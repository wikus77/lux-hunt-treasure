const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mapStore.DJ51G-DA.js","assets/three-vendor.B3e0mz6d.js","assets/react-vendor.CAU3V3le.js","assets/ui-vendor.CkkPodTS.js","assets/MapTiler3D.B7HciP6X.js","assets/animation-vendor.BBMfCuXy.js","assets/supabase-vendor.Be5pfGoK.js","assets/map-vendor.DP0KRNIP.js","assets/stripe-vendor.DYHkqekj.js","assets/router-vendor.opNAzTki.js","assets/MapTiler3D.hkuiddIC.css","assets/ShadowIntercepts.BmcMEHuS.js","assets/contextBuilder.CcFueusl.js","assets/MarkersHealthcheck.CyVW0NID.js","assets/SendNotificationPage.Bnn_4_3p.js","assets/MissionPanelPage.BZkGObEB.js","assets/PulseLab.B0VT9Jnm.js","assets/PushTestPage.Vt0nqUQa.js","assets/test-tube.Ck18vXQW.js","assets/AdminPushConsolePage.CK-M87o9.js","assets/pushApi.BzV5UMHP.js","assets/PushSenderPanel.BAspSXC-.js","assets/api.DTyiylKT.js","assets/NotificationDebug.D0xuRqV3.js","assets/PanelAccessPage.knmRIi_t.js","assets/usePanelAccessProtection.fYNIkpB2.js","assets/MarkerRewardManager.DSM5V2U3.js","assets/enablePush.Bj56GJ45.js","assets/radio-group.a7M-ytHY.js","assets/PushDiagnosi.Cgtqc7rg.js","assets/PanelUsersPage.UHzW9p_9.js","assets/BulkMarkerDropPage.DK4pMuEz.js","assets/MarkerRewardsPage.D8UrjdBq.js","assets/NorahAdmin.DSzOGn68.js","assets/pause.5qOwhCHd.js","assets/DiagSupabase.D7b1Eaov.js","assets/SupabaseConnectionTest.CYMIAl3i.js","assets/PushTest.CgX_94cz.js","assets/PushDiagnostic.DEjtqH6P.js","assets/M1ssionPushTest.BUQxQa_N.js","assets/M1ssionDebugTest.D007Nbc4.js","assets/firebase-notification-debug.Bg93Ck0A.js","assets/useFcm.BkmHgguS.js","assets/PushHealth.BmSUR0iu.js","assets/PushDebug.CufkiEfE.js","assets/PushReport.CPy3iva0.js","assets/OnboardingSandbox.5XzuCPKZ.js","assets/FcmTest.vqpc-Dn7.js","assets/PushTest.BtYqnlCZ.js","assets/UserPushConsolePage.CQVyVR5R.js","assets/useAutoInterestSignals.CeXJWyfH.js","assets/interestSignals.Dc6ZMrNh.js","assets/prod-hide-debug.CBE4uU49.css","assets/testFcm.DjGuDkD2.js","assets/productionMonitoring.CwBHBKVP.js"])))=>i.map(i=>d[i]);
import { s as shimExports, _ as __vitePreload, c as create$1, p as persist, S as Scene, a as PerspectiveCamera, W as WebGLRenderer, I as IcosahedronGeometry, M as MeshStandardMaterial, C as Color, b as Mesh, A as AmbientLight, d as PointLight, e as Controls, V as Vector3, f as MOUSE, T as TOUCH, Q as Quaternion, g as Spherical, h as Vector2, R as Ray, i as Plane, j as MathUtils, k as SphereGeometry, l as MeshBasicMaterial, m as InstancedMesh, n as Matrix4, o as Raycaster, L as LineCurve3, q as TubeGeometry, r as ShaderMaterial, t as AdditiveBlending, u as SRGBColorSpace, v as ACESFilmicToneMapping, F as Fog, G as Group, B as BufferGeometry, w as BufferAttribute, E as EdgesGeometry, x as LineBasicMaterial, y as LineSegments, z as Clock$1, D as client$1 } from './three-vendor.B3e0mz6d.js';
import { j as jsxRuntimeExports, c as composeRefs, u as useCallbackRef, b as useLayoutEffect2, O as Overlay, P as Portal$1, C as Content, d as Close, T as Title, D as Description, e as createPopperScope, f as useDirection, g as useControllableState, R as Root2$2, h as createContextScope$2, i as useId, k as createCollection, l as useComposedRefs, m as Primitive$3, V as VISUALLY_HIDDEN_STYLES, A as Anchor, n as composeEventHandlers, o as Portal$2, p as hideOthers, q as useFocusGuards, r as ReactRemoveScroll, F as FocusScope, s as DismissableLayer, v as Content$1, w as Arrow, x as createDialogScope, W as WarningProvider, y as Root$3, z as Trigger$1, B as Presence, E as useSize } from './ui-vendor.CkkPodTS.js';
import { c as createClient } from './supabase-vendor.Be5pfGoK.js';
import { r as reactExports, R as React, c as React$1, b as ReactDOM, d as getDefaultExportFromCjs, a as reactDomExports } from './react-vendor.CAU3V3le.js';
import { m as motion, A as AnimatePresence, u as useLottie, L as LayoutGroup, a as useMotionValue, b as useTransform } from './animation-vendor.BBMfCuXy.js';
import { L as L$1, M as MapContainer, T as TileLayer, a as Marker, P as Popup, C as Circle$1, u as useMapEvents } from './map-vendor.DP0KRNIP.js';
import { l as loadStripe, E as Elements, u as useStripe, a as useElements, C as CardElement } from './stripe-vendor.DYHkqekj.js';
import { u as useParams$1, a as useNavigate } from './router-vendor.opNAzTki.js';

true&&(function polyfill() {
  const relList = document.createElement("link").relList;
  if (relList && relList.supports && relList.supports("modulepreload")) {
    return;
  }
  for (const link of document.querySelectorAll('link[rel="modulepreload"]')) {
    processPreload(link);
  }
  new MutationObserver((mutations) => {
    for (const mutation of mutations) {
      if (mutation.type !== "childList") {
        continue;
      }
      for (const node of mutation.addedNodes) {
        if (node.tagName === "LINK" && node.rel === "modulepreload")
          processPreload(node);
      }
    }
  }).observe(document, { childList: true, subtree: true });
  function getFetchOpts(link) {
    const fetchOpts = {};
    if (link.integrity) fetchOpts.integrity = link.integrity;
    if (link.referrerPolicy) fetchOpts.referrerPolicy = link.referrerPolicy;
    if (link.crossOrigin === "use-credentials")
      fetchOpts.credentials = "include";
    else if (link.crossOrigin === "anonymous") fetchOpts.credentials = "omit";
    else fetchOpts.credentials = "same-origin";
    return fetchOpts;
  }
  function processPreload(link) {
    if (link.ep)
      return;
    link.ep = true;
    const fetchOpts = getFetchOpts(link);
    fetch(link.href, fetchOpts);
  }
}());

const SUPABASE_URL = "https://vkjrqirvdvjbemsfzxof.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk";
const supabase = createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true
  }
});

const client = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  supabase
}, Symbol.toStringTag, { value: 'Module' }));

function getProjectRef$1() {
  const url = supabase.supabaseUrl || "";
  const match = url.match(/https:\/\/([^.]+)\.supabase\.co/);
  return match?.[1] || "vkjrqirvdvjbemsfzxof";
}
function getSupabaseUrl() {
  return supabase.supabaseUrl || "https://vkjrqirvdvjbemsfzxof.supabase.co";
}
function getSupabaseAnonKey() {
  return "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk";
}
function getFunctionsUrl() {
  const baseUrl = getSupabaseUrl();
  return `${baseUrl.replace(/\/$/, "")}/functions/v1`;
}
function getAuthTokenKey() {
  return `sb-${getProjectRef$1()}-auth-token`;
}
function getSupabaseConfig() {
  return {
    projectRef: getProjectRef$1(),
    url: getSupabaseUrl(),
    anonKey: getSupabaseAnonKey(),
    functionsUrl: getFunctionsUrl()
  };
}

const clientUtils = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  getAuthTokenKey,
  getFunctionsUrl,
  getProjectRef: getProjectRef$1,
  getSupabaseAnonKey,
  getSupabaseConfig,
  getSupabaseUrl
}, Symbol.toStringTag, { value: 'Module' }));

async function ensureSWAnyHost() {
  if (!("serviceWorker" in navigator)) {
    return null;
  }
  try {
    const existing = await navigator.serviceWorker.getRegistration("/");
    if (existing?.active?.scriptURL.includes("/sw.js")) {
      return existing;
    }
    const registration = await navigator.serviceWorker.register("/sw.js", {
      scope: "/",
      updateViaCache: "none"
    });
    await navigator.serviceWorker.ready;
    return registration;
  } catch (error) {
    const errStr = String(error?.message || error || "");
    if (errStr.includes("503") || errStr.includes("ERR_FAILED") || errStr.includes("failed to fetch")) ;
    return null;
  }
}

(async () => {
  try {
    await ensureSWAnyHost();
  } catch (error) {
  }
})();

// src/subscribable.ts
var Subscribable = class {
  constructor() {
    this.listeners = /* @__PURE__ */ new Set();
    this.subscribe = this.subscribe.bind(this);
  }
  subscribe(listener) {
    this.listeners.add(listener);
    this.onSubscribe();
    return () => {
      this.listeners.delete(listener);
      this.onUnsubscribe();
    };
  }
  hasListeners() {
    return this.listeners.size > 0;
  }
  onSubscribe() {
  }
  onUnsubscribe() {
  }
};

var defaultTimeoutProvider = {
  // We need the wrapper function syntax below instead of direct references to
  // global setTimeout etc.
  //
  // BAD: `setTimeout: setTimeout`
  // GOOD: `setTimeout: (cb, delay) => setTimeout(cb, delay)`
  //
  // If we use direct references here, then anything that wants to spy on or
  // replace the global setTimeout (like tests) won't work since we'll already
  // have a hard reference to the original implementation at the time when this
  // file was imported.
  setTimeout: (callback, delay) => setTimeout(callback, delay),
  clearTimeout: (timeoutId) => clearTimeout(timeoutId),
  setInterval: (callback, delay) => setInterval(callback, delay),
  clearInterval: (intervalId) => clearInterval(intervalId)
};
var TimeoutManager = class {
  // We cannot have TimeoutManager<T> as we must instantiate it with a concrete
  // type at app boot; and if we leave that type, then any new timer provider
  // would need to support ReturnType<typeof setTimeout>, which is infeasible.
  //
  // We settle for type safety for the TimeoutProvider type, and accept that
  // this class is unsafe internally to allow for extension.
  #provider = defaultTimeoutProvider;
  #providerCalled = false;
  setTimeoutProvider(provider) {
    this.#provider = provider;
  }
  setTimeout(callback, delay) {
    return this.#provider.setTimeout(callback, delay);
  }
  clearTimeout(timeoutId) {
    this.#provider.clearTimeout(timeoutId);
  }
  setInterval(callback, delay) {
    return this.#provider.setInterval(callback, delay);
  }
  clearInterval(intervalId) {
    this.#provider.clearInterval(intervalId);
  }
};
var timeoutManager = new TimeoutManager();
function systemSetTimeoutZero(callback) {
  setTimeout(callback, 0);
}

var isServer = typeof window === "undefined" || "Deno" in globalThis;
function noop$1() {
}
function functionalUpdate(updater, input) {
  return typeof updater === "function" ? updater(input) : updater;
}
function isValidTimeout(value) {
  return typeof value === "number" && value >= 0 && value !== Infinity;
}
function timeUntilStale(updatedAt, staleTime) {
  return Math.max(updatedAt + (staleTime || 0) - Date.now(), 0);
}
function resolveStaleTime(staleTime, query) {
  return typeof staleTime === "function" ? staleTime(query) : staleTime;
}
function resolveEnabled(enabled, query) {
  return typeof enabled === "function" ? enabled(query) : enabled;
}
function matchQuery(filters, query) {
  const {
    type = "all",
    exact,
    fetchStatus,
    predicate,
    queryKey,
    stale
  } = filters;
  if (queryKey) {
    if (exact) {
      if (query.queryHash !== hashQueryKeyByOptions(queryKey, query.options)) {
        return false;
      }
    } else if (!partialMatchKey(query.queryKey, queryKey)) {
      return false;
    }
  }
  if (type !== "all") {
    const isActive = query.isActive();
    if (type === "active" && !isActive) {
      return false;
    }
    if (type === "inactive" && isActive) {
      return false;
    }
  }
  if (typeof stale === "boolean" && query.isStale() !== stale) {
    return false;
  }
  if (fetchStatus && fetchStatus !== query.state.fetchStatus) {
    return false;
  }
  if (predicate && !predicate(query)) {
    return false;
  }
  return true;
}
function matchMutation(filters, mutation) {
  const { exact, status, predicate, mutationKey } = filters;
  if (mutationKey) {
    if (!mutation.options.mutationKey) {
      return false;
    }
    if (exact) {
      if (hashKey(mutation.options.mutationKey) !== hashKey(mutationKey)) {
        return false;
      }
    } else if (!partialMatchKey(mutation.options.mutationKey, mutationKey)) {
      return false;
    }
  }
  if (status && mutation.state.status !== status) {
    return false;
  }
  if (predicate && !predicate(mutation)) {
    return false;
  }
  return true;
}
function hashQueryKeyByOptions(queryKey, options) {
  const hashFn = options?.queryKeyHashFn || hashKey;
  return hashFn(queryKey);
}
function hashKey(queryKey) {
  return JSON.stringify(
    queryKey,
    (_, val) => isPlainObject(val) ? Object.keys(val).sort().reduce((result, key) => {
      result[key] = val[key];
      return result;
    }, {}) : val
  );
}
function partialMatchKey(a, b) {
  if (a === b) {
    return true;
  }
  if (typeof a !== typeof b) {
    return false;
  }
  if (a && b && typeof a === "object" && typeof b === "object") {
    return Object.keys(b).every((key) => partialMatchKey(a[key], b[key]));
  }
  return false;
}
var hasOwn = Object.prototype.hasOwnProperty;
function replaceEqualDeep(a, b) {
  if (a === b) {
    return a;
  }
  const array = isPlainArray(a) && isPlainArray(b);
  if (!array && !(isPlainObject(a) && isPlainObject(b))) return b;
  const aItems = array ? a : Object.keys(a);
  const aSize = aItems.length;
  const bItems = array ? b : Object.keys(b);
  const bSize = bItems.length;
  const copy = array ? new Array(bSize) : {};
  let equalItems = 0;
  for (let i = 0; i < bSize; i++) {
    const key = array ? i : bItems[i];
    const aItem = a[key];
    const bItem = b[key];
    if (aItem === bItem) {
      copy[key] = aItem;
      if (array ? i < aSize : hasOwn.call(a, key)) equalItems++;
      continue;
    }
    if (aItem === null || bItem === null || typeof aItem !== "object" || typeof bItem !== "object") {
      copy[key] = bItem;
      continue;
    }
    const v = replaceEqualDeep(aItem, bItem);
    copy[key] = v;
    if (v === aItem) equalItems++;
  }
  return aSize === bSize && equalItems === aSize ? a : copy;
}
function isPlainArray(value) {
  return Array.isArray(value) && value.length === Object.keys(value).length;
}
function isPlainObject(o) {
  if (!hasObjectPrototype(o)) {
    return false;
  }
  const ctor = o.constructor;
  if (ctor === void 0) {
    return true;
  }
  const prot = ctor.prototype;
  if (!hasObjectPrototype(prot)) {
    return false;
  }
  if (!prot.hasOwnProperty("isPrototypeOf")) {
    return false;
  }
  if (Object.getPrototypeOf(o) !== Object.prototype) {
    return false;
  }
  return true;
}
function hasObjectPrototype(o) {
  return Object.prototype.toString.call(o) === "[object Object]";
}
function sleep(timeout) {
  return new Promise((resolve) => {
    timeoutManager.setTimeout(resolve, timeout);
  });
}
function replaceData(prevData, data, options) {
  if (typeof options.structuralSharing === "function") {
    return options.structuralSharing(prevData, data);
  } else if (options.structuralSharing !== false) {
    return replaceEqualDeep(prevData, data);
  }
  return data;
}
function addToEnd(items, item, max = 0) {
  const newItems = [...items, item];
  return max && newItems.length > max ? newItems.slice(1) : newItems;
}
function addToStart(items, item, max = 0) {
  const newItems = [item, ...items];
  return max && newItems.length > max ? newItems.slice(0, -1) : newItems;
}
var skipToken = Symbol();
function ensureQueryFn(options, fetchOptions) {
  if (!options.queryFn && fetchOptions?.initialPromise) {
    return () => fetchOptions.initialPromise;
  }
  if (!options.queryFn || options.queryFn === skipToken) {
    return () => Promise.reject(new Error(`Missing queryFn: '${options.queryHash}'`));
  }
  return options.queryFn;
}

var FocusManager = class extends Subscribable {
  #focused;
  #cleanup;
  #setup;
  constructor() {
    super();
    this.#setup = (onFocus) => {
      if (!isServer && window.addEventListener) {
        const listener = () => onFocus();
        window.addEventListener("visibilitychange", listener, false);
        return () => {
          window.removeEventListener("visibilitychange", listener);
        };
      }
      return;
    };
  }
  onSubscribe() {
    if (!this.#cleanup) {
      this.setEventListener(this.#setup);
    }
  }
  onUnsubscribe() {
    if (!this.hasListeners()) {
      this.#cleanup?.();
      this.#cleanup = void 0;
    }
  }
  setEventListener(setup) {
    this.#setup = setup;
    this.#cleanup?.();
    this.#cleanup = setup((focused) => {
      if (typeof focused === "boolean") {
        this.setFocused(focused);
      } else {
        this.onFocus();
      }
    });
  }
  setFocused(focused) {
    const changed = this.#focused !== focused;
    if (changed) {
      this.#focused = focused;
      this.onFocus();
    }
  }
  onFocus() {
    const isFocused = this.isFocused();
    this.listeners.forEach((listener) => {
      listener(isFocused);
    });
  }
  isFocused() {
    if (typeof this.#focused === "boolean") {
      return this.#focused;
    }
    return globalThis.document?.visibilityState !== "hidden";
  }
};
var focusManager = new FocusManager();

// src/thenable.ts
function pendingThenable() {
  let resolve;
  let reject;
  const thenable = new Promise((_resolve, _reject) => {
    resolve = _resolve;
    reject = _reject;
  });
  thenable.status = "pending";
  thenable.catch(() => {
  });
  function finalize(data) {
    Object.assign(thenable, data);
    delete thenable.resolve;
    delete thenable.reject;
  }
  thenable.resolve = (value) => {
    finalize({
      status: "fulfilled",
      value
    });
    resolve(value);
  };
  thenable.reject = (reason) => {
    finalize({
      status: "rejected",
      reason
    });
    reject(reason);
  };
  return thenable;
}

// src/notifyManager.ts
var defaultScheduler = systemSetTimeoutZero;
function createNotifyManager() {
  let queue = [];
  let transactions = 0;
  let notifyFn = (callback) => {
    callback();
  };
  let batchNotifyFn = (callback) => {
    callback();
  };
  let scheduleFn = defaultScheduler;
  const schedule = (callback) => {
    if (transactions) {
      queue.push(callback);
    } else {
      scheduleFn(() => {
        notifyFn(callback);
      });
    }
  };
  const flush = () => {
    const originalQueue = queue;
    queue = [];
    if (originalQueue.length) {
      scheduleFn(() => {
        batchNotifyFn(() => {
          originalQueue.forEach((callback) => {
            notifyFn(callback);
          });
        });
      });
    }
  };
  return {
    batch: (callback) => {
      let result;
      transactions++;
      try {
        result = callback();
      } finally {
        transactions--;
        if (!transactions) {
          flush();
        }
      }
      return result;
    },
    /**
     * All calls to the wrapped function will be batched.
     */
    batchCalls: (callback) => {
      return (...args) => {
        schedule(() => {
          callback(...args);
        });
      };
    },
    schedule,
    /**
     * Use this method to set a custom notify function.
     * This can be used to for example wrap notifications with `React.act` while running tests.
     */
    setNotifyFunction: (fn) => {
      notifyFn = fn;
    },
    /**
     * Use this method to set a custom function to batch notifications together into a single tick.
     * By default React Query will use the batch function provided by ReactDOM or React Native.
     */
    setBatchNotifyFunction: (fn) => {
      batchNotifyFn = fn;
    },
    setScheduler: (fn) => {
      scheduleFn = fn;
    }
  };
}
var notifyManager = createNotifyManager();

// src/onlineManager.ts
var OnlineManager = class extends Subscribable {
  #online = true;
  #cleanup;
  #setup;
  constructor() {
    super();
    this.#setup = (onOnline) => {
      if (!isServer && window.addEventListener) {
        const onlineListener = () => onOnline(true);
        const offlineListener = () => onOnline(false);
        window.addEventListener("online", onlineListener, false);
        window.addEventListener("offline", offlineListener, false);
        return () => {
          window.removeEventListener("online", onlineListener);
          window.removeEventListener("offline", offlineListener);
        };
      }
      return;
    };
  }
  onSubscribe() {
    if (!this.#cleanup) {
      this.setEventListener(this.#setup);
    }
  }
  onUnsubscribe() {
    if (!this.hasListeners()) {
      this.#cleanup?.();
      this.#cleanup = void 0;
    }
  }
  setEventListener(setup) {
    this.#setup = setup;
    this.#cleanup?.();
    this.#cleanup = setup(this.setOnline.bind(this));
  }
  setOnline(online) {
    const changed = this.#online !== online;
    if (changed) {
      this.#online = online;
      this.listeners.forEach((listener) => {
        listener(online);
      });
    }
  }
  isOnline() {
    return this.#online;
  }
};
var onlineManager = new OnlineManager();

// src/retryer.ts
function defaultRetryDelay(failureCount) {
  return Math.min(1e3 * 2 ** failureCount, 3e4);
}
function canFetch(networkMode) {
  return (networkMode ?? "online") === "online" ? onlineManager.isOnline() : true;
}
var CancelledError = class extends Error {
  constructor(options) {
    super("CancelledError");
    this.revert = options?.revert;
    this.silent = options?.silent;
  }
};
function createRetryer(config) {
  let isRetryCancelled = false;
  let failureCount = 0;
  let continueFn;
  const thenable = pendingThenable();
  const isResolved = () => thenable.status !== "pending";
  const cancel = (cancelOptions) => {
    if (!isResolved()) {
      const error = new CancelledError(cancelOptions);
      reject(error);
      config.onCancel?.(error);
    }
  };
  const cancelRetry = () => {
    isRetryCancelled = true;
  };
  const continueRetry = () => {
    isRetryCancelled = false;
  };
  const canContinue = () => focusManager.isFocused() && (config.networkMode === "always" || onlineManager.isOnline()) && config.canRun();
  const canStart = () => canFetch(config.networkMode) && config.canRun();
  const resolve = (value) => {
    if (!isResolved()) {
      continueFn?.();
      thenable.resolve(value);
    }
  };
  const reject = (value) => {
    if (!isResolved()) {
      continueFn?.();
      thenable.reject(value);
    }
  };
  const pause = () => {
    return new Promise((continueResolve) => {
      continueFn = (value) => {
        if (isResolved() || canContinue()) {
          continueResolve(value);
        }
      };
      config.onPause?.();
    }).then(() => {
      continueFn = void 0;
      if (!isResolved()) {
        config.onContinue?.();
      }
    });
  };
  const run = () => {
    if (isResolved()) {
      return;
    }
    let promiseOrValue;
    const initialPromise = failureCount === 0 ? config.initialPromise : void 0;
    try {
      promiseOrValue = initialPromise ?? config.fn();
    } catch (error) {
      promiseOrValue = Promise.reject(error);
    }
    Promise.resolve(promiseOrValue).then(resolve).catch((error) => {
      if (isResolved()) {
        return;
      }
      const retry = config.retry ?? (isServer ? 0 : 3);
      const retryDelay = config.retryDelay ?? defaultRetryDelay;
      const delay = typeof retryDelay === "function" ? retryDelay(failureCount, error) : retryDelay;
      const shouldRetry = retry === true || typeof retry === "number" && failureCount < retry || typeof retry === "function" && retry(failureCount, error);
      if (isRetryCancelled || !shouldRetry) {
        reject(error);
        return;
      }
      failureCount++;
      config.onFail?.(failureCount, error);
      sleep(delay).then(() => {
        return canContinue() ? void 0 : pause();
      }).then(() => {
        if (isRetryCancelled) {
          reject(error);
        } else {
          run();
        }
      });
    });
  };
  return {
    promise: thenable,
    status: () => thenable.status,
    cancel,
    continue: () => {
      continueFn?.();
      return thenable;
    },
    cancelRetry,
    continueRetry,
    canStart,
    start: () => {
      if (canStart()) {
        run();
      } else {
        pause().then(run);
      }
      return thenable;
    }
  };
}

// src/removable.ts
var Removable = class {
  #gcTimeout;
  destroy() {
    this.clearGcTimeout();
  }
  scheduleGc() {
    this.clearGcTimeout();
    if (isValidTimeout(this.gcTime)) {
      this.#gcTimeout = timeoutManager.setTimeout(() => {
        this.optionalRemove();
      }, this.gcTime);
    }
  }
  updateGcTime(newGcTime) {
    this.gcTime = Math.max(
      this.gcTime || 0,
      newGcTime ?? (isServer ? Infinity : 5 * 60 * 1e3)
    );
  }
  clearGcTimeout() {
    if (this.#gcTimeout) {
      timeoutManager.clearTimeout(this.#gcTimeout);
      this.#gcTimeout = void 0;
    }
  }
};

var Query = class extends Removable {
  #initialState;
  #revertState;
  #cache;
  #client;
  #retryer;
  #defaultOptions;
  #abortSignalConsumed;
  constructor(config) {
    super();
    this.#abortSignalConsumed = false;
    this.#defaultOptions = config.defaultOptions;
    this.setOptions(config.options);
    this.observers = [];
    this.#client = config.client;
    this.#cache = this.#client.getQueryCache();
    this.queryKey = config.queryKey;
    this.queryHash = config.queryHash;
    this.#initialState = getDefaultState$1(this.options);
    this.state = config.state ?? this.#initialState;
    this.scheduleGc();
  }
  get meta() {
    return this.options.meta;
  }
  get promise() {
    return this.#retryer?.promise;
  }
  setOptions(options) {
    this.options = { ...this.#defaultOptions, ...options };
    this.updateGcTime(this.options.gcTime);
    if (this.state && this.state.data === void 0) {
      const defaultState = getDefaultState$1(this.options);
      if (defaultState.data !== void 0) {
        this.setState(
          successState(defaultState.data, defaultState.dataUpdatedAt)
        );
        this.#initialState = defaultState;
      }
    }
  }
  optionalRemove() {
    if (!this.observers.length && this.state.fetchStatus === "idle") {
      this.#cache.remove(this);
    }
  }
  setData(newData, options) {
    const data = replaceData(this.state.data, newData, this.options);
    this.#dispatch({
      data,
      type: "success",
      dataUpdatedAt: options?.updatedAt,
      manual: options?.manual
    });
    return data;
  }
  setState(state, setStateOptions) {
    this.#dispatch({ type: "setState", state, setStateOptions });
  }
  cancel(options) {
    const promise = this.#retryer?.promise;
    this.#retryer?.cancel(options);
    return promise ? promise.then(noop$1).catch(noop$1) : Promise.resolve();
  }
  destroy() {
    super.destroy();
    this.cancel({ silent: true });
  }
  reset() {
    this.destroy();
    this.setState(this.#initialState);
  }
  isActive() {
    return this.observers.some(
      (observer) => resolveEnabled(observer.options.enabled, this) !== false
    );
  }
  isDisabled() {
    if (this.getObserversCount() > 0) {
      return !this.isActive();
    }
    return this.options.queryFn === skipToken || this.state.dataUpdateCount + this.state.errorUpdateCount === 0;
  }
  isStatic() {
    if (this.getObserversCount() > 0) {
      return this.observers.some(
        (observer) => resolveStaleTime(observer.options.staleTime, this) === "static"
      );
    }
    return false;
  }
  isStale() {
    if (this.getObserversCount() > 0) {
      return this.observers.some(
        (observer) => observer.getCurrentResult().isStale
      );
    }
    return this.state.data === void 0 || this.state.isInvalidated;
  }
  isStaleByTime(staleTime = 0) {
    if (this.state.data === void 0) {
      return true;
    }
    if (staleTime === "static") {
      return false;
    }
    if (this.state.isInvalidated) {
      return true;
    }
    return !timeUntilStale(this.state.dataUpdatedAt, staleTime);
  }
  onFocus() {
    const observer = this.observers.find((x) => x.shouldFetchOnWindowFocus());
    observer?.refetch({ cancelRefetch: false });
    this.#retryer?.continue();
  }
  onOnline() {
    const observer = this.observers.find((x) => x.shouldFetchOnReconnect());
    observer?.refetch({ cancelRefetch: false });
    this.#retryer?.continue();
  }
  addObserver(observer) {
    if (!this.observers.includes(observer)) {
      this.observers.push(observer);
      this.clearGcTimeout();
      this.#cache.notify({ type: "observerAdded", query: this, observer });
    }
  }
  removeObserver(observer) {
    if (this.observers.includes(observer)) {
      this.observers = this.observers.filter((x) => x !== observer);
      if (!this.observers.length) {
        if (this.#retryer) {
          if (this.#abortSignalConsumed) {
            this.#retryer.cancel({ revert: true });
          } else {
            this.#retryer.cancelRetry();
          }
        }
        this.scheduleGc();
      }
      this.#cache.notify({ type: "observerRemoved", query: this, observer });
    }
  }
  getObserversCount() {
    return this.observers.length;
  }
  invalidate() {
    if (!this.state.isInvalidated) {
      this.#dispatch({ type: "invalidate" });
    }
  }
  async fetch(options, fetchOptions) {
    if (this.state.fetchStatus !== "idle" && // If the promise in the retyer is already rejected, we have to definitely
    // re-start the fetch; there is a chance that the query is still in a
    // pending state when that happens
    this.#retryer?.status() !== "rejected") {
      if (this.state.data !== void 0 && fetchOptions?.cancelRefetch) {
        this.cancel({ silent: true });
      } else if (this.#retryer) {
        this.#retryer.continueRetry();
        return this.#retryer.promise;
      }
    }
    if (options) {
      this.setOptions(options);
    }
    if (!this.options.queryFn) {
      const observer = this.observers.find((x) => x.options.queryFn);
      if (observer) {
        this.setOptions(observer.options);
      }
    }
    const abortController = new AbortController();
    const addSignalProperty = (object) => {
      Object.defineProperty(object, "signal", {
        enumerable: true,
        get: () => {
          this.#abortSignalConsumed = true;
          return abortController.signal;
        }
      });
    };
    const fetchFn = () => {
      const queryFn = ensureQueryFn(this.options, fetchOptions);
      const createQueryFnContext = () => {
        const queryFnContext2 = {
          client: this.#client,
          queryKey: this.queryKey,
          meta: this.meta
        };
        addSignalProperty(queryFnContext2);
        return queryFnContext2;
      };
      const queryFnContext = createQueryFnContext();
      this.#abortSignalConsumed = false;
      if (this.options.persister) {
        return this.options.persister(
          queryFn,
          queryFnContext,
          this
        );
      }
      return queryFn(queryFnContext);
    };
    const createFetchContext = () => {
      const context2 = {
        fetchOptions,
        options: this.options,
        queryKey: this.queryKey,
        client: this.#client,
        state: this.state,
        fetchFn
      };
      addSignalProperty(context2);
      return context2;
    };
    const context = createFetchContext();
    this.options.behavior?.onFetch(context, this);
    this.#revertState = this.state;
    if (this.state.fetchStatus === "idle" || this.state.fetchMeta !== context.fetchOptions?.meta) {
      this.#dispatch({ type: "fetch", meta: context.fetchOptions?.meta });
    }
    this.#retryer = createRetryer({
      initialPromise: fetchOptions?.initialPromise,
      fn: context.fetchFn,
      onCancel: (error) => {
        if (error instanceof CancelledError && error.revert) {
          this.setState({
            ...this.#revertState,
            fetchStatus: "idle"
          });
        }
        abortController.abort();
      },
      onFail: (failureCount, error) => {
        this.#dispatch({ type: "failed", failureCount, error });
      },
      onPause: () => {
        this.#dispatch({ type: "pause" });
      },
      onContinue: () => {
        this.#dispatch({ type: "continue" });
      },
      retry: context.options.retry,
      retryDelay: context.options.retryDelay,
      networkMode: context.options.networkMode,
      canRun: () => true
    });
    try {
      const data = await this.#retryer.start();
      if (data === void 0) {
        if (false) ;
        throw new Error(`${this.queryHash} data is undefined`);
      }
      this.setData(data);
      this.#cache.config.onSuccess?.(data, this);
      this.#cache.config.onSettled?.(
        data,
        this.state.error,
        this
      );
      return data;
    } catch (error) {
      if (error instanceof CancelledError) {
        if (error.silent) {
          return this.#retryer.promise;
        } else if (error.revert) {
          if (this.state.data === void 0) {
            throw error;
          }
          return this.state.data;
        }
      }
      this.#dispatch({
        type: "error",
        error
      });
      this.#cache.config.onError?.(
        error,
        this
      );
      this.#cache.config.onSettled?.(
        this.state.data,
        error,
        this
      );
      throw error;
    } finally {
      this.scheduleGc();
    }
  }
  #dispatch(action) {
    const reducer = (state) => {
      switch (action.type) {
        case "failed":
          return {
            ...state,
            fetchFailureCount: action.failureCount,
            fetchFailureReason: action.error
          };
        case "pause":
          return {
            ...state,
            fetchStatus: "paused"
          };
        case "continue":
          return {
            ...state,
            fetchStatus: "fetching"
          };
        case "fetch":
          return {
            ...state,
            ...fetchState(state.data, this.options),
            fetchMeta: action.meta ?? null
          };
        case "success":
          const newState = {
            ...state,
            ...successState(action.data, action.dataUpdatedAt),
            dataUpdateCount: state.dataUpdateCount + 1,
            ...!action.manual && {
              fetchStatus: "idle",
              fetchFailureCount: 0,
              fetchFailureReason: null
            }
          };
          this.#revertState = action.manual ? newState : void 0;
          return newState;
        case "error":
          const error = action.error;
          return {
            ...state,
            error,
            errorUpdateCount: state.errorUpdateCount + 1,
            errorUpdatedAt: Date.now(),
            fetchFailureCount: state.fetchFailureCount + 1,
            fetchFailureReason: error,
            fetchStatus: "idle",
            status: "error"
          };
        case "invalidate":
          return {
            ...state,
            isInvalidated: true
          };
        case "setState":
          return {
            ...state,
            ...action.state
          };
      }
    };
    this.state = reducer(this.state);
    notifyManager.batch(() => {
      this.observers.forEach((observer) => {
        observer.onQueryUpdate();
      });
      this.#cache.notify({ query: this, type: "updated", action });
    });
  }
};
function fetchState(data, options) {
  return {
    fetchFailureCount: 0,
    fetchFailureReason: null,
    fetchStatus: canFetch(options.networkMode) ? "fetching" : "paused",
    ...data === void 0 && {
      error: null,
      status: "pending"
    }
  };
}
function successState(data, dataUpdatedAt) {
  return {
    data,
    dataUpdatedAt: dataUpdatedAt ?? Date.now(),
    error: null,
    isInvalidated: false,
    status: "success"
  };
}
function getDefaultState$1(options) {
  const data = typeof options.initialData === "function" ? options.initialData() : options.initialData;
  const hasData = data !== void 0;
  const initialDataUpdatedAt = hasData ? typeof options.initialDataUpdatedAt === "function" ? options.initialDataUpdatedAt() : options.initialDataUpdatedAt : 0;
  return {
    data,
    dataUpdateCount: 0,
    dataUpdatedAt: hasData ? initialDataUpdatedAt ?? Date.now() : 0,
    error: null,
    errorUpdateCount: 0,
    errorUpdatedAt: 0,
    fetchFailureCount: 0,
    fetchFailureReason: null,
    fetchMeta: null,
    isInvalidated: false,
    status: hasData ? "success" : "pending",
    fetchStatus: "idle"
  };
}

// src/infiniteQueryBehavior.ts
function infiniteQueryBehavior(pages) {
  return {
    onFetch: (context, query) => {
      const options = context.options;
      const direction = context.fetchOptions?.meta?.fetchMore?.direction;
      const oldPages = context.state.data?.pages || [];
      const oldPageParams = context.state.data?.pageParams || [];
      let result = { pages: [], pageParams: [] };
      let currentPage = 0;
      const fetchFn = async () => {
        let cancelled = false;
        const addSignalProperty = (object) => {
          Object.defineProperty(object, "signal", {
            enumerable: true,
            get: () => {
              if (context.signal.aborted) {
                cancelled = true;
              } else {
                context.signal.addEventListener("abort", () => {
                  cancelled = true;
                });
              }
              return context.signal;
            }
          });
        };
        const queryFn = ensureQueryFn(context.options, context.fetchOptions);
        const fetchPage = async (data, param, previous) => {
          if (cancelled) {
            return Promise.reject();
          }
          if (param == null && data.pages.length) {
            return Promise.resolve(data);
          }
          const createQueryFnContext = () => {
            const queryFnContext2 = {
              client: context.client,
              queryKey: context.queryKey,
              pageParam: param,
              direction: previous ? "backward" : "forward",
              meta: context.options.meta
            };
            addSignalProperty(queryFnContext2);
            return queryFnContext2;
          };
          const queryFnContext = createQueryFnContext();
          const page = await queryFn(queryFnContext);
          const { maxPages } = context.options;
          const addTo = previous ? addToStart : addToEnd;
          return {
            pages: addTo(data.pages, page, maxPages),
            pageParams: addTo(data.pageParams, param, maxPages)
          };
        };
        if (direction && oldPages.length) {
          const previous = direction === "backward";
          const pageParamFn = previous ? getPreviousPageParam : getNextPageParam;
          const oldData = {
            pages: oldPages,
            pageParams: oldPageParams
          };
          const param = pageParamFn(options, oldData);
          result = await fetchPage(oldData, param, previous);
        } else {
          const remainingPages = pages ?? oldPages.length;
          do {
            const param = currentPage === 0 ? oldPageParams[0] ?? options.initialPageParam : getNextPageParam(options, result);
            if (currentPage > 0 && param == null) {
              break;
            }
            result = await fetchPage(result, param);
            currentPage++;
          } while (currentPage < remainingPages);
        }
        return result;
      };
      if (context.options.persister) {
        context.fetchFn = () => {
          return context.options.persister?.(
            fetchFn,
            {
              client: context.client,
              queryKey: context.queryKey,
              meta: context.options.meta,
              signal: context.signal
            },
            query
          );
        };
      } else {
        context.fetchFn = fetchFn;
      }
    }
  };
}
function getNextPageParam(options, { pages, pageParams }) {
  const lastIndex = pages.length - 1;
  return pages.length > 0 ? options.getNextPageParam(
    pages[lastIndex],
    pages,
    pageParams[lastIndex],
    pageParams
  ) : void 0;
}
function getPreviousPageParam(options, { pages, pageParams }) {
  return pages.length > 0 ? options.getPreviousPageParam?.(pages[0], pages, pageParams[0], pageParams) : void 0;
}

// src/mutation.ts
var Mutation = class extends Removable {
  #client;
  #observers;
  #mutationCache;
  #retryer;
  constructor(config) {
    super();
    this.#client = config.client;
    this.mutationId = config.mutationId;
    this.#mutationCache = config.mutationCache;
    this.#observers = [];
    this.state = config.state || getDefaultState();
    this.setOptions(config.options);
    this.scheduleGc();
  }
  setOptions(options) {
    this.options = options;
    this.updateGcTime(this.options.gcTime);
  }
  get meta() {
    return this.options.meta;
  }
  addObserver(observer) {
    if (!this.#observers.includes(observer)) {
      this.#observers.push(observer);
      this.clearGcTimeout();
      this.#mutationCache.notify({
        type: "observerAdded",
        mutation: this,
        observer
      });
    }
  }
  removeObserver(observer) {
    this.#observers = this.#observers.filter((x) => x !== observer);
    this.scheduleGc();
    this.#mutationCache.notify({
      type: "observerRemoved",
      mutation: this,
      observer
    });
  }
  optionalRemove() {
    if (!this.#observers.length) {
      if (this.state.status === "pending") {
        this.scheduleGc();
      } else {
        this.#mutationCache.remove(this);
      }
    }
  }
  continue() {
    return this.#retryer?.continue() ?? // continuing a mutation assumes that variables are set, mutation must have been dehydrated before
    this.execute(this.state.variables);
  }
  async execute(variables) {
    const onContinue = () => {
      this.#dispatch({ type: "continue" });
    };
    const mutationFnContext = {
      client: this.#client,
      meta: this.options.meta,
      mutationKey: this.options.mutationKey
    };
    this.#retryer = createRetryer({
      fn: () => {
        if (!this.options.mutationFn) {
          return Promise.reject(new Error("No mutationFn found"));
        }
        return this.options.mutationFn(variables, mutationFnContext);
      },
      onFail: (failureCount, error) => {
        this.#dispatch({ type: "failed", failureCount, error });
      },
      onPause: () => {
        this.#dispatch({ type: "pause" });
      },
      onContinue,
      retry: this.options.retry ?? 0,
      retryDelay: this.options.retryDelay,
      networkMode: this.options.networkMode,
      canRun: () => this.#mutationCache.canRun(this)
    });
    const restored = this.state.status === "pending";
    const isPaused = !this.#retryer.canStart();
    try {
      if (restored) {
        onContinue();
      } else {
        this.#dispatch({ type: "pending", variables, isPaused });
        await this.#mutationCache.config.onMutate?.(
          variables,
          this,
          mutationFnContext
        );
        const context = await this.options.onMutate?.(
          variables,
          mutationFnContext
        );
        if (context !== this.state.context) {
          this.#dispatch({
            type: "pending",
            context,
            variables,
            isPaused
          });
        }
      }
      const data = await this.#retryer.start();
      await this.#mutationCache.config.onSuccess?.(
        data,
        variables,
        this.state.context,
        this,
        mutationFnContext
      );
      await this.options.onSuccess?.(
        data,
        variables,
        this.state.context,
        mutationFnContext
      );
      await this.#mutationCache.config.onSettled?.(
        data,
        null,
        this.state.variables,
        this.state.context,
        this,
        mutationFnContext
      );
      await this.options.onSettled?.(
        data,
        null,
        variables,
        this.state.context,
        mutationFnContext
      );
      this.#dispatch({ type: "success", data });
      return data;
    } catch (error) {
      try {
        await this.#mutationCache.config.onError?.(
          error,
          variables,
          this.state.context,
          this,
          mutationFnContext
        );
        await this.options.onError?.(
          error,
          variables,
          this.state.context,
          mutationFnContext
        );
        await this.#mutationCache.config.onSettled?.(
          void 0,
          error,
          this.state.variables,
          this.state.context,
          this,
          mutationFnContext
        );
        await this.options.onSettled?.(
          void 0,
          error,
          variables,
          this.state.context,
          mutationFnContext
        );
        throw error;
      } finally {
        this.#dispatch({ type: "error", error });
      }
    } finally {
      this.#mutationCache.runNext(this);
    }
  }
  #dispatch(action) {
    const reducer = (state) => {
      switch (action.type) {
        case "failed":
          return {
            ...state,
            failureCount: action.failureCount,
            failureReason: action.error
          };
        case "pause":
          return {
            ...state,
            isPaused: true
          };
        case "continue":
          return {
            ...state,
            isPaused: false
          };
        case "pending":
          return {
            ...state,
            context: action.context,
            data: void 0,
            failureCount: 0,
            failureReason: null,
            error: null,
            isPaused: action.isPaused,
            status: "pending",
            variables: action.variables,
            submittedAt: Date.now()
          };
        case "success":
          return {
            ...state,
            data: action.data,
            failureCount: 0,
            failureReason: null,
            error: null,
            status: "success",
            isPaused: false
          };
        case "error":
          return {
            ...state,
            data: void 0,
            error: action.error,
            failureCount: state.failureCount + 1,
            failureReason: action.error,
            isPaused: false,
            status: "error"
          };
      }
    };
    this.state = reducer(this.state);
    notifyManager.batch(() => {
      this.#observers.forEach((observer) => {
        observer.onMutationUpdate(action);
      });
      this.#mutationCache.notify({
        mutation: this,
        type: "updated",
        action
      });
    });
  }
};
function getDefaultState() {
  return {
    context: void 0,
    data: void 0,
    error: null,
    failureCount: 0,
    failureReason: null,
    isPaused: false,
    status: "idle",
    variables: void 0,
    submittedAt: 0
  };
}

// src/mutationCache.ts
var MutationCache = class extends Subscribable {
  constructor(config = {}) {
    super();
    this.config = config;
    this.#mutations = /* @__PURE__ */ new Set();
    this.#scopes = /* @__PURE__ */ new Map();
    this.#mutationId = 0;
  }
  #mutations;
  #scopes;
  #mutationId;
  build(client, options, state) {
    const mutation = new Mutation({
      client,
      mutationCache: this,
      mutationId: ++this.#mutationId,
      options: client.defaultMutationOptions(options),
      state
    });
    this.add(mutation);
    return mutation;
  }
  add(mutation) {
    this.#mutations.add(mutation);
    const scope = scopeFor(mutation);
    if (typeof scope === "string") {
      const scopedMutations = this.#scopes.get(scope);
      if (scopedMutations) {
        scopedMutations.push(mutation);
      } else {
        this.#scopes.set(scope, [mutation]);
      }
    }
    this.notify({ type: "added", mutation });
  }
  remove(mutation) {
    if (this.#mutations.delete(mutation)) {
      const scope = scopeFor(mutation);
      if (typeof scope === "string") {
        const scopedMutations = this.#scopes.get(scope);
        if (scopedMutations) {
          if (scopedMutations.length > 1) {
            const index = scopedMutations.indexOf(mutation);
            if (index !== -1) {
              scopedMutations.splice(index, 1);
            }
          } else if (scopedMutations[0] === mutation) {
            this.#scopes.delete(scope);
          }
        }
      }
    }
    this.notify({ type: "removed", mutation });
  }
  canRun(mutation) {
    const scope = scopeFor(mutation);
    if (typeof scope === "string") {
      const mutationsWithSameScope = this.#scopes.get(scope);
      const firstPendingMutation = mutationsWithSameScope?.find(
        (m) => m.state.status === "pending"
      );
      return !firstPendingMutation || firstPendingMutation === mutation;
    } else {
      return true;
    }
  }
  runNext(mutation) {
    const scope = scopeFor(mutation);
    if (typeof scope === "string") {
      const foundMutation = this.#scopes.get(scope)?.find((m) => m !== mutation && m.state.isPaused);
      return foundMutation?.continue() ?? Promise.resolve();
    } else {
      return Promise.resolve();
    }
  }
  clear() {
    notifyManager.batch(() => {
      this.#mutations.forEach((mutation) => {
        this.notify({ type: "removed", mutation });
      });
      this.#mutations.clear();
      this.#scopes.clear();
    });
  }
  getAll() {
    return Array.from(this.#mutations);
  }
  find(filters) {
    const defaultedFilters = { exact: true, ...filters };
    return this.getAll().find(
      (mutation) => matchMutation(defaultedFilters, mutation)
    );
  }
  findAll(filters = {}) {
    return this.getAll().filter((mutation) => matchMutation(filters, mutation));
  }
  notify(event) {
    notifyManager.batch(() => {
      this.listeners.forEach((listener) => {
        listener(event);
      });
    });
  }
  resumePausedMutations() {
    const pausedMutations = this.getAll().filter((x) => x.state.isPaused);
    return notifyManager.batch(
      () => Promise.all(
        pausedMutations.map((mutation) => mutation.continue().catch(noop$1))
      )
    );
  }
};
function scopeFor(mutation) {
  return mutation.options.scope?.id;
}

// src/queryCache.ts
var QueryCache = class extends Subscribable {
  constructor(config = {}) {
    super();
    this.config = config;
    this.#queries = /* @__PURE__ */ new Map();
  }
  #queries;
  build(client, options, state) {
    const queryKey = options.queryKey;
    const queryHash = options.queryHash ?? hashQueryKeyByOptions(queryKey, options);
    let query = this.get(queryHash);
    if (!query) {
      query = new Query({
        client,
        queryKey,
        queryHash,
        options: client.defaultQueryOptions(options),
        state,
        defaultOptions: client.getQueryDefaults(queryKey)
      });
      this.add(query);
    }
    return query;
  }
  add(query) {
    if (!this.#queries.has(query.queryHash)) {
      this.#queries.set(query.queryHash, query);
      this.notify({
        type: "added",
        query
      });
    }
  }
  remove(query) {
    const queryInMap = this.#queries.get(query.queryHash);
    if (queryInMap) {
      query.destroy();
      if (queryInMap === query) {
        this.#queries.delete(query.queryHash);
      }
      this.notify({ type: "removed", query });
    }
  }
  clear() {
    notifyManager.batch(() => {
      this.getAll().forEach((query) => {
        this.remove(query);
      });
    });
  }
  get(queryHash) {
    return this.#queries.get(queryHash);
  }
  getAll() {
    return [...this.#queries.values()];
  }
  find(filters) {
    const defaultedFilters = { exact: true, ...filters };
    return this.getAll().find(
      (query) => matchQuery(defaultedFilters, query)
    );
  }
  findAll(filters = {}) {
    const queries = this.getAll();
    return Object.keys(filters).length > 0 ? queries.filter((query) => matchQuery(filters, query)) : queries;
  }
  notify(event) {
    notifyManager.batch(() => {
      this.listeners.forEach((listener) => {
        listener(event);
      });
    });
  }
  onFocus() {
    notifyManager.batch(() => {
      this.getAll().forEach((query) => {
        query.onFocus();
      });
    });
  }
  onOnline() {
    notifyManager.batch(() => {
      this.getAll().forEach((query) => {
        query.onOnline();
      });
    });
  }
};

// src/queryClient.ts
var QueryClient = class {
  #queryCache;
  #mutationCache;
  #defaultOptions;
  #queryDefaults;
  #mutationDefaults;
  #mountCount;
  #unsubscribeFocus;
  #unsubscribeOnline;
  constructor(config = {}) {
    this.#queryCache = config.queryCache || new QueryCache();
    this.#mutationCache = config.mutationCache || new MutationCache();
    this.#defaultOptions = config.defaultOptions || {};
    this.#queryDefaults = /* @__PURE__ */ new Map();
    this.#mutationDefaults = /* @__PURE__ */ new Map();
    this.#mountCount = 0;
  }
  mount() {
    this.#mountCount++;
    if (this.#mountCount !== 1) return;
    this.#unsubscribeFocus = focusManager.subscribe(async (focused) => {
      if (focused) {
        await this.resumePausedMutations();
        this.#queryCache.onFocus();
      }
    });
    this.#unsubscribeOnline = onlineManager.subscribe(async (online) => {
      if (online) {
        await this.resumePausedMutations();
        this.#queryCache.onOnline();
      }
    });
  }
  unmount() {
    this.#mountCount--;
    if (this.#mountCount !== 0) return;
    this.#unsubscribeFocus?.();
    this.#unsubscribeFocus = void 0;
    this.#unsubscribeOnline?.();
    this.#unsubscribeOnline = void 0;
  }
  isFetching(filters) {
    return this.#queryCache.findAll({ ...filters, fetchStatus: "fetching" }).length;
  }
  isMutating(filters) {
    return this.#mutationCache.findAll({ ...filters, status: "pending" }).length;
  }
  /**
   * Imperative (non-reactive) way to retrieve data for a QueryKey.
   * Should only be used in callbacks or functions where reading the latest data is necessary, e.g. for optimistic updates.
   *
   * Hint: Do not use this function inside a component, because it won't receive updates.
   * Use `useQuery` to create a `QueryObserver` that subscribes to changes.
   */
  getQueryData(queryKey) {
    const options = this.defaultQueryOptions({ queryKey });
    return this.#queryCache.get(options.queryHash)?.state.data;
  }
  ensureQueryData(options) {
    const defaultedOptions = this.defaultQueryOptions(options);
    const query = this.#queryCache.build(this, defaultedOptions);
    const cachedData = query.state.data;
    if (cachedData === void 0) {
      return this.fetchQuery(options);
    }
    if (options.revalidateIfStale && query.isStaleByTime(resolveStaleTime(defaultedOptions.staleTime, query))) {
      void this.prefetchQuery(defaultedOptions);
    }
    return Promise.resolve(cachedData);
  }
  getQueriesData(filters) {
    return this.#queryCache.findAll(filters).map(({ queryKey, state }) => {
      const data = state.data;
      return [queryKey, data];
    });
  }
  setQueryData(queryKey, updater, options) {
    const defaultedOptions = this.defaultQueryOptions({ queryKey });
    const query = this.#queryCache.get(
      defaultedOptions.queryHash
    );
    const prevData = query?.state.data;
    const data = functionalUpdate(updater, prevData);
    if (data === void 0) {
      return void 0;
    }
    return this.#queryCache.build(this, defaultedOptions).setData(data, { ...options, manual: true });
  }
  setQueriesData(filters, updater, options) {
    return notifyManager.batch(
      () => this.#queryCache.findAll(filters).map(({ queryKey }) => [
        queryKey,
        this.setQueryData(queryKey, updater, options)
      ])
    );
  }
  getQueryState(queryKey) {
    const options = this.defaultQueryOptions({ queryKey });
    return this.#queryCache.get(
      options.queryHash
    )?.state;
  }
  removeQueries(filters) {
    const queryCache = this.#queryCache;
    notifyManager.batch(() => {
      queryCache.findAll(filters).forEach((query) => {
        queryCache.remove(query);
      });
    });
  }
  resetQueries(filters, options) {
    const queryCache = this.#queryCache;
    return notifyManager.batch(() => {
      queryCache.findAll(filters).forEach((query) => {
        query.reset();
      });
      return this.refetchQueries(
        {
          type: "active",
          ...filters
        },
        options
      );
    });
  }
  cancelQueries(filters, cancelOptions = {}) {
    const defaultedCancelOptions = { revert: true, ...cancelOptions };
    const promises = notifyManager.batch(
      () => this.#queryCache.findAll(filters).map((query) => query.cancel(defaultedCancelOptions))
    );
    return Promise.all(promises).then(noop$1).catch(noop$1);
  }
  invalidateQueries(filters, options = {}) {
    return notifyManager.batch(() => {
      this.#queryCache.findAll(filters).forEach((query) => {
        query.invalidate();
      });
      if (filters?.refetchType === "none") {
        return Promise.resolve();
      }
      return this.refetchQueries(
        {
          ...filters,
          type: filters?.refetchType ?? filters?.type ?? "active"
        },
        options
      );
    });
  }
  refetchQueries(filters, options = {}) {
    const fetchOptions = {
      ...options,
      cancelRefetch: options.cancelRefetch ?? true
    };
    const promises = notifyManager.batch(
      () => this.#queryCache.findAll(filters).filter((query) => !query.isDisabled() && !query.isStatic()).map((query) => {
        let promise = query.fetch(void 0, fetchOptions);
        if (!fetchOptions.throwOnError) {
          promise = promise.catch(noop$1);
        }
        return query.state.fetchStatus === "paused" ? Promise.resolve() : promise;
      })
    );
    return Promise.all(promises).then(noop$1);
  }
  fetchQuery(options) {
    const defaultedOptions = this.defaultQueryOptions(options);
    if (defaultedOptions.retry === void 0) {
      defaultedOptions.retry = false;
    }
    const query = this.#queryCache.build(this, defaultedOptions);
    return query.isStaleByTime(
      resolveStaleTime(defaultedOptions.staleTime, query)
    ) ? query.fetch(defaultedOptions) : Promise.resolve(query.state.data);
  }
  prefetchQuery(options) {
    return this.fetchQuery(options).then(noop$1).catch(noop$1);
  }
  fetchInfiniteQuery(options) {
    options.behavior = infiniteQueryBehavior(options.pages);
    return this.fetchQuery(options);
  }
  prefetchInfiniteQuery(options) {
    return this.fetchInfiniteQuery(options).then(noop$1).catch(noop$1);
  }
  ensureInfiniteQueryData(options) {
    options.behavior = infiniteQueryBehavior(options.pages);
    return this.ensureQueryData(options);
  }
  resumePausedMutations() {
    if (onlineManager.isOnline()) {
      return this.#mutationCache.resumePausedMutations();
    }
    return Promise.resolve();
  }
  getQueryCache() {
    return this.#queryCache;
  }
  getMutationCache() {
    return this.#mutationCache;
  }
  getDefaultOptions() {
    return this.#defaultOptions;
  }
  setDefaultOptions(options) {
    this.#defaultOptions = options;
  }
  setQueryDefaults(queryKey, options) {
    this.#queryDefaults.set(hashKey(queryKey), {
      queryKey,
      defaultOptions: options
    });
  }
  getQueryDefaults(queryKey) {
    const defaults = [...this.#queryDefaults.values()];
    const result = {};
    defaults.forEach((queryDefault) => {
      if (partialMatchKey(queryKey, queryDefault.queryKey)) {
        Object.assign(result, queryDefault.defaultOptions);
      }
    });
    return result;
  }
  setMutationDefaults(mutationKey, options) {
    this.#mutationDefaults.set(hashKey(mutationKey), {
      mutationKey,
      defaultOptions: options
    });
  }
  getMutationDefaults(mutationKey) {
    const defaults = [...this.#mutationDefaults.values()];
    const result = {};
    defaults.forEach((queryDefault) => {
      if (partialMatchKey(mutationKey, queryDefault.mutationKey)) {
        Object.assign(result, queryDefault.defaultOptions);
      }
    });
    return result;
  }
  defaultQueryOptions(options) {
    if (options._defaulted) {
      return options;
    }
    const defaultedOptions = {
      ...this.#defaultOptions.queries,
      ...this.getQueryDefaults(options.queryKey),
      ...options,
      _defaulted: true
    };
    if (!defaultedOptions.queryHash) {
      defaultedOptions.queryHash = hashQueryKeyByOptions(
        defaultedOptions.queryKey,
        defaultedOptions
      );
    }
    if (defaultedOptions.refetchOnReconnect === void 0) {
      defaultedOptions.refetchOnReconnect = defaultedOptions.networkMode !== "always";
    }
    if (defaultedOptions.throwOnError === void 0) {
      defaultedOptions.throwOnError = !!defaultedOptions.suspense;
    }
    if (!defaultedOptions.networkMode && defaultedOptions.persister) {
      defaultedOptions.networkMode = "offlineFirst";
    }
    if (defaultedOptions.queryFn === skipToken) {
      defaultedOptions.enabled = false;
    }
    return defaultedOptions;
  }
  defaultMutationOptions(options) {
    if (options?._defaulted) {
      return options;
    }
    return {
      ...this.#defaultOptions.mutations,
      ...options?.mutationKey && this.getMutationDefaults(options.mutationKey),
      ...options,
      _defaulted: true
    };
  }
  clear() {
    this.#queryCache.clear();
    this.#mutationCache.clear();
  }
};

var QueryClientContext = reactExports.createContext(
  void 0
);
var QueryClientProvider = ({
  client,
  children
}) => {
  reactExports.useEffect(() => {
    client.mount();
    return () => {
      client.unmount();
    };
  }, [client]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(QueryClientContext.Provider, { value: client, children });
};

/**
 * @param {string|RegExp} input The route pattern
 * @param {boolean} [loose] Allow open-ended matching. Ignored with `RegExp` input.
 */
function parse(input, loose) {
	if (input instanceof RegExp) return { keys:false, pattern:input };
	var c, o, tmp, ext, keys=[], pattern='', arr = input.split('/');
	arr[0] || arr.shift();

	while (tmp = arr.shift()) {
		c = tmp[0];
		if (c === '*') {
			keys.push(c);
			pattern += tmp[1] === '?' ? '(?:/(.*))?' : '/(.*)';
		} else if (c === ':') {
			o = tmp.indexOf('?', 1);
			ext = tmp.indexOf('.', 1);
			keys.push( tmp.substring(1, !!~o ? o : !!~ext ? ext : tmp.length) );
			pattern += !!~o && !~ext ? '(?:/([^/]+?))?' : '/([^/]+?)';
			if (!!~ext) pattern += (!!~o ? '?' : '') + '\\' + tmp.substring(ext);
		} else {
			pattern += '/' + tmp;
		}
	}

	return {
		keys: keys,
		pattern: new RegExp('^' + pattern + (loose ? '(?=$|\/)' : '\/?$'), 'i')
	};
}

// React.useInsertionEffect is not available in React <18
// This hack fixes a transpilation issue on some apps
const useBuiltinInsertionEffect = React["useInsertion" + "Effect"];

// Copied from:
// https://github.com/facebook/react/blob/main/packages/shared/ExecutionEnvironment.js
const canUseDOM = !!(
  typeof window !== "undefined" &&
  typeof window.document !== "undefined" &&
  typeof window.document.createElement !== "undefined"
);

// Copied from:
// https://github.com/reduxjs/react-redux/blob/master/src/utils/useIsomorphicLayoutEffect.ts
// "React currently throws a warning when using useLayoutEffect on the server.
// To get around it, we can conditionally useEffect on the server (no-op) and
// useLayoutEffect in the browser."
const useIsomorphicLayoutEffect = canUseDOM
  ? reactExports.useLayoutEffect
  : reactExports.useEffect;

// useInsertionEffect is already a noop on the server.
// See: https://github.com/facebook/react/blob/main/packages/react-server/src/ReactFizzHooks.js
const useInsertionEffect =
  useBuiltinInsertionEffect || useIsomorphicLayoutEffect;

// Userland polyfill while we wait for the forthcoming
// https://github.com/reactjs/rfcs/blob/useevent/text/0000-useevent.md
// Note: "A high-fidelity polyfill for useEvent is not possible because
// there is no lifecycle or Hook in React that we can use to switch
// .current at the right timing."
// So we will have to make do with this "close enough" approach for now.
const useEvent = (fn) => {
  const ref = reactExports.useRef([fn, (...args) => ref[0](...args)]).current;
  // Per Dan Abramov: useInsertionEffect executes marginally closer to the
  // correct timing for ref synchronization than useLayoutEffect on React 18.
  // See: https://github.com/facebook/react/pull/25881#issuecomment-1356244360
  useInsertionEffect(() => {
    ref[0] = fn;
  });
  return ref[1];
};

/**
 * History API docs @see https://developer.mozilla.org/en-US/docs/Web/API/History
 */
const eventPopstate = "popstate";
const eventPushState = "pushState";
const eventReplaceState = "replaceState";
const eventHashchange = "hashchange";
const events = [
  eventPopstate,
  eventPushState,
  eventReplaceState,
  eventHashchange,
];

const subscribeToLocationUpdates = (callback) => {
  for (const event of events) {
    addEventListener(event, callback);
  }
  return () => {
    for (const event of events) {
      removeEventListener(event, callback);
    }
  };
};

const useLocationProperty = (fn, ssrFn) =>
  shimExports.useSyncExternalStore(subscribeToLocationUpdates, fn, ssrFn);

const currentSearch = () => location.search;

const useSearch = ({ ssrSearch } = {}) =>
  useLocationProperty(
    currentSearch,
    ssrSearch != null ? () => ssrSearch : currentSearch
  );

const currentPathname = () => location.pathname;

const usePathname = ({ ssrPath } = {}) =>
  useLocationProperty(
    currentPathname,
    ssrPath != null ? () => ssrPath : currentPathname
  );

const navigate = (to, { replace = false, state = null } = {}) =>
  history[replace ? eventReplaceState : eventPushState](state, "", to);

// the 2nd argument of the `useBrowserLocation` return value is a function
// that allows to perform a navigation.
const useBrowserLocation = (opts = {}) => [usePathname(opts), navigate];

const patchKey = Symbol.for("wouter_v3");

// While History API does have `popstate` event, the only
// proper way to listen to changes via `push/replaceState`
// is to monkey-patch these methods.
//
// See https://stackoverflow.com/a/4585031
if (typeof history !== "undefined" && typeof window[patchKey] === "undefined") {
  for (const type of [eventPushState, eventReplaceState]) {
    const original = history[type];
    // TODO: we should be using unstable_batchedUpdates to avoid multiple re-renders,
    // however that will require an additional peer dependency on react-dom.
    // See: https://github.com/reactwg/react-18/discussions/86#discussioncomment-1567149
    history[type] = function () {
      const result = original.apply(this, arguments);
      const event = new Event(type);
      event.arguments = arguments;

      dispatchEvent(event);
      return result;
    };
  }

  // patch history object only once
  // See: https://github.com/molefrog/wouter/issues/167
  Object.defineProperty(window, patchKey, { value: true });
}

/*
 * Transforms `path` into its relative `base` version
 * If base isn't part of the path provided returns absolute path e.g. `~/app`
 */
const _relativePath = (base, path) =>
  !path.toLowerCase().indexOf(base.toLowerCase())
    ? path.slice(base.length) || "/"
    : "~" + path;

/**
 * When basepath is `undefined` or '/' it is ignored (we assume it's empty string)
 */
const baseDefaults = (base = "") => (base === "/" ? "" : base);

const absolutePath = (to, base) =>
  to[0] === "~" ? to.slice(1) : baseDefaults(base) + to;

const relativePath = (base = "", path) =>
  _relativePath(unescape$1(baseDefaults(base)), unescape$1(path));

/*
 * decodes escape sequences such as %20
 */
const unescape$1 = (str) => {
  try {
    return decodeURI(str);
  } catch (_e) {
    // fail-safe mode: if string can't be decoded do nothing
    return str;
  }
};

/*
 * Router and router context. Router is a lightweight object that represents the current
 * routing options: how location is managed, base path etc.
 *
 * There is a default router present for most of the use cases, however it can be overridden
 * via the <Router /> component.
 */

const defaultRouter = {
  hook: useBrowserLocation,
  searchHook: useSearch,
  parser: parse,
  base: "",
  // this option is used to override the current location during SSR
  ssrPath: undefined,
  ssrSearch: undefined,
  // optional context to track render state during SSR
  ssrContext: undefined,
  // customizes how `href` props are transformed for <Link />
  hrefs: (x) => x,
};

const RouterCtx = reactExports.createContext(defaultRouter);

// gets the closest parent router from the context
const useRouter = () => reactExports.useContext(RouterCtx);

/**
 * Parameters context. Used by `useParams()` to get the
 * matched params from the innermost `Route` component.
 */

const Params0 = {},
  ParamsCtx = reactExports.createContext(Params0);

const useParams = () => reactExports.useContext(ParamsCtx);

/*
 * Part 1, Hooks API: useRoute and useLocation
 */

// Internal version of useLocation to avoid redundant useRouter calls

const useLocationFromRouter = (router) => {
  const [location, navigate] = router.hook(router);

  // the function reference should stay the same between re-renders, so that
  // it can be passed down as an element prop without any performance concerns.
  // (This is achieved via `useEvent`.)
  return [
    relativePath(router.base, location),
    useEvent((to, navOpts) => navigate(absolutePath(to, router.base), navOpts)),
  ];
};

const useLocation = () => useLocationFromRouter(useRouter());

const matchRoute = (parser, route, path, loose) => {
  // if the input is a regexp, skip parsing
  const { pattern, keys } =
    route instanceof RegExp
      ? { keys: false, pattern: route }
      : parser(route || "*", loose);

  // array destructuring loses keys, so this is done in two steps
  const result = pattern.exec(path) || [];

  // when parser is in "loose" mode, `$base` is equal to the
  // first part of the route that matches the pattern
  // (e.g. for pattern `/a/:b` and path `/a/1/2/3` the `$base` is `a/1`)
  // we use this for route nesting
  const [$base, ...matches] = result;

  return $base !== undefined
    ? [
        true,

        (() => {
          // for regex paths, `keys` will always be false

          // an object with parameters matched, e.g. { foo: "bar" } for "/:foo"
          // we "zip" two arrays here to construct the object
          // ["foo"], ["bar"]  { foo: "bar" }
          const groups =
            keys !== false
              ? Object.fromEntries(keys.map((key, i) => [key, matches[i]]))
              : result.groups;

          // convert the array to an instance of object
          // this makes it easier to integrate with the existing param implementation
          let obj = { ...matches };

          // merge named capture groups with matches array
          groups && Object.assign(obj, groups);

          return obj;
        })(),

        // the third value if only present when parser is in "loose" mode,
        // so that we can extract the base path for nested routes
        ...(loose ? [$base] : []),
      ]
    : [false, null];
};

/*
 * Part 2, Low Carb Router API: Router, Route, Link, Switch
 */

const Router = ({ children, ...props }) => {
  // the router we will inherit from - it is the closest router in the tree,
  // unless the custom `hook` is provided (in that case it's the default one)
  const parent_ = useRouter();
  const parent = props.hook ? defaultRouter : parent_;

  // holds to the context value: the router object
  let value = parent;

  // when `ssrPath` contains a `?` character, we can extract the search from it
  const [path, search] = props.ssrPath?.split("?") ?? [];
  if (search) (props.ssrSearch = search), (props.ssrPath = path);

  // hooks can define their own `href` formatter (e.g. for hash location)
  props.hrefs = props.hrefs ?? props.hook?.hrefs;

  // hooks can define their own search hook (e.g. for memory location)
  props.searchHook = props.searchHook ?? props.hook?.searchHook;

  // what is happening below: to avoid unnecessary rerenders in child components,
  // we ensure that the router object reference is stable, unless there are any
  // changes that require reload (e.g. `base` prop changes -> all components that
  // get the router from the context should rerender, even if the component is memoized).
  // the expected behaviour is:
  //
  //   1) when the resulted router is no different from the parent, use parent
  //   2) if the custom `hook` prop is provided, we always inherit from the
  //      default router instead. this resets all previously overridden options.
  //   3) when the router is customized here, it should stay stable between renders
  let ref = reactExports.useRef({}),
    prev = ref.current,
    next = prev;

  for (let k in parent) {
    const option =
      k === "base"
        ? /* base is special case, it is appended to the parent's base */
          parent[k] + (props[k] || "")
        : props[k] || parent[k];

    if (prev === next && option !== next[k]) {
      ref.current = next = { ...next };
    }

    next[k] = option;

    // the new router is no different from the parent or from the memoized value, use parent
    if (option !== parent[k] || option !== value[k]) value = next;
  }

  return reactExports.createElement(RouterCtx.Provider, { value, children });
};

const h_route = ({ children, component }, params) => {
  // React-Router style `component` prop
  if (component) return reactExports.createElement(component, { params });

  // support render prop or plain children
  return typeof children === "function" ? children(params) : children;
};

// Cache params object between renders if values are shallow equal
const useCachedParams = (value) => {
  let prev = reactExports.useRef(Params0);
  const curr = prev.current;
  return (prev.current =
    // Update cache if number of params changed or any value changed
    Object.keys(value).length !== Object.keys(curr).length ||
    Object.entries(value).some(([k, v]) => v !== curr[k])
      ? value // Return new value if there are changes
      : curr); // Return cached value if nothing changed
};

const Route = ({ path, nest, match, ...renderProps }) => {
  const router = useRouter();
  const [location] = useLocationFromRouter(router);

  const [matches, routeParams, base] =
    // `match` is a special prop to give up control to the parent,
    // it is used by the `Switch` to avoid double matching
    match ?? matchRoute(router.parser, path, location, nest);

  // when `routeParams` is `null` (there was no match), the argument
  // below becomes {...null} = {}, see the Object Spread specs
  // https://tc39.es/proposal-object-rest-spread/#AbstractOperations-CopyDataProperties
  const params = useCachedParams({ ...useParams(), ...routeParams });

  if (!matches) return null;

  const children = base
    ? reactExports.createElement(Router, { base }, h_route(renderProps, params))
    : h_route(renderProps, params);

  return reactExports.createElement(ParamsCtx.Provider, { value: params, children });
};

const Link = reactExports.forwardRef((props, ref) => {
  const router = useRouter();
  const [currentPath, navigate] = useLocationFromRouter(router);

  const {
    to = "",
    href: targetPath = to,
    onClick: _onClick,
    asChild,
    children,
    className: cls,
    /* eslint-disable no-unused-vars */
    replace /* ignore nav props */,
    state /* ignore nav props */,
    /* eslint-enable no-unused-vars */

    ...restProps
  } = props;

  const onClick = useEvent((event) => {
    // ignores the navigation when clicked using right mouse button or
    // by holding a special modifier key: ctrl, command, win, alt, shift
    if (
      event.ctrlKey ||
      event.metaKey ||
      event.altKey ||
      event.shiftKey ||
      event.button !== 0
    )
      return;

    _onClick?.(event);
    if (!event.defaultPrevented) {
      event.preventDefault();
      navigate(targetPath, props);
    }
  });

  // handle nested routers and absolute paths
  const href = router.hrefs(
    targetPath[0] === "~" ? targetPath.slice(1) : router.base + targetPath,
    router // pass router as a second argument for convinience
  );

  return asChild && reactExports.isValidElement(children)
    ? reactExports.cloneElement(children, { onClick, href })
    : reactExports.createElement("a", {
        ...restProps,
        onClick,
        href,
        // `className` can be a function to apply the class if this link is active
        className: cls?.call ? cls(currentPath === targetPath) : cls,
        children,
        ref,
      });
});

const flattenChildren = (children) =>
  Array.isArray(children)
    ? children.flatMap((c) =>
        flattenChildren(c && c.type === reactExports.Fragment ? c.props.children : c)
      )
    : [children];

const Switch$1 = ({ children, location }) => {
  const router = useRouter();
  const [originalLocation] = useLocationFromRouter(router);

  for (const element of flattenChildren(children)) {
    let match = 0;

    if (
      reactExports.isValidElement(element) &&
      // we don't require an element to be of type Route,
      // but we do require it to contain a truthy `path` prop.
      // this allows to use different components that wrap Route
      // inside of a switch, for example <AnimatedRoute />.
      (match = matchRoute(
        router.parser,
        element.props.path,
        location || originalLocation,
        element.props.nest
      ))[0]
    )
      return reactExports.cloneElement(element, { match });
  }

  return null;
};

var P=["light","dark"],E="(prefers-color-scheme: dark)",L=reactExports.createContext(void 0),D={setTheme:e=>{},themes:[]},j=()=>{var e;return (e=reactExports.useContext(L))!=null?e:D};reactExports.memo(({forcedTheme:e,storageKey:a,attribute:n,enableSystem:g,enableColorScheme:m,defaultTheme:c,value:o,attrs:y,nonce:h})=>{let k=c==="system",w=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${y.map(u=>`'${u}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,i=m?(P.includes(c)?c:null)?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${c}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",d=(l,u=false,R=true)=>{let f=o?o[l]:l,p=u?l+"|| ''":`'${f}'`,$="";return m&&R&&!u&&P.includes(l)&&($+=`d.style.colorScheme = '${l}';`),n==="class"?u||f?$+=`c.add(${p})`:$+="null":f&&($+=`d[s](n,${p})`),$},S=e?`!function(){${w}${d(e)}}()`:g?`!function(){try{${w}var e=localStorage.getItem('${a}');if('system'===e||(!e&&${k})){var t='${E}',m=window.matchMedia(t);if(m.media!==t||m.matches){${d("dark")}}else{${d("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${d(o?"x[e]":"e",true)}}${k?"":"else{"+d(c,false,false)+"}"}${i}}catch(e){}}()`:`!function(){try{${w}var e=localStorage.getItem('${a}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${d(o?"x[e]":"e",true)}}else{${d(c,false,false)};}${i}}catch(t){}}();`;return reactExports.createElement("script",{nonce:h,dangerouslySetInnerHTML:{__html:S}})});

var jt=n=>{switch(n){case "success":return ee;case "info":return ae;case "warning":return oe;case "error":return se;default:return null}},te=Array(12).fill(0),Yt=({visible:n,className:e})=>React$1.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":n},React$1.createElement("div",{className:"sonner-spinner"},te.map((t,a)=>React$1.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),ee=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React$1.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),oe=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},React$1.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),ae=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React$1.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),se=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React$1.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ot=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},React$1.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React$1.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}));var Ft=()=>{let[n,e]=React$1.useState(document.hidden);return React$1.useEffect(()=>{let t=()=>{e(document.hidden);};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),n};var bt=1,yt=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1);});this.publish=e=>{this.subscribers.forEach(t=>t(e));};this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e];};this.create=e=>{var S;let{message:t,...a}=e,u=typeof(e==null?void 0:e.id)=="number"||((S=e.id)==null?void 0:S.length)>0?e.id:bt++,f=this.toasts.find(g=>g.id===u),w=e.dismissible===void 0?true:e.dismissible;return this.dismissedToasts.has(u)&&this.dismissedToasts.delete(u),f?this.toasts=this.toasts.map(g=>g.id===u?(this.publish({...g,...e,id:u,title:t}),{...g,...e,id:u,dismissible:w,title:t}):g):this.addToast({title:t,...a,dismissible:w,id:u}),u};this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(a=>a({id:t.id,dismiss:true}));}),this.subscribers.forEach(t=>t({id:e,dismiss:true})),e);this.message=(e,t)=>this.create({...t,message:e});this.error=(e,t)=>this.create({...t,message:e,type:"error"});this.success=(e,t)=>this.create({...t,type:"success",message:e});this.info=(e,t)=>this.create({...t,type:"info",message:e});this.warning=(e,t)=>this.create({...t,type:"warning",message:e});this.loading=(e,t)=>this.create({...t,type:"loading",message:e});this.promise=(e,t)=>{if(!t)return;let a;t.loading!==void 0&&(a=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let u=e instanceof Promise?e:e(),f=a!==void 0,w,S=u.then(async i=>{if(w=["resolve",i],React$1.isValidElement(i))f=false,this.create({id:a,type:"default",message:i});else if(ie(i)&&!i.ok){f=false;let T=typeof t.error=="function"?await t.error(`HTTP error! status: ${i.status}`):t.error,F=typeof t.description=="function"?await t.description(`HTTP error! status: ${i.status}`):t.description;this.create({id:a,type:"error",message:T,description:F});}else if(t.success!==void 0){f=false;let T=typeof t.success=="function"?await t.success(i):t.success,F=typeof t.description=="function"?await t.description(i):t.description;this.create({id:a,type:"success",message:T,description:F});}}).catch(async i=>{if(w=["reject",i],t.error!==void 0){f=false;let D=typeof t.error=="function"?await t.error(i):t.error,T=typeof t.description=="function"?await t.description(i):t.description;this.create({id:a,type:"error",message:D,description:T});}}).finally(()=>{var i;f&&(this.dismiss(a),a=void 0),(i=t.finally)==null||i.call(t);}),g=()=>new Promise((i,D)=>S.then(()=>w[0]==="reject"?D(w[1]):i(w[1])).catch(D));return typeof a!="string"&&typeof a!="number"?{unwrap:g}:Object.assign(a,{unwrap:g})};this.custom=(e,t)=>{let a=(t==null?void 0:t.id)||bt++;return this.create({jsx:e(a),id:a,...t}),a};this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id));this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set;}},v$1=new yt,ne=(n,e)=>{let t=(e==null?void 0:e.id)||bt++;return v$1.addToast({title:n,...e,id:t}),t},ie=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",le=ne,ce=()=>v$1.toasts,de=()=>v$1.getActiveToasts(),ue=Object.assign(le,{success:v$1.success,info:v$1.info,warning:v$1.warning,error:v$1.error,custom:v$1.custom,message:v$1.message,promise:v$1.promise,dismiss:v$1.dismiss,loading:v$1.loading},{getHistory:ce,getToasts:de});function wt(n,{insertAt:e}={}){if(typeof document=="undefined")return;let t=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",e==="top"&&t.firstChild?t.insertBefore(a,t.firstChild):t.appendChild(a),a.styleSheet?a.styleSheet.cssText=n:a.appendChild(document.createTextNode(n));}wt(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function tt(n){return n.label!==void 0}var pe=3,me="32px",ge="16px",Wt=4e3,he=356,be=14,ye=20,we=200;function M(...n){return n.filter(Boolean).join(" ")}function xe(n){let[e,t]=n.split("-"),a=[];return e&&a.push(e),t&&a.push(t),a}var ve=n=>{var Dt,Pt,Nt,Bt,Ct,kt,It,Mt,Ht,At,Lt;let{invert:e,toast:t,unstyled:a,interacting:u,setHeights:f,visibleToasts:w,heights:S,index:g,toasts:i,expanded:D,removeToast:T,defaultRichColors:F,closeButton:et,style:ut,cancelButtonStyle:ft,actionButtonStyle:l,className:ot="",descriptionClassName:at="",duration:X,position:st,gap:pt,loadingIcon:rt,expandByDefault:B,classNames:s,icons:P,closeButtonAriaLabel:nt="Close toast",pauseWhenPageIsHidden:it}=n,[Y,C]=React$1.useState(null),[lt,J]=React$1.useState(null),[W,H]=React$1.useState(false),[A,mt]=React$1.useState(false),[L,z]=React$1.useState(false),[ct,d]=React$1.useState(false),[h,y]=React$1.useState(false),[R,j]=React$1.useState(0),[p,_]=React$1.useState(0),O=React$1.useRef(t.duration||X||Wt),G=React$1.useRef(null),k=React$1.useRef(null),Vt=g===0,Ut=g+1<=w,N=t.type,V=t.dismissible!==false,Kt=t.className||"",Xt=t.descriptionClassName||"",dt=React$1.useMemo(()=>S.findIndex(r=>r.toastId===t.id)||0,[S,t.id]),Jt=React$1.useMemo(()=>{var r;return (r=t.closeButton)!=null?r:et},[t.closeButton,et]),Tt=React$1.useMemo(()=>t.duration||X||Wt,[t.duration,X]),gt=React$1.useRef(0),U=React$1.useRef(0),St=React$1.useRef(0),K=React$1.useRef(null),[Gt,Qt]=st.split("-"),Rt=React$1.useMemo(()=>S.reduce((r,m,c)=>c>=dt?r:r+m.height,0),[S,dt]),Et=Ft(),qt=t.invert||e,ht=N==="loading";U.current=React$1.useMemo(()=>dt*pt+Rt,[dt,Rt]),React$1.useEffect(()=>{O.current=Tt;},[Tt]),React$1.useEffect(()=>{H(true);},[]),React$1.useEffect(()=>{let r=k.current;if(r){let m=r.getBoundingClientRect().height;return _(m),f(c=>[{toastId:t.id,height:m,position:t.position},...c]),()=>f(c=>c.filter(b=>b.toastId!==t.id))}},[f,t.id]),React$1.useLayoutEffect(()=>{if(!W)return;let r=k.current,m=r.style.height;r.style.height="auto";let c=r.getBoundingClientRect().height;r.style.height=m,_(c),f(b=>b.find(x=>x.toastId===t.id)?b.map(x=>x.toastId===t.id?{...x,height:c}:x):[{toastId:t.id,height:c,position:t.position},...b]);},[W,t.title,t.description,f,t.id]);let $=React$1.useCallback(()=>{mt(true),j(U.current),f(r=>r.filter(m=>m.toastId!==t.id)),setTimeout(()=>{T(t);},we);},[t,T,f,U]);React$1.useEffect(()=>{if(t.promise&&N==="loading"||t.duration===1/0||t.type==="loading")return;let r;return D||u||it&&Et?(()=>{if(St.current<gt.current){let b=new Date().getTime()-gt.current;O.current=O.current-b;}St.current=new Date().getTime();})():(()=>{O.current!==1/0&&(gt.current=new Date().getTime(),r=setTimeout(()=>{var b;(b=t.onAutoClose)==null||b.call(t,t),$();},O.current));})(),()=>clearTimeout(r)},[D,u,t,N,it,Et,$]),React$1.useEffect(()=>{t.delete&&$();},[$,t.delete]);function Zt(){var r,m,c;return P!=null&&P.loading?React$1.createElement("div",{className:M(s==null?void 0:s.loader,(r=t==null?void 0:t.classNames)==null?void 0:r.loader,"sonner-loader"),"data-visible":N==="loading"},P.loading):rt?React$1.createElement("div",{className:M(s==null?void 0:s.loader,(m=t==null?void 0:t.classNames)==null?void 0:m.loader,"sonner-loader"),"data-visible":N==="loading"},rt):React$1.createElement(Yt,{className:M(s==null?void 0:s.loader,(c=t==null?void 0:t.classNames)==null?void 0:c.loader),visible:N==="loading"})}return React$1.createElement("li",{tabIndex:0,ref:k,className:M(ot,Kt,s==null?void 0:s.toast,(Dt=t==null?void 0:t.classNames)==null?void 0:Dt.toast,s==null?void 0:s.default,s==null?void 0:s[N],(Pt=t==null?void 0:t.classNames)==null?void 0:Pt[N]),"data-sonner-toast":"","data-rich-colors":(Nt=t.richColors)!=null?Nt:F,"data-styled":!(t.jsx||t.unstyled||a),"data-mounted":W,"data-promise":!!t.promise,"data-swiped":h,"data-removed":A,"data-visible":Ut,"data-y-position":Gt,"data-x-position":Qt,"data-index":g,"data-front":Vt,"data-swiping":L,"data-dismissible":V,"data-type":N,"data-invert":qt,"data-swipe-out":ct,"data-swipe-direction":lt,"data-expanded":!!(D||B&&W),style:{"--index":g,"--toasts-before":g,"--z-index":i.length-g,"--offset":`${A?R:U.current}px`,"--initial-height":B?"auto":`${p}px`,...ut,...t.style},onDragEnd:()=>{z(false),C(null),K.current=null;},onPointerDown:r=>{ht||!V||(G.current=new Date,j(U.current),r.target.setPointerCapture(r.pointerId),r.target.tagName!=="BUTTON"&&(z(true),K.current={x:r.clientX,y:r.clientY}));},onPointerUp:()=>{var x,Q,q,Z;if(ct||!V)return;K.current=null;let r=Number(((x=k.current)==null?void 0:x.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),m=Number(((Q=k.current)==null?void 0:Q.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),c=new Date().getTime()-((q=G.current)==null?void 0:q.getTime()),b=Y==="x"?r:m,I=Math.abs(b)/c;if(Math.abs(b)>=ye||I>.11){j(U.current),(Z=t.onDismiss)==null||Z.call(t,t),J(Y==="x"?r>0?"right":"left":m>0?"down":"up"),$(),d(true),y(false);return}z(false),C(null);},onPointerMove:r=>{var Q,q,Z,zt;if(!K.current||!V||((Q=window.getSelection())==null?void 0:Q.toString().length)>0)return;let c=r.clientY-K.current.y,b=r.clientX-K.current.x,I=(q=n.swipeDirections)!=null?q:xe(st);!Y&&(Math.abs(b)>1||Math.abs(c)>1)&&C(Math.abs(b)>Math.abs(c)?"x":"y");let x={x:0,y:0};Y==="y"?(I.includes("top")||I.includes("bottom"))&&(I.includes("top")&&c<0||I.includes("bottom")&&c>0)&&(x.y=c):Y==="x"&&(I.includes("left")||I.includes("right"))&&(I.includes("left")&&b<0||I.includes("right")&&b>0)&&(x.x=b),(Math.abs(x.x)>0||Math.abs(x.y)>0)&&y(true),(Z=k.current)==null||Z.style.setProperty("--swipe-amount-x",`${x.x}px`),(zt=k.current)==null||zt.style.setProperty("--swipe-amount-y",`${x.y}px`);}},Jt&&!t.jsx?React$1.createElement("button",{"aria-label":nt,"data-disabled":ht,"data-close-button":true,onClick:ht||!V?()=>{}:()=>{var r;$(),(r=t.onDismiss)==null||r.call(t,t);},className:M(s==null?void 0:s.closeButton,(Bt=t==null?void 0:t.classNames)==null?void 0:Bt.closeButton)},(Ct=P==null?void 0:P.close)!=null?Ct:Ot):null,t.jsx||reactExports.isValidElement(t.title)?t.jsx?t.jsx:typeof t.title=="function"?t.title():t.title:React$1.createElement(React$1.Fragment,null,N||t.icon||t.promise?React$1.createElement("div",{"data-icon":"",className:M(s==null?void 0:s.icon,(kt=t==null?void 0:t.classNames)==null?void 0:kt.icon)},t.promise||t.type==="loading"&&!t.icon?t.icon||Zt():null,t.type!=="loading"?t.icon||(P==null?void 0:P[N])||jt(N):null):null,React$1.createElement("div",{"data-content":"",className:M(s==null?void 0:s.content,(It=t==null?void 0:t.classNames)==null?void 0:It.content)},React$1.createElement("div",{"data-title":"",className:M(s==null?void 0:s.title,(Mt=t==null?void 0:t.classNames)==null?void 0:Mt.title)},typeof t.title=="function"?t.title():t.title),t.description?React$1.createElement("div",{"data-description":"",className:M(at,Xt,s==null?void 0:s.description,(Ht=t==null?void 0:t.classNames)==null?void 0:Ht.description)},typeof t.description=="function"?t.description():t.description):null),reactExports.isValidElement(t.cancel)?t.cancel:t.cancel&&tt(t.cancel)?React$1.createElement("button",{"data-button":true,"data-cancel":true,style:t.cancelButtonStyle||ft,onClick:r=>{var m,c;tt(t.cancel)&&V&&((c=(m=t.cancel).onClick)==null||c.call(m,r),$());},className:M(s==null?void 0:s.cancelButton,(At=t==null?void 0:t.classNames)==null?void 0:At.cancelButton)},t.cancel.label):null,reactExports.isValidElement(t.action)?t.action:t.action&&tt(t.action)?React$1.createElement("button",{"data-button":true,"data-action":true,style:t.actionButtonStyle||l,onClick:r=>{var m,c;tt(t.action)&&((c=(m=t.action).onClick)==null||c.call(m,r),!r.defaultPrevented&&$());},className:M(s==null?void 0:s.actionButton,(Lt=t==null?void 0:t.classNames)==null?void 0:Lt.actionButton)},t.action.label):null))};function _t(){if(typeof window=="undefined"||typeof document=="undefined")return "ltr";let n=document.documentElement.getAttribute("dir");return n==="auto"||!n?window.getComputedStyle(document.documentElement).direction:n}function Te(n,e){let t={};return [n,e].forEach((a,u)=>{let f=u===1,w=f?"--mobile-offset":"--offset",S=f?ge:me;function g(i){["top","right","bottom","left"].forEach(D=>{t[`${w}-${D}`]=typeof i=="number"?`${i}px`:i;});}typeof a=="number"||typeof a=="string"?g(a):typeof a=="object"?["top","right","bottom","left"].forEach(i=>{a[i]===void 0?t[`${w}-${i}`]=S:t[`${w}-${i}`]=typeof a[i]=="number"?`${a[i]}px`:a[i];}):g(S);}),t}var $e=reactExports.forwardRef(function(e,t){let{invert:a,position:u="bottom-right",hotkey:f=["altKey","KeyT"],expand:w,closeButton:S,className:g,offset:i,mobileOffset:D,theme:T="light",richColors:F,duration:et,style:ut,visibleToasts:ft=pe,toastOptions:l,dir:ot=_t(),gap:at=be,loadingIcon:X,icons:st,containerAriaLabel:pt="Notifications",pauseWhenPageIsHidden:rt}=e,[B,s]=React$1.useState([]),P=React$1.useMemo(()=>Array.from(new Set([u].concat(B.filter(d=>d.position).map(d=>d.position)))),[B,u]),[nt,it]=React$1.useState([]),[Y,C]=React$1.useState(false),[lt,J]=React$1.useState(false),[W,H]=React$1.useState(T!=="system"?T:typeof window!="undefined"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),A=React$1.useRef(null),mt=f.join("+").replace(/Key/g,"").replace(/Digit/g,""),L=React$1.useRef(null),z=React$1.useRef(false),ct=React$1.useCallback(d=>{s(h=>{var y;return (y=h.find(R=>R.id===d.id))!=null&&y.delete||v$1.dismiss(d.id),h.filter(({id:R})=>R!==d.id)});},[]);return React$1.useEffect(()=>v$1.subscribe(d=>{if(d.dismiss){s(h=>h.map(y=>y.id===d.id?{...y,delete:true}:y));return}setTimeout(()=>{ReactDOM.flushSync(()=>{s(h=>{let y=h.findIndex(R=>R.id===d.id);return y!==-1?[...h.slice(0,y),{...h[y],...d},...h.slice(y+1)]:[d,...h]});});});}),[]),React$1.useEffect(()=>{if(T!=="system"){H(T);return}if(T==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?H("dark"):H("light")),typeof window=="undefined")return;let d=window.matchMedia("(prefers-color-scheme: dark)");try{d.addEventListener("change",({matches:h})=>{H(h?"dark":"light");});}catch(h){d.addListener(({matches:y})=>{try{H(y?"dark":"light");}catch(R){console.error(R);}});}},[T]),React$1.useEffect(()=>{B.length<=1&&C(false);},[B]),React$1.useEffect(()=>{let d=h=>{var R,j;f.every(p=>h[p]||h.code===p)&&(C(true),(R=A.current)==null||R.focus()),h.code==="Escape"&&(document.activeElement===A.current||(j=A.current)!=null&&j.contains(document.activeElement))&&C(false);};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[f]),React$1.useEffect(()=>{if(A.current)return ()=>{L.current&&(L.current.focus({preventScroll:true}),L.current=null,z.current=false);}},[A.current]),React$1.createElement("section",{ref:t,"aria-label":`${pt} ${mt}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:true},P.map((d,h)=>{var j;let[y,R]=d.split("-");return B.length?React$1.createElement("ol",{key:d,dir:ot==="auto"?_t():ot,tabIndex:-1,ref:A,className:g,"data-sonner-toaster":true,"data-theme":W,"data-y-position":y,"data-lifted":Y&&B.length>1&&!w,"data-x-position":R,style:{"--front-toast-height":`${((j=nt[0])==null?void 0:j.height)||0}px`,"--width":`${he}px`,"--gap":`${at}px`,...ut,...Te(i,D)},onBlur:p=>{z.current&&!p.currentTarget.contains(p.relatedTarget)&&(z.current=false,L.current&&(L.current.focus({preventScroll:true}),L.current=null));},onFocus:p=>{p.target instanceof HTMLElement&&p.target.dataset.dismissible==="false"||z.current||(z.current=true,L.current=p.relatedTarget);},onMouseEnter:()=>C(true),onMouseMove:()=>C(true),onMouseLeave:()=>{lt||C(false);},onDragEnd:()=>C(false),onPointerDown:p=>{p.target instanceof HTMLElement&&p.target.dataset.dismissible==="false"||J(true);},onPointerUp:()=>J(false)},B.filter(p=>!p.position&&h===0||p.position===d).map((p,_)=>{var O,G;return React$1.createElement(ve,{key:p.id,icons:st,index:_,toast:p,defaultRichColors:F,duration:(O=l==null?void 0:l.duration)!=null?O:et,className:l==null?void 0:l.className,descriptionClassName:l==null?void 0:l.descriptionClassName,invert:a,visibleToasts:ft,closeButton:(G=l==null?void 0:l.closeButton)!=null?G:S,interacting:lt,position:d,style:l==null?void 0:l.style,unstyled:l==null?void 0:l.unstyled,classNames:l==null?void 0:l.classNames,cancelButtonStyle:l==null?void 0:l.cancelButtonStyle,actionButtonStyle:l==null?void 0:l.actionButtonStyle,removeToast:ct,toasts:B.filter(k=>k.position==p.position),heights:nt.filter(k=>k.position==p.position),setHeights:it,expandByDefault:w,gap:at,loadingIcon:X,expanded:Y,pauseWhenPageIsHidden:rt,swipeDirections:e.swipeDirections})})):null}))});

class ToastDebugManager {
  toasts = /* @__PURE__ */ new Map();
  isEnabled = false;
  constructor() {
    if (this.isEnabled && typeof window !== "undefined") {
      window.__M1_TOAST_DEBUG__ = {
        get: () => this.getState(),
        list: () => this.list(),
        show: (message) => this.testShow(message),
        dismiss: (id) => this.testDismiss(id)
      };
    }
  }
  trackToast(id, state) {
    if (!this.isEnabled) return;
    const existing = this.toasts.get(id);
    const now = Date.now();
    if (state === "entering" && !existing) {
      this.toasts.set(id, {
        id,
        state,
        startTime: now
      });
    } else if (existing) {
      existing.state = state;
      if (state === "removed") {
        this.toasts.delete(id);
      }
    }
  }
  trackGesture(id, gesture) {
    if (!this.isEnabled) return;
    const toast = this.toasts.get(id);
    if (toast) {
      toast.gesture = gesture;
    }
  }
  trackTimer(id, timer) {
    if (!this.isEnabled) return;
    const toast = this.toasts.get(id);
    if (toast) {
      toast.timer = timer;
    }
  }
  getState() {
    return {
      toasts: Array.from(this.toasts.values()),
      timestamp: Date.now(),
      enabled: this.isEnabled
    };
  }
  list() {
    return this.toasts.size;
  }
  testShow(message) {
    if (typeof window !== "undefined" && window.toast) {
      window.toast(message || "Test toast message");
      return "Toast triggered";
    }
    return "Toast function not found";
  }
  testDismiss(id) {
    const toast = this.toasts.get(id);
    if (toast) {
      this.trackToast(id, "exiting");
      return `Dismissing toast ${id}`;
    }
    return `Toast ${id} not found`;
  }
}
const toastDebug = new ToastDebugManager();

const Toaster = ({ ...props }) => {
  const { theme = "system" } = j();
  const gestureRef = reactExports.useRef({ startY: 0, startTime: 0, currentToast: null, isDragging: false });
  reactExports.useEffect(() => {
    const gesture = gestureRef.current;
    const handleTouchStart = (e) => {
      const target = e.target;
      const toastElement = target.closest("[data-sonner-toast]");
      if (!toastElement) return;
      gesture.currentToast = toastElement;
      gesture.startY = e.touches[0].clientY;
      gesture.startTime = Date.now();
      gesture.isDragging = false;
      toastDebug.trackGesture(toastElement.id || "unknown", {
        startY: gesture.startY,
        currentY: gesture.startY,
        isDragging: false
      });
      toastElement.classList.add("toast-swiping");
    };
    const handleTouchMove = (e) => {
      if (!gesture.currentToast) return;
      const deltaY = e.touches[0].clientY - gesture.startY;
      if (deltaY < 0) {
        e.preventDefault();
        gesture.isDragging = true;
        const clampedDelta = Math.max(deltaY, -80);
        const opacity = Math.max(0.2, 1 + clampedDelta / 80 * 0.8);
        gesture.currentToast.style.transform = `translateY(${clampedDelta}px)`;
        gesture.currentToast.style.opacity = opacity.toString();
        toastDebug.trackGesture(gesture.currentToast.id || "unknown", {
          startY: gesture.startY,
          currentY: e.touches[0].clientY,
          isDragging: true
        });
      }
    };
    const handleTouchEnd = (e) => {
      if (!gesture.currentToast) return;
      const deltaY = e.changedTouches[0].clientY - gesture.startY;
      const deltaTime = Date.now() - gesture.startTime;
      const velocity = Math.abs(deltaY) / deltaTime;
      gesture.currentToast.classList.remove("toast-swiping");
      const shouldDismiss = Math.abs(deltaY) >= 32 && deltaY < 0 || velocity >= 0.35 && deltaY < 0;
      if (shouldDismiss && gesture.isDragging) {
        gesture.currentToast.setAttribute("data-removed", "true");
        toastDebug.trackToast(gesture.currentToast.id || "unknown", "exiting");
        setTimeout(() => {
          gesture.currentToast?.remove();
        }, 320);
      } else if (gesture.isDragging) {
        gesture.currentToast.classList.add("toast-snap-back");
        gesture.currentToast.style.transform = "";
        gesture.currentToast.style.opacity = "";
        setTimeout(() => {
          gesture.currentToast?.classList.remove("toast-snap-back");
        }, 320);
      }
      gesture.currentToast = null;
      gesture.isDragging = false;
    };
    document.addEventListener("touchstart", handleTouchStart, { passive: false });
    document.addEventListener("touchmove", handleTouchMove, { passive: false });
    document.addEventListener("touchend", handleTouchEnd, { passive: false });
    return () => {
      document.removeEventListener("touchstart", handleTouchStart);
      document.removeEventListener("touchmove", handleTouchMove);
      document.removeEventListener("touchend", handleTouchEnd);
    };
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    $e,
    {
      theme,
      className: "toaster group",
      position: "top-center",
      richColors: false,
      closeButton: false,
      duration: 3e3,
      expand: false,
      visibleToasts: 3,
      offset: 0,
      toastOptions: {
        style: {
          background: "rgba(0, 12, 24, 0.95)",
          color: "white",
          border: "1px solid rgba(0, 209, 255, 0.5)",
          borderRadius: "20px",
          backdropFilter: "blur(24px)",
          boxShadow: "0 12px 40px rgba(0, 209, 255, 0.4), inset 0 2px 0 rgba(255, 255, 255, 0.15), 0 0 0 1px rgba(0, 209, 255, 0.2)",
          fontFamily: "Orbitron, -apple-system, BlinkMacSystemFont, sans-serif",
          fontSize: "15px",
          padding: "14px 40px",
          minHeight: "48px",
          width: "450px",
          maxWidth: "min(92vw, 420px)",
          fontWeight: "500",
          letterSpacing: "0.025em",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          WebkitUserSelect: "none",
          userSelect: "none",
          textAlign: "center",
          pointerEvents: "auto"
        },
        classNames: {
          toast: "toast-centered",
          description: "group-[.toast]:text-white/80",
          actionButton: "group-[.toast]:bg-cyan-500 group-[.toast]:text-black",
          cancelButton: "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"
        },
        unstyled: false
      },
      ...props
    }
  );
};

let diagnosticState = {
  standalone: false,
  hasSetAppBadge: false,
  hasClearAppBadge: false,
  ua: ""
};
function initPWABadgeDiagnostics() {
  if (typeof window === "undefined") return;
  const standalone = window.matchMedia("(display-mode: standalone)").matches || navigator.standalone === true || document.referrer.includes("android-app://");
  const hasSetAppBadge = typeof navigator.setAppBadge === "function";
  const hasClearAppBadge = typeof navigator.clearAppBadge === "function";
  diagnosticState = {
    standalone,
    hasSetAppBadge,
    hasClearAppBadge,
    ua: navigator.userAgent.slice(0, 120)
  };
  window.__M1_BADGE_DIAG__ = diagnosticState;
}
async function testBadgeAPI(count) {
  if (!diagnosticState.hasSetAppBadge) {
    return false;
  }
  const testResult = {
    count,
    success: false,
    timestamp: (/* @__PURE__ */ new Date()).toISOString()
  };
  try {
    if (count > 0) {
      await navigator.setAppBadge(count);
    } else {
      await navigator.clearAppBadge();
    }
    testResult.success = true;
  } catch (error) {
    testResult.success = false;
    testResult.error = error.message || error.toString();
  }
  diagnosticState.lastTest = testResult;
  return testResult.success;
}
function createBadgeTestHelpers() {
  if (typeof window === "undefined") return;
}
function getBadgeDiagnostics() {
  return { ...diagnosticState };
}

const pwaBadgeAudit = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  createBadgeTestHelpers,
  getBadgeDiagnostics,
  initPWABadgeDiagnostics,
  testBadgeAPI
}, Symbol.toStringTag, { value: 'Module' }));

let badgeUpdateTimeout = null;
function supportsBadging() {
  if (typeof navigator === "undefined") return false;
  const hasAPI = "setAppBadge" in navigator && "clearAppBadge" in navigator;
  const isPWA = window.matchMedia("(display-mode: standalone)").matches;
  return hasAPI && isPWA;
}
function setBadge(count) {
  if (badgeUpdateTimeout) {
    clearTimeout(badgeUpdateTimeout);
  }
  badgeUpdateTimeout = setTimeout(() => {
    if (!supportsBadging()) {
      return;
    }
    try {
      const safeCount = Math.max(0, Math.floor(count));
      if (safeCount > 0) {
        navigator.setAppBadge(safeCount);
        if (undefined                                 === "1") ;
      } else {
        navigator.clearAppBadge();
        if (undefined                                 === "1") ;
      }
    } catch (error) {
    }
  }, 200);
}
function syncFromNotice(count) {
  setBadge(count);
}
function getPlatformInfo() {
  const userAgent = navigator.userAgent.toLowerCase();
  const isIOS = /iphone|ipad|ipod/.test(userAgent);
  const isAndroid = /android/.test(userAgent);
  const isDesktop = !isIOS && !isAndroid;
  const isPWA = window.matchMedia("(display-mode: standalone)").matches;
  return {
    isIOS,
    isAndroid,
    isDesktop,
    isPWA,
    supportsIconBadge: supportsBadging(),
    platform: isIOS ? "iosPWA" : isAndroid ? "android" : "desktop"
  };
}

let currentState = {
  unreadCount: 0,
  lastUpdate: (/* @__PURE__ */ new Date()).toISOString(),
  supportsIconBadge: false,
  platform: "unknown"
};
function updateBadgeState(unreadCount) {
  const platformInfo = getPlatformInfo();
  currentState = {
    unreadCount,
    lastUpdate: (/* @__PURE__ */ new Date()).toISOString(),
    supportsIconBadge: platformInfo.supportsIconBadge,
    platform: platformInfo.platform
  };
}
function getBadgeState() {
  return { ...currentState };
}
function testBadge(count) {
  return false;
}
function initBadgeDiagnostics() {
  if (typeof window !== "undefined") {
    window.__M1_BADGE__ = {
      get: () => getBadgeState(),
      test: testBadge,
      platform: getPlatformInfo()
    };
  }
}

let syncTimeout = null;
let lastSyncValue = -1;
function isSupported$1() {
  if (typeof navigator === "undefined" || typeof window === "undefined") {
    return false;
  }
  const hasAPI = "setAppBadge" in navigator && "clearAppBadge" in navigator;
  const isStandalone = window.matchMedia("(display-mode: standalone)").matches || navigator.standalone === true || document.referrer.includes("android-app://");
  return hasAPI && isStandalone;
}
async function syncAppIconBadge(count) {
  if (syncTimeout) {
    clearTimeout(syncTimeout);
  }
  syncTimeout = setTimeout(async () => {
    if (lastSyncValue === count) {
      return;
    }
    if (!isSupported$1()) {
      return;
    }
    try {
      const safeCount = Math.max(0, Math.floor(count || 0));
      if (safeCount > 0) {
        await navigator.setAppBadge(safeCount);
        if (undefined                                 === "1") ;
      } else {
        await navigator.clearAppBadge();
        if (undefined                                 === "1") ;
      }
      lastSyncValue = safeCount;
    } catch (error) {
    }
  }, 150);
}

let listeners = [];
const MAX_NOTIFICATIONS = 100;
const STORAGE_KEY$3 = "notifications";
const NOTIFICATION_CATEGORIES$1 = {
  LEADERBOARD: "leaderboard_update",
  BUZZ: "buzz",
  MAP_BUZZ: "map_buzz",
  WEEKLY: "weekly_summary",
  GENERIC: "generic"
};
function useNotifications() {
  const [notifications, setNotifications] = reactExports.useState([]);
  const [unreadCount, setUnreadCount] = reactExports.useState(0);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const loadingTimeoutRef = reactExports.useRef(null);
  const lastReloadTimeRef = reactExports.useRef(0);
  const isInitialLoadRef = reactExports.useRef(true);
  const saveNotifications = reactExports.useCallback((notifs) => {
    try {
      const limitedNotifs = notifs.slice(-MAX_NOTIFICATIONS);
      localStorage.setItem(STORAGE_KEY$3, JSON.stringify(limitedNotifs));
      return true;
    } catch (error) {
      return false;
    }
  }, []);
  const reloadNotifications = reactExports.useCallback(async (force = false) => {
    if (!force && document.visibilityState !== "visible") {
      return true;
    }
    const now = Date.now();
    if (!force && now - lastReloadTimeRef.current < 1e3 && !isInitialLoadRef.current) {
      return true;
    }
    try {
      if (isInitialLoadRef.current || now - lastReloadTimeRef.current > 1e3) {
        setIsLoading(true);
      }
      if (loadingTimeoutRef.current) {
        clearTimeout(loadingTimeoutRef.current);
      }
      localStorage.removeItem(STORAGE_KEY$3);
      let notifs = [];
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { data: supabaseNotifs, error } = await supabase.from("user_notifications").select("*").eq("is_deleted", false).eq("user_id", user.id).order("created_at", { ascending: false });
        if (error) {
        } else if (supabaseNotifs && supabaseNotifs.length > 0) {
          notifs = supabaseNotifs.map((n) => ({
            id: n.id,
            title: n.title,
            description: n.message,
            date: n.created_at,
            read: n.is_read === true,
            type: n.type
          })).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
          saveNotifications(notifs);
        }
      }
      const unreadCount2 = notifs.filter((n) => !n.read).length;
      if (undefined                                 === "1") ;
      setNotifications(notifs);
      setUnreadCount(unreadCount2);
      try {
        await syncAppIconBadge(unreadCount2);
        if (undefined                                 === "1") ;
      } catch (badgeError) {
        if (undefined                                 === "1") ;
      }
      syncFromNotice(unreadCount2);
      updateBadgeState(unreadCount2);
      if (unreadCount2 > 0 && undefined                                 === "1") ;
      loadingTimeoutRef.current = setTimeout(() => {
        setIsLoading(false);
        loadingTimeoutRef.current = null;
      }, 200);
      lastReloadTimeRef.current = now;
      isInitialLoadRef.current = false;
      return true;
    } catch (e) {
      setNotifications([]);
      setUnreadCount(0);
      setIsLoading(false);
      return false;
    }
  }, [saveNotifications]);
  const markAllAsRead = reactExports.useCallback(async () => {
    if (notifications.length === 0) return;
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { error } = await supabase.from("user_notifications").update({ is_read: true }).eq("user_id", user.id).eq("is_deleted", false);
        if (error) {
          return;
        } else {
        }
      }
      const updated = notifications.map((n) => ({ ...n, read: true }));
      const saved = saveNotifications(updated);
      if (saved) {
        setNotifications(updated);
        setUnreadCount(0);
        try {
          await syncAppIconBadge(0);
        } catch (badgeError) {
        }
        syncFromNotice(0);
        updateBadgeState(0);
        listeners.forEach((fn) => fn());
      }
    } catch (error) {
    }
  }, [notifications, saveNotifications]);
  reactExports.useEffect(() => {
    const setupRealtimeSubscription = async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      const channel = supabase.channel("notification-changes").on(
        "postgres_changes",
        {
          event: "*",
          schema: "public",
          table: "user_notifications",
          filter: `user_id=eq.${user.id}`
        },
        (payload) => {
          if (payload.eventType === "INSERT" || payload.eventType === "UPDATE") {
            reloadNotifications(true);
          }
        }
      ).subscribe();
      return () => {
        supabase.removeChannel(channel);
      };
    };
    setupRealtimeSubscription();
  }, [reloadNotifications]);
  reactExports.useEffect(() => {
    const startPolling = () => {
      const interval = setInterval(() => {
        if (document.visibilityState === "visible") {
          reloadNotifications();
        }
      }, 5e3);
      return interval;
    };
    if (!isInitialLoadRef.current) {
      reloadNotifications().then(() => {
        isInitialLoadRef.current = true;
      });
    }
    const pollingInterval = startPolling();
    return () => {
      clearInterval(pollingInterval);
    };
  }, [reloadNotifications]);
  reactExports.useEffect(() => {
    const handleVisibilityChange = () => {
      if (document.visibilityState === "visible" && !isInitialLoadRef.current) {
        reloadNotifications(true);
      }
    };
    const handleFocus = () => {
      if (!isInitialLoadRef.current) {
        syncFromNotice(unreadCount);
        syncAppIconBadge(unreadCount);
      }
    };
    document.addEventListener("visibilitychange", handleVisibilityChange);
    window.addEventListener("focus", handleFocus);
    return () => {
      document.removeEventListener("visibilitychange", handleVisibilityChange);
      window.removeEventListener("focus", handleFocus);
    };
  }, [reloadNotifications, unreadCount]);
  const markAsRead = reactExports.useCallback(async (id) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { error } = await supabase.from("user_notifications").update({ is_read: true }).eq("id", id);
        if (error) {
        } else {
        }
      }
      const updated = notifications.map((n) => n.id === id ? { ...n, read: true } : n);
      const saved = saveNotifications(updated);
      if (saved) {
        const newUnreadCount = updated.filter((n) => !n.read).length;
        if (undefined                                 === "1") ;
        setNotifications(updated);
        setUnreadCount(newUnreadCount);
        try {
          await syncAppIconBadge(newUnreadCount);
        } catch (badgeError) {
        }
        syncFromNotice(newUnreadCount);
        updateBadgeState(newUnreadCount);
        listeners.forEach((fn) => fn());
      }
      return saved;
    } catch (error) {
      return false;
    }
  }, [notifications, saveNotifications]);
  const deleteNotification = reactExports.useCallback(async (id) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { error } = await supabase.from("user_notifications").update({ is_deleted: true }).eq("id", id);
        if (error) {
        }
      }
      const updated = notifications.filter((n) => n.id !== id);
      const saved = saveNotifications(updated);
      if (saved) {
        const newUnreadCount = updated.filter((n) => !n.read).length;
        setNotifications(updated);
        setUnreadCount(newUnreadCount);
        try {
          await syncAppIconBadge(newUnreadCount);
        } catch (badgeError) {
        }
        syncFromNotice(newUnreadCount);
        updateBadgeState(newUnreadCount);
        listeners.forEach((fn) => fn());
      }
      return saved;
    } catch (error) {
      return false;
    }
  }, [notifications, saveNotifications]);
  const addNotification = reactExports.useCallback(async (notification) => {
    const type = notification.type || NOTIFICATION_CATEGORIES$1.GENERIC;
    try {
      let tempId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      let newNotification = {
        id: tempId,
        title: notification.title,
        description: notification.description,
        date: (/* @__PURE__ */ new Date()).toISOString(),
        read: false,
        type
      };
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { error, data } = await supabase.from("user_notifications").insert({
          user_id: user.id,
          type,
          title: notification.title,
          message: notification.description,
          is_read: false
        }).select().single();
        if (error) {
        } else if (data) {
          newNotification.id = data.id;
        }
      }
      const stored = localStorage.getItem(STORAGE_KEY$3);
      const currentNotifs = stored ? JSON.parse(stored) : [];
      const updated = [newNotification, ...currentNotifs];
      const saved = saveNotifications(updated);
      if (saved) {
        const newUnreadCount = updated.filter((n) => !n.read).length;
        setNotifications(updated);
        setUnreadCount(newUnreadCount);
        try {
          await syncAppIconBadge(newUnreadCount);
        } catch (badgeError) {
        }
        syncFromNotice(newUnreadCount);
        updateBadgeState(newUnreadCount);
        listeners.forEach((fn) => fn());
      }
      return saved;
    } catch (error) {
      return false;
    }
  }, [saveNotifications]);
  const getNotificationsByCategory = reactExports.useCallback((category) => {
    return notifications.filter((n) => n.type === category);
  }, [notifications]);
  const manualReload = reactExports.useCallback(async () => {
    return await reloadNotifications(true);
  }, [reloadNotifications]);
  return {
    notifications,
    unreadCount,
    isLoading,
    reloadNotifications: manualReload,
    markAllAsRead,
    markAsRead,
    addNotification,
    deleteNotification,
    getNotificationsByCategory
  };
}

const BadgeAuditReport = () => {
  useNotifications();
  getBadgeDiagnostics();
  {
    return null;
  }
};

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */

const toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, "$1-$2").toLowerCase();
const mergeClasses = (...classes) => classes.filter((className, index, array) => {
  return Boolean(className) && className.trim() !== "" && array.indexOf(className) === index;
}).join(" ").trim();

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */

var defaultAttributes = {
  xmlns: "http://www.w3.org/2000/svg",
  width: 24,
  height: 24,
  viewBox: "0 0 24 24",
  fill: "none",
  stroke: "currentColor",
  strokeWidth: 2,
  strokeLinecap: "round",
  strokeLinejoin: "round"
};

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Icon$1 = reactExports.forwardRef(
  ({
    color = "currentColor",
    size = 24,
    strokeWidth = 2,
    absoluteStrokeWidth,
    className = "",
    children,
    iconNode,
    ...rest
  }, ref) => {
    return reactExports.createElement(
      "svg",
      {
        ref,
        ...defaultAttributes,
        width: size,
        height: size,
        stroke: color,
        strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,
        className: mergeClasses("lucide", className),
        ...rest
      },
      [
        ...iconNode.map(([tag, attrs]) => reactExports.createElement(tag, attrs)),
        ...Array.isArray(children) ? children : [children]
      ]
    );
  }
);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const createLucideIcon = (iconName, iconNode) => {
  const Component = reactExports.forwardRef(
    ({ className, ...props }, ref) => reactExports.createElement(Icon$1, {
      ref,
      iconNode,
      className: mergeClasses(`lucide-${toKebabCase(iconName)}`, className),
      ...props
    })
  );
  Component.displayName = `${iconName}`;
  return Component;
};

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Activity = createLucideIcon("Activity", [
  [
    "path",
    {
      d: "M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",
      key: "169zse"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Apple = createLucideIcon("Apple", [
  [
    "path",
    {
      d: "M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",
      key: "3s7exb"
    }
  ],
  ["path", { d: "M10 2c1 .5 2 2 2 5", key: "fcco2y" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Archive = createLucideIcon("Archive", [
  ["rect", { width: "20", height: "5", x: "2", y: "3", rx: "1", key: "1wp1u1" }],
  ["path", { d: "M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8", key: "1s80jp" }],
  ["path", { d: "M10 12h4", key: "a56b0p" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ArrowDown = createLucideIcon("ArrowDown", [
  ["path", { d: "M12 5v14", key: "s699le" }],
  ["path", { d: "m19 12-7 7-7-7", key: "1idqje" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ArrowLeft = createLucideIcon("ArrowLeft", [
  ["path", { d: "m12 19-7-7 7-7", key: "1l729n" }],
  ["path", { d: "M19 12H5", key: "x3x0zl" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Award = createLucideIcon("Award", [
  [
    "path",
    {
      d: "m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",
      key: "1yiouv"
    }
  ],
  ["circle", { cx: "12", cy: "8", r: "6", key: "1vp47v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Ban = createLucideIcon("Ban", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "m4.9 4.9 14.2 14.2", key: "1m5liu" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Battery = createLucideIcon("Battery", [
  ["rect", { width: "16", height: "10", x: "2", y: "7", rx: "2", ry: "2", key: "1w10f2" }],
  ["line", { x1: "22", x2: "22", y1: "11", y2: "13", key: "4dh1rd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const BellOff = createLucideIcon("BellOff", [
  ["path", { d: "M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5", key: "o7mx20" }],
  ["path", { d: "M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7", key: "16f1lm" }],
  ["path", { d: "M10.3 21a1.94 1.94 0 0 0 3.4 0", key: "qgo35s" }],
  ["path", { d: "m2 2 20 20", key: "1ooewy" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Bell = createLucideIcon("Bell", [
  ["path", { d: "M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9", key: "1qo2s2" }],
  ["path", { d: "M10.3 21a1.94 1.94 0 0 0 3.4 0", key: "qgo35s" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const BookOpen = createLucideIcon("BookOpen", [
  ["path", { d: "M12 7v14", key: "1akyts" }],
  [
    "path",
    {
      d: "M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",
      key: "ruj8y"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Bot = createLucideIcon("Bot", [
  ["path", { d: "M12 8V4H8", key: "hb8ula" }],
  ["rect", { width: "16", height: "12", x: "4", y: "8", rx: "2", key: "enze0r" }],
  ["path", { d: "M2 14h2", key: "vft8re" }],
  ["path", { d: "M20 14h2", key: "4cs60a" }],
  ["path", { d: "M15 13v2", key: "1xurst" }],
  ["path", { d: "M9 13v2", key: "rq6x2g" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Brain = createLucideIcon("Brain", [
  [
    "path",
    {
      d: "M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",
      key: "l5xja"
    }
  ],
  [
    "path",
    {
      d: "M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",
      key: "ep3f8r"
    }
  ],
  ["path", { d: "M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4", key: "1p4c4q" }],
  ["path", { d: "M17.599 6.5a3 3 0 0 0 .399-1.375", key: "tmeiqw" }],
  ["path", { d: "M6.003 5.125A3 3 0 0 0 6.401 6.5", key: "105sqy" }],
  ["path", { d: "M3.477 10.896a4 4 0 0 1 .585-.396", key: "ql3yin" }],
  ["path", { d: "M19.938 10.5a4 4 0 0 1 .585.396", key: "1qfode" }],
  ["path", { d: "M6 18a4 4 0 0 1-1.967-.516", key: "2e4loj" }],
  ["path", { d: "M19.967 17.484A4 4 0 0 1 18 18", key: "159ez6" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Calendar = createLucideIcon("Calendar", [
  ["path", { d: "M8 2v4", key: "1cmpym" }],
  ["path", { d: "M16 2v4", key: "4m81vk" }],
  ["rect", { width: "18", height: "18", x: "3", y: "4", rx: "2", key: "1hopcy" }],
  ["path", { d: "M3 10h18", key: "8toen8" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Camera = createLucideIcon("Camera", [
  [
    "path",
    {
      d: "M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",
      key: "1tc9qg"
    }
  ],
  ["circle", { cx: "12", cy: "13", r: "3", key: "1vg3eu" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ChartColumn = createLucideIcon("ChartColumn", [
  ["path", { d: "M3 3v16a2 2 0 0 0 2 2h16", key: "c24i48" }],
  ["path", { d: "M18 17V9", key: "2bz60n" }],
  ["path", { d: "M13 17V5", key: "1frdt8" }],
  ["path", { d: "M8 17v-3", key: "17ska0" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Check = createLucideIcon("Check", [["path", { d: "M20 6 9 17l-5-5", key: "1gmf2c" }]]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ChevronDown = createLucideIcon("ChevronDown", [
  ["path", { d: "m6 9 6 6 6-6", key: "qrunsl" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ChevronRight = createLucideIcon("ChevronRight", [
  ["path", { d: "m9 18 6-6-6-6", key: "mthhwq" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ChevronUp = createLucideIcon("ChevronUp", [["path", { d: "m18 15-6-6-6 6", key: "153udz" }]]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CircleAlert = createLucideIcon("CircleAlert", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["line", { x1: "12", x2: "12", y1: "8", y2: "12", key: "1pkeuh" }],
  ["line", { x1: "12", x2: "12.01", y1: "16", y2: "16", key: "4dfq90" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CircleCheckBig = createLucideIcon("CircleCheckBig", [
  ["path", { d: "M21.801 10A10 10 0 1 1 17 3.335", key: "yps3ct" }],
  ["path", { d: "m9 11 3 3L22 4", key: "1pflzl" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CircleCheck = createLucideIcon("CircleCheck", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "m9 12 2 2 4-4", key: "dzmm74" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CircleX = createLucideIcon("CircleX", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "m15 9-6 6", key: "1uzhvr" }],
  ["path", { d: "m9 9 6 6", key: "z0biqf" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Circle = createLucideIcon("Circle", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Clock = createLucideIcon("Clock", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["polyline", { points: "12 6 12 12 16 14", key: "68esgv" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Coins = createLucideIcon("Coins", [
  ["circle", { cx: "8", cy: "8", r: "6", key: "3yglwk" }],
  ["path", { d: "M18.09 10.37A6 6 0 1 1 10.34 18", key: "t5s6rm" }],
  ["path", { d: "M7 6h1v4", key: "1obek4" }],
  ["path", { d: "m16.71 13.88.7.71-2.82 2.82", key: "1rbuyh" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Compass = createLucideIcon("Compass", [
  [
    "path",
    {
      d: "m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",
      key: "9ktpf1"
    }
  ],
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Cookie = createLucideIcon("Cookie", [
  ["path", { d: "M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5", key: "laymnq" }],
  ["path", { d: "M8.5 8.5v.01", key: "ue8clq" }],
  ["path", { d: "M16 15.5v.01", key: "14dtrp" }],
  ["path", { d: "M12 12v.01", key: "u5ubse" }],
  ["path", { d: "M11 17v.01", key: "1hyl5a" }],
  ["path", { d: "M7 14v.01", key: "uct60s" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Copy = createLucideIcon("Copy", [
  ["rect", { width: "14", height: "14", x: "8", y: "8", rx: "2", ry: "2", key: "17jyea" }],
  ["path", { d: "M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2", key: "zix9uf" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Copyright = createLucideIcon("Copyright", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "M14.83 14.83a4 4 0 1 1 0-5.66", key: "1i56pz" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Cpu = createLucideIcon("Cpu", [
  ["rect", { width: "16", height: "16", x: "4", y: "4", rx: "2", key: "14l7u7" }],
  ["rect", { width: "6", height: "6", x: "9", y: "9", rx: "1", key: "5aljv4" }],
  ["path", { d: "M15 2v2", key: "13l42r" }],
  ["path", { d: "M15 20v2", key: "15mkzm" }],
  ["path", { d: "M2 15h2", key: "1gxd5l" }],
  ["path", { d: "M2 9h2", key: "1bbxkp" }],
  ["path", { d: "M20 15h2", key: "19e6y8" }],
  ["path", { d: "M20 9h2", key: "19tzq7" }],
  ["path", { d: "M9 2v2", key: "165o2o" }],
  ["path", { d: "M9 20v2", key: "i2bqo8" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CreditCard = createLucideIcon("CreditCard", [
  ["rect", { width: "20", height: "14", x: "2", y: "5", rx: "2", key: "ynyp8z" }],
  ["line", { x1: "2", x2: "22", y1: "10", y2: "10", key: "1b3vmo" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Crosshair = createLucideIcon("Crosshair", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["line", { x1: "22", x2: "18", y1: "12", y2: "12", key: "l9bcsi" }],
  ["line", { x1: "6", x2: "2", y1: "12", y2: "12", key: "13hhkx" }],
  ["line", { x1: "12", x2: "12", y1: "6", y2: "2", key: "10w3f3" }],
  ["line", { x1: "12", x2: "12", y1: "22", y2: "18", key: "15g9kq" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Crown = createLucideIcon("Crown", [
  [
    "path",
    {
      d: "M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",
      key: "1vdc57"
    }
  ],
  ["path", { d: "M5 21h14", key: "11awu3" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Database = createLucideIcon("Database", [
  ["ellipse", { cx: "12", cy: "5", rx: "9", ry: "3", key: "msslwz" }],
  ["path", { d: "M3 5V19A9 3 0 0 0 21 19V5", key: "1wlel7" }],
  ["path", { d: "M3 12A9 3 0 0 0 21 12", key: "mv7ke4" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Download = createLucideIcon("Download", [
  ["path", { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4", key: "ih7n3h" }],
  ["polyline", { points: "7 10 12 15 17 10", key: "2ggqvy" }],
  ["line", { x1: "12", x2: "12", y1: "15", y2: "3", key: "1vk2je" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Ellipsis = createLucideIcon("Ellipsis", [
  ["circle", { cx: "12", cy: "12", r: "1", key: "41hilf" }],
  ["circle", { cx: "19", cy: "12", r: "1", key: "1wjl8i" }],
  ["circle", { cx: "5", cy: "12", r: "1", key: "1pcz8c" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ExternalLink = createLucideIcon("ExternalLink", [
  ["path", { d: "M15 3h6v6", key: "1q9fwt" }],
  ["path", { d: "M10 14 21 3", key: "gplh6r" }],
  ["path", { d: "M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6", key: "a6xqqp" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const EyeOff = createLucideIcon("EyeOff", [
  [
    "path",
    {
      d: "M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",
      key: "ct8e1f"
    }
  ],
  ["path", { d: "M14.084 14.158a3 3 0 0 1-4.242-4.242", key: "151rxh" }],
  [
    "path",
    {
      d: "M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",
      key: "13bj9a"
    }
  ],
  ["path", { d: "m2 2 20 20", key: "1ooewy" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Eye = createLucideIcon("Eye", [
  [
    "path",
    {
      d: "M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",
      key: "1nclc0"
    }
  ],
  ["circle", { cx: "12", cy: "12", r: "3", key: "1v7zrd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const FileText = createLucideIcon("FileText", [
  ["path", { d: "M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z", key: "1rqfz7" }],
  ["path", { d: "M14 2v4a2 2 0 0 0 2 2h4", key: "tnqrlb" }],
  ["path", { d: "M10 9H8", key: "b1mrlr" }],
  ["path", { d: "M16 13H8", key: "t4e002" }],
  ["path", { d: "M16 17H8", key: "z1uh3a" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Flame = createLucideIcon("Flame", [
  [
    "path",
    {
      d: "M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",
      key: "96xj49"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Gamepad2 = createLucideIcon("Gamepad2", [
  ["line", { x1: "6", x2: "10", y1: "11", y2: "11", key: "1gktln" }],
  ["line", { x1: "8", x2: "8", y1: "9", y2: "13", key: "qnk9ow" }],
  ["line", { x1: "15", x2: "15.01", y1: "12", y2: "12", key: "krot7o" }],
  ["line", { x1: "18", x2: "18.01", y1: "10", y2: "10", key: "1lcuu1" }],
  [
    "path",
    {
      d: "M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",
      key: "mfqc10"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Gem = createLucideIcon("Gem", [
  ["path", { d: "M6 3h12l4 6-10 13L2 9Z", key: "1pcd5k" }],
  ["path", { d: "M11 3 8 9l4 13 4-13-3-6", key: "1fcu3u" }],
  ["path", { d: "M2 9h20", key: "16fsjt" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Gift = createLucideIcon("Gift", [
  ["rect", { x: "3", y: "8", width: "18", height: "4", rx: "1", key: "bkv52" }],
  ["path", { d: "M12 8v13", key: "1c76mn" }],
  ["path", { d: "M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7", key: "6wjy6b" }],
  [
    "path",
    {
      d: "M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",
      key: "1ihvrl"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Globe = createLucideIcon("Globe", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20", key: "13o1zl" }],
  ["path", { d: "M2 12h20", key: "9i4pu4" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Heart = createLucideIcon("Heart", [
  [
    "path",
    {
      d: "M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",
      key: "c3ymky"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const House = createLucideIcon("House", [
  ["path", { d: "M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8", key: "5wwlr5" }],
  [
    "path",
    {
      d: "M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",
      key: "1d0kgt"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const IdCard = createLucideIcon("IdCard", [
  ["path", { d: "M16 10h2", key: "8sgtl7" }],
  ["path", { d: "M16 14h2", key: "epxaof" }],
  ["path", { d: "M6.17 15a3 3 0 0 1 5.66 0", key: "n6f512" }],
  ["circle", { cx: "9", cy: "11", r: "2", key: "yxgjnd" }],
  ["rect", { x: "2", y: "5", width: "20", height: "14", rx: "2", key: "qneu4z" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Infinity$1 = createLucideIcon("Infinity", [
  [
    "path",
    {
      d: "M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",
      key: "1z0uae"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Info = createLucideIcon("Info", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "M12 16v-4", key: "1dtifu" }],
  ["path", { d: "M12 8h.01", key: "e9boi3" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Instagram = createLucideIcon("Instagram", [
  ["rect", { width: "20", height: "20", x: "2", y: "2", rx: "5", ry: "5", key: "2e1cvw" }],
  ["path", { d: "M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z", key: "9exkf1" }],
  ["line", { x1: "17.5", x2: "17.51", y1: "6.5", y2: "6.5", key: "r4j83e" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Key = createLucideIcon("Key", [
  ["path", { d: "m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4", key: "g0fldk" }],
  ["path", { d: "m21 2-9.6 9.6", key: "1j0ho8" }],
  ["circle", { cx: "7.5", cy: "15.5", r: "5.5", key: "yqb3hr" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const LoaderCircle = createLucideIcon("LoaderCircle", [
  ["path", { d: "M21 12a9 9 0 1 1-6.219-8.56", key: "13zald" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Lock = createLucideIcon("Lock", [
  ["rect", { width: "18", height: "11", x: "3", y: "11", rx: "2", ry: "2", key: "1w4ew1" }],
  ["path", { d: "M7 11V7a5 5 0 0 1 10 0v4", key: "fwvmzm" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const LogOut = createLucideIcon("LogOut", [
  ["path", { d: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4", key: "1uf3rs" }],
  ["polyline", { points: "16 17 21 12 16 7", key: "1gabdz" }],
  ["line", { x1: "21", x2: "9", y1: "12", y2: "12", key: "1uyos4" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Mail = createLucideIcon("Mail", [
  ["rect", { width: "20", height: "16", x: "2", y: "4", rx: "2", key: "18n3k1" }],
  ["path", { d: "m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7", key: "1ocrg3" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const MapPin = createLucideIcon("MapPin", [
  [
    "path",
    {
      d: "M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",
      key: "1r0f0z"
    }
  ],
  ["circle", { cx: "12", cy: "10", r: "3", key: "ilqhr7" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Map$1 = createLucideIcon("Map", [
  [
    "path",
    {
      d: "M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",
      key: "169xi5"
    }
  ],
  ["path", { d: "M15 5.764v15", key: "1pn4in" }],
  ["path", { d: "M9 3.236v15", key: "1uimfh" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Medal = createLucideIcon("Medal", [
  [
    "path",
    {
      d: "M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",
      key: "143lza"
    }
  ],
  ["path", { d: "M11 12 5.12 2.2", key: "qhuxz6" }],
  ["path", { d: "m13 12 5.88-9.8", key: "hbye0f" }],
  ["path", { d: "M8 7h8", key: "i86dvs" }],
  ["circle", { cx: "12", cy: "17", r: "5", key: "qbz8iq" }],
  ["path", { d: "M12 18v-2h-.5", key: "fawc4q" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Megaphone = createLucideIcon("Megaphone", [
  ["path", { d: "m3 11 18-5v12L3 14v-3z", key: "n962bs" }],
  ["path", { d: "M11.6 16.8a3 3 0 1 1-5.8-1.6", key: "1yl0tm" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const MessageCircle = createLucideIcon("MessageCircle", [
  ["path", { d: "M7.9 20A9 9 0 1 0 4 16.1L2 22Z", key: "vv11sd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const MessageSquare = createLucideIcon("MessageSquare", [
  ["path", { d: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z", key: "1lielz" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const MicOff = createLucideIcon("MicOff", [
  ["line", { x1: "2", x2: "22", y1: "2", y2: "22", key: "a6p6uj" }],
  ["path", { d: "M18.89 13.23A7.12 7.12 0 0 0 19 12v-2", key: "80xlxr" }],
  ["path", { d: "M5 10v2a7 7 0 0 0 12 5", key: "p2k8kg" }],
  ["path", { d: "M15 9.34V5a3 3 0 0 0-5.68-1.33", key: "1gzdoj" }],
  ["path", { d: "M9 9v3a3 3 0 0 0 5.12 2.12", key: "r2i35w" }],
  ["line", { x1: "12", x2: "12", y1: "19", y2: "22", key: "x3vr5v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Mic = createLucideIcon("Mic", [
  ["path", { d: "M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z", key: "131961" }],
  ["path", { d: "M19 10v2a7 7 0 0 1-14 0v-2", key: "1vc78b" }],
  ["line", { x1: "12", x2: "12", y1: "19", y2: "22", key: "x3vr5v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Monitor = createLucideIcon("Monitor", [
  ["rect", { width: "20", height: "14", x: "2", y: "3", rx: "2", key: "48i651" }],
  ["line", { x1: "8", x2: "16", y1: "21", y2: "21", key: "1svkeh" }],
  ["line", { x1: "12", x2: "12", y1: "17", y2: "21", key: "vw1qmm" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Phone = createLucideIcon("Phone", [
  [
    "path",
    {
      d: "M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",
      key: "foiqr5"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Play = createLucideIcon("Play", [
  ["polygon", { points: "6 3 20 12 6 21 6 3", key: "1oa8hb" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Plus = createLucideIcon("Plus", [
  ["path", { d: "M5 12h14", key: "1ays0h" }],
  ["path", { d: "M12 5v14", key: "s699le" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Radar = createLucideIcon("Radar", [
  ["path", { d: "M19.07 4.93A10 10 0 0 0 6.99 3.34", key: "z3du51" }],
  ["path", { d: "M4 6h.01", key: "oypzma" }],
  ["path", { d: "M2.29 9.62A10 10 0 1 0 21.31 8.35", key: "qzzz0" }],
  ["path", { d: "M16.24 7.76A6 6 0 1 0 8.23 16.67", key: "1yjesh" }],
  ["path", { d: "M12 18h.01", key: "mhygvu" }],
  ["path", { d: "M17.99 11.66A6 6 0 0 1 15.77 16.67", key: "1u2y91" }],
  ["circle", { cx: "12", cy: "12", r: "2", key: "1c9p78" }],
  ["path", { d: "m13.41 10.59 5.66-5.66", key: "mhq4k0" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Radio = createLucideIcon("Radio", [
  ["path", { d: "M4.9 19.1C1 15.2 1 8.8 4.9 4.9", key: "1vaf9d" }],
  ["path", { d: "M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5", key: "u1ii0m" }],
  ["circle", { cx: "12", cy: "12", r: "2", key: "1c9p78" }],
  ["path", { d: "M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5", key: "1j5fej" }],
  ["path", { d: "M19.1 4.9C23 8.8 23 15.1 19.1 19", key: "10b0cb" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const RefreshCw = createLucideIcon("RefreshCw", [
  ["path", { d: "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8", key: "v9h5vc" }],
  ["path", { d: "M21 3v5h-5", key: "1q7to0" }],
  ["path", { d: "M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16", key: "3uifl3" }],
  ["path", { d: "M8 16H3v5", key: "1cv678" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const RotateCcw = createLucideIcon("RotateCcw", [
  ["path", { d: "M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8", key: "1357e3" }],
  ["path", { d: "M3 3v5h5", key: "1xhq8a" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const RotateCw = createLucideIcon("RotateCw", [
  ["path", { d: "M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8", key: "1p45f6" }],
  ["path", { d: "M21 3v5h-5", key: "1q7to0" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Save = createLucideIcon("Save", [
  [
    "path",
    {
      d: "M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",
      key: "1c8476"
    }
  ],
  ["path", { d: "M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7", key: "1ydtos" }],
  ["path", { d: "M7 3v4a1 1 0 0 0 1 1h7", key: "t51u73" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Scale = createLucideIcon("Scale", [
  ["path", { d: "m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z", key: "7g6ntu" }],
  ["path", { d: "m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z", key: "ijws7r" }],
  ["path", { d: "M7 21h10", key: "1b0cd5" }],
  ["path", { d: "M12 3v18", key: "108xh3" }],
  ["path", { d: "M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2", key: "3gwbw2" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Search = createLucideIcon("Search", [
  ["circle", { cx: "11", cy: "11", r: "8", key: "4ej97u" }],
  ["path", { d: "m21 21-4.3-4.3", key: "1qie3q" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Send = createLucideIcon("Send", [
  [
    "path",
    {
      d: "M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",
      key: "1ffxy3"
    }
  ],
  ["path", { d: "m21.854 2.147-10.94 10.939", key: "12cjpa" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Server = createLucideIcon("Server", [
  ["rect", { width: "20", height: "8", x: "2", y: "2", rx: "2", ry: "2", key: "ngkwjq" }],
  ["rect", { width: "20", height: "8", x: "2", y: "14", rx: "2", ry: "2", key: "iecqi9" }],
  ["line", { x1: "6", x2: "6.01", y1: "6", y2: "6", key: "16zg32" }],
  ["line", { x1: "6", x2: "6.01", y1: "18", y2: "18", key: "nzw8ys" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Settings = createLucideIcon("Settings", [
  [
    "path",
    {
      d: "M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",
      key: "1qme2f"
    }
  ],
  ["circle", { cx: "12", cy: "12", r: "3", key: "1v7zrd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Share2 = createLucideIcon("Share2", [
  ["circle", { cx: "18", cy: "5", r: "3", key: "gq8acd" }],
  ["circle", { cx: "6", cy: "12", r: "3", key: "w7nqdw" }],
  ["circle", { cx: "18", cy: "19", r: "3", key: "1xt0gg" }],
  ["line", { x1: "8.59", x2: "15.42", y1: "13.51", y2: "17.49", key: "47mynk" }],
  ["line", { x1: "15.41", x2: "8.59", y1: "6.51", y2: "10.49", key: "1n3mei" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Shield = createLucideIcon("Shield", [
  [
    "path",
    {
      d: "M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",
      key: "oel41y"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ShoppingCart = createLucideIcon("ShoppingCart", [
  ["circle", { cx: "8", cy: "21", r: "1", key: "jimo8o" }],
  ["circle", { cx: "19", cy: "21", r: "1", key: "13723u" }],
  [
    "path",
    {
      d: "M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",
      key: "9zh506"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Shuffle = createLucideIcon("Shuffle", [
  ["path", { d: "m18 14 4 4-4 4", key: "10pe0f" }],
  ["path", { d: "m18 2 4 4-4 4", key: "pucp1d" }],
  ["path", { d: "M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22", key: "1ailkh" }],
  ["path", { d: "M2 6h1.972a4 4 0 0 1 3.6 2.2", key: "km57vx" }],
  ["path", { d: "M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45", key: "os18l9" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Smartphone = createLucideIcon("Smartphone", [
  ["rect", { width: "14", height: "20", x: "5", y: "2", rx: "2", ry: "2", key: "1yt0o3" }],
  ["path", { d: "M12 18h.01", key: "mhygvu" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Sparkles = createLucideIcon("Sparkles", [
  [
    "path",
    {
      d: "M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",
      key: "4pj2yx"
    }
  ],
  ["path", { d: "M20 3v4", key: "1olli1" }],
  ["path", { d: "M22 5h-4", key: "1gvqau" }],
  ["path", { d: "M4 17v2", key: "vumght" }],
  ["path", { d: "M5 18H3", key: "zchphs" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const SquarePen = createLucideIcon("SquarePen", [
  ["path", { d: "M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7", key: "1m0v6g" }],
  [
    "path",
    {
      d: "M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",
      key: "ohrbg2"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Star = createLucideIcon("Star", [
  [
    "path",
    {
      d: "M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",
      key: "r04s7s"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Stethoscope = createLucideIcon("Stethoscope", [
  ["path", { d: "M11 2v2", key: "1539x4" }],
  ["path", { d: "M5 2v2", key: "1yf1q8" }],
  ["path", { d: "M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1", key: "rb5t3r" }],
  ["path", { d: "M8 15a6 6 0 0 0 12 0v-3", key: "x18d4x" }],
  ["circle", { cx: "20", cy: "10", r: "2", key: "ts1r5v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Swords = createLucideIcon("Swords", [
  ["polyline", { points: "14.5 17.5 3 6 3 3 6 3 17.5 14.5", key: "1hfsw2" }],
  ["line", { x1: "13", x2: "19", y1: "19", y2: "13", key: "1vrmhu" }],
  ["line", { x1: "16", x2: "20", y1: "16", y2: "20", key: "1bron3" }],
  ["line", { x1: "19", x2: "21", y1: "21", y2: "19", key: "13pww6" }],
  ["polyline", { points: "14.5 6.5 18 3 21 3 21 6 17.5 9.5", key: "hbey2j" }],
  ["line", { x1: "5", x2: "9", y1: "14", y2: "18", key: "1hf58s" }],
  ["line", { x1: "7", x2: "4", y1: "17", y2: "20", key: "pidxm4" }],
  ["line", { x1: "3", x2: "5", y1: "19", y2: "21", key: "1pehsh" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Tag = createLucideIcon("Tag", [
  [
    "path",
    {
      d: "M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",
      key: "vktsd0"
    }
  ],
  ["circle", { cx: "7.5", cy: "7.5", r: ".5", fill: "currentColor", key: "kqv944" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Target = createLucideIcon("Target", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["circle", { cx: "12", cy: "12", r: "6", key: "1vlfrh" }],
  ["circle", { cx: "12", cy: "12", r: "2", key: "1c9p78" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Trash2 = createLucideIcon("Trash2", [
  ["path", { d: "M3 6h18", key: "d0wm0j" }],
  ["path", { d: "M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6", key: "4alrt4" }],
  ["path", { d: "M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2", key: "v07s0e" }],
  ["line", { x1: "10", x2: "10", y1: "11", y2: "17", key: "1uufr5" }],
  ["line", { x1: "14", x2: "14", y1: "11", y2: "17", key: "xtxkd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const TrendingDown = createLucideIcon("TrendingDown", [
  ["polyline", { points: "22 17 13.5 8.5 8.5 13.5 2 7", key: "1r2t7k" }],
  ["polyline", { points: "16 17 22 17 22 11", key: "11uiuu" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const TrendingUp = createLucideIcon("TrendingUp", [
  ["polyline", { points: "22 7 13.5 15.5 8.5 10.5 2 17", key: "126l90" }],
  ["polyline", { points: "16 7 22 7 22 13", key: "kwv8wd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const TriangleAlert = createLucideIcon("TriangleAlert", [
  [
    "path",
    {
      d: "m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",
      key: "wmoenq"
    }
  ],
  ["path", { d: "M12 9v4", key: "juzpu7" }],
  ["path", { d: "M12 17h.01", key: "p32p05" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Trophy = createLucideIcon("Trophy", [
  ["path", { d: "M6 9H4.5a2.5 2.5 0 0 1 0-5H6", key: "17hqa7" }],
  ["path", { d: "M18 9h1.5a2.5 2.5 0 0 0 0-5H18", key: "lmptdp" }],
  ["path", { d: "M4 22h16", key: "57wxv0" }],
  ["path", { d: "M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22", key: "1nw9bq" }],
  ["path", { d: "M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22", key: "1np0yb" }],
  ["path", { d: "M18 2H6v7a6 6 0 0 0 12 0V2Z", key: "u46fv3" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const UserCheck = createLucideIcon("UserCheck", [
  ["path", { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2", key: "1yyitq" }],
  ["circle", { cx: "9", cy: "7", r: "4", key: "nufk8" }],
  ["polyline", { points: "16 11 18 13 22 9", key: "1pwet4" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const UserPlus = createLucideIcon("UserPlus", [
  ["path", { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2", key: "1yyitq" }],
  ["circle", { cx: "9", cy: "7", r: "4", key: "nufk8" }],
  ["line", { x1: "19", x2: "19", y1: "8", y2: "14", key: "1bvyxn" }],
  ["line", { x1: "22", x2: "16", y1: "11", y2: "11", key: "1shjgl" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const UserX = createLucideIcon("UserX", [
  ["path", { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2", key: "1yyitq" }],
  ["circle", { cx: "9", cy: "7", r: "4", key: "nufk8" }],
  ["line", { x1: "17", x2: "22", y1: "8", y2: "13", key: "3nzzx3" }],
  ["line", { x1: "22", x2: "17", y1: "8", y2: "13", key: "1swrse" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const User = createLucideIcon("User", [
  ["path", { d: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2", key: "975kel" }],
  ["circle", { cx: "12", cy: "7", r: "4", key: "17ys0d" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Users = createLucideIcon("Users", [
  ["path", { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2", key: "1yyitq" }],
  ["circle", { cx: "9", cy: "7", r: "4", key: "nufk8" }],
  ["path", { d: "M22 21v-2a4 4 0 0 0-3-3.87", key: "kshegd" }],
  ["path", { d: "M16 3.13a4 4 0 0 1 0 7.75", key: "1da9ce" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Vault = createLucideIcon("Vault", [
  ["rect", { width: "18", height: "18", x: "3", y: "3", rx: "2", key: "afitv7" }],
  ["circle", { cx: "7.5", cy: "7.5", r: ".5", fill: "currentColor", key: "kqv944" }],
  ["path", { d: "m7.9 7.9 2.7 2.7", key: "hpeyl3" }],
  ["circle", { cx: "16.5", cy: "7.5", r: ".5", fill: "currentColor", key: "w0ekpg" }],
  ["path", { d: "m13.4 10.6 2.7-2.7", key: "264c1n" }],
  ["circle", { cx: "7.5", cy: "16.5", r: ".5", fill: "currentColor", key: "nkw3mc" }],
  ["path", { d: "m7.9 16.1 2.7-2.7", key: "p81g5e" }],
  ["circle", { cx: "16.5", cy: "16.5", r: ".5", fill: "currentColor", key: "fubopw" }],
  ["path", { d: "m13.4 13.4 2.7 2.7", key: "abhel3" }],
  ["circle", { cx: "12", cy: "12", r: "2", key: "1c9p78" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Video = createLucideIcon("Video", [
  [
    "path",
    {
      d: "m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",
      key: "ftymec"
    }
  ],
  ["rect", { x: "2", y: "6", width: "14", height: "12", rx: "2", key: "158x01" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Volume2 = createLucideIcon("Volume2", [
  [
    "path",
    {
      d: "M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",
      key: "uqj9uw"
    }
  ],
  ["path", { d: "M16 9a5 5 0 0 1 0 6", key: "1q6k2b" }],
  ["path", { d: "M19.364 18.364a9 9 0 0 0 0-12.728", key: "ijwkga" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const WifiOff = createLucideIcon("WifiOff", [
  ["path", { d: "M12 20h.01", key: "zekei9" }],
  ["path", { d: "M8.5 16.429a5 5 0 0 1 7 0", key: "1bycff" }],
  ["path", { d: "M5 12.859a10 10 0 0 1 5.17-2.69", key: "1dl1wf" }],
  ["path", { d: "M19 12.859a10 10 0 0 0-2.007-1.523", key: "4k23kn" }],
  ["path", { d: "M2 8.82a15 15 0 0 1 4.177-2.643", key: "1grhjp" }],
  ["path", { d: "M22 8.82a15 15 0 0 0-11.288-3.764", key: "z3jwby" }],
  ["path", { d: "m2 2 20 20", key: "1ooewy" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Wifi = createLucideIcon("Wifi", [
  ["path", { d: "M12 20h.01", key: "zekei9" }],
  ["path", { d: "M2 8.82a15 15 0 0 1 20 0", key: "dnpr2z" }],
  ["path", { d: "M5 12.859a10 10 0 0 1 14 0", key: "1x1e6c" }],
  ["path", { d: "M8.5 16.429a5 5 0 0 1 7 0", key: "1bycff" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const X = createLucideIcon("X", [
  ["path", { d: "M18 6 6 18", key: "1bl5f8" }],
  ["path", { d: "m6 6 12 12", key: "d8bk6v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Zap = createLucideIcon("Zap", [
  [
    "path",
    {
      d: "M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",
      key: "1xq2db"
    }
  ]
]);

const PushFrozenNotice = () => {
  {
    return null;
  }
};

const AuthContext = reactExports.createContext(void 0);

class AuthHealthCheckLogger {
  logs = [];
  maxLogs = 50;
  log(step, success, data, error) {
    const logEntry = {
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      step,
      success,
      data,
      error,
      userAgent: navigator.userAgent,
      isCapacitor: !!window.Capacitor,
      pathname: window.location.pathname
    };
    this.logs.unshift(logEntry);
    if (this.logs.length > this.maxLogs) {
      this.logs = this.logs.slice(0, this.maxLogs);
    }
    localStorage.setItem("authHealthLogs", JSON.stringify(this.logs));
  }
  getLogs() {
    return this.logs;
  }
  getRecentFailures() {
    return this.logs.filter((log) => !log.success);
  }
  clearLogs() {
    this.logs = [];
    localStorage.removeItem("authHealthLogs");
  }
  exportReport() {
    const report = {
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      totalLogs: this.logs.length,
      failureCount: this.getRecentFailures().length,
      successRate: this.logs.length > 0 ? (this.logs.filter((l) => l.success).length / this.logs.length * 100).toFixed(2) + "%" : "N/A",
      logs: this.logs
    };
    return JSON.stringify(report, null, 2);
  }
  // Restore logs from localStorage on init
  restoreLogsFromStorage() {
    try {
      const storedLogs = localStorage.getItem("authHealthLogs");
      if (storedLogs) {
        this.logs = JSON.parse(storedLogs);
      }
    } catch (error) {
    }
  }
  constructor() {
    this.restoreLogsFromStorage();
  }
}
const authHealthLogger = new AuthHealthCheckLogger();

const maskData = (data) => {
  const masked = { ...data };
  const sensitiveFields = ["password", "token", "secret", "key", "authorization"];
  for (const key of Object.keys(masked)) {
    if (sensitiveFields.some((f) => key.toLowerCase().includes(f))) {
      masked[key] = "[REDACTED]";
    }
    if (key.toLowerCase().includes("email") && typeof masked[key] === "string") {
      const email = masked[key];
      const [local, domain] = email.split("@");
      if (domain) {
        masked[key] = `${local.slice(0, 2)}***@${domain}`;
      }
    }
    if ((key === "user_id" || key === "userId") && typeof masked[key] === "string") {
      masked[key] = `...${masked[key].slice(-8)}`;
    }
  }
  return masked;
};
const logAuditEvent = async (entry) => {
  try {
    const userAgent = typeof navigator !== "undefined" ? navigator.userAgent : "server";
    const maskedDetails = entry.details ? maskData(entry.details) : {};
    if (false) ;
    const { error } = await supabase.from("admin_logs").insert({
      event_type: `audit_${entry.event_type.toLowerCase()}`,
      user_id: entry.user_id || null,
      note: `${entry.event_type}: ${JSON.stringify(maskedDetails).slice(0, 500)}`,
      context: JSON.stringify({
        severity: entry.severity || "info",
        user_agent: userAgent.slice(0, 200),
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        ...maskedDetails
      }).slice(0, 1e3)
    });
    if (error) {
    }
  } catch (err) {
  }
};
const logMissionConfigChange = async (userId, field, oldValue, newValue) => {
  await logAuditEvent({
    event_type: field.includes("prize") ? "PRIZE_LOCATION_CHANGE" : "MISSION_CONFIG_CHANGE",
    user_id: userId,
    severity: field.includes("prize") ? "critical" : "warning",
    details: {
      field,
      changed: true,
      // Don't log actual coordinates for prize location
      value_changed: field.includes("prize") ? "[REDACTED]" : `${oldValue} -> ${newValue}`
    }
  });
};

const ADMIN_EMAILS = [
  "wikus77@hotmail.it",
  "joseph@m1ssion.io"
];
const ADMIN_CODES = {
  "wikus77@hotmail.it": "AG-X0197"
};
const isAdminEmail = (email) => {
  if (!email) return false;
  return ADMIN_EMAILS.some(
    (admin) => admin.toLowerCase() === email.toLowerCase()
  );
};
const getAdminCode = (email) => {
  if (!email) return null;
  const normalizedEmail = email.toLowerCase();
  for (const [adminEmail, code] of Object.entries(ADMIN_CODES)) {
    if (adminEmail.toLowerCase() === normalizedEmail) {
      return code;
    }
  }
  return null;
};

const log$2 = (message, data) => {
};
const AUTH_SESSION_CACHE = "m1ssion_session_cache";
const getCachedSession = () => {
  try {
    const cached = localStorage.getItem(AUTH_SESSION_CACHE);
    if (cached) {
      const { user, session, timestamp } = JSON.parse(cached);
      if (user && session && Date.now() - timestamp < 60 * 60 * 1e3) {
        return { user, session };
      }
    }
  } catch {
  }
  return { user: null, session: null };
};
const AuthProvider = ({ children }) => {
  const cachedAuth = getCachedSession();
  const [user, setUser] = reactExports.useState(cachedAuth.user);
  const [session, setSession] = reactExports.useState(cachedAuth.session);
  const [isLoading, setIsLoading] = reactExports.useState(!cachedAuth.user);
  const [userRoles, setUserRoles] = reactExports.useState([]);
  const [isRoleLoading, setIsRoleLoading] = reactExports.useState(true);
  const cacheSession = (user2, session2) => {
    try {
      if (user2 && session2) {
        localStorage.setItem(AUTH_SESSION_CACHE, JSON.stringify({
          user: user2,
          session: session2,
          timestamp: Date.now()
        }));
      } else {
        localStorage.removeItem(AUTH_SESSION_CACHE);
      }
    } catch {
    }
  };
  reactExports.useEffect(() => {
    let isMounted = true;
    const abortController = new AbortController();
    const initializeAuth = async () => {
      try {
        log$2("Inizializzazione sistema unified auth");
        authHealthLogger.log("AuthProvider_Init", true, { timestamp: (/* @__PURE__ */ new Date()).toISOString() });
        let session2 = null;
        let attempts = 0;
        const maxAttempts = 3;
        while (attempts < maxAttempts && !session2) {
          try {
            const { data: { session: currentSession }, error } = await supabase.auth.getSession();
            if (error) {
              log$2(`Errore getSession (tentativo ${attempts + 1})`, error);
              attempts++;
              if (attempts < maxAttempts) {
                await new Promise((resolve) => setTimeout(resolve, 1e3));
                continue;
              }
              if (isMounted) {
                setIsLoading(false);
              }
              return;
            }
            session2 = currentSession;
            break;
          } catch (error) {
            log$2(`Errore getSession exception (tentativo ${attempts + 1})`, error);
            attempts++;
            if (attempts < maxAttempts) {
              await new Promise((resolve) => setTimeout(resolve, 1e3));
            }
          }
        }
        if (session2 && isMounted) {
          log$2("Sessione trovata", session2.user.email);
          setSession(session2);
          setUser(session2.user);
          cacheSession(session2.user, session2);
        } else {
          log$2("Nessuna sessione attiva");
          cacheSession(null, null);
        }
      } catch (error) {
      } finally {
        if (isMounted) {
          setIsLoading(false);
        }
      }
    };
    initializeAuth();
    return () => {
      isMounted = false;
      abortController.abort();
    };
  }, []);
  reactExports.useEffect(() => {
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      async (event, newSession) => {
        log$2(`Auth event: ${event}`, newSession?.user?.email || "NO USER");
        setSession((prevSession) => newSession);
        setUser((prevUser) => newSession?.user ?? null);
        cacheSession(newSession?.user ?? null, newSession);
        if (event === "SIGNED_IN" && newSession) {
          log$2("Utente autenticato", newSession.user.email);
          logAuditEvent({
            event_type: "LOGIN_SUCCESS",
            user_id: newSession.user.id,
            user_email: newSession.user.email,
            severity: "info"
          });
          if (isAdminEmail(newSession.user.email)) {
            logAuditEvent({
              event_type: "ADMIN_ACCESS",
              user_id: newSession.user.id,
              user_email: newSession.user.email,
              severity: "warning",
              details: { action: "login" }
            });
          }
        } else if (event === "SIGNED_OUT") {
          logAuditEvent({
            event_type: "LOGOUT",
            severity: "info"
          });
          setUserRoles([]);
          setIsRoleLoading(false);
          sessionStorage.removeItem("auth_reload_done");
        }
        setIsLoading(false);
      }
    );
    return () => {
      subscription.unsubscribe();
    };
  }, []);
  reactExports.useEffect(() => {
    const abortController = new AbortController();
    const handleVisibilityChange = async () => {
      if (document.visibilityState === "visible" && !isLoading && !abortController.signal.aborted) {
        try {
          const { data: { session: currentSession } } = await supabase.auth.getSession();
          if (currentSession && (!session || session.expires_at !== currentSession.expires_at)) {
            log$2("Sessione aggiornata da visibility change");
            setSession(currentSession);
            setUser(currentSession.user);
          }
        } catch (error) {
          if (!abortController.signal.aborted) ;
        }
      }
    };
    if (window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true) {
      document.addEventListener("visibilitychange", handleVisibilityChange, { signal: abortController.signal });
      return () => {
        abortController.abort();
        document.removeEventListener("visibilitychange", handleVisibilityChange);
      };
    }
    return () => {
      abortController.abort();
    };
  }, [session, isLoading]);
  const fetchUserRoles = async (userId) => {
    if (!userId) return;
    setIsRoleLoading(true);
    try {
      const { data: rolesData } = await supabase.from("user_roles").select("role").eq("user_id", userId);
      if (rolesData && rolesData.length > 0) {
        const roles = rolesData.map((r) => r.role);
        log$2("Roles da user_roles", roles);
        setUserRoles(roles);
        return;
      }
      const { data: profileData } = await supabase.from("profiles").select("role").eq("id", userId).single();
      if (profileData?.role) {
        log$2("Role da profiles", [profileData.role]);
        setUserRoles([profileData.role]);
      } else {
        log$2("Nessun role trovato");
        setUserRoles([]);
      }
    } catch (error) {
      setUserRoles([]);
    } finally {
      setIsRoleLoading(false);
    }
  };
  reactExports.useEffect(() => {
    if (user?.id) {
      fetchUserRoles(user.id);
    } else {
      setUserRoles([]);
      setIsRoleLoading(false);
    }
  }, [user?.id]);
  const hasRole = (role) => {
    const result = userRoles.includes(role);
    log$2(`hasRole(${role}) = ${result}`, { userEmail: user?.email });
    return result;
  };
  const login = async (email, password) => {
    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
      });
      if (error) {
        log$2("Login error", error.message);
        return { success: false, error };
      }
      log$2("Login success", data.user?.email);
      return { success: true, session: data.session };
    } catch (error) {
      return { success: false, error };
    }
  };
  const register = async (email, password) => {
    try {
      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: `${window.location.origin}/`
        }
      });
      if (error) {
        log$2("Register error", error.message);
        return { success: false, error };
      }
      log$2("Register success", data.user?.email);
      return { success: true, data };
    } catch (error) {
      return { success: false, error };
    }
  };
  const resetPassword = async (email) => {
    try {
      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: `${window.location.origin}/auth/reset`
      });
      if (error) {
        log$2("Reset password error", error.message);
        return { success: false, error: error.message };
      }
      log$2("Reset password success");
      return { success: true };
    } catch (error) {
      return { success: false, error: error.message };
    }
  };
  const resendVerificationEmail = async (email) => {
    try {
      const { error } = await supabase.auth.resend({
        type: "signup",
        email,
        options: {
          emailRedirectTo: `${window.location.origin}/`
        }
      });
      if (error) {
        log$2("Resend verification error", error.message);
        return { success: false, error: error.message };
      }
      log$2("Resend verification success");
      return { success: true };
    } catch (error) {
      return { success: false, error: error.message };
    }
  };
  const logout = async () => {
    try {
      setIsLoading(true);
      await supabase.auth.signOut();
      setUser(null);
      setSession(null);
      setUserRoles([]);
      setIsRoleLoading(false);
      cacheSession(null, null);
      sessionStorage.removeItem("hasSeenPostLoginIntro");
      setTimeout(() => {
        setIsLoading(false);
        if ("caches" in window) {
          caches.keys().then((cacheNames) => {
            cacheNames.forEach((cacheName) => {
              caches.delete(cacheName);
            });
          });
        }
        if (window.location.pathname !== "/login" && window.location.pathname !== "/") {
          log$2("Force redirect to login after logout");
          const redirectToLogin = () => {
            try {
              window.location.href = "/login";
            } catch (error) {
              log$2("Fallback redirect method", error);
              window.location.replace("/login");
            }
          };
          redirectToLogin();
        }
      }, 150);
      log$2("Logout completato");
    } catch (error) {
      setIsLoading(false);
    }
  };
  const authContextValue = {
    user,
    session,
    isAuthenticated: !!user,
    isLoading,
    isEmailVerified: user?.email_confirmed_at ? true : false,
    userRole: userRoles[0] || null,
    isRoleLoading,
    getCurrentUser: () => user,
    getAccessToken: () => session?.access_token || null,
    hasRole,
    login,
    register,
    logout,
    resetPassword,
    resendVerificationEmail
  };
  log$2("Context value", {
    isAuthenticated: authContextValue.isAuthenticated,
    isLoading: authContextValue.isLoading,
    userEmail: user?.email,
    rolesCount: userRoles.length});
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AuthContext.Provider, { value: authContextValue, children });
};

const SoundContext = reactExports.createContext(void 0);
const SoundProvider = ({ children }) => {
  const [soundPreference, setSoundPreference] = reactExports.useState("default");
  const [volume, setVolume] = reactExports.useState([75]);
  const [isEnabled, setIsEnabled] = reactExports.useState(true);
  reactExports.useEffect(() => {
    const savedSound = localStorage.getItem("buzzSound");
    if (savedSound) {
      setSoundPreference(savedSound);
    }
    const savedVolume = localStorage.getItem("buzzVolume");
    if (savedVolume) {
      setVolume([Number(savedVolume)]);
    }
    const savedEnabled = localStorage.getItem("soundEnabled");
    if (savedEnabled !== null) {
      setIsEnabled(savedEnabled === "true");
    }
  }, []);
  const updateSound = (sound) => {
    setSoundPreference(sound);
    localStorage.setItem("buzzSound", sound);
  };
  const updateVolume = (newVolume) => {
    setVolume(newVolume);
    localStorage.setItem("buzzVolume", newVolume[0].toString());
  };
  const toggleSound = (enabled) => {
    setIsEnabled(enabled);
    localStorage.setItem("soundEnabled", enabled.toString());
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(SoundContext.Provider, { value: {
    soundPreference,
    volume,
    isEnabled,
    updateSound,
    updateVolume,
    toggleSound
  }, children });
};
const useSound = () => {
  const context = reactExports.useContext(SoundContext);
  if (context === void 0) {
    throw new Error("useSound must be used within a SoundProvider");
  }
  return context;
};

const PUSH_PREFLIGHT_ENABLED = false;
const NEW_PUSH_SUBSCRIBE_FLOW = true;
const DETAILED_ERRORS = false;

const generateErrorId = () => `ERR-${Date.now().toString(36).toUpperCase()}`;
let ErrorBoundary$1 = class ErrorBoundary extends React$1.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasError: false,
      errorMessage: "",
      errorStack: void 0,
      errorId: ""
    };
  }
  static getDerivedStateFromError(error) {
    return {
      hasError: true,
      errorMessage: error.message || "Si  verificato un errore inaspettato",
      errorStack: error.stack,
      errorId: generateErrorId()
    };
  }
  componentDidCatch(error, errorInfo) {
    const errorReport = {
      id: this.state.errorId,
      message: error.message,
      stack: error.stack,
      componentStack: errorInfo.componentStack,
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      url: window.location.href,
      userAgent: navigator.userAgent
    };
    this.props.onError?.(error, errorInfo);
    try {
      const errors = JSON.parse(localStorage.getItem("m1_error_log") || "[]");
      errors.push(errorReport);
      localStorage.setItem("m1_error_log", JSON.stringify(errors.slice(-10)));
    } catch {
    }
  }
  handleRefresh = () => {
    window.location.reload();
  };
  handleReset = () => {
    this.setState({
      hasError: false,
      errorMessage: "",
      errorStack: void 0,
      errorId: ""
    });
  };
  handleGoHome = () => {
    window.location.href = "/";
  };
  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: {
        padding: "20px",
        color: "white",
        backgroundColor: "#070818",
        minHeight: "100vh",
        display: "flex",
        flexDirection: "column",
        alignItems: "center",
        justifyContent: "center",
        fontFamily: "system-ui, -apple-system, sans-serif"
      }, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: {
        maxWidth: "500px",
        textAlign: "center",
        padding: "40px",
        background: "rgba(255,255,255,0.05)",
        borderRadius: "16px",
        border: "1px solid rgba(255,255,255,0.1)"
      }, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontSize: "64px", marginBottom: "20px" }, children: "" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { style: {
          fontSize: "24px",
          fontWeight: "bold",
          marginBottom: "12px",
          color: "#fff"
        }, children: "Oops! Qualcosa  andato storto" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { style: {
          color: "rgba(255,255,255,0.7)",
          marginBottom: "24px",
          lineHeight: "1.5"
        }, children: "L'applicazione ha riscontrato un problema. Puoi provare a ricaricare la pagina o tornare alla home." }),
        DETAILED_ERRORS,
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { style: {
          fontSize: "11px",
          color: "rgba(255,255,255,0.4)",
          marginBottom: "20px"
        }, children: [
          "Codice errore: ",
          this.state.errorId
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { display: "flex", gap: "12px", justifyContent: "center", flexWrap: "wrap" }, children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: this.handleRefresh,
              style: {
                padding: "12px 24px",
                background: "linear-gradient(135deg, #00E5FF, #7C3AED)",
                color: "white",
                border: "none",
                borderRadius: "8px",
                cursor: "pointer",
                fontWeight: "bold",
                fontSize: "14px",
                transition: "transform 0.2s"
              },
              onMouseOver: (e) => e.currentTarget.style.transform = "scale(1.05)",
              onMouseOut: (e) => e.currentTarget.style.transform = "scale(1)",
              children: " Ricarica Pagina"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: this.handleGoHome,
              style: {
                padding: "12px 24px",
                background: "rgba(255,255,255,0.1)",
                color: "white",
                border: "1px solid rgba(255,255,255,0.2)",
                borderRadius: "8px",
                cursor: "pointer",
                fontWeight: "bold",
                fontSize: "14px",
                transition: "transform 0.2s"
              },
              onMouseOver: (e) => e.currentTarget.style.transform = "scale(1.05)",
              onMouseOut: (e) => e.currentTarget.style.transform = "scale(1)",
              children: " Vai alla Home"
            }
          )
        ] })
      ] }) });
    }
    return this.props.children;
  }
};

const useAuthContext = () => {
  const context = reactExports.useContext(AuthContext);
  if (context === void 0) {
    throw new Error("useAuthContext deve essere usato all'interno di un AuthProvider");
  }
  return context;
};

const useXpSystem = () => {
  const { user } = useAuthContext();
  const [xpStatus, setXpStatus] = reactExports.useState({
    total_xp: 0,
    buzz_xp_progress: 0,
    map_xp_progress: 0,
    free_buzz_credit: 0,
    free_buzz_map_credit: 0,
    next_buzz_reward: 100,
    next_map_reward: 250
  });
  const [loading, setLoading] = reactExports.useState(true);
  const [hasNewRewards, setHasNewRewards] = reactExports.useState(false);
  const [newBadge, setNewBadge] = reactExports.useState(null);
  const fetchXpStatus = async () => {
    if (!user?.id) return;
    try {
      const { data, error } = await supabase.rpc("get_user_xp_status", {
        p_user_id: user.id
      });
      if (error) {
        return;
      }
      if (data) {
        const newStatus = data;
        const hadNewBuzzCredit = newStatus.free_buzz_credit > xpStatus.free_buzz_credit;
        const hadNewMapCredit = newStatus.free_buzz_map_credit > xpStatus.free_buzz_map_credit;
        if (hadNewBuzzCredit || hadNewMapCredit) {
          setHasNewRewards(true);
        }
        if (hadNewBuzzCredit) {
          setNewBadge({
            name: "BUZZ Gratuito Sbloccato!",
            description: `Hai guadagnato un BUZZ gratuito! (${newStatus.free_buzz_credit} disponibili)`
          });
        } else if (hadNewMapCredit) {
          setNewBadge({
            name: "BUZZ MAP Gratuito Sbloccato!",
            description: `Hai guadagnato un BUZZ MAP gratuito! (${newStatus.free_buzz_map_credit} disponibili)`
          });
        }
        setXpStatus(newStatus);
      }
    } catch (error) {
    } finally {
      setLoading(false);
    }
  };
  const consumeCredit = async (creditType) => {
    if (!user?.id) return false;
    try {
      const { data, error } = await supabase.rpc("consume_credit", {
        p_user_id: user.id,
        p_credit_type: creditType
      });
      if (error) {
        return false;
      }
      if (data) {
        await fetchXpStatus();
        return true;
      }
      return false;
    } catch (error) {
      return false;
    }
  };
  const markRewardsAsSeen = () => {
    setHasNewRewards(false);
  };
  reactExports.useEffect(() => {
    if (!user?.id) return;
    fetchXpStatus();
    const xpChannel = supabase.channel("user_xp_changes").on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "user_xp",
        filter: `user_id=eq.${user.id}`
      },
      () => {
        fetchXpStatus();
      }
    ).subscribe();
    const creditsChannel = supabase.channel("user_credits_changes").on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "user_credits",
        filter: `user_id=eq.${user.id}`
      },
      () => {
        fetchXpStatus();
      }
    ).subscribe();
    return () => {
      supabase.removeChannel(xpChannel);
      supabase.removeChannel(creditsChannel);
    };
  }, [user?.id]);
  const closeBadgeNotification = () => {
    setNewBadge(null);
  };
  return {
    xpStatus,
    loading,
    hasNewRewards,
    newBadge,
    consumeCredit,
    markRewardsAsSeen,
    closeBadgeNotification,
    refreshXpStatus: fetchXpStatus
  };
};

function r(e){var t,f,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=" "),n+=f);}else for(f in e)e[f]&&(n&&(n+=" "),n+=f);return n}function clsx(){for(var e,t,f=0,n="",o=arguments.length;f<o;f++)(e=arguments[f])&&(t=r(e))&&(n&&(n+=" "),n+=t);return n}

const CLASS_PART_SEPARATOR = '-';
const createClassGroupUtils = config => {
  const classMap = createClassMap(config);
  const {
    conflictingClassGroups,
    conflictingClassGroupModifiers
  } = config;
  const getClassGroupId = className => {
    const classParts = className.split(CLASS_PART_SEPARATOR);
    // Classes like `-inset-1` produce an empty string as first classPart. We assume that classes for negative values are used correctly and remove it from classParts.
    if (classParts[0] === '' && classParts.length !== 1) {
      classParts.shift();
    }
    return getGroupRecursive(classParts, classMap) || getGroupIdForArbitraryProperty(className);
  };
  const getConflictingClassGroupIds = (classGroupId, hasPostfixModifier) => {
    const conflicts = conflictingClassGroups[classGroupId] || [];
    if (hasPostfixModifier && conflictingClassGroupModifiers[classGroupId]) {
      return [...conflicts, ...conflictingClassGroupModifiers[classGroupId]];
    }
    return conflicts;
  };
  return {
    getClassGroupId,
    getConflictingClassGroupIds
  };
};
const getGroupRecursive = (classParts, classPartObject) => {
  if (classParts.length === 0) {
    return classPartObject.classGroupId;
  }
  const currentClassPart = classParts[0];
  const nextClassPartObject = classPartObject.nextPart.get(currentClassPart);
  const classGroupFromNextClassPart = nextClassPartObject ? getGroupRecursive(classParts.slice(1), nextClassPartObject) : undefined;
  if (classGroupFromNextClassPart) {
    return classGroupFromNextClassPart;
  }
  if (classPartObject.validators.length === 0) {
    return undefined;
  }
  const classRest = classParts.join(CLASS_PART_SEPARATOR);
  return classPartObject.validators.find(({
    validator
  }) => validator(classRest))?.classGroupId;
};
const arbitraryPropertyRegex = /^\[(.+)\]$/;
const getGroupIdForArbitraryProperty = className => {
  if (arbitraryPropertyRegex.test(className)) {
    const arbitraryPropertyClassName = arbitraryPropertyRegex.exec(className)[1];
    const property = arbitraryPropertyClassName?.substring(0, arbitraryPropertyClassName.indexOf(':'));
    if (property) {
      // I use two dots here because one dot is used as prefix for class groups in plugins
      return 'arbitrary..' + property;
    }
  }
};
/**
 * Exported for testing only
 */
const createClassMap = config => {
  const {
    theme,
    prefix
  } = config;
  const classMap = {
    nextPart: new Map(),
    validators: []
  };
  const prefixedClassGroupEntries = getPrefixedClassGroupEntries(Object.entries(config.classGroups), prefix);
  prefixedClassGroupEntries.forEach(([classGroupId, classGroup]) => {
    processClassesRecursively(classGroup, classMap, classGroupId, theme);
  });
  return classMap;
};
const processClassesRecursively = (classGroup, classPartObject, classGroupId, theme) => {
  classGroup.forEach(classDefinition => {
    if (typeof classDefinition === 'string') {
      const classPartObjectToEdit = classDefinition === '' ? classPartObject : getPart(classPartObject, classDefinition);
      classPartObjectToEdit.classGroupId = classGroupId;
      return;
    }
    if (typeof classDefinition === 'function') {
      if (isThemeGetter(classDefinition)) {
        processClassesRecursively(classDefinition(theme), classPartObject, classGroupId, theme);
        return;
      }
      classPartObject.validators.push({
        validator: classDefinition,
        classGroupId
      });
      return;
    }
    Object.entries(classDefinition).forEach(([key, classGroup]) => {
      processClassesRecursively(classGroup, getPart(classPartObject, key), classGroupId, theme);
    });
  });
};
const getPart = (classPartObject, path) => {
  let currentClassPartObject = classPartObject;
  path.split(CLASS_PART_SEPARATOR).forEach(pathPart => {
    if (!currentClassPartObject.nextPart.has(pathPart)) {
      currentClassPartObject.nextPart.set(pathPart, {
        nextPart: new Map(),
        validators: []
      });
    }
    currentClassPartObject = currentClassPartObject.nextPart.get(pathPart);
  });
  return currentClassPartObject;
};
const isThemeGetter = func => func.isThemeGetter;
const getPrefixedClassGroupEntries = (classGroupEntries, prefix) => {
  if (!prefix) {
    return classGroupEntries;
  }
  return classGroupEntries.map(([classGroupId, classGroup]) => {
    const prefixedClassGroup = classGroup.map(classDefinition => {
      if (typeof classDefinition === 'string') {
        return prefix + classDefinition;
      }
      if (typeof classDefinition === 'object') {
        return Object.fromEntries(Object.entries(classDefinition).map(([key, value]) => [prefix + key, value]));
      }
      return classDefinition;
    });
    return [classGroupId, prefixedClassGroup];
  });
};

// LRU cache inspired from hashlru (https://github.com/dominictarr/hashlru/blob/v1.0.4/index.js) but object replaced with Map to improve performance
const createLruCache = maxCacheSize => {
  if (maxCacheSize < 1) {
    return {
      get: () => undefined,
      set: () => {}
    };
  }
  let cacheSize = 0;
  let cache = new Map();
  let previousCache = new Map();
  const update = (key, value) => {
    cache.set(key, value);
    cacheSize++;
    if (cacheSize > maxCacheSize) {
      cacheSize = 0;
      previousCache = cache;
      cache = new Map();
    }
  };
  return {
    get(key) {
      let value = cache.get(key);
      if (value !== undefined) {
        return value;
      }
      if ((value = previousCache.get(key)) !== undefined) {
        update(key, value);
        return value;
      }
    },
    set(key, value) {
      if (cache.has(key)) {
        cache.set(key, value);
      } else {
        update(key, value);
      }
    }
  };
};
const IMPORTANT_MODIFIER = '!';
const createParseClassName = config => {
  const {
    separator,
    experimentalParseClassName
  } = config;
  const isSeparatorSingleCharacter = separator.length === 1;
  const firstSeparatorCharacter = separator[0];
  const separatorLength = separator.length;
  // parseClassName inspired by https://github.com/tailwindlabs/tailwindcss/blob/v3.2.2/src/util/splitAtTopLevelOnly.js
  const parseClassName = className => {
    const modifiers = [];
    let bracketDepth = 0;
    let modifierStart = 0;
    let postfixModifierPosition;
    for (let index = 0; index < className.length; index++) {
      let currentCharacter = className[index];
      if (bracketDepth === 0) {
        if (currentCharacter === firstSeparatorCharacter && (isSeparatorSingleCharacter || className.slice(index, index + separatorLength) === separator)) {
          modifiers.push(className.slice(modifierStart, index));
          modifierStart = index + separatorLength;
          continue;
        }
        if (currentCharacter === '/') {
          postfixModifierPosition = index;
          continue;
        }
      }
      if (currentCharacter === '[') {
        bracketDepth++;
      } else if (currentCharacter === ']') {
        bracketDepth--;
      }
    }
    const baseClassNameWithImportantModifier = modifiers.length === 0 ? className : className.substring(modifierStart);
    const hasImportantModifier = baseClassNameWithImportantModifier.startsWith(IMPORTANT_MODIFIER);
    const baseClassName = hasImportantModifier ? baseClassNameWithImportantModifier.substring(1) : baseClassNameWithImportantModifier;
    const maybePostfixModifierPosition = postfixModifierPosition && postfixModifierPosition > modifierStart ? postfixModifierPosition - modifierStart : undefined;
    return {
      modifiers,
      hasImportantModifier,
      baseClassName,
      maybePostfixModifierPosition
    };
  };
  if (experimentalParseClassName) {
    return className => experimentalParseClassName({
      className,
      parseClassName
    });
  }
  return parseClassName;
};
/**
 * Sorts modifiers according to following schema:
 * - Predefined modifiers are sorted alphabetically
 * - When an arbitrary variant appears, it must be preserved which modifiers are before and after it
 */
const sortModifiers = modifiers => {
  if (modifiers.length <= 1) {
    return modifiers;
  }
  const sortedModifiers = [];
  let unsortedModifiers = [];
  modifiers.forEach(modifier => {
    const isArbitraryVariant = modifier[0] === '[';
    if (isArbitraryVariant) {
      sortedModifiers.push(...unsortedModifiers.sort(), modifier);
      unsortedModifiers = [];
    } else {
      unsortedModifiers.push(modifier);
    }
  });
  sortedModifiers.push(...unsortedModifiers.sort());
  return sortedModifiers;
};
const createConfigUtils = config => ({
  cache: createLruCache(config.cacheSize),
  parseClassName: createParseClassName(config),
  ...createClassGroupUtils(config)
});
const SPLIT_CLASSES_REGEX = /\s+/;
const mergeClassList = (classList, configUtils) => {
  const {
    parseClassName,
    getClassGroupId,
    getConflictingClassGroupIds
  } = configUtils;
  /**
   * Set of classGroupIds in following format:
   * `{importantModifier}{variantModifiers}{classGroupId}`
   * @example 'float'
   * @example 'hover:focus:bg-color'
   * @example 'md:!pr'
   */
  const classGroupsInConflict = [];
  const classNames = classList.trim().split(SPLIT_CLASSES_REGEX);
  let result = '';
  for (let index = classNames.length - 1; index >= 0; index -= 1) {
    const originalClassName = classNames[index];
    const {
      modifiers,
      hasImportantModifier,
      baseClassName,
      maybePostfixModifierPosition
    } = parseClassName(originalClassName);
    let hasPostfixModifier = Boolean(maybePostfixModifierPosition);
    let classGroupId = getClassGroupId(hasPostfixModifier ? baseClassName.substring(0, maybePostfixModifierPosition) : baseClassName);
    if (!classGroupId) {
      if (!hasPostfixModifier) {
        // Not a Tailwind class
        result = originalClassName + (result.length > 0 ? ' ' + result : result);
        continue;
      }
      classGroupId = getClassGroupId(baseClassName);
      if (!classGroupId) {
        // Not a Tailwind class
        result = originalClassName + (result.length > 0 ? ' ' + result : result);
        continue;
      }
      hasPostfixModifier = false;
    }
    const variantModifier = sortModifiers(modifiers).join(':');
    const modifierId = hasImportantModifier ? variantModifier + IMPORTANT_MODIFIER : variantModifier;
    const classId = modifierId + classGroupId;
    if (classGroupsInConflict.includes(classId)) {
      // Tailwind class omitted due to conflict
      continue;
    }
    classGroupsInConflict.push(classId);
    const conflictGroups = getConflictingClassGroupIds(classGroupId, hasPostfixModifier);
    for (let i = 0; i < conflictGroups.length; ++i) {
      const group = conflictGroups[i];
      classGroupsInConflict.push(modifierId + group);
    }
    // Tailwind class not in conflict
    result = originalClassName + (result.length > 0 ? ' ' + result : result);
  }
  return result;
};

/**
 * The code in this file is copied from https://github.com/lukeed/clsx and modified to suit the needs of tailwind-merge better.
 *
 * Specifically:
 * - Runtime code from https://github.com/lukeed/clsx/blob/v1.2.1/src/index.js
 * - TypeScript types from https://github.com/lukeed/clsx/blob/v1.2.1/clsx.d.ts
 *
 * Original code has MIT license: Copyright (c) Luke Edwards <luke.edwards05@gmail.com> (lukeed.com)
 */
function twJoin() {
  let index = 0;
  let argument;
  let resolvedValue;
  let string = '';
  while (index < arguments.length) {
    if (argument = arguments[index++]) {
      if (resolvedValue = toValue(argument)) {
        string && (string += ' ');
        string += resolvedValue;
      }
    }
  }
  return string;
}
const toValue = mix => {
  if (typeof mix === 'string') {
    return mix;
  }
  let resolvedValue;
  let string = '';
  for (let k = 0; k < mix.length; k++) {
    if (mix[k]) {
      if (resolvedValue = toValue(mix[k])) {
        string && (string += ' ');
        string += resolvedValue;
      }
    }
  }
  return string;
};
function createTailwindMerge(createConfigFirst, ...createConfigRest) {
  let configUtils;
  let cacheGet;
  let cacheSet;
  let functionToCall = initTailwindMerge;
  function initTailwindMerge(classList) {
    const config = createConfigRest.reduce((previousConfig, createConfigCurrent) => createConfigCurrent(previousConfig), createConfigFirst());
    configUtils = createConfigUtils(config);
    cacheGet = configUtils.cache.get;
    cacheSet = configUtils.cache.set;
    functionToCall = tailwindMerge;
    return tailwindMerge(classList);
  }
  function tailwindMerge(classList) {
    const cachedResult = cacheGet(classList);
    if (cachedResult) {
      return cachedResult;
    }
    const result = mergeClassList(classList, configUtils);
    cacheSet(classList, result);
    return result;
  }
  return function callTailwindMerge() {
    return functionToCall(twJoin.apply(null, arguments));
  };
}
const fromTheme = key => {
  const themeGetter = theme => theme[key] || [];
  themeGetter.isThemeGetter = true;
  return themeGetter;
};
const arbitraryValueRegex = /^\[(?:([a-z-]+):)?(.+)\]$/i;
const fractionRegex = /^\d+\/\d+$/;
const stringLengths = /*#__PURE__*/new Set(['px', 'full', 'screen']);
const tshirtUnitRegex = /^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/;
const lengthUnitRegex = /\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/;
const colorFunctionRegex = /^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/;
// Shadow always begins with x and y offset separated by underscore optionally prepended by inset
const shadowRegex = /^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;
const imageRegex = /^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/;
const isLength = value => isNumber$1(value) || stringLengths.has(value) || fractionRegex.test(value);
const isArbitraryLength = value => getIsArbitraryValue(value, 'length', isLengthOnly);
const isNumber$1 = value => Boolean(value) && !Number.isNaN(Number(value));
const isArbitraryNumber = value => getIsArbitraryValue(value, 'number', isNumber$1);
const isInteger = value => Boolean(value) && Number.isInteger(Number(value));
const isPercent = value => value.endsWith('%') && isNumber$1(value.slice(0, -1));
const isArbitraryValue = value => arbitraryValueRegex.test(value);
const isTshirtSize = value => tshirtUnitRegex.test(value);
const sizeLabels = /*#__PURE__*/new Set(['length', 'size', 'percentage']);
const isArbitrarySize = value => getIsArbitraryValue(value, sizeLabels, isNever);
const isArbitraryPosition = value => getIsArbitraryValue(value, 'position', isNever);
const imageLabels = /*#__PURE__*/new Set(['image', 'url']);
const isArbitraryImage = value => getIsArbitraryValue(value, imageLabels, isImage);
const isArbitraryShadow = value => getIsArbitraryValue(value, '', isShadow);
const isAny = () => true;
const getIsArbitraryValue = (value, label, testValue) => {
  const result = arbitraryValueRegex.exec(value);
  if (result) {
    if (result[1]) {
      return typeof label === 'string' ? result[1] === label : label.has(result[1]);
    }
    return testValue(result[2]);
  }
  return false;
};
const isLengthOnly = value =>
// `colorFunctionRegex` check is necessary because color functions can have percentages in them which which would be incorrectly classified as lengths.
// For example, `hsl(0 0% 0%)` would be classified as a length without this check.
// I could also use lookbehind assertion in `lengthUnitRegex` but that isn't supported widely enough.
lengthUnitRegex.test(value) && !colorFunctionRegex.test(value);
const isNever = () => false;
const isShadow = value => shadowRegex.test(value);
const isImage = value => imageRegex.test(value);
const getDefaultConfig = () => {
  const colors = fromTheme('colors');
  const spacing = fromTheme('spacing');
  const blur = fromTheme('blur');
  const brightness = fromTheme('brightness');
  const borderColor = fromTheme('borderColor');
  const borderRadius = fromTheme('borderRadius');
  const borderSpacing = fromTheme('borderSpacing');
  const borderWidth = fromTheme('borderWidth');
  const contrast = fromTheme('contrast');
  const grayscale = fromTheme('grayscale');
  const hueRotate = fromTheme('hueRotate');
  const invert = fromTheme('invert');
  const gap = fromTheme('gap');
  const gradientColorStops = fromTheme('gradientColorStops');
  const gradientColorStopPositions = fromTheme('gradientColorStopPositions');
  const inset = fromTheme('inset');
  const margin = fromTheme('margin');
  const opacity = fromTheme('opacity');
  const padding = fromTheme('padding');
  const saturate = fromTheme('saturate');
  const scale = fromTheme('scale');
  const sepia = fromTheme('sepia');
  const skew = fromTheme('skew');
  const space = fromTheme('space');
  const translate = fromTheme('translate');
  const getOverscroll = () => ['auto', 'contain', 'none'];
  const getOverflow = () => ['auto', 'hidden', 'clip', 'visible', 'scroll'];
  const getSpacingWithAutoAndArbitrary = () => ['auto', isArbitraryValue, spacing];
  const getSpacingWithArbitrary = () => [isArbitraryValue, spacing];
  const getLengthWithEmptyAndArbitrary = () => ['', isLength, isArbitraryLength];
  const getNumberWithAutoAndArbitrary = () => ['auto', isNumber$1, isArbitraryValue];
  const getPositions = () => ['bottom', 'center', 'left', 'left-bottom', 'left-top', 'right', 'right-bottom', 'right-top', 'top'];
  const getLineStyles = () => ['solid', 'dashed', 'dotted', 'double', 'none'];
  const getBlendModes = () => ['normal', 'multiply', 'screen', 'overlay', 'darken', 'lighten', 'color-dodge', 'color-burn', 'hard-light', 'soft-light', 'difference', 'exclusion', 'hue', 'saturation', 'color', 'luminosity'];
  const getAlign = () => ['start', 'end', 'center', 'between', 'around', 'evenly', 'stretch'];
  const getZeroAndEmpty = () => ['', '0', isArbitraryValue];
  const getBreaks = () => ['auto', 'avoid', 'all', 'avoid-page', 'page', 'left', 'right', 'column'];
  const getNumberAndArbitrary = () => [isNumber$1, isArbitraryValue];
  return {
    cacheSize: 500,
    separator: ':',
    theme: {
      colors: [isAny],
      spacing: [isLength, isArbitraryLength],
      blur: ['none', '', isTshirtSize, isArbitraryValue],
      brightness: getNumberAndArbitrary(),
      borderColor: [colors],
      borderRadius: ['none', '', 'full', isTshirtSize, isArbitraryValue],
      borderSpacing: getSpacingWithArbitrary(),
      borderWidth: getLengthWithEmptyAndArbitrary(),
      contrast: getNumberAndArbitrary(),
      grayscale: getZeroAndEmpty(),
      hueRotate: getNumberAndArbitrary(),
      invert: getZeroAndEmpty(),
      gap: getSpacingWithArbitrary(),
      gradientColorStops: [colors],
      gradientColorStopPositions: [isPercent, isArbitraryLength],
      inset: getSpacingWithAutoAndArbitrary(),
      margin: getSpacingWithAutoAndArbitrary(),
      opacity: getNumberAndArbitrary(),
      padding: getSpacingWithArbitrary(),
      saturate: getNumberAndArbitrary(),
      scale: getNumberAndArbitrary(),
      sepia: getZeroAndEmpty(),
      skew: getNumberAndArbitrary(),
      space: getSpacingWithArbitrary(),
      translate: getSpacingWithArbitrary()
    },
    classGroups: {
      // Layout
      /**
       * Aspect Ratio
       * @see https://tailwindcss.com/docs/aspect-ratio
       */
      aspect: [{
        aspect: ['auto', 'square', 'video', isArbitraryValue]
      }],
      /**
       * Container
       * @see https://tailwindcss.com/docs/container
       */
      container: ['container'],
      /**
       * Columns
       * @see https://tailwindcss.com/docs/columns
       */
      columns: [{
        columns: [isTshirtSize]
      }],
      /**
       * Break After
       * @see https://tailwindcss.com/docs/break-after
       */
      'break-after': [{
        'break-after': getBreaks()
      }],
      /**
       * Break Before
       * @see https://tailwindcss.com/docs/break-before
       */
      'break-before': [{
        'break-before': getBreaks()
      }],
      /**
       * Break Inside
       * @see https://tailwindcss.com/docs/break-inside
       */
      'break-inside': [{
        'break-inside': ['auto', 'avoid', 'avoid-page', 'avoid-column']
      }],
      /**
       * Box Decoration Break
       * @see https://tailwindcss.com/docs/box-decoration-break
       */
      'box-decoration': [{
        'box-decoration': ['slice', 'clone']
      }],
      /**
       * Box Sizing
       * @see https://tailwindcss.com/docs/box-sizing
       */
      box: [{
        box: ['border', 'content']
      }],
      /**
       * Display
       * @see https://tailwindcss.com/docs/display
       */
      display: ['block', 'inline-block', 'inline', 'flex', 'inline-flex', 'table', 'inline-table', 'table-caption', 'table-cell', 'table-column', 'table-column-group', 'table-footer-group', 'table-header-group', 'table-row-group', 'table-row', 'flow-root', 'grid', 'inline-grid', 'contents', 'list-item', 'hidden'],
      /**
       * Floats
       * @see https://tailwindcss.com/docs/float
       */
      float: [{
        float: ['right', 'left', 'none', 'start', 'end']
      }],
      /**
       * Clear
       * @see https://tailwindcss.com/docs/clear
       */
      clear: [{
        clear: ['left', 'right', 'both', 'none', 'start', 'end']
      }],
      /**
       * Isolation
       * @see https://tailwindcss.com/docs/isolation
       */
      isolation: ['isolate', 'isolation-auto'],
      /**
       * Object Fit
       * @see https://tailwindcss.com/docs/object-fit
       */
      'object-fit': [{
        object: ['contain', 'cover', 'fill', 'none', 'scale-down']
      }],
      /**
       * Object Position
       * @see https://tailwindcss.com/docs/object-position
       */
      'object-position': [{
        object: [...getPositions(), isArbitraryValue]
      }],
      /**
       * Overflow
       * @see https://tailwindcss.com/docs/overflow
       */
      overflow: [{
        overflow: getOverflow()
      }],
      /**
       * Overflow X
       * @see https://tailwindcss.com/docs/overflow
       */
      'overflow-x': [{
        'overflow-x': getOverflow()
      }],
      /**
       * Overflow Y
       * @see https://tailwindcss.com/docs/overflow
       */
      'overflow-y': [{
        'overflow-y': getOverflow()
      }],
      /**
       * Overscroll Behavior
       * @see https://tailwindcss.com/docs/overscroll-behavior
       */
      overscroll: [{
        overscroll: getOverscroll()
      }],
      /**
       * Overscroll Behavior X
       * @see https://tailwindcss.com/docs/overscroll-behavior
       */
      'overscroll-x': [{
        'overscroll-x': getOverscroll()
      }],
      /**
       * Overscroll Behavior Y
       * @see https://tailwindcss.com/docs/overscroll-behavior
       */
      'overscroll-y': [{
        'overscroll-y': getOverscroll()
      }],
      /**
       * Position
       * @see https://tailwindcss.com/docs/position
       */
      position: ['static', 'fixed', 'absolute', 'relative', 'sticky'],
      /**
       * Top / Right / Bottom / Left
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      inset: [{
        inset: [inset]
      }],
      /**
       * Right / Left
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      'inset-x': [{
        'inset-x': [inset]
      }],
      /**
       * Top / Bottom
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      'inset-y': [{
        'inset-y': [inset]
      }],
      /**
       * Start
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      start: [{
        start: [inset]
      }],
      /**
       * End
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      end: [{
        end: [inset]
      }],
      /**
       * Top
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      top: [{
        top: [inset]
      }],
      /**
       * Right
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      right: [{
        right: [inset]
      }],
      /**
       * Bottom
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      bottom: [{
        bottom: [inset]
      }],
      /**
       * Left
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      left: [{
        left: [inset]
      }],
      /**
       * Visibility
       * @see https://tailwindcss.com/docs/visibility
       */
      visibility: ['visible', 'invisible', 'collapse'],
      /**
       * Z-Index
       * @see https://tailwindcss.com/docs/z-index
       */
      z: [{
        z: ['auto', isInteger, isArbitraryValue]
      }],
      // Flexbox and Grid
      /**
       * Flex Basis
       * @see https://tailwindcss.com/docs/flex-basis
       */
      basis: [{
        basis: getSpacingWithAutoAndArbitrary()
      }],
      /**
       * Flex Direction
       * @see https://tailwindcss.com/docs/flex-direction
       */
      'flex-direction': [{
        flex: ['row', 'row-reverse', 'col', 'col-reverse']
      }],
      /**
       * Flex Wrap
       * @see https://tailwindcss.com/docs/flex-wrap
       */
      'flex-wrap': [{
        flex: ['wrap', 'wrap-reverse', 'nowrap']
      }],
      /**
       * Flex
       * @see https://tailwindcss.com/docs/flex
       */
      flex: [{
        flex: ['1', 'auto', 'initial', 'none', isArbitraryValue]
      }],
      /**
       * Flex Grow
       * @see https://tailwindcss.com/docs/flex-grow
       */
      grow: [{
        grow: getZeroAndEmpty()
      }],
      /**
       * Flex Shrink
       * @see https://tailwindcss.com/docs/flex-shrink
       */
      shrink: [{
        shrink: getZeroAndEmpty()
      }],
      /**
       * Order
       * @see https://tailwindcss.com/docs/order
       */
      order: [{
        order: ['first', 'last', 'none', isInteger, isArbitraryValue]
      }],
      /**
       * Grid Template Columns
       * @see https://tailwindcss.com/docs/grid-template-columns
       */
      'grid-cols': [{
        'grid-cols': [isAny]
      }],
      /**
       * Grid Column Start / End
       * @see https://tailwindcss.com/docs/grid-column
       */
      'col-start-end': [{
        col: ['auto', {
          span: ['full', isInteger, isArbitraryValue]
        }, isArbitraryValue]
      }],
      /**
       * Grid Column Start
       * @see https://tailwindcss.com/docs/grid-column
       */
      'col-start': [{
        'col-start': getNumberWithAutoAndArbitrary()
      }],
      /**
       * Grid Column End
       * @see https://tailwindcss.com/docs/grid-column
       */
      'col-end': [{
        'col-end': getNumberWithAutoAndArbitrary()
      }],
      /**
       * Grid Template Rows
       * @see https://tailwindcss.com/docs/grid-template-rows
       */
      'grid-rows': [{
        'grid-rows': [isAny]
      }],
      /**
       * Grid Row Start / End
       * @see https://tailwindcss.com/docs/grid-row
       */
      'row-start-end': [{
        row: ['auto', {
          span: [isInteger, isArbitraryValue]
        }, isArbitraryValue]
      }],
      /**
       * Grid Row Start
       * @see https://tailwindcss.com/docs/grid-row
       */
      'row-start': [{
        'row-start': getNumberWithAutoAndArbitrary()
      }],
      /**
       * Grid Row End
       * @see https://tailwindcss.com/docs/grid-row
       */
      'row-end': [{
        'row-end': getNumberWithAutoAndArbitrary()
      }],
      /**
       * Grid Auto Flow
       * @see https://tailwindcss.com/docs/grid-auto-flow
       */
      'grid-flow': [{
        'grid-flow': ['row', 'col', 'dense', 'row-dense', 'col-dense']
      }],
      /**
       * Grid Auto Columns
       * @see https://tailwindcss.com/docs/grid-auto-columns
       */
      'auto-cols': [{
        'auto-cols': ['auto', 'min', 'max', 'fr', isArbitraryValue]
      }],
      /**
       * Grid Auto Rows
       * @see https://tailwindcss.com/docs/grid-auto-rows
       */
      'auto-rows': [{
        'auto-rows': ['auto', 'min', 'max', 'fr', isArbitraryValue]
      }],
      /**
       * Gap
       * @see https://tailwindcss.com/docs/gap
       */
      gap: [{
        gap: [gap]
      }],
      /**
       * Gap X
       * @see https://tailwindcss.com/docs/gap
       */
      'gap-x': [{
        'gap-x': [gap]
      }],
      /**
       * Gap Y
       * @see https://tailwindcss.com/docs/gap
       */
      'gap-y': [{
        'gap-y': [gap]
      }],
      /**
       * Justify Content
       * @see https://tailwindcss.com/docs/justify-content
       */
      'justify-content': [{
        justify: ['normal', ...getAlign()]
      }],
      /**
       * Justify Items
       * @see https://tailwindcss.com/docs/justify-items
       */
      'justify-items': [{
        'justify-items': ['start', 'end', 'center', 'stretch']
      }],
      /**
       * Justify Self
       * @see https://tailwindcss.com/docs/justify-self
       */
      'justify-self': [{
        'justify-self': ['auto', 'start', 'end', 'center', 'stretch']
      }],
      /**
       * Align Content
       * @see https://tailwindcss.com/docs/align-content
       */
      'align-content': [{
        content: ['normal', ...getAlign(), 'baseline']
      }],
      /**
       * Align Items
       * @see https://tailwindcss.com/docs/align-items
       */
      'align-items': [{
        items: ['start', 'end', 'center', 'baseline', 'stretch']
      }],
      /**
       * Align Self
       * @see https://tailwindcss.com/docs/align-self
       */
      'align-self': [{
        self: ['auto', 'start', 'end', 'center', 'stretch', 'baseline']
      }],
      /**
       * Place Content
       * @see https://tailwindcss.com/docs/place-content
       */
      'place-content': [{
        'place-content': [...getAlign(), 'baseline']
      }],
      /**
       * Place Items
       * @see https://tailwindcss.com/docs/place-items
       */
      'place-items': [{
        'place-items': ['start', 'end', 'center', 'baseline', 'stretch']
      }],
      /**
       * Place Self
       * @see https://tailwindcss.com/docs/place-self
       */
      'place-self': [{
        'place-self': ['auto', 'start', 'end', 'center', 'stretch']
      }],
      // Spacing
      /**
       * Padding
       * @see https://tailwindcss.com/docs/padding
       */
      p: [{
        p: [padding]
      }],
      /**
       * Padding X
       * @see https://tailwindcss.com/docs/padding
       */
      px: [{
        px: [padding]
      }],
      /**
       * Padding Y
       * @see https://tailwindcss.com/docs/padding
       */
      py: [{
        py: [padding]
      }],
      /**
       * Padding Start
       * @see https://tailwindcss.com/docs/padding
       */
      ps: [{
        ps: [padding]
      }],
      /**
       * Padding End
       * @see https://tailwindcss.com/docs/padding
       */
      pe: [{
        pe: [padding]
      }],
      /**
       * Padding Top
       * @see https://tailwindcss.com/docs/padding
       */
      pt: [{
        pt: [padding]
      }],
      /**
       * Padding Right
       * @see https://tailwindcss.com/docs/padding
       */
      pr: [{
        pr: [padding]
      }],
      /**
       * Padding Bottom
       * @see https://tailwindcss.com/docs/padding
       */
      pb: [{
        pb: [padding]
      }],
      /**
       * Padding Left
       * @see https://tailwindcss.com/docs/padding
       */
      pl: [{
        pl: [padding]
      }],
      /**
       * Margin
       * @see https://tailwindcss.com/docs/margin
       */
      m: [{
        m: [margin]
      }],
      /**
       * Margin X
       * @see https://tailwindcss.com/docs/margin
       */
      mx: [{
        mx: [margin]
      }],
      /**
       * Margin Y
       * @see https://tailwindcss.com/docs/margin
       */
      my: [{
        my: [margin]
      }],
      /**
       * Margin Start
       * @see https://tailwindcss.com/docs/margin
       */
      ms: [{
        ms: [margin]
      }],
      /**
       * Margin End
       * @see https://tailwindcss.com/docs/margin
       */
      me: [{
        me: [margin]
      }],
      /**
       * Margin Top
       * @see https://tailwindcss.com/docs/margin
       */
      mt: [{
        mt: [margin]
      }],
      /**
       * Margin Right
       * @see https://tailwindcss.com/docs/margin
       */
      mr: [{
        mr: [margin]
      }],
      /**
       * Margin Bottom
       * @see https://tailwindcss.com/docs/margin
       */
      mb: [{
        mb: [margin]
      }],
      /**
       * Margin Left
       * @see https://tailwindcss.com/docs/margin
       */
      ml: [{
        ml: [margin]
      }],
      /**
       * Space Between X
       * @see https://tailwindcss.com/docs/space
       */
      'space-x': [{
        'space-x': [space]
      }],
      /**
       * Space Between X Reverse
       * @see https://tailwindcss.com/docs/space
       */
      'space-x-reverse': ['space-x-reverse'],
      /**
       * Space Between Y
       * @see https://tailwindcss.com/docs/space
       */
      'space-y': [{
        'space-y': [space]
      }],
      /**
       * Space Between Y Reverse
       * @see https://tailwindcss.com/docs/space
       */
      'space-y-reverse': ['space-y-reverse'],
      // Sizing
      /**
       * Width
       * @see https://tailwindcss.com/docs/width
       */
      w: [{
        w: ['auto', 'min', 'max', 'fit', 'svw', 'lvw', 'dvw', isArbitraryValue, spacing]
      }],
      /**
       * Min-Width
       * @see https://tailwindcss.com/docs/min-width
       */
      'min-w': [{
        'min-w': [isArbitraryValue, spacing, 'min', 'max', 'fit']
      }],
      /**
       * Max-Width
       * @see https://tailwindcss.com/docs/max-width
       */
      'max-w': [{
        'max-w': [isArbitraryValue, spacing, 'none', 'full', 'min', 'max', 'fit', 'prose', {
          screen: [isTshirtSize]
        }, isTshirtSize]
      }],
      /**
       * Height
       * @see https://tailwindcss.com/docs/height
       */
      h: [{
        h: [isArbitraryValue, spacing, 'auto', 'min', 'max', 'fit', 'svh', 'lvh', 'dvh']
      }],
      /**
       * Min-Height
       * @see https://tailwindcss.com/docs/min-height
       */
      'min-h': [{
        'min-h': [isArbitraryValue, spacing, 'min', 'max', 'fit', 'svh', 'lvh', 'dvh']
      }],
      /**
       * Max-Height
       * @see https://tailwindcss.com/docs/max-height
       */
      'max-h': [{
        'max-h': [isArbitraryValue, spacing, 'min', 'max', 'fit', 'svh', 'lvh', 'dvh']
      }],
      /**
       * Size
       * @see https://tailwindcss.com/docs/size
       */
      size: [{
        size: [isArbitraryValue, spacing, 'auto', 'min', 'max', 'fit']
      }],
      // Typography
      /**
       * Font Size
       * @see https://tailwindcss.com/docs/font-size
       */
      'font-size': [{
        text: ['base', isTshirtSize, isArbitraryLength]
      }],
      /**
       * Font Smoothing
       * @see https://tailwindcss.com/docs/font-smoothing
       */
      'font-smoothing': ['antialiased', 'subpixel-antialiased'],
      /**
       * Font Style
       * @see https://tailwindcss.com/docs/font-style
       */
      'font-style': ['italic', 'not-italic'],
      /**
       * Font Weight
       * @see https://tailwindcss.com/docs/font-weight
       */
      'font-weight': [{
        font: ['thin', 'extralight', 'light', 'normal', 'medium', 'semibold', 'bold', 'extrabold', 'black', isArbitraryNumber]
      }],
      /**
       * Font Family
       * @see https://tailwindcss.com/docs/font-family
       */
      'font-family': [{
        font: [isAny]
      }],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-normal': ['normal-nums'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-ordinal': ['ordinal'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-slashed-zero': ['slashed-zero'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-figure': ['lining-nums', 'oldstyle-nums'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-spacing': ['proportional-nums', 'tabular-nums'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-fraction': ['diagonal-fractions', 'stacked-fractions'],
      /**
       * Letter Spacing
       * @see https://tailwindcss.com/docs/letter-spacing
       */
      tracking: [{
        tracking: ['tighter', 'tight', 'normal', 'wide', 'wider', 'widest', isArbitraryValue]
      }],
      /**
       * Line Clamp
       * @see https://tailwindcss.com/docs/line-clamp
       */
      'line-clamp': [{
        'line-clamp': ['none', isNumber$1, isArbitraryNumber]
      }],
      /**
       * Line Height
       * @see https://tailwindcss.com/docs/line-height
       */
      leading: [{
        leading: ['none', 'tight', 'snug', 'normal', 'relaxed', 'loose', isLength, isArbitraryValue]
      }],
      /**
       * List Style Image
       * @see https://tailwindcss.com/docs/list-style-image
       */
      'list-image': [{
        'list-image': ['none', isArbitraryValue]
      }],
      /**
       * List Style Type
       * @see https://tailwindcss.com/docs/list-style-type
       */
      'list-style-type': [{
        list: ['none', 'disc', 'decimal', isArbitraryValue]
      }],
      /**
       * List Style Position
       * @see https://tailwindcss.com/docs/list-style-position
       */
      'list-style-position': [{
        list: ['inside', 'outside']
      }],
      /**
       * Placeholder Color
       * @deprecated since Tailwind CSS v3.0.0
       * @see https://tailwindcss.com/docs/placeholder-color
       */
      'placeholder-color': [{
        placeholder: [colors]
      }],
      /**
       * Placeholder Opacity
       * @see https://tailwindcss.com/docs/placeholder-opacity
       */
      'placeholder-opacity': [{
        'placeholder-opacity': [opacity]
      }],
      /**
       * Text Alignment
       * @see https://tailwindcss.com/docs/text-align
       */
      'text-alignment': [{
        text: ['left', 'center', 'right', 'justify', 'start', 'end']
      }],
      /**
       * Text Color
       * @see https://tailwindcss.com/docs/text-color
       */
      'text-color': [{
        text: [colors]
      }],
      /**
       * Text Opacity
       * @see https://tailwindcss.com/docs/text-opacity
       */
      'text-opacity': [{
        'text-opacity': [opacity]
      }],
      /**
       * Text Decoration
       * @see https://tailwindcss.com/docs/text-decoration
       */
      'text-decoration': ['underline', 'overline', 'line-through', 'no-underline'],
      /**
       * Text Decoration Style
       * @see https://tailwindcss.com/docs/text-decoration-style
       */
      'text-decoration-style': [{
        decoration: [...getLineStyles(), 'wavy']
      }],
      /**
       * Text Decoration Thickness
       * @see https://tailwindcss.com/docs/text-decoration-thickness
       */
      'text-decoration-thickness': [{
        decoration: ['auto', 'from-font', isLength, isArbitraryLength]
      }],
      /**
       * Text Underline Offset
       * @see https://tailwindcss.com/docs/text-underline-offset
       */
      'underline-offset': [{
        'underline-offset': ['auto', isLength, isArbitraryValue]
      }],
      /**
       * Text Decoration Color
       * @see https://tailwindcss.com/docs/text-decoration-color
       */
      'text-decoration-color': [{
        decoration: [colors]
      }],
      /**
       * Text Transform
       * @see https://tailwindcss.com/docs/text-transform
       */
      'text-transform': ['uppercase', 'lowercase', 'capitalize', 'normal-case'],
      /**
       * Text Overflow
       * @see https://tailwindcss.com/docs/text-overflow
       */
      'text-overflow': ['truncate', 'text-ellipsis', 'text-clip'],
      /**
       * Text Wrap
       * @see https://tailwindcss.com/docs/text-wrap
       */
      'text-wrap': [{
        text: ['wrap', 'nowrap', 'balance', 'pretty']
      }],
      /**
       * Text Indent
       * @see https://tailwindcss.com/docs/text-indent
       */
      indent: [{
        indent: getSpacingWithArbitrary()
      }],
      /**
       * Vertical Alignment
       * @see https://tailwindcss.com/docs/vertical-align
       */
      'vertical-align': [{
        align: ['baseline', 'top', 'middle', 'bottom', 'text-top', 'text-bottom', 'sub', 'super', isArbitraryValue]
      }],
      /**
       * Whitespace
       * @see https://tailwindcss.com/docs/whitespace
       */
      whitespace: [{
        whitespace: ['normal', 'nowrap', 'pre', 'pre-line', 'pre-wrap', 'break-spaces']
      }],
      /**
       * Word Break
       * @see https://tailwindcss.com/docs/word-break
       */
      break: [{
        break: ['normal', 'words', 'all', 'keep']
      }],
      /**
       * Hyphens
       * @see https://tailwindcss.com/docs/hyphens
       */
      hyphens: [{
        hyphens: ['none', 'manual', 'auto']
      }],
      /**
       * Content
       * @see https://tailwindcss.com/docs/content
       */
      content: [{
        content: ['none', isArbitraryValue]
      }],
      // Backgrounds
      /**
       * Background Attachment
       * @see https://tailwindcss.com/docs/background-attachment
       */
      'bg-attachment': [{
        bg: ['fixed', 'local', 'scroll']
      }],
      /**
       * Background Clip
       * @see https://tailwindcss.com/docs/background-clip
       */
      'bg-clip': [{
        'bg-clip': ['border', 'padding', 'content', 'text']
      }],
      /**
       * Background Opacity
       * @deprecated since Tailwind CSS v3.0.0
       * @see https://tailwindcss.com/docs/background-opacity
       */
      'bg-opacity': [{
        'bg-opacity': [opacity]
      }],
      /**
       * Background Origin
       * @see https://tailwindcss.com/docs/background-origin
       */
      'bg-origin': [{
        'bg-origin': ['border', 'padding', 'content']
      }],
      /**
       * Background Position
       * @see https://tailwindcss.com/docs/background-position
       */
      'bg-position': [{
        bg: [...getPositions(), isArbitraryPosition]
      }],
      /**
       * Background Repeat
       * @see https://tailwindcss.com/docs/background-repeat
       */
      'bg-repeat': [{
        bg: ['no-repeat', {
          repeat: ['', 'x', 'y', 'round', 'space']
        }]
      }],
      /**
       * Background Size
       * @see https://tailwindcss.com/docs/background-size
       */
      'bg-size': [{
        bg: ['auto', 'cover', 'contain', isArbitrarySize]
      }],
      /**
       * Background Image
       * @see https://tailwindcss.com/docs/background-image
       */
      'bg-image': [{
        bg: ['none', {
          'gradient-to': ['t', 'tr', 'r', 'br', 'b', 'bl', 'l', 'tl']
        }, isArbitraryImage]
      }],
      /**
       * Background Color
       * @see https://tailwindcss.com/docs/background-color
       */
      'bg-color': [{
        bg: [colors]
      }],
      /**
       * Gradient Color Stops From Position
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-from-pos': [{
        from: [gradientColorStopPositions]
      }],
      /**
       * Gradient Color Stops Via Position
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-via-pos': [{
        via: [gradientColorStopPositions]
      }],
      /**
       * Gradient Color Stops To Position
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-to-pos': [{
        to: [gradientColorStopPositions]
      }],
      /**
       * Gradient Color Stops From
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-from': [{
        from: [gradientColorStops]
      }],
      /**
       * Gradient Color Stops Via
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-via': [{
        via: [gradientColorStops]
      }],
      /**
       * Gradient Color Stops To
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-to': [{
        to: [gradientColorStops]
      }],
      // Borders
      /**
       * Border Radius
       * @see https://tailwindcss.com/docs/border-radius
       */
      rounded: [{
        rounded: [borderRadius]
      }],
      /**
       * Border Radius Start
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-s': [{
        'rounded-s': [borderRadius]
      }],
      /**
       * Border Radius End
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-e': [{
        'rounded-e': [borderRadius]
      }],
      /**
       * Border Radius Top
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-t': [{
        'rounded-t': [borderRadius]
      }],
      /**
       * Border Radius Right
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-r': [{
        'rounded-r': [borderRadius]
      }],
      /**
       * Border Radius Bottom
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-b': [{
        'rounded-b': [borderRadius]
      }],
      /**
       * Border Radius Left
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-l': [{
        'rounded-l': [borderRadius]
      }],
      /**
       * Border Radius Start Start
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-ss': [{
        'rounded-ss': [borderRadius]
      }],
      /**
       * Border Radius Start End
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-se': [{
        'rounded-se': [borderRadius]
      }],
      /**
       * Border Radius End End
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-ee': [{
        'rounded-ee': [borderRadius]
      }],
      /**
       * Border Radius End Start
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-es': [{
        'rounded-es': [borderRadius]
      }],
      /**
       * Border Radius Top Left
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-tl': [{
        'rounded-tl': [borderRadius]
      }],
      /**
       * Border Radius Top Right
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-tr': [{
        'rounded-tr': [borderRadius]
      }],
      /**
       * Border Radius Bottom Right
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-br': [{
        'rounded-br': [borderRadius]
      }],
      /**
       * Border Radius Bottom Left
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-bl': [{
        'rounded-bl': [borderRadius]
      }],
      /**
       * Border Width
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w': [{
        border: [borderWidth]
      }],
      /**
       * Border Width X
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-x': [{
        'border-x': [borderWidth]
      }],
      /**
       * Border Width Y
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-y': [{
        'border-y': [borderWidth]
      }],
      /**
       * Border Width Start
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-s': [{
        'border-s': [borderWidth]
      }],
      /**
       * Border Width End
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-e': [{
        'border-e': [borderWidth]
      }],
      /**
       * Border Width Top
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-t': [{
        'border-t': [borderWidth]
      }],
      /**
       * Border Width Right
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-r': [{
        'border-r': [borderWidth]
      }],
      /**
       * Border Width Bottom
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-b': [{
        'border-b': [borderWidth]
      }],
      /**
       * Border Width Left
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-l': [{
        'border-l': [borderWidth]
      }],
      /**
       * Border Opacity
       * @see https://tailwindcss.com/docs/border-opacity
       */
      'border-opacity': [{
        'border-opacity': [opacity]
      }],
      /**
       * Border Style
       * @see https://tailwindcss.com/docs/border-style
       */
      'border-style': [{
        border: [...getLineStyles(), 'hidden']
      }],
      /**
       * Divide Width X
       * @see https://tailwindcss.com/docs/divide-width
       */
      'divide-x': [{
        'divide-x': [borderWidth]
      }],
      /**
       * Divide Width X Reverse
       * @see https://tailwindcss.com/docs/divide-width
       */
      'divide-x-reverse': ['divide-x-reverse'],
      /**
       * Divide Width Y
       * @see https://tailwindcss.com/docs/divide-width
       */
      'divide-y': [{
        'divide-y': [borderWidth]
      }],
      /**
       * Divide Width Y Reverse
       * @see https://tailwindcss.com/docs/divide-width
       */
      'divide-y-reverse': ['divide-y-reverse'],
      /**
       * Divide Opacity
       * @see https://tailwindcss.com/docs/divide-opacity
       */
      'divide-opacity': [{
        'divide-opacity': [opacity]
      }],
      /**
       * Divide Style
       * @see https://tailwindcss.com/docs/divide-style
       */
      'divide-style': [{
        divide: getLineStyles()
      }],
      /**
       * Border Color
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color': [{
        border: [borderColor]
      }],
      /**
       * Border Color X
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-x': [{
        'border-x': [borderColor]
      }],
      /**
       * Border Color Y
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-y': [{
        'border-y': [borderColor]
      }],
      /**
       * Border Color S
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-s': [{
        'border-s': [borderColor]
      }],
      /**
       * Border Color E
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-e': [{
        'border-e': [borderColor]
      }],
      /**
       * Border Color Top
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-t': [{
        'border-t': [borderColor]
      }],
      /**
       * Border Color Right
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-r': [{
        'border-r': [borderColor]
      }],
      /**
       * Border Color Bottom
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-b': [{
        'border-b': [borderColor]
      }],
      /**
       * Border Color Left
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-l': [{
        'border-l': [borderColor]
      }],
      /**
       * Divide Color
       * @see https://tailwindcss.com/docs/divide-color
       */
      'divide-color': [{
        divide: [borderColor]
      }],
      /**
       * Outline Style
       * @see https://tailwindcss.com/docs/outline-style
       */
      'outline-style': [{
        outline: ['', ...getLineStyles()]
      }],
      /**
       * Outline Offset
       * @see https://tailwindcss.com/docs/outline-offset
       */
      'outline-offset': [{
        'outline-offset': [isLength, isArbitraryValue]
      }],
      /**
       * Outline Width
       * @see https://tailwindcss.com/docs/outline-width
       */
      'outline-w': [{
        outline: [isLength, isArbitraryLength]
      }],
      /**
       * Outline Color
       * @see https://tailwindcss.com/docs/outline-color
       */
      'outline-color': [{
        outline: [colors]
      }],
      /**
       * Ring Width
       * @see https://tailwindcss.com/docs/ring-width
       */
      'ring-w': [{
        ring: getLengthWithEmptyAndArbitrary()
      }],
      /**
       * Ring Width Inset
       * @see https://tailwindcss.com/docs/ring-width
       */
      'ring-w-inset': ['ring-inset'],
      /**
       * Ring Color
       * @see https://tailwindcss.com/docs/ring-color
       */
      'ring-color': [{
        ring: [colors]
      }],
      /**
       * Ring Opacity
       * @see https://tailwindcss.com/docs/ring-opacity
       */
      'ring-opacity': [{
        'ring-opacity': [opacity]
      }],
      /**
       * Ring Offset Width
       * @see https://tailwindcss.com/docs/ring-offset-width
       */
      'ring-offset-w': [{
        'ring-offset': [isLength, isArbitraryLength]
      }],
      /**
       * Ring Offset Color
       * @see https://tailwindcss.com/docs/ring-offset-color
       */
      'ring-offset-color': [{
        'ring-offset': [colors]
      }],
      // Effects
      /**
       * Box Shadow
       * @see https://tailwindcss.com/docs/box-shadow
       */
      shadow: [{
        shadow: ['', 'inner', 'none', isTshirtSize, isArbitraryShadow]
      }],
      /**
       * Box Shadow Color
       * @see https://tailwindcss.com/docs/box-shadow-color
       */
      'shadow-color': [{
        shadow: [isAny]
      }],
      /**
       * Opacity
       * @see https://tailwindcss.com/docs/opacity
       */
      opacity: [{
        opacity: [opacity]
      }],
      /**
       * Mix Blend Mode
       * @see https://tailwindcss.com/docs/mix-blend-mode
       */
      'mix-blend': [{
        'mix-blend': [...getBlendModes(), 'plus-lighter', 'plus-darker']
      }],
      /**
       * Background Blend Mode
       * @see https://tailwindcss.com/docs/background-blend-mode
       */
      'bg-blend': [{
        'bg-blend': getBlendModes()
      }],
      // Filters
      /**
       * Filter
       * @deprecated since Tailwind CSS v3.0.0
       * @see https://tailwindcss.com/docs/filter
       */
      filter: [{
        filter: ['', 'none']
      }],
      /**
       * Blur
       * @see https://tailwindcss.com/docs/blur
       */
      blur: [{
        blur: [blur]
      }],
      /**
       * Brightness
       * @see https://tailwindcss.com/docs/brightness
       */
      brightness: [{
        brightness: [brightness]
      }],
      /**
       * Contrast
       * @see https://tailwindcss.com/docs/contrast
       */
      contrast: [{
        contrast: [contrast]
      }],
      /**
       * Drop Shadow
       * @see https://tailwindcss.com/docs/drop-shadow
       */
      'drop-shadow': [{
        'drop-shadow': ['', 'none', isTshirtSize, isArbitraryValue]
      }],
      /**
       * Grayscale
       * @see https://tailwindcss.com/docs/grayscale
       */
      grayscale: [{
        grayscale: [grayscale]
      }],
      /**
       * Hue Rotate
       * @see https://tailwindcss.com/docs/hue-rotate
       */
      'hue-rotate': [{
        'hue-rotate': [hueRotate]
      }],
      /**
       * Invert
       * @see https://tailwindcss.com/docs/invert
       */
      invert: [{
        invert: [invert]
      }],
      /**
       * Saturate
       * @see https://tailwindcss.com/docs/saturate
       */
      saturate: [{
        saturate: [saturate]
      }],
      /**
       * Sepia
       * @see https://tailwindcss.com/docs/sepia
       */
      sepia: [{
        sepia: [sepia]
      }],
      /**
       * Backdrop Filter
       * @deprecated since Tailwind CSS v3.0.0
       * @see https://tailwindcss.com/docs/backdrop-filter
       */
      'backdrop-filter': [{
        'backdrop-filter': ['', 'none']
      }],
      /**
       * Backdrop Blur
       * @see https://tailwindcss.com/docs/backdrop-blur
       */
      'backdrop-blur': [{
        'backdrop-blur': [blur]
      }],
      /**
       * Backdrop Brightness
       * @see https://tailwindcss.com/docs/backdrop-brightness
       */
      'backdrop-brightness': [{
        'backdrop-brightness': [brightness]
      }],
      /**
       * Backdrop Contrast
       * @see https://tailwindcss.com/docs/backdrop-contrast
       */
      'backdrop-contrast': [{
        'backdrop-contrast': [contrast]
      }],
      /**
       * Backdrop Grayscale
       * @see https://tailwindcss.com/docs/backdrop-grayscale
       */
      'backdrop-grayscale': [{
        'backdrop-grayscale': [grayscale]
      }],
      /**
       * Backdrop Hue Rotate
       * @see https://tailwindcss.com/docs/backdrop-hue-rotate
       */
      'backdrop-hue-rotate': [{
        'backdrop-hue-rotate': [hueRotate]
      }],
      /**
       * Backdrop Invert
       * @see https://tailwindcss.com/docs/backdrop-invert
       */
      'backdrop-invert': [{
        'backdrop-invert': [invert]
      }],
      /**
       * Backdrop Opacity
       * @see https://tailwindcss.com/docs/backdrop-opacity
       */
      'backdrop-opacity': [{
        'backdrop-opacity': [opacity]
      }],
      /**
       * Backdrop Saturate
       * @see https://tailwindcss.com/docs/backdrop-saturate
       */
      'backdrop-saturate': [{
        'backdrop-saturate': [saturate]
      }],
      /**
       * Backdrop Sepia
       * @see https://tailwindcss.com/docs/backdrop-sepia
       */
      'backdrop-sepia': [{
        'backdrop-sepia': [sepia]
      }],
      // Tables
      /**
       * Border Collapse
       * @see https://tailwindcss.com/docs/border-collapse
       */
      'border-collapse': [{
        border: ['collapse', 'separate']
      }],
      /**
       * Border Spacing
       * @see https://tailwindcss.com/docs/border-spacing
       */
      'border-spacing': [{
        'border-spacing': [borderSpacing]
      }],
      /**
       * Border Spacing X
       * @see https://tailwindcss.com/docs/border-spacing
       */
      'border-spacing-x': [{
        'border-spacing-x': [borderSpacing]
      }],
      /**
       * Border Spacing Y
       * @see https://tailwindcss.com/docs/border-spacing
       */
      'border-spacing-y': [{
        'border-spacing-y': [borderSpacing]
      }],
      /**
       * Table Layout
       * @see https://tailwindcss.com/docs/table-layout
       */
      'table-layout': [{
        table: ['auto', 'fixed']
      }],
      /**
       * Caption Side
       * @see https://tailwindcss.com/docs/caption-side
       */
      caption: [{
        caption: ['top', 'bottom']
      }],
      // Transitions and Animation
      /**
       * Tranisition Property
       * @see https://tailwindcss.com/docs/transition-property
       */
      transition: [{
        transition: ['none', 'all', '', 'colors', 'opacity', 'shadow', 'transform', isArbitraryValue]
      }],
      /**
       * Transition Duration
       * @see https://tailwindcss.com/docs/transition-duration
       */
      duration: [{
        duration: getNumberAndArbitrary()
      }],
      /**
       * Transition Timing Function
       * @see https://tailwindcss.com/docs/transition-timing-function
       */
      ease: [{
        ease: ['linear', 'in', 'out', 'in-out', isArbitraryValue]
      }],
      /**
       * Transition Delay
       * @see https://tailwindcss.com/docs/transition-delay
       */
      delay: [{
        delay: getNumberAndArbitrary()
      }],
      /**
       * Animation
       * @see https://tailwindcss.com/docs/animation
       */
      animate: [{
        animate: ['none', 'spin', 'ping', 'pulse', 'bounce', isArbitraryValue]
      }],
      // Transforms
      /**
       * Transform
       * @see https://tailwindcss.com/docs/transform
       */
      transform: [{
        transform: ['', 'gpu', 'none']
      }],
      /**
       * Scale
       * @see https://tailwindcss.com/docs/scale
       */
      scale: [{
        scale: [scale]
      }],
      /**
       * Scale X
       * @see https://tailwindcss.com/docs/scale
       */
      'scale-x': [{
        'scale-x': [scale]
      }],
      /**
       * Scale Y
       * @see https://tailwindcss.com/docs/scale
       */
      'scale-y': [{
        'scale-y': [scale]
      }],
      /**
       * Rotate
       * @see https://tailwindcss.com/docs/rotate
       */
      rotate: [{
        rotate: [isInteger, isArbitraryValue]
      }],
      /**
       * Translate X
       * @see https://tailwindcss.com/docs/translate
       */
      'translate-x': [{
        'translate-x': [translate]
      }],
      /**
       * Translate Y
       * @see https://tailwindcss.com/docs/translate
       */
      'translate-y': [{
        'translate-y': [translate]
      }],
      /**
       * Skew X
       * @see https://tailwindcss.com/docs/skew
       */
      'skew-x': [{
        'skew-x': [skew]
      }],
      /**
       * Skew Y
       * @see https://tailwindcss.com/docs/skew
       */
      'skew-y': [{
        'skew-y': [skew]
      }],
      /**
       * Transform Origin
       * @see https://tailwindcss.com/docs/transform-origin
       */
      'transform-origin': [{
        origin: ['center', 'top', 'top-right', 'right', 'bottom-right', 'bottom', 'bottom-left', 'left', 'top-left', isArbitraryValue]
      }],
      // Interactivity
      /**
       * Accent Color
       * @see https://tailwindcss.com/docs/accent-color
       */
      accent: [{
        accent: ['auto', colors]
      }],
      /**
       * Appearance
       * @see https://tailwindcss.com/docs/appearance
       */
      appearance: [{
        appearance: ['none', 'auto']
      }],
      /**
       * Cursor
       * @see https://tailwindcss.com/docs/cursor
       */
      cursor: [{
        cursor: ['auto', 'default', 'pointer', 'wait', 'text', 'move', 'help', 'not-allowed', 'none', 'context-menu', 'progress', 'cell', 'crosshair', 'vertical-text', 'alias', 'copy', 'no-drop', 'grab', 'grabbing', 'all-scroll', 'col-resize', 'row-resize', 'n-resize', 'e-resize', 's-resize', 'w-resize', 'ne-resize', 'nw-resize', 'se-resize', 'sw-resize', 'ew-resize', 'ns-resize', 'nesw-resize', 'nwse-resize', 'zoom-in', 'zoom-out', isArbitraryValue]
      }],
      /**
       * Caret Color
       * @see https://tailwindcss.com/docs/just-in-time-mode#caret-color-utilities
       */
      'caret-color': [{
        caret: [colors]
      }],
      /**
       * Pointer Events
       * @see https://tailwindcss.com/docs/pointer-events
       */
      'pointer-events': [{
        'pointer-events': ['none', 'auto']
      }],
      /**
       * Resize
       * @see https://tailwindcss.com/docs/resize
       */
      resize: [{
        resize: ['none', 'y', 'x', '']
      }],
      /**
       * Scroll Behavior
       * @see https://tailwindcss.com/docs/scroll-behavior
       */
      'scroll-behavior': [{
        scroll: ['auto', 'smooth']
      }],
      /**
       * Scroll Margin
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-m': [{
        'scroll-m': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin X
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-mx': [{
        'scroll-mx': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Y
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-my': [{
        'scroll-my': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Start
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-ms': [{
        'scroll-ms': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin End
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-me': [{
        'scroll-me': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Top
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-mt': [{
        'scroll-mt': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Right
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-mr': [{
        'scroll-mr': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Bottom
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-mb': [{
        'scroll-mb': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Left
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-ml': [{
        'scroll-ml': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-p': [{
        'scroll-p': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding X
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-px': [{
        'scroll-px': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Y
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-py': [{
        'scroll-py': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Start
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-ps': [{
        'scroll-ps': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding End
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pe': [{
        'scroll-pe': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Top
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pt': [{
        'scroll-pt': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Right
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pr': [{
        'scroll-pr': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Bottom
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pb': [{
        'scroll-pb': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Left
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pl': [{
        'scroll-pl': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Snap Align
       * @see https://tailwindcss.com/docs/scroll-snap-align
       */
      'snap-align': [{
        snap: ['start', 'end', 'center', 'align-none']
      }],
      /**
       * Scroll Snap Stop
       * @see https://tailwindcss.com/docs/scroll-snap-stop
       */
      'snap-stop': [{
        snap: ['normal', 'always']
      }],
      /**
       * Scroll Snap Type
       * @see https://tailwindcss.com/docs/scroll-snap-type
       */
      'snap-type': [{
        snap: ['none', 'x', 'y', 'both']
      }],
      /**
       * Scroll Snap Type Strictness
       * @see https://tailwindcss.com/docs/scroll-snap-type
       */
      'snap-strictness': [{
        snap: ['mandatory', 'proximity']
      }],
      /**
       * Touch Action
       * @see https://tailwindcss.com/docs/touch-action
       */
      touch: [{
        touch: ['auto', 'none', 'manipulation']
      }],
      /**
       * Touch Action X
       * @see https://tailwindcss.com/docs/touch-action
       */
      'touch-x': [{
        'touch-pan': ['x', 'left', 'right']
      }],
      /**
       * Touch Action Y
       * @see https://tailwindcss.com/docs/touch-action
       */
      'touch-y': [{
        'touch-pan': ['y', 'up', 'down']
      }],
      /**
       * Touch Action Pinch Zoom
       * @see https://tailwindcss.com/docs/touch-action
       */
      'touch-pz': ['touch-pinch-zoom'],
      /**
       * User Select
       * @see https://tailwindcss.com/docs/user-select
       */
      select: [{
        select: ['none', 'text', 'all', 'auto']
      }],
      /**
       * Will Change
       * @see https://tailwindcss.com/docs/will-change
       */
      'will-change': [{
        'will-change': ['auto', 'scroll', 'contents', 'transform', isArbitraryValue]
      }],
      // SVG
      /**
       * Fill
       * @see https://tailwindcss.com/docs/fill
       */
      fill: [{
        fill: [colors, 'none']
      }],
      /**
       * Stroke Width
       * @see https://tailwindcss.com/docs/stroke-width
       */
      'stroke-w': [{
        stroke: [isLength, isArbitraryLength, isArbitraryNumber]
      }],
      /**
       * Stroke
       * @see https://tailwindcss.com/docs/stroke
       */
      stroke: [{
        stroke: [colors, 'none']
      }],
      // Accessibility
      /**
       * Screen Readers
       * @see https://tailwindcss.com/docs/screen-readers
       */
      sr: ['sr-only', 'not-sr-only'],
      /**
       * Forced Color Adjust
       * @see https://tailwindcss.com/docs/forced-color-adjust
       */
      'forced-color-adjust': [{
        'forced-color-adjust': ['auto', 'none']
      }]
    },
    conflictingClassGroups: {
      overflow: ['overflow-x', 'overflow-y'],
      overscroll: ['overscroll-x', 'overscroll-y'],
      inset: ['inset-x', 'inset-y', 'start', 'end', 'top', 'right', 'bottom', 'left'],
      'inset-x': ['right', 'left'],
      'inset-y': ['top', 'bottom'],
      flex: ['basis', 'grow', 'shrink'],
      gap: ['gap-x', 'gap-y'],
      p: ['px', 'py', 'ps', 'pe', 'pt', 'pr', 'pb', 'pl'],
      px: ['pr', 'pl'],
      py: ['pt', 'pb'],
      m: ['mx', 'my', 'ms', 'me', 'mt', 'mr', 'mb', 'ml'],
      mx: ['mr', 'ml'],
      my: ['mt', 'mb'],
      size: ['w', 'h'],
      'font-size': ['leading'],
      'fvn-normal': ['fvn-ordinal', 'fvn-slashed-zero', 'fvn-figure', 'fvn-spacing', 'fvn-fraction'],
      'fvn-ordinal': ['fvn-normal'],
      'fvn-slashed-zero': ['fvn-normal'],
      'fvn-figure': ['fvn-normal'],
      'fvn-spacing': ['fvn-normal'],
      'fvn-fraction': ['fvn-normal'],
      'line-clamp': ['display', 'overflow'],
      rounded: ['rounded-s', 'rounded-e', 'rounded-t', 'rounded-r', 'rounded-b', 'rounded-l', 'rounded-ss', 'rounded-se', 'rounded-ee', 'rounded-es', 'rounded-tl', 'rounded-tr', 'rounded-br', 'rounded-bl'],
      'rounded-s': ['rounded-ss', 'rounded-es'],
      'rounded-e': ['rounded-se', 'rounded-ee'],
      'rounded-t': ['rounded-tl', 'rounded-tr'],
      'rounded-r': ['rounded-tr', 'rounded-br'],
      'rounded-b': ['rounded-br', 'rounded-bl'],
      'rounded-l': ['rounded-tl', 'rounded-bl'],
      'border-spacing': ['border-spacing-x', 'border-spacing-y'],
      'border-w': ['border-w-s', 'border-w-e', 'border-w-t', 'border-w-r', 'border-w-b', 'border-w-l'],
      'border-w-x': ['border-w-r', 'border-w-l'],
      'border-w-y': ['border-w-t', 'border-w-b'],
      'border-color': ['border-color-s', 'border-color-e', 'border-color-t', 'border-color-r', 'border-color-b', 'border-color-l'],
      'border-color-x': ['border-color-r', 'border-color-l'],
      'border-color-y': ['border-color-t', 'border-color-b'],
      'scroll-m': ['scroll-mx', 'scroll-my', 'scroll-ms', 'scroll-me', 'scroll-mt', 'scroll-mr', 'scroll-mb', 'scroll-ml'],
      'scroll-mx': ['scroll-mr', 'scroll-ml'],
      'scroll-my': ['scroll-mt', 'scroll-mb'],
      'scroll-p': ['scroll-px', 'scroll-py', 'scroll-ps', 'scroll-pe', 'scroll-pt', 'scroll-pr', 'scroll-pb', 'scroll-pl'],
      'scroll-px': ['scroll-pr', 'scroll-pl'],
      'scroll-py': ['scroll-pt', 'scroll-pb'],
      touch: ['touch-x', 'touch-y', 'touch-pz'],
      'touch-x': ['touch'],
      'touch-y': ['touch'],
      'touch-pz': ['touch']
    },
    conflictingClassGroupModifiers: {
      'font-size': ['leading']
    }
  };
};
const twMerge = /*#__PURE__*/createTailwindMerge(getDefaultConfig);

function cn(...inputs) {
  return twMerge(clsx(inputs));
}

const Dialog = ({ open, onOpenChange, children }) => {
  const [isOpen, setIsOpen] = reactExports.useState(open || false);
  reactExports.useEffect(() => {
    if (open !== void 0) {
      setIsOpen(open);
    }
  }, [open]);
  const handleOpenChange = (newOpen) => {
    setIsOpen(newOpen);
    onOpenChange?.(newOpen);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: reactExports.Children.map(children, (child) => {
    if (reactExports.isValidElement(child)) {
      return reactExports.cloneElement(child, {
        isOpen,
        onOpenChange: handleOpenChange
      });
    }
    return child;
  }) });
};
const DialogContent = reactExports.forwardRef(
  ({ className, isOpen, onOpenChange, children, ...props }, ref) => {
    if (!isOpen) return null;
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        ref,
        className: cn(
          "relative bg-background rounded-lg shadow-lg max-w-lg w-full max-h-[85vh] overflow-y-auto m1ssion-glass-card",
          className
        ),
        ...props,
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            "button",
            {
              onClick: () => onOpenChange?.(false),
              className: "absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 text-white hover:text-[#00D1FF]",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only", children: "Close" }),
                ""
              ]
            }
          ),
          children
        ]
      }
    ) });
  }
);
DialogContent.displayName = "DialogContent";
const DialogHeader = ({ className, ...props }) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn("flex flex-col space-y-1.5 text-center sm:text-left p-6", className),
    ...props
  }
);
DialogHeader.displayName = "DialogHeader";
const DialogTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "h2",
  {
    ref,
    className: cn("text-lg font-semibold leading-none tracking-tight gradient-text-cyan", className),
    ...props
  }
));
DialogTitle.displayName = "DialogTitle";
const DialogDescription = reactExports.forwardRef(({ className, asChild, children, ...props }, ref) => {
  const Comp = asChild ? "div" : "p";
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Comp,
    {
      ref,
      className: cn("text-sm text-white/70", className),
      ...props,
      children
    }
  );
});
DialogDescription.displayName = "DialogDescription";
const DialogFooter = ({ className, ...props }) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 p-6 pt-0",
      className
    ),
    ...props
  }
);
DialogFooter.displayName = "DialogFooter";
const DialogClose = ({ asChild, children, ...props }) => {
  const Comp = asChild ? "span" : "button";
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Comp, { ...props, children });
};
DialogClose.displayName = "DialogClose";

const falsyToString = (value)=>typeof value === "boolean" ? `${value}` : value === 0 ? "0" : value;
const cx = clsx;
const cva = (base, config)=>(props)=>{
        var _config_compoundVariants;
        if ((config === null || config === void 0 ? void 0 : config.variants) == null) return cx(base, props === null || props === void 0 ? void 0 : props.class, props === null || props === void 0 ? void 0 : props.className);
        const { variants, defaultVariants } = config;
        const getVariantClassNames = Object.keys(variants).map((variant)=>{
            const variantProp = props === null || props === void 0 ? void 0 : props[variant];
            const defaultVariantProp = defaultVariants === null || defaultVariants === void 0 ? void 0 : defaultVariants[variant];
            if (variantProp === null) return null;
            const variantKey = falsyToString(variantProp) || falsyToString(defaultVariantProp);
            return variants[variant][variantKey];
        });
        const propsWithoutUndefined = props && Object.entries(props).reduce((acc, param)=>{
            let [key, value] = param;
            if (value === undefined) {
                return acc;
            }
            acc[key] = value;
            return acc;
        }, {});
        const getCompoundVariantClassNames = config === null || config === void 0 ? void 0 : (_config_compoundVariants = config.compoundVariants) === null || _config_compoundVariants === void 0 ? void 0 : _config_compoundVariants.reduce((acc, param)=>{
            let { class: cvClass, className: cvClassName, ...compoundVariantOptions } = param;
            return Object.entries(compoundVariantOptions).every((param)=>{
                let [key, value] = param;
                return Array.isArray(value) ? value.includes({
                    ...defaultVariants,
                    ...propsWithoutUndefined
                }[key]) : ({
                    ...defaultVariants,
                    ...propsWithoutUndefined
                })[key] === value;
            }) ? [
                ...acc,
                cvClass,
                cvClassName
            ] : acc;
        }, []);
        return cx(base, getVariantClassNames, getCompoundVariantClassNames, props === null || props === void 0 ? void 0 : props.class, props === null || props === void 0 ? void 0 : props.className);
    };

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 btn-hover-effect",
  {
    variants: {
      variant: {
        default: "bg-gradient-to-r from-[#7B2EFF] to-[#00D1FF] text-white hover:shadow-[0_0_15px_rgba(0,209,255,0.5)] hover:scale-[1.03]",
        destructive: "bg-gradient-to-r from-red-500 to-red-700 text-white hover:shadow-[0_0_15px_rgba(239,68,68,0.5)] hover:scale-[1.03]",
        outline: "border border-[#00D1FF]/30 hover:border-[#00D1FF]/70 bg-black/30 hover:bg-black/50 text-white",
        secondary: "bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-[0_0_15px_rgba(217,70,239,0.5)] hover:scale-[1.03]",
        ghost: "hover:bg-white/10 hover:text-[#00D1FF] text-white",
        link: "text-[#00D1FF] underline-offset-4 hover:underline hover:brightness-125",
        accent: "bg-gradient-to-r from-yellow-400 to-orange-500 text-black hover:shadow-[0_0_15px_rgba(250,204,21,0.5)] hover:scale-[1.03]"
      },
      size: {
        default: "h-10 px-6 py-2 rounded-full",
        sm: "h-9 rounded-full px-4",
        lg: "h-11 rounded-full px-8",
        icon: "h-10 w-10 rounded-full"
      }
    },
    defaultVariants: {
      variant: "default",
      size: "default"
    }
  }
);
const Button = reactExports.forwardRef(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? "span" : "button";
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Comp,
      {
        className: cn(buttonVariants({ variant, size, className })),
        ref,
        ...props
      }
    );
  }
);
Button.displayName = "Button";

const __vite_import_meta_env__ = {"BASE_URL": "/", "DEV": false, "MODE": "production", "PROD": true, "SSR": false, "VITE_ANALYTICS_ID": "your_analytics_id_here", "VITE_APP_ENV": "development", "VITE_APP_SECRET": "your_app_secret_here", "VITE_BUILD_ID": "build-mizzito4", "VITE_CAPACITOR_BUILD": "false", "VITE_CONTOUR_URL": "https://api.maptiler.com/tiles/contours/{z}/{x}/{y}.pbf?key=VRJaVKMtkFdyVzhXCjBF", "VITE_DEBUG_MODE": "true", "VITE_ENABLE_LIVING_MAP": "true", "VITE_LIVING_MAP_USE_MOCK": "false", "VITE_MAP3D_DEV_MOCKS": "false", "VITE_MAPBOX_TOKEN": "your_mapbox_token_here", "VITE_MAPTILER_KEY_DEV": "gw2gQRfg512G0yw3DbWn", "VITE_MAPTILER_KEY_PROD": "M2JlRFvsxjcMvVXw1HN1", "VITE_MISSION_START_DATE": "2024-01-01", "VITE_PUSH_SAFE_MODE": "1", "VITE_PWA_VERSION": "2025.01.18.001", "VITE_STRIPE_PUBLISHABLE_KEY": "pk_live_51QJWtNRp5StPxarejrEVvghG3FX5h1jm4Cj3b1DsHaIyhlQcSZeFWwhLy60ke87bD0nxaXkuc1fEgCaYsOzKk7wJ00HI7zz7h3", "VITE_SUPABASE_ANON_KEY": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk", "VITE_SUPABASE_PROJECT_ID": "vkjrqirvdvjbemsfzxof", "VITE_SUPABASE_PUBLISHABLE_KEY": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk", "VITE_SUPABASE_URL": "https://vkjrqirvdvjbemsfzxof.supabase.co", "VITE_TERRAIN_URL": "https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=VRJaVKMtkFdyVzhXCjBF", "VITE_VAPID_PUBLIC_KEY": "BBjgzWK_1_PBZXGLQb-xQjSEUH5jLsNNgx8N0LgOcKUkZeCUaNV_gRE-QM5pKS2bPKUhVJLn0Q-H3BNGnOOjy8Q"};
const DEFAULT_PERIODS = {
  "xp-reward": 24,
  "ios-permission": 24,
  "cookie-consent": 8760,
  // 1 year
  "first-login-quiz": 8760
  // 1 year
};
function getPopupPeriod(id) {
  try {
    const localOverride = localStorage.getItem(`m1:popup:${id}:hours`);
    if (localOverride) {
      const parsed = parseInt(localOverride, 10);
      if (!isNaN(parsed) && parsed > 0) {
        return parsed;
      }
    }
    const envKey = `VITE_POPUP_${id.toUpperCase().replace(/-/g, "_")}_HOURS`;
    const envValue = __vite_import_meta_env__?.[envKey];
    if (envValue) {
      const parsed = parseInt(envValue, 10);
      if (!isNaN(parsed) && parsed > 0) {
        return parsed;
      }
    }
    return DEFAULT_PERIODS[id] || 24;
  } catch (error) {
    return DEFAULT_PERIODS[id] || 24;
  }
}

const STORAGE_KEY$2 = "m1:popup:stats";
const DISABLE_KEY = "m1:popup:stats:disable";
const MAX_EVENTS = 100;
let eventLog = [];
function isDisabled() {
  try {
    return localStorage.getItem(DISABLE_KEY) === "1";
  } catch {
    return false;
  }
}
function logPopupEvent(id, action, reason) {
  if (isDisabled()) return;
  try {
    const event = {
      id,
      timestamp: Date.now(),
      action,
      reason
    };
    eventLog.push(event);
    if (eventLog.length > MAX_EVENTS) {
      eventLog = eventLog.slice(-MAX_EVENTS);
    }
    const stats = getPopupStats();
    const popupStats = stats[id] || {
      id,
      shownCount: 0,
      blockedCount: 0,
      dismissedCount: 0
    };
    if (action === "shown") {
      popupStats.shownCount++;
      popupStats.lastShown = event.timestamp;
      if (!popupStats.firstSeen) {
        popupStats.firstSeen = event.timestamp;
      }
    } else if (action === "blocked") {
      popupStats.blockedCount++;
      popupStats.lastBlocked = event.timestamp;
    } else if (action === "dismissed") {
      popupStats.dismissedCount++;
    }
    stats[id] = popupStats;
    localStorage.setItem(STORAGE_KEY$2, JSON.stringify(stats));
    if (false) ;
  } catch (error) {
  }
}
function getPopupStats() {
  try {
    const stored = localStorage.getItem(STORAGE_KEY$2);
    return stored ? JSON.parse(stored) : {};
  } catch (error) {
    return {};
  }
}
function getRecentEvents(limit = 50) {
  return eventLog.slice(-limit);
}
function exportStatsToConsole() {
  getPopupStats();
  getRecentEvents();
}
if (typeof window !== "undefined") {
  window.m1PopupStats = exportStatsToConsole;
}

function shouldShow(id, periodHours) {
  try {
    const effectivePeriod = periodHours ?? getPopupPeriod(id);
    syncFromUserMetadata(id);
    const key = `m1:last:${id}`;
    const lastShown = localStorage.getItem(key);
    if (!lastShown) {
      logPopupEvent(id, "shown", "first-time");
      return true;
    }
    const lastTimestamp = parseInt(lastShown, 10);
    if (isNaN(lastTimestamp)) {
      logPopupEvent(id, "shown", "invalid-timestamp");
      return true;
    }
    const hoursSinceLastShow = (Date.now() - lastTimestamp) / (1e3 * 60 * 60);
    const canShow = hoursSinceLastShow >= effectivePeriod;
    if (canShow) {
      logPopupEvent(id, "shown", `period-elapsed-${hoursSinceLastShow.toFixed(1)}h`);
    } else {
      logPopupEvent(id, "blocked", `${(effectivePeriod - hoursSinceLastShow).toFixed(1)}h-remaining`);
    }
    return canShow;
  } catch (error) {
    logPopupEvent(id, "shown", "error-fallback");
    return true;
  }
}
function markShown(id) {
  try {
    const key = `m1:last:${id}`;
    const timestamp = Date.now().toString();
    localStorage.setItem(key, timestamp);
    syncToUserMetadata(id, parseInt(timestamp, 10)).catch(() => {
    });
  } catch (error) {
  }
}
async function syncToUserMetadata(id, timestamp) {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return;
    const currentMetadata = user.user_metadata || {};
    const m1PopupLastSeen = currentMetadata.m1_popup_lastSeen || {};
    if (!m1PopupLastSeen[id] || timestamp > m1PopupLastSeen[id]) {
      await supabase.auth.updateUser({
        data: {
          m1_popup_lastSeen: {
            ...m1PopupLastSeen,
            [id]: timestamp
          }
        }
      });
    }
  } catch (error) {
  }
}
function syncFromUserMetadata(id) {
  try {
    const key = `m1:last:${id}`;
    const localTimestamp = localStorage.getItem(key);
    const localValue = localTimestamp ? parseInt(localTimestamp, 10) : 0;
    supabase.auth.getUser().then(({ data: { user } }) => {
      if (!user) return;
      const m1PopupLastSeen = user.user_metadata?.m1_popup_lastSeen;
      if (!m1PopupLastSeen || !m1PopupLastSeen[id]) return;
      const remoteValue = m1PopupLastSeen[id];
      if (remoteValue > localValue) {
        localStorage.setItem(key, remoteValue.toString());
      }
    }).catch(() => {
    });
  } catch (error) {
  }
}

const XpRewardModal = ({
  open,
  onOpenChange,
  freeBuzzCredits,
  freeBuzzMapCredits,
  onRedirectToBuzz,
  onRedirectToBuzzMap
}) => {
  const canShowModal = shouldShow("xp-reward", 24);
  reactExports.useEffect(() => {
    if (open && canShowModal) {
      markShown("xp-reward");
    }
  }, [open, canShowModal]);
  const handleBuzzRedirect = () => {
    onOpenChange(false);
    onRedirectToBuzz();
  };
  const handleBuzzMapRedirect = () => {
    onOpenChange(false);
    onRedirectToBuzzMap();
  };
  if (!canShowModal) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "max-w-md mx-auto bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f172a] border border-cyan-500/20", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          initial: { scale: 0.8, opacity: 0 },
          animate: { scale: 1, opacity: 1 },
          transition: { duration: 0.5 },
          className: "flex items-center justify-center mb-4",
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Gift, { className: "w-16 h-16 text-yellow-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "absolute -top-2 -right-2 w-6 h-6 text-yellow-300" })
          ] })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-2xl font-bold gradient-text mb-2", children: " BADGE SBLOCCATO!" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 text-sm", children: "Hai guadagnato ricompense gratuite! Clicca per riscattare." })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3 py-4", children: [
      freeBuzzCredits > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: handleBuzzRedirect,
          className: "w-full flex items-center justify-between p-4 bg-gradient-to-r from-purple-900/60 to-purple-700/60 rounded-xl border-2 border-purple-500/50 hover:border-purple-400 hover:scale-[1.02] transition-all duration-200 cursor-pointer",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-purple-600/70 rounded-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-6 h-6 text-yellow-300" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-left", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-bold text-lg text-white", children: "BUZZ Gratuito Sbloccato!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-purple-200", children: [
                  "Hai guadagnato un BUZZ gratuito (",
                  freeBuzzCredits,
                  " disponibili)"
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-3xl", children: "" })
          ]
        }
      ),
      freeBuzzMapCredits > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: handleBuzzMapRedirect,
          className: "w-full flex items-center justify-between p-4 bg-gradient-to-r from-cyan-900/60 to-cyan-700/60 rounded-xl border-2 border-cyan-500/50 hover:border-cyan-400 hover:scale-[1.02] transition-all duration-200 cursor-pointer",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-cyan-600/70 rounded-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-6 h-6 text-yellow-300" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-left", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-bold text-lg text-white", children: "BUZZ MAPPA Gratuito Sbloccato!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-cyan-200", children: [
                  "Hai guadagnato un BUZZ MAPPA gratuito (",
                  freeBuzzMapCredits,
                  " disponibili)"
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-3xl", children: "" })
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center pt-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        onClick: () => onOpenChange(false),
        variant: "ghost",
        size: "sm",
        className: "text-gray-400 hover:text-gray-200",
        children: "Chiudi"
      }
    ) })
  ] }) });
};

const CreditConfirmModal = ({
  open,
  onOpenChange,
  creditType,
  onConfirm,
  onCancel
}) => {
  const creditInfo = {
    buzz: {
      icon: Zap,
      title: "Buzz Gratuito",
      description: "Utilizzare un Buzz gratuito ottenuto tramite XP?",
      color: "purple",
      gradientFrom: "from-purple-900/40",
      gradientTo: "to-purple-700/40",
      borderColor: "border-purple-500/30",
      textColor: "text-purple-200",
      buttonBg: "bg-purple-600/20",
      buttonBorder: "border-purple-500/50",
      buttonHover: "hover:bg-purple-600/40"
    },
    buzz_map: {
      icon: MapPin,
      title: "Buzz Mappa Gratuito",
      description: "Utilizzare un Buzz Mappa gratuito ottenuto tramite XP?",
      color: "cyan",
      gradientFrom: "from-cyan-900/40",
      gradientTo: "to-cyan-700/40",
      borderColor: "border-cyan-500/30",
      textColor: "text-cyan-200",
      buttonBg: "bg-cyan-600/20",
      buttonBorder: "border-cyan-500/50",
      buttonHover: "hover:bg-cyan-600/40"
    }
  };
  const currentCredit = creditType ? creditInfo[creditType] : null;
  if (!currentCredit) return null;
  const Icon = currentCredit.icon;
  const handleConfirm = () => {
    onConfirm();
    onOpenChange(false);
  };
  const handleCancel = () => {
    onCancel();
    onOpenChange(false);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "max-w-sm mx-auto bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f172a] border border-cyan-500/20", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          initial: { scale: 0.8, opacity: 0 },
          animate: { scale: 1, opacity: 1 },
          transition: { duration: 0.5 },
          className: "flex items-center justify-center mb-4",
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `p-4 bg-gradient-to-r ${currentCredit.gradientFrom} ${currentCredit.gradientTo} rounded-full border ${currentCredit.borderColor}`, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "w-12 h-12 text-white" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                animate: {
                  scale: [1, 1.3, 1],
                  rotate: [0, 180, 360]
                },
                transition: {
                  duration: 2,
                  repeat: Infinity,
                  repeatType: "loop"
                },
                className: "absolute -top-1 -right-1",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-6 h-6 text-yellow-400" })
              }
            )
          ] })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogTitle, { className: "text-xl font-bold gradient-text mb-2", children: [
        " ",
        currentCredit.title
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 text-sm", children: currentCredit.description })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { y: 20, opacity: 0 },
        animate: { y: 0, opacity: 1 },
        transition: { delay: 0.2 },
        className: `p-4 bg-gradient-to-r ${currentCredit.gradientFrom} ${currentCredit.gradientTo} rounded-lg border ${currentCredit.borderColor} mb-4`,
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `p-2 ${currentCredit.buttonBg} rounded-full`, children: /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-5 h-5 text-green-400" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: `font-semibold ${currentCredit.textColor}`, children: "Credito XP" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400", children: "Ottenuto tramite sistema XP" })
          ] })
        ] })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex space-x-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: handleCancel,
          variant: "outline",
          className: "flex-1 bg-gray-700/50 border-gray-600/50 text-gray-300 hover:bg-gray-700/80",
          children: "Annulla"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: handleConfirm,
          className: `flex-1 ${currentCredit.buttonBg} ${currentCredit.buttonBorder} ${currentCredit.textColor} ${currentCredit.buttonHover} border`,
          children: "Conferma"
        }
      )
    ] })
  ] }) });
};

const XpSystemManager = ({
  onCreditAvailable,
  onRequestCreditConsumption
}) => {
  const { xpStatus, hasNewRewards, markRewardsAsSeen, consumeCredit } = useXpSystem();
  const [, setLocation] = useLocation();
  const [rewardModalOpen, setRewardModalOpen] = reactExports.useState(false);
  const [consumedThisSession, setConsumedThisSession] = reactExports.useState(false);
  const [creditConfirmModal, setCreditConfirmModal] = reactExports.useState({
    open: false,
    type: null
  });
  reactExports.useEffect(() => {
    if (hasNewRewards && !consumedThisSession && (xpStatus.free_buzz_credit > 0 || xpStatus.free_buzz_map_credit > 0)) {
      setRewardModalOpen(true);
    }
  }, [hasNewRewards, xpStatus.free_buzz_credit, xpStatus.free_buzz_map_credit, consumedThisSession]);
  reactExports.useEffect(() => {
    if (onCreditAvailable) {
      onCreditAvailable("buzz", xpStatus.free_buzz_credit > 0);
      onCreditAvailable("buzz_map", xpStatus.free_buzz_map_credit > 0);
    }
  }, [xpStatus.free_buzz_credit, xpStatus.free_buzz_map_credit, onCreditAvailable]);
  reactExports.useEffect(() => {
  }, [onRequestCreditConsumption]);
  const handleRedirectToBuzz = () => {
    markRewardsAsSeen();
    setConsumedThisSession(true);
    setRewardModalOpen(false);
    setLocation("/buzz?free=1&reward=1");
  };
  const handleRedirectToBuzzMap = () => {
    markRewardsAsSeen();
    setConsumedThisSession(true);
    setRewardModalOpen(false);
    setLocation("/map?free=1&reward=1");
  };
  const handleCreditConfirm = async () => {
    if (creditConfirmModal.type && creditConfirmModal.resolve) {
      const success = await consumeCredit(creditConfirmModal.type);
      creditConfirmModal.resolve(success);
      setCreditConfirmModal({ open: false, type: null });
    }
  };
  const handleCreditCancel = () => {
    if (creditConfirmModal.resolve) {
      creditConfirmModal.resolve(false);
    }
    setCreditConfirmModal({ open: false, type: null });
  };
  const requestCreditConsumption = async (creditType) => {
    return new Promise((resolve) => {
      setCreditConfirmModal({
        open: true,
        type: creditType,
        resolve
      });
    });
  };
  React$1.useImperativeHandle(React$1.createRef(), () => ({
    requestCreditConsumption
  }), []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      XpRewardModal,
      {
        open: rewardModalOpen,
        onOpenChange: setRewardModalOpen,
        freeBuzzCredits: xpStatus.free_buzz_credit,
        freeBuzzMapCredits: xpStatus.free_buzz_map_credit,
        onRedirectToBuzz: handleRedirectToBuzz,
        onRedirectToBuzzMap: handleRedirectToBuzzMap
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      CreditConfirmModal,
      {
        open: creditConfirmModal.open,
        onOpenChange: (open) => !open && handleCreditCancel(),
        creditType: creditConfirmModal.type,
        onConfirm: handleCreditConfirm,
        onCancel: handleCreditCancel
      }
    )
  ] });
};

const DynamicIslandContext = reactExports.createContext(null);
const ARTWORK_URLS = [
  { src: "/icons/icon-m1-192x192.png", sizes: "192x192", type: "image/png" },
  { src: "/icons/icon-m1-512x512.png", sizes: "512x512", type: "image/png" },
  { src: "/icons/128.png", sizes: "128x128", type: "image/png" },
  { src: "/icons/512.png", sizes: "512x512", type: "image/png" }
];
const generateSilentAudio = () => {
  const sampleRate = 44100;
  const duration = 1;
  const numSamples = sampleRate * duration;
  const numChannels = 1;
  const bitsPerSample = 16;
  const bytesPerSample = bitsPerSample / 8;
  const blockAlign = numChannels * bytesPerSample;
  const byteRate = sampleRate * blockAlign;
  const dataSize = numSamples * blockAlign;
  const fileSize = 36 + dataSize;
  const buffer = new ArrayBuffer(44 + dataSize);
  const view = new DataView(buffer);
  const writeString = (offset, str) => {
    for (let i = 0; i < str.length; i++) {
      view.setUint8(offset + i, str.charCodeAt(i));
    }
  };
  writeString(0, "RIFF");
  view.setUint32(4, fileSize, true);
  writeString(8, "WAVE");
  writeString(12, "fmt ");
  view.setUint32(16, 16, true);
  view.setUint16(20, 1, true);
  view.setUint16(22, numChannels, true);
  view.setUint32(24, sampleRate, true);
  view.setUint32(28, byteRate, true);
  view.setUint16(32, blockAlign, true);
  view.setUint16(34, bitsPerSample, true);
  writeString(36, "data");
  view.setUint32(40, dataSize, true);
  for (let i = 0; i < numSamples; i++) {
    const sample = Math.sin(2 * Math.PI * 100 * i / sampleRate) * 1;
    view.setInt16(44 + i * bytesPerSample, sample, true);
  }
  const bytes = new Uint8Array(buffer);
  let binary = "";
  for (let i = 0; i < bytes.byteLength; i++) {
    binary += String.fromCharCode(bytes[i]);
  }
  return "data:audio/wav;base64," + btoa(binary);
};
const generatePageContent = (page, data) => {
  switch (page) {
    case "home":
      return {
        title: ` Indizi: ${data.cluesFound ?? 0}/${data.totalClues ?? 200}`,
        subtitle: ` ${data.daysRemaining ?? 25} giorni rimanenti`
      };
    case "buzz-map":
      return {
        title: ` BUZZ MAP - ${data.buzzCost ?? 0} M1U`,
        subtitle: ` ${data.rewardsAvailable ?? 0}/${data.totalRewards ?? 99} Rewards`
      };
    case "buzz":
      const buzzDisplay = data.buzzCost === 0 ? "GRATIS" : `${data.buzzCost} M1U`;
      return {
        title: ` BUZZ - ${buzzDisplay}`,
        subtitle: data.lastBuzzResult || ` Rileva posizione!`
      };
    case "intelligence":
      return {
        title: ` AION ${data.aionStatus === "active" ? "ATTIVO" : "PRONTO"}`,
        subtitle: ` L'Oracolo M1SSION`
      };
    case "notifications":
      return {
        title: ` ${data.unreadCount ?? 0} Notifiche`,
        subtitle: ` Messaggi da HQ`
      };
    case "leaderboard":
      const change = data.positionChange ? data.positionChange > 0 ? `${data.positionChange}` : `${Math.abs(data.positionChange)}` : "";
      return {
        title: ` #${data.currentPosition ?? "?"} ${change}`,
        subtitle: ` Classifica`
      };
    case "profile":
      return {
        title: ` Profilo Agente`,
        subtitle: ` M1SSION Agent`
      };
    default:
      return {
        title: ` M1SSION ATTIVA`,
        subtitle: ` Trova il tesoro!`
      };
  }
};
const DynamicIslandProvider = ({ children }) => {
  const [isActive, setIsActive] = reactExports.useState(false);
  const currentPageRef = reactExports.useRef("default");
  const pageDataRef = reactExports.useRef({});
  const audioRef = reactExports.useRef(null);
  const updateMediaSession = reactExports.useCallback((page, data) => {
    if (!("mediaSession" in navigator)) return;
    try {
      const content = generatePageContent(page, data);
      navigator.mediaSession.metadata = new MediaMetadata({
        title: content.title,
        artist: "M1SSION",
        album: content.subtitle,
        artwork: ARTWORK_URLS
      });
      navigator.mediaSession.playbackState = "playing";
    } catch (error) {
    }
  }, []);
  const createAudioElement = reactExports.useCallback(() => {
    if (audioRef.current) return;
    try {
      const audio = new Audio();
      audio.src = generateSilentAudio();
      audio.loop = true;
      audio.volume = 1e-3;
      audioRef.current = audio;
      if ("mediaSession" in navigator) {
        navigator.mediaSession.setActionHandler("play", () => {
          audioRef.current?.play();
        });
        navigator.mediaSession.setActionHandler("pause", () => {
          audioRef.current?.pause();
        });
      }
    } catch (error) {
    }
  }, []);
  const activate = reactExports.useCallback(async (initialData) => {
    try {
      createAudioElement();
      if (initialData) {
        pageDataRef.current = { ...pageDataRef.current, ...initialData };
      }
      if (audioRef.current) {
        await audioRef.current.play();
      }
      updateMediaSession(currentPageRef.current, pageDataRef.current);
      setIsActive(true);
    } catch (error) {
    }
  }, [createAudioElement, updateMediaSession]);
  const deactivate = reactExports.useCallback(() => {
    try {
      if (audioRef.current) {
        audioRef.current.pause();
        audioRef.current.currentTime = 0;
      }
      if ("mediaSession" in navigator) {
        navigator.mediaSession.playbackState = "paused";
      }
      setIsActive(false);
    } catch (error) {
    }
  }, []);
  const setPage = reactExports.useCallback((page, data) => {
    currentPageRef.current = page;
    if (data) {
      pageDataRef.current = { ...pageDataRef.current, ...data };
    }
    if (audioRef.current && !audioRef.current.paused) {
      updateMediaSession(page, pageDataRef.current);
    }
  }, [updateMediaSession]);
  const updateData = reactExports.useCallback((newData) => {
    pageDataRef.current = { ...pageDataRef.current, ...newData };
    if (audioRef.current && !audioRef.current.paused) {
      updateMediaSession(currentPageRef.current, pageDataRef.current);
    }
  }, [updateMediaSession]);
  const updateStatus = reactExports.useCallback((status) => {
    updateData({
      cluesFound: status.cluesFound,
      totalClues: status.totalClues,
      daysRemaining: status.daysRemaining
    });
  }, [updateData]);
  const showMessage = reactExports.useCallback((title, subtitle) => {
    if (!("mediaSession" in navigator)) return;
    if (!audioRef.current || audioRef.current.paused) return;
    navigator.mediaSession.metadata = new MediaMetadata({
      title,
      artist: "M1SSION",
      album: subtitle || "",
      artwork: ARTWORK_URLS
    });
  }, []);
  const value = reactExports.useMemo(() => ({
    isActive,
    activate,
    deactivate,
    setPage,
    updateData,
    updateStatus,
    showMessage
  }), [isActive, activate, deactivate, setPage, updateData, updateStatus, showMessage]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(DynamicIslandContext.Provider, { value, children });
};
const useDynamicIsland = () => {
  const context = reactExports.useContext(DynamicIslandContext);
  if (!context) {
    return {
      isActive: false,
      activate: async () => {
      },
      deactivate: () => {
      },
      setPage: () => {
      },
      updateData: () => {
      },
      updateStatus: () => {
      },
      showMessage: () => {
      },
      // Legacy aliases
      isDynamicIslandActive: false,
      activateDynamicIsland: async () => {
      },
      deactivateDynamicIsland: () => {
      }
    };
  }
  return {
    ...context,
    // Legacy aliases
    isDynamicIslandActive: context.isActive,
    activateDynamicIsland: context.activate,
    deactivateDynamicIsland: context.deactivate
  };
};

const useAuthSessionManager = () => {
  const [user, setUser] = reactExports.useState(null);
  const [session, setSession] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const forceSessionFromTokens = async (accessToken, refreshToken) => {
    try {
      if (refreshToken && accessToken) {
        const sessionData = await supabase.auth.setSession({
          access_token: accessToken,
          refresh_token: refreshToken
        });
        if (!sessionData.error && sessionData.data?.session) {
          setSession(sessionData.data.session);
          setUser(sessionData.data.session.user);
          const sessionBackup = {
            access_token: accessToken,
            refresh_token: refreshToken,
            expires_at: sessionData.data.session.expires_at,
            user: sessionData.data.session.user,
            created_at: Date.now(),
            source: "enhanced_developer_auto_login",
            version: "2.0"
          };
          localStorage.setItem(getAuthTokenKey(), JSON.stringify(sessionBackup));
          return true;
        } else {
        }
      }
      try {
        const tokenParts = accessToken.split(".");
        let tokenPayload = {};
        if (tokenParts.length === 3) {
          try {
            const base64Payload = tokenParts[1].replace(/-/g, "+").replace(/_/g, "/");
            const padding = base64Payload.length % 4;
            const paddedPayload = base64Payload + "=".repeat(padding ? 4 - padding : 0);
            tokenPayload = JSON.parse(atob(paddedPayload));
          } catch (decodeError) {
          }
        }
        const manualSession = {
          access_token: accessToken,
          refresh_token: refreshToken || `enhanced_refresh_${Date.now()}`,
          expires_in: 3600,
          expires_at: tokenPayload.exp || Math.floor(Date.now() / 1e3) + 3600,
          token_type: "bearer",
          user: {
            id: tokenPayload.sub || `enhanced_user_${Date.now()}`,
            email: tokenPayload.email || "wikus77@hotmail.it",
            email_confirmed_at: tokenPayload.email_confirmed_at || (/* @__PURE__ */ new Date()).toISOString(),
            confirmed_at: tokenPayload.confirmed_at || (/* @__PURE__ */ new Date()).toISOString(),
            last_sign_in_at: (/* @__PURE__ */ new Date()).toISOString(),
            app_metadata: {
              provider: "enhanced_developer_login",
              providers: ["enhanced_developer_login"],
              ...tokenPayload.app_metadata
            },
            user_metadata: {
              enhanced_auto_login: true,
              login_method: "developer_session_force",
              ...tokenPayload.user_metadata
            },
            aud: tokenPayload.aud || "authenticated",
            created_at: tokenPayload.created_at || (/* @__PURE__ */ new Date()).toISOString(),
            updated_at: (/* @__PURE__ */ new Date()).toISOString(),
            role: tokenPayload.role || "authenticated"
          }
        };
        setSession(manualSession);
        setUser(manualSession.user);
        const sessionBackup = {
          ...manualSession,
          created_at: Date.now(),
          source: "manual_construction_enhanced",
          version: "2.0",
          diagnostics: {
            tokenLength: accessToken.length,
            hasRefreshToken: !!refreshToken,
            jwtDecoded: tokenParts.length === 3,
            timestamp: (/* @__PURE__ */ new Date()).toISOString()
          }
        };
        localStorage.setItem(getAuthTokenKey(), JSON.stringify(sessionBackup));
        return true;
      } catch (constructionError) {
        return false;
      }
    } catch (error) {
      return false;
    }
  };
  const clearSession = async () => {
    setSession(null);
    setUser(null);
    localStorage.removeItem(getAuthTokenKey());
    try {
      await supabase.auth.signOut();
    } catch (error) {
    }
  };
  reactExports.useEffect(() => {
    const initializeSession = async () => {
      try {
        const { data: { session: session2 }, error } = await supabase.auth.getSession();
        if (!error && session2 && session2.user) {
          setSession(session2);
          setUser(session2.user);
          setIsLoading(false);
          return;
        }
        const storedSession = localStorage.getItem(getAuthTokenKey());
        if (storedSession) {
          try {
            const parsedSession = JSON.parse(storedSession);
            const now = Math.floor(Date.now() / 1e3);
            const isExpired = parsedSession.expires_at && parsedSession.expires_at <= now;
            if (!isExpired && parsedSession.user && parsedSession.access_token) {
              setSession(parsedSession);
              setUser(parsedSession.user);
              if (parsedSession.access_token && parsedSession.refresh_token) {
                setTimeout(() => {
                  supabase.auth.setSession({
                    access_token: parsedSession.access_token,
                    refresh_token: parsedSession.refresh_token
                  }).then((result) => {
                  }).catch((err) => void 0);
                }, 1e3);
              }
            } else {
              localStorage.removeItem(getAuthTokenKey());
            }
          } catch (parseError) {
            localStorage.removeItem(getAuthTokenKey());
          }
        }
      } catch (error) {
      } finally {
        setIsLoading(false);
      }
    };
    initializeSession();
    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session2) => {
      if (session2 && session2.user) {
        setSession(session2);
        setUser(session2.user);
        const sessionBackup = {
          ...session2,
          created_at: Date.now(),
          source: "auth_state_change_enhanced",
          version: "2.0",
          event_type: event
        };
        localStorage.setItem(getAuthTokenKey(), JSON.stringify(sessionBackup));
      } else if (event === "SIGNED_OUT") {
        await clearSession();
      }
    });
    return () => subscription.unsubscribe();
  }, []);
  return {
    user,
    session,
    isAuthenticated: !!session && !!user,
    isLoading,
    forceSessionFromTokens,
    clearSession
  };
};

const useAuth = () => {
  const sessionManager = useAuthSessionManager();
  const login = async (email, password) => {
    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
      });
      if (error) {
        return { success: false, error };
      }
      if (data.session) {
        await sessionManager.forceSessionFromTokens(
          data.session.access_token,
          data.session.refresh_token
        );
        return { success: true, session: data.session };
      }
      return { success: false, error: { message: "No session created" } };
    } catch (error) {
      return { success: false, error };
    }
  };
  const register = async (email, password) => {
    try {
      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: `${window.location.origin}/`
        }
      });
      if (error) {
        return { success: false, error };
      }
      return { success: true, data };
    } catch (error) {
      return { success: false, error };
    }
  };
  const logout = async () => {
    const quizSkipKey = "m1_quiz_last_skip";
    const quizSkipValue = localStorage.getItem(quizSkipKey);
    localStorage.clear();
    sessionStorage.clear();
    if (quizSkipValue) {
      localStorage.setItem(quizSkipKey, quizSkipValue);
    }
    try {
      const mapStoreModule = await __vitePreload(() => import('./mapStore.DJ51G-DA.js'),true?__vite__mapDeps([0,1,2,3]):void 0).catch(() => null);
      if (mapStoreModule?.useMapStore) {
        const store = mapStoreModule.useMapStore.getState();
        store.resetMapState?.();
      }
    } catch (e) {
    }
    await supabase.auth.signOut();
    await sessionManager.clearSession();
  };
  const resetPassword = async (email) => {
    try {
      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: `${window.location.origin}/auth/reset`
      });
      if (error) {
        return { success: false, error: error.message };
      }
      return { success: true };
    } catch (error) {
      return { success: false, error: error.message };
    }
  };
  const resendVerificationEmail = async (email) => {
    try {
      const { error } = await supabase.auth.resend({
        type: "signup",
        email,
        options: {
          emailRedirectTo: `${window.location.origin}/`
        }
      });
      if (error) {
        return { success: false, error: error.message };
      }
      return { success: true };
    } catch (error) {
      return { success: false, error: error.message };
    }
  };
  const updateProfile = async (data) => {
  };
  return {
    user: sessionManager.user,
    session: sessionManager.session,
    isAuthenticated: sessionManager.isAuthenticated,
    isLoading: sessionManager.isLoading,
    isEmailVerified: sessionManager.user?.email_confirmed_at ? true : false,
    login,
    register,
    logout,
    resetPassword,
    resendVerificationEmail,
    updateProfile,
    getCurrentUser: () => sessionManager.user,
    getAccessToken: () => sessionManager.session?.access_token || ""
  };
};

const useMissionStatus = () => {
  const [missionStatus, setMissionStatus] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const { user } = useAuth();
  const loadMissionStatus = async () => {
    if (!user) {
      setLoading(false);
      return;
    }
    try {
      setLoading(true);
      setError(null);
      const { data: activeMissionData, error: missionFetchError } = await supabase.from("current_mission_data").select("id, mission_name, mission_status, mission_started_at, mission_ends_at").eq("is_active", true).order("created_at", { ascending: false }).limit(1).maybeSingle();
      if (missionFetchError && missionFetchError.code !== "PGRST116" && missionFetchError.code !== "406" && missionFetchError.code !== "42P01") {
      }
      const missionId = activeMissionData?.id || "M001";
      const missionTitle = activeMissionData?.mission_name || "MISSIONE IN CORSO";
      const { count: userCluesCount, error: cluesError } = await supabase.from("user_clues").select("*", { count: "exact", head: true }).eq("user_id", user.id);
      if (cluesError) {
      }
      const { count: buzzNotificationsCount, error: notifError } = await supabase.from("user_notifications").select("*", { count: "exact", head: true }).eq("user_id", user.id).eq("type", "buzz");
      if (notifError) {
      }
      const { data: buzzMapActions, error: buzzMapError } = await supabase.from("buzz_map_actions").select("clue_count").eq("user_id", user.id);
      if (buzzMapError) {
      }
      const buzzMapCluesCount = buzzMapActions?.reduce((sum, a) => sum + (a.clue_count || 0), 0) || 0;
      const realCluesCount = Math.max(
        userCluesCount || 0,
        buzzNotificationsCount || 0,
        buzzMapCluesCount
      );
      const actualProgress = Math.round(realCluesCount / 250 * 100);
      const { data: userMissionData, error: missionError } = await supabase.from("user_mission_status").select("*").eq("user_id", user.id).single();
      if (missionError && missionError.code !== "PGRST116") {
        setError("Errore nel caricamento dello stato missione");
        return;
      }
      if (!userMissionData) {
        const { data: newMissionData, error: insertError } = await supabase.from("user_mission_status").insert({
          user_id: user.id,
          clues_found: 0,
          mission_progress_percent: 0,
          mission_started_at: (/* @__PURE__ */ new Date()).toISOString(),
          mission_days_remaining: 30,
          buzz_counter: 0,
          map_radius_km: null,
          map_area_generated: false
        }).select().single();
        if (insertError) {
          setError("Errore nella creazione dello stato missione");
          return;
        }
        const missionStart = new Date(newMissionData.mission_started_at);
        const now = /* @__PURE__ */ new Date();
        const daysPassed = Math.floor((now.getTime() - missionStart.getTime()) / (1e3 * 60 * 60 * 24));
        const daysRemaining = Math.max(0, 30 - daysPassed);
        const { error: updateError } = await supabase.from("user_mission_status").update({
          clues_found: realCluesCount,
          mission_progress_percent: actualProgress
        }).eq("user_id", user.id);
        if (updateError) {
        }
        setMissionStatus({
          id: missionId,
          title: missionTitle,
          state: daysRemaining > 0 ? "ATTIVA" : "SCADUTA",
          startDate: missionStart,
          daysRemaining,
          totalDays: 30,
          cluesFound: realCluesCount,
          totalClues: 250,
          progressPercent: actualProgress
        });
      } else {
        const missionStart = new Date(userMissionData.mission_started_at);
        const now = /* @__PURE__ */ new Date();
        const daysPassed = Math.floor((now.getTime() - missionStart.getTime()) / (1e3 * 60 * 60 * 24));
        const daysRemaining = Math.max(0, 30 - daysPassed);
        if ((userMissionData.clues_found || 0) !== realCluesCount) {
          const { error: updateError } = await supabase.from("user_mission_status").update({
            clues_found: realCluesCount,
            mission_progress_percent: actualProgress
          }).eq("user_id", user.id);
          if (updateError) {
          }
        }
        setMissionStatus({
          id: missionId,
          title: missionTitle,
          state: daysRemaining > 0 ? "ATTIVA" : "SCADUTA",
          startDate: missionStart,
          daysRemaining,
          totalDays: 30,
          cluesFound: realCluesCount,
          totalClues: 250,
          progressPercent: actualProgress
        });
      }
    } catch (err) {
      setError("Errore di connessione");
    } finally {
      setLoading(false);
    }
  };
  reactExports.useEffect(() => {
    if (!user) return;
    loadMissionStatus();
    const subscription = supabase.channel("mission_status_realtime").on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "user_clues",
        filter: `user_id=eq.${user.id}`
      },
      () => {
        loadMissionStatus();
      }
    ).on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "user_notifications",
        filter: `user_id=eq.${user.id}`
      },
      (payload) => {
        if (payload.new?.type === "buzz" || payload.old?.type === "buzz") {
          loadMissionStatus();
        }
      }
    ).on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "buzz_map_actions",
        filter: `user_id=eq.${user.id}`
      },
      () => {
        loadMissionStatus();
      }
    ).on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "user_mission_status",
        filter: `user_id=eq.${user.id}`
      },
      () => {
        loadMissionStatus();
      }
    ).subscribe();
    return () => {
      subscription.unsubscribe();
    };
  }, [user]);
  reactExports.useEffect(() => {
    if (!missionStatus) return;
    const interval = setInterval(() => {
      const missionStart = missionStatus.startDate;
      const now = /* @__PURE__ */ new Date();
      const daysPassed = Math.floor((now.getTime() - missionStart.getTime()) / (1e3 * 60 * 60 * 24));
      const daysRemaining = Math.max(0, 30 - daysPassed);
      if (daysRemaining !== missionStatus.daysRemaining) {
        setMissionStatus((prev) => prev ? {
          ...prev,
          daysRemaining,
          state: daysRemaining > 0 ? "ATTIVA" : "SCADUTA"
        } : null);
      }
    }, 6e4);
    return () => clearInterval(interval);
  }, [missionStatus]);
  return {
    missionStatus,
    loading,
    error,
    reload: loadMissionStatus
  };
};

const DynamicIslandAutoActivator = () => {
  const { isActive, activate, updateData, deactivate } = useDynamicIsland();
  const { missionStatus } = useMissionStatus();
  const { user } = useAuth();
  const hasActivatedRef = reactExports.useRef(false);
  const activationAttemptedRef = reactExports.useRef(false);
  reactExports.useEffect(() => {
    if (!user) {
      if (isActive) {
        deactivate();
      }
      hasActivatedRef.current = false;
      activationAttemptedRef.current = false;
      return;
    }
    if (hasActivatedRef.current) return;
    const handleFirstInteraction = async () => {
      if (hasActivatedRef.current || activationAttemptedRef.current) return;
      activationAttemptedRef.current = true;
      try {
        const initialData = missionStatus ? {
          cluesFound: missionStatus.cluesFound,
          totalClues: missionStatus.totalClues,
          daysRemaining: missionStatus.daysRemaining
        } : {
          cluesFound: 0,
          totalClues: 200,
          daysRemaining: 25
        };
        await activate(initialData);
        hasActivatedRef.current = true;
        document.removeEventListener("click", handleFirstInteraction);
        document.removeEventListener("touchstart", handleFirstInteraction);
      } catch (error) {
        activationAttemptedRef.current = false;
      }
    };
    document.addEventListener("click", handleFirstInteraction, { once: true });
    document.addEventListener("touchstart", handleFirstInteraction, { once: true });
    return () => {
      document.removeEventListener("click", handleFirstInteraction);
      document.removeEventListener("touchstart", handleFirstInteraction);
    };
  }, [user, activate, missionStatus, isActive, deactivate]);
  reactExports.useEffect(() => {
    if (isActive && missionStatus) {
      updateData({
        cluesFound: missionStatus.cluesFound,
        totalClues: missionStatus.totalClues,
        daysRemaining: missionStatus.daysRemaining
      });
    }
  }, [isActive, missionStatus, updateData]);
  return null;
};

const HAPTIC_PATTERNS = {
  light: 10,
  // Tap leggero
  medium: 25,
  // Conferma
  heavy: 50,
  // Azione importante
  success: [30, 50, 30, 50, 50],
  // Pattern successo 
  error: [50, 30, 50, 30, 100],
  // Pattern errore 
  warning: [30, 50, 30],
  // Pattern warning 
  notification: [50, 100, 50]
  // Pattern notifica 
};
const isVibrationSupported = () => {
  return typeof navigator !== "undefined" && "vibrate" in navigator;
};
const isHapticsEnabled = () => {
  if (typeof localStorage === "undefined") return true;
  const setting = localStorage.getItem("m1_haptics_enabled");
  return setting !== "false";
};
const haptic = (type = "light") => {
  try {
    if (!isVibrationSupported() || !isHapticsEnabled()) {
      return false;
    }
    const pattern = HAPTIC_PATTERNS[type];
    navigator.vibrate(pattern);
    return true;
  } catch (error) {
    return false;
  }
};
const hapticLight = () => haptic("light");
const hapticMedium = () => haptic("medium");
const hapticHeavy = () => haptic("heavy");
const hapticSuccess = () => haptic("success");
const hapticError = () => haptic("error");
const hapticWarning = () => haptic("warning");
const hapticNotification = () => haptic("notification");
const setHapticsEnabled = (enabled) => {
  if (typeof localStorage !== "undefined") {
    localStorage.setItem("m1_haptics_enabled", String(enabled));
  }
};
const getHapticsEnabled = () => {
  return isHapticsEnabled();
};
const toggleHaptics = () => {
  const newState = !isHapticsEnabled();
  setHapticsEnabled(newState);
  if (newState) {
    haptic("light");
  }
  return newState;
};
const hapticCustom = (pattern) => {
  try {
    if (!isVibrationSupported() || !isHapticsEnabled()) {
      return false;
    }
    navigator.vibrate(pattern);
    return true;
  } catch {
    return false;
  }
};
const hapticStop = () => {
  try {
    if (isVibrationSupported()) {
      navigator.vibrate(0);
    }
  } catch {
  }
};
const hapticManager = {
  trigger: (type = "light") => {
    if (type === "selection") return haptic("light");
    return haptic(type);
  },
  light: hapticLight,
  medium: hapticMedium,
  heavy: hapticHeavy,
  success: hapticSuccess,
  error: hapticError,
  warning: hapticWarning,
  notification: hapticNotification,
  custom: hapticCustom,
  stop: hapticStop,
  setEnabled: setHapticsEnabled,
  getEnabled: getHapticsEnabled,
  toggle: toggleHaptics,
  isSupported: isVibrationSupported
};

function useRealtimeLeaderboard(options = {}) {
  const {
    scope = "global",
    filterValue,
    limit = 50,
    enableNotifications = true
  } = options;
  const { user } = useAuthContext();
  const [leaderboard, setLeaderboard] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const [currentUserRank, setCurrentUserRank] = reactExports.useState(null);
  const [lastOvertake, setLastOvertake] = reactExports.useState(null);
  const previousRankRef = reactExports.useRef(null);
  const channelRef = reactExports.useRef(null);
  const fetchLeaderboard = reactExports.useCallback(async () => {
    try {
      setLoading(true);
      setError(null);
      let data = [];
      const { data: rpcData, error: rpcError } = await supabase.rpc("get_leaderboard", {
        p_scope: scope,
        p_filter_value: filterValue || null,
        p_limit: limit
      });
      if (rpcError) {
        let query = supabase.from("profiles").select(`
            id,
            agent_code,
            full_name,
            avatar_url,
            city,
            region,
            country,
            subscription_plan,
            current_streak_days,
            pulse_energy,
            m1_units
          `).not("agent_code", "is", null).order("pulse_energy", { ascending: false }).limit(limit);
        if (scope === "city" && filterValue) {
          query = query.eq("city", filterValue);
        } else if (scope === "region" && filterValue) {
          query = query.eq("region", filterValue);
        } else if (scope === "country" && filterValue) {
          query = query.eq("country", filterValue);
        }
        const { data: profiles, error: profilesError } = await query;
        if (profilesError) throw profilesError;
        const userIds = profiles?.map((p) => p.id) || [];
        const { data: cluesData } = await supabase.from("user_clues").select("user_id").in("user_id", userIds);
        const cluesCount = {};
        cluesData?.forEach((c) => {
          cluesCount[c.user_id] = (cluesCount[c.user_id] || 0) + 1;
        });
        const { data: buzzData } = await supabase.from("user_buzz_counter").select("user_id, buzz_count").in("user_id", userIds);
        const buzzCount = {};
        buzzData?.forEach((b) => {
          buzzCount[b.user_id] = (buzzCount[b.user_id] || 0) + (b.buzz_count || 0);
        });
        data = (profiles || []).map((profile, index) => {
          const clues = cluesCount[profile.id] || 0;
          const buzz = buzzCount[profile.id] || 0;
          const score = (profile.pulse_energy || 0) * 2 + clues * 10 + buzz * 5 + (profile.current_streak_days || 0) * 3;
          return {
            id: profile.id,
            agent_code: profile.agent_code,
            full_name: profile.full_name,
            avatar_url: profile.avatar_url,
            city: profile.city,
            region: profile.region,
            country: profile.country,
            subscription_plan: profile.subscription_plan,
            streak_days: profile.current_streak_days || 0,
            pulse_energy: profile.pulse_energy || 0,
            m1_units: profile.m1_units || 0,
            clues_unlocked: clues,
            buzz_used: buzz,
            total_score: score,
            rank: index + 1
          };
        }).sort((a, b) => b.total_score - a.total_score).map((u, i) => ({ ...u, rank: i + 1 }));
      } else {
        data = rpcData || [];
      }
      const enrichedData = data.map((u) => ({
        ...u,
        isCurrentUser: u.id === user?.id,
        change: 0
        // Real change tracking would require storing position history
      }));
      setLeaderboard(enrichedData);
      if (user) {
        const currentUser = enrichedData.find((u) => u.id === user.id);
        if (currentUser) {
          setCurrentUserRank(currentUser);
          if (previousRankRef.current !== null && currentUser.rank > previousRankRef.current && enableNotifications) {
            const overtaker = enrichedData.find((u) => u.rank === previousRankRef.current);
            if (overtaker && !overtaker.isCurrentUser) {
              hapticWarning();
              setLastOvertake({ name: overtaker.full_name || overtaker.agent_code, rank: overtaker.rank });
              ue.warning(` ${overtaker.full_name || overtaker.agent_code} ti ha superato!`, {
                description: `Ora sei #${currentUser.rank} in classifica`,
                duration: 5e3
              });
            }
          }
          previousRankRef.current = currentUser.rank;
        }
      }
    } catch (err) {
      setError(err.message || "Errore nel caricamento");
    } finally {
      setLoading(false);
    }
  }, [scope, filterValue, limit, user, enableNotifications]);
  reactExports.useEffect(() => {
    fetchLeaderboard();
    channelRef.current = supabase.channel("leaderboard-realtime").on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "profiles"
    }, () => {
      setTimeout(fetchLeaderboard, 1e3);
    }).on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "user_clues"
    }, () => {
      setTimeout(fetchLeaderboard, 1e3);
    }).subscribe();
    const refreshInterval = setInterval(fetchLeaderboard, 3e4);
    return () => {
      if (channelRef.current) {
        supabase.removeChannel(channelRef.current);
      }
      clearInterval(refreshInterval);
    };
  }, [fetchLeaderboard]);
  const getFilterOptions = reactExports.useCallback(async (type) => {
    const { data, error: error2 } = await supabase.from("profiles").select(type).not(type, "is", null).limit(100);
    if (error2) return [];
    const unique = [...new Set(data?.map((d) => d[type]).filter(Boolean))];
    return unique.sort();
  }, []);
  return {
    leaderboard,
    loading,
    error,
    currentUserRank,
    lastOvertake,
    refetch: fetchLeaderboard,
    getFilterOptions
  };
}

const BUZZ_MAP_LEVELS = [
  // Entry (1-16): 4.99  29.99, 500km  110km
  { level: 1, radiusKm: 500, priceCents: 499, priceEur: 4.99 },
  { level: 2, radiusKm: 450, priceCents: 699, priceEur: 6.99 },
  { level: 3, radiusKm: 400, priceCents: 899, priceEur: 8.99 },
  { level: 4, radiusKm: 360, priceCents: 1099, priceEur: 10.99 },
  { level: 5, radiusKm: 320, priceCents: 1299, priceEur: 12.99 },
  { level: 6, radiusKm: 290, priceCents: 1499, priceEur: 14.99 },
  { level: 7, radiusKm: 260, priceCents: 1699, priceEur: 16.99 },
  { level: 8, radiusKm: 230, priceCents: 1899, priceEur: 18.99 },
  { level: 9, radiusKm: 210, priceCents: 1999, priceEur: 19.99 },
  { level: 10, radiusKm: 190, priceCents: 2199, priceEur: 21.99 },
  { level: 11, radiusKm: 175, priceCents: 2399, priceEur: 23.99 },
  { level: 12, radiusKm: 160, priceCents: 2499, priceEur: 24.99 },
  { level: 13, radiusKm: 145, priceCents: 2699, priceEur: 26.99 },
  { level: 14, radiusKm: 130, priceCents: 2799, priceEur: 27.99 },
  { level: 15, radiusKm: 120, priceCents: 2899, priceEur: 28.99 },
  { level: 16, radiusKm: 110, priceCents: 2999, priceEur: 29.99 },
  // Mid High-Spender (17-22): 39.99  149.99, 100km  64km
  { level: 17, radiusKm: 100, priceCents: 3999, priceEur: 39.99 },
  { level: 18, radiusKm: 92, priceCents: 5499, priceEur: 54.99 },
  { level: 19, radiusKm: 84, priceCents: 6999, priceEur: 69.99 },
  { level: 20, radiusKm: 77, priceCents: 8999, priceEur: 89.99 },
  { level: 21, radiusKm: 70, priceCents: 10999, priceEur: 109.99 },
  { level: 22, radiusKm: 64, priceCents: 14999, priceEur: 149.99 },
  // High-Spender (23-30): 199.99  699.99, 58km  31km
  { level: 23, radiusKm: 58, priceCents: 19999, priceEur: 199.99 },
  { level: 24, radiusKm: 53, priceCents: 24999, priceEur: 249.99 },
  { level: 25, radiusKm: 48, priceCents: 29999, priceEur: 299.99 },
  { level: 26, radiusKm: 44, priceCents: 34999, priceEur: 349.99 },
  { level: 27, radiusKm: 40, priceCents: 39999, priceEur: 399.99 },
  { level: 28, radiusKm: 37, priceCents: 44999, priceEur: 449.99 },
  { level: 29, radiusKm: 34, priceCents: 54999, priceEur: 549.99 },
  { level: 30, radiusKm: 31, priceCents: 69999, priceEur: 699.99 },
  // ELITE (31-42): 999.99  1,999.99, 28km  5km
  { level: 31, radiusKm: 28, priceCents: 99999, priceEur: 999.99 },
  { level: 32, radiusKm: 26, priceCents: 109999, priceEur: 1099.99 },
  { level: 33, radiusKm: 24, priceCents: 119999, priceEur: 1199.99 },
  { level: 34, radiusKm: 22, priceCents: 129999, priceEur: 1299.99 },
  { level: 35, radiusKm: 20, priceCents: 139999, priceEur: 1399.99 },
  { level: 36, radiusKm: 18, priceCents: 149999, priceEur: 1499.99 },
  { level: 37, radiusKm: 16, priceCents: 159999, priceEur: 1599.99 },
  { level: 38, radiusKm: 14, priceCents: 169999, priceEur: 1699.99 },
  { level: 39, radiusKm: 12, priceCents: 179999, priceEur: 1799.99 },
  { level: 40, radiusKm: 10, priceCents: 189999, priceEur: 1899.99 },
  { level: 41, radiusKm: 8, priceCents: 194999, priceEur: 1949.99 },
  { level: 42, radiusKm: 5, priceCents: 199999, priceEur: 1999.99 }
];
const MAX_BUZZ_MAP_LEVEL$1 = 42;
function getBuzzMapPricing(level) {
  const clampedLevel = Math.max(1, Math.min(level, MAX_BUZZ_MAP_LEVEL$1));
  return BUZZ_MAP_LEVELS[clampedLevel - 1];
}

const BUZZ_MAP_M1U_PRICING = [
  // Entry (1-16): 50  300 M1U
  { level: 1, radiusKm: 500, priceEur: 4.99, m1u: 50 },
  { level: 2, radiusKm: 450, priceEur: 6.99, m1u: 70 },
  { level: 3, radiusKm: 400, priceEur: 8.99, m1u: 90 },
  { level: 4, radiusKm: 360, priceEur: 10.99, m1u: 110 },
  { level: 5, radiusKm: 320, priceEur: 12.99, m1u: 130 },
  { level: 6, radiusKm: 290, priceEur: 14.99, m1u: 150 },
  { level: 7, radiusKm: 260, priceEur: 16.99, m1u: 170 },
  { level: 8, radiusKm: 230, priceEur: 18.99, m1u: 190 },
  { level: 9, radiusKm: 210, priceEur: 19.99, m1u: 200 },
  { level: 10, radiusKm: 190, priceEur: 21.99, m1u: 220 },
  { level: 11, radiusKm: 175, priceEur: 23.99, m1u: 240 },
  { level: 12, radiusKm: 160, priceEur: 24.99, m1u: 250 },
  { level: 13, radiusKm: 145, priceEur: 26.99, m1u: 270 },
  { level: 14, radiusKm: 130, priceEur: 27.99, m1u: 280 },
  { level: 15, radiusKm: 120, priceEur: 28.99, m1u: 290 },
  { level: 16, radiusKm: 110, priceEur: 29.99, m1u: 300 },
  // Mid High-Spender (17-22): 400  1500 M1U
  { level: 17, radiusKm: 100, priceEur: 39.99, m1u: 400 },
  { level: 18, radiusKm: 92, priceEur: 54.99, m1u: 550 },
  { level: 19, radiusKm: 84, priceEur: 69.99, m1u: 700 },
  { level: 20, radiusKm: 77, priceEur: 89.99, m1u: 900 },
  { level: 21, radiusKm: 70, priceEur: 109.99, m1u: 1100 },
  { level: 22, radiusKm: 64, priceEur: 149.99, m1u: 1500 },
  // High-Spender (23-30): 2000  7000 M1U
  { level: 23, radiusKm: 58, priceEur: 199.99, m1u: 2e3 },
  { level: 24, radiusKm: 53, priceEur: 249.99, m1u: 2500 },
  { level: 25, radiusKm: 48, priceEur: 299.99, m1u: 3e3 },
  { level: 26, radiusKm: 44, priceEur: 349.99, m1u: 3500 },
  { level: 27, radiusKm: 40, priceEur: 399.99, m1u: 4e3 },
  { level: 28, radiusKm: 37, priceEur: 449.99, m1u: 4500 },
  { level: 29, radiusKm: 34, priceEur: 549.99, m1u: 5500 },
  { level: 30, radiusKm: 31, priceEur: 699.99, m1u: 7e3 },
  // ELITE (31-42): 10000  20000 M1U
  { level: 31, radiusKm: 28, priceEur: 999.99, m1u: 1e4 },
  { level: 32, radiusKm: 26, priceEur: 1099.99, m1u: 11e3 },
  { level: 33, radiusKm: 24, priceEur: 1199.99, m1u: 12e3 },
  { level: 34, radiusKm: 22, priceEur: 1299.99, m1u: 13e3 },
  { level: 35, radiusKm: 20, priceEur: 1399.99, m1u: 14e3 },
  { level: 36, radiusKm: 18, priceEur: 1499.99, m1u: 15e3 },
  { level: 37, radiusKm: 16, priceEur: 1599.99, m1u: 16e3 },
  { level: 38, radiusKm: 14, priceEur: 1699.99, m1u: 17e3 },
  { level: 39, radiusKm: 12, priceEur: 1799.99, m1u: 18e3 },
  { level: 40, radiusKm: 10, priceEur: 1899.99, m1u: 19e3 },
  { level: 41, radiusKm: 8, priceEur: 1949.99, m1u: 19500 },
  { level: 42, radiusKm: 5, priceEur: 1999.99, m1u: 2e4 }
];
const MAX_BUZZ_MAP_LEVEL = 42;
const getBuzzMapPricingM1U = (level) => {
  const clampedLevel = Math.max(1, Math.min(level, MAX_BUZZ_MAP_LEVEL));
  const pricing = BUZZ_MAP_M1U_PRICING.find((p) => p.level === clampedLevel);
  if (!pricing) {
    return BUZZ_MAP_M1U_PRICING[0];
  }
  return pricing;
};
const getBuzzMapCostM1U = (level) => {
  const pricing = getBuzzMapPricingM1U(level);
  return pricing.m1u;
};

function getCurrentWeekOfYear() {
  const now = /* @__PURE__ */ new Date();
  const dt = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()));
  const dayNum = dt.getUTCDay() || 7;
  dt.setUTCDate(dt.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(dt.getUTCFullYear(), 0, 1));
  const weekNo = Math.ceil(((dt.getTime() - yearStart.getTime()) / 864e5 + 1) / 7);
  return weekNo;
}

function useBuzzMapPricingNew(userId) {
  const [loading, setLoading] = reactExports.useState(true);
  const [nextLevel, setLevel] = reactExports.useState(1);
  const [nextRadiusKm, setRadius] = reactExports.useState(500);
  const [nextPriceEur, setPrice] = reactExports.useState(4.99);
  const [nextCostM1U, setCostM1U] = reactExports.useState(50);
  const [disabled, setDisabled] = reactExports.useState(false);
  const [error, setError] = reactExports.useState(null);
  const calculateNextLevel = reactExports.useCallback(async () => {
    setLoading(true);
    setError(null);
    setDisabled(false);
    try {
      const { data: { session }, error: sessionError } = await supabase.auth.getSession();
      if (sessionError || !session?.user) {
        setLevel(1);
        setRadius(500);
        setPrice(4.99);
        setDisabled(true);
        setError("Autenticazione richiesta");
        return;
      }
      const currentUserId = userId || session.user.id;
      const currentWeek = getCurrentWeekOfYear();
      const { count, error: countError } = await supabase.from("user_map_areas").select("id", { count: "exact", head: true }).eq("user_id", currentUserId).eq("source", "buzz_map").eq("week", currentWeek);
      if (countError) {
        setLevel(1);
        setRadius(500);
        setPrice(4.99);
        setDisabled(true);
        setError("Errore nel caricamento dati");
        return;
      }
      const currentCount = count ?? 0;
      const levelNext = Math.max(1, Math.min(currentCount + 1, 60));
      const pricingData = getBuzzMapPricing(levelNext);
      const costM1U = getBuzzMapCostM1U(levelNext);
      setLevel(levelNext);
      setRadius(pricingData.radiusKm);
      setPrice(pricingData.priceEur);
      setCostM1U(costM1U);
      setDisabled(false);
    } catch (error2) {
      setLevel(1);
      setRadius(500);
      setPrice(4.99);
      setDisabled(true);
      if (error2.code === "401" || error2.message?.includes("401")) {
        setError("Accesso richiesto");
      } else {
        setError("Errore nel caricamento");
      }
    } finally {
      setLoading(false);
    }
  }, [userId]);
  reactExports.useEffect(() => {
    calculateNextLevel();
  }, [calculateNextLevel]);
  reactExports.useEffect(() => {
    let mounted = true;
    let channel;
    const setup = async () => {
      const { data: { session } } = await supabase.auth.getSession();
      const uid = userId || session?.user?.id;
      if (!uid || !mounted) {
        return;
      }
      const currentWeek = getCurrentWeekOfYear();
      channel = supabase.channel(`buzz_map_pricing_updates_${uid}`).on(
        "postgres_changes",
        {
          event: "INSERT",
          schema: "public",
          table: "user_map_areas",
          filter: `user_id=eq.${uid}`
        },
        (payload) => {
          if (payload.new?.source === "buzz_map" && payload.new?.week === currentWeek) {
            calculateNextLevel();
          }
        }
      ).subscribe();
    };
    setup();
    return () => {
      mounted = false;
      if (channel) {
        supabase.removeChannel(channel);
      }
    };
  }, [userId, calculateNextLevel]);
  reactExports.useEffect(() => {
    const handleBuzzAreaCreated = () => {
      calculateNextLevel();
    };
    window.addEventListener("buzzAreaCreated", handleBuzzAreaCreated);
    return () => window.removeEventListener("buzzAreaCreated", handleBuzzAreaCreated);
  }, [calculateNextLevel]);
  return {
    loading,
    nextLevel,
    nextRadiusKm,
    nextPriceEur,
    nextCostM1U,
    disabled,
    error,
    // Backward compatibility
    generation: nextLevel,
    price: nextPriceEur,
    radius: nextRadiusKm
  };
}

const BUZZ_PRICING_TIERS = [
  // Click 1-10: 1.99 ciascuno
  { minClick: 1, maxClick: 10, priceEur: 1.99, priceCents: 199 },
  // Click 11-20: 3.99 ciascuno  
  { minClick: 11, maxClick: 20, priceEur: 3.99, priceCents: 399 },
  // Click 21-30: 5.99 ciascuno
  { minClick: 21, maxClick: 30, priceEur: 5.99, priceCents: 599 },
  // Click 31-40: 7.99 ciascuno
  { minClick: 31, maxClick: 40, priceEur: 7.99, priceCents: 799 },
  // Click 41-50: 9.99 ciascuno
  { minClick: 41, maxClick: 50, priceEur: 9.99, priceCents: 999 },
  // Click 51+: 10.99 ciascuno
  { minClick: 51, maxClick: 9999, priceEur: 10.99, priceCents: 1099 }
];
const calculateBuzzPrice = (dailyClickCount) => {
  const nextClick = dailyClickCount + 1;
  const tier = BUZZ_PRICING_TIERS.find(
    (tier2) => nextClick >= tier2.minClick && nextClick <= tier2.maxClick
  );
  if (!tier) {
    const highestTier = BUZZ_PRICING_TIERS[BUZZ_PRICING_TIERS.length - 1];
    return {
      priceEur: highestTier.priceEur,
      priceCents: highestTier.priceCents
    };
  }
  return {
    priceEur: tier.priceEur,
    priceCents: tier.priceCents
  };
};
const getBuzzDisplayPrice = (dailyClickCount) => {
  const { priceEur } = calculateBuzzPrice(dailyClickCount);
  return `${priceEur.toFixed(2)}`;
};
const getBuzzPriceCents = (dailyClickCount) => {
  const { priceCents } = calculateBuzzPrice(dailyClickCount);
  return priceCents;
};

const BUZZ_M1U_COST = [
  // Click 1-10: 1.99  20 M1U
  { minClick: 1, maxClick: 10, m1u: 20 },
  // Click 11-20: 3.99  40 M1U  
  { minClick: 11, maxClick: 20, m1u: 40 },
  // Click 21-30: 5.99  60 M1U
  { minClick: 21, maxClick: 30, m1u: 60 },
  // Click 31-40: 7.99  80 M1U
  { minClick: 31, maxClick: 40, m1u: 80 },
  // Click 41-50: 9.99  100 M1U
  { minClick: 41, maxClick: 50, m1u: 100 },
  // Click 51+: 10.99  110 M1U
  { minClick: 51, maxClick: 9999, m1u: 110 }
];
const calculateBuzzCostM1U = (dailyClickCount) => {
  const nextClick = dailyClickCount + 1;
  const tier = BUZZ_M1U_COST.find(
    (tier2) => nextClick >= tier2.minClick && nextClick <= tier2.maxClick
  );
  if (!tier) {
    const highestTier = BUZZ_M1U_COST[BUZZ_M1U_COST.length - 1];
    return highestTier.m1u;
  }
  return tier.m1u;
};
const getBuzzDisplayCostM1U = (dailyClickCount) => {
  const costM1U = calculateBuzzCostM1U(dailyClickCount);
  return `${costM1U} M1U`;
};

const useBuzzCounter = (userId) => {
  const [dailyBuzzCounter, setDailyBuzzCounter] = reactExports.useState(0);
  const loadDailyBuzzCounter = reactExports.useCallback(async () => {
    if (!userId) return;
    const todayDate = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
    try {
      const { data, error } = await supabase.from("user_buzz_counter").select("buzz_count").eq("user_id", userId).eq("date", todayDate).maybeSingle();
      if (error && !["PGRST116", "42P01", "400"].includes(error.code)) {
        return;
      }
      const buzzCount = data?.buzz_count || 0;
      setDailyBuzzCounter(buzzCount);
    } catch (err) {
      setDailyBuzzCounter(0);
    }
  }, [userId]);
  const updateDailyBuzzCounter = reactExports.useCallback(async () => {
    if (!userId) return 0;
    const newBuzzCounter = dailyBuzzCounter + 1;
    try {
      await supabase.from("user_buzz_counter").upsert({
        user_id: userId,
        date: (/* @__PURE__ */ new Date()).toISOString().split("T")[0],
        buzz_count: newBuzzCounter
      }, { onConflict: "user_id,date" });
      setDailyBuzzCounter(newBuzzCounter);
      setTimeout(() => loadDailyBuzzCounter(), 100);
      return newBuzzCounter;
    } catch (err) {
      return dailyBuzzCounter;
    }
  }, [userId, dailyBuzzCounter, loadDailyBuzzCounter]);
  const getCurrentBuzzPrice = reactExports.useCallback(() => {
    return calculateBuzzPrice(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  const getCurrentBuzzDisplayPrice = reactExports.useCallback(() => {
    return getBuzzDisplayPrice(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  const getCurrentBuzzPriceCents = reactExports.useCallback(() => {
    return getBuzzPriceCents(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  const getCurrentBuzzCostM1U = reactExports.useCallback(() => {
    return calculateBuzzCostM1U(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  const getCurrentBuzzDisplayCostM1U = reactExports.useCallback(() => {
    return getBuzzDisplayCostM1U(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  reactExports.useEffect(() => {
    if (userId) {
      loadDailyBuzzCounter();
    }
  }, [userId, loadDailyBuzzCounter]);
  return {
    dailyBuzzCounter,
    loadDailyBuzzCounter,
    updateDailyBuzzCounter,
    getCurrentBuzzPrice,
    getCurrentBuzzDisplayPrice,
    getCurrentBuzzPriceCents,
    // M1U functions
    getCurrentBuzzCostM1U,
    getCurrentBuzzDisplayCostM1U
  };
};

const useBuzzGrants = () => {
  const [grants, setGrants] = reactExports.useState([]);
  const [totalRemaining, setTotalRemaining] = reactExports.useState(0);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [error, setError] = reactExports.useState(null);
  const [dailyUsed, setDailyUsed] = reactExports.useState(false);
  const fetchGrants = async () => {
    setIsLoading(true);
    setError(null);
    try {
      const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
      const { data: todayBuzzUsage, error: buzzError } = await supabase.from("user_buzz_counter").select("*").eq("user_id", (await supabase.auth.getUser()).data.user?.id).eq("date", today).maybeSingle();
      if (todayBuzzUsage && todayBuzzUsage.buzz_count > 0) {
        setDailyUsed(true);
      } else {
        setDailyUsed(false);
      }
      const { data, error: error2 } = await supabase.from("buzz_grants").select("*").gt("remaining", 0).order("created_at", { ascending: false });
      if (error2) throw error2;
      setGrants(data || []);
      const total = (data || []).reduce((sum, grant) => sum + grant.remaining, 0);
      setTotalRemaining(total);
    } catch (err) {
      setError(err instanceof Error ? err.message : "Unknown error");
      setGrants([]);
      setTotalRemaining(0);
    } finally {
      setIsLoading(false);
    }
  };
  const consumeFreeBuzz = async () => {
    if (totalRemaining <= 0) {
      return false;
    }
    try {
      const userId = (await supabase.auth.getUser()).data.user?.id;
      if (!userId) {
        return false;
      }
      const grantToUse = grants.find((g) => g.remaining > 0);
      if (!grantToUse) {
        return false;
      }
      const { error: error2 } = await supabase.from("buzz_grants").update({
        remaining: grantToUse.remaining - 1,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", grantToUse.id);
      if (error2) throw error2;
      const uniqueClue = `Cerca dove l'innovazione italiana splende (${(/* @__PURE__ */ new Date()).toLocaleTimeString()}) - FREE BUZZ`;
      const clueId = `free_buzz_${Date.now()}_${Math.random().toString(36).substring(7)}`;
      const { error: clueError } = await supabase.from("user_clues").insert({
        user_id: userId,
        clue_id: clueId,
        // Required field!
        title_it: " Indizio BUZZ Gratuito",
        description_it: uniqueClue,
        clue_type: "buzz",
        buzz_cost: 0
      });
      if (clueError) {
      } else {
      }
      const { error: notifError } = await supabase.from("user_notifications").insert({
        user_id: userId,
        type: "buzz",
        title: " Nuovo Indizio BUZZ Gratuito!",
        message: uniqueClue,
        is_read: false,
        metadata: { free: true, source: "buzz_grant" }
      });
      if (notifError) {
      } else {
      }
      const { error: statusUpdateError } = await supabase.from("user_mission_status").upsert({
        user_id: userId,
        clues_found: 1,
        mission_progress_percent: Math.round(1 / 250 * 100),
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      });
      if (statusUpdateError) {
      } else {
      }
      setDailyUsed(true);
      await fetchGrants();
      return true;
    } catch (err) {
      return false;
    }
  };
  reactExports.useEffect(() => {
    fetchGrants();
  }, []);
  return {
    grants,
    totalRemaining,
    isLoading,
    error,
    fetchGrants,
    consumeFreeBuzz,
    hasFreeBuzz: totalRemaining > 0 && !dailyUsed,
    //  FIX: Check BOTH grants AND daily usage
    dailyUsed
  };
};

const getPageFromPath = (path) => {
  const normalizedPath = path.toLowerCase();
  if (normalizedPath === "/" || normalizedPath === "/home" || normalizedPath === "/app-home") {
    return "home";
  }
  if (normalizedPath.includes("/sandbox") || normalizedPath.includes("/buzz-map") || normalizedPath.includes("/map")) {
    return "buzz-map";
  }
  if (normalizedPath === "/buzz" || normalizedPath.includes("/buzz-page")) {
    return "buzz";
  }
  if (normalizedPath.includes("/intelligence") || normalizedPath.includes("/norah") || normalizedPath.includes("/aion")) {
    return "intelligence";
  }
  if (normalizedPath.includes("/notification") || normalizedPath.includes("/notice")) {
    return "notifications";
  }
  if (normalizedPath.includes("/leaderboard") || normalizedPath.includes("/winners") || normalizedPath.includes("/hall")) {
    return "leaderboard";
  }
  if (normalizedPath.includes("/profile")) {
    return "profile";
  }
  return "default";
};
const DynamicIslandContextManager = () => {
  const [location] = useLocation();
  const { isActive, setPage, updateData } = useDynamicIsland();
  const { missionStatus } = useMissionStatus();
  const { unreadCount } = useNotifications();
  const { user } = useAuth();
  const { currentUserRank } = useRealtimeLeaderboard({
    scope: "global",
    limit: 50,
    enableNotifications: false
  });
  const { nextCostM1U: buzzMapCost } = useBuzzMapPricingNew(user?.id);
  const { getCurrentBuzzCostM1U } = useBuzzCounter(user?.id);
  const { hasFreeBuzz } = useBuzzGrants();
  const prevLocationRef = reactExports.useRef("");
  const prevMissionRef = reactExports.useRef("");
  const prevUnreadRef = reactExports.useRef(-1);
  const prevLeaderboardRef = reactExports.useRef(-1);
  const prevBuzzCostRef = reactExports.useRef("");
  const loadedRewardsRef = reactExports.useRef(false);
  const loadRewardStats = reactExports.useCallback(async () => {
    if (!user?.id || loadedRewardsRef.current) return;
    try {
      loadedRewardsRef.current = true;
      const { count: totalCount } = await supabase.from("markers").select("*", { count: "exact", head: true }).eq("active", true);
      const { count: claimedCount } = await supabase.from("marker_claims").select("*", { count: "exact", head: true }).eq("user_id", user.id);
      const total = totalCount ?? 99;
      const claimed = claimedCount ?? 0;
      const available = Math.max(0, total - claimed);
      updateData({
        rewardsAvailable: available,
        totalRewards: total
      });
    } catch (error) {
      loadedRewardsRef.current = false;
    }
  }, [user?.id, updateData]);
  reactExports.useEffect(() => {
    if (!isActive) return;
    if (location === prevLocationRef.current) return;
    prevLocationRef.current = location;
    const newPage = getPageFromPath(location);
    setPage(newPage);
    if (newPage === "buzz-map") {
      loadRewardStats();
    }
  }, [location, isActive, setPage, loadRewardStats]);
  reactExports.useEffect(() => {
    if (!isActive || !missionStatus) return;
    const missionKey = `${missionStatus.cluesFound}-${missionStatus.totalClues}-${missionStatus.daysRemaining}`;
    if (missionKey === prevMissionRef.current) return;
    prevMissionRef.current = missionKey;
    updateData({
      cluesFound: missionStatus.cluesFound,
      totalClues: missionStatus.totalClues,
      daysRemaining: missionStatus.daysRemaining
    });
  }, [isActive, missionStatus?.cluesFound, missionStatus?.totalClues, missionStatus?.daysRemaining, updateData]);
  reactExports.useEffect(() => {
    if (!isActive) return;
    if (unreadCount === prevUnreadRef.current) return;
    prevUnreadRef.current = unreadCount;
    updateData({ unreadCount });
  }, [isActive, unreadCount, updateData]);
  reactExports.useEffect(() => {
    if (!isActive || !currentUserRank) return;
    const realRank = currentUserRank.rank;
    if (realRank === prevLeaderboardRef.current) return;
    prevLeaderboardRef.current = realRank;
    updateData({
      currentPosition: realRank,
      positionChange: currentUserRank.change || 0
    });
  }, [isActive, currentUserRank?.rank, currentUserRank?.change, updateData]);
  reactExports.useEffect(() => {
    if (!isActive) return;
    const currentPage = getPageFromPath(location);
    let costToShow;
    if (currentPage === "buzz-map") {
      costToShow = buzzMapCost;
    } else if (currentPage === "buzz") {
      costToShow = hasFreeBuzz ? 0 : getCurrentBuzzCostM1U();
    } else {
      return;
    }
    const costKey = `${currentPage}-${costToShow}`;
    if (costKey === prevBuzzCostRef.current) return;
    prevBuzzCostRef.current = costKey;
    updateData({ buzzCost: costToShow });
  }, [isActive, location, buzzMapCost, getCurrentBuzzCostM1U, hasFreeBuzz, updateData]);
  reactExports.useEffect(() => {
    if (!isActive) return;
    const currentPage = getPageFromPath(location);
    if (currentPage === "intelligence") {
      updateData({ aionStatus: "active" });
    }
  }, [isActive, location, updateData]);
  return null;
};

var hasElementType = typeof Element !== "undefined";
var hasMap = typeof Map === "function";
var hasSet = typeof Set === "function";
var hasArrayBuffer = typeof ArrayBuffer === "function" && !!ArrayBuffer.isView;
function equal(a, b) {
  if (a === b) return true;
  if (a && b && typeof a == "object" && typeof b == "object") {
    if (a.constructor !== b.constructor) return false;
    var length, i, keys;
    if (Array.isArray(a)) {
      length = a.length;
      if (length != b.length) return false;
      for (i = length; i-- !== 0; )
        if (!equal(a[i], b[i])) return false;
      return true;
    }
    var it;
    if (hasMap && a instanceof Map && b instanceof Map) {
      if (a.size !== b.size) return false;
      it = a.entries();
      while (!(i = it.next()).done)
        if (!b.has(i.value[0])) return false;
      it = a.entries();
      while (!(i = it.next()).done)
        if (!equal(i.value[1], b.get(i.value[0]))) return false;
      return true;
    }
    if (hasSet && a instanceof Set && b instanceof Set) {
      if (a.size !== b.size) return false;
      it = a.entries();
      while (!(i = it.next()).done)
        if (!b.has(i.value[0])) return false;
      return true;
    }
    if (hasArrayBuffer && ArrayBuffer.isView(a) && ArrayBuffer.isView(b)) {
      length = a.length;
      if (length != b.length) return false;
      for (i = length; i-- !== 0; )
        if (a[i] !== b[i]) return false;
      return true;
    }
    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;
    if (a.valueOf !== Object.prototype.valueOf && typeof a.valueOf === "function" && typeof b.valueOf === "function") return a.valueOf() === b.valueOf();
    if (a.toString !== Object.prototype.toString && typeof a.toString === "function" && typeof b.toString === "function") return a.toString() === b.toString();
    keys = Object.keys(a);
    length = keys.length;
    if (length !== Object.keys(b).length) return false;
    for (i = length; i-- !== 0; )
      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;
    if (hasElementType && a instanceof Element) return false;
    for (i = length; i-- !== 0; ) {
      if ((keys[i] === "_owner" || keys[i] === "__v" || keys[i] === "__o") && a.$$typeof) {
        continue;
      }
      if (!equal(a[keys[i]], b[keys[i]])) return false;
    }
    return true;
  }
  return a !== a && b !== b;
}
var reactFastCompare = function isEqual(a, b) {
  try {
    return equal(a, b);
  } catch (error) {
    if ((error.message || "").match(/stack|recursion/i)) {
      console.warn("react-fast-compare cannot handle circular refs");
      return false;
    }
    throw error;
  }
};

const fastCompare = /*@__PURE__*/getDefaultExportFromCjs(reactFastCompare);

var invariant = function(condition, format, a, b, c, d, e, f) {
  if (!condition) {
    var error;
    if (format === void 0) {
      error = new Error(
        "Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings."
      );
    } else {
      var args = [a, b, c, d, e, f];
      var argIndex = 0;
      error = new Error(
        format.replace(/%s/g, function() {
          return args[argIndex++];
        })
      );
      error.name = "Invariant Violation";
    }
    error.framesToPop = 1;
    throw error;
  }
};
var browser = invariant;

const invariant$1 = /*@__PURE__*/getDefaultExportFromCjs(browser);

//

var shallowequal = function shallowEqual(objA, objB, compare, compareContext) {
  var ret = compare ? compare.call(compareContext, objA, objB) : void 0;

  if (ret !== void 0) {
    return !!ret;
  }

  if (objA === objB) {
    return true;
  }

  if (typeof objA !== "object" || !objA || typeof objB !== "object" || !objB) {
    return false;
  }

  var keysA = Object.keys(objA);
  var keysB = Object.keys(objB);

  if (keysA.length !== keysB.length) {
    return false;
  }

  var bHasOwnProperty = Object.prototype.hasOwnProperty.bind(objB);

  // Test for A's keys different from B.
  for (var idx = 0; idx < keysA.length; idx++) {
    var key = keysA[idx];

    if (!bHasOwnProperty(key)) {
      return false;
    }

    var valueA = objA[key];
    var valueB = objB[key];

    ret = compare ? compare.call(compareContext, valueA, valueB, key) : void 0;

    if (ret === false || (ret === void 0 && valueA !== valueB)) {
      return false;
    }
  }

  return true;
};

const shallowEqual = /*@__PURE__*/getDefaultExportFromCjs(shallowequal);

// src/index.tsx

// src/constants.ts
var TAG_NAMES = /* @__PURE__ */ ((TAG_NAMES2) => {
  TAG_NAMES2["BASE"] = "base";
  TAG_NAMES2["BODY"] = "body";
  TAG_NAMES2["HEAD"] = "head";
  TAG_NAMES2["HTML"] = "html";
  TAG_NAMES2["LINK"] = "link";
  TAG_NAMES2["META"] = "meta";
  TAG_NAMES2["NOSCRIPT"] = "noscript";
  TAG_NAMES2["SCRIPT"] = "script";
  TAG_NAMES2["STYLE"] = "style";
  TAG_NAMES2["TITLE"] = "title";
  TAG_NAMES2["FRAGMENT"] = "Symbol(react.fragment)";
  return TAG_NAMES2;
})(TAG_NAMES || {});
var SEO_PRIORITY_TAGS = {
  link: { rel: ["amphtml", "canonical", "alternate"] },
  script: { type: ["application/ld+json"] },
  meta: {
    charset: "",
    name: ["generator", "robots", "description"],
    property: [
      "og:type",
      "og:title",
      "og:url",
      "og:image",
      "og:image:alt",
      "og:description",
      "twitter:url",
      "twitter:title",
      "twitter:description",
      "twitter:image",
      "twitter:image:alt",
      "twitter:card",
      "twitter:site"
    ]
  }
};
var VALID_TAG_NAMES = Object.values(TAG_NAMES);
var REACT_TAG_MAP = {
  accesskey: "accessKey",
  charset: "charSet",
  class: "className",
  contenteditable: "contentEditable",
  contextmenu: "contextMenu",
  "http-equiv": "httpEquiv",
  itemprop: "itemProp",
  tabindex: "tabIndex"
};
var HTML_TAG_MAP = Object.entries(REACT_TAG_MAP).reduce(
  (carry, [key, value]) => {
    carry[value] = key;
    return carry;
  },
  {}
);
var HELMET_ATTRIBUTE = "data-rh";

// src/utils.ts
var HELMET_PROPS = {
  DEFAULT_TITLE: "defaultTitle",
  DEFER: "defer",
  ENCODE_SPECIAL_CHARACTERS: "encodeSpecialCharacters",
  ON_CHANGE_CLIENT_STATE: "onChangeClientState",
  TITLE_TEMPLATE: "titleTemplate",
  PRIORITIZE_SEO_TAGS: "prioritizeSeoTags"
};
var getInnermostProperty = (propsList, property) => {
  for (let i = propsList.length - 1; i >= 0; i -= 1) {
    const props = propsList[i];
    if (Object.prototype.hasOwnProperty.call(props, property)) {
      return props[property];
    }
  }
  return null;
};
var getTitleFromPropsList = (propsList) => {
  let innermostTitle = getInnermostProperty(propsList, "title" /* TITLE */);
  const innermostTemplate = getInnermostProperty(propsList, HELMET_PROPS.TITLE_TEMPLATE);
  if (Array.isArray(innermostTitle)) {
    innermostTitle = innermostTitle.join("");
  }
  if (innermostTemplate && innermostTitle) {
    return innermostTemplate.replace(/%s/g, () => innermostTitle);
  }
  const innermostDefaultTitle = getInnermostProperty(propsList, HELMET_PROPS.DEFAULT_TITLE);
  return innermostTitle || innermostDefaultTitle || void 0;
};
var getOnChangeClientState = (propsList) => getInnermostProperty(propsList, HELMET_PROPS.ON_CHANGE_CLIENT_STATE) || (() => {
});
var getAttributesFromPropsList = (tagType, propsList) => propsList.filter((props) => typeof props[tagType] !== "undefined").map((props) => props[tagType]).reduce((tagAttrs, current) => ({ ...tagAttrs, ...current }), {});
var getBaseTagFromPropsList = (primaryAttributes, propsList) => propsList.filter((props) => typeof props["base" /* BASE */] !== "undefined").map((props) => props["base" /* BASE */]).reverse().reduce((innermostBaseTag, tag) => {
  if (!innermostBaseTag.length) {
    const keys = Object.keys(tag);
    for (let i = 0; i < keys.length; i += 1) {
      const attributeKey = keys[i];
      const lowerCaseAttributeKey = attributeKey.toLowerCase();
      if (primaryAttributes.indexOf(lowerCaseAttributeKey) !== -1 && tag[lowerCaseAttributeKey]) {
        return innermostBaseTag.concat(tag);
      }
    }
  }
  return innermostBaseTag;
}, []);
var warn$1 = (msg) => console && typeof console.warn === "function" && console.warn(msg);
var getTagsFromPropsList = (tagName, primaryAttributes, propsList) => {
  const approvedSeenTags = {};
  return propsList.filter((props) => {
    if (Array.isArray(props[tagName])) {
      return true;
    }
    if (typeof props[tagName] !== "undefined") {
      warn$1(
        `Helmet: ${tagName} should be of type "Array". Instead found type "${typeof props[tagName]}"`
      );
    }
    return false;
  }).map((props) => props[tagName]).reverse().reduce((approvedTags, instanceTags) => {
    const instanceSeenTags = {};
    instanceTags.filter((tag) => {
      let primaryAttributeKey;
      const keys2 = Object.keys(tag);
      for (let i = 0; i < keys2.length; i += 1) {
        const attributeKey = keys2[i];
        const lowerCaseAttributeKey = attributeKey.toLowerCase();
        if (primaryAttributes.indexOf(lowerCaseAttributeKey) !== -1 && !(primaryAttributeKey === "rel" /* REL */ && tag[primaryAttributeKey].toLowerCase() === "canonical") && !(lowerCaseAttributeKey === "rel" /* REL */ && tag[lowerCaseAttributeKey].toLowerCase() === "stylesheet")) {
          primaryAttributeKey = lowerCaseAttributeKey;
        }
        if (primaryAttributes.indexOf(attributeKey) !== -1 && (attributeKey === "innerHTML" /* INNER_HTML */ || attributeKey === "cssText" /* CSS_TEXT */ || attributeKey === "itemprop" /* ITEM_PROP */)) {
          primaryAttributeKey = attributeKey;
        }
      }
      if (!primaryAttributeKey || !tag[primaryAttributeKey]) {
        return false;
      }
      const value = tag[primaryAttributeKey].toLowerCase();
      if (!approvedSeenTags[primaryAttributeKey]) {
        approvedSeenTags[primaryAttributeKey] = {};
      }
      if (!instanceSeenTags[primaryAttributeKey]) {
        instanceSeenTags[primaryAttributeKey] = {};
      }
      if (!approvedSeenTags[primaryAttributeKey][value]) {
        instanceSeenTags[primaryAttributeKey][value] = true;
        return true;
      }
      return false;
    }).reverse().forEach((tag) => approvedTags.push(tag));
    const keys = Object.keys(instanceSeenTags);
    for (let i = 0; i < keys.length; i += 1) {
      const attributeKey = keys[i];
      const tagUnion = {
        ...approvedSeenTags[attributeKey],
        ...instanceSeenTags[attributeKey]
      };
      approvedSeenTags[attributeKey] = tagUnion;
    }
    return approvedTags;
  }, []).reverse();
};
var getAnyTrueFromPropsList = (propsList, checkedTag) => {
  if (Array.isArray(propsList) && propsList.length) {
    for (let index = 0; index < propsList.length; index += 1) {
      const prop = propsList[index];
      if (prop[checkedTag]) {
        return true;
      }
    }
  }
  return false;
};
var reducePropsToState = (propsList) => ({
  baseTag: getBaseTagFromPropsList(["href" /* HREF */], propsList),
  bodyAttributes: getAttributesFromPropsList("bodyAttributes" /* BODY */, propsList),
  defer: getInnermostProperty(propsList, HELMET_PROPS.DEFER),
  encode: getInnermostProperty(propsList, HELMET_PROPS.ENCODE_SPECIAL_CHARACTERS),
  htmlAttributes: getAttributesFromPropsList("htmlAttributes" /* HTML */, propsList),
  linkTags: getTagsFromPropsList(
    "link" /* LINK */,
    ["rel" /* REL */, "href" /* HREF */],
    propsList
  ),
  metaTags: getTagsFromPropsList(
    "meta" /* META */,
    [
      "name" /* NAME */,
      "charset" /* CHARSET */,
      "http-equiv" /* HTTPEQUIV */,
      "property" /* PROPERTY */,
      "itemprop" /* ITEM_PROP */
    ],
    propsList
  ),
  noscriptTags: getTagsFromPropsList("noscript" /* NOSCRIPT */, ["innerHTML" /* INNER_HTML */], propsList),
  onChangeClientState: getOnChangeClientState(propsList),
  scriptTags: getTagsFromPropsList(
    "script" /* SCRIPT */,
    ["src" /* SRC */, "innerHTML" /* INNER_HTML */],
    propsList
  ),
  styleTags: getTagsFromPropsList("style" /* STYLE */, ["cssText" /* CSS_TEXT */], propsList),
  title: getTitleFromPropsList(propsList),
  titleAttributes: getAttributesFromPropsList("titleAttributes" /* TITLE */, propsList),
  prioritizeSeoTags: getAnyTrueFromPropsList(propsList, HELMET_PROPS.PRIORITIZE_SEO_TAGS)
});
var flattenArray = (possibleArray) => Array.isArray(possibleArray) ? possibleArray.join("") : possibleArray;
var checkIfPropsMatch = (props, toMatch) => {
  const keys = Object.keys(props);
  for (let i = 0; i < keys.length; i += 1) {
    if (toMatch[keys[i]] && toMatch[keys[i]].includes(props[keys[i]])) {
      return true;
    }
  }
  return false;
};
var prioritizer = (elementsList, propsToMatch) => {
  if (Array.isArray(elementsList)) {
    return elementsList.reduce(
      (acc, elementAttrs) => {
        if (checkIfPropsMatch(elementAttrs, propsToMatch)) {
          acc.priority.push(elementAttrs);
        } else {
          acc.default.push(elementAttrs);
        }
        return acc;
      },
      { priority: [], default: [] }
    );
  }
  return { default: elementsList, priority: [] };
};
var without = (obj, key) => {
  return {
    ...obj,
    [key]: void 0
  };
};

// src/server.ts
var SELF_CLOSING_TAGS = ["noscript" /* NOSCRIPT */, "script" /* SCRIPT */, "style" /* STYLE */];
var encodeSpecialCharacters = (str, encode = true) => {
  if (encode === false) {
    return String(str);
  }
  return String(str).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#x27;");
};
var generateElementAttributesAsString = (attributes) => Object.keys(attributes).reduce((str, key) => {
  const attr = typeof attributes[key] !== "undefined" ? `${key}="${attributes[key]}"` : `${key}`;
  return str ? `${str} ${attr}` : attr;
}, "");
var generateTitleAsString = (type, title, attributes, encode) => {
  const attributeString = generateElementAttributesAsString(attributes);
  const flattenedTitle = flattenArray(title);
  return attributeString ? `<${type} ${HELMET_ATTRIBUTE}="true" ${attributeString}>${encodeSpecialCharacters(
    flattenedTitle,
    encode
  )}</${type}>` : `<${type} ${HELMET_ATTRIBUTE}="true">${encodeSpecialCharacters(
    flattenedTitle,
    encode
  )}</${type}>`;
};
var generateTagsAsString = (type, tags, encode = true) => tags.reduce((str, t) => {
  const tag = t;
  const attributeHtml = Object.keys(tag).filter(
    (attribute) => !(attribute === "innerHTML" /* INNER_HTML */ || attribute === "cssText" /* CSS_TEXT */)
  ).reduce((string, attribute) => {
    const attr = typeof tag[attribute] === "undefined" ? attribute : `${attribute}="${encodeSpecialCharacters(tag[attribute], encode)}"`;
    return string ? `${string} ${attr}` : attr;
  }, "");
  const tagContent = tag.innerHTML || tag.cssText || "";
  const isSelfClosing = SELF_CLOSING_TAGS.indexOf(type) === -1;
  return `${str}<${type} ${HELMET_ATTRIBUTE}="true" ${attributeHtml}${isSelfClosing ? `/>` : `>${tagContent}</${type}>`}`;
}, "");
var convertElementAttributesToReactProps = (attributes, initProps = {}) => Object.keys(attributes).reduce((obj, key) => {
  const mapped = REACT_TAG_MAP[key];
  obj[mapped || key] = attributes[key];
  return obj;
}, initProps);
var generateTitleAsReactComponent = (_type, title, attributes) => {
  const initProps = {
    key: title,
    [HELMET_ATTRIBUTE]: true
  };
  const props = convertElementAttributesToReactProps(attributes, initProps);
  return [React$1.createElement("title" /* TITLE */, props, title)];
};
var generateTagsAsReactComponent = (type, tags) => tags.map((tag, i) => {
  const mappedTag = {
    key: i,
    [HELMET_ATTRIBUTE]: true
  };
  Object.keys(tag).forEach((attribute) => {
    const mapped = REACT_TAG_MAP[attribute];
    const mappedAttribute = mapped || attribute;
    if (mappedAttribute === "innerHTML" /* INNER_HTML */ || mappedAttribute === "cssText" /* CSS_TEXT */) {
      const content = tag.innerHTML || tag.cssText;
      mappedTag.dangerouslySetInnerHTML = { __html: content };
    } else {
      mappedTag[mappedAttribute] = tag[attribute];
    }
  });
  return React$1.createElement(type, mappedTag);
});
var getMethodsForTag = (type, tags, encode = true) => {
  switch (type) {
    case "title" /* TITLE */:
      return {
        toComponent: () => generateTitleAsReactComponent(type, tags.title, tags.titleAttributes),
        toString: () => generateTitleAsString(type, tags.title, tags.titleAttributes, encode)
      };
    case "bodyAttributes" /* BODY */:
    case "htmlAttributes" /* HTML */:
      return {
        toComponent: () => convertElementAttributesToReactProps(tags),
        toString: () => generateElementAttributesAsString(tags)
      };
    default:
      return {
        toComponent: () => generateTagsAsReactComponent(type, tags),
        toString: () => generateTagsAsString(type, tags, encode)
      };
  }
};
var getPriorityMethods = ({ metaTags, linkTags, scriptTags, encode }) => {
  const meta = prioritizer(metaTags, SEO_PRIORITY_TAGS.meta);
  const link = prioritizer(linkTags, SEO_PRIORITY_TAGS.link);
  const script = prioritizer(scriptTags, SEO_PRIORITY_TAGS.script);
  const priorityMethods = {
    toComponent: () => [
      ...generateTagsAsReactComponent("meta" /* META */, meta.priority),
      ...generateTagsAsReactComponent("link" /* LINK */, link.priority),
      ...generateTagsAsReactComponent("script" /* SCRIPT */, script.priority)
    ],
    toString: () => (
      // generate all the tags as strings and concatenate them
      `${getMethodsForTag("meta" /* META */, meta.priority, encode)} ${getMethodsForTag(
        "link" /* LINK */,
        link.priority,
        encode
      )} ${getMethodsForTag("script" /* SCRIPT */, script.priority, encode)}`
    )
  };
  return {
    priorityMethods,
    metaTags: meta.default,
    linkTags: link.default,
    scriptTags: script.default
  };
};
var mapStateOnServer = (props) => {
  const {
    baseTag,
    bodyAttributes,
    encode = true,
    htmlAttributes,
    noscriptTags,
    styleTags,
    title = "",
    titleAttributes,
    prioritizeSeoTags
  } = props;
  let { linkTags, metaTags, scriptTags } = props;
  let priorityMethods = {
    toComponent: () => {
    },
    toString: () => ""
  };
  if (prioritizeSeoTags) {
    ({ priorityMethods, linkTags, metaTags, scriptTags } = getPriorityMethods(props));
  }
  return {
    priority: priorityMethods,
    base: getMethodsForTag("base" /* BASE */, baseTag, encode),
    bodyAttributes: getMethodsForTag("bodyAttributes" /* BODY */, bodyAttributes, encode),
    htmlAttributes: getMethodsForTag("htmlAttributes" /* HTML */, htmlAttributes, encode),
    link: getMethodsForTag("link" /* LINK */, linkTags, encode),
    meta: getMethodsForTag("meta" /* META */, metaTags, encode),
    noscript: getMethodsForTag("noscript" /* NOSCRIPT */, noscriptTags, encode),
    script: getMethodsForTag("script" /* SCRIPT */, scriptTags, encode),
    style: getMethodsForTag("style" /* STYLE */, styleTags, encode),
    title: getMethodsForTag("title" /* TITLE */, { title, titleAttributes }, encode)
  };
};
var server_default = mapStateOnServer;

// src/HelmetData.ts
var instances = [];
var isDocument = !!(typeof window !== "undefined" && window.document && window.document.createElement);
var HelmetData = class {
  instances = [];
  canUseDOM = isDocument;
  context;
  value = {
    setHelmet: (serverState) => {
      this.context.helmet = serverState;
    },
    helmetInstances: {
      get: () => this.canUseDOM ? instances : this.instances,
      add: (instance) => {
        (this.canUseDOM ? instances : this.instances).push(instance);
      },
      remove: (instance) => {
        const index = (this.canUseDOM ? instances : this.instances).indexOf(instance);
        (this.canUseDOM ? instances : this.instances).splice(index, 1);
      }
    }
  };
  constructor(context, canUseDOM) {
    this.context = context;
    this.canUseDOM = canUseDOM || false;
    if (!canUseDOM) {
      context.helmet = server_default({
        baseTag: [],
        bodyAttributes: {},
        htmlAttributes: {},
        linkTags: [],
        metaTags: [],
        noscriptTags: [],
        scriptTags: [],
        styleTags: [],
        title: "",
        titleAttributes: {}
      });
    }
  }
};

// src/Provider.tsx
var defaultValue = {};
var Context$1 = React$1.createContext(defaultValue);
var HelmetProvider$1 = class _HelmetProvider extends reactExports.Component {
  static canUseDOM = isDocument;
  helmetData;
  constructor(props) {
    super(props);
    this.helmetData = new HelmetData(this.props.context || {}, _HelmetProvider.canUseDOM);
  }
  render() {
    return /* @__PURE__ */ React$1.createElement(Context$1.Provider, { value: this.helmetData.value }, this.props.children);
  }
};

// src/client.ts
var updateTags = (type, tags) => {
  const headElement = document.head || document.querySelector("head" /* HEAD */);
  const tagNodes = headElement.querySelectorAll(`${type}[${HELMET_ATTRIBUTE}]`);
  const oldTags = [].slice.call(tagNodes);
  const newTags = [];
  let indexToDelete;
  if (tags && tags.length) {
    tags.forEach((tag) => {
      const newElement = document.createElement(type);
      for (const attribute in tag) {
        if (Object.prototype.hasOwnProperty.call(tag, attribute)) {
          if (attribute === "innerHTML" /* INNER_HTML */) {
            newElement.innerHTML = tag.innerHTML;
          } else if (attribute === "cssText" /* CSS_TEXT */) {
            if (newElement.styleSheet) {
              newElement.styleSheet.cssText = tag.cssText;
            } else {
              newElement.appendChild(document.createTextNode(tag.cssText));
            }
          } else {
            const attr = attribute;
            const value = typeof tag[attr] === "undefined" ? "" : tag[attr];
            newElement.setAttribute(attribute, value);
          }
        }
      }
      newElement.setAttribute(HELMET_ATTRIBUTE, "true");
      if (oldTags.some((existingTag, index) => {
        indexToDelete = index;
        return newElement.isEqualNode(existingTag);
      })) {
        oldTags.splice(indexToDelete, 1);
      } else {
        newTags.push(newElement);
      }
    });
  }
  oldTags.forEach((tag) => tag.parentNode?.removeChild(tag));
  newTags.forEach((tag) => headElement.appendChild(tag));
  return {
    oldTags,
    newTags
  };
};
var updateAttributes = (tagName, attributes) => {
  const elementTag = document.getElementsByTagName(tagName)[0];
  if (!elementTag) {
    return;
  }
  const helmetAttributeString = elementTag.getAttribute(HELMET_ATTRIBUTE);
  const helmetAttributes = helmetAttributeString ? helmetAttributeString.split(",") : [];
  const attributesToRemove = [...helmetAttributes];
  const attributeKeys = Object.keys(attributes);
  for (const attribute of attributeKeys) {
    const value = attributes[attribute] || "";
    if (elementTag.getAttribute(attribute) !== value) {
      elementTag.setAttribute(attribute, value);
    }
    if (helmetAttributes.indexOf(attribute) === -1) {
      helmetAttributes.push(attribute);
    }
    const indexToSave = attributesToRemove.indexOf(attribute);
    if (indexToSave !== -1) {
      attributesToRemove.splice(indexToSave, 1);
    }
  }
  for (let i = attributesToRemove.length - 1; i >= 0; i -= 1) {
    elementTag.removeAttribute(attributesToRemove[i]);
  }
  if (helmetAttributes.length === attributesToRemove.length) {
    elementTag.removeAttribute(HELMET_ATTRIBUTE);
  } else if (elementTag.getAttribute(HELMET_ATTRIBUTE) !== attributeKeys.join(",")) {
    elementTag.setAttribute(HELMET_ATTRIBUTE, attributeKeys.join(","));
  }
};
var updateTitle = (title, attributes) => {
  if (typeof title !== "undefined" && document.title !== title) {
    document.title = flattenArray(title);
  }
  updateAttributes("title" /* TITLE */, attributes);
};
var commitTagChanges = (newState, cb) => {
  const {
    baseTag,
    bodyAttributes,
    htmlAttributes,
    linkTags,
    metaTags,
    noscriptTags,
    onChangeClientState,
    scriptTags,
    styleTags,
    title,
    titleAttributes
  } = newState;
  updateAttributes("body" /* BODY */, bodyAttributes);
  updateAttributes("html" /* HTML */, htmlAttributes);
  updateTitle(title, titleAttributes);
  const tagUpdates = {
    baseTag: updateTags("base" /* BASE */, baseTag),
    linkTags: updateTags("link" /* LINK */, linkTags),
    metaTags: updateTags("meta" /* META */, metaTags),
    noscriptTags: updateTags("noscript" /* NOSCRIPT */, noscriptTags),
    scriptTags: updateTags("script" /* SCRIPT */, scriptTags),
    styleTags: updateTags("style" /* STYLE */, styleTags)
  };
  const addedTags = {};
  const removedTags = {};
  Object.keys(tagUpdates).forEach((tagType) => {
    const { newTags, oldTags } = tagUpdates[tagType];
    if (newTags.length) {
      addedTags[tagType] = newTags;
    }
    if (oldTags.length) {
      removedTags[tagType] = tagUpdates[tagType].oldTags;
    }
  });
  if (cb) {
    cb();
  }
  onChangeClientState(newState, addedTags, removedTags);
};
var _helmetCallback = null;
var handleStateChangeOnClient = (newState) => {
  if (_helmetCallback) {
    cancelAnimationFrame(_helmetCallback);
  }
  if (newState.defer) {
    _helmetCallback = requestAnimationFrame(() => {
      commitTagChanges(newState, () => {
        _helmetCallback = null;
      });
    });
  } else {
    commitTagChanges(newState);
    _helmetCallback = null;
  }
};
var client_default = handleStateChangeOnClient;

// src/Dispatcher.tsx
var HelmetDispatcher = class extends reactExports.Component {
  rendered = false;
  shouldComponentUpdate(nextProps) {
    return !shallowEqual(nextProps, this.props);
  }
  componentDidUpdate() {
    this.emitChange();
  }
  componentWillUnmount() {
    const { helmetInstances } = this.props.context;
    helmetInstances.remove(this);
    this.emitChange();
  }
  emitChange() {
    const { helmetInstances, setHelmet } = this.props.context;
    let serverState = null;
    const state = reducePropsToState(
      helmetInstances.get().map((instance) => {
        const props = { ...instance.props };
        delete props.context;
        return props;
      })
    );
    if (HelmetProvider$1.canUseDOM) {
      client_default(state);
    } else if (server_default) {
      serverState = server_default(state);
    }
    setHelmet(serverState);
  }
  // componentWillMount will be deprecated
  // for SSR, initialize on first render
  // constructor is also unsafe in StrictMode
  init() {
    if (this.rendered) {
      return;
    }
    this.rendered = true;
    const { helmetInstances } = this.props.context;
    helmetInstances.add(this);
    this.emitChange();
  }
  render() {
    this.init();
    return null;
  }
};

// src/index.tsx
var Helmet = class extends reactExports.Component {
  static defaultProps = {
    defer: true,
    encodeSpecialCharacters: true,
    prioritizeSeoTags: false
  };
  shouldComponentUpdate(nextProps) {
    return !fastCompare(without(this.props, "helmetData"), without(nextProps, "helmetData"));
  }
  mapNestedChildrenToProps(child, nestedChildren) {
    if (!nestedChildren) {
      return null;
    }
    switch (child.type) {
      case "script" /* SCRIPT */:
      case "noscript" /* NOSCRIPT */:
        return {
          innerHTML: nestedChildren
        };
      case "style" /* STYLE */:
        return {
          cssText: nestedChildren
        };
      default:
        throw new Error(
          `<${child.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`
        );
    }
  }
  flattenArrayTypeChildren(child, arrayTypeChildren, newChildProps, nestedChildren) {
    return {
      ...arrayTypeChildren,
      [child.type]: [
        ...arrayTypeChildren[child.type] || [],
        {
          ...newChildProps,
          ...this.mapNestedChildrenToProps(child, nestedChildren)
        }
      ]
    };
  }
  mapObjectTypeChildren(child, newProps, newChildProps, nestedChildren) {
    switch (child.type) {
      case "title" /* TITLE */:
        return {
          ...newProps,
          [child.type]: nestedChildren,
          titleAttributes: { ...newChildProps }
        };
      case "body" /* BODY */:
        return {
          ...newProps,
          bodyAttributes: { ...newChildProps }
        };
      case "html" /* HTML */:
        return {
          ...newProps,
          htmlAttributes: { ...newChildProps }
        };
      default:
        return {
          ...newProps,
          [child.type]: { ...newChildProps }
        };
    }
  }
  mapArrayTypeChildrenToProps(arrayTypeChildren, newProps) {
    let newFlattenedProps = { ...newProps };
    Object.keys(arrayTypeChildren).forEach((arrayChildName) => {
      newFlattenedProps = {
        ...newFlattenedProps,
        [arrayChildName]: arrayTypeChildren[arrayChildName]
      };
    });
    return newFlattenedProps;
  }
  warnOnInvalidChildren(child, nestedChildren) {
    invariant$1(
      VALID_TAG_NAMES.some((name) => child.type === name),
      typeof child.type === "function" ? `You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.` : `Only elements types ${VALID_TAG_NAMES.join(
        ", "
      )} are allowed. Helmet does not support rendering <${child.type}> elements. Refer to our API for more information.`
    );
    invariant$1(
      !nestedChildren || typeof nestedChildren === "string" || Array.isArray(nestedChildren) && !nestedChildren.some((nestedChild) => typeof nestedChild !== "string"),
      `Helmet expects a string as a child of <${child.type}>. Did you forget to wrap your children in braces? ( <${child.type}>{\`\`}</${child.type}> ) Refer to our API for more information.`
    );
    return true;
  }
  mapChildrenToProps(children, newProps) {
    let arrayTypeChildren = {};
    React$1.Children.forEach(children, (child) => {
      if (!child || !child.props) {
        return;
      }
      const { children: nestedChildren, ...childProps } = child.props;
      const newChildProps = Object.keys(childProps).reduce((obj, key) => {
        obj[HTML_TAG_MAP[key] || key] = childProps[key];
        return obj;
      }, {});
      let { type } = child;
      if (typeof type === "symbol") {
        type = type.toString();
      } else {
        this.warnOnInvalidChildren(child, nestedChildren);
      }
      switch (type) {
        case "Symbol(react.fragment)" /* FRAGMENT */:
          newProps = this.mapChildrenToProps(nestedChildren, newProps);
          break;
        case "link" /* LINK */:
        case "meta" /* META */:
        case "noscript" /* NOSCRIPT */:
        case "script" /* SCRIPT */:
        case "style" /* STYLE */:
          arrayTypeChildren = this.flattenArrayTypeChildren(
            child,
            arrayTypeChildren,
            newChildProps,
            nestedChildren
          );
          break;
        default:
          newProps = this.mapObjectTypeChildren(child, newProps, newChildProps, nestedChildren);
          break;
      }
    });
    return this.mapArrayTypeChildrenToProps(arrayTypeChildren, newProps);
  }
  render() {
    const { children, ...props } = this.props;
    let newProps = { ...props };
    let { helmetData } = props;
    if (children) {
      newProps = this.mapChildrenToProps(children, newProps);
    }
    if (helmetData && !(helmetData instanceof HelmetData)) {
      const data = helmetData;
      helmetData = new HelmetData(data.context, true);
      delete newProps.helmetData;
    }
    return helmetData ? /* @__PURE__ */ React$1.createElement(HelmetDispatcher, { ...newProps, context: helmetData.value }) : /* @__PURE__ */ React$1.createElement(Context$1.Consumer, null, (context) => /* @__PURE__ */ React$1.createElement(HelmetDispatcher, { ...newProps, context }));
  }
};

const HelmetProvider = ({ children }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(HelmetProvider$1, { children });
};

const SkipToContent = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "a",
    {
      href: "#main-content",
      className: "sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-foreground focus:rounded-md focus:shadow-lg",
      tabIndex: 0,
      children: "Vai al contenuto principale"
    }
  );
};

const OfflineIndicator = () => {
  const [isOnline, setIsOnline] = reactExports.useState(navigator.onLine);
  const [showIndicator, setShowIndicator] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const handleOnline = () => {
      setIsOnline(true);
      setShowIndicator(true);
      setTimeout(() => setShowIndicator(false), 3e3);
    };
    const handleOffline = () => {
      setIsOnline(false);
      setShowIndicator(true);
    };
    window.addEventListener("online", handleOnline);
    window.addEventListener("offline", handleOffline);
    if (!navigator.onLine) {
      setShowIndicator(true);
    }
    return () => {
      window.removeEventListener("online", handleOnline);
      window.removeEventListener("offline", handleOffline);
    };
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showIndicator && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { y: -100, opacity: 0 },
      animate: { y: 0, opacity: 1 },
      exit: { y: -100, opacity: 0 },
      className: `fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 ${isOnline ? "bg-green-600 text-white" : "bg-red-600 text-white"}`,
      role: "alert",
      "aria-live": "polite",
      children: isOnline ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Wifi, { size: 16 }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Connesso" })
      ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(WifiOff, { size: 16 }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Nessuna connessione" })
      ] })
    }
  ) });
};

const log$1 = (message, data) => {
};
const useUnifiedAuth = () => {
  const context = reactExports.useContext(AuthContext);
  if (context === void 0) {
    throw new Error("useUnifiedAuth deve essere usato all'interno di un AuthProvider");
  }
  log$1("Hook accessed", {
    isAuthenticated: context.isAuthenticated,
    isLoading: context.isLoading,
    userEmail: context.getCurrentUser()?.email,
    hasSession: !!context.session
  });
  return context;
};

const useAccessControl = () => {
  const { isAuthenticated, getCurrentUser } = useUnifiedAuth();
  const [state, setState] = reactExports.useState({
    canAccess: false,
    isLoading: true,
    accessStartDate: null,
    subscriptionPlan: "",
    status: "registered_pending",
    timeUntilAccess: null
  });
  reactExports.useEffect(() => {
    const user = getCurrentUser();
    if (user?.email === "wikus77@hotmail.it") {
      setState({
        canAccess: true,
        isLoading: false,
        accessStartDate: /* @__PURE__ */ new Date(),
        subscriptionPlan: "ADMIN",
        status: "admin_emergency_access",
        timeUntilAccess: null
      });
      return;
    }
    if (!isAuthenticated) {
      setState((prev) => ({ ...prev, isLoading: false, canAccess: false }));
      return;
    }
    const checkAccess = async () => {
      try {
        const user2 = getCurrentUser();
        if (!user2) return;
        const { data: userProfile, error: fetchError } = await supabase.from("profiles").select("id, role, created_at").eq("id", user2.id).single();
        if (fetchError) {
          return;
        }
        if (userProfile?.role === "admin") {
          setState({
            canAccess: true,
            isLoading: false,
            accessStartDate: /* @__PURE__ */ new Date(),
            subscriptionPlan: "ADMIN",
            status: "admin_access",
            timeUntilAccess: null
          });
          return;
        }
        setState({
          canAccess: true,
          isLoading: false,
          accessStartDate: /* @__PURE__ */ new Date(),
          subscriptionPlan: "free",
          status: "active",
          timeUntilAccess: null
        });
      } catch (error) {
        setState((prev) => ({ ...prev, isLoading: false }));
      }
    };
    checkAccess();
  }, [isAuthenticated, getCurrentUser]);
  return state;
};

const useWouterNavigation = () => {
  const [location, setLocation] = useLocation();
  const isCapacitor = typeof window !== "undefined" && (window.location.protocol === "capacitor:" || !!window.Capacitor);
  const navigate = reactExports.useCallback((path, options) => {
    setLocation(path, { replace: options?.replace });
    if (isCapacitor) {
      setTimeout(() => {
        window.scrollTo(0, 0);
      }, 100);
    }
  }, [location, setLocation, isCapacitor]);
  const goBack = reactExports.useCallback(() => {
    if (typeof window !== "undefined" && window.history.length > 1) {
      window.history.back();
    } else {
      setLocation("/home");
    }
  }, [setLocation]);
  const toHome = reactExports.useCallback(() => navigate("/home"), [navigate]);
  const toMap = reactExports.useCallback(() => navigate("/map-3d-tiler"), [navigate]);
  const toBuzz = reactExports.useCallback(() => navigate("/buzz"), [navigate]);
  const toIntelligence = reactExports.useCallback(() => navigate("/intelligence"), [navigate]);
  const toNotifications = reactExports.useCallback(() => navigate("/notifications"), [navigate]);
  const toLeaderboard = reactExports.useCallback(() => navigate("/leaderboard"), [navigate]);
  const toProfile = reactExports.useCallback(() => navigate("/profile"), [navigate]);
  const toSettings = reactExports.useCallback(() => navigate("/settings"), [navigate]);
  const toSubscriptions = reactExports.useCallback(() => navigate("/subscriptions"), [navigate]);
  const toLogin = reactExports.useCallback(() => navigate("/login"), [navigate]);
  const toRegister = reactExports.useCallback(() => navigate("/register"), [navigate]);
  return {
    navigate,
    goBack,
    toHome,
    toMap,
    toBuzz,
    toIntelligence,
    toNotifications,
    toLeaderboard,
    toProfile,
    toSettings,
    toSubscriptions,
    toLogin,
    toRegister,
    currentPath: location,
    isCapacitor
  };
};

const v = "5.7.1";
const fr$1 = 30;
const ip = 0;
const op = 90;
const w = 400;
const h = 400;
const nm = "M1SSION Logo Animation";
const ddd = 0;
const assets = [
];
const layers = [
	{
		ddd: 0,
		ind: 1,
		ty: 4,
		nm: "Logo Text",
		sr: 1,
		ks: {
			o: {
				a: 1,
				k: [
					{
						i: {
							x: [
								0.833
							],
							y: [
								0.833
							]
						},
						o: {
							x: [
								0.167
							],
							y: [
								0.167
							]
						},
						t: 0,
						s: [
							100
						]
					},
					{
						t: 45,
						s: [
							60
						]
					},
					{
						t: 90,
						s: [
							100
						]
					}
				]
			},
			p: {
				a: 0,
				k: [
					200,
					200,
					0
				]
			},
			a: {
				a: 0,
				k: [
					0,
					0,
					0
				]
			},
			s: {
				a: 0,
				k: [
					100,
					100,
					100
				]
			}
		},
		ao: 0,
		shapes: [
			{
				ty: "gr",
				it: [
					{
						ind: 0,
						ty: "sh",
						ix: 1,
						ks: {
							a: 0,
							k: {
								i: [
								],
								o: [
								],
								v: [
									[
										-100,
										-20
									],
									[
										-80,
										-20
									],
									[
										-60,
										20
									],
									[
										-40,
										-20
									],
									[
										-20,
										20
									],
									[
										0,
										-20
									],
									[
										20,
										-20
									],
									[
										20,
										20
									],
									[
										40,
										20
									],
									[
										40,
										-20
									],
									[
										60,
										-20
									],
									[
										60,
										20
									],
									[
										80,
										20
									],
									[
										100,
										-20
									]
								],
								c: false
							}
						},
						nm: "M1SSION Path"
					},
					{
						ty: "st",
						c: {
							a: 1,
							k: [
								{
									t: 0,
									s: [
										0,
										0.64,
										1,
										1
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 30,
									s: [
										0.36,
										0.22,
										0.98,
										1
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 60,
									s: [
										0.95,
										0.28,
										0.75,
										1
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 90,
									s: [
										0,
										0.64,
										1,
										1
									]
								}
							]
						},
						o: {
							a: 0,
							k: 100
						},
						w: {
							a: 0,
							k: 8
						},
						lc: 2,
						lj: 2
					},
					{
						ty: "gf",
						o: {
							a: 0,
							k: 60
						},
						r: 1,
						g: {
							p: 3,
							k: {
								a: 0,
								k: [
									0,
									0,
									0.64,
									1,
									0.5,
									0.36,
									0.22,
									0.98,
									1,
									0.95,
									0.28,
									0.75
								]
							}
						},
						s: {
							a: 0,
							k: [
								-100,
								0
							]
						},
						e: {
							a: 0,
							k: [
								100,
								0
							]
						}
					}
				],
				nm: "M1SSION"
			}
		],
		ef: [
			{
				ty: 29,
				nm: "Glow",
				ix: 1,
				en: 1,
				ef: [
					{
						ty: 7,
						nm: "Glow Based On",
						ix: 1,
						v: {
							a: 0,
							k: 2
						}
					},
					{
						ty: 0,
						nm: "Glow Threshold",
						ix: 2,
						v: {
							a: 0,
							k: 128
						}
					},
					{
						ty: 0,
						nm: "Glow Radius",
						ix: 3,
						v: {
							a: 1,
							k: [
								{
									t: 0,
									s: [
										10
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 45,
									s: [
										15
									]
								},
								{
									t: 90,
									s: [
										10
									]
								}
							]
						}
					},
					{
						ty: 0,
						nm: "Glow Intensity",
						ix: 4,
						v: {
							a: 0,
							k: 1
						}
					},
					{
						ty: 2,
						nm: "Glow Color",
						ix: 5,
						v: {
							a: 1,
							k: [
								{
									t: 0,
									s: [
										0,
										0.64,
										1,
										1
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 45,
									s: [
										0.36,
										0.22,
										0.98,
										1
									]
								},
								{
									t: 90,
									s: [
										0,
										0.64,
										1,
										1
									]
								}
							]
						}
					}
				]
			}
		]
	}
];
const neonLogoAnimation = {
	v: v,
	fr: fr$1,
	ip: ip,
	op: op,
	w: w,
	h: h,
	nm: nm,
	ddd: ddd,
	assets: assets,
	layers: layers
};

const AnimatedLogo = () => {
  const options = {
    animationData: neonLogoAnimation,
    loop: true,
    autoplay: true,
    rendererSettings: {
      preserveAspectRatio: "xMidYMid meet",
      className: "lottie-svg-class"
    }
  };
  const { View } = useLottie(options);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative w-32 h-10 flex items-center justify-center", children: View });
};

const Label$1 = reactExports.forwardRef(
  ({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    "label",
    {
      ref,
      className: cn(
        "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",
        className
      ),
      ...props
    }
  )
);
Label$1.displayName = "Label";

const Input = reactExports.forwardRef(
  ({ className, type, ...props }, ref) => {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      "input",
      {
        type,
        className: cn(
          "flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",
          className
        ),
        ref,
        ...props
      }
    );
  }
);
Input.displayName = "Input";

const FormField = ({
  id,
  type,
  label,
  placeholder = "",
  value,
  onChange,
  icon,
  error,
  required = false,
  disabled = false,
  autoComplete = "off"
}) => {
  const [showPassword, setShowPassword] = reactExports.useState(false);
  const isPasswordField = type === "password";
  const inputType = isPasswordField && showPassword ? "text" : type;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: id, className: "text-white", children: label }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
      icon && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute left-3 top-1/2 -translate-y-1/2 text-white/50", children: icon }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          id,
          type: inputType,
          placeholder,
          value,
          onChange,
          className: `bg-black/50 border-white/10 text-white ${icon ? "pl-10" : "pl-3"} ${isPasswordField ? "pr-10" : ""}`,
          required,
          disabled,
          autoComplete,
          autoCorrect: "off",
          spellCheck: false,
          "data-form-type": "other"
        }
      ),
      isPasswordField && /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          type: "button",
          onClick: () => setShowPassword(!showPassword),
          className: "absolute right-3 top-1/2 -translate-y-1/2 text-white/50 hover:text-white/80 transition-colors",
          tabIndex: -1,
          "aria-label": showPassword ? "Nascondi password" : "Mostra password",
          children: showPassword ? /* @__PURE__ */ jsxRuntimeExports.jsx(EyeOff, { className: "h-4 w-4" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "h-4 w-4" })
        }
      )
    ] }),
    error && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-500 text-xs mt-1", children: error })
  ] });
};

function StandardLoginForm({ verificationStatus }) {
  const [email, setEmail] = reactExports.useState("");
  const [password, setPassword] = reactExports.useState("");
  const [showPassword, setShowPassword] = reactExports.useState(false);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const { navigate } = useWouterNavigation();
  const { login } = useAuthContext();
  const sanitizeEmail = (email2) => {
    return email2.toLowerCase().trim().replace(/[^\w@.-]/g, "");
  };
  const handleSubmit = async (e) => {
    e.preventDefault();
    const cleanEmail = sanitizeEmail(email);
    const cleanPassword = password.trim();
    if (!cleanEmail || !cleanPassword) {
      ue.error("Tutti i campi sono obbligatori");
      return;
    }
    if (!/\S+@\S+\.\S+/.test(cleanEmail)) {
      ue.error("Formato email non valido");
      return;
    }
    setIsLoading(true);
    try {
      const result = await login(cleanEmail, cleanPassword);
      if (!result.success) {
        ue.error("Errore di login", {
          description: result.error?.message || "Credenziali non valide"
        });
        return;
      }
      ue.success("Login effettuato con successo", {
        description: "Benvenuto in M1SSION!"
      });
      window.dispatchEvent(new CustomEvent("auth-success", {
        detail: { timestamp: Date.now() }
      }));
      const params = new URLSearchParams(window.location.search);
      const qRedirect = params.get("redirect");
      let target = qRedirect || "";
      if (!target) {
        try {
          target = localStorage.getItem("post_login_redirect") || "";
          if (target) localStorage.removeItem("post_login_redirect");
        } catch {
        }
      }
      const finalTarget = target || "/home";
      navigate(finalTarget);
      if (window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true) {
        setTimeout(() => {
          if (window.location.pathname === "/login") {
            window.location.href = finalTarget;
          }
        }, 800);
      }
    } catch (error) {
      ue.error("Errore di sistema", {
        description: error.message || "Si  verificato un errore imprevisto"
      });
    } finally {
      setIsLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "email",
        label: "Email",
        type: "email",
        placeholder: "Inserisci la tua email",
        value: email,
        onChange: (e) => setEmail(e.target.value),
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "h-4 w-4" }),
        required: true,
        disabled: isLoading,
        autoComplete: "email"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        FormField,
        {
          id: "password",
          label: "Password",
          type: showPassword ? "text" : "password",
          placeholder: "Inserisci la password",
          value: password,
          onChange: (e) => setPassword(e.target.value),
          icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "h-4 w-4" }),
          required: true,
          disabled: isLoading,
          autoComplete: "current-password"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          type: "button",
          className: "flex items-center gap-2 text-sm text-white/70 hover:text-white transition-colors",
          onClick: () => setShowPassword(!showPassword),
          children: [
            showPassword ? /* @__PURE__ */ jsxRuntimeExports.jsx(EyeOff, { className: "h-4 w-4" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "h-4 w-4" }),
            showPassword ? "Nascondi password" : "Mostra password"
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          type: "submit",
          className: "w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 font-bold text-lg py-3 rounded-xl neon-button-cyan",
          disabled: isLoading,
          children: isLoading ? "Caricamento..." : "Accedi"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          type: "button",
          onClick: () => navigate("/register"),
          className: "w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 font-bold text-lg py-3 rounded-xl transition-all duration-300",
          disabled: isLoading,
          children: "Registrati - Accesso limitato"
        }
      )
    ] })
  ] });
}

const BackgroundParticles = ({ count = 15 }) => {
  const [particles, setParticles] = reactExports.useState([]);
  reactExports.useEffect(() => {
    const generatedParticles = Array.from({ length: count }, (_, i) => ({
      id: i,
      size: Math.random() * 4 + 2,
      top: Math.random() * 100,
      left: Math.random() * 100,
      delay: Math.random() * 5,
      duration: Math.random() * 15 + 10,
      color: i % 3 === 0 ? "#00E5FF" : i % 3 === 1 ? "#FFC300" : "#FF00FF",
      parallaxSpeed: Math.random() * 0.3 + 0.1,
      blur: Math.random() * 2 + 1
    }));
    setParticles(generatedParticles);
  }, [count]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 z-0 pointer-events-none overflow-hidden", children: particles.map((particle) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      className: "absolute rounded-full",
      style: {
        width: `${particle.size}px`,
        height: `${particle.size}px`,
        backgroundColor: particle.color,
        boxShadow: `0 0 ${particle.size + 4}px ${particle.color}`,
        filter: `blur(${particle.blur}px)`,
        top: `${particle.top}%`,
        left: `${particle.left}%`
      },
      animate: {
        y: [0, -30, 0, 30, 0],
        x: [0, 15, 30, 15, 0],
        opacity: [0.4, 0.8, 0.6, 0.9, 0.4]
      },
      transition: {
        duration: particle.duration,
        ease: "easeInOut",
        times: [0, 0.2, 0.5, 0.8, 1],
        repeat: Infinity,
        delay: particle.delay
      },
      "data-parallax": "background",
      "data-parallax-speed": -particle.parallaxSpeed
    },
    particle.id
  )) });
};

const AdminEmergencyLogin = ({ onClose }) => {
  const [isLogging, setIsLogging] = reactExports.useState(false);
  const { login } = useUnifiedAuth();
  useWouterNavigation();
  reactExports.useEffect(() => {
    const handleKeyPress = (e) => {
      if (e.key === "Escape" && onClose) {
        onClose();
      }
    };
    document.addEventListener("keydown", handleKeyPress);
    return () => document.removeEventListener("keydown", handleKeyPress);
  }, [onClose]);
  const handleEmergencyLogin = async () => {
    setIsLogging(true);
    try {
      const result = await login("wikus77@hotmail.it", "Wikus@190877");
      if (result.success) {
        localStorage.setItem("emergency_admin_access", "true");
        window.location.href = "/push-test?emergency=admin";
      } else {
        alert("Emergency login failed: " + (result.error?.message || "Unknown error"));
      }
    } catch (error) {
      alert("Emergency login exception: " + error);
    } finally {
      setIsLogging(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/90 flex items-center justify-center z-50", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-red-900 border border-red-500 rounded-lg p-6 max-w-md relative", children: [
    onClose && /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        onClick: onClose,
        className: "absolute top-2 right-2 text-red-300 hover:text-white text-2xl",
        children: ""
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-white text-xl font-bold mb-4", children: " EMERGENCY ADMIN ACCESS" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-200 mb-4", children: "Sistema di bypass d'emergenza per accesso sviluppatore immediato" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        onClick: handleEmergencyLogin,
        disabled: isLogging,
        className: "w-full bg-red-600 hover:bg-red-700 disabled:bg-red-800 text-white font-bold py-2 px-4 rounded transition-colors mb-4",
        children: isLogging ? " Accesso in corso..." : " ACCESSO EMERGENCY"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300 text-xs", children: "wikus77@hotmail.it / Wikus@190877" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-400 text-xs mt-2", children: "Premi ESC per chiudere" })
  ] }) });
};

const KEY = "post_login_redirect";
function consumePostLoginRedirect() {
  try {
    const target = localStorage.getItem(KEY);
    if (target) localStorage.removeItem(KEY);
    return target;
  } catch {
    return null;
  }
}
function postLoginRedirectFixed(navigate) {
  const target = consumePostLoginRedirect() || "/home";
  try {
    navigate(target);
  } catch {
    window.location.href = target;
  }
}

const M1LogoSplash = ({
  onComplete,
  duration = 8e3
}) => {
  const [isVisible, setIsVisible] = reactExports.useState(true);
  const [isFading, setIsFading] = reactExports.useState(false);
  const [videoError, setVideoError] = reactExports.useState(false);
  const videoRef = reactExports.useRef(null);
  const hasEndedRef = reactExports.useRef(false);
  const handleComplete = () => {
    if (hasEndedRef.current) return;
    hasEndedRef.current = true;
    setIsFading(true);
    setTimeout(() => {
      setIsVisible(false);
      onComplete();
    }, 500);
  };
  reactExports.useEffect(() => {
    const fallbackTimer = setTimeout(() => {
      if (!hasEndedRef.current) {
        handleComplete();
      }
    }, duration);
    return () => clearTimeout(fallbackTimer);
  }, [duration]);
  const handleVideoEnded = () => {
    handleComplete();
  };
  const handleVideoError = () => {
    setVideoError(true);
    setTimeout(handleComplete, 2e3);
  };
  reactExports.useEffect(() => {
    const video = videoRef.current;
    if (video) {
      video.play().catch((err) => {
        video.muted = true;
        video.play().catch(handleVideoError);
      });
    }
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isVisible && /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "fixed inset-0 z-[99999] flex items-center justify-center bg-black overflow-hidden",
      initial: { opacity: 1 },
      animate: { opacity: isFading ? 0 : 1 },
      exit: { opacity: 0 },
      transition: { duration: 0.5 },
      children: [
        !videoError ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "video",
            {
              ref: videoRef,
              playsInline: true,
              autoPlay: true,
              muted: true,
              onEnded: handleVideoEnded,
              onError: handleVideoError,
              preload: "auto",
              style: {
                position: "absolute",
                top: "50%",
                left: "50%",
                transform: "translate(-50%, -50%)",
                width: "100%",
                height: "100%",
                objectFit: "contain",
                backgroundColor: "black",
                zIndex: 1
              },
              src: "/videos/m1-intro.mov"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "div",
            {
              style: {
                position: "absolute",
                top: 0,
                left: 0,
                right: 0,
                height: "40%",
                background: "linear-gradient(to bottom, #000000 0%, #000000 30%, rgba(0,0,0,0.95) 50%, rgba(0,0,0,0.7) 70%, rgba(0,0,0,0.3) 85%, rgba(0,0,0,0) 100%)",
                pointerEvents: "none",
                zIndex: 100
              }
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "div",
            {
              style: {
                position: "absolute",
                bottom: 0,
                left: 0,
                right: 0,
                height: "40%",
                background: "linear-gradient(to top, #000000 0%, #000000 30%, rgba(0,0,0,0.95) 50%, rgba(0,0,0,0.7) 70%, rgba(0,0,0,0.3) 85%, rgba(0,0,0,0) 100%)",
                pointerEvents: "none",
                zIndex: 100
              }
            }
          )
        ] }) : (
          // Fallback: Simple logo if video fails
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "flex flex-col items-center justify-center",
              initial: { opacity: 0, scale: 0.8 },
              animate: { opacity: 1, scale: 1 },
              transition: { duration: 0.5 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center mb-8", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "span",
                    {
                      className: "text-8xl font-bold text-cyan-400",
                      style: {
                        textShadow: "0 0 40px rgba(0, 209, 255, 0.8), 0 0 80px rgba(0, 209, 255, 0.4)",
                        fontFamily: "Inter, sans-serif"
                      },
                      children: "M"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "span",
                    {
                      className: "text-8xl font-bold text-white",
                      style: {
                        textShadow: "0 0 20px rgba(255, 255, 255, 0.5)",
                        fontFamily: "Inter, sans-serif"
                      },
                      children: "1"
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "p",
                  {
                    className: "text-xl tracking-[0.3em] text-amber-500",
                    style: {
                      fontFamily: "Orbitron, sans-serif",
                      textShadow: "0 0 20px rgba(218, 165, 32, 0.6)"
                    },
                    children: "IT IS POSSIBLE"
                  }
                )
              ]
            }
          )
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute bottom-8 text-white/40 text-xs",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 1 }
          }
        )
      ]
    }
  ) });
};

const Login = () => {
  const [verificationStatus, setVerificationStatus] = reactExports.useState(null);
  const [showEmergencyLogin, setShowEmergencyLogin] = reactExports.useState(false);
  const [showSplash, setShowSplash] = reactExports.useState(true);
  const { navigate } = useWouterNavigation();
  const { isAuthenticated, isLoading } = useUnifiedAuth();
  const searchParams = new URLSearchParams(window.location.search);
  const redirectAttemptedRef = reactExports.useRef(false);
  const fallbackTimerRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    if (isAuthenticated && !isLoading && !redirectAttemptedRef.current && !showSplash) {
      redirectAttemptedRef.current = true;
      postLoginRedirectFixed(navigate);
    }
  }, [isAuthenticated, isLoading, showSplash]);
  reactExports.useEffect(() => {
    if (isAuthenticated && !isLoading && window.location.pathname === "/login") {
      fallbackTimerRef.current = setTimeout(() => {
        if (window.location.pathname === "/login" && isAuthenticated) {
          postLoginRedirectFixed(navigate);
        }
      }, 2e3);
      return () => {
        if (fallbackTimerRef.current) {
          clearTimeout(fallbackTimerRef.current);
          fallbackTimerRef.current = null;
        }
      };
    }
  }, [isAuthenticated, isLoading]);
  reactExports.useEffect(() => {
    const verification = searchParams.get("verification");
    if (verification === "pending") {
      setVerificationStatus("pending");
    } else if (verification === "success") {
      setVerificationStatus("success");
      ue.success("Email verificata", {
        description: "La tua email  stata verificata con successo."
      });
    }
  }, [navigate]);
  const handleSplashComplete = () => {
    setShowSplash(false);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen flex items-center justify-center bg-black px-4 py-12 relative overflow-hidden", children: [
    showSplash && /* @__PURE__ */ jsxRuntimeExports.jsx(
      M1LogoSplash,
      {
        onComplete: handleSplashComplete,
        duration: 7e3
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(BackgroundParticles, { count: 15 }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "w-full max-w-md z-10",
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.5 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatedLogo, {}) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-2xl font-bold mb-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF] drop-shadow-[0_0_10px_rgba(0,229,255,0.8)]", children: "M1" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: "SSION" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Accedi per iniziare la tua missione" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            "div",
            {
              className: "m1-relief p-6 rounded-xl relative",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(StandardLoginForm, { verificationStatus }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 text-center space-y-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-white/70", children: [
                    "Non hai un account?",
                    " ",
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/register", className: "text-cyan-400 hover:text-cyan-300 transition-colors", children: "Registrati" })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/50", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/landing", className: "text-cyan-400 hover:text-cyan-300 transition-colors", children: " Torna alla homepage" }) })
                ] })
              ]
            }
          )
        ]
      }
    ),
    showEmergencyLogin && /* @__PURE__ */ jsxRuntimeExports.jsx(AdminEmergencyLogin, { onClose: () => setShowEmergencyLogin(false) })
  ] });
};

async function getActiveSubscription(supabase, userId) {
  const { data, error } = await supabase.from("subscriptions").select("id,tier,status,created_at").eq("user_id", userId).eq("status", "active").order("created_at", { ascending: false }).limit(1).maybeSingle();
  if (error) {
    return { hasActive: false, plan: null };
  }
  return { hasActive: !!data, plan: data?.tier ?? null };
}

const AccessBlockedView = ({
  subscriptionPlan,
  accessStartDate,
  timeUntilAccess
}) => {
  const { navigate } = useWouterNavigation();
  const { getCurrentUser } = useUnifiedAuth();
  const [realPlanName, setRealPlanName] = reactExports.useState("Free");
  reactExports.useEffect(() => {
    async function fetchRealPlan() {
      const user = getCurrentUser();
      if (user?.id) {
        const { data: userData } = await supabase.auth.getUser();
        if (userData.user?.email === "wikus77@hotmail.it") {
          return null;
        }
        const result = await getActiveSubscription(supabase, user.id);
        const plan = result.plan || "free";
        setRealPlanName(plan);
        if (plan === "free" && window.location.pathname !== "/choose-plan") {
          navigate("/home", { replace: true });
          return;
        }
      }
    }
    fetchRealPlan();
  }, [getCurrentUser, navigate]);
  const formatTimeRemaining = (milliseconds) => {
    const days = Math.floor(milliseconds / (1e3 * 60 * 60 * 24));
    const hours = Math.floor(milliseconds % (1e3 * 60 * 60 * 24) / (1e3 * 60 * 60));
    const minutes = Math.floor(milliseconds % (1e3 * 60 * 60) / (1e3 * 60));
    if (days > 0) return `${days} giorni, ${hours} ore`;
    if (hours > 0) return `${hours} ore, ${minutes} minuti`;
    return `${minutes} minuti`;
  };
  const getPlanDisplayName = (plan) => {
    switch (plan.toUpperCase()) {
      case "SILVER":
        return "Silver";
      case "GOLD":
        return "Gold";
      case "BLACK":
        return "Black";
      case "TITANIUM":
        return "Titanium";
      case "FREE":
        return "Free";
      default:
        return "Free";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black px-4 py-12", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "w-full max-w-md text-center",
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "mx-auto mb-6 w-20 h-20 bg-yellow-500/20 rounded-full flex items-center justify-center",
            initial: { scale: 0 },
            animate: { scale: 1 },
            transition: { delay: 0.2, type: "spring" },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-10 h-10 text-yellow-400" })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white mb-4", children: " Accesso non ancora disponibile" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-300 mb-6", children: [
          "L'accesso alla missione non  ancora disponibile per il tuo piano ",
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-semibold text-cyan-400", children: getPlanDisplayName(realPlanName) }),
          "."
        ] }),
        timeUntilAccess && timeUntilAccess > 0 && accessStartDate && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "bg-gray-900/50 border border-gray-700 rounded-lg p-4 mb-6",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 0.4 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 mb-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-5 h-5 text-cyan-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 font-semibold", children: "Accesso disponibile tra:" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xl font-mono text-white", children: formatTimeRemaining(timeUntilAccess) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-gray-400 mt-2", children: [
                "Data di sblocco: ",
                accessStartDate.toLocaleDateString("it-IT", {
                  day: "2-digit",
                  month: "long",
                  year: "numeric",
                  hour: "2-digit",
                  minute: "2-digit"
                })
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-6",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 0.6 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 mb-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "w-5 h-5 text-blue-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-blue-400 font-semibold", children: "Ti avviseremo!" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-blue-300", children: "Riceverai una notifica push e una email quando potrai iniziare la tua missione." })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
          (realPlanName.toLowerCase() === "base" || realPlanName.toLowerCase() === "free") && /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: () => {
                navigate("/choose-plan?from=access-blocked&current_plan=" + encodeURIComponent(realPlanName));
              },
              className: "w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105",
              children: " Aggiorna il tuo piano per accesso anticipato"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: "outline",
              onClick: () => navigate("/home", { replace: true }),
              className: "w-full border-gray-600 text-gray-300 hover:bg-gray-800 pointer-events-auto z-10",
              style: { pointerEvents: "auto" },
              children: " Torna alla homepage"
            }
          )
        ] })
      ]
    }
  ) });
};

const ProtectedRoute = ({ children }) => {
  const { isAuthenticated, isLoading: authLoading, getCurrentUser } = useUnifiedAuth();
  const { canAccess, isLoading: accessLoading, subscriptionPlan, accessStartDate, timeUntilAccess } = useAccessControl();
  const [location, setLocation] = useLocation();
  const user = getCurrentUser();
  const isAdminUser = user?.email === "wikus77@hotmail.it";
  React$1.useEffect(() => {
    if (!authLoading && !accessLoading) {
      if (isAdminUser) {
        return;
      }
      if (!isAuthenticated && location !== "/login") {
        setLocation("/login");
      } else if (isAuthenticated && (!subscriptionPlan || subscriptionPlan === "") && location !== "/choose-plan" && subscriptionPlan !== "ADMIN") {
        setLocation("/choose-plan");
      }
    }
  }, [isAuthenticated, authLoading, accessLoading, subscriptionPlan, location, setLocation, isAdminUser]);
  React$1.useEffect(() => {
    if (!isAuthenticated && !authLoading) {
      sessionStorage.removeItem("hasSeenPostLoginIntro");
    }
  }, [isAuthenticated, authLoading]);
  if (isAdminUser) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
  }
  if (!authLoading && !isAuthenticated) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {});
  }
  if (authLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white", children: "Verifica accesso..." }) });
  }
  if (isAuthenticated && accessLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white", children: "Verifica permessi..." }) });
  }
  if (!canAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      AccessBlockedView,
      {
        subscriptionPlan,
        accessStartDate,
        timeUntilAccess
      }
    );
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
};

const AdminProtectedRoute = ({
  children,
  fallbackPath = "/home"
}) => {
  const { isAuthenticated, isLoading, getCurrentUser } = useUnifiedAuth();
  const [, setLocation] = useLocation();
  const user = getCurrentUser();
  const userEmail = user?.email;
  const isAdmin = isAdminEmail(userEmail);
  reactExports.useEffect(() => {
    if (!isLoading && !isAuthenticated) {
      setLocation("/login");
    }
  }, [isAuthenticated, isLoading, isAdmin, userEmail, setLocation]);
  if (isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white text-sm", children: "Verifica accesso admin..." }) });
  }
  if (!isAuthenticated) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white text-sm", children: "Reindirizzamento..." }) });
  }
  if (!isAdmin) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex flex-col items-center justify-center bg-black text-white p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-4xl", children: "" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-xl font-bold", children: "Accesso Non Autorizzato" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm max-w-md", children: "Questa sezione  riservata agli amministratori di M1SSION." }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => setLocation(fallbackPath),
          className: "mt-4 px-6 py-2 bg-gradient-to-r from-pink-500 to-purple-600 rounded-lg font-medium hover:opacity-90 transition-opacity",
          children: "Torna alla Home"
        }
      )
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
};

const preserveFunctionName = (fn, name) => {
  return fn;
};
const detectPWAEnvironment = () => {
  if (typeof window === "undefined") return false;
  return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true || document.referrer.includes("android-app://");
};
const getPWASafeAreaInsets$1 = () => {
  if (typeof window === "undefined") {
    return { top: 0, bottom: 0, left: 0, right: 0 };
  }
  const getInset = (side) => {
    const value = getComputedStyle(document.documentElement).getPropertyValue(`--safe-area-inset-${side}`).trim();
    if (value && value !== `env(safe-area-inset-${side})`) {
      return parseInt(value.replace("px", "")) || 0;
    }
    return 0;
  };
  return {
    top: getInset("top"),
    bottom: getInset("bottom"),
    left: getInset("left"),
    right: getInset("right")
  };
};

const IOSSafeAreaOverlay = ({
  children,
  visible = false,
  opacity = 0.3
}) => {
  if (!new URLSearchParams(window.location.search).get("diag")) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
  }
  const [safeArea, setSafeArea] = reactExports.useState({ top: 0, bottom: 0, left: 0, right: 0 });
  const [isCapacitor, setIsCapacitor] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const updateSafeArea = () => {
      const insets = getPWASafeAreaInsets$1();
      setSafeArea(insets);
      setIsCapacitor(detectPWAEnvironment());
    };
    updateSafeArea();
    const handleOrientationChange = () => {
      setTimeout(updateSafeArea, 100);
    };
    window.addEventListener("orientationchange", handleOrientationChange);
    window.addEventListener("resize", updateSafeArea);
    return () => {
      window.removeEventListener("orientationchange", handleOrientationChange);
      window.removeEventListener("resize", updateSafeArea);
    };
  }, []);
  if (!visible || !isCapacitor) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    children,
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "fixed inset-0 pointer-events-none z-[9998]", children: [
      safeArea.top > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute top-0 left-0 right-0 bg-red-500 flex items-center justify-center",
          style: {
            height: `${safeArea.top}px`,
            opacity
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white text-xs font-mono", children: [
            "TOP SAFE AREA (",
            safeArea.top,
            "px)"
          ] })
        }
      ),
      safeArea.bottom > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute bottom-0 left-0 right-0 bg-blue-500 flex items-center justify-center",
          style: {
            height: `${safeArea.bottom}px`,
            opacity
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white text-xs font-mono", children: [
            "BOTTOM SAFE AREA (",
            safeArea.bottom,
            "px)"
          ] })
        }
      ),
      safeArea.left > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute top-0 bottom-0 left-0 bg-green-500 flex items-center justify-center",
          style: {
            width: `${safeArea.left}px`,
            opacity,
            writingMode: "vertical-rl",
            textOrientation: "mixed"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white text-xs font-mono", children: [
            "LEFT (",
            safeArea.left,
            "px)"
          ] })
        }
      ),
      safeArea.right > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute top-0 bottom-0 right-0 bg-yellow-500 flex items-center justify-center",
          style: {
            width: `${safeArea.right}px`,
            opacity,
            writingMode: "vertical-lr",
            textOrientation: "mixed"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white text-xs font-mono", children: [
            "RIGHT (",
            safeArea.right,
            "px)"
          ] })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute top-16 left-4 bg-black bg-opacity-80 text-white p-2 rounded text-xs font-mono", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          "Platform: ",
          isCapacitor ? "Capacitor" : "Web"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          "Orientation: ",
          window.innerWidth > window.innerHeight ? "Landscape" : "Portrait"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          "Viewport: ",
          window.innerWidth,
          "",
          window.innerHeight
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          "Safe Area: T",
          safeArea.top,
          " B",
          safeArea.bottom,
          " L",
          safeArea.left,
          " R",
          safeArea.right
        ] })
      ] })
    ] })
  ] });
};

const getPWASafeAreaInsets = () => {
  if (typeof window === "undefined") {
    return { top: 0, bottom: 0, left: 0, right: 0 };
  }
  const getInset = (side) => {
    const value = getComputedStyle(document.documentElement).getPropertyValue(`--safe-area-inset-${side}`).trim();
    if (value && value !== `env(safe-area-inset-${side})`) {
      return parseInt(value.replace("px", "")) || 0;
    }
    return 0;
  };
  return {
    top: getInset("top"),
    bottom: getInset("bottom"),
    left: getInset("left"),
    right: getInset("right")
  };
};
const optimizePWATouchGestures = () => {
  if (typeof window === "undefined") return;
  let lastTouchEnd = 0;
  document.addEventListener("touchend", (e) => {
    const now = (/* @__PURE__ */ new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
      e.preventDefault();
    }
    lastTouchEnd = now;
  }, false);
  document.body.style.overscrollBehavior = "none";
  document.body.style.touchAction = "manipulation";
};
const initializePWA = async () => {
  try {
    optimizePWATouchGestures();
    const viewport = document.querySelector('meta[name="viewport"]');
    if (viewport) {
      viewport.setAttribute(
        "content",
        "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
      );
    }
    return true;
  } catch (error) {
    return false;
  }
};

const pwaNativeFunctions = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  getPWASafeAreaInsets,
  initializePWA,
  optimizePWATouchGestures
}, Symbol.toStringTag, { value: 'Module' }));

const SafeAreaWrapper = ({
  children,
  className = "",
  top = true,
  bottom = true,
  left = true,
  right = true,
  debug = false
}) => {
  const [safeArea, setSafeArea] = reactExports.useState({ top: 0, bottom: 0, left: 0, right: 0 });
  const [isPWA, setIsPWA] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const updateSafeArea = () => {
      const insets = getPWASafeAreaInsets();
      setSafeArea(insets);
      setIsPWA(window.matchMedia("(display-mode: standalone)").matches);
    };
    updateSafeArea();
    const handleOrientationChange = () => {
      setTimeout(updateSafeArea, 100);
    };
    window.addEventListener("orientationchange", handleOrientationChange);
    window.addEventListener("resize", updateSafeArea);
    return () => {
      window.removeEventListener("orientationchange", handleOrientationChange);
      window.removeEventListener("resize", updateSafeArea);
    };
  }, [debug]);
  const paddingStyle = isPWA ? {
    paddingTop: void 0,
    // Background extends into safe area
    paddingBottom: bottom ? `${safeArea.bottom}px` : void 0,
    paddingLeft: left ? `${safeArea.left}px` : void 0,
    paddingRight: right ? `${safeArea.right}px` : void 0
  } : {};
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `safe-area-wrapper ${className}`,
      style: paddingStyle,
      children: [
        debug && isPWA && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "fixed top-0 left-0 z-[10000] bg-red-500 text-white text-xs p-2", children: [
          "Safe Area: T:",
          safeArea.top,
          " B:",
          safeArea.bottom,
          " L:",
          safeArea.left,
          " R:",
          safeArea.right
        ] }),
        children
      ]
    }
  );
};

const useProfileNotifications = () => {
  const [showNotifications, setShowNotifications] = reactExports.useState(false);
  return {
    showNotifications,
    setShowNotifications
  };
};

function useNotificationManager() {
  const { showNotifications, setShowNotifications } = useProfileNotifications();
  const {
    notifications,
    unreadCount,
    markAllAsRead,
    markAsRead,
    addNotification,
    deleteNotification,
    reloadNotifications
  } = useNotifications();
  const [notificationsBannerOpen, setNotificationsBannerOpen] = reactExports.useState(false);
  const pollingIntervalRef = reactExports.useRef(null);
  const isInitialLoadDone = reactExports.useRef(false);
  reactExports.useEffect(() => {
    const startPolling = () => {
      if (pollingIntervalRef.current) {
        clearInterval(pollingIntervalRef.current);
      }
      pollingIntervalRef.current = window.setInterval(() => {
        if (document.visibilityState === "visible") {
          reloadNotifications();
        }
      }, 5e3);
    };
    if (!isInitialLoadDone.current) {
      reloadNotifications().then(() => {
        isInitialLoadDone.current = true;
        startPolling();
      });
    }
    return () => {
      if (pollingIntervalRef.current) {
        clearInterval(pollingIntervalRef.current);
      }
    };
  }, [reloadNotifications]);
  const openNotificationsBanner = reactExports.useCallback(() => {
    setNotificationsBannerOpen(true);
  }, []);
  const closeNotificationsBanner = reactExports.useCallback(() => {
    setNotificationsBannerOpen(false);
  }, []);
  const openNotificationsDrawer = reactExports.useCallback(() => {
    setShowNotifications(true);
    reloadNotifications();
  }, [setShowNotifications, reloadNotifications]);
  const closeNotificationsDrawer = reactExports.useCallback(() => {
    setShowNotifications(false);
    markAllAsRead().then(() => {
    });
  }, [setShowNotifications, markAllAsRead]);
  const createNotification = reactExports.useCallback(async (title, description, type = NOTIFICATION_CATEGORIES$1.GENERIC) => {
    ue(title, {
      description
    });
    try {
      const result = await addNotification({
        title,
        description,
        type
      });
      if (result) {
        setTimeout(() => {
          reloadNotifications();
        }, 500);
      } else {
      }
      return result;
    } catch (error) {
      return false;
    }
  }, [addNotification, reloadNotifications]);
  const createBuzzNotification = reactExports.useCallback(async (title, description) => {
    return await createNotification(title, description, NOTIFICATION_CATEGORIES$1.BUZZ);
  }, [createNotification]);
  const createMapBuzzNotification = reactExports.useCallback(async (title, description) => {
    return await createNotification(title, description, NOTIFICATION_CATEGORIES$1.MAP_BUZZ);
  }, [createNotification]);
  const createLeaderboardNotification = reactExports.useCallback(async (title, description) => {
    return await createNotification(title, description, NOTIFICATION_CATEGORIES$1.LEADERBOARD);
  }, [createNotification]);
  const createWeeklyNotification = reactExports.useCallback(async (title, description) => {
    return await createNotification(title, description, NOTIFICATION_CATEGORIES$1.WEEKLY);
  }, [createNotification]);
  const manualReload = reactExports.useCallback(async () => {
    return await reloadNotifications();
  }, [reloadNotifications]);
  return {
    // Notification data
    notifications,
    unreadCount,
    // Banner controls
    notificationsBannerOpen,
    openNotificationsBanner,
    closeNotificationsBanner,
    // Drawer controls
    notificationsDrawerOpen: showNotifications,
    openNotificationsDrawer,
    closeNotificationsDrawer,
    // Actions
    markAllAsRead,
    markAsRead,
    deleteNotification,
    // Create notifications by category
    createNotification,
    // Generic
    createBuzzNotification,
    createMapBuzzNotification,
    createLeaderboardNotification,
    createWeeklyNotification,
    reloadNotifications: manualReload
  };
}

const Card = reactExports.forwardRef(({ className, gradient = false, interactive = false, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
  motion.div,
  {
    ref,
    className: cn(
      "m1ssion-glass-card overflow-hidden transition-all duration-300 card-hover-effect relative rounded-[24px]",
      className
    ),
    whileHover: interactive ? {
      scale: 1.03,
      boxShadow: "0 0 25px rgba(0, 209, 255, 0.4), 0 0 50px rgba(123, 46, 255, 0.2)"
    } : {},
    whileTap: interactive ? { scale: 0.97 } : {},
    transition: { duration: 0.3, ease: "easeOut" },
    ...props,
    children: [
      gradient && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "relative",
          whileHover: interactive ? { y: -2 } : {},
          transition: { duration: 0.2 },
          children
        }
      )
    ]
  }
));
Card.displayName = "Card";
const CardHeader = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    ref,
    className: cn("flex flex-col space-y-1.5 p-6", className),
    ...props
  }
));
CardHeader.displayName = "CardHeader";
const CardTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "h3",
  {
    ref,
    className: cn(
      "text-2xl font-semibold leading-none tracking-tight gradient-text-cyan glow-text",
      className
    ),
    ...props
  }
));
CardTitle.displayName = "CardTitle";
const CardDescription = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "p",
  {
    ref,
    className: cn("text-sm text-white/70", className),
    ...props
  }
));
CardDescription.displayName = "CardDescription";
const CardContent = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { ref, className: cn("p-6 pt-0", className), ...props }));
CardContent.displayName = "CardContent";
const CardFooter = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    ref,
    className: cn("flex items-center p-6 pt-0", className),
    ...props
  }
));
CardFooter.displayName = "CardFooter";

// src/create-context.tsx
function createContextScope$1(scopeName, createContextScopeDeps = []) {
  let defaultContexts = [];
  function createContext3(rootComponentName, defaultContext) {
    const BaseContext = reactExports.createContext(defaultContext);
    BaseContext.displayName = rootComponentName + "Context";
    const index = defaultContexts.length;
    defaultContexts = [...defaultContexts, defaultContext];
    const Provider = (props) => {
      const { scope, children, ...context } = props;
      const Context = scope?.[scopeName]?.[index] || BaseContext;
      const value = reactExports.useMemo(() => context, Object.values(context));
      return /* @__PURE__ */ jsxRuntimeExports.jsx(Context.Provider, { value, children });
    };
    Provider.displayName = rootComponentName + "Provider";
    function useContext2(consumerName, scope) {
      const Context = scope?.[scopeName]?.[index] || BaseContext;
      const context = reactExports.useContext(Context);
      if (context) return context;
      if (defaultContext !== void 0) return defaultContext;
      throw new Error(`\`${consumerName}\` must be used within \`${rootComponentName}\``);
    }
    return [Provider, useContext2];
  }
  const createScope = () => {
    const scopeContexts = defaultContexts.map((defaultContext) => {
      return reactExports.createContext(defaultContext);
    });
    return function useScope(scope) {
      const contexts = scope?.[scopeName] || scopeContexts;
      return reactExports.useMemo(
        () => ({ [`__scope${scopeName}`]: { ...scope, [scopeName]: contexts } }),
        [scope, contexts]
      );
    };
  };
  createScope.scopeName = scopeName;
  return [createContext3, composeContextScopes$1(createScope, ...createContextScopeDeps)];
}
function composeContextScopes$1(...scopes) {
  const baseScope = scopes[0];
  if (scopes.length === 1) return baseScope;
  const createScope = () => {
    const scopeHooks = scopes.map((createScope2) => ({
      useScope: createScope2(),
      scopeName: createScope2.scopeName
    }));
    return function useComposedScopes(overrideScopes) {
      const nextScopes = scopeHooks.reduce((nextScopes2, { useScope, scopeName }) => {
        const scopeProps = useScope(overrideScopes);
        const currentScope = scopeProps[`__scope${scopeName}`];
        return { ...nextScopes2, ...currentScope };
      }, {});
      return reactExports.useMemo(() => ({ [`__scope${baseScope.scopeName}`]: nextScopes }), [nextScopes]);
    };
  };
  createScope.scopeName = baseScope.scopeName;
  return createScope;
}

// src/slot.tsx
var REACT_LAZY_TYPE = Symbol.for("react.lazy");
var use = React[" use ".trim().toString()];
function isPromiseLike(value) {
  return typeof value === "object" && value !== null && "then" in value;
}
function isLazyComponent(element) {
  return element != null && typeof element === "object" && "$$typeof" in element && element.$$typeof === REACT_LAZY_TYPE && "_payload" in element && isPromiseLike(element._payload);
}
// @__NO_SIDE_EFFECTS__
function createSlot$1(ownerName) {
  const SlotClone = /* @__PURE__ */ createSlotClone$1(ownerName);
  const Slot2 = reactExports.forwardRef((props, forwardedRef) => {
    let { children, ...slotProps } = props;
    if (isLazyComponent(children) && typeof use === "function") {
      children = use(children._payload);
    }
    const childrenArray = reactExports.Children.toArray(children);
    const slottable = childrenArray.find(isSlottable$1);
    if (slottable) {
      const newElement = slottable.props.children;
      const newChildren = childrenArray.map((child) => {
        if (child === slottable) {
          if (reactExports.Children.count(newElement) > 1) return reactExports.Children.only(null);
          return reactExports.isValidElement(newElement) ? newElement.props.children : null;
        } else {
          return child;
        }
      });
      return /* @__PURE__ */ jsxRuntimeExports.jsx(SlotClone, { ...slotProps, ref: forwardedRef, children: reactExports.isValidElement(newElement) ? reactExports.cloneElement(newElement, void 0, newChildren) : null });
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SlotClone, { ...slotProps, ref: forwardedRef, children });
  });
  Slot2.displayName = `${ownerName}.Slot`;
  return Slot2;
}
// @__NO_SIDE_EFFECTS__
function createSlotClone$1(ownerName) {
  const SlotClone = reactExports.forwardRef((props, forwardedRef) => {
    let { children, ...slotProps } = props;
    if (isLazyComponent(children) && typeof use === "function") {
      children = use(children._payload);
    }
    if (reactExports.isValidElement(children)) {
      const childrenRef = getElementRef$1(children);
      const props2 = mergeProps$1(slotProps, children.props);
      if (children.type !== reactExports.Fragment) {
        props2.ref = forwardedRef ? composeRefs(forwardedRef, childrenRef) : childrenRef;
      }
      return reactExports.cloneElement(children, props2);
    }
    return reactExports.Children.count(children) > 1 ? reactExports.Children.only(null) : null;
  });
  SlotClone.displayName = `${ownerName}.SlotClone`;
  return SlotClone;
}
var SLOTTABLE_IDENTIFIER$2 = Symbol("radix.slottable");
function isSlottable$1(child) {
  return reactExports.isValidElement(child) && typeof child.type === "function" && "__radixId" in child.type && child.type.__radixId === SLOTTABLE_IDENTIFIER$2;
}
function mergeProps$1(slotProps, childProps) {
  const overrideProps = { ...childProps };
  for (const propName in childProps) {
    const slotPropValue = slotProps[propName];
    const childPropValue = childProps[propName];
    const isHandler = /^on[A-Z]/.test(propName);
    if (isHandler) {
      if (slotPropValue && childPropValue) {
        overrideProps[propName] = (...args) => {
          const result = childPropValue(...args);
          slotPropValue(...args);
          return result;
        };
      } else if (slotPropValue) {
        overrideProps[propName] = slotPropValue;
      }
    } else if (propName === "style") {
      overrideProps[propName] = { ...slotPropValue, ...childPropValue };
    } else if (propName === "className") {
      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(" ");
    }
  }
  return { ...slotProps, ...overrideProps };
}
function getElementRef$1(element) {
  let getter = Object.getOwnPropertyDescriptor(element.props, "ref")?.get;
  let mayWarn = getter && "isReactWarning" in getter && getter.isReactWarning;
  if (mayWarn) {
    return element.ref;
  }
  getter = Object.getOwnPropertyDescriptor(element, "ref")?.get;
  mayWarn = getter && "isReactWarning" in getter && getter.isReactWarning;
  if (mayWarn) {
    return element.props.ref;
  }
  return element.props.ref || element.ref;
}

// src/primitive.tsx
var NODES$2 = [
  "a",
  "button",
  "div",
  "form",
  "h2",
  "h3",
  "img",
  "input",
  "label",
  "li",
  "nav",
  "ol",
  "p",
  "select",
  "span",
  "svg",
  "ul"
];
var Primitive$2 = NODES$2.reduce((primitive, node) => {
  const Slot = createSlot$1(`Primitive.${node}`);
  const Node = reactExports.forwardRef((props, forwardedRef) => {
    const { asChild, ...primitiveProps } = props;
    const Comp = asChild ? Slot : node;
    if (typeof window !== "undefined") {
      window[Symbol.for("radix-ui")] = true;
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Comp, { ...primitiveProps, ref: forwardedRef });
  });
  Node.displayName = `Primitive.${node}`;
  return { ...primitive, [node]: Node };
}, {});

// src/use-is-hydrated.tsx
function useIsHydrated() {
  return shimExports.useSyncExternalStore(
    subscribe$1,
    () => true,
    () => false
  );
}
function subscribe$1() {
  return () => {
  };
}

var AVATAR_NAME = "Avatar";
var [createAvatarContext] = createContextScope$1(AVATAR_NAME);
var [AvatarProvider, useAvatarContext] = createAvatarContext(AVATAR_NAME);
var Avatar$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAvatar, ...avatarProps } = props;
    const [imageLoadingStatus, setImageLoadingStatus] = reactExports.useState("idle");
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      AvatarProvider,
      {
        scope: __scopeAvatar,
        imageLoadingStatus,
        onImageLoadingStatusChange: setImageLoadingStatus,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$2.span, { ...avatarProps, ref: forwardedRef })
      }
    );
  }
);
Avatar$1.displayName = AVATAR_NAME;
var IMAGE_NAME = "AvatarImage";
var AvatarImage$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAvatar, src, onLoadingStatusChange = () => {
    }, ...imageProps } = props;
    const context = useAvatarContext(IMAGE_NAME, __scopeAvatar);
    const imageLoadingStatus = useImageLoadingStatus(src, imageProps);
    const handleLoadingStatusChange = useCallbackRef((status) => {
      onLoadingStatusChange(status);
      context.onImageLoadingStatusChange(status);
    });
    useLayoutEffect2(() => {
      if (imageLoadingStatus !== "idle") {
        handleLoadingStatusChange(imageLoadingStatus);
      }
    }, [imageLoadingStatus, handleLoadingStatusChange]);
    return imageLoadingStatus === "loaded" ? /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$2.img, { ...imageProps, ref: forwardedRef, src }) : null;
  }
);
AvatarImage$1.displayName = IMAGE_NAME;
var FALLBACK_NAME = "AvatarFallback";
var AvatarFallback$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAvatar, delayMs, ...fallbackProps } = props;
    const context = useAvatarContext(FALLBACK_NAME, __scopeAvatar);
    const [canRender, setCanRender] = reactExports.useState(delayMs === void 0);
    reactExports.useEffect(() => {
      if (delayMs !== void 0) {
        const timerId = window.setTimeout(() => setCanRender(true), delayMs);
        return () => window.clearTimeout(timerId);
      }
    }, [delayMs]);
    return canRender && context.imageLoadingStatus !== "loaded" ? /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$2.span, { ...fallbackProps, ref: forwardedRef }) : null;
  }
);
AvatarFallback$1.displayName = FALLBACK_NAME;
function resolveLoadingStatus(image, src) {
  if (!image) {
    return "idle";
  }
  if (!src) {
    return "error";
  }
  if (image.src !== src) {
    image.src = src;
  }
  return image.complete && image.naturalWidth > 0 ? "loaded" : "loading";
}
function useImageLoadingStatus(src, { referrerPolicy, crossOrigin }) {
  const isHydrated = useIsHydrated();
  const imageRef = reactExports.useRef(null);
  const image = (() => {
    if (!isHydrated) return null;
    if (!imageRef.current) {
      imageRef.current = new window.Image();
    }
    return imageRef.current;
  })();
  const [loadingStatus, setLoadingStatus] = reactExports.useState(
    () => resolveLoadingStatus(image, src)
  );
  useLayoutEffect2(() => {
    setLoadingStatus(resolveLoadingStatus(image, src));
  }, [image, src]);
  useLayoutEffect2(() => {
    const updateStatus = (status) => () => {
      setLoadingStatus(status);
    };
    if (!image) return;
    const handleLoad = updateStatus("loaded");
    const handleError = updateStatus("error");
    image.addEventListener("load", handleLoad);
    image.addEventListener("error", handleError);
    if (referrerPolicy) {
      image.referrerPolicy = referrerPolicy;
    }
    if (typeof crossOrigin === "string") {
      image.crossOrigin = crossOrigin;
    }
    return () => {
      image.removeEventListener("load", handleLoad);
      image.removeEventListener("error", handleError);
    };
  }, [image, crossOrigin, referrerPolicy]);
  return loadingStatus;
}
var Root$2 = Avatar$1;
var Image = AvatarImage$1;
var Fallback = AvatarFallback$1;

const Avatar = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Root$2,
  {
    ref,
    className: cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    ),
    ...props
  }
));
Avatar.displayName = Root$2.displayName;
const AvatarImage = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Image,
  {
    ref,
    className: cn("aspect-square h-full w-full", className),
    ...props
  }
));
AvatarImage.displayName = Image.displayName;
const AvatarFallback = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Fallback,
  {
    ref,
    className: cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    ),
    ...props
  }
));
AvatarFallback.displayName = Fallback.displayName;

const ProfileAvatar = ({
  profileImage,
  className,
  disabled = false
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Avatar, { className: cn(
    "rounded-full border-2 border-[#00D1FF]/30",
    disabled && "opacity-50 cursor-not-allowed",
    className
  ), children: profileImage ? /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarImage, { src: profileImage, alt: "Profile" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarFallback, { className: "bg-gradient-to-r from-[#131524]/80 to-black/80", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "h-5 w-5 text-[#00D1FF]" }) }) });
};

function useToast() {
  const [toasts, setToasts] = reactExports.useState([]);
  const recentToasts = reactExports.useRef(/* @__PURE__ */ new Set());
  const toast2 = reactExports.useCallback(({
    title,
    description,
    variant = "default",
    duration = 4e3,
    action
  }) => {
    const content = title || description || "";
    const toastKey = `${variant}-${content}`;
    if (recentToasts.current.has(toastKey)) {
      return { id: "", dismiss: () => {
      }, update: () => {
      } };
    }
    recentToasts.current.add(toastKey);
    setTimeout(() => {
      recentToasts.current.delete(toastKey);
    }, 2e3);
    const id = Math.random().toString(36).substr(2, 9);
    switch (variant) {
      case "destructive":
        hapticError();
        ue.error(title || description || "Errore", {
          description: title ? description : void 0,
          duration
        });
        break;
      default:
        hapticSuccess();
        ue.success(title || description || "Successo", {
          description: title ? description : void 0,
          duration
        });
    }
    const newToast = { id, title, description, variant, duration, action };
    setToasts((prev) => [...prev, newToast]);
    setTimeout(() => {
      setToasts((prev) => prev.filter((t) => t.id !== id));
    }, duration);
    return {
      id,
      dismiss: () => setToasts((prev) => prev.filter((t) => t.id !== id)),
      update: (newToast2) => setToasts((prev) => prev.map((t) => t.id === id ? { ...t, ...newToast2 } : t))
    };
  }, []);
  return { toast: toast2, toasts };
}

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default: "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary: "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive: "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground"
      }
    },
    defaultVariants: {
      variant: "default"
    }
  }
);
function Badge({ className, variant, ...props }) {
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn(badgeVariants({ variant }), className), ...props });
}

const useReferralCode = () => {
  const [referralCode, setReferralCode] = reactExports.useState("");
  const [loading, setLoading] = reactExports.useState(true);
  const { toast } = useToast();
  reactExports.useEffect(() => {
    const fetchReferralCode = async () => {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        const { data, error } = await supabase.from("profiles").select("referral_code").eq("id", user.id).single();
        if (error) {
          return;
        }
        if (data?.referral_code) {
          setReferralCode(data.referral_code);
        }
      } catch (error) {
      } finally {
        setLoading(false);
      }
    };
    fetchReferralCode();
  }, []);
  const copyReferralCode = () => {
    if (referralCode) {
      navigator.clipboard.writeText(referralCode);
      toast({
        title: "Codice copiato!",
        description: `Il tuo codice referral ${referralCode}  stato copiato negli appunti.`
      });
    }
  };
  return {
    referralCode,
    loading,
    copyReferralCode
  };
};

// src/create-context.tsx
function createContextScope(scopeName, createContextScopeDeps = []) {
  let defaultContexts = [];
  function createContext3(rootComponentName, defaultContext) {
    const BaseContext = reactExports.createContext(defaultContext);
    BaseContext.displayName = rootComponentName + "Context";
    const index = defaultContexts.length;
    defaultContexts = [...defaultContexts, defaultContext];
    const Provider = (props) => {
      const { scope, children, ...context } = props;
      const Context = scope?.[scopeName]?.[index] || BaseContext;
      const value = reactExports.useMemo(() => context, Object.values(context));
      return /* @__PURE__ */ jsxRuntimeExports.jsx(Context.Provider, { value, children });
    };
    Provider.displayName = rootComponentName + "Provider";
    function useContext2(consumerName, scope) {
      const Context = scope?.[scopeName]?.[index] || BaseContext;
      const context = reactExports.useContext(Context);
      if (context) return context;
      if (defaultContext !== void 0) return defaultContext;
      throw new Error(`\`${consumerName}\` must be used within \`${rootComponentName}\``);
    }
    return [Provider, useContext2];
  }
  const createScope = () => {
    const scopeContexts = defaultContexts.map((defaultContext) => {
      return reactExports.createContext(defaultContext);
    });
    return function useScope(scope) {
      const contexts = scope?.[scopeName] || scopeContexts;
      return reactExports.useMemo(
        () => ({ [`__scope${scopeName}`]: { ...scope, [scopeName]: contexts } }),
        [scope, contexts]
      );
    };
  };
  createScope.scopeName = scopeName;
  return [createContext3, composeContextScopes(createScope, ...createContextScopeDeps)];
}
function composeContextScopes(...scopes) {
  const baseScope = scopes[0];
  if (scopes.length === 1) return baseScope;
  const createScope = () => {
    const scopeHooks = scopes.map((createScope2) => ({
      useScope: createScope2(),
      scopeName: createScope2.scopeName
    }));
    return function useComposedScopes(overrideScopes) {
      const nextScopes = scopeHooks.reduce((nextScopes2, { useScope, scopeName }) => {
        const scopeProps = useScope(overrideScopes);
        const currentScope = scopeProps[`__scope${scopeName}`];
        return { ...nextScopes2, ...currentScope };
      }, {});
      return reactExports.useMemo(() => ({ [`__scope${baseScope.scopeName}`]: nextScopes }), [nextScopes]);
    };
  };
  createScope.scopeName = baseScope.scopeName;
  return createScope;
}

// src/primitive.tsx
var NODES$1 = [
  "a",
  "button",
  "div",
  "form",
  "h2",
  "h3",
  "img",
  "input",
  "label",
  "li",
  "nav",
  "ol",
  "p",
  "select",
  "span",
  "svg",
  "ul"
];
var Primitive$1 = NODES$1.reduce((primitive, node) => {
  const Slot = createSlot$1(`Primitive.${node}`);
  const Node = reactExports.forwardRef((props, forwardedRef) => {
    const { asChild, ...primitiveProps } = props;
    const Comp = asChild ? Slot : node;
    if (typeof window !== "undefined") {
      window[Symbol.for("radix-ui")] = true;
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Comp, { ...primitiveProps, ref: forwardedRef });
  });
  Node.displayName = `Primitive.${node}`;
  return { ...primitive, [node]: Node };
}, {});

var PROGRESS_NAME = "Progress";
var DEFAULT_MAX = 100;
var [createProgressContext] = createContextScope(PROGRESS_NAME);
var [ProgressProvider, useProgressContext] = createProgressContext(PROGRESS_NAME);
var Progress$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeProgress,
      value: valueProp = null,
      max: maxProp,
      getValueLabel = defaultGetValueLabel,
      ...progressProps
    } = props;
    if ((maxProp || maxProp === 0) && !isValidMaxNumber(maxProp)) {
      console.error(getInvalidMaxError(`${maxProp}`, "Progress"));
    }
    const max = isValidMaxNumber(maxProp) ? maxProp : DEFAULT_MAX;
    if (valueProp !== null && !isValidValueNumber(valueProp, max)) {
      console.error(getInvalidValueError(`${valueProp}`, "Progress"));
    }
    const value = isValidValueNumber(valueProp, max) ? valueProp : null;
    const valueLabel = isNumber(value) ? getValueLabel(value, max) : void 0;
    return /* @__PURE__ */ jsxRuntimeExports.jsx(ProgressProvider, { scope: __scopeProgress, value, max, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$1.div,
      {
        "aria-valuemax": max,
        "aria-valuemin": 0,
        "aria-valuenow": isNumber(value) ? value : void 0,
        "aria-valuetext": valueLabel,
        role: "progressbar",
        "data-state": getProgressState(value, max),
        "data-value": value ?? void 0,
        "data-max": max,
        ...progressProps,
        ref: forwardedRef
      }
    ) });
  }
);
Progress$1.displayName = PROGRESS_NAME;
var INDICATOR_NAME$1 = "ProgressIndicator";
var ProgressIndicator = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeProgress, ...indicatorProps } = props;
    const context = useProgressContext(INDICATOR_NAME$1, __scopeProgress);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$1.div,
      {
        "data-state": getProgressState(context.value, context.max),
        "data-value": context.value ?? void 0,
        "data-max": context.max,
        ...indicatorProps,
        ref: forwardedRef
      }
    );
  }
);
ProgressIndicator.displayName = INDICATOR_NAME$1;
function defaultGetValueLabel(value, max) {
  return `${Math.round(value / max * 100)}%`;
}
function getProgressState(value, maxValue) {
  return value == null ? "indeterminate" : value === maxValue ? "complete" : "loading";
}
function isNumber(value) {
  return typeof value === "number";
}
function isValidMaxNumber(max) {
  return isNumber(max) && !isNaN(max) && max > 0;
}
function isValidValueNumber(value, max) {
  return isNumber(value) && !isNaN(value) && value <= max && value >= 0;
}
function getInvalidMaxError(propValue, componentName) {
  return `Invalid prop \`max\` of value \`${propValue}\` supplied to \`${componentName}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${DEFAULT_MAX}\`.`;
}
function getInvalidValueError(propValue, componentName) {
  return `Invalid prop \`value\` of value \`${propValue}\` supplied to \`${componentName}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${DEFAULT_MAX} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`;
}
var Root$1 = Progress$1;
var Indicator = ProgressIndicator;

const Progress = reactExports.forwardRef(({ className, value, indicatorClassName, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Root$1,
  {
    ref,
    className: cn(
      "relative h-2 w-full overflow-hidden rounded-full bg-primary/20",
      className
    ),
    ...props,
    children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Indicator,
      {
        className: cn(
          "h-full w-full flex-1 bg-gradient-to-r from-m1ssion-blue to-blue-600 transition-all",
          indicatorClassName
        ),
        style: { transform: `translateX(-${100 - (value || 0)}%)` }
      }
    )
  }
));
Progress.displayName = Root$1.displayName;

const XpLevelProgress = ({ totalXp, className }) => {
  const level = Math.floor(totalXp / 1e3) + 1;
  const xpInCurrentLevel = totalXp % 1e3;
  const xpNeededForNextLevel = 1e3;
  const progressPercentage = xpInCurrentLevel / xpNeededForNextLevel * 100;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `space-y-3 ${className}`, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "p-2 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-full",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "w-5 h-5 text-white" })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400", children: "Livello" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-2xl font-bold gradient-text", children: level })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400", children: "XP Totale" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xl font-semibold text-cyan-400 flex items-center gap-1", children: [
          totalXp.toLocaleString(),
          /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingUp, { className: "w-4 h-4" })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-xs text-gray-400", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
          xpInCurrentLevel,
          " XP"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
          xpNeededForNextLevel,
          " XP"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Progress,
          {
            value: progressPercentage,
            className: "h-3 bg-gray-800/50 border border-cyan-500/20"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 h-3 rounded-full bg-gradient-to-r from-cyan-500/20 to-purple-500/20 pointer-events-none"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-center text-gray-500", children: [
        xpNeededForNextLevel - xpInCurrentLevel,
        " XP al prossimo livello"
      ] })
    ] })
  ] });
};

function DailyCheckInButton() {
  const { user } = useAuthContext();
  const [loading, setLoading] = reactExports.useState(false);
  const [currentStreak, setCurrentStreak] = reactExports.useState(0);
  const [canCheckIn, setCanCheckIn] = reactExports.useState(true);
  const [lastCheckIn, setLastCheckIn] = reactExports.useState(null);
  reactExports.useEffect(() => {
    if (user) {
      loadStreakData();
    }
  }, [user]);
  const loadStreakData = async () => {
    if (!user) return;
    try {
      const { data, error } = await supabase.from("profiles").select("current_streak_days, last_check_in_date").eq("id", user.id).single();
      if (error) throw error;
      if (data) {
        setCurrentStreak(data.current_streak_days || 0);
        setLastCheckIn(data.last_check_in_date);
        const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
        setCanCheckIn(data.last_check_in_date !== today);
      }
    } catch (err) {
    }
  };
  const handleCheckIn = async () => {
    if (!user || !canCheckIn) return;
    setLoading(true);
    try {
      const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
      const yesterday = new Date(Date.now() - 864e5).toISOString().split("T")[0];
      let newStreak = currentStreak;
      if (!lastCheckIn || lastCheckIn === yesterday) {
        newStreak = currentStreak + 1;
      } else if (lastCheckIn !== today) {
        newStreak = 1;
        ue.warning(" La tua streak  stata resettata", { duration: 3e3 });
      }
      const { error: updateError } = await supabase.from("profiles").update({
        current_streak_days: newStreak,
        last_check_in_date: today
      }).eq("id", user.id);
      if (updateError) throw updateError;
      const { error: xpError } = await supabase.rpc("award_xp", {
        p_user_id: user.id,
        p_xp_amount: 10,
        p_source: "daily_checkin"
      });
      if (xpError) ;
      setCurrentStreak(newStreak);
      setCanCheckIn(false);
      setLastCheckIn(today);
      ue.success(
        ` Check-in completato! Streak: ${newStreak} giorni (+10 PE)`,
        { duration: 3e3 }
      );
    } catch (err) {
      ue.error("Errore durante il check-in");
    } finally {
      setLoading(false);
    }
  };
  if (!user) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "flex flex-col items-center gap-2",
      initial: { scale: 0.9, opacity: 0 },
      animate: { scale: 1, opacity: 1 },
      transition: { duration: 0.15 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 text-primary", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Flame, { className: "h-5 w-5" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-lg font-bold", children: [
              currentStreak,
              " giorni"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Streak corrente" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleCheckIn,
            disabled: !canCheckIn || loading,
            className: "relative overflow-hidden",
            size: "sm",
            children: loading ? "Attendere..." : canCheckIn ? " Check-in Giornaliero" : " Completato oggi"
          }
        ),
        !canCheckIn && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Torna domani per continuare la streak!" })
      ]
    }
  );
}

const ProfileToast = ({ isOpen, onClose, className }) => {
  const [profileData, setProfileData] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  const [isLoggingOut, setIsLoggingOut] = reactExports.useState(false);
  const { referralCode, copyReferralCode } = useReferralCode();
  const { toast } = useToast();
  const { logout } = useAuthContext();
  const [, setLocation] = useLocation();
  const { xpStatus } = useXpSystem();
  const totalXp = xpStatus?.total_xp ?? 0;
  reactExports.useEffect(() => {
    if (isOpen) {
      fetchProfileData();
      const interval = setInterval(() => {
        fetchProfileData();
      }, 1e3);
      const subscription = supabase.channel("profile-updates").on(
        "postgres_changes",
        { event: "*", schema: "public", table: "user_mission_status" },
        () => {
          fetchProfileData();
        }
      ).on(
        "postgres_changes",
        { event: "*", schema: "public", table: "profiles" },
        () => {
          fetchProfileData();
        }
      ).subscribe();
      return () => {
        clearInterval(interval);
        subscription.unsubscribe();
      };
    }
  }, [isOpen]);
  const fetchProfileData = async () => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      const { data: profile } = await supabase.from("profiles").select("username, full_name, subscription_tier").eq("id", user.id).single();
      const { data: missionStatus } = await supabase.from("user_mission_status").select("clues_found, mission_started_at, mission_days_remaining").eq("user_id", user.id).single();
      let daysRemaining = 30;
      if (missionStatus?.mission_started_at) {
        const startDate = new Date(missionStatus.mission_started_at);
        const currentDate = /* @__PURE__ */ new Date();
        const daysPassed = Math.floor((currentDate.getTime() - startDate.getTime()) / (1e3 * 60 * 60 * 24));
        daysRemaining = Math.max(0, 30 - daysPassed);
      }
      const { data: subscription } = await supabase.from("subscriptions").select("tier").eq("user_id", user.id).eq("status", "active").single();
      let userTier = subscription?.tier || profile?.subscription_tier || "Base";
      setProfileData({
        username: profile?.username || profile?.full_name || "Agente",
        email: user.email || "",
        cluesFound: missionStatus?.clues_found || 0,
        totalClues: 12,
        // Total clues in the mission
        daysRemaining,
        // Use real-time calculated value
        missionStartDate: missionStatus?.mission_started_at || (/* @__PURE__ */ new Date()).toISOString(),
        subscriptionTier: userTier
      });
    } catch (error) {
    } finally {
      setLoading(false);
    }
  };
  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString("it-IT", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric"
    });
  };
  const handleLogout = async () => {
    setIsLoggingOut(true);
    try {
      await logout();
      onClose();
      setLocation("/login");
      toast({
        title: "Logout effettuato",
        description: "Sei stato disconnesso con successo"
      });
    } catch (error) {
      toast({
        title: "Errore",
        description: "Errore durante il logout",
        variant: "destructive"
      });
    } finally {
      setIsLoggingOut(false);
    }
  };
  const handleUpgrade = () => {
    onClose();
    setLocation("/subscriptions");
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isOpen && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        exit: { opacity: 0 },
        className: "fixed inset-0 bg-black/50 backdrop-blur-sm z-50",
        onClick: onClose
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, scale: 0.9, y: -20 },
        animate: { opacity: 1, scale: 1, y: 0 },
        exit: { opacity: 0, scale: 0.9, y: -20 },
        transition: { duration: 0.2, ease: "easeOut" },
        className: `fixed top-20 right-4 w-80 max-h-[100dvh] bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl border border-slate-700/50 rounded-xl shadow-2xl z-50 overflow-hidden ${className}`,
        style: {
          boxShadow: "0 20px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1)",
          touchAction: "pan-y"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-4 border-b border-slate-700/50", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-full flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-4 h-4 text-white" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-orbitron font-bold text-white", children: "Profilo Agente" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                variant: "ghost",
                size: "icon",
                onClick: onClose,
                className: "w-8 h-8 rounded-full hover:bg-white/10",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-4 h-4" })
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "div",
            {
              className: "p-4 space-y-4 overflow-y-auto overscroll-contain",
              "data-profile-scroll": "enabled",
              style: {
                maxHeight: "calc(100dvh - 5rem - var(--m1-bottom-nav) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px))",
                paddingBottom: "calc(var(--m1-bottom-nav) + env(safe-area-inset-bottom, 0px) + 16px)",
                WebkitOverflowScrolling: "touch",
                touchAction: "pan-y"
              },
              children: loading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500" }) }) : profileData ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border border-slate-700/50 rounded-lg p-3 bg-slate-900/50", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-semibold text-blue-400", children: "Livello & PE" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-gray-400", children: [
                      "Totale: ",
                      totalXp,
                      " PE"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(XpLevelProgress, { totalXp }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-3 pt-3 border-t border-slate-700/50", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "text-xs text-gray-300 mb-2", children: "Check-in giornaliero" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(DailyCheckInButton, {})
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-4 h-4 text-blue-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Nome utente:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium", children: profileData.username })
                ] }),
                referralCode && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-blue-400 rounded-full animate-pulse" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Codice referral:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-mono text-sm bg-slate-800 px-2 py-1 rounded", children: referralCode }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Button,
                      {
                        variant: "ghost",
                        size: "icon",
                        onClick: copyReferralCode,
                        className: "w-6 h-6 rounded hover:bg-white/10",
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Copy, { className: "w-3 h-3" })
                      }
                    )
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Email:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium text-sm", children: profileData.email })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t border-slate-700/50 pt-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-semibold text-blue-400 mb-3", children: "Stato Missione" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-4 h-4 text-green-400" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Indizi trovati:" })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white font-medium", children: [
                        profileData.cluesFound,
                        "/",
                        profileData.totalClues
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-4 h-4 text-orange-400" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Giorni rimanenti:" })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium", children: profileData.daysRemaining })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-4 h-4 text-blue-400" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Inizio missione:" })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium text-sm", children: formatDate(profileData.missionStartDate) })
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t border-slate-700/50 pt-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-semibold text-blue-400 mb-3", children: "Abbonamento" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Piano attuale:" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Badge,
                        {
                          variant: "secondary",
                          className: cn(
                            "font-semibold transition-all duration-300",
                            profileData.subscriptionTier === "Base" && "bg-gray-500 text-white",
                            profileData.subscriptionTier === "Silver" && "bg-gradient-to-r from-gray-300 to-gray-500 text-gray-900",
                            profileData.subscriptionTier === "Gold" && "bg-gradient-to-r from-amber-400 to-amber-600 text-white shadow-md",
                            profileData.subscriptionTier === "Black" && "bg-gradient-to-r from-gray-800 to-gray-900 text-white shadow-lg",
                            profileData.subscriptionTier === "Titanium" && "bg-gradient-to-r from-purple-500 to-cyan-500 text-white animate-pulse shadow-[0_0_20px_rgba(168,85,247,0.5)]"
                          ),
                          children: profileData.subscriptionTier?.toUpperCase() || "BASE"
                        }
                      )
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(
                      Button,
                      {
                        onClick: handleUpgrade,
                        variant: "outline",
                        size: "sm",
                        className: "w-full bg-gradient-to-r from-blue-500/20 to-cyan-500/20 border-blue-500/50 text-blue-400 hover:bg-blue-500/30",
                        children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "w-4 h-4 mr-2" }),
                          "Upgrade"
                        ]
                      }
                    )
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "border-t border-slate-700/50 pt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Button,
                  {
                    onClick: handleLogout,
                    variant: "outline",
                    size: "sm",
                    className: "w-full border-red-500/50 text-red-400 hover:bg-red-500/20",
                    disabled: isLoggingOut,
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(LogOut, { className: "w-4 h-4 mr-2" }),
                      isLoggingOut ? "Disconnessione..." : "Esci"
                    ]
                  }
                ) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { "aria-hidden": true, className: "h-24 sm:h-16" })
              ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-4 text-gray-400", children: "Errore nel caricamento dei dati" })
            }
          )
        ]
      }
    )
  ] }) });
};

const PulseEnergyBadge = ({ rank, className = "", showCode = true }) => {
  if (!rank) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: `inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-gray-800/50 border border-gray-700 ${className}`,
        "data-testid": "pe-badge-unavailable",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-4 h-4 text-gray-500" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-500", children: "Grado Non Disponibile" })
        ]
      }
    );
  }
  const isBaseRank = rank.code === "AG-01";
  const displayColor = isBaseRank ? "#4A90E2" : rank.color;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `inline-flex items-center gap-2 px-3 py-1.5 rounded-md border ${className}`,
      style: {
        backgroundColor: `${displayColor}20`,
        borderColor: displayColor,
        boxShadow: `0 0 12px ${displayColor}40`,
        minHeight: "40px"
        // Increased for better visibility
      },
      "data-testid": "pe-badge",
      "data-rank-code": rank.code,
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg", role: "img", "aria-label": "rank symbol", children: rank.symbol }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-bold leading-tight", style: { color: displayColor }, children: rank.name_it }),
          showCode && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[10px] font-mono leading-tight", style: { color: displayColor, opacity: 0.7 }, children: rank.code })
        ] })
      ]
    }
  );
};

const PulseEnergyProgressBar = ({
  currentRank,
  nextRank,
  progressPercent,
  currentPE,
  className = ""
}) => {
  if (!nextRank) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `space-y-2 ${className}`, "data-testid": "pe-progress-max", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "PE Totali" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-bold text-cyan-400", children: [
          currentPE.toLocaleString("it-IT"),
          " PE"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-md bg-gradient-to-r from-amber-900/30 to-yellow-900/30 border border-amber-500/50", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingUp, { className: "w-4 h-4 text-amber-400" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-amber-400 font-bold", children: "GRADO MASSIMO RAGGIUNTO" })
      ] }) })
    ] });
  }
  const peNeeded = nextRank.pe_min - currentPE;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `space-y-2 ${className}`, "data-testid": "pe-progress-active", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "PE Totali" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-bold text-cyan-400", children: [
        currentPE.toLocaleString("it-IT"),
        " PE"
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      Progress,
      {
        value: progressPercent,
        className: "h-2 bg-gray-800",
        "data-testid": "pe-progress-bar"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-500", children: currentRank?.name_it || "Attuale" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-cyan-400 font-medium", children: [
        peNeeded.toLocaleString("it-IT"),
        " PE al prossimo grado"
      ] })
    ] })
  ] });
};

const usePulseEnergy = () => {
  const xpSystem = useXpSystem();
  const [ranks, setRanks] = reactExports.useState([]);
  const [ranksLoading, setRanksLoading] = reactExports.useState(true);
  const [userRankId, setUserRankId] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const fetchRanks = async () => {
      try {
        const { data, error } = await supabase.from("agent_ranks").select("*").order("pe_min", { ascending: true });
        if (error) {
          setRanks([]);
        } else if (data) {
          setRanks(data);
        }
      } catch (err) {
        setRanks([]);
      } finally {
        setRanksLoading(false);
      }
    };
    fetchRanks();
  }, []);
  reactExports.useEffect(() => {
    const fetchUserRank = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session?.user) return;
        const { data, error } = await supabase.from("profiles").select("rank_id").eq("id", session.user.id).single();
        if (!error && data?.rank_id) {
          setUserRankId(data.rank_id);
        }
      } catch (err) {
      }
    };
    fetchUserRank();
  }, []);
  const pulseEnergy = xpSystem.xpStatus.total_xp;
  const currentRank = reactExports.useMemo(() => {
    if (ranks.length === 0) return null;
    if (userRankId !== null) {
      const assignedRank = ranks.find((r) => r.id === userRankId);
      if (assignedRank) {
        return assignedRank;
      }
    }
    for (let i = ranks.length - 1; i >= 0; i--) {
      const rank = ranks[i];
      if (pulseEnergy >= rank.pe_min) {
        if (rank.pe_max === null || pulseEnergy < rank.pe_max) {
          return rank;
        }
      }
    }
    return ranks[0] || null;
  }, [ranks, pulseEnergy, userRankId]);
  const nextRank = reactExports.useMemo(() => {
    if (!currentRank || ranks.length === 0) return null;
    const currentIndex = ranks.findIndex((r) => r.id === currentRank.id);
    if (currentIndex === -1 || currentIndex === ranks.length - 1) return null;
    return ranks[currentIndex + 1];
  }, [ranks, currentRank]);
  const progressToNextRank = reactExports.useMemo(() => {
    if (!currentRank || !nextRank) return 100;
    const rangeSize = nextRank.pe_min - currentRank.pe_min;
    const progressInRange = pulseEnergy - currentRank.pe_min;
    return Math.min(100, Math.max(0, progressInRange / rangeSize * 100));
  }, [currentRank, nextRank, pulseEnergy]);
  return {
    pulseEnergy,
    currentRank,
    nextRank,
    progressToNextRank,
    buzzCredits: xpSystem.xpStatus.free_buzz_credit,
    buzzMapCredits: xpSystem.xpStatus.free_buzz_map_credit,
    loading: xpSystem.loading || ranksLoading,
    hasNewRewards: xpSystem.hasNewRewards,
    consumeCredit: xpSystem.consumeCredit,
    refreshPulseEnergy: xpSystem.refreshXpStatus,
    markRewardsAsSeen: xpSystem.markRewardsAsSeen,
    ranksAvailable: ranks.length > 0
  };
};

const ProfileDropdown = ({
  profileImage,
  className = ""
}) => {
  const [isOpen, setIsOpen] = reactExports.useState(false);
  const [showProfileToast, setShowProfileToast] = reactExports.useState(false);
  const { user, logout } = useAuth();
  const { navigate } = useWouterNavigation();
  const { toast } = useToast();
  const dropdownRef = reactExports.useRef(null);
  const { pulseEnergy, currentRank, nextRank, progressToNextRank, loading: peLoading } = usePulseEnergy();
  reactExports.useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setIsOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);
  const handleLogout = async () => {
    try {
      await logout();
      toast({
        title: " Logout completato",
        description: "Sei stato disconnesso con successo."
      });
      navigate("/auth");
    } catch (error) {
      toast({
        title: " Errore logout",
        description: "Impossibile disconnettersi. Riprova.",
        variant: "destructive"
      });
    }
  };
  const handleSettingsClick = () => {
    setIsOpen(false);
    navigate("/settings");
  };
  const handleAvatarClick = () => {
    setShowProfileToast(true);
    setIsOpen(false);
  };
  const displayName = user?.user_metadata?.full_name || `${user?.user_metadata?.first_name || ""} ${user?.user_metadata?.last_name || ""}`.trim() || "Joseph";
  const email = user?.email || "wikus77@hotmail.it";
  const userId = user?.id ? user.id.substring(0, 8) : "N/A";
  const subscriptionTier = user?.user_metadata?.subscription_tier || "m1ssion+";
  const getTierDisplay = () => {
    switch (subscriptionTier.toLowerCase()) {
      case "black":
        return { name: "Black", color: "bg-gray-800 text-white", emoji: "" };
      case "elite":
        return { name: "Elite", color: "bg-amber-600 text-white", emoji: "" };
      case "m1ssion+":
        return { name: "M1SSION+", color: "bg-gradient-to-r from-purple-600 to-blue-600 text-white", emoji: "" };
      default:
        return { name: "M1SSION+", color: "bg-gradient-to-r from-purple-600 to-blue-600 text-white", emoji: "" };
    }
  };
  const tierInfo = getTierDisplay();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `relative ${className}`, ref: dropdownRef, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        variant: "ghost",
        className: "p-1 rounded-full hover:bg-white/10 transition-colors",
        onClick: handleAvatarClick,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          ProfileAvatar,
          {
            profileImage,
            className: "w-10 h-10 border-2 border-[#00D1FF]/30 hover:border-[#00D1FF] transition-colors"
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isOpen && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, y: -10, scale: 0.95 },
        animate: { opacity: 1, y: 0, scale: 1 },
        exit: { opacity: 0, y: -10, scale: 0.95 },
        transition: { duration: 0.2, ease: "easeOut" },
        className: "absolute right-0 mt-2 w-80 z-[99999]",
        style: {
          top: "calc(100% + 8px)",
          maxWidth: "calc(100vw - 32px)",
          position: "absolute",
          right: "0px",
          left: "auto",
          transform: "none"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/95 border-[#00D1FF]/30 backdrop-blur-xl shadow-2xl border-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-4 space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3 pb-3 border-b border-white/10", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              ProfileAvatar,
              {
                profileImage,
                className: "w-12 h-12 border-2 border-[#00D1FF]/30"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-orbitron font-semibold text-white text-sm", children: displayName }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-xs", children: email }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/50 text-xs", children: [
                "ID: ",
                userId
              ] })
            ] })
          ] }),
          !peLoading && currentRank && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t border-white/10 pt-3 space-y-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-between", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/70 text-xs", children: "Grado Agente" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(PulseEnergyBadge, { rank: currentRank, showCode: true }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              PulseEnergyProgressBar,
              {
                currentRank,
                nextRank,
                progressPercent: progressToNextRank,
                currentPE: pulseEnergy
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/70 text-sm", children: "Piano attivo:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: `px-3 py-1 rounded-full text-xs font-medium ${tierInfo.color}`, children: [
              tierInfo.emoji,
              " ",
              tierInfo.name
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 pt-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "ghost",
                className: "w-full justify-start text-white/90 hover:bg-white/10",
                onClick: handleSettingsClick,
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 mr-3" }),
                  "Modifica profilo"
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "ghost",
                className: "w-full justify-start text-red-400 hover:bg-red-500/10 hover:text-red-300",
                onClick: handleLogout,
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(LogOut, { className: "w-4 h-4 mr-3" }),
                  "Esci"
                ]
              }
            )
          ] })
        ] }) })
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      ProfileToast,
      {
        isOpen: showProfileToast,
        onClose: () => setShowProfileToast(false)
      }
    )
  ] });
};

const useNavigationStore = create$1()(
  persist(
    (set, get) => ({
      // State
      currentTab: "/",
      history: ["/"],
      isCapacitor: false,
      lastNavigation: Date.now(),
      // Actions
      setCurrentTab: (tab) => {
        set({
          currentTab: tab,
          lastNavigation: Date.now()
        });
      },
      addToHistory: (path) => {
        const { history } = get();
        const newHistory = [...history, path].slice(-10);
        set({
          history: newHistory,
          lastNavigation: Date.now()
        });
      },
      goBack: () => {
        const { history } = get();
        if (history.length > 1) {
          const newHistory = history.slice(0, -1);
          const previousPath = newHistory[newHistory.length - 1];
          set({
            history: newHistory,
            currentTab: previousPath,
            lastNavigation: Date.now()
          });
          return previousPath;
        }
        return null;
      },
      clearHistory: () => {
        set({
          history: ["/"],
          currentTab: "/",
          lastNavigation: Date.now()
        });
      },
      setCapacitorMode: (isCapacitor) => {
        set({
          isCapacitor,
          lastNavigation: Date.now()
        });
      },
      getNavigationInfo: () => {
        return get();
      }
    }),
    {
      name: "m1ssion-navigation-store",
      partialize: (state) => ({
        currentTab: state.currentTab,
        history: state.history,
        isCapacitor: state.isCapacitor
      })
    }
  )
);

const PushNotifications = {
  requestPermissions: async () => ({
    receive: "granted"
  }),
  register: async () => Promise.resolve(),
  addListener: () => ({
    remove: () => {
    }
  }),
  removeAllListeners: () => Promise.resolve(),
  removeAllDeliveredNotifications: () => Promise.resolve(),
  getDeliveredNotifications: () => Promise.resolve({ notifications: [] }),
  checkPermissions: async () => ({
    receive: "granted"
  })
};

const AUDIO_MAP = {
  success: "/assets/audio/success.mp3",
  error: "/assets/audio/error.mp3",
  chime: "/assets/audio/chime.mp3",
  beep: "/assets/audio/beep.mp3",
  start: "/assets/audio/start.mp3",
  level_complete: "/assets/audio/level_complete.mp3",
  victory: "/assets/audio/victory.mp3"
};
class AudioManager {
  audioCache = /* @__PURE__ */ new Map();
  isEnabled = true;
  constructor() {
  }
  async preloadAudio() {
    try {
      for (const [key, path] of Object.entries(AUDIO_MAP)) {
        const audio = new Audio(path);
        audio.preload = "auto";
        this.audioCache.set(key, audio);
      }
    } catch (error) {
    }
  }
  setEnabled(enabled) {
    this.isEnabled = enabled;
  }
  async playSound(soundKey) {
    if (!this.isEnabled) return;
    try {
      let audio = this.audioCache.get(soundKey);
      if (!audio && AUDIO_MAP[soundKey]) {
        audio = new Audio(AUDIO_MAP[soundKey]);
        this.audioCache.set(soundKey, audio);
      }
      if (audio) {
        audio.currentTime = 0;
        await audio.play();
      }
    } catch (error) {
    }
  }
}
const audioManager = new AudioManager();
const playSound = (soundKey) => audioManager.playSound(soundKey);

const usePWAHardwareStub = () => {
  const [state] = reactExports.useState({
    isPWA: typeof window !== "undefined" && window.matchMedia("(display-mode: standalone)").matches,
    deviceInfo: { platform: "web", userAgent: navigator.userAgent },
    networkStatus: navigator.onLine ? "online" : "offline",
    orientation: "portrait"
  });
  const vibrate = async (duration = 200) => {
    if ("vibrate" in navigator) {
      try {
        navigator.vibrate(duration);
      } catch (error) {
      }
    }
  };
  const triggerHaptic = async (type) => {
    await hapticManager.trigger(type);
  };
  return {
    ...state,
    vibrate,
    triggerHaptic,
    playSound,
    isLoading: false
  };
};

const useEnhancedNavigation = () => {
  const { navigate, currentPath: location } = useWouterNavigation();
  const { isPWA, triggerHaptic } = usePWAHardwareStub();
  const { setCurrentTab, addToHistory, goBack } = useNavigationStore();
  const navigateWithFeedback = preserveFunctionName(
    async (path, options) => {
      if (options?.haptic !== false) {
        await triggerHaptic("tick");
      }
      setCurrentTab(path);
      addToHistory(path);
      navigate(path, options);
      if (isPWA) {
        setTimeout(() => {
          window.scrollTo(0, 0);
        }, 100);
      }
    });
  const goBackWithFeedback = preserveFunctionName(
    async (options) => {
      if (options?.haptic !== false) {
        await triggerHaptic("selection");
      }
      if (typeof window !== "undefined" && window.history.length > 1) {
        window.history.back();
        if (isPWA) {
          setTimeout(() => {
            window.scrollTo(0, 0);
          }, 100);
        }
        return true;
      } else {
        navigate("/home");
        return "/home";
      }
    });
  const navigationShortcuts = {
    toHome: preserveFunctionName(() => navigateWithFeedback("/home")),
    toMap: preserveFunctionName(() => navigateWithFeedback("/map")),
    toBuzz: preserveFunctionName(() => navigateWithFeedback("/buzz")),
    toGames: preserveFunctionName(() => navigateWithFeedback("/games")),
    toProfile: preserveFunctionName(() => navigateWithFeedback("/profile")),
    toSettings: preserveFunctionName(() => navigateWithFeedback("/settings")),
    toNotifications: preserveFunctionName(() => navigateWithFeedback("/notifications")),
    toLeaderboard: preserveFunctionName(() => navigateWithFeedback("/leaderboard"))
  };
  const getCurrentTab = preserveFunctionName(() => {
    const path = location;
    if (path.startsWith("/home")) return "home";
    if (path.startsWith("/map")) return "map";
    if (path.startsWith("/buzz")) return "buzz";
    if (path.startsWith("/games")) return "games";
    if (path.startsWith("/profile")) return "profile";
    if (path.startsWith("/settings")) return "settings";
    if (path.startsWith("/notifications")) return "notifications";
    if (path.startsWith("/leaderboard")) return "leaderboard";
    return "home";
  });
  const navigationState = {
    currentPath: location,
    currentTab: getCurrentTab(),
    isPWA,
    canGoBack: window.history.length > 1
  };
  return {
    // Core navigation
    navigateWithFeedback,
    goBackWithFeedback,
    // Shortcuts
    ...navigationShortcuts,
    // State
    ...navigationState,
    // Utilities
    getCurrentTab
  };
};

function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = reactExports.useState(() => {
    if (typeof window === "undefined") {
      return initialValue;
    }
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      return initialValue;
    }
  });
  const setValue = (value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      if (typeof window !== "undefined") {
        window.localStorage.setItem(key, JSON.stringify(valueToStore));
      }
    } catch (error) {
    }
  };
  reactExports.useEffect(() => {
    function handleStorageChange(event) {
      if (event.key === key && event.newValue) {
        try {
          const newValue = event.newValue.trim();
          if (newValue.startsWith("{") || newValue.startsWith("[") || newValue.startsWith('"') || newValue === "true" || newValue === "false" || !isNaN(Number(newValue))) {
            setStoredValue(JSON.parse(newValue));
          } else {
          }
        } catch (parseError) {
        }
      }
    }
    if (typeof window !== "undefined") {
      window.addEventListener("storage", handleStorageChange);
      return () => window.removeEventListener("storage", handleStorageChange);
    }
  }, [key]);
  return [storedValue, setValue];
}

const useProfileRealtime = () => {
  const [profileData, setProfileData] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [channel, setChannel] = reactExports.useState(null);
  reactExports.useEffect(() => {
    let mounted = true;
    let realtimeChannel = null;
    const setupRealtimeSubscription = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session?.user) {
          setIsLoading(false);
          return;
        }
        const { data, error } = await supabase.from("profiles").select("id, full_name, bio, agent_code, agent_title, avatar_url, email, updated_at").eq("id", session.user.id).single();
        if (mounted && data && !error) {
          setProfileData(data);
        }
        realtimeChannel = supabase.channel(`profile_changes_${session.user.id}`).on(
          "postgres_changes",
          {
            event: "UPDATE",
            schema: "public",
            table: "profiles",
            filter: `id=eq.${session.user.id}`
          },
          (payload) => {
            if (mounted && payload.new) {
              const newData = payload.new;
              setProfileData(newData);
              if (newData.full_name) {
                localStorage.setItem("profileName", newData.full_name);
              }
              if (newData.bio) {
                localStorage.setItem("profileBio", newData.bio);
              }
              if (newData.agent_code) {
                localStorage.setItem("agentCode", newData.agent_code);
              }
              if (newData.avatar_url) {
                localStorage.setItem("profileImage", newData.avatar_url);
              }
            }
          }
        ).subscribe((status) => {
        });
        setChannel(realtimeChannel);
        setIsLoading(false);
      } catch (error) {
        setIsLoading(false);
      }
    };
    setupRealtimeSubscription();
    return () => {
      mounted = false;
      if (realtimeChannel) {
        supabase.removeChannel(realtimeChannel);
      }
    };
  }, []);
  const updateProfile = async (updates) => {
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.user) return null;
      setProfileData((prev) => prev ? { ...prev, ...updates } : null);
      const { data, error } = await supabase.from("profiles").update({
        ...updates,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", session.user.id).select().single();
      if (error) {
        const { data: currentData } = await supabase.from("profiles").select("id, full_name, bio, agent_code, agent_title, avatar_url, email, updated_at").eq("id", session.user.id).single();
        if (currentData) {
          setProfileData(currentData);
        }
        throw error;
      }
      return data;
    } catch (error) {
      throw error;
    }
  };
  return {
    profileData,
    isLoading,
    updateProfile,
    channel
  };
};

const useProfileImage = () => {
  const [profileImage, setProfileImage] = useLocalStorage("profileImage", null);
  const { profileData: realtimeProfile } = useProfileRealtime();
  reactExports.useEffect(() => {
    if (realtimeProfile?.avatar_url) {
      setProfileImage(realtimeProfile.avatar_url);
    }
  }, [realtimeProfile?.avatar_url, setProfileImage]);
  const saveImageToStorage = async (file) => {
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.user) return null;
      const fileName = `${session.user.id}.jpg`;
      const filePath = `profiles/${fileName}`;
      const { data, error } = await supabase.storage.from("avatars").upload(filePath, file, {
        cacheControl: "3600",
        upsert: true
      });
      if (error) throw error;
      const { data: { publicUrl } } = supabase.storage.from("avatars").getPublicUrl(filePath);
      return publicUrl;
    } catch (error) {
      return null;
    }
  };
  return {
    profileImage,
    setProfileImage,
    saveImageToStorage
  };
};

const ensureAgentCode = async (userId) => {
  try {
    const { data: profile, error } = await supabase.from("profiles").select("agent_code").eq("id", userId).single();
    if (error) {
      return null;
    }
    if (profile?.agent_code) {
      return profile.agent_code;
    }
    await new Promise((resolve) => setTimeout(resolve, 100));
    const { data: updatedProfile, error: retryError } = await supabase.from("profiles").select("agent_code").eq("id", userId).single();
    if (retryError) {
      return null;
    }
    return updatedProfile?.agent_code || null;
  } catch (error) {
    return null;
  }
};

const AGENT_CODE_CACHE_KEY = "m1ssion_agent_code";
const AGENT_CODE_CACHE_EXPIRY = 24 * 60 * 60 * 1e3;
const getCachedAgentCode = () => {
  try {
    const cached = localStorage.getItem(AGENT_CODE_CACHE_KEY);
    if (cached) {
      const parsed = JSON.parse(cached);
      if (Date.now() - parsed.timestamp < AGENT_CODE_CACHE_EXPIRY) {
        return parsed;
      }
    }
  } catch {
  }
  return null;
};
const setCachedAgentCode = (code, userId) => {
  try {
    const cached = {
      code,
      timestamp: Date.now(),
      userId
    };
    localStorage.setItem(AGENT_CODE_CACHE_KEY, JSON.stringify(cached));
  } catch {
  }
};
const useAgentCode = () => {
  const cached = getCachedAgentCode();
  const [agentCode, setAgentCode] = reactExports.useState(cached?.code || null);
  const [isLoading, setIsLoading] = reactExports.useState(!cached?.code);
  const [error, setError] = reactExports.useState(null);
  const fetchedRef = reactExports.useRef(false);
  reactExports.useEffect(() => {
    if (fetchedRef.current) return;
    fetchedRef.current = true;
    const fetchAgentCode = async () => {
      try {
        if (!cached?.code) {
          setIsLoading(true);
        }
        setError(null);
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          setIsLoading(false);
          return;
        }
        const adminCode = getAdminCode(user.email);
        if (adminCode) {
          setAgentCode(adminCode);
          setCachedAgentCode(adminCode, user.id);
          setIsLoading(false);
          return;
        }
        if (cached?.code && cached?.userId === user.id) {
          setAgentCode(cached.code);
          setIsLoading(false);
          ensureAgentCode(user.id).then((freshCode) => {
            if (freshCode && freshCode !== cached.code) {
              setAgentCode(freshCode);
              setCachedAgentCode(freshCode, user.id);
            }
          });
          return;
        }
        const code = await ensureAgentCode(user.id);
        if (code) {
          setAgentCode(code);
          setCachedAgentCode(code, user.id);
        } else {
          setError(new Error("Failed to retrieve agent code"));
        }
      } catch (e) {
        setError(e instanceof Error ? e : new Error("Unknown error"));
      } finally {
        setIsLoading(false);
      }
    };
    fetchAgentCode();
  }, []);
  return {
    agentCode,
    isLoading,
    error
  };
};

const ReferralCodeDisplay = () => {
  const { agentCode, isLoading } = useAgentCode();
  if (isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-slate-600 rounded-full animate-pulse" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-slate-500 font-orbitron", children: "Loading..." })
    ] });
  }
  if (!agentCode) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { opacity: 0, y: -10 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.3 },
      className: "flex items-center",
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        "span",
        {
          className: "text-[15px] font-orbitron font-bold text-[#00D1FF] agent-code-badge tracking-wider",
          style: {
            textShadow: "0 0 12px rgba(0, 209, 255, 0.7), 0 0 24px rgba(0, 209, 255, 0.4)"
          },
          children: agentCode
        }
      )
    }
  );
};

const useScrollDirection = (threshold = 50, containerSelector) => {
  const [state, setState] = reactExports.useState({
    isScrollingUp: false,
    isScrollingDown: false,
    scrollY: 0,
    shouldHideHeader: false
  });
  reactExports.useEffect(() => {
    let lastScroll = window.scrollY;
    let ticking = false;
    let attachedTarget = null;
    let virtualScroll = 0;
    const readScroll = () => (window.scrollY) + virtualScroll;
    const updateScrollDirection = () => {
      const current = readScroll();
      if (Math.abs(current - lastScroll) < threshold) {
        ticking = false;
        return;
      }
      const isScrollingDown = current > lastScroll;
      const isScrollingUp = current < lastScroll;
      setState({
        isScrollingUp,
        isScrollingDown,
        scrollY: current,
        shouldHideHeader: isScrollingDown && current > threshold
      });
      lastScroll = current > 0 ? current : 0;
      ticking = false;
    };
    const onScroll = () => {
      if (!ticking) {
        window.requestAnimationFrame(updateScrollDirection);
        ticking = true;
      }
    };
    const attachListener = (target) => {
      if (attachedTarget) attachedTarget.removeEventListener("scroll", onScroll);
      target.addEventListener("scroll", onScroll, { passive: true });
      attachedTarget = target;
    };
    attachListener(window);
    return () => {
      if (attachedTarget) attachedTarget.removeEventListener("scroll", onScroll);
    };
  }, [threshold, containerSelector]);
  return state;
};

const MinimalHeaderStrip = ({ show, children }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: show && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      transition: {
        duration: 0.2,
        ease: [0.4, 0, 0.2, 1]
      },
      className: "fixed left-1/2 z-[60]",
      style: {
        top: "calc(47px + 20px)",
        transform: "translateX(-50%)"
      },
      children
    }
  ) });
};

const UnifiedHeader = ({
  profileImage: propProfileImage,
  leftComponent,
  onClickMail,
  disableScrollHide = false
}) => {
  const mountedRef = reactExports.useRef(false);
  reactExports.useEffect(() => {
    if (mountedRef.current && false) ;
    mountedRef.current = true;
    return () => {
      mountedRef.current = false;
    };
  }, []);
  const [location] = useLocation();
  useNotificationManager();
  const { goBackWithFeedback, canGoBack } = useEnhancedNavigation();
  const { profileImage } = useProfileImage();
  const { user } = useUnifiedAuth();
  const [hasAccess, setHasAccess] = reactExports.useState(false);
  const [isCapacitor, setIsCapacitor] = reactExports.useState(false);
  const [isPWA, setIsPWA] = reactExports.useState(false);
  const isMapRoute = location === "/map" || location.startsWith("/map/");
  const isBuzzRoute = location === "/buzz";
  const { shouldHideHeader: windowHide } = useScrollDirection(50);
  const [mapHide, setMapHide] = reactExports.useState(false);
  const hideHeader = isBuzzRoute ? false : isMapRoute ? mapHide : windowHide;
  reactExports.useEffect(() => {
    if (!isMapRoute || disableScrollHide || isBuzzRoute) return;
    const el = document.querySelector("#map-scroll-container");
    if (!el) return;
    const onScroll = () => setMapHide(el.scrollTop > 10);
    el.addEventListener("scroll", onScroll, { passive: true });
    const onWheel = (e) => {
      if (e.deltaY > 0) setMapHide(true);
      if (e.deltaY < 0 && el.scrollTop <= 0) setMapHide(false);
    };
    el.addEventListener("wheel", onWheel, { passive: true, capture: true });
    let touchStartY = null;
    const onTouchStart = (e) => {
      touchStartY = e.touches[0]?.clientY ?? null;
    };
    const onTouchMove = (e) => {
      if (touchStartY == null) return;
      const currentY = e.touches[0]?.clientY ?? touchStartY;
      const deltaY = touchStartY - currentY;
      if (deltaY > 0) setMapHide(true);
      if (deltaY < 0 && el.scrollTop <= 0) setMapHide(false);
      touchStartY = currentY;
    };
    el.addEventListener("touchstart", onTouchStart, { passive: true, capture: true });
    el.addEventListener("touchmove", onTouchMove, { passive: true, capture: true });
    const leaflet = document.querySelector(".leaflet-container");
    if (leaflet) {
      leaflet.addEventListener("wheel", onWheel, { passive: true, capture: true });
      leaflet.addEventListener("touchstart", onTouchStart, { passive: true, capture: true });
      leaflet.addEventListener("touchmove", onTouchMove, { passive: true, capture: true });
    }
    return () => {
      el.removeEventListener("scroll", onScroll);
      el.removeEventListener("wheel", onWheel);
      el.removeEventListener("touchstart", onTouchStart);
      el.removeEventListener("touchmove", onTouchMove);
      if (leaflet) {
        leaflet.removeEventListener("wheel", onWheel);
        leaflet.removeEventListener("touchstart", onTouchStart);
        leaflet.removeEventListener("touchmove", onTouchMove);
      }
    };
  }, [isMapRoute, location, disableScrollHide, isBuzzRoute]);
  const currentProfileImage = profileImage || propProfileImage;
  reactExports.useEffect(() => {
    const isPWAMode = window.matchMedia("(display-mode: standalone)").matches;
    setIsPWA(isPWAMode);
    const checkAccess = async () => {
      const isCapacitorApp = !!window.Capacitor;
      setIsCapacitor(isCapacitorApp);
      const userAgent = navigator.userAgent;
      const isMobile = /iPhone|iPad|iPod|Android|Mobile/i.test(userAgent) || isCapacitorApp;
      const hasStoredAccess = localStorage.getItem("developer_access") === "granted";
      let isDeveloperUser = false;
      if (user) {
        const { data: profile } = await supabase.from("profiles").select("role").eq("id", user.id).single();
        isDeveloperUser = profile?.role === "admin";
      }
      if (isDeveloperUser) {
        setHasAccess(true);
        localStorage.setItem("unlimited_access", "true");
        localStorage.setItem("bypass_all_restrictions", "true");
      } else if (isMobile && hasStoredAccess) {
        setHasAccess(true);
      } else if (!isMobile) {
        setHasAccess(false);
      } else {
        setHasAccess(false);
      }
    };
    checkAccess();
  }, [user]);
  const isHomePage = location === "/home";
  const reduceAnimations = location === "/profile" || location === "/settings/agent-profile";
  const bottomNavPages = ["/", "/home", "/map", "/buzz", "/games", "/notifications", "/leaderboard", "/intelligence", "/map-3d-tiler"];
  const isBottomNavPage = bottomNavPages.includes(location);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(MinimalHeaderStrip, { show: false, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center gap-1", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "w-2 h-2 bg-[#00D1FF] rounded-full",
            animate: {
              scale: [1, 1.2, 1],
              opacity: [1, 0.7, 1]
            },
            transition: {
              duration: 1.6,
              repeat: Infinity,
              ease: "easeInOut"
            },
            style: {
              boxShadow: "0 0 8px rgba(0, 209, 255, 0.6), 0 0 16px rgba(0, 209, 255, 0.4)"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "span",
          {
            className: "text-xs font-orbitron font-bold text-white tracking-wider",
            style: {
              textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"
            },
            children: "CODE"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ReferralCodeDisplay, {})
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        style: {
          position: "fixed",
          top: 0,
          left: 0,
          right: 0,
          zIndex: 50,
          display: "flex",
          justifyContent: "center",
          paddingTop: isPWA ? "calc(env(safe-area-inset-top, 0px) + 12px)" : "16px",
          paddingLeft: "16px",
          paddingRight: "16px",
          pointerEvents: "none"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "header",
          {
            style: {
              width: "100%",
              maxWidth: "600px",
              height: "64px",
              background: "linear-gradient(180deg, #2A3441 0%, #1E2630 100%)",
              borderRadius: "32px",
              boxShadow: "0 4px 24px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255,255,255,0.05)",
              pointerEvents: "auto",
              position: "relative",
              isolation: "isolate"
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "hidden" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-full w-full relative", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between h-full px-4 sm:px-6 relative", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(motion.div, { className: "flex items-center", animate: { opacity: hideHeader ? 0 : 1 }, transition: { duration: 0.3 }, children: leftComponent ? leftComponent : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
                  !isHomePage && !isBottomNavPage && canGoBack && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      variant: "ghost",
                      size: "icon",
                      onClick: () => {
                        hapticLight();
                        goBackWithFeedback();
                      },
                      className: "mr-2 rounded-xl hover:bg-white/10 unified-header-btn w-11 h-11 m1-touch-feedback",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-6 h-6" })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Link,
                    {
                      to: "/home",
                      className: "text-2xl sm:text-[1.75rem] font-orbitron font-bold m1ssion-logo m1-text-glow",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", style: {
                          textShadow: "0 0 12px rgba(0, 209, 255, 0.7), 0 0 24px rgba(0, 209, 255, 0.4)"
                        }, children: "M1" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                          "SSION",
                          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[10px] align-top ml-0.5", children: "" })
                        ] })
                      ]
                    }
                  )
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-1.5", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        className: "w-2.5 h-2.5 bg-[#00D1FF] rounded-full m1-glow-pulse",
                        animate: {
                          scale: [1, 1.3, 1],
                          opacity: [1, 0.8, 1]
                        },
                        transition: {
                          duration: 1.6,
                          repeat: reduceAnimations ? 0 : Infinity,
                          ease: "easeInOut"
                        },
                        style: {
                          boxShadow: "0 0 10px rgba(0, 209, 255, 0.7), 0 0 20px rgba(0, 209, 255, 0.5)"
                        }
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "span",
                      {
                        className: "text-[11px] font-orbitron font-bold text-white tracking-widest",
                        style: {
                          textShadow: "0 0 12px rgba(0, 209, 255, 0.7), 0 0 24px rgba(0, 209, 255, 0.4)"
                        },
                        children: "CODE"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(ReferralCodeDisplay, {})
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(motion.div, { className: "flex items-center space-x-1 sm:space-x-3", animate: { opacity: hideHeader ? 0 : 1 }, transition: { duration: 0.3 }, children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/settings", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      variant: "ghost",
                      size: "icon",
                      className: "rounded-xl hover:bg-white/10 unified-header-btn w-11 h-11 m1-touch-feedback",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          animate: {
                            rotate: [0, 360],
                            scale: [1, 1.08, 1]
                          },
                          transition: {
                            rotate: { duration: reduceAnimations ? 1.6 : 8, repeat: reduceAnimations ? 0 : Infinity, ease: "linear" },
                            scale: { duration: reduceAnimations ? 1.2 : 4, repeat: reduceAnimations ? 0 : Infinity, ease: "easeInOut" }
                          },
                          style: {
                            filter: "drop-shadow(0 0 10px rgba(0, 209, 255, 0.5))"
                          },
                          children: /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-6 h-6 text-[#00D1FF]" })
                        }
                      )
                    }
                  ) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    ProfileDropdown,
                    {
                      profileImage: currentProfileImage,
                      className: "cursor-pointer"
                    }
                  )
                ] })
              ] }) })
            ]
          }
        )
      }
    )
  ] });
};

const BottomNavigationComponent = () => {
  const [currentPath] = useLocation();
  const { unreadCount } = useNotifications();
  const { navigate } = useWouterNavigation();
  const isPWA = typeof window !== "undefined" && window.matchMedia("(display-mode: standalone)").matches;
  const links = [
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(House, { className: "h-6 w-6", strokeWidth: 1.5 }),
      path: "/home"
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "1.5", className: "w-6 h-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "12", cy: "12", r: "10" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" })
      ] }),
      path: "/map-3d-tiler"
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Circle, { strokeWidth: 1.5, className: "h-6 w-6" }),
      path: "/buzz",
      isSpecial: true
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg font-semibold", children: "AI" }),
      path: "/intelligence"
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(MessageSquare, { className: "h-6 w-6", strokeWidth: 1.5 }),
      path: "/notifications",
      badge: unreadCount > 0,
      badgeCount: unreadCount
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { width: "24", height: "24", viewBox: "0 0 24 24", fill: "currentColor", stroke: "currentColor", strokeWidth: "1", className: "w-6 h-6", children: /* @__PURE__ */ jsxRuntimeExports.jsx("polygon", { points: "12,18 4,7 20,7" }) }),
      path: "/leaderboard"
    }
  ];
  const handleNavigationPWA = async (link, e) => {
    e.preventDefault();
    hapticLight();
    navigate(link.path);
    if (isPWA) {
      setTimeout(() => window.scrollTo(0, 0), 100);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: "bottom-navigation-ios",
      "data-onboarding": "bottom-nav",
      style: {
        position: "fixed",
        left: 0,
        right: 0,
        bottom: 0,
        zIndex: 1e4,
        display: "flex",
        justifyContent: "center",
        // Bottom nav al massimo in basso - padding minimo
        paddingBottom: isPWA ? "env(safe-area-inset-bottom, 0px)" : "0px",
        paddingLeft: "16px",
        paddingRight: "16px",
        pointerEvents: "none"
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          style: {
            display: "flex",
            alignItems: "center",
            justifyContent: "space-around",
            width: "100%",
            maxWidth: "400px",
            height: "64px",
            background: "linear-gradient(180deg, #2A3441 0%, #1E2630 100%)",
            borderRadius: "32px",
            padding: "0 8px",
            boxShadow: "0 4px 24px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255,255,255,0.05)",
            pointerEvents: "auto"
          },
          children: links.map((link) => {
            const isActive = currentPath === link.path || link.path === "/map-3d-tiler" && currentPath === "/living-map-3d";
            return /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.button,
              {
                onClick: (e) => handleNavigationPWA(link, e),
                className: "relative flex flex-col items-center justify-center",
                style: {
                  background: "none",
                  border: "none",
                  outline: "none",
                  cursor: "pointer",
                  padding: "8px 12px",
                  WebkitTapHighlightColor: "transparent",
                  color: isActive ? "#00D1FF" : "#8B9CAF"
                },
                whileTap: { scale: 0.9 },
                whileHover: { scale: 1.05 },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isActive && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      style: {
                        position: "absolute",
                        width: "48px",
                        height: "48px",
                        borderRadius: "50%",
                        background: "rgba(0, 0, 0, 0.4)",
                        zIndex: 0
                      },
                      initial: { opacity: 0, scale: 0.6 },
                      animate: { opacity: 1, scale: 1 },
                      exit: { opacity: 0, scale: 0.6 },
                      transition: { duration: 0.2, ease: "easeOut" }
                    }
                  ) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isActive && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      style: {
                        position: "absolute",
                        top: "2px",
                        width: "20px",
                        height: "3px",
                        backgroundColor: "#00D1FF",
                        borderRadius: "2px",
                        boxShadow: "0 0 8px #00D1FF, 0 0 16px #00D1FF, 0 0 24px rgba(0, 209, 255, 0.6)",
                        zIndex: 2
                      },
                      initial: { opacity: 0, scaleX: 0 },
                      animate: {
                        opacity: 1,
                        scaleX: 1,
                        boxShadow: [
                          "0 0 8px #00D1FF, 0 0 16px #00D1FF, 0 0 24px rgba(0, 209, 255, 0.6)",
                          "0 0 12px #00D1FF, 0 0 24px #00D1FF, 0 0 32px rgba(0, 209, 255, 0.8)",
                          "0 0 8px #00D1FF, 0 0 16px #00D1FF, 0 0 24px rgba(0, 209, 255, 0.6)"
                        ]
                      },
                      exit: { opacity: 0, scaleX: 0 },
                      transition: {
                        duration: 0.2,
                        boxShadow: { duration: 2, repeat: Infinity, ease: "easeInOut" }
                      }
                    }
                  ) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.div,
                    {
                      className: "relative z-[1]",
                      animate: isActive ? {
                        filter: [
                          "drop-shadow(0 0 4px rgba(0, 209, 255, 0.6))",
                          "drop-shadow(0 0 8px rgba(0, 209, 255, 0.8))",
                          "drop-shadow(0 0 4px rgba(0, 209, 255, 0.6))"
                        ]
                      } : {},
                      transition: { duration: 2, repeat: Infinity, ease: "easeInOut" },
                      children: [
                        link.icon,
                        link.badge && link.badgeCount && /* @__PURE__ */ jsxRuntimeExports.jsx(
                          motion.div,
                          {
                            className: "absolute -top-1 -right-1 flex items-center justify-center h-4 w-4 bg-[#FF59F8] rounded-full",
                            style: { boxShadow: "0 0 8px rgba(255, 89, 248, 0.7)" },
                            initial: { scale: 0 },
                            animate: { scale: 1 },
                            children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[8px] font-bold text-white", children: link.badgeCount > 9 ? "9+" : link.badgeCount })
                          }
                        )
                      ]
                    }
                  )
                ]
              },
              link.path
            );
          })
        }
      )
    }
  );
};
const BottomNavigation = BottomNavigationComponent;

const GlobalLayout = ({ children }) => {
  const [location] = useLocation();
  const isCapacitor = detectPWAEnvironment();
  const hideNavigationRoutes = [
    "/login",
    "/register",
    "/auth",
    "/kyc",
    "/verification",
    "/select-mission"
  ];
  const fullScreenRoutes = [
    "/map",
    "/buzz",
    "/games"
  ];
  const selfManagedRoutes = [];
  const shouldHideNavigation = hideNavigationRoutes.includes(location);
  const isFullScreen = fullScreenRoutes.includes(location);
  const isSelfManaged = selfManagedRoutes.includes(location);
  if (shouldHideNavigation) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SafeAreaWrapper, { className: "min-h-screen", children });
  }
  if (isSelfManaged) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
  }
  if (isFullScreen) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SafeAreaWrapper, { className: "min-h-screen", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative min-h-screen", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: "relative z-10 global-layout-content", children }, location),
      /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(SafeAreaWrapper, { className: "min-h-screen", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "main",
      {
        className: "relative z-10 pt-[80px] pb-20 global-layout-content",
        style: {
          minHeight: "calc(100vh - 80px - 80px)",
          paddingTop: isCapacitor ? "calc(80px + env(safe-area-inset-top, 0px))" : "80px"
        },
        children
      },
      location
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
  ] }) });
};

function useQueryQRRedirect() {
  const [, setLocation] = useLocation();
  reactExports.useEffect(() => {
    try {
      const sp = new URLSearchParams(window.location.search);
      const raw = sp.get("qr")?.trim();
      if (!raw) return;
      setLocation(`/map`);
      const url = new URL(window.location.href);
      url.searchParams.delete("qr");
      window.history.replaceState({}, document.title, url.toString());
    } catch (e) {
    }
  }, [setLocation]);
}

const LazyImage = ({
  src,
  alt,
  className,
  placeholderSrc = "/placeholder.svg",
  threshold = 0.1,
  ...props
}) => {
  const [isLoaded, setIsLoaded] = reactExports.useState(false);
  const [isInView, setIsInView] = reactExports.useState(false);
  const imgRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    if (!imgRef.current) return;
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setIsInView(true);
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold }
    );
    observer.observe(imgRef.current);
    return () => {
      if (imgRef.current) {
        observer.unobserve(imgRef.current);
      }
    };
  }, [threshold]);
  const handleImageLoaded = () => {
    setIsLoaded(true);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: cn("relative overflow-hidden", className), style: props.style, children: [
    !isLoaded && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gray-900/20 animate-pulse flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      "img",
      {
        src: placeholderSrc,
        alt: "Loading...",
        className: "w-12 h-12 opacity-30"
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "img",
      {
        ref: imgRef,
        src: isInView ? src : placeholderSrc,
        alt: alt || "Image",
        className: cn(
          "transition-opacity duration-500",
          isLoaded ? "opacity-100" : "opacity-0"
        ),
        onLoad: handleImageLoaded,
        ...props
      }
    )
  ] });
};

const ImagePreview = ({
  isOpen,
  onClose,
  imageUrl,
  alt = "Image preview"
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogContent, { className: "sm:max-w-[60vw] max-w-[90vw] p-1 bg-black/80 border border-cyan-500/30 rounded-xl shadow-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        className: "absolute top-2 right-2 z-10 rounded-full bg-black/50 p-1.5 text-white/80 hover:bg-black/70 hover:text-white transition-colors",
        onClick: onClose,
        "aria-label": "Close preview",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "h-5 w-5" })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.img,
      {
        src: imageUrl,
        alt,
        initial: { opacity: 0, scale: 0.9 },
        animate: { opacity: 1, scale: 1 },
        transition: { duration: 0.3 },
        className: "w-full h-auto rounded-lg object-contain max-h-[80vh]"
      }
    )
  ] }) }) });
};

const useLongPress = (callback, options = {}) => {
  const { threshold = 500, onStart, onFinish, onCancel } = options;
  const [longPressTriggered, setLongPressTriggered] = reactExports.useState(false);
  const timeout = reactExports.useRef();
  const target = reactExports.useRef();
  const start = reactExports.useCallback((e) => {
    e.persist();
    if ("touches" in e) {
      e.preventDefault();
    }
    ({ ...e });
    target.current = e.target;
    timeout.current = setTimeout(() => {
      onStart?.();
      setLongPressTriggered(true);
      callback();
      onFinish?.();
    }, threshold);
  }, [callback, onFinish, onStart, threshold]);
  const clear = reactExports.useCallback(() => {
    timeout.current && clearTimeout(timeout.current);
    setLongPressTriggered(false);
    onCancel?.();
  }, [onCancel]);
  return {
    onMouseDown: (e) => start(e),
    onMouseUp: clear,
    onMouseLeave: clear,
    onTouchStart: (e) => start(e),
    onTouchEnd: clear
  };
};

const PrizeDetailsModal = ({ isOpen, onClose }) => {
  const [previewImage, setPreviewImage] = reactExports.useState(null);
  const prizes = [
    {
      name: "Lamborghini Huracn",
      description: "Vivi il brivido della velocit con una Lamborghini Huracn. Design aggressivo, motore ruggente e linee affilate:  pi di un'auto,  una dichiarazione di potere. Solo un agente M1SSION potr portarsela a casa.",
      image: "/lovable-uploads/211b98b7-646d-4c40-80d6-416ac71a54fc.png"
    },
    {
      name: "Ferrari SF90 Stradale",
      description: "Un'auto di lusso con prestazioni straordinarie, design all'avanguardia e tecnologia di punta.",
      image: "/lovable-uploads/2f1f79ad-4221-4a49-a188-81e28222514d.png"
    },
    {
      name: "Aston Martin DBX",
      description: "Il SUV pi elegante e potente mai prodotto da Aston Martin. Linee muscolose, prestazioni sportive e lusso senza compromessi per affrontare ogni missione con stile.",
      image: "/lovable-uploads/3b5f5a13-bb71-472b-9348-6e52c12cba7e.png"
    },
    {
      name: "Porsche 911 Turbo",
      description: "La Porsche 911 Turbo  il simbolo della perfezione tedesca: eleganza, potenza e precisione in un'unica auto. Un gioiello nero su quattro ruote per chi completa la M1SSION con intelligenza e velocit.",
      image: "/lovable-uploads/7bda6b4a-6ac6-489d-8b2f-b9a4f9c312a2.png"
    }
  ];
  const closePreview = () => {
    setPreviewImage(null);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      DialogContent,
      {
        className: "m1-relief sm:max-w-3xl w-[calc(100vw-2rem)] max-h-[85vh] overflow-y-auto p-6",
        style: {
          borderRadius: "24px"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-2xl font-orbitron text-center bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent", children: " Premi Esclusivi M1SSION" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(DialogDescription, { className: "text-center text-white/70", children: "Ecco i premi che potrai vincere partecipando alle nostre missioni speciali. Solo i pi veloci, astuti e determinati potranno conquistarli." })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6 my-6 p-1 rounded-2xl shadow-xl p-6", children: prizes.map((prize, index) => {
            const longPressProps = useLongPress(() => setPreviewImage(prize.image));
            return /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "div",
              {
                className: "m1-relief-sm p-4 rounded-xl hover:scale-[1.02] transition-all duration-300",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "div",
                    {
                      className: "h-48 overflow-hidden rounded-xl mb-4 cursor-pointer",
                      ...longPressProps,
                      onDoubleClick: () => setPreviewImage(prize.image),
                      onContextMenu: (e) => {
                        e.preventDefault();
                        setPreviewImage(prize.image);
                      },
                      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                        LazyImage,
                        {
                          src: prize.image,
                          alt: prize.name,
                          className: "w-full h-full object-cover transform hover:scale-105 transition-transform duration-500 rounded-xl"
                        }
                      )
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-orbitron text-lg font-bold text-cyan-400 mb-2", children: prize.name }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70", children: prize.description })
                ]
              },
              index
            );
          }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(DialogFooter, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogClose, { asChild: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { className: "w-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full", children: "Chiudi" }) }) })
        ]
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      ImagePreview,
      {
        isOpen: !!previewImage,
        onClose: closePreview,
        imageUrl: previewImage || "",
        alt: "Prize preview"
      }
    )
  ] });
};

const LandingFooter = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx("footer", { className: "py-16 px-4 bg-black w-full border-t border-white/20 relative z-50", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-screen-xl mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col md:flex-row justify-between items-center w-full mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-6 md:mb-0", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-2xl font-bold", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
          "SSION",
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" })
        ] })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap gap-4 justify-center md:justify-end", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/privacy-policy", className: "text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1", children: "Privacy Policy" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/cookie-policy", className: "text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1", children: "Cookie Policy" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/terms", className: "text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1", children: "Terms" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/policies", className: "text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1", children: "Policies" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/contact", className: "text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1", children: "Contact" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "border-t border-white/20 pt-8 text-center md:text-left", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-base text-white/80 font-medium", children: [
      " 2025 ",
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
        "SSION",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" })
      ] }),
      "  ALL RIGHTS RESERVED  NIYVORA KFT"
    ] }) })
  ] }) });
};

const SUPPORTED_LANGUAGES = ["en", "it", "fr", "es", "de", "pt", "zh", "ar"];
function detectInitialLanguage() {
  try {
    const browserLang = navigator.language || navigator.userLanguage;
    if (!browserLang) {
      return "en";
    }
    const primaryLang = browserLang.toLowerCase().split("-")[0];
    if (SUPPORTED_LANGUAGES.includes(primaryLang)) {
      return primaryLang;
    }
    return "en";
  } catch (error) {
    return "en";
  }
}

const landingTranslations = {
  en: {
    heroTitle: "M1SSION",
    heroSubtitle: "The Ultimate Challenge",
    heroDescription: "A prize awaits those who can see beyond. The clues are not hidden: they are disguised. It requires logic, coldness and vision. The challenge has begun.",
    joinTheHunt: "JOIN THE HUNT",
    learnMore: "LEARN MORE",
    missionStartsOn: "M1SSION STARTS ON 19 AUGUST",
    realPrizes: "REAL PRIZES",
    realPrizesDescription: "Not simulations. Not virtual tokens. Tangible prizes you can touch, use, own.",
    imageRepresentation: "Image for representation purposes",
    welcomeToMission: "WELCOME TO M1SSION",
    registerForMission: "Register for M1SSION",
    startMission: "START M1SSION",
    discoverMission: "Discover M1SSION",
    gdpr: {
      cookieTitle: "Cookie Settings",
      cookieDescription: 'We use cookies to enhance your experience, analyze site usage, and assist in our marketing efforts. By clicking "Accept All", you consent to our use of cookies.',
      cookieSettings: "Cookie Settings",
      cookiePreferences: "Cookie Preferences",
      acceptAll: "Accept All",
      rejectAll: "Reject All",
      saveSettings: "Save Settings",
      required: "Required",
      necessaryCookies: "Necessary Cookies",
      necessaryDescription: "Essential for the website to function properly. Cannot be disabled.",
      functionalCookies: "Functional Cookies",
      functionalDescription: "Enable enhanced functionality and personalization.",
      analyticsCookies: "Analytics Cookies",
      analyticsDescription: "Help us understand how visitors interact with the website.",
      marketingCookies: "Marketing Cookies",
      marketingDescription: "Used to track visitors and display relevant ads."
    }
  },
  it: {
    heroTitle: "M1SSION",
    heroSubtitle: "La Sfida Definitiva",
    heroDescription: "Un premio attende chi sa vedere oltre. Gli indizi non sono nascosti: sono camuffati. Serve logica, freddezza e visione. La sfida  iniziata.",
    joinTheHunt: "UNISCITI ALLA CACCIA",
    learnMore: "SCOPRI DI PI",
    missionStartsOn: "M1SSION INIZIA IL 19 AGOSTO",
    realPrizes: "PREMI REALI",
    realPrizesDescription: "Non simulazioni. Non gettoni virtuali. Premi tangibili che puoi toccare, usare, possedere.",
    imageRepresentation: "Immagine a scopo rappresentativo",
    welcomeToMission: "BENVENUTO IN M1SSION",
    registerForMission: "Registrati per M1SSION",
    startMission: "INIZIA M1SSION",
    discoverMission: "Scopri M1SSION",
    gdpr: {
      cookieTitle: "Impostazioni Cookie",
      cookieDescription: `Utilizziamo i cookie per migliorare la tua esperienza, analizzare l'utilizzo del sito e assistere nei nostri sforzi di marketing. Cliccando "Accetta Tutto", acconsenti all'uso dei nostri cookie.`,
      cookieSettings: "Impostazioni Cookie",
      cookiePreferences: "Preferenze Cookie",
      acceptAll: "Accetta Tutto",
      rejectAll: "Rifiuta Tutto",
      saveSettings: "Salva Impostazioni",
      required: "Richiesto",
      necessaryCookies: "Cookie Necessari",
      necessaryDescription: "Essenziali per il corretto funzionamento del sito web. Non possono essere disabilitati.",
      functionalCookies: "Cookie Funzionali",
      functionalDescription: "Abilitano funzionalit avanzate e personalizzazione.",
      analyticsCookies: "Cookie Analytics",
      analyticsDescription: "Ci aiutano a capire come i visitatori interagiscono con il sito web.",
      marketingCookies: "Cookie Marketing",
      marketingDescription: "Utilizzati per tracciare i visitatori e mostrare annunci pertinenti."
    }
  },
  fr: {
    heroTitle: "M1SSION",
    heroSubtitle: "Le Dfi Ultime",
    heroDescription: "Un prix attend ceux qui savent voir au-del. Les indices ne sont pas cachs : ils sont dguiss. Il faut de la logique, de la froideur et de la vision. Le dfi a commenc.",
    joinTheHunt: "REJOIGNEZ LA CHASSE",
    learnMore: "EN SAVOIR PLUS",
    missionStartsOn: "M1SSION COMMENCE LE 19 AOT",
    realPrizes: "VRAIS PRIX",
    realPrizesDescription: "Pas de simulations. Pas de jetons virtuels. Des prix tangibles que vous pouvez toucher, utiliser, possder.",
    imageRepresentation: "Image  des fins de reprsentation",
    welcomeToMission: "BIENVENUE DANS M1SSION",
    registerForMission: "S'inscrire  M1SSION",
    startMission: "COMMENCER M1SSION",
    discoverMission: "Dcouvrir M1SSION",
    gdpr: {
      cookieTitle: "Paramtres des Cookies",
      cookieDescription: `Nous utilisons des cookies pour amliorer votre exprience, analyser l'utilisation du site et assister dans nos efforts marketing. En cliquant sur "Tout Accepter", vous consentez  notre utilisation des cookies.`,
      cookieSettings: "Paramtres des Cookies",
      cookiePreferences: "Prfrences des Cookies",
      acceptAll: "Tout Accepter",
      rejectAll: "Tout Rejeter",
      saveSettings: "Sauvegarder les Paramtres",
      required: "Requis",
      necessaryCookies: "Cookies Ncessaires",
      necessaryDescription: "Essentiels pour le bon fonctionnement du site web. Ne peuvent pas tre dsactivs.",
      functionalCookies: "Cookies Fonctionnels",
      functionalDescription: "Permettent des fonctionnalits amliores et la personnalisation.",
      analyticsCookies: "Cookies Analytics",
      analyticsDescription: "Nous aident  comprendre comment les visiteurs interagissent avec le site web.",
      marketingCookies: "Cookies Marketing",
      marketingDescription: "Utiliss pour suivre les visiteurs et afficher des publicits pertinentes."
    }
  },
  es: {
    heroTitle: "M1SSION",
    heroSubtitle: "El Desafo Definitivo",
    heroDescription: "Un premio espera a quienes saben ver ms all. Las pistas no estn ocultas: estn disfrazadas. Requiere lgica, frialdad y visin. El desafo ha comenzado.",
    joinTheHunt: "NETE A LA CAZA",
    learnMore: "SABER MS",
    missionStartsOn: "M1SSION COMIENZA EL 19 DE AGOSTO",
    realPrizes: "PREMIOS REALES",
    realPrizesDescription: "No simulaciones. No tokens virtuales. Premios tangibles que puedes tocar, usar, poseer.",
    imageRepresentation: "Imagen con fines representativos",
    welcomeToMission: "BIENVENIDO A M1SSION",
    registerForMission: "Regstrate para M1SSION",
    startMission: "INICIAR M1SSION",
    discoverMission: "Descubrir M1SSION",
    gdpr: {
      cookieTitle: "Configuracin de Cookies",
      cookieDescription: 'Utilizamos cookies para mejorar tu experiencia, analizar el uso del sitio y asistir en nuestros esfuerzos de marketing. Al hacer clic en "Aceptar Todo", consientes nuestro uso de cookies.',
      cookieSettings: "Configuracin de Cookies",
      cookiePreferences: "Preferencias de Cookies",
      acceptAll: "Aceptar Todo",
      rejectAll: "Rechazar Todo",
      saveSettings: "Guardar Configuracin",
      required: "Requerido",
      necessaryCookies: "Cookies Necesarias",
      necessaryDescription: "Esenciales para el funcionamiento correcto del sitio web. No se pueden desactivar.",
      functionalCookies: "Cookies Funcionales",
      functionalDescription: "Permiten funcionalidad mejorada y personalizacin.",
      analyticsCookies: "Cookies Analytics",
      analyticsDescription: "Nos ayudan a entender cmo los visitantes interactan con el sitio web.",
      marketingCookies: "Cookies Marketing",
      marketingDescription: "Utilizadas para rastrear visitantes y mostrar anuncios relevantes."
    }
  },
  de: {
    heroTitle: "M1SSION",
    heroSubtitle: "Die Ultimative Herausforderung",
    heroDescription: "Ein Preis wartet auf diejenigen, die ber das Offensichtliche hinaussehen knnen. Die Hinweise sind nicht versteckt: sie sind getarnt. Es erfordert Logik, Klte und Vision. Die Herausforderung hat begonnen.",
    joinTheHunt: "DER JAGD BEITRETEN",
    learnMore: "MEHR ERFAHREN",
    missionStartsOn: "M1SSION BEGINNT AM 19. AUGUST",
    realPrizes: "ECHTE PREISE",
    realPrizesDescription: "Keine Simulationen. Keine virtuellen Token. Greifbare Preise, die Sie berhren, verwenden, besitzen knnen.",
    imageRepresentation: "Bild zu Darstellungszwecken",
    welcomeToMission: "WILLKOMMEN BEI M1SSION",
    registerForMission: "Fr M1SSION registrieren",
    startMission: "M1SSION STARTEN",
    discoverMission: "M1SSION Entdecken",
    gdpr: {
      cookieTitle: "Cookie-Einstellungen",
      cookieDescription: 'Wir verwenden Cookies, um Ihre Erfahrung zu verbessern, die Nutzung der Website zu analysieren und bei unseren Marketingbemhungen zu helfen. Durch Klicken auf "Alle Akzeptieren" stimmen Sie unserer Verwendung von Cookies zu.',
      cookieSettings: "Cookie-Einstellungen",
      cookiePreferences: "Cookie-Prferenzen",
      acceptAll: "Alle Akzeptieren",
      rejectAll: "Alle Ablehnen",
      saveSettings: "Einstellungen Speichern",
      required: "Erforderlich",
      necessaryCookies: "Notwendige Cookies",
      necessaryDescription: "Wesentlich fr das ordnungsgeme Funktionieren der Website. Knnen nicht deaktiviert werden.",
      functionalCookies: "Funktionale Cookies",
      functionalDescription: "Ermglichen erweiterte Funktionalitt und Personalisierung.",
      analyticsCookies: "Analytics Cookies",
      analyticsDescription: "Helfen uns zu verstehen, wie Besucher mit der Website interagieren.",
      marketingCookies: "Marketing Cookies",
      marketingDescription: "Werden verwendet, um Besucher zu verfolgen und relevante Werbung anzuzeigen."
    }
  },
  pt: {
    heroTitle: "M1SSION",
    heroSubtitle: "O Desafio Definitivo",
    heroDescription: "Um prmio aguarda aqueles que sabem ver alm. As pistas no esto escondidas: esto disfaradas. Requer lgica, frieza e viso. O desafio comeou.",
    joinTheHunt: "JUNTE-SE  CAADA",
    learnMore: "SABER MAIS",
    missionStartsOn: "M1SSION COMEA EM 19 DE AGOSTO",
    realPrizes: "PRMIOS REAIS",
    realPrizesDescription: "No simulaes. No tokens virtuais. Prmios tangveis que voc pode tocar, usar, possuir.",
    imageRepresentation: "Imagem para fins de representao",
    welcomeToMission: "BEM-VINDO  M1SSION",
    registerForMission: "Registre-se para M1SSION",
    startMission: "INICIAR M1SSION",
    discoverMission: "Descobrir M1SSION",
    gdpr: {
      cookieTitle: "Configuraes de Cookies",
      cookieDescription: 'Usamos cookies para melhorar sua experincia, analisar o uso do site e auxiliar em nossos esforos de marketing. Ao clicar em "Aceitar Tudo", voc consente com nosso uso de cookies.',
      cookieSettings: "Configuraes de Cookies",
      cookiePreferences: "Preferncias de Cookies",
      acceptAll: "Aceitar Tudo",
      rejectAll: "Rejeitar Tudo",
      saveSettings: "Salvar Configuraes",
      required: "Obrigatrio",
      necessaryCookies: "Cookies Necessrios",
      necessaryDescription: "Essenciais para o funcionamento adequado do site. No podem ser desabilitados.",
      functionalCookies: "Cookies Funcionais",
      functionalDescription: "Permitem funcionalidade aprimorada e personalizao.",
      analyticsCookies: "Cookies Analytics",
      analyticsDescription: "Nos ajudam a entender como os visitantes interagem com o site.",
      marketingCookies: "Cookies Marketing",
      marketingDescription: "Usados para rastrear visitantes e exibir anncios relevantes."
    }
  },
  zh: {
    heroTitle: "M1SSION",
    heroSubtitle: "",
    heroDescription: "",
    joinTheHunt: "",
    learnMore: "",
    missionStartsOn: "M1SSION  8  19 ",
    realPrizes: "",
    realPrizesDescription: "",
    imageRepresentation: "",
    welcomeToMission: " M1SSION",
    registerForMission: " M1SSION",
    startMission: " M1SSION",
    discoverMission: " M1SSION",
    gdpr: {
      cookieTitle: "Cookie ",
      cookieDescription: ' cookie "" cookie',
      cookieSettings: "Cookie ",
      cookiePreferences: "Cookie ",
      acceptAll: "",
      rejectAll: "",
      saveSettings: "",
      required: "",
      necessaryCookies: " Cookie",
      necessaryDescription: "",
      functionalCookies: " Cookie",
      functionalDescription: "",
      analyticsCookies: " Cookie",
      analyticsDescription: "",
      marketingCookies: " Cookie",
      marketingDescription: ""
    }
  },
  ar: {
    heroTitle: "M1SSION",
    heroSubtitle: " ",
    heroDescription: "        .   :  .    .   .",
    joinTheHunt: " ",
    learnMore: " ",
    missionStartsOn: "M1SSION   19 ",
    realPrizes: " ",
    realPrizesDescription: " .   .      .",
    imageRepresentation: "  ",
    welcomeToMission: "   M1SSION",
    registerForMission: "  M1SSION",
    startMission: " M1SSION",
    discoverMission: " M1SSION",
    gdpr: {
      cookieTitle: "   ",
      cookieDescription: '            .   " "       .',
      cookieSettings: "   ",
      cookiePreferences: "   ",
      acceptAll: " ",
      rejectAll: " ",
      saveSettings: " ",
      required: "",
      necessaryCookies: "   ",
      necessaryDescription: "   .   .",
      functionalCookies: "   ",
      functionalDescription: "   .",
      analyticsCookies: "   ",
      analyticsDescription: "       .",
      marketingCookies: "   ",
      marketingDescription: "      ."
    }
  }
};

const useLandingTranslations = () => {
  const [currentLanguage, setCurrentLanguage] = reactExports.useState("en");
  const [translations, setTranslations] = reactExports.useState(landingTranslations.en);
  reactExports.useEffect(() => {
    const detectedLanguage = detectInitialLanguage();
    setCurrentLanguage(detectedLanguage);
    setTranslations(landingTranslations[detectedLanguage]);
  }, []);
  const t = (key) => {
    const keys = key.split(".");
    let result = translations;
    for (const k of keys) {
      result = result?.[k];
      if (result === void 0) {
        return key;
      }
    }
    return result;
  };
  return {
    t,
    currentLanguage,
    setLanguage: (lang) => {
      setCurrentLanguage(lang);
      setTranslations(landingTranslations[lang]);
    }
  };
};

const CookieBanner$1 = () => {
  const { t } = useLandingTranslations();
  const [isVisible, setIsVisible] = reactExports.useState(false);
  const [showSettings, setShowSettings] = reactExports.useState(false);
  const [preferences, setPreferences] = reactExports.useState({
    necessary: true,
    // Always true, can't be disabled
    analytics: false,
    marketing: false,
    functional: false
  });
  reactExports.useEffect(() => {
    const cookieConsent = localStorage.getItem("cookie_consent") || localStorage.getItem("m1ssion-cookie-consent");
    if (!cookieConsent) {
      const timer = setTimeout(() => setIsVisible(true), 1e3);
      return () => clearTimeout(timer);
    }
  }, []);
  const handleAcceptAll = () => {
    const allAccepted = {
      necessary: true,
      analytics: true,
      marketing: true,
      functional: true
    };
    const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
    localStorage.setItem("cookie_consent", JSON.stringify(allAccepted));
    localStorage.setItem("cookie_banner_last_shown", today);
    localStorage.setItem("m1ssion-cookie-consent", JSON.stringify(allAccepted));
    localStorage.setItem("m1ssion-cookie-timestamp", (/* @__PURE__ */ new Date()).toISOString());
    setIsVisible(false);
  };
  const handleRejectAll = () => {
    const onlyNecessary = {
      necessary: true,
      analytics: false,
      marketing: false,
      functional: false
    };
    const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
    localStorage.setItem("cookie_consent", JSON.stringify(onlyNecessary));
    localStorage.setItem("cookie_banner_last_shown", today);
    localStorage.setItem("m1ssion-cookie-consent", JSON.stringify(onlyNecessary));
    localStorage.setItem("m1ssion-cookie-timestamp", (/* @__PURE__ */ new Date()).toISOString());
    setIsVisible(false);
  };
  const handleSaveSettings = () => {
    const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
    localStorage.setItem("cookie_consent", JSON.stringify(preferences));
    localStorage.setItem("cookie_banner_last_shown", today);
    localStorage.setItem("m1ssion-cookie-consent", JSON.stringify(preferences));
    localStorage.setItem("m1ssion-cookie-timestamp", (/* @__PURE__ */ new Date()).toISOString());
    setIsVisible(false);
    setShowSettings(false);
  };
  const togglePreference = (key) => {
    if (key === "necessary") return;
    setPreferences((prev) => ({
      ...prev,
      [key]: !prev[key]
    }));
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isVisible && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { y: 100, opacity: 0 },
      animate: { y: 0, opacity: 1 },
      exit: { y: 100, opacity: 0 },
      transition: { duration: 0.5, ease: "easeOut" },
      className: "fixed inset-0 flex items-center justify-center z-[9999] p-4",
      style: {
        paddingTop: "calc(env(safe-area-inset-top, 0px) + 20px)",
        paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 20px)",
        backgroundColor: "rgba(0, 0, 0, 0.7)",
        backdropFilter: "blur(8px)"
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-6xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "m1ssion-glass-card p-6", children: !showSettings ? (
        // Main banner
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col lg:flex-row lg:items-center gap-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-4 flex-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-8 h-8 text-cyan-400 mt-1 flex-shrink-0" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white mb-2", children: t("gdpr.cookieTitle") || "Cookie Settings" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 text-sm leading-relaxed", children: t("gdpr.cookieDescription") || 'We use cookies to enhance your experience, analyze site usage, and assist in our marketing efforts. By clicking "Accept All", you consent to our use of cookies.' })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-3 lg:ml-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: () => setShowSettings(true),
                variant: "outline",
                className: "text-cyan-400 border-cyan-400/50 hover:bg-cyan-400/10 hover:border-cyan-400 transition-all duration-300",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 mr-2" }),
                  t("gdpr.cookieSettings") || "Cookie Settings"
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleRejectAll,
                variant: "outline",
                className: "text-gray-300 border-gray-500/50 hover:bg-gray-500/10 hover:border-gray-400 transition-all duration-300",
                children: t("gdpr.rejectAll") || "Reject All"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleAcceptAll,
                className: "bg-gradient-to-r from-cyan-400 to-purple-600 text-black font-bold hover:shadow-[0_0_20px_rgba(0,229,255,0.5)] transition-all duration-300",
                children: t("gdpr.acceptAll") || "Accept All"
              }
            )
          ] })
        ] })
      ) : (
        // Settings panel
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white", children: t("gdpr.cookiePreferences") || "Cookie Preferences" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setShowSettings(false),
                className: "text-gray-400 hover:text-white transition-colors",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-6 h-6" })
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4 mb-6", children: [
            {
              key: "necessary",
              title: t("gdpr.necessaryCookies") || "Necessary Cookies",
              description: t("gdpr.necessaryDescription") || "Essential for the website to function properly. Cannot be disabled.",
              required: true
            },
            {
              key: "functional",
              title: t("gdpr.functionalCookies") || "Functional Cookies",
              description: t("gdpr.functionalDescription") || "Enable enhanced functionality and personalization.",
              required: false
            },
            {
              key: "analytics",
              title: t("gdpr.analyticsCookies") || "Analytics Cookies",
              description: t("gdpr.analyticsDescription") || "Help us understand how visitors interact with the website.",
              required: false
            },
            {
              key: "marketing",
              title: t("gdpr.marketingCookies") || "Marketing Cookies",
              description: t("gdpr.marketingDescription") || "Used to track visitors and display relevant ads.",
              required: false
            }
          ].map((cookie) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between p-4 rounded-lg bg-white/5 border border-white/10", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-white", children: cookie.title }),
                cookie.required && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs bg-cyan-400/20 text-cyan-400 px-2 py-1 rounded", children: t("gdpr.required") || "Required" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400", children: cookie.description })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "ml-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => togglePreference(cookie.key),
                disabled: cookie.required,
                className: `relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${preferences[cookie.key] ? "bg-cyan-400" : "bg-gray-600"} ${cookie.required ? "opacity-50 cursor-not-allowed" : "cursor-pointer"}`,
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "span",
                  {
                    className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${preferences[cookie.key] ? "translate-x-6" : "translate-x-1"}`
                  }
                )
              }
            ) })
          ] }, cookie.key)) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleRejectAll,
                variant: "outline",
                className: "text-gray-300 border-gray-500/50 hover:bg-gray-500/10 hover:border-gray-400 transition-all duration-300",
                children: t("gdpr.rejectAll") || "Reject All"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleSaveSettings,
                className: "bg-gradient-to-r from-cyan-400 to-purple-600 text-black font-bold hover:shadow-[0_0_20px_rgba(0,229,255,0.5)] transition-all duration-300 flex-1",
                children: t("gdpr.saveSettings") || "Save Settings"
              }
            )
          ] })
        ] })
      ) }) })
    }
  ) });
};

function _assertThisInitialized(self) {
  if (self === void 0) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }
  return self;
}
function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;
  subClass.__proto__ = superClass;
}
/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/
var _config = {
  autoSleep: 120,
  force3D: "auto",
  nullTargetWarn: 1,
  units: {
    lineHeight: ""
  }
}, _defaults$1 = {
  duration: 0.5,
  overwrite: false,
  delay: 0
}, _suppressOverwrites$1, _reverting$1, _context$2, _bigNum$1 = 1e8, _tinyNum = 1 / _bigNum$1, _2PI = Math.PI * 2, _HALF_PI = _2PI / 4, _gsID = 0, _sqrt = Math.sqrt, _cos = Math.cos, _sin = Math.sin, _isString$1 = function _isString2(value) {
  return typeof value === "string";
}, _isFunction$1 = function _isFunction2(value) {
  return typeof value === "function";
}, _isNumber$1 = function _isNumber2(value) {
  return typeof value === "number";
}, _isUndefined = function _isUndefined2(value) {
  return typeof value === "undefined";
}, _isObject$1 = function _isObject2(value) {
  return typeof value === "object";
}, _isNotFalse = function _isNotFalse2(value) {
  return value !== false;
}, _windowExists$2 = function _windowExists2() {
  return typeof window !== "undefined";
}, _isFuncOrString = function _isFuncOrString2(value) {
  return _isFunction$1(value) || _isString$1(value);
}, _isTypedArray = typeof ArrayBuffer === "function" && ArrayBuffer.isView || function() {
}, _isArray = Array.isArray, _strictNumExp = /(?:-?\.?\d|\.)+/gi, _numExp = /[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g, _numWithUnitExp = /[-+=.]*\d+[.e-]*\d*[a-z%]*/g, _complexStringNumExp = /[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi, _relExp = /[+-]=-?[.\d]+/, _delimitedValueExp = /[^,'"\[\]\s]+/gi, _unitExp = /^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i, _globalTimeline, _win$3, _coreInitted$2, _doc$3, _globals = {}, _installScope = {}, _coreReady, _install = function _install2(scope) {
  return (_installScope = _merge(scope, _globals)) && gsap$2;
}, _missingPlugin = function _missingPlugin2(property, value) {
  return console.warn("Invalid property", property, "set to", value, "Missing plugin? gsap.registerPlugin()");
}, _warn = function _warn2(message, suppress) {
  return !suppress && console.warn(message);
}, _addGlobal = function _addGlobal2(name, obj) {
  return name && (_globals[name] = obj) && _installScope && (_installScope[name] = obj) || _globals;
}, _emptyFunc = function _emptyFunc2() {
  return 0;
}, _startAtRevertConfig = {
  suppressEvents: true,
  isStart: true,
  kill: false
}, _revertConfigNoKill = {
  suppressEvents: true,
  kill: false
}, _revertConfig = {
  suppressEvents: true
}, _reservedProps = {}, _lazyTweens = [], _lazyLookup = {}, _lastRenderedFrame, _plugins = {}, _effects = {}, _nextGCFrame = 30, _harnessPlugins = [], _callbackNames = "", _harness = function _harness2(targets) {
  var target = targets[0], harnessPlugin, i;
  _isObject$1(target) || _isFunction$1(target) || (targets = [targets]);
  if (!(harnessPlugin = (target._gsap || {}).harness)) {
    i = _harnessPlugins.length;
    while (i-- && !_harnessPlugins[i].targetTest(target)) {
    }
    harnessPlugin = _harnessPlugins[i];
  }
  i = targets.length;
  while (i--) {
    targets[i] && (targets[i]._gsap || (targets[i]._gsap = new GSCache(targets[i], harnessPlugin))) || targets.splice(i, 1);
  }
  return targets;
}, _getCache = function _getCache2(target) {
  return target._gsap || _harness(toArray(target))[0]._gsap;
}, _getProperty = function _getProperty2(target, property, v) {
  return (v = target[property]) && _isFunction$1(v) ? target[property]() : _isUndefined(v) && target.getAttribute && target.getAttribute(property) || v;
}, _forEachName = function _forEachName2(names, func) {
  return (names = names.split(",")).forEach(func) || names;
}, _round$1 = function _round2(value) {
  return Math.round(value * 1e5) / 1e5 || 0;
}, _roundPrecise = function _roundPrecise2(value) {
  return Math.round(value * 1e7) / 1e7 || 0;
}, _parseRelative = function _parseRelative2(start, value) {
  var operator = value.charAt(0), end = parseFloat(value.substr(2));
  start = parseFloat(start);
  return operator === "+" ? start + end : operator === "-" ? start - end : operator === "*" ? start * end : start / end;
}, _arrayContainsAny = function _arrayContainsAny2(toSearch, toFind) {
  var l = toFind.length, i = 0;
  for (; toSearch.indexOf(toFind[i]) < 0 && ++i < l; ) {
  }
  return i < l;
}, _lazyRender = function _lazyRender2() {
  var l = _lazyTweens.length, a = _lazyTweens.slice(0), i, tween;
  _lazyLookup = {};
  _lazyTweens.length = 0;
  for (i = 0; i < l; i++) {
    tween = a[i];
    tween && tween._lazy && (tween.render(tween._lazy[0], tween._lazy[1], true)._lazy = 0);
  }
}, _isRevertWorthy = function _isRevertWorthy2(animation) {
  return !!(animation._initted || animation._startAt || animation.add);
}, _lazySafeRender = function _lazySafeRender2(animation, time, suppressEvents, force) {
  _lazyTweens.length && !_reverting$1 && _lazyRender();
  animation.render(time, suppressEvents, !!(_reverting$1 && time < 0 && _isRevertWorthy(animation)));
  _lazyTweens.length && !_reverting$1 && _lazyRender();
}, _numericIfPossible = function _numericIfPossible2(value) {
  var n = parseFloat(value);
  return (n || n === 0) && (value + "").match(_delimitedValueExp).length < 2 ? n : _isString$1(value) ? value.trim() : value;
}, _passThrough$1 = function _passThrough2(p) {
  return p;
}, _setDefaults$1 = function _setDefaults2(obj, defaults2) {
  for (var p in defaults2) {
    p in obj || (obj[p] = defaults2[p]);
  }
  return obj;
}, _setKeyframeDefaults = function _setKeyframeDefaults2(excludeDuration) {
  return function(obj, defaults2) {
    for (var p in defaults2) {
      p in obj || p === "duration" && excludeDuration || p === "ease" || (obj[p] = defaults2[p]);
    }
  };
}, _merge = function _merge2(base, toMerge) {
  for (var p in toMerge) {
    base[p] = toMerge[p];
  }
  return base;
}, _mergeDeep = function _mergeDeep2(base, toMerge) {
  for (var p in toMerge) {
    p !== "__proto__" && p !== "constructor" && p !== "prototype" && (base[p] = _isObject$1(toMerge[p]) ? _mergeDeep2(base[p] || (base[p] = {}), toMerge[p]) : toMerge[p]);
  }
  return base;
}, _copyExcluding = function _copyExcluding2(obj, excluding) {
  var copy = {}, p;
  for (p in obj) {
    p in excluding || (copy[p] = obj[p]);
  }
  return copy;
}, _inheritDefaults = function _inheritDefaults2(vars) {
  var parent = vars.parent || _globalTimeline, func = vars.keyframes ? _setKeyframeDefaults(_isArray(vars.keyframes)) : _setDefaults$1;
  if (_isNotFalse(vars.inherit)) {
    while (parent) {
      func(vars, parent.vars.defaults);
      parent = parent.parent || parent._dp;
    }
  }
  return vars;
}, _arraysMatch = function _arraysMatch2(a1, a2) {
  var i = a1.length, match = i === a2.length;
  while (match && i-- && a1[i] === a2[i]) {
  }
  return i < 0;
}, _addLinkedListItem = function _addLinkedListItem2(parent, child, firstProp, lastProp, sortBy) {
  var prev = parent[lastProp], t;
  if (sortBy) {
    t = child[sortBy];
    while (prev && prev[sortBy] > t) {
      prev = prev._prev;
    }
  }
  if (prev) {
    child._next = prev._next;
    prev._next = child;
  } else {
    child._next = parent[firstProp];
    parent[firstProp] = child;
  }
  if (child._next) {
    child._next._prev = child;
  } else {
    parent[lastProp] = child;
  }
  child._prev = prev;
  child.parent = child._dp = parent;
  return child;
}, _removeLinkedListItem = function _removeLinkedListItem2(parent, child, firstProp, lastProp) {
  if (firstProp === void 0) {
    firstProp = "_first";
  }
  if (lastProp === void 0) {
    lastProp = "_last";
  }
  var prev = child._prev, next = child._next;
  if (prev) {
    prev._next = next;
  } else if (parent[firstProp] === child) {
    parent[firstProp] = next;
  }
  if (next) {
    next._prev = prev;
  } else if (parent[lastProp] === child) {
    parent[lastProp] = prev;
  }
  child._next = child._prev = child.parent = null;
}, _removeFromParent = function _removeFromParent2(child, onlyIfParentHasAutoRemove) {
  child.parent && (!onlyIfParentHasAutoRemove || child.parent.autoRemoveChildren) && child.parent.remove && child.parent.remove(child);
  child._act = 0;
}, _uncache = function _uncache2(animation, child) {
  if (animation && (!child || child._end > animation._dur || child._start < 0)) {
    var a = animation;
    while (a) {
      a._dirty = 1;
      a = a.parent;
    }
  }
  return animation;
}, _recacheAncestors = function _recacheAncestors2(animation) {
  var parent = animation.parent;
  while (parent && parent.parent) {
    parent._dirty = 1;
    parent.totalDuration();
    parent = parent.parent;
  }
  return animation;
}, _rewindStartAt = function _rewindStartAt2(tween, totalTime, suppressEvents, force) {
  return tween._startAt && (_reverting$1 ? tween._startAt.revert(_revertConfigNoKill) : tween.vars.immediateRender && !tween.vars.autoRevert || tween._startAt.render(totalTime, true, force));
}, _hasNoPausedAncestors = function _hasNoPausedAncestors2(animation) {
  return !animation || animation._ts && _hasNoPausedAncestors2(animation.parent);
}, _elapsedCycleDuration = function _elapsedCycleDuration2(animation) {
  return animation._repeat ? _animationCycle(animation._tTime, animation = animation.duration() + animation._rDelay) * animation : 0;
}, _animationCycle = function _animationCycle2(tTime, cycleDuration) {
  var whole = Math.floor(tTime = _roundPrecise(tTime / cycleDuration));
  return tTime && whole === tTime ? whole - 1 : whole;
}, _parentToChildTotalTime = function _parentToChildTotalTime2(parentTime, child) {
  return (parentTime - child._start) * child._ts + (child._ts >= 0 ? 0 : child._dirty ? child.totalDuration() : child._tDur);
}, _setEnd = function _setEnd2(animation) {
  return animation._end = _roundPrecise(animation._start + (animation._tDur / Math.abs(animation._ts || animation._rts || _tinyNum) || 0));
}, _alignPlayhead = function _alignPlayhead2(animation, totalTime) {
  var parent = animation._dp;
  if (parent && parent.smoothChildTiming && animation._ts) {
    animation._start = _roundPrecise(parent._time - (animation._ts > 0 ? totalTime / animation._ts : ((animation._dirty ? animation.totalDuration() : animation._tDur) - totalTime) / -animation._ts));
    _setEnd(animation);
    parent._dirty || _uncache(parent, animation);
  }
  return animation;
}, _postAddChecks = function _postAddChecks2(timeline2, child) {
  var t;
  if (child._time || !child._dur && child._initted || child._start < timeline2._time && (child._dur || !child.add)) {
    t = _parentToChildTotalTime(timeline2.rawTime(), child);
    if (!child._dur || _clamp$1(0, child.totalDuration(), t) - child._tTime > _tinyNum) {
      child.render(t, true);
    }
  }
  if (_uncache(timeline2, child)._dp && timeline2._initted && timeline2._time >= timeline2._dur && timeline2._ts) {
    if (timeline2._dur < timeline2.duration()) {
      t = timeline2;
      while (t._dp) {
        t.rawTime() >= 0 && t.totalTime(t._tTime);
        t = t._dp;
      }
    }
    timeline2._zTime = -_tinyNum;
  }
}, _addToTimeline = function _addToTimeline2(timeline2, child, position, skipChecks) {
  child.parent && _removeFromParent(child);
  child._start = _roundPrecise((_isNumber$1(position) ? position : position || timeline2 !== _globalTimeline ? _parsePosition$1(timeline2, position, child) : timeline2._time) + child._delay);
  child._end = _roundPrecise(child._start + (child.totalDuration() / Math.abs(child.timeScale()) || 0));
  _addLinkedListItem(timeline2, child, "_first", "_last", timeline2._sort ? "_start" : 0);
  _isFromOrFromStart(child) || (timeline2._recent = child);
  skipChecks || _postAddChecks(timeline2, child);
  timeline2._ts < 0 && _alignPlayhead(timeline2, timeline2._tTime);
  return timeline2;
}, _scrollTrigger = function _scrollTrigger2(animation, trigger) {
  return (_globals.ScrollTrigger || _missingPlugin("scrollTrigger", trigger)) && _globals.ScrollTrigger.create(trigger, animation);
}, _attemptInitTween = function _attemptInitTween2(tween, time, force, suppressEvents, tTime) {
  _initTween(tween, time, tTime);
  if (!tween._initted) {
    return 1;
  }
  if (!force && tween._pt && !_reverting$1 && (tween._dur && tween.vars.lazy !== false || !tween._dur && tween.vars.lazy) && _lastRenderedFrame !== _ticker.frame) {
    _lazyTweens.push(tween);
    tween._lazy = [tTime, suppressEvents];
    return 1;
  }
}, _parentPlayheadIsBeforeStart = function _parentPlayheadIsBeforeStart2(_ref) {
  var parent = _ref.parent;
  return parent && parent._ts && parent._initted && !parent._lock && (parent.rawTime() < 0 || _parentPlayheadIsBeforeStart2(parent));
}, _isFromOrFromStart = function _isFromOrFromStart2(_ref2) {
  var data = _ref2.data;
  return data === "isFromStart" || data === "isStart";
}, _renderZeroDurationTween = function _renderZeroDurationTween2(tween, totalTime, suppressEvents, force) {
  var prevRatio = tween.ratio, ratio = totalTime < 0 || !totalTime && (!tween._start && _parentPlayheadIsBeforeStart(tween) && !(!tween._initted && _isFromOrFromStart(tween)) || (tween._ts < 0 || tween._dp._ts < 0) && !_isFromOrFromStart(tween)) ? 0 : 1, repeatDelay = tween._rDelay, tTime = 0, pt, iteration, prevIteration;
  if (repeatDelay && tween._repeat) {
    tTime = _clamp$1(0, tween._tDur, totalTime);
    iteration = _animationCycle(tTime, repeatDelay);
    tween._yoyo && iteration & 1 && (ratio = 1 - ratio);
    if (iteration !== _animationCycle(tween._tTime, repeatDelay)) {
      prevRatio = 1 - ratio;
      tween.vars.repeatRefresh && tween._initted && tween.invalidate();
    }
  }
  if (ratio !== prevRatio || _reverting$1 || force || tween._zTime === _tinyNum || !totalTime && tween._zTime) {
    if (!tween._initted && _attemptInitTween(tween, totalTime, force, suppressEvents, tTime)) {
      return;
    }
    prevIteration = tween._zTime;
    tween._zTime = totalTime || (suppressEvents ? _tinyNum : 0);
    suppressEvents || (suppressEvents = totalTime && !prevIteration);
    tween.ratio = ratio;
    tween._from && (ratio = 1 - ratio);
    tween._time = 0;
    tween._tTime = tTime;
    pt = tween._pt;
    while (pt) {
      pt.r(ratio, pt.d);
      pt = pt._next;
    }
    totalTime < 0 && _rewindStartAt(tween, totalTime, suppressEvents, true);
    tween._onUpdate && !suppressEvents && _callback$1(tween, "onUpdate");
    tTime && tween._repeat && !suppressEvents && tween.parent && _callback$1(tween, "onRepeat");
    if ((totalTime >= tween._tDur || totalTime < 0) && tween.ratio === ratio) {
      ratio && _removeFromParent(tween, 1);
      if (!suppressEvents && !_reverting$1) {
        _callback$1(tween, ratio ? "onComplete" : "onReverseComplete", true);
        tween._prom && tween._prom();
      }
    }
  } else if (!tween._zTime) {
    tween._zTime = totalTime;
  }
}, _findNextPauseTween = function _findNextPauseTween2(animation, prevTime, time) {
  var child;
  if (time > prevTime) {
    child = animation._first;
    while (child && child._start <= time) {
      if (child.data === "isPause" && child._start > prevTime) {
        return child;
      }
      child = child._next;
    }
  } else {
    child = animation._last;
    while (child && child._start >= time) {
      if (child.data === "isPause" && child._start < prevTime) {
        return child;
      }
      child = child._prev;
    }
  }
}, _setDuration = function _setDuration2(animation, duration, skipUncache, leavePlayhead) {
  var repeat = animation._repeat, dur = _roundPrecise(duration) || 0, totalProgress = animation._tTime / animation._tDur;
  totalProgress && !leavePlayhead && (animation._time *= dur / animation._dur);
  animation._dur = dur;
  animation._tDur = !repeat ? dur : repeat < 0 ? 1e10 : _roundPrecise(dur * (repeat + 1) + animation._rDelay * repeat);
  totalProgress > 0 && !leavePlayhead && _alignPlayhead(animation, animation._tTime = animation._tDur * totalProgress);
  animation.parent && _setEnd(animation);
  skipUncache || _uncache(animation.parent, animation);
  return animation;
}, _onUpdateTotalDuration = function _onUpdateTotalDuration2(animation) {
  return animation instanceof Timeline ? _uncache(animation) : _setDuration(animation, animation._dur);
}, _zeroPosition = {
  _start: 0,
  endTime: _emptyFunc,
  totalDuration: _emptyFunc
}, _parsePosition$1 = function _parsePosition2(animation, position, percentAnimation) {
  var labels = animation.labels, recent = animation._recent || _zeroPosition, clippedDuration = animation.duration() >= _bigNum$1 ? recent.endTime(false) : animation._dur, i, offset, isPercent;
  if (_isString$1(position) && (isNaN(position) || position in labels)) {
    offset = position.charAt(0);
    isPercent = position.substr(-1) === "%";
    i = position.indexOf("=");
    if (offset === "<" || offset === ">") {
      i >= 0 && (position = position.replace(/=/, ""));
      return (offset === "<" ? recent._start : recent.endTime(recent._repeat >= 0)) + (parseFloat(position.substr(1)) || 0) * (isPercent ? (i < 0 ? recent : percentAnimation).totalDuration() / 100 : 1);
    }
    if (i < 0) {
      position in labels || (labels[position] = clippedDuration);
      return labels[position];
    }
    offset = parseFloat(position.charAt(i - 1) + position.substr(i + 1));
    if (isPercent && percentAnimation) {
      offset = offset / 100 * (_isArray(percentAnimation) ? percentAnimation[0] : percentAnimation).totalDuration();
    }
    return i > 1 ? _parsePosition2(animation, position.substr(0, i - 1), percentAnimation) + offset : clippedDuration + offset;
  }
  return position == null ? clippedDuration : +position;
}, _createTweenType = function _createTweenType2(type, params, timeline2) {
  var isLegacy = _isNumber$1(params[1]), varsIndex = (isLegacy ? 2 : 1) + (type < 2 ? 0 : 1), vars = params[varsIndex], irVars, parent;
  isLegacy && (vars.duration = params[1]);
  vars.parent = timeline2;
  if (type) {
    irVars = vars;
    parent = timeline2;
    while (parent && !("immediateRender" in irVars)) {
      irVars = parent.vars.defaults || {};
      parent = _isNotFalse(parent.vars.inherit) && parent.parent;
    }
    vars.immediateRender = _isNotFalse(irVars.immediateRender);
    type < 2 ? vars.runBackwards = 1 : vars.startAt = params[varsIndex - 1];
  }
  return new Tween(params[0], vars, params[varsIndex + 1]);
}, _conditionalReturn = function _conditionalReturn2(value, func) {
  return value || value === 0 ? func(value) : func;
}, _clamp$1 = function _clamp2(min, max, value) {
  return value < min ? min : value > max ? max : value;
}, getUnit = function getUnit2(value, v) {
  return !_isString$1(value) || !(v = _unitExp.exec(value)) ? "" : v[1];
}, clamp$1 = function clamp2(min, max, value) {
  return _conditionalReturn(value, function(v) {
    return _clamp$1(min, max, v);
  });
}, _slice = [].slice, _isArrayLike = function _isArrayLike2(value, nonEmpty) {
  return value && _isObject$1(value) && "length" in value && (!nonEmpty && !value.length || value.length - 1 in value && _isObject$1(value[0])) && !value.nodeType && value !== _win$3;
}, _flatten = function _flatten2(ar, leaveStrings, accumulator) {
  if (accumulator === void 0) {
    accumulator = [];
  }
  return ar.forEach(function(value) {
    var _accumulator;
    return _isString$1(value) && !leaveStrings || _isArrayLike(value, 1) ? (_accumulator = accumulator).push.apply(_accumulator, toArray(value)) : accumulator.push(value);
  }) || accumulator;
}, toArray = function toArray2(value, scope, leaveStrings) {
  return _context$2 && !scope && _context$2.selector ? _context$2.selector(value) : _isString$1(value) && !leaveStrings && (_coreInitted$2 || !_wake()) ? _slice.call((scope || _doc$3).querySelectorAll(value), 0) : _isArray(value) ? _flatten(value, leaveStrings) : _isArrayLike(value) ? _slice.call(value, 0) : value ? [value] : [];
}, selector = function selector2(value) {
  value = toArray(value)[0] || _warn("Invalid scope") || {};
  return function(v) {
    var el = value.current || value.nativeElement || value;
    return toArray(v, el.querySelectorAll ? el : el === value ? _warn("Invalid scope") || _doc$3.createElement("div") : value);
  };
}, shuffle = function shuffle2(a) {
  return a.sort(function() {
    return 0.5 - Math.random();
  });
}, distribute = function distribute2(v) {
  if (_isFunction$1(v)) {
    return v;
  }
  var vars = _isObject$1(v) ? v : {
    each: v
  }, ease = _parseEase(vars.ease), from = vars.from || 0, base = parseFloat(vars.base) || 0, cache = {}, isDecimal = from > 0 && from < 1, ratios = isNaN(from) || isDecimal, axis = vars.axis, ratioX = from, ratioY = from;
  if (_isString$1(from)) {
    ratioX = ratioY = {
      center: 0.5,
      edges: 0.5,
      end: 1
    }[from] || 0;
  } else if (!isDecimal && ratios) {
    ratioX = from[0];
    ratioY = from[1];
  }
  return function(i, target, a) {
    var l = (a || vars).length, distances = cache[l], originX, originY, x, y, d, j, max, min, wrapAt;
    if (!distances) {
      wrapAt = vars.grid === "auto" ? 0 : (vars.grid || [1, _bigNum$1])[1];
      if (!wrapAt) {
        max = -_bigNum$1;
        while (max < (max = a[wrapAt++].getBoundingClientRect().left) && wrapAt < l) {
        }
        wrapAt < l && wrapAt--;
      }
      distances = cache[l] = [];
      originX = ratios ? Math.min(wrapAt, l) * ratioX - 0.5 : from % wrapAt;
      originY = wrapAt === _bigNum$1 ? 0 : ratios ? l * ratioY / wrapAt - 0.5 : from / wrapAt | 0;
      max = 0;
      min = _bigNum$1;
      for (j = 0; j < l; j++) {
        x = j % wrapAt - originX;
        y = originY - (j / wrapAt | 0);
        distances[j] = d = !axis ? _sqrt(x * x + y * y) : Math.abs(axis === "y" ? y : x);
        d > max && (max = d);
        d < min && (min = d);
      }
      from === "random" && shuffle(distances);
      distances.max = max - min;
      distances.min = min;
      distances.v = l = (parseFloat(vars.amount) || parseFloat(vars.each) * (wrapAt > l ? l - 1 : !axis ? Math.max(wrapAt, l / wrapAt) : axis === "y" ? l / wrapAt : wrapAt) || 0) * (from === "edges" ? -1 : 1);
      distances.b = l < 0 ? base - l : base;
      distances.u = getUnit(vars.amount || vars.each) || 0;
      ease = ease && l < 0 ? _invertEase(ease) : ease;
    }
    l = (distances[i] - distances.min) / distances.max || 0;
    return _roundPrecise(distances.b + (ease ? ease(l) : l) * distances.v) + distances.u;
  };
}, _roundModifier = function _roundModifier2(v) {
  var p = Math.pow(10, ((v + "").split(".")[1] || "").length);
  return function(raw) {
    var n = _roundPrecise(Math.round(parseFloat(raw) / v) * v * p);
    return (n - n % 1) / p + (_isNumber$1(raw) ? 0 : getUnit(raw));
  };
}, snap = function snap2(snapTo, value) {
  var isArray = _isArray(snapTo), radius, is2D;
  if (!isArray && _isObject$1(snapTo)) {
    radius = isArray = snapTo.radius || _bigNum$1;
    if (snapTo.values) {
      snapTo = toArray(snapTo.values);
      if (is2D = !_isNumber$1(snapTo[0])) {
        radius *= radius;
      }
    } else {
      snapTo = _roundModifier(snapTo.increment);
    }
  }
  return _conditionalReturn(value, !isArray ? _roundModifier(snapTo) : _isFunction$1(snapTo) ? function(raw) {
    is2D = snapTo(raw);
    return Math.abs(is2D - raw) <= radius ? is2D : raw;
  } : function(raw) {
    var x = parseFloat(is2D ? raw.x : raw), y = parseFloat(is2D ? raw.y : 0), min = _bigNum$1, closest = 0, i = snapTo.length, dx, dy;
    while (i--) {
      if (is2D) {
        dx = snapTo[i].x - x;
        dy = snapTo[i].y - y;
        dx = dx * dx + dy * dy;
      } else {
        dx = Math.abs(snapTo[i] - x);
      }
      if (dx < min) {
        min = dx;
        closest = i;
      }
    }
    closest = !radius || min <= radius ? snapTo[closest] : raw;
    return is2D || closest === raw || _isNumber$1(raw) ? closest : closest + getUnit(raw);
  });
}, random = function random2(min, max, roundingIncrement, returnFunction) {
  return _conditionalReturn(_isArray(min) ? !max : roundingIncrement === true ? !!(roundingIncrement = 0) : !returnFunction, function() {
    return _isArray(min) ? min[~~(Math.random() * min.length)] : (roundingIncrement = roundingIncrement || 1e-5) && (returnFunction = roundingIncrement < 1 ? Math.pow(10, (roundingIncrement + "").length - 2) : 1) && Math.floor(Math.round((min - roundingIncrement / 2 + Math.random() * (max - min + roundingIncrement * 0.99)) / roundingIncrement) * roundingIncrement * returnFunction) / returnFunction;
  });
}, pipe = function pipe2() {
  for (var _len = arguments.length, functions = new Array(_len), _key = 0; _key < _len; _key++) {
    functions[_key] = arguments[_key];
  }
  return function(value) {
    return functions.reduce(function(v, f) {
      return f(v);
    }, value);
  };
}, unitize = function unitize2(func, unit) {
  return function(value) {
    return func(parseFloat(value)) + (unit || getUnit(value));
  };
}, normalize$2 = function normalize2(min, max, value) {
  return mapRange(min, max, 0, 1, value);
}, _wrapArray = function _wrapArray2(a, wrapper, value) {
  return _conditionalReturn(value, function(index) {
    return a[~~wrapper(index)];
  });
}, wrap = function wrap2(min, max, value) {
  var range = max - min;
  return _isArray(min) ? _wrapArray(min, wrap2(0, min.length), max) : _conditionalReturn(value, function(value2) {
    return (range + (value2 - min) % range) % range + min;
  });
}, wrapYoyo = function wrapYoyo2(min, max, value) {
  var range = max - min, total = range * 2;
  return _isArray(min) ? _wrapArray(min, wrapYoyo2(0, min.length - 1), max) : _conditionalReturn(value, function(value2) {
    value2 = (total + (value2 - min) % total) % total || 0;
    return min + (value2 > range ? total - value2 : value2);
  });
}, _replaceRandom = function _replaceRandom2(value) {
  var prev = 0, s = "", i, nums, end, isArray;
  while (~(i = value.indexOf("random(", prev))) {
    end = value.indexOf(")", i);
    isArray = value.charAt(i + 7) === "[";
    nums = value.substr(i + 7, end - i - 7).match(isArray ? _delimitedValueExp : _strictNumExp);
    s += value.substr(prev, i - prev) + random(isArray ? nums : +nums[0], isArray ? 0 : +nums[1], +nums[2] || 1e-5);
    prev = end + 1;
  }
  return s + value.substr(prev, value.length - prev);
}, mapRange = function mapRange2(inMin, inMax, outMin, outMax, value) {
  var inRange = inMax - inMin, outRange = outMax - outMin;
  return _conditionalReturn(value, function(value2) {
    return outMin + ((value2 - inMin) / inRange * outRange || 0);
  });
}, interpolate = function interpolate2(start, end, progress, mutate) {
  var func = isNaN(start + end) ? 0 : function(p2) {
    return (1 - p2) * start + p2 * end;
  };
  if (!func) {
    var isString = _isString$1(start), master = {}, p, i, interpolators, l, il;
    progress === true && (mutate = 1) && (progress = null);
    if (isString) {
      start = {
        p: start
      };
      end = {
        p: end
      };
    } else if (_isArray(start) && !_isArray(end)) {
      interpolators = [];
      l = start.length;
      il = l - 2;
      for (i = 1; i < l; i++) {
        interpolators.push(interpolate2(start[i - 1], start[i]));
      }
      l--;
      func = function func2(p2) {
        p2 *= l;
        var i2 = Math.min(il, ~~p2);
        return interpolators[i2](p2 - i2);
      };
      progress = end;
    } else if (!mutate) {
      start = _merge(_isArray(start) ? [] : {}, start);
    }
    if (!interpolators) {
      for (p in end) {
        _addPropTween.call(master, start, p, "get", end[p]);
      }
      func = function func2(p2) {
        return _renderPropTweens(p2, master) || (isString ? start.p : start);
      };
    }
  }
  return _conditionalReturn(progress, func);
}, _getLabelInDirection = function _getLabelInDirection2(timeline2, fromTime, backward) {
  var labels = timeline2.labels, min = _bigNum$1, p, distance, label;
  for (p in labels) {
    distance = labels[p] - fromTime;
    if (distance < 0 === !!backward && distance && min > (distance = Math.abs(distance))) {
      label = p;
      min = distance;
    }
  }
  return label;
}, _callback$1 = function _callback2(animation, type, executeLazyFirst) {
  var v = animation.vars, callback = v[type], prevContext = _context$2, context3 = animation._ctx, params, scope, result;
  if (!callback) {
    return;
  }
  params = v[type + "Params"];
  scope = v.callbackScope || animation;
  executeLazyFirst && _lazyTweens.length && _lazyRender();
  context3 && (_context$2 = context3);
  result = params ? callback.apply(scope, params) : callback.call(scope);
  _context$2 = prevContext;
  return result;
}, _interrupt = function _interrupt2(animation) {
  _removeFromParent(animation);
  animation.scrollTrigger && animation.scrollTrigger.kill(!!_reverting$1);
  animation.progress() < 1 && _callback$1(animation, "onInterrupt");
  return animation;
}, _quickTween, _registerPluginQueue = [], _createPlugin = function _createPlugin2(config3) {
  if (!config3) return;
  config3 = !config3.name && config3["default"] || config3;
  if (_windowExists$2() || config3.headless) {
    var name = config3.name, isFunc = _isFunction$1(config3), Plugin = name && !isFunc && config3.init ? function() {
      this._props = [];
    } : config3, instanceDefaults = {
      init: _emptyFunc,
      render: _renderPropTweens,
      add: _addPropTween,
      kill: _killPropTweensOf,
      modifier: _addPluginModifier,
      rawVars: 0
    }, statics = {
      targetTest: 0,
      get: 0,
      getSetter: _getSetter,
      aliases: {},
      register: 0
    };
    _wake();
    if (config3 !== Plugin) {
      if (_plugins[name]) {
        return;
      }
      _setDefaults$1(Plugin, _setDefaults$1(_copyExcluding(config3, instanceDefaults), statics));
      _merge(Plugin.prototype, _merge(instanceDefaults, _copyExcluding(config3, statics)));
      _plugins[Plugin.prop = name] = Plugin;
      if (config3.targetTest) {
        _harnessPlugins.push(Plugin);
        _reservedProps[name] = 1;
      }
      name = (name === "css" ? "CSS" : name.charAt(0).toUpperCase() + name.substr(1)) + "Plugin";
    }
    _addGlobal(name, Plugin);
    config3.register && config3.register(gsap$2, Plugin, PropTween);
  } else {
    _registerPluginQueue.push(config3);
  }
}, _255 = 255, _colorLookup = {
  aqua: [0, _255, _255],
  lime: [0, _255, 0],
  silver: [192, 192, 192],
  black: [0, 0, 0],
  maroon: [128, 0, 0],
  teal: [0, 128, 128],
  blue: [0, 0, _255],
  navy: [0, 0, 128],
  white: [_255, _255, _255],
  olive: [128, 128, 0],
  yellow: [_255, _255, 0],
  orange: [_255, 165, 0],
  gray: [128, 128, 128],
  purple: [128, 0, 128],
  green: [0, 128, 0],
  red: [_255, 0, 0],
  pink: [_255, 192, 203],
  cyan: [0, _255, _255],
  transparent: [_255, _255, _255, 0]
}, _hue = function _hue2(h, m1, m2) {
  h += h < 0 ? 1 : h > 1 ? -1 : 0;
  return (h * 6 < 1 ? m1 + (m2 - m1) * h * 6 : h < 0.5 ? m2 : h * 3 < 2 ? m1 + (m2 - m1) * (2 / 3 - h) * 6 : m1) * _255 + 0.5 | 0;
}, splitColor = function splitColor2(v, toHSL, forceAlpha) {
  var a = !v ? _colorLookup.black : _isNumber$1(v) ? [v >> 16, v >> 8 & _255, v & _255] : 0, r, g, b, h, s, l, max, min, d, wasHSL;
  if (!a) {
    if (v.substr(-1) === ",") {
      v = v.substr(0, v.length - 1);
    }
    if (_colorLookup[v]) {
      a = _colorLookup[v];
    } else if (v.charAt(0) === "#") {
      if (v.length < 6) {
        r = v.charAt(1);
        g = v.charAt(2);
        b = v.charAt(3);
        v = "#" + r + r + g + g + b + b + (v.length === 5 ? v.charAt(4) + v.charAt(4) : "");
      }
      if (v.length === 9) {
        a = parseInt(v.substr(1, 6), 16);
        return [a >> 16, a >> 8 & _255, a & _255, parseInt(v.substr(7), 16) / 255];
      }
      v = parseInt(v.substr(1), 16);
      a = [v >> 16, v >> 8 & _255, v & _255];
    } else if (v.substr(0, 3) === "hsl") {
      a = wasHSL = v.match(_strictNumExp);
      if (!toHSL) {
        h = +a[0] % 360 / 360;
        s = +a[1] / 100;
        l = +a[2] / 100;
        g = l <= 0.5 ? l * (s + 1) : l + s - l * s;
        r = l * 2 - g;
        a.length > 3 && (a[3] *= 1);
        a[0] = _hue(h + 1 / 3, r, g);
        a[1] = _hue(h, r, g);
        a[2] = _hue(h - 1 / 3, r, g);
      } else if (~v.indexOf("=")) {
        a = v.match(_numExp);
        forceAlpha && a.length < 4 && (a[3] = 1);
        return a;
      }
    } else {
      a = v.match(_strictNumExp) || _colorLookup.transparent;
    }
    a = a.map(Number);
  }
  if (toHSL && !wasHSL) {
    r = a[0] / _255;
    g = a[1] / _255;
    b = a[2] / _255;
    max = Math.max(r, g, b);
    min = Math.min(r, g, b);
    l = (max + min) / 2;
    if (max === min) {
      h = s = 0;
    } else {
      d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      h = max === r ? (g - b) / d + (g < b ? 6 : 0) : max === g ? (b - r) / d + 2 : (r - g) / d + 4;
      h *= 60;
    }
    a[0] = ~~(h + 0.5);
    a[1] = ~~(s * 100 + 0.5);
    a[2] = ~~(l * 100 + 0.5);
  }
  forceAlpha && a.length < 4 && (a[3] = 1);
  return a;
}, _colorOrderData = function _colorOrderData2(v) {
  var values = [], c = [], i = -1;
  v.split(_colorExp).forEach(function(v2) {
    var a = v2.match(_numWithUnitExp) || [];
    values.push.apply(values, a);
    c.push(i += a.length + 1);
  });
  values.c = c;
  return values;
}, _formatColors = function _formatColors2(s, toHSL, orderMatchData) {
  var result = "", colors = (s + result).match(_colorExp), type = toHSL ? "hsla(" : "rgba(", i = 0, c, shell, d, l;
  if (!colors) {
    return s;
  }
  colors = colors.map(function(color) {
    return (color = splitColor(color, toHSL, 1)) && type + (toHSL ? color[0] + "," + color[1] + "%," + color[2] + "%," + color[3] : color.join(",")) + ")";
  });
  if (orderMatchData) {
    d = _colorOrderData(s);
    c = orderMatchData.c;
    if (c.join(result) !== d.c.join(result)) {
      shell = s.replace(_colorExp, "1").split(_numWithUnitExp);
      l = shell.length - 1;
      for (; i < l; i++) {
        result += shell[i] + (~c.indexOf(i) ? colors.shift() || type + "0,0,0,0)" : (d.length ? d : colors.length ? colors : orderMatchData).shift());
      }
    }
  }
  if (!shell) {
    shell = s.split(_colorExp);
    l = shell.length - 1;
    for (; i < l; i++) {
      result += shell[i] + colors[i];
    }
  }
  return result + shell[l];
}, _colorExp = function() {
  var s = "(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b", p;
  for (p in _colorLookup) {
    s += "|" + p + "\\b";
  }
  return new RegExp(s + ")", "gi");
}(), _hslExp = /hsl[a]?\(/, _colorStringFilter = function _colorStringFilter2(a) {
  var combined = a.join(" "), toHSL;
  _colorExp.lastIndex = 0;
  if (_colorExp.test(combined)) {
    toHSL = _hslExp.test(combined);
    a[1] = _formatColors(a[1], toHSL);
    a[0] = _formatColors(a[0], toHSL, _colorOrderData(a[1]));
    return true;
  }
}, _tickerActive, _ticker = function() {
  var _getTime = Date.now, _lagThreshold = 500, _adjustedLag = 33, _startTime = _getTime(), _lastUpdate = _startTime, _gap = 1e3 / 240, _nextTime = _gap, _listeners2 = [], _id, _req, _raf, _self, _delta, _i, _tick = function _tick2(v) {
    var elapsed = _getTime() - _lastUpdate, manual = v === true, overlap, dispatch, time, frame;
    (elapsed > _lagThreshold || elapsed < 0) && (_startTime += elapsed - _adjustedLag);
    _lastUpdate += elapsed;
    time = _lastUpdate - _startTime;
    overlap = time - _nextTime;
    if (overlap > 0 || manual) {
      frame = ++_self.frame;
      _delta = time - _self.time * 1e3;
      _self.time = time = time / 1e3;
      _nextTime += overlap + (overlap >= _gap ? 4 : _gap - overlap);
      dispatch = 1;
    }
    manual || (_id = _req(_tick2));
    if (dispatch) {
      for (_i = 0; _i < _listeners2.length; _i++) {
        _listeners2[_i](time, _delta, frame, v);
      }
    }
  };
  _self = {
    time: 0,
    frame: 0,
    tick: function tick() {
      _tick(true);
    },
    deltaRatio: function deltaRatio(fps) {
      return _delta / (1e3 / (fps || 60));
    },
    wake: function wake() {
      if (_coreReady) {
        if (!_coreInitted$2 && _windowExists$2()) {
          _win$3 = _coreInitted$2 = window;
          _doc$3 = _win$3.document || {};
          _globals.gsap = gsap$2;
          (_win$3.gsapVersions || (_win$3.gsapVersions = [])).push(gsap$2.version);
          _install(_installScope || _win$3.GreenSockGlobals || !_win$3.gsap && _win$3 || {});
          _registerPluginQueue.forEach(_createPlugin);
        }
        _raf = typeof requestAnimationFrame !== "undefined" && requestAnimationFrame;
        _id && _self.sleep();
        _req = _raf || function(f) {
          return setTimeout(f, _nextTime - _self.time * 1e3 + 1 | 0);
        };
        _tickerActive = 1;
        _tick(2);
      }
    },
    sleep: function sleep() {
      (_raf ? cancelAnimationFrame : clearTimeout)(_id);
      _tickerActive = 0;
      _req = _emptyFunc;
    },
    lagSmoothing: function lagSmoothing(threshold, adjustedLag) {
      _lagThreshold = threshold || Infinity;
      _adjustedLag = Math.min(adjustedLag || 33, _lagThreshold);
    },
    fps: function fps(_fps) {
      _gap = 1e3 / (_fps || 240);
      _nextTime = _self.time * 1e3 + _gap;
    },
    add: function add(callback, once, prioritize) {
      var func = once ? function(t, d, f, v) {
        callback(t, d, f, v);
        _self.remove(func);
      } : callback;
      _self.remove(callback);
      _listeners2[prioritize ? "unshift" : "push"](func);
      _wake();
      return func;
    },
    remove: function remove(callback, i) {
      ~(i = _listeners2.indexOf(callback)) && _listeners2.splice(i, 1) && _i >= i && _i--;
    },
    _listeners: _listeners2
  };
  return _self;
}(), _wake = function _wake2() {
  return !_tickerActive && _ticker.wake();
}, _easeMap = {}, _customEaseExp = /^[\d.\-M][\d.\-,\s]/, _quotesExp = /["']/g, _parseObjectInString = function _parseObjectInString2(value) {
  var obj = {}, split = value.substr(1, value.length - 3).split(":"), key = split[0], i = 1, l = split.length, index, val, parsedVal;
  for (; i < l; i++) {
    val = split[i];
    index = i !== l - 1 ? val.lastIndexOf(",") : val.length;
    parsedVal = val.substr(0, index);
    obj[key] = isNaN(parsedVal) ? parsedVal.replace(_quotesExp, "").trim() : +parsedVal;
    key = val.substr(index + 1).trim();
  }
  return obj;
}, _valueInParentheses = function _valueInParentheses2(value) {
  var open = value.indexOf("(") + 1, close = value.indexOf(")"), nested = value.indexOf("(", open);
  return value.substring(open, ~nested && nested < close ? value.indexOf(")", close + 1) : close);
}, _configEaseFromString = function _configEaseFromString2(name) {
  var split = (name + "").split("("), ease = _easeMap[split[0]];
  return ease && split.length > 1 && ease.config ? ease.config.apply(null, ~name.indexOf("{") ? [_parseObjectInString(split[1])] : _valueInParentheses(name).split(",").map(_numericIfPossible)) : _easeMap._CE && _customEaseExp.test(name) ? _easeMap._CE("", name) : ease;
}, _invertEase = function _invertEase2(ease) {
  return function(p) {
    return 1 - ease(1 - p);
  };
}, _propagateYoyoEase = function _propagateYoyoEase2(timeline2, isYoyo) {
  var child = timeline2._first, ease;
  while (child) {
    if (child instanceof Timeline) {
      _propagateYoyoEase2(child, isYoyo);
    } else if (child.vars.yoyoEase && (!child._yoyo || !child._repeat) && child._yoyo !== isYoyo) {
      if (child.timeline) {
        _propagateYoyoEase2(child.timeline, isYoyo);
      } else {
        ease = child._ease;
        child._ease = child._yEase;
        child._yEase = ease;
        child._yoyo = isYoyo;
      }
    }
    child = child._next;
  }
}, _parseEase = function _parseEase2(ease, defaultEase) {
  return !ease ? defaultEase : (_isFunction$1(ease) ? ease : _easeMap[ease] || _configEaseFromString(ease)) || defaultEase;
}, _insertEase = function _insertEase2(names, easeIn, easeOut, easeInOut) {
  if (easeOut === void 0) {
    easeOut = function easeOut2(p) {
      return 1 - easeIn(1 - p);
    };
  }
  if (easeInOut === void 0) {
    easeInOut = function easeInOut2(p) {
      return p < 0.5 ? easeIn(p * 2) / 2 : 1 - easeIn((1 - p) * 2) / 2;
    };
  }
  var ease = {
    easeIn,
    easeOut,
    easeInOut
  }, lowercaseName;
  _forEachName(names, function(name) {
    _easeMap[name] = _globals[name] = ease;
    _easeMap[lowercaseName = name.toLowerCase()] = easeOut;
    for (var p in ease) {
      _easeMap[lowercaseName + (p === "easeIn" ? ".in" : p === "easeOut" ? ".out" : ".inOut")] = _easeMap[name + "." + p] = ease[p];
    }
  });
  return ease;
}, _easeInOutFromOut = function _easeInOutFromOut2(easeOut) {
  return function(p) {
    return p < 0.5 ? (1 - easeOut(1 - p * 2)) / 2 : 0.5 + easeOut((p - 0.5) * 2) / 2;
  };
}, _configElastic = function _configElastic2(type, amplitude, period) {
  var p1 = amplitude >= 1 ? amplitude : 1, p2 = (period || (type ? 0.3 : 0.45)) / (amplitude < 1 ? amplitude : 1), p3 = p2 / _2PI * (Math.asin(1 / p1) || 0), easeOut = function easeOut2(p) {
    return p === 1 ? 1 : p1 * Math.pow(2, -10 * p) * _sin((p - p3) * p2) + 1;
  }, ease = type === "out" ? easeOut : type === "in" ? function(p) {
    return 1 - easeOut(1 - p);
  } : _easeInOutFromOut(easeOut);
  p2 = _2PI / p2;
  ease.config = function(amplitude2, period2) {
    return _configElastic2(type, amplitude2, period2);
  };
  return ease;
}, _configBack = function _configBack2(type, overshoot) {
  if (overshoot === void 0) {
    overshoot = 1.70158;
  }
  var easeOut = function easeOut2(p) {
    return p ? --p * p * ((overshoot + 1) * p + overshoot) + 1 : 0;
  }, ease = type === "out" ? easeOut : type === "in" ? function(p) {
    return 1 - easeOut(1 - p);
  } : _easeInOutFromOut(easeOut);
  ease.config = function(overshoot2) {
    return _configBack2(type, overshoot2);
  };
  return ease;
};
_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong", function(name, i) {
  var power = i < 5 ? i + 1 : i;
  _insertEase(name + ",Power" + (power - 1), i ? function(p) {
    return Math.pow(p, power);
  } : function(p) {
    return p;
  }, function(p) {
    return 1 - Math.pow(1 - p, power);
  }, function(p) {
    return p < 0.5 ? Math.pow(p * 2, power) / 2 : 1 - Math.pow((1 - p) * 2, power) / 2;
  });
});
_easeMap.Linear.easeNone = _easeMap.none = _easeMap.Linear.easeIn;
_insertEase("Elastic", _configElastic("in"), _configElastic("out"), _configElastic());
(function(n, c) {
  var n1 = 1 / c, n2 = 2 * n1, n3 = 2.5 * n1, easeOut = function easeOut2(p) {
    return p < n1 ? n * p * p : p < n2 ? n * Math.pow(p - 1.5 / c, 2) + 0.75 : p < n3 ? n * (p -= 2.25 / c) * p + 0.9375 : n * Math.pow(p - 2.625 / c, 2) + 0.984375;
  };
  _insertEase("Bounce", function(p) {
    return 1 - easeOut(1 - p);
  }, easeOut);
})(7.5625, 2.75);
_insertEase("Expo", function(p) {
  return Math.pow(2, 10 * (p - 1)) * p + p * p * p * p * p * p * (1 - p);
});
_insertEase("Circ", function(p) {
  return -(_sqrt(1 - p * p) - 1);
});
_insertEase("Sine", function(p) {
  return p === 1 ? 1 : -_cos(p * _HALF_PI) + 1;
});
_insertEase("Back", _configBack("in"), _configBack("out"), _configBack());
_easeMap.SteppedEase = _easeMap.steps = _globals.SteppedEase = {
  config: function config(steps, immediateStart) {
    if (steps === void 0) {
      steps = 1;
    }
    var p1 = 1 / steps, p2 = steps + (immediateStart ? 0 : 1), p3 = immediateStart ? 1 : 0, max = 1 - _tinyNum;
    return function(p) {
      return ((p2 * _clamp$1(0, max, p) | 0) + p3) * p1;
    };
  }
};
_defaults$1.ease = _easeMap["quad.out"];
_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt", function(name) {
  return _callbackNames += name + "," + name + "Params,";
});
var GSCache = function GSCache2(target, harness) {
  this.id = _gsID++;
  target._gsap = this;
  this.target = target;
  this.harness = harness;
  this.get = harness ? harness.get : _getProperty;
  this.set = harness ? harness.getSetter : _getSetter;
};
var Animation = /* @__PURE__ */ function() {
  function Animation2(vars) {
    this.vars = vars;
    this._delay = +vars.delay || 0;
    if (this._repeat = vars.repeat === Infinity ? -2 : vars.repeat || 0) {
      this._rDelay = vars.repeatDelay || 0;
      this._yoyo = !!vars.yoyo || !!vars.yoyoEase;
    }
    this._ts = 1;
    _setDuration(this, +vars.duration, 1, 1);
    this.data = vars.data;
    if (_context$2) {
      this._ctx = _context$2;
      _context$2.data.push(this);
    }
    _tickerActive || _ticker.wake();
  }
  var _proto = Animation2.prototype;
  _proto.delay = function delay(value) {
    if (value || value === 0) {
      this.parent && this.parent.smoothChildTiming && this.startTime(this._start + value - this._delay);
      this._delay = value;
      return this;
    }
    return this._delay;
  };
  _proto.duration = function duration(value) {
    return arguments.length ? this.totalDuration(this._repeat > 0 ? value + (value + this._rDelay) * this._repeat : value) : this.totalDuration() && this._dur;
  };
  _proto.totalDuration = function totalDuration(value) {
    if (!arguments.length) {
      return this._tDur;
    }
    this._dirty = 0;
    return _setDuration(this, this._repeat < 0 ? value : (value - this._repeat * this._rDelay) / (this._repeat + 1));
  };
  _proto.totalTime = function totalTime(_totalTime, suppressEvents) {
    _wake();
    if (!arguments.length) {
      return this._tTime;
    }
    var parent = this._dp;
    if (parent && parent.smoothChildTiming && this._ts) {
      _alignPlayhead(this, _totalTime);
      !parent._dp || parent.parent || _postAddChecks(parent, this);
      while (parent && parent.parent) {
        if (parent.parent._time !== parent._start + (parent._ts >= 0 ? parent._tTime / parent._ts : (parent.totalDuration() - parent._tTime) / -parent._ts)) {
          parent.totalTime(parent._tTime, true);
        }
        parent = parent.parent;
      }
      if (!this.parent && this._dp.autoRemoveChildren && (this._ts > 0 && _totalTime < this._tDur || this._ts < 0 && _totalTime > 0 || !this._tDur && !_totalTime)) {
        _addToTimeline(this._dp, this, this._start - this._delay);
      }
    }
    if (this._tTime !== _totalTime || !this._dur && !suppressEvents || this._initted && Math.abs(this._zTime) === _tinyNum || !_totalTime && !this._initted && (this.add || this._ptLookup)) {
      this._ts || (this._pTime = _totalTime);
      _lazySafeRender(this, _totalTime, suppressEvents);
    }
    return this;
  };
  _proto.time = function time(value, suppressEvents) {
    return arguments.length ? this.totalTime(Math.min(this.totalDuration(), value + _elapsedCycleDuration(this)) % (this._dur + this._rDelay) || (value ? this._dur : 0), suppressEvents) : this._time;
  };
  _proto.totalProgress = function totalProgress(value, suppressEvents) {
    return arguments.length ? this.totalTime(this.totalDuration() * value, suppressEvents) : this.totalDuration() ? Math.min(1, this._tTime / this._tDur) : this.rawTime() >= 0 && this._initted ? 1 : 0;
  };
  _proto.progress = function progress(value, suppressEvents) {
    return arguments.length ? this.totalTime(this.duration() * (this._yoyo && !(this.iteration() & 1) ? 1 - value : value) + _elapsedCycleDuration(this), suppressEvents) : this.duration() ? Math.min(1, this._time / this._dur) : this.rawTime() > 0 ? 1 : 0;
  };
  _proto.iteration = function iteration(value, suppressEvents) {
    var cycleDuration = this.duration() + this._rDelay;
    return arguments.length ? this.totalTime(this._time + (value - 1) * cycleDuration, suppressEvents) : this._repeat ? _animationCycle(this._tTime, cycleDuration) + 1 : 1;
  };
  _proto.timeScale = function timeScale(value, suppressEvents) {
    if (!arguments.length) {
      return this._rts === -_tinyNum ? 0 : this._rts;
    }
    if (this._rts === value) {
      return this;
    }
    var tTime = this.parent && this._ts ? _parentToChildTotalTime(this.parent._time, this) : this._tTime;
    this._rts = +value || 0;
    this._ts = this._ps || value === -_tinyNum ? 0 : this._rts;
    this.totalTime(_clamp$1(-Math.abs(this._delay), this.totalDuration(), tTime), suppressEvents !== false);
    _setEnd(this);
    return _recacheAncestors(this);
  };
  _proto.paused = function paused(value) {
    if (!arguments.length) {
      return this._ps;
    }
    if (this._ps !== value) {
      this._ps = value;
      if (value) {
        this._pTime = this._tTime || Math.max(-this._delay, this.rawTime());
        this._ts = this._act = 0;
      } else {
        _wake();
        this._ts = this._rts;
        this.totalTime(this.parent && !this.parent.smoothChildTiming ? this.rawTime() : this._tTime || this._pTime, this.progress() === 1 && Math.abs(this._zTime) !== _tinyNum && (this._tTime -= _tinyNum));
      }
    }
    return this;
  };
  _proto.startTime = function startTime(value) {
    if (arguments.length) {
      this._start = value;
      var parent = this.parent || this._dp;
      parent && (parent._sort || !this.parent) && _addToTimeline(parent, this, value - this._delay);
      return this;
    }
    return this._start;
  };
  _proto.endTime = function endTime(includeRepeats) {
    return this._start + (_isNotFalse(includeRepeats) ? this.totalDuration() : this.duration()) / Math.abs(this._ts || 1);
  };
  _proto.rawTime = function rawTime(wrapRepeats) {
    var parent = this.parent || this._dp;
    return !parent ? this._tTime : wrapRepeats && (!this._ts || this._repeat && this._time && this.totalProgress() < 1) ? this._tTime % (this._dur + this._rDelay) : !this._ts ? this._tTime : _parentToChildTotalTime(parent.rawTime(wrapRepeats), this);
  };
  _proto.revert = function revert(config3) {
    if (config3 === void 0) {
      config3 = _revertConfig;
    }
    var prevIsReverting = _reverting$1;
    _reverting$1 = config3;
    if (_isRevertWorthy(this)) {
      this.timeline && this.timeline.revert(config3);
      this.totalTime(-0.01, config3.suppressEvents);
    }
    this.data !== "nested" && config3.kill !== false && this.kill();
    _reverting$1 = prevIsReverting;
    return this;
  };
  _proto.globalTime = function globalTime(rawTime) {
    var animation = this, time = arguments.length ? rawTime : animation.rawTime();
    while (animation) {
      time = animation._start + time / (Math.abs(animation._ts) || 1);
      animation = animation._dp;
    }
    return !this.parent && this._sat ? this._sat.globalTime(rawTime) : time;
  };
  _proto.repeat = function repeat(value) {
    if (arguments.length) {
      this._repeat = value === Infinity ? -2 : value;
      return _onUpdateTotalDuration(this);
    }
    return this._repeat === -2 ? Infinity : this._repeat;
  };
  _proto.repeatDelay = function repeatDelay(value) {
    if (arguments.length) {
      var time = this._time;
      this._rDelay = value;
      _onUpdateTotalDuration(this);
      return time ? this.time(time) : this;
    }
    return this._rDelay;
  };
  _proto.yoyo = function yoyo(value) {
    if (arguments.length) {
      this._yoyo = value;
      return this;
    }
    return this._yoyo;
  };
  _proto.seek = function seek(position, suppressEvents) {
    return this.totalTime(_parsePosition$1(this, position), _isNotFalse(suppressEvents));
  };
  _proto.restart = function restart(includeDelay, suppressEvents) {
    this.play().totalTime(includeDelay ? -this._delay : 0, _isNotFalse(suppressEvents));
    this._dur || (this._zTime = -_tinyNum);
    return this;
  };
  _proto.play = function play(from, suppressEvents) {
    from != null && this.seek(from, suppressEvents);
    return this.reversed(false).paused(false);
  };
  _proto.reverse = function reverse(from, suppressEvents) {
    from != null && this.seek(from || this.totalDuration(), suppressEvents);
    return this.reversed(true).paused(false);
  };
  _proto.pause = function pause(atTime, suppressEvents) {
    atTime != null && this.seek(atTime, suppressEvents);
    return this.paused(true);
  };
  _proto.resume = function resume() {
    return this.paused(false);
  };
  _proto.reversed = function reversed(value) {
    if (arguments.length) {
      !!value !== this.reversed() && this.timeScale(-this._rts || (value ? -_tinyNum : 0));
      return this;
    }
    return this._rts < 0;
  };
  _proto.invalidate = function invalidate() {
    this._initted = this._act = 0;
    this._zTime = -_tinyNum;
    return this;
  };
  _proto.isActive = function isActive() {
    var parent = this.parent || this._dp, start = this._start, rawTime;
    return !!(!parent || this._ts && this._initted && parent.isActive() && (rawTime = parent.rawTime(true)) >= start && rawTime < this.endTime(true) - _tinyNum);
  };
  _proto.eventCallback = function eventCallback(type, callback, params) {
    var vars = this.vars;
    if (arguments.length > 1) {
      if (!callback) {
        delete vars[type];
      } else {
        vars[type] = callback;
        params && (vars[type + "Params"] = params);
        type === "onUpdate" && (this._onUpdate = callback);
      }
      return this;
    }
    return vars[type];
  };
  _proto.then = function then(onFulfilled) {
    var self = this;
    return new Promise(function(resolve) {
      var f = _isFunction$1(onFulfilled) ? onFulfilled : _passThrough$1, _resolve = function _resolve2() {
        var _then = self.then;
        self.then = null;
        _isFunction$1(f) && (f = f(self)) && (f.then || f === self) && (self.then = _then);
        resolve(f);
        self.then = _then;
      };
      if (self._initted && self.totalProgress() === 1 && self._ts >= 0 || !self._tTime && self._ts < 0) {
        _resolve();
      } else {
        self._prom = _resolve;
      }
    });
  };
  _proto.kill = function kill() {
    _interrupt(this);
  };
  return Animation2;
}();
_setDefaults$1(Animation.prototype, {
  _time: 0,
  _start: 0,
  _end: 0,
  _tTime: 0,
  _tDur: 0,
  _dirty: 0,
  _repeat: 0,
  _yoyo: false,
  parent: null,
  _initted: false,
  _rDelay: 0,
  _ts: 1,
  _dp: 0,
  ratio: 0,
  _zTime: -_tinyNum,
  _prom: 0,
  _ps: false,
  _rts: 1
});
var Timeline = /* @__PURE__ */ function(_Animation) {
  _inheritsLoose(Timeline2, _Animation);
  function Timeline2(vars, position) {
    var _this;
    if (vars === void 0) {
      vars = {};
    }
    _this = _Animation.call(this, vars) || this;
    _this.labels = {};
    _this.smoothChildTiming = !!vars.smoothChildTiming;
    _this.autoRemoveChildren = !!vars.autoRemoveChildren;
    _this._sort = _isNotFalse(vars.sortChildren);
    _globalTimeline && _addToTimeline(vars.parent || _globalTimeline, _assertThisInitialized(_this), position);
    vars.reversed && _this.reverse();
    vars.paused && _this.paused(true);
    vars.scrollTrigger && _scrollTrigger(_assertThisInitialized(_this), vars.scrollTrigger);
    return _this;
  }
  var _proto2 = Timeline2.prototype;
  _proto2.to = function to(targets, vars, position) {
    _createTweenType(0, arguments, this);
    return this;
  };
  _proto2.from = function from(targets, vars, position) {
    _createTweenType(1, arguments, this);
    return this;
  };
  _proto2.fromTo = function fromTo(targets, fromVars, toVars, position) {
    _createTweenType(2, arguments, this);
    return this;
  };
  _proto2.set = function set(targets, vars, position) {
    vars.duration = 0;
    vars.parent = this;
    _inheritDefaults(vars).repeatDelay || (vars.repeat = 0);
    vars.immediateRender = !!vars.immediateRender;
    new Tween(targets, vars, _parsePosition$1(this, position), 1);
    return this;
  };
  _proto2.call = function call(callback, params, position) {
    return _addToTimeline(this, Tween.delayedCall(0, callback, params), position);
  };
  _proto2.staggerTo = function staggerTo(targets, duration, vars, stagger, position, onCompleteAll, onCompleteAllParams) {
    vars.duration = duration;
    vars.stagger = vars.stagger || stagger;
    vars.onComplete = onCompleteAll;
    vars.onCompleteParams = onCompleteAllParams;
    vars.parent = this;
    new Tween(targets, vars, _parsePosition$1(this, position));
    return this;
  };
  _proto2.staggerFrom = function staggerFrom(targets, duration, vars, stagger, position, onCompleteAll, onCompleteAllParams) {
    vars.runBackwards = 1;
    _inheritDefaults(vars).immediateRender = _isNotFalse(vars.immediateRender);
    return this.staggerTo(targets, duration, vars, stagger, position, onCompleteAll, onCompleteAllParams);
  };
  _proto2.staggerFromTo = function staggerFromTo(targets, duration, fromVars, toVars, stagger, position, onCompleteAll, onCompleteAllParams) {
    toVars.startAt = fromVars;
    _inheritDefaults(toVars).immediateRender = _isNotFalse(toVars.immediateRender);
    return this.staggerTo(targets, duration, toVars, stagger, position, onCompleteAll, onCompleteAllParams);
  };
  _proto2.render = function render2(totalTime, suppressEvents, force) {
    var prevTime = this._time, tDur = this._dirty ? this.totalDuration() : this._tDur, dur = this._dur, tTime = totalTime <= 0 ? 0 : _roundPrecise(totalTime), crossingStart = this._zTime < 0 !== totalTime < 0 && (this._initted || !dur), time, child, next, iteration, cycleDuration, prevPaused, pauseTween, timeScale, prevStart, prevIteration, yoyo, isYoyo;
    this !== _globalTimeline && tTime > tDur && totalTime >= 0 && (tTime = tDur);
    if (tTime !== this._tTime || force || crossingStart) {
      if (prevTime !== this._time && dur) {
        tTime += this._time - prevTime;
        totalTime += this._time - prevTime;
      }
      time = tTime;
      prevStart = this._start;
      timeScale = this._ts;
      prevPaused = !timeScale;
      if (crossingStart) {
        dur || (prevTime = this._zTime);
        (totalTime || !suppressEvents) && (this._zTime = totalTime);
      }
      if (this._repeat) {
        yoyo = this._yoyo;
        cycleDuration = dur + this._rDelay;
        if (this._repeat < -1 && totalTime < 0) {
          return this.totalTime(cycleDuration * 100 + totalTime, suppressEvents, force);
        }
        time = _roundPrecise(tTime % cycleDuration);
        if (tTime === tDur) {
          iteration = this._repeat;
          time = dur;
        } else {
          prevIteration = _roundPrecise(tTime / cycleDuration);
          iteration = ~~prevIteration;
          if (iteration && iteration === prevIteration) {
            time = dur;
            iteration--;
          }
          time > dur && (time = dur);
        }
        prevIteration = _animationCycle(this._tTime, cycleDuration);
        !prevTime && this._tTime && prevIteration !== iteration && this._tTime - prevIteration * cycleDuration - this._dur <= 0 && (prevIteration = iteration);
        if (yoyo && iteration & 1) {
          time = dur - time;
          isYoyo = 1;
        }
        if (iteration !== prevIteration && !this._lock) {
          var rewinding = yoyo && prevIteration & 1, doesWrap = rewinding === (yoyo && iteration & 1);
          iteration < prevIteration && (rewinding = !rewinding);
          prevTime = rewinding ? 0 : tTime % dur ? dur : tTime;
          this._lock = 1;
          this.render(prevTime || (isYoyo ? 0 : _roundPrecise(iteration * cycleDuration)), suppressEvents, !dur)._lock = 0;
          this._tTime = tTime;
          !suppressEvents && this.parent && _callback$1(this, "onRepeat");
          this.vars.repeatRefresh && !isYoyo && (this.invalidate()._lock = 1);
          if (prevTime && prevTime !== this._time || prevPaused !== !this._ts || this.vars.onRepeat && !this.parent && !this._act) {
            return this;
          }
          dur = this._dur;
          tDur = this._tDur;
          if (doesWrap) {
            this._lock = 2;
            prevTime = rewinding ? dur : -1e-4;
            this.render(prevTime, true);
            this.vars.repeatRefresh && !isYoyo && this.invalidate();
          }
          this._lock = 0;
          if (!this._ts && !prevPaused) {
            return this;
          }
          _propagateYoyoEase(this, isYoyo);
        }
      }
      if (this._hasPause && !this._forcing && this._lock < 2) {
        pauseTween = _findNextPauseTween(this, _roundPrecise(prevTime), _roundPrecise(time));
        if (pauseTween) {
          tTime -= time - (time = pauseTween._start);
        }
      }
      this._tTime = tTime;
      this._time = time;
      this._act = !timeScale;
      if (!this._initted) {
        this._onUpdate = this.vars.onUpdate;
        this._initted = 1;
        this._zTime = totalTime;
        prevTime = 0;
      }
      if (!prevTime && tTime && !suppressEvents && !prevIteration) {
        _callback$1(this, "onStart");
        if (this._tTime !== tTime) {
          return this;
        }
      }
      if (time >= prevTime && totalTime >= 0) {
        child = this._first;
        while (child) {
          next = child._next;
          if ((child._act || time >= child._start) && child._ts && pauseTween !== child) {
            if (child.parent !== this) {
              return this.render(totalTime, suppressEvents, force);
            }
            child.render(child._ts > 0 ? (time - child._start) * child._ts : (child._dirty ? child.totalDuration() : child._tDur) + (time - child._start) * child._ts, suppressEvents, force);
            if (time !== this._time || !this._ts && !prevPaused) {
              pauseTween = 0;
              next && (tTime += this._zTime = -_tinyNum);
              break;
            }
          }
          child = next;
        }
      } else {
        child = this._last;
        var adjustedTime = totalTime < 0 ? totalTime : time;
        while (child) {
          next = child._prev;
          if ((child._act || adjustedTime <= child._end) && child._ts && pauseTween !== child) {
            if (child.parent !== this) {
              return this.render(totalTime, suppressEvents, force);
            }
            child.render(child._ts > 0 ? (adjustedTime - child._start) * child._ts : (child._dirty ? child.totalDuration() : child._tDur) + (adjustedTime - child._start) * child._ts, suppressEvents, force || _reverting$1 && _isRevertWorthy(child));
            if (time !== this._time || !this._ts && !prevPaused) {
              pauseTween = 0;
              next && (tTime += this._zTime = adjustedTime ? -_tinyNum : _tinyNum);
              break;
            }
          }
          child = next;
        }
      }
      if (pauseTween && !suppressEvents) {
        this.pause();
        pauseTween.render(time >= prevTime ? 0 : -_tinyNum)._zTime = time >= prevTime ? 1 : -1;
        if (this._ts) {
          this._start = prevStart;
          _setEnd(this);
          return this.render(totalTime, suppressEvents, force);
        }
      }
      this._onUpdate && !suppressEvents && _callback$1(this, "onUpdate", true);
      if (tTime === tDur && this._tTime >= this.totalDuration() || !tTime && prevTime) {
        if (prevStart === this._start || Math.abs(timeScale) !== Math.abs(this._ts)) {
          if (!this._lock) {
            (totalTime || !dur) && (tTime === tDur && this._ts > 0 || !tTime && this._ts < 0) && _removeFromParent(this, 1);
            if (!suppressEvents && !(totalTime < 0 && !prevTime) && (tTime || prevTime || !tDur)) {
              _callback$1(this, tTime === tDur && totalTime >= 0 ? "onComplete" : "onReverseComplete", true);
              this._prom && !(tTime < tDur && this.timeScale() > 0) && this._prom();
            }
          }
        }
      }
    }
    return this;
  };
  _proto2.add = function add(child, position) {
    var _this2 = this;
    _isNumber$1(position) || (position = _parsePosition$1(this, position, child));
    if (!(child instanceof Animation)) {
      if (_isArray(child)) {
        child.forEach(function(obj) {
          return _this2.add(obj, position);
        });
        return this;
      }
      if (_isString$1(child)) {
        return this.addLabel(child, position);
      }
      if (_isFunction$1(child)) {
        child = Tween.delayedCall(0, child);
      } else {
        return this;
      }
    }
    return this !== child ? _addToTimeline(this, child, position) : this;
  };
  _proto2.getChildren = function getChildren(nested, tweens, timelines, ignoreBeforeTime) {
    if (nested === void 0) {
      nested = true;
    }
    if (tweens === void 0) {
      tweens = true;
    }
    if (timelines === void 0) {
      timelines = true;
    }
    if (ignoreBeforeTime === void 0) {
      ignoreBeforeTime = -_bigNum$1;
    }
    var a = [], child = this._first;
    while (child) {
      if (child._start >= ignoreBeforeTime) {
        if (child instanceof Tween) {
          tweens && a.push(child);
        } else {
          timelines && a.push(child);
          nested && a.push.apply(a, child.getChildren(true, tweens, timelines));
        }
      }
      child = child._next;
    }
    return a;
  };
  _proto2.getById = function getById2(id) {
    var animations = this.getChildren(1, 1, 1), i = animations.length;
    while (i--) {
      if (animations[i].vars.id === id) {
        return animations[i];
      }
    }
  };
  _proto2.remove = function remove(child) {
    if (_isString$1(child)) {
      return this.removeLabel(child);
    }
    if (_isFunction$1(child)) {
      return this.killTweensOf(child);
    }
    child.parent === this && _removeLinkedListItem(this, child);
    if (child === this._recent) {
      this._recent = this._last;
    }
    return _uncache(this);
  };
  _proto2.totalTime = function totalTime(_totalTime2, suppressEvents) {
    if (!arguments.length) {
      return this._tTime;
    }
    this._forcing = 1;
    if (!this._dp && this._ts) {
      this._start = _roundPrecise(_ticker.time - (this._ts > 0 ? _totalTime2 / this._ts : (this.totalDuration() - _totalTime2) / -this._ts));
    }
    _Animation.prototype.totalTime.call(this, _totalTime2, suppressEvents);
    this._forcing = 0;
    return this;
  };
  _proto2.addLabel = function addLabel(label, position) {
    this.labels[label] = _parsePosition$1(this, position);
    return this;
  };
  _proto2.removeLabel = function removeLabel(label) {
    delete this.labels[label];
    return this;
  };
  _proto2.addPause = function addPause(position, callback, params) {
    var t = Tween.delayedCall(0, callback || _emptyFunc, params);
    t.data = "isPause";
    this._hasPause = 1;
    return _addToTimeline(this, t, _parsePosition$1(this, position));
  };
  _proto2.removePause = function removePause(position) {
    var child = this._first;
    position = _parsePosition$1(this, position);
    while (child) {
      if (child._start === position && child.data === "isPause") {
        _removeFromParent(child);
      }
      child = child._next;
    }
  };
  _proto2.killTweensOf = function killTweensOf(targets, props, onlyActive) {
    var tweens = this.getTweensOf(targets, onlyActive), i = tweens.length;
    while (i--) {
      _overwritingTween !== tweens[i] && tweens[i].kill(targets, props);
    }
    return this;
  };
  _proto2.getTweensOf = function getTweensOf2(targets, onlyActive) {
    var a = [], parsedTargets = toArray(targets), child = this._first, isGlobalTime = _isNumber$1(onlyActive), children;
    while (child) {
      if (child instanceof Tween) {
        if (_arrayContainsAny(child._targets, parsedTargets) && (isGlobalTime ? (!_overwritingTween || child._initted && child._ts) && child.globalTime(0) <= onlyActive && child.globalTime(child.totalDuration()) > onlyActive : !onlyActive || child.isActive())) {
          a.push(child);
        }
      } else if ((children = child.getTweensOf(parsedTargets, onlyActive)).length) {
        a.push.apply(a, children);
      }
      child = child._next;
    }
    return a;
  };
  _proto2.tweenTo = function tweenTo(position, vars) {
    vars = vars || {};
    var tl = this, endTime = _parsePosition$1(tl, position), _vars = vars, startAt = _vars.startAt, _onStart = _vars.onStart, onStartParams = _vars.onStartParams, immediateRender = _vars.immediateRender, initted, tween = Tween.to(tl, _setDefaults$1({
      ease: vars.ease || "none",
      lazy: false,
      immediateRender: false,
      time: endTime,
      overwrite: "auto",
      duration: vars.duration || Math.abs((endTime - (startAt && "time" in startAt ? startAt.time : tl._time)) / tl.timeScale()) || _tinyNum,
      onStart: function onStart() {
        tl.pause();
        if (!initted) {
          var duration = vars.duration || Math.abs((endTime - (startAt && "time" in startAt ? startAt.time : tl._time)) / tl.timeScale());
          tween._dur !== duration && _setDuration(tween, duration, 0, 1).render(tween._time, true, true);
          initted = 1;
        }
        _onStart && _onStart.apply(tween, onStartParams || []);
      }
    }, vars));
    return immediateRender ? tween.render(0) : tween;
  };
  _proto2.tweenFromTo = function tweenFromTo(fromPosition, toPosition, vars) {
    return this.tweenTo(toPosition, _setDefaults$1({
      startAt: {
        time: _parsePosition$1(this, fromPosition)
      }
    }, vars));
  };
  _proto2.recent = function recent() {
    return this._recent;
  };
  _proto2.nextLabel = function nextLabel(afterTime) {
    if (afterTime === void 0) {
      afterTime = this._time;
    }
    return _getLabelInDirection(this, _parsePosition$1(this, afterTime));
  };
  _proto2.previousLabel = function previousLabel(beforeTime) {
    if (beforeTime === void 0) {
      beforeTime = this._time;
    }
    return _getLabelInDirection(this, _parsePosition$1(this, beforeTime), 1);
  };
  _proto2.currentLabel = function currentLabel(value) {
    return arguments.length ? this.seek(value, true) : this.previousLabel(this._time + _tinyNum);
  };
  _proto2.shiftChildren = function shiftChildren(amount, adjustLabels, ignoreBeforeTime) {
    if (ignoreBeforeTime === void 0) {
      ignoreBeforeTime = 0;
    }
    var child = this._first, labels = this.labels, p;
    while (child) {
      if (child._start >= ignoreBeforeTime) {
        child._start += amount;
        child._end += amount;
      }
      child = child._next;
    }
    if (adjustLabels) {
      for (p in labels) {
        if (labels[p] >= ignoreBeforeTime) {
          labels[p] += amount;
        }
      }
    }
    return _uncache(this);
  };
  _proto2.invalidate = function invalidate(soft) {
    var child = this._first;
    this._lock = 0;
    while (child) {
      child.invalidate(soft);
      child = child._next;
    }
    return _Animation.prototype.invalidate.call(this, soft);
  };
  _proto2.clear = function clear(includeLabels) {
    if (includeLabels === void 0) {
      includeLabels = true;
    }
    var child = this._first, next;
    while (child) {
      next = child._next;
      this.remove(child);
      child = next;
    }
    this._dp && (this._time = this._tTime = this._pTime = 0);
    includeLabels && (this.labels = {});
    return _uncache(this);
  };
  _proto2.totalDuration = function totalDuration(value) {
    var max = 0, self = this, child = self._last, prevStart = _bigNum$1, prev, start, parent;
    if (arguments.length) {
      return self.timeScale((self._repeat < 0 ? self.duration() : self.totalDuration()) / (self.reversed() ? -value : value));
    }
    if (self._dirty) {
      parent = self.parent;
      while (child) {
        prev = child._prev;
        child._dirty && child.totalDuration();
        start = child._start;
        if (start > prevStart && self._sort && child._ts && !self._lock) {
          self._lock = 1;
          _addToTimeline(self, child, start - child._delay, 1)._lock = 0;
        } else {
          prevStart = start;
        }
        if (start < 0 && child._ts) {
          max -= start;
          if (!parent && !self._dp || parent && parent.smoothChildTiming) {
            self._start += start / self._ts;
            self._time -= start;
            self._tTime -= start;
          }
          self.shiftChildren(-start, false, -Infinity);
          prevStart = 0;
        }
        child._end > max && child._ts && (max = child._end);
        child = prev;
      }
      _setDuration(self, self === _globalTimeline && self._time > max ? self._time : max, 1, 1);
      self._dirty = 0;
    }
    return self._tDur;
  };
  Timeline2.updateRoot = function updateRoot(time) {
    if (_globalTimeline._ts) {
      _lazySafeRender(_globalTimeline, _parentToChildTotalTime(time, _globalTimeline));
      _lastRenderedFrame = _ticker.frame;
    }
    if (_ticker.frame >= _nextGCFrame) {
      _nextGCFrame += _config.autoSleep || 120;
      var child = _globalTimeline._first;
      if (!child || !child._ts) {
        if (_config.autoSleep && _ticker._listeners.length < 2) {
          while (child && !child._ts) {
            child = child._next;
          }
          child || _ticker.sleep();
        }
      }
    }
  };
  return Timeline2;
}(Animation);
_setDefaults$1(Timeline.prototype, {
  _lock: 0,
  _hasPause: 0,
  _forcing: 0
});
var _addComplexStringPropTween = function _addComplexStringPropTween2(target, prop, start, end, setter, stringFilter, funcParam) {
  var pt = new PropTween(this._pt, target, prop, 0, 1, _renderComplexString, null, setter), index = 0, matchIndex = 0, result, startNums, color, endNum, chunk, startNum, hasRandom, a;
  pt.b = start;
  pt.e = end;
  start += "";
  end += "";
  if (hasRandom = ~end.indexOf("random(")) {
    end = _replaceRandom(end);
  }
  if (stringFilter) {
    a = [start, end];
    stringFilter(a, target, prop);
    start = a[0];
    end = a[1];
  }
  startNums = start.match(_complexStringNumExp) || [];
  while (result = _complexStringNumExp.exec(end)) {
    endNum = result[0];
    chunk = end.substring(index, result.index);
    if (color) {
      color = (color + 1) % 5;
    } else if (chunk.substr(-5) === "rgba(") {
      color = 1;
    }
    if (endNum !== startNums[matchIndex++]) {
      startNum = parseFloat(startNums[matchIndex - 1]) || 0;
      pt._pt = {
        _next: pt._pt,
        p: chunk || matchIndex === 1 ? chunk : ",",
        //note: SVG spec allows omission of comma/space when a negative sign is wedged between two numbers, like 2.5-5.3 instead of 2.5,-5.3 but when tweening, the negative value may switch to positive, so we insert the comma just in case.
        s: startNum,
        c: endNum.charAt(1) === "=" ? _parseRelative(startNum, endNum) - startNum : parseFloat(endNum) - startNum,
        m: color && color < 4 ? Math.round : 0
      };
      index = _complexStringNumExp.lastIndex;
    }
  }
  pt.c = index < end.length ? end.substring(index, end.length) : "";
  pt.fp = funcParam;
  if (_relExp.test(end) || hasRandom) {
    pt.e = 0;
  }
  this._pt = pt;
  return pt;
}, _addPropTween = function _addPropTween2(target, prop, start, end, index, targets, modifier, stringFilter, funcParam, optional) {
  _isFunction$1(end) && (end = end(index || 0, target, targets));
  var currentValue = target[prop], parsedStart = start !== "get" ? start : !_isFunction$1(currentValue) ? currentValue : funcParam ? target[prop.indexOf("set") || !_isFunction$1(target["get" + prop.substr(3)]) ? prop : "get" + prop.substr(3)](funcParam) : target[prop](), setter = !_isFunction$1(currentValue) ? _setterPlain : funcParam ? _setterFuncWithParam : _setterFunc, pt;
  if (_isString$1(end)) {
    if (~end.indexOf("random(")) {
      end = _replaceRandom(end);
    }
    if (end.charAt(1) === "=") {
      pt = _parseRelative(parsedStart, end) + (getUnit(parsedStart) || 0);
      if (pt || pt === 0) {
        end = pt;
      }
    }
  }
  if (!optional || parsedStart !== end || _forceAllPropTweens) {
    if (!isNaN(parsedStart * end) && end !== "") {
      pt = new PropTween(this._pt, target, prop, +parsedStart || 0, end - (parsedStart || 0), typeof currentValue === "boolean" ? _renderBoolean : _renderPlain, 0, setter);
      funcParam && (pt.fp = funcParam);
      modifier && pt.modifier(modifier, this, target);
      return this._pt = pt;
    }
    !currentValue && !(prop in target) && _missingPlugin(prop, end);
    return _addComplexStringPropTween.call(this, target, prop, parsedStart, end, setter, stringFilter || _config.stringFilter, funcParam);
  }
}, _processVars = function _processVars2(vars, index, target, targets, tween) {
  _isFunction$1(vars) && (vars = _parseFuncOrString(vars, tween, index, target, targets));
  if (!_isObject$1(vars) || vars.style && vars.nodeType || _isArray(vars) || _isTypedArray(vars)) {
    return _isString$1(vars) ? _parseFuncOrString(vars, tween, index, target, targets) : vars;
  }
  var copy = {}, p;
  for (p in vars) {
    copy[p] = _parseFuncOrString(vars[p], tween, index, target, targets);
  }
  return copy;
}, _checkPlugin = function _checkPlugin2(property, vars, tween, index, target, targets) {
  var plugin, pt, ptLookup, i;
  if (_plugins[property] && (plugin = new _plugins[property]()).init(target, plugin.rawVars ? vars[property] : _processVars(vars[property], index, target, targets, tween), tween, index, targets) !== false) {
    tween._pt = pt = new PropTween(tween._pt, target, property, 0, 1, plugin.render, plugin, 0, plugin.priority);
    if (tween !== _quickTween) {
      ptLookup = tween._ptLookup[tween._targets.indexOf(target)];
      i = plugin._props.length;
      while (i--) {
        ptLookup[plugin._props[i]] = pt;
      }
    }
  }
  return plugin;
}, _overwritingTween, _forceAllPropTweens, _initTween = function _initTween2(tween, time, tTime) {
  var vars = tween.vars, ease = vars.ease, startAt = vars.startAt, immediateRender = vars.immediateRender, lazy = vars.lazy, onUpdate = vars.onUpdate, runBackwards = vars.runBackwards, yoyoEase = vars.yoyoEase, keyframes = vars.keyframes, autoRevert = vars.autoRevert, dur = tween._dur, prevStartAt = tween._startAt, targets = tween._targets, parent = tween.parent, fullTargets = parent && parent.data === "nested" ? parent.vars.targets : targets, autoOverwrite = tween._overwrite === "auto" && !_suppressOverwrites$1, tl = tween.timeline, cleanVars, i, p, pt, target, hasPriority, gsData, harness, plugin, ptLookup, index, harnessVars, overwritten;
  tl && (!keyframes || !ease) && (ease = "none");
  tween._ease = _parseEase(ease, _defaults$1.ease);
  tween._yEase = yoyoEase ? _invertEase(_parseEase(yoyoEase === true ? ease : yoyoEase, _defaults$1.ease)) : 0;
  if (yoyoEase && tween._yoyo && !tween._repeat) {
    yoyoEase = tween._yEase;
    tween._yEase = tween._ease;
    tween._ease = yoyoEase;
  }
  tween._from = !tl && !!vars.runBackwards;
  if (!tl || keyframes && !vars.stagger) {
    harness = targets[0] ? _getCache(targets[0]).harness : 0;
    harnessVars = harness && vars[harness.prop];
    cleanVars = _copyExcluding(vars, _reservedProps);
    if (prevStartAt) {
      prevStartAt._zTime < 0 && prevStartAt.progress(1);
      time < 0 && runBackwards && immediateRender && !autoRevert ? prevStartAt.render(-1, true) : prevStartAt.revert(runBackwards && dur ? _revertConfigNoKill : _startAtRevertConfig);
      prevStartAt._lazy = 0;
    }
    if (startAt) {
      _removeFromParent(tween._startAt = Tween.set(targets, _setDefaults$1({
        data: "isStart",
        overwrite: false,
        parent,
        immediateRender: true,
        lazy: !prevStartAt && _isNotFalse(lazy),
        startAt: null,
        delay: 0,
        onUpdate: onUpdate && function() {
          return _callback$1(tween, "onUpdate");
        },
        stagger: 0
      }, startAt)));
      tween._startAt._dp = 0;
      tween._startAt._sat = tween;
      time < 0 && (_reverting$1 || !immediateRender && !autoRevert) && tween._startAt.revert(_revertConfigNoKill);
      if (immediateRender) {
        if (dur && time <= 0 && tTime <= 0) {
          time && (tween._zTime = time);
          return;
        }
      }
    } else if (runBackwards && dur) {
      if (!prevStartAt) {
        time && (immediateRender = false);
        p = _setDefaults$1({
          overwrite: false,
          data: "isFromStart",
          //we tag the tween with as "isFromStart" so that if [inside a plugin] we need to only do something at the very END of a tween, we have a way of identifying this tween as merely the one that's setting the beginning values for a "from()" tween. For example, clearProps in CSSPlugin should only get applied at the very END of a tween and without this tag, from(...{height:100, clearProps:"height", delay:1}) would wipe the height at the beginning of the tween and after 1 second, it'd kick back in.
          lazy: immediateRender && !prevStartAt && _isNotFalse(lazy),
          immediateRender,
          //zero-duration tweens render immediately by default, but if we're not specifically instructed to render this tween immediately, we should skip this and merely _init() to record the starting values (rendering them immediately would push them to completion which is wasteful in that case - we'd have to render(-1) immediately after)
          stagger: 0,
          parent
          //ensures that nested tweens that had a stagger are handled properly, like gsap.from(".class", {y: gsap.utils.wrap([-100,100]), stagger: 0.5})
        }, cleanVars);
        harnessVars && (p[harness.prop] = harnessVars);
        _removeFromParent(tween._startAt = Tween.set(targets, p));
        tween._startAt._dp = 0;
        tween._startAt._sat = tween;
        time < 0 && (_reverting$1 ? tween._startAt.revert(_revertConfigNoKill) : tween._startAt.render(-1, true));
        tween._zTime = time;
        if (!immediateRender) {
          _initTween2(tween._startAt, _tinyNum, _tinyNum);
        } else if (!time) {
          return;
        }
      }
    }
    tween._pt = tween._ptCache = 0;
    lazy = dur && _isNotFalse(lazy) || lazy && !dur;
    for (i = 0; i < targets.length; i++) {
      target = targets[i];
      gsData = target._gsap || _harness(targets)[i]._gsap;
      tween._ptLookup[i] = ptLookup = {};
      _lazyLookup[gsData.id] && _lazyTweens.length && _lazyRender();
      index = fullTargets === targets ? i : fullTargets.indexOf(target);
      if (harness && (plugin = new harness()).init(target, harnessVars || cleanVars, tween, index, fullTargets) !== false) {
        tween._pt = pt = new PropTween(tween._pt, target, plugin.name, 0, 1, plugin.render, plugin, 0, plugin.priority);
        plugin._props.forEach(function(name) {
          ptLookup[name] = pt;
        });
        plugin.priority && (hasPriority = 1);
      }
      if (!harness || harnessVars) {
        for (p in cleanVars) {
          if (_plugins[p] && (plugin = _checkPlugin(p, cleanVars, tween, index, target, fullTargets))) {
            plugin.priority && (hasPriority = 1);
          } else {
            ptLookup[p] = pt = _addPropTween.call(tween, target, p, "get", cleanVars[p], index, fullTargets, 0, vars.stringFilter);
          }
        }
      }
      tween._op && tween._op[i] && tween.kill(target, tween._op[i]);
      if (autoOverwrite && tween._pt) {
        _overwritingTween = tween;
        _globalTimeline.killTweensOf(target, ptLookup, tween.globalTime(time));
        overwritten = !tween.parent;
        _overwritingTween = 0;
      }
      tween._pt && lazy && (_lazyLookup[gsData.id] = 1);
    }
    hasPriority && _sortPropTweensByPriority(tween);
    tween._onInit && tween._onInit(tween);
  }
  tween._onUpdate = onUpdate;
  tween._initted = (!tween._op || tween._pt) && !overwritten;
  keyframes && time <= 0 && tl.render(_bigNum$1, true, true);
}, _updatePropTweens = function _updatePropTweens2(tween, property, value, start, startIsRelative, ratio, time, skipRecursion) {
  var ptCache = (tween._pt && tween._ptCache || (tween._ptCache = {}))[property], pt, rootPT, lookup, i;
  if (!ptCache) {
    ptCache = tween._ptCache[property] = [];
    lookup = tween._ptLookup;
    i = tween._targets.length;
    while (i--) {
      pt = lookup[i][property];
      if (pt && pt.d && pt.d._pt) {
        pt = pt.d._pt;
        while (pt && pt.p !== property && pt.fp !== property) {
          pt = pt._next;
        }
      }
      if (!pt) {
        _forceAllPropTweens = 1;
        tween.vars[property] = "+=0";
        _initTween(tween, time);
        _forceAllPropTweens = 0;
        return skipRecursion ? _warn(property + " not eligible for reset") : 1;
      }
      ptCache.push(pt);
    }
  }
  i = ptCache.length;
  while (i--) {
    rootPT = ptCache[i];
    pt = rootPT._pt || rootPT;
    pt.s = (start || start === 0) && !startIsRelative ? start : pt.s + (start || 0) + ratio * pt.c;
    pt.c = value - pt.s;
    rootPT.e && (rootPT.e = _round$1(value) + getUnit(rootPT.e));
    rootPT.b && (rootPT.b = pt.s + getUnit(rootPT.b));
  }
}, _addAliasesToVars = function _addAliasesToVars2(targets, vars) {
  var harness = targets[0] ? _getCache(targets[0]).harness : 0, propertyAliases = harness && harness.aliases, copy, p, i, aliases;
  if (!propertyAliases) {
    return vars;
  }
  copy = _merge({}, vars);
  for (p in propertyAliases) {
    if (p in copy) {
      aliases = propertyAliases[p].split(",");
      i = aliases.length;
      while (i--) {
        copy[aliases[i]] = copy[p];
      }
    }
  }
  return copy;
}, _parseKeyframe = function _parseKeyframe2(prop, obj, allProps, easeEach) {
  var ease = obj.ease || easeEach || "power1.inOut", p, a;
  if (_isArray(obj)) {
    a = allProps[prop] || (allProps[prop] = []);
    obj.forEach(function(value, i) {
      return a.push({
        t: i / (obj.length - 1) * 100,
        v: value,
        e: ease
      });
    });
  } else {
    for (p in obj) {
      a = allProps[p] || (allProps[p] = []);
      p === "ease" || a.push({
        t: parseFloat(prop),
        v: obj[p],
        e: ease
      });
    }
  }
}, _parseFuncOrString = function _parseFuncOrString2(value, tween, i, target, targets) {
  return _isFunction$1(value) ? value.call(tween, i, target, targets) : _isString$1(value) && ~value.indexOf("random(") ? _replaceRandom(value) : value;
}, _staggerTweenProps = _callbackNames + "repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert", _staggerPropsToSkip = {};
_forEachName(_staggerTweenProps + ",id,stagger,delay,duration,paused,scrollTrigger", function(name) {
  return _staggerPropsToSkip[name] = 1;
});
var Tween = /* @__PURE__ */ function(_Animation2) {
  _inheritsLoose(Tween2, _Animation2);
  function Tween2(targets, vars, position, skipInherit) {
    var _this3;
    if (typeof vars === "number") {
      position.duration = vars;
      vars = position;
      position = null;
    }
    _this3 = _Animation2.call(this, skipInherit ? vars : _inheritDefaults(vars)) || this;
    var _this3$vars = _this3.vars, duration = _this3$vars.duration, delay = _this3$vars.delay, immediateRender = _this3$vars.immediateRender, stagger = _this3$vars.stagger, overwrite = _this3$vars.overwrite, keyframes = _this3$vars.keyframes, defaults2 = _this3$vars.defaults, scrollTrigger = _this3$vars.scrollTrigger, yoyoEase = _this3$vars.yoyoEase, parent = vars.parent || _globalTimeline, parsedTargets = (_isArray(targets) || _isTypedArray(targets) ? _isNumber$1(targets[0]) : "length" in vars) ? [targets] : toArray(targets), tl, i, copy, l, p, curTarget, staggerFunc, staggerVarsToMerge;
    _this3._targets = parsedTargets.length ? _harness(parsedTargets) : _warn("GSAP target " + targets + " not found. https://gsap.com", !_config.nullTargetWarn) || [];
    _this3._ptLookup = [];
    _this3._overwrite = overwrite;
    if (keyframes || stagger || _isFuncOrString(duration) || _isFuncOrString(delay)) {
      vars = _this3.vars;
      tl = _this3.timeline = new Timeline({
        data: "nested",
        defaults: defaults2 || {},
        targets: parent && parent.data === "nested" ? parent.vars.targets : parsedTargets
      });
      tl.kill();
      tl.parent = tl._dp = _assertThisInitialized(_this3);
      tl._start = 0;
      if (stagger || _isFuncOrString(duration) || _isFuncOrString(delay)) {
        l = parsedTargets.length;
        staggerFunc = stagger && distribute(stagger);
        if (_isObject$1(stagger)) {
          for (p in stagger) {
            if (~_staggerTweenProps.indexOf(p)) {
              staggerVarsToMerge || (staggerVarsToMerge = {});
              staggerVarsToMerge[p] = stagger[p];
            }
          }
        }
        for (i = 0; i < l; i++) {
          copy = _copyExcluding(vars, _staggerPropsToSkip);
          copy.stagger = 0;
          yoyoEase && (copy.yoyoEase = yoyoEase);
          staggerVarsToMerge && _merge(copy, staggerVarsToMerge);
          curTarget = parsedTargets[i];
          copy.duration = +_parseFuncOrString(duration, _assertThisInitialized(_this3), i, curTarget, parsedTargets);
          copy.delay = (+_parseFuncOrString(delay, _assertThisInitialized(_this3), i, curTarget, parsedTargets) || 0) - _this3._delay;
          if (!stagger && l === 1 && copy.delay) {
            _this3._delay = delay = copy.delay;
            _this3._start += delay;
            copy.delay = 0;
          }
          tl.to(curTarget, copy, staggerFunc ? staggerFunc(i, curTarget, parsedTargets) : 0);
          tl._ease = _easeMap.none;
        }
        tl.duration() ? duration = delay = 0 : _this3.timeline = 0;
      } else if (keyframes) {
        _inheritDefaults(_setDefaults$1(tl.vars.defaults, {
          ease: "none"
        }));
        tl._ease = _parseEase(keyframes.ease || vars.ease || "none");
        var time = 0, a, kf, v;
        if (_isArray(keyframes)) {
          keyframes.forEach(function(frame) {
            return tl.to(parsedTargets, frame, ">");
          });
          tl.duration();
        } else {
          copy = {};
          for (p in keyframes) {
            p === "ease" || p === "easeEach" || _parseKeyframe(p, keyframes[p], copy, keyframes.easeEach);
          }
          for (p in copy) {
            a = copy[p].sort(function(a2, b) {
              return a2.t - b.t;
            });
            time = 0;
            for (i = 0; i < a.length; i++) {
              kf = a[i];
              v = {
                ease: kf.e,
                duration: (kf.t - (i ? a[i - 1].t : 0)) / 100 * duration
              };
              v[p] = kf.v;
              tl.to(parsedTargets, v, time);
              time += v.duration;
            }
          }
          tl.duration() < duration && tl.to({}, {
            duration: duration - tl.duration()
          });
        }
      }
      duration || _this3.duration(duration = tl.duration());
    } else {
      _this3.timeline = 0;
    }
    if (overwrite === true && !_suppressOverwrites$1) {
      _overwritingTween = _assertThisInitialized(_this3);
      _globalTimeline.killTweensOf(parsedTargets);
      _overwritingTween = 0;
    }
    _addToTimeline(parent, _assertThisInitialized(_this3), position);
    vars.reversed && _this3.reverse();
    vars.paused && _this3.paused(true);
    if (immediateRender || !duration && !keyframes && _this3._start === _roundPrecise(parent._time) && _isNotFalse(immediateRender) && _hasNoPausedAncestors(_assertThisInitialized(_this3)) && parent.data !== "nested") {
      _this3._tTime = -_tinyNum;
      _this3.render(Math.max(0, -delay) || 0);
    }
    scrollTrigger && _scrollTrigger(_assertThisInitialized(_this3), scrollTrigger);
    return _this3;
  }
  var _proto3 = Tween2.prototype;
  _proto3.render = function render2(totalTime, suppressEvents, force) {
    var prevTime = this._time, tDur = this._tDur, dur = this._dur, isNegative = totalTime < 0, tTime = totalTime > tDur - _tinyNum && !isNegative ? tDur : totalTime < _tinyNum ? 0 : totalTime, time, pt, iteration, cycleDuration, prevIteration, isYoyo, ratio, timeline2, yoyoEase;
    if (!dur) {
      _renderZeroDurationTween(this, totalTime, suppressEvents, force);
    } else if (tTime !== this._tTime || !totalTime || force || !this._initted && this._tTime || this._startAt && this._zTime < 0 !== isNegative || this._lazy) {
      time = tTime;
      timeline2 = this.timeline;
      if (this._repeat) {
        cycleDuration = dur + this._rDelay;
        if (this._repeat < -1 && isNegative) {
          return this.totalTime(cycleDuration * 100 + totalTime, suppressEvents, force);
        }
        time = _roundPrecise(tTime % cycleDuration);
        if (tTime === tDur) {
          iteration = this._repeat;
          time = dur;
        } else {
          prevIteration = _roundPrecise(tTime / cycleDuration);
          iteration = ~~prevIteration;
          if (iteration && iteration === prevIteration) {
            time = dur;
            iteration--;
          } else if (time > dur) {
            time = dur;
          }
        }
        isYoyo = this._yoyo && iteration & 1;
        if (isYoyo) {
          yoyoEase = this._yEase;
          time = dur - time;
        }
        prevIteration = _animationCycle(this._tTime, cycleDuration);
        if (time === prevTime && !force && this._initted && iteration === prevIteration) {
          this._tTime = tTime;
          return this;
        }
        if (iteration !== prevIteration) {
          timeline2 && this._yEase && _propagateYoyoEase(timeline2, isYoyo);
          if (this.vars.repeatRefresh && !isYoyo && !this._lock && time !== cycleDuration && this._initted) {
            this._lock = force = 1;
            this.render(_roundPrecise(cycleDuration * iteration), true).invalidate()._lock = 0;
          }
        }
      }
      if (!this._initted) {
        if (_attemptInitTween(this, isNegative ? totalTime : time, force, suppressEvents, tTime)) {
          this._tTime = 0;
          return this;
        }
        if (prevTime !== this._time && !(force && this.vars.repeatRefresh && iteration !== prevIteration)) {
          return this;
        }
        if (dur !== this._dur) {
          return this.render(totalTime, suppressEvents, force);
        }
      }
      this._tTime = tTime;
      this._time = time;
      if (!this._act && this._ts) {
        this._act = 1;
        this._lazy = 0;
      }
      this.ratio = ratio = (yoyoEase || this._ease)(time / dur);
      if (this._from) {
        this.ratio = ratio = 1 - ratio;
      }
      if (!prevTime && tTime && !suppressEvents && !prevIteration) {
        _callback$1(this, "onStart");
        if (this._tTime !== tTime) {
          return this;
        }
      }
      pt = this._pt;
      while (pt) {
        pt.r(ratio, pt.d);
        pt = pt._next;
      }
      timeline2 && timeline2.render(totalTime < 0 ? totalTime : timeline2._dur * timeline2._ease(time / this._dur), suppressEvents, force) || this._startAt && (this._zTime = totalTime);
      if (this._onUpdate && !suppressEvents) {
        isNegative && _rewindStartAt(this, totalTime, suppressEvents, force);
        _callback$1(this, "onUpdate");
      }
      this._repeat && iteration !== prevIteration && this.vars.onRepeat && !suppressEvents && this.parent && _callback$1(this, "onRepeat");
      if ((tTime === this._tDur || !tTime) && this._tTime === tTime) {
        isNegative && !this._onUpdate && _rewindStartAt(this, totalTime, true, true);
        (totalTime || !dur) && (tTime === this._tDur && this._ts > 0 || !tTime && this._ts < 0) && _removeFromParent(this, 1);
        if (!suppressEvents && !(isNegative && !prevTime) && (tTime || prevTime || isYoyo)) {
          _callback$1(this, tTime === tDur ? "onComplete" : "onReverseComplete", true);
          this._prom && !(tTime < tDur && this.timeScale() > 0) && this._prom();
        }
      }
    }
    return this;
  };
  _proto3.targets = function targets() {
    return this._targets;
  };
  _proto3.invalidate = function invalidate(soft) {
    (!soft || !this.vars.runBackwards) && (this._startAt = 0);
    this._pt = this._op = this._onUpdate = this._lazy = this.ratio = 0;
    this._ptLookup = [];
    this.timeline && this.timeline.invalidate(soft);
    return _Animation2.prototype.invalidate.call(this, soft);
  };
  _proto3.resetTo = function resetTo(property, value, start, startIsRelative, skipRecursion) {
    _tickerActive || _ticker.wake();
    this._ts || this.play();
    var time = Math.min(this._dur, (this._dp._time - this._start) * this._ts), ratio;
    this._initted || _initTween(this, time);
    ratio = this._ease(time / this._dur);
    if (_updatePropTweens(this, property, value, start, startIsRelative, ratio, time, skipRecursion)) {
      return this.resetTo(property, value, start, startIsRelative, 1);
    }
    _alignPlayhead(this, 0);
    this.parent || _addLinkedListItem(this._dp, this, "_first", "_last", this._dp._sort ? "_start" : 0);
    return this.render(0);
  };
  _proto3.kill = function kill(targets, vars) {
    if (vars === void 0) {
      vars = "all";
    }
    if (!targets && (!vars || vars === "all")) {
      this._lazy = this._pt = 0;
      this.parent ? _interrupt(this) : this.scrollTrigger && this.scrollTrigger.kill(!!_reverting$1);
      return this;
    }
    if (this.timeline) {
      var tDur = this.timeline.totalDuration();
      this.timeline.killTweensOf(targets, vars, _overwritingTween && _overwritingTween.vars.overwrite !== true)._first || _interrupt(this);
      this.parent && tDur !== this.timeline.totalDuration() && _setDuration(this, this._dur * this.timeline._tDur / tDur, 0, 1);
      return this;
    }
    var parsedTargets = this._targets, killingTargets = targets ? toArray(targets) : parsedTargets, propTweenLookup = this._ptLookup, firstPT = this._pt, overwrittenProps, curLookup, curOverwriteProps, props, p, pt, i;
    if ((!vars || vars === "all") && _arraysMatch(parsedTargets, killingTargets)) {
      vars === "all" && (this._pt = 0);
      return _interrupt(this);
    }
    overwrittenProps = this._op = this._op || [];
    if (vars !== "all") {
      if (_isString$1(vars)) {
        p = {};
        _forEachName(vars, function(name) {
          return p[name] = 1;
        });
        vars = p;
      }
      vars = _addAliasesToVars(parsedTargets, vars);
    }
    i = parsedTargets.length;
    while (i--) {
      if (~killingTargets.indexOf(parsedTargets[i])) {
        curLookup = propTweenLookup[i];
        if (vars === "all") {
          overwrittenProps[i] = vars;
          props = curLookup;
          curOverwriteProps = {};
        } else {
          curOverwriteProps = overwrittenProps[i] = overwrittenProps[i] || {};
          props = vars;
        }
        for (p in props) {
          pt = curLookup && curLookup[p];
          if (pt) {
            if (!("kill" in pt.d) || pt.d.kill(p) === true) {
              _removeLinkedListItem(this, pt, "_pt");
            }
            delete curLookup[p];
          }
          if (curOverwriteProps !== "all") {
            curOverwriteProps[p] = 1;
          }
        }
      }
    }
    this._initted && !this._pt && firstPT && _interrupt(this);
    return this;
  };
  Tween2.to = function to(targets, vars) {
    return new Tween2(targets, vars, arguments[2]);
  };
  Tween2.from = function from(targets, vars) {
    return _createTweenType(1, arguments);
  };
  Tween2.delayedCall = function delayedCall(delay, callback, params, scope) {
    return new Tween2(callback, 0, {
      immediateRender: false,
      lazy: false,
      overwrite: false,
      delay,
      onComplete: callback,
      onReverseComplete: callback,
      onCompleteParams: params,
      onReverseCompleteParams: params,
      callbackScope: scope
    });
  };
  Tween2.fromTo = function fromTo(targets, fromVars, toVars) {
    return _createTweenType(2, arguments);
  };
  Tween2.set = function set(targets, vars) {
    vars.duration = 0;
    vars.repeatDelay || (vars.repeat = 0);
    return new Tween2(targets, vars);
  };
  Tween2.killTweensOf = function killTweensOf(targets, props, onlyActive) {
    return _globalTimeline.killTweensOf(targets, props, onlyActive);
  };
  return Tween2;
}(Animation);
_setDefaults$1(Tween.prototype, {
  _targets: [],
  _lazy: 0,
  _startAt: 0,
  _op: 0,
  _onInit: 0
});
_forEachName("staggerTo,staggerFrom,staggerFromTo", function(name) {
  Tween[name] = function() {
    var tl = new Timeline(), params = _slice.call(arguments, 0);
    params.splice(name === "staggerFromTo" ? 5 : 4, 0, 0);
    return tl[name].apply(tl, params);
  };
});
var _setterPlain = function _setterPlain2(target, property, value) {
  return target[property] = value;
}, _setterFunc = function _setterFunc2(target, property, value) {
  return target[property](value);
}, _setterFuncWithParam = function _setterFuncWithParam2(target, property, value, data) {
  return target[property](data.fp, value);
}, _setterAttribute = function _setterAttribute2(target, property, value) {
  return target.setAttribute(property, value);
}, _getSetter = function _getSetter2(target, property) {
  return _isFunction$1(target[property]) ? _setterFunc : _isUndefined(target[property]) && target.setAttribute ? _setterAttribute : _setterPlain;
}, _renderPlain = function _renderPlain2(ratio, data) {
  return data.set(data.t, data.p, Math.round((data.s + data.c * ratio) * 1e6) / 1e6, data);
}, _renderBoolean = function _renderBoolean2(ratio, data) {
  return data.set(data.t, data.p, !!(data.s + data.c * ratio), data);
}, _renderComplexString = function _renderComplexString2(ratio, data) {
  var pt = data._pt, s = "";
  if (!ratio && data.b) {
    s = data.b;
  } else if (ratio === 1 && data.e) {
    s = data.e;
  } else {
    while (pt) {
      s = pt.p + (pt.m ? pt.m(pt.s + pt.c * ratio) : Math.round((pt.s + pt.c * ratio) * 1e4) / 1e4) + s;
      pt = pt._next;
    }
    s += data.c;
  }
  data.set(data.t, data.p, s, data);
}, _renderPropTweens = function _renderPropTweens2(ratio, data) {
  var pt = data._pt;
  while (pt) {
    pt.r(ratio, pt.d);
    pt = pt._next;
  }
}, _addPluginModifier = function _addPluginModifier2(modifier, tween, target, property) {
  var pt = this._pt, next;
  while (pt) {
    next = pt._next;
    pt.p === property && pt.modifier(modifier, tween, target);
    pt = next;
  }
}, _killPropTweensOf = function _killPropTweensOf2(property) {
  var pt = this._pt, hasNonDependentRemaining, next;
  while (pt) {
    next = pt._next;
    if (pt.p === property && !pt.op || pt.op === property) {
      _removeLinkedListItem(this, pt, "_pt");
    } else if (!pt.dep) {
      hasNonDependentRemaining = 1;
    }
    pt = next;
  }
  return !hasNonDependentRemaining;
}, _setterWithModifier = function _setterWithModifier2(target, property, value, data) {
  data.mSet(target, property, data.m.call(data.tween, value, data.mt), data);
}, _sortPropTweensByPriority = function _sortPropTweensByPriority2(parent) {
  var pt = parent._pt, next, pt2, first, last;
  while (pt) {
    next = pt._next;
    pt2 = first;
    while (pt2 && pt2.pr > pt.pr) {
      pt2 = pt2._next;
    }
    if (pt._prev = pt2 ? pt2._prev : last) {
      pt._prev._next = pt;
    } else {
      first = pt;
    }
    if (pt._next = pt2) {
      pt2._prev = pt;
    } else {
      last = pt;
    }
    pt = next;
  }
  parent._pt = first;
};
var PropTween = /* @__PURE__ */ function() {
  function PropTween2(next, target, prop, start, change, renderer, data, setter, priority) {
    this.t = target;
    this.s = start;
    this.c = change;
    this.p = prop;
    this.r = renderer || _renderPlain;
    this.d = data || this;
    this.set = setter || _setterPlain;
    this.pr = priority || 0;
    this._next = next;
    if (next) {
      next._prev = this;
    }
  }
  var _proto4 = PropTween2.prototype;
  _proto4.modifier = function modifier(func, tween, target) {
    this.mSet = this.mSet || this.set;
    this.set = _setterWithModifier;
    this.m = func;
    this.mt = target;
    this.tween = tween;
  };
  return PropTween2;
}();
_forEachName(_callbackNames + "parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger", function(name) {
  return _reservedProps[name] = 1;
});
_globals.TweenMax = _globals.TweenLite = Tween;
_globals.TimelineLite = _globals.TimelineMax = Timeline;
_globalTimeline = new Timeline({
  sortChildren: false,
  defaults: _defaults$1,
  autoRemoveChildren: true,
  id: "root",
  smoothChildTiming: true
});
_config.stringFilter = _colorStringFilter;
var _media = [], _listeners$1 = {}, _emptyArray$1 = [], _lastMediaTime = 0, _contextID = 0, _dispatch$1 = function _dispatch2(type) {
  return (_listeners$1[type] || _emptyArray$1).map(function(f) {
    return f();
  });
}, _onMediaChange = function _onMediaChange2() {
  var time = Date.now(), matches = [];
  if (time - _lastMediaTime > 2) {
    _dispatch$1("matchMediaInit");
    _media.forEach(function(c) {
      var queries = c.queries, conditions = c.conditions, match, p, anyMatch, toggled;
      for (p in queries) {
        match = _win$3.matchMedia(queries[p]).matches;
        match && (anyMatch = 1);
        if (match !== conditions[p]) {
          conditions[p] = match;
          toggled = 1;
        }
      }
      if (toggled) {
        c.revert();
        anyMatch && matches.push(c);
      }
    });
    _dispatch$1("matchMediaRevert");
    matches.forEach(function(c) {
      return c.onMatch(c, function(func) {
        return c.add(null, func);
      });
    });
    _lastMediaTime = time;
    _dispatch$1("matchMedia");
  }
};
var Context = /* @__PURE__ */ function() {
  function Context2(func, scope) {
    this.selector = scope && selector(scope);
    this.data = [];
    this._r = [];
    this.isReverted = false;
    this.id = _contextID++;
    func && this.add(func);
  }
  var _proto5 = Context2.prototype;
  _proto5.add = function add(name, func, scope) {
    if (_isFunction$1(name)) {
      scope = func;
      func = name;
      name = _isFunction$1;
    }
    var self = this, f = function f2() {
      var prev = _context$2, prevSelector = self.selector, result;
      prev && prev !== self && prev.data.push(self);
      scope && (self.selector = selector(scope));
      _context$2 = self;
      result = func.apply(self, arguments);
      _isFunction$1(result) && self._r.push(result);
      _context$2 = prev;
      self.selector = prevSelector;
      self.isReverted = false;
      return result;
    };
    self.last = f;
    return name === _isFunction$1 ? f(self, function(func2) {
      return self.add(null, func2);
    }) : name ? self[name] = f : f;
  };
  _proto5.ignore = function ignore(func) {
    var prev = _context$2;
    _context$2 = null;
    func(this);
    _context$2 = prev;
  };
  _proto5.getTweens = function getTweens() {
    var a = [];
    this.data.forEach(function(e) {
      return e instanceof Context2 ? a.push.apply(a, e.getTweens()) : e instanceof Tween && !(e.parent && e.parent.data === "nested") && a.push(e);
    });
    return a;
  };
  _proto5.clear = function clear() {
    this._r.length = this.data.length = 0;
  };
  _proto5.kill = function kill(revert, matchMedia2) {
    var _this4 = this;
    if (revert) {
      (function() {
        var tweens = _this4.getTweens(), i2 = _this4.data.length, t;
        while (i2--) {
          t = _this4.data[i2];
          if (t.data === "isFlip") {
            t.revert();
            t.getChildren(true, true, false).forEach(function(tween) {
              return tweens.splice(tweens.indexOf(tween), 1);
            });
          }
        }
        tweens.map(function(t2) {
          return {
            g: t2._dur || t2._delay || t2._sat && !t2._sat.vars.immediateRender ? t2.globalTime(0) : -Infinity,
            t: t2
          };
        }).sort(function(a, b) {
          return b.g - a.g || -Infinity;
        }).forEach(function(o) {
          return o.t.revert(revert);
        });
        i2 = _this4.data.length;
        while (i2--) {
          t = _this4.data[i2];
          if (t instanceof Timeline) {
            if (t.data !== "nested") {
              t.scrollTrigger && t.scrollTrigger.revert();
              t.kill();
            }
          } else {
            !(t instanceof Tween) && t.revert && t.revert(revert);
          }
        }
        _this4._r.forEach(function(f) {
          return f(revert, _this4);
        });
        _this4.isReverted = true;
      })();
    } else {
      this.data.forEach(function(e) {
        return e.kill && e.kill();
      });
    }
    this.clear();
    if (matchMedia2) {
      var i = _media.length;
      while (i--) {
        _media[i].id === this.id && _media.splice(i, 1);
      }
    }
  };
  _proto5.revert = function revert(config3) {
    this.kill(config3 || {});
  };
  return Context2;
}();
var MatchMedia = /* @__PURE__ */ function() {
  function MatchMedia2(scope) {
    this.contexts = [];
    this.scope = scope;
    _context$2 && _context$2.data.push(this);
  }
  var _proto6 = MatchMedia2.prototype;
  _proto6.add = function add(conditions, func, scope) {
    _isObject$1(conditions) || (conditions = {
      matches: conditions
    });
    var context3 = new Context(0, scope || this.scope), cond = context3.conditions = {}, mq, p, active;
    _context$2 && !context3.selector && (context3.selector = _context$2.selector);
    this.contexts.push(context3);
    func = context3.add("onMatch", func);
    context3.queries = conditions;
    for (p in conditions) {
      if (p === "all") {
        active = 1;
      } else {
        mq = _win$3.matchMedia(conditions[p]);
        if (mq) {
          _media.indexOf(context3) < 0 && _media.push(context3);
          (cond[p] = mq.matches) && (active = 1);
          mq.addListener ? mq.addListener(_onMediaChange) : mq.addEventListener("change", _onMediaChange);
        }
      }
    }
    active && func(context3, function(f) {
      return context3.add(null, f);
    });
    return this;
  };
  _proto6.revert = function revert(config3) {
    this.kill(config3 || {});
  };
  _proto6.kill = function kill(revert) {
    this.contexts.forEach(function(c) {
      return c.kill(revert, true);
    });
  };
  return MatchMedia2;
}();
var _gsap = {
  registerPlugin: function registerPlugin() {
    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }
    args.forEach(function(config3) {
      return _createPlugin(config3);
    });
  },
  timeline: function timeline(vars) {
    return new Timeline(vars);
  },
  getTweensOf: function getTweensOf(targets, onlyActive) {
    return _globalTimeline.getTweensOf(targets, onlyActive);
  },
  getProperty: function getProperty(target, property, unit, uncache) {
    _isString$1(target) && (target = toArray(target)[0]);
    var getter = _getCache(target || {}).get, format = unit ? _passThrough$1 : _numericIfPossible;
    unit === "native" && (unit = "");
    return !target ? target : !property ? function(property2, unit2, uncache2) {
      return format((_plugins[property2] && _plugins[property2].get || getter)(target, property2, unit2, uncache2));
    } : format((_plugins[property] && _plugins[property].get || getter)(target, property, unit, uncache));
  },
  quickSetter: function quickSetter(target, property, unit) {
    target = toArray(target);
    if (target.length > 1) {
      var setters = target.map(function(t) {
        return gsap$2.quickSetter(t, property, unit);
      }), l = setters.length;
      return function(value) {
        var i = l;
        while (i--) {
          setters[i](value);
        }
      };
    }
    target = target[0] || {};
    var Plugin = _plugins[property], cache = _getCache(target), p = cache.harness && (cache.harness.aliases || {})[property] || property, setter = Plugin ? function(value) {
      var p2 = new Plugin();
      _quickTween._pt = 0;
      p2.init(target, unit ? value + unit : value, _quickTween, 0, [target]);
      p2.render(1, p2);
      _quickTween._pt && _renderPropTweens(1, _quickTween);
    } : cache.set(target, p);
    return Plugin ? setter : function(value) {
      return setter(target, p, unit ? value + unit : value, cache, 1);
    };
  },
  quickTo: function quickTo(target, property, vars) {
    var _setDefaults22;
    var tween = gsap$2.to(target, _setDefaults$1((_setDefaults22 = {}, _setDefaults22[property] = "+=0.1", _setDefaults22.paused = true, _setDefaults22.stagger = 0, _setDefaults22), vars || {})), func = function func2(value, start, startIsRelative) {
      return tween.resetTo(property, value, start, startIsRelative);
    };
    func.tween = tween;
    return func;
  },
  isTweening: function isTweening(targets) {
    return _globalTimeline.getTweensOf(targets, true).length > 0;
  },
  defaults: function defaults(value) {
    value && value.ease && (value.ease = _parseEase(value.ease, _defaults$1.ease));
    return _mergeDeep(_defaults$1, value || {});
  },
  config: function config2(value) {
    return _mergeDeep(_config, value || {});
  },
  registerEffect: function registerEffect(_ref3) {
    var name = _ref3.name, effect = _ref3.effect, plugins = _ref3.plugins, defaults2 = _ref3.defaults, extendTimeline = _ref3.extendTimeline;
    (plugins || "").split(",").forEach(function(pluginName) {
      return pluginName && !_plugins[pluginName] && !_globals[pluginName] && _warn(name + " effect requires " + pluginName + " plugin.");
    });
    _effects[name] = function(targets, vars, tl) {
      return effect(toArray(targets), _setDefaults$1(vars || {}, defaults2), tl);
    };
    if (extendTimeline) {
      Timeline.prototype[name] = function(targets, vars, position) {
        return this.add(_effects[name](targets, _isObject$1(vars) ? vars : (position = vars) && {}, this), position);
      };
    }
  },
  registerEase: function registerEase(name, ease) {
    _easeMap[name] = _parseEase(ease);
  },
  parseEase: function parseEase(ease, defaultEase) {
    return arguments.length ? _parseEase(ease, defaultEase) : _easeMap;
  },
  getById: function getById(id) {
    return _globalTimeline.getById(id);
  },
  exportRoot: function exportRoot(vars, includeDelayedCalls) {
    if (vars === void 0) {
      vars = {};
    }
    var tl = new Timeline(vars), child, next;
    tl.smoothChildTiming = _isNotFalse(vars.smoothChildTiming);
    _globalTimeline.remove(tl);
    tl._dp = 0;
    tl._time = tl._tTime = _globalTimeline._time;
    child = _globalTimeline._first;
    while (child) {
      next = child._next;
      if (includeDelayedCalls || !(!child._dur && child instanceof Tween && child.vars.onComplete === child._targets[0])) {
        _addToTimeline(tl, child, child._start - child._delay);
      }
      child = next;
    }
    _addToTimeline(_globalTimeline, tl, 0);
    return tl;
  },
  context: function context(func, scope) {
    return func ? new Context(func, scope) : _context$2;
  },
  matchMedia: function matchMedia(scope) {
    return new MatchMedia(scope);
  },
  matchMediaRefresh: function matchMediaRefresh() {
    return _media.forEach(function(c) {
      var cond = c.conditions, found, p;
      for (p in cond) {
        if (cond[p]) {
          cond[p] = false;
          found = 1;
        }
      }
      found && c.revert();
    }) || _onMediaChange();
  },
  addEventListener: function addEventListener(type, callback) {
    var a = _listeners$1[type] || (_listeners$1[type] = []);
    ~a.indexOf(callback) || a.push(callback);
  },
  removeEventListener: function removeEventListener(type, callback) {
    var a = _listeners$1[type], i = a && a.indexOf(callback);
    i >= 0 && a.splice(i, 1);
  },
  utils: {
    wrap,
    wrapYoyo,
    distribute,
    random,
    snap,
    normalize: normalize$2,
    getUnit,
    clamp: clamp$1,
    splitColor,
    toArray,
    selector,
    mapRange,
    pipe,
    unitize,
    interpolate,
    shuffle
  },
  install: _install,
  effects: _effects,
  ticker: _ticker,
  updateRoot: Timeline.updateRoot,
  plugins: _plugins,
  globalTimeline: _globalTimeline,
  core: {
    PropTween,
    globals: _addGlobal,
    Tween,
    Timeline,
    Animation,
    getCache: _getCache,
    _removeLinkedListItem,
    reverting: function reverting() {
      return _reverting$1;
    },
    context: function context2(toAdd) {
      if (toAdd && _context$2) {
        _context$2.data.push(toAdd);
        toAdd._ctx = _context$2;
      }
      return _context$2;
    },
    suppressOverwrites: function suppressOverwrites(value) {
      return _suppressOverwrites$1 = value;
    }
  }
};
_forEachName("to,from,fromTo,delayedCall,set,killTweensOf", function(name) {
  return _gsap[name] = Tween[name];
});
_ticker.add(Timeline.updateRoot);
_quickTween = _gsap.to({}, {
  duration: 0
});
var _getPluginPropTween = function _getPluginPropTween2(plugin, prop) {
  var pt = plugin._pt;
  while (pt && pt.p !== prop && pt.op !== prop && pt.fp !== prop) {
    pt = pt._next;
  }
  return pt;
}, _addModifiers = function _addModifiers2(tween, modifiers) {
  var targets = tween._targets, p, i, pt;
  for (p in modifiers) {
    i = targets.length;
    while (i--) {
      pt = tween._ptLookup[i][p];
      if (pt && (pt = pt.d)) {
        if (pt._pt) {
          pt = _getPluginPropTween(pt, p);
        }
        pt && pt.modifier && pt.modifier(modifiers[p], tween, targets[i], p);
      }
    }
  }
}, _buildModifierPlugin = function _buildModifierPlugin2(name, modifier) {
  return {
    name,
    headless: 1,
    rawVars: 1,
    //don't pre-process function-based values or "random()" strings.
    init: function init3(target, vars, tween) {
      tween._onInit = function(tween2) {
        var temp, p;
        if (_isString$1(vars)) {
          temp = {};
          _forEachName(vars, function(name2) {
            return temp[name2] = 1;
          });
          vars = temp;
        }
        if (modifier) {
          temp = {};
          for (p in vars) {
            temp[p] = modifier(vars[p]);
          }
          vars = temp;
        }
        _addModifiers(tween2, vars);
      };
    }
  };
};
var gsap$2 = _gsap.registerPlugin({
  name: "attr",
  init: function init(target, vars, tween, index, targets) {
    var p, pt, v;
    this.tween = tween;
    for (p in vars) {
      v = target.getAttribute(p) || "";
      pt = this.add(target, "setAttribute", (v || 0) + "", vars[p], index, targets, 0, 0, p);
      pt.op = p;
      pt.b = v;
      this._props.push(p);
    }
  },
  render: function render(ratio, data) {
    var pt = data._pt;
    while (pt) {
      _reverting$1 ? pt.set(pt.t, pt.p, pt.b, pt) : pt.r(ratio, pt.d);
      pt = pt._next;
    }
  }
}, {
  name: "endArray",
  headless: 1,
  init: function init2(target, value) {
    var i = value.length;
    while (i--) {
      this.add(target, i, target[i] || 0, value[i], 0, 0, 0, 0, 0, 1);
    }
  }
}, _buildModifierPlugin("roundProps", _roundModifier), _buildModifierPlugin("modifiers"), _buildModifierPlugin("snap", snap)) || _gsap;
Tween.version = Timeline.version = gsap$2.version = "3.13.0";
_coreReady = 1;
_windowExists$2() && _wake();
_easeMap.Power0; _easeMap.Power1; _easeMap.Power2; _easeMap.Power3; _easeMap.Power4; _easeMap.Linear; _easeMap.Quad; _easeMap.Cubic; _easeMap.Quart; _easeMap.Quint; _easeMap.Strong; _easeMap.Elastic; _easeMap.Back; _easeMap.SteppedEase; _easeMap.Bounce; _easeMap.Sine; _easeMap.Expo; _easeMap.Circ;

/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/


var _win$2,
    _doc$2,
    _docElement,
    _pluginInitted,
    _tempDiv,
    _recentSetterPlugin,
    _reverting,
    _windowExists$1 = function _windowExists() {
  return typeof window !== "undefined";
},
    _transformProps = {},
    _RAD2DEG = 180 / Math.PI,
    _DEG2RAD = Math.PI / 180,
    _atan2 = Math.atan2,
    _bigNum = 1e8,
    _capsExp$1 = /([A-Z])/g,
    _horizontalExp = /(left|right|width|margin|padding|x)/i,
    _complexExp = /[\s,\(]\S/,
    _propertyAliases = {
  autoAlpha: "opacity,visibility",
  scale: "scaleX,scaleY",
  alpha: "opacity"
},
    _renderCSSProp = function _renderCSSProp(ratio, data) {
  return data.set(data.t, data.p, Math.round((data.s + data.c * ratio) * 10000) / 10000 + data.u, data);
},
    _renderPropWithEnd = function _renderPropWithEnd(ratio, data) {
  return data.set(data.t, data.p, ratio === 1 ? data.e : Math.round((data.s + data.c * ratio) * 10000) / 10000 + data.u, data);
},
    _renderCSSPropWithBeginning = function _renderCSSPropWithBeginning(ratio, data) {
  return data.set(data.t, data.p, ratio ? Math.round((data.s + data.c * ratio) * 10000) / 10000 + data.u : data.b, data);
},
    //if units change, we need a way to render the original unit/value when the tween goes all the way back to the beginning (ratio:0)
_renderRoundedCSSProp = function _renderRoundedCSSProp(ratio, data) {
  var value = data.s + data.c * ratio;
  data.set(data.t, data.p, ~~(value + (value < 0 ? -0.5 : .5)) + data.u, data);
},
    _renderNonTweeningValue = function _renderNonTweeningValue(ratio, data) {
  return data.set(data.t, data.p, ratio ? data.e : data.b, data);
},
    _renderNonTweeningValueOnlyAtEnd = function _renderNonTweeningValueOnlyAtEnd(ratio, data) {
  return data.set(data.t, data.p, ratio !== 1 ? data.b : data.e, data);
},
    _setterCSSStyle = function _setterCSSStyle(target, property, value) {
  return target.style[property] = value;
},
    _setterCSSProp = function _setterCSSProp(target, property, value) {
  return target.style.setProperty(property, value);
},
    _setterTransform = function _setterTransform(target, property, value) {
  return target._gsap[property] = value;
},
    _setterScale = function _setterScale(target, property, value) {
  return target._gsap.scaleX = target._gsap.scaleY = value;
},
    _setterScaleWithRender = function _setterScaleWithRender(target, property, value, data, ratio) {
  var cache = target._gsap;
  cache.scaleX = cache.scaleY = value;
  cache.renderTransform(ratio, cache);
},
    _setterTransformWithRender = function _setterTransformWithRender(target, property, value, data, ratio) {
  var cache = target._gsap;
  cache[property] = value;
  cache.renderTransform(ratio, cache);
},
    _transformProp$1 = "transform",
    _transformOriginProp = _transformProp$1 + "Origin",
    _saveStyle = function _saveStyle(property, isNotCSS) {
  var _this = this;

  var target = this.target,
      style = target.style,
      cache = target._gsap;

  if (property in _transformProps && style) {
    this.tfm = this.tfm || {};

    if (property !== "transform") {
      property = _propertyAliases[property] || property;
      ~property.indexOf(",") ? property.split(",").forEach(function (a) {
        return _this.tfm[a] = _get(target, a);
      }) : this.tfm[property] = cache.x ? cache[property] : _get(target, property); // note: scale would map to "scaleX,scaleY", thus we loop and apply them both.

      property === _transformOriginProp && (this.tfm.zOrigin = cache.zOrigin);
    } else {
      return _propertyAliases.transform.split(",").forEach(function (p) {
        return _saveStyle.call(_this, p, isNotCSS);
      });
    }

    if (this.props.indexOf(_transformProp$1) >= 0) {
      return;
    }

    if (cache.svg) {
      this.svgo = target.getAttribute("data-svg-origin");
      this.props.push(_transformOriginProp, isNotCSS, "");
    }

    property = _transformProp$1;
  }

  (style || isNotCSS) && this.props.push(property, isNotCSS, style[property]);
},
    _removeIndependentTransforms = function _removeIndependentTransforms(style) {
  if (style.translate) {
    style.removeProperty("translate");
    style.removeProperty("scale");
    style.removeProperty("rotate");
  }
},
    _revertStyle = function _revertStyle() {
  var props = this.props,
      target = this.target,
      style = target.style,
      cache = target._gsap,
      i,
      p;

  for (i = 0; i < props.length; i += 3) {
    // stored like this: property, isNotCSS, value
    if (!props[i + 1]) {
      props[i + 2] ? style[props[i]] = props[i + 2] : style.removeProperty(props[i].substr(0, 2) === "--" ? props[i] : props[i].replace(_capsExp$1, "-$1").toLowerCase());
    } else if (props[i + 1] === 2) {
      // non-CSS value (function-based)
      target[props[i]](props[i + 2]);
    } else {
      // non-CSS value (not function-based)
      target[props[i]] = props[i + 2];
    }
  }

  if (this.tfm) {
    for (p in this.tfm) {
      cache[p] = this.tfm[p];
    }

    if (cache.svg) {
      cache.renderTransform();
      target.setAttribute("data-svg-origin", this.svgo || "");
    }

    i = _reverting();

    if ((!i || !i.isStart) && !style[_transformProp$1]) {
      _removeIndependentTransforms(style);

      if (cache.zOrigin && style[_transformOriginProp]) {
        style[_transformOriginProp] += " " + cache.zOrigin + "px"; // since we're uncaching, we must put the zOrigin back into the transformOrigin so that we can pull it out accurately when we parse again. Otherwise, we'd lose the z portion of the origin since we extract it to protect from Safari bugs.

        cache.zOrigin = 0;
        cache.renderTransform();
      }

      cache.uncache = 1; // if it's a startAt that's being reverted in the _initTween() of the core, we don't need to uncache transforms. This is purely a performance optimization.
    }
  }
},
    _getStyleSaver = function _getStyleSaver(target, properties) {
  var saver = {
    target: target,
    props: [],
    revert: _revertStyle,
    save: _saveStyle
  };
  target._gsap || gsap$2.core.getCache(target); // just make sure there's a _gsap cache defined because we read from it in _saveStyle() and it's more efficient to just check it here once.

  properties && target.style && target.nodeType && properties.split(",").forEach(function (p) {
    return saver.save(p);
  }); // make sure it's a DOM node too.

  return saver;
},
    _supports3D,
    _createElement = function _createElement(type, ns) {
  var e = _doc$2.createElementNS ? _doc$2.createElementNS((ns || "http://www.w3.org/1999/xhtml").replace(/^https/, "http"), type) : _doc$2.createElement(type); //some servers swap in https for http in the namespace which can break things, making "style" inaccessible.

  return e && e.style ? e : _doc$2.createElement(type); //some environments won't allow access to the element's style when created with a namespace in which case we default to the standard createElement() to work around the issue. Also note that when GSAP is embedded directly inside an SVG file, createElement() won't allow access to the style object in Firefox (see https://gsap.com/forums/topic/20215-problem-using-tweenmax-in-standalone-self-containing-svg-file-err-cannot-set-property-csstext-of-undefined/).
},
    _getComputedProperty = function _getComputedProperty(target, property, skipPrefixFallback) {
  var cs = getComputedStyle(target);
  return cs[property] || cs.getPropertyValue(property.replace(_capsExp$1, "-$1").toLowerCase()) || cs.getPropertyValue(property) || !skipPrefixFallback && _getComputedProperty(target, _checkPropPrefix(property) || property, 1) || ""; //css variables may not need caps swapped out for dashes and lowercase.
},
    _prefixes = "O,Moz,ms,Ms,Webkit".split(","),
    _checkPropPrefix = function _checkPropPrefix(property, element, preferPrefix) {
  var e = element || _tempDiv,
      s = e.style,
      i = 5;

  if (property in s && !preferPrefix) {
    return property;
  }

  property = property.charAt(0).toUpperCase() + property.substr(1);

  while (i-- && !(_prefixes[i] + property in s)) {}

  return i < 0 ? null : (i === 3 ? "ms" : i >= 0 ? _prefixes[i] : "") + property;
},
    _initCore$1 = function _initCore() {
  if (_windowExists$1() && window.document) {
    _win$2 = window;
    _doc$2 = _win$2.document;
    _docElement = _doc$2.documentElement;
    _tempDiv = _createElement("div") || {
      style: {}
    };
    _createElement("div");
    _transformProp$1 = _checkPropPrefix(_transformProp$1);
    _transformOriginProp = _transformProp$1 + "Origin";
    _tempDiv.style.cssText = "border-width:0;line-height:0;position:absolute;padding:0"; //make sure to override certain properties that may contaminate measurements, in case the user has overreaching style sheets.

    _supports3D = !!_checkPropPrefix("perspective");
    _reverting = gsap$2.core.reverting;
    _pluginInitted = 1;
  }
},
    _getReparentedCloneBBox = function _getReparentedCloneBBox(target) {
  //works around issues in some browsers (like Firefox) that don't correctly report getBBox() on SVG elements inside a <defs> element and/or <mask>. We try creating an SVG, adding it to the documentElement and toss the element in there so that it's definitely part of the rendering tree, then grab the bbox and if it works, we actually swap out the original getBBox() method for our own that does these extra steps whenever getBBox is needed. This helps ensure that performance is optimal (only do all these extra steps when absolutely necessary...most elements don't need it).
  var owner = target.ownerSVGElement,
      svg = _createElement("svg", owner && owner.getAttribute("xmlns") || "http://www.w3.org/2000/svg"),
      clone = target.cloneNode(true),
      bbox;

  clone.style.display = "block";
  svg.appendChild(clone);

  _docElement.appendChild(svg);

  try {
    bbox = clone.getBBox();
  } catch (e) {}

  svg.removeChild(clone);

  _docElement.removeChild(svg);

  return bbox;
},
    _getAttributeFallbacks = function _getAttributeFallbacks(target, attributesArray) {
  var i = attributesArray.length;

  while (i--) {
    if (target.hasAttribute(attributesArray[i])) {
      return target.getAttribute(attributesArray[i]);
    }
  }
},
    _getBBox = function _getBBox(target) {
  var bounds, cloned;

  try {
    bounds = target.getBBox(); //Firefox throws errors if you try calling getBBox() on an SVG element that's not rendered (like in a <symbol> or <defs>). https://bugzilla.mozilla.org/show_bug.cgi?id=612118
  } catch (error) {
    bounds = _getReparentedCloneBBox(target);
    cloned = 1;
  }

  bounds && (bounds.width || bounds.height) || cloned || (bounds = _getReparentedCloneBBox(target)); //some browsers (like Firefox) misreport the bounds if the element has zero width and height (it just assumes it's at x:0, y:0), thus we need to manually grab the position in that case.

  return bounds && !bounds.width && !bounds.x && !bounds.y ? {
    x: +_getAttributeFallbacks(target, ["x", "cx", "x1"]) || 0,
    y: +_getAttributeFallbacks(target, ["y", "cy", "y1"]) || 0,
    width: 0,
    height: 0
  } : bounds;
},
    _isSVG = function _isSVG(e) {
  return !!(e.getCTM && (!e.parentNode || e.ownerSVGElement) && _getBBox(e));
},
    //reports if the element is an SVG on which getBBox() actually works
_removeProperty = function _removeProperty(target, property) {
  if (property) {
    var style = target.style,
        first2Chars;

    if (property in _transformProps && property !== _transformOriginProp) {
      property = _transformProp$1;
    }

    if (style.removeProperty) {
      first2Chars = property.substr(0, 2);

      if (first2Chars === "ms" || property.substr(0, 6) === "webkit") {
        //Microsoft and some Webkit browsers don't conform to the standard of capitalizing the first prefix character, so we adjust so that when we prefix the caps with a dash, it's correct (otherwise it'd be "ms-transform" instead of "-ms-transform" for IE9, for example)
        property = "-" + property;
      }

      style.removeProperty(first2Chars === "--" ? property : property.replace(_capsExp$1, "-$1").toLowerCase());
    } else {
      //note: old versions of IE use "removeAttribute()" instead of "removeProperty()"
      style.removeAttribute(property);
    }
  }
},
    _addNonTweeningPT = function _addNonTweeningPT(plugin, target, property, beginning, end, onlySetAtEnd) {
  var pt = new PropTween(plugin._pt, target, property, 0, 1, onlySetAtEnd ? _renderNonTweeningValueOnlyAtEnd : _renderNonTweeningValue);
  plugin._pt = pt;
  pt.b = beginning;
  pt.e = end;

  plugin._props.push(property);

  return pt;
},
    _nonConvertibleUnits = {
  deg: 1,
  rad: 1,
  turn: 1
},
    _nonStandardLayouts = {
  grid: 1,
  flex: 1
},
    //takes a single value like 20px and converts it to the unit specified, like "%", returning only the numeric amount.
_convertToUnit = function _convertToUnit(target, property, value, unit) {
  var curValue = parseFloat(value) || 0,
      curUnit = (value + "").trim().substr((curValue + "").length) || "px",
      // some browsers leave extra whitespace at the beginning of CSS variables, hence the need to trim()
  style = _tempDiv.style,
      horizontal = _horizontalExp.test(property),
      isRootSVG = target.tagName.toLowerCase() === "svg",
      measureProperty = (isRootSVG ? "client" : "offset") + (horizontal ? "Width" : "Height"),
      amount = 100,
      toPixels = unit === "px",
      toPercent = unit === "%",
      px,
      parent,
      cache,
      isSVG;

  if (unit === curUnit || !curValue || _nonConvertibleUnits[unit] || _nonConvertibleUnits[curUnit]) {
    return curValue;
  }

  curUnit !== "px" && !toPixels && (curValue = _convertToUnit(target, property, value, "px"));
  isSVG = target.getCTM && _isSVG(target);

  if ((toPercent || curUnit === "%") && (_transformProps[property] || ~property.indexOf("adius"))) {
    px = isSVG ? target.getBBox()[horizontal ? "width" : "height"] : target[measureProperty];
    return _round$1(toPercent ? curValue / px * amount : curValue / 100 * px);
  }

  style[horizontal ? "width" : "height"] = amount + (toPixels ? curUnit : unit);
  parent = unit !== "rem" && ~property.indexOf("adius") || unit === "em" && target.appendChild && !isRootSVG ? target : target.parentNode;

  if (isSVG) {
    parent = (target.ownerSVGElement || {}).parentNode;
  }

  if (!parent || parent === _doc$2 || !parent.appendChild) {
    parent = _doc$2.body;
  }

  cache = parent._gsap;

  if (cache && toPercent && cache.width && horizontal && cache.time === _ticker.time && !cache.uncache) {
    return _round$1(curValue / cache.width * amount);
  } else {
    if (toPercent && (property === "height" || property === "width")) {
      // if we're dealing with width/height that's inside a container with padding and/or it's a flexbox/grid container, we must apply it to the target itself rather than the _tempDiv in order to ensure complete accuracy, factoring in the parent's padding.
      var v = target.style[property];
      target.style[property] = amount + unit;
      px = target[measureProperty];
      v ? target.style[property] = v : _removeProperty(target, property);
    } else {
      (toPercent || curUnit === "%") && !_nonStandardLayouts[_getComputedProperty(parent, "display")] && (style.position = _getComputedProperty(target, "position"));
      parent === target && (style.position = "static"); // like for borderRadius, if it's a % we must have it relative to the target itself but that may not have position: relative or position: absolute in which case it'd go up the chain until it finds its offsetParent (bad). position: static protects against that.

      parent.appendChild(_tempDiv);
      px = _tempDiv[measureProperty];
      parent.removeChild(_tempDiv);
      style.position = "absolute";
    }

    if (horizontal && toPercent) {
      cache = _getCache(parent);
      cache.time = _ticker.time;
      cache.width = parent[measureProperty];
    }
  }

  return _round$1(toPixels ? px * curValue / amount : px && curValue ? amount / px * curValue : 0);
},
    _get = function _get(target, property, unit, uncache) {
  var value;
  _pluginInitted || _initCore$1();

  if (property in _propertyAliases && property !== "transform") {
    property = _propertyAliases[property];

    if (~property.indexOf(",")) {
      property = property.split(",")[0];
    }
  }

  if (_transformProps[property] && property !== "transform") {
    value = _parseTransform(target, uncache);
    value = property !== "transformOrigin" ? value[property] : value.svg ? value.origin : _firstTwoOnly(_getComputedProperty(target, _transformOriginProp)) + " " + value.zOrigin + "px";
  } else {
    value = target.style[property];

    if (!value || value === "auto" || uncache || ~(value + "").indexOf("calc(")) {
      value = _specialProps[property] && _specialProps[property](target, property, unit) || _getComputedProperty(target, property) || _getProperty(target, property) || (property === "opacity" ? 1 : 0); // note: some browsers, like Firefox, don't report borderRadius correctly! Instead, it only reports every corner like  borderTopLeftRadius
    }
  }

  return unit && !~(value + "").trim().indexOf(" ") ? _convertToUnit(target, property, value, unit) + unit : value;
},
    _tweenComplexCSSString = function _tweenComplexCSSString(target, prop, start, end) {
  // note: we call _tweenComplexCSSString.call(pluginInstance...) to ensure that it's scoped properly. We may call it from within a plugin too, thus "this" would refer to the plugin.
  if (!start || start === "none") {
    // some browsers like Safari actually PREFER the prefixed property and mis-report the unprefixed value like clipPath (BUG). In other words, even though clipPath exists in the style ("clipPath" in target.style) and it's set in the CSS properly (along with -webkit-clip-path), Safari reports clipPath as "none" whereas WebkitClipPath reports accurately like "ellipse(100% 0% at 50% 0%)", so in this case we must SWITCH to using the prefixed property instead. See https://gsap.com/forums/topic/18310-clippath-doesnt-work-on-ios/
    var p = _checkPropPrefix(prop, target, 1),
        s = p && _getComputedProperty(target, p, 1);

    if (s && s !== start) {
      prop = p;
      start = s;
    } else if (prop === "borderColor") {
      start = _getComputedProperty(target, "borderTopColor"); // Firefox bug: always reports "borderColor" as "", so we must fall back to borderTopColor. See https://gsap.com/forums/topic/24583-how-to-return-colors-that-i-had-after-reverse/
    }
  }

  var pt = new PropTween(this._pt, target.style, prop, 0, 1, _renderComplexString),
      index = 0,
      matchIndex = 0,
      a,
      result,
      startValues,
      startNum,
      color,
      startValue,
      endValue,
      endNum,
      chunk,
      endUnit,
      startUnit,
      endValues;
  pt.b = start;
  pt.e = end;
  start += ""; // ensure values are strings

  end += "";

  if (end.substring(0, 6) === "var(--") {
    end = _getComputedProperty(target, end.substring(4, end.indexOf(")")));
  }

  if (end === "auto") {
    startValue = target.style[prop];
    target.style[prop] = end;
    end = _getComputedProperty(target, prop) || end;
    startValue ? target.style[prop] = startValue : _removeProperty(target, prop);
  }

  a = [start, end];

  _colorStringFilter(a); // pass an array with the starting and ending values and let the filter do whatever it needs to the values. If colors are found, it returns true and then we must match where the color shows up order-wise because for things like boxShadow, sometimes the browser provides the computed values with the color FIRST, but the user provides it with the color LAST, so flip them if necessary. Same for drop-shadow().


  start = a[0];
  end = a[1];
  startValues = start.match(_numWithUnitExp) || [];
  endValues = end.match(_numWithUnitExp) || [];

  if (endValues.length) {
    while (result = _numWithUnitExp.exec(end)) {
      endValue = result[0];
      chunk = end.substring(index, result.index);

      if (color) {
        color = (color + 1) % 5;
      } else if (chunk.substr(-5) === "rgba(" || chunk.substr(-5) === "hsla(") {
        color = 1;
      }

      if (endValue !== (startValue = startValues[matchIndex++] || "")) {
        startNum = parseFloat(startValue) || 0;
        startUnit = startValue.substr((startNum + "").length);
        endValue.charAt(1) === "=" && (endValue = _parseRelative(startNum, endValue) + startUnit);
        endNum = parseFloat(endValue);
        endUnit = endValue.substr((endNum + "").length);
        index = _numWithUnitExp.lastIndex - endUnit.length;

        if (!endUnit) {
          //if something like "perspective:300" is passed in and we must add a unit to the end
          endUnit = endUnit || _config.units[prop] || startUnit;

          if (index === end.length) {
            end += endUnit;
            pt.e += endUnit;
          }
        }

        if (startUnit !== endUnit) {
          startNum = _convertToUnit(target, prop, startValue, endUnit) || 0;
        } // these nested PropTweens are handled in a special way - we'll never actually call a render or setter method on them. We'll just loop through them in the parent complex string PropTween's render method.


        pt._pt = {
          _next: pt._pt,
          p: chunk || matchIndex === 1 ? chunk : ",",
          //note: SVG spec allows omission of comma/space when a negative sign is wedged between two numbers, like 2.5-5.3 instead of 2.5,-5.3 but when tweening, the negative value may switch to positive, so we insert the comma just in case.
          s: startNum,
          c: endNum - startNum,
          m: color && color < 4 || prop === "zIndex" ? Math.round : 0
        };
      }
    }

    pt.c = index < end.length ? end.substring(index, end.length) : ""; //we use the "c" of the PropTween to store the final part of the string (after the last number)
  } else {
    pt.r = prop === "display" && end === "none" ? _renderNonTweeningValueOnlyAtEnd : _renderNonTweeningValue;
  }

  _relExp.test(end) && (pt.e = 0); //if the end string contains relative values or dynamic random(...) values, delete the end it so that on the final render we don't actually set it to the string with += or -= characters (forces it to use the calculated value).

  this._pt = pt; //start the linked list with this new PropTween. Remember, we call _tweenComplexCSSString.call(pluginInstance...) to ensure that it's scoped properly. We may call it from within another plugin too, thus "this" would refer to the plugin.

  return pt;
},
    _keywordToPercent = {
  top: "0%",
  bottom: "100%",
  left: "0%",
  right: "100%",
  center: "50%"
},
    _convertKeywordsToPercentages = function _convertKeywordsToPercentages(value) {
  var split = value.split(" "),
      x = split[0],
      y = split[1] || "50%";

  if (x === "top" || x === "bottom" || y === "left" || y === "right") {
    //the user provided them in the wrong order, so flip them
    value = x;
    x = y;
    y = value;
  }

  split[0] = _keywordToPercent[x] || x;
  split[1] = _keywordToPercent[y] || y;
  return split.join(" ");
},
    _renderClearProps = function _renderClearProps(ratio, data) {
  if (data.tween && data.tween._time === data.tween._dur) {
    var target = data.t,
        style = target.style,
        props = data.u,
        cache = target._gsap,
        prop,
        clearTransforms,
        i;

    if (props === "all" || props === true) {
      style.cssText = "";
      clearTransforms = 1;
    } else {
      props = props.split(",");
      i = props.length;

      while (--i > -1) {
        prop = props[i];

        if (_transformProps[prop]) {
          clearTransforms = 1;
          prop = prop === "transformOrigin" ? _transformOriginProp : _transformProp$1;
        }

        _removeProperty(target, prop);
      }
    }

    if (clearTransforms) {
      _removeProperty(target, _transformProp$1);

      if (cache) {
        cache.svg && target.removeAttribute("transform");
        style.scale = style.rotate = style.translate = "none";

        _parseTransform(target, 1); // force all the cached values back to "normal"/identity, otherwise if there's another tween that's already set to render transforms on this element, it could display the wrong values.


        cache.uncache = 1;

        _removeIndependentTransforms(style);
      }
    }
  }
},
    // note: specialProps should return 1 if (and only if) they have a non-zero priority. It indicates we need to sort the linked list.
_specialProps = {
  clearProps: function clearProps(plugin, target, property, endValue, tween) {
    if (tween.data !== "isFromStart") {
      var pt = plugin._pt = new PropTween(plugin._pt, target, property, 0, 0, _renderClearProps);
      pt.u = endValue;
      pt.pr = -10;
      pt.tween = tween;

      plugin._props.push(property);

      return 1;
    }
  }
  /* className feature (about 0.4kb gzipped).
  , className(plugin, target, property, endValue, tween) {
  	let _renderClassName = (ratio, data) => {
  			data.css.render(ratio, data.css);
  			if (!ratio || ratio === 1) {
  				let inline = data.rmv,
  					target = data.t,
  					p;
  				target.setAttribute("class", ratio ? data.e : data.b);
  				for (p in inline) {
  					_removeProperty(target, p);
  				}
  			}
  		},
  		_getAllStyles = (target) => {
  			let styles = {},
  				computed = getComputedStyle(target),
  				p;
  			for (p in computed) {
  				if (isNaN(p) && p !== "cssText" && p !== "length") {
  					styles[p] = computed[p];
  				}
  			}
  			_setDefaults(styles, _parseTransform(target, 1));
  			return styles;
  		},
  		startClassList = target.getAttribute("class"),
  		style = target.style,
  		cssText = style.cssText,
  		cache = target._gsap,
  		classPT = cache.classPT,
  		inlineToRemoveAtEnd = {},
  		data = {t:target, plugin:plugin, rmv:inlineToRemoveAtEnd, b:startClassList, e:(endValue.charAt(1) !== "=") ? endValue : startClassList.replace(new RegExp("(?:\\s|^)" + endValue.substr(2) + "(?![\\w-])"), "") + ((endValue.charAt(0) === "+") ? " " + endValue.substr(2) : "")},
  		changingVars = {},
  		startVars = _getAllStyles(target),
  		transformRelated = /(transform|perspective)/i,
  		endVars, p;
  	if (classPT) {
  		classPT.r(1, classPT.d);
  		_removeLinkedListItem(classPT.d.plugin, classPT, "_pt");
  	}
  	target.setAttribute("class", data.e);
  	endVars = _getAllStyles(target, true);
  	target.setAttribute("class", startClassList);
  	for (p in endVars) {
  		if (endVars[p] !== startVars[p] && !transformRelated.test(p)) {
  			changingVars[p] = endVars[p];
  			if (!style[p] && style[p] !== "0") {
  				inlineToRemoveAtEnd[p] = 1;
  			}
  		}
  	}
  	cache.classPT = plugin._pt = new PropTween(plugin._pt, target, "className", 0, 0, _renderClassName, data, 0, -11);
  	if (style.cssText !== cssText) { //only apply if things change. Otherwise, in cases like a background-image that's pulled dynamically, it could cause a refresh. See https://gsap.com/forums/topic/20368-possible-gsap-bug-switching-classnames-in-chrome/.
  		style.cssText = cssText; //we recorded cssText before we swapped classes and ran _getAllStyles() because in cases when a className tween is overwritten, we remove all the related tweening properties from that class change (otherwise class-specific stuff can't override properties we've directly set on the target's style object due to specificity).
  	}
  	_parseTransform(target, true); //to clear the caching of transforms
  	data.css = new gsap.plugins.css();
  	data.css.init(target, changingVars, tween);
  	plugin._props.push(...data.css._props);
  	return 1;
  }
  */

},

/*
 * --------------------------------------------------------------------------------------
 * TRANSFORMS
 * --------------------------------------------------------------------------------------
 */
_identity2DMatrix = [1, 0, 0, 1, 0, 0],
    _rotationalProperties = {},
    _isNullTransform = function _isNullTransform(value) {
  return value === "matrix(1, 0, 0, 1, 0, 0)" || value === "none" || !value;
},
    _getComputedTransformMatrixAsArray = function _getComputedTransformMatrixAsArray(target) {
  var matrixString = _getComputedProperty(target, _transformProp$1);

  return _isNullTransform(matrixString) ? _identity2DMatrix : matrixString.substr(7).match(_numExp).map(_round$1);
},
    _getMatrix = function _getMatrix(target, force2D) {
  var cache = target._gsap || _getCache(target),
      style = target.style,
      matrix = _getComputedTransformMatrixAsArray(target),
      parent,
      nextSibling,
      temp,
      addedToDOM;

  if (cache.svg && target.getAttribute("transform")) {
    temp = target.transform.baseVal.consolidate().matrix; //ensures that even complex values like "translate(50,60) rotate(135,0,0)" are parsed because it mashes it into a matrix.

    matrix = [temp.a, temp.b, temp.c, temp.d, temp.e, temp.f];
    return matrix.join(",") === "1,0,0,1,0,0" ? _identity2DMatrix : matrix;
  } else if (matrix === _identity2DMatrix && !target.offsetParent && target !== _docElement && !cache.svg) {
    //note: if offsetParent is null, that means the element isn't in the normal document flow, like if it has display:none or one of its ancestors has display:none). Firefox returns null for getComputedStyle() if the element is in an iframe that has display:none. https://bugzilla.mozilla.org/show_bug.cgi?id=548397
    //browsers don't report transforms accurately unless the element is in the DOM and has a display value that's not "none". Firefox and Microsoft browsers have a partial bug where they'll report transforms even if display:none BUT not any percentage-based values like translate(-50%, 8px) will be reported as if it's translate(0, 8px).
    temp = style.display;
    style.display = "block";
    parent = target.parentNode;

    if (!parent || !target.offsetParent && !target.getBoundingClientRect().width) {
      // note: in 3.3.0 we switched target.offsetParent to _doc.body.contains(target) to avoid [sometimes unnecessary] MutationObserver calls but that wasn't adequate because there are edge cases where nested position: fixed elements need to get reparented to accurately sense transforms. See https://github.com/greensock/GSAP/issues/388 and https://github.com/greensock/GSAP/issues/375. Note: position: fixed elements report a null offsetParent but they could also be invisible because they're in an ancestor with display: none, so we check getBoundingClientRect(). We only want to alter the DOM if we absolutely have to because it can cause iframe content to reload, like a Vimeo video.
      addedToDOM = 1; //flag

      nextSibling = target.nextElementSibling;

      _docElement.appendChild(target); //we must add it to the DOM in order to get values properly

    }

    matrix = _getComputedTransformMatrixAsArray(target);
    temp ? style.display = temp : _removeProperty(target, "display");

    if (addedToDOM) {
      nextSibling ? parent.insertBefore(target, nextSibling) : parent ? parent.appendChild(target) : _docElement.removeChild(target);
    }
  }

  return force2D && matrix.length > 6 ? [matrix[0], matrix[1], matrix[4], matrix[5], matrix[12], matrix[13]] : matrix;
},
    _applySVGOrigin = function _applySVGOrigin(target, origin, originIsAbsolute, smooth, matrixArray, pluginToAddPropTweensTo) {
  var cache = target._gsap,
      matrix = matrixArray || _getMatrix(target, true),
      xOriginOld = cache.xOrigin || 0,
      yOriginOld = cache.yOrigin || 0,
      xOffsetOld = cache.xOffset || 0,
      yOffsetOld = cache.yOffset || 0,
      a = matrix[0],
      b = matrix[1],
      c = matrix[2],
      d = matrix[3],
      tx = matrix[4],
      ty = matrix[5],
      originSplit = origin.split(" "),
      xOrigin = parseFloat(originSplit[0]) || 0,
      yOrigin = parseFloat(originSplit[1]) || 0,
      bounds,
      determinant,
      x,
      y;

  if (!originIsAbsolute) {
    bounds = _getBBox(target);
    xOrigin = bounds.x + (~originSplit[0].indexOf("%") ? xOrigin / 100 * bounds.width : xOrigin);
    yOrigin = bounds.y + (~(originSplit[1] || originSplit[0]).indexOf("%") ? yOrigin / 100 * bounds.height : yOrigin); // if (!("xOrigin" in cache) && (xOrigin || yOrigin)) { // added in 3.12.3, reverted in 3.12.4; requires more exploration
    // 	xOrigin -= bounds.x;
    // 	yOrigin -= bounds.y;
    // }
  } else if (matrix !== _identity2DMatrix && (determinant = a * d - b * c)) {
    //if it's zero (like if scaleX and scaleY are zero), skip it to avoid errors with dividing by zero.
    x = xOrigin * (d / determinant) + yOrigin * (-c / determinant) + (c * ty - d * tx) / determinant;
    y = xOrigin * (-b / determinant) + yOrigin * (a / determinant) - (a * ty - b * tx) / determinant;
    xOrigin = x;
    yOrigin = y; // theory: we only had to do this for smoothing and it assumes that the previous one was not originIsAbsolute.
  }

  if (smooth || smooth !== false && cache.smooth) {
    tx = xOrigin - xOriginOld;
    ty = yOrigin - yOriginOld;
    cache.xOffset = xOffsetOld + (tx * a + ty * c) - tx;
    cache.yOffset = yOffsetOld + (tx * b + ty * d) - ty;
  } else {
    cache.xOffset = cache.yOffset = 0;
  }

  cache.xOrigin = xOrigin;
  cache.yOrigin = yOrigin;
  cache.smooth = !!smooth;
  cache.origin = origin;
  cache.originIsAbsolute = !!originIsAbsolute;
  target.style[_transformOriginProp] = "0px 0px"; //otherwise, if someone sets  an origin via CSS, it will likely interfere with the SVG transform attribute ones (because remember, we're baking the origin into the matrix() value).

  if (pluginToAddPropTweensTo) {
    _addNonTweeningPT(pluginToAddPropTweensTo, cache, "xOrigin", xOriginOld, xOrigin);

    _addNonTweeningPT(pluginToAddPropTweensTo, cache, "yOrigin", yOriginOld, yOrigin);

    _addNonTweeningPT(pluginToAddPropTweensTo, cache, "xOffset", xOffsetOld, cache.xOffset);

    _addNonTweeningPT(pluginToAddPropTweensTo, cache, "yOffset", yOffsetOld, cache.yOffset);
  }

  target.setAttribute("data-svg-origin", xOrigin + " " + yOrigin);
},
    _parseTransform = function _parseTransform(target, uncache) {
  var cache = target._gsap || new GSCache(target);

  if ("x" in cache && !uncache && !cache.uncache) {
    return cache;
  }

  var style = target.style,
      invertedScaleX = cache.scaleX < 0,
      px = "px",
      deg = "deg",
      cs = getComputedStyle(target),
      origin = _getComputedProperty(target, _transformOriginProp) || "0",
      x,
      y,
      z,
      scaleX,
      scaleY,
      rotation,
      rotationX,
      rotationY,
      skewX,
      skewY,
      perspective,
      xOrigin,
      yOrigin,
      matrix,
      angle,
      cos,
      sin,
      a,
      b,
      c,
      d,
      a12,
      a22,
      t1,
      t2,
      t3,
      a13,
      a23,
      a33,
      a42,
      a43,
      a32;
  x = y = z = rotation = rotationX = rotationY = skewX = skewY = perspective = 0;
  scaleX = scaleY = 1;
  cache.svg = !!(target.getCTM && _isSVG(target));

  if (cs.translate) {
    // accommodate independent transforms by combining them into normal ones.
    if (cs.translate !== "none" || cs.scale !== "none" || cs.rotate !== "none") {
      style[_transformProp$1] = (cs.translate !== "none" ? "translate3d(" + (cs.translate + " 0 0").split(" ").slice(0, 3).join(", ") + ") " : "") + (cs.rotate !== "none" ? "rotate(" + cs.rotate + ") " : "") + (cs.scale !== "none" ? "scale(" + cs.scale.split(" ").join(",") + ") " : "") + (cs[_transformProp$1] !== "none" ? cs[_transformProp$1] : "");
    }

    style.scale = style.rotate = style.translate = "none";
  }

  matrix = _getMatrix(target, cache.svg);

  if (cache.svg) {
    if (cache.uncache) {
      // if cache.uncache is true (and maybe if origin is 0,0), we need to set element.style.transformOrigin = (cache.xOrigin - bbox.x) + "px " + (cache.yOrigin - bbox.y) + "px". Previously we let the data-svg-origin stay instead, but when introducing revert(), it complicated things.
      t2 = target.getBBox();
      origin = cache.xOrigin - t2.x + "px " + (cache.yOrigin - t2.y) + "px";
      t1 = "";
    } else {
      t1 = !uncache && target.getAttribute("data-svg-origin"); //  Remember, to work around browser inconsistencies we always force SVG elements' transformOrigin to 0,0 and offset the translation accordingly.
    }

    _applySVGOrigin(target, t1 || origin, !!t1 || cache.originIsAbsolute, cache.smooth !== false, matrix);
  }

  xOrigin = cache.xOrigin || 0;
  yOrigin = cache.yOrigin || 0;

  if (matrix !== _identity2DMatrix) {
    a = matrix[0]; //a11

    b = matrix[1]; //a21

    c = matrix[2]; //a31

    d = matrix[3]; //a41

    x = a12 = matrix[4];
    y = a22 = matrix[5]; //2D matrix

    if (matrix.length === 6) {
      scaleX = Math.sqrt(a * a + b * b);
      scaleY = Math.sqrt(d * d + c * c);
      rotation = a || b ? _atan2(b, a) * _RAD2DEG : 0; //note: if scaleX is 0, we cannot accurately measure rotation. Same for skewX with a scaleY of 0. Therefore, we default to the previously recorded value (or zero if that doesn't exist).

      skewX = c || d ? _atan2(c, d) * _RAD2DEG + rotation : 0;
      skewX && (scaleY *= Math.abs(Math.cos(skewX * _DEG2RAD)));

      if (cache.svg) {
        x -= xOrigin - (xOrigin * a + yOrigin * c);
        y -= yOrigin - (xOrigin * b + yOrigin * d);
      } //3D matrix

    } else {
      a32 = matrix[6];
      a42 = matrix[7];
      a13 = matrix[8];
      a23 = matrix[9];
      a33 = matrix[10];
      a43 = matrix[11];
      x = matrix[12];
      y = matrix[13];
      z = matrix[14];
      angle = _atan2(a32, a33);
      rotationX = angle * _RAD2DEG; //rotationX

      if (angle) {
        cos = Math.cos(-angle);
        sin = Math.sin(-angle);
        t1 = a12 * cos + a13 * sin;
        t2 = a22 * cos + a23 * sin;
        t3 = a32 * cos + a33 * sin;
        a13 = a12 * -sin + a13 * cos;
        a23 = a22 * -sin + a23 * cos;
        a33 = a32 * -sin + a33 * cos;
        a43 = a42 * -sin + a43 * cos;
        a12 = t1;
        a22 = t2;
        a32 = t3;
      } //rotationY


      angle = _atan2(-c, a33);
      rotationY = angle * _RAD2DEG;

      if (angle) {
        cos = Math.cos(-angle);
        sin = Math.sin(-angle);
        t1 = a * cos - a13 * sin;
        t2 = b * cos - a23 * sin;
        t3 = c * cos - a33 * sin;
        a43 = d * sin + a43 * cos;
        a = t1;
        b = t2;
        c = t3;
      } //rotationZ


      angle = _atan2(b, a);
      rotation = angle * _RAD2DEG;

      if (angle) {
        cos = Math.cos(angle);
        sin = Math.sin(angle);
        t1 = a * cos + b * sin;
        t2 = a12 * cos + a22 * sin;
        b = b * cos - a * sin;
        a22 = a22 * cos - a12 * sin;
        a = t1;
        a12 = t2;
      }

      if (rotationX && Math.abs(rotationX) + Math.abs(rotation) > 359.9) {
        //when rotationY is set, it will often be parsed as 180 degrees different than it should be, and rotationX and rotation both being 180 (it looks the same), so we adjust for that here.
        rotationX = rotation = 0;
        rotationY = 180 - rotationY;
      }

      scaleX = _round$1(Math.sqrt(a * a + b * b + c * c));
      scaleY = _round$1(Math.sqrt(a22 * a22 + a32 * a32));
      angle = _atan2(a12, a22);
      skewX = Math.abs(angle) > 0.0002 ? angle * _RAD2DEG : 0;
      perspective = a43 ? 1 / (a43 < 0 ? -a43 : a43) : 0;
    }

    if (cache.svg) {
      //sense if there are CSS transforms applied on an SVG element in which case we must overwrite them when rendering. The transform attribute is more reliable cross-browser, but we can't just remove the CSS ones because they may be applied in a CSS rule somewhere (not just inline).
      t1 = target.getAttribute("transform");
      cache.forceCSS = target.setAttribute("transform", "") || !_isNullTransform(_getComputedProperty(target, _transformProp$1));
      t1 && target.setAttribute("transform", t1);
    }
  }

  if (Math.abs(skewX) > 90 && Math.abs(skewX) < 270) {
    if (invertedScaleX) {
      scaleX *= -1;
      skewX += rotation <= 0 ? 180 : -180;
      rotation += rotation <= 0 ? 180 : -180;
    } else {
      scaleY *= -1;
      skewX += skewX <= 0 ? 180 : -180;
    }
  }

  uncache = uncache || cache.uncache;
  cache.x = x - ((cache.xPercent = x && (!uncache && cache.xPercent || (Math.round(target.offsetWidth / 2) === Math.round(-x) ? -50 : 0))) ? target.offsetWidth * cache.xPercent / 100 : 0) + px;
  cache.y = y - ((cache.yPercent = y && (!uncache && cache.yPercent || (Math.round(target.offsetHeight / 2) === Math.round(-y) ? -50 : 0))) ? target.offsetHeight * cache.yPercent / 100 : 0) + px;
  cache.z = z + px;
  cache.scaleX = _round$1(scaleX);
  cache.scaleY = _round$1(scaleY);
  cache.rotation = _round$1(rotation) + deg;
  cache.rotationX = _round$1(rotationX) + deg;
  cache.rotationY = _round$1(rotationY) + deg;
  cache.skewX = skewX + deg;
  cache.skewY = skewY + deg;
  cache.transformPerspective = perspective + px;

  if (cache.zOrigin = parseFloat(origin.split(" ")[2]) || !uncache && cache.zOrigin || 0) {
    style[_transformOriginProp] = _firstTwoOnly(origin);
  }

  cache.xOffset = cache.yOffset = 0;
  cache.force3D = _config.force3D;
  cache.renderTransform = cache.svg ? _renderSVGTransforms : _supports3D ? _renderCSSTransforms : _renderNon3DTransforms;
  cache.uncache = 0;
  return cache;
},
    _firstTwoOnly = function _firstTwoOnly(value) {
  return (value = value.split(" "))[0] + " " + value[1];
},
    //for handling transformOrigin values, stripping out the 3rd dimension
_addPxTranslate = function _addPxTranslate(target, start, value) {
  var unit = getUnit(start);
  return _round$1(parseFloat(start) + parseFloat(_convertToUnit(target, "x", value + "px", unit))) + unit;
},
    _renderNon3DTransforms = function _renderNon3DTransforms(ratio, cache) {
  cache.z = "0px";
  cache.rotationY = cache.rotationX = "0deg";
  cache.force3D = 0;

  _renderCSSTransforms(ratio, cache);
},
    _zeroDeg = "0deg",
    _zeroPx = "0px",
    _endParenthesis = ") ",
    _renderCSSTransforms = function _renderCSSTransforms(ratio, cache) {
  var _ref = cache || this,
      xPercent = _ref.xPercent,
      yPercent = _ref.yPercent,
      x = _ref.x,
      y = _ref.y,
      z = _ref.z,
      rotation = _ref.rotation,
      rotationY = _ref.rotationY,
      rotationX = _ref.rotationX,
      skewX = _ref.skewX,
      skewY = _ref.skewY,
      scaleX = _ref.scaleX,
      scaleY = _ref.scaleY,
      transformPerspective = _ref.transformPerspective,
      force3D = _ref.force3D,
      target = _ref.target,
      zOrigin = _ref.zOrigin,
      transforms = "",
      use3D = force3D === "auto" && ratio && ratio !== 1 || force3D === true; // Safari has a bug that causes it not to render 3D transform-origin values properly, so we force the z origin to 0, record it in the cache, and then do the math here to offset the translate values accordingly (basically do the 3D transform-origin part manually)


  if (zOrigin && (rotationX !== _zeroDeg || rotationY !== _zeroDeg)) {
    var angle = parseFloat(rotationY) * _DEG2RAD,
        a13 = Math.sin(angle),
        a33 = Math.cos(angle),
        cos;

    angle = parseFloat(rotationX) * _DEG2RAD;
    cos = Math.cos(angle);
    x = _addPxTranslate(target, x, a13 * cos * -zOrigin);
    y = _addPxTranslate(target, y, -Math.sin(angle) * -zOrigin);
    z = _addPxTranslate(target, z, a33 * cos * -zOrigin + zOrigin);
  }

  if (transformPerspective !== _zeroPx) {
    transforms += "perspective(" + transformPerspective + _endParenthesis;
  }

  if (xPercent || yPercent) {
    transforms += "translate(" + xPercent + "%, " + yPercent + "%) ";
  }

  if (use3D || x !== _zeroPx || y !== _zeroPx || z !== _zeroPx) {
    transforms += z !== _zeroPx || use3D ? "translate3d(" + x + ", " + y + ", " + z + ") " : "translate(" + x + ", " + y + _endParenthesis;
  }

  if (rotation !== _zeroDeg) {
    transforms += "rotate(" + rotation + _endParenthesis;
  }

  if (rotationY !== _zeroDeg) {
    transforms += "rotateY(" + rotationY + _endParenthesis;
  }

  if (rotationX !== _zeroDeg) {
    transforms += "rotateX(" + rotationX + _endParenthesis;
  }

  if (skewX !== _zeroDeg || skewY !== _zeroDeg) {
    transforms += "skew(" + skewX + ", " + skewY + _endParenthesis;
  }

  if (scaleX !== 1 || scaleY !== 1) {
    transforms += "scale(" + scaleX + ", " + scaleY + _endParenthesis;
  }

  target.style[_transformProp$1] = transforms || "translate(0, 0)";
},
    _renderSVGTransforms = function _renderSVGTransforms(ratio, cache) {
  var _ref2 = cache || this,
      xPercent = _ref2.xPercent,
      yPercent = _ref2.yPercent,
      x = _ref2.x,
      y = _ref2.y,
      rotation = _ref2.rotation,
      skewX = _ref2.skewX,
      skewY = _ref2.skewY,
      scaleX = _ref2.scaleX,
      scaleY = _ref2.scaleY,
      target = _ref2.target,
      xOrigin = _ref2.xOrigin,
      yOrigin = _ref2.yOrigin,
      xOffset = _ref2.xOffset,
      yOffset = _ref2.yOffset,
      forceCSS = _ref2.forceCSS,
      tx = parseFloat(x),
      ty = parseFloat(y),
      a11,
      a21,
      a12,
      a22,
      temp;

  rotation = parseFloat(rotation);
  skewX = parseFloat(skewX);
  skewY = parseFloat(skewY);

  if (skewY) {
    //for performance reasons, we combine all skewing into the skewX and rotation values. Remember, a skewY of 10 degrees looks the same as a rotation of 10 degrees plus a skewX of 10 degrees.
    skewY = parseFloat(skewY);
    skewX += skewY;
    rotation += skewY;
  }

  if (rotation || skewX) {
    rotation *= _DEG2RAD;
    skewX *= _DEG2RAD;
    a11 = Math.cos(rotation) * scaleX;
    a21 = Math.sin(rotation) * scaleX;
    a12 = Math.sin(rotation - skewX) * -scaleY;
    a22 = Math.cos(rotation - skewX) * scaleY;

    if (skewX) {
      skewY *= _DEG2RAD;
      temp = Math.tan(skewX - skewY);
      temp = Math.sqrt(1 + temp * temp);
      a12 *= temp;
      a22 *= temp;

      if (skewY) {
        temp = Math.tan(skewY);
        temp = Math.sqrt(1 + temp * temp);
        a11 *= temp;
        a21 *= temp;
      }
    }

    a11 = _round$1(a11);
    a21 = _round$1(a21);
    a12 = _round$1(a12);
    a22 = _round$1(a22);
  } else {
    a11 = scaleX;
    a22 = scaleY;
    a21 = a12 = 0;
  }

  if (tx && !~(x + "").indexOf("px") || ty && !~(y + "").indexOf("px")) {
    tx = _convertToUnit(target, "x", x, "px");
    ty = _convertToUnit(target, "y", y, "px");
  }

  if (xOrigin || yOrigin || xOffset || yOffset) {
    tx = _round$1(tx + xOrigin - (xOrigin * a11 + yOrigin * a12) + xOffset);
    ty = _round$1(ty + yOrigin - (xOrigin * a21 + yOrigin * a22) + yOffset);
  }

  if (xPercent || yPercent) {
    //The SVG spec doesn't support percentage-based translation in the "transform" attribute, so we merge it into the translation to simulate it.
    temp = target.getBBox();
    tx = _round$1(tx + xPercent / 100 * temp.width);
    ty = _round$1(ty + yPercent / 100 * temp.height);
  }

  temp = "matrix(" + a11 + "," + a21 + "," + a12 + "," + a22 + "," + tx + "," + ty + ")";
  target.setAttribute("transform", temp);
  forceCSS && (target.style[_transformProp$1] = temp); //some browsers prioritize CSS transforms over the transform attribute. When we sense that the user has CSS transforms applied, we must overwrite them this way (otherwise some browser simply won't render the transform attribute changes!)
},
    _addRotationalPropTween = function _addRotationalPropTween(plugin, target, property, startNum, endValue) {
  var cap = 360,
      isString = _isString$1(endValue),
      endNum = parseFloat(endValue) * (isString && ~endValue.indexOf("rad") ? _RAD2DEG : 1),
      change = endNum - startNum,
      finalValue = startNum + change + "deg",
      direction,
      pt;

  if (isString) {
    direction = endValue.split("_")[1];

    if (direction === "short") {
      change %= cap;

      if (change !== change % (cap / 2)) {
        change += change < 0 ? cap : -cap;
      }
    }

    if (direction === "cw" && change < 0) {
      change = (change + cap * _bigNum) % cap - ~~(change / cap) * cap;
    } else if (direction === "ccw" && change > 0) {
      change = (change - cap * _bigNum) % cap - ~~(change / cap) * cap;
    }
  }

  plugin._pt = pt = new PropTween(plugin._pt, target, property, startNum, change, _renderPropWithEnd);
  pt.e = finalValue;
  pt.u = "deg";

  plugin._props.push(property);

  return pt;
},
    _assign = function _assign(target, source) {
  // Internet Explorer doesn't have Object.assign(), so we recreate it here.
  for (var p in source) {
    target[p] = source[p];
  }

  return target;
},
    _addRawTransformPTs = function _addRawTransformPTs(plugin, transforms, target) {
  //for handling cases where someone passes in a whole transform string, like transform: "scale(2, 3) rotate(20deg) translateY(30em)"
  var startCache = _assign({}, target._gsap),
      exclude = "perspective,force3D,transformOrigin,svgOrigin",
      style = target.style,
      endCache,
      p,
      startValue,
      endValue,
      startNum,
      endNum,
      startUnit,
      endUnit;

  if (startCache.svg) {
    startValue = target.getAttribute("transform");
    target.setAttribute("transform", "");
    style[_transformProp$1] = transforms;
    endCache = _parseTransform(target, 1);

    _removeProperty(target, _transformProp$1);

    target.setAttribute("transform", startValue);
  } else {
    startValue = getComputedStyle(target)[_transformProp$1];
    style[_transformProp$1] = transforms;
    endCache = _parseTransform(target, 1);
    style[_transformProp$1] = startValue;
  }

  for (p in _transformProps) {
    startValue = startCache[p];
    endValue = endCache[p];

    if (startValue !== endValue && exclude.indexOf(p) < 0) {
      //tweening to no perspective gives very unintuitive results - just keep the same perspective in that case.
      startUnit = getUnit(startValue);
      endUnit = getUnit(endValue);
      startNum = startUnit !== endUnit ? _convertToUnit(target, p, startValue, endUnit) : parseFloat(startValue);
      endNum = parseFloat(endValue);
      plugin._pt = new PropTween(plugin._pt, endCache, p, startNum, endNum - startNum, _renderCSSProp);
      plugin._pt.u = endUnit || 0;

      plugin._props.push(p);
    }
  }

  _assign(endCache, startCache);
}; // handle splitting apart padding, margin, borderWidth, and borderRadius into their 4 components. Firefox, for example, won't report borderRadius correctly - it will only do borderTopLeftRadius and the other corners. We also want to handle paddingTop, marginLeft, borderRightWidth, etc.


_forEachName("padding,margin,Width,Radius", function (name, index) {
  var t = "Top",
      r = "Right",
      b = "Bottom",
      l = "Left",
      props = (index < 3 ? [t, r, b, l] : [t + l, t + r, b + r, b + l]).map(function (side) {
    return index < 2 ? name + side : "border" + side + name;
  });

  _specialProps[index > 1 ? "border" + name : name] = function (plugin, target, property, endValue, tween) {
    var a, vars;

    if (arguments.length < 4) {
      // getter, passed target, property, and unit (from _get())
      a = props.map(function (prop) {
        return _get(plugin, prop, property);
      });
      vars = a.join(" ");
      return vars.split(a[0]).length === 5 ? a[0] : vars;
    }

    a = (endValue + "").split(" ");
    vars = {};
    props.forEach(function (prop, i) {
      return vars[prop] = a[i] = a[i] || a[(i - 1) / 2 | 0];
    });
    plugin.init(target, vars, tween);
  };
});

var CSSPlugin = {
  name: "css",
  register: _initCore$1,
  targetTest: function targetTest(target) {
    return target.style && target.nodeType;
  },
  init: function init(target, vars, tween, index, targets) {
    var props = this._props,
        style = target.style,
        startAt = tween.vars.startAt,
        startValue,
        endValue,
        endNum,
        startNum,
        type,
        specialProp,
        p,
        startUnit,
        endUnit,
        relative,
        isTransformRelated,
        transformPropTween,
        cache,
        smooth,
        hasPriority,
        inlineProps;
    _pluginInitted || _initCore$1(); // we may call init() multiple times on the same plugin instance, like when adding special properties, so make sure we don't overwrite the revert data or inlineProps

    this.styles = this.styles || _getStyleSaver(target);
    inlineProps = this.styles.props;
    this.tween = tween;

    for (p in vars) {
      if (p === "autoRound") {
        continue;
      }

      endValue = vars[p];

      if (_plugins[p] && _checkPlugin(p, vars, tween, index, target, targets)) {
        // plugins
        continue;
      }

      type = typeof endValue;
      specialProp = _specialProps[p];

      if (type === "function") {
        endValue = endValue.call(tween, index, target, targets);
        type = typeof endValue;
      }

      if (type === "string" && ~endValue.indexOf("random(")) {
        endValue = _replaceRandom(endValue);
      }

      if (specialProp) {
        specialProp(this, target, p, endValue, tween) && (hasPriority = 1);
      } else if (p.substr(0, 2) === "--") {
        //CSS variable
        startValue = (getComputedStyle(target).getPropertyValue(p) + "").trim();
        endValue += "";
        _colorExp.lastIndex = 0;

        if (!_colorExp.test(startValue)) {
          // colors don't have units
          startUnit = getUnit(startValue);
          endUnit = getUnit(endValue);
        }

        endUnit ? startUnit !== endUnit && (startValue = _convertToUnit(target, p, startValue, endUnit) + endUnit) : startUnit && (endValue += startUnit);
        this.add(style, "setProperty", startValue, endValue, index, targets, 0, 0, p);
        props.push(p);
        inlineProps.push(p, 0, style[p]);
      } else if (type !== "undefined") {
        if (startAt && p in startAt) {
          // in case someone hard-codes a complex value as the start, like top: "calc(2vh / 2)". Without this, it'd use the computed value (always in px)
          startValue = typeof startAt[p] === "function" ? startAt[p].call(tween, index, target, targets) : startAt[p];
          _isString$1(startValue) && ~startValue.indexOf("random(") && (startValue = _replaceRandom(startValue));
          getUnit(startValue + "") || startValue === "auto" || (startValue += _config.units[p] || getUnit(_get(target, p)) || ""); // for cases when someone passes in a unitless value like {x: 100}; if we try setting translate(100, 0px) it won't work.

          (startValue + "").charAt(1) === "=" && (startValue = _get(target, p)); // can't work with relative values
        } else {
          startValue = _get(target, p);
        }

        startNum = parseFloat(startValue);
        relative = type === "string" && endValue.charAt(1) === "=" && endValue.substr(0, 2);
        relative && (endValue = endValue.substr(2));
        endNum = parseFloat(endValue);

        if (p in _propertyAliases) {
          if (p === "autoAlpha") {
            //special case where we control the visibility along with opacity. We still allow the opacity value to pass through and get tweened.
            if (startNum === 1 && _get(target, "visibility") === "hidden" && endNum) {
              //if visibility is initially set to "hidden", we should interpret that as intent to make opacity 0 (a convenience)
              startNum = 0;
            }

            inlineProps.push("visibility", 0, style.visibility);

            _addNonTweeningPT(this, style, "visibility", startNum ? "inherit" : "hidden", endNum ? "inherit" : "hidden", !endNum);
          }

          if (p !== "scale" && p !== "transform") {
            p = _propertyAliases[p];
            ~p.indexOf(",") && (p = p.split(",")[0]);
          }
        }

        isTransformRelated = p in _transformProps; //--- TRANSFORM-RELATED ---

        if (isTransformRelated) {
          this.styles.save(p);

          if (type === "string" && endValue.substring(0, 6) === "var(--") {
            endValue = _getComputedProperty(target, endValue.substring(4, endValue.indexOf(")")));
            endNum = parseFloat(endValue);
          }

          if (!transformPropTween) {
            cache = target._gsap;
            cache.renderTransform && !vars.parseTransform || _parseTransform(target, vars.parseTransform); // if, for example, gsap.set(... {transform:"translateX(50vw)"}), the _get() call doesn't parse the transform, thus cache.renderTransform won't be set yet so force the parsing of the transform here.

            smooth = vars.smoothOrigin !== false && cache.smooth;
            transformPropTween = this._pt = new PropTween(this._pt, style, _transformProp$1, 0, 1, cache.renderTransform, cache, 0, -1); //the first time through, create the rendering PropTween so that it runs LAST (in the linked list, we keep adding to the beginning)

            transformPropTween.dep = 1; //flag it as dependent so that if things get killed/overwritten and this is the only PropTween left, we can safely kill the whole tween.
          }

          if (p === "scale") {
            this._pt = new PropTween(this._pt, cache, "scaleY", cache.scaleY, (relative ? _parseRelative(cache.scaleY, relative + endNum) : endNum) - cache.scaleY || 0, _renderCSSProp);
            this._pt.u = 0;
            props.push("scaleY", p);
            p += "X";
          } else if (p === "transformOrigin") {
            inlineProps.push(_transformOriginProp, 0, style[_transformOriginProp]);
            endValue = _convertKeywordsToPercentages(endValue); //in case something like "left top" or "bottom right" is passed in. Convert to percentages.

            if (cache.svg) {
              _applySVGOrigin(target, endValue, 0, smooth, 0, this);
            } else {
              endUnit = parseFloat(endValue.split(" ")[2]) || 0; //handle the zOrigin separately!

              endUnit !== cache.zOrigin && _addNonTweeningPT(this, cache, "zOrigin", cache.zOrigin, endUnit);

              _addNonTweeningPT(this, style, p, _firstTwoOnly(startValue), _firstTwoOnly(endValue));
            }

            continue;
          } else if (p === "svgOrigin") {
            _applySVGOrigin(target, endValue, 1, smooth, 0, this);

            continue;
          } else if (p in _rotationalProperties) {
            _addRotationalPropTween(this, cache, p, startNum, relative ? _parseRelative(startNum, relative + endValue) : endValue);

            continue;
          } else if (p === "smoothOrigin") {
            _addNonTweeningPT(this, cache, "smooth", cache.smooth, endValue);

            continue;
          } else if (p === "force3D") {
            cache[p] = endValue;
            continue;
          } else if (p === "transform") {
            _addRawTransformPTs(this, endValue, target);

            continue;
          }
        } else if (!(p in style)) {
          p = _checkPropPrefix(p) || p;
        }

        if (isTransformRelated || (endNum || endNum === 0) && (startNum || startNum === 0) && !_complexExp.test(endValue) && p in style) {
          startUnit = (startValue + "").substr((startNum + "").length);
          endNum || (endNum = 0); // protect against NaN

          endUnit = getUnit(endValue) || (p in _config.units ? _config.units[p] : startUnit);
          startUnit !== endUnit && (startNum = _convertToUnit(target, p, startValue, endUnit));
          this._pt = new PropTween(this._pt, isTransformRelated ? cache : style, p, startNum, (relative ? _parseRelative(startNum, relative + endNum) : endNum) - startNum, !isTransformRelated && (endUnit === "px" || p === "zIndex") && vars.autoRound !== false ? _renderRoundedCSSProp : _renderCSSProp);
          this._pt.u = endUnit || 0;

          if (startUnit !== endUnit && endUnit !== "%") {
            //when the tween goes all the way back to the beginning, we need to revert it to the OLD/ORIGINAL value (with those units). We record that as a "b" (beginning) property and point to a render method that handles that. (performance optimization)
            this._pt.b = startValue;
            this._pt.r = _renderCSSPropWithBeginning;
          }
        } else if (!(p in style)) {
          if (p in target) {
            //maybe it's not a style - it could be a property added directly to an element in which case we'll try to animate that.
            this.add(target, p, startValue || target[p], relative ? relative + endValue : endValue, index, targets);
          } else if (p !== "parseTransform") {
            _missingPlugin(p, endValue);

            continue;
          }
        } else {
          _tweenComplexCSSString.call(this, target, p, startValue, relative ? relative + endValue : endValue);
        }

        isTransformRelated || (p in style ? inlineProps.push(p, 0, style[p]) : typeof target[p] === "function" ? inlineProps.push(p, 2, target[p]()) : inlineProps.push(p, 1, startValue || target[p]));
        props.push(p);
      }
    }

    hasPriority && _sortPropTweensByPriority(this);
  },
  render: function render(ratio, data) {
    if (data.tween._time || !_reverting()) {
      var pt = data._pt;

      while (pt) {
        pt.r(ratio, pt.d);
        pt = pt._next;
      }
    } else {
      data.styles.revert();
    }
  },
  get: _get,
  aliases: _propertyAliases,
  getSetter: function getSetter(target, property, plugin) {
    //returns a setter function that accepts target, property, value and applies it accordingly. Remember, properties like "x" aren't as simple as target.style.property = value because they've got to be applied to a proxy object and then merged into a transform string in a renderer.
    var p = _propertyAliases[property];
    p && p.indexOf(",") < 0 && (property = p);
    return property in _transformProps && property !== _transformOriginProp && (target._gsap.x || _get(target, "x")) ? plugin && _recentSetterPlugin === plugin ? property === "scale" ? _setterScale : _setterTransform : (_recentSetterPlugin = plugin || {}) && (property === "scale" ? _setterScaleWithRender : _setterTransformWithRender) : target.style && !_isUndefined(target.style[property]) ? _setterCSSStyle : ~property.indexOf("-") ? _setterCSSProp : _getSetter(target, property);
  },
  core: {
    _removeProperty: _removeProperty,
    _getMatrix: _getMatrix
  }
};
gsap$2.utils.checkPrefix = _checkPropPrefix;
gsap$2.core.getStyleSaver = _getStyleSaver;

(function (positionAndScale, rotation, others, aliases) {
  var all = _forEachName(positionAndScale + "," + rotation + "," + others, function (name) {
    _transformProps[name] = 1;
  });

  _forEachName(rotation, function (name) {
    _config.units[name] = "deg";
    _rotationalProperties[name] = 1;
  });

  _propertyAliases[all[13]] = positionAndScale + "," + rotation;

  _forEachName(aliases, function (name) {
    var split = name.split(":");
    _propertyAliases[split[1]] = all[split[0]];
  });
})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent", "rotation,rotationX,rotationY,skewX,skewY", "transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective", "0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");

_forEachName("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective", function (name) {
  _config.units[name] = "px";
});

gsap$2.registerPlugin(CSSPlugin);

var gsapWithCSS = gsap$2.registerPlugin(CSSPlugin) || gsap$2;
    // to protect from tree shaking
gsapWithCSS.core.Tween;

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}
function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  return Constructor;
}
/*!
 * Observer 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/
var gsap$1, _coreInitted$1, _win$1, _doc$1, _docEl$1, _body$1, _isTouch, _pointerType, ScrollTrigger$1, _root$1, _normalizer$1, _eventTypes, _context$1, _getGSAP$1 = function _getGSAP2() {
  return gsap$1 || typeof window !== "undefined" && (gsap$1 = window.gsap) && gsap$1.registerPlugin && gsap$1;
}, _startup$1 = 1, _observers = [], _scrollers = [], _proxies = [], _getTime$1 = Date.now, _bridge = function _bridge2(name, value) {
  return value;
}, _integrate = function _integrate2() {
  var core = ScrollTrigger$1.core, data = core.bridge || {}, scrollers = core._scrollers, proxies = core._proxies;
  scrollers.push.apply(scrollers, _scrollers);
  proxies.push.apply(proxies, _proxies);
  _scrollers = scrollers;
  _proxies = proxies;
  _bridge = function _bridge3(name, value) {
    return data[name](value);
  };
}, _getProxyProp = function _getProxyProp2(element, property) {
  return ~_proxies.indexOf(element) && _proxies[_proxies.indexOf(element) + 1][property];
}, _isViewport$1 = function _isViewport2(el) {
  return !!~_root$1.indexOf(el);
}, _addListener$1 = function _addListener2(element, type, func, passive, capture) {
  return element.addEventListener(type, func, {
    passive: passive !== false,
    capture: !!capture
  });
}, _removeListener$1 = function _removeListener2(element, type, func, capture) {
  return element.removeEventListener(type, func, !!capture);
}, _scrollLeft = "scrollLeft", _scrollTop = "scrollTop", _onScroll$1 = function _onScroll2() {
  return _normalizer$1 && _normalizer$1.isPressed || _scrollers.cache++;
}, _scrollCacheFunc = function _scrollCacheFunc2(f, doNotCache) {
  var cachingFunc = function cachingFunc2(value) {
    if (value || value === 0) {
      _startup$1 && (_win$1.history.scrollRestoration = "manual");
      var isNormalizing = _normalizer$1 && _normalizer$1.isPressed;
      value = cachingFunc2.v = Math.round(value) || (_normalizer$1 && _normalizer$1.iOS ? 1 : 0);
      f(value);
      cachingFunc2.cacheID = _scrollers.cache;
      isNormalizing && _bridge("ss", value);
    } else if (doNotCache || _scrollers.cache !== cachingFunc2.cacheID || _bridge("ref")) {
      cachingFunc2.cacheID = _scrollers.cache;
      cachingFunc2.v = f();
    }
    return cachingFunc2.v + cachingFunc2.offset;
  };
  cachingFunc.offset = 0;
  return f && cachingFunc;
}, _horizontal = {
  s: _scrollLeft,
  p: "left",
  p2: "Left",
  os: "right",
  os2: "Right",
  d: "width",
  d2: "Width",
  a: "x",
  sc: _scrollCacheFunc(function(value) {
    return arguments.length ? _win$1.scrollTo(value, _vertical.sc()) : _win$1.pageXOffset || _doc$1[_scrollLeft] || _docEl$1[_scrollLeft] || _body$1[_scrollLeft] || 0;
  })
}, _vertical = {
  s: _scrollTop,
  p: "top",
  p2: "Top",
  os: "bottom",
  os2: "Bottom",
  d: "height",
  d2: "Height",
  a: "y",
  op: _horizontal,
  sc: _scrollCacheFunc(function(value) {
    return arguments.length ? _win$1.scrollTo(_horizontal.sc(), value) : _win$1.pageYOffset || _doc$1[_scrollTop] || _docEl$1[_scrollTop] || _body$1[_scrollTop] || 0;
  })
}, _getTarget = function _getTarget2(t, self) {
  return (self && self._ctx && self._ctx.selector || gsap$1.utils.toArray)(t)[0] || (typeof t === "string" && gsap$1.config().nullTargetWarn !== false ? console.warn("Element not found:", t) : null);
}, _isWithin = function _isWithin2(element, list) {
  var i = list.length;
  while (i--) {
    if (list[i] === element || list[i].contains(element)) {
      return true;
    }
  }
  return false;
}, _getScrollFunc = function _getScrollFunc2(element, _ref) {
  var s = _ref.s, sc = _ref.sc;
  _isViewport$1(element) && (element = _doc$1.scrollingElement || _docEl$1);
  var i = _scrollers.indexOf(element), offset = sc === _vertical.sc ? 1 : 2;
  !~i && (i = _scrollers.push(element) - 1);
  _scrollers[i + offset] || _addListener$1(element, "scroll", _onScroll$1);
  var prev = _scrollers[i + offset], func = prev || (_scrollers[i + offset] = _scrollCacheFunc(_getProxyProp(element, s), true) || (_isViewport$1(element) ? sc : _scrollCacheFunc(function(value) {
    return arguments.length ? element[s] = value : element[s];
  })));
  func.target = element;
  prev || (func.smooth = gsap$1.getProperty(element, "scrollBehavior") === "smooth");
  return func;
}, _getVelocityProp = function _getVelocityProp2(value, minTimeRefresh, useDelta) {
  var v1 = value, v2 = value, t1 = _getTime$1(), t2 = t1, min = minTimeRefresh || 50, dropToZeroTime = Math.max(500, min * 3), update = function update2(value2, force) {
    var t = _getTime$1();
    if (force || t - t1 > min) {
      v2 = v1;
      v1 = value2;
      t2 = t1;
      t1 = t;
    } else if (useDelta) {
      v1 += value2;
    } else {
      v1 = v2 + (value2 - v2) / (t - t2) * (t1 - t2);
    }
  }, reset = function reset2() {
    v2 = v1 = useDelta ? 0 : v1;
    t2 = t1 = 0;
  }, getVelocity = function getVelocity2(latestValue) {
    var tOld = t2, vOld = v2, t = _getTime$1();
    (latestValue || latestValue === 0) && latestValue !== v1 && update(latestValue);
    return t1 === t2 || t - t2 > dropToZeroTime ? 0 : (v1 + (useDelta ? vOld : -vOld)) / ((useDelta ? t : t1) - tOld) * 1e3;
  };
  return {
    update,
    reset,
    getVelocity
  };
}, _getEvent = function _getEvent2(e, preventDefault) {
  preventDefault && !e._gsapAllow && e.preventDefault();
  return e.changedTouches ? e.changedTouches[0] : e;
}, _getAbsoluteMax = function _getAbsoluteMax2(a) {
  var max = Math.max.apply(Math, a), min = Math.min.apply(Math, a);
  return Math.abs(max) >= Math.abs(min) ? max : min;
}, _setScrollTrigger = function _setScrollTrigger2() {
  ScrollTrigger$1 = gsap$1.core.globals().ScrollTrigger;
  ScrollTrigger$1 && ScrollTrigger$1.core && _integrate();
}, _initCore = function _initCore2(core) {
  gsap$1 = core || _getGSAP$1();
  if (!_coreInitted$1 && gsap$1 && typeof document !== "undefined" && document.body) {
    _win$1 = window;
    _doc$1 = document;
    _docEl$1 = _doc$1.documentElement;
    _body$1 = _doc$1.body;
    _root$1 = [_win$1, _doc$1, _docEl$1, _body$1];
    gsap$1.utils.clamp;
    _context$1 = gsap$1.core.context || function() {
    };
    _pointerType = "onpointerenter" in _body$1 ? "pointer" : "mouse";
    _isTouch = Observer.isTouch = _win$1.matchMedia && _win$1.matchMedia("(hover: none), (pointer: coarse)").matches ? 1 : "ontouchstart" in _win$1 || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0 ? 2 : 0;
    _eventTypes = Observer.eventTypes = ("ontouchstart" in _docEl$1 ? "touchstart,touchmove,touchcancel,touchend" : !("onpointerdown" in _docEl$1) ? "mousedown,mousemove,mouseup,mouseup" : "pointerdown,pointermove,pointercancel,pointerup").split(",");
    setTimeout(function() {
      return _startup$1 = 0;
    }, 500);
    _setScrollTrigger();
    _coreInitted$1 = 1;
  }
  return _coreInitted$1;
};
_horizontal.op = _vertical;
_scrollers.cache = 0;
var Observer = /* @__PURE__ */ function() {
  function Observer2(vars) {
    this.init(vars);
  }
  var _proto = Observer2.prototype;
  _proto.init = function init(vars) {
    _coreInitted$1 || _initCore(gsap$1) || console.warn("Please gsap.registerPlugin(Observer)");
    ScrollTrigger$1 || _setScrollTrigger();
    var tolerance = vars.tolerance, dragMinimum = vars.dragMinimum, type = vars.type, target = vars.target, lineHeight = vars.lineHeight, debounce = vars.debounce, preventDefault = vars.preventDefault, onStop = vars.onStop, onStopDelay = vars.onStopDelay, ignore = vars.ignore, wheelSpeed = vars.wheelSpeed, event = vars.event, onDragStart = vars.onDragStart, onDragEnd = vars.onDragEnd, onDrag = vars.onDrag, onPress = vars.onPress, onRelease = vars.onRelease, onRight = vars.onRight, onLeft = vars.onLeft, onUp = vars.onUp, onDown = vars.onDown, onChangeX = vars.onChangeX, onChangeY = vars.onChangeY, onChange = vars.onChange, onToggleX = vars.onToggleX, onToggleY = vars.onToggleY, onHover = vars.onHover, onHoverEnd = vars.onHoverEnd, onMove = vars.onMove, ignoreCheck = vars.ignoreCheck, isNormalizer = vars.isNormalizer, onGestureStart = vars.onGestureStart, onGestureEnd = vars.onGestureEnd, onWheel = vars.onWheel, onEnable = vars.onEnable, onDisable = vars.onDisable, onClick = vars.onClick, scrollSpeed = vars.scrollSpeed, capture = vars.capture, allowClicks = vars.allowClicks, lockAxis = vars.lockAxis, onLockAxis = vars.onLockAxis;
    this.target = target = _getTarget(target) || _docEl$1;
    this.vars = vars;
    ignore && (ignore = gsap$1.utils.toArray(ignore));
    tolerance = tolerance || 1e-9;
    dragMinimum = dragMinimum || 0;
    wheelSpeed = wheelSpeed || 1;
    scrollSpeed = scrollSpeed || 1;
    type = type || "wheel,touch,pointer";
    debounce = debounce !== false;
    lineHeight || (lineHeight = parseFloat(_win$1.getComputedStyle(_body$1).lineHeight) || 22);
    var id, onStopDelayedCall, dragged, moved, wheeled, locked, axis, self = this, prevDeltaX = 0, prevDeltaY = 0, passive = vars.passive || !preventDefault && vars.passive !== false, scrollFuncX = _getScrollFunc(target, _horizontal), scrollFuncY = _getScrollFunc(target, _vertical), scrollX = scrollFuncX(), scrollY = scrollFuncY(), limitToTouch = ~type.indexOf("touch") && !~type.indexOf("pointer") && _eventTypes[0] === "pointerdown", isViewport = _isViewport$1(target), ownerDoc = target.ownerDocument || _doc$1, deltaX = [0, 0, 0], deltaY = [0, 0, 0], onClickTime = 0, clickCapture = function clickCapture2() {
      return onClickTime = _getTime$1();
    }, _ignoreCheck = function _ignoreCheck2(e, isPointerOrTouch) {
      return (self.event = e) && ignore && _isWithin(e.target, ignore) || isPointerOrTouch && limitToTouch && e.pointerType !== "touch" || ignoreCheck && ignoreCheck(e, isPointerOrTouch);
    }, onStopFunc = function onStopFunc2() {
      self._vx.reset();
      self._vy.reset();
      onStopDelayedCall.pause();
      onStop && onStop(self);
    }, update = function update2() {
      var dx = self.deltaX = _getAbsoluteMax(deltaX), dy = self.deltaY = _getAbsoluteMax(deltaY), changedX = Math.abs(dx) >= tolerance, changedY = Math.abs(dy) >= tolerance;
      onChange && (changedX || changedY) && onChange(self, dx, dy, deltaX, deltaY);
      if (changedX) {
        onRight && self.deltaX > 0 && onRight(self);
        onLeft && self.deltaX < 0 && onLeft(self);
        onChangeX && onChangeX(self);
        onToggleX && self.deltaX < 0 !== prevDeltaX < 0 && onToggleX(self);
        prevDeltaX = self.deltaX;
        deltaX[0] = deltaX[1] = deltaX[2] = 0;
      }
      if (changedY) {
        onDown && self.deltaY > 0 && onDown(self);
        onUp && self.deltaY < 0 && onUp(self);
        onChangeY && onChangeY(self);
        onToggleY && self.deltaY < 0 !== prevDeltaY < 0 && onToggleY(self);
        prevDeltaY = self.deltaY;
        deltaY[0] = deltaY[1] = deltaY[2] = 0;
      }
      if (moved || dragged) {
        onMove && onMove(self);
        if (dragged) {
          onDragStart && dragged === 1 && onDragStart(self);
          onDrag && onDrag(self);
          dragged = 0;
        }
        moved = false;
      }
      locked && !(locked = false) && onLockAxis && onLockAxis(self);
      if (wheeled) {
        onWheel(self);
        wheeled = false;
      }
      id = 0;
    }, onDelta = function onDelta2(x, y, index) {
      deltaX[index] += x;
      deltaY[index] += y;
      self._vx.update(x);
      self._vy.update(y);
      debounce ? id || (id = requestAnimationFrame(update)) : update();
    }, onTouchOrPointerDelta = function onTouchOrPointerDelta2(x, y) {
      if (lockAxis && !axis) {
        self.axis = axis = Math.abs(x) > Math.abs(y) ? "x" : "y";
        locked = true;
      }
      if (axis !== "y") {
        deltaX[2] += x;
        self._vx.update(x, true);
      }
      if (axis !== "x") {
        deltaY[2] += y;
        self._vy.update(y, true);
      }
      debounce ? id || (id = requestAnimationFrame(update)) : update();
    }, _onDrag = function _onDrag2(e) {
      if (_ignoreCheck(e, 1)) {
        return;
      }
      e = _getEvent(e, preventDefault);
      var x = e.clientX, y = e.clientY, dx = x - self.x, dy = y - self.y, isDragging = self.isDragging;
      self.x = x;
      self.y = y;
      if (isDragging || (dx || dy) && (Math.abs(self.startX - x) >= dragMinimum || Math.abs(self.startY - y) >= dragMinimum)) {
        dragged = isDragging ? 2 : 1;
        isDragging || (self.isDragging = true);
        onTouchOrPointerDelta(dx, dy);
      }
    }, _onPress = self.onPress = function(e) {
      if (_ignoreCheck(e, 1) || e && e.button) {
        return;
      }
      self.axis = axis = null;
      onStopDelayedCall.pause();
      self.isPressed = true;
      e = _getEvent(e);
      prevDeltaX = prevDeltaY = 0;
      self.startX = self.x = e.clientX;
      self.startY = self.y = e.clientY;
      self._vx.reset();
      self._vy.reset();
      _addListener$1(isNormalizer ? target : ownerDoc, _eventTypes[1], _onDrag, passive, true);
      self.deltaX = self.deltaY = 0;
      onPress && onPress(self);
    }, _onRelease = self.onRelease = function(e) {
      if (_ignoreCheck(e, 1)) {
        return;
      }
      _removeListener$1(isNormalizer ? target : ownerDoc, _eventTypes[1], _onDrag, true);
      var isTrackingDrag = !isNaN(self.y - self.startY), wasDragging = self.isDragging, isDragNotClick = wasDragging && (Math.abs(self.x - self.startX) > 3 || Math.abs(self.y - self.startY) > 3), eventData = _getEvent(e);
      if (!isDragNotClick && isTrackingDrag) {
        self._vx.reset();
        self._vy.reset();
        if (preventDefault && allowClicks) {
          gsap$1.delayedCall(0.08, function() {
            if (_getTime$1() - onClickTime > 300 && !e.defaultPrevented) {
              if (e.target.click) {
                e.target.click();
              } else if (ownerDoc.createEvent) {
                var syntheticEvent = ownerDoc.createEvent("MouseEvents");
                syntheticEvent.initMouseEvent("click", true, true, _win$1, 1, eventData.screenX, eventData.screenY, eventData.clientX, eventData.clientY, false, false, false, false, 0, null);
                e.target.dispatchEvent(syntheticEvent);
              }
            }
          });
        }
      }
      self.isDragging = self.isGesturing = self.isPressed = false;
      onStop && wasDragging && !isNormalizer && onStopDelayedCall.restart(true);
      dragged && update();
      onDragEnd && wasDragging && onDragEnd(self);
      onRelease && onRelease(self, isDragNotClick);
    }, _onGestureStart = function _onGestureStart2(e) {
      return e.touches && e.touches.length > 1 && (self.isGesturing = true) && onGestureStart(e, self.isDragging);
    }, _onGestureEnd = function _onGestureEnd2() {
      return (self.isGesturing = false) || onGestureEnd(self);
    }, onScroll = function onScroll2(e) {
      if (_ignoreCheck(e)) {
        return;
      }
      var x = scrollFuncX(), y = scrollFuncY();
      onDelta((x - scrollX) * scrollSpeed, (y - scrollY) * scrollSpeed, 1);
      scrollX = x;
      scrollY = y;
      onStop && onStopDelayedCall.restart(true);
    }, _onWheel = function _onWheel2(e) {
      if (_ignoreCheck(e)) {
        return;
      }
      e = _getEvent(e, preventDefault);
      onWheel && (wheeled = true);
      var multiplier = (e.deltaMode === 1 ? lineHeight : e.deltaMode === 2 ? _win$1.innerHeight : 1) * wheelSpeed;
      onDelta(e.deltaX * multiplier, e.deltaY * multiplier, 0);
      onStop && !isNormalizer && onStopDelayedCall.restart(true);
    }, _onMove = function _onMove2(e) {
      if (_ignoreCheck(e)) {
        return;
      }
      var x = e.clientX, y = e.clientY, dx = x - self.x, dy = y - self.y;
      self.x = x;
      self.y = y;
      moved = true;
      onStop && onStopDelayedCall.restart(true);
      (dx || dy) && onTouchOrPointerDelta(dx, dy);
    }, _onHover = function _onHover2(e) {
      self.event = e;
      onHover(self);
    }, _onHoverEnd = function _onHoverEnd2(e) {
      self.event = e;
      onHoverEnd(self);
    }, _onClick = function _onClick2(e) {
      return _ignoreCheck(e) || _getEvent(e, preventDefault) && onClick(self);
    };
    onStopDelayedCall = self._dc = gsap$1.delayedCall(onStopDelay || 0.25, onStopFunc).pause();
    self.deltaX = self.deltaY = 0;
    self._vx = _getVelocityProp(0, 50, true);
    self._vy = _getVelocityProp(0, 50, true);
    self.scrollX = scrollFuncX;
    self.scrollY = scrollFuncY;
    self.isDragging = self.isGesturing = self.isPressed = false;
    _context$1(this);
    self.enable = function(e) {
      if (!self.isEnabled) {
        _addListener$1(isViewport ? ownerDoc : target, "scroll", _onScroll$1);
        type.indexOf("scroll") >= 0 && _addListener$1(isViewport ? ownerDoc : target, "scroll", onScroll, passive, capture);
        type.indexOf("wheel") >= 0 && _addListener$1(target, "wheel", _onWheel, passive, capture);
        if (type.indexOf("touch") >= 0 && _isTouch || type.indexOf("pointer") >= 0) {
          _addListener$1(target, _eventTypes[0], _onPress, passive, capture);
          _addListener$1(ownerDoc, _eventTypes[2], _onRelease);
          _addListener$1(ownerDoc, _eventTypes[3], _onRelease);
          allowClicks && _addListener$1(target, "click", clickCapture, true, true);
          onClick && _addListener$1(target, "click", _onClick);
          onGestureStart && _addListener$1(ownerDoc, "gesturestart", _onGestureStart);
          onGestureEnd && _addListener$1(ownerDoc, "gestureend", _onGestureEnd);
          onHover && _addListener$1(target, _pointerType + "enter", _onHover);
          onHoverEnd && _addListener$1(target, _pointerType + "leave", _onHoverEnd);
          onMove && _addListener$1(target, _pointerType + "move", _onMove);
        }
        self.isEnabled = true;
        self.isDragging = self.isGesturing = self.isPressed = moved = dragged = false;
        self._vx.reset();
        self._vy.reset();
        scrollX = scrollFuncX();
        scrollY = scrollFuncY();
        e && e.type && _onPress(e);
        onEnable && onEnable(self);
      }
      return self;
    };
    self.disable = function() {
      if (self.isEnabled) {
        _observers.filter(function(o) {
          return o !== self && _isViewport$1(o.target);
        }).length || _removeListener$1(isViewport ? ownerDoc : target, "scroll", _onScroll$1);
        if (self.isPressed) {
          self._vx.reset();
          self._vy.reset();
          _removeListener$1(isNormalizer ? target : ownerDoc, _eventTypes[1], _onDrag, true);
        }
        _removeListener$1(isViewport ? ownerDoc : target, "scroll", onScroll, capture);
        _removeListener$1(target, "wheel", _onWheel, capture);
        _removeListener$1(target, _eventTypes[0], _onPress, capture);
        _removeListener$1(ownerDoc, _eventTypes[2], _onRelease);
        _removeListener$1(ownerDoc, _eventTypes[3], _onRelease);
        _removeListener$1(target, "click", clickCapture, true);
        _removeListener$1(target, "click", _onClick);
        _removeListener$1(ownerDoc, "gesturestart", _onGestureStart);
        _removeListener$1(ownerDoc, "gestureend", _onGestureEnd);
        _removeListener$1(target, _pointerType + "enter", _onHover);
        _removeListener$1(target, _pointerType + "leave", _onHoverEnd);
        _removeListener$1(target, _pointerType + "move", _onMove);
        self.isEnabled = self.isPressed = self.isDragging = false;
        onDisable && onDisable(self);
      }
    };
    self.kill = self.revert = function() {
      self.disable();
      var i = _observers.indexOf(self);
      i >= 0 && _observers.splice(i, 1);
      _normalizer$1 === self && (_normalizer$1 = 0);
    };
    _observers.push(self);
    isNormalizer && _isViewport$1(target) && (_normalizer$1 = self);
    self.enable(event);
  };
  _createClass(Observer2, [{
    key: "velocityX",
    get: function get() {
      return this._vx.getVelocity();
    }
  }, {
    key: "velocityY",
    get: function get() {
      return this._vy.getVelocity();
    }
  }]);
  return Observer2;
}();
Observer.version = "3.13.0";
Observer.create = function(vars) {
  return new Observer(vars);
};
Observer.register = _initCore;
Observer.getAll = function() {
  return _observers.slice();
};
Observer.getById = function(id) {
  return _observers.filter(function(o) {
    return o.vars.id === id;
  })[0];
};
_getGSAP$1() && gsap$1.registerPlugin(Observer);

/*!
 * ScrollTrigger 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/
var gsap, _coreInitted, _win, _doc, _docEl, _body, _root, _resizeDelay, _toArray, _clamp, _time2, _syncInterval, _refreshing, _pointerIsDown, _transformProp, _i, _prevWidth, _prevHeight, _autoRefresh, _sort, _suppressOverwrites, _ignoreResize, _normalizer, _ignoreMobileResize, _baseScreenHeight, _baseScreenWidth, _fixIOSBug, _context, _scrollRestoration, _div100vh, _100vh, _isReverted, _clampingMax, _limitCallbacks, _startup = 1, _getTime = Date.now, _time1 = _getTime(), _lastScrollTime = 0, _enabled = 0, _parseClamp = function _parseClamp2(value, type, self) {
  var clamp = _isString(value) && (value.substr(0, 6) === "clamp(" || value.indexOf("max") > -1);
  self["_" + type + "Clamp"] = clamp;
  return clamp ? value.substr(6, value.length - 7) : value;
}, _keepClamp = function _keepClamp2(value, clamp) {
  return clamp && (!_isString(value) || value.substr(0, 6) !== "clamp(") ? "clamp(" + value + ")" : value;
}, _rafBugFix = function _rafBugFix2() {
  return _enabled && requestAnimationFrame(_rafBugFix2);
}, _pointerDownHandler = function _pointerDownHandler2() {
  return _pointerIsDown = 1;
}, _pointerUpHandler = function _pointerUpHandler2() {
  return _pointerIsDown = 0;
}, _passThrough = function _passThrough2(v) {
  return v;
}, _round = function _round2(value) {
  return Math.round(value * 1e5) / 1e5 || 0;
}, _windowExists = function _windowExists2() {
  return typeof window !== "undefined";
}, _getGSAP = function _getGSAP2() {
  return gsap || _windowExists() && (gsap = window.gsap) && gsap.registerPlugin && gsap;
}, _isViewport = function _isViewport2(e) {
  return !!~_root.indexOf(e);
}, _getViewportDimension = function _getViewportDimension2(dimensionProperty) {
  return (dimensionProperty === "Height" ? _100vh : _win["inner" + dimensionProperty]) || _docEl["client" + dimensionProperty] || _body["client" + dimensionProperty];
}, _getBoundsFunc = function _getBoundsFunc2(element) {
  return _getProxyProp(element, "getBoundingClientRect") || (_isViewport(element) ? function() {
    _winOffsets.width = _win.innerWidth;
    _winOffsets.height = _100vh;
    return _winOffsets;
  } : function() {
    return _getBounds(element);
  });
}, _getSizeFunc = function _getSizeFunc2(scroller, isViewport, _ref) {
  var d = _ref.d, d2 = _ref.d2, a = _ref.a;
  return (a = _getProxyProp(scroller, "getBoundingClientRect")) ? function() {
    return a()[d];
  } : function() {
    return (isViewport ? _getViewportDimension(d2) : scroller["client" + d2]) || 0;
  };
}, _getOffsetsFunc = function _getOffsetsFunc2(element, isViewport) {
  return !isViewport || ~_proxies.indexOf(element) ? _getBoundsFunc(element) : function() {
    return _winOffsets;
  };
}, _maxScroll = function _maxScroll2(element, _ref2) {
  var s = _ref2.s, d2 = _ref2.d2, d = _ref2.d, a = _ref2.a;
  return Math.max(0, (s = "scroll" + d2) && (a = _getProxyProp(element, s)) ? a() - _getBoundsFunc(element)()[d] : _isViewport(element) ? (_docEl[s] || _body[s]) - _getViewportDimension(d2) : element[s] - element["offset" + d2]);
}, _iterateAutoRefresh = function _iterateAutoRefresh2(func, events) {
  for (var i = 0; i < _autoRefresh.length; i += 3) {
    (!events || ~events.indexOf(_autoRefresh[i + 1])) && func(_autoRefresh[i], _autoRefresh[i + 1], _autoRefresh[i + 2]);
  }
}, _isString = function _isString2(value) {
  return typeof value === "string";
}, _isFunction = function _isFunction2(value) {
  return typeof value === "function";
}, _isNumber = function _isNumber2(value) {
  return typeof value === "number";
}, _isObject = function _isObject2(value) {
  return typeof value === "object";
}, _endAnimation = function _endAnimation2(animation, reversed, pause) {
  return animation && animation.progress(reversed ? 0 : 1) && pause && animation.pause();
}, _callback = function _callback2(self, func) {
  if (self.enabled) {
    var result = self._ctx ? self._ctx.add(function() {
      return func(self);
    }) : func(self);
    result && result.totalTime && (self.callbackAnimation = result);
  }
}, _abs = Math.abs, _left = "left", _top = "top", _right = "right", _bottom = "bottom", _width = "width", _height = "height", _Right = "Right", _Left = "Left", _Top = "Top", _Bottom = "Bottom", _padding = "padding", _margin = "margin", _Width = "Width", _Height = "Height", _px = "px", _getComputedStyle = function _getComputedStyle2(element) {
  return _win.getComputedStyle(element);
}, _makePositionable = function _makePositionable2(element) {
  var position = _getComputedStyle(element).position;
  element.style.position = position === "absolute" || position === "fixed" ? position : "relative";
}, _setDefaults = function _setDefaults2(obj, defaults) {
  for (var p in defaults) {
    p in obj || (obj[p] = defaults[p]);
  }
  return obj;
}, _getBounds = function _getBounds2(element, withoutTransforms) {
  var tween = withoutTransforms && _getComputedStyle(element)[_transformProp] !== "matrix(1, 0, 0, 1, 0, 0)" && gsap.to(element, {
    x: 0,
    y: 0,
    xPercent: 0,
    yPercent: 0,
    rotation: 0,
    rotationX: 0,
    rotationY: 0,
    scale: 1,
    skewX: 0,
    skewY: 0
  }).progress(1), bounds = element.getBoundingClientRect();
  tween && tween.progress(0).kill();
  return bounds;
}, _getSize = function _getSize2(element, _ref3) {
  var d2 = _ref3.d2;
  return element["offset" + d2] || element["client" + d2] || 0;
}, _getLabelRatioArray = function _getLabelRatioArray2(timeline) {
  var a = [], labels = timeline.labels, duration = timeline.duration(), p;
  for (p in labels) {
    a.push(labels[p] / duration);
  }
  return a;
}, _getClosestLabel = function _getClosestLabel2(animation) {
  return function(value) {
    return gsap.utils.snap(_getLabelRatioArray(animation), value);
  };
}, _snapDirectional = function _snapDirectional2(snapIncrementOrArray) {
  var snap = gsap.utils.snap(snapIncrementOrArray), a = Array.isArray(snapIncrementOrArray) && snapIncrementOrArray.slice(0).sort(function(a2, b) {
    return a2 - b;
  });
  return a ? function(value, direction, threshold) {
    if (threshold === void 0) {
      threshold = 1e-3;
    }
    var i;
    if (!direction) {
      return snap(value);
    }
    if (direction > 0) {
      value -= threshold;
      for (i = 0; i < a.length; i++) {
        if (a[i] >= value) {
          return a[i];
        }
      }
      return a[i - 1];
    } else {
      i = a.length;
      value += threshold;
      while (i--) {
        if (a[i] <= value) {
          return a[i];
        }
      }
    }
    return a[0];
  } : function(value, direction, threshold) {
    if (threshold === void 0) {
      threshold = 1e-3;
    }
    var snapped = snap(value);
    return !direction || Math.abs(snapped - value) < threshold || snapped - value < 0 === direction < 0 ? snapped : snap(direction < 0 ? value - snapIncrementOrArray : value + snapIncrementOrArray);
  };
}, _getLabelAtDirection = function _getLabelAtDirection2(timeline) {
  return function(value, st) {
    return _snapDirectional(_getLabelRatioArray(timeline))(value, st.direction);
  };
}, _multiListener = function _multiListener2(func, element, types, callback) {
  return types.split(",").forEach(function(type) {
    return func(element, type, callback);
  });
}, _addListener = function _addListener2(element, type, func, nonPassive, capture) {
  return element.addEventListener(type, func, {
    passive: !nonPassive,
    capture: !!capture
  });
}, _removeListener = function _removeListener2(element, type, func, capture) {
  return element.removeEventListener(type, func, !!capture);
}, _wheelListener = function _wheelListener2(func, el, scrollFunc) {
  scrollFunc = scrollFunc && scrollFunc.wheelHandler;
  if (scrollFunc) {
    func(el, "wheel", scrollFunc);
    func(el, "touchmove", scrollFunc);
  }
}, _markerDefaults = {
  startColor: "green",
  endColor: "red",
  indent: 0,
  fontSize: "16px",
  fontWeight: "normal"
}, _defaults = {
  toggleActions: "play",
  anticipatePin: 0
}, _keywords = {
  top: 0,
  left: 0,
  center: 0.5,
  bottom: 1,
  right: 1
}, _offsetToPx = function _offsetToPx2(value, size) {
  if (_isString(value)) {
    var eqIndex = value.indexOf("="), relative = ~eqIndex ? +(value.charAt(eqIndex - 1) + 1) * parseFloat(value.substr(eqIndex + 1)) : 0;
    if (~eqIndex) {
      value.indexOf("%") > eqIndex && (relative *= size / 100);
      value = value.substr(0, eqIndex - 1);
    }
    value = relative + (value in _keywords ? _keywords[value] * size : ~value.indexOf("%") ? parseFloat(value) * size / 100 : parseFloat(value) || 0);
  }
  return value;
}, _createMarker = function _createMarker2(type, name, container, direction, _ref4, offset, matchWidthEl, containerAnimation) {
  var startColor = _ref4.startColor, endColor = _ref4.endColor, fontSize = _ref4.fontSize, indent = _ref4.indent, fontWeight = _ref4.fontWeight;
  var e = _doc.createElement("div"), useFixedPosition = _isViewport(container) || _getProxyProp(container, "pinType") === "fixed", isScroller = type.indexOf("scroller") !== -1, parent = useFixedPosition ? _body : container, isStart = type.indexOf("start") !== -1, color = isStart ? startColor : endColor, css = "border-color:" + color + ";font-size:" + fontSize + ";color:" + color + ";font-weight:" + fontWeight + ";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";
  css += "position:" + ((isScroller || containerAnimation) && useFixedPosition ? "fixed;" : "absolute;");
  (isScroller || containerAnimation || !useFixedPosition) && (css += (direction === _vertical ? _right : _bottom) + ":" + (offset + parseFloat(indent)) + "px;");
  matchWidthEl && (css += "box-sizing:border-box;text-align:left;width:" + matchWidthEl.offsetWidth + "px;");
  e._isStart = isStart;
  e.setAttribute("class", "gsap-marker-" + type + (name ? " marker-" + name : ""));
  e.style.cssText = css;
  e.innerText = name || name === 0 ? type + "-" + name : type;
  parent.children[0] ? parent.insertBefore(e, parent.children[0]) : parent.appendChild(e);
  e._offset = e["offset" + direction.op.d2];
  _positionMarker(e, 0, direction, isStart);
  return e;
}, _positionMarker = function _positionMarker2(marker, start, direction, flipped) {
  var vars = {
    display: "block"
  }, side = direction[flipped ? "os2" : "p2"], oppositeSide = direction[flipped ? "p2" : "os2"];
  marker._isFlipped = flipped;
  vars[direction.a + "Percent"] = flipped ? -100 : 0;
  vars[direction.a] = flipped ? "1px" : 0;
  vars["border" + side + _Width] = 1;
  vars["border" + oppositeSide + _Width] = 0;
  vars[direction.p] = start + "px";
  gsap.set(marker, vars);
}, _triggers = [], _ids = {}, _rafID, _sync = function _sync2() {
  return _getTime() - _lastScrollTime > 34 && (_rafID || (_rafID = requestAnimationFrame(_updateAll)));
}, _onScroll = function _onScroll2() {
  if (!_normalizer || !_normalizer.isPressed || _normalizer.startX > _body.clientWidth) {
    _scrollers.cache++;
    if (_normalizer) {
      _rafID || (_rafID = requestAnimationFrame(_updateAll));
    } else {
      _updateAll();
    }
    _lastScrollTime || _dispatch("scrollStart");
    _lastScrollTime = _getTime();
  }
}, _setBaseDimensions = function _setBaseDimensions2() {
  _baseScreenWidth = _win.innerWidth;
  _baseScreenHeight = _win.innerHeight;
}, _onResize = function _onResize2(force) {
  _scrollers.cache++;
  (force === true || !_refreshing && !_ignoreResize && !_doc.fullscreenElement && !_doc.webkitFullscreenElement && (!_ignoreMobileResize || _baseScreenWidth !== _win.innerWidth || Math.abs(_win.innerHeight - _baseScreenHeight) > _win.innerHeight * 0.25)) && _resizeDelay.restart(true);
}, _listeners = {}, _emptyArray = [], _softRefresh = function _softRefresh2() {
  return _removeListener(ScrollTrigger, "scrollEnd", _softRefresh2) || _refreshAll(true);
}, _dispatch = function _dispatch2(type) {
  return _listeners[type] && _listeners[type].map(function(f) {
    return f();
  }) || _emptyArray;
}, _savedStyles = [], _revertRecorded = function _revertRecorded2(media) {
  for (var i = 0; i < _savedStyles.length; i += 5) {
    if (!media || _savedStyles[i + 4] && _savedStyles[i + 4].query === media) {
      _savedStyles[i].style.cssText = _savedStyles[i + 1];
      _savedStyles[i].getBBox && _savedStyles[i].setAttribute("transform", _savedStyles[i + 2] || "");
      _savedStyles[i + 3].uncache = 1;
    }
  }
}, _revertAll = function _revertAll2(kill, media) {
  var trigger;
  for (_i = 0; _i < _triggers.length; _i++) {
    trigger = _triggers[_i];
    if (trigger && (!media || trigger._ctx === media)) {
      if (kill) {
        trigger.kill(1);
      } else {
        trigger.revert(true, true);
      }
    }
  }
  _isReverted = true;
  media && _revertRecorded(media);
  media || _dispatch("revert");
}, _clearScrollMemory = function _clearScrollMemory2(scrollRestoration, force) {
  _scrollers.cache++;
  (force || !_refreshingAll) && _scrollers.forEach(function(obj) {
    return _isFunction(obj) && obj.cacheID++ && (obj.rec = 0);
  });
  _isString(scrollRestoration) && (_win.history.scrollRestoration = _scrollRestoration = scrollRestoration);
}, _refreshingAll, _refreshID = 0, _queueRefreshID, _queueRefreshAll = function _queueRefreshAll2() {
  if (_queueRefreshID !== _refreshID) {
    var id = _queueRefreshID = _refreshID;
    requestAnimationFrame(function() {
      return id === _refreshID && _refreshAll(true);
    });
  }
}, _refresh100vh = function _refresh100vh2() {
  _body.appendChild(_div100vh);
  _100vh = !_normalizer && _div100vh.offsetHeight || _win.innerHeight;
  _body.removeChild(_div100vh);
}, _hideAllMarkers = function _hideAllMarkers2(hide) {
  return _toArray(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(el) {
    return el.style.display = hide ? "none" : "block";
  });
}, _refreshAll = function _refreshAll2(force, skipRevert) {
  _docEl = _doc.documentElement;
  _body = _doc.body;
  _root = [_win, _doc, _docEl, _body];
  if (_lastScrollTime && !force && !_isReverted) {
    _addListener(ScrollTrigger, "scrollEnd", _softRefresh);
    return;
  }
  _refresh100vh();
  _refreshingAll = ScrollTrigger.isRefreshing = true;
  _scrollers.forEach(function(obj) {
    return _isFunction(obj) && ++obj.cacheID && (obj.rec = obj());
  });
  var refreshInits = _dispatch("refreshInit");
  _sort && ScrollTrigger.sort();
  skipRevert || _revertAll();
  _scrollers.forEach(function(obj) {
    if (_isFunction(obj)) {
      obj.smooth && (obj.target.style.scrollBehavior = "auto");
      obj(0);
    }
  });
  _triggers.slice(0).forEach(function(t) {
    return t.refresh();
  });
  _isReverted = false;
  _triggers.forEach(function(t) {
    if (t._subPinOffset && t.pin) {
      var prop = t.vars.horizontal ? "offsetWidth" : "offsetHeight", original = t.pin[prop];
      t.revert(true, 1);
      t.adjustPinSpacing(t.pin[prop] - original);
      t.refresh();
    }
  });
  _clampingMax = 1;
  _hideAllMarkers(true);
  _triggers.forEach(function(t) {
    var max = _maxScroll(t.scroller, t._dir), endClamp = t.vars.end === "max" || t._endClamp && t.end > max, startClamp = t._startClamp && t.start >= max;
    (endClamp || startClamp) && t.setPositions(startClamp ? max - 1 : t.start, endClamp ? Math.max(startClamp ? max : t.start + 1, max) : t.end, true);
  });
  _hideAllMarkers(false);
  _clampingMax = 0;
  refreshInits.forEach(function(result) {
    return result && result.render && result.render(-1);
  });
  _scrollers.forEach(function(obj) {
    if (_isFunction(obj)) {
      obj.smooth && requestAnimationFrame(function() {
        return obj.target.style.scrollBehavior = "smooth";
      });
      obj.rec && obj(obj.rec);
    }
  });
  _clearScrollMemory(_scrollRestoration, 1);
  _resizeDelay.pause();
  _refreshID++;
  _refreshingAll = 2;
  _updateAll(2);
  _triggers.forEach(function(t) {
    return _isFunction(t.vars.onRefresh) && t.vars.onRefresh(t);
  });
  _refreshingAll = ScrollTrigger.isRefreshing = false;
  _dispatch("refresh");
}, _lastScroll = 0, _direction = 1, _primary, _updateAll = function _updateAll2(force) {
  if (force === 2 || !_refreshingAll && !_isReverted) {
    ScrollTrigger.isUpdating = true;
    _primary && _primary.update(0);
    var l = _triggers.length, time = _getTime(), recordVelocity = time - _time1 >= 50, scroll = l && _triggers[0].scroll();
    _direction = _lastScroll > scroll ? -1 : 1;
    _refreshingAll || (_lastScroll = scroll);
    if (recordVelocity) {
      if (_lastScrollTime && !_pointerIsDown && time - _lastScrollTime > 200) {
        _lastScrollTime = 0;
        _dispatch("scrollEnd");
      }
      _time2 = _time1;
      _time1 = time;
    }
    if (_direction < 0) {
      _i = l;
      while (_i-- > 0) {
        _triggers[_i] && _triggers[_i].update(0, recordVelocity);
      }
      _direction = 1;
    } else {
      for (_i = 0; _i < l; _i++) {
        _triggers[_i] && _triggers[_i].update(0, recordVelocity);
      }
    }
    ScrollTrigger.isUpdating = false;
  }
  _rafID = 0;
}, _propNamesToCopy = [_left, _top, _bottom, _right, _margin + _Bottom, _margin + _Right, _margin + _Top, _margin + _Left, "display", "flexShrink", "float", "zIndex", "gridColumnStart", "gridColumnEnd", "gridRowStart", "gridRowEnd", "gridArea", "justifySelf", "alignSelf", "placeSelf", "order"], _stateProps = _propNamesToCopy.concat([_width, _height, "boxSizing", "max" + _Width, "max" + _Height, "position", _margin, _padding, _padding + _Top, _padding + _Right, _padding + _Bottom, _padding + _Left]), _swapPinOut = function _swapPinOut2(pin, spacer, state) {
  _setState(state);
  var cache = pin._gsap;
  if (cache.spacerIsNative) {
    _setState(cache.spacerState);
  } else if (pin._gsap.swappedIn) {
    var parent = spacer.parentNode;
    if (parent) {
      parent.insertBefore(pin, spacer);
      parent.removeChild(spacer);
    }
  }
  pin._gsap.swappedIn = false;
}, _swapPinIn = function _swapPinIn2(pin, spacer, cs, spacerState) {
  if (!pin._gsap.swappedIn) {
    var i = _propNamesToCopy.length, spacerStyle = spacer.style, pinStyle = pin.style, p;
    while (i--) {
      p = _propNamesToCopy[i];
      spacerStyle[p] = cs[p];
    }
    spacerStyle.position = cs.position === "absolute" ? "absolute" : "relative";
    cs.display === "inline" && (spacerStyle.display = "inline-block");
    pinStyle[_bottom] = pinStyle[_right] = "auto";
    spacerStyle.flexBasis = cs.flexBasis || "auto";
    spacerStyle.overflow = "visible";
    spacerStyle.boxSizing = "border-box";
    spacerStyle[_width] = _getSize(pin, _horizontal) + _px;
    spacerStyle[_height] = _getSize(pin, _vertical) + _px;
    spacerStyle[_padding] = pinStyle[_margin] = pinStyle[_top] = pinStyle[_left] = "0";
    _setState(spacerState);
    pinStyle[_width] = pinStyle["max" + _Width] = cs[_width];
    pinStyle[_height] = pinStyle["max" + _Height] = cs[_height];
    pinStyle[_padding] = cs[_padding];
    if (pin.parentNode !== spacer) {
      pin.parentNode.insertBefore(spacer, pin);
      spacer.appendChild(pin);
    }
    pin._gsap.swappedIn = true;
  }
}, _capsExp = /([A-Z])/g, _setState = function _setState2(state) {
  if (state) {
    var style = state.t.style, l = state.length, i = 0, p, value;
    (state.t._gsap || gsap.core.getCache(state.t)).uncache = 1;
    for (; i < l; i += 2) {
      value = state[i + 1];
      p = state[i];
      if (value) {
        style[p] = value;
      } else if (style[p]) {
        style.removeProperty(p.replace(_capsExp, "-$1").toLowerCase());
      }
    }
  }
}, _getState = function _getState2(element) {
  var l = _stateProps.length, style = element.style, state = [], i = 0;
  for (; i < l; i++) {
    state.push(_stateProps[i], style[_stateProps[i]]);
  }
  state.t = element;
  return state;
}, _copyState = function _copyState2(state, override, omitOffsets) {
  var result = [], l = state.length, i = omitOffsets ? 8 : 0, p;
  for (; i < l; i += 2) {
    p = state[i];
    result.push(p, p in override ? override[p] : state[i + 1]);
  }
  result.t = state.t;
  return result;
}, _winOffsets = {
  left: 0,
  top: 0
}, _parsePosition = function _parsePosition2(value, trigger, scrollerSize, direction, scroll, marker, markerScroller, self, scrollerBounds, borderWidth, useFixedPosition, scrollerMax, containerAnimation, clampZeroProp) {
  _isFunction(value) && (value = value(self));
  if (_isString(value) && value.substr(0, 3) === "max") {
    value = scrollerMax + (value.charAt(4) === "=" ? _offsetToPx("0" + value.substr(3), scrollerSize) : 0);
  }
  var time = containerAnimation ? containerAnimation.time() : 0, p1, p2, element;
  containerAnimation && containerAnimation.seek(0);
  isNaN(value) || (value = +value);
  if (!_isNumber(value)) {
    _isFunction(trigger) && (trigger = trigger(self));
    var offsets = (value || "0").split(" "), bounds, localOffset, globalOffset, display;
    element = _getTarget(trigger, self) || _body;
    bounds = _getBounds(element) || {};
    if ((!bounds || !bounds.left && !bounds.top) && _getComputedStyle(element).display === "none") {
      display = element.style.display;
      element.style.display = "block";
      bounds = _getBounds(element);
      display ? element.style.display = display : element.style.removeProperty("display");
    }
    localOffset = _offsetToPx(offsets[0], bounds[direction.d]);
    globalOffset = _offsetToPx(offsets[1] || "0", scrollerSize);
    value = bounds[direction.p] - scrollerBounds[direction.p] - borderWidth + localOffset + scroll - globalOffset;
    markerScroller && _positionMarker(markerScroller, globalOffset, direction, scrollerSize - globalOffset < 20 || markerScroller._isStart && globalOffset > 20);
    scrollerSize -= scrollerSize - globalOffset;
  } else {
    containerAnimation && (value = gsap.utils.mapRange(containerAnimation.scrollTrigger.start, containerAnimation.scrollTrigger.end, 0, scrollerMax, value));
    markerScroller && _positionMarker(markerScroller, scrollerSize, direction, true);
  }
  if (clampZeroProp) {
    self[clampZeroProp] = value || -1e-3;
    value < 0 && (value = 0);
  }
  if (marker) {
    var position = value + scrollerSize, isStart = marker._isStart;
    p1 = "scroll" + direction.d2;
    _positionMarker(marker, position, direction, isStart && position > 20 || !isStart && (useFixedPosition ? Math.max(_body[p1], _docEl[p1]) : marker.parentNode[p1]) <= position + 1);
    if (useFixedPosition) {
      scrollerBounds = _getBounds(markerScroller);
      useFixedPosition && (marker.style[direction.op.p] = scrollerBounds[direction.op.p] - direction.op.m - marker._offset + _px);
    }
  }
  if (containerAnimation && element) {
    p1 = _getBounds(element);
    containerAnimation.seek(scrollerMax);
    p2 = _getBounds(element);
    containerAnimation._caScrollDist = p1[direction.p] - p2[direction.p];
    value = value / containerAnimation._caScrollDist * scrollerMax;
  }
  containerAnimation && containerAnimation.seek(time);
  return containerAnimation ? value : Math.round(value);
}, _prefixExp = /(webkit|moz|length|cssText|inset)/i, _reparent = function _reparent2(element, parent, top, left) {
  if (element.parentNode !== parent) {
    var style = element.style, p, cs;
    if (parent === _body) {
      element._stOrig = style.cssText;
      cs = _getComputedStyle(element);
      for (p in cs) {
        if (!+p && !_prefixExp.test(p) && cs[p] && typeof style[p] === "string" && p !== "0") {
          style[p] = cs[p];
        }
      }
      style.top = top;
      style.left = left;
    } else {
      style.cssText = element._stOrig;
    }
    gsap.core.getCache(element).uncache = 1;
    parent.appendChild(element);
  }
}, _interruptionTracker = function _interruptionTracker2(getValueFunc, initialValue, onInterrupt) {
  var last1 = initialValue, last2 = last1;
  return function(value) {
    var current = Math.round(getValueFunc());
    if (current !== last1 && current !== last2 && Math.abs(current - last1) > 3 && Math.abs(current - last2) > 3) {
      value = current;
      onInterrupt && onInterrupt();
    }
    last2 = last1;
    last1 = Math.round(value);
    return last1;
  };
}, _shiftMarker = function _shiftMarker2(marker, direction, value) {
  var vars = {};
  vars[direction.p] = "+=" + value;
  gsap.set(marker, vars);
}, _getTweenCreator = function _getTweenCreator2(scroller, direction) {
  var getScroll = _getScrollFunc(scroller, direction), prop = "_scroll" + direction.p2, getTween = function getTween2(scrollTo, vars, initialValue, change1, change2) {
    var tween = getTween2.tween, onComplete = vars.onComplete, modifiers = {};
    initialValue = initialValue || getScroll();
    var checkForInterruption = _interruptionTracker(getScroll, initialValue, function() {
      tween.kill();
      getTween2.tween = 0;
    });
    change2 = change1 && change2 || 0;
    change1 = change1 || scrollTo - initialValue;
    tween && tween.kill();
    vars[prop] = scrollTo;
    vars.inherit = false;
    vars.modifiers = modifiers;
    modifiers[prop] = function() {
      return checkForInterruption(initialValue + change1 * tween.ratio + change2 * tween.ratio * tween.ratio);
    };
    vars.onUpdate = function() {
      _scrollers.cache++;
      getTween2.tween && _updateAll();
    };
    vars.onComplete = function() {
      getTween2.tween = 0;
      onComplete && onComplete.call(tween);
    };
    tween = getTween2.tween = gsap.to(scroller, vars);
    return tween;
  };
  scroller[prop] = getScroll;
  getScroll.wheelHandler = function() {
    return getTween.tween && getTween.tween.kill() && (getTween.tween = 0);
  };
  _addListener(scroller, "wheel", getScroll.wheelHandler);
  ScrollTrigger.isTouch && _addListener(scroller, "touchmove", getScroll.wheelHandler);
  return getTween;
};
var ScrollTrigger = /* @__PURE__ */ function() {
  function ScrollTrigger2(vars, animation) {
    _coreInitted || ScrollTrigger2.register(gsap) || console.warn("Please gsap.registerPlugin(ScrollTrigger)");
    _context(this);
    this.init(vars, animation);
  }
  var _proto = ScrollTrigger2.prototype;
  _proto.init = function init(vars, animation) {
    this.progress = this.start = 0;
    this.vars && this.kill(true, true);
    if (!_enabled) {
      this.update = this.refresh = this.kill = _passThrough;
      return;
    }
    vars = _setDefaults(_isString(vars) || _isNumber(vars) || vars.nodeType ? {
      trigger: vars
    } : vars, _defaults);
    var _vars = vars, onUpdate = _vars.onUpdate, toggleClass = _vars.toggleClass, id = _vars.id, onToggle = _vars.onToggle, onRefresh = _vars.onRefresh, scrub = _vars.scrub, trigger = _vars.trigger, pin = _vars.pin, pinSpacing = _vars.pinSpacing, invalidateOnRefresh = _vars.invalidateOnRefresh, anticipatePin = _vars.anticipatePin, onScrubComplete = _vars.onScrubComplete, onSnapComplete = _vars.onSnapComplete, once = _vars.once, snap = _vars.snap, pinReparent = _vars.pinReparent, pinSpacer = _vars.pinSpacer, containerAnimation = _vars.containerAnimation, fastScrollEnd = _vars.fastScrollEnd, preventOverlaps = _vars.preventOverlaps, direction = vars.horizontal || vars.containerAnimation && vars.horizontal !== false ? _horizontal : _vertical, isToggle = !scrub && scrub !== 0, scroller = _getTarget(vars.scroller || _win), scrollerCache = gsap.core.getCache(scroller), isViewport = _isViewport(scroller), useFixedPosition = ("pinType" in vars ? vars.pinType : _getProxyProp(scroller, "pinType") || isViewport && "fixed") === "fixed", callbacks = [vars.onEnter, vars.onLeave, vars.onEnterBack, vars.onLeaveBack], toggleActions = isToggle && vars.toggleActions.split(" "), markers = "markers" in vars ? vars.markers : _defaults.markers, borderWidth = isViewport ? 0 : parseFloat(_getComputedStyle(scroller)["border" + direction.p2 + _Width]) || 0, self = this, onRefreshInit = vars.onRefreshInit && function() {
      return vars.onRefreshInit(self);
    }, getScrollerSize = _getSizeFunc(scroller, isViewport, direction), getScrollerOffsets = _getOffsetsFunc(scroller, isViewport), lastSnap = 0, lastRefresh = 0, prevProgress = 0, scrollFunc = _getScrollFunc(scroller, direction), tweenTo, pinCache, snapFunc, scroll1, scroll2, start, end, markerStart, markerEnd, markerStartTrigger, markerEndTrigger, markerVars, executingOnRefresh, change, pinOriginalState, pinActiveState, pinState, spacer, offset, pinGetter, pinSetter, pinStart, pinChange, spacingStart, spacerState, markerStartSetter, pinMoves, markerEndSetter, cs, snap1, snap2, scrubTween, scrubSmooth, snapDurClamp, snapDelayedCall, prevScroll, prevAnimProgress, caMarkerSetter, customRevertReturn;
    self._startClamp = self._endClamp = false;
    self._dir = direction;
    anticipatePin *= 45;
    self.scroller = scroller;
    self.scroll = containerAnimation ? containerAnimation.time.bind(containerAnimation) : scrollFunc;
    scroll1 = scrollFunc();
    self.vars = vars;
    animation = animation || vars.animation;
    if ("refreshPriority" in vars) {
      _sort = 1;
      vars.refreshPriority === -9999 && (_primary = self);
    }
    scrollerCache.tweenScroll = scrollerCache.tweenScroll || {
      top: _getTweenCreator(scroller, _vertical),
      left: _getTweenCreator(scroller, _horizontal)
    };
    self.tweenTo = tweenTo = scrollerCache.tweenScroll[direction.p];
    self.scrubDuration = function(value) {
      scrubSmooth = _isNumber(value) && value;
      if (!scrubSmooth) {
        scrubTween && scrubTween.progress(1).kill();
        scrubTween = 0;
      } else {
        scrubTween ? scrubTween.duration(value) : scrubTween = gsap.to(animation, {
          ease: "expo",
          totalProgress: "+=0",
          inherit: false,
          duration: scrubSmooth,
          paused: true,
          onComplete: function onComplete() {
            return onScrubComplete && onScrubComplete(self);
          }
        });
      }
    };
    if (animation) {
      animation.vars.lazy = false;
      animation._initted && !self.isReverted || animation.vars.immediateRender !== false && vars.immediateRender !== false && animation.duration() && animation.render(0, true, true);
      self.animation = animation.pause();
      animation.scrollTrigger = self;
      self.scrubDuration(scrub);
      snap1 = 0;
      id || (id = animation.vars.id);
    }
    if (snap) {
      if (!_isObject(snap) || snap.push) {
        snap = {
          snapTo: snap
        };
      }
      "scrollBehavior" in _body.style && gsap.set(isViewport ? [_body, _docEl] : scroller, {
        scrollBehavior: "auto"
      });
      _scrollers.forEach(function(o) {
        return _isFunction(o) && o.target === (isViewport ? _doc.scrollingElement || _docEl : scroller) && (o.smooth = false);
      });
      snapFunc = _isFunction(snap.snapTo) ? snap.snapTo : snap.snapTo === "labels" ? _getClosestLabel(animation) : snap.snapTo === "labelsDirectional" ? _getLabelAtDirection(animation) : snap.directional !== false ? function(value, st) {
        return _snapDirectional(snap.snapTo)(value, _getTime() - lastRefresh < 500 ? 0 : st.direction);
      } : gsap.utils.snap(snap.snapTo);
      snapDurClamp = snap.duration || {
        min: 0.1,
        max: 2
      };
      snapDurClamp = _isObject(snapDurClamp) ? _clamp(snapDurClamp.min, snapDurClamp.max) : _clamp(snapDurClamp, snapDurClamp);
      snapDelayedCall = gsap.delayedCall(snap.delay || scrubSmooth / 2 || 0.1, function() {
        var scroll = scrollFunc(), refreshedRecently = _getTime() - lastRefresh < 500, tween = tweenTo.tween;
        if ((refreshedRecently || Math.abs(self.getVelocity()) < 10) && !tween && !_pointerIsDown && lastSnap !== scroll) {
          var progress = (scroll - start) / change, totalProgress = animation && !isToggle ? animation.totalProgress() : progress, velocity = refreshedRecently ? 0 : (totalProgress - snap2) / (_getTime() - _time2) * 1e3 || 0, change1 = gsap.utils.clamp(-progress, 1 - progress, _abs(velocity / 2) * velocity / 0.185), naturalEnd = progress + (snap.inertia === false ? 0 : change1), endValue, endScroll, _snap = snap, onStart = _snap.onStart, _onInterrupt = _snap.onInterrupt, _onComplete = _snap.onComplete;
          endValue = snapFunc(naturalEnd, self);
          _isNumber(endValue) || (endValue = naturalEnd);
          endScroll = Math.max(0, Math.round(start + endValue * change));
          if (scroll <= end && scroll >= start && endScroll !== scroll) {
            if (tween && !tween._initted && tween.data <= _abs(endScroll - scroll)) {
              return;
            }
            if (snap.inertia === false) {
              change1 = endValue - progress;
            }
            tweenTo(endScroll, {
              duration: snapDurClamp(_abs(Math.max(_abs(naturalEnd - totalProgress), _abs(endValue - totalProgress)) * 0.185 / velocity / 0.05 || 0)),
              ease: snap.ease || "power3",
              data: _abs(endScroll - scroll),
              // record the distance so that if another snap tween occurs (conflict) we can prioritize the closest snap.
              onInterrupt: function onInterrupt() {
                return snapDelayedCall.restart(true) && _onInterrupt && _onInterrupt(self);
              },
              onComplete: function onComplete() {
                self.update();
                lastSnap = scrollFunc();
                if (animation && !isToggle) {
                  scrubTween ? scrubTween.resetTo("totalProgress", endValue, animation._tTime / animation._tDur) : animation.progress(endValue);
                }
                snap1 = snap2 = animation && !isToggle ? animation.totalProgress() : self.progress;
                onSnapComplete && onSnapComplete(self);
                _onComplete && _onComplete(self);
              }
            }, scroll, change1 * change, endScroll - scroll - change1 * change);
            onStart && onStart(self, tweenTo.tween);
          }
        } else if (self.isActive && lastSnap !== scroll) {
          snapDelayedCall.restart(true);
        }
      }).pause();
    }
    id && (_ids[id] = self);
    trigger = self.trigger = _getTarget(trigger || pin !== true && pin);
    customRevertReturn = trigger && trigger._gsap && trigger._gsap.stRevert;
    customRevertReturn && (customRevertReturn = customRevertReturn(self));
    pin = pin === true ? trigger : _getTarget(pin);
    _isString(toggleClass) && (toggleClass = {
      targets: trigger,
      className: toggleClass
    });
    if (pin) {
      pinSpacing === false || pinSpacing === _margin || (pinSpacing = !pinSpacing && pin.parentNode && pin.parentNode.style && _getComputedStyle(pin.parentNode).display === "flex" ? false : _padding);
      self.pin = pin;
      pinCache = gsap.core.getCache(pin);
      if (!pinCache.spacer) {
        if (pinSpacer) {
          pinSpacer = _getTarget(pinSpacer);
          pinSpacer && !pinSpacer.nodeType && (pinSpacer = pinSpacer.current || pinSpacer.nativeElement);
          pinCache.spacerIsNative = !!pinSpacer;
          pinSpacer && (pinCache.spacerState = _getState(pinSpacer));
        }
        pinCache.spacer = spacer = pinSpacer || _doc.createElement("div");
        spacer.classList.add("pin-spacer");
        id && spacer.classList.add("pin-spacer-" + id);
        pinCache.pinState = pinOriginalState = _getState(pin);
      } else {
        pinOriginalState = pinCache.pinState;
      }
      vars.force3D !== false && gsap.set(pin, {
        force3D: true
      });
      self.spacer = spacer = pinCache.spacer;
      cs = _getComputedStyle(pin);
      spacingStart = cs[pinSpacing + direction.os2];
      pinGetter = gsap.getProperty(pin);
      pinSetter = gsap.quickSetter(pin, direction.a, _px);
      _swapPinIn(pin, spacer, cs);
      pinState = _getState(pin);
    }
    if (markers) {
      markerVars = _isObject(markers) ? _setDefaults(markers, _markerDefaults) : _markerDefaults;
      markerStartTrigger = _createMarker("scroller-start", id, scroller, direction, markerVars, 0);
      markerEndTrigger = _createMarker("scroller-end", id, scroller, direction, markerVars, 0, markerStartTrigger);
      offset = markerStartTrigger["offset" + direction.op.d2];
      var content = _getTarget(_getProxyProp(scroller, "content") || scroller);
      markerStart = this.markerStart = _createMarker("start", id, content, direction, markerVars, offset, 0, containerAnimation);
      markerEnd = this.markerEnd = _createMarker("end", id, content, direction, markerVars, offset, 0, containerAnimation);
      containerAnimation && (caMarkerSetter = gsap.quickSetter([markerStart, markerEnd], direction.a, _px));
      if (!useFixedPosition && !(_proxies.length && _getProxyProp(scroller, "fixedMarkers") === true)) {
        _makePositionable(isViewport ? _body : scroller);
        gsap.set([markerStartTrigger, markerEndTrigger], {
          force3D: true
        });
        markerStartSetter = gsap.quickSetter(markerStartTrigger, direction.a, _px);
        markerEndSetter = gsap.quickSetter(markerEndTrigger, direction.a, _px);
      }
    }
    if (containerAnimation) {
      var oldOnUpdate = containerAnimation.vars.onUpdate, oldParams = containerAnimation.vars.onUpdateParams;
      containerAnimation.eventCallback("onUpdate", function() {
        self.update(0, 0, 1);
        oldOnUpdate && oldOnUpdate.apply(containerAnimation, oldParams || []);
      });
    }
    self.previous = function() {
      return _triggers[_triggers.indexOf(self) - 1];
    };
    self.next = function() {
      return _triggers[_triggers.indexOf(self) + 1];
    };
    self.revert = function(revert, temp) {
      if (!temp) {
        return self.kill(true);
      }
      var r = revert !== false || !self.enabled, prevRefreshing = _refreshing;
      if (r !== self.isReverted) {
        if (r) {
          prevScroll = Math.max(scrollFunc(), self.scroll.rec || 0);
          prevProgress = self.progress;
          prevAnimProgress = animation && animation.progress();
        }
        markerStart && [markerStart, markerEnd, markerStartTrigger, markerEndTrigger].forEach(function(m) {
          return m.style.display = r ? "none" : "block";
        });
        if (r) {
          _refreshing = self;
          self.update(r);
        }
        if (pin && (!pinReparent || !self.isActive)) {
          if (r) {
            _swapPinOut(pin, spacer, pinOriginalState);
          } else {
            _swapPinIn(pin, spacer, _getComputedStyle(pin), spacerState);
          }
        }
        r || self.update(r);
        _refreshing = prevRefreshing;
        self.isReverted = r;
      }
    };
    self.refresh = function(soft, force, position, pinOffset) {
      if ((_refreshing || !self.enabled) && !force) {
        return;
      }
      if (pin && soft && _lastScrollTime) {
        _addListener(ScrollTrigger2, "scrollEnd", _softRefresh);
        return;
      }
      !_refreshingAll && onRefreshInit && onRefreshInit(self);
      _refreshing = self;
      if (tweenTo.tween && !position) {
        tweenTo.tween.kill();
        tweenTo.tween = 0;
      }
      scrubTween && scrubTween.pause();
      if (invalidateOnRefresh && animation) {
        animation.revert({
          kill: false
        }).invalidate();
        animation.getChildren && animation.getChildren(true, true, false).forEach(function(t) {
          return t.vars.immediateRender && t.render(0, true, true);
        });
      }
      self.isReverted || self.revert(true, true);
      self._subPinOffset = false;
      var size = getScrollerSize(), scrollerBounds = getScrollerOffsets(), max = containerAnimation ? containerAnimation.duration() : _maxScroll(scroller, direction), isFirstRefresh = change <= 0.01 || !change, offset2 = 0, otherPinOffset = pinOffset || 0, parsedEnd = _isObject(position) ? position.end : vars.end, parsedEndTrigger = vars.endTrigger || trigger, parsedStart = _isObject(position) ? position.start : vars.start || (vars.start === 0 || !trigger ? 0 : pin ? "0 0" : "0 100%"), pinnedContainer = self.pinnedContainer = vars.pinnedContainer && _getTarget(vars.pinnedContainer, self), triggerIndex = trigger && Math.max(0, _triggers.indexOf(self)) || 0, i = triggerIndex, cs2, bounds, scroll, isVertical, override, curTrigger, curPin, oppositeScroll, initted, revertedPins, forcedOverflow, markerStartOffset, markerEndOffset;
      if (markers && _isObject(position)) {
        markerStartOffset = gsap.getProperty(markerStartTrigger, direction.p);
        markerEndOffset = gsap.getProperty(markerEndTrigger, direction.p);
      }
      while (i-- > 0) {
        curTrigger = _triggers[i];
        curTrigger.end || curTrigger.refresh(0, 1) || (_refreshing = self);
        curPin = curTrigger.pin;
        if (curPin && (curPin === trigger || curPin === pin || curPin === pinnedContainer) && !curTrigger.isReverted) {
          revertedPins || (revertedPins = []);
          revertedPins.unshift(curTrigger);
          curTrigger.revert(true, true);
        }
        if (curTrigger !== _triggers[i]) {
          triggerIndex--;
          i--;
        }
      }
      _isFunction(parsedStart) && (parsedStart = parsedStart(self));
      parsedStart = _parseClamp(parsedStart, "start", self);
      start = _parsePosition(parsedStart, trigger, size, direction, scrollFunc(), markerStart, markerStartTrigger, self, scrollerBounds, borderWidth, useFixedPosition, max, containerAnimation, self._startClamp && "_startClamp") || (pin ? -1e-3 : 0);
      _isFunction(parsedEnd) && (parsedEnd = parsedEnd(self));
      if (_isString(parsedEnd) && !parsedEnd.indexOf("+=")) {
        if (~parsedEnd.indexOf(" ")) {
          parsedEnd = (_isString(parsedStart) ? parsedStart.split(" ")[0] : "") + parsedEnd;
        } else {
          offset2 = _offsetToPx(parsedEnd.substr(2), size);
          parsedEnd = _isString(parsedStart) ? parsedStart : (containerAnimation ? gsap.utils.mapRange(0, containerAnimation.duration(), containerAnimation.scrollTrigger.start, containerAnimation.scrollTrigger.end, start) : start) + offset2;
          parsedEndTrigger = trigger;
        }
      }
      parsedEnd = _parseClamp(parsedEnd, "end", self);
      end = Math.max(start, _parsePosition(parsedEnd || (parsedEndTrigger ? "100% 0" : max), parsedEndTrigger, size, direction, scrollFunc() + offset2, markerEnd, markerEndTrigger, self, scrollerBounds, borderWidth, useFixedPosition, max, containerAnimation, self._endClamp && "_endClamp")) || -1e-3;
      offset2 = 0;
      i = triggerIndex;
      while (i--) {
        curTrigger = _triggers[i];
        curPin = curTrigger.pin;
        if (curPin && curTrigger.start - curTrigger._pinPush <= start && !containerAnimation && curTrigger.end > 0) {
          cs2 = curTrigger.end - (self._startClamp ? Math.max(0, curTrigger.start) : curTrigger.start);
          if ((curPin === trigger && curTrigger.start - curTrigger._pinPush < start || curPin === pinnedContainer) && isNaN(parsedStart)) {
            offset2 += cs2 * (1 - curTrigger.progress);
          }
          curPin === pin && (otherPinOffset += cs2);
        }
      }
      start += offset2;
      end += offset2;
      self._startClamp && (self._startClamp += offset2);
      if (self._endClamp && !_refreshingAll) {
        self._endClamp = end || -1e-3;
        end = Math.min(end, _maxScroll(scroller, direction));
      }
      change = end - start || (start -= 0.01) && 1e-3;
      if (isFirstRefresh) {
        prevProgress = gsap.utils.clamp(0, 1, gsap.utils.normalize(start, end, prevScroll));
      }
      self._pinPush = otherPinOffset;
      if (markerStart && offset2) {
        cs2 = {};
        cs2[direction.a] = "+=" + offset2;
        pinnedContainer && (cs2[direction.p] = "-=" + scrollFunc());
        gsap.set([markerStart, markerEnd], cs2);
      }
      if (pin && !(_clampingMax && self.end >= _maxScroll(scroller, direction))) {
        cs2 = _getComputedStyle(pin);
        isVertical = direction === _vertical;
        scroll = scrollFunc();
        pinStart = parseFloat(pinGetter(direction.a)) + otherPinOffset;
        if (!max && end > 1) {
          forcedOverflow = (isViewport ? _doc.scrollingElement || _docEl : scroller).style;
          forcedOverflow = {
            style: forcedOverflow,
            value: forcedOverflow["overflow" + direction.a.toUpperCase()]
          };
          if (isViewport && _getComputedStyle(_body)["overflow" + direction.a.toUpperCase()] !== "scroll") {
            forcedOverflow.style["overflow" + direction.a.toUpperCase()] = "scroll";
          }
        }
        _swapPinIn(pin, spacer, cs2);
        pinState = _getState(pin);
        bounds = _getBounds(pin, true);
        oppositeScroll = useFixedPosition && _getScrollFunc(scroller, isVertical ? _horizontal : _vertical)();
        if (pinSpacing) {
          spacerState = [pinSpacing + direction.os2, change + otherPinOffset + _px];
          spacerState.t = spacer;
          i = pinSpacing === _padding ? _getSize(pin, direction) + change + otherPinOffset : 0;
          if (i) {
            spacerState.push(direction.d, i + _px);
            spacer.style.flexBasis !== "auto" && (spacer.style.flexBasis = i + _px);
          }
          _setState(spacerState);
          if (pinnedContainer) {
            _triggers.forEach(function(t) {
              if (t.pin === pinnedContainer && t.vars.pinSpacing !== false) {
                t._subPinOffset = true;
              }
            });
          }
          useFixedPosition && scrollFunc(prevScroll);
        } else {
          i = _getSize(pin, direction);
          i && spacer.style.flexBasis !== "auto" && (spacer.style.flexBasis = i + _px);
        }
        if (useFixedPosition) {
          override = {
            top: bounds.top + (isVertical ? scroll - start : oppositeScroll) + _px,
            left: bounds.left + (isVertical ? oppositeScroll : scroll - start) + _px,
            boxSizing: "border-box",
            position: "fixed"
          };
          override[_width] = override["max" + _Width] = Math.ceil(bounds.width) + _px;
          override[_height] = override["max" + _Height] = Math.ceil(bounds.height) + _px;
          override[_margin] = override[_margin + _Top] = override[_margin + _Right] = override[_margin + _Bottom] = override[_margin + _Left] = "0";
          override[_padding] = cs2[_padding];
          override[_padding + _Top] = cs2[_padding + _Top];
          override[_padding + _Right] = cs2[_padding + _Right];
          override[_padding + _Bottom] = cs2[_padding + _Bottom];
          override[_padding + _Left] = cs2[_padding + _Left];
          pinActiveState = _copyState(pinOriginalState, override, pinReparent);
          _refreshingAll && scrollFunc(0);
        }
        if (animation) {
          initted = animation._initted;
          _suppressOverwrites(1);
          animation.render(animation.duration(), true, true);
          pinChange = pinGetter(direction.a) - pinStart + change + otherPinOffset;
          pinMoves = Math.abs(change - pinChange) > 1;
          useFixedPosition && pinMoves && pinActiveState.splice(pinActiveState.length - 2, 2);
          animation.render(0, true, true);
          initted || animation.invalidate(true);
          animation.parent || animation.totalTime(animation.totalTime());
          _suppressOverwrites(0);
        } else {
          pinChange = change;
        }
        forcedOverflow && (forcedOverflow.value ? forcedOverflow.style["overflow" + direction.a.toUpperCase()] = forcedOverflow.value : forcedOverflow.style.removeProperty("overflow-" + direction.a));
      } else if (trigger && scrollFunc() && !containerAnimation) {
        bounds = trigger.parentNode;
        while (bounds && bounds !== _body) {
          if (bounds._pinOffset) {
            start -= bounds._pinOffset;
            end -= bounds._pinOffset;
          }
          bounds = bounds.parentNode;
        }
      }
      revertedPins && revertedPins.forEach(function(t) {
        return t.revert(false, true);
      });
      self.start = start;
      self.end = end;
      scroll1 = scroll2 = _refreshingAll ? prevScroll : scrollFunc();
      if (!containerAnimation && !_refreshingAll) {
        scroll1 < prevScroll && scrollFunc(prevScroll);
        self.scroll.rec = 0;
      }
      self.revert(false, true);
      lastRefresh = _getTime();
      if (snapDelayedCall) {
        lastSnap = -1;
        snapDelayedCall.restart(true);
      }
      _refreshing = 0;
      animation && isToggle && (animation._initted || prevAnimProgress) && animation.progress() !== prevAnimProgress && animation.progress(prevAnimProgress || 0, true).render(animation.time(), true, true);
      if (isFirstRefresh || prevProgress !== self.progress || containerAnimation || invalidateOnRefresh || animation && !animation._initted) {
        animation && !isToggle && (animation._initted || prevProgress || animation.vars.immediateRender !== false) && animation.totalProgress(containerAnimation && start < -1e-3 && !prevProgress ? gsap.utils.normalize(start, end, 0) : prevProgress, true);
        self.progress = isFirstRefresh || (scroll1 - start) / change === prevProgress ? 0 : prevProgress;
      }
      pin && pinSpacing && (spacer._pinOffset = Math.round(self.progress * pinChange));
      scrubTween && scrubTween.invalidate();
      if (!isNaN(markerStartOffset)) {
        markerStartOffset -= gsap.getProperty(markerStartTrigger, direction.p);
        markerEndOffset -= gsap.getProperty(markerEndTrigger, direction.p);
        _shiftMarker(markerStartTrigger, direction, markerStartOffset);
        _shiftMarker(markerStart, direction, markerStartOffset - (pinOffset || 0));
        _shiftMarker(markerEndTrigger, direction, markerEndOffset);
        _shiftMarker(markerEnd, direction, markerEndOffset - (pinOffset || 0));
      }
      isFirstRefresh && !_refreshingAll && self.update();
      if (onRefresh && !_refreshingAll && !executingOnRefresh) {
        executingOnRefresh = true;
        onRefresh(self);
        executingOnRefresh = false;
      }
    };
    self.getVelocity = function() {
      return (scrollFunc() - scroll2) / (_getTime() - _time2) * 1e3 || 0;
    };
    self.endAnimation = function() {
      _endAnimation(self.callbackAnimation);
      if (animation) {
        scrubTween ? scrubTween.progress(1) : !animation.paused() ? _endAnimation(animation, animation.reversed()) : isToggle || _endAnimation(animation, self.direction < 0, 1);
      }
    };
    self.labelToScroll = function(label) {
      return animation && animation.labels && (start || self.refresh() || start) + animation.labels[label] / animation.duration() * change || 0;
    };
    self.getTrailing = function(name) {
      var i = _triggers.indexOf(self), a = self.direction > 0 ? _triggers.slice(0, i).reverse() : _triggers.slice(i + 1);
      return (_isString(name) ? a.filter(function(t) {
        return t.vars.preventOverlaps === name;
      }) : a).filter(function(t) {
        return self.direction > 0 ? t.end <= start : t.start >= end;
      });
    };
    self.update = function(reset, recordVelocity, forceFake) {
      if (containerAnimation && !forceFake && !reset) {
        return;
      }
      var scroll = _refreshingAll === true ? prevScroll : self.scroll(), p = reset ? 0 : (scroll - start) / change, clipped = p < 0 ? 0 : p > 1 ? 1 : p || 0, prevProgress2 = self.progress, isActive, wasActive, toggleState, action, stateChanged, toggled, isAtMax, isTakingAction;
      if (recordVelocity) {
        scroll2 = scroll1;
        scroll1 = containerAnimation ? scrollFunc() : scroll;
        if (snap) {
          snap2 = snap1;
          snap1 = animation && !isToggle ? animation.totalProgress() : clipped;
        }
      }
      if (anticipatePin && pin && !_refreshing && !_startup && _lastScrollTime) {
        if (!clipped && start < scroll + (scroll - scroll2) / (_getTime() - _time2) * anticipatePin) {
          clipped = 1e-4;
        } else if (clipped === 1 && end > scroll + (scroll - scroll2) / (_getTime() - _time2) * anticipatePin) {
          clipped = 0.9999;
        }
      }
      if (clipped !== prevProgress2 && self.enabled) {
        isActive = self.isActive = !!clipped && clipped < 1;
        wasActive = !!prevProgress2 && prevProgress2 < 1;
        toggled = isActive !== wasActive;
        stateChanged = toggled || !!clipped !== !!prevProgress2;
        self.direction = clipped > prevProgress2 ? 1 : -1;
        self.progress = clipped;
        if (stateChanged && !_refreshing) {
          toggleState = clipped && !prevProgress2 ? 0 : clipped === 1 ? 1 : prevProgress2 === 1 ? 2 : 3;
          if (isToggle) {
            action = !toggled && toggleActions[toggleState + 1] !== "none" && toggleActions[toggleState + 1] || toggleActions[toggleState];
            isTakingAction = animation && (action === "complete" || action === "reset" || action in animation);
          }
        }
        preventOverlaps && (toggled || isTakingAction) && (isTakingAction || scrub || !animation) && (_isFunction(preventOverlaps) ? preventOverlaps(self) : self.getTrailing(preventOverlaps).forEach(function(t) {
          return t.endAnimation();
        }));
        if (!isToggle) {
          if (scrubTween && !_refreshing && !_startup) {
            scrubTween._dp._time - scrubTween._start !== scrubTween._time && scrubTween.render(scrubTween._dp._time - scrubTween._start);
            if (scrubTween.resetTo) {
              scrubTween.resetTo("totalProgress", clipped, animation._tTime / animation._tDur);
            } else {
              scrubTween.vars.totalProgress = clipped;
              scrubTween.invalidate().restart();
            }
          } else if (animation) {
            animation.totalProgress(clipped, !!(_refreshing && (lastRefresh || reset)));
          }
        }
        if (pin) {
          reset && pinSpacing && (spacer.style[pinSpacing + direction.os2] = spacingStart);
          if (!useFixedPosition) {
            pinSetter(_round(pinStart + pinChange * clipped));
          } else if (stateChanged) {
            isAtMax = !reset && clipped > prevProgress2 && end + 1 > scroll && scroll + 1 >= _maxScroll(scroller, direction);
            if (pinReparent) {
              if (!reset && (isActive || isAtMax)) {
                var bounds = _getBounds(pin, true), _offset = scroll - start;
                _reparent(pin, _body, bounds.top + (direction === _vertical ? _offset : 0) + _px, bounds.left + (direction === _vertical ? 0 : _offset) + _px);
              } else {
                _reparent(pin, spacer);
              }
            }
            _setState(isActive || isAtMax ? pinActiveState : pinState);
            pinMoves && clipped < 1 && isActive || pinSetter(pinStart + (clipped === 1 && !isAtMax ? pinChange : 0));
          }
        }
        snap && !tweenTo.tween && !_refreshing && !_startup && snapDelayedCall.restart(true);
        toggleClass && (toggled || once && clipped && (clipped < 1 || !_limitCallbacks)) && _toArray(toggleClass.targets).forEach(function(el) {
          return el.classList[isActive || once ? "add" : "remove"](toggleClass.className);
        });
        onUpdate && !isToggle && !reset && onUpdate(self);
        if (stateChanged && !_refreshing) {
          if (isToggle) {
            if (isTakingAction) {
              if (action === "complete") {
                animation.pause().totalProgress(1);
              } else if (action === "reset") {
                animation.restart(true).pause();
              } else if (action === "restart") {
                animation.restart(true);
              } else {
                animation[action]();
              }
            }
            onUpdate && onUpdate(self);
          }
          if (toggled || !_limitCallbacks) {
            onToggle && toggled && _callback(self, onToggle);
            callbacks[toggleState] && _callback(self, callbacks[toggleState]);
            once && (clipped === 1 ? self.kill(false, 1) : callbacks[toggleState] = 0);
            if (!toggled) {
              toggleState = clipped === 1 ? 1 : 3;
              callbacks[toggleState] && _callback(self, callbacks[toggleState]);
            }
          }
          if (fastScrollEnd && !isActive && Math.abs(self.getVelocity()) > (_isNumber(fastScrollEnd) ? fastScrollEnd : 2500)) {
            _endAnimation(self.callbackAnimation);
            scrubTween ? scrubTween.progress(1) : _endAnimation(animation, action === "reverse" ? 1 : !clipped, 1);
          }
        } else if (isToggle && onUpdate && !_refreshing) {
          onUpdate(self);
        }
      }
      if (markerEndSetter) {
        var n = containerAnimation ? scroll / containerAnimation.duration() * (containerAnimation._caScrollDist || 0) : scroll;
        markerStartSetter(n + (markerStartTrigger._isFlipped ? 1 : 0));
        markerEndSetter(n);
      }
      caMarkerSetter && caMarkerSetter(-scroll / containerAnimation.duration() * (containerAnimation._caScrollDist || 0));
    };
    self.enable = function(reset, refresh) {
      if (!self.enabled) {
        self.enabled = true;
        _addListener(scroller, "resize", _onResize);
        isViewport || _addListener(scroller, "scroll", _onScroll);
        onRefreshInit && _addListener(ScrollTrigger2, "refreshInit", onRefreshInit);
        if (reset !== false) {
          self.progress = prevProgress = 0;
          scroll1 = scroll2 = lastSnap = scrollFunc();
        }
        refresh !== false && self.refresh();
      }
    };
    self.getTween = function(snap3) {
      return snap3 && tweenTo ? tweenTo.tween : scrubTween;
    };
    self.setPositions = function(newStart, newEnd, keepClamp, pinOffset) {
      if (containerAnimation) {
        var st = containerAnimation.scrollTrigger, duration = containerAnimation.duration(), _change = st.end - st.start;
        newStart = st.start + _change * newStart / duration;
        newEnd = st.start + _change * newEnd / duration;
      }
      self.refresh(false, false, {
        start: _keepClamp(newStart, keepClamp && !!self._startClamp),
        end: _keepClamp(newEnd, keepClamp && !!self._endClamp)
      }, pinOffset);
      self.update();
    };
    self.adjustPinSpacing = function(amount) {
      if (spacerState && amount) {
        var i = spacerState.indexOf(direction.d) + 1;
        spacerState[i] = parseFloat(spacerState[i]) + amount + _px;
        spacerState[1] = parseFloat(spacerState[1]) + amount + _px;
        _setState(spacerState);
      }
    };
    self.disable = function(reset, allowAnimation) {
      if (self.enabled) {
        reset !== false && self.revert(true, true);
        self.enabled = self.isActive = false;
        allowAnimation || scrubTween && scrubTween.pause();
        prevScroll = 0;
        pinCache && (pinCache.uncache = 1);
        onRefreshInit && _removeListener(ScrollTrigger2, "refreshInit", onRefreshInit);
        if (snapDelayedCall) {
          snapDelayedCall.pause();
          tweenTo.tween && tweenTo.tween.kill() && (tweenTo.tween = 0);
        }
        if (!isViewport) {
          var i = _triggers.length;
          while (i--) {
            if (_triggers[i].scroller === scroller && _triggers[i] !== self) {
              return;
            }
          }
          _removeListener(scroller, "resize", _onResize);
          isViewport || _removeListener(scroller, "scroll", _onScroll);
        }
      }
    };
    self.kill = function(revert, allowAnimation) {
      self.disable(revert, allowAnimation);
      scrubTween && !allowAnimation && scrubTween.kill();
      id && delete _ids[id];
      var i = _triggers.indexOf(self);
      i >= 0 && _triggers.splice(i, 1);
      i === _i && _direction > 0 && _i--;
      i = 0;
      _triggers.forEach(function(t) {
        return t.scroller === self.scroller && (i = 1);
      });
      i || _refreshingAll || (self.scroll.rec = 0);
      if (animation) {
        animation.scrollTrigger = null;
        revert && animation.revert({
          kill: false
        });
        allowAnimation || animation.kill();
      }
      markerStart && [markerStart, markerEnd, markerStartTrigger, markerEndTrigger].forEach(function(m) {
        return m.parentNode && m.parentNode.removeChild(m);
      });
      _primary === self && (_primary = 0);
      if (pin) {
        pinCache && (pinCache.uncache = 1);
        i = 0;
        _triggers.forEach(function(t) {
          return t.pin === pin && i++;
        });
        i || (pinCache.spacer = 0);
      }
      vars.onKill && vars.onKill(self);
    };
    _triggers.push(self);
    self.enable(false, false);
    customRevertReturn && customRevertReturn(self);
    if (animation && animation.add && !change) {
      var updateFunc = self.update;
      self.update = function() {
        self.update = updateFunc;
        _scrollers.cache++;
        start || end || self.refresh();
      };
      gsap.delayedCall(0.01, self.update);
      change = 0.01;
      start = end = 0;
    } else {
      self.refresh();
    }
    pin && _queueRefreshAll();
  };
  ScrollTrigger2.register = function register(core) {
    if (!_coreInitted) {
      gsap = core || _getGSAP();
      _windowExists() && window.document && ScrollTrigger2.enable();
      _coreInitted = _enabled;
    }
    return _coreInitted;
  };
  ScrollTrigger2.defaults = function defaults(config) {
    if (config) {
      for (var p in config) {
        _defaults[p] = config[p];
      }
    }
    return _defaults;
  };
  ScrollTrigger2.disable = function disable(reset, kill) {
    _enabled = 0;
    _triggers.forEach(function(trigger) {
      return trigger[kill ? "kill" : "disable"](reset);
    });
    _removeListener(_win, "wheel", _onScroll);
    _removeListener(_doc, "scroll", _onScroll);
    clearInterval(_syncInterval);
    _removeListener(_doc, "touchcancel", _passThrough);
    _removeListener(_body, "touchstart", _passThrough);
    _multiListener(_removeListener, _doc, "pointerdown,touchstart,mousedown", _pointerDownHandler);
    _multiListener(_removeListener, _doc, "pointerup,touchend,mouseup", _pointerUpHandler);
    _resizeDelay.kill();
    _iterateAutoRefresh(_removeListener);
    for (var i = 0; i < _scrollers.length; i += 3) {
      _wheelListener(_removeListener, _scrollers[i], _scrollers[i + 1]);
      _wheelListener(_removeListener, _scrollers[i], _scrollers[i + 2]);
    }
  };
  ScrollTrigger2.enable = function enable() {
    _win = window;
    _doc = document;
    _docEl = _doc.documentElement;
    _body = _doc.body;
    if (gsap) {
      _toArray = gsap.utils.toArray;
      _clamp = gsap.utils.clamp;
      _context = gsap.core.context || _passThrough;
      _suppressOverwrites = gsap.core.suppressOverwrites || _passThrough;
      _scrollRestoration = _win.history.scrollRestoration || "auto";
      _lastScroll = _win.pageYOffset || 0;
      gsap.core.globals("ScrollTrigger", ScrollTrigger2);
      if (_body) {
        _enabled = 1;
        _div100vh = document.createElement("div");
        _div100vh.style.height = "100vh";
        _div100vh.style.position = "absolute";
        _refresh100vh();
        _rafBugFix();
        Observer.register(gsap);
        ScrollTrigger2.isTouch = Observer.isTouch;
        _fixIOSBug = Observer.isTouch && /(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent);
        _ignoreMobileResize = Observer.isTouch === 1;
        _addListener(_win, "wheel", _onScroll);
        _root = [_win, _doc, _docEl, _body];
        if (gsap.matchMedia) {
          ScrollTrigger2.matchMedia = function(vars) {
            var mm = gsap.matchMedia(), p;
            for (p in vars) {
              mm.add(p, vars[p]);
            }
            return mm;
          };
          gsap.addEventListener("matchMediaInit", function() {
            return _revertAll();
          });
          gsap.addEventListener("matchMediaRevert", function() {
            return _revertRecorded();
          });
          gsap.addEventListener("matchMedia", function() {
            _refreshAll(0, 1);
            _dispatch("matchMedia");
          });
          gsap.matchMedia().add("(orientation: portrait)", function() {
            _setBaseDimensions();
            return _setBaseDimensions;
          });
        } else {
          console.warn("Requires GSAP 3.11.0 or later");
        }
        _setBaseDimensions();
        _addListener(_doc, "scroll", _onScroll);
        var bodyHasStyle = _body.hasAttribute("style"), bodyStyle = _body.style, border = bodyStyle.borderTopStyle, AnimationProto = gsap.core.Animation.prototype, bounds, i;
        AnimationProto.revert || Object.defineProperty(AnimationProto, "revert", {
          value: function value() {
            return this.time(-0.01, true);
          }
        });
        bodyStyle.borderTopStyle = "solid";
        bounds = _getBounds(_body);
        _vertical.m = Math.round(bounds.top + _vertical.sc()) || 0;
        _horizontal.m = Math.round(bounds.left + _horizontal.sc()) || 0;
        border ? bodyStyle.borderTopStyle = border : bodyStyle.removeProperty("border-top-style");
        if (!bodyHasStyle) {
          _body.setAttribute("style", "");
          _body.removeAttribute("style");
        }
        _syncInterval = setInterval(_sync, 250);
        gsap.delayedCall(0.5, function() {
          return _startup = 0;
        });
        _addListener(_doc, "touchcancel", _passThrough);
        _addListener(_body, "touchstart", _passThrough);
        _multiListener(_addListener, _doc, "pointerdown,touchstart,mousedown", _pointerDownHandler);
        _multiListener(_addListener, _doc, "pointerup,touchend,mouseup", _pointerUpHandler);
        _transformProp = gsap.utils.checkPrefix("transform");
        _stateProps.push(_transformProp);
        _coreInitted = _getTime();
        _resizeDelay = gsap.delayedCall(0.2, _refreshAll).pause();
        _autoRefresh = [_doc, "visibilitychange", function() {
          var w = _win.innerWidth, h = _win.innerHeight;
          if (_doc.hidden) {
            _prevWidth = w;
            _prevHeight = h;
          } else if (_prevWidth !== w || _prevHeight !== h) {
            _onResize();
          }
        }, _doc, "DOMContentLoaded", _refreshAll, _win, "load", _refreshAll, _win, "resize", _onResize];
        _iterateAutoRefresh(_addListener);
        _triggers.forEach(function(trigger) {
          return trigger.enable(0, 1);
        });
        for (i = 0; i < _scrollers.length; i += 3) {
          _wheelListener(_removeListener, _scrollers[i], _scrollers[i + 1]);
          _wheelListener(_removeListener, _scrollers[i], _scrollers[i + 2]);
        }
      }
    }
  };
  ScrollTrigger2.config = function config(vars) {
    "limitCallbacks" in vars && (_limitCallbacks = !!vars.limitCallbacks);
    var ms = vars.syncInterval;
    ms && clearInterval(_syncInterval) || (_syncInterval = ms) && setInterval(_sync, ms);
    "ignoreMobileResize" in vars && (_ignoreMobileResize = ScrollTrigger2.isTouch === 1 && vars.ignoreMobileResize);
    if ("autoRefreshEvents" in vars) {
      _iterateAutoRefresh(_removeListener) || _iterateAutoRefresh(_addListener, vars.autoRefreshEvents || "none");
      _ignoreResize = (vars.autoRefreshEvents + "").indexOf("resize") === -1;
    }
  };
  ScrollTrigger2.scrollerProxy = function scrollerProxy(target, vars) {
    var t = _getTarget(target), i = _scrollers.indexOf(t), isViewport = _isViewport(t);
    if (~i) {
      _scrollers.splice(i, isViewport ? 6 : 2);
    }
    if (vars) {
      isViewport ? _proxies.unshift(_win, vars, _body, vars, _docEl, vars) : _proxies.unshift(t, vars);
    }
  };
  ScrollTrigger2.clearMatchMedia = function clearMatchMedia(query) {
    _triggers.forEach(function(t) {
      return t._ctx && t._ctx.query === query && t._ctx.kill(true, true);
    });
  };
  ScrollTrigger2.isInViewport = function isInViewport(element, ratio, horizontal) {
    var bounds = (_isString(element) ? _getTarget(element) : element).getBoundingClientRect(), offset = bounds[horizontal ? _width : _height] * ratio || 0;
    return horizontal ? bounds.right - offset > 0 && bounds.left + offset < _win.innerWidth : bounds.bottom - offset > 0 && bounds.top + offset < _win.innerHeight;
  };
  ScrollTrigger2.positionInViewport = function positionInViewport(element, referencePoint, horizontal) {
    _isString(element) && (element = _getTarget(element));
    var bounds = element.getBoundingClientRect(), size = bounds[horizontal ? _width : _height], offset = referencePoint == null ? size / 2 : referencePoint in _keywords ? _keywords[referencePoint] * size : ~referencePoint.indexOf("%") ? parseFloat(referencePoint) * size / 100 : parseFloat(referencePoint) || 0;
    return horizontal ? (bounds.left + offset) / _win.innerWidth : (bounds.top + offset) / _win.innerHeight;
  };
  ScrollTrigger2.killAll = function killAll(allowListeners) {
    _triggers.slice(0).forEach(function(t) {
      return t.vars.id !== "ScrollSmoother" && t.kill();
    });
    if (allowListeners !== true) {
      var listeners = _listeners.killAll || [];
      _listeners = {};
      listeners.forEach(function(f) {
        return f();
      });
    }
  };
  return ScrollTrigger2;
}();
ScrollTrigger.version = "3.13.0";
ScrollTrigger.saveStyles = function(targets) {
  return targets ? _toArray(targets).forEach(function(target) {
    if (target && target.style) {
      var i = _savedStyles.indexOf(target);
      i >= 0 && _savedStyles.splice(i, 5);
      _savedStyles.push(target, target.style.cssText, target.getBBox && target.getAttribute("transform"), gsap.core.getCache(target), _context());
    }
  }) : _savedStyles;
};
ScrollTrigger.revert = function(soft, media) {
  return _revertAll(!soft, media);
};
ScrollTrigger.create = function(vars, animation) {
  return new ScrollTrigger(vars, animation);
};
ScrollTrigger.refresh = function(safe) {
  return safe ? _onResize(true) : (_coreInitted || ScrollTrigger.register()) && _refreshAll(true);
};
ScrollTrigger.update = function(force) {
  return ++_scrollers.cache && _updateAll(force === true ? 2 : 0);
};
ScrollTrigger.clearScrollMemory = _clearScrollMemory;
ScrollTrigger.maxScroll = function(element, horizontal) {
  return _maxScroll(element, horizontal ? _horizontal : _vertical);
};
ScrollTrigger.getScrollFunc = function(element, horizontal) {
  return _getScrollFunc(_getTarget(element), horizontal ? _horizontal : _vertical);
};
ScrollTrigger.getById = function(id) {
  return _ids[id];
};
ScrollTrigger.getAll = function() {
  return _triggers.filter(function(t) {
    return t.vars.id !== "ScrollSmoother";
  });
};
ScrollTrigger.isScrolling = function() {
  return !!_lastScrollTime;
};
ScrollTrigger.snapDirectional = _snapDirectional;
ScrollTrigger.addEventListener = function(type, callback) {
  var a = _listeners[type] || (_listeners[type] = []);
  ~a.indexOf(callback) || a.push(callback);
};
ScrollTrigger.removeEventListener = function(type, callback) {
  var a = _listeners[type], i = a && a.indexOf(callback);
  i >= 0 && a.splice(i, 1);
};
ScrollTrigger.batch = function(targets, vars) {
  var result = [], varsCopy = {}, interval = vars.interval || 0.016, batchMax = vars.batchMax || 1e9, proxyCallback = function proxyCallback2(type, callback) {
    var elements = [], triggers = [], delay = gsap.delayedCall(interval, function() {
      callback(elements, triggers);
      elements = [];
      triggers = [];
    }).pause();
    return function(self) {
      elements.length || delay.restart(true);
      elements.push(self.trigger);
      triggers.push(self);
      batchMax <= elements.length && delay.progress(1);
    };
  }, p;
  for (p in vars) {
    varsCopy[p] = p.substr(0, 2) === "on" && _isFunction(vars[p]) && p !== "onRefreshInit" ? proxyCallback(p, vars[p]) : vars[p];
  }
  if (_isFunction(batchMax)) {
    batchMax = batchMax();
    _addListener(ScrollTrigger, "refresh", function() {
      return batchMax = vars.batchMax();
    });
  }
  _toArray(targets).forEach(function(target) {
    var config = {};
    for (p in varsCopy) {
      config[p] = varsCopy[p];
    }
    config.trigger = target;
    result.push(ScrollTrigger.create(config));
  });
  return result;
};
var _clampScrollAndGetDurationMultiplier = function _clampScrollAndGetDurationMultiplier2(scrollFunc, current, end, max) {
  current > max ? scrollFunc(max) : current < 0 && scrollFunc(0);
  return end > max ? (max - current) / (end - current) : end < 0 ? current / (current - end) : 1;
}, _allowNativePanning = function _allowNativePanning2(target, direction) {
  if (direction === true) {
    target.style.removeProperty("touch-action");
  } else {
    target.style.touchAction = direction === true ? "auto" : direction ? "pan-" + direction + (Observer.isTouch ? " pinch-zoom" : "") : "none";
  }
  target === _docEl && _allowNativePanning2(_body, direction);
}, _overflow = {
  auto: 1,
  scroll: 1
}, _nestedScroll = function _nestedScroll2(_ref5) {
  var event = _ref5.event, target = _ref5.target, axis = _ref5.axis;
  var node = (event.changedTouches ? event.changedTouches[0] : event).target, cache = node._gsap || gsap.core.getCache(node), time = _getTime(), cs;
  if (!cache._isScrollT || time - cache._isScrollT > 2e3) {
    while (node && node !== _body && (node.scrollHeight <= node.clientHeight && node.scrollWidth <= node.clientWidth || !(_overflow[(cs = _getComputedStyle(node)).overflowY] || _overflow[cs.overflowX]))) {
      node = node.parentNode;
    }
    cache._isScroll = node && node !== target && !_isViewport(node) && (_overflow[(cs = _getComputedStyle(node)).overflowY] || _overflow[cs.overflowX]);
    cache._isScrollT = time;
  }
  if (cache._isScroll || axis === "x") {
    event.stopPropagation();
    event._gsapAllow = true;
  }
}, _inputObserver = function _inputObserver2(target, type, inputs, nested) {
  return Observer.create({
    target,
    capture: true,
    debounce: false,
    lockAxis: true,
    type,
    onWheel: nested = nested && _nestedScroll,
    onPress: nested,
    onDrag: nested,
    onScroll: nested,
    onEnable: function onEnable() {
      return inputs && _addListener(_doc, Observer.eventTypes[0], _captureInputs, false, true);
    },
    onDisable: function onDisable() {
      return _removeListener(_doc, Observer.eventTypes[0], _captureInputs, true);
    }
  });
}, _inputExp = /(input|label|select|textarea)/i, _inputIsFocused, _captureInputs = function _captureInputs2(e) {
  var isInput = _inputExp.test(e.target.tagName);
  if (isInput || _inputIsFocused) {
    e._gsapAllow = true;
    _inputIsFocused = isInput;
  }
}, _getScrollNormalizer = function _getScrollNormalizer2(vars) {
  _isObject(vars) || (vars = {});
  vars.preventDefault = vars.isNormalizer = vars.allowClicks = true;
  vars.type || (vars.type = "wheel,touch");
  vars.debounce = !!vars.debounce;
  vars.id = vars.id || "normalizer";
  var _vars2 = vars, normalizeScrollX = _vars2.normalizeScrollX, momentum = _vars2.momentum, allowNestedScroll = _vars2.allowNestedScroll, onRelease = _vars2.onRelease, self, maxY, target = _getTarget(vars.target) || _docEl, smoother = gsap.core.globals().ScrollSmoother, smootherInstance = smoother && smoother.get(), content = _fixIOSBug && (vars.content && _getTarget(vars.content) || smootherInstance && vars.content !== false && !smootherInstance.smooth() && smootherInstance.content()), scrollFuncY = _getScrollFunc(target, _vertical), scrollFuncX = _getScrollFunc(target, _horizontal), scale = 1, initialScale = (Observer.isTouch && _win.visualViewport ? _win.visualViewport.scale * _win.visualViewport.width : _win.outerWidth) / _win.innerWidth, wheelRefresh = 0, resolveMomentumDuration = _isFunction(momentum) ? function() {
    return momentum(self);
  } : function() {
    return momentum || 2.8;
  }, lastRefreshID, skipTouchMove, inputObserver = _inputObserver(target, vars.type, true, allowNestedScroll), resumeTouchMove = function resumeTouchMove2() {
    return skipTouchMove = false;
  }, scrollClampX = _passThrough, scrollClampY = _passThrough, updateClamps = function updateClamps2() {
    maxY = _maxScroll(target, _vertical);
    scrollClampY = _clamp(_fixIOSBug ? 1 : 0, maxY);
    normalizeScrollX && (scrollClampX = _clamp(0, _maxScroll(target, _horizontal)));
    lastRefreshID = _refreshID;
  }, removeContentOffset = function removeContentOffset2() {
    content._gsap.y = _round(parseFloat(content._gsap.y) + scrollFuncY.offset) + "px";
    content.style.transform = "matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, " + parseFloat(content._gsap.y) + ", 0, 1)";
    scrollFuncY.offset = scrollFuncY.cacheID = 0;
  }, ignoreDrag = function ignoreDrag2() {
    if (skipTouchMove) {
      requestAnimationFrame(resumeTouchMove);
      var offset = _round(self.deltaY / 2), scroll = scrollClampY(scrollFuncY.v - offset);
      if (content && scroll !== scrollFuncY.v + scrollFuncY.offset) {
        scrollFuncY.offset = scroll - scrollFuncY.v;
        var y = _round((parseFloat(content && content._gsap.y) || 0) - scrollFuncY.offset);
        content.style.transform = "matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, " + y + ", 0, 1)";
        content._gsap.y = y + "px";
        scrollFuncY.cacheID = _scrollers.cache;
        _updateAll();
      }
      return true;
    }
    scrollFuncY.offset && removeContentOffset();
    skipTouchMove = true;
  }, tween, startScrollX, startScrollY, onStopDelayedCall, onResize = function onResize2() {
    updateClamps();
    if (tween.isActive() && tween.vars.scrollY > maxY) {
      scrollFuncY() > maxY ? tween.progress(1) && scrollFuncY(maxY) : tween.resetTo("scrollY", maxY);
    }
  };
  content && gsap.set(content, {
    y: "+=0"
  });
  vars.ignoreCheck = function(e) {
    return _fixIOSBug && e.type === "touchmove" && ignoreDrag() || scale > 1.05 && e.type !== "touchstart" || self.isGesturing || e.touches && e.touches.length > 1;
  };
  vars.onPress = function() {
    skipTouchMove = false;
    var prevScale = scale;
    scale = _round((_win.visualViewport && _win.visualViewport.scale || 1) / initialScale);
    tween.pause();
    prevScale !== scale && _allowNativePanning(target, scale > 1.01 ? true : normalizeScrollX ? false : "x");
    startScrollX = scrollFuncX();
    startScrollY = scrollFuncY();
    updateClamps();
    lastRefreshID = _refreshID;
  };
  vars.onRelease = vars.onGestureStart = function(self2, wasDragging) {
    scrollFuncY.offset && removeContentOffset();
    if (!wasDragging) {
      onStopDelayedCall.restart(true);
    } else {
      _scrollers.cache++;
      var dur = resolveMomentumDuration(), currentScroll, endScroll;
      if (normalizeScrollX) {
        currentScroll = scrollFuncX();
        endScroll = currentScroll + dur * 0.05 * -self2.velocityX / 0.227;
        dur *= _clampScrollAndGetDurationMultiplier(scrollFuncX, currentScroll, endScroll, _maxScroll(target, _horizontal));
        tween.vars.scrollX = scrollClampX(endScroll);
      }
      currentScroll = scrollFuncY();
      endScroll = currentScroll + dur * 0.05 * -self2.velocityY / 0.227;
      dur *= _clampScrollAndGetDurationMultiplier(scrollFuncY, currentScroll, endScroll, _maxScroll(target, _vertical));
      tween.vars.scrollY = scrollClampY(endScroll);
      tween.invalidate().duration(dur).play(0.01);
      if (_fixIOSBug && tween.vars.scrollY >= maxY || currentScroll >= maxY - 1) {
        gsap.to({}, {
          onUpdate: onResize,
          duration: dur
        });
      }
    }
    onRelease && onRelease(self2);
  };
  vars.onWheel = function() {
    tween._ts && tween.pause();
    if (_getTime() - wheelRefresh > 1e3) {
      lastRefreshID = 0;
      wheelRefresh = _getTime();
    }
  };
  vars.onChange = function(self2, dx, dy, xArray, yArray) {
    _refreshID !== lastRefreshID && updateClamps();
    dx && normalizeScrollX && scrollFuncX(scrollClampX(xArray[2] === dx ? startScrollX + (self2.startX - self2.x) : scrollFuncX() + dx - xArray[1]));
    if (dy) {
      scrollFuncY.offset && removeContentOffset();
      var isTouch = yArray[2] === dy, y = isTouch ? startScrollY + self2.startY - self2.y : scrollFuncY() + dy - yArray[1], yClamped = scrollClampY(y);
      isTouch && y !== yClamped && (startScrollY += yClamped - y);
      scrollFuncY(yClamped);
    }
    (dy || dx) && _updateAll();
  };
  vars.onEnable = function() {
    _allowNativePanning(target, normalizeScrollX ? false : "x");
    ScrollTrigger.addEventListener("refresh", onResize);
    _addListener(_win, "resize", onResize);
    if (scrollFuncY.smooth) {
      scrollFuncY.target.style.scrollBehavior = "auto";
      scrollFuncY.smooth = scrollFuncX.smooth = false;
    }
    inputObserver.enable();
  };
  vars.onDisable = function() {
    _allowNativePanning(target, true);
    _removeListener(_win, "resize", onResize);
    ScrollTrigger.removeEventListener("refresh", onResize);
    inputObserver.kill();
  };
  vars.lockAxis = vars.lockAxis !== false;
  self = new Observer(vars);
  self.iOS = _fixIOSBug;
  _fixIOSBug && !scrollFuncY() && scrollFuncY(1);
  _fixIOSBug && gsap.ticker.add(_passThrough);
  onStopDelayedCall = self._dc;
  tween = gsap.to(self, {
    ease: "power4",
    paused: true,
    inherit: false,
    scrollX: normalizeScrollX ? "+=0.1" : "+=0",
    scrollY: "+=0.1",
    modifiers: {
      scrollY: _interruptionTracker(scrollFuncY, scrollFuncY(), function() {
        return tween.pause();
      })
    },
    onUpdate: _updateAll,
    onComplete: onStopDelayedCall.vars.onComplete
  });
  return self;
};
ScrollTrigger.sort = function(func) {
  if (_isFunction(func)) {
    return _triggers.sort(func);
  }
  var scroll = _win.pageYOffset || 0;
  ScrollTrigger.getAll().forEach(function(t) {
    return t._sortY = t.trigger ? scroll + t.trigger.getBoundingClientRect().top : t.start + _win.innerHeight;
  });
  return _triggers.sort(func || function(a, b) {
    return (a.vars.refreshPriority || 0) * -1e6 + (a.vars.containerAnimation ? 1e6 : a._sortY) - ((b.vars.containerAnimation ? 1e6 : b._sortY) + (b.vars.refreshPriority || 0) * -1e6);
  });
};
ScrollTrigger.observe = function(vars) {
  return new Observer(vars);
};
ScrollTrigger.normalizeScroll = function(vars) {
  if (typeof vars === "undefined") {
    return _normalizer;
  }
  if (vars === true && _normalizer) {
    return _normalizer.enable();
  }
  if (vars === false) {
    _normalizer && _normalizer.kill();
    _normalizer = vars;
    return;
  }
  var normalizer = vars instanceof Observer ? vars : _getScrollNormalizer(vars);
  _normalizer && _normalizer.target === normalizer.target && _normalizer.kill();
  _isViewport(normalizer.target) && (_normalizer = normalizer);
  return normalizer;
};
ScrollTrigger.core = {
  // smaller file size way to leverage in ScrollSmoother and Observer
  _getVelocityProp,
  _inputObserver,
  _scrollers,
  _proxies,
  bridge: {
    // when normalizeScroll sets the scroll position (ss = setScroll)
    ss: function ss() {
      _lastScrollTime || _dispatch("scrollStart");
      _lastScrollTime = _getTime();
    },
    // a way to get the _refreshing value in Observer
    ref: function ref() {
      return _refreshing;
    }
  }
};
_getGSAP() && gsap.registerPlugin(ScrollTrigger);

gsapWithCSS.registerPlugin(ScrollTrigger);
const LandingPage = () => {
  const [, setLocation] = useLocation();
  const [showPrizeDetails, setShowPrizeDetails] = reactExports.useState(false);
  const [showAgeVerification, setShowAgeVerification] = reactExports.useState(false);
  const [showInviteFriend, setShowInviteFriend] = reactExports.useState(false);
  const [showEmergencyLogin, setShowEmergencyLogin] = reactExports.useState(false);
  const [flippedCards, setFlippedCards] = reactExports.useState([]);
  const [imageLoaded, setImageLoaded] = reactExports.useState(false);
  const { t } = useLandingTranslations();
  const heroRef = reactExports.useRef(null);
  const titleRef = reactExports.useRef(null);
  const sectionsRef = reactExports.useRef([]);
  const [isTypingComplete, setIsTypingComplete] = reactExports.useState(false);
  reactExports.useEffect(() => {
    if (titleRef.current) {
      gsapWithCSS.fromTo(
        titleRef.current.children,
        { y: 100, opacity: 0 },
        { y: 0, opacity: 1, duration: 1, stagger: 0.15, ease: "power2.out" }
      );
    }
    sectionsRef.current.forEach((section, index) => {
      if (section) {
        gsapWithCSS.fromTo(
          section,
          { y: 30, opacity: 0 },
          {
            y: 0,
            opacity: 1,
            duration: 0.6,
            scrollTrigger: {
              trigger: section,
              start: "top 85%",
              end: "bottom 15%",
              toggleActions: "play none none reverse",
              fastScrollEnd: true
            }
          }
        );
      }
    });
    return () => {
      ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
    };
  }, []);
  reactExports.useEffect(() => {
    const handleStatusBarTap = (e) => {
      if (e.touches[0].clientY <= 44 && window.scrollY > 100) {
        e.preventDefault();
        window.scrollTo({
          top: 0,
          behavior: "smooth"
        });
      }
    };
    if ("ontouchstart" in window) {
      document.addEventListener("touchstart", handleStatusBarTap, { passive: false });
    }
    return () => {
      if ("ontouchstart" in window) {
        document.removeEventListener("touchstart", handleStatusBarTap);
      }
    };
  }, []);
  const [logoClickCount, setLogoClickCount] = reactExports.useState(0);
  reactExports.useEffect(() => {
    const handleKeySequence = (e) => {
      if (e.ctrlKey && e.shiftKey && e.key === "E") {
        setShowEmergencyLogin(true);
        e.preventDefault();
      }
    };
    document.addEventListener("keydown", handleKeySequence);
    return () => document.removeEventListener("keydown", handleKeySequence);
  }, []);
  const handleRegisterClick = () => {
    setLocation("/register");
  };
  const openInviteFriend = () => {
    setShowInviteFriend(true);
  };
  const handleCardClick = (index) => {
    setFlippedCards(
      (prev) => prev.includes(index) ? [] : [index]
      // Altrimenti apri solo questa
    );
  };
  const steps = [
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(UserCheck, { className: "w-8 h-8 text-[#00E5FF]" }),
      title: "Registrazione",
      description: "Crea il tuo account su M1SSION e preparati alla sfida",
      details: "Accesso gratuito con il piano Base. Scegli tra 5 piani di abbonamento per accedere a indizi premium, eventi esclusivi e vantaggi unici. La registrazione include verifica dell'identit per garantire sicurezza e conformit normativa."
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-8 h-8 text-[#00E5FF]" }),
      title: "Ricevi Indizi",
      description: "Ogni settimana ricevi nuovi indizi via app ed email",
      details: "Gli indizi arrivano attraverso notifiche push, email crittografate e aggiornamenti in-app. Ogni piano offre un numero diverso di indizi settimanali: dal piano Base (1 indizio) al Titanium (8 indizi totali)."
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-8 h-8 text-[#FFC107]" }),
      title: "Risolvi la Missione",
      description: "Analizza gli indizi e trova la posizione del premio",
      details: "Usa la mappa interattiva, decrittografa i codici, analizza pattern e coordinate GPS. Gli indizi sono interconnessi e richiedono logica, intuito e capacit di analisi per rivelare la posizione finale del tesoro."
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-8 h-8 text-[#FF00FF]" }),
      title: "Vinci davvero",
      description: "Se sei il primo a trovare il premio, diventa tuo!",
      details: "I premi sono reali: auto di lusso, orologi, gioielli e altri oggetti di valore. Solo il primo che raggiunge la posizione esatta e completa la verifica finale ottiene il premio. Nessuna simulazione, solo vittorie concrete."
    }
  ];
  const subscriptions = [
    {
      title: "Base  Gratis",
      price: "0",
      period: "/mese",
      highlight: false,
      features: [
        "Funzioni base (accesso alla missione con restrizioni)",
        "Supporto email standard",
        "1 indizio settimanale base"
      ],
      notIncluded: [
        "Nessun accesso anticipato agli eventi",
        "Nessun badge esclusivo"
      ],
      buttonText: "Inizia Gratis",
      buttonColor: "bg-gradient-to-r from-[#00E5FF] to-[#008eb3] text-black hover:shadow-[0_0_15px_rgba(0,229,255,0.5)]"
    },
    {
      title: "Silver",
      price: "3.99",
      period: "/mese",
      features: [
        "Tutti i vantaggi Base",
        "3 indizi premium aggiuntivi a settimana",
        "Accesso anticipato di 2 ore agli eventi",
        "Badge Silver nel profilo"
      ],
      buttonText: "Scegli Silver",
      buttonColor: "bg-gradient-to-r from-[#C0C0C0] to-[#919191] text-black hover:shadow-[0_0_15px_rgba(192,192,192,0.5)]"
    },
    {
      title: "Gold",
      price: "6.99",
      period: "/mese",
      highlight: true,
      features: [
        "Tutti i vantaggi Silver",
        "4 indizi premium aggiuntivi a settimana",
        "Accesso anticipato di 12 ore agli eventi",
        "Partecipazione alle estrazioni Gold",
        "Badge Gold esclusivo nel profilo"
      ],
      buttonText: "Scegli Gold",
      buttonColor: "bg-gradient-to-r from-[#FFD700] to-[#FFA500] text-black hover:shadow-[0_0_15px_rgba(255,215,0,0.5)]"
    },
    {
      title: "Black",
      price: "9.99",
      period: "/mese",
      features: [
        "Tutti i vantaggi Gold",
        "Accesso VIP anticipato di 24 ore agli eventi",
        "5 indizi premium aggiuntivi a settimana",
        "Badge Black esclusivo"
      ],
      buttonText: "Scegli Black",
      buttonColor: "bg-gradient-to-r from-[#1A1A1A] to-[#333333] text-white hover:shadow-[0_0_15px_rgba(0,0,0,0.7)]"
    },
    {
      title: "Titanium",
      price: "29.99",
      period: "/mese",
      features: [
        "Tutti i vantaggi Black",
        "7 indizi premium aggiuntivi a settimana",
        "Accesso VIP anticipato di 48 ore agli eventi",
        "Supporto prioritario dedicato (24/7)",
        "Eventi esclusivi M1SSION",
        "Badge Titanium esclusivo"
      ],
      buttonText: "Scegli Titanium",
      buttonColor: "bg-gradient-to-r from-[#E6E6FA] to-[#FFD700] text-black hover:shadow-[0_0_15px_rgba(230,230,250,0.8)]"
    }
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-black overflow-x-hidden relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "fixed inset-0 pointer-events-none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-black via-gray-900 to-black opacity-80" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-[radial-gradient(circle_at_20%_50%,rgba(0,229,255,0.1),transparent_50%)]" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-[radial-gradient(circle_at_80%_20%,rgba(255,0,255,0.1),transparent_50%)]" }),
      [...Array(30)].map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "absolute rounded-full opacity-20",
          style: {
            width: `${Math.random() * 4 + 2}px`,
            height: `${Math.random() * 4 + 2}px`,
            background: i % 2 === 0 ? "#00E5FF" : "#FF00FF",
            left: `${Math.random() * 100}%`,
            top: `${Math.random() * 100}%`
          },
          animate: {
            y: [0, -30, 0],
            x: [0, 15, -15, 0],
            opacity: [0.1, 0.3, 0.1]
          },
          transition: {
            duration: Math.random() * 20 + 15,
            repeat: Infinity,
            ease: "easeInOut",
            delay: Math.random() * 10
          }
        },
        i
      ))
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "fixed bottom-8 right-8 z-40 flex flex-col gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.button,
        {
          onClick: () => setShowPrizeDetails(true),
          className: "p-4 rounded-full bg-cyan-500/20 backdrop-blur-sm border border-cyan-400/30 text-cyan-400 hover:bg-cyan-500/30 transition-all duration-300",
          whileHover: { scale: 1.1 },
          whileTap: { scale: 0.95 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "h-6 w-6" })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.button,
        {
          onClick: openInviteFriend,
          className: "p-4 rounded-full bg-purple-500/20 backdrop-blur-sm border border-purple-400/30 text-purple-400 hover:bg-purple-500/30 transition-all duration-300",
          whileHover: { scale: 1.1 },
          whileTap: { scale: 0.95 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(UserPlus, { className: "h-6 w-6" })
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "section",
      {
        ref: heroRef,
        className: "relative min-h-screen w-full flex flex-col items-center justify-center text-center px-4 py-20 overflow-hidden",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "z-10 max-w-6xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "h1",
              {
                ref: titleRef,
                className: "text-6xl md:text-7xl lg:text-[8rem] font-black leading-none mb-6",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 glow-text block drop-shadow-[0_0_30px_rgba(0,229,255,0.8)]", children: "M1" }) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "overflow-hidden -mt-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white block", children: [
                    "SSION",
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-2xl align-top", children: "" })
                  ] }) })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.p,
              {
                className: "text-2xl md:text-3xl font-light tracking-[0.3em] mb-12 uppercase",
                style: { color: "#00FF00" },
                initial: { opacity: 0, y: 20 },
                animate: { opacity: 1, y: 0 },
                transition: { duration: 0.8, delay: 1.5 },
                children: "M1SSION STARTS ON 19 DECEMBER"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.p,
              {
                className: "text-xl md:text-2xl text-gray-400 mb-16 max-w-4xl mx-auto leading-relaxed",
                initial: { opacity: 0, y: 20 },
                animate: { opacity: 1, y: 0 },
                transition: { duration: 0.8, delay: 2 },
                children: t("heroDescription")
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "text-yellow-300 text-lg md:text-xl tracking-[0.5em] mb-16 relative font-light",
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                transition: { duration: 0.8, delay: 2.5 },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(TypingEffect, { text: "IT IS POSSIBLE", onComplete: () => setIsTypingComplete(true) })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "flex flex-col sm:flex-row gap-6 justify-center items-center",
                initial: { opacity: 0, y: 30 },
                animate: { opacity: 1, y: 0 },
                transition: { duration: 0.8, delay: 3 },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.button,
                    {
                      className: "px-12 py-6 rounded-full bg-gradient-to-r from-cyan-400 to-purple-600 text-black text-xl font-black uppercase tracking-wider hover:shadow-[0_0_40px_rgba(34,211,238,0.8)] transition-all duration-300 relative group",
                      onClick: handleRegisterClick,
                      whileHover: { scale: 1.05 },
                      whileTap: { scale: 0.95 },
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "relative z-10", children: t("joinTheHunt") }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          motion.div,
                          {
                            className: "absolute inset-0 bg-gradient-to-r from-purple-600 to-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-full"
                          }
                        )
                      ]
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.button,
                    {
                      className: "px-12 py-6 rounded-full text-white font-black uppercase tracking-wider bg-white/5 border-2 border-white/20 hover:bg-white/10 hover:border-cyan-400/50 hover:text-cyan-400 transition-all duration-300",
                      whileHover: { scale: 1.05 },
                      whileTap: { scale: 0.95 },
                      children: t("learnMore")
                    }
                  )
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "absolute bottom-12 left-1/2 transform -translate-x-1/2",
              animate: { y: [0, 10, 0] },
              transition: { duration: 2, repeat: Infinity, ease: "easeInOut" },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowDown, { className: "w-8 h-8 text-white/40" })
            }
          )
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "section",
      {
        ref: (el) => el && (sectionsRef.current[0] = el),
        className: "relative py-32 px-4",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-purple-900/20 via-transparent to-cyan-900/20" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-7xl mx-auto relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "text-center mb-16",
                initial: { opacity: 0, y: 30 },
                whileInView: { opacity: 1, y: 0 },
                transition: { duration: 0.8 },
                viewport: { once: true },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-4xl md:text-5xl font-black mb-6 text-white leading-none", children: t("realPrizes") }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xl text-gray-400 max-w-2xl mx-auto", children: t("realPrizesDescription") })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "relative h-[40vh] md:h-[50vh] lg:h-[60vh] rounded-3xl bg-black/40 backdrop-blur-sm border border-white/10 overflow-hidden",
                whileHover: { scale: 1.02 },
                transition: { duration: 0.5 },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-cyan-500/20 via-transparent to-purple-500/20 opacity-60" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "img",
                    {
                      src: "/lovable-uploads/eccb4710-0336-46f8-9137-906f61fbdebd.png",
                      alt: "M1SSION PREMI IN PALIO - Ferrari, Lamborghini, Rolex",
                      className: "w-full h-full object-cover object-center",
                      style: {
                        objectFit: "cover",
                        objectPosition: "center",
                        aspectRatio: "16/9"
                      },
                      onLoad: () => {
                        setImageLoaded(true);
                      },
                      onError: (e) => {
                        setImageLoaded(false);
                        e.currentTarget.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='450' viewBox='0 0 800 450'%3E%3Crect width='800' height='450' fill='%23000'/%3E%3Ctext x='400' y='225' font-family='Arial, sans-serif' font-size='24' fill='%2300E5FF' text-anchor='middle' dy='.3em'%3EM1SSION PREMI IN PALIO%3C/text%3E%3C/svg%3E";
                      }
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400/30 to-transparent",
                      animate: { x: ["-100%", "100%"] },
                      transition: { duration: 4, repeat: Infinity, ease: "easeInOut" }
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-4 right-4 text-white/60 text-xs font-normal bg-black/20 backdrop-blur-sm px-2 py-1 rounded border border-white/10", children: "Image for illustration purposes only" })
                ]
              }
            )
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.section,
      {
        className: "relative py-16 px-4 bg-black",
        initial: { opacity: 0, y: 40 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
        viewport: { once: true },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.h3,
            {
              className: "text-2xl md:text-3xl font-bold mb-6 text-white",
              initial: { opacity: 0 },
              whileInView: { opacity: 1 },
              transition: { duration: 0.6, delay: 0.2 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: "SSION" }),
                " in arrivo"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "relative w-full h-3 bg-black/60 rounded-full overflow-hidden border border-white/20 mb-4",
              initial: { scale: 0.8, opacity: 0 },
              whileInView: { scale: 1, opacity: 1 },
              transition: { duration: 0.6, delay: 0.4 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "h-full rounded-full relative overflow-hidden",
                    style: {
                      background: "linear-gradient(90deg, #00E5FF, #FF00FF, #00E5FF)"
                    },
                    animate: {
                      background: [
                        "linear-gradient(90deg, #00E5FF, #FF00FF, #00E5FF)",
                        "linear-gradient(90deg, #FF00FF, #00E5FF, #FF00FF)",
                        "linear-gradient(90deg, #00E5FF, #FF00FF, #00E5FF)"
                      ],
                      width: ["0%", "78%"]
                    },
                    transition: {
                      background: { duration: 3, repeat: Infinity, ease: "easeInOut" },
                      width: { duration: 2, ease: "easeOut" }
                    }
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent",
                    animate: { x: ["-100%", "100%"] },
                    transition: { duration: 2, repeat: Infinity, ease: "easeInOut" }
                  }
                )
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.p,
            {
              className: "text-white/70 text-sm",
              initial: { opacity: 0 },
              whileInView: { opacity: 1 },
              transition: { duration: 0.6, delay: 0.6 },
              children: "78% completato - La caccia inizia presto"
            }
          )
        ] })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.section,
      {
        className: "relative py-20 px-4 bg-black",
        initial: { opacity: 0, y: 40 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
        viewport: { once: true },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "glass-card p-8 md:p-12 text-center relative overflow-hidden",
            whileHover: { scale: 1.01 },
            transition: { duration: 0.3 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-3xl md:text-4xl font-orbitron mb-8", children: [
                "WELCOME TO",
                " ",
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                    "SSION",
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" })
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg mb-6 max-w-3xl mx-auto text-gray-200", children: "In the near future... The world becomes a gameboard. The clues are encrypted. The stakes are real." }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg mb-6 max-w-3xl mx-auto text-gray-200", children: "Thousands will try. Only a few will see the pattern. You're not just chasing a prizeyou're chasing the proof that you can outthink them all." }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg mb-6 max-w-3xl mx-auto text-gray-200", children: [
                "This is ",
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                  "SSION",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" })
                ] }),
                ". The countdown has begun. Are you ready?"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-400/40 to-transparent" })
            ]
          }
        ) })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.section,
      {
        className: "relative py-20 px-4",
        initial: { opacity: 0, y: 40 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
        viewport: { once: true },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-purple-900/40 via-cyan-900/40 to-pink-900/40" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-lg mx-auto relative z-10", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "relative m1ssion-glass-card overflow-hidden bg-black/60 backdrop-blur-xl shadow-lg p-10 text-center",
              whileHover: { scale: 1.02 },
              transition: { duration: 0.3 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-2xl md:text-3xl font-bold mb-2", children: [
                  "Registrati per",
                  " ",
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                      "SSION",
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" })
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-6", children: "Ottieni accesso esclusivo e un codice referral unico. Preparati per l'avventura che cambier tutto." }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    whileHover: { scale: 1.05 },
                    whileTap: { scale: 0.98 },
                    className: "relative overflow-hidden rounded-xl",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          className: "absolute inset-0",
                          style: {
                            background: "linear-gradient(45deg, #ec4899, #d946ef, #ec4899, #d946ef)"
                          },
                          animate: {
                            background: [
                              "linear-gradient(45deg, #ec4899, #d946ef, #ec4899, #d946ef)",
                              "linear-gradient(135deg, #d946ef, #ec4899, #d946ef, #ec4899)",
                              "linear-gradient(45deg, #ec4899, #d946ef, #ec4899, #d946ef)"
                            ]
                          },
                          transition: { duration: 3, repeat: Infinity, ease: "easeInOut" }
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Button,
                        {
                          onClick: handleRegisterClick,
                          className: "relative w-full bg-transparent text-white text-xl font-bold py-4 px-12 hover:bg-transparent transition-all duration-300 shadow-lg hover:shadow-cyan-500/30",
                          style: {
                            boxShadow: "0 0 20px rgba(236, 72, 153, 0.3)"
                          },
                          onMouseEnter: (e) => {
                            e.currentTarget.style.boxShadow = "0 0 30px rgba(0, 229, 255, 0.5), 0 0 60px rgba(236, 72, 153, 0.3)";
                          },
                          onMouseLeave: (e) => {
                            e.currentTarget.style.boxShadow = "0 0 20px rgba(236, 72, 153, 0.3)";
                          },
                          children: "START M1SSION"
                        }
                      )
                    ]
                  }
                ) })
              ]
            }
          ) })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.section,
      {
        className: "py-20 px-4 bg-black",
        initial: { opacity: 0, y: 40 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
        viewport: { once: true },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-3xl md:text-4xl font-bold mb-12 text-center", children: [
            "Scopri ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: "SSION" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12 relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "hidden lg:block absolute top-16 left-[12.5%] right-[12.5%] h-0.5 bg-gradient-to-r from-[#00E5FF] via-[#FFC107] to-[#FF00FF] z-0" }),
            steps.map((step, index) => {
              const isFlipped = flippedCards.includes(index);
              return /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  className: "relative z-10 perspective-1000",
                  initial: { y: 30, opacity: 0 },
                  whileInView: { y: 0, opacity: 1 },
                  transition: { duration: 0.5, delay: index * 0.1 },
                  viewport: { once: true },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "absolute -top-4 -left-4 w-10 h-10 rounded-full bg-black border border-white/10 flex items-center justify-center font-bold text-white z-30", children: index + 1 }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(
                      "div",
                      {
                        className: `mission-flip-card h-64 cursor-pointer ${isFlipped ? "is-flipped" : ""}`,
                        onClick: () => handleCardClick(index),
                        children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mission-card-front glass-card", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-4 p-3 rounded-full bg-black/50 border border-white/10", children: step.icon }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold mb-2 text-white", children: step.title }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-4 leading-relaxed", children: step.description }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 text-sm font-medium", children: "Clicca per saperne di pi" })
                          ] }),
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mission-card-back glass-card bg-gradient-to-br from-cyan-900/40 to-purple-900/40 border border-cyan-400/30", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-3 p-2 rounded-full bg-cyan-400/20", children: step.icon }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-bold mb-3 text-cyan-300", children: step.title }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/90 text-sm leading-relaxed mb-4", children: step.details }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-300 text-xs font-medium", children: "Clicca per tornare indietro" })
                          ] })
                        ]
                      }
                    )
                  ]
                },
                index
              );
            })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleRegisterClick,
              className: "bg-gradient-to-r from-[#00E5FF] to-[#00BFFF] text-black font-bold px-8 py-6 rounded-full text-lg hover:shadow-[0_0_15px_rgba(0,229,255,0.5)]",
              size: "lg",
              children: "Inizia La Tua M1SSION"
            }
          ) })
        ] })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("section", { className: "py-12 px-4 bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl md:text-3xl font-bold text-white mb-4", children: "Stay Updated" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-8", children: "Get the latest updates about M1SSION and be the first to know about new challenges." })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "py-16 px-4 bg-black relative", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-black via-gray-900 to-black opacity-80" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative z-10 max-w-7xl mx-auto", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, y: 20 },
            whileInView: { opacity: 1, y: 0 },
            transition: { duration: 0.6 },
            viewport: { once: true },
            className: "text-center mb-12",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-3xl md:text-4xl font-bold inline-block", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: "SSION" }),
                " Abbonamenti"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-white/70 max-w-2xl mx-auto", children: "Scegli il piano pi adatto a te e inizia la tua avventura. Tutti i piani offrono la possibilit di vincere premi reali." })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-12", children: subscriptions.map((sub, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: `rounded-xl relative p-4 ${sub.highlight ? "bg-gradient-to-b from-[#00E5FF]/20 to-black/70 border border-[#00E5FF]/30" : "bg-white/5 border border-white/10"}`,
            initial: { opacity: 0, y: 30 },
            whileInView: { opacity: 1, y: 0 },
            transition: { delay: index * 0.1, duration: 0.5 },
            viewport: { once: true },
            whileHover: { y: -5, transition: { duration: 0.2 } },
            children: [
              sub.highlight && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute -top-3 -right-3 bg-[#00E5FF] text-black text-xs font-bold py-1 px-2 rounded-full flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-3 h-3 mr-1" }),
                "Top"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-bold text-white", children: sub.title }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xl font-bold text-white", children: sub.price }),
                  sub.period && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/50 text-xs", children: sub.period })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 mb-4", children: [
                sub.features.slice(0, 3).map((feature, idx) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 text-green-400 mr-2 mt-0.5 flex-shrink-0" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80 text-sm", children: feature })
                ] }, idx)),
                sub.features.length > 3 && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/60 text-xs", children: [
                  "+",
                  sub.features.length - 3,
                  " altri vantaggi"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: handleRegisterClick,
                  className: `w-full text-sm py-2 ${sub.buttonColor}`,
                  disabled: false,
                  children: sub.buttonText
                }
              )
            ]
          },
          index
        )) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-sm", children: "Tutti i piani sono soggetti ai termini e condizioni di servizio." }) })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("section", { className: "py-20 px-4 bg-black relative", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-lg mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "glass-card p-8 text-center",
        initial: { opacity: 0, scale: 0.95 },
        whileInView: { opacity: 1, scale: 1 },
        transition: { duration: 0.5 },
        viewport: { once: true },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(IdCard, { className: "w-16 h-16 text-purple-400 mx-auto mb-4" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-white mb-2", children: "Verifica la tua identit" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Per garantire un'esperienza di gioco sicura e conforme alle normative,  necessario completare la verifica dell'identit prima di ricevere premi." })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleRegisterClick,
              className: "bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold px-8 py-3 rounded-full hover:shadow-[0_0_15px_rgba(128,0,128,0.5)]",
              children: "Vai alla verifica identit"
            }
          )
        ]
      }
    ) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("section", { className: "py-20 px-4 bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "glass-card p-8 md:p-12 text-center relative overflow-hidden",
        initial: { opacity: 0, y: 30 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6 },
        viewport: { once: true },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-3xl md:text-4xl font-bold mb-8 text-white", children: [
            "Installa ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
              "SSION",
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg mb-8 text-gray-200", children: "Per installare M1SSION sul tuo dispositivo mobile:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4 mb-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center text-gray-300", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "mr-2", children: "" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "iOS (Safari):" }),
                ' premi il tasto "Condividi" e seleziona "Aggiungi alla Home"'
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center text-gray-300", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "mr-2", children: "" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Android (Chrome):" }),
                ' apri il menu  e premi "Installa App"'
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleRegisterClick,
              className: "bg-blue-600 hover:bg-blue-700 text-white font-bold px-8 py-3 rounded-full",
              children: "Aggiungi M1SSION alla tua Home"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-400/40 to-transparent" })
        ]
      }
    ) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(LandingFooter, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(CookieBanner$1, {}),
    showEmergencyLogin && /* @__PURE__ */ jsxRuntimeExports.jsx(AdminEmergencyLogin, { onClose: () => setShowEmergencyLogin(false) }),
    showPrizeDetails && /* @__PURE__ */ jsxRuntimeExports.jsx(
      PrizeDetailsModal,
      {
        isOpen: showPrizeDetails,
        onClose: () => setShowPrizeDetails(false)
      }
    ),
    showAgeVerification && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/75 flex items-center justify-center z-[9999] p-4", style: { paddingTop: "calc(env(safe-area-inset-top, 0px) + 20px)", paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 20px)" }, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "bg-black/90 border border-purple-500/30 rounded-xl p-6 max-w-md w-full relative",
        initial: { opacity: 0, scale: 0.9 },
        animate: { opacity: 1, scale: 1 },
        exit: { opacity: 0, scale: 0.9 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: () => setShowAgeVerification(false),
              className: "absolute top-4 right-4 text-white/60 hover:text-white",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-6 h-6" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white mb-4", children: "Verifica dell'et" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-6", children: "Confermi di avere almeno 18 anni? Questo gioco  riservato ai maggiorenni." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: () => {
                    setShowAgeVerification(false);
                    handleRegisterClick();
                  },
                  className: "flex-1 bg-green-600 hover:bg-green-700 text-white",
                  children: "S, ho 18+ anni"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: () => setShowAgeVerification(false),
                  variant: "outline",
                  className: "flex-1",
                  children: "No"
                }
              )
            ] })
          ] })
        ]
      }
    ) }),
    showInviteFriend && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/75 flex items-center justify-center z-50 p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "bg-black/90 border border-purple-500/30 rounded-xl p-6 max-w-md w-full relative",
        initial: { opacity: 0, scale: 0.9 },
        animate: { opacity: 1, scale: 1 },
        exit: { opacity: 0, scale: 0.9 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: () => setShowInviteFriend(false),
              className: "absolute top-4 right-4 text-white/60 hover:text-white",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-6 h-6" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white mb-4", children: "Invita un amico" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-6", children: "Condividi M1SSION con i tuoi amici e guadagna vantaggi esclusivi!" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => {
                  setShowInviteFriend(false);
                  handleRegisterClick();
                },
                className: "bg-purple-600 hover:bg-purple-700 text-white",
                children: "Ottieni il tuo codice referral"
              }
            )
          ] })
        ]
      }
    ) })
  ] });
};
const TypingEffect = ({ text, onComplete }) => {
  const [displayText, setDisplayText] = reactExports.useState("");
  const [currentIndex, setCurrentIndex] = reactExports.useState(0);
  reactExports.useEffect(() => {
    if (currentIndex < text.length) {
      const timer = setTimeout(() => {
        setDisplayText((prev) => prev + text[currentIndex]);
        setCurrentIndex((prev) => prev + 1);
      }, 120);
      return () => clearTimeout(timer);
    } else if (onComplete) {
      onComplete();
    }
  }, [currentIndex, text, onComplete]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "inline-block", children: [
    displayText,
    currentIndex < text.length && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.span,
      {
        className: "inline-block w-0.5 h-6 bg-yellow-300 ml-1",
        animate: { opacity: [1, 0] },
        transition: { duration: 0.5, repeat: Infinity, ease: "easeInOut" }
      }
    )
  ] });
};

const Skeleton$1 = ({
  className,
  variant = "rectangular",
  width,
  height,
  animate = true
}) => {
  const baseStyles = "bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 bg-[length:200%_100%]";
  const animationStyles = animate ? "animate-shimmer" : "";
  const variantStyles = {
    text: "h-4 rounded",
    circular: "rounded-full",
    rectangular: "rounded-lg",
    card: "rounded-xl",
    avatar: "rounded-full w-10 h-10",
    button: "rounded-lg h-10"
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: cn(baseStyles, animationStyles, variantStyles[variant], className),
      style: {
        width: width ?? (variant === "avatar" ? 40 : "100%"),
        height: height ?? (variant === "text" ? 16 : variant === "avatar" ? 40 : "auto")
      }
    }
  );
};
const SkeletonCard = ({ className }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: cn("p-4 rounded-xl bg-slate-900/50 border border-slate-800/50 space-y-3", className), children: [
  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "avatar" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "60%" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "40%", height: 12 })
    ] })
  ] }),
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", height: 80 }),
  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "button", width: "30%" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "button", width: "30%" })
  ] })
] });
const SkeletonList = ({ count = 3, className }) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn("space-y-3", className), children: Array.from({ length: count }).map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 rounded-lg bg-slate-900/30", children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "avatar" }),
  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-2", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "70%" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "50%", height: 12 })
  ] })
] }, i)) });
const SkeletonProfile = ({ className }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: cn("text-center space-y-4", className), children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "circular", width: 80, height: 80, className: "mx-auto" }),
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: 120, className: "mx-auto" }),
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: 180, height: 12, className: "mx-auto" }),
  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-center gap-4 mt-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", width: 60, height: 60 }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", width: 60, height: 60 }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", width: 60, height: 60 })
  ] })
] });
const SkeletonMap = ({ className }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: cn("relative w-full h-full min-h-[400px] rounded-xl overflow-hidden", className), children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", className: "absolute inset-0", animate: false }),
  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-slate-400 font-orbitron", children: "Inizializzazione mappa..." })
  ] }) })
] });
const SkeletonStats = ({ count = 4, className }) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn("grid grid-cols-2 gap-3", className), children: Array.from({ length: count }).map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 rounded-lg bg-slate-900/30 border border-slate-800/50", children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "40%", height: 12 }),
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "60%", height: 24, className: "mt-2" })
] }, i)) });
const PageSkeleton = ({ variant = "default" }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-background p-4 space-y-4 animate-fadeIn", children: [
  variant === "profile" && /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonProfile, {}),
  variant === "list" && /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonList, { count: 5 }),
  variant === "map" && /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonMap, {}),
  variant === "default" && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: 150, height: 24 }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "circular", width: 32, height: 32 })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonStats, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonCard, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonList, { count: 3 })
  ] })
] });

const Textarea = reactExports.forwardRef(
  ({ className, ...props }, ref) => {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      "textarea",
      {
        className: cn(
          "flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",
          className
        ),
        ref,
        ...props
      }
    );
  }
);
Textarea.displayName = "Textarea";

const CoordinateSelector = () => {
  const [coordinates, setCoordinates] = reactExports.useState([]);
  const [newCoord, setNewCoord] = reactExports.useState({
    lat: "",
    lng: "",
    label: "",
    notes: ""
  });
  const handleSaveCoordinate = () => {
    if (!newCoord.lat || !newCoord.lng || !newCoord.label) {
      ue.error("Lat, Lng e Label sono obbligatori");
      return;
    }
    const coordinate = {
      id: crypto.randomUUID(),
      lat: parseFloat(newCoord.lat),
      lng: parseFloat(newCoord.lng),
      label: newCoord.label,
      notes: newCoord.notes,
      createdAt: /* @__PURE__ */ new Date()
    };
    setCoordinates([...coordinates, coordinate]);
    setNewCoord({ lat: "", lng: "", label: "", notes: "" });
    ue.success("Coordinata salvata");
  };
  const handleCopyCoordinate = (coord) => {
    const text = `${coord.lat}, ${coord.lng}`;
    navigator.clipboard.writeText(text);
    ue.success("Coordinate copiate negli appunti");
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-full overflow-y-auto pb-20 space-y-8", style: {
    height: "calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 80px)",
    paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 80px)"
  }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-6 h-6 text-white" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "Coordinate Selector" })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent", children: "Aggiungi Nuova Coordinata" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "lat", children: "Latitudine" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "lat",
                type: "number",
                step: "any",
                placeholder: "46.0 [COORD-LAT]",
                value: newCoord.lat,
                onChange: (e) => setNewCoord({ ...newCoord, lat: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "lng", children: "Longitudine" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "lng",
                type: "number",
                step: "any",
                placeholder: "8.0 [COORD-LNG]",
                value: newCoord.lng,
                onChange: (e) => setNewCoord({ ...newCoord, lng: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "label", children: "Label" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "label",
              placeholder: "TARGET-ID [Punto di interesse]",
              value: newCoord.label,
              onChange: (e) => setNewCoord({ ...newCoord, label: e.target.value }),
              className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "notes", children: "Note (opzionale)" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              id: "notes",
              placeholder: "NOTES [Descrizione dettagliata...]",
              value: newCoord.notes,
              onChange: (e) => setNewCoord({ ...newCoord, notes: e.target.value }),
              className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300",
              rows: 3
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleSaveCoordinate, className: "w-full bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 rounded-xl py-4 shadow-2xl shadow-cyan-500/30 hover:shadow-cyan-500/50 transition-all duration-300 text-lg", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Save, { className: "w-4 h-4 mr-2" }),
          "Salva Coordinata"
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-lg font-semibold text-foreground", children: "Coordinate Salvate" }),
      coordinates.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/40 backdrop-blur-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-12 text-center text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-16 h-16 mx-auto mb-6 opacity-50" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg", children: "Nessuna coordinata salvata" })
      ] }) }) : coordinates.map((coord) => /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-xl hover:shadow-2xl transition-all duration-300", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "py-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-start", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "font-semibold text-foreground", children: coord.label }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-muted-foreground font-mono", children: [
            coord.lat,
            ", ",
            coord.lng
          ] }),
          coord.notes && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mt-2", children: coord.notes }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground mt-2", children: coord.createdAt.toLocaleDateString() })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            onClick: () => handleCopyCoordinate(coord),
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Copy, { className: "w-4 h-4" })
          }
        )
      ] }) }) }, coord.id))
    ] })
  ] });
};

const ClueJournal = () => {
  const [entries, setEntries] = reactExports.useState([]);
  const [searchTerm, setSearchTerm] = reactExports.useState("");
  const [showAddForm, setShowAddForm] = reactExports.useState(false);
  const [newEntry, setNewEntry] = reactExports.useState({
    title: "",
    content: "",
    week: 1,
    tags: "",
    importance: "medium"
  });
  const handleSaveEntry = () => {
    if (!newEntry.title || !newEntry.content) {
      ue.error("Titolo e contenuto sono obbligatori");
      return;
    }
    const entry = {
      id: crypto.randomUUID(),
      title: newEntry.title,
      content: newEntry.content,
      week: newEntry.week,
      tags: newEntry.tags.split(",").map((tag) => tag.trim()).filter((tag) => tag),
      createdAt: /* @__PURE__ */ new Date(),
      importance: newEntry.importance
    };
    setEntries([entry, ...entries]);
    setNewEntry({ title: "", content: "", week: 1, tags: "", importance: "medium" });
    setShowAddForm(false);
    ue.success("Voce del diario salvata");
  };
  const filteredEntries = entries.filter(
    (entry) => entry.title.toLowerCase().includes(searchTerm.toLowerCase()) || entry.content.toLowerCase().includes(searchTerm.toLowerCase()) || entry.tags.some((tag) => tag.toLowerCase().includes(searchTerm.toLowerCase()))
  );
  const getImportanceColor = (importance) => {
    switch (importance) {
      case "high":
        return "bg-red-500";
      case "medium":
        return "bg-yellow-500";
      case "low":
        return "bg-green-500";
      default:
        return "bg-gray-500";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-full overflow-y-auto pb-20 space-y-8", style: {
    height: "calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 80px)",
    paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 80px)"
  }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(BookOpen, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "Clue Journal" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: () => setShowAddForm(!showAddForm), className: "bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 rounded-xl py-3 px-6 shadow-2xl shadow-cyan-500/30 hover:shadow-cyan-500/50 transition-all duration-300", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-2" }),
        "Nuova Voce"
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Search, { className: "absolute left-3 top-3 w-4 h-4 text-muted-foreground" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          placeholder: "SEARCH [Cerca nel diario...]",
          value: searchTerm,
          onChange: (e) => setSearchTerm(e.target.value),
          className: "pl-10 bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"
        }
      )
    ] }),
    showAddForm && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent", children: "Nuova Voce del Diario" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "title", children: "Titolo" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "title",
              placeholder: "Titolo dell'indizio...",
              value: newEntry.title,
              onChange: (e) => setNewEntry({ ...newEntry, title: e.target.value }),
              className: "bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "week", children: "Settimana" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "week",
                type: "number",
                min: "1",
                max: "4",
                value: newEntry.week,
                onChange: (e) => setNewEntry({ ...newEntry, week: parseInt(e.target.value) }),
                className: "bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "importance", children: "Importanza" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "select",
              {
                id: "importance",
                value: newEntry.importance,
                onChange: (e) => setNewEntry({ ...newEntry, importance: e.target.value }),
                className: "w-full h-10 px-3 rounded-lg bg-muted/50 border border-border text-foreground backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: "low", children: "Bassa" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: "medium", children: "Media" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: "high", children: "Alta" })
                ]
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "tags", children: "Tags (separati da virgole)" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "tags",
              placeholder: "geografia, simbolo, numero...",
              value: newEntry.tags,
              onChange: (e) => setNewEntry({ ...newEntry, tags: e.target.value }),
              className: "bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "content", children: "Contenuto" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              id: "content",
              placeholder: "Descrizione dettagliata dell'indizio...",
              value: newEntry.content,
              onChange: (e) => setNewEntry({ ...newEntry, content: e.target.value }),
              className: "bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",
              rows: 4
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleSaveEntry, className: "flex-1 bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 rounded-lg shadow-md hover:shadow-lg transition-all", children: "Salva Voce" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "outline", onClick: () => setShowAddForm(false), className: "rounded-lg", children: "Annulla" })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: filteredEntries.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-border rounded-xl bg-card/30 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-8 text-center text-muted-foreground", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(BookOpen, { className: "w-12 h-12 mx-auto mb-4 opacity-50" }),
      searchTerm ? "Nessun risultato trovato" : "Nessuna voce nel diario"
    ] }) }) : filteredEntries.map((entry) => /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-border rounded-xl bg-card/40 backdrop-blur-sm shadow-sm hover:shadow-md transition-all", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between mb-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${getImportanceColor(entry.importance)}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "font-semibold text-foreground", children: entry.title })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm text-muted-foreground", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-4 h-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
            "Settimana ",
            entry.week
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mb-3 whitespace-pre-wrap", children: entry.content }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-wrap gap-1", children: entry.tags.map((tag, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "secondary", className: "text-xs", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Tag, { className: "w-3 h-3 mr-1" }),
          tag
        ] }, index)) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-muted-foreground", children: entry.createdAt.toLocaleDateString() })
      ] })
    ] }) }, entry.id)) })
  ] });
};

const ClueArchive = () => {
  const [clues, setClues] = reactExports.useState([]);
  const [filteredClues, setFilteredClues] = reactExports.useState([]);
  const [searchTerm, setSearchTerm] = reactExports.useState("");
  const [weekFilter, setWeekFilter] = reactExports.useState(null);
  const [typeFilter, setTypeFilter] = reactExports.useState("all");
  const [loading, setLoading] = reactExports.useState(true);
  const { toast } = useToast();
  reactExports.useEffect(() => {
    loadClues();
  }, []);
  reactExports.useEffect(() => {
    filterClues();
  }, [clues, searchTerm, weekFilter, typeFilter]);
  const loadClues = async () => {
    try {
      const { data, error } = await supabase.from("clues").select("*").order("created_at", { ascending: false });
      if (error) throw error;
      const mappedClues = (data || []).map((clue) => ({
        id: clue.id,
        title: clue.title,
        description: clue.description,
        week: 1,
        // Default week
        isLocked: clue.is_locked,
        subscriptionType: clue.premium_type || "Base",
        foundAt: clue.created_at ? new Date(clue.created_at) : void 0,
        importance: "medium"
      }));
      setClues(mappedClues);
    } catch (error) {
      toast({
        title: "Errore",
        description: "Impossibile caricare l'archivio indizi",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const filterClues = () => {
    let filtered = clues;
    if (searchTerm) {
      filtered = filtered.filter(
        (clue) => clue.title.toLowerCase().includes(searchTerm.toLowerCase()) || clue.description.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }
    if (weekFilter !== null) {
      filtered = filtered.filter((clue) => clue.week === weekFilter);
    }
    if (typeFilter !== "all") {
      filtered = filtered.filter((clue) => clue.subscriptionType.toLowerCase() === typeFilter);
    }
    setFilteredClues(filtered);
  };
  const getImportanceBadge = (importance) => {
    switch (importance) {
      case "high":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "destructive", className: "text-xs", children: "Critico" });
      case "medium":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "default", className: "text-xs bg-yellow-500 text-white", children: "Medio" });
      case "low":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", className: "text-xs", children: "Basso" });
      default:
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-xs", children: "Standard" });
    }
  };
  const getSubscriptionBadge = (type) => {
    const colors = {
      "Base": "bg-gray-500",
      "Silver": "bg-gray-400",
      "Gold": "bg-yellow-500",
      "Black": "bg-black",
      "Premium": "bg-purple-500"
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: `text-xs text-white ${colors[type] || "bg-gray-500"}`, children: type });
  };
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center p-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400" }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Archive, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "Archivio Indizi" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 text-sm text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Database completo degli indizi raccolti" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col gap-4 md:flex-row md:items-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 relative", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Search, { className: "absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            placeholder: "Cerca indizi... [ARCH-SEARCH]",
            value: searchTerm,
            onChange: (e) => setSearchTerm(e.target.value),
            className: "pl-10 bg-muted/60 border-2 border-border/50 rounded-xl py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: weekFilter === null ? "default" : "outline",
            size: "sm",
            onClick: () => setWeekFilter(null),
            className: "rounded-xl",
            children: "Tutte"
          }
        ),
        [1, 2, 3, 4].map((week) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            variant: weekFilter === week ? "default" : "outline",
            size: "sm",
            onClick: () => setWeekFilter(week),
            className: "rounded-xl",
            children: [
              "W",
              week
            ]
          },
          week
        ))
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2", children: ["all", "base", "silver", "gold", "black"].map((type) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: typeFilter === type ? "default" : "outline",
          size: "sm",
          onClick: () => setTypeFilter(type),
          className: "rounded-xl capitalize",
          children: type
        },
        type
      )) })
    ] }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid gap-4 md:grid-cols-2 lg:grid-cols-3", children: filteredClues.map((clue) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Card,
      {
        className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-lg hover:shadow-2xl hover:shadow-cyan-500/20 transition-all duration-300 group cursor-pointer",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "pb-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-lg group-hover:text-cyan-400 transition-colors", children: clue.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                clue.isLocked && /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-4 h-4 text-red-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", className: "text-xs", children: [
                  "W",
                  clue.week
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              getSubscriptionBadge(clue.subscriptionType),
              getImportanceBadge(clue.importance || "medium")
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "pt-0", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mb-4 line-clamp-3", children: clue.description }),
            clue.foundAt && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-xs text-muted-foreground", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-3 h-3" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                "Trovato: ",
                clue.foundAt.toLocaleDateString("it-IT")
              ] })
            ] })
          ] })
        ]
      },
      clue.id
    )) }),
    filteredClues.length === 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-dashed border-border/50 rounded-2xl bg-card/30 backdrop-blur-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-12 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Archive, { className: "w-12 h-12 text-muted-foreground mx-auto mb-4 opacity-50" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-muted-foreground mb-2", children: "Nessun indizio trovato" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Modifica i filtri di ricerca per visualizzare altri indizi." })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-4 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-cyan-400", children: clues.length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Totale Indizi" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-green-400", children: clues.filter((c) => !c.isLocked).length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Sbloccati" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-yellow-400", children: clues.filter((c) => c.importance === "high").length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Critici" })
      ] })
    ] }) }) })
  ] });
};

delete L$1.Icon.Default.prototype._getIconUrl;
L$1.Icon.Default.mergeOptions({
  iconRetinaUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",
  iconUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",
  shadowUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"
});
const GeoRadarTool = () => {
  const [isScanning, setIsScanning] = reactExports.useState(false);
  const [scanProgress, setScanProgress] = reactExports.useState(0);
  const [scans, setScans] = reactExports.useState([]);
  const [scanParams, setScanParams] = reactExports.useState({
    centerLat: "",
    centerLng: "",
    radius: "1000",
    label: ""
  });
  const [savedCoordinates, setSavedCoordinates] = reactExports.useState([]);
  reactExports.useEffect(() => {
    loadSavedCoordinates();
  }, []);
  const loadSavedCoordinates = async () => {
    try {
      const { data, error } = await supabase.from("geo_radar_coordinates").select("*").order("created_at", { ascending: false });
      if (error) throw error;
      if (data) setSavedCoordinates(data);
    } catch (error) {
    }
  };
  const handleSaveCoordinates = async () => {
    if (!scanParams.centerLat || !scanParams.centerLng || !scanParams.label) {
      ue.error("Compila tutti i campi richiesti");
      return;
    }
    try {
      const { data: userData } = await supabase.auth.getUser();
      if (!userData.user) {
        ue.error("Devi essere autenticato per salvare");
        return;
      }
      const { error } = await supabase.from("geo_radar_coordinates").insert({
        user_id: userData.user.id,
        lat: parseFloat(scanParams.centerLat),
        lng: parseFloat(scanParams.centerLng),
        label: scanParams.label,
        radius: parseFloat(scanParams.radius)
      });
      if (error) throw error;
      ue.success("Coordinate salvate con successo");
      loadSavedCoordinates();
    } catch (error) {
      ue.error("Errore nel salvataggio coordinate");
    }
  };
  const handleStartScan = async () => {
    if (!scanParams.centerLat || !scanParams.centerLng) {
      ue.error("Inserisci coordinate valide");
      return;
    }
    setIsScanning(true);
    setScanProgress(0);
    const progressInterval = setInterval(() => {
      setScanProgress((prev) => {
        if (prev >= 100) {
          clearInterval(progressInterval);
          setIsScanning(false);
          generateScanResults();
          return 100;
        }
        return prev + 10;
      });
    }, 300);
  };
  const checkTargetProximity = (lat, lng) => {
    const targetLat = 46;
    const targetLng = 8;
    const R = 6371e3;
    const dLat = (targetLat - lat) * Math.PI / 180;
    const dLng = (targetLng - lng) * Math.PI / 180;
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat * Math.PI / 180) * Math.cos(targetLat * Math.PI / 180) * Math.sin(dLng / 2) * Math.sin(dLng / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const distance = R * c;
    return distance <= 3e3;
  };
  const generateScanResults = () => {
    const centerLat = parseFloat(scanParams.centerLat);
    const centerLng = parseFloat(scanParams.centerLng);
    const radius = parseInt(scanParams.radius);
    const isNearTarget = checkTargetProximity(centerLat, centerLng);
    const results = [];
    const numResults = isNearTarget ? Math.floor(Math.random() * 3) + 2 : Math.floor(Math.random() * 2) + 1;
    for (let i = 0; i < numResults; i++) {
      const angle = Math.random() * 360 * (Math.PI / 180);
      const distance = Math.random() * radius;
      const lat = centerLat + distance / 111e3 * Math.cos(angle);
      const lng = centerLng + distance / (111e3 * Math.cos(centerLat * Math.PI / 180)) * Math.sin(angle);
      const baseSignal = isNearTarget ? 60 + Math.random() * 40 : Math.random() * 60;
      const baseConfidence = isNearTarget ? 70 + Math.random() * 30 : Math.random() * 70;
      results.push({
        lat,
        lng,
        signal: baseSignal,
        confidence: baseConfidence,
        description: isNearTarget ? ` SIGNAL FORTE - Settore ${String.fromCharCode(65 + i)}` : `Anomalia rilevata - Settore ${String.fromCharCode(65 + i)}`
      });
    }
    if (isNearTarget) {
      ue.success(" RADAR: Segnali anomali rilevati! Possibile obiettivo nelle vicinanze!");
    } else {
      ue.success(" RADAR: Scansione completata - Area sicura");
    }
    const scan = {
      id: crypto.randomUUID(),
      centerLat,
      centerLng,
      radius,
      scanResults: results,
      timestamp: /* @__PURE__ */ new Date()
    };
    setScans([scan, ...scans]);
    setScanProgress(0);
    ue.success(`Scansione completata - ${results.length} anomalie rilevate`);
  };
  const getSignalColor = (signal) => {
    if (signal > 70) return "text-red-500";
    if (signal > 40) return "text-yellow-500";
    return "text-green-500";
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-8", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Radar, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "Geo Radar Tool" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 text-sm text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Disponibile dalla Settimana 3" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent", children: "Parametri Scansione" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "centerLat", children: "Latitudine Centro" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "centerLat",
                type: "number",
                step: "any",
                placeholder: "46.0 [COORD-LAT]",
                value: scanParams.centerLat,
                onChange: (e) => setScanParams({ ...scanParams, centerLat: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",
                disabled: isScanning
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "centerLng", children: "Longitudine Centro" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "centerLng",
                type: "number",
                step: "any",
                placeholder: "8.0 [COORD-LNG]",
                value: scanParams.centerLng,
                onChange: (e) => setScanParams({ ...scanParams, centerLng: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",
                disabled: isScanning
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "radius", children: "Raggio (metri)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "radius",
                type: "number",
                min: "100",
                max: "5000",
                value: scanParams.radius,
                onChange: (e) => setScanParams({ ...scanParams, radius: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",
                disabled: isScanning
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "label", children: "Etichetta" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "label",
                placeholder: "SCAN-ID [Nome scansione]",
                value: scanParams.label,
                onChange: (e) => setScanParams({ ...scanParams, label: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",
                disabled: isScanning
              }
            )
          ] })
        ] }),
        isScanning && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Scansione in corso..." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
              scanProgress,
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: scanProgress, className: "h-2" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: handleSaveCoordinates,
              disabled: isScanning,
              variant: "outline",
              className: "rounded-xl border-2 border-cyan-400/30 hover:border-cyan-400 hover:bg-cyan-400/10 transition-all duration-300",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Save, { className: "w-4 h-4 mr-2" }),
                "Salva Coordinate"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: handleStartScan,
              disabled: isScanning,
              className: "bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 rounded-xl shadow-2xl shadow-cyan-500/30 hover:shadow-cyan-500/50 transition-all duration-300",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Search, { className: "w-4 h-4 mr-2" }),
                isScanning ? "Scansione..." : "Avvia Scansione"
              ]
            }
          )
        ] })
      ] })
    ] }),
    scanParams.centerLat && scanParams.centerLng && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent", children: " Mappa Tattica Interattiva" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-80 rounded-2xl overflow-hidden border-2 border-cyan-500/20 shadow-inner", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
        MapContainer,
        {
          center: [parseFloat(scanParams.centerLat), parseFloat(scanParams.centerLng)],
          zoom: 15,
          style: { height: "100%", width: "100%" },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              TileLayer,
              {
                url: "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                attribution: " M1SSION Tactical Map"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Marker, { position: [parseFloat(scanParams.centerLat), parseFloat(scanParams.centerLng)], children: /* @__PURE__ */ jsxRuntimeExports.jsx(Popup, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Centro Scansione M1SSION" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
              scanParams.label || "Punto di scansione",
              /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs font-mono", children: [
                parseFloat(scanParams.centerLat).toFixed(6),
                ", ",
                parseFloat(scanParams.centerLng).toFixed(6)
              ] })
            ] }) }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Circle$1,
              {
                center: [parseFloat(scanParams.centerLat), parseFloat(scanParams.centerLng)],
                radius: parseFloat(scanParams.radius),
                pathOptions: {
                  color: "#00FFFF",
                  fillColor: "#00FFFF",
                  fillOpacity: 0.1,
                  weight: 3,
                  dashArray: "10, 5"
                }
              }
            )
          ]
        }
      ) }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-lg font-semibold text-foreground", children: "Risultati Scansioni" }),
      scans.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/40 backdrop-blur-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-12 text-center text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Radar, { className: "w-16 h-16 mx-auto mb-6 opacity-50" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg", children: "Nessuna scansione effettuata" })
      ] }) }) : scans.map((scan) => /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-xl hover:shadow-2xl transition-all duration-300", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-lg flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
            "Scansione ",
            scan.timestamp.toLocaleTimeString()
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-muted-foreground", children: [
            scan.scanResults.length,
            " anomalie"
          ] })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 text-sm text-muted-foreground", children: [
            "Centro: ",
            scan.centerLat.toFixed(6),
            ", ",
            scan.centerLng.toFixed(6),
            " | Raggio: ",
            scan.radius,
            "m"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: scan.scanResults.map((result, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-4 bg-muted/60 rounded-2xl border-2 border-border/50 backdrop-blur-md hover:border-cyan-400/30 transition-all duration-300", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-4 h-4 text-primary" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-medium", children: result.description }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground font-mono", children: [
                  result.lat.toFixed(6),
                  ", ",
                  result.lng.toFixed(6)
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `font-bold ${getSignalColor(result.signal)}`, children: [
                result.signal.toFixed(1),
                "%"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground", children: [
                "Conf: ",
                result.confidence.toFixed(1),
                "%"
              ] })
            ] })
          ] }, index)) })
        ] })
      ] }, scan.id))
    ] })
  ] });
};

const BuzzInterceptor = () => {
  const [isIntercepting, setIsIntercepting] = reactExports.useState(false);
  const [signals, setSignals] = reactExports.useState([]);
  const [interceptProgress, setInterceptProgress] = reactExports.useState(0);
  const [frequencyRange, setFrequencyRange] = reactExports.useState({ min: 2400, max: 2500 });
  reactExports.useEffect(() => {
    let interval;
    if (isIntercepting) {
      interval = setInterval(() => {
        if (Math.random() < 0.3) {
          generateRandomSignal();
        }
        setInterceptProgress((prev) => {
          if (prev >= 100) {
            return 0;
          }
          return prev + 10;
        });
      }, 1e3);
    }
    return () => {
      if (interval) {
        clearInterval(interval);
      }
    };
  }, [isIntercepting]);
  const generateRandomSignal = () => {
    const signal = {
      id: crypto.randomUUID(),
      frequency: Math.random() * (frequencyRange.max - frequencyRange.min) + frequencyRange.min,
      strength: Math.random() * 100,
      location: {
        lat: 46 + (Math.random() - 0.5) * 0.1,
        lng: 8 + (Math.random() - 0.5) * 0.1
      },
      timestamp: /* @__PURE__ */ new Date(),
      decoded: Math.random() < 0.4,
      // 40% chance di decodifica
      message: Math.random() < 0.4 ? getRandomMessage() : void 0
    };
    setSignals((prev) => [signal, ...prev.slice(0, 9)]);
    if (signal.decoded && signal.message) {
      ue.success("Segnale BUZZ decodificato!");
    }
  };
  const getRandomMessage = () => {
    const messages = [
      "COORDINATE: 46.0000, 8.0000",
      "SETTORE ALPHA: ANOMALIA RILEVATA",
      "PROTOCOLLO M1SSION: FASE 3 ATTIVA",
      "SEGNALE DEBOLE - RIPETERE SCANSIONE",
      "ZONA CRITICA: ACCESSO LIMITATO",
      "FREQUENZA MODULATA - DECRITTAZIONE RICHIESTA"
    ];
    return messages[Math.floor(Math.random() * messages.length)];
  };
  const handleToggleInterception = () => {
    setIsIntercepting(!isIntercepting);
    if (!isIntercepting) {
      ue.success("Intercettazione BUZZ avviata");
    } else {
      ue.info("Intercettazione BUZZ arrestata");
      setInterceptProgress(0);
    }
  };
  const getStrengthColor = (strength) => {
    if (strength > 70) return "text-red-500";
    if (strength > 40) return "text-yellow-500";
    return "text-green-500";
  };
  const getFrequencyBand = (frequency) => {
    if (frequency < 2420) return "LOW";
    if (frequency < 2460) return "MID";
    return "HIGH";
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-full overflow-y-auto pb-20 space-y-8", style: {
    height: "calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 80px)",
    paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 80px)"
  }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "BUZZ Interceptor" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 text-sm text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Disponibile dalla Settimana 4" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Card,
      {
        className: "m1-relief relative overflow-hidden rounded-[24px]",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Pannello di Controllo" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${isIntercepting ? "bg-red-500 animate-pulse" : "bg-gray-500"}` }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: isIntercepting ? "ATTIVO" : "STANDBY" })
            ] })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm font-medium", children: "Frequenza Min (MHz)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "input",
                  {
                    type: "number",
                    value: frequencyRange.min,
                    onChange: (e) => setFrequencyRange({ ...frequencyRange, min: parseInt(e.target.value) }),
                    className: "w-full h-12 px-4 rounded-xl bg-muted/60 border-2 border-border/50 text-foreground backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300",
                    disabled: isIntercepting
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm font-medium", children: "Frequenza Max (MHz)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "input",
                  {
                    type: "number",
                    value: frequencyRange.max,
                    onChange: (e) => setFrequencyRange({ ...frequencyRange, max: parseInt(e.target.value) }),
                    className: "w-full h-12 px-4 rounded-xl bg-muted/60 border-2 border-border/50 text-foreground backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300",
                    disabled: isIntercepting
                  }
                )
              ] })
            ] }),
            isIntercepting && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Scansione frequenze..." }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                  interceptProgress,
                  "%"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: interceptProgress, className: "h-2" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: handleToggleInterception,
                variant: isIntercepting ? "destructive" : "default",
                className: `w-full rounded-xl py-4 shadow-2xl hover:shadow-2xl transition-all duration-300 ${!isIntercepting ? "bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 shadow-cyan-500/30 hover:shadow-cyan-500/50" : ""}`,
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Radio, { className: "w-4 h-4 mr-2" }),
                  isIntercepting ? "Arresta Intercettazione" : "Avvia Intercettazione"
                ]
              }
            )
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Card,
      {
        className: "m1-relief relative overflow-hidden rounded-[24px]",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Feed Segnali BUZZ" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "secondary", children: [
              signals.length,
              " segnali"
            ] })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3 max-h-96 overflow-y-auto", children: signals.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "py-8 text-center text-muted-foreground", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-12 h-12 mx-auto mb-4 opacity-50" }),
            isIntercepting ? "In attesa di segnali..." : "Avvia intercettazione per rilevare segnali BUZZ"
          ] }) : signals.map((signal) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 bg-muted/60 rounded-2xl border-2 border-border/50 backdrop-blur-md hover:border-cyan-400/30 transition-all duration-300", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between mb-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-2 h-2 rounded-full ${signal.decoded ? "bg-green-500" : "bg-yellow-500"}` }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "font-medium text-sm", children: [
                    signal.frequency.toFixed(2),
                    " MHz"
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: signal.timestamp.toLocaleTimeString() })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-xs", children: getFrequencyBand(signal.frequency) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `text-sm font-bold ${getStrengthColor(signal.strength)}`, children: [
                  signal.strength.toFixed(1),
                  "%"
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground mb-2 font-mono", children: [
              " ",
              signal.location.lat.toFixed(6),
              ", ",
              signal.location.lng.toFixed(6)
            ] }),
            signal.decoded && signal.message && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-3 p-2 bg-primary/10 rounded border border-primary/20", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-3 h-3 text-primary" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-medium text-primary", children: "DECODIFICATO" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-mono text-foreground", children: signal.message })
            ] })
          ] }, signal.id)) }) })
        ]
      }
    )
  ] });
};

const markerIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=";

const markerShadow = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC";

const PulsingRedIcon = L$1.divIcon({
  className: "pulsing-red-marker",
  html: `<div style="
    width: 20px;
    height: 20px;
    background: #ff0000;
    border-radius: 50%;
    animation: pulse 2s infinite;
    box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
  "></div>
  <style>
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>`,
  iconSize: [20, 20],
  iconAnchor: [10, 10]
});
const DefaultIcon = L$1.icon({
  iconUrl: markerIcon,
  shadowUrl: markerShadow,
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
L$1.Marker.prototype.options.icon = DefaultIcon;
const MapClickHandler = ({ onMapClick }) => {
  useMapEvents({
    click: (e) => {
      onMapClick(e.latlng.lat, e.latlng.lng);
    }
  });
  return null;
};
const FinalShotPage = () => {
  const [selectedPosition, setSelectedPosition] = reactExports.useState(null);
  const [isSubmitting, setIsSubmitting] = reactExports.useState(false);
  const [showConfirmation, setShowConfirmation] = reactExports.useState(false);
  const [attempts, setAttempts] = reactExports.useState([]);
  const [cooldownEnd, setCooldownEnd] = reactExports.useState(null);
  const [mapStyle, setMapStyle] = reactExports.useState("satellite");
  const [showMapControls, setShowMapControls] = reactExports.useState(false);
  const { toast } = useToast();
  const mapRef = reactExports.useRef(null);
  const currentMissionId = "550e8400-e29b-41d4-a716-446655440000";
  reactExports.useEffect(() => {
    loadAttempts();
  }, []);
  const loadAttempts = async () => {
    try {
      const { data, error } = await supabase.from("final_shots").select("*").eq("mission_id", currentMissionId).order("created_at", { ascending: false });
      if (error) throw error;
      setAttempts(data || []);
      if (data && data.length > 0) {
        const lastAttempt = new Date(data[0].created_at);
        const cooldown = new Date(lastAttempt.getTime() + 12 * 60 * 60 * 1e3);
        if (cooldown > /* @__PURE__ */ new Date()) {
          setCooldownEnd(cooldown);
        }
      }
    } catch (error) {
    }
  };
  const handleMapClick = (lat, lng) => {
    if (!isDisabled) {
      const exactPosition = {
        lat: parseFloat(lat.toFixed(6)),
        lng: parseFloat(lng.toFixed(6))
      };
      setSelectedPosition(exactPosition);
      setShowConfirmation(true);
      setShowMapControls(true);
      toast({
        title: " Posizione Final Shot Selezionata",
        description: `Coordinate: ${exactPosition.lat}, ${exactPosition.lng}`,
        variant: "default"
      });
    } else {
      toast({
        title: " Final Shot Non Disponibile",
        description: getCooldownTime() ? `Cooldown attivo: ${getCooldownTime()}` : "Tentativi esauriti",
        variant: "destructive"
      });
    }
  };
  const submitFinalShot = async () => {
    if (!selectedPosition) return;
    setIsSubmitting(true);
    try {
      const { data, error } = await supabase.rpc("submit_final_shot", {
        p_mission_id: currentMissionId,
        p_latitude: selectedPosition.lat,
        p_longitude: selectedPosition.lng
      });
      if (error) {
        throw error;
      }
      const result = data;
      if (result.error) {
        const errorTitle = result.error.includes("Mission target") ? " Target Non Trovato" : result.error.includes("Maximum attempts") ? " Tentativi Esauriti" : result.error.includes("Daily limit") ? " Limite Giornaliero" : result.error.includes("Cooldown") ? " Cooldown Attivo" : " Errore Final Shot";
        toast({
          title: errorTitle,
          description: result.error,
          variant: "destructive"
        });
        return;
      }
      if (result.success) {
        if (result.is_winner) {
          toast({
            title: " VINCITORE!",
            description: "Complimenti! Hai trovato il premio esatto!",
            variant: "default"
          });
        } else {
          toast({
            title: " Final Shot Registrato",
            description: `Distanza: ${(result.distance_meters / 1e3).toFixed(2)} km | Direzione: ${result.direction}`,
            variant: "default"
          });
        }
        setCooldownEnd(new Date(Date.now() + 12 * 60 * 60 * 1e3));
        await loadAttempts();
        setSelectedPosition(null);
        setShowConfirmation(false);
        setShowMapControls(false);
      } else {
        toast({
          title: " Final Shot Fallito",
          description: "Impossibile registrare il tentativo",
          variant: "destructive"
        });
      }
    } catch (error) {
      toast({
        title: " Errore Sistema",
        description: "Errore critico durante l'invio. Riprova.",
        variant: "destructive"
      });
    } finally {
      setIsSubmitting(false);
    }
  };
  const getRemainingAttempts = () => {
    const maxAttempts = 5;
    return Math.max(0, maxAttempts - attempts.length);
  };
  const getCooldownTime = () => {
    if (!cooldownEnd) return null;
    const now = /* @__PURE__ */ new Date();
    const diff = cooldownEnd.getTime() - now.getTime();
    if (diff <= 0) return null;
    const hours = Math.floor(diff / (1e3 * 60 * 60));
    const minutes = Math.floor(diff % (1e3 * 60 * 60) / (1e3 * 60));
    return `${hours}h ${minutes}m`;
  };
  const isDisabled = getRemainingAttempts() === 0 || !!getCooldownTime();
  const getMapTileUrl = () => {
    switch (mapStyle) {
      case "satellite":
        return "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}";
      case "dark":
        return "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png";
      case "terrain":
        return "https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png";
      default:
        return "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";
    }
  };
  const getMapAttribution = () => {
    switch (mapStyle) {
      case "satellite":
        return "&copy; M1SSION Tactical Intelligence | Esri";
      case "dark":
        return "&copy; M1SSION Dark Ops | CartoDB";
      case "terrain":
        return "&copy; M1SSION Terrain | OpenTopoMap";
      default:
        return "&copy; M1SSION Standard | OpenStreetMap";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full h-full overflow-y-auto bg-black/10", style: {
    minHeight: "calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 160px)"
  }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mb-4 px-4 pt-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 mb-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-5 h-5 text-white" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "text-xl font-bold", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400", children: "FINAL" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: " SHOT" })
      ] })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-2 mb-4 px-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border border-cyan-500/20 rounded-lg bg-card/60 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-2 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold text-cyan-400", children: getRemainingAttempts() }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Tentativi" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border border-cyan-500/20 rounded-lg bg-card/60 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-2 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold text-yellow-400", children: getCooldownTime() || "" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Cooldown" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border border-cyan-500/20 rounded-lg bg-card/60 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-2 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold text-green-400", children: attempts.length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Effettuati" })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 relative px-4 pb-20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative h-[400px] sm:h-[500px] md:h-[600px] rounded-xl overflow-hidden border-2 border-cyan-500/20 shadow-2xl bg-black/20", style: { zIndex: 1 }, children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "!visible !opacity-100 !flex absolute top-4 right-4 z-[999] flex-wrap gap-1", style: {
        visibility: "visible",
        opacity: 1,
        display: "flex"
      }, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            className: "!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",
            onClick: () => setMapStyle("satellite"),
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block"
            },
            children: ""
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            className: "!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",
            onClick: () => setMapStyle("dark"),
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block"
            },
            children: ""
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            className: "!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",
            onClick: () => setMapStyle("terrain"),
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block"
            },
            children: ""
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            className: "!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",
            onClick: () => setMapStyle("osm"),
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block"
            },
            children: ""
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        MapContainer,
        {
          center: [50.8503, 4.3517],
          zoom: 4,
          minZoom: 2,
          maxZoom: 20,
          style: {
            height: "100%",
            width: "100%",
            position: "absolute",
            top: 0,
            left: 0,
            touchAction: "pan-x pan-y pinch-zoom",
            WebkitTouchCallout: "none",
            WebkitUserSelect: "none",
            userSelect: "none"
          },
          ref: mapRef,
          scrollWheelZoom: true,
          doubleClickZoom: true,
          dragging: true,
          touchZoom: true,
          zoomControl: true,
          attributionControl: false,
          whenReady: () => {
            if (typeof window !== "undefined" && window.navigator?.standalone) {
              const mapContainer = mapRef.current?.getContainer();
              if (mapContainer) {
                mapContainer.style.WebkitTransform = "translateZ(0)";
                mapContainer.style.transform = "translateZ(0)";
                mapContainer.style.WebkitBackfaceVisibility = "hidden";
                mapContainer.style.backfaceVisibility = "hidden";
                mapContainer.style.willChange = "transform";
                mapContainer.addEventListener("touchstart", () => {
                }, { passive: true });
                mapContainer.addEventListener("touchmove", () => {
                }, { passive: true });
                mapContainer.addEventListener("touchend", () => {
                }, { passive: true });
              }
            }
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              TileLayer,
              {
                url: getMapTileUrl(),
                attribution: getMapAttribution()
              }
            ),
            !isDisabled && /* @__PURE__ */ jsxRuntimeExports.jsx(MapClickHandler, { onMapClick: handleMapClick }),
            selectedPosition && /* @__PURE__ */ jsxRuntimeExports.jsx(
              Marker,
              {
                position: [selectedPosition.lat, selectedPosition.lng],
                icon: PulsingRedIcon,
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Popup, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-bold text-red-600", children: " Final Shot" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm bg-yellow-200 px-2 py-1 rounded text-black font-mono", children: [
                    selectedPosition.lat.toFixed(6),
                    ", ",
                    selectedPosition.lng.toFixed(6)
                  ] })
                ] }) })
              }
            )
          ]
        }
      ),
      isDisabled && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-black/50 flex items-center justify-center z-40 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-white p-4 bg-black/60 rounded-xl border border-red-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold mb-2", children: " Final Shot Non Disponibile" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm", children: [
          getRemainingAttempts() === 0 && "Tentativi esauriti",
          getCooldownTime() && `Cooldown: ${getCooldownTime()}`
        ] })
      ] }) })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "!visible !opacity-100 !block",
        style: {
          position: "fixed",
          left: "50%",
          transform: "translateX(-50%)",
          bottom: `calc(env(safe-area-inset-bottom, 0px) + 120px)`,
          zIndex: 99999,
          pointerEvents: "auto",
          visibility: "visible",
          opacity: 1,
          display: "block"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: () => {
              if (isDisabled) {
                toast({
                  title: getCooldownTime() ? " Cooldown Attivo" : " Tentativi Esauriti",
                  description: getCooldownTime() ? `Riprova tra: ${getCooldownTime()}` : "Hai raggiunto il limite massimo di tentativi",
                  variant: "destructive"
                });
                return;
              }
              if (!showMapControls) {
                setShowMapControls(true);
              }
              toast({
                title: " Modalit Final Shot Attiva",
                description: "Clicca sulla mappa per selezionare la posizione del premio",
                variant: "default"
              });
            },
            disabled: isDisabled,
            className: `
            !visible !opacity-100 !block !relative !z-[100]
            ${isDisabled ? "bg-gray-600/80 hover:bg-gray-600/80 cursor-not-allowed border-gray-500/50" : "bg-gradient-to-r from-fuchsia-600 to-fuchsia-900 hover:from-fuchsia-700 hover:to-fuchsia-950 border-fuchsia-400/50"} 
            text-white shadow-2xl px-8 py-4 text-lg font-black rounded-full border-3 backdrop-blur-md
            transition-all duration-300 hover:scale-105 hover:shadow-fuchsia-500/50
            min-w-[200px] text-center
            animate-pulse
          `,
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block",
              position: "relative",
              zIndex: 100,
              WebkitTapHighlightColor: "transparent",
              WebkitTouchCallout: "none"
            },
            children: isDisabled ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              " FINAL SHOT",
              getCooldownTime() ? ` (${getCooldownTime()})` : " (ESAURITO)"
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children: " FINAL SHOT" })
          }
        )
      }
    ),
    showConfirmation && selectedPosition && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-red-500/50 rounded-2xl bg-red-500/10 backdrop-blur-md max-w-md w-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-6 h-6 text-red-400" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white", children: "Conferma Final Shot" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300", children: "Stai dichiarando che il premio si trova in questo punto." }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-gray-400 font-mono bg-yellow-200 p-3 rounded-lg text-black font-bold", children: [
        " ",
        selectedPosition.lat.toFixed(6),
        ", ",
        selectedPosition.lng.toFixed(6)
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-yellow-400 font-medium", children: [
        "Hai solo ",
        getRemainingAttempts(),
        " tentativi totali per questa missione. Confermi?"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-4 justify-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "outline",
            onClick: () => {
              setShowConfirmation(false);
              setSelectedPosition(null);
            },
            className: "px-6",
            children: "Annulla"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: submitFinalShot,
            disabled: isSubmitting,
            className: "px-8 bg-gradient-to-r from-fuchsia-600 to-fuchsia-900 hover:from-fuchsia-700 hover:to-fuchsia-950 text-white shadow-xl",
            children: isSubmitting ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-4 w-4 border-b-2 border-white" }),
              "Invio..."
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-5 h-5" }),
              " LANCIA IL TUO FINAL SHOT"
            ] })
          }
        )
      ] })
    ] }) }) }) })
  ] });
};

const IntelModuleHeader = ({ title }) => {
  const [, setLocation] = useLocation();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "sticky top-0 z-20 flex items-center justify-between px-4 py-3 bg-background/80 backdrop-blur-md border-b border-border", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-lg font-semibold text-foreground", children: title }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          variant: "outline",
          size: "sm",
          onClick: () => setLocation("/intelligence/final-shot"),
          "aria-label": "Apri Final Shot",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Crosshair, { className: "w-4 h-4 mr-2" }),
            " FINAL SHOT"
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "ghost",
          size: "icon",
          onClick: () => setLocation("/intelligence"),
          "aria-label": "Chiudi e torna alla lista Intelligence",
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-5 h-5" })
        }
      )
    ] })
  ] });
};

const huracanImg = "/assets/lamborghini-huracan.BDVrMRV0.png";

const rolexImg = "/assets/rolex-submariner.A9k_cAfW.png";

const birkinImg = "/assets/hermes-birkin.DHEqTVeR.png";

const iphoneImg = "/assets/iphone-16-pro-max.Ddiy8e6N.png";

const airpodsImg = "/assets/airpods-max.DG_7KfAy.png";

const missionPrizeImages = [
  "/assets/m1ssion-prize/hero-forest-watch.png",
  "/assets/m1ssion-prize/hero-forest-lambo.png",
  "/assets/m1ssion-prize/hero-forest-lambo-porsche.png",
  "/assets/m1ssion-prize/treasure-forest-car.png"
];
function PrizeVision({ progress }) {
  const [currentImageIndex, setCurrentImageIndex] = reactExports.useState(0);
  const [isSwipeTransition, setIsSwipeTransition] = reactExports.useState(false);
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const [flipped, setFlipped] = reactExports.useState([]);
  const handleSwipeLeft = () => {
    if (isSwipeTransition) return;
    setIsSwipeTransition(true);
    setTimeout(() => {
      setCurrentImageIndex((prev) => (prev + 1) % missionPrizeImages.length);
      setIsSwipeTransition(false);
    }, 150);
  };
  const prizes = [
    { name: "Lamborghini Huracn Experience", image: huracanImg, description: " Lamborghini Huracn Experience  Un weekend adrenalina pura." },
    { name: "Rolex Submariner", image: rolexImg, description: " Rolex Submariner  Precisione e stile intramontabile." },
    { name: "Herms Birkin", image: birkinImg, description: " Herms Birkin  Eleganza senza compromessi." },
    { name: "iPhone 16 Pro Max", image: iphoneImg, description: " iPhone 16 Pro Max  Tecnologia allavanguardia." },
    { name: "AirPods Max", image: airpodsImg, description: " AirPods Max  Immersivo, ovunque." }
  ];
  const toggleFlip = (index) => {
    setFlipped((prev) => prev.includes(index) ? prev.filter((i) => i !== index) : [...prev, index]);
  };
  const layoutSpring = { layout: { type: "spring", stiffness: 160, damping: 22 } };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(LayoutGroup, { id: "mission-prize-group", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        layoutId: "missionPrize",
        className: "w-full",
        style: { visibility: isExpanded ? "hidden" : "visible" },
        transition: layoutSpring,
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "w-full relative overflow-hidden rounded-[24px]",
            style: {
              background: "linear-gradient(160deg, rgba(15, 25, 45, 0.95) 0%, rgba(5, 10, 25, 0.98) 50%, rgba(10, 20, 40, 0.95) 100%)",
              backdropFilter: "blur(40px)",
              WebkitBackdropFilter: "blur(40px)",
              border: "2px solid rgba(0, 209, 255, 0.4)",
              borderTop: "2px solid rgba(0, 209, 255, 0.6)",
              borderBottom: "2px solid rgba(0, 150, 200, 0.3)",
              boxShadow: `
              0 25px 80px rgba(0, 0, 0, 0.7),
              0 15px 40px rgba(0, 0, 0, 0.5),
              0 5px 20px rgba(0, 0, 0, 0.4),
              inset 0 2px 4px rgba(255, 255, 255, 0.15),
              inset 0 -2px 4px rgba(0, 0, 0, 0.4),
              0 0 30px rgba(0, 209, 255, 0.25),
              0 0 60px rgba(0, 209, 255, 0.15),
              0 -5px 30px rgba(0, 209, 255, 0.1)
            `,
              transform: "translateY(-4px) translateZ(20px)",
              transformStyle: "preserve-3d",
              perspective: "1000px"
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                "div",
                {
                  className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                  style: {
                    animation: "slideGlow 3s ease-in-out infinite",
                    width: "200%",
                    left: "-100%"
                  }
                }
              ) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
            @keyframes slideGlow {
              0% { transform: translateX(0); }
              50% { transform: translateX(50%); }
              100% { transform: translateX(0); }
            }
          ` }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "div",
                {
                  className: "p-4 border-b border-white/10 flex justify-between items-center cursor-pointer",
                  onClick: () => setIsExpanded(true),
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-lg md:text-xl font-orbitron font-bold", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", style: { textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)" }, children: "M1" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                        "SSION",
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" }),
                        " PRIZE"
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/70", children: [
                        "Visibilit: ",
                        progress,
                        "%"
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/50", children: [
                        "(",
                        currentImageIndex + 1,
                        "/",
                        missionPrizeImages.length,
                        ")"
                      ] })
                    ] })
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative h-60 sm:h-72 md:h-80 lg:h-96 overflow-hidden", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  "div",
                  {
                    className: "relative w-full h-full cursor-pointer",
                    onClick: handleSwipeLeft,
                    onTouchStart: handleSwipeLeft,
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          className: "absolute inset-0",
                          initial: { opacity: 0, x: 50 },
                          animate: { opacity: 1, x: 0 },
                          exit: { opacity: 0, x: -50 },
                          transition: { duration: 0.3, ease: "easeInOut" },
                          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                            "img",
                            {
                              src: missionPrizeImages[currentImageIndex],
                              alt: `M1SSION Prize ${currentImageIndex + 1}`,
                              className: "w-full h-full object-cover rounded-lg shadow-lg"
                            }
                          )
                        },
                        currentImageIndex
                      ) }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          className: "absolute top-4 right-4 w-10 h-10 rounded-full bg-gradient-to-br from-[#00D1FF]/20 to-[#7B2EFF]/20 backdrop-blur-md border border-[#00D1FF]/30 flex items-center justify-center",
                          animate: {
                            x: [0, 8, 0],
                            opacity: [0.7, 1, 0.7]
                          },
                          transition: {
                            duration: 1.5,
                            repeat: Infinity,
                            ease: "easeInOut"
                          },
                          children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                            "svg",
                            {
                              width: "20",
                              height: "20",
                              viewBox: "0 0 24 24",
                              fill: "none",
                              xmlns: "http://www.w3.org/2000/svg",
                              className: "drop-shadow-[0_0_8px_rgba(0,209,255,0.6)]",
                              children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsx(
                                  "path",
                                  {
                                    d: "M5 12H19M19 12L12 5M19 12L12 19",
                                    stroke: "url(#arrowGradient)",
                                    strokeWidth: "2.5",
                                    strokeLinecap: "round",
                                    strokeLinejoin: "round"
                                  }
                                ),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("defs", { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("linearGradient", { id: "arrowGradient", x1: "5", y1: "12", x2: "19", y2: "12", gradientUnits: "userSpaceOnUse", children: [
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "0%", stopColor: "#00D1FF" }),
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "100%", stopColor: "#7B2EFF" })
                                ] }) })
                              ]
                            }
                          )
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-2 right-2 bg-black/60 backdrop-blur-sm px-2 py-1 rounded text-white text-[14px] md:text-[18px] font-medium", children: "Image for illustrative purposes only" })
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-0 left-0 right-0 h-1 bg-black/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "div",
                  {
                    className: "h-full bg-gradient-to-r from-[#00D1FF] to-[#7B2EFF]",
                    style: { width: `${progress}%` }
                  }
                ) })
              ] })
            ]
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "fixed inset-0 z-[100]",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        exit: { opacity: 0 },
        onClick: () => setIsExpanded(false),
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-black/70 backdrop-blur-sm" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              layoutId: "missionPrize",
              className: "fixed left-0 right-0 z-[101] prize-modal-container",
              style: { top: 72, bottom: 88, transformOrigin: "center center" },
              transition: layoutSpring,
              onClick: (e) => e.stopPropagation(),
              children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-2 md:px-6 h-full max-w-screen-xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "div",
                {
                  className: "w-full h-full flex flex-col relative overflow-hidden rounded-[24px]",
                  style: {
                    background: "rgba(0, 0, 0, 0.05)",
                    backdropFilter: "blur(40px)",
                    WebkitBackdropFilter: "blur(40px)",
                    border: "1px solid rgba(255, 255, 255, 0.1)",
                    boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
                  },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                        style: {
                          animation: "slideGlow 3s ease-in-out infinite",
                          width: "200%",
                          left: "-100%"
                        }
                      }
                    ) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 border-b border-white/10 flex justify-between items-center", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-lg md:text-xl font-orbitron font-bold", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", style: { textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)" }, children: "M1" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                          "SSION",
                          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" }),
                          " PRIZE"
                        ] })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("button", { onClick: () => setIsExpanded(false), className: "text-white/80 hover:text-white text-sm md:text-base", children: "Chiudi" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 overflow-y-auto p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6", children: prizes.map((prize, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "perspective-1000 h-64",
                        onClick: (e) => {
                          e.stopPropagation();
                          toggleFlip(index);
                        },
                        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                          "div",
                          {
                            className: `mission-flip-card w-full h-full ${flipped.includes(index) ? "is-flipped" : ""}`,
                            style: { transformOrigin: "center center" },
                            children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mission-card-front absolute inset-0 rounded-xl overflow-hidden bg-white/5 border border-white/10", children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsx("img", { src: prize.image, alt: prize.name, className: "absolute inset-0 w-full h-full object-cover" }),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 to-transparent p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-orbitron text-base md:text-lg font-bold text-cyan-400", children: prize.name }) })
                              ] }),
                              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mission-card-back absolute inset-0 rounded-xl p-6 bg-white/5 border border-white/10 flex items-center justify-center text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-sm md:text-base leading-relaxed", children: prize.description }) })
                            ]
                          }
                        )
                      },
                      index
                    )) }) })
                  ]
                }
              ) })
            }
          )
        ]
      },
      "overlay"
    ) })
  ] });
}

const MOBILE_BREAKPOINT = 768;
function useIsMobile() {
  const [isMobile, setIsMobile] = reactExports.useState(void 0);
  reactExports.useEffect(() => {
    const checkIsMobile = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    checkIsMobile();
    window.addEventListener("resize", checkIsMobile);
    return () => window.removeEventListener("resize", checkIsMobile);
  }, []);
  return isMobile ?? false;
}

const Tabs = ({ value, onValueChange, children, className, ...props }) => {
  const [activeTab, setActiveTab] = reactExports.useState(value || "");
  const handleTabChange = (newValue) => {
    setActiveTab(newValue);
    onValueChange?.(newValue);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn("w-full", className), ...props, children: reactExports.Children.map(children, (child) => {
    if (reactExports.isValidElement(child)) {
      return reactExports.cloneElement(child, {
        activeTab,
        onTabChange: handleTabChange
      });
    }
    return child;
  }) });
};
const TabsList = ({ className, activeTab, onTabChange, children, ...props }) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn(
      "inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",
      className
    ),
    ...props,
    children: reactExports.Children.map(children, (child) => {
      if (reactExports.isValidElement(child)) {
        return reactExports.cloneElement(child, {
          activeTab,
          onTabChange
        });
      }
      return child;
    })
  }
);
const TabsTrigger = ({ className, value, activeTab, onTabChange, children, ...props }) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "button",
  {
    className: cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
      activeTab === value ? "bg-background text-foreground shadow" : "text-muted-foreground hover:text-foreground",
      className
    ),
    onClick: () => onTabChange?.(value),
    ...props,
    children
  }
);
const TabsContent = ({ className, value, activeTab, children, ...props }) => {
  if (activeTab !== value) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: cn(
        "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
        className
      ),
      ...props,
      children
    }
  );
};

const BattleLobby$2 = reactExports.lazy(() => __vitePreload(() => Promise.resolve().then(() => BattleLobby$1),true?void 0:void 0));
function BattleConsole({ className }) {
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const [userId, setUserId] = reactExports.useState(null);
  const [pendingCount, setPendingCount] = reactExports.useState(0);
  const [stats, setStats] = reactExports.useState(null);
  useIsMobile();
  reactExports.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      if (data.user) {
        setUserId(data.user.id);
        loadPendingBattles(data.user.id);
        loadStats(data.user.id);
      }
    });
  }, []);
  reactExports.useEffect(() => {
    if (!userId) return;
    const channel = supabase.channel("battle-console-updates").on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "battles",
      filter: `opponent_id=eq.${userId}`
    }, () => {
      loadPendingBattles(userId);
    }).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, [userId]);
  const loadPendingBattles = async (uid) => {
    const { data, error } = await supabase.from("battles").select("id").eq("opponent_id", uid).in("status", ["pending", "accepted"]).order("created_at", { ascending: false });
    if (!error && data) {
      setPendingCount(data.length);
    }
  };
  const loadStats = async (uid) => {
    try {
      const { data, error } = await supabase.from("battle_metrics").select("*").eq("user_id", uid).maybeSingle();
      if (error && (error.code === "406" || error.code === "PGRST116" || error.code === "42P01")) {
        return;
      }
      if (data) {
        setStats(data);
      }
    } catch (e) {
    }
  };
  const handleHeaderClick = () => {
    setIsExpanded(!isExpanded);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: `m1-relief rounded-[20px] overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] mb-4 relative ${className}`,
      whileHover: { scale: 1.02 },
      whileTap: { scale: 0.98 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
            style: {
              animation: "slideGlowBattle 3s ease-in-out infinite",
              width: "200%",
              left: "-100%"
            }
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
        @keyframes slideGlowBattle {
          0% { transform: translateX(0); }
          50% { transform: translateX(50%); }
          100% { transform: translateX(0); }
        }
      ` }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "p-6 border-b border-white/10 flex justify-between items-center",
            onClick: handleHeaderClick,
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-lg bg-gradient-to-br from-[#FC1EFF] to-[#00D1FF] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Swords, { className: "w-5 h-5 text-white" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-lg md:text-xl font-orbitron font-bold text-white", children: "M1SSION BATTLE" }),
                  pendingCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.div,
                    {
                      initial: { scale: 0 },
                      animate: { scale: 1 },
                      className: "inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-[#00D1FF]/20 border border-[#00D1FF]/50",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-3 h-3 text-[#00D1FF]" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs font-bold text-[#00D1FF]", children: [
                          pendingCount,
                          " sfide"
                        ] })
                      ]
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                stats && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "hidden md:flex items-center gap-4 text-sm", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-4 h-4 text-yellow-400" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/70", children: "W:" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-bold", children: stats.total_wins })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-4 h-4 text-red-400" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/70", children: "L:" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-bold", children: stats.total_losses })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { rotate: isExpanded ? 180 : 0 },
                    transition: { duration: 0.3 },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-5 h-5 text-white/60" })
                  }
                )
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { height: 0, opacity: 0 },
            animate: { height: "auto", opacity: 1 },
            exit: { height: 0, opacity: 0 },
            transition: { duration: 0.5, ease: "easeInOut" },
            className: "overflow-hidden",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "lobby", className: "w-full", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-3 bg-black/30", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "lobby", className: "data-[state=active]:bg-[#FC1EFF]/20 data-[state=active]:text-[#FC1EFF]", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Swords, { className: "w-4 h-4 mr-2" }),
                  "Lobby"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "stats", className: "data-[state=active]:bg-[#00D1FF]/20 data-[state=active]:text-[#00D1FF]", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-4 h-4 mr-2" }),
                  "Stats"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "leaderboard", className: "data-[state=active]:bg-[#FACC15]/20 data-[state=active]:text-[#FACC15]", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-4 h-4 mr-2" }),
                  "Top"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "lobby", className: "max-h-[70vh] overflow-y-auto custom-scrollbar mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(reactExports.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-12", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "w-8 h-8 border-2 border-[#FC1EFF] border-t-transparent rounded-full",
                  animate: { rotate: 360 },
                  transition: { duration: 1, repeat: Infinity, ease: "linear" }
                }
              ) }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleLobby$2, {}) }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "stats", className: "mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: stats ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-black/30 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-1", children: "Total Battles" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-white", children: stats.total_battles })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-black/30 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-1", children: "Win Rate" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-[#00D1FF]", children: [
                      stats.win_rate,
                      "%"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-black/30 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-1", children: "Best Reaction" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-[#FC1EFF]", children: [
                      stats.best_reaction_ms,
                      "ms"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-black/30 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-1", children: "Avg Reaction" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-yellow-400", children: [
                      stats.avg_reaction_ms,
                      "ms"
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-gradient-to-r from-[#FC1EFF]/10 to-[#00D1FF]/10 border border-[#FC1EFF]/30", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-2", children: "Total Earned" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-5 h-5 text-[#FACC15]" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-bold text-white", children: [
                      stats.total_energy_won,
                      " Energy"
                    ] })
                  ] })
                ] })
              ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8 text-white/50", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Swords, { className: "w-12 h-12 mx-auto mb-3 opacity-30" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Play your first battle to see stats" })
              ] }) }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "leaderboard", className: "mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8 text-white/50", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-12 h-12 mx-auto mb-3 opacity-30" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Leaderboard coming soon" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs mt-2", children: "Battle to earn your rank" })
              ] }) })
            ] }) })
          }
        ) })
      ]
    }
  );
}

function AgentDiary({ entries, onAddNote, purchasedClues }) {
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const [newNote, setNewNote] = reactExports.useState("");
  const [showAddNote, setShowAddNote] = reactExports.useState(false);
  const handleHeaderClick = () => {
    setIsExpanded(!isExpanded);
  };
  const handleAddNote = () => {
    if (newNote.trim()) {
      onAddNote(newNote.trim());
      setNewNote("");
      setShowAddNote(false);
    }
  };
  const formatTimestamp = (timestamp) => {
    const date = new Date(timestamp);
    return date.toLocaleString("it-IT", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit"
    });
  };
  const getAgentStats = () => {
    return {
      totalEntries: entries.length,
      notesCount: entries.filter((entry) => entry.type === "note").length,
      purchasesCount: entries.filter((entry) => entry.type === "purchase").length,
      cluesCount: purchasedClues.length
    };
  };
  const stats = getAgentStats();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "m1-relief rounded-[20px] overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] mb-4 relative",
      whileHover: { scale: 1.02 },
      whileTap: { scale: 0.98 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
            style: {
              animation: "slideGlowAgent 3s ease-in-out infinite",
              width: "200%",
              left: "-100%"
            }
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
        @keyframes slideGlowAgent {
          0% { transform: translateX(0); }
          50% { transform: translateX(50%); }
          100% { transform: translateX(0); }
        }
      ` }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "p-6 border-b border-white/10 flex justify-between items-center",
            onClick: handleHeaderClick,
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-lg md:text-xl font-orbitron font-bold text-white", children: "M1SSION AGENT" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/70", children: [
                  "Attivit: ",
                  entries.length
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { rotate: isExpanded ? 180 : 0 },
                    transition: { duration: 0.3 },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-4 h-4 text-white/60" })
                  }
                )
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { height: 0, opacity: 0 },
            animate: { height: "auto", opacity: 1 },
            exit: { height: 0, opacity: 0 },
            transition: { duration: 0.5, ease: "easeInOut" },
            className: "overflow-hidden",
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-3 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-blue-400", children: stats.totalEntries }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Attivit Totali" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-green-400", children: stats.notesCount }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Note Personali" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-yellow-400", children: stats.purchasesCount }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Acquisti" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-purple-400", children: stats.cluesCount }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Indizi" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  "button",
                  {
                    onClick: (e) => {
                      e.stopPropagation();
                      setShowAddNote(!showAddNote);
                    },
                    className: "w-full p-3 bg-gradient-to-r from-[#365EFF]/20 to-[#FC1EFF]/20 border border-[#365EFF]/30 rounded-[16px] text-white hover:from-[#365EFF]/30 hover:to-[#FC1EFF]/30 transition-all flex items-center justify-center space-x-2",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-orbitron", children: "Aggiungi Nota Personale" })
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showAddNote && /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    initial: { height: 0, opacity: 0 },
                    animate: { height: "auto", opacity: 1 },
                    exit: { height: 0, opacity: 0 },
                    transition: { duration: 0.3 },
                    className: "mt-3 overflow-hidden",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "textarea",
                        {
                          value: newNote,
                          onChange: (e) => setNewNote(e.target.value),
                          placeholder: "Scrivi la tua nota personale...",
                          className: "w-full p-3 bg-[#0a0a0a]/50 border border-white/20 rounded-[16px] text-white placeholder-white/50 resize-none focus:outline-none focus:border-[#365EFF]/50",
                          rows: 3,
                          onClick: (e) => e.stopPropagation()
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex space-x-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          "button",
                          {
                            onClick: (e) => {
                              e.stopPropagation();
                              handleAddNote();
                            },
                            className: "px-4 py-2 bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white rounded-full text-sm hover:shadow-lg transition-all font-orbitron",
                            children: "Salva Nota"
                          }
                        ),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          "button",
                          {
                            onClick: (e) => {
                              e.stopPropagation();
                              setShowAddNote(false);
                              setNewNote("");
                            },
                            className: "px-4 py-2 bg-gray-600 text-white rounded-full text-sm hover:bg-gray-700 transition-all font-orbitron",
                            children: "Annulla"
                          }
                        )
                      ] })
                    ] })
                  }
                ) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3 max-h-[calc(100vh-30rem)] overflow-y-auto pr-1 custom-scrollbar", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium mb-3 font-orbitron", children: "Diario delle Attivit" }),
                entries.length > 0 ? entries.map((entry, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "p-3 bg-[#0a0a0a]/50 rounded-[16px] border border-white/10 hover:border-white/20 transition-colors",
                    initial: { opacity: 0, x: -20 },
                    animate: { opacity: 1, x: 0 },
                    transition: { duration: 0.3, delay: index * 0.05 },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-start space-x-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-sm leading-relaxed break-words", children: entry.content }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/60 mt-2 block", children: formatTimestamp(entry.timestamp) })
                    ] }) })
                  },
                  index
                )) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8 text-white/50", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: "Nessuna attivit registrata" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/40 mt-1", children: "Le tue azioni verranno registrate qui" })
                ] })
              ] })
            ] })
          }
        ) })
      ]
    }
  );
}

const BattleArena$2 = reactExports.lazy(() => __vitePreload(() => Promise.resolve().then(() => BattleArena$1),true?void 0:void 0));
function BattleArenaOverlay({ battleId, open, onClose }) {
  if (!battleId || !open) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: open && /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "fixed inset-0 z-[200] bg-black/98 backdrop-blur-xl",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      transition: { duration: 0.3 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-4 right-4 z-[201] safe-top", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "icon",
            onClick: onClose,
            className: "w-10 h-10 rounded-full bg-black/50 hover:bg-black/70 text-white border border-white/20",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-5 h-5" })
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-full w-full overflow-y-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          reactExports.Suspense,
          {
            fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center min-h-screen", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "w-12 h-12 border-4 border-[#FC1EFF] border-t-transparent rounded-full",
                animate: { rotate: 360 },
                transition: { duration: 1, repeat: Infinity, ease: "linear" }
              }
            ) }),
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleArena$2, { battleId })
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 pointer-events-none opacity-30",
            style: {
              background: "radial-gradient(circle at 50% 50%, rgba(252, 30, 255, 0.1) 0%, transparent 50%)"
            }
          }
        )
      ]
    }
  ) });
}

function useBattleOverlay() {
  const [location, setLocation] = useLocation();
  const [battleId, setBattleId] = reactExports.useState(null);
  const [isOpen, setIsOpen] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const battleMatch = location.match(/^\/battle\/([a-f0-9-]+)$/);
    if (battleMatch && location.startsWith("/home")) {
      const id = battleMatch[1];
      setBattleId(id);
      setIsOpen(true);
    }
  }, [location]);
  reactExports.useEffect(() => {
    const handleNotificationIntent = (event) => {
      const { type, battle_id } = event.detail || {};
      if (type === "battle_invite" && battle_id) {
        setBattleId(battle_id);
        setIsOpen(true);
      }
    };
    window.addEventListener("push-notification-intent", handleNotificationIntent);
    return () => {
      window.removeEventListener("push-notification-intent", handleNotificationIntent);
    };
  }, []);
  const openBattle = (id) => {
    setBattleId(id);
    setIsOpen(true);
  };
  const closeBattle = () => {
    setIsOpen(false);
    setBattleId(null);
    if (location.startsWith("/battle/")) {
      setLocation("/home");
    }
  };
  return {
    battleId,
    isOpen,
    openBattle,
    closeBattle
  };
}

function ActiveMissionBox({ mission, purchasedClues = [], progress = 0 }) {
  const [expandedBox, setExpandedBox] = reactExports.useState(null);
  const realCluesFound = mission.foundClues ?? 0;
  const totalClues = mission.totalClues || 200;
  const { notifications } = useNotifications();
  const buzzClues = notifications.filter((n) => n.type === "buzz");
  const fallbackFoundFromBuzz = buzzClues?.length || 0;
  const displayCluesFound = realCluesFound > 0 ? realCluesFound : fallbackFoundFromBuzz;
  const toggleBox = (boxId) => {
    setExpandedBox(expandedBox === boxId ? null : boxId);
  };
  const getMissionTimeline = () => {
    const startDate = new Date(mission.startTime);
    return [
      { event: "Missione Iniziata", date: startDate.toLocaleDateString(), status: "completed" },
      { event: "Primo Indizio", date: new Date(startDate.getTime() + 864e5).toLocaleDateString(), status: "completed" },
      { event: "Fase Intermedia", date: (/* @__PURE__ */ new Date()).toLocaleDateString(), status: "current" },
      { event: "Deadline Finale", date: new Date(startDate.getTime() + mission.totalDays * 864e5).toLocaleDateString(), status: "pending" }
    ];
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-xl font-orbitron font-bold mb-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", children: "PROTOCOLLO" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: " DI RILEVAMENTO" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-xl font-orbitron font-bold", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", children: "MISSIONE ID:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
          " ",
          mission.title
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "m1-relief-sm rounded-2xl p-4 cursor-pointer hover:border-green-500/30 transition-colors overflow-hidden relative",
          onClick: () => toggleBox("clues"),
          whileHover: { scale: 1.02 },
          whileTap: { scale: 0.98 },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                style: {
                  animation: "slideGlow 3s ease-in-out infinite",
                  width: "200%",
                  left: "-100%"
                }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
            @keyframes slideGlow {
              0% { transform: translateX(0); }
              50% { transform: translateX(50%); }
              100% { transform: translateX(0); }
            }
          ` }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 mb-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-green-400 rounded-full" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80 text-sm", children: "Indizi trovati" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-green-400 mb-2", children: [
              displayCluesFound,
              "/",
              totalClues
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-gray-700 rounded-full h-2 mb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: `h-2 rounded-full transition-all duration-500 ${displayCluesFound === 0 ? "bg-gray-500" : displayCluesFound < 50 ? "bg-gradient-to-r from-[#22C55E] to-[#10B981]" : displayCluesFound < 100 ? "bg-gradient-to-r from-[#10B981] to-[#00D1FF]" : displayCluesFound < 150 ? "bg-gradient-to-r from-[#00D1FF] to-[#A855F7]" : "bg-gradient-to-r from-[#A855F7] to-[#D946EF]"}`,
                style: { width: `${displayCluesFound / totalClues * 100}%` }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/60", children: [
              Math.round(displayCluesFound / totalClues * 100),
              "% completato"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: expandedBox === "clues" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { height: 0, opacity: 0 },
                animate: { height: "auto", opacity: 1 },
                exit: { height: 0, opacity: 0 },
                transition: { duration: 0.3, ease: "easeInOut" },
                className: "overflow-hidden mt-4 pt-4 border-t border-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "text-white font-medium mb-3", children: [
                    "Indizi BUZZ Scoperti (",
                    buzzClues.length,
                    ")"
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: buzzClues.length > 0 ? buzzClues.map((clue, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.div,
                    {
                      className: "bg-white/5 rounded-lg p-3 border border-white/10 hover:border-white/20 transition-colors",
                      initial: { opacity: 0, x: -10 },
                      animate: { opacity: 1, x: 0 },
                      transition: { delay: index * 0.1 },
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between mb-2", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "text-sm font-medium text-white", children: clue.title }),
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/50", children: new Date(clue.date).toLocaleDateString("it-IT") }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "inline-block px-2 py-1 text-xs bg-blue-500/20 text-blue-300 rounded-full", children: "BUZZ" })
                          ] })
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/80 leading-relaxed mb-3", children: clue.description }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-green-400", children: " Scoperto via BUZZ" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("button", { className: "px-3 py-1 bg-blue-600/20 hover:bg-blue-600/30 text-blue-300 text-xs rounded-lg border border-blue-500/30 transition-colors", children: " Visualizza" })
                        ] })
                      ]
                    },
                    clue.id
                  )) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-4 text-white/60", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Nessun indizio trovato oggi." }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-2", children: "Premi BUZZ per scoprire nuovi indizi!" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 p-3 bg-blue-900/20 rounded-lg border border-blue-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-blue-300", children: " Gli indizi BUZZ verranno visualizzati qui dopo ogni utilizzo" }) })
                  ] }) })
                ]
              }
            ) })
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "m1-relief-sm rounded-2xl p-4 cursor-pointer hover:border-amber-500/30 transition-colors overflow-hidden relative",
          onClick: () => toggleBox("time"),
          whileHover: { scale: 1.02 },
          whileTap: { scale: 0.98 },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                style: {
                  animation: "slideGlowTime 3s ease-in-out infinite",
                  width: "200%",
                  left: "-100%"
                }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
            @keyframes slideGlowTime {
              0% { transform: translateX(0); }
              50% { transform: translateX(50%); }
              100% { transform: translateX(0); }
            }
          ` }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 mb-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-amber-400 rounded-full" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80 text-sm", children: "Tempo rimasto" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-amber-400 mb-2", children: [
              mission.remainingDays,
              " giorni"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-gray-700 rounded-full h-2 mb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: `h-2 rounded-full transition-all duration-500 ${mission.remainingDays <= 0 ? "bg-gradient-to-r from-[#EF4444] to-[#DC2626]" : mission.remainingDays <= 5 ? "bg-gradient-to-r from-[#F97316] to-[#EF4444]" : mission.remainingDays <= 15 ? "bg-gradient-to-r from-[#FBBF24] to-[#F97316]" : "bg-gradient-to-r from-[#FDE047] to-[#FBBF24]"}`,
                style: { width: `${(mission.totalDays - mission.remainingDays) / mission.totalDays * 100}%` }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/60", children: [
              "su ",
              mission.totalDays,
              " giorni totali"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: expandedBox === "time" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { height: 0, opacity: 0 },
                animate: { height: "auto", opacity: 1 },
                exit: { height: 0, opacity: 0 },
                transition: { duration: 0.3, ease: "easeInOut" },
                className: "overflow-hidden mt-4 pt-4 border-t border-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium mb-3", children: "Timeline Missione" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: getMissionTimeline().map((item, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-2 bg-[#0a0a0a] rounded", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white text-sm", children: item.event }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/60", children: item.date }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-2 h-2 rounded-full ${item.status === "completed" ? "bg-green-400" : item.status === "current" ? "bg-amber-400" : "bg-gray-600"}` })
                    ] })
                  ] }, index)) })
                ]
              }
            ) })
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "m1-relief-sm rounded-2xl p-4 cursor-pointer hover:border-[#00D1FF]/30 transition-colors overflow-hidden relative",
          onClick: () => toggleBox("status"),
          whileHover: { scale: 1.02 },
          whileTap: { scale: 0.98 },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                style: {
                  animation: "slideGlowStatus 3s ease-in-out infinite",
                  width: "200%",
                  left: "-100%"
                }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
            @keyframes slideGlowStatus {
              0% { transform: translateX(0); }
              50% { transform: translateX(50%); }
              100% { transform: translateX(0); }
            }
          ` }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 mb-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-[#00D1FF] rounded-full" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80 text-sm", children: "Stato missione" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xl font-bold text-[#00D1FF] mb-3", children: mission.remainingDays > 0 ? "ATTIVA" : "SCADUTA" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-gray-700 rounded-full h-2 mb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: `h-2 rounded-full transition-all duration-500 ${mission.remainingDays <= 0 ? "bg-red-500" : mission.remainingDays <= 5 ? "bg-gradient-to-r from-yellow-400 to-red-500" : mission.remainingDays <= 15 ? "bg-gradient-to-r from-green-400 to-yellow-400" : "bg-gradient-to-r from-[#00D1FF] to-green-400"}`,
                style: { width: `${(mission.totalDays - mission.remainingDays) / mission.totalDays * 100}%` }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-white/60 mb-1", children: [
              "Iniziata il ",
              new Date(mission.startTime).toLocaleDateString("it-IT")
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/60", children: [
              Math.round((mission.totalDays - mission.remainingDays) / mission.totalDays * 100),
              "% tempo trascorso (",
              mission.totalDays - mission.remainingDays,
              "/",
              mission.totalDays,
              " giorni)"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: expandedBox === "status" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { height: 0, opacity: 0 },
                animate: { height: "auto", opacity: 1 },
                exit: { height: 0, opacity: 0 },
                transition: { duration: 0.3, ease: "easeInOut" },
                className: "overflow-hidden mt-4 pt-4 border-t border-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium mb-3", children: "Dettagli Progresso" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between mb-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white text-sm", children: "Progresso Generale" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-[#00D1FF] text-sm font-bold", children: [
                        Math.round(realCluesFound / totalClues * 100),
                        "%"
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-gray-700 rounded-full h-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        className: `h-3 rounded-full transition-all duration-500 ${realCluesFound === 0 ? "bg-gray-500" : realCluesFound < 50 ? "bg-gradient-to-r from-[#00D1FF] to-blue-400" : realCluesFound < 150 ? "bg-gradient-to-r from-green-400 to-[#00D1FF]" : "bg-gradient-to-r from-[#7B2EFF] to-[#00D1FF]"}`,
                        initial: { width: 0 },
                        animate: { width: `${realCluesFound / totalClues * 100}%` },
                        transition: { duration: 1, ease: "easeOut" }
                      }
                    ) })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a] p-3 rounded-lg text-center", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-green-400", children: realCluesFound }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Obiettivi Raggiunti" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a] p-3 rounded-lg text-center", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-red-400", children: totalClues - realCluesFound }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Obiettivi Rimanenti" })
                    ] })
                  ] })
                ]
              }
            ) })
          ]
        }
      )
    ] })
  ] });
}

const usePrizeData = () => {
  const [prizes, setPrizes] = reactExports.useState([]);
  const [userClues, setUserClues] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const { user } = useAuth();
  const loadPrizes = preserveFunctionName(async () => {
    if (!user) return;
    try {
      setLoading(true);
      setError(null);
      const { data: prizesData, error: prizesError } = await supabase.from("prizes").select(`
          *,
          prize_clues!inner(count)
        `).eq("is_active", true).order("start_date", { ascending: false });
      if (prizesError) {
        setError("Errore nel caricamento dei premi");
        return;
      }
      const prizeIds = prizesData?.map((p) => p.id) || [];
      if (prizeIds.length > 0) {
        const { data: allClues } = await supabase.from("prize_clues").select("id, prize_id").in("prize_id", prizeIds);
        const clueIds = allClues?.map((c) => c.id) || [];
        const { data: userCluesData } = await supabase.from("user_clues").select("*").eq("user_id", user.id).in("clue_id", clueIds);
        setUserClues(userCluesData || []);
        const clueCountMap = /* @__PURE__ */ new Map();
        allClues?.forEach((clue) => {
          const isUnlocked = userCluesData?.some((uc) => uc.clue_id === clue.id);
          if (isUnlocked) {
            clueCountMap.set(clue.prize_id, (clueCountMap.get(clue.prize_id) || 0) + 1);
          }
        });
        const enrichedPrizes = prizesData?.map((prize) => ({
          ...prize,
          clue_count: prize.prize_clues?.length || 0,
          unlocked_clues: clueCountMap.get(prize.id) || 0
        })) || [];
        setPrizes(enrichedPrizes);
      } else {
        setPrizes([]);
        setUserClues([]);
      }
    } catch (err) {
      setError("Errore di connessione");
    } finally {
      setLoading(false);
    }
  });
  const loadPrizeClues = preserveFunctionName(async (prizeId) => {
    if (!user) return [];
    try {
      const { data: prizeClues, error: cluesError } = await supabase.from("prize_clues").select("*").eq("prize_id", prizeId).order("week", { ascending: true });
      if (cluesError) {
        throw new Error("Errore nel caricamento degli indizi");
      }
      const clueIds = prizeClues?.map((c) => c.id) || [];
      const { data: userCluesData } = await supabase.from("user_clues").select("clue_id").eq("user_id", user.id).in("clue_id", clueIds);
      const unlockedClueIds = new Set(userCluesData?.map((uc) => uc.clue_id) || []);
      const enrichedClues = prizeClues?.map((clue) => ({
        ...clue,
        is_unlocked: unlockedClueIds.has(clue.id),
        unlock_cost: getUnlockCost(clue.clue_type)
      })) || [];
      return enrichedClues;
    } catch (err) {
      throw err;
    }
  });
  const getUnlockCost = (clueType) => {
    switch (clueType) {
      case "precise":
        return 50;
      case "medium":
        return 30;
      case "vague":
        return 10;
      default:
        return 20;
    }
  };
  const unlockClue = preserveFunctionName(async (clue) => {
    if (!user) return false;
    try {
      const { data: profile } = await supabase.from("profiles").select("credits").eq("id", user.id).single();
      const userCredits = profile?.credits || 0;
      const cost = clue.unlock_cost || 20;
      if (userCredits < cost) {
        ue.error(`Crediti insufficienti. Servono ${cost} crediti.`);
        return false;
      }
      const { error: updateError } = await supabase.from("profiles").update({ credits: userCredits - cost }).eq("id", user.id);
      if (updateError) {
        ue.error("Errore nell'aggiornamento dei crediti");
        return false;
      }
      const { error: insertError } = await supabase.from("user_clues").insert({
        user_id: user.id,
        clue_id: clue.id,
        title_it: clue.title_it,
        description_it: clue.description_it,
        clue_type: clue.clue_type,
        buzz_cost: cost
      });
      if (insertError) {
        await supabase.from("profiles").update({ credits: userCredits }).eq("id", user.id);
        ue.error("Errore nel salvataggio dell'indizio");
        return false;
      }
      const newUserClue = {
        clue_id: clue.id,
        user_id: user.id,
        title_it: clue.title_it,
        description_it: clue.description_it,
        clue_type: clue.clue_type,
        buzz_cost: cost,
        created_at: (/* @__PURE__ */ new Date()).toISOString()
      };
      setUserClues((prev) => [...prev, newUserClue]);
      ue.success(`Indizio sbloccato! Costato ${cost} crediti.`);
      await loadPrizes();
      return true;
    } catch (err) {
      ue.error("Errore nel sblocco dell'indizio");
      return false;
    }
  });
  const getPrizeUserClues = reactExports.useCallback((prizeId) => {
    return userClues.filter((uc) => {
      return true;
    });
  }, [userClues]);
  const getPrizeProgress = reactExports.useCallback((prize) => {
    if (!prize.clue_count) return 0;
    return Math.round((prize.unlocked_clues || 0) / prize.clue_count * 100);
  }, []);
  const isPrizeCompleted = reactExports.useCallback((prize) => {
    return getPrizeProgress(prize) === 100;
  }, [getPrizeProgress]);
  reactExports.useEffect(() => {
    if (user) {
      loadPrizes();
    }
  }, [user]);
  return {
    prizes,
    userClues,
    loading,
    error,
    loadPrizes,
    loadPrizeClues,
    unlockClue,
    getPrizeUserClues,
    getPrizeProgress,
    isPrizeCompleted,
    getUnlockCost
  };
};

const useBuzzPricing = (userId) => {
  const [userCluesCount, setUserCluesCount] = reactExports.useState(0);
  const loadUserCluesCount = reactExports.useCallback(async () => {
    if (!userId) return;
    try {
      const { count, error } = await supabase.from("user_clues").select("*", { count: "exact", head: true }).eq("user_id", userId);
      if (error) {
        return;
      }
      const cluesCount = count || 0;
      setUserCluesCount(cluesCount);
    } catch (err) {
    }
  }, [userId]);
  const calculateBuzzMapPrice = reactExports.useCallback(() => {
    if (userCluesCount <= 10) {
      return 7.99;
    }
    if (userCluesCount <= 20) {
      return 9.99;
    }
    if (userCluesCount <= 30) {
      return 13.99;
    }
    if (userCluesCount <= 40) {
      return 19.99;
    }
    return 29.99;
  }, [userCluesCount]);
  const testCalculationLogic = reactExports.useCallback(() => {
    const testCases = [5, 15, 25, 35, 45];
    testCases.forEach((clues) => {
      const oldCount = userCluesCount;
      setUserCluesCount(clues);
      setUserCluesCount(oldCount);
    });
  }, [userCluesCount, calculateBuzzMapPrice]);
  reactExports.useEffect(() => {
    if (userId) {
      loadUserCluesCount();
    }
  }, [userId, loadUserCluesCount]);
  return {
    userCluesCount,
    calculateBuzzMapPrice,
    testCalculationLogic,
    loadUserCluesCount
  };
};

const InviteFriendModal = ({
  open,
  onOpenChange
}) => {
  const { user } = useAuthContext();
  const [isSharing, setIsSharing] = reactExports.useState(false);
  const [copied, setCopied] = reactExports.useState(false);
  const referralLink = user?.id ? `https://m1ssion.eu?ref=${user.id}` : `https://m1ssion.eu`;
  const inviteMessage = ` Unisciti a M1SSION - La caccia al tesoro pi epica! Usa il mio link per iniziare: ${referralLink}`;
  const copyReferralLink = async () => {
    hapticLight();
    try {
      await navigator.clipboard.writeText(referralLink);
      setCopied(true);
      hapticSuccess();
      ue.success("Link copiato! ");
      setTimeout(() => setCopied(false), 2e3);
    } catch (error) {
      ue.error("Errore durante la copia");
    }
  };
  const shareInvite = async () => {
    hapticLight();
    if (navigator.share) {
      try {
        setIsSharing(true);
        await navigator.share({
          title: "M1SSION - Unisciti alla caccia!",
          text: "Unisciti a M1SSION - La caccia al tesoro pi epica!",
          url: referralLink
        });
        hapticSuccess();
      } catch (error) {
        if (error.name !== "AbortError") {
          ue.error("Errore durante la condivisione");
        }
      } finally {
        setIsSharing(false);
      }
    } else {
      copyReferralLink();
    }
  };
  const shareWhatsApp = () => {
    hapticLight();
    window.open(`https://wa.me/?text=${encodeURIComponent(inviteMessage)}`, "_blank");
  };
  const shareSMS = () => {
    hapticLight();
    window.open(`sms:?body=${encodeURIComponent(inviteMessage)}`);
  };
  const shareEmail = () => {
    hapticLight();
    window.open(`mailto:?subject=${encodeURIComponent("Unisciti a M1SSION!")}&body=${encodeURIComponent(inviteMessage)}`);
  };
  const shareInstagram = async () => {
    hapticLight();
    await navigator.clipboard.writeText(inviteMessage);
    ue.success("Copiato! Incollalo su Instagram Stories ");
    window.open("instagram://story-camera", "_blank");
  };
  const shareTikTok = async () => {
    hapticLight();
    await navigator.clipboard.writeText(inviteMessage);
    ue.success("Copiato! Incollalo su TikTok ");
    window.open("https://www.tiktok.com", "_blank");
  };
  const shareTelegram = () => {
    hapticLight();
    window.open(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(" Unisciti a M1SSION!")}`, "_blank");
  };
  const socialButtons = [
    { name: "WhatsApp", icon: MessageCircle, onClick: shareWhatsApp, gradient: "from-green-500 to-green-600", glow: "shadow-green-500/30" },
    { name: "Instagram", icon: Instagram, onClick: shareInstagram, gradient: "from-purple-500 via-pink-500 to-orange-400", glow: "shadow-pink-500/30" },
    { name: "TikTok", icon: Video, onClick: shareTikTok, gradient: "from-gray-700 to-gray-900", glow: "shadow-white/10" },
    { name: "Telegram", icon: MessageCircle, onClick: shareTelegram, gradient: "from-blue-400 to-blue-600", glow: "shadow-blue-500/30" },
    { name: "SMS", icon: Smartphone, onClick: shareSMS, gradient: "from-cyan-500 to-blue-500", glow: "shadow-cyan-500/30" },
    { name: "Email", icon: Mail, onClick: shareEmail, gradient: "from-purple-500 to-indigo-600", glow: "shadow-purple-500/30" }
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogContent, { className: "max-w-[340px] sm:max-w-[380px] p-0 border-0 bg-transparent overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { scale: 0.9, opacity: 0, y: 20 },
      animate: { scale: 1, opacity: 1, y: 0 },
      exit: { scale: 0.9, opacity: 0, y: 20 },
      transition: { type: "spring", duration: 0.5 },
      className: "relative",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute -inset-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 rounded-3xl blur-xl opacity-30 animate-pulse" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative bg-gradient-to-br from-[#0a0e17] via-[#111827] to-[#0a0e17] rounded-2xl border border-cyan-500/20 overflow-hidden", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 opacity-5", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAxMCAwIEwgMCAwIDAgMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMC41Ii8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+PC9zdmc+')]" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: () => onOpenChange(false),
              className: "absolute top-4 right-4 z-10 w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-4 h-4 text-gray-400" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative pt-8 pb-4 px-6 text-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { scale: 0, rotate: -180 },
                animate: { scale: 1, rotate: 0 },
                transition: { type: "spring", delay: 0.2, duration: 0.8 },
                className: "relative inline-flex mb-4",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      animate: { scale: [1, 1.2, 1], opacity: [0.5, 0.2, 0.5] },
                      transition: { duration: 2, repeat: Infinity },
                      className: "absolute inset-0 rounded-full bg-gradient-to-r from-cyan-500 to-purple-500 blur-xl"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative w-20 h-20 rounded-full bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border border-cyan-500/30 flex items-center justify-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-10 h-10 text-cyan-400" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        animate: { rotate: 360 },
                        transition: { duration: 8, repeat: Infinity, ease: "linear" },
                        className: "absolute inset-0",
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "absolute -top-1 -right-1 w-5 h-5 text-yellow-400" })
                      }
                    )
                  ] })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.h2,
              {
                initial: { opacity: 0, y: 10 },
                animate: { opacity: 1, y: 0 },
                transition: { delay: 0.3 },
                className: "text-2xl font-bold font-orbitron mb-2",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent", children: "Invita un Amico" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.p,
              {
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                transition: { delay: 0.4 },
                className: "text-gray-400 text-sm",
                children: "Condividi M1SSION e guadagna ricompense!"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-6 pb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, y: 10 },
              animate: { opacity: 1, y: 0 },
              transition: { delay: 0.5 },
              className: "relative",
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 p-3 rounded-xl bg-black/40 border border-cyan-500/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 overflow-hidden", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[10px] text-cyan-400/60 uppercase tracking-wider mb-0.5", children: "Il tuo link" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-300 truncate font-mono", children: referralLink })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.button,
                  {
                    whileTap: { scale: 0.9 },
                    onClick: copyReferralLink,
                    className: `w-10 h-10 rounded-lg flex items-center justify-center transition-all ${copied ? "bg-green-500/20 border border-green-500/50" : "bg-cyan-500/10 border border-cyan-500/30 hover:bg-cyan-500/20"}`,
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: copied ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        initial: { scale: 0 },
                        animate: { scale: 1 },
                        exit: { scale: 0 },
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-5 h-5 text-green-400" })
                      },
                      "check"
                    ) : /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        initial: { scale: 0 },
                        animate: { scale: 1 },
                        exit: { scale: 0 },
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Copy, { className: "w-5 h-5 text-cyan-400" })
                      },
                      "copy"
                    ) })
                  }
                )
              ] })
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "px-6 pb-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.p,
              {
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                transition: { delay: 0.6 },
                className: "text-xs text-gray-500 uppercase tracking-wider mb-3",
                children: "Condividi tramite"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                initial: { opacity: 0, y: 20 },
                animate: { opacity: 1, y: 0 },
                transition: { delay: 0.7 },
                className: "grid grid-cols-3 gap-2",
                children: socialButtons.map((btn, idx) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.button,
                  {
                    initial: { opacity: 0, scale: 0.8 },
                    animate: { opacity: 1, scale: 1 },
                    transition: { delay: 0.7 + idx * 0.05 },
                    whileHover: { scale: 1.05, y: -2 },
                    whileTap: { scale: 0.95 },
                    onClick: btn.onClick,
                    className: `relative group flex flex-col items-center justify-center h-[70px] rounded-xl bg-gradient-to-br ${btn.gradient} p-[1px] overflow-hidden`,
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full h-full rounded-[11px] bg-[#0a0e17]/80 flex flex-col items-center justify-center", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(btn.icon, { className: "w-6 h-6 text-white mb-1.5" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[10px] text-gray-300 font-medium", children: btn.name })
                      ] })
                    ]
                  },
                  btn.name
                ))
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-6 pb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, y: 10 },
              animate: { opacity: 1, y: 0 },
              transition: { delay: 1 },
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Button,
                {
                  onClick: shareInvite,
                  disabled: isSharing,
                  className: "w-full h-12 bg-gradient-to-r from-cyan-600 to-purple-600 hover:from-cyan-500 hover:to-purple-500 text-white font-semibold rounded-xl shadow-lg shadow-cyan-500/20 border-0",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Share2, { className: "w-5 h-5 mr-2" }),
                    isSharing ? "Condividendo..." : "Altre opzioni"
                  ]
                }
              )
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, y: 20 },
              animate: { opacity: 1, y: 0 },
              transition: { delay: 1.1 },
              className: "mx-6 mb-6 p-4 rounded-xl bg-gradient-to-r from-yellow-500/10 via-orange-500/10 to-yellow-500/10 border border-yellow-500/20",
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-full bg-yellow-500/20 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-2xl", children: "" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-300 font-semibold text-sm", children: "Ricompensa Referral" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-yellow-200/70 text-xs", children: [
                    "Guadagna ",
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-yellow-400 font-bold", children: "+25 PE" }),
                    " per ogni amico!"
                  ] })
                ] })
              ] })
            }
          )
        ] })
      ]
    }
  ) }) });
};

const InviteFloatingButton = () => {
  const [open, setOpen] = reactExports.useState(false);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.button,
      {
        "aria-label": "Invita un Amico",
        "data-onboarding": "invite",
        onClick: () => setOpen(true),
        className: "fixed z-[70] bottom-40 right-4 md:bottom-44 md:right-8 w-12 h-12 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-[hsl(282,90%,45%)]/15 to-[hsl(218,79%,59%)]/15 backdrop-blur-md border border-white/15 shadow-[0_8px_30px_rgba(114,9,183,0.25)] hover:from-[hsl(282,90%,45%)]/25 hover:to-[hsl(218,79%,59%)]/25 transition-all flex items-center justify-center",
        initial: { opacity: 0, scale: 0.9, y: -10 },
        animate: { opacity: 1, scale: 1, y: 0 },
        whileHover: { scale: 1.05 },
        whileTap: { scale: 0.95 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(UserPlus, { className: "w-5 h-5 md:w-6 md:h-6 text-white drop-shadow-[0_0_8px_rgba(255,255,255,0.3)]" })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(InviteFriendModal, { open, onOpenChange: setOpen })
  ] });
};

class DNAClient {
  async ensureDna(userId) {
    try {
      const { error } = await supabase.rpc("ensure_agent_dna", {
        p_user: userId
      });
      if (error) throw error;
    } catch (error) {
      throw error;
    }
  }
  async getDna(userId) {
    try {
      const { data, error } = await supabase.from("agent_dna").select("*").eq("user_id", userId).single();
      if (error) {
        if (error.code === "PGRST116") {
          await this.ensureDna(userId);
          return this.getDna(userId);
        }
        throw error;
      }
      return data;
    } catch (error) {
      return null;
    }
  }
  async updateDna(userId, partial) {
    try {
      await this.ensureDna(userId);
      const { data, error } = await supabase.from("agent_dna").update(partial).eq("user_id", userId).select().single();
      if (error) throw error;
      return data;
    } catch (error) {
      return null;
    }
  }
  // Helper: calculate DNA boost from activity (non-invasive)
  calculateActivityBoost(loginCount) {
    const baseBoost = Math.min(5, Math.floor(loginCount / 10));
    return {
      intuito: 50 + baseBoost,
      audacia: 50 + Math.floor(baseBoost * 0.8),
      etica: 50 + Math.floor(baseBoost * 1.2),
      rischio: 50 + Math.floor(baseBoost * 0.6),
      vibrazione: 50 + baseBoost
    };
  }
}
const dnaClient = new DNAClient();

const ARCHETYPE_CONFIGS = {
  Seeker: {
    id: "Seeker",
    name: "Seeker",
    nameIt: "Cercatore",
    description: "Guidato dall'intuizione e dalla vibrazione. Esplori territori inesplorati con curiosit e apertura mentale.",
    color: "#00d1ff",
    icon: "",
    accentVar: "hsl(190, 100%, 50%)"
  },
  Breaker: {
    id: "Breaker",
    name: "Breaker",
    nameIt: "Spezzacatene",
    description: "Audacia e rischio sono il tuo motore. Sfidi i limiti e rompi gli schemi con coraggio.",
    color: "#ff2768",
    icon: "",
    accentVar: "hsl(345, 100%, 57%)"
  },
  Oracle: {
    id: "Oracle",
    name: "Oracle",
    nameIt: "Oracolo",
    description: "Intuito elevato e rischio calibrato. Vedi oltre le apparenze e comprendi le dinamiche nascoste.",
    color: "#8a5cff",
    icon: "",
    accentVar: "hsl(260, 100%, 67%)"
  },
  Warden: {
    id: "Warden",
    name: "Warden",
    nameIt: "Guardiano",
    description: "Etica e prudenza definiscono le tue scelte. Proteggi ci che  giusto con integrit.",
    color: "#00ff85",
    icon: "",
    accentVar: "hsl(152, 100%, 50%)"
  },
  Nomad: {
    id: "Nomad",
    name: "Nomad",
    nameIt: "Nomade",
    description: "Equilibrio e adattabilit. Il tuo DNA  in costante ricerca della propria identit.",
    color: "#9d9d9d",
    icon: "",
    accentVar: "hsl(0, 0%, 62%)"
  }
};
function calculateArchetype(scores) {
  const { intuito, audacia, etica, rischio, vibrazione } = scores;
  const seekerScore = intuito + vibrazione + (etica >= 50 ? 10 : 0);
  const breakerScore = audacia + rischio + (etica <= 55 ? 10 : 0);
  const oracleScore = (intuito >= 70 ? intuito + 20 : intuito) + (60 - Math.abs(rischio - 50));
  const wardenScore = (etica >= 70 ? etica + 20 : etica) + (60 - Math.abs(rischio - 30));
  const scores_map = {
    Seeker: seekerScore,
    Breaker: breakerScore,
    Oracle: oracleScore,
    Warden: wardenScore
  };
  const sorted = Object.entries(scores_map).sort((a, b) => b[1] - a[1]);
  return sorted[0][0];
}
function getDefaultScores() {
  return {
    intuito: 50,
    audacia: 50,
    etica: 50,
    rischio: 50,
    vibrazione: 50
  };
}
const DNA_QUESTIONS = [
  {
    id: "q1",
    attribute: "intuito",
    question: "Di fronte a una situazione nuova, ti affidi a:",
    options: [
      { label: "Analisi razionale e dati", value: 30 },
      { label: "Mix di logica e intuizione", value: 60 },
      { label: "Istinto e sensazioni", value: 90 }
    ]
  },
  {
    id: "q2",
    attribute: "audacia",
    question: "Preferisci prendere decisioni:",
    options: [
      { label: "Dopo aver valutato ogni dettaglio", value: 30 },
      { label: "Con una buona pianificazione", value: 60 },
      { label: "Rapidamente, seguendo l'impulso", value: 90 }
    ]
  },
  {
    id: "q3",
    attribute: "etica",
    question: "Per raggiungere un obiettivo importante:",
    options: [
      { label: "Tutti i mezzi sono leciti", value: 20 },
      { label: "Accetto compromessi ragionevoli", value: 60 },
      { label: "Mai scendere a compromessi etici", value: 95 }
    ]
  },
  {
    id: "q4",
    attribute: "rischio",
    question: "Il tuo rapporto con il rischio:",
    options: [
      { label: "Lo evito quando possibile", value: 20 },
      { label: "Lo gestisco con attenzione", value: 50 },
      { label: "Lo cerco attivamente", value: 85 }
    ]
  },
  {
    id: "q5",
    attribute: "vibrazione",
    question: "Ti senti pi connesso a:",
    options: [
      { label: "Fatti concreti e tangibili", value: 30 },
      { label: "Equilibrio tra reale e possibile", value: 60 },
      { label: "Energie e possibilit nascoste", value: 90 }
    ]
  }
];

const getTodayKey = () => {
  const today = /* @__PURE__ */ new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, "0");
  const dd = String(today.getDate()).padStart(2, "0");
  return `${yyyy}-${mm}-${dd}`;
};
const useDNA = () => {
  const { isAuthenticated, getCurrentUser } = useUnifiedAuth();
  const [dnaProfile, setDnaProfile] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [needsOnboarding, setNeedsOnboarding] = reactExports.useState(false);
  const user = getCurrentUser();
  const userId = user?.id ?? "anon";
  reactExports.useEffect(() => {
    const loadDNA = async () => {
      if (!isAuthenticated || !user) {
        setIsLoading(false);
        return;
      }
      try {
        const remoteDNA = await dnaClient.getDna(userId);
        if (remoteDNA) {
          const archetype = remoteDNA.archetype || calculateArchetype({
            intuito: remoteDNA.intuito,
            audacia: remoteDNA.audacia,
            etica: remoteDNA.etica,
            rischio: remoteDNA.rischio,
            vibrazione: remoteDNA.vibrazione
          });
          const profile = {
            intuito: remoteDNA.intuito,
            audacia: remoteDNA.audacia,
            etica: remoteDNA.etica,
            rischio: remoteDNA.rischio,
            vibrazione: remoteDNA.vibrazione,
            archetype,
            completedAt: remoteDNA.updated_at
          };
          setDnaProfile(profile);
          localStorage.setItem(`dna:profile:${userId}`, JSON.stringify(profile));
          localStorage.setItem(`dna:completed:${userId}`, "1");
          setNeedsOnboarding(false);
        } else {
          const localProfile = localStorage.getItem(`dna:profile:${userId}`);
          const completed = localStorage.getItem(`dna:completed:${userId}`) === "1";
          if (localProfile && completed) {
            const profile = JSON.parse(localProfile);
            setDnaProfile(profile);
            setNeedsOnboarding(false);
          } else {
            const lastShown = localStorage.getItem(`dna:lastShown:${userId}`);
            const today = getTodayKey();
            if (lastShown !== today) {
              setNeedsOnboarding(true);
            } else {
              setNeedsOnboarding(false);
            }
          }
        }
      } catch (error) {
      } finally {
        setIsLoading(false);
      }
    };
    loadDNA();
  }, [isAuthenticated, user, userId]);
  const saveDNA = async (scores) => {
    if (!user) return false;
    try {
      const archetype = calculateArchetype(scores);
      const profile = {
        ...scores,
        archetype,
        completedAt: (/* @__PURE__ */ new Date()).toISOString()
      };
      localStorage.setItem(`dna:profile:${userId}`, JSON.stringify(profile));
      localStorage.setItem(`dna:completed:${userId}`, "1");
      localStorage.setItem(`dna:lastShown:${userId}`, getTodayKey());
      setDnaProfile(profile);
      setNeedsOnboarding(false);
      try {
        await dnaClient.updateDna(userId, scores);
      } catch (syncError) {
      }
      return true;
    } catch (error) {
      return false;
    }
  };
  const recordOnboardingShown = () => {
    localStorage.setItem(`dna:lastShown:${userId}`, getTodayKey());
    setNeedsOnboarding(false);
  };
  const pendingUpdateRef = reactExports.useRef(null);
  const updateDNA = reactExports.useCallback(async (partial) => {
    if (!dnaProfile) return false;
    if (pendingUpdateRef.current) {
      clearTimeout(pendingUpdateRef.current);
    }
    return new Promise((resolve) => {
      pendingUpdateRef.current = setTimeout(async () => {
        const updatedScores = {
          intuito: partial.intuito ?? dnaProfile.intuito,
          audacia: partial.audacia ?? dnaProfile.audacia,
          etica: partial.etica ?? dnaProfile.etica,
          rischio: partial.rischio ?? dnaProfile.rischio,
          vibrazione: partial.vibrazione ?? dnaProfile.vibrazione
        };
        const result = await saveDNA(updatedScores);
        resolve(result);
      }, 400);
    });
  }, [dnaProfile, saveDNA]);
  reactExports.useEffect(() => {
  }, [user, dnaProfile]);
  return {
    dnaProfile,
    isLoading,
    needsOnboarding,
    saveDNA,
    updateDNA,
    recordOnboardingShown
  };
};

const ArchetypeIcon = ({
  archetype,
  size = 24,
  animated = true
}) => {
  const shouldAnimate = animated && window.matchMedia("(prefers-reduced-motion: no-preference)").matches;
  const color = ARCHETYPE_CONFIGS[archetype].color;
  const iconVariants = {
    Seeker: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M12 5C7 5 2.73 8.11 1 12.5c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5C21.27 8.11 17 5 12 5z",
          stroke: color,
          strokeWidth: "1.5",
          fill: "none",
          animate: shouldAnimate ? {
            opacity: [1, 0.7, 1],
            scale: [1, 1.02, 1]
          } : {},
          transition: {
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.circle,
        {
          cx: "12",
          cy: "12.5",
          r: "3.5",
          fill: color,
          opacity: "0.8",
          animate: shouldAnimate ? {
            scale: [1, 1.1, 1],
            opacity: [0.8, 1, 0.8]
          } : {},
          transition: {
            duration: 1.5,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "12", cy: "12.5", r: "1.5", fill: "#000" })
    ] }),
    Breaker: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M13 2L3 14h8l-1 8 10-12h-8l1-8z",
          fill: color,
          opacity: "0.9",
          animate: shouldAnimate ? {
            x: [0, -1, 1, 0],
            opacity: [0.9, 1, 0.9, 1, 0.9]
          } : {},
          transition: {
            duration: 0.8,
            repeat: Infinity,
            ease: "linear",
            times: [0, 0.2, 0.4, 0.6, 1]
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M13 2L3 14h8l-1 8 10-12h-8l1-8z",
          stroke: color,
          strokeWidth: "1",
          fill: "none",
          animate: shouldAnimate ? {
            opacity: [0, 0.5, 0],
            scale: [1, 1.05, 1]
          } : {},
          transition: {
            duration: 1.2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      )
    ] }),
    Oracle: /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("g", { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "path",
        {
          d: "M12 2L6 7l6 5 6-5-6-5z",
          fill: color,
          opacity: "0.7"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "path",
        {
          d: "M12 12l-6 5 6 5 6-5-6-5z",
          fill: color,
          opacity: "0.9"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M6 7v10l6 5V12L6 7z",
          fill: color,
          opacity: "0.5",
          animate: shouldAnimate ? {
            opacity: [0.5, 0.7, 0.5]
          } : {},
          transition: {
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "path",
        {
          d: "M18 7v10l-6 5V12l6-5z",
          fill: color,
          opacity: "0.6"
        }
      )
    ] }) }),
    Warden: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "path",
        {
          d: "M12 2L4 6v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V6l-8-4z",
          stroke: color,
          strokeWidth: "1.5",
          fill: "none"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.circle,
        {
          cx: "12",
          cy: "12",
          r: "4",
          stroke: color,
          strokeWidth: "1.5",
          fill: "none",
          animate: shouldAnimate ? {
            scale: [1, 1.1, 1],
            opacity: [0.6, 1, 0.6]
          } : {},
          transition: {
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M12 8v8M8 12h8",
          stroke: color,
          strokeWidth: "2",
          strokeLinecap: "round",
          animate: shouldAnimate ? {
            opacity: [0.8, 1, 0.8]
          } : {},
          transition: {
            duration: 1.5,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      )
    ] }),
    Nomad: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "circle",
        {
          cx: "12",
          cy: "12",
          r: "8",
          stroke: color,
          strokeWidth: "1.5",
          fill: "none",
          opacity: "0.3"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.circle,
        {
          cx: "12",
          cy: "12",
          r: "5",
          stroke: color,
          strokeWidth: "1",
          fill: "none",
          opacity: "0.5",
          animate: shouldAnimate ? {
            scale: [1, 1.05, 1]
          } : {},
          transition: {
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("g", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "20", cy: "12", r: "2", fill: color, opacity: "0.8" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.circle,
          {
            cx: "18",
            cy: "12",
            r: "1.5",
            fill: color,
            opacity: "0.4",
            animate: shouldAnimate ? {
              opacity: [0.4, 0, 0.4]
            } : {},
            transition: {
              duration: 1,
              repeat: Infinity,
              ease: "easeInOut"
            }
          }
        )
      ] })
    ] })
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "inline-flex items-center justify-center", style: { filter: `drop-shadow(0 0 8px ${color}40)` }, children: iconVariants[archetype] });
};

const DNAQuickAction = () => {
  const [, setLocation] = useLocation();
  const { dnaProfile, isLoading } = useDNA();
  if (isLoading || !dnaProfile) {
    return null;
  }
  const archetypeConfig = ARCHETYPE_CONFIGS[dnaProfile.archetype];
  const handleClick = () => {
    setLocation("/dna");
    ue.info("DNA Hub aperto", {
      description: `${archetypeConfig.nameIt}  Codice Vivo`,
      icon: archetypeConfig.icon
    });
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.button,
    {
      "aria-label": `M1SSION DNA - ${archetypeConfig.nameIt}`,
      onClick: handleClick,
      className: "fixed z-[70] bottom-24 right-4 md:bottom-28 md:right-8 w-12 h-12 md:w-14 md:h-14 rounded-full backdrop-blur-md border shadow-lg transition-all flex items-center justify-center",
      style: {
        backgroundColor: `${archetypeConfig.color}15`,
        borderColor: `${archetypeConfig.color}40`,
        boxShadow: `0 8px 30px ${archetypeConfig.color}25, 0 0 20px ${archetypeConfig.color}15`
      },
      initial: { opacity: 0, scale: 0.9, y: -10 },
      animate: { opacity: 1, scale: 1, y: 0 },
      transition: { duration: 0.4, delay: 0.1 },
      whileHover: { scale: 1.05 },
      whileTap: { scale: 0.95 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute inset-0 rounded-full",
            style: {
              backgroundColor: archetypeConfig.color,
              opacity: 0.2
            },
            animate: {
              scale: [1, 1.2, 1],
              opacity: [0.2, 0.1, 0.2]
            },
            transition: {
              duration: 2,
              repeat: Infinity,
              ease: "easeInOut"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative z-10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          ArchetypeIcon,
          {
            archetype: dnaProfile.archetype,
            size: 24,
            animated: true
          }
        ) })
      ]
    }
  );
};

const RECONNECT_EVENTS = {
  RECONNECTING: "realtime:reconnecting",
  SUBSCRIBED: "realtime:subscribed",
  ERROR: "realtime:error"
};
function emitSubscribed(channelName) {
  const event = new CustomEvent(RECONNECT_EVENTS.SUBSCRIBED, {
    detail: {
      timestamp: Date.now(),
      channelName
    }
  });
  window.dispatchEvent(event);
}
function emitError(reason, channelName) {
  const event = new CustomEvent(RECONNECT_EVENTS.ERROR, {
    detail: {
      timestamp: Date.now(),
      channelName,
      reason
    }
  });
  window.dispatchEvent(event);
}
function onReconnectEvent(eventType, handler) {
  const listener = (event) => {
    handler(event.detail);
  };
  window.addEventListener(eventType, listener);
  return () => {
    window.removeEventListener(eventType, listener);
  };
}

const usePulseRealtime = () => {
  const [pulseState, setPulseState] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const [lastUpdate, setLastUpdate] = reactExports.useState(null);
  const channelRef = reactExports.useRef(null);
  const lastUpdateTime = reactExports.useRef(0);
  const fetchState = reactExports.useCallback(async () => {
    try {
      setIsLoading(true);
      setError(null);
      const { data, error: rpcError } = await supabase.rpc("rpc_pulse_state_read");
      if (rpcError) {
        throw rpcError;
      }
      if (data) {
        const parsed = typeof data === "string" ? JSON.parse(data) : data;
        const mappedState = {
          value: parsed.current_value ?? parsed.value ?? 0,
          last_threshold: parsed.last_threshold ?? 0,
          updated_at: parsed.updated_at ?? (/* @__PURE__ */ new Date()).toISOString()
        };
        setPulseState(mappedState);
      }
    } catch (err) {
      setError(err);
    } finally {
      setIsLoading(false);
    }
  }, []);
  reactExports.useEffect(() => {
    fetchState();
    const stateChannel = supabase.channel("pulse_state_changes").on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "pulse_state"
      },
      (payload) => {
        const newRow = payload.new;
        const mappedState = {
          value: newRow.value ?? 0,
          last_threshold: newRow.last_threshold ?? 0,
          updated_at: newRow.updated_at ?? (/* @__PURE__ */ new Date()).toISOString()
        };
        setPulseState(mappedState);
      }
    ).subscribe((status) => {
      if (status === "SUBSCRIBED") {
        emitSubscribed("pulse_state_changes");
      } else if (status === "CHANNEL_ERROR" || status === "TIMED_OUT") {
        emitError(String(status), "pulse_state_changes");
      }
    });
    const notifyChannel = supabase.channel("pulse_notifications").on("broadcast", { event: "pulse_update" }, (payload) => {
      const now = Date.now();
      if (now - lastUpdateTime.current < 100) return;
      lastUpdateTime.current = now;
      setLastUpdate(payload.payload);
    }).subscribe((status) => {
      if (status === "SUBSCRIBED") {
        emitSubscribed("pulse_notifications");
      } else if (status === "CHANNEL_ERROR" || status === "TIMED_OUT") {
        emitError(String(status), "pulse_notifications");
      }
    });
    channelRef.current = { stateChannel, notifyChannel };
    return () => {
      stateChannel.unsubscribe();
      notifyChannel.unsubscribe();
    };
  }, [fetchState]);
  return {
    pulseState,
    isLoading,
    error,
    lastUpdate,
    refetch: fetchState
  };
};

const useAgentEnergy = () => {
  const { user } = useAuth();
  const [energy, setEnergy] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const [lastDelta, setLastDelta] = reactExports.useState(null);
  const channelRef = reactExports.useRef(null);
  const previousPE = reactExports.useRef(0);
  const fetchRanks = reactExports.useCallback(async () => {
    const { data, error: error2 } = await supabase.from("agent_ranks").select("*").order("pe_min", { ascending: true });
    if (error2) throw error2;
    return data || [];
  }, []);
  const calculateProgress = (currentPE, currentRank, nextRank) => {
    if (!currentRank || !nextRank) {
      return { progress: 100, peToNext: 0 };
    }
    const rangeStart = currentRank.pe_min;
    const rangeEnd = nextRank.pe_min;
    const peInRange = currentPE - rangeStart;
    const totalRange = rangeEnd - rangeStart;
    const progress = Math.min(100, Math.max(0, peInRange / totalRange * 100));
    const peToNext = Math.max(0, rangeEnd - currentPE);
    return { progress, peToNext };
  };
  const fetchEnergy = reactExports.useCallback(async () => {
    if (!user?.id) return;
    try {
      setIsLoading(true);
      setError(null);
      const { data: profile, error: profileError } = await supabase.from("profiles").select(`
          pulse_energy,
          rank_id,
          agent_ranks:rank_id (
            id, code, name_en, name_it, description, pe_min, pe_max, color, symbol
          )
        `).eq("id", user.id).single();
      if (profileError) throw profileError;
      const allRanks = await fetchRanks();
      const currentPE = profile?.pulse_energy || 0;
      const currentRank = profile?.agent_ranks;
      const nextRank = allRanks.find(
        (r) => r.pe_min > currentPE && r.code !== "SRC-"
      ) || null;
      const { progress, peToNext } = calculateProgress(currentPE, currentRank, nextRank);
      if (previousPE.current > 0 && currentPE !== previousPE.current) {
        const delta = currentPE - previousPE.current;
        if (delta > 0) {
          setLastDelta(delta);
          setTimeout(() => setLastDelta(null), 3e3);
        }
      }
      previousPE.current = currentPE;
      setEnergy({
        pulseEnergy: currentPE,
        rank: currentRank,
        nextRank,
        progressToNextRank: progress,
        peToNextRank: peToNext
      });
    } catch (err) {
      setError(err);
    } finally {
      setIsLoading(false);
    }
  }, [user?.id, fetchRanks]);
  reactExports.useEffect(() => {
    fetchEnergy();
  }, [fetchEnergy]);
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const channel = supabase.channel(`agent_energy_${user.id}`).on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "profiles",
        filter: `id=eq.${user.id}`
      },
      (payload) => {
        const newPE = payload.new.pulse_energy;
        const oldPE = previousPE.current;
        if (newPE !== oldPE) {
          fetchEnergy();
        }
      }
    ).subscribe((status) => {
    });
    channelRef.current = channel;
    return () => {
      channel.unsubscribe();
    };
  }, [user?.id, fetchEnergy]);
  return {
    energy,
    isLoading,
    error,
    lastDelta,
    refetch: fetchEnergy
  };
};

const EVENT_DISPLAY_INFO = {
  BUZZ_COMPLETED: { label: "Buzz completato!", emoji: "" },
  PORTAL_DISCOVERED: { label: "Portale scoperto!", emoji: "" },
  DAILY_STREAK: { label: "Login giornaliero!", emoji: "" },
  QR_SCAN_VERIFIED: { label: "QR verificato!", emoji: "" },
  NORAH_STORY_BEAT: { label: "Interazione AION!", emoji: "" },
  MISSION_COMPLETED: { label: "Missione completata!", emoji: "" }
};
const usePulseContribute = () => {
  const { user } = useAuthContext();
  const [isContributing, setIsContributing] = reactExports.useState(false);
  const [lastContribution, setLastContribution] = reactExports.useState(null);
  const contribute = reactExports.useCallback(async (type, meta = {}) => {
    if (!user?.id) {
      return { success: false, accepted: false, error: "Not authenticated" };
    }
    setIsContributing(true);
    try {
      const deviceHash = typeof window !== "undefined" ? btoa(navigator.userAgent + screen.width + screen.height).slice(0, 16) : void 0;
      const { data, error } = await supabase.rpc("rpc_pulse_event_record", {
        p_user_id: user.id,
        p_type: type,
        p_meta: { ...meta, device_hash: deviceHash }
      });
      if (error) {
        return { success: false, accepted: false, error: error.message };
      }
      const result = typeof data === "string" ? JSON.parse(data) : data;
      if (!result.accepted) {
        return {
          success: true,
          // RPC worked, but contribution was rejected (cooldown, cap, etc.)
          accepted: false,
          error: result.error
        };
      }
      const displayInfo = EVENT_DISPLAY_INFO[type];
      const contributionResult = {
        success: true,
        accepted: true,
        newValue: result.new_value,
        delta: result.delta,
        thresholdTriggered: result.threshold_triggered,
        displayInfo: {
          label: displayInfo.label,
          emoji: displayInfo.emoji,
          deltaPercent: result.delta || 0
        }
      };
      setLastContribution(contributionResult);
      if (typeof window !== "undefined") {
        window.dispatchEvent(new CustomEvent("pulse:contributed", {
          detail: contributionResult
        }));
      }
      return contributionResult;
    } catch (err) {
      return {
        success: false,
        accepted: false,
        error: err instanceof Error ? err.message : "Unknown error"
      };
    } finally {
      setIsContributing(false);
    }
  }, [user?.id]);
  return {
    contribute,
    isContributing,
    lastContribution
  };
};

const INITIAL_STATE = {
  status: "idle",
  roundId: null,
  betAmount: 0,
  betCurrency: "M1U",
  currentMultiplier: 1,
  crashPoint: 0,
  cashoutMultiplier: null,
  payout: null,
  error: null,
  nearMissMultiplier: null,
  potentialWinAtCrash: null
};
function generateCrashPoint() {
  const array = new Uint32Array(1);
  crypto.getRandomValues(array);
  const r = array[0] / (4294967295 + 1);
  const houseEdge = 0.95;
  const raw = houseEdge / (1 - r * houseEdge);
  return Math.max(1.01, Math.min(20, Math.floor(raw * 100) / 100));
}
function usePulseBreaker() {
  const { user } = useAuth();
  const [gameState, setGameState] = reactExports.useState(INITIAL_STATE);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [userBalance, setUserBalance] = reactExports.useState({ m1u: 0, pe: 0 });
  const [crashHistory, setCrashHistory] = reactExports.useState([]);
  const intervalRef = reactExports.useRef(null);
  const startTimeRef = reactExports.useRef(0);
  const crashPointRef = reactExports.useRef(0);
  const gameActiveRef = reactExports.useRef(false);
  const betDataRef = reactExports.useRef({ amount: 0, currency: "M1U" });
  const cleanup = reactExports.useCallback(() => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
      intervalRef.current = null;
    }
    gameActiveRef.current = false;
  }, []);
  const refreshBalance = reactExports.useCallback(async () => {
    if (!user) return;
    try {
      const { data } = await supabase.from("profiles").select("m1_units, pulse_energy").eq("id", user.id).single();
      if (data) {
        setUserBalance({
          m1u: data.m1_units || 0,
          pe: data.pulse_energy || 0
        });
      }
    } catch {
    }
  }, [user]);
  reactExports.useEffect(() => {
    refreshBalance();
  }, [refreshBalance]);
  reactExports.useEffect(() => {
    return cleanup;
  }, [cleanup]);
  const updateBalanceAsync = reactExports.useCallback(async (currency, newBalance) => {
    if (!user) return;
    try {
      const field = currency === "M1U" ? "m1_units" : "pulse_energy";
      await supabase.rpc("update_user_balance", {
        p_user_id: user.id,
        p_field: field,
        p_value: Math.floor(newBalance)
      });
    } catch {
      try {
        const field = currency === "M1U" ? "m1_units" : "pulse_energy";
        await supabase.from("profiles").update({ [field]: Math.floor(newBalance) }).eq("id", user.id);
      } catch {
      }
    }
  }, [user]);
  const startRound = reactExports.useCallback(async (betAmount, currency) => {
    if (!user || gameActiveRef.current || gameState.status === "running") return false;
    const currentBalance = currency === "M1U" ? userBalance.m1u : userBalance.pe;
    if (betAmount < 1 || betAmount > 1e3) {
      setGameState((prev) => ({ ...prev, error: "Puntata: 1-1000" }));
      return false;
    }
    if (currentBalance < betAmount) {
      setGameState((prev) => ({ ...prev, error: `Saldo ${currency} insufficiente` }));
      return false;
    }
    setIsLoading(true);
    cleanup();
    const newBalance = currentBalance - betAmount;
    setUserBalance((prev) => ({
      ...prev,
      [currency.toLowerCase()]: newBalance
    }));
    updateBalanceAsync(currency, newBalance);
    const crashPoint = generateCrashPoint();
    crashPointRef.current = crashPoint;
    startTimeRef.current = Date.now();
    gameActiveRef.current = true;
    betDataRef.current = { amount: betAmount, currency };
    setGameState({
      ...INITIAL_STATE,
      status: "running",
      roundId: crypto.randomUUID(),
      betAmount,
      betCurrency: currency,
      currentMultiplier: 1
    });
    intervalRef.current = setInterval(() => {
      if (!gameActiveRef.current) {
        cleanup();
        return;
      }
      const elapsed = (Date.now() - startTimeRef.current) / 1e3;
      const rawMult = 1 + Math.pow(elapsed, 1.3) * 0.15;
      const newMult = Math.min(20, Math.floor(rawMult * 100) / 100);
      if (newMult >= crashPointRef.current) {
        cleanup();
        const crashPt = crashPointRef.current;
        setCrashHistory((prev) => [...prev.slice(-9), crashPt]);
        setGameState((prev) => ({
          ...prev,
          status: "crashed",
          currentMultiplier: crashPt,
          crashPoint: crashPt,
          payout: 0,
          potentialWinAtCrash: prev.betAmount * crashPt
        }));
        return;
      }
      setGameState((prev) => {
        if (prev.status !== "running") return prev;
        return { ...prev, currentMultiplier: newMult };
      });
    }, 50);
    setIsLoading(false);
    return true;
  }, [user, gameState.status, userBalance, cleanup, updateBalanceAsync]);
  const cashout = reactExports.useCallback(async () => {
    if (!user || !gameActiveRef.current || gameState.status !== "running") return false;
    cleanup();
    const cashoutMult = gameState.currentMultiplier;
    const crashPt = crashPointRef.current;
    const bet = betDataRef.current;
    const payout = Math.floor(bet.amount * cashoutMult);
    const nearMiss = crashPt > cashoutMult + 0.3 ? crashPt : null;
    const potentialWin = nearMiss ? bet.amount * crashPt : null;
    const currentBal = bet.currency === "M1U" ? userBalance.m1u : userBalance.pe;
    const newBalance = currentBal + payout;
    setUserBalance((prev) => ({
      ...prev,
      [bet.currency.toLowerCase()]: newBalance
    }));
    updateBalanceAsync(bet.currency, newBalance);
    setCrashHistory((prev) => [...prev.slice(-9), crashPt]);
    setGameState((prev) => ({
      ...prev,
      status: "cashed_out",
      cashoutMultiplier: cashoutMult,
      payout,
      crashPoint: crashPt,
      nearMissMultiplier: nearMiss,
      potentialWinAtCrash: potentialWin ? Math.floor(potentialWin) : null
    }));
    return true;
  }, [user, gameState, userBalance, cleanup, updateBalanceAsync]);
  const resetGame = reactExports.useCallback(() => {
    cleanup();
    crashPointRef.current = 0;
    betDataRef.current = { amount: 0, currency: "M1U" };
    setGameState(INITIAL_STATE);
    refreshBalance();
  }, [cleanup, refreshBalance]);
  return {
    gameState,
    isLoading,
    startRound,
    cashout,
    resetGame,
    userBalance,
    refreshBalance,
    crashHistory
  };
}

const BET_PRESETS = [5, 10, 25, 50, 100];
const PulseBreaker = ({ isOpen, onClose }) => {
  const {
    gameState,
    isLoading,
    startRound,
    cashout,
    resetGame,
    userBalance,
    refreshBalance,
    crashHistory
  } = usePulseBreaker();
  const [betAmount, setBetAmount] = reactExports.useState(10);
  const [betCurrency, setBetCurrency] = reactExports.useState("M1U");
  const [showCrashEffect, setShowCrashEffect] = reactExports.useState(false);
  const [showWinCelebration, setShowWinCelebration] = reactExports.useState(false);
  const [currentSpeedZone, setCurrentSpeedZone] = reactExports.useState("normal");
  const [sonicBoomEffect, setSonicBoomEffect] = reactExports.useState("none");
  const [showDisclaimer, setShowDisclaimer] = reactExports.useState(false);
  const canvasRef = reactExports.useRef(null);
  const animationRef = reactExports.useRef(null);
  const lastZoneRef = reactExports.useRef("normal");
  const starsRef = reactExports.useRef([]);
  const starsInitialized = reactExports.useRef(false);
  const balance = betCurrency === "M1U" ? userBalance.m1u : userBalance.pe;
  reactExports.useEffect(() => {
    if (gameState.status !== "running") {
      setCurrentSpeedZone("normal");
      lastZoneRef.current = "normal";
      return;
    }
    const mult = gameState.currentMultiplier;
    let newZone = "normal";
    if (mult >= 4) newZone = "warp";
    else if (mult >= 3) newZone = "supersonic";
    else if (mult >= 2) newZone = "fast";
    if (newZone !== lastZoneRef.current) {
      if (newZone === "supersonic" && lastZoneRef.current !== "warp") {
        setSonicBoomEffect("supersonic-enter");
        if (navigator.vibrate) navigator.vibrate(50);
        setTimeout(() => setSonicBoomEffect("none"), 400);
      } else if (newZone === "warp") {
        setSonicBoomEffect("warp-enter");
        if (navigator.vibrate) navigator.vibrate([30, 20, 50]);
        setTimeout(() => setSonicBoomEffect("none"), 500);
      }
      lastZoneRef.current = newZone;
    }
    setCurrentSpeedZone(newZone);
  }, [gameState.currentMultiplier, gameState.status]);
  reactExports.useEffect(() => {
    if (gameState.status === "cashed_out") {
      setShowWinCelebration(true);
      if (navigator.vibrate) {
        navigator.vibrate([50, 30, 50, 30, 100]);
      }
      setTimeout(() => setShowWinCelebration(false), 2e3);
    }
  }, [gameState.status]);
  reactExports.useEffect(() => {
    if (gameState.status === "crashed") {
      setShowCrashEffect(true);
      if (navigator.vibrate) {
        navigator.vibrate([100, 50, 100, 50, 200]);
      }
      setTimeout(() => setShowCrashEffect(false), 1500);
    }
  }, [gameState.status]);
  const drawCanvas = reactExports.useCallback(() => {
    if (!canvasRef.current) return;
    const canvas = canvasRef.current;
    const ctx = canvas.getContext("2d");
    if (!ctx) return;
    const rect = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);
    const width = rect.width;
    const height = rect.height;
    const centerX = width / 2;
    const centerY = height / 2;
    if (!starsInitialized.current || starsRef.current.length === 0) {
      starsRef.current = [];
      for (let i = 0; i < 150; i++) {
        starsRef.current.push({
          x: (Math.random() - 0.5) * width * 3,
          y: (Math.random() - 0.5) * height * 3,
          z: Math.random() * width,
          size: Math.random() * 1.5 + 0.5
        });
      }
      starsInitialized.current = true;
    }
    ctx.fillStyle = "#000508";
    ctx.fillRect(0, 0, width, height);
    const mult = gameState.currentMultiplier;
    let warpSpeed;
    let warpZone;
    let trailColor;
    if (gameState.status !== "running") {
      warpSpeed = 0.1;
      warpZone = "idle";
      trailColor = "rgba(200, 220, 255, ";
    } else if (mult < 2) {
      warpSpeed = 0.5 + (mult - 1) * 1;
      warpZone = "normal";
      trailColor = "rgba(200, 220, 255, ";
    } else if (mult < 3) {
      warpSpeed = 1.5 + (mult - 2) * 3;
      warpZone = "fast";
      trailColor = "rgba(100, 200, 255, ";
    } else if (mult < 4) {
      warpSpeed = 4.5 + (mult - 3) * 6;
      warpZone = "supersonic";
      trailColor = "rgba(150, 100, 255, ";
    } else {
      warpSpeed = 10.5 + (mult - 4) * 4;
      warpZone = "warp";
      trailColor = "rgba(255, 100, 255, ";
    }
    const stars = starsRef.current;
    for (let i = 0; i < stars.length; i++) {
      const star = stars[i];
      star.z -= warpSpeed;
      if (star.z <= 0) {
        star.x = (Math.random() - 0.5) * width * 3;
        star.y = (Math.random() - 0.5) * height * 3;
        star.z = width;
      }
      const perspective = width / star.z;
      const screenX = centerX + star.x * perspective;
      const screenY = centerY + star.y * perspective;
      if (screenX >= 0 && screenX <= width && screenY >= 0 && screenY <= height) {
        const size = star.size * perspective * 0.5;
        const alpha = Math.min(1, (width - star.z) / width);
        if (gameState.status === "running" && warpSpeed > 0.5) {
          const trailLength = Math.min(size * warpSpeed * 3, warpZone === "warp" ? 80 : 40);
          const gradient = ctx.createLinearGradient(
            screenX,
            screenY,
            screenX - star.x * perspective * 0.15,
            screenY - star.y * perspective * 0.15
          );
          gradient.addColorStop(0, trailColor + alpha + ")");
          gradient.addColorStop(1, "transparent");
          ctx.beginPath();
          ctx.strokeStyle = gradient;
          ctx.lineWidth = warpZone === "warp" ? size * 0.8 : size * 0.5;
          ctx.moveTo(screenX, screenY);
          ctx.lineTo(screenX - trailLength * (star.x / width), screenY - trailLength * (star.y / height));
          ctx.stroke();
        }
        ctx.beginPath();
        ctx.arc(screenX, screenY, Math.max(0.5, size), 0, Math.PI * 2);
        const starBrightness = warpZone === "warp" ? 255 : 220;
        ctx.fillStyle = `rgba(${starBrightness}, ${starBrightness}, 255, ${alpha})`;
        ctx.fill();
      }
    }
    if (warpZone === "warp" && gameState.status === "running") {
      const flashAlpha = 0.02 + Math.sin(Date.now() / 50) * 0.02;
      ctx.fillStyle = `rgba(255, 100, 255, ${flashAlpha})`;
      ctx.fillRect(0, 0, width, height);
    }
    const marginLeft = 35;
    const marginBottom = 25;
    const marginTop = 20;
    const marginRight = 10;
    const graphWidth = width - marginLeft - marginRight;
    const graphHeight = height - marginTop - marginBottom;
    ctx.strokeStyle = "rgba(0, 229, 255, 0.3)";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(marginLeft, marginTop);
    ctx.lineTo(marginLeft, height - marginBottom);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(marginLeft, height - marginBottom);
    ctx.lineTo(width - marginRight, height - marginBottom);
    ctx.stroke();
    ctx.font = "9px Orbitron, monospace";
    ctx.fillStyle = "rgba(0, 229, 255, 0.5)";
    ctx.textAlign = "right";
    for (let i = 0; i <= 20; i += 5) {
      const y = height - marginBottom - i / 20 * graphHeight;
      ctx.fillText(`${i}x`, marginLeft - 5, y + 3);
      ctx.strokeStyle = "rgba(0, 229, 255, 0.06)";
      ctx.beginPath();
      ctx.moveTo(marginLeft, y);
      ctx.lineTo(width - marginRight, y);
      ctx.stroke();
    }
    const zones = [
      { y: 2, label: "FAST", color: "rgba(100, 200, 255, 0.3)" },
      { y: 3, label: "SONIC", color: "rgba(150, 100, 255, 0.3)" },
      { y: 4, label: "WARP", color: "rgba(255, 100, 255, 0.3)" }
    ];
    zones.forEach((zone) => {
      const zoneY = height - marginBottom - zone.y / 20 * graphHeight;
      ctx.strokeStyle = zone.color;
      ctx.setLineDash([3, 3]);
      ctx.beginPath();
      ctx.moveTo(marginLeft, zoneY);
      ctx.lineTo(width - marginRight, zoneY);
      ctx.stroke();
      ctx.setLineDash([]);
    });
    ctx.textAlign = "center";
    ctx.fillStyle = "rgba(0, 229, 255, 0.4)";
    for (let i = 0; i <= 4; i++) {
      const x = marginLeft + i / 4 * graphWidth;
      ctx.fillText(`${i * 5}s`, x, height - 8);
    }
    if (gameState.status === "running" || gameState.status === "cashed_out" || gameState.status === "crashed") {
      const progress = Math.min((mult - 1) / 19, 1);
      const startX = marginLeft;
      const startY = height - marginBottom;
      const endX = marginLeft + progress * graphWidth;
      const endY = height - marginBottom - progress * graphHeight;
      let mainColor;
      let glowIntensity;
      if (mult < 2) {
        mainColor = "#00e5ff";
        glowIntensity = 0.3;
      } else if (mult < 3) {
        mainColor = "#64c8ff";
        glowIntensity = 0.5;
      } else if (mult < 4) {
        mainColor = "#9664ff";
        glowIntensity = 0.7;
      } else if (mult < 10) {
        mainColor = "#ff64ff";
        glowIntensity = 0.9;
      } else {
        mainColor = "#ff88ff";
        glowIntensity = 1;
      }
      if (gameState.status === "crashed") {
        mainColor = "#ff1744";
        glowIntensity = 1;
      }
      const cp1x = startX + (endX - startX) * 0.4;
      const cp1y = startY;
      const cp2x = startX + (endX - startX) * 0.8;
      const cp2y = endY + (startY - endY) * 0.3;
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);
      ctx.lineTo(endX, height - marginBottom);
      ctx.lineTo(startX, height - marginBottom);
      ctx.closePath();
      const areaGradient = ctx.createLinearGradient(0, endY, 0, height - marginBottom);
      const hexToRgba = (hex, alpha) => {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
      };
      areaGradient.addColorStop(0, hexToRgba(mainColor, 0.2));
      areaGradient.addColorStop(1, "transparent");
      ctx.fillStyle = areaGradient;
      ctx.fill();
      const pulsePhase = Math.sin(Date.now() / (200 - mult * 15)) * 0.5 + 0.5;
      const glowWidth = 3 + glowIntensity * 4 * pulsePhase;
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);
      ctx.strokeStyle = mainColor + Math.floor(40 + pulsePhase * 40).toString(16);
      ctx.lineWidth = glowWidth;
      ctx.lineCap = "round";
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);
      ctx.strokeStyle = mainColor;
      ctx.lineWidth = 1;
      ctx.stroke();
      const markerPulse = Math.sin(Date.now() / 150) * 0.5 + 0.5;
      const markerSize = 3 + markerPulse;
      ctx.beginPath();
      ctx.arc(endX, endY, markerSize + 2, 0, Math.PI * 2);
      ctx.fillStyle = mainColor + "40";
      ctx.fill();
      ctx.beginPath();
      ctx.arc(endX, endY, markerSize, 0, Math.PI * 2);
      ctx.fillStyle = mainColor;
      ctx.fill();
      ctx.beginPath();
      ctx.arc(endX, endY, markerSize * 0.3, 0, Math.PI * 2);
      ctx.fillStyle = "#fff";
      ctx.fill();
      if (gameState.status === "crashed") {
        ctx.fillStyle = "rgba(255, 0, 50, 0.1)";
        ctx.fillRect(0, 0, width, height);
        for (let i = 0; i < 4; i++) {
          const glitchY = Math.random() * height;
          ctx.fillStyle = `rgba(255, 23, 68, ${0.05 + Math.random() * 0.1})`;
          ctx.fillRect(0, glitchY, width, 1);
        }
      }
    }
    if (gameState.status === "running") {
      animationRef.current = requestAnimationFrame(drawCanvas);
    }
  }, [gameState.status, gameState.currentMultiplier]);
  reactExports.useEffect(() => {
    if (gameState.status === "running") {
      drawCanvas();
    } else {
      if (animationRef.current) {
        cancelAnimationFrame(animationRef.current);
        animationRef.current = null;
      }
      drawCanvas();
    }
    return () => {
      if (animationRef.current) {
        cancelAnimationFrame(animationRef.current);
      }
    };
  }, [gameState.status, drawCanvas]);
  reactExports.useEffect(() => {
    if (gameState.status !== "running") {
      drawCanvas();
    }
  }, [gameState.currentMultiplier, drawCanvas]);
  const handleStart = async () => {
    if (betAmount > balance || betAmount < 1) return;
    await startRound(betAmount, betCurrency);
  };
  const handleClose = () => {
    if (gameState.status === "running") return;
    resetGame();
    onClose();
  };
  reactExports.useEffect(() => {
    refreshBalance();
  }, [betCurrency, refreshBalance]);
  reactExports.useEffect(() => {
    if (isOpen) {
      refreshBalance();
    }
  }, [isOpen, refreshBalance]);
  if (!isOpen) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "pb-overlay",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showCrashEffect && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "pb-crash-flash",
            initial: { opacity: 0 },
            animate: { opacity: [0, 1, 0.5, 1, 0] },
            exit: { opacity: 0 },
            transition: { duration: 0.5 }
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showWinCelebration && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "pb-win-celebration",
            initial: { opacity: 0 },
            animate: { opacity: [0, 0.8, 0.4, 0.6, 0] },
            exit: { opacity: 0 },
            transition: { duration: 1.5 },
            style: {
              position: "fixed",
              inset: 0,
              zIndex: 1e4,
              background: "radial-gradient(circle at center, rgba(0, 255, 136, 0.3), rgba(0, 231, 255, 0.2), transparent)",
              pointerEvents: "none"
            }
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "pb-container",
            initial: { scale: 0.95, opacity: 0 },
            animate: { scale: 1, opacity: 1 },
            exit: { scale: 0.95, opacity: 0 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  className: "pb-close-btn",
                  onClick: handleClose,
                  disabled: gameState.status === "running",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { size: 24 })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-header-section", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-logo", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "pb-logo-icon" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pb-logo-text", children: "PULSE BREAKER" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-balance-pill", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Coins, { className: "pb-pill-icon" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pb-pill-value", children: Math.floor(userBalance.m1u) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pb-pill-label", children: "M1U" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `pb-game-area ${gameState.status === "crashed" ? "crashed" : ""}`, children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("canvas", { ref: canvasRef, className: "pb-canvas" }),
                gameState.status === "running" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `pb-speed-indicator ${currentSpeedZone}`, children: [
                  currentSpeedZone === "normal" && " NORMAL",
                  currentSpeedZone === "fast" && " FAST",
                  currentSpeedZone === "supersonic" && " SONIC",
                  currentSpeedZone === "warp" && " WARP"
                ] }),
                sonicBoomEffect !== "none" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `pb-sonic-boom ${sonicBoomEffect}` }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `pb-multiplier-display ${gameState.status}`, children: gameState.status === "crashed" ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    className: "pb-crashed-display",
                    initial: { scale: 0.5, opacity: 0 },
                    animate: { scale: 1, opacity: 1 },
                    transition: { type: "spring", stiffness: 300 },
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pb-crash-text", children: "CRASH!" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "pb-crash-mult", children: [
                        gameState.crashPoint?.toFixed(2),
                        ""
                      ] })
                    ]
                  }
                ) : gameState.status === "cashed_out" ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    className: "pb-win-display",
                    initial: { scale: 0.5, opacity: 0 },
                    animate: { scale: 1, opacity: 1 },
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pb-win-text", children: "ESTRATTO!" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "pb-win-mult", children: [
                        gameState.cashoutMultiplier?.toFixed(2),
                        ""
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "pb-win-amount", children: [
                        "+",
                        Math.floor(gameState.payout || 0),
                        " ",
                        gameState.betCurrency
                      ] })
                    ]
                  }
                ) : /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.span,
                  {
                    className: "pb-live-mult",
                    initial: { scale: 1.1 },
                    animate: { scale: 1 },
                    children: [
                      gameState.currentMultiplier.toFixed(2),
                      ""
                    ]
                  },
                  gameState.currentMultiplier
                ) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-controls-section", children: [
                gameState.status === "idle" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    className: "pb-idle-controls",
                    initial: { opacity: 0, y: 20 },
                    animate: { opacity: 1, y: 0 },
                    children: [
                      crashHistory.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-crash-history", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pb-history-label", children: "Ultimi crash:" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "pb-history-pills", children: crashHistory.slice(-6).map((crash, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                          "span",
                          {
                            className: `pb-history-pill ${crash >= 2 ? "high" : crash >= 1.5 ? "mid" : "low"}`,
                            children: [
                              crash.toFixed(2),
                              ""
                            ]
                          },
                          i
                        )) })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-currency-selector", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsxs(
                          "button",
                          {
                            className: `pb-curr-btn ${betCurrency === "M1U" ? "active" : ""}`,
                            onClick: () => setBetCurrency("M1U"),
                            children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx(Coins, { size: 16 }),
                              "M1U"
                            ]
                          }
                        ),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs(
                          "button",
                          {
                            className: `pb-curr-btn ${betCurrency === "PE" ? "active" : ""}`,
                            onClick: () => setBetCurrency("PE"),
                            children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { size: 16 }),
                              "PE"
                            ]
                          }
                        )
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "pb-bet-presets", children: BET_PRESETS.map((preset) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "button",
                        {
                          className: `pb-preset ${betAmount === preset ? "active" : ""}`,
                          onClick: () => setBetAmount(preset),
                          disabled: preset > balance,
                          children: preset
                        },
                        preset
                      )) }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-bet-input-wrapper", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          "input",
                          {
                            type: "number",
                            className: "pb-bet-input",
                            value: betAmount,
                            onChange: (e) => setBetAmount(Math.max(1, Math.min(Number(e.target.value), Math.min(balance, 1e3)))),
                            min: 1,
                            max: Math.min(balance, 1e3)
                          }
                        ),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pb-input-currency", children: betCurrency })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        motion.button,
                        {
                          className: "pb-start-btn",
                          onClick: handleStart,
                          disabled: isLoading || betAmount < 1 || betAmount > balance,
                          whileTap: { scale: 0.97 },
                          children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { size: 22 }),
                            "START"
                          ]
                        }
                      )
                    ]
                  }
                ),
                gameState.status === "running" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    className: "pb-running-controls",
                    initial: { opacity: 0, scale: 0.9 },
                    animate: { opacity: 1, scale: 1 },
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-potential-win", children: [
                        "Vincita: ",
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("strong", { children: [
                          Math.floor(betAmount * gameState.currentMultiplier),
                          " ",
                          betCurrency
                        ] })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        motion.button,
                        {
                          className: "pb-extract-btn",
                          onClick: cashout,
                          disabled: isLoading,
                          whileTap: { scale: 0.95 },
                          animate: {
                            boxShadow: [
                              "0 0 20px rgba(0, 255, 136, 0.4)",
                              "0 0 40px rgba(0, 255, 136, 0.7)",
                              "0 0 20px rgba(0, 255, 136, 0.4)"
                            ]
                          },
                          transition: { duration: 0.6, repeat: Infinity },
                          children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingUp, { size: 24 }),
                            "ESTRAI ",
                            Math.floor(betAmount * gameState.currentMultiplier)
                          ]
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-warning-text", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { size: 14 }),
                        "Estrai prima del CRASH!"
                      ] })
                    ]
                  }
                ),
                (gameState.status === "crashed" || gameState.status === "cashed_out") && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    className: "pb-result-controls",
                    initial: { opacity: 0, y: 20 },
                    animate: { opacity: 1, y: 0 },
                    children: [
                      gameState.status === "cashed_out" && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-win-banner", children: [
                          " Hai vinto ",
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("strong", { children: [
                            Math.floor(gameState.payout || 0),
                            " ",
                            gameState.betCurrency
                          ] }),
                          "!"
                        ] }),
                        gameState.nearMissMultiplier && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                          motion.div,
                          {
                            className: "pb-near-miss",
                            initial: { opacity: 0, scale: 0.9 },
                            animate: { opacity: 1, scale: 1 },
                            transition: { delay: 0.5 },
                            children: [
                              " Il crash era a ",
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("strong", { children: [
                                gameState.crashPoint.toFixed(2),
                                ""
                              ] }),
                              "! Potevi vincere ",
                              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: Math.floor(gameState.potentialWinAtCrash || 0) }),
                              "!"
                            ]
                          }
                        )
                      ] }),
                      gameState.status === "crashed" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-lose-banner", children: [
                        " Crash a ",
                        gameState.crashPoint?.toFixed(2),
                        "  Perso ",
                        gameState.betAmount,
                        " ",
                        gameState.betCurrency
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.button,
                        {
                          className: "pb-replay-btn",
                          onClick: resetGame,
                          whileTap: { scale: 0.95 },
                          children: " GIOCA ANCORA"
                        }
                      )
                    ]
                  }
                ),
                gameState.error && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-error-msg", children: [
                  " ",
                  gameState.error
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-disclaimer-footer", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pb-disclaimer-text", children: " ENTERTAINMENT ONLY  No real money, no cash prizes, no withdrawals." }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "button",
                  {
                    className: "pb-disclaimer-info-btn",
                    onClick: () => setShowDisclaimer(true),
                    "aria-label": "More info about game disclaimer",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { size: 14 })
                  }
                )
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showDisclaimer && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "pb-disclaimer-modal-overlay",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            exit: { opacity: 0 },
            onClick: () => setShowDisclaimer(false),
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "pb-disclaimer-modal",
                initial: { scale: 0.9, opacity: 0 },
                animate: { scale: 1, opacity: 1 },
                exit: { scale: 0.9, opacity: 0 },
                onClick: (e) => e.stopPropagation(),
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "button",
                    {
                      className: "pb-disclaimer-close",
                      onClick: () => setShowDisclaimer(false),
                      children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { size: 18 })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "pb-disclaimer-title", children: " PULSE BREAKER  SIMULATION GAME" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-disclaimer-content", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "pb-disclaimer-intro", children: [
                      "This game is provided for ",
                      /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "ENTERTAINMENT PURPOSES ONLY" }),
                      "."
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-disclaimer-section", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { children: " NO GAMBLING" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "This is NOT a gambling application. No real money is wagered, won, or lost." })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-disclaimer-section", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { children: " NO REAL-MONEY REWARDS" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "All currencies (M1U, PE) are virtual, in-app currencies with no monetary value." })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-disclaimer-section", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { children: " NO CASH-OUT / WITHDRAWALS" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Virtual currencies cannot be exchanged or withdrawn for real money." })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-disclaimer-section", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { children: " ENTERTAINMENT ONLY" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "This simulation is designed for fun within the M1SSION experience." })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pb-disclaimer-section", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { children: " RESPONSIBLE PLAY" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Not intended to encourage repetitive paid play or simulate gambling behavior." })
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "pb-disclaimer-legal", children: "By playing, you acknowledge this is a simulation game with no real-world monetary implications." }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "pb-disclaimer-copyright", children: " 2025 NIYVORA KFT  M1SSION" })
                ]
              }
            )
          }
        ) })
      ]
    }
  ) });
};

const PulseBreakerPill = () => {
  const [isGameOpen, setIsGameOpen] = reactExports.useState(false);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.button,
      {
        className: "pe-pill-orb",
        "aria-label": "Pulse Breaker Game",
        whileHover: { scale: 1.03 },
        whileTap: { scale: 0.97 },
        onClick: () => setIsGameOpen(true),
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Gamepad2, { className: "w-5 h-5 z-10 relative text-cyan-400", style: { filter: "drop-shadow(0 0 4px #00d4ff)" } }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pe-dot" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { className: "absolute inset-0 w-full h-full -rotate-90 pointer-events-none", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "circle",
              {
                cx: "50%",
                cy: "50%",
                r: "45%",
                fill: "none",
                stroke: "rgba(0, 255, 200, 0.15)",
                strokeWidth: "2"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "circle",
              {
                cx: "50%",
                cy: "50%",
                r: "45%",
                fill: "none",
                stroke: "url(#pbGradient)",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeDasharray: "200 283"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("defs", { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("linearGradient", { id: "pbGradient", x1: "0%", y1: "0%", x2: "100%", y2: "0%", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "0%", stopColor: "#00d4ff" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "50%", stopColor: "#8b5cf6" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "100%", stopColor: "#00ff88" })
            ] }) })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      PulseBreaker,
      {
        isOpen: isGameOpen,
        onClose: () => setIsGameOpen(false)
      }
    )
  ] });
};

const PulseBar = ({ onTap }) => {
  const { pulseState, refetch } = usePulseRealtime();
  const [displayValue, setDisplayValue] = reactExports.useState(0);
  const [isGameOpen, setIsGameOpen] = reactExports.useState(false);
  const value = pulseState?.value ?? 0;
  reactExports.useEffect(() => {
    const handleContribution = (e) => {
      if (e.detail?.accepted) {
        refetch();
        setTimeout(() => refetch(), 500);
        setTimeout(() => refetch(), 1500);
      }
    };
    window.addEventListener("pulse:contributed", handleContribution);
    return () => window.removeEventListener("pulse:contributed", handleContribution);
  }, [refetch]);
  reactExports.useEffect(() => {
    const target = Math.round(value);
    if (displayValue !== target) {
      const timer = setTimeout(() => {
        setDisplayValue((prev) => prev < target ? prev + 1 : prev - 1);
      }, 20);
      return () => clearTimeout(timer);
    }
  }, [value, displayValue]);
  const totalSegments = 24;
  const filledSegments = Math.floor(value / 100 * totalSegments);
  const cyan = "#00e7ff";
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "relative w-full flex items-center gap-2",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      onClick: onTap,
      style: { cursor: onTap ? "pointer" : "default" },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative flex-shrink-0", style: { width: 56, height: 56 }, children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: "56", height: "56", viewBox: "0 0 56 56", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "28", cy: "28", r: "27", fill: "none", stroke: cyan, strokeWidth: "1", opacity: "0.4" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "28", cy: "28", r: "24", fill: "none", stroke: cyan, strokeWidth: "1", opacity: "0.6" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "28", cy: "28", r: "20", fill: "none", stroke: "rgba(0,231,255,0.15)", strokeWidth: "3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.circle,
              {
                cx: "28",
                cy: "28",
                r: "20",
                fill: "none",
                stroke: cyan,
                strokeWidth: "3",
                strokeLinecap: "round",
                strokeDasharray: 2 * Math.PI * 20,
                strokeDashoffset: 2 * Math.PI * 20 * (1 - value / 100),
                transform: "rotate(-90 28 28)",
                style: { filter: `drop-shadow(0 0 4px ${cyan})` },
                transition: { duration: 0.5 }
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "28", cy: "28", r: "16", fill: "none", stroke: cyan, strokeWidth: "1", opacity: "0.3" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
            "span",
            {
              className: "font-bold font-mono text-sm",
              style: {
                color: cyan,
                textShadow: `0 0 10px ${cyan}, 0 0 20px ${cyan}`,
                letterSpacing: "-0.5px"
              },
              children: [
                displayValue,
                "%"
              ]
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "absolute inset-0",
              animate: { rotate: 360 },
              transition: { duration: 6, repeat: Infinity, ease: "linear" },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                "div",
                {
                  className: "absolute w-2 h-2 rounded-full",
                  style: {
                    background: cyan,
                    boxShadow: `0 0 6px ${cyan}, 0 0 12px ${cyan}`,
                    top: 0,
                    left: "50%",
                    transform: "translateX(-50%)"
                  }
                }
              )
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 relative", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1 mb-0.5", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "span",
              {
                className: "text-[9px] font-bold tracking-[0.15em]",
                style: { color: cyan, textShadow: `0 0 6px ${cyan}` },
                children: "PULSE"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.span,
              {
                style: { color: cyan },
                className: "text-[8px]",
                animate: { opacity: [1, 0.3, 1] },
                transition: { duration: 1.5, repeat: Infinity },
                children: ""
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            "div",
            {
              className: "relative h-[16px]",
              style: {
                background: "rgba(0,20,30,0.9)",
                clipPath: "polygon(0 0, 100% 0, 96% 100%, 0 100%)",
                border: `1px solid ${cyan}33`
              },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-[2px] flex gap-[2px]", style: { clipPath: "polygon(0 0, 100% 0, 97% 100%, 0 100%)" }, children: [...Array(totalSegments)].map((_, i) => {
                  const isFilled = i < filledSegments;
                  return /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      className: "flex-1 relative",
                      style: {
                        background: isFilled ? `linear-gradient(180deg, ${cyan} 0%, ${cyan}99 50%, ${cyan}66 100%)` : "rgba(0,231,255,0.08)",
                        transform: "skewX(-20deg)",
                        transformOrigin: "bottom",
                        boxShadow: isFilled ? `0 0 4px ${cyan}` : "none"
                      },
                      initial: false,
                      animate: {
                        opacity: isFilled ? 1 : 0.4
                      },
                      transition: { duration: 0.2, delay: i * 0.01 },
                      children: isFilled && /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          className: "absolute inset-0",
                          style: {
                            background: "linear-gradient(180deg, rgba(255,255,255,0.4) 0%, transparent 50%)"
                          },
                          animate: { opacity: [0.3, 0.6, 0.3] },
                          transition: { duration: 2, repeat: Infinity, delay: i * 0.05 }
                        }
                      )
                    },
                    i
                  );
                }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "absolute top-0 bottom-0 w-8 pointer-events-none",
                    style: {
                      background: `linear-gradient(90deg, transparent, ${cyan}44, transparent)`
                    },
                    animate: { left: ["-10%", "110%"] },
                    transition: { duration: 2, repeat: Infinity, ease: "easeInOut" }
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "div",
                  {
                    className: "absolute top-0 left-0 right-0 h-[1px]",
                    style: { background: `linear-gradient(90deg, ${cyan}66, ${cyan}22)` }
                  }
                )
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "div",
            {
              className: "absolute right-0 top-1/2 -translate-y-1/2 translate-x-1",
              style: {
                width: 6,
                height: 20,
                borderRight: `2px solid ${cyan}`,
                borderTop: `2px solid ${cyan}`,
                borderBottom: `2px solid ${cyan}`,
                opacity: 0.5
              }
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.button,
          {
            className: "flex-shrink-0 flex items-center justify-center",
            style: {
              width: 36,
              height: 36,
              borderRadius: "50%",
              background: "linear-gradient(135deg, rgba(0, 231, 255, 0.2) 0%, rgba(0, 100, 150, 0.3) 100%)",
              border: `2px solid ${cyan}`,
              boxShadow: `0 0 12px rgba(0, 231, 255, 0.4), inset 0 0 8px rgba(0, 231, 255, 0.1)`,
              cursor: "pointer"
            },
            whileHover: { scale: 1.1, boxShadow: `0 0 20px rgba(0, 231, 255, 0.6)` },
            whileTap: { scale: 0.95 },
            onClick: (e) => {
              e.stopPropagation();
              setIsGameOpen(true);
            },
            title: "PULSE BREAKER",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              Gamepad2,
              {
                size: 18,
                style: {
                  color: cyan,
                  filter: `drop-shadow(0 0 4px ${cyan})`
                }
              }
            )
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          PulseBreaker,
          {
            isOpen: isGameOpen,
            onClose: () => setIsGameOpen(false)
          }
        )
      ]
    }
  );
};

const AgentEnergyPill = () => {
  const { energy, isLoading, lastDelta } = useAgentEnergy();
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const [showPEGain, setShowPEGain] = reactExports.useState(false);
  const pulseEnergy = energy?.pulseEnergy ?? 0;
  const rank = energy?.rank;
  const progressPercent = energy?.progressToNextRank ?? 0;
  const peToNext = energy?.peToNextRank ?? 0;
  const nextRank = energy?.nextRank;
  const rankLevel = rank ? parseInt(rank.code.match(/\d+/)?.[0] || "1") : 1;
  reactExports.useEffect(() => {
    if (lastDelta && lastDelta > 0) {
      setShowPEGain(true);
      setTimeout(() => setShowPEGain(false), 2500);
    }
  }, [lastDelta]);
  const formatPE = (pe) => {
    if (pe >= 1e6) return `${(pe / 1e6).toFixed(1)}M`;
    if (pe >= 1e3) return `${(pe / 1e3).toFixed(1)}K`;
    return pe.toString();
  };
  if (isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "pe-pill-orb opacity-50" });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.button,
      {
        className: "pe-pill-orb",
        "aria-label": "Agent Energy",
        whileHover: { scale: 1.03 },
        whileTap: { scale: 0.97 },
        onClick: () => setIsExpanded(!isExpanded),
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg z-10 relative", children: rank?.symbol || "" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pe-dot" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { className: "absolute inset-0 w-full h-full -rotate-90 pointer-events-none", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "circle",
              {
                cx: "50%",
                cy: "50%",
                r: "45%",
                fill: "none",
                stroke: "rgba(0, 255, 200, 0.15)",
                strokeWidth: "2"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "circle",
              {
                cx: "50%",
                cy: "50%",
                r: "45%",
                fill: "none",
                stroke: "url(#peGradient)",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeDasharray: `${progressPercent * 2.83} 283`,
                style: { transition: "stroke-dasharray 0.8s ease" }
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("defs", { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("linearGradient", { id: "peGradient", x1: "0%", y1: "0%", x2: "100%", y2: "0%", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "0%", stopColor: "#00d4ff" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "50%", stopColor: "#8b5cf6" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "100%", stopColor: "#00ff88" })
            ] }) })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showPEGain && lastDelta && lastDelta > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        className: "absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap z-20",
        initial: { opacity: 0, y: 5, scale: 0.8 },
        animate: { opacity: 1, y: 0, scale: 1 },
        exit: { opacity: 0, y: -10, scale: 0.8 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-emerald-500/20 border border-emerald-400/50 text-emerald-400", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-3 h-3" }),
          "+",
          lastDelta,
          " PE"
        ] })
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 z-[140]", onClick: () => setIsExpanded(false) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "absolute top-full left-0 mt-2 z-[150] min-w-[220px]",
          initial: { opacity: 0, y: -10, scale: 0.9 },
          animate: { opacity: 1, y: 0, scale: 1 },
          exit: { opacity: 0, y: -10, scale: 0.9 },
          transition: { type: "spring", damping: 25 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
            "div",
            {
              className: "p-4 rounded-2xl",
              style: {
                background: "radial-gradient(120% 120% at 50% 10%, rgba(255,255,255,.06), rgba(0,0,0,.4) 58%)",
                border: "1px solid rgba(255, 255, 255, 0.15)",
                boxShadow: "0 2px 20px rgba(0,0,0,.5), 0 0 30px rgba(0, 255, 200, 0.1) inset",
                backdropFilter: "blur(16px)"
              },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 mb-3 pb-3 border-b border-white/10", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-2xl", children: rank?.symbol }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-bold font-orbitron", style: { color: rank?.color || "#00d4ff" }, children: rank?.name_it || "Recluta" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-[10px] font-mono text-white/40", children: [
                      rank?.code,
                      "  LVL ",
                      rankLevel
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-[9px] font-mono text-cyan-400/50 mb-1", children: "PULSE ENERGY" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold font-orbitron", style: {
                    background: "linear-gradient(90deg, #00d4ff, #8b5cf6, #00ff88)",
                    WebkitBackgroundClip: "text",
                    WebkitTextFillColor: "transparent"
                  }, children: [
                    formatPE(pulseEnergy),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/30 ml-1", style: { WebkitTextFillColor: "initial" }, children: "PE" })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-[9px] font-mono mb-1", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/40", children: "PROGRESS" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-cyan-400", children: [
                      Math.round(progressPercent),
                      "%"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-1.5 bg-black/40 rounded-full overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      className: "h-full rounded-full",
                      style: { background: "linear-gradient(90deg, #00d4ff, #8b5cf6, #00ff88)" },
                      initial: { width: 0 },
                      animate: { width: `${progressPercent}%` }
                    }
                  ) }),
                  nextRank && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 text-[9px] font-mono text-white/30", children: [
                    " ",
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { style: { color: nextRank.color }, children: [
                      nextRank.symbol,
                      " ",
                      nextRank.name_it
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white/20", children: [
                      " (",
                      formatPE(peToNext),
                      " PE)"
                    ] })
                  ] })
                ] })
              ]
            }
          )
        }
      )
    ] }) })
  ] });
};

const SheetPortal = Portal$1;
const SheetOverlay = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Overlay,
  {
    className: cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    ),
    ...props,
    ref
  }
));
SheetOverlay.displayName = Overlay.displayName;
const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom: "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right: "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"
      }
    },
    defaultVariants: {
      side: "right"
    }
  }
);
const SheetContent = reactExports.forwardRef(({ side = "right", className, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(SheetPortal, { children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(SheetOverlay, {}),
  /* @__PURE__ */ jsxRuntimeExports.jsxs(
    Content,
    {
      ref,
      className: cn(sheetVariants({ side }), className),
      ...props,
      children: [
        children,
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Close, { className: "absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "h-4 w-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only", children: "Close" })
        ] })
      ]
    }
  )
] }));
SheetContent.displayName = Content.displayName;
const SheetTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Title,
  {
    ref,
    className: cn("text-lg font-semibold text-foreground", className),
    ...props
  }
));
SheetTitle.displayName = Title.displayName;
const SheetDescription = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Description,
  {
    ref,
    className: cn("text-sm text-muted-foreground", className),
    ...props
  }
));
SheetDescription.displayName = Description.displayName;

const ScrollArea = reactExports.forwardRef(
  ({ className, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      ref,
      className: cn("relative overflow-hidden", className),
      ...props,
      children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-full w-full rounded-[inherit] overflow-auto", children })
    }
  )
);
ScrollArea.displayName = "ScrollArea";

// src/primitive.tsx
var NODES = [
  "a",
  "button",
  "div",
  "form",
  "h2",
  "h3",
  "img",
  "input",
  "label",
  "li",
  "nav",
  "ol",
  "p",
  "select",
  "span",
  "svg",
  "ul"
];
var Primitive = NODES.reduce((primitive, node) => {
  const Slot = createSlot$1(`Primitive.${node}`);
  const Node = reactExports.forwardRef((props, forwardedRef) => {
    const { asChild, ...primitiveProps } = props;
    const Comp = asChild ? Slot : node;
    if (typeof window !== "undefined") {
      window[Symbol.for("radix-ui")] = true;
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Comp, { ...primitiveProps, ref: forwardedRef });
  });
  Node.displayName = `Primitive.${node}`;
  return { ...primitive, [node]: Node };
}, {});

// src/separator.tsx
var NAME = "Separator";
var DEFAULT_ORIENTATION = "horizontal";
var ORIENTATIONS = ["horizontal", "vertical"];
var Separator$2 = reactExports.forwardRef((props, forwardedRef) => {
  const { decorative, orientation: orientationProp = DEFAULT_ORIENTATION, ...domProps } = props;
  const orientation = isValidOrientation(orientationProp) ? orientationProp : DEFAULT_ORIENTATION;
  const ariaOrientation = orientation === "vertical" ? orientation : void 0;
  const semanticProps = decorative ? { role: "none" } : { "aria-orientation": ariaOrientation, role: "separator" };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Primitive.div,
    {
      "data-orientation": orientation,
      ...semanticProps,
      ...domProps,
      ref: forwardedRef
    }
  );
});
Separator$2.displayName = NAME;
function isValidOrientation(orientation) {
  return ORIENTATIONS.includes(orientation);
}
var Root = Separator$2;

const Separator$1 = reactExports.forwardRef(
  ({ className, orientation = "horizontal", decorative = true, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    Root,
    {
      ref,
      decorative,
      orientation,
      className: cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      ),
      ...props
    }
  )
);
Separator$1.displayName = Root.displayName;

/**
 * @name toDate
 * @category Common Helpers
 * @summary Convert the given argument to an instance of Date.
 *
 * @description
 * Convert the given argument to an instance of Date.
 *
 * If the argument is an instance of Date, the function returns its clone.
 *
 * If the argument is a number, it is treated as a timestamp.
 *
 * If the argument is none of the above, the function returns Invalid Date.
 *
 * **Note**: *all* Date arguments passed to any *date-fns* function is processed by `toDate`.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param argument - The value to convert
 *
 * @returns The parsed date in the local time zone
 *
 * @example
 * // Clone the date:
 * const result = toDate(new Date(2014, 1, 11, 11, 30, 30))
 * //=> Tue Feb 11 2014 11:30:30
 *
 * @example
 * // Convert the timestamp to date:
 * const result = toDate(1392098430000)
 * //=> Tue Feb 11 2014 11:30:30
 */
function toDate(argument) {
  const argStr = Object.prototype.toString.call(argument);

  // Clone the date
  if (
    argument instanceof Date ||
    (typeof argument === "object" && argStr === "[object Date]")
  ) {
    // Prevent the date to lose the milliseconds when passed to new Date() in IE10
    return new argument.constructor(+argument);
  } else if (
    typeof argument === "number" ||
    argStr === "[object Number]" ||
    typeof argument === "string" ||
    argStr === "[object String]"
  ) {
    // TODO: Can we get rid of as?
    return new Date(argument);
  } else {
    // TODO: Can we get rid of as?
    return new Date(NaN);
  }
}

/**
 * @name constructFrom
 * @category Generic Helpers
 * @summary Constructs a date using the reference date and the value
 *
 * @description
 * The function constructs a new date using the constructor from the reference
 * date and the given value. It helps to build generic functions that accept
 * date extensions.
 *
 * It defaults to `Date` if the passed reference date is a number or a string.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The reference date to take constructor from
 * @param value - The value to create the date
 *
 * @returns Date initialized using the given date and value
 *
 * @example
 * import { constructFrom } from 'date-fns'
 *
 * // A function that clones a date preserving the original type
 * function cloneDate<DateType extends Date(date: DateType): DateType {
 *   return constructFrom(
 *     date, // Use contrustor from the given date
 *     date.getTime() // Use the date value to create a new date
 *   )
 * }
 */
function constructFrom(date, value) {
  if (date instanceof Date) {
    return new date.constructor(value);
  } else {
    return new Date(value);
  }
}

/**
 * @name addDays
 * @category Day Helpers
 * @summary Add the specified number of days to the given date.
 *
 * @description
 * Add the specified number of days to the given date.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date to be changed
 * @param amount - The amount of days to be added.
 *
 * @returns The new date with the days added
 *
 * @example
 * // Add 10 days to 1 September 2014:
 * const result = addDays(new Date(2014, 8, 1), 10)
 * //=> Thu Sep 11 2014 00:00:00
 */
function addDays(date, amount) {
  const _date = toDate(date);
  if (isNaN(amount)) return constructFrom(date, NaN);
  _date.setDate(_date.getDate() + amount);
  return _date;
}

/**
 * @module constants
 * @summary Useful constants
 * @description
 * Collection of useful date constants.
 *
 * The constants could be imported from `date-fns/constants`:
 *
 * ```ts
 * import { maxTime, minTime } from "./constants/date-fns/constants";
 *
 * function isAllowedTime(time) {
 *   return time <= maxTime && time >= minTime;
 * }
 * ```
 */


/**
 * @constant
 * @name millisecondsInWeek
 * @summary Milliseconds in 1 week.
 */
const millisecondsInWeek = 604800000;

/**
 * @constant
 * @name millisecondsInDay
 * @summary Milliseconds in 1 day.
 */
const millisecondsInDay = 86400000;

/**
 * @constant
 * @name minutesInMonth
 * @summary Minutes in 1 month.
 */
const minutesInMonth = 43200;

/**
 * @constant
 * @name minutesInDay
 * @summary Minutes in 1 day.
 */
const minutesInDay = 1440;

let defaultOptions$1 = {};

function getDefaultOptions() {
  return defaultOptions$1;
}

/**
 * The {@link startOfWeek} function options.
 */

/**
 * @name startOfWeek
 * @category Week Helpers
 * @summary Return the start of a week for the given date.
 *
 * @description
 * Return the start of a week for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 * @param options - An object with options
 *
 * @returns The start of a week
 *
 * @example
 * // The start of a week for 2 September 2014 11:55:00:
 * const result = startOfWeek(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Sun Aug 31 2014 00:00:00
 *
 * @example
 * // If the week starts on Monday, the start of the week for 2 September 2014 11:55:00:
 * const result = startOfWeek(new Date(2014, 8, 2, 11, 55, 0), { weekStartsOn: 1 })
 * //=> Mon Sep 01 2014 00:00:00
 */
function startOfWeek(date, options) {
  const defaultOptions = getDefaultOptions();
  const weekStartsOn =
    options?.weekStartsOn ??
    options?.locale?.options?.weekStartsOn ??
    defaultOptions.weekStartsOn ??
    defaultOptions.locale?.options?.weekStartsOn ??
    0;

  const _date = toDate(date);
  const day = _date.getDay();
  const diff = (day < weekStartsOn ? 7 : 0) + day - weekStartsOn;

  _date.setDate(_date.getDate() - diff);
  _date.setHours(0, 0, 0, 0);
  return _date;
}

/**
 * @name startOfISOWeek
 * @category ISO Week Helpers
 * @summary Return the start of an ISO week for the given date.
 *
 * @description
 * Return the start of an ISO week for the given date.
 * The result will be in the local timezone.
 *
 * ISO week-numbering year: http://en.wikipedia.org/wiki/ISO_week_date
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The start of an ISO week
 *
 * @example
 * // The start of an ISO week for 2 September 2014 11:55:00:
 * const result = startOfISOWeek(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Mon Sep 01 2014 00:00:00
 */
function startOfISOWeek(date) {
  return startOfWeek(date, { weekStartsOn: 1 });
}

/**
 * @name getISOWeekYear
 * @category ISO Week-Numbering Year Helpers
 * @summary Get the ISO week-numbering year of the given date.
 *
 * @description
 * Get the ISO week-numbering year of the given date,
 * which always starts 3 days before the year's first Thursday.
 *
 * ISO week-numbering year: http://en.wikipedia.org/wiki/ISO_week_date
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 *
 * @returns The ISO week-numbering year
 *
 * @example
 * // Which ISO-week numbering year is 2 January 2005?
 * const result = getISOWeekYear(new Date(2005, 0, 2))
 * //=> 2004
 */
function getISOWeekYear(date) {
  const _date = toDate(date);
  const year = _date.getFullYear();

  const fourthOfJanuaryOfNextYear = constructFrom(date, 0);
  fourthOfJanuaryOfNextYear.setFullYear(year + 1, 0, 4);
  fourthOfJanuaryOfNextYear.setHours(0, 0, 0, 0);
  const startOfNextYear = startOfISOWeek(fourthOfJanuaryOfNextYear);

  const fourthOfJanuaryOfThisYear = constructFrom(date, 0);
  fourthOfJanuaryOfThisYear.setFullYear(year, 0, 4);
  fourthOfJanuaryOfThisYear.setHours(0, 0, 0, 0);
  const startOfThisYear = startOfISOWeek(fourthOfJanuaryOfThisYear);

  if (_date.getTime() >= startOfNextYear.getTime()) {
    return year + 1;
  } else if (_date.getTime() >= startOfThisYear.getTime()) {
    return year;
  } else {
    return year - 1;
  }
}

/**
 * @name startOfDay
 * @category Day Helpers
 * @summary Return the start of a day for the given date.
 *
 * @description
 * Return the start of a day for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The start of a day
 *
 * @example
 * // The start of a day for 2 September 2014 11:55:00:
 * const result = startOfDay(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Tue Sep 02 2014 00:00:00
 */
function startOfDay(date) {
  const _date = toDate(date);
  _date.setHours(0, 0, 0, 0);
  return _date;
}

/**
 * Google Chrome as of 67.0.3396.87 introduced timezones with offset that includes seconds.
 * They usually appear for dates that denote time before the timezones were introduced
 * (e.g. for 'Europe/Prague' timezone the offset is GMT+00:57:44 before 1 October 1891
 * and GMT+01:00:00 after that date)
 *
 * Date#getTimezoneOffset returns the offset in minutes and would return 57 for the example above,
 * which would lead to incorrect calculations.
 *
 * This function returns the timezone offset in milliseconds that takes seconds in account.
 */
function getTimezoneOffsetInMilliseconds(date) {
  const _date = toDate(date);
  const utcDate = new Date(
    Date.UTC(
      _date.getFullYear(),
      _date.getMonth(),
      _date.getDate(),
      _date.getHours(),
      _date.getMinutes(),
      _date.getSeconds(),
      _date.getMilliseconds(),
    ),
  );
  utcDate.setUTCFullYear(_date.getFullYear());
  return +date - +utcDate;
}

/**
 * @name differenceInCalendarDays
 * @category Day Helpers
 * @summary Get the number of calendar days between the given dates.
 *
 * @description
 * Get the number of calendar days between the given dates. This means that the times are removed
 * from the dates and then the difference in days is calculated.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 *
 * @returns The number of calendar days
 *
 * @example
 * // How many calendar days are between
 * // 2 July 2011 23:00:00 and 2 July 2012 00:00:00?
 * const result = differenceInCalendarDays(
 *   new Date(2012, 6, 2, 0, 0),
 *   new Date(2011, 6, 2, 23, 0)
 * )
 * //=> 366
 * // How many calendar days are between
 * // 2 July 2011 23:59:00 and 3 July 2011 00:01:00?
 * const result = differenceInCalendarDays(
 *   new Date(2011, 6, 3, 0, 1),
 *   new Date(2011, 6, 2, 23, 59)
 * )
 * //=> 1
 */
function differenceInCalendarDays(dateLeft, dateRight) {
  const startOfDayLeft = startOfDay(dateLeft);
  const startOfDayRight = startOfDay(dateRight);

  const timestampLeft =
    +startOfDayLeft - getTimezoneOffsetInMilliseconds(startOfDayLeft);
  const timestampRight =
    +startOfDayRight - getTimezoneOffsetInMilliseconds(startOfDayRight);

  // Round the number of days to the nearest integer because the number of
  // milliseconds in a day is not constant (e.g. it's different in the week of
  // the daylight saving time clock shift).
  return Math.round((timestampLeft - timestampRight) / millisecondsInDay);
}

/**
 * @name startOfISOWeekYear
 * @category ISO Week-Numbering Year Helpers
 * @summary Return the start of an ISO week-numbering year for the given date.
 *
 * @description
 * Return the start of an ISO week-numbering year,
 * which always starts 3 days before the year's first Thursday.
 * The result will be in the local timezone.
 *
 * ISO week-numbering year: http://en.wikipedia.org/wiki/ISO_week_date
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The start of an ISO week-numbering year
 *
 * @example
 * // The start of an ISO week-numbering year for 2 July 2005:
 * const result = startOfISOWeekYear(new Date(2005, 6, 2))
 * //=> Mon Jan 03 2005 00:00:00
 */
function startOfISOWeekYear(date) {
  const year = getISOWeekYear(date);
  const fourthOfJanuary = constructFrom(date, 0);
  fourthOfJanuary.setFullYear(year, 0, 4);
  fourthOfJanuary.setHours(0, 0, 0, 0);
  return startOfISOWeek(fourthOfJanuary);
}

/**
 * @name compareAsc
 * @category Common Helpers
 * @summary Compare the two dates and return -1, 0 or 1.
 *
 * @description
 * Compare the two dates and return 1 if the first date is after the second,
 * -1 if the first date is before the second or 0 if dates are equal.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The first date to compare
 * @param dateRight - The second date to compare
 *
 * @returns The result of the comparison
 *
 * @example
 * // Compare 11 February 1987 and 10 July 1989:
 * const result = compareAsc(new Date(1987, 1, 11), new Date(1989, 6, 10))
 * //=> -1
 *
 * @example
 * // Sort the array of dates:
 * const result = [
 *   new Date(1995, 6, 2),
 *   new Date(1987, 1, 11),
 *   new Date(1989, 6, 10)
 * ].sort(compareAsc)
 * //=> [
 * //   Wed Feb 11 1987 00:00:00,
 * //   Mon Jul 10 1989 00:00:00,
 * //   Sun Jul 02 1995 00:00:00
 * // ]
 */
function compareAsc(dateLeft, dateRight) {
  const _dateLeft = toDate(dateLeft);
  const _dateRight = toDate(dateRight);

  const diff = _dateLeft.getTime() - _dateRight.getTime();

  if (diff < 0) {
    return -1;
  } else if (diff > 0) {
    return 1;
    // Return 0 if diff is 0; return NaN if diff is NaN
  } else {
    return diff;
  }
}

/**
 * @name constructNow
 * @category Generic Helpers
 * @summary Constructs a new current date using the passed value constructor.
 * @pure false
 *
 * @description
 * The function constructs a new current date using the constructor from
 * the reference date. It helps to build generic functions that accept date
 * extensions and use the current date.
 *
 * It defaults to `Date` if the passed reference date is a number or a string.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The reference date to take constructor from
 *
 * @returns Current date initialized using the given date constructor
 *
 * @example
 * import { constructNow, isSameDay } from 'date-fns'
 *
 * function isToday<DateType extends Date>(
 *   date: DateType | number | string,
 * ): boolean {
 *   // If we were to use `new Date()` directly, the function would  behave
 *   // differently in different timezones and return false for the same date.
 *   return isSameDay(date, constructNow(date));
 * }
 */
function constructNow(date) {
  return constructFrom(date, Date.now());
}

/**
 * @name isSameDay
 * @category Day Helpers
 * @summary Are the given dates in the same day (and year and month)?
 *
 * @description
 * Are the given dates in the same day (and year and month)?
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The first date to check
 * @param dateRight - The second date to check

 * @returns The dates are in the same day (and year and month)
 *
 * @example
 * // Are 4 September 06:00:00 and 4 September 18:00:00 in the same day?
 * const result = isSameDay(new Date(2014, 8, 4, 6, 0), new Date(2014, 8, 4, 18, 0))
 * //=> true
 *
 * @example
 * // Are 4 September and 4 October in the same day?
 * const result = isSameDay(new Date(2014, 8, 4), new Date(2014, 9, 4))
 * //=> false
 *
 * @example
 * // Are 4 September, 2014 and 4 September, 2015 in the same day?
 * const result = isSameDay(new Date(2014, 8, 4), new Date(2015, 8, 4))
 * //=> false
 */
function isSameDay(dateLeft, dateRight) {
  const dateLeftStartOfDay = startOfDay(dateLeft);
  const dateRightStartOfDay = startOfDay(dateRight);

  return +dateLeftStartOfDay === +dateRightStartOfDay;
}

/**
 * @name isDate
 * @category Common Helpers
 * @summary Is the given value a date?
 *
 * @description
 * Returns true if the given value is an instance of Date. The function works for dates transferred across iframes.
 *
 * @param value - The value to check
 *
 * @returns True if the given value is a date
 *
 * @example
 * // For a valid date:
 * const result = isDate(new Date())
 * //=> true
 *
 * @example
 * // For an invalid date:
 * const result = isDate(new Date(NaN))
 * //=> true
 *
 * @example
 * // For some value:
 * const result = isDate('2014-02-31')
 * //=> false
 *
 * @example
 * // For an object:
 * const result = isDate({})
 * //=> false
 */
function isDate(value) {
  return (
    value instanceof Date ||
    (typeof value === "object" &&
      Object.prototype.toString.call(value) === "[object Date]")
  );
}

/**
 * @name isValid
 * @category Common Helpers
 * @summary Is the given date valid?
 *
 * @description
 * Returns false if argument is Invalid Date and true otherwise.
 * Argument is converted to Date using `toDate`. See [toDate](https://date-fns.org/docs/toDate)
 * Invalid Date is a Date, whose time value is NaN.
 *
 * Time value of Date: http://es5.github.io/#x15.9.1.1
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date to check
 *
 * @returns The date is valid
 *
 * @example
 * // For the valid date:
 * const result = isValid(new Date(2014, 1, 31))
 * //=> true
 *
 * @example
 * // For the value, convertable into a date:
 * const result = isValid(1393804800000)
 * //=> true
 *
 * @example
 * // For the invalid date:
 * const result = isValid(new Date(''))
 * //=> false
 */
function isValid(date) {
  if (!isDate(date) && typeof date !== "number") {
    return false;
  }
  const _date = toDate(date);
  return !isNaN(Number(_date));
}

/**
 * @name differenceInCalendarMonths
 * @category Month Helpers
 * @summary Get the number of calendar months between the given dates.
 *
 * @description
 * Get the number of calendar months between the given dates.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 *
 * @returns The number of calendar months
 *
 * @example
 * // How many calendar months are between 31 January 2014 and 1 September 2014?
 * const result = differenceInCalendarMonths(
 *   new Date(2014, 8, 1),
 *   new Date(2014, 0, 31)
 * )
 * //=> 8
 */
function differenceInCalendarMonths(dateLeft, dateRight) {
  const _dateLeft = toDate(dateLeft);
  const _dateRight = toDate(dateRight);

  const yearDiff = _dateLeft.getFullYear() - _dateRight.getFullYear();
  const monthDiff = _dateLeft.getMonth() - _dateRight.getMonth();

  return yearDiff * 12 + monthDiff;
}

function getRoundingMethod(method) {
  return (number) => {
    const round = method ? Math[method] : Math.trunc;
    const result = round(number);
    // Prevent negative zero
    return result === 0 ? 0 : result;
  };
}

/**
 * @name differenceInMilliseconds
 * @category Millisecond Helpers
 * @summary Get the number of milliseconds between the given dates.
 *
 * @description
 * Get the number of milliseconds between the given dates.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 *
 * @returns The number of milliseconds
 *
 * @example
 * // How many milliseconds are between
 * // 2 July 2014 12:30:20.600 and 2 July 2014 12:30:21.700?
 * const result = differenceInMilliseconds(
 *   new Date(2014, 6, 2, 12, 30, 21, 700),
 *   new Date(2014, 6, 2, 12, 30, 20, 600)
 * )
 * //=> 1100
 */
function differenceInMilliseconds(dateLeft, dateRight) {
  return +toDate(dateLeft) - +toDate(dateRight);
}

/**
 * @name endOfDay
 * @category Day Helpers
 * @summary Return the end of a day for the given date.
 *
 * @description
 * Return the end of a day for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The end of a day
 *
 * @example
 * // The end of a day for 2 September 2014 11:55:00:
 * const result = endOfDay(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Tue Sep 02 2014 23:59:59.999
 */
function endOfDay(date) {
  const _date = toDate(date);
  _date.setHours(23, 59, 59, 999);
  return _date;
}

/**
 * @name endOfMonth
 * @category Month Helpers
 * @summary Return the end of a month for the given date.
 *
 * @description
 * Return the end of a month for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The end of a month
 *
 * @example
 * // The end of a month for 2 September 2014 11:55:00:
 * const result = endOfMonth(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Tue Sep 30 2014 23:59:59.999
 */
function endOfMonth(date) {
  const _date = toDate(date);
  const month = _date.getMonth();
  _date.setFullYear(_date.getFullYear(), month + 1, 0);
  _date.setHours(23, 59, 59, 999);
  return _date;
}

/**
 * @name isLastDayOfMonth
 * @category Month Helpers
 * @summary Is the given date the last day of a month?
 *
 * @description
 * Is the given date the last day of a month?
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date to check

 * @returns The date is the last day of a month
 *
 * @example
 * // Is 28 February 2014 the last day of a month?
 * const result = isLastDayOfMonth(new Date(2014, 1, 28))
 * //=> true
 */
function isLastDayOfMonth(date) {
  const _date = toDate(date);
  return +endOfDay(_date) === +endOfMonth(_date);
}

/**
 * @name differenceInMonths
 * @category Month Helpers
 * @summary Get the number of full months between the given dates.
 *
 * @description
 * Get the number of full months between the given dates using trunc as a default rounding method.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 *
 * @returns The number of full months
 *
 * @example
 * // How many full months are between 31 January 2014 and 1 September 2014?
 * const result = differenceInMonths(new Date(2014, 8, 1), new Date(2014, 0, 31))
 * //=> 7
 */
function differenceInMonths(dateLeft, dateRight) {
  const _dateLeft = toDate(dateLeft);
  const _dateRight = toDate(dateRight);

  const sign = compareAsc(_dateLeft, _dateRight);
  const difference = Math.abs(
    differenceInCalendarMonths(_dateLeft, _dateRight),
  );
  let result;

  // Check for the difference of less than month
  if (difference < 1) {
    result = 0;
  } else {
    if (_dateLeft.getMonth() === 1 && _dateLeft.getDate() > 27) {
      // This will check if the date is end of Feb and assign a higher end of month date
      // to compare it with Jan
      _dateLeft.setDate(30);
    }

    _dateLeft.setMonth(_dateLeft.getMonth() - sign * difference);

    // Math.abs(diff in full months - diff in calendar months) === 1 if last calendar month is not full
    // If so, result must be decreased by 1 in absolute value
    let isLastMonthNotFull = compareAsc(_dateLeft, _dateRight) === -sign;

    // Check for cases of one full calendar month
    if (
      isLastDayOfMonth(toDate(dateLeft)) &&
      difference === 1 &&
      compareAsc(dateLeft, _dateRight) === 1
    ) {
      isLastMonthNotFull = false;
    }

    result = sign * (difference - Number(isLastMonthNotFull));
  }

  // Prevent negative zero
  return result === 0 ? 0 : result;
}

/**
 * The {@link differenceInSeconds} function options.
 */

/**
 * @name differenceInSeconds
 * @category Second Helpers
 * @summary Get the number of seconds between the given dates.
 *
 * @description
 * Get the number of seconds between the given dates.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 * @param options - An object with options.
 *
 * @returns The number of seconds
 *
 * @example
 * // How many seconds are between
 * // 2 July 2014 12:30:07.999 and 2 July 2014 12:30:20.000?
 * const result = differenceInSeconds(
 *   new Date(2014, 6, 2, 12, 30, 20, 0),
 *   new Date(2014, 6, 2, 12, 30, 7, 999)
 * )
 * //=> 12
 */
function differenceInSeconds(dateLeft, dateRight, options) {
  const diff = differenceInMilliseconds(dateLeft, dateRight) / 1000;
  return getRoundingMethod(options?.roundingMethod)(diff);
}

/**
 * @name startOfYear
 * @category Year Helpers
 * @summary Return the start of a year for the given date.
 *
 * @description
 * Return the start of a year for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The start of a year
 *
 * @example
 * // The start of a year for 2 September 2014 11:55:00:
 * const result = startOfYear(new Date(2014, 8, 2, 11, 55, 00))
 * //=> Wed Jan 01 2014 00:00:00
 */
function startOfYear(date) {
  const cleanDate = toDate(date);
  const _date = constructFrom(date, 0);
  _date.setFullYear(cleanDate.getFullYear(), 0, 1);
  _date.setHours(0, 0, 0, 0);
  return _date;
}

const formatDistanceLocale$1 = {
  lessThanXSeconds: {
    one: "less than a second",
    other: "less than {{count}} seconds",
  },

  xSeconds: {
    one: "1 second",
    other: "{{count}} seconds",
  },

  halfAMinute: "half a minute",

  lessThanXMinutes: {
    one: "less than a minute",
    other: "less than {{count}} minutes",
  },

  xMinutes: {
    one: "1 minute",
    other: "{{count}} minutes",
  },

  aboutXHours: {
    one: "about 1 hour",
    other: "about {{count}} hours",
  },

  xHours: {
    one: "1 hour",
    other: "{{count}} hours",
  },

  xDays: {
    one: "1 day",
    other: "{{count}} days",
  },

  aboutXWeeks: {
    one: "about 1 week",
    other: "about {{count}} weeks",
  },

  xWeeks: {
    one: "1 week",
    other: "{{count}} weeks",
  },

  aboutXMonths: {
    one: "about 1 month",
    other: "about {{count}} months",
  },

  xMonths: {
    one: "1 month",
    other: "{{count}} months",
  },

  aboutXYears: {
    one: "about 1 year",
    other: "about {{count}} years",
  },

  xYears: {
    one: "1 year",
    other: "{{count}} years",
  },

  overXYears: {
    one: "over 1 year",
    other: "over {{count}} years",
  },

  almostXYears: {
    one: "almost 1 year",
    other: "almost {{count}} years",
  },
};

const formatDistance$2 = (token, count, options) => {
  let result;

  const tokenValue = formatDistanceLocale$1[token];
  if (typeof tokenValue === "string") {
    result = tokenValue;
  } else if (count === 1) {
    result = tokenValue.one;
  } else {
    result = tokenValue.other.replace("{{count}}", count.toString());
  }

  if (options?.addSuffix) {
    if (options.comparison && options.comparison > 0) {
      return "in " + result;
    } else {
      return result + " ago";
    }
  }

  return result;
};

function buildFormatLongFn(args) {
  return (options = {}) => {
    // TODO: Remove String()
    const width = options.width ? String(options.width) : args.defaultWidth;
    const format = args.formats[width] || args.formats[args.defaultWidth];
    return format;
  };
}

const dateFormats$1 = {
  full: "EEEE, MMMM do, y",
  long: "MMMM do, y",
  medium: "MMM d, y",
  short: "MM/dd/yyyy",
};

const timeFormats$1 = {
  full: "h:mm:ss a zzzz",
  long: "h:mm:ss a z",
  medium: "h:mm:ss a",
  short: "h:mm a",
};

const dateTimeFormats$1 = {
  full: "{{date}} 'at' {{time}}",
  long: "{{date}} 'at' {{time}}",
  medium: "{{date}}, {{time}}",
  short: "{{date}}, {{time}}",
};

const formatLong$1 = {
  date: buildFormatLongFn({
    formats: dateFormats$1,
    defaultWidth: "full",
  }),

  time: buildFormatLongFn({
    formats: timeFormats$1,
    defaultWidth: "full",
  }),

  dateTime: buildFormatLongFn({
    formats: dateTimeFormats$1,
    defaultWidth: "full",
  }),
};

const formatRelativeLocale$1 = {
  lastWeek: "'last' eeee 'at' p",
  yesterday: "'yesterday at' p",
  today: "'today at' p",
  tomorrow: "'tomorrow at' p",
  nextWeek: "eeee 'at' p",
  other: "P",
};

const formatRelative$1 = (token, _date, _baseDate, _options) =>
  formatRelativeLocale$1[token];

/* eslint-disable no-unused-vars */

/**
 * The localize function argument callback which allows to convert raw value to
 * the actual type.
 *
 * @param value - The value to convert
 *
 * @returns The converted value
 */

/**
 * The map of localized values for each width.
 */

/**
 * The index type of the locale unit value. It types conversion of units of
 * values that don't start at 0 (i.e. quarters).
 */

/**
 * Converts the unit value to the tuple of values.
 */

/**
 * The tuple of localized era values. The first element represents BC,
 * the second element represents AD.
 */

/**
 * The tuple of localized quarter values. The first element represents Q1.
 */

/**
 * The tuple of localized day values. The first element represents Sunday.
 */

/**
 * The tuple of localized month values. The first element represents January.
 */

function buildLocalizeFn(args) {
  return (value, options) => {
    const context = options?.context ? String(options.context) : "standalone";

    let valuesArray;
    if (context === "formatting" && args.formattingValues) {
      const defaultWidth = args.defaultFormattingWidth || args.defaultWidth;
      const width = options?.width ? String(options.width) : defaultWidth;

      valuesArray =
        args.formattingValues[width] || args.formattingValues[defaultWidth];
    } else {
      const defaultWidth = args.defaultWidth;
      const width = options?.width ? String(options.width) : args.defaultWidth;

      valuesArray = args.values[width] || args.values[defaultWidth];
    }
    const index = args.argumentCallback ? args.argumentCallback(value) : value;

    // @ts-expect-error - For some reason TypeScript just don't want to match it, no matter how hard we try. I challenge you to try to remove it!
    return valuesArray[index];
  };
}

const eraValues$1 = {
  narrow: ["B", "A"],
  abbreviated: ["BC", "AD"],
  wide: ["Before Christ", "Anno Domini"],
};

const quarterValues$1 = {
  narrow: ["1", "2", "3", "4"],
  abbreviated: ["Q1", "Q2", "Q3", "Q4"],
  wide: ["1st quarter", "2nd quarter", "3rd quarter", "4th quarter"],
};

// Note: in English, the names of days of the week and months are capitalized.
// If you are making a new locale based on this one, check if the same is true for the language you're working on.
// Generally, formatted dates should look like they are in the middle of a sentence,
// e.g. in Spanish language the weekdays and months should be in the lowercase.
const monthValues$1 = {
  narrow: ["J", "F", "M", "A", "M", "J", "J", "A", "S", "O", "N", "D"],
  abbreviated: [
    "Jan",
    "Feb",
    "Mar",
    "Apr",
    "May",
    "Jun",
    "Jul",
    "Aug",
    "Sep",
    "Oct",
    "Nov",
    "Dec",
  ],

  wide: [
    "January",
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December",
  ],
};

const dayValues$1 = {
  narrow: ["S", "M", "T", "W", "T", "F", "S"],
  short: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"],
  abbreviated: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
  wide: [
    "Sunday",
    "Monday",
    "Tuesday",
    "Wednesday",
    "Thursday",
    "Friday",
    "Saturday",
  ],
};

const dayPeriodValues$1 = {
  narrow: {
    am: "a",
    pm: "p",
    midnight: "mi",
    noon: "n",
    morning: "morning",
    afternoon: "afternoon",
    evening: "evening",
    night: "night",
  },
  abbreviated: {
    am: "AM",
    pm: "PM",
    midnight: "midnight",
    noon: "noon",
    morning: "morning",
    afternoon: "afternoon",
    evening: "evening",
    night: "night",
  },
  wide: {
    am: "a.m.",
    pm: "p.m.",
    midnight: "midnight",
    noon: "noon",
    morning: "morning",
    afternoon: "afternoon",
    evening: "evening",
    night: "night",
  },
};

const formattingDayPeriodValues$1 = {
  narrow: {
    am: "a",
    pm: "p",
    midnight: "mi",
    noon: "n",
    morning: "in the morning",
    afternoon: "in the afternoon",
    evening: "in the evening",
    night: "at night",
  },
  abbreviated: {
    am: "AM",
    pm: "PM",
    midnight: "midnight",
    noon: "noon",
    morning: "in the morning",
    afternoon: "in the afternoon",
    evening: "in the evening",
    night: "at night",
  },
  wide: {
    am: "a.m.",
    pm: "p.m.",
    midnight: "midnight",
    noon: "noon",
    morning: "in the morning",
    afternoon: "in the afternoon",
    evening: "in the evening",
    night: "at night",
  },
};

const ordinalNumber$1 = (dirtyNumber, _options) => {
  const number = Number(dirtyNumber);

  // If ordinal numbers depend on context, for example,
  // if they are different for different grammatical genders,
  // use `options.unit`.
  //
  // `unit` can be 'year', 'quarter', 'month', 'week', 'date', 'dayOfYear',
  // 'day', 'hour', 'minute', 'second'.

  const rem100 = number % 100;
  if (rem100 > 20 || rem100 < 10) {
    switch (rem100 % 10) {
      case 1:
        return number + "st";
      case 2:
        return number + "nd";
      case 3:
        return number + "rd";
    }
  }
  return number + "th";
};

const localize$1 = {
  ordinalNumber: ordinalNumber$1,

  era: buildLocalizeFn({
    values: eraValues$1,
    defaultWidth: "wide",
  }),

  quarter: buildLocalizeFn({
    values: quarterValues$1,
    defaultWidth: "wide",
    argumentCallback: (quarter) => quarter - 1,
  }),

  month: buildLocalizeFn({
    values: monthValues$1,
    defaultWidth: "wide",
  }),

  day: buildLocalizeFn({
    values: dayValues$1,
    defaultWidth: "wide",
  }),

  dayPeriod: buildLocalizeFn({
    values: dayPeriodValues$1,
    defaultWidth: "wide",
    formattingValues: formattingDayPeriodValues$1,
    defaultFormattingWidth: "wide",
  }),
};

function buildMatchFn(args) {
  return (string, options = {}) => {
    const width = options.width;

    const matchPattern =
      (width && args.matchPatterns[width]) ||
      args.matchPatterns[args.defaultMatchWidth];
    const matchResult = string.match(matchPattern);

    if (!matchResult) {
      return null;
    }
    const matchedString = matchResult[0];

    const parsePatterns =
      (width && args.parsePatterns[width]) ||
      args.parsePatterns[args.defaultParseWidth];

    const key = Array.isArray(parsePatterns)
      ? findIndex(parsePatterns, (pattern) => pattern.test(matchedString))
      : // eslint-disable-next-line @typescript-eslint/no-explicit-any -- I challange you to fix the type
        findKey(parsePatterns, (pattern) => pattern.test(matchedString));

    let value;

    value = args.valueCallback ? args.valueCallback(key) : key;
    value = options.valueCallback
      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any -- I challange you to fix the type
        options.valueCallback(value)
      : value;

    const rest = string.slice(matchedString.length);

    return { value, rest };
  };
}

function findKey(object, predicate) {
  for (const key in object) {
    if (
      Object.prototype.hasOwnProperty.call(object, key) &&
      predicate(object[key])
    ) {
      return key;
    }
  }
  return undefined;
}

function findIndex(array, predicate) {
  for (let key = 0; key < array.length; key++) {
    if (predicate(array[key])) {
      return key;
    }
  }
  return undefined;
}

function buildMatchPatternFn(args) {
  return (string, options = {}) => {
    const matchResult = string.match(args.matchPattern);
    if (!matchResult) return null;
    const matchedString = matchResult[0];

    const parseResult = string.match(args.parsePattern);
    if (!parseResult) return null;
    let value = args.valueCallback
      ? args.valueCallback(parseResult[0])
      : parseResult[0];

    // eslint-disable-next-line @typescript-eslint/no-explicit-any -- I challange you to fix the type
    value = options.valueCallback ? options.valueCallback(value) : value;

    const rest = string.slice(matchedString.length);

    return { value, rest };
  };
}

const matchOrdinalNumberPattern$1 = /^(\d+)(th|st|nd|rd)?/i;
const parseOrdinalNumberPattern$1 = /\d+/i;

const matchEraPatterns$1 = {
  narrow: /^(b|a)/i,
  abbreviated: /^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,
  wide: /^(before christ|before common era|anno domini|common era)/i,
};
const parseEraPatterns$1 = {
  any: [/^b/i, /^(a|c)/i],
};

const matchQuarterPatterns$1 = {
  narrow: /^[1234]/i,
  abbreviated: /^q[1234]/i,
  wide: /^[1234](th|st|nd|rd)? quarter/i,
};
const parseQuarterPatterns$1 = {
  any: [/1/i, /2/i, /3/i, /4/i],
};

const matchMonthPatterns$1 = {
  narrow: /^[jfmasond]/i,
  abbreviated: /^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,
  wide: /^(january|february|march|april|may|june|july|august|september|october|november|december)/i,
};
const parseMonthPatterns$1 = {
  narrow: [
    /^j/i,
    /^f/i,
    /^m/i,
    /^a/i,
    /^m/i,
    /^j/i,
    /^j/i,
    /^a/i,
    /^s/i,
    /^o/i,
    /^n/i,
    /^d/i,
  ],

  any: [
    /^ja/i,
    /^f/i,
    /^mar/i,
    /^ap/i,
    /^may/i,
    /^jun/i,
    /^jul/i,
    /^au/i,
    /^s/i,
    /^o/i,
    /^n/i,
    /^d/i,
  ],
};

const matchDayPatterns$1 = {
  narrow: /^[smtwf]/i,
  short: /^(su|mo|tu|we|th|fr|sa)/i,
  abbreviated: /^(sun|mon|tue|wed|thu|fri|sat)/i,
  wide: /^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i,
};
const parseDayPatterns$1 = {
  narrow: [/^s/i, /^m/i, /^t/i, /^w/i, /^t/i, /^f/i, /^s/i],
  any: [/^su/i, /^m/i, /^tu/i, /^w/i, /^th/i, /^f/i, /^sa/i],
};

const matchDayPeriodPatterns$1 = {
  narrow: /^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,
  any: /^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i,
};
const parseDayPeriodPatterns$1 = {
  any: {
    am: /^a/i,
    pm: /^p/i,
    midnight: /^mi/i,
    noon: /^no/i,
    morning: /morning/i,
    afternoon: /afternoon/i,
    evening: /evening/i,
    night: /night/i,
  },
};

const match$1 = {
  ordinalNumber: buildMatchPatternFn({
    matchPattern: matchOrdinalNumberPattern$1,
    parsePattern: parseOrdinalNumberPattern$1,
    valueCallback: (value) => parseInt(value, 10),
  }),

  era: buildMatchFn({
    matchPatterns: matchEraPatterns$1,
    defaultMatchWidth: "wide",
    parsePatterns: parseEraPatterns$1,
    defaultParseWidth: "any",
  }),

  quarter: buildMatchFn({
    matchPatterns: matchQuarterPatterns$1,
    defaultMatchWidth: "wide",
    parsePatterns: parseQuarterPatterns$1,
    defaultParseWidth: "any",
    valueCallback: (index) => index + 1,
  }),

  month: buildMatchFn({
    matchPatterns: matchMonthPatterns$1,
    defaultMatchWidth: "wide",
    parsePatterns: parseMonthPatterns$1,
    defaultParseWidth: "any",
  }),

  day: buildMatchFn({
    matchPatterns: matchDayPatterns$1,
    defaultMatchWidth: "wide",
    parsePatterns: parseDayPatterns$1,
    defaultParseWidth: "any",
  }),

  dayPeriod: buildMatchFn({
    matchPatterns: matchDayPeriodPatterns$1,
    defaultMatchWidth: "any",
    parsePatterns: parseDayPeriodPatterns$1,
    defaultParseWidth: "any",
  }),
};

/**
 * @category Locales
 * @summary English locale (United States).
 * @language English
 * @iso-639-2 eng
 * @author Sasha Koss [@kossnocorp](https://github.com/kossnocorp)
 * @author Lesha Koss [@leshakoss](https://github.com/leshakoss)
 */
const enUS = {
  code: "en-US",
  formatDistance: formatDistance$2,
  formatLong: formatLong$1,
  formatRelative: formatRelative$1,
  localize: localize$1,
  match: match$1,
  options: {
    weekStartsOn: 0 /* Sunday */,
    firstWeekContainsDate: 1,
  },
};

/**
 * @name getDayOfYear
 * @category Day Helpers
 * @summary Get the day of the year of the given date.
 *
 * @description
 * Get the day of the year of the given date.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 *
 * @returns The day of year
 *
 * @example
 * // Which day of the year is 2 July 2014?
 * const result = getDayOfYear(new Date(2014, 6, 2))
 * //=> 183
 */
function getDayOfYear(date) {
  const _date = toDate(date);
  const diff = differenceInCalendarDays(_date, startOfYear(_date));
  const dayOfYear = diff + 1;
  return dayOfYear;
}

/**
 * @name getISOWeek
 * @category ISO Week Helpers
 * @summary Get the ISO week of the given date.
 *
 * @description
 * Get the ISO week of the given date.
 *
 * ISO week-numbering year: http://en.wikipedia.org/wiki/ISO_week_date
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 *
 * @returns The ISO week
 *
 * @example
 * // Which week of the ISO-week numbering year is 2 January 2005?
 * const result = getISOWeek(new Date(2005, 0, 2))
 * //=> 53
 */
function getISOWeek(date) {
  const _date = toDate(date);
  const diff = +startOfISOWeek(_date) - +startOfISOWeekYear(_date);

  // Round the number of weeks to the nearest integer because the number of
  // milliseconds in a week is not constant (e.g. it's different in the week of
  // the daylight saving time clock shift).
  return Math.round(diff / millisecondsInWeek) + 1;
}

/**
 * The {@link getWeekYear} function options.
 */

/**
 * @name getWeekYear
 * @category Week-Numbering Year Helpers
 * @summary Get the local week-numbering year of the given date.
 *
 * @description
 * Get the local week-numbering year of the given date.
 * The exact calculation depends on the values of
 * `options.weekStartsOn` (which is the index of the first day of the week)
 * and `options.firstWeekContainsDate` (which is the day of January, which is always in
 * the first week of the week-numbering year)
 *
 * Week numbering: https://en.wikipedia.org/wiki/Week#The_ISO_week_date_system
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 * @param options - An object with options.
 *
 * @returns The local week-numbering year
 *
 * @example
 * // Which week numbering year is 26 December 2004 with the default settings?
 * const result = getWeekYear(new Date(2004, 11, 26))
 * //=> 2005
 *
 * @example
 * // Which week numbering year is 26 December 2004 if week starts on Saturday?
 * const result = getWeekYear(new Date(2004, 11, 26), { weekStartsOn: 6 })
 * //=> 2004
 *
 * @example
 * // Which week numbering year is 26 December 2004 if the first week contains 4 January?
 * const result = getWeekYear(new Date(2004, 11, 26), { firstWeekContainsDate: 4 })
 * //=> 2004
 */
function getWeekYear(date, options) {
  const _date = toDate(date);
  const year = _date.getFullYear();

  const defaultOptions = getDefaultOptions();
  const firstWeekContainsDate =
    options?.firstWeekContainsDate ??
    options?.locale?.options?.firstWeekContainsDate ??
    defaultOptions.firstWeekContainsDate ??
    defaultOptions.locale?.options?.firstWeekContainsDate ??
    1;

  const firstWeekOfNextYear = constructFrom(date, 0);
  firstWeekOfNextYear.setFullYear(year + 1, 0, firstWeekContainsDate);
  firstWeekOfNextYear.setHours(0, 0, 0, 0);
  const startOfNextYear = startOfWeek(firstWeekOfNextYear, options);

  const firstWeekOfThisYear = constructFrom(date, 0);
  firstWeekOfThisYear.setFullYear(year, 0, firstWeekContainsDate);
  firstWeekOfThisYear.setHours(0, 0, 0, 0);
  const startOfThisYear = startOfWeek(firstWeekOfThisYear, options);

  if (_date.getTime() >= startOfNextYear.getTime()) {
    return year + 1;
  } else if (_date.getTime() >= startOfThisYear.getTime()) {
    return year;
  } else {
    return year - 1;
  }
}

/**
 * The {@link startOfWeekYear} function options.
 */

/**
 * @name startOfWeekYear
 * @category Week-Numbering Year Helpers
 * @summary Return the start of a local week-numbering year for the given date.
 *
 * @description
 * Return the start of a local week-numbering year.
 * The exact calculation depends on the values of
 * `options.weekStartsOn` (which is the index of the first day of the week)
 * and `options.firstWeekContainsDate` (which is the day of January, which is always in
 * the first week of the week-numbering year)
 *
 * Week numbering: https://en.wikipedia.org/wiki/Week#The_ISO_week_date_system
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 * @param options - An object with options
 *
 * @returns The start of a week-numbering year
 *
 * @example
 * // The start of an a week-numbering year for 2 July 2005 with default settings:
 * const result = startOfWeekYear(new Date(2005, 6, 2))
 * //=> Sun Dec 26 2004 00:00:00
 *
 * @example
 * // The start of a week-numbering year for 2 July 2005
 * // if Monday is the first day of week
 * // and 4 January is always in the first week of the year:
 * const result = startOfWeekYear(new Date(2005, 6, 2), {
 *   weekStartsOn: 1,
 *   firstWeekContainsDate: 4
 * })
 * //=> Mon Jan 03 2005 00:00:00
 */
function startOfWeekYear(date, options) {
  const defaultOptions = getDefaultOptions();
  const firstWeekContainsDate =
    options?.firstWeekContainsDate ??
    options?.locale?.options?.firstWeekContainsDate ??
    defaultOptions.firstWeekContainsDate ??
    defaultOptions.locale?.options?.firstWeekContainsDate ??
    1;

  const year = getWeekYear(date, options);
  const firstWeek = constructFrom(date, 0);
  firstWeek.setFullYear(year, 0, firstWeekContainsDate);
  firstWeek.setHours(0, 0, 0, 0);
  const _date = startOfWeek(firstWeek, options);
  return _date;
}

/**
 * The {@link getWeek} function options.
 */

/**
 * @name getWeek
 * @category Week Helpers
 * @summary Get the local week index of the given date.
 *
 * @description
 * Get the local week index of the given date.
 * The exact calculation depends on the values of
 * `options.weekStartsOn` (which is the index of the first day of the week)
 * and `options.firstWeekContainsDate` (which is the day of January, which is always in
 * the first week of the week-numbering year)
 *
 * Week numbering: https://en.wikipedia.org/wiki/Week#The_ISO_week_date_system
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 * @param options - An object with options
 *
 * @returns The week
 *
 * @example
 * // Which week of the local week numbering year is 2 January 2005 with default options?
 * const result = getWeek(new Date(2005, 0, 2))
 * //=> 2
 *
 * @example
 * // Which week of the local week numbering year is 2 January 2005,
 * // if Monday is the first day of the week,
 * // and the first week of the year always contains 4 January?
 * const result = getWeek(new Date(2005, 0, 2), {
 *   weekStartsOn: 1,
 *   firstWeekContainsDate: 4
 * })
 * //=> 53
 */

function getWeek(date, options) {
  const _date = toDate(date);
  const diff = +startOfWeek(_date, options) - +startOfWeekYear(_date, options);

  // Round the number of weeks to the nearest integer because the number of
  // milliseconds in a week is not constant (e.g. it's different in the week of
  // the daylight saving time clock shift).
  return Math.round(diff / millisecondsInWeek) + 1;
}

function addLeadingZeros(number, targetLength) {
  const sign = number < 0 ? "-" : "";
  const output = Math.abs(number).toString().padStart(targetLength, "0");
  return sign + output;
}

/*
 * |     | Unit                           |     | Unit                           |
 * |-----|--------------------------------|-----|--------------------------------|
 * |  a  | AM, PM                         |  A* |                                |
 * |  d  | Day of month                   |  D  |                                |
 * |  h  | Hour [1-12]                    |  H  | Hour [0-23]                    |
 * |  m  | Minute                         |  M  | Month                          |
 * |  s  | Second                         |  S  | Fraction of second             |
 * |  y  | Year (abs)                     |  Y  |                                |
 *
 * Letters marked by * are not implemented but reserved by Unicode standard.
 */

const lightFormatters = {
  // Year
  y(date, token) {
    // From http://www.unicode.org/reports/tr35/tr35-31/tr35-dates.html#Date_Format_tokens
    // | Year     |     y | yy |   yyy |  yyyy | yyyyy |
    // |----------|-------|----|-------|-------|-------|
    // | AD 1     |     1 | 01 |   001 |  0001 | 00001 |
    // | AD 12    |    12 | 12 |   012 |  0012 | 00012 |
    // | AD 123   |   123 | 23 |   123 |  0123 | 00123 |
    // | AD 1234  |  1234 | 34 |  1234 |  1234 | 01234 |
    // | AD 12345 | 12345 | 45 | 12345 | 12345 | 12345 |

    const signedYear = date.getFullYear();
    // Returns 1 for 1 BC (which is year 0 in JavaScript)
    const year = signedYear > 0 ? signedYear : 1 - signedYear;
    return addLeadingZeros(token === "yy" ? year % 100 : year, token.length);
  },

  // Month
  M(date, token) {
    const month = date.getMonth();
    return token === "M" ? String(month + 1) : addLeadingZeros(month + 1, 2);
  },

  // Day of the month
  d(date, token) {
    return addLeadingZeros(date.getDate(), token.length);
  },

  // AM or PM
  a(date, token) {
    const dayPeriodEnumValue = date.getHours() / 12 >= 1 ? "pm" : "am";

    switch (token) {
      case "a":
      case "aa":
        return dayPeriodEnumValue.toUpperCase();
      case "aaa":
        return dayPeriodEnumValue;
      case "aaaaa":
        return dayPeriodEnumValue[0];
      case "aaaa":
      default:
        return dayPeriodEnumValue === "am" ? "a.m." : "p.m.";
    }
  },

  // Hour [1-12]
  h(date, token) {
    return addLeadingZeros(date.getHours() % 12 || 12, token.length);
  },

  // Hour [0-23]
  H(date, token) {
    return addLeadingZeros(date.getHours(), token.length);
  },

  // Minute
  m(date, token) {
    return addLeadingZeros(date.getMinutes(), token.length);
  },

  // Second
  s(date, token) {
    return addLeadingZeros(date.getSeconds(), token.length);
  },

  // Fraction of second
  S(date, token) {
    const numberOfDigits = token.length;
    const milliseconds = date.getMilliseconds();
    const fractionalSeconds = Math.trunc(
      milliseconds * Math.pow(10, numberOfDigits - 3),
    );
    return addLeadingZeros(fractionalSeconds, token.length);
  },
};

const dayPeriodEnum = {
  midnight: "midnight",
  noon: "noon",
  morning: "morning",
  afternoon: "afternoon",
  evening: "evening",
  night: "night",
};

/*
 * |     | Unit                           |     | Unit                           |
 * |-----|--------------------------------|-----|--------------------------------|
 * |  a  | AM, PM                         |  A* | Milliseconds in day            |
 * |  b  | AM, PM, noon, midnight         |  B  | Flexible day period            |
 * |  c  | Stand-alone local day of week  |  C* | Localized hour w/ day period   |
 * |  d  | Day of month                   |  D  | Day of year                    |
 * |  e  | Local day of week              |  E  | Day of week                    |
 * |  f  |                                |  F* | Day of week in month           |
 * |  g* | Modified Julian day            |  G  | Era                            |
 * |  h  | Hour [1-12]                    |  H  | Hour [0-23]                    |
 * |  i! | ISO day of week                |  I! | ISO week of year               |
 * |  j* | Localized hour w/ day period   |  J* | Localized hour w/o day period  |
 * |  k  | Hour [1-24]                    |  K  | Hour [0-11]                    |
 * |  l* | (deprecated)                   |  L  | Stand-alone month              |
 * |  m  | Minute                         |  M  | Month                          |
 * |  n  |                                |  N  |                                |
 * |  o! | Ordinal number modifier        |  O  | Timezone (GMT)                 |
 * |  p! | Long localized time            |  P! | Long localized date            |
 * |  q  | Stand-alone quarter            |  Q  | Quarter                        |
 * |  r* | Related Gregorian year         |  R! | ISO week-numbering year        |
 * |  s  | Second                         |  S  | Fraction of second             |
 * |  t! | Seconds timestamp              |  T! | Milliseconds timestamp         |
 * |  u  | Extended year                  |  U* | Cyclic year                    |
 * |  v* | Timezone (generic non-locat.)  |  V* | Timezone (location)            |
 * |  w  | Local week of year             |  W* | Week of month                  |
 * |  x  | Timezone (ISO-8601 w/o Z)      |  X  | Timezone (ISO-8601)            |
 * |  y  | Year (abs)                     |  Y  | Local week-numbering year      |
 * |  z  | Timezone (specific non-locat.) |  Z* | Timezone (aliases)             |
 *
 * Letters marked by * are not implemented but reserved by Unicode standard.
 *
 * Letters marked by ! are non-standard, but implemented by date-fns:
 * - `o` modifies the previous token to turn it into an ordinal (see `format` docs)
 * - `i` is ISO day of week. For `i` and `ii` is returns numeric ISO week days,
 *   i.e. 7 for Sunday, 1 for Monday, etc.
 * - `I` is ISO week of year, as opposed to `w` which is local week of year.
 * - `R` is ISO week-numbering year, as opposed to `Y` which is local week-numbering year.
 *   `R` is supposed to be used in conjunction with `I` and `i`
 *   for universal ISO week-numbering date, whereas
 *   `Y` is supposed to be used in conjunction with `w` and `e`
 *   for week-numbering date specific to the locale.
 * - `P` is long localized date format
 * - `p` is long localized time format
 */

const formatters = {
  // Era
  G: function (date, token, localize) {
    const era = date.getFullYear() > 0 ? 1 : 0;
    switch (token) {
      // AD, BC
      case "G":
      case "GG":
      case "GGG":
        return localize.era(era, { width: "abbreviated" });
      // A, B
      case "GGGGG":
        return localize.era(era, { width: "narrow" });
      // Anno Domini, Before Christ
      case "GGGG":
      default:
        return localize.era(era, { width: "wide" });
    }
  },

  // Year
  y: function (date, token, localize) {
    // Ordinal number
    if (token === "yo") {
      const signedYear = date.getFullYear();
      // Returns 1 for 1 BC (which is year 0 in JavaScript)
      const year = signedYear > 0 ? signedYear : 1 - signedYear;
      return localize.ordinalNumber(year, { unit: "year" });
    }

    return lightFormatters.y(date, token);
  },

  // Local week-numbering year
  Y: function (date, token, localize, options) {
    const signedWeekYear = getWeekYear(date, options);
    // Returns 1 for 1 BC (which is year 0 in JavaScript)
    const weekYear = signedWeekYear > 0 ? signedWeekYear : 1 - signedWeekYear;

    // Two digit year
    if (token === "YY") {
      const twoDigitYear = weekYear % 100;
      return addLeadingZeros(twoDigitYear, 2);
    }

    // Ordinal number
    if (token === "Yo") {
      return localize.ordinalNumber(weekYear, { unit: "year" });
    }

    // Padding
    return addLeadingZeros(weekYear, token.length);
  },

  // ISO week-numbering year
  R: function (date, token) {
    const isoWeekYear = getISOWeekYear(date);

    // Padding
    return addLeadingZeros(isoWeekYear, token.length);
  },

  // Extended year. This is a single number designating the year of this calendar system.
  // The main difference between `y` and `u` localizers are B.C. years:
  // | Year | `y` | `u` |
  // |------|-----|-----|
  // | AC 1 |   1 |   1 |
  // | BC 1 |   1 |   0 |
  // | BC 2 |   2 |  -1 |
  // Also `yy` always returns the last two digits of a year,
  // while `uu` pads single digit years to 2 characters and returns other years unchanged.
  u: function (date, token) {
    const year = date.getFullYear();
    return addLeadingZeros(year, token.length);
  },

  // Quarter
  Q: function (date, token, localize) {
    const quarter = Math.ceil((date.getMonth() + 1) / 3);
    switch (token) {
      // 1, 2, 3, 4
      case "Q":
        return String(quarter);
      // 01, 02, 03, 04
      case "QQ":
        return addLeadingZeros(quarter, 2);
      // 1st, 2nd, 3rd, 4th
      case "Qo":
        return localize.ordinalNumber(quarter, { unit: "quarter" });
      // Q1, Q2, Q3, Q4
      case "QQQ":
        return localize.quarter(quarter, {
          width: "abbreviated",
          context: "formatting",
        });
      // 1, 2, 3, 4 (narrow quarter; could be not numerical)
      case "QQQQQ":
        return localize.quarter(quarter, {
          width: "narrow",
          context: "formatting",
        });
      // 1st quarter, 2nd quarter, ...
      case "QQQQ":
      default:
        return localize.quarter(quarter, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // Stand-alone quarter
  q: function (date, token, localize) {
    const quarter = Math.ceil((date.getMonth() + 1) / 3);
    switch (token) {
      // 1, 2, 3, 4
      case "q":
        return String(quarter);
      // 01, 02, 03, 04
      case "qq":
        return addLeadingZeros(quarter, 2);
      // 1st, 2nd, 3rd, 4th
      case "qo":
        return localize.ordinalNumber(quarter, { unit: "quarter" });
      // Q1, Q2, Q3, Q4
      case "qqq":
        return localize.quarter(quarter, {
          width: "abbreviated",
          context: "standalone",
        });
      // 1, 2, 3, 4 (narrow quarter; could be not numerical)
      case "qqqqq":
        return localize.quarter(quarter, {
          width: "narrow",
          context: "standalone",
        });
      // 1st quarter, 2nd quarter, ...
      case "qqqq":
      default:
        return localize.quarter(quarter, {
          width: "wide",
          context: "standalone",
        });
    }
  },

  // Month
  M: function (date, token, localize) {
    const month = date.getMonth();
    switch (token) {
      case "M":
      case "MM":
        return lightFormatters.M(date, token);
      // 1st, 2nd, ..., 12th
      case "Mo":
        return localize.ordinalNumber(month + 1, { unit: "month" });
      // Jan, Feb, ..., Dec
      case "MMM":
        return localize.month(month, {
          width: "abbreviated",
          context: "formatting",
        });
      // J, F, ..., D
      case "MMMMM":
        return localize.month(month, {
          width: "narrow",
          context: "formatting",
        });
      // January, February, ..., December
      case "MMMM":
      default:
        return localize.month(month, { width: "wide", context: "formatting" });
    }
  },

  // Stand-alone month
  L: function (date, token, localize) {
    const month = date.getMonth();
    switch (token) {
      // 1, 2, ..., 12
      case "L":
        return String(month + 1);
      // 01, 02, ..., 12
      case "LL":
        return addLeadingZeros(month + 1, 2);
      // 1st, 2nd, ..., 12th
      case "Lo":
        return localize.ordinalNumber(month + 1, { unit: "month" });
      // Jan, Feb, ..., Dec
      case "LLL":
        return localize.month(month, {
          width: "abbreviated",
          context: "standalone",
        });
      // J, F, ..., D
      case "LLLLL":
        return localize.month(month, {
          width: "narrow",
          context: "standalone",
        });
      // January, February, ..., December
      case "LLLL":
      default:
        return localize.month(month, { width: "wide", context: "standalone" });
    }
  },

  // Local week of year
  w: function (date, token, localize, options) {
    const week = getWeek(date, options);

    if (token === "wo") {
      return localize.ordinalNumber(week, { unit: "week" });
    }

    return addLeadingZeros(week, token.length);
  },

  // ISO week of year
  I: function (date, token, localize) {
    const isoWeek = getISOWeek(date);

    if (token === "Io") {
      return localize.ordinalNumber(isoWeek, { unit: "week" });
    }

    return addLeadingZeros(isoWeek, token.length);
  },

  // Day of the month
  d: function (date, token, localize) {
    if (token === "do") {
      return localize.ordinalNumber(date.getDate(), { unit: "date" });
    }

    return lightFormatters.d(date, token);
  },

  // Day of year
  D: function (date, token, localize) {
    const dayOfYear = getDayOfYear(date);

    if (token === "Do") {
      return localize.ordinalNumber(dayOfYear, { unit: "dayOfYear" });
    }

    return addLeadingZeros(dayOfYear, token.length);
  },

  // Day of week
  E: function (date, token, localize) {
    const dayOfWeek = date.getDay();
    switch (token) {
      // Tue
      case "E":
      case "EE":
      case "EEE":
        return localize.day(dayOfWeek, {
          width: "abbreviated",
          context: "formatting",
        });
      // T
      case "EEEEE":
        return localize.day(dayOfWeek, {
          width: "narrow",
          context: "formatting",
        });
      // Tu
      case "EEEEEE":
        return localize.day(dayOfWeek, {
          width: "short",
          context: "formatting",
        });
      // Tuesday
      case "EEEE":
      default:
        return localize.day(dayOfWeek, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // Local day of week
  e: function (date, token, localize, options) {
    const dayOfWeek = date.getDay();
    const localDayOfWeek = (dayOfWeek - options.weekStartsOn + 8) % 7 || 7;
    switch (token) {
      // Numerical value (Nth day of week with current locale or weekStartsOn)
      case "e":
        return String(localDayOfWeek);
      // Padded numerical value
      case "ee":
        return addLeadingZeros(localDayOfWeek, 2);
      // 1st, 2nd, ..., 7th
      case "eo":
        return localize.ordinalNumber(localDayOfWeek, { unit: "day" });
      case "eee":
        return localize.day(dayOfWeek, {
          width: "abbreviated",
          context: "formatting",
        });
      // T
      case "eeeee":
        return localize.day(dayOfWeek, {
          width: "narrow",
          context: "formatting",
        });
      // Tu
      case "eeeeee":
        return localize.day(dayOfWeek, {
          width: "short",
          context: "formatting",
        });
      // Tuesday
      case "eeee":
      default:
        return localize.day(dayOfWeek, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // Stand-alone local day of week
  c: function (date, token, localize, options) {
    const dayOfWeek = date.getDay();
    const localDayOfWeek = (dayOfWeek - options.weekStartsOn + 8) % 7 || 7;
    switch (token) {
      // Numerical value (same as in `e`)
      case "c":
        return String(localDayOfWeek);
      // Padded numerical value
      case "cc":
        return addLeadingZeros(localDayOfWeek, token.length);
      // 1st, 2nd, ..., 7th
      case "co":
        return localize.ordinalNumber(localDayOfWeek, { unit: "day" });
      case "ccc":
        return localize.day(dayOfWeek, {
          width: "abbreviated",
          context: "standalone",
        });
      // T
      case "ccccc":
        return localize.day(dayOfWeek, {
          width: "narrow",
          context: "standalone",
        });
      // Tu
      case "cccccc":
        return localize.day(dayOfWeek, {
          width: "short",
          context: "standalone",
        });
      // Tuesday
      case "cccc":
      default:
        return localize.day(dayOfWeek, {
          width: "wide",
          context: "standalone",
        });
    }
  },

  // ISO day of week
  i: function (date, token, localize) {
    const dayOfWeek = date.getDay();
    const isoDayOfWeek = dayOfWeek === 0 ? 7 : dayOfWeek;
    switch (token) {
      // 2
      case "i":
        return String(isoDayOfWeek);
      // 02
      case "ii":
        return addLeadingZeros(isoDayOfWeek, token.length);
      // 2nd
      case "io":
        return localize.ordinalNumber(isoDayOfWeek, { unit: "day" });
      // Tue
      case "iii":
        return localize.day(dayOfWeek, {
          width: "abbreviated",
          context: "formatting",
        });
      // T
      case "iiiii":
        return localize.day(dayOfWeek, {
          width: "narrow",
          context: "formatting",
        });
      // Tu
      case "iiiiii":
        return localize.day(dayOfWeek, {
          width: "short",
          context: "formatting",
        });
      // Tuesday
      case "iiii":
      default:
        return localize.day(dayOfWeek, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // AM or PM
  a: function (date, token, localize) {
    const hours = date.getHours();
    const dayPeriodEnumValue = hours / 12 >= 1 ? "pm" : "am";

    switch (token) {
      case "a":
      case "aa":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "abbreviated",
          context: "formatting",
        });
      case "aaa":
        return localize
          .dayPeriod(dayPeriodEnumValue, {
            width: "abbreviated",
            context: "formatting",
          })
          .toLowerCase();
      case "aaaaa":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "narrow",
          context: "formatting",
        });
      case "aaaa":
      default:
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // AM, PM, midnight, noon
  b: function (date, token, localize) {
    const hours = date.getHours();
    let dayPeriodEnumValue;
    if (hours === 12) {
      dayPeriodEnumValue = dayPeriodEnum.noon;
    } else if (hours === 0) {
      dayPeriodEnumValue = dayPeriodEnum.midnight;
    } else {
      dayPeriodEnumValue = hours / 12 >= 1 ? "pm" : "am";
    }

    switch (token) {
      case "b":
      case "bb":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "abbreviated",
          context: "formatting",
        });
      case "bbb":
        return localize
          .dayPeriod(dayPeriodEnumValue, {
            width: "abbreviated",
            context: "formatting",
          })
          .toLowerCase();
      case "bbbbb":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "narrow",
          context: "formatting",
        });
      case "bbbb":
      default:
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // in the morning, in the afternoon, in the evening, at night
  B: function (date, token, localize) {
    const hours = date.getHours();
    let dayPeriodEnumValue;
    if (hours >= 17) {
      dayPeriodEnumValue = dayPeriodEnum.evening;
    } else if (hours >= 12) {
      dayPeriodEnumValue = dayPeriodEnum.afternoon;
    } else if (hours >= 4) {
      dayPeriodEnumValue = dayPeriodEnum.morning;
    } else {
      dayPeriodEnumValue = dayPeriodEnum.night;
    }

    switch (token) {
      case "B":
      case "BB":
      case "BBB":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "abbreviated",
          context: "formatting",
        });
      case "BBBBB":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "narrow",
          context: "formatting",
        });
      case "BBBB":
      default:
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // Hour [1-12]
  h: function (date, token, localize) {
    if (token === "ho") {
      let hours = date.getHours() % 12;
      if (hours === 0) hours = 12;
      return localize.ordinalNumber(hours, { unit: "hour" });
    }

    return lightFormatters.h(date, token);
  },

  // Hour [0-23]
  H: function (date, token, localize) {
    if (token === "Ho") {
      return localize.ordinalNumber(date.getHours(), { unit: "hour" });
    }

    return lightFormatters.H(date, token);
  },

  // Hour [0-11]
  K: function (date, token, localize) {
    const hours = date.getHours() % 12;

    if (token === "Ko") {
      return localize.ordinalNumber(hours, { unit: "hour" });
    }

    return addLeadingZeros(hours, token.length);
  },

  // Hour [1-24]
  k: function (date, token, localize) {
    let hours = date.getHours();
    if (hours === 0) hours = 24;

    if (token === "ko") {
      return localize.ordinalNumber(hours, { unit: "hour" });
    }

    return addLeadingZeros(hours, token.length);
  },

  // Minute
  m: function (date, token, localize) {
    if (token === "mo") {
      return localize.ordinalNumber(date.getMinutes(), { unit: "minute" });
    }

    return lightFormatters.m(date, token);
  },

  // Second
  s: function (date, token, localize) {
    if (token === "so") {
      return localize.ordinalNumber(date.getSeconds(), { unit: "second" });
    }

    return lightFormatters.s(date, token);
  },

  // Fraction of second
  S: function (date, token) {
    return lightFormatters.S(date, token);
  },

  // Timezone (ISO-8601. If offset is 0, output is always `'Z'`)
  X: function (date, token, _localize) {
    const timezoneOffset = date.getTimezoneOffset();

    if (timezoneOffset === 0) {
      return "Z";
    }

    switch (token) {
      // Hours and optional minutes
      case "X":
        return formatTimezoneWithOptionalMinutes(timezoneOffset);

      // Hours, minutes and optional seconds without `:` delimiter
      // Note: neither ISO-8601 nor JavaScript supports seconds in timezone offsets
      // so this token always has the same output as `XX`
      case "XXXX":
      case "XX": // Hours and minutes without `:` delimiter
        return formatTimezone(timezoneOffset);

      // Hours, minutes and optional seconds with `:` delimiter
      // Note: neither ISO-8601 nor JavaScript supports seconds in timezone offsets
      // so this token always has the same output as `XXX`
      case "XXXXX":
      case "XXX": // Hours and minutes with `:` delimiter
      default:
        return formatTimezone(timezoneOffset, ":");
    }
  },

  // Timezone (ISO-8601. If offset is 0, output is `'+00:00'` or equivalent)
  x: function (date, token, _localize) {
    const timezoneOffset = date.getTimezoneOffset();

    switch (token) {
      // Hours and optional minutes
      case "x":
        return formatTimezoneWithOptionalMinutes(timezoneOffset);

      // Hours, minutes and optional seconds without `:` delimiter
      // Note: neither ISO-8601 nor JavaScript supports seconds in timezone offsets
      // so this token always has the same output as `xx`
      case "xxxx":
      case "xx": // Hours and minutes without `:` delimiter
        return formatTimezone(timezoneOffset);

      // Hours, minutes and optional seconds with `:` delimiter
      // Note: neither ISO-8601 nor JavaScript supports seconds in timezone offsets
      // so this token always has the same output as `xxx`
      case "xxxxx":
      case "xxx": // Hours and minutes with `:` delimiter
      default:
        return formatTimezone(timezoneOffset, ":");
    }
  },

  // Timezone (GMT)
  O: function (date, token, _localize) {
    const timezoneOffset = date.getTimezoneOffset();

    switch (token) {
      // Short
      case "O":
      case "OO":
      case "OOO":
        return "GMT" + formatTimezoneShort(timezoneOffset, ":");
      // Long
      case "OOOO":
      default:
        return "GMT" + formatTimezone(timezoneOffset, ":");
    }
  },

  // Timezone (specific non-location)
  z: function (date, token, _localize) {
    const timezoneOffset = date.getTimezoneOffset();

    switch (token) {
      // Short
      case "z":
      case "zz":
      case "zzz":
        return "GMT" + formatTimezoneShort(timezoneOffset, ":");
      // Long
      case "zzzz":
      default:
        return "GMT" + formatTimezone(timezoneOffset, ":");
    }
  },

  // Seconds timestamp
  t: function (date, token, _localize) {
    const timestamp = Math.trunc(date.getTime() / 1000);
    return addLeadingZeros(timestamp, token.length);
  },

  // Milliseconds timestamp
  T: function (date, token, _localize) {
    const timestamp = date.getTime();
    return addLeadingZeros(timestamp, token.length);
  },
};

function formatTimezoneShort(offset, delimiter = "") {
  const sign = offset > 0 ? "-" : "+";
  const absOffset = Math.abs(offset);
  const hours = Math.trunc(absOffset / 60);
  const minutes = absOffset % 60;
  if (minutes === 0) {
    return sign + String(hours);
  }
  return sign + String(hours) + delimiter + addLeadingZeros(minutes, 2);
}

function formatTimezoneWithOptionalMinutes(offset, delimiter) {
  if (offset % 60 === 0) {
    const sign = offset > 0 ? "-" : "+";
    return sign + addLeadingZeros(Math.abs(offset) / 60, 2);
  }
  return formatTimezone(offset, delimiter);
}

function formatTimezone(offset, delimiter = "") {
  const sign = offset > 0 ? "-" : "+";
  const absOffset = Math.abs(offset);
  const hours = addLeadingZeros(Math.trunc(absOffset / 60), 2);
  const minutes = addLeadingZeros(absOffset % 60, 2);
  return sign + hours + delimiter + minutes;
}

const dateLongFormatter = (pattern, formatLong) => {
  switch (pattern) {
    case "P":
      return formatLong.date({ width: "short" });
    case "PP":
      return formatLong.date({ width: "medium" });
    case "PPP":
      return formatLong.date({ width: "long" });
    case "PPPP":
    default:
      return formatLong.date({ width: "full" });
  }
};

const timeLongFormatter = (pattern, formatLong) => {
  switch (pattern) {
    case "p":
      return formatLong.time({ width: "short" });
    case "pp":
      return formatLong.time({ width: "medium" });
    case "ppp":
      return formatLong.time({ width: "long" });
    case "pppp":
    default:
      return formatLong.time({ width: "full" });
  }
};

const dateTimeLongFormatter = (pattern, formatLong) => {
  const matchResult = pattern.match(/(P+)(p+)?/) || [];
  const datePattern = matchResult[1];
  const timePattern = matchResult[2];

  if (!timePattern) {
    return dateLongFormatter(pattern, formatLong);
  }

  let dateTimeFormat;

  switch (datePattern) {
    case "P":
      dateTimeFormat = formatLong.dateTime({ width: "short" });
      break;
    case "PP":
      dateTimeFormat = formatLong.dateTime({ width: "medium" });
      break;
    case "PPP":
      dateTimeFormat = formatLong.dateTime({ width: "long" });
      break;
    case "PPPP":
    default:
      dateTimeFormat = formatLong.dateTime({ width: "full" });
      break;
  }

  return dateTimeFormat
    .replace("{{date}}", dateLongFormatter(datePattern, formatLong))
    .replace("{{time}}", timeLongFormatter(timePattern, formatLong));
};

const longFormatters = {
  p: timeLongFormatter,
  P: dateTimeLongFormatter,
};

const dayOfYearTokenRE = /^D+$/;
const weekYearTokenRE = /^Y+$/;

const throwTokens = ["D", "DD", "YY", "YYYY"];

function isProtectedDayOfYearToken(token) {
  return dayOfYearTokenRE.test(token);
}

function isProtectedWeekYearToken(token) {
  return weekYearTokenRE.test(token);
}

function warnOrThrowProtectedError(token, format, input) {
  const _message = message(token, format, input);
  console.warn(_message);
  if (throwTokens.includes(token)) throw new RangeError(_message);
}

function message(token, format, input) {
  const subject = token[0] === "Y" ? "years" : "days of the month";
  return `Use \`${token.toLowerCase()}\` instead of \`${token}\` (in \`${format}\`) for formatting ${subject} to the input \`${input}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`;
}

// This RegExp consists of three parts separated by `|`:
// - [yYQqMLwIdDecihHKkms]o matches any available ordinal number token
//   (one of the certain letters followed by `o`)
// - (\w)\1* matches any sequences of the same letter
// - '' matches two quote characters in a row
// - '(''|[^'])+('|$) matches anything surrounded by two quote characters ('),
//   except a single quote symbol, which ends the sequence.
//   Two quote characters do not end the sequence.
//   If there is no matching single quote
//   then the sequence will continue until the end of the string.
// - . matches any single character unmatched by previous parts of the RegExps
const formattingTokensRegExp =
  /[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g;

// This RegExp catches symbols escaped by quotes, and also
// sequences of symbols P, p, and the combinations like `PPPPPPPppppp`
const longFormattingTokensRegExp = /P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;

const escapedStringRegExp = /^'([^]*?)'?$/;
const doubleQuoteRegExp = /''/g;
const unescapedLatinCharacterRegExp = /[a-zA-Z]/;

/**
 * The {@link format} function options.
 */

/**
 * @name format
 * @alias formatDate
 * @category Common Helpers
 * @summary Format the date.
 *
 * @description
 * Return the formatted date string in the given format. The result may vary by locale.
 *
 * >  Please note that the `format` tokens differ from Moment.js and other libraries.
 * > See: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 *
 * The characters wrapped between two single quotes characters (') are escaped.
 * Two single quotes in a row, whether inside or outside a quoted sequence, represent a 'real' single quote.
 * (see the last example)
 *
 * Format of the string is based on Unicode Technical Standard #35:
 * https://www.unicode.org/reports/tr35/tr35-dates.html#Date_Field_Symbol_Table
 * with a few additions (see note 7 below the table).
 *
 * Accepted patterns:
 * | Unit                            | Pattern | Result examples                   | Notes |
 * |---------------------------------|---------|-----------------------------------|-------|
 * | Era                             | G..GGG  | AD, BC                            |       |
 * |                                 | GGGG    | Anno Domini, Before Christ        | 2     |
 * |                                 | GGGGG   | A, B                              |       |
 * | Calendar year                   | y       | 44, 1, 1900, 2017                 | 5     |
 * |                                 | yo      | 44th, 1st, 0th, 17th              | 5,7   |
 * |                                 | yy      | 44, 01, 00, 17                    | 5     |
 * |                                 | yyy     | 044, 001, 1900, 2017              | 5     |
 * |                                 | yyyy    | 0044, 0001, 1900, 2017            | 5     |
 * |                                 | yyyyy   | ...                               | 3,5   |
 * | Local week-numbering year       | Y       | 44, 1, 1900, 2017                 | 5     |
 * |                                 | Yo      | 44th, 1st, 1900th, 2017th         | 5,7   |
 * |                                 | YY      | 44, 01, 00, 17                    | 5,8   |
 * |                                 | YYY     | 044, 001, 1900, 2017              | 5     |
 * |                                 | YYYY    | 0044, 0001, 1900, 2017            | 5,8   |
 * |                                 | YYYYY   | ...                               | 3,5   |
 * | ISO week-numbering year         | R       | -43, 0, 1, 1900, 2017             | 5,7   |
 * |                                 | RR      | -43, 00, 01, 1900, 2017           | 5,7   |
 * |                                 | RRR     | -043, 000, 001, 1900, 2017        | 5,7   |
 * |                                 | RRRR    | -0043, 0000, 0001, 1900, 2017     | 5,7   |
 * |                                 | RRRRR   | ...                               | 3,5,7 |
 * | Extended year                   | u       | -43, 0, 1, 1900, 2017             | 5     |
 * |                                 | uu      | -43, 01, 1900, 2017               | 5     |
 * |                                 | uuu     | -043, 001, 1900, 2017             | 5     |
 * |                                 | uuuu    | -0043, 0001, 1900, 2017           | 5     |
 * |                                 | uuuuu   | ...                               | 3,5   |
 * | Quarter (formatting)            | Q       | 1, 2, 3, 4                        |       |
 * |                                 | Qo      | 1st, 2nd, 3rd, 4th                | 7     |
 * |                                 | QQ      | 01, 02, 03, 04                    |       |
 * |                                 | QQQ     | Q1, Q2, Q3, Q4                    |       |
 * |                                 | QQQQ    | 1st quarter, 2nd quarter, ...     | 2     |
 * |                                 | QQQQQ   | 1, 2, 3, 4                        | 4     |
 * | Quarter (stand-alone)           | q       | 1, 2, 3, 4                        |       |
 * |                                 | qo      | 1st, 2nd, 3rd, 4th                | 7     |
 * |                                 | qq      | 01, 02, 03, 04                    |       |
 * |                                 | qqq     | Q1, Q2, Q3, Q4                    |       |
 * |                                 | qqqq    | 1st quarter, 2nd quarter, ...     | 2     |
 * |                                 | qqqqq   | 1, 2, 3, 4                        | 4     |
 * | Month (formatting)              | M       | 1, 2, ..., 12                     |       |
 * |                                 | Mo      | 1st, 2nd, ..., 12th               | 7     |
 * |                                 | MM      | 01, 02, ..., 12                   |       |
 * |                                 | MMM     | Jan, Feb, ..., Dec                |       |
 * |                                 | MMMM    | January, February, ..., December  | 2     |
 * |                                 | MMMMM   | J, F, ..., D                      |       |
 * | Month (stand-alone)             | L       | 1, 2, ..., 12                     |       |
 * |                                 | Lo      | 1st, 2nd, ..., 12th               | 7     |
 * |                                 | LL      | 01, 02, ..., 12                   |       |
 * |                                 | LLL     | Jan, Feb, ..., Dec                |       |
 * |                                 | LLLL    | January, February, ..., December  | 2     |
 * |                                 | LLLLL   | J, F, ..., D                      |       |
 * | Local week of year              | w       | 1, 2, ..., 53                     |       |
 * |                                 | wo      | 1st, 2nd, ..., 53th               | 7     |
 * |                                 | ww      | 01, 02, ..., 53                   |       |
 * | ISO week of year                | I       | 1, 2, ..., 53                     | 7     |
 * |                                 | Io      | 1st, 2nd, ..., 53th               | 7     |
 * |                                 | II      | 01, 02, ..., 53                   | 7     |
 * | Day of month                    | d       | 1, 2, ..., 31                     |       |
 * |                                 | do      | 1st, 2nd, ..., 31st               | 7     |
 * |                                 | dd      | 01, 02, ..., 31                   |       |
 * | Day of year                     | D       | 1, 2, ..., 365, 366               | 9     |
 * |                                 | Do      | 1st, 2nd, ..., 365th, 366th       | 7     |
 * |                                 | DD      | 01, 02, ..., 365, 366             | 9     |
 * |                                 | DDD     | 001, 002, ..., 365, 366           |       |
 * |                                 | DDDD    | ...                               | 3     |
 * | Day of week (formatting)        | E..EEE  | Mon, Tue, Wed, ..., Sun           |       |
 * |                                 | EEEE    | Monday, Tuesday, ..., Sunday      | 2     |
 * |                                 | EEEEE   | M, T, W, T, F, S, S               |       |
 * |                                 | EEEEEE  | Mo, Tu, We, Th, Fr, Sa, Su        |       |
 * | ISO day of week (formatting)    | i       | 1, 2, 3, ..., 7                   | 7     |
 * |                                 | io      | 1st, 2nd, ..., 7th                | 7     |
 * |                                 | ii      | 01, 02, ..., 07                   | 7     |
 * |                                 | iii     | Mon, Tue, Wed, ..., Sun           | 7     |
 * |                                 | iiii    | Monday, Tuesday, ..., Sunday      | 2,7   |
 * |                                 | iiiii   | M, T, W, T, F, S, S               | 7     |
 * |                                 | iiiiii  | Mo, Tu, We, Th, Fr, Sa, Su        | 7     |
 * | Local day of week (formatting)  | e       | 2, 3, 4, ..., 1                   |       |
 * |                                 | eo      | 2nd, 3rd, ..., 1st                | 7     |
 * |                                 | ee      | 02, 03, ..., 01                   |       |
 * |                                 | eee     | Mon, Tue, Wed, ..., Sun           |       |
 * |                                 | eeee    | Monday, Tuesday, ..., Sunday      | 2     |
 * |                                 | eeeee   | M, T, W, T, F, S, S               |       |
 * |                                 | eeeeee  | Mo, Tu, We, Th, Fr, Sa, Su        |       |
 * | Local day of week (stand-alone) | c       | 2, 3, 4, ..., 1                   |       |
 * |                                 | co      | 2nd, 3rd, ..., 1st                | 7     |
 * |                                 | cc      | 02, 03, ..., 01                   |       |
 * |                                 | ccc     | Mon, Tue, Wed, ..., Sun           |       |
 * |                                 | cccc    | Monday, Tuesday, ..., Sunday      | 2     |
 * |                                 | ccccc   | M, T, W, T, F, S, S               |       |
 * |                                 | cccccc  | Mo, Tu, We, Th, Fr, Sa, Su        |       |
 * | AM, PM                          | a..aa   | AM, PM                            |       |
 * |                                 | aaa     | am, pm                            |       |
 * |                                 | aaaa    | a.m., p.m.                        | 2     |
 * |                                 | aaaaa   | a, p                              |       |
 * | AM, PM, noon, midnight          | b..bb   | AM, PM, noon, midnight            |       |
 * |                                 | bbb     | am, pm, noon, midnight            |       |
 * |                                 | bbbb    | a.m., p.m., noon, midnight        | 2     |
 * |                                 | bbbbb   | a, p, n, mi                       |       |
 * | Flexible day period             | B..BBB  | at night, in the morning, ...     |       |
 * |                                 | BBBB    | at night, in the morning, ...     | 2     |
 * |                                 | BBBBB   | at night, in the morning, ...     |       |
 * | Hour [1-12]                     | h       | 1, 2, ..., 11, 12                 |       |
 * |                                 | ho      | 1st, 2nd, ..., 11th, 12th         | 7     |
 * |                                 | hh      | 01, 02, ..., 11, 12               |       |
 * | Hour [0-23]                     | H       | 0, 1, 2, ..., 23                  |       |
 * |                                 | Ho      | 0th, 1st, 2nd, ..., 23rd          | 7     |
 * |                                 | HH      | 00, 01, 02, ..., 23               |       |
 * | Hour [0-11]                     | K       | 1, 2, ..., 11, 0                  |       |
 * |                                 | Ko      | 1st, 2nd, ..., 11th, 0th          | 7     |
 * |                                 | KK      | 01, 02, ..., 11, 00               |       |
 * | Hour [1-24]                     | k       | 24, 1, 2, ..., 23                 |       |
 * |                                 | ko      | 24th, 1st, 2nd, ..., 23rd         | 7     |
 * |                                 | kk      | 24, 01, 02, ..., 23               |       |
 * | Minute                          | m       | 0, 1, ..., 59                     |       |
 * |                                 | mo      | 0th, 1st, ..., 59th               | 7     |
 * |                                 | mm      | 00, 01, ..., 59                   |       |
 * | Second                          | s       | 0, 1, ..., 59                     |       |
 * |                                 | so      | 0th, 1st, ..., 59th               | 7     |
 * |                                 | ss      | 00, 01, ..., 59                   |       |
 * | Fraction of second              | S       | 0, 1, ..., 9                      |       |
 * |                                 | SS      | 00, 01, ..., 99                   |       |
 * |                                 | SSS     | 000, 001, ..., 999                |       |
 * |                                 | SSSS    | ...                               | 3     |
 * | Timezone (ISO-8601 w/ Z)        | X       | -08, +0530, Z                     |       |
 * |                                 | XX      | -0800, +0530, Z                   |       |
 * |                                 | XXX     | -08:00, +05:30, Z                 |       |
 * |                                 | XXXX    | -0800, +0530, Z, +123456          | 2     |
 * |                                 | XXXXX   | -08:00, +05:30, Z, +12:34:56      |       |
 * | Timezone (ISO-8601 w/o Z)       | x       | -08, +0530, +00                   |       |
 * |                                 | xx      | -0800, +0530, +0000               |       |
 * |                                 | xxx     | -08:00, +05:30, +00:00            | 2     |
 * |                                 | xxxx    | -0800, +0530, +0000, +123456      |       |
 * |                                 | xxxxx   | -08:00, +05:30, +00:00, +12:34:56 |       |
 * | Timezone (GMT)                  | O...OOO | GMT-8, GMT+5:30, GMT+0            |       |
 * |                                 | OOOO    | GMT-08:00, GMT+05:30, GMT+00:00   | 2     |
 * | Timezone (specific non-locat.)  | z...zzz | GMT-8, GMT+5:30, GMT+0            | 6     |
 * |                                 | zzzz    | GMT-08:00, GMT+05:30, GMT+00:00   | 2,6   |
 * | Seconds timestamp               | t       | 512969520                         | 7     |
 * |                                 | tt      | ...                               | 3,7   |
 * | Milliseconds timestamp          | T       | 512969520900                      | 7     |
 * |                                 | TT      | ...                               | 3,7   |
 * | Long localized date             | P       | 04/29/1453                        | 7     |
 * |                                 | PP      | Apr 29, 1453                      | 7     |
 * |                                 | PPP     | April 29th, 1453                  | 7     |
 * |                                 | PPPP    | Friday, April 29th, 1453          | 2,7   |
 * | Long localized time             | p       | 12:00 AM                          | 7     |
 * |                                 | pp      | 12:00:00 AM                       | 7     |
 * |                                 | ppp     | 12:00:00 AM GMT+2                 | 7     |
 * |                                 | pppp    | 12:00:00 AM GMT+02:00             | 2,7   |
 * | Combination of date and time    | Pp      | 04/29/1453, 12:00 AM              | 7     |
 * |                                 | PPpp    | Apr 29, 1453, 12:00:00 AM         | 7     |
 * |                                 | PPPppp  | April 29th, 1453 at ...           | 7     |
 * |                                 | PPPPpppp| Friday, April 29th, 1453 at ...   | 2,7   |
 * Notes:
 * 1. "Formatting" units (e.g. formatting quarter) in the default en-US locale
 *    are the same as "stand-alone" units, but are different in some languages.
 *    "Formatting" units are declined according to the rules of the language
 *    in the context of a date. "Stand-alone" units are always nominative singular:
 *
 *    `format(new Date(2017, 10, 6), 'do LLLL', {locale: cs}) //=> '6. listopad'`
 *
 *    `format(new Date(2017, 10, 6), 'do MMMM', {locale: cs}) //=> '6. listopadu'`
 *
 * 2. Any sequence of the identical letters is a pattern, unless it is escaped by
 *    the single quote characters (see below).
 *    If the sequence is longer than listed in table (e.g. `EEEEEEEEEEE`)
 *    the output will be the same as default pattern for this unit, usually
 *    the longest one (in case of ISO weekdays, `EEEE`). Default patterns for units
 *    are marked with "2" in the last column of the table.
 *
 *    `format(new Date(2017, 10, 6), 'MMM') //=> 'Nov'`
 *
 *    `format(new Date(2017, 10, 6), 'MMMM') //=> 'November'`
 *
 *    `format(new Date(2017, 10, 6), 'MMMMM') //=> 'N'`
 *
 *    `format(new Date(2017, 10, 6), 'MMMMMM') //=> 'November'`
 *
 *    `format(new Date(2017, 10, 6), 'MMMMMMM') //=> 'November'`
 *
 * 3. Some patterns could be unlimited length (such as `yyyyyyyy`).
 *    The output will be padded with zeros to match the length of the pattern.
 *
 *    `format(new Date(2017, 10, 6), 'yyyyyyyy') //=> '00002017'`
 *
 * 4. `QQQQQ` and `qqqqq` could be not strictly numerical in some locales.
 *    These tokens represent the shortest form of the quarter.
 *
 * 5. The main difference between `y` and `u` patterns are B.C. years:
 *
 *    | Year | `y` | `u` |
 *    |------|-----|-----|
 *    | AC 1 |   1 |   1 |
 *    | BC 1 |   1 |   0 |
 *    | BC 2 |   2 |  -1 |
 *
 *    Also `yy` always returns the last two digits of a year,
 *    while `uu` pads single digit years to 2 characters and returns other years unchanged:
 *
 *    | Year | `yy` | `uu` |
 *    |------|------|------|
 *    | 1    |   01 |   01 |
 *    | 14   |   14 |   14 |
 *    | 376  |   76 |  376 |
 *    | 1453 |   53 | 1453 |
 *
 *    The same difference is true for local and ISO week-numbering years (`Y` and `R`),
 *    except local week-numbering years are dependent on `options.weekStartsOn`
 *    and `options.firstWeekContainsDate` (compare [getISOWeekYear](https://date-fns.org/docs/getISOWeekYear)
 *    and [getWeekYear](https://date-fns.org/docs/getWeekYear)).
 *
 * 6. Specific non-location timezones are currently unavailable in `date-fns`,
 *    so right now these tokens fall back to GMT timezones.
 *
 * 7. These patterns are not in the Unicode Technical Standard #35:
 *    - `i`: ISO day of week
 *    - `I`: ISO week of year
 *    - `R`: ISO week-numbering year
 *    - `t`: seconds timestamp
 *    - `T`: milliseconds timestamp
 *    - `o`: ordinal number modifier
 *    - `P`: long localized date
 *    - `p`: long localized time
 *
 * 8. `YY` and `YYYY` tokens represent week-numbering years but they are often confused with years.
 *    You should enable `options.useAdditionalWeekYearTokens` to use them. See: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 *
 * 9. `D` and `DD` tokens represent days of the year but they are often confused with days of the month.
 *    You should enable `options.useAdditionalDayOfYearTokens` to use them. See: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 * @param format - The string of tokens
 * @param options - An object with options
 *
 * @returns The formatted date string
 *
 * @throws `date` must not be Invalid Date
 * @throws `options.locale` must contain `localize` property
 * @throws `options.locale` must contain `formatLong` property
 * @throws use `yyyy` instead of `YYYY` for formatting years using [format provided] to the input [input provided]; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 * @throws use `yy` instead of `YY` for formatting years using [format provided] to the input [input provided]; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 * @throws use `d` instead of `D` for formatting days of the month using [format provided] to the input [input provided]; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 * @throws use `dd` instead of `DD` for formatting days of the month using [format provided] to the input [input provided]; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 * @throws format string contains an unescaped latin alphabet character
 *
 * @example
 * // Represent 11 February 2014 in middle-endian format:
 * const result = format(new Date(2014, 1, 11), 'MM/dd/yyyy')
 * //=> '02/11/2014'
 *
 * @example
 * // Represent 2 July 2014 in Esperanto:
 * import { eoLocale } from 'date-fns/locale/eo'
 * const result = format(new Date(2014, 6, 2), "do 'de' MMMM yyyy", {
 *   locale: eoLocale
 * })
 * //=> '2-a de julio 2014'
 *
 * @example
 * // Escape string by single quote characters:
 * const result = format(new Date(2014, 6, 2, 15), "h 'o''clock'")
 * //=> "3 o'clock"
 */
function format(date, formatStr, options) {
  const defaultOptions = getDefaultOptions();
  const locale = options?.locale ?? defaultOptions.locale ?? enUS;

  const firstWeekContainsDate =
    options?.firstWeekContainsDate ??
    options?.locale?.options?.firstWeekContainsDate ??
    defaultOptions.firstWeekContainsDate ??
    defaultOptions.locale?.options?.firstWeekContainsDate ??
    1;

  const weekStartsOn =
    options?.weekStartsOn ??
    options?.locale?.options?.weekStartsOn ??
    defaultOptions.weekStartsOn ??
    defaultOptions.locale?.options?.weekStartsOn ??
    0;

  const originalDate = toDate(date);

  if (!isValid(originalDate)) {
    throw new RangeError("Invalid time value");
  }

  let parts = formatStr
    .match(longFormattingTokensRegExp)
    .map((substring) => {
      const firstCharacter = substring[0];
      if (firstCharacter === "p" || firstCharacter === "P") {
        const longFormatter = longFormatters[firstCharacter];
        return longFormatter(substring, locale.formatLong);
      }
      return substring;
    })
    .join("")
    .match(formattingTokensRegExp)
    .map((substring) => {
      // Replace two single quote characters with one single quote character
      if (substring === "''") {
        return { isToken: false, value: "'" };
      }

      const firstCharacter = substring[0];
      if (firstCharacter === "'") {
        return { isToken: false, value: cleanEscapedString(substring) };
      }

      if (formatters[firstCharacter]) {
        return { isToken: true, value: substring };
      }

      if (firstCharacter.match(unescapedLatinCharacterRegExp)) {
        throw new RangeError(
          "Format string contains an unescaped latin alphabet character `" +
            firstCharacter +
            "`",
        );
      }

      return { isToken: false, value: substring };
    });

  // invoke localize preprocessor (only for french locales at the moment)
  if (locale.localize.preprocessor) {
    parts = locale.localize.preprocessor(originalDate, parts);
  }

  const formatterOptions = {
    firstWeekContainsDate,
    weekStartsOn,
    locale,
  };

  return parts
    .map((part) => {
      if (!part.isToken) return part.value;

      const token = part.value;

      if (
        (!options?.useAdditionalWeekYearTokens &&
          isProtectedWeekYearToken(token)) ||
        (!options?.useAdditionalDayOfYearTokens &&
          isProtectedDayOfYearToken(token))
      ) {
        warnOrThrowProtectedError(token, formatStr, String(date));
      }

      const formatter = formatters[token[0]];
      return formatter(originalDate, token, locale.localize, formatterOptions);
    })
    .join("");
}

function cleanEscapedString(input) {
  const matched = input.match(escapedStringRegExp);

  if (!matched) {
    return input;
  }

  return matched[1].replace(doubleQuoteRegExp, "'");
}

/**
 * The {@link formatDistance} function options.
 */

/**
 * @name formatDistance
 * @category Common Helpers
 * @summary Return the distance between the given dates in words.
 *
 * @description
 * Return the distance between the given dates in words.
 *
 * | Distance between dates                                            | Result              |
 * |-------------------------------------------------------------------|---------------------|
 * | 0 ... 30 secs                                                     | less than a minute  |
 * | 30 secs ... 1 min 30 secs                                         | 1 minute            |
 * | 1 min 30 secs ... 44 mins 30 secs                                 | [2..44] minutes     |
 * | 44 mins ... 30 secs ... 89 mins 30 secs                           | about 1 hour        |
 * | 89 mins 30 secs ... 23 hrs 59 mins 30 secs                        | about [2..24] hours |
 * | 23 hrs 59 mins 30 secs ... 41 hrs 59 mins 30 secs                 | 1 day               |
 * | 41 hrs 59 mins 30 secs ... 29 days 23 hrs 59 mins 30 secs         | [2..30] days        |
 * | 29 days 23 hrs 59 mins 30 secs ... 44 days 23 hrs 59 mins 30 secs | about 1 month       |
 * | 44 days 23 hrs 59 mins 30 secs ... 59 days 23 hrs 59 mins 30 secs | about 2 months      |
 * | 59 days 23 hrs 59 mins 30 secs ... 1 yr                           | [2..12] months      |
 * | 1 yr ... 1 yr 3 months                                            | about 1 year        |
 * | 1 yr 3 months ... 1 yr 9 month s                                  | over 1 year         |
 * | 1 yr 9 months ... 2 yrs                                           | almost 2 years      |
 * | N yrs ... N yrs 3 months                                          | about N years       |
 * | N yrs 3 months ... N yrs 9 months                                 | over N years        |
 * | N yrs 9 months ... N+1 yrs                                        | almost N+1 years    |
 *
 * With `options.includeSeconds == true`:
 * | Distance between dates | Result               |
 * |------------------------|----------------------|
 * | 0 secs ... 5 secs      | less than 5 seconds  |
 * | 5 secs ... 10 secs     | less than 10 seconds |
 * | 10 secs ... 20 secs    | less than 20 seconds |
 * | 20 secs ... 40 secs    | half a minute        |
 * | 40 secs ... 60 secs    | less than a minute   |
 * | 60 secs ... 90 secs    | 1 minute             |
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date
 * @param baseDate - The date to compare with
 * @param options - An object with options
 *
 * @returns The distance in words
 *
 * @throws `date` must not be Invalid Date
 * @throws `baseDate` must not be Invalid Date
 * @throws `options.locale` must contain `formatDistance` property
 *
 * @example
 * // What is the distance between 2 July 2014 and 1 January 2015?
 * const result = formatDistance(new Date(2014, 6, 2), new Date(2015, 0, 1))
 * //=> '6 months'
 *
 * @example
 * // What is the distance between 1 January 2015 00:00:15
 * // and 1 January 2015 00:00:00, including seconds?
 * const result = formatDistance(
 *   new Date(2015, 0, 1, 0, 0, 15),
 *   new Date(2015, 0, 1, 0, 0, 0),
 *   { includeSeconds: true }
 * )
 * //=> 'less than 20 seconds'
 *
 * @example
 * // What is the distance from 1 January 2016
 * // to 1 January 2015, with a suffix?
 * const result = formatDistance(new Date(2015, 0, 1), new Date(2016, 0, 1), {
 *   addSuffix: true
 * })
 * //=> 'about 1 year ago'
 *
 * @example
 * // What is the distance between 1 August 2016 and 1 January 2015 in Esperanto?
 * import { eoLocale } from 'date-fns/locale/eo'
 * const result = formatDistance(new Date(2016, 7, 1), new Date(2015, 0, 1), {
 *   locale: eoLocale
 * })
 * //=> 'pli ol 1 jaro'
 */

function formatDistance$1(date, baseDate, options) {
  const defaultOptions = getDefaultOptions();
  const locale = options?.locale ?? defaultOptions.locale ?? enUS;
  const minutesInAlmostTwoDays = 2520;

  const comparison = compareAsc(date, baseDate);

  if (isNaN(comparison)) {
    throw new RangeError("Invalid time value");
  }

  const localizeOptions = Object.assign({}, options, {
    addSuffix: options?.addSuffix,
    comparison: comparison,
  });

  let dateLeft;
  let dateRight;
  if (comparison > 0) {
    dateLeft = toDate(baseDate);
    dateRight = toDate(date);
  } else {
    dateLeft = toDate(date);
    dateRight = toDate(baseDate);
  }

  const seconds = differenceInSeconds(dateRight, dateLeft);
  const offsetInSeconds =
    (getTimezoneOffsetInMilliseconds(dateRight) -
      getTimezoneOffsetInMilliseconds(dateLeft)) /
    1000;
  const minutes = Math.round((seconds - offsetInSeconds) / 60);
  let months;

  // 0 up to 2 mins
  if (minutes < 2) {
    if (options?.includeSeconds) {
      if (seconds < 5) {
        return locale.formatDistance("lessThanXSeconds", 5, localizeOptions);
      } else if (seconds < 10) {
        return locale.formatDistance("lessThanXSeconds", 10, localizeOptions);
      } else if (seconds < 20) {
        return locale.formatDistance("lessThanXSeconds", 20, localizeOptions);
      } else if (seconds < 40) {
        return locale.formatDistance("halfAMinute", 0, localizeOptions);
      } else if (seconds < 60) {
        return locale.formatDistance("lessThanXMinutes", 1, localizeOptions);
      } else {
        return locale.formatDistance("xMinutes", 1, localizeOptions);
      }
    } else {
      if (minutes === 0) {
        return locale.formatDistance("lessThanXMinutes", 1, localizeOptions);
      } else {
        return locale.formatDistance("xMinutes", minutes, localizeOptions);
      }
    }

    // 2 mins up to 0.75 hrs
  } else if (minutes < 45) {
    return locale.formatDistance("xMinutes", minutes, localizeOptions);

    // 0.75 hrs up to 1.5 hrs
  } else if (minutes < 90) {
    return locale.formatDistance("aboutXHours", 1, localizeOptions);

    // 1.5 hrs up to 24 hrs
  } else if (minutes < minutesInDay) {
    const hours = Math.round(minutes / 60);
    return locale.formatDistance("aboutXHours", hours, localizeOptions);

    // 1 day up to 1.75 days
  } else if (minutes < minutesInAlmostTwoDays) {
    return locale.formatDistance("xDays", 1, localizeOptions);

    // 1.75 days up to 30 days
  } else if (minutes < minutesInMonth) {
    const days = Math.round(minutes / minutesInDay);
    return locale.formatDistance("xDays", days, localizeOptions);

    // 1 month up to 2 months
  } else if (minutes < minutesInMonth * 2) {
    months = Math.round(minutes / minutesInMonth);
    return locale.formatDistance("aboutXMonths", months, localizeOptions);
  }

  months = differenceInMonths(dateRight, dateLeft);

  // 2 months up to 12 months
  if (months < 12) {
    const nearestMonth = Math.round(minutes / minutesInMonth);
    return locale.formatDistance("xMonths", nearestMonth, localizeOptions);

    // 1 year up to max Date
  } else {
    const monthsSinceStartOfYear = months % 12;
    const years = Math.trunc(months / 12);

    // N years up to 1 years 3 months
    if (monthsSinceStartOfYear < 3) {
      return locale.formatDistance("aboutXYears", years, localizeOptions);

      // N years 3 months up to N years 9 months
    } else if (monthsSinceStartOfYear < 9) {
      return locale.formatDistance("overXYears", years, localizeOptions);

      // N years 9 months up to N year 12 months
    } else {
      return locale.formatDistance("almostXYears", years + 1, localizeOptions);
    }
  }
}

/**
 * The {@link formatDistanceToNow} function options.
 */

/**
 * @name formatDistanceToNow
 * @category Common Helpers
 * @summary Return the distance between the given date and now in words.
 * @pure false
 *
 * @description
 * Return the distance between the given date and now in words.
 *
 * | Distance to now                                                   | Result              |
 * |-------------------------------------------------------------------|---------------------|
 * | 0 ... 30 secs                                                     | less than a minute  |
 * | 30 secs ... 1 min 30 secs                                         | 1 minute            |
 * | 1 min 30 secs ... 44 mins 30 secs                                 | [2..44] minutes     |
 * | 44 mins ... 30 secs ... 89 mins 30 secs                           | about 1 hour        |
 * | 89 mins 30 secs ... 23 hrs 59 mins 30 secs                        | about [2..24] hours |
 * | 23 hrs 59 mins 30 secs ... 41 hrs 59 mins 30 secs                 | 1 day               |
 * | 41 hrs 59 mins 30 secs ... 29 days 23 hrs 59 mins 30 secs         | [2..30] days        |
 * | 29 days 23 hrs 59 mins 30 secs ... 44 days 23 hrs 59 mins 30 secs | about 1 month       |
 * | 44 days 23 hrs 59 mins 30 secs ... 59 days 23 hrs 59 mins 30 secs | about 2 months      |
 * | 59 days 23 hrs 59 mins 30 secs ... 1 yr                           | [2..12] months      |
 * | 1 yr ... 1 yr 3 months                                            | about 1 year        |
 * | 1 yr 3 months ... 1 yr 9 month s                                  | over 1 year         |
 * | 1 yr 9 months ... 2 yrs                                           | almost 2 years      |
 * | N yrs ... N yrs 3 months                                          | about N years       |
 * | N yrs 3 months ... N yrs 9 months                                 | over N years        |
 * | N yrs 9 months ... N+1 yrs                                        | almost N+1 years    |
 *
 * With `options.includeSeconds == true`:
 * | Distance to now     | Result               |
 * |---------------------|----------------------|
 * | 0 secs ... 5 secs   | less than 5 seconds  |
 * | 5 secs ... 10 secs  | less than 10 seconds |
 * | 10 secs ... 20 secs | less than 20 seconds |
 * | 20 secs ... 40 secs | half a minute        |
 * | 40 secs ... 60 secs | less than a minute   |
 * | 60 secs ... 90 secs | 1 minute             |
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 * @param options - The object with options
 *
 * @returns The distance in words
 *
 * @throws `date` must not be Invalid Date
 * @throws `options.locale` must contain `formatDistance` property
 *
 * @example
 * // If today is 1 January 2015, what is the distance to 2 July 2014?
 * const result = formatDistanceToNow(
 *   new Date(2014, 6, 2)
 * )
 * //=> '6 months'
 *
 * @example
 * // If now is 1 January 2015 00:00:00,
 * // what is the distance to 1 January 2015 00:00:15, including seconds?
 * const result = formatDistanceToNow(
 *   new Date(2015, 0, 1, 0, 0, 15),
 *   {includeSeconds: true}
 * )
 * //=> 'less than 20 seconds'
 *
 * @example
 * // If today is 1 January 2015,
 * // what is the distance to 1 January 2016, with a suffix?
 * const result = formatDistanceToNow(
 *   new Date(2016, 0, 1),
 *   {addSuffix: true}
 * )
 * //=> 'in about 1 year'
 *
 * @example
 * // If today is 1 January 2015,
 * // what is the distance to 1 August 2016 in Esperanto?
 * const eoLocale = require('date-fns/locale/eo')
 * const result = formatDistanceToNow(
 *   new Date(2016, 7, 1),
 *   {locale: eoLocale}
 * )
 * //=> 'pli ol 1 jaro'
 */
function formatDistanceToNow(date, options) {
  return formatDistance$1(date, constructNow(date), options);
}

/**
 * The {@link isSameWeek} function options.
 */

/**
 * @name isSameWeek
 * @category Week Helpers
 * @summary Are the given dates in the same week (and month and year)?
 *
 * @description
 * Are the given dates in the same week (and month and year)?
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The first date to check
 * @param dateRight - The second date to check
 * @param options - An object with options
 *
 * @returns The dates are in the same week (and month and year)
 *
 * @example
 * // Are 31 August 2014 and 4 September 2014 in the same week?
 * const result = isSameWeek(new Date(2014, 7, 31), new Date(2014, 8, 4))
 * //=> true
 *
 * @example
 * // If week starts with Monday,
 * // are 31 August 2014 and 4 September 2014 in the same week?
 * const result = isSameWeek(new Date(2014, 7, 31), new Date(2014, 8, 4), {
 *   weekStartsOn: 1
 * })
 * //=> false
 *
 * @example
 * // Are 1 January 2014 and 1 January 2015 in the same week?
 * const result = isSameWeek(new Date(2014, 0, 1), new Date(2015, 0, 1))
 * //=> false
 */
function isSameWeek(dateLeft, dateRight, options) {
  const dateLeftStartOfWeek = startOfWeek(dateLeft, options);
  const dateRightStartOfWeek = startOfWeek(dateRight, options);

  return +dateLeftStartOfWeek === +dateRightStartOfWeek;
}

/**
 * @name isToday
 * @category Day Helpers
 * @summary Is the given date today?
 * @pure false
 *
 * @description
 * Is the given date today?
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date to check
 *
 * @returns The date is today
 *
 * @example
 * // If today is 6 October 2014, is 6 October 14:00:00 today?
 * const result = isToday(new Date(2014, 9, 6, 14, 0))
 * //=> true
 */
function isToday(date) {
  return isSameDay(date, constructNow(date));
}

/**
 * @name subDays
 * @category Day Helpers
 * @summary Subtract the specified number of days from the given date.
 *
 * @description
 * Subtract the specified number of days from the given date.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date to be changed
 * @param amount - The amount of days to be subtracted.
 *
 * @returns The new date with the days subtracted
 *
 * @example
 * // Subtract 10 days from 1 September 2014:
 * const result = subDays(new Date(2014, 8, 1), 10)
 * //=> Fri Aug 22 2014 00:00:00
 */
function subDays(date, amount) {
  return addDays(date, -1);
}

/**
 * @name isYesterday
 * @category Day Helpers
 * @summary Is the given date yesterday?
 * @pure false
 *
 * @description
 * Is the given date yesterday?
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date to check
 *
 * @returns The date is yesterday
 *
 * @example
 * // If today is 6 October 2014, is 5 October 14:00:00 yesterday?
 * const result = isYesterday(new Date(2014, 9, 5, 14, 0))
 * //=> true
 */
function isYesterday(date) {
  return isSameDay(date, subDays(constructNow(date)));
}

const formatDistanceLocale = {
  lessThanXSeconds: {
    one: "meno di un secondo",
    other: "meno di {{count}} secondi",
  },

  xSeconds: {
    one: "un secondo",
    other: "{{count}} secondi",
  },

  halfAMinute: "alcuni secondi",

  lessThanXMinutes: {
    one: "meno di un minuto",
    other: "meno di {{count}} minuti",
  },

  xMinutes: {
    one: "un minuto",
    other: "{{count}} minuti",
  },

  aboutXHours: {
    one: "circa un'ora",
    other: "circa {{count}} ore",
  },

  xHours: {
    one: "un'ora",
    other: "{{count}} ore",
  },

  xDays: {
    one: "un giorno",
    other: "{{count}} giorni",
  },

  aboutXWeeks: {
    one: "circa una settimana",
    other: "circa {{count}} settimane",
  },

  xWeeks: {
    one: "una settimana",
    other: "{{count}} settimane",
  },

  aboutXMonths: {
    one: "circa un mese",
    other: "circa {{count}} mesi",
  },

  xMonths: {
    one: "un mese",
    other: "{{count}} mesi",
  },

  aboutXYears: {
    one: "circa un anno",
    other: "circa {{count}} anni",
  },

  xYears: {
    one: "un anno",
    other: "{{count}} anni",
  },

  overXYears: {
    one: "pi di un anno",
    other: "pi di {{count}} anni",
  },

  almostXYears: {
    one: "quasi un anno",
    other: "quasi {{count}} anni",
  },
};

const formatDistance = (token, count, options) => {
  let result;

  const tokenValue = formatDistanceLocale[token];
  if (typeof tokenValue === "string") {
    result = tokenValue;
  } else if (count === 1) {
    result = tokenValue.one;
  } else {
    result = tokenValue.other.replace("{{count}}", count.toString());
  }

  if (options?.addSuffix) {
    if (options.comparison && options.comparison > 0) {
      return "tra " + result;
    } else {
      return result + " fa";
    }
  }

  return result;
};

const dateFormats = {
  full: "EEEE d MMMM y",
  long: "d MMMM y",
  medium: "d MMM y",
  short: "dd/MM/y",
};

const timeFormats = {
  full: "HH:mm:ss zzzz",
  long: "HH:mm:ss z",
  medium: "HH:mm:ss",
  short: "HH:mm",
};

const dateTimeFormats = {
  full: "{{date}} {{time}}",
  long: "{{date}} {{time}}",
  medium: "{{date}} {{time}}",
  short: "{{date}} {{time}}",
};

const formatLong = {
  date: buildFormatLongFn({
    formats: dateFormats,
    defaultWidth: "full",
  }),

  time: buildFormatLongFn({
    formats: timeFormats,
    defaultWidth: "full",
  }),

  dateTime: buildFormatLongFn({
    formats: dateTimeFormats,
    defaultWidth: "full",
  }),
};

const weekdays = [
  "domenica",
  "luned",
  "marted",
  "mercoled",
  "gioved",
  "venerd",
  "sabato",
];

function lastWeek(day) {
  switch (day) {
    case 0:
      return "'domenica scorsa alle' p";
    default:
      return "'" + weekdays[day] + " scorso alle' p";
  }
}

function thisWeek(day) {
  return "'" + weekdays[day] + " alle' p";
}

function nextWeek(day) {
  switch (day) {
    case 0:
      return "'domenica prossima alle' p";
    default:
      return "'" + weekdays[day] + " prossimo alle' p";
  }
}

const formatRelativeLocale = {
  lastWeek: (date, baseDate, options) => {
    const day = date.getDay();
    if (isSameWeek(date, baseDate, options)) {
      return thisWeek(day);
    } else {
      return lastWeek(day);
    }
  },
  yesterday: "'ieri alle' p",
  today: "'oggi alle' p",
  tomorrow: "'domani alle' p",
  nextWeek: (date, baseDate, options) => {
    const day = date.getDay();
    if (isSameWeek(date, baseDate, options)) {
      return thisWeek(day);
    } else {
      return nextWeek(day);
    }
  },
  other: "P",
};

const formatRelative = (token, date, baseDate, options) => {
  const format = formatRelativeLocale[token];

  if (typeof format === "function") {
    return format(date, baseDate, options);
  }

  return format;
};

const eraValues = {
  narrow: ["aC", "dC"],
  abbreviated: ["a.C.", "d.C."],
  wide: ["avanti Cristo", "dopo Cristo"],
};

const quarterValues = {
  narrow: ["1", "2", "3", "4"],
  abbreviated: ["T1", "T2", "T3", "T4"],
  wide: ["1 trimestre", "2 trimestre", "3 trimestre", "4 trimestre"],
};

const monthValues = {
  narrow: ["G", "F", "M", "A", "M", "G", "L", "A", "S", "O", "N", "D"],
  abbreviated: [
    "gen",
    "feb",
    "mar",
    "apr",
    "mag",
    "giu",
    "lug",
    "ago",
    "set",
    "ott",
    "nov",
    "dic",
  ],

  wide: [
    "gennaio",
    "febbraio",
    "marzo",
    "aprile",
    "maggio",
    "giugno",
    "luglio",
    "agosto",
    "settembre",
    "ottobre",
    "novembre",
    "dicembre",
  ],
};

const dayValues = {
  narrow: ["D", "L", "M", "M", "G", "V", "S"],
  short: ["dom", "lun", "mar", "mer", "gio", "ven", "sab"],
  abbreviated: ["dom", "lun", "mar", "mer", "gio", "ven", "sab"],
  wide: [
    "domenica",
    "luned",
    "marted",
    "mercoled",
    "gioved",
    "venerd",
    "sabato",
  ],
};

const dayPeriodValues = {
  narrow: {
    am: "m.",
    pm: "p.",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "mattina",
    afternoon: "pomeriggio",
    evening: "sera",
    night: "notte",
  },
  abbreviated: {
    am: "AM",
    pm: "PM",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "mattina",
    afternoon: "pomeriggio",
    evening: "sera",
    night: "notte",
  },
  wide: {
    am: "AM",
    pm: "PM",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "mattina",
    afternoon: "pomeriggio",
    evening: "sera",
    night: "notte",
  },
};

const formattingDayPeriodValues = {
  narrow: {
    am: "m.",
    pm: "p.",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "di mattina",
    afternoon: "del pomeriggio",
    evening: "di sera",
    night: "di notte",
  },
  abbreviated: {
    am: "AM",
    pm: "PM",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "di mattina",
    afternoon: "del pomeriggio",
    evening: "di sera",
    night: "di notte",
  },
  wide: {
    am: "AM",
    pm: "PM",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "di mattina",
    afternoon: "del pomeriggio",
    evening: "di sera",
    night: "di notte",
  },
};

const ordinalNumber = (dirtyNumber, _options) => {
  const number = Number(dirtyNumber);
  return String(number);
};

const localize = {
  ordinalNumber,

  era: buildLocalizeFn({
    values: eraValues,
    defaultWidth: "wide",
  }),

  quarter: buildLocalizeFn({
    values: quarterValues,
    defaultWidth: "wide",
    argumentCallback: (quarter) => quarter - 1,
  }),

  month: buildLocalizeFn({
    values: monthValues,
    defaultWidth: "wide",
  }),

  day: buildLocalizeFn({
    values: dayValues,
    defaultWidth: "wide",
  }),

  dayPeriod: buildLocalizeFn({
    values: dayPeriodValues,
    defaultWidth: "wide",
    formattingValues: formattingDayPeriodValues,
    defaultFormattingWidth: "wide",
  }),
};

const matchOrdinalNumberPattern = /^(\d+)()?/i;
const parseOrdinalNumberPattern = /\d+/i;

const matchEraPatterns = {
  narrow: /^(aC|dC)/i,
  abbreviated: /^(a\.?\s?C\.?|a\.?\s?e\.?\s?v\.?|d\.?\s?C\.?|e\.?\s?v\.?)/i,
  wide: /^(avanti Cristo|avanti Era Volgare|dopo Cristo|Era Volgare)/i,
};
const parseEraPatterns = {
  any: [/^a/i, /^(d|e)/i],
};

const matchQuarterPatterns = {
  narrow: /^[1234]/i,
  abbreviated: /^t[1234]/i,
  wide: /^[1234]()? trimestre/i,
};
const parseQuarterPatterns = {
  any: [/1/i, /2/i, /3/i, /4/i],
};

const matchMonthPatterns = {
  narrow: /^[gfmalsond]/i,
  abbreviated: /^(gen|feb|mar|apr|mag|giu|lug|ago|set|ott|nov|dic)/i,
  wide: /^(gennaio|febbraio|marzo|aprile|maggio|giugno|luglio|agosto|settembre|ottobre|novembre|dicembre)/i,
};
const parseMonthPatterns = {
  narrow: [
    /^g/i,
    /^f/i,
    /^m/i,
    /^a/i,
    /^m/i,
    /^g/i,
    /^l/i,
    /^a/i,
    /^s/i,
    /^o/i,
    /^n/i,
    /^d/i,
  ],

  any: [
    /^ge/i,
    /^f/i,
    /^mar/i,
    /^ap/i,
    /^mag/i,
    /^gi/i,
    /^l/i,
    /^ag/i,
    /^s/i,
    /^o/i,
    /^n/i,
    /^d/i,
  ],
};

const matchDayPatterns = {
  narrow: /^[dlmgvs]/i,
  short: /^(do|lu|ma|me|gi|ve|sa)/i,
  abbreviated: /^(dom|lun|mar|mer|gio|ven|sab)/i,
  wide: /^(domenica|luned[i|]|marted[i|]|mercoled[i|]|gioved[i|]|venerd[i|]|sabato)/i,
};
const parseDayPatterns = {
  narrow: [/^d/i, /^l/i, /^m/i, /^m/i, /^g/i, /^v/i, /^s/i],
  any: [/^d/i, /^l/i, /^ma/i, /^me/i, /^g/i, /^v/i, /^s/i],
};

const matchDayPeriodPatterns = {
  narrow:
    /^(a|m\.|p|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i,
  any: /^([ap]\.?\s?m\.?|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i,
};
const parseDayPeriodPatterns = {
  any: {
    am: /^a/i,
    pm: /^p/i,
    midnight: /^mezza/i,
    noon: /^mezzo/i,
    morning: /mattina/i,
    afternoon: /pomeriggio/i,
    evening: /sera/i,
    night: /notte/i,
  },
};

const match = {
  ordinalNumber: buildMatchPatternFn({
    matchPattern: matchOrdinalNumberPattern,
    parsePattern: parseOrdinalNumberPattern,
    valueCallback: (value) => parseInt(value, 10),
  }),

  era: buildMatchFn({
    matchPatterns: matchEraPatterns,
    defaultMatchWidth: "wide",
    parsePatterns: parseEraPatterns,
    defaultParseWidth: "any",
  }),

  quarter: buildMatchFn({
    matchPatterns: matchQuarterPatterns,
    defaultMatchWidth: "wide",
    parsePatterns: parseQuarterPatterns,
    defaultParseWidth: "any",
    valueCallback: (index) => index + 1,
  }),

  month: buildMatchFn({
    matchPatterns: matchMonthPatterns,
    defaultMatchWidth: "wide",
    parsePatterns: parseMonthPatterns,
    defaultParseWidth: "any",
  }),

  day: buildMatchFn({
    matchPatterns: matchDayPatterns,
    defaultMatchWidth: "wide",
    parsePatterns: parseDayPatterns,
    defaultParseWidth: "any",
  }),

  dayPeriod: buildMatchFn({
    matchPatterns: matchDayPeriodPatterns,
    defaultMatchWidth: "any",
    parsePatterns: parseDayPeriodPatterns,
    defaultParseWidth: "any",
  }),
};

/**
 * @category Locales
 * @summary Italian locale.
 * @language Italian
 * @iso-639-2 ita
 * @author Alberto Restifo [@albertorestifo](https://github.com/albertorestifo)
 * @author Giovanni Polimeni [@giofilo](https://github.com/giofilo)
 * @author Vincenzo Carrese [@vin-car](https://github.com/vin-car)
 */
const it$1 = {
  code: "it",
  formatDistance: formatDistance,
  formatLong: formatLong,
  formatRelative: formatRelative,
  localize: localize,
  match: match,
  options: {
    weekStartsOn: 1 /* Monday */,
    firstWeekContainsDate: 4,
  },
};

const Switch = reactExports.forwardRef(
  ({ className, checked, onCheckedChange, ...props }, ref) => {
    const [isChecked, setIsChecked] = reactExports.useState(checked || false);
    reactExports.useEffect(() => {
      if (checked !== void 0) {
        setIsChecked(checked);
      }
    }, [checked]);
    const handleChange = (event) => {
      const newChecked = event.target.checked;
      setIsChecked(newChecked);
      onCheckedChange?.(newChecked);
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("label", { className: "inline-flex items-center cursor-pointer", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "input",
        {
          type: "checkbox",
          ref,
          checked: isChecked,
          onChange: handleChange,
          className: "sr-only",
          ...props
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: cn(
            "relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
            isChecked ? "bg-primary" : "bg-input",
            className
          ),
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "span",
            {
              className: cn(
                "pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform",
                isChecked ? "translate-x-4" : "translate-x-0.5"
              )
            }
          )
        }
      )
    ] });
  }
);
Switch.displayName = "Switch";

const PulseContributionToast = ({
  contribution,
  duration = 3e3
}) => {
  const [visible, setVisible] = reactExports.useState(false);
  const [currentContribution, setCurrentContribution] = reactExports.useState(null);
  reactExports.useEffect(() => {
    if (contribution?.accepted && contribution?.displayInfo) {
      setCurrentContribution(contribution);
      setVisible(true);
      const timer = setTimeout(() => {
        setVisible(false);
      }, duration);
      return () => clearTimeout(timer);
    }
  }, [contribution, duration]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: visible && currentContribution?.displayInfo && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      className: "fixed z-[9999] pointer-events-none",
      style: {
        top: "calc(env(safe-area-inset-top, 0px) + 60px)",
        left: "50%",
        transform: "translateX(-50%)"
      },
      initial: { opacity: 0, y: -20, scale: 0.9 },
      animate: { opacity: 1, y: 0, scale: 1 },
      exit: { opacity: 0, y: -10, scale: 0.95 },
      transition: {
        type: "spring",
        stiffness: 400,
        damping: 25
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "div",
        {
          className: "relative px-4 py-3 rounded-2xl overflow-hidden",
          style: {
            background: "linear-gradient(135deg, rgba(0, 231, 255, 0.15) 0%, rgba(255, 77, 240, 0.15) 100%)",
            backdropFilter: "blur(20px)",
            WebkitBackdropFilter: "blur(20px)",
            border: "1px solid rgba(0, 231, 255, 0.3)",
            boxShadow: "0 8px 32px rgba(0, 231, 255, 0.2), 0 0 60px rgba(255, 77, 240, 0.1)"
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "absolute inset-0 rounded-2xl pointer-events-none",
                initial: { opacity: 0 },
                animate: { opacity: [0, 0.5, 0] },
                transition: { duration: 1.5, ease: "easeOut" },
                style: {
                  background: "radial-gradient(circle at center, rgba(0, 231, 255, 0.4) 0%, transparent 70%)"
                }
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative flex items-center gap-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "flex items-center justify-center w-10 h-10 rounded-full",
                  style: {
                    background: "linear-gradient(135deg, #00e7ff 0%, #ff4df0 100%)",
                    boxShadow: "0 0 20px rgba(0, 231, 255, 0.5)"
                  },
                  animate: {
                    scale: [1, 1.1, 1],
                    boxShadow: [
                      "0 0 20px rgba(0, 231, 255, 0.5)",
                      "0 0 40px rgba(255, 77, 240, 0.7)",
                      "0 0 20px rgba(0, 231, 255, 0.5)"
                    ]
                  },
                  transition: { duration: 0.8, ease: "easeInOut" },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-5 h-5 text-white", fill: "white" })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.span,
                  {
                    className: "text-lg font-bold font-mono tracking-wider",
                    style: {
                      background: "linear-gradient(90deg, #00e7ff 0%, #ff4df0 100%)",
                      WebkitBackgroundClip: "text",
                      WebkitTextFillColor: "transparent",
                      textShadow: "0 0 20px rgba(0, 231, 255, 0.5)"
                    },
                    initial: { opacity: 0, x: -10 },
                    animate: { opacity: 1, x: 0 },
                    transition: { delay: 0.1 },
                    children: [
                      "+",
                      currentContribution.displayInfo.deltaPercent.toFixed(2),
                      "% PULSE"
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.span,
                  {
                    className: "text-sm text-white/80",
                    initial: { opacity: 0 },
                    animate: { opacity: 1 },
                    transition: { delay: 0.2 },
                    children: [
                      currentContribution.displayInfo.emoji,
                      " ",
                      currentContribution.displayInfo.label
                    ]
                  }
                )
              ] })
            ] }),
            currentContribution.thresholdTriggered && /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "mt-2 pt-2 border-t border-white/10 text-center",
                initial: { opacity: 0, height: 0 },
                animate: { opacity: 1, height: "auto" },
                transition: { delay: 0.3 },
                children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs font-bold text-yellow-400", children: [
                  " SOGLIA ",
                  currentContribution.thresholdTriggered,
                  "% RAGGIUNTA!"
                ] })
              }
            )
          ]
        }
      )
    }
  ) });
};

const PulseContributionListener = () => {
  const [contribution, setContribution] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const handleContribution = (event) => {
      setContribution(event.detail);
    };
    window.addEventListener("pulse:contributed", handleContribution);
    return () => {
      window.removeEventListener("pulse:contributed", handleContribution);
    };
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(PulseContributionToast, { contribution, duration: 3500 });
};

const THRESHOLD_CONFIG = {
  25: { icon: Zap, color: "#ff6b6b", label: "25%" },
  50: { icon: Gift, color: "#ffd93d", label: "50%" },
  75: { icon: Trophy, color: "#6bcb77", label: "75%" },
  100: { icon: Crown, color: "#4d96ff", label: "100% " }
};
const PulseRewardNotification = () => {
  const { user } = useAuth();
  const [showReward, setShowReward] = reactExports.useState(false);
  const [currentReward, setCurrentReward] = reactExports.useState(null);
  reactExports.useEffect(() => {
    if (!user) return;
    const channel = supabase.channel("pulse_rewards").on("postgres_changes", {
      event: "INSERT",
      schema: "public",
      table: "pulse_rewards_log",
      filter: `user_id=eq.${user.id}`
    }, (payload) => {
      const reward = payload.new;
      setCurrentReward({
        threshold: reward.threshold,
        baseReward: reward.base_reward,
        bonusReward: reward.bonus_reward,
        totalReward: reward.total_reward,
        isContributor: reward.is_contributor
      });
      setShowReward(true);
      const config2 = THRESHOLD_CONFIG[reward.threshold];
      ue.success(
        ` PULSE ${config2.label} raggiunto! +${reward.total_reward} M1U${reward.is_contributor ? " (con bonus contributore!)" : ""}`,
        {
          duration: 5e3,
          style: {
            background: `linear-gradient(135deg, ${config2.color}22 0%, #1a1a2e 100%)`,
            border: `2px solid ${config2.color}`,
            color: "white"
          }
        }
      );
    }).subscribe();
    const pulseChannel = supabase.channel("pulse_cycle_reset").on("broadcast", { event: "pulse_cycle_reset" }, (payload) => {
      ue.info(" PULSE Reset! Nuovo ciclo iniziato!", {
        duration: 4e3,
        style: {
          background: "linear-gradient(135deg, #4d96ff22 0%, #1a1a2e 100%)",
          border: "2px solid #4d96ff",
          color: "white"
        }
      });
    }).subscribe();
    return () => {
      supabase.removeChannel(channel);
      supabase.removeChannel(pulseChannel);
    };
  }, [user]);
  reactExports.useEffect(() => {
    if (showReward) {
      const timer = setTimeout(() => setShowReward(false), 5e3);
      return () => clearTimeout(timer);
    }
  }, [showReward]);
  if (!currentReward) return null;
  const config = THRESHOLD_CONFIG[currentReward.threshold];
  const Icon = config.icon;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showReward && /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "fixed inset-0 z-[9999] flex items-center justify-center pointer-events-none",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute inset-0 bg-black/60 backdrop-blur-sm",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            exit: { opacity: 0 }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "relative flex flex-col items-center p-8 rounded-2xl",
            style: {
              background: `linear-gradient(135deg, ${config.color}33 0%, rgba(26, 26, 46, 0.95) 100%)`,
              border: `3px solid ${config.color}`,
              boxShadow: `0 0 60px ${config.color}66, 0 0 120px ${config.color}33`
            },
            initial: { scale: 0.5, y: 50, opacity: 0 },
            animate: {
              scale: 1,
              y: 0,
              opacity: 1,
              transition: { type: "spring", damping: 15, stiffness: 200 }
            },
            exit: { scale: 0.8, y: -50, opacity: 0 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "absolute -top-4 -left-4",
                  animate: { rotate: 360 },
                  transition: { duration: 3, repeat: Infinity, ease: "linear" },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { size: 32, style: { color: config.color } })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "absolute -top-4 -right-4",
                  animate: { rotate: -360 },
                  transition: { duration: 3, repeat: Infinity, ease: "linear" },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { size: 32, style: { color: config.color } })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "mb-4 p-4 rounded-full",
                  style: {
                    background: `${config.color}33`,
                    boxShadow: `0 0 30px ${config.color}66`
                  },
                  animate: {
                    scale: [1, 1.1, 1],
                    boxShadow: [
                      `0 0 30px ${config.color}66`,
                      `0 0 50px ${config.color}88`,
                      `0 0 30px ${config.color}66`
                    ]
                  },
                  transition: { duration: 1.5, repeat: Infinity },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { size: 48, style: { color: config.color } })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.h2,
                {
                  className: "text-2xl font-bold mb-2 text-white text-center",
                  style: { textShadow: `0 0 20px ${config.color}` },
                  children: [
                    "PULSE ",
                    config.label,
                    " Raggiunto!"
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  className: "flex items-center gap-2 text-4xl font-bold mb-4",
                  style: { color: config.color },
                  initial: { scale: 0 },
                  animate: { scale: 1 },
                  transition: { delay: 0.3, type: "spring" },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                      "+",
                      currentReward.totalReward
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-2xl", children: "M1U" })
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-white/80 text-center space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
                  "Ricompensa base: +",
                  currentReward.baseReward,
                  " M1U"
                ] }),
                currentReward.isContributor && currentReward.bonusReward > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.p,
                  {
                    className: "font-semibold",
                    style: { color: config.color },
                    initial: { opacity: 0, y: 10 },
                    animate: { opacity: 1, y: 0 },
                    transition: { delay: 0.5 },
                    children: [
                      " Bonus Contributore: +",
                      currentReward.bonusReward,
                      " M1U"
                    ]
                  }
                )
              ] }),
              currentReward.threshold === 100 && /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.p,
                {
                  className: "mt-4 text-xs text-cyan-400 text-center",
                  initial: { opacity: 0 },
                  animate: { opacity: 1 },
                  transition: { delay: 0.8 },
                  children: " Nuovo ciclo PULSE iniziato!"
                }
              )
            ]
          }
        )
      ]
    }
  ) });
};

function CommandCenterHome() {
  const { user } = useAuth();
  usePrizeData();
  useBuzzPricing(user?.id);
  const { missionStatus} = useMissionStatus();
  const { battleId, isOpen, closeBattle } = useBattleOverlay();
  reactExports.useEffect(() => {
    localStorage.removeItem("mission-progress");
    localStorage.removeItem("purchased-clues");
    localStorage.removeItem("diary-entries");
    localStorage.removeItem("user-credits");
    localStorage.removeItem("mission-data");
    localStorage.removeItem("clue-data");
    localStorage.removeItem("mission-08-06-2025");
    localStorage.removeItem("timeline-08-06");
    localStorage.removeItem("old-mission-data");
  }, []);
  const [progress, setProgress] = useLocalStorage("mission-progress", 0);
  useLocalStorage("user-credits", 1e3);
  const [purchasedClues] = useLocalStorage("purchased-clues", []);
  const [diaryEntries, setDiaryEntries] = useLocalStorage("diary-entries", []);
  const [prizeUnlockStatus, setPrizeUnlockStatus] = reactExports.useState("locked");
  const activeMission = missionStatus ? {
    id: missionStatus.id,
    title: missionStatus.title,
    totalClues: missionStatus.totalClues,
    foundClues: missionStatus.cluesFound,
    timeLimit: "48:00:00",
    startTime: missionStatus.startDate.toISOString(),
    remainingDays: missionStatus.daysRemaining,
    totalDays: missionStatus.totalDays,
    dailyLimit: 50
    //  BUZZ GIORNALIERO MASSIMO 50
  } : {
    id: "M001",
    title: "M1SSION ONE",
    totalClues: 250,
    //  FIX: 250 indizi totali
    foundClues: 0,
    timeLimit: "48:00:00",
    startTime: "2025-11-26T00:00:00.000Z",
    //  FIX: Data corretta
    remainingDays: 30,
    totalDays: 30,
    dailyLimit: 50
  };
  reactExports.useEffect(() => {
    if (missionStatus) {
      const realProgress = missionStatus.progressPercent;
      setProgress(realProgress);
    }
  }, [missionStatus, setProgress]);
  reactExports.useEffect(() => {
    const daysRemaining = activeMission.remainingDays;
    const objectivesPercentage = activeMission.foundClues / activeMission.totalClues * 100;
    const userScore = progress;
    if (daysRemaining <= 3) {
      setPrizeUnlockStatus("unlocked");
    } else {
      const partialVisibility = objectivesPercentage * 0.4 + userScore * 0.05;
      if (partialVisibility < 20) {
        setPrizeUnlockStatus("locked");
      } else if (partialVisibility < 35) {
        setPrizeUnlockStatus("partial");
      } else {
        setPrizeUnlockStatus("near");
      }
    }
  }, [progress, activeMission.foundClues, activeMission.totalClues, activeMission.remainingDays]);
  const addDiaryEntry = (entry) => {
    setDiaryEntries((prev) => [entry, ...prev]);
  };
  const addPersonalNote = (note) => {
    addDiaryEntry({
      type: "note",
      content: note,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    });
    ue.success("Nota aggiunta al diario");
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        className: "mb-6 w-full m1-card",
        "data-onboarding": "prize-vision",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        transition: { duration: 0.5 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          PrizeVision,
          {
            progress,
            status: prizeUnlockStatus
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        className: "mb-6",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        transition: { duration: 0.5, delay: 0.05 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(PulseBar, { variant: "inline" })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(InviteFloatingButton, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { "data-onboarding": "dna-hub", children: /* @__PURE__ */ jsxRuntimeExports.jsx(DNAQuickAction, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        className: "mb-6",
        "data-onboarding": "mission-card",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        transition: { duration: 0.5, delay: 0.1 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          ActiveMissionBox,
          {
            mission: activeMission,
            purchasedClues,
            progress
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "order-2 md:order-1 m1-card",
          "data-onboarding": "battle",
          initial: { opacity: 0, x: -20 },
          animate: { opacity: 1, x: 0 },
          transition: { duration: 0.5, delay: 0.2 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleConsole, {})
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "order-3 md:order-2 m1-card",
          initial: { opacity: 0, x: 20 },
          animate: { opacity: 1, x: 0 },
          transition: { duration: 0.5, delay: 0.2 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            AgentDiary,
            {
              entries: diaryEntries,
              onAddNote: addPersonalNote,
              purchasedClues
            }
          )
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      BattleArenaOverlay,
      {
        battleId,
        open: isOpen,
        onClose: closeBattle
      }
    )
  ] });
}

function useRealTimeNotifications() {
  const [isConnected, setIsConnected] = reactExports.useState(false);
  const { createNotification} = useNotificationManager();
  reactExports.useEffect(() => {
    const channel = supabase.channel("notification-updates").on("broadcast", { event: "new-notification" }, (payload) => {
      if (payload.payload && typeof payload.payload === "object") {
        const { title, description } = payload.payload;
        if (title && description) {
          createNotification(title, description);
          ue.info(title, {
            description,
            duration: 5e3
          });
        }
      }
    }).subscribe((status) => {
      setIsConnected(status === "SUBSCRIBED");
    });
    return () => {
      supabase.removeChannel(channel);
    };
  }, [createNotification]);
  const broadcastNotification = async (title, description) => {
    try {
      const response = await supabase.channel("notification-updates").send({
        type: "broadcast",
        event: "new-notification",
        payload: { title, description }
      });
      if (!response) {
        return false;
      }
      createNotification(title, description);
      return true;
    } catch (error) {
      return false;
    }
  };
  return {
    isConnected,
    broadcastNotification
  };
}

const NotificationItem = ({
  notification,
  onSelect,
  onDelete
}) => {
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const formattedDate = formatDistanceToNow(new Date(notification.date), {
    addSuffix: true,
    locale: it$1
  });
  const fullFormattedDate = new Date(notification.date).toLocaleString("it-IT", {
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit"
  });
  const handleDelete = (e) => {
    e.stopPropagation();
    onDelete();
  };
  const handleCardClick = () => {
    setIsExpanded(!isExpanded);
    if (!notification.read) {
      onSelect();
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      whileHover: { scale: 1.02, boxShadow: "0 15px 50px rgba(0, 229, 255, 0.25)" },
      whileTap: { scale: 0.98 },
      onClick: handleCardClick,
      className: "m1-relief-sm cursor-pointer transition-all duration-300 relative overflow-hidden",
      style: {
        borderRadius: "24px"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
            style: {
              animation: "slideGlowNotif 3s ease-in-out infinite",
              width: "200%",
              left: "-100%"
            }
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
        @keyframes slideGlowNotif {
          0% { transform: translateX(0); }
          50% { transform: translateX(50%); }
          100% { transform: translateX(0); }
        }
      ` }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-start", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: `text-base font-medium font-orbitron ${notification.read ? "text-white/70" : "text-white"}`, children: notification.title }),
              !isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-2 text-sm text-white/60 line-clamp-2", children: notification.description })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 ml-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/40", children: formattedDate }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  animate: { rotate: isExpanded ? 180 : 0 },
                  transition: { duration: 0.3 },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-4 h-4 text-white/60" })
                }
              )
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { height: 0, opacity: 0 },
              animate: { height: "auto", opacity: 1 },
              exit: { height: 0, opacity: 0 },
              transition: { duration: 0.4, ease: "easeInOut" },
              className: "overflow-hidden mt-4",
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-[16px] bg-[#0a0a0a]/50", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-medium text-white/80 mb-2 font-orbitron", children: "Contenuto completo" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm leading-relaxed whitespace-pre-wrap", children: notification.description })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-[16px] bg-[#0a0a0a]/30", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-medium text-white/60 font-orbitron", children: "Data completa" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/80 mt-1", children: fullFormattedDate })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-[16px] bg-[#0a0a0a]/30", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-medium text-white/60 font-orbitron", children: "Stato" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 mt-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `text-sm ${notification.read ? "text-green-400" : "text-yellow-400"}`, children: notification.read ? "Letta" : "Non letta" }),
                      !notification.read && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-yellow-400 rounded-full animate-pulse" })
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between pt-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center space-x-2", children: !notification.read && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "button",
                    {
                      onClick: (e) => {
                        e.stopPropagation();
                        onSelect();
                      },
                      className: "px-4 py-2 bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white rounded-full text-xs hover:shadow-lg transition-all font-orbitron",
                      children: "Segna come letta"
                    }
                  ) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "button",
                    {
                      onClick: handleDelete,
                      className: "p-2 rounded-full hover:bg-white/10 transition-colors",
                      title: "Elimina notifica",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { size: 16, className: "text-red-400 hover:text-red-300" })
                    }
                  )
                ] })
              ] })
            }
          ) })
        ] })
      ]
    }
  );
};

const NotificationDialog = ({ notification, open, onClose }) => {
  if (!notification) return null;
  const formattedDate = formatDistanceToNow(new Date(notification.date), {
    addSuffix: true,
    locale: it$1
  });
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "max-w-md bg-black border border-[#00D1FF]/30 rounded-[24px] shadow-[0_0_20px_rgba(0,209,255,0.2)]", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(DialogHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-lg font-bold text-[#00D1FF]", style: { textShadow: "0 0 5px rgba(0, 209, 255, 0.3)" }, children: notification.title }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/90 text-base leading-relaxed", children: notification.description }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-[#00D1FF]/60 mt-4", children: formattedDate })
    ] })
  ] }) });
};

const SWIPE_THRESHOLD = 64;
const NotificationsBanner = ({
  open,
  notifications,
  unreadCount,
  onClose,
  onMarkAllAsRead,
  onDeleteNotification
}) => {
  const bannerRef = reactExports.useRef(null);
  const dragging = reactExports.useRef(false);
  const initialY = reactExports.useRef(null);
  const [selectedNotification, setSelectedNotification] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const banner = bannerRef.current;
    function handleTouchStart(e) {
      initialY.current = e.touches[0].clientY;
      dragging.current = true;
    }
    function handleTouchMove(e) {
      if (!dragging.current || initialY.current == null) return;
      const dist = initialY.current - e.touches[0].clientY;
      if (dist > SWIPE_THRESHOLD) {
        onClose();
        dragging.current = false;
        initialY.current = null;
      }
    }
    function handleTouchEnd() {
      dragging.current = false;
      initialY.current = null;
    }
    function handleMouseDown(e) {
      initialY.current = e.clientY;
      dragging.current = true;
    }
    function handleMouseMove(e) {
      if (!dragging.current || initialY.current == null) return;
      const dist = initialY.current - e.clientY;
      if (dist > SWIPE_THRESHOLD) {
        onClose();
        dragging.current = false;
        initialY.current = null;
      }
    }
    function handleMouseUp() {
      dragging.current = false;
      initialY.current = null;
    }
    if (banner && open) {
      banner.addEventListener("touchstart", handleTouchStart, { passive: true });
      banner.addEventListener("touchmove", handleTouchMove, { passive: true });
      banner.addEventListener("touchend", handleTouchEnd);
      banner.addEventListener("mousedown", handleMouseDown);
      window.addEventListener("mousemove", handleMouseMove);
      window.addEventListener("mouseup", handleMouseUp);
    }
    return () => {
      if (banner) {
        banner.removeEventListener("touchstart", handleTouchStart);
        banner.removeEventListener("touchmove", handleTouchMove);
        banner.removeEventListener("touchend", handleTouchEnd);
        banner.removeEventListener("mousedown", handleMouseDown);
      }
      window.removeEventListener("mousemove", handleMouseMove);
      window.removeEventListener("mouseup", handleMouseUp);
    };
  }, [open, onClose]);
  const handleSelectNotification = (notification) => {
    setSelectedNotification(notification);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      ref: bannerRef,
      className: `fixed left-0 right-0 z-[9999] flex justify-center transition-all duration-500 cursor-grab select-none ${open ? "translate-y-0 opacity-100" : "-translate-y-32 opacity-0 pointer-events-none"}`,
      style: {
        top: "env(safe-area-inset-top, 0px)",
        transitionProperty: "transform, opacity"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative w-full max-w-lg mx-auto bg-black/95 backdrop-blur-xl border border-m1ssion-blue rounded-b-2xl shadow-2xl mt-2 px-4 py-4 animate-fade-in", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center mb-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5 text-m1ssion-blue mr-2" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold text-lg flex-1", children: "Notifiche" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                className: "text-m1ssion-blue hover:text-m1ssion-pink rounded-full p-1 ml-2 border border-m1ssion-blue hover:bg-m1ssion-blue/20 transition-colors",
                onClick: onClose,
                "aria-label": "Chiudi",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-5 h-5" })
              }
            )
          ] }),
          notifications.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-4 text-muted-foreground", children: "Non hai notifiche." }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-h-60 overflow-y-auto space-y-2 pr-1 custom-scrollbar", children: notifications.map((notification) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            NotificationItem,
            {
              notification,
              onSelect: () => handleSelectNotification(notification),
              onDelete: () => onDeleteNotification(notification.id)
            },
            notification.id
          )) }),
          notifications.length > 0 && unreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mt-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: onMarkAllAsRead,
              className: "text-xs px-3 py-1 rounded-lg border border-m1ssion-blue hover:bg-m1ssion-blue/10 transition active:scale-95",
              children: "Segna tutte come lette"
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 text-xs text-muted-foreground text-center", children: [
            "Chiudi con ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("b", { children: "Swipe Up" }),
            " su mobile/tablet o trascina con il mouse."
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          NotificationDialog,
          {
            notification: selectedNotification,
            open: !!selectedNotification,
            onClose: () => setSelectedNotification(null)
          }
        )
      ]
    }
  );
};

const DeveloperAccess = () => {
  React$1.useEffect(() => {
    window.location.href = "/login";
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white text-lg mb-4", children: "Reindirizzamento al login..." }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-sm", children: "Sistema di login unificato attivo" })
  ] }) });
};

const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
function useDeepLinkQR() {
  const [, setLocation] = useLocation();
  reactExports.useEffect(() => {
    try {
      const sp = new URLSearchParams(window.location.search);
      const raw = sp.get("qr")?.trim();
      if (!raw) return;
      const go = async () => {
        let code = raw;
        if (UUID_RE.test(raw)) {
          const { data, error } = await supabase.from("qr_codes").select("code").eq("id", raw).maybeSingle();
          if (error) {
            return;
          }
          if (!data?.code) return;
          code = data.code;
        }
        code = code.toUpperCase();
        setLocation(`/map`);
        const url = new URL(window.location.href);
        url.searchParams.delete("qr");
        window.history.replaceState({}, document.title, url.toString());
      };
      go();
    } catch (e) {
    }
  }, [setLocation]);
}

const M1U_CACHE_KEY = "m1ssion_m1u_cache";
const useM1UnitsRealtime = (userId) => {
  const getCachedBalance = () => {
    try {
      const cached = localStorage.getItem(M1U_CACHE_KEY);
      if (cached) {
        const { balance, userId: cachedUserId } = JSON.parse(cached);
        if (cachedUserId === userId) return balance;
      }
    } catch {
    }
    return 0;
  };
  const [unitsData, setUnitsData] = reactExports.useState(() => {
    const cachedBalance = getCachedBalance();
    if (userId && cachedBalance > 0) {
      return {
        user_id: userId,
        balance: cachedBalance,
        total_earned: 0,
        total_spent: 0,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      };
    }
    return null;
  });
  const [connectionState, setConnectionState] = reactExports.useState("INIT");
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const [heartbeatTimer, setHeartbeatTimer] = reactExports.useState(null);
  const cacheBalance = reactExports.useCallback((balance) => {
    if (userId) {
      try {
        localStorage.setItem(M1U_CACHE_KEY, JSON.stringify({ balance, userId, timestamp: Date.now() }));
      } catch {
      }
    }
  }, [userId]);
  const fetchUnits = reactExports.useCallback(async (retryCount = 0) => {
    if (!userId) {
      setIsLoading(false);
      return;
    }
    try {
      setIsLoading(true);
      setError(null);
      const { data: profile, error: fetchError } = await supabase.from("profiles").select("id, m1_units, updated_at").eq("id", userId).single();
      if (fetchError) {
        if (retryCount < 2) {
          setTimeout(() => fetchUnits(retryCount + 1), 500 * (retryCount + 1));
          return;
        }
        throw new Error(fetchError.message || "Failed to fetch M1U");
      }
      if (profile) {
        const balance = profile.m1_units || 0;
        setUnitsData({
          user_id: profile.id,
          balance,
          total_earned: 0,
          total_spent: 0,
          updated_at: profile.updated_at || (/* @__PURE__ */ new Date()).toISOString()
        });
        cacheBalance(balance);
      }
    } catch (err) {
      const errorMsg = err instanceof Error ? err.message : "Unknown error";
      setError(errorMsg);
      setConnectionState("ERROR");
    } finally {
      setIsLoading(false);
    }
  }, [userId, cacheBalance]);
  const ping = reactExports.useCallback(async () => {
    if (!userId) return;
    try {
      const { error: updateError } = await supabase.from("profiles").update({ updated_at: (/* @__PURE__ */ new Date()).toISOString() }).eq("id", userId);
      if (updateError) throw updateError;
      setConnectionState("HEARTBEAT");
      setTimeout(() => {
        setConnectionState("SUBSCRIBED");
      }, 2e3);
    } catch (err) {
      const errorMsg = err instanceof Error ? err.message : "Ping failed";
      setError(errorMsg);
      setConnectionState("ERROR");
    }
  }, [userId]);
  reactExports.useEffect(() => {
    const handleM1UUpdate = () => {
      fetchUnits();
    };
    window.addEventListener("m1u-balance-updated", handleM1UUpdate);
    return () => {
      window.removeEventListener("m1u-balance-updated", handleM1UUpdate);
    };
  }, [fetchUnits]);
  reactExports.useEffect(() => {
    if (!userId) return;
    fetchUnits();
    setConnectionState("CONNECTING");
    const channelName = `m1_units_user_${userId}`;
    const channel = supabase.channel(channelName).on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "profiles",
        filter: `id=eq.${userId}`
      },
      async (payload) => {
        await fetchUnits();
        setConnectionState("HEARTBEAT");
        setTimeout(() => {
          setConnectionState("SUBSCRIBED");
        }, 1e3);
      }
    ).subscribe((status) => {
      if (status === "SUBSCRIBED") {
        setConnectionState("SUBSCRIBED");
        emitSubscribed(channelName);
        const timer = setInterval(() => {
          setConnectionState((prev) => prev === "SUBSCRIBED" ? "SUBSCRIBED" : prev);
        }, 3e4);
        setHeartbeatTimer(timer);
      } else if (status === "CHANNEL_ERROR" || status === "TIMED_OUT") {
        setConnectionState("ERROR");
        emitError(String(status), channelName);
      } else if (status === "CLOSED") {
        setConnectionState("CLOSED");
      }
    });
    return () => {
      if (heartbeatTimer) {
        clearInterval(heartbeatTimer);
      }
      channel.unsubscribe();
      setConnectionState("INIT");
    };
  }, [userId, fetchUnits]);
  return {
    unitsData,
    connectionState,
    isLoading,
    error,
    ping,
    refetch: fetchUnits
  };
};

let stripePromise$2;
function getStripe() {
  if (!stripePromise$2) {
    const pk = "pk_live_51QJWtNRp5StPxarejrEVvghG3FX5h1jm4Cj3b1DsHaIyhlQcSZeFWwhLy60ke87bD0nxaXkuc1fEgCaYsOzKk7wJ00HI7zz7h3";
    stripePromise$2 = loadStripe(pk);
  }
  return stripePromise$2;
}

let cachedPromise = null;
function resolvePublishableKey() {
  try {
    const envPk = import.meta?.env?.VITE_STRIPE_PUBLISHABLE_KEY;
    if (envPk && typeof envPk === "string" && envPk.startsWith("pk_")) return envPk;
  } catch (_) {
  }
  const w = typeof window !== "undefined" ? window : void 0;
  if (w?.__STRIPE_PK__ && typeof w.__STRIPE_PK__ === "string") return w.__STRIPE_PK__;
  if (w?.ENV?.VITE_STRIPE_PUBLISHABLE_KEY && typeof w.ENV.VITE_STRIPE_PUBLISHABLE_KEY === "string") {
    return w.ENV.VITE_STRIPE_PUBLISHABLE_KEY;
  }
  return null;
}
async function getStripeSafe() {
  try {
    return await getStripe();
  } catch (err) {
  }
  if (!cachedPromise) {
    const pk = resolvePublishableKey();
    if (!pk) {
      cachedPromise = Promise.resolve(null);
    } else {
      cachedPromise = loadStripe(pk);
    }
  }
  return cachedPromise;
}
try {
  const w = typeof window !== "undefined" ? window : void 0;
  if (w && typeof w.getStripe !== "function") {
    w.getStripe = getStripeSafe;
    w.__getStripeSafe = getStripeSafe;
  }
} catch (_) {
}

const stripeFallback = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  getStripeSafe
}, Symbol.toStringTag, { value: 'Module' }));

const stripePromise$1 = getStripeSafe();
const CheckoutForm$1 = ({ packName, packCode, m1uAmount, priceCents, onSuccess, onCancel }) => {
  const stripe = useStripe();
  const elements = useElements();
  const [loading, setLoading] = reactExports.useState(false);
  const [clientSecret, setClientSecret] = reactExports.useState("");
  const { user } = useAuthContext();
  reactExports.useEffect(() => {
    if (!user) return;
    const createPaymentIntent = async () => {
      try {
        const { data, error } = await supabase.functions.invoke("create-payment-intent", {
          body: {
            amount: priceCents,
            // Already in cents
            currency: "eur",
            payment_type: "m1u_purchase",
            plan: packCode,
            description: `M1 UNITS ${packName} - ${m1uAmount} M1U`,
            metadata: {
              pack_code: packCode,
              pack_name: packName,
              m1u_amount: m1uAmount,
              user_email: user.email
            }
          }
        });
        if (error) {
          ue.error(`Errore: ${error.message || "Creazione pagamento fallita"}`);
          return;
        }
        const clientSecretValue = data?.client_secret || data?.clientSecret;
        if (clientSecretValue) {
          setClientSecret(clientSecretValue);
        } else {
          ue.error("Errore nella configurazione del pagamento");
        }
      } catch (error) {
        ue.error("Errore nel sistema di pagamento");
      }
    };
    createPaymentIntent();
  }, [user, packCode, packName, m1uAmount, priceCents]);
  const handleSubmit = async (event) => {
    event.preventDefault();
    if (!stripe || !elements || !clientSecret) {
      ue.error("Sistema di pagamento non pronto");
      return;
    }
    setLoading(true);
    const cardElement = elements.getElement(CardElement);
    if (!cardElement) {
      ue.error("Elemento carta non trovato");
      setLoading(false);
      return;
    }
    try {
      const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
        payment_method: {
          card: cardElement,
          billing_details: {
            email: user?.email || ""
          }
        }
      });
      if (error) {
        ue.error(`Pagamento fallito: ${error.message || "Errore sconosciuto"}`);
      } else if (paymentIntent.status === "succeeded") {
        ue.success("Pagamento completato!", {
          description: `${m1uAmount} M1U aggiunti al tuo account`
        });
        window.dispatchEvent(new CustomEvent("m1uPurchaseSucceeded", {
          detail: {
            paymentIntentId: paymentIntent.id,
            packCode,
            m1uAmount
          }
        }));
        onSuccess();
      }
    } catch (error) {
      ue.error("Errore nel processare il pagamento");
    } finally {
      setLoading(false);
    }
  };
  const cardElementOptions = {
    style: {
      base: {
        fontSize: "16px",
        color: "#ffffff",
        "::placeholder": {
          color: "#aab7c4"
        },
        backgroundColor: "transparent"
      },
      invalid: {
        color: "#fa755a",
        iconColor: "#fa755a"
      }
    },
    hidePostalCode: true
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "w-full max-w-md mx-auto bg-black/95 border-[#00D1FF]/30 backdrop-blur-xl", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "border-b border-white/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(ShoppingCart, { className: "w-5 h-5 text-[#00D1FF]" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-white font-orbitron", children: packName })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "icon",
            onClick: onCancel,
            disabled: loading,
            className: "h-8 w-8 rounded-full hover:bg-white/10",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-4 h-4" })
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mt-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-3xl font-bold text-white mb-1", children: [
          m1uAmount,
          " ",
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF] text-lg", children: "M1U" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-semibold text-[#FFD700]", children: [
          "",
          (priceCents / 100).toFixed(2)
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 pt-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 bg-white/5 rounded-lg border border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardElement, { options: cardElementOptions }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: "outline",
              onClick: onCancel,
              className: "flex-1 border-white/20 hover:bg-white/10",
              disabled: loading,
              children: "Annulla"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "submit",
              disabled: !stripe || loading || !clientSecret,
              className: "flex-1 bg-gradient-to-r from-[#00D1FF] to-[#7C3AED] hover:opacity-90 text-white font-semibold",
              children: loading ? /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" }),
                "Elaborazione..."
              ] }) : `Paga ${(priceCents / 100).toFixed(2)}`
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/50 text-center pt-2 border-t border-white/10", children: " Pagamento sicuro elaborato da Stripe" })
    ] })
  ] });
};
const M1UPaymentModal = ({
  isOpen,
  packName,
  packCode,
  m1uAmount,
  priceEur,
  priceCents,
  onSuccess,
  onCancel
}) => {
  reactExports.useEffect(() => {
    if (!isOpen) return;
    const handleEsc = (event) => {
      if (event.key === "Escape") {
        onCancel();
      }
    };
    window.addEventListener("keydown", handleEsc);
    return () => window.removeEventListener("keydown", handleEsc);
  }, [isOpen, onCancel]);
  if (!isOpen) return null;
  const options = {
    appearance: {
      theme: "night",
      variables: {
        colorPrimary: "#00D1FF",
        colorBackground: "#000000",
        colorText: "#ffffff",
        colorDanger: "#ef4444",
        fontFamily: "system-ui, sans-serif",
        spacingUnit: "4px",
        borderRadius: "8px"
      }
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: "fixed inset-0 bg-black/95 backdrop-blur-sm flex items-center justify-center p-4 z-[10000] overflow-y-auto",
      style: {
        paddingTop: "calc(env(safe-area-inset-top, 20px) + 20px)",
        paddingBottom: "calc(env(safe-area-inset-bottom, 20px) + 20px)",
        maxHeight: "100dvh"
      },
      onClick: (e) => {
        if (e.target === e.currentTarget) {
          onCancel();
        }
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(Elements, { stripe: stripePromise$1, options, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        CheckoutForm$1,
        {
          packName,
          packCode,
          m1uAmount,
          priceCents,
          onSuccess,
          onCancel
        }
      ) })
    }
  );
};

const M1U_PACKS = [
  {
    id: "starter",
    name: "Starter Pack",
    code: "M1U_STARTER",
    m1u_total: 50,
    euro: 4.99,
    savePct: 0,
    icon: Sparkles,
    gradient: "from-[#00D1FF]/20 to-[#A855F7]/20"
  },
  {
    id: "agent",
    name: "Agent Pack",
    code: "M1U_AGENT",
    m1u_total: 110,
    euro: 9.99,
    savePct: 9,
    icon: Zap,
    gradient: "from-[#00D1FF]/25 to-[#A855F7]/25"
  },
  {
    id: "elite",
    name: "Elite Pack",
    code: "M1U_ELITE",
    m1u_total: 250,
    euro: 19.99,
    savePct: 20,
    icon: Star,
    gradient: "from-[#00D1FF]/30 to-[#A855F7]/30"
  },
  {
    id: "commander",
    name: "Commander Pack",
    code: "M1U_COMMANDER",
    m1u_total: 550,
    euro: 39.99,
    savePct: 27,
    icon: Crown,
    gradient: "from-[#00D1FF]/30 to-[#A855F7]/30"
  },
  {
    id: "director",
    name: "Director Pack",
    code: "M1U_DIRECTOR",
    m1u_total: 1200,
    euro: 79.99,
    savePct: 33,
    icon: Gem,
    gradient: "from-[#00D1FF]/35 to-[#A855F7]/35"
  },
  {
    id: "mcp",
    name: "Master Control",
    code: "M1U_MASTER",
    m1u_total: 3e3,
    euro: 199.99,
    savePct: 33,
    icon: Crown,
    gradient: "from-[#00D1FF]/40 to-[#A855F7]/40"
  }
];
const M1UnitsShopModal = ({ isOpen, onClose }) => {
  const [selectedPack, setSelectedPack] = reactExports.useState(null);
  const [showPaymentModal, setShowPaymentModal] = reactExports.useState(false);
  const handlePurchase = (pack) => {
    if (typeof window !== "undefined" && window.plausible) {
      window.plausible("checkout_start", { props: { pack: pack.id } });
    }
    setSelectedPack(pack);
    setShowPaymentModal(true);
  };
  const handlePaymentSuccess = () => {
    setShowPaymentModal(false);
    if (selectedPack) {
      window.dispatchEvent(new CustomEvent("m1u-credited", {
        detail: {
          amount: selectedPack.m1u_total,
          packCode: selectedPack.code,
          packName: selectedPack.name
        }
      }));
      window.dispatchEvent(new CustomEvent("m1u-balance-changed", {
        detail: {
          type: "purchase",
          amount: selectedPack.m1u_total
        }
      }));
    }
    setSelectedPack(null);
    onClose();
  };
  const handlePaymentCancel = () => {
    setShowPaymentModal(false);
    setSelectedPack(null);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      DialogContent,
      {
        "aria-label": "M1 UNITS Shop",
        className: "sm:max-w-5xl w-[calc(100vw-2rem)] max-h-[85vh] overflow-y-auto p-0 bg-transparent border-0",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative rounded-2xl p-[1.5px] bg-gradient-to-r from-[#00D1FF] via-[#7C3AED] to-[#00D1FF] shadow-[0_0_30px_rgba(124,58,237,0.35)]", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "rounded-2xl bg-black/90 backdrop-blur-xl border border-white/10 p-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: onClose,
              "aria-label": "Close",
              className: "absolute top-4 right-4 z-10 w-11 h-11 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 border border-white/20 hover:border-white/30 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#00D1FF]/50",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-5 h-5 text-white" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-2xl font-orbitron text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "bg-gradient-to-r from-[#00D1FF] to-[#7C3AED] bg-clip-text text-transparent", children: "M1 UNITS SHOP" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(DialogDescription, { className: "text-center text-white/70", children: "Acquista pacchetti M1U per sbloccare indizi e funzionalit premium" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 my-6", children: M1U_PACKS.map((pack, index) => {
            const Icon = pack.icon;
            selectedPack?.id === pack.id && showPaymentModal;
            return /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                initial: { opacity: 0, y: 20 },
                animate: { opacity: 1, y: 0 },
                transition: { delay: index * 0.05 },
                className: "relative",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `group relative h-full rounded-xl border border-white/10 bg-gradient-to-br ${pack.gradient} p-[1px] hover:border-white/20 transition-all`, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "rounded-xl bg-black/80 backdrop-blur-xl p-5 h-full", children: [
                  pack.savePct > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute -top-2 -right-2 px-2 py-1 rounded-full text-xs font-bold text-white bg-emerald-500 shadow-[0_0_12px_rgba(16,185,129,0.6)]", children: [
                    "-",
                    pack.savePct,
                    "%"
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-14 h-14 rounded-full mx-auto mb-4 flex items-center justify-center bg-gradient-to-br from-[#00D1FF] to-[#7C3AED] shadow-[0_10px_30px_rgba(124,58,237,0.35)]", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "w-7 h-7 text-white" }) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-orbitron font-bold text-center text-white mb-2", children: pack.name }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-4", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-3xl font-extrabold text-white mb-1", children: [
                      pack.m1u_total,
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/70 ml-1", children: "M1U" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-semibold text-[#FFD700]", children: [
                      "",
                      pack.euro.toFixed(2)
                    ] }),
                    pack.savePct > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-emerald-400 mt-1", children: [
                      "Risparmi ",
                      pack.savePct,
                      "%"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => handlePurchase(pack),
                      disabled: showPaymentModal,
                      className: "w-full rounded-lg bg-gradient-to-r from-[#00D1FF] to-[#7C3AED] text-white font-semibold hover:opacity-90 transition-opacity",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(ShoppingCart, { className: "w-4 h-4" }),
                        "Acquista"
                      ] })
                    }
                  )
                ] }) })
              },
              pack.id
            );
          }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center text-xs text-white/50 mt-4 pb-2", children: "Pagamento sicuro tramite Stripe  M1U non scadono mai" })
        ] }) })
      }
    ) }),
    selectedPack && /* @__PURE__ */ jsxRuntimeExports.jsx(
      M1UPaymentModal,
      {
        isOpen: showPaymentModal,
        packName: selectedPack.name,
        packCode: selectedPack.code,
        m1uAmount: selectedPack.m1u_total,
        priceEur: selectedPack.euro,
        priceCents: Math.round(selectedPack.euro * 100),
        onSuccess: handlePaymentSuccess,
        onCancel: handlePaymentCancel
      }
    )
  ] });
};

const M1UPill$1 = ({
  className = "",
  showLabel = true,
  showPlusButton = true
}) => {
  const { user } = useUnifiedAuth();
  const userId = user?.id;
  const [pulseAnimation, setPulseAnimation] = reactExports.useState(false);
  const [prevBalance, setPrevBalance] = reactExports.useState(null);
  const [showShopModal, setShowShopModal] = reactExports.useState(false);
  const { unitsData, isLoading, error, refetch } = useM1UnitsRealtime(userId);
  const getCachedM1U = () => {
    try {
      const cached = localStorage.getItem("m1ssion_m1u_cache");
      if (cached) {
        const { balance: balance2, userId: cachedUserId } = JSON.parse(cached);
        if (cachedUserId === userId) return balance2;
      }
    } catch {
    }
    return unitsData?.balance || 0;
  };
  const [displayedBalance, setDisplayedBalance] = reactExports.useState(() => getCachedM1U());
  const [isAnimating, setIsAnimating] = reactExports.useState(false);
  const animationRef = React$1.useRef(null);
  const animateBalance = (startValue, endValue, duration = 2e3) => {
    if (animationRef.current) {
      cancelAnimationFrame(animationRef.current);
    }
    const startTime = performance.now();
    const difference = endValue - startValue;
    setIsAnimating(true);
    setPulseAnimation(true);
    const animate = (currentTime) => {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const easeOutQuart = 1 - Math.pow(1 - progress, 4);
      const currentValue = Math.round(startValue + difference * easeOutQuart);
      setDisplayedBalance(currentValue);
      if (progress < 1) {
        animationRef.current = requestAnimationFrame(animate);
      } else {
        setDisplayedBalance(endValue);
        setIsAnimating(false);
        setPulseAnimation(false);
        animationRef.current = null;
      }
    };
    animationRef.current = requestAnimationFrame(animate);
  };
  reactExports.useEffect(() => {
    const handleRefresh = () => {
      refetch();
    };
    const handleM1USpent = (event) => {
      event.detail?.amount || 0;
      const newBalance = event.detail?.newBalance;
      if (newBalance !== void 0) {
        setDisplayedBalance(newBalance);
        setPrevBalance(newBalance);
      }
      setTimeout(() => refetch(), 300);
    };
    window.addEventListener("buzzAreaCreated", handleRefresh);
    window.addEventListener("buzzClueCreated", handleRefresh);
    window.addEventListener("m1u-spent", handleM1USpent);
    window.addEventListener("m1u-balance-changed", handleRefresh);
    return () => {
      window.removeEventListener("buzzAreaCreated", handleRefresh);
      window.removeEventListener("buzzClueCreated", handleRefresh);
      window.removeEventListener("m1u-spent", handleM1USpent);
      window.removeEventListener("m1u-balance-changed", handleRefresh);
    };
  }, [refetch]);
  reactExports.useEffect(() => {
    const handleM1UCredited = (event) => {
      const amount = event.detail?.amount || 0;
      const currentDisplayed = displayedBalance;
      const newBalance = currentDisplayed + amount;
      setTimeout(() => refetch(), 100);
      animateBalance(currentDisplayed, newBalance, 2500);
      ue.success(` +${amount} M1U!`, {
        description: "Guarda i tuoi crediti salire! ",
        duration: 3e3
      });
    };
    window.addEventListener("m1u-credited", handleM1UCredited);
    return () => {
      window.removeEventListener("m1u-credited", handleM1UCredited);
    };
  }, [refetch, displayedBalance]);
  reactExports.useEffect(() => {
    if (unitsData?.balance !== void 0 && !isAnimating) {
      if (displayedBalance !== unitsData.balance) {
        setDisplayedBalance(unitsData.balance);
      }
    }
  }, [unitsData?.balance, isAnimating, displayedBalance]);
  reactExports.useEffect(() => {
    if (unitsData?.balance !== void 0 && prevBalance !== null && unitsData.balance !== prevBalance) {
      if (!isAnimating && Math.abs(unitsData.balance - prevBalance) >= 5) {
        animateBalance(prevBalance, unitsData.balance, 1500);
      }
    }
    if (unitsData?.balance !== void 0) {
      setPrevBalance(unitsData.balance);
    }
  }, [unitsData?.balance, prevBalance, isAnimating]);
  reactExports.useEffect(() => {
    return () => {
      if (animationRef.current) {
        cancelAnimationFrame(animationRef.current);
      }
    };
  }, []);
  const balance = unitsData?.balance ?? 0;
  const lowBalance = balance < 100;
  const handleOpenRecharge = () => {
    setShowShopModal(true);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `flex items-center gap-2 relative ${className}`, children: [
      showPlusButton && /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.button,
        {
          className: "pill-orb",
          "aria-label": "Add M1U",
          whileHover: { scale: 1.03 },
          whileTap: { scale: 0.97 },
          onClick: () => {
            handleOpenRecharge();
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 text-cyan-100" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "dot" })
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "m1u-pill-main flex items-center gap-2 px-4 py-2 rounded-full cursor-pointer",
          style: {
            background: "radial-gradient(120% 120% at 50% 10%, rgba(255,255,255,.08), rgba(0,0,0,.2) 58%)",
            border: "1px solid rgba(255, 255, 255, 0.18)",
            boxShadow: "0 2px 12px rgba(0,0,0,.35), 0 0 20px rgba(255, 215, 0, 0.12) inset",
            backdropFilter: "blur(12px)",
            minHeight: 40
          },
          whileHover: { scale: 1.02 },
          whileTap: { scale: 0.98 },
          onClick: handleOpenRecharge,
          animate: pulseAnimation ? { scale: [1, 1.05, 1] } : {},
          transition: { duration: 0.3 },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold",
                style: {
                  background: "linear-gradient(135deg, #FFD700 0%, #FFA500 100%)",
                  color: "#1a1a1a",
                  boxShadow: "0 0 8px rgba(255, 215, 0, 0.6)"
                },
                animate: pulseAnimation ? { rotate: [0, 10, -10, 0] } : {},
                children: "M1"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: isLoading && displayedBalance === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "animate-pulse text-sm font-orbitron text-white opacity-60",
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                exit: { opacity: 0 },
                children: ""
              },
              "loading"
            ) : error ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "flex items-center gap-1 text-sm font-orbitron text-red-500",
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                exit: { opacity: 0 },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-3 h-3" }),
                  " ERR"
                ]
              },
              "error"
            ) : /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "flex items-center gap-1.5",
                initial: { opacity: 0, y: -10 },
                animate: { opacity: 1, y: 0 },
                exit: { opacity: 0, y: 10 },
                children: [
                  showLabel && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold text-white/90 font-orbitron", children: "M1U" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "span",
                    {
                      className: `text-sm font-bold font-orbitron tracking-wide transition-all ${isAnimating ? "text-[#FFD700] scale-110 drop-shadow-[0_0_8px_rgba(255,215,0,0.8)]" : "text-white"}`,
                      style: {
                        textShadow: isAnimating ? "0 0 10px rgba(255, 215, 0, 0.9)" : "none"
                      },
                      children: displayedBalance.toLocaleString("it-IT")
                    }
                  ),
                  isAnimating && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.span,
                    {
                      initial: { opacity: 0, scale: 0 },
                      animate: { opacity: [0, 1, 0], scale: [0.5, 1.2, 0.5] },
                      transition: { duration: 0.5, repeat: Infinity },
                      className: "text-yellow-400 text-xs",
                      children: ""
                    }
                  )
                ]
              },
              "balance"
            ) }),
            lowBalance && !isLoading && !error && /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full",
                style: { boxShadow: "0 0 8px rgba(239,68,68,0.8)" }
              }
            )
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      M1UnitsShopModal,
      {
        isOpen: showShopModal,
        onClose: () => setShowShopModal(false)
      }
    )
  ] });
};

const M1UPill$2 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: M1UPill$1
}, Symbol.toStringTag, { value: 'Module' }));

const MILESTONES = [
  { days: 5, icon: "", name: "Fiamma Nascente", color: "#FF6B35" },
  { days: 10, icon: "", name: "Fiamma Ardente", color: "#FF4500" },
  { days: 15, icon: "", name: "Inferno", color: "#DC143C" },
  { days: 25, icon: "", name: "Leggenda Streak", color: "#FFD700" },
  { days: 30, icon: "", name: "Campione Missione", color: "#00D1FF" },
  { days: 50, icon: "", name: "Diamante", color: "#00BFFF" },
  { days: 100, icon: "", name: "Re della Streak", color: "#9B59B6" }
];
function StreakModal({ isOpen, onClose, onCheckInComplete }) {
  const { user } = useAuthContext();
  const [loading, setLoading] = reactExports.useState(true);
  const [checkingIn, setCheckingIn] = reactExports.useState(false);
  const [streakInfo, setStreakInfo] = reactExports.useState(null);
  const [canCheckIn, setCanCheckIn] = reactExports.useState(true);
  const [showSuccess, setShowSuccess] = reactExports.useState(false);
  reactExports.useEffect(() => {
    if (isOpen && user) loadStreakInfo();
  }, [isOpen, user]);
  const loadStreakInfo = async () => {
    if (!user) return;
    setLoading(true);
    try {
      const { data: profile } = await supabase.from("profiles").select("current_streak_days, longest_streak_days, last_check_in_date").eq("id", user.id).single();
      if (profile) {
        const streak2 = profile.current_streak_days || 0;
        const nextMilestone = MILESTONES.find((m) => streak2 < m.days)?.days || null;
        setStreakInfo({
          current_streak: streak2,
          longest_streak: profile.longest_streak_days || 0,
          last_check_in: profile.last_check_in_date,
          next_milestone: nextMilestone,
          days_to_next_milestone: nextMilestone ? nextMilestone - streak2 : 0
        });
        const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
        setCanCheckIn(profile.last_check_in_date !== today);
      }
    } catch (err) {
    } finally {
      setLoading(false);
    }
  };
  const handleCheckIn = async () => {
    if (!user || !canCheckIn || checkingIn) return;
    hapticLight();
    setCheckingIn(true);
    try {
      const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
      const yesterday = new Date(Date.now() - 864e5).toISOString().split("T")[0];
      const currentStreak = streakInfo?.current_streak || 0;
      const lastCheckIn = streakInfo?.last_check_in;
      let newStreak = 1;
      let streakBroken = false;
      if (lastCheckIn === yesterday) {
        newStreak = currentStreak + 1;
      } else if (lastCheckIn && lastCheckIn !== today) {
        streakBroken = true;
      }
      const basePE = 10;
      const multiplier = Math.min(1 + newStreak * 0.05, 1.5);
      const peAwarded = Math.round(basePE * multiplier);
      const { error: updateError } = await supabase.from("profiles").update({
        current_streak_days: newStreak,
        longest_streak_days: Math.max(newStreak, streakInfo?.longest_streak || 0),
        last_check_in_date: today
      }).eq("id", user.id);
      if (updateError) throw updateError;
      await supabase.rpc("award_xp", {
        p_user_id: user.id,
        p_xp_amount: peAwarded,
        p_source: "daily_checkin"
      });
      hapticSuccess();
      setShowSuccess(true);
      setCanCheckIn(false);
      setTimeout(() => {
        setShowSuccess(false);
        onCheckInComplete?.();
        loadStreakInfo();
      }, 2e3);
      if (streakBroken) {
        ue.warning(" Streak resettata! Ricomincia da 1");
      } else {
        const milestone = MILESTONES.find((m) => m.days === newStreak);
        if (milestone) {
          ue.success(` Badge sbloccato: ${milestone.name}!`);
        } else {
          ue.success(` Streak: ${newStreak} giorni! +${peAwarded} PE`);
        }
      }
    } catch (err) {
      ue.error("Errore durante il check-in");
    } finally {
      setCheckingIn(false);
    }
  };
  const streak = streakInfo?.current_streak || 0;
  const progress = streakInfo?.next_milestone ? streak / streakInfo.next_milestone * 100 : 100;
  const peMultiplier = Math.min(1 + streak * 0.05, 1.5);
  const m1uBonus = Math.min(streak * 2, 30);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogContent, { className: "max-w-md p-0 bg-transparent border-0 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { scale: 0.9, opacity: 0 },
      animate: { scale: 1, opacity: 1 },
      exit: { scale: 0.9, opacity: 0 },
      className: "relative rounded-2xl overflow-hidden",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-[#0a0b14] via-[#12131f] to-[#0a0b14]" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-[url('/grid-pattern.svg')] opacity-5" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute top-0 left-1/2 -translate-x-1/2 w-64 h-64 rounded-full blur-3xl",
            style: { background: "radial-gradient(circle, rgba(255,107,53,0.3) 0%, transparent 70%)" },
            animate: { scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] },
            transition: { duration: 4, repeat: Infinity }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute bottom-0 right-0 w-48 h-48 rounded-full blur-3xl",
            style: { background: "radial-gradient(circle, rgba(0,209,255,0.2) 0%, transparent 70%)" },
            animate: { scale: [1, 1.1, 1], opacity: [0.2, 0.4, 0.2] },
            transition: { duration: 3, repeat: Infinity, delay: 1 }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative p-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: onClose,
              className: "absolute top-4 right-4 w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-4 h-4 text-white/60" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showSuccess && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              exit: { opacity: 0 },
              className: "absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm rounded-2xl",
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  initial: { scale: 0 },
                  animate: { scale: [0, 1.2, 1] },
                  className: "text-center",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        animate: { rotate: [0, 360] },
                        transition: { duration: 1 },
                        className: "w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-green-400 to-cyan-400 flex items-center justify-center",
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-10 h-10 text-white" })
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xl font-bold text-white", children: "Check-in Completato!" })
                  ]
                }
              )
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                animate: { scale: [1, 1.1, 1], rotate: [0, 5, -5, 0] },
                transition: { duration: 2, repeat: Infinity },
                className: "relative inline-block mb-3",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-16 h-16 rounded-full bg-gradient-to-br from-orange-500/30 to-red-500/30 flex items-center justify-center mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Flame, { className: "w-8 h-8 text-orange-400" }) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      className: "absolute -inset-2 rounded-full",
                      style: { border: "2px solid rgba(255,107,53,0.3)" },
                      animate: { scale: [1, 1.2, 1], opacity: [0.5, 0, 0.5] },
                      transition: { duration: 2, repeat: Infinity }
                    }
                  )
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-orbitron font-bold text-white mb-1", children: " STREAK SYSTEM" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Accedi ogni giorno per bonus esclusivi" })
          ] }),
          loading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center py-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 border-2 border-orange-400 border-t-transparent rounded-full animate-spin" }) }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3 mb-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-gradient-to-br from-orange-500/10 to-red-500/10 border border-orange-500/20 text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-orbitron font-bold text-orange-400", children: streak }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-400 uppercase tracking-wider", children: "Giorni Streak" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/20 text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-orbitron font-bold text-cyan-400", children: streakInfo?.longest_streak || 0 }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-400 uppercase tracking-wider", children: "Record" })
              ] })
            ] }),
            streakInfo?.next_milestone && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-xs text-gray-400 mb-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                  "Prossimo badge: ",
                  MILESTONES.find((m) => m.days === streakInfo.next_milestone)?.name
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                  streakInfo.days_to_next_milestone,
                  " giorni"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-3 bg-gray-800/50 rounded-full overflow-hidden relative", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    initial: { width: 0 },
                    animate: { width: `${progress}%` },
                    transition: { duration: 1, ease: "easeOut" },
                    className: "h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full"
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent" })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3 mb-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  className: "p-3 rounded-xl bg-purple-500/10 border border-purple-500/20",
                  whileHover: { scale: 1.02 },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-4 h-4 text-purple-400" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "PE Bonus" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg font-bold text-purple-300", children: [
                      "+",
                      Math.round((peMultiplier - 1) * 100),
                      "%"
                    ] })
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  className: "p-3 rounded-xl bg-cyan-500/10 border border-cyan-500/20",
                  whileHover: { scale: 1.02 },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Gift, { className: "w-4 h-4 text-cyan-400" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "M1U Bonus" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg font-bold text-cyan-300", children: [
                      "+",
                      m1uBonus,
                      "%"
                    ] })
                  ]
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-500 uppercase tracking-wider mb-3", children: "Badge Streak" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2 overflow-x-auto pb-2 scrollbar-hide", children: MILESTONES.slice(0, 5).map((m) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  whileHover: { scale: 1.05, y: -2 },
                  className: `flex-shrink-0 w-14 h-14 rounded-xl flex flex-col items-center justify-center transition-all ${streak >= m.days ? "bg-gradient-to-br from-green-500/20 to-emerald-500/20 border border-green-500/40" : "bg-gray-800/30 border border-gray-700/30"}`,
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg", children: m.icon }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: `text-[10px] font-bold ${streak >= m.days ? "text-green-400" : "text-gray-500"}`, children: [
                      m.days,
                      "g"
                    ] })
                  ]
                },
                m.days
              )) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleCheckIn,
                disabled: !canCheckIn || checkingIn,
                className: `w-full h-14 text-lg font-orbitron font-bold rounded-xl transition-all ${canCheckIn ? "bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-400 hover:to-red-400 text-white shadow-lg shadow-orange-500/30" : "bg-gray-700 text-gray-400"}`,
                children: checkingIn ? /* @__PURE__ */ jsxRuntimeExports.jsx(motion.div, { animate: { rotate: 360 }, transition: { duration: 1, repeat: Infinity }, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-5 h-5" }) }) : canCheckIn ? /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Flame, { className: "w-5 h-5" }),
                  "CHECK-IN GIORNALIERO"
                ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-5 h-5" }),
                  "COMPLETATO OGGI"
                ] })
              }
            ),
            !canCheckIn && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-center text-xs text-gray-500 mt-3", children: "Torna domani per continuare la streak!" })
          ] })
        ] })
      ]
    }
  ) }) });
}

const StreakPill = ({ className = "", showLabel = true }) => {
  const { user } = useAuthContext();
  const [streak, setStreak] = reactExports.useState(0);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(false);
  const [showModal, setShowModal] = reactExports.useState(false);
  const [pulseAnimation, setPulseAnimation] = reactExports.useState(false);
  const [canCheckIn, setCanCheckIn] = reactExports.useState(true);
  reactExports.useEffect(() => {
    if (user) loadStreakData();
  }, [user]);
  const loadStreakData = async (retryCount = 0) => {
    if (!user) return;
    setIsLoading(true);
    setError(false);
    try {
      const { data, error: queryError } = await supabase.from("profiles").select("current_streak_days, last_check_in_date").eq("id", user.id).single();
      if (queryError) {
        throw queryError;
      }
      if (data) {
        setStreak(data.current_streak_days || 0);
        const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
        setCanCheckIn(data.last_check_in_date !== today);
      } else {
        setStreak(0);
        setCanCheckIn(true);
      }
    } catch (err) {
      if (retryCount < 3) {
        const delay = Math.pow(2, retryCount) * 1e3;
        setTimeout(() => loadStreakData(retryCount + 1), delay);
        return;
      }
      setError(true);
      setStreak(0);
      setCanCheckIn(true);
    } finally {
      if (retryCount >= 3 || !error) {
        setIsLoading(false);
      }
    }
  };
  reactExports.useEffect(() => {
    const handleUpdate = () => {
      setPulseAnimation(true);
      loadStreakData();
      setTimeout(() => setPulseAnimation(false), 1e3);
    };
    window.addEventListener("streak-updated", handleUpdate);
    return () => window.removeEventListener("streak-updated", handleUpdate);
  }, []);
  const getFireColor = () => {
    if (streak >= 30) return { from: "#9B59B6", to: "#8E44AD", glow: "rgba(155,89,182,0.6)" };
    if (streak >= 15) return { from: "#FFD700", to: "#FFA500", glow: "rgba(255,215,0,0.6)" };
    if (streak >= 5) return { from: "#FF6B35", to: "#FF4500", glow: "rgba(255,107,53,0.6)" };
    return { from: "#FF4757", to: "#FF6B81", glow: "rgba(255,71,87,0.5)" };
  };
  const fireColor = getFireColor();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `flex items-center gap-3 relative ${className}`, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "flex items-center gap-2 px-4 py-2 rounded-full cursor-pointer",
        style: {
          background: "radial-gradient(120% 120% at 50% 10%, rgba(255,255,255,.08), rgba(0,0,0,.2) 58%)",
          border: "1px solid rgba(255,255,255,0.18)",
          boxShadow: `0 2px 12px rgba(0,0,0,.35), 0 0 20px ${fireColor.glow} inset`,
          backdropFilter: "blur(12px)",
          minHeight: 40
        },
        whileHover: { scale: 1.02 },
        whileTap: { scale: 0.98 },
        onClick: () => setShowModal(true),
        animate: pulseAnimation ? { scale: [1, 1.05, 1] } : {},
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "w-5 h-5 rounded-full flex items-center justify-center",
              style: {
                background: `linear-gradient(135deg, ${fireColor.from}, ${fireColor.to})`,
                boxShadow: `0 0 8px ${fireColor.glow}`
              },
              animate: canCheckIn ? { scale: [1, 1.2, 1] } : {},
              transition: { duration: 1, repeat: canCheckIn ? Infinity : 0, repeatDelay: 2 },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Flame, { className: "w-3 h-3 text-white" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(motion.div, { className: "animate-pulse text-sm font-orbitron text-white/60", children: "" }, "loading") : error ? /* @__PURE__ */ jsxRuntimeExports.jsxs(motion.div, { className: "flex items-center gap-1 text-sm text-red-500", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-3 h-3" }),
            " ERR"
          ] }, "error") : /* @__PURE__ */ jsxRuntimeExports.jsxs(motion.div, { className: "flex items-center gap-1.5", initial: { opacity: 0 }, animate: { opacity: 1 }, children: [
            showLabel && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold text-white/90 font-orbitron", children: "STREAK" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `text-sm font-bold font-orbitron ${pulseAnimation ? "text-orange-400" : "text-white"}`, children: streak }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/60", children: "d" })
          ] }, "streak") }),
          canCheckIn && !isLoading && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "absolute -top-1 -right-1 w-3 h-3 rounded-full",
              style: { background: "linear-gradient(135deg, #00D1FF, #00FF88)", boxShadow: "0 0 8px rgba(0,209,255,0.8)" },
              animate: { scale: [1, 1.3, 1] },
              transition: { duration: 1.5, repeat: Infinity }
            }
          )
        ]
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      StreakModal,
      {
        isOpen: showModal,
        onClose: () => setShowModal(false),
        onCheckInComplete: () => {
          loadStreakData();
          window.dispatchEvent(new CustomEvent("streak-updated"));
        }
      }
    )
  ] });
};

const CASHBACK_RATES_BY_TIER = {
  base: 5e-3,
  // 0.5%
  silver: 0.01,
  // 1%
  gold: 0.02,
  // 2%
  black: 0.03,
  // 3%
  titanium: 0.05
  // 5%
};
const calculateCashbackM1U = (costEur, tier) => {
  if (costEur <= 0) return 0;
  const rate = CASHBACK_RATES_BY_TIER[tier] || CASHBACK_RATES_BY_TIER.base;
  const rawCashback = costEur * rate * 10;
  const cashbackM1U = Math.max(1, Math.ceil(rawCashback));
  return cashbackM1U;
};

const normalizeTier = (tier) => {
  if (!tier) return "base";
  const normalized = tier.toLowerCase().trim();
  if (["base", "free"].includes(normalized)) return "base";
  if (["silver"].includes(normalized)) return "silver";
  if (["gold"].includes(normalized)) return "gold";
  if (["black"].includes(normalized)) return "black";
  if (["titanium"].includes(normalized)) return "titanium";
  return "base";
};
const FREE_BUZZ_WEEKLY_BY_TIER = {
  base: 1,
  silver: 3,
  gold: 4,
  black: 5,
  titanium: 7
};

function useCashbackWallet() {
  const { user } = useAuthContext();
  const [accumulatedM1U, setAccumulatedM1U] = reactExports.useState(0);
  const [lifetimeEarnedM1U, setLifetimeEarnedM1U] = reactExports.useState(0);
  const [lastClaimAt, setLastClaimAt] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [error, setError] = reactExports.useState(null);
  const [userTier, setUserTier] = reactExports.useState("base");
  const now = /* @__PURE__ */ new Date();
  const isSunday = now.getDay() === 0;
  const canClaim = accumulatedM1U > 0 && isSunday && (lastClaimAt === null || now.getTime() - lastClaimAt.getTime() >= 7 * 24 * 60 * 60 * 1e3);
  const getNextSunday = () => {
    const today = /* @__PURE__ */ new Date();
    const dayOfWeek = today.getDay();
    const daysUntilSunday = dayOfWeek === 0 ? 7 : 7 - dayOfWeek;
    const nextSunday = new Date(today);
    nextSunday.setDate(today.getDate() + daysUntilSunday);
    nextSunday.setHours(0, 0, 0, 0);
    return nextSunday;
  };
  const nextClaimAvailable = lastClaimAt && now.getTime() - lastClaimAt.getTime() < 7 * 24 * 60 * 60 * 1e3 ? getNextSunday() : !isSunday ? getNextSunday() : null;
  const loadWallet = reactExports.useCallback(async () => {
    if (!user?.id) return;
    setIsLoading(true);
    setError(null);
    try {
      const { data: wallet, error: walletError } = await supabase.from("user_cashback_wallet").select("accumulated_m1u, lifetime_earned_m1u, last_claim_at").eq("user_id", user.id).maybeSingle();
      if (walletError && walletError.code !== "PGRST116") {
        setError("Errore caricamento wallet");
        return;
      }
      if (wallet) {
        setAccumulatedM1U(wallet.accumulated_m1u || 0);
        setLifetimeEarnedM1U(wallet.lifetime_earned_m1u || 0);
        setLastClaimAt(wallet.last_claim_at ? new Date(wallet.last_claim_at) : null);
      }
      const { data: subData } = await supabase.from("subscriptions").select("tier").eq("user_id", user.id).eq("status", "active").maybeSingle();
      if (subData?.tier) {
        setUserTier(normalizeTier(subData.tier));
      }
    } catch (err) {
      setError("Errore imprevisto");
    } finally {
      setIsLoading(false);
    }
  }, [user?.id]);
  reactExports.useEffect(() => {
    if (user?.id) {
      loadWallet();
    }
  }, [user?.id, loadWallet]);
  const accrueInternal = reactExports.useCallback(async (sourceType, costEur, tier) => {
    if (!user?.id || costEur <= 0) return;
    const cashbackM1U = calculateCashbackM1U(costEur, tier);
    if (cashbackM1U <= 0) return;
    try {
      const { error: rpcError } = await supabase.rpc("accrue_cashback", {
        p_user_id: user.id,
        p_source_type: sourceType,
        p_source_cost_eur: costEur,
        p_cashback_m1u: cashbackM1U,
        p_tier_at_time: tier
      });
      if (rpcError) {
        return;
      }
      setAccumulatedM1U((prev) => prev + cashbackM1U);
      setLifetimeEarnedM1U((prev) => prev + cashbackM1U);
      window.dispatchEvent(new CustomEvent("cashbackUpdated", {
        detail: { amount: cashbackM1U, source: sourceType }
      }));
    } catch (err) {
    }
  }, [user?.id]);
  const accrueFromBuzz = reactExports.useCallback(async (params) => {
    await accrueInternal("buzz", params.costEur, params.tier || userTier);
  }, [accrueInternal, userTier]);
  const accrueFromBuzzMap = reactExports.useCallback(async (params) => {
    await accrueInternal("buzz_map", params.costEur, params.tier || userTier);
  }, [accrueInternal, userTier]);
  const accrueFromAion = reactExports.useCallback(async (params) => {
    await accrueInternal("aion", params.costEur, params.tier || userTier);
  }, [accrueInternal, userTier]);
  const claimCashback = reactExports.useCallback(async () => {
    if (!user?.id || !canClaim) return null;
    setIsLoading(true);
    setError(null);
    try {
      const { data: session } = await supabase.auth.getSession();
      if (!session?.session?.access_token) {
        setError("Sessione scaduta");
        return null;
      }
      const response = await supabase.functions.invoke("cashback-claim", {
        headers: {
          Authorization: `Bearer ${session.session.access_token}`
        }
      });
      if (response.error) {
        setError(response.error.message || "Errore nel claim");
        return null;
      }
      const result = response.data;
      setAccumulatedM1U(0);
      setLastClaimAt(/* @__PURE__ */ new Date());
      window.dispatchEvent(new CustomEvent("m1u-balance-updated"));
      return {
        credited_m1u: result.credited_m1u,
        new_balance: result.new_balance
      };
    } catch (err) {
      setError("Errore imprevisto nel claim");
      return null;
    } finally {
      setIsLoading(false);
    }
  }, [user?.id, canClaim]);
  return {
    accumulatedM1U,
    lifetimeEarnedM1U,
    canClaim,
    nextClaimAvailable,
    isLoading,
    error,
    accrueFromBuzz,
    accrueFromBuzzMap,
    accrueFromAion,
    claimCashback,
    refresh: loadWallet
  };
}

const CashbackVaultPill = ({
  className = "",
  variant = "compact"
}) => {
  const {
    accumulatedM1U,
    canClaim,
    nextClaimAvailable,
    isLoading,
    claimCashback,
    refresh
  } = useCashbackWallet();
  const [isClaiming, setIsClaiming] = reactExports.useState(false);
  const [showClaimModal, setShowClaimModal] = reactExports.useState(false);
  const [displayedValue, setDisplayedValue] = reactExports.useState(accumulatedM1U);
  const [isAnimating, setIsAnimating] = reactExports.useState(false);
  const animationRef = reactExports.useRef(null);
  const animateSlotMachine = (targetValue, increment) => {
    const startValue = displayedValue;
    const duration = 1200;
    const steps = 20;
    const stepDuration = duration / steps;
    let currentStep = 0;
    setIsAnimating(true);
    if (animationRef.current) {
      clearInterval(animationRef.current);
    }
    animationRef.current = setInterval(() => {
      currentStep++;
      if (currentStep >= steps) {
        setDisplayedValue(targetValue);
        setIsAnimating(false);
        if (animationRef.current) {
          clearInterval(animationRef.current);
          animationRef.current = null;
        }
      } else {
        const progress = currentStep / steps;
        const randomOffset = Math.floor(Math.random() * 10) - 5;
        const interpolated = Math.floor(startValue + (targetValue - startValue) * progress) + randomOffset;
        setDisplayedValue(Math.max(0, interpolated));
      }
    }, stepDuration);
  };
  reactExports.useEffect(() => {
    const handleCashbackUpdate = (event) => {
      const newTotal = accumulatedM1U + event.detail.amount;
      animateSlotMachine(newTotal, event.detail.amount);
    };
    window.addEventListener("cashbackUpdated", handleCashbackUpdate);
    return () => {
      window.removeEventListener("cashbackUpdated", handleCashbackUpdate);
      if (animationRef.current) {
        clearInterval(animationRef.current);
      }
    };
  }, [accumulatedM1U]);
  reactExports.useEffect(() => {
    if (!isAnimating) {
      setDisplayedValue(accumulatedM1U);
    }
  }, [accumulatedM1U, isAnimating]);
  const handleClaim = async () => {
    if (!canClaim || isClaiming) return;
    setIsClaiming(true);
    try {
      const result = await claimCashback();
      if (result) {
        ue.success(` Cashback riscattato!`, {
          description: `+${result.credited_m1u.toLocaleString()} M1U aggiunti al tuo saldo`
        });
        setShowClaimModal(false);
        window.dispatchEvent(new CustomEvent("m1u-balance-updated"));
      }
    } catch (err) {
      ue.error("Errore nel riscatto del cashback");
    } finally {
      setIsClaiming(false);
    }
  };
  const formatNextClaim = () => {
    if (!nextClaimAvailable) {
      const isSunday2 = (/* @__PURE__ */ new Date()).getDay() === 0;
      return isSunday2 ? "Disponibile oggi!" : "Solo di Domenica";
    }
    const now = /* @__PURE__ */ new Date();
    const diff = nextClaimAvailable.getTime() - now.getTime();
    const days = Math.ceil(diff / (1e3 * 60 * 60 * 24));
    if (days <= 0) return "Disponibile";
    if (days === 1) return "Domani (Dom)";
    return `Domenica (${days}g)`;
  };
  const isSunday = (/* @__PURE__ */ new Date()).getDay() === 0;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: `
          relative overflow-hidden rounded-2xl
          bg-gradient-to-br from-cyan-500/30 via-blue-500/25 to-pink-500/30
          backdrop-blur-md border border-cyan-400/30
          shadow-lg shadow-cyan-500/10
          cursor-pointer
          ${isAnimating ? "ring-2 ring-cyan-400/50 ring-offset-2 ring-offset-transparent" : ""}
          ${className}
        `,
        initial: { opacity: 0, y: 10 },
        animate: {
          opacity: 1,
          y: 0,
          scale: isAnimating ? [1, 1.02, 1] : 1
        },
        transition: {
          duration: isAnimating ? 0.3 : 0.3,
          repeat: isAnimating ? 3 : 0
        },
        onClick: () => accumulatedM1U > 0 && setShowClaimModal(true),
        whileHover: { scale: 1.02 },
        whileTap: { scale: 0.98 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-r from-cyan-400/10 via-pink-400/15 to-cyan-400/10 animate-pulse" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative px-3 py-2 flex items-center justify-between gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "w-8 h-8 rounded-xl bg-gradient-to-br from-cyan-400 to-pink-500 flex items-center justify-center shadow-lg shadow-cyan-500/30",
                    animate: isAnimating ? { rotate: [0, 10, -10, 0] } : {},
                    transition: { duration: 0.2, repeat: isAnimating ? 5 : 0 },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(Vault, { className: "w-4 h-4 text-white" })
                  }
                ),
                canClaim && accumulatedM1U > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full border border-black",
                    animate: { scale: [1, 1.2, 1] },
                    transition: { repeat: Infinity, duration: 1.5 }
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[10px] text-cyan-200/80 font-medium leading-tight", children: "Cashback" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.span,
                    {
                      className: `text-sm font-bold ${isAnimating ? "text-cyan-300" : "text-white"}`,
                      animate: isAnimating ? {
                        color: ["#fff", "#22d3ee", "#f472b6", "#22d3ee", "#fff"]
                      } : {},
                      transition: { duration: 1.2 },
                      children: isLoading ? "..." : `+${displayedValue.toLocaleString()}`
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[10px] text-cyan-300 font-medium", children: "M1U" })
                ] })
              ] })
            ] }),
            canClaim && accumulatedM1U > 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "flex items-center gap-1 px-1.5 py-0.5 bg-green-500/20 rounded-lg",
                whileHover: { scale: 1.05 },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Gift, { className: "w-2.5 h-2.5 text-green-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronRight, { className: "w-2.5 h-2.5 text-green-400" })
                ]
              }
            ) : nextClaimAvailable && nextClaimAvailable > /* @__PURE__ */ new Date() ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-1 px-1.5 py-0.5 bg-gray-500/20 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-2.5 h-2.5 text-gray-400" }) }) : null
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showClaimModal && accumulatedM1U > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        exit: { opacity: 0 },
        onClick: () => setShowClaimModal(false),
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-2xl p-6 max-w-sm w-full border border-cyan-500/30 shadow-2xl",
            initial: { scale: 0.9, opacity: 0 },
            animate: { scale: 1, opacity: 1 },
            exit: { scale: 0.9, opacity: 0 },
            onClick: (e) => e.stopPropagation(),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-16 h-16 rounded-2xl bg-gradient-to-br from-cyan-400 to-pink-500 flex items-center justify-center shadow-xl shadow-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Vault, { className: "w-8 h-8 text-white" }) }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-center text-white mb-2", children: "M1SSION Cashback Vault" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-4xl font-bold bg-gradient-to-r from-cyan-400 to-pink-400 bg-clip-text text-transparent", children: [
                  "+",
                  accumulatedM1U.toLocaleString()
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xl text-cyan-300 ml-2", children: "M1U" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm mt-2", children: "Cashback accumulato pronto per essere riscattato" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.button,
                  {
                    className: "flex-1 py-3 px-4 rounded-xl bg-gray-700 text-white font-medium",
                    whileHover: { scale: 1.02 },
                    whileTap: { scale: 0.98 },
                    onClick: () => setShowClaimModal(false),
                    children: "Annulla"
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.button,
                  {
                    className: `flex-1 py-3 px-4 rounded-xl font-medium flex items-center justify-center gap-2
                    ${canClaim ? "bg-gradient-to-r from-cyan-500 to-pink-500 text-white" : "bg-gray-600 text-gray-400 cursor-not-allowed"}`,
                    whileHover: canClaim ? { scale: 1.02 } : {},
                    whileTap: canClaim ? { scale: 0.98 } : {},
                    onClick: handleClaim,
                    disabled: !canClaim || isClaiming,
                    children: isClaiming ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Gift, { className: "w-4 h-4" }),
                      "Riscatta"
                    ] })
                  }
                )
              ] }),
              !canClaim && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-center text-gray-500 text-xs mt-4", children: !isSunday ? " Il riscatto  disponibile solo di Domenica" : nextClaimAvailable ? `Prossimo riscatto: ${formatNextClaim()}` : "Accumula cashback per riscattare" })
            ]
          }
        )
      }
    ) })
  ] });
};

const AppHome = () => {
  const [error, setError] = reactExports.useState(null);
  const [isLoaded, setIsLoaded] = reactExports.useState(false);
  useProfileImage();
  const isMobile = useIsMobile();
  const [hasAccess, setHasAccess] = reactExports.useState(false);
  const [isCapacitor, setIsCapacitor] = reactExports.useState(false);
  const { hasRole, user, isAuthenticated, isLoading, getCurrentUser } = useUnifiedAuth();
  const [, navigate] = useLocation();
  const {
    notifications,
    unreadCount,
    markAllAsRead,
    deleteNotification,
    notificationsBannerOpen,
    closeNotificationsBanner
  } = useNotificationManager();
  const { isConnected } = useRealTimeNotifications();
  useDeepLinkQR();
  reactExports.useEffect(() => {
    const checkAccess = () => {
      const isCapacitorApp = !!window.Capacitor;
      setIsCapacitor(isCapacitorApp);
      setHasAccess(true);
    };
    checkAccess();
  }, []);
  reactExports.useEffect(() => {
    const timer = setTimeout(() => {
      setIsLoaded(true);
    }, 300);
    return () => clearTimeout(timer);
  }, []);
  reactExports.useEffect(() => {
  }, [isConnected]);
  reactExports.useEffect(() => {
    if (error) {
      ue.error("Si  verificato un errore", {
        description: error,
        position: "bottom-center"
      });
    }
  }, [error]);
  if (!isAuthenticated || isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" });
  }
  if (!user) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-[#070818]", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 border-t-2 border-cyan-400 rounded-full animate-spin mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Inizializzazione utente..." })
    ] }) });
  }
  const isAdmin = hasRole("admin");
  const isDeveloper = hasRole("developer");
  const showPanelButton = isAdmin || isDeveloper;
  if (isMobile && !hasAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(DeveloperAccess, {});
  }
  if (error) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex min-h-screen items-center justify-center bg-[#070818] px-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-8 bg-red-800/30 rounded-xl text-center w-full max-w-sm glass-card", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl sm:text-2xl font-bold mb-4 text-red-300", children: "Errore" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80", children: error }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.button,
        {
          onClick: () => window.location.reload(),
          className: "mt-6 px-6 py-2 bg-gradient-to-r from-red-600 to-red-700 rounded-full text-white btn-hover-effect",
          whileHover: { scale: 1.03 },
          whileTap: { scale: 0.97 },
          children: "Riprova"
        }
      )
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen m1-app-bg relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "m1-grain" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION - Home App" }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-4 space-y-6 relative z-10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isLoaded && /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "relative min-h-screen overflow-y-auto",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        transition: { duration: 0.5 },
        children: [
          notificationsBannerOpen && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, y: -20 },
              animate: { opacity: 1, y: 0 },
              exit: { opacity: 0, y: -20 },
              transition: { duration: 0.3 },
              className: "fixed inset-x-0 z-40 px-2 md:px-4",
              style: {
                top: "calc(72px + 47px + env(safe-area-inset-top, 0px))"
              },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                NotificationsBanner,
                {
                  notifications,
                  open: notificationsBannerOpen,
                  unreadCount,
                  onClose: closeNotificationsBanner,
                  onMarkAllAsRead: markAllAsRead,
                  onDeleteNotification: deleteNotification
                }
              )
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto px-3 pb-20", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                id: "m1u-pill-home-slot",
                "data-onboarding": "m1u-pill",
                className: "fixed z-[70] top-36 left-4 md:top-40 md:left-8",
                initial: { opacity: 0, scale: 0.9, y: -10 },
                animate: { opacity: 1, scale: 1, y: 0 },
                transition: { duration: 0.4 },
                style: { pointerEvents: "auto" },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(M1UPill$1, { showLabel: true, showPlusButton: true })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                "data-onboarding": "streak-pill",
                className: "fixed z-[70] top-48 left-4 md:top-52 md:left-8",
                initial: { opacity: 0, scale: 0.9, y: -10 },
                animate: { opacity: 1, scale: 1, y: 0 },
                transition: { duration: 0.4, delay: 0.1 },
                style: { pointerEvents: "auto" },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(StreakPill, { showLabel: true })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                "data-onboarding": "cashback-pill",
                className: "fixed z-[70] top-36 right-4 md:top-40 md:right-8",
                initial: { opacity: 0, scale: 0.9, y: -10 },
                animate: { opacity: 1, scale: 1, y: 0 },
                transition: { duration: 0.4, delay: 0.12 },
                style: { pointerEvents: "auto" },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(CashbackVaultPill, {})
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "fixed z-[70] top-[13.5rem] right-4 md:top-64 md:right-8",
                initial: { opacity: 0, scale: 0.9, y: -10 },
                animate: { opacity: 1, scale: 1, y: 0 },
                transition: { duration: 0.4, delay: 0.15 },
                style: { pointerEvents: "auto" },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(AgentEnergyPill, {})
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "fixed z-[70] top-[16.5rem] right-4 md:top-80 md:right-8",
                initial: { opacity: 0, scale: 0.9, y: -10 },
                animate: { opacity: 1, scale: 1, y: 0 },
                transition: { duration: 0.4, delay: 0.18 },
                style: { pointerEvents: "auto" },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(PulseBreakerPill, {})
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "relative my-4 sm:my-6 pt-16 text-center",
                initial: { opacity: 0, y: -10 },
                animate: { opacity: 1, y: 0 },
                transition: { delay: 0.2, duration: 0.5 },
                "data-page": "home",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "h1",
                    {
                      id: "m1-home-title",
                      "aria-label": "Centro di Comando Agente M1SSION",
                      className: "sr-only",
                      children: "M1SSION Centro di Comando"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "div",
                    {
                      id: "mission-status-badge-portal",
                      "data-anchor": "m1-header-badge",
                      "data-persistent": "true",
                      className: "flex justify-center my-2 sm:my-3"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 mt-1 sm:mt-2 text-center text-sm sm:text-base", children: "Centro di Comando Agente" })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "main",
              {
                id: "main-content",
                className: "max-w-screen-xl mx-auto",
                role: "main",
                "aria-label": "Contenuto principale",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CommandCenterHome, {}) }),
                  showPanelButton && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      initial: { opacity: 0, y: 20 },
                      animate: { opacity: 1, y: 0 },
                      transition: { delay: 0.8, duration: 0.6 },
                      className: "mt-4",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        motion.button,
                        {
                          onClick: () => navigate("/panel-access"),
                          className: "w-full glass-card p-4 border border-[#4361ee]/30 bg-gradient-to-r from-[#4361ee]/10 to-[#7209b7]/10 rounded-xl group relative overflow-hidden",
                          whileHover: {
                            scale: 1.02,
                            borderColor: "rgba(67, 97, 238, 0.6)"
                          },
                          whileTap: { scale: 0.98 },
                          children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 rounded-xl border border-[#4361ee]/50 animate-pulse group-hover:border-[#4361ee]/80 transition-colors" }),
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative flex items-center justify-center gap-3", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Cpu, { className: "w-5 h-5 text-white" }) }),
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-left", children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-orbitron font-bold", children: [
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#4361ee]", children: "M1SSION" }),
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: " PANEL" }),
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top text-[#7209b7]", children: "" })
                                ] }),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Centro AI Generativo - Accesso Test" })
                              ] }),
                              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "ml-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 rounded-full bg-green-400 animate-pulse" }) })
                            ] }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 rounded-xl bg-gradient-to-r from-[#4361ee]/0 via-[#4361ee]/5 to-[#7209b7]/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300" })
                          ]
                        }
                      )
                    }
                  )
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "fixed bottom-24 left-0 right-0 h-32 pointer-events-none z-[9]",
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              transition: { delay: 0.5, duration: 0.8 },
              style: {
                background: `
                    radial-gradient(ellipse at 50% 100%, rgba(0, 209, 255, 0.18), transparent 70%),
                    radial-gradient(ellipse at 20% 100%, rgba(123, 92, 255, 0.15), transparent 60%),
                    radial-gradient(ellipse at 80% 100%, rgba(240, 89, 255, 0.12), transparent 65%)
                  `,
                filter: "blur(20px)"
              }
            }
          )
        ]
      }
    ) }) })
  ] });
};

const MapTiler3D = React$1.lazy(() => __vitePreload(() => import('./MapTiler3D.B7HciP6X.js'),true?__vite__mapDeps([4,3,2,5,1,6,7,8,9,10]):void 0));
const LivingMap3D = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-[#070818]", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "inline-block animate-spin rounded-full h-12 w-12 border-4 border-[rgba(0,209,255,0.3)] border-t-[rgba(0,209,255,1)] mb-4" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[rgba(0,209,255,0.9)] text-lg", children: "Loading 3D Map..." })
  ] }) }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(MapTiler3D, {}) });
};

const DEBUG_BUZZ = undefined                                    === "1";
const dlog = (...args) => {
};
function useBuzzApi() {
  const handleBuzzPress = async ({ userId, mode, generateMap, coordinates, prizeId, sessionId }) => {
    try {
      if (!userId) {
        return { success: false, error: true, errorMessage: "Devi effettuare l'accesso per utilizzare questa funzione" };
      }
      const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
      if (!uuidRegex.test(userId)) {
        return { success: false, error: true, errorMessage: "ID utente non valido" };
      }
      const functionName = generateMap ? "buzz-map-resolve-v2" : "handle-buzz-press";
      const payload = {};
      if (functionName === "buzz-map-resolve-v2") {
        if (!coordinates) {
          return { success: false, error: true, errorMessage: "Coordinate mancanti per BUZZ MAP" };
        }
        payload.lat = coordinates.lat;
        payload.lng = coordinates.lng;
        if (DEBUG_BUZZ) ;
      } else {
        payload.userId = userId;
        payload.generateMap = generateMap;
        if (mode) {
          payload.mode = mode;
        }
        if (generateMap && coordinates) {
          payload.coordinates = coordinates;
        }
        if (prizeId) payload.prizeId = prizeId;
        if (sessionId) payload.sessionId = sessionId;
      }
      dlog(" [DBG] PAYLOAD", {
        functionName,
        generateMap: payload.generateMap,
        hasLat: "lat" in payload,
        hasLng: "lng" in payload,
        hasCoordinates: "coordinates" in payload
      });
      const { data: sessionData, error: sessionError } = await supabase.auth.getSession();
      const jwt = sessionData?.session?.access_token || "";
      if (!jwt) {
        return { success: false, error: true, errorMessage: "Sessione non valida. Effettua l'accesso nuovamente." };
      }
      const supabaseUrl = supabase.supabaseUrl || "https://vkjrqirvdvjbemsfzxof.supabase.co";
      const functionUrl = `${supabaseUrl}/functions/v1/${functionName}`;
      const response = await fetch(functionUrl, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${jwt}`,
          "apikey": supabase.supabaseKey
        },
        body: JSON.stringify(payload)
      });
      let data = null;
      let error = null;
      if (!response.ok) {
        const errorText = await response.text();
        error = {
          message: `Edge function returned ${response.status}: ${errorText}`,
          status: response.status
        };
      } else {
        data = await response.json();
      }
      dlog(" [DBG] EDGE RESP", {
        ok: !!data?.success,
        mode: data?.mode,
        hasAreaId: !!data?.area_id,
        level: data?.level,
        radius_km: data?.radius_km
      });
      if (DEBUG_BUZZ && data?.mode === "map" && !data?.area_id) ;
      if (generateMap && data?.success && data?.mode === "map" && !data?.area_id) {
        return {
          success: false,
          error: true,
          errorMessage: "Errore server: area non creata correttamente"
        };
      }
      if (error) {
        if (error.message?.includes("daily_quota_exceeded") || error.message?.includes("429")) {
          ue.error("Hai raggiunto il limite giornaliero di 5 BUZZ. Riprova dopo mezzanotte.");
          return { success: false, error: true, errorMessage: "Limite giornaliero raggiunto. Riprova dopo mezzanotte." };
        }
        if (error.details?.includes("daily_quota_exceeded") || error.code === "daily_quota_exceeded") {
          ue.error("Hai raggiunto il limite giornaliero di 5 BUZZ. Riprova dopo mezzanotte.");
          return { success: false, error: true, errorMessage: "Limite giornaliero raggiunto. Riprova dopo mezzanotte." };
        }
        ue.error("Operazione non riuscita, riprova fra poco.");
        return { success: false, error: true, errorMessage: "Operazione non riuscita, riprova fra poco." };
      }
      if (data?.success) {
        if (data.mode === "map") {
          if (!data.area) {
            return { success: false, error: true, errorMessage: "Area non generata" };
          }
        }
        return {
          success: true,
          clue_text: data.clue?.text || data.clue_text,
          // Backward compat
          buzz_cost: data.buzz_cost,
          radius_km: data.area?.radius_km || data.radius_km,
          lat: data.area?.center_lat || data.lat,
          lng: data.area?.center_lng || data.lng,
          area_id: data.area?.id || data.area_id,
          generation_number: data.generation_number,
          map_area: data.map_area,
          precision: data.precision,
          canGenerateMap: data.canGenerateMap,
          remainingMapGenerations: data.remainingMapGenerations
        };
      }
      if (!data) {
        ue.error("Operazione non riuscita. Riprova tra poco.");
        return { success: false, error: true, errorMessage: "Operazione non riuscita. Riprova tra poco." };
      }
      if (!data.success) {
        if (data?.code === "daily_quota_exceeded") {
          ue.error("Hai raggiunto il limite giornaliero di 5 BUZZ. Riprova dopo mezzanotte.");
          return {
            success: false,
            error: true,
            errorMessage: "Limite giornaliero raggiunto. Riprova dopo mezzanotte."
          };
        }
        if (data?.code === "payment_required") {
          ue.error("Pagamento richiesto per utilizzare BUZZ MAPPA.");
          return {
            success: false,
            error: true,
            errorMessage: "Pagamento richiesto per utilizzare BUZZ MAPPA."
          };
        }
        ue.error("Operazione non riuscita. Riprova tra poco.");
        return {
          success: false,
          error: true,
          errorMessage: "Operazione non riuscita. Riprova tra poco."
        };
      }
      return {
        success: true,
        clue_text: data.clue?.text || data.clue_text,
        // Backward compat
        buzz_cost: data.buzz_cost,
        radius_km: data.area?.radius_km || data.radius_km,
        lat: data.area?.center_lat || data.lat,
        lng: data.area?.center_lng || data.lng,
        area_id: data.area?.id || data.area_id,
        generation_number: data.generation_number,
        map_area: data.map_area,
        precision: data.precision,
        canGenerateMap: data.canGenerateMap,
        remainingMapGenerations: data.remainingMapGenerations
      };
    } catch (error) {
      ue.error("Operazione non riuscita. Riprova tra poco.");
      return { success: false, error: true, errorMessage: "Operazione non riuscita. Riprova tra poco." };
    }
  };
  return { callBuzzApi: handleBuzzPress };
}

function useAbuseProtection() {
  const checkAbuseAndLog = async (userId) => {
    try {
      const { data: abuseData } = await supabase.from("abuse_logs").select("*").eq("user_id", userId).eq("event_type", "buzz_press").gte("timestamp", new Date(Date.now() - 3e4).toISOString());
      if (abuseData && abuseData.length >= 5) {
        return {
          isBlocked: true,
          message: "Troppi tentativi. Riprova tra qualche secondo."
        };
      }
      await supabase.from("abuse_logs").insert({
        user_id: userId,
        event_type: "buzz_press"
      });
      return { isBlocked: false };
    } catch (error) {
      return { isBlocked: false };
    }
  };
  return { checkAbuseAndLog };
}

const useBuzzNotificationScheduler = () => {
  const scheduleBuzzNotification = reactExports.useCallback(async (buzzType, cooldownHours = 3) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        return false;
      }
      const scheduledTime = /* @__PURE__ */ new Date();
      scheduledTime.setHours(scheduledTime.getHours() + cooldownHours);
      const { error } = await supabase.functions.invoke("schedule-buzz-notification", {
        body: {
          user_id: user.id,
          buzz_type: buzzType,
          scheduled_time: scheduledTime.toISOString()
        }
      });
      if (error) {
        return false;
      }
      const notificationText = buzzType === "buzz_mappa" ? "BUZZ MAPPA" : "BUZZ";
      return true;
    } catch (error) {
      return false;
    }
  }, []);
  const scheduleBuzzMappaNotification = reactExports.useCallback(() => {
    return scheduleBuzzNotification("buzz_mappa", 3);
  }, [scheduleBuzzNotification]);
  const scheduleBuzzAvailableNotification = reactExports.useCallback(() => {
    return scheduleBuzzNotification("buzz", 3);
  }, [scheduleBuzzNotification]);
  return {
    scheduleBuzzNotification,
    scheduleBuzzMappaNotification,
    scheduleBuzzAvailableNotification
  };
};

const __buzz$1 = globalThis.__buzzToastLock ?? { shown: false, t: 0 };
globalThis.__buzzToastLock = __buzz$1;
function buzzToastOnce(fn, msg, opts) {
  const now = Date.now();
  if (!__buzz$1.shown || now - __buzz$1.t > 2e3) {
    __buzz$1.shown = true;
    __buzz$1.t = now;
    ue[fn]?.(msg, opts);
    setTimeout(() => {
      __buzz$1.shown = false;
    }, 2e3);
  }
}
function useBuzzHandler({ currentPrice, onSuccess, hasFreeBuzz = false, context }) {
  const [buzzing, setBuzzing] = reactExports.useState(false);
  const [showShockwave, setShowShockwave] = reactExports.useState(false);
  const { user } = useAuth();
  const { triggerHaptic } = usePWAHardwareStub();
  const { checkAbuseAndLog } = useAbuseProtection();
  useBuzzNotificationScheduler();
  const { callBuzzApi } = useBuzzApi();
  const { contribute: contributeToPulse } = usePulseContribute();
  const handleBuzz = async () => {
    if (context?.skipServerBuzzPress) {
      return;
    }
    if (!user) {
      ue.error("Devi essere loggato per utilizzare BUZZ!");
      return;
    }
    let hadError = false;
    let buzzToastShown = false;
    try {
      setBuzzing(true);
      setShowShockwave(true);
      await triggerHaptic("buzzUnlocked");
      if (!hasFreeBuzz && (currentPrice < 0 || isNaN(currentPrice))) {
        ue.error("Errore nel calcolo del prezzo BUZZ");
        return;
      }
      const abuseResult = await checkAbuseAndLog(user.id);
      if (abuseResult.isBlocked) {
        ue.error(abuseResult.message);
        return;
      }
      const buzzResult = await callBuzzApi({
        userId: user.id,
        generateMap: false,
        // Regular BUZZ, not map
        coordinates: null,
        prizeId: null,
        sessionId: `buzz_${Date.now()}`
      });
      if (!buzzResult) {
        hadError = true;
        ue.dismiss();
        ue.error("Errore di connessione. Verifica la tua connessione e riprova.");
        return;
      }
      if (buzzResult.error && !buzzResult.clue_text) {
        hadError = true;
        ue.dismiss();
        ue.error(buzzResult.errorMessage || "Errore di rete. Riprova.");
        return;
      }
      if (!buzzResult.success && !buzzResult.clue_text) {
        hadError = true;
        ue.dismiss();
        ue.error(buzzResult.errorMessage || "Errore durante BUZZ");
        return;
      }
      if (buzzResult.clue_text) {
        buzzToastOnce("success", buzzResult.clue_text, {
          duration: 5e3,
          position: "top-center",
          style: {
            background: "linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)",
            color: "white",
            fontWeight: "bold",
            zIndex: 9999
          }
        });
        buzzToastShown = true;
        buzzToastShown = true;
        contributeToPulse("BUZZ_COMPLETED", { price: currentPrice }).catch((err) => {
        });
      } else {
        hadError = true;
        ue.dismiss();
        ue.error("Non sono riuscito a generare l'indizio, riprova fra poco.");
        return;
      }
    } catch (err) {
      hadError = true;
    } finally {
      setBuzzing(false);
      if (hadError && !buzzToastShown) {
        await triggerHaptic("error");
        buzzToastOnce("error", "Non sono riuscito a generare l'indizio, riprova fra poco.");
      }
    }
  };
  return {
    buzzing,
    showShockwave,
    handleBuzz
  };
}

const TronBuzzSkin = ({
  priceDisplay,
  isLoading = false,
  isBlocked = false
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "tron-disc", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "tron-disc-rotating", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `tron-led-ring ${isLoading ? "loading" : ""}` }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-disc-dots" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-disc-dots-sides" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-disc-content", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-loading-spinner" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold text-white/80", style: {
        fontFamily: "Orbitron, sans-serif",
        letterSpacing: "0.1em"
      }, children: "PROCESSING" })
    ] }) : isBlocked ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "svg",
        {
          className: "w-12 h-12 text-white/60",
          fill: "none",
          stroke: "currentColor",
          viewBox: "0 0 24 24",
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "path",
            {
              strokeLinecap: "round",
              strokeLinejoin: "round",
              strokeWidth: 2,
              d: "M12 15v2m0 0v2m0-2h2m-2 0H10m8-6a6 6 0 11-12 0 6 6 0 0112 0z"
            }
          )
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold text-white/60", style: {
        fontFamily: "Orbitron, sans-serif",
        letterSpacing: "0.1em"
      }, children: "BLOCKED" })
    ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-price", children: priceDisplay }) })
  ] });
};

const BuzzButton = ({
  currentPrice,
  isBlocked,
  buzzing,
  onClick
  // All buzz actions are now paid
}) => {
  useXpSystem();
  const priceDisplay = `${currentPrice} M1U`;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.button,
    {
      whileTap: { scale: 0.97 },
      disabled: isBlocked || buzzing,
      onClick,
      className: "relative border-0 bg-transparent p-0 z-20",
      style: {
        cursor: isBlocked || buzzing ? "not-allowed" : "pointer"
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        TronBuzzSkin,
        {
          priceDisplay,
          isLoading: buzzing,
          isBlocked
        }
      )
    }
  );
};

const ShockwaveAnimation = ({ show }) => {
  if (!show) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      className: "absolute w-48 h-48 rounded-full border-4 border-[#F213A4]",
      initial: { scale: 0, opacity: 0.8 },
      animate: { scale: 3.5, opacity: 0 },
      transition: { duration: 0.8, ease: "easeOut" },
      style: {
        zIndex: 10,
        borderWidth: "3px",
        filter: "blur(0.5px)",
        borderColor: "#F213A4"
      }
    },
    Date.now()
  );
};

const getWeekStart = (date = /* @__PURE__ */ new Date()) => {
  const d = new Date(date);
  const day = d.getDay();
  const diff = d.getDate() - day + (day === 0 ? -6 : 1);
  d.setDate(diff);
  d.setHours(0, 0, 0, 0);
  return d.toISOString().split("T")[0];
};
const useTierFreeBuzz = () => {
  const { user } = useUnifiedAuth();
  const [state, setState] = reactExports.useState({
    isLoading: true,
    error: null,
    userTier: "base",
    weekStart: getWeekStart(),
    weeklyLimit: 1,
    freeBuzzUsed: 0,
    freeBuzzRemaining: 1,
    hasFreeBuzz: true,
    canUseFreeBuzz: true
  });
  const loadUserTier = reactExports.useCallback(async () => {
    if (!user?.id) return "base";
    try {
      const { data: subData } = await supabase.from("subscriptions").select("tier").eq("user_id", user.id).eq("status", "active").order("created_at", { ascending: false }).limit(1).maybeSingle();
      if (subData?.tier) {
        return normalizeTier(subData.tier);
      }
      const { data: profileData } = await supabase.from("profiles").select("subscription_tier, tier").eq("id", user.id).maybeSingle();
      if (profileData?.subscription_tier) {
        return normalizeTier(profileData.subscription_tier);
      }
      if (profileData?.tier) {
        return normalizeTier(profileData.tier);
      }
      return "base";
    } catch (err) {
      return "base";
    }
  }, [user?.id]);
  const loadWeeklyState = reactExports.useCallback(async () => {
    if (!user?.id) {
      setState((prev) => ({ ...prev, isLoading: false }));
      return;
    }
    setState((prev) => ({ ...prev, isLoading: true, error: null }));
    try {
      const currentWeekStart = getWeekStart();
      const userTier = await loadUserTier();
      const weeklyLimit = FREE_BUZZ_WEEKLY_BY_TIER[userTier];
      const { data: existingRecord, error: selectError } = await supabase.from("user_buzz_weekly").select("*").eq("user_id", user.id).eq("week_start", currentWeekStart).maybeSingle();
      if (selectError && selectError.code !== "PGRST116") {
        throw selectError;
      }
      let freeBuzzUsed = 0;
      if (existingRecord) {
        freeBuzzUsed = existingRecord.free_buzz_used || 0;
      }
      const freeBuzzRemaining = Math.max(0, weeklyLimit - freeBuzzUsed);
      const hasFreeBuzz = freeBuzzRemaining > 0;
      setState({
        isLoading: false,
        error: null,
        userTier,
        weekStart: currentWeekStart,
        weeklyLimit,
        freeBuzzUsed,
        freeBuzzRemaining,
        hasFreeBuzz,
        canUseFreeBuzz: hasFreeBuzz
      });
    } catch (err) {
      setState((prev) => ({
        ...prev,
        isLoading: false,
        error: err.message || "Errore caricamento stato BUZZ settimanale"
      }));
    }
  }, [user?.id, loadUserTier]);
  const consumeFreeBuzz = reactExports.useCallback(async () => {
    if (!user?.id) {
      return false;
    }
    if (!state.canUseFreeBuzz || state.freeBuzzRemaining <= 0) {
      return false;
    }
    try {
      const currentWeekStart = getWeekStart();
      const newFreeBuzzUsed = state.freeBuzzUsed + 1;
      const { error: upsertError } = await supabase.from("user_buzz_weekly").upsert({
        user_id: user.id,
        week_start: currentWeekStart,
        free_buzz_used: newFreeBuzzUsed,
        tier_snapshot: state.userTier,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }, {
        onConflict: "user_id,week_start"
      });
      if (upsertError) {
        throw upsertError;
      }
      const newRemaining = Math.max(0, state.weeklyLimit - newFreeBuzzUsed);
      setState((prev) => ({
        ...prev,
        freeBuzzUsed: newFreeBuzzUsed,
        freeBuzzRemaining: newRemaining,
        hasFreeBuzz: newRemaining > 0,
        canUseFreeBuzz: newRemaining > 0
      }));
      return true;
    } catch (err) {
      setState((prev) => ({
        ...prev,
        error: err.message || "Errore consumo BUZZ gratuito"
      }));
      return false;
    }
  }, [user?.id, state]);
  const refreshState = reactExports.useCallback(async () => {
    await loadWeeklyState();
  }, [loadWeeklyState]);
  reactExports.useEffect(() => {
    loadWeeklyState();
  }, [loadWeeklyState]);
  return {
    ...state,
    consumeFreeBuzz,
    refreshState
  };
};

const soundCache = {};
const useSoundEffects = () => {
  reactExports.useEffect(() => {
    const soundsToPreload = ["notification", "buzz", "chime", "arcade", "bell", "agentClick", "spacecraftIgnition", "discVortex"];
    soundsToPreload.forEach((sound) => {
      try {
        let path = `/sounds/${sound}.mp3`;
        if (sound === "buzz") {
          path = "/buzz-sound.mp3";
        }
        if (sound === "spacecraftIgnition") {
          path = "/audio/spacecraft-ignition.mp3";
        }
        if (sound === "discVortex") {
          path = "/audio/disc-vortex.mp3";
        }
        const audio = new Audio(path);
        audio.preload = "auto";
        soundCache[sound] = audio;
      } catch (error) {
      }
    });
    return () => {
    };
  }, []);
  const playSound = reactExports.useCallback((sound, volume = 0.5) => {
    try {
      let path = `/sounds/${sound}.mp3`;
      if (sound === "buzz") {
        path = "/buzz-sound.mp3";
      }
      if (sound === "spacecraftIgnition") {
        path = "/audio/spacecraft-ignition.mp3";
      }
      if (sound === "discVortex") {
        path = "/audio/disc-vortex.mp3";
      }
      let audio = soundCache[sound];
      if (!audio) {
        audio = new Audio(path);
        soundCache[sound] = audio;
      }
      audio.currentTime = 0;
      audio.volume = volume;
      const playPromise = audio.play();
      if (playPromise !== void 0) {
        playPromise.catch((error) => {
        });
      }
    } catch (error) {
      ue.error("Impossibile riprodurre il suono");
    }
  }, []);
  return { playSound };
};

const showInsufficientM1UToast = (required, current) => {
  ue.error(
    `Saldo M1U insufficiente`,
    {
      description: `Ti servono ${required} M1U, ma hai solo ${current} M1U. Acquista un pacchetto M1U per continuare.`,
      duration: 5e3,
      action: {
        label: "Acquista M1U",
        onClick: () => {
          window.dispatchEvent(new CustomEvent("open-m1u-shop"));
        }
      }
    }
  );
};

const CTA_COOLDOWN_MS = 5 * 60 * 1e3;
const MISSION_START_DATE = /* @__PURE__ */ new Date("2025-12-19T00:00:00Z");
const SHADOW_PROTOCOL_TIMING = {
  // Minimo tempo in ms tra un evento e il successivo
  MIN_INTERVAL_MS: 9e4,
  // 1.5 minuti
  MAX_INTERVAL_MS: 3e5,
  // 5 minuti
  // Limite massimo eventi per sessione (anti-spam)
  MAX_EVENTS_PER_SESSION: 8,
  //  v7: Reduced min display time for faster UX (was 2000)
  MIN_DISPLAY_MS: 1500,
  // Delay tra eventi concatenati (catene MCP  SHADOW)
  CHAIN_DELAY_MS: 3e3,
  // 3 secondi tra messaggio SHADOW e risposta MCP
  // Delay per trigger contestuali (after BUZZ, map open, etc.)
  CONTEXT_TRIGGER_DELAY_MS: 2e3,
  // 2 secondi dopo evento contestuale
  // v3: First Event Booster - primo evento rapido
  FIRST_EVENT_DELAY_MS: 3e4,
  // 30 secondi per primo evento
  // v3: Timeout fallback per intro bloccato
  INTRO_MAX_DURATION_MS: 12e3,
  // 12 secondi max per intro
  //  v4: Inactivity threshold per diminuire threat
  INACTIVITY_THRESHOLD_MS: 2 * 60 * 60 * 1e3,
  // 2 ore
  //  v4: Finestra per leaderboard frequente (aumenta threat)
  LEADERBOARD_FREQUENT_WINDOW_MS: 10 * 60 * 1e3};
const SHADOW_GLITCH_TIMING = {
  // 3 minuti
  // Durata glitch globale (ms)
  GLOBAL_GLITCH_DURATION_MS: 300,
  // 200-500ms
  // Moltiplicatore per threat level (glitch pi frequenti a threat alto)
  THREAT_GLITCH_MULTIPLIER: {
    LOW: 1.5,
    // 50% pi lento (meno frequente)
    MEDIUM: 1,
    // normale
    HIGH: 0.6
    // 40% pi veloce (pi frequente)
  }};
const SHADOW_EXCLUDED_PATHS = [
  "/login",
  "/register",
  "/subscriptions",
  "/subscriptions/checkout",
  "/kyc",
  "/verification",
  "/terms",
  "/privacy",
  "/cookies",
  "/policies",
  "/mission-intro"
  // Esclusa per non sovrapporre elementi narrativi
];
const SHADOW_PREFERRED_PATHS = [
  "/home",
  "/buzz",
  "/map-3d-tiler",
  "/intelligence",
  "/leaderboard"
];
function getMissionPhase(now = /* @__PURE__ */ new Date()) {
  const diffMs = now.getTime() - MISSION_START_DATE.getTime();
  const weekMs = 7 * 24 * 60 * 60 * 1e3;
  if (diffMs < 0) return 0;
  const weeks = Math.floor(diffMs / weekMs);
  if (weeks === 0) return 1;
  if (weeks === 1) return 2;
  if (weeks === 2) return 3;
  return 4;
}
function getThreatLevelCategory(level) {
  if (level <= 1) return "LOW";
  if (level <= 3) return "MEDIUM";
  return "HIGH";
}
function getWeightMultiplierForThreat(template, threatLevel) {
  const category = getThreatLevelCategory(threatLevel);
  const { entity, intensity, blocking } = template;
  let multiplier = 1;
  switch (category) {
    case "LOW":
      if (entity === "SHADOW") multiplier *= 0.3;
      if (intensity === 3) multiplier *= 0.1;
      if (intensity === 2) multiplier *= 0.5;
      if (blocking) multiplier *= 0.5;
      if (entity === "MCP") multiplier *= 1.3;
      if (entity === "ECHO") multiplier *= 1.2;
      break;
    case "MEDIUM":
      if (entity === "SHADOW") multiplier *= 0.8;
      if (intensity === 3) multiplier *= 0.5;
      if (blocking) multiplier *= 0.8;
      break;
    case "HIGH":
      if (entity === "SHADOW") multiplier *= 1.5;
      if (entity === "MCP") multiplier *= 0.6;
      if (entity === "ECHO") multiplier *= 0.6;
      if (intensity === 1) multiplier *= 0.4;
      if (intensity === 3) multiplier *= 1.3;
      if (blocking) multiplier *= 1.2;
      break;
  }
  return Math.max(0.1, Math.min(2, multiplier));
}
const EVOLUTION_TEXT_MODIFIERS = {
  SHADOW: {
    0: "",
    // Observer - no modifier
    1: "\n\n...interference detected...",
    2: "\n\n PATTERN LOGGED",
    3: "\n\n YOU ARE FULLY MAPPED "
  },
  MCP: {
    0: "",
    1: "\n\nStay focused, Agent.",
    2: "\n\n MCP Shield Active",
    3: "\n\n CRITICAL: ADJUST BEHAVIOR"
  },
  ECHO: {
    0: "",
    1: "\n\n...we sense something...",
    2: "\n\n...they are watching us too...",
    3: "\n\n...signal lost..."
  }
};
function getEvolutionModifiedText(text, entity, evolutionLevel) {
  const modifier = EVOLUTION_TEXT_MODIFIERS[entity][evolutionLevel];
  return modifier ? text + modifier : text;
}
const SHADOW_MESSAGE_TEMPLATES = [
  // =========================================================================
  // WEEK 0  INFILTRAZIONE (Pre-Lancio, attiva da SUBITO)
  // Shadow  gi presente, MCP monitora, Echo osserva
  // =========================================================================
  {
    id: "shadow_infiltration_1",
    entity: "SHADOW",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    text: "[SHADOW//INFILTRATE]\nWe found you before the others, Echo.\nThat is inconvenient."
  },
  {
    id: "shadow_infiltration_2",
    entity: "SHADOW",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[SHADOW//BREACH]\nYour presence was logged.\nBefore you even started."
  },
  {
    id: "mcp_prelaunch_1",
    entity: "MCP",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    text: "[MCP//OVERRIDE: ACTIVE]\nShadow presence detected before launch.\nInitiating countermeasures."
  },
  {
    id: "mcp_prelaunch_2",
    entity: "MCP",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[MCP//PREEMPTIVE]\nAgent, you are not alone.\nShadow has infiltrated the network."
  },
  {
    id: "echo_prelaunch_1",
    entity: "ECHO",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[ECHO//COLLECTIVE]\nWe are watching.\nThe network is awake."
  },
  // =========================================================================
  // WEEK 1  Presenza lieve, solo accenni, quasi tutti MCP
  // =========================================================================
  {
    id: "mcp_entry_1",
    entity: "MCP",
    intensity: 1,
    weekRange: [1, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    text: "[MCP//OVERRIDE: ACTIVE]\nShadow traffic detected.\nStay alert, Agent."
  },
  {
    id: "mcp_entry_2",
    entity: "MCP",
    intensity: 1,
    weekRange: [1, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[MCP//OVERRIDE: ACTIVE]\nEcho interference detected.\nContainment uncertain."
  },
  {
    id: "mcp_entry_3",
    entity: "MCP",
    intensity: 1,
    weekRange: [1, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[MCP//OVERRIDE: ACTIVE]\nGeolocation lock established.\nDo not deviate."
  },
  {
    id: "mcp_scan_1",
    entity: "MCP",
    intensity: 1,
    weekRange: [1, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[MCP//SCAN]\nPerimeter check complete.\nNo anomalies detected for now."
  },
  // =========================================================================
  // WEEK 2  Compare qualche SHADOW, pi aggressivo
  // =========================================================================
  {
    id: "shadow_probe_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [2, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    text: "[SHADOW//PROTOCOL]\nYour route is noisy, Echo.\nWe see your pattern.",
    chainId: "shadow_probe_chain"
  },
  {
    id: "mcp_probe_response",
    entity: "MCP",
    intensity: 2,
    weekRange: [2, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 0,
    // Non selezionato casualmente, solo via chain
    text: "[MCP//COUNTER]\nShadow signal intercepted.\nYour pattern is protected.",
    followsAfterId: "shadow_probe_1"
  },
  {
    id: "shadow_trace_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [2, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[SHADOW//TRACE]\nSignal acquired.\nYou cannot hide from the protocol."
  },
  // =========================================================================
  // WEEK 3  SHADOW disturba, MCP interviene (CATENE)
  // =========================================================================
  {
    id: "shadow_cut_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [3, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[SHADOW//CUT]\nConnection compromised.\nYour advantage is temporary.",
    chainId: "shadow_cut_chain"
  },
  {
    id: "mcp_cut_response",
    entity: "MCP",
    intensity: 2,
    weekRange: [3, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 0,
    text: "[MCP//RESTORE]\nConnection restored.\nShadow interference neutralized.",
    followsAfterId: "shadow_cut_1"
  },
  {
    id: "mcp_counter_1",
    entity: "MCP",
    intensity: 2,
    weekRange: [3, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[MCP//OVERRIDE: ACTIVE]\nShadow signal disrupted.\nYou have a few seconds. Move."
  },
  {
    id: "mcp_defense_1",
    entity: "MCP",
    intensity: 2,
    weekRange: [3, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[MCP//DEFENSE]\nFirewall holding.\nShadow breach contained."
  },
  // =========================================================================
  // WEEK 4  Scontri veri, overlay pi forti
  // =========================================================================
  {
    id: "shadow_hunt_1",
    entity: "SHADOW",
    intensity: 3,
    weekRange: [4, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    text: "[SHADOW//HUNT]\nYou are not hunting prizes.\nYou are being profiled.",
    chainId: "shadow_hunt_chain"
  },
  {
    id: "mcp_hunt_response",
    entity: "MCP",
    intensity: 3,
    weekRange: [4, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 0,
    text: "[MCP//DIRECTIVE]\nProfile compromised.\nInitiating emergency extraction protocol.",
    followsAfterId: "shadow_hunt_1"
  },
  {
    id: "mcp_directive_1",
    entity: "MCP",
    intensity: 3,
    weekRange: [4, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    text: "[MCP//PRIMARY DIRECTIVE]\nShadow Protocol escalation confirmed.\nTrust your coordinates. Distrust everything else."
  },
  {
    id: "shadow_final_1",
    entity: "SHADOW",
    intensity: 3,
    weekRange: [4, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[SHADOW//ENDGAME]\nThe prize was never yours.\nIt was bait."
  },
  // =========================================================================
  // ECHO  Entit collettiva (tutte le settimane)
  // =========================================================================
  {
    id: "echo_whisper_1",
    entity: "ECHO",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 1,
    text: "[ECHO//NETWORK]\nOthers are moving.\nYour silence is a signal too."
  },
  {
    id: "echo_sync_1",
    entity: "ECHO",
    intensity: 1,
    weekRange: [2, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 1,
    text: "[ECHO//SYNC]\nCollective signal rising.\nThe network remembers."
  },
  {
    id: "echo_pulse_1",
    entity: "ECHO",
    intensity: 2,
    weekRange: [3, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 1,
    text: "[ECHO//PULSE]\nWe are many. We are one.\nYour frequency has been logged."
  },
  // =========================================================================
  // TRIGGER CONTESTUALI  BUZZ
  // =========================================================================
  {
    id: "shadow_buzz_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [0, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    trigger: "buzz",
    text: "[SHADOW//INTERCEPT]\nYou weren't supposed to find this.\nNow we know your method."
  },
  {
    id: "mcp_buzz_1",
    entity: "MCP",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    trigger: "buzz",
    text: "[MCP//CONFIRMATION]\nClue verified.\nShadow interference minimal."
  },
  // =========================================================================
  // TRIGGER CONTESTUALI  MAP
  // =========================================================================
  {
    id: "shadow_map_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    trigger: "map",
    text: "[SHADOW//TRACE]\nYour route is compromised.\nWe mapped it before you did."
  },
  {
    id: "mcp_map_1",
    entity: "MCP",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    trigger: "map",
    text: "[MCP//SCAN]\nMap sector analyzed.\nProceed with caution."
  },
  // =========================================================================
  // TRIGGER CONTESTUALI  REWARD
  // =========================================================================
  {
    id: "shadow_reward_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [0, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    trigger: "reward",
    text: "[SHADOW//DISPUTE]\nSTOP.\nThat reward is under protocol dispute."
  },
  {
    id: "mcp_reward_1",
    entity: "MCP",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    trigger: "reward",
    text: "[MCP//VERIFIED]\nReward authenticated.\nShadow claim rejected."
  },
  // =========================================================================
  // TRIGGER CONTESTUALI  LEADERBOARD
  // =========================================================================
  {
    id: "shadow_leaderboard_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 3,
    trigger: "leaderboard",
    text: "[SHADOW//SUSPICION]\nClimbing so fast?\nSuspicious."
  },
  {
    id: "echo_leaderboard_1",
    entity: "ECHO",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    trigger: "leaderboard",
    text: "[ECHO//RANK]\nYour position is noted.\nThe collective watches."
  },
  // =========================================================================
  //  v5: TEMPLATES WITH CTA (Interactive Call-to-Action)
  // =========================================================================
  // CTA  Intelligence (from Map)
  {
    id: "shadow_cta_intelligence_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [0, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    trigger: "map",
    text: "[SHADOW//INTERCEPT]\nYour route is compromised.\nWe tracked your movements.",
    ctaLabel: "CHECK INTELLIGENCE",
    ctaRoute: "/intelligence",
    ctaType: "primary"
  },
  {
    id: "mcp_cta_intelligence_1",
    entity: "MCP",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    trigger: "buzz",
    text: "[MCP//ALERT]\nAnomaly logged near your last BUZZ.\nReview recommended.",
    ctaLabel: "OPEN INTELLIGENCE",
    ctaRoute: "/intelligence",
    ctaType: "secondary"
  },
  // CTA  Map (from Leaderboard/Home)
  {
    id: "shadow_cta_map_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    trigger: "leaderboard",
    text: "[SHADOW//TRACE]\nTheir numbers are rising.\nYour position is vulnerable.",
    ctaLabel: "OPEN MAP",
    ctaRoute: "/map-3d-tiler",
    ctaType: "primary"
  },
  {
    id: "mcp_cta_map_1",
    entity: "MCP",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[MCP//DIRECTIVE]\nNew sector available.\nCoordinates updated.",
    ctaLabel: "CHECK MAP",
    ctaRoute: "/map-3d-tiler",
    ctaType: "secondary"
  },
  // CTA  Leaderboard (from Map/Home)
  {
    id: "echo_cta_leaderboard_1",
    entity: "ECHO",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[ECHO//COLLECTIVE]\nThe network is shifting.\nRankings have changed.",
    ctaLabel: "VIEW RANKINGS",
    ctaRoute: "/leaderboard",
    ctaType: "secondary"
  },
  {
    id: "shadow_cta_leaderboard_1",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [1, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 1,
    trigger: "reward",
    text: "[SHADOW//MONITOR]\nYou claimed a prize.\nNow everyone knows your position.",
    ctaLabel: "CHECK STANDINGS",
    ctaRoute: "/leaderboard",
    ctaType: "primary"
  },
  // CTA  BUZZ (from Intelligence/Home)
  {
    id: "mcp_cta_buzz_1",
    entity: "MCP",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    text: "[MCP//OPPORTUNITY]\nClue signal detected nearby.\nAct before Shadow intercepts.",
    ctaLabel: "START BUZZ",
    ctaRoute: "/buzz",
    ctaType: "primary"
  },
  // =========================================================================
  //  v6: TEMPLATES WITH ADVANCED CTA ACTIONS
  // =========================================================================
  // Highlight BUZZ button
  {
    id: "mcp_highlight_buzz",
    entity: "MCP",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 1,
    text: "[MCP//DIRECTIVE]\nYour next move awaits.\nThe BUZZ button pulses with opportunity.",
    ctaAction: { type: "pulseBuzzButton" }
  },
  // Shadow interrupt for map spam
  {
    id: "shadow_map_interrupt",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [0, 4],
    blocking: true,
    allowOnAllProtectedRoutes: true,
    weight: 0,
    // Not random, triggered programmatically
    trigger: "map",
    text: "[SHADOW//INTERCEPT]\nStop scanning.\nWe already scanned you."
  },
  // Shadow ambition warning (leaderboard spam)
  {
    id: "shadow_ambition_warning",
    entity: "SHADOW",
    intensity: 2,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 2,
    trigger: "leaderboard",
    text: "[SHADOW//OBSERVATION]\nAmbition makes you visible, Echo.\nWe see every rank you climb."
  },
  // Whisper after reward
  {
    id: "shadow_reward_whisper",
    entity: "SHADOW",
    intensity: 1,
    weekRange: [0, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 1,
    trigger: "reward",
    text: "[SHADOW//WHISPER]\nEnjoy it while it lasts.\nNothing is truly yours.",
    ctaAction: { type: "triggerWhisper", message: "We are watching..." }
  },
  // MCP guidance to intelligence
  {
    id: "mcp_intelligence_guidance",
    entity: "MCP",
    intensity: 1,
    weekRange: [1, 4],
    blocking: false,
    allowOnAllProtectedRoutes: true,
    weight: 1,
    text: "[MCP//INTEL]\nNew intercepts available.\nThe Intelligence panel awaits your review.",
    ctaLabel: "REVIEW INTEL",
    ctaRoute: "/intelligence",
    ctaType: "primary",
    ctaAction: { type: "redirect", path: "/intelligence" }
  }
];
const getTemplatesForContext = (context, phase) => {
  return SHADOW_MESSAGE_TEMPLATES.filter(
    (t) => t.trigger === context && t.weekRange[0] <= phase && t.weekRange[1] >= phase && t.weight > 0
    // Escludi template con weight 0 (usati solo per catene)
  );
};
const getChainResponseTemplate = (triggerId) => {
  return SHADOW_MESSAGE_TEMPLATES.find((t) => t.followsAfterId === triggerId) || null;
};

const STORAGE_KEY_THREAT_LEVEL = "m1ssion_shadow_threat_level";
const STORAGE_KEY_THREAT_UPDATED = "m1ssion_shadow_threat_updated";
const STORAGE_KEY_LAST_EVENT_TIME = "m1ssion_shadow_last_event";
const STORAGE_KEY_SESSION_ENTITY_COUNTS = "m1ssion_shadow_entity_counts";
const STORAGE_KEY_LAST_CTA_TIME = "m1ssion_shadow_last_cta";
const STORAGE_KEY_ENTITY_EVOLUTION = "m1ssion_shadow_entity_evolution";
const STORAGE_KEY_EVOLUTION_LAST_UPDATED = "m1ssion_shadow_evolution_updated";
const STORAGE_KEY_BRANCHING_FLAGS = "m1ssion_shadow_branching";
const STORAGE_KEY_RARE_CONSUMED = "m1ssion_shadow_rare_consumed";
function safeGetStorage$1(key, defaultValue) {
  if (typeof window === "undefined") return defaultValue;
  try {
    const stored = localStorage.getItem(key);
    if (stored === null) return defaultValue;
    return JSON.parse(stored);
  } catch {
    return defaultValue;
  }
}
function safeSetStorage$1(key, value) {
  if (typeof window === "undefined") return;
  try {
    localStorage.setItem(key, JSON.stringify(value));
  } catch {
  }
}
const MAX_RECENT_EVENTS = 10;
const DEFAULT_THREAT_LEVEL = 1;
function loadInitialThreatLevel() {
  const stored = safeGetStorage$1(STORAGE_KEY_THREAT_LEVEL, DEFAULT_THREAT_LEVEL);
  if (typeof stored !== "number" || isNaN(stored)) return DEFAULT_THREAT_LEVEL;
  return Math.max(0, Math.min(5, stored));
}
function loadInitialThreatUpdated() {
  return safeGetStorage$1(STORAGE_KEY_THREAT_UPDATED, null);
}
function loadInitialLastEventTime() {
  return safeGetStorage$1(STORAGE_KEY_LAST_EVENT_TIME, 0);
}
function loadInitialEntityCounts() {
  return safeGetStorage$1(STORAGE_KEY_SESSION_ENTITY_COUNTS, {
    MCP: 0,
    SHADOW: 0,
    ECHO: 0
  });
}
function loadInitialLastCtaTime() {
  return safeGetStorage$1(STORAGE_KEY_LAST_CTA_TIME, null);
}
const DEFAULT_EVOLUTION = {
  SHADOW: 0,
  MCP: 0,
  ECHO: 0
};
const DEFAULT_BRANCHING_FLAGS = {
  lastShadowWarningAt: null,
  lastShadowWarningRoute: null,
  lastUserFollowedHintAt: null,
  fastDismissCount: 0,
  lastFastDismissAt: null,
  ignoredWarningCount: 0
};
function loadInitialEntityEvolution() {
  const stored = safeGetStorage$1(STORAGE_KEY_ENTITY_EVOLUTION, DEFAULT_EVOLUTION);
  return {
    SHADOW: Math.max(0, Math.min(3, stored?.SHADOW ?? 0)),
    MCP: Math.max(0, Math.min(3, stored?.MCP ?? 0)),
    ECHO: Math.max(0, Math.min(3, stored?.ECHO ?? 0))
  };
}
function loadInitialBranchingFlags() {
  return safeGetStorage$1(STORAGE_KEY_BRANCHING_FLAGS, DEFAULT_BRANCHING_FLAGS);
}
function loadInitialRareConsumed() {
  return safeGetStorage$1(STORAGE_KEY_RARE_CONSUMED, []);
}
const useEntityOverlayStore = create$1((set, get) => ({
  // Stato iniziale
  currentEvent: null,
  isVisible: false,
  eventsShownThisSession: 0,
  lastEventTime: loadInitialLastEventTime(),
  recentEvents: [],
  pendingContextTrigger: null,
  isIntroActive: false,
  introStartTime: null,
  showMissionIntro: false,
  missionIntroMissionId: null,
  pendingChainTriggerId: null,
  // v3: Timer persistente
  nextEventTimestamp: null,
  isFirstEventTriggered: false,
  hasEnteredPreferredRoute: false,
  //  v4: Threat Level System (caricato da localStorage)
  shadowThreatLevel: loadInitialThreatLevel(),
  shadowThreatLevelLastUpdated: loadInitialThreatUpdated(),
  lastLeaderboardContextTime: null,
  entityEventCounts: loadInitialEntityCounts(),
  //  v5: Glitch Effects System
  isGlobalGlitchActive: false,
  globalGlitchIntensity: 0,
  isMapGlitchActive: false,
  lastCtaNavigationTime: loadInitialLastCtaTime(),
  //  v8: Entity Evolution System
  entityEvolution: loadInitialEntityEvolution(),
  branchingFlags: loadInitialBranchingFlags(),
  rareTemplatesConsumed: loadInitialRareConsumed(),
  // Mostra overlay con un template
  showOverlay: (template) => {
    const now = Date.now();
    const activeEvent = {
      id: template.id,
      entity: template.entity,
      intensity: template.intensity,
      text: template.text,
      blocking: template.blocking,
      createdAt: now,
      trigger: template.trigger,
      //  v5: CTA fields
      ctaLabel: template.ctaLabel,
      ctaRoute: template.ctaRoute,
      ctaType: template.ctaType
    };
    const historyItem = {
      id: template.id,
      entity: template.entity,
      text: template.text.split("\n")[0],
      // Solo prima riga per compattezza
      timestamp: now
    };
    set((state) => {
      const newEntityCounts = { ...state.entityEventCounts };
      newEntityCounts[template.entity] += 1;
      safeSetStorage$1(STORAGE_KEY_SESSION_ENTITY_COUNTS, newEntityCounts);
      safeSetStorage$1(STORAGE_KEY_LAST_EVENT_TIME, now);
      return {
        currentEvent: activeEvent,
        isVisible: true,
        eventsShownThisSession: state.eventsShownThisSession + 1,
        lastEventTime: now,
        // Aggiungi a cronologia, mantieni max 10
        recentEvents: [historyItem, ...state.recentEvents].slice(0, MAX_RECENT_EVENTS),
        // Se ha chainId, imposta per trigger catena
        pendingChainTriggerId: template.chainId || null,
        //  v4: Aggiorna contatori
        entityEventCounts: newEntityCounts
      };
    });
    if (template.entity === "SHADOW") {
      get().increaseThreat(0.5);
    }
    try {
      __vitePreload(async () => { const {ShadowGlitchEngine} = await Promise.resolve().then(() => shadowGlitchEngine);return { ShadowGlitchEngine }},true?void 0:void 0).then(({ ShadowGlitchEngine }) => {
        ShadowGlitchEngine.onNarrativeEvent({
          entity: template.entity,
          intensity: template.intensity,
          context: template.trigger,
          templateId: template.id
        });
      });
    } catch {
    }
  },
  // Nascondi overlay
  hideOverlay: () => {
    set({
      isVisible: false,
      currentEvent: null
    });
  },
  // Reset sessione (es. al logout)
  resetSession: () => {
    const state = get();
    const hadOnlyMcpEcho = state.entityEventCounts.SHADOW === 0 && (state.entityEventCounts.MCP > 0 || state.entityEventCounts.ECHO > 0);
    if (hadOnlyMcpEcho) {
      const newLevel = Math.max(0, state.shadowThreatLevel - 0.5);
      safeSetStorage$1(STORAGE_KEY_THREAT_LEVEL, newLevel);
      safeSetStorage$1(STORAGE_KEY_THREAT_UPDATED, Date.now());
    }
    const resetCounts = { MCP: 0, SHADOW: 0, ECHO: 0 };
    safeSetStorage$1(STORAGE_KEY_SESSION_ENTITY_COUNTS, resetCounts);
    set({
      isVisible: false,
      currentEvent: null,
      eventsShownThisSession: 0,
      // NON resettare lastEventTime - mantieni per decay
      recentEvents: [],
      pendingContextTrigger: null,
      pendingChainTriggerId: null,
      // v3: Reset timer
      nextEventTimestamp: null,
      isFirstEventTriggered: false,
      hasEnteredPreferredRoute: false,
      isIntroActive: false,
      introStartTime: null,
      //  v4: Reset contatori sessione ma mantieni threat level
      entityEventCounts: resetCounts,
      // Aggiorna threat se sessione senza SHADOW
      shadowThreatLevel: hadOnlyMcpEcho ? Math.max(0, state.shadowThreatLevel - 0.5) : state.shadowThreatLevel
    });
  },
  // Imposta trigger contestuale
  setContextTrigger: (trigger) => {
    set({ pendingContextTrigger: trigger });
    if (trigger === "leaderboard") {
      get().updateLeaderboardContext();
    }
  },
  // Cancella trigger contestuale
  clearContextTrigger: () => {
    set({ pendingContextTrigger: null });
  },
  // Imposta stato intro (disabilita overlay durante intro)
  setIntroActive: (active) => {
    set({
      isIntroActive: active,
      introStartTime: active ? Date.now() : null
    });
  },
  // Imposta pending chain
  setPendingChain: (triggerId) => {
    set({ pendingChainTriggerId: triggerId });
  },
  // Mission Start Sequence - TRIGGER (fullscreen overlay)
  triggerMissionIntro: (missionId) => {
    set({
      showMissionIntro: true,
      missionIntroMissionId: missionId,
      isIntroActive: true,
      introStartTime: Date.now()
    });
  },
  // Mission Start Sequence - CLOSE
  closeMissionIntro: () => {
    set({
      showMissionIntro: false,
      missionIntroMissionId: null,
      isIntroActive: false,
      introStartTime: null
    });
  },
  // v3: Timer actions
  setNextEventTimestamp: (timestamp) => {
    set({ nextEventTimestamp: timestamp });
  },
  markFirstEventTriggered: () => {
    set({ isFirstEventTriggered: true });
  },
  markPreferredRouteEntered: () => {
    const state = get();
    if (!state.hasEnteredPreferredRoute) {
      set({ hasEnteredPreferredRoute: true });
    }
  },
  // =========================================================================
  //  v4: THREAT LEVEL ACTIONS
  // =========================================================================
  /**
   * setShadowThreatLevel - Imposta il livello di minaccia (clamped 0-5)
   */
  setShadowThreatLevel: (level) => {
    const clampedLevel = Math.round(Math.max(0, Math.min(5, level)) * 10) / 10;
    const now = Date.now();
    safeSetStorage$1(STORAGE_KEY_THREAT_LEVEL, clampedLevel);
    safeSetStorage$1(STORAGE_KEY_THREAT_UPDATED, now);
    set({
      shadowThreatLevel: clampedLevel,
      shadowThreatLevelLastUpdated: now
    });
  },
  /**
   * increaseThreat - Aumenta il livello di minaccia
   * @param delta - Quantit da aggiungere (es. 0.5, 1)
   */
  increaseThreat: (delta) => {
    const state = get();
    const newLevel = Math.round(Math.max(0, Math.min(5, state.shadowThreatLevel + delta)) * 10) / 10;
    const now = Date.now();
    safeSetStorage$1(STORAGE_KEY_THREAT_LEVEL, newLevel);
    safeSetStorage$1(STORAGE_KEY_THREAT_UPDATED, now);
    set({
      shadowThreatLevel: newLevel,
      shadowThreatLevelLastUpdated: now
    });
    try {
      __vitePreload(async () => { const {ShadowGlitchEngine} = await Promise.resolve().then(() => shadowGlitchEngine);return { ShadowGlitchEngine }},true?void 0:void 0).then(({ ShadowGlitchEngine }) => {
        ShadowGlitchEngine.syncFromThreatLevel(newLevel);
      });
    } catch {
    }
  },
  /**
   * decreaseThreat - Diminuisce il livello di minaccia
   * @param delta - Quantit da sottrarre (es. 0.5, 1)
   */
  decreaseThreat: (delta) => {
    const state = get();
    const newLevel = Math.round(Math.max(0, Math.min(5, state.shadowThreatLevel - delta)) * 10) / 10;
    const now = Date.now();
    safeSetStorage$1(STORAGE_KEY_THREAT_LEVEL, newLevel);
    safeSetStorage$1(STORAGE_KEY_THREAT_UPDATED, now);
    set({
      shadowThreatLevel: newLevel,
      shadowThreatLevelLastUpdated: now
    });
  },
  /**
   * checkInactivityDecay - Verifica se applicare decay per inattivit
   * Chiamato all'avvio dell'engine, applica -1 se inattivo > 2 ore
   */
  checkInactivityDecay: () => {
    const state = get();
    const now = Date.now();
    const lastEvent = state.lastEventTime;
    if (!lastEvent || lastEvent === 0) return;
    const timeSinceLastEvent = now - lastEvent;
    if (timeSinceLastEvent >= SHADOW_PROTOCOL_TIMING.INACTIVITY_THRESHOLD_MS) {
      const newLevel = Math.round(Math.max(0, state.shadowThreatLevel - 1) * 10) / 10;
      safeSetStorage$1(STORAGE_KEY_THREAT_LEVEL, newLevel);
      safeSetStorage$1(STORAGE_KEY_THREAT_UPDATED, now);
      safeSetStorage$1(STORAGE_KEY_LAST_EVENT_TIME, now);
      set({
        shadowThreatLevel: newLevel,
        shadowThreatLevelLastUpdated: now,
        lastEventTime: now
      });
    }
  },
  /**
   * updateLeaderboardContext - Traccia accesso leaderboard per aumentare threat
   * Se accesso ripetuto entro 10 minuti, +0.5 threat
   */
  updateLeaderboardContext: () => {
    const state = get();
    const now = Date.now();
    const lastLeaderboard = state.lastLeaderboardContextTime;
    if (lastLeaderboard && now - lastLeaderboard < SHADOW_PROTOCOL_TIMING.LEADERBOARD_FREQUENT_WINDOW_MS) {
      get().increaseThreat(0.5);
    }
    set({ lastLeaderboardContextTime: now });
  },
  // =========================================================================
  //  v5: GLITCH EFFECTS ACTIONS
  // =========================================================================
  /**
   * triggerGlobalGlitch - Attiva effetto glitch globale sulla pagina
   * @param intensity - Intensit 0-1 (default: basata su threat level)
   */
  triggerGlobalGlitch: (intensity) => {
    const state = get();
    const defaultIntensity = state.shadowThreatLevel <= 1 ? 0.3 : state.shadowThreatLevel <= 3 ? 0.6 : 1;
    const finalIntensity = intensity ?? defaultIntensity;
    set({
      isGlobalGlitchActive: true,
      globalGlitchIntensity: finalIntensity
    });
  },
  /**
   * endGlobalGlitch - Termina effetto glitch globale
   */
  endGlobalGlitch: () => {
    set({
      isGlobalGlitchActive: false,
      globalGlitchIntensity: 0
    });
  },
  /**
   * triggerMapGlitch - Attiva effetto glitch sulla mappa
   */
  triggerMapGlitch: () => {
    set({ isMapGlitchActive: true });
  },
  /**
   * endMapGlitch - Termina effetto glitch mappa
   */
  endMapGlitch: () => {
    set({ isMapGlitchActive: false });
  },
  /**
   * canNavigateCta - Verifica se  possibile navigare via CTA (cooldown check)
   */
  canNavigateCta: () => {
    const state = get();
    const now = Date.now();
    if (!state.lastCtaNavigationTime) return true;
    return now - state.lastCtaNavigationTime >= CTA_COOLDOWN_MS;
  },
  /**
   * recordCtaNavigation - Registra navigazione CTA per cooldown
   */
  recordCtaNavigation: () => {
    const now = Date.now();
    safeSetStorage$1(STORAGE_KEY_LAST_CTA_TIME, now);
    set({ lastCtaNavigationTime: now });
  },
  // =========================================================================
  //  v8: ENTITY EVOLUTION SYSTEM ACTIONS
  // =========================================================================
  /**
   * getEntityEvolution - Get current evolution level for an entity
   */
  getEntityEvolution: (entity) => {
    return get().entityEvolution[entity];
  },
  /**
   * increaseEntityEvolution - Increase evolution level for an entity
   * Clamped to 0-3
   */
  increaseEntityEvolution: (entity, delta = 1) => {
    const state = get();
    const currentLevel = state.entityEvolution[entity];
    const newLevel = Math.min(3, currentLevel + delta);
    if (newLevel === currentLevel) return;
    const newEvolution = { ...state.entityEvolution, [entity]: newLevel };
    safeSetStorage$1(STORAGE_KEY_ENTITY_EVOLUTION, newEvolution);
    safeSetStorage$1(STORAGE_KEY_EVOLUTION_LAST_UPDATED, Date.now());
    set({ entityEvolution: newEvolution });
  },
  /**
   * decreaseEntityEvolution - Decrease evolution level for an entity
   * Clamped to 0-3
   */
  decreaseEntityEvolution: (entity, delta = 1) => {
    const state = get();
    const currentLevel = state.entityEvolution[entity];
    const newLevel = Math.max(0, currentLevel - delta);
    if (newLevel === currentLevel) return;
    const newEvolution = { ...state.entityEvolution, [entity]: newLevel };
    safeSetStorage$1(STORAGE_KEY_ENTITY_EVOLUTION, newEvolution);
    safeSetStorage$1(STORAGE_KEY_EVOLUTION_LAST_UPDATED, Date.now());
    set({ entityEvolution: newEvolution });
  },
  /**
   * recordFastDismiss - Record when user dismisses overlay quickly
   * Used for branching behavior detection
   */
  recordFastDismiss: () => {
    const state = get();
    const now = Date.now();
    const newCount = state.branchingFlags.fastDismissCount + 1;
    const newFlags = {
      ...state.branchingFlags,
      fastDismissCount: newCount,
      lastFastDismissAt: now
    };
    safeSetStorage$1(STORAGE_KEY_BRANCHING_FLAGS, newFlags);
    set({ branchingFlags: newFlags });
    if (newCount >= 3 && newCount % 3 === 0) {
      get().increaseEntityEvolution("SHADOW", 1);
    }
  },
  /**
   * recordIgnoredWarning - Record when user ignores a SHADOW warning
   * (e.g., opens map right after SHADOW said "don't")
   */
  recordIgnoredWarning: (route) => {
    const state = get();
    const now = Date.now();
    const newCount = state.branchingFlags.ignoredWarningCount + 1;
    const newFlags = {
      ...state.branchingFlags,
      lastShadowWarningAt: now,
      lastShadowWarningRoute: route,
      ignoredWarningCount: newCount
    };
    safeSetStorage$1(STORAGE_KEY_BRANCHING_FLAGS, newFlags);
    set({ branchingFlags: newFlags });
    get().increaseEntityEvolution("SHADOW", 1);
  },
  /**
   * recordFollowedHint - Record when user follows an MCP/SHADOW hint
   */
  recordFollowedHint: () => {
    const state = get();
    const now = Date.now();
    const newFlags = {
      ...state.branchingFlags,
      lastUserFollowedHintAt: now
    };
    safeSetStorage$1(STORAGE_KEY_BRANCHING_FLAGS, newFlags);
    set({ branchingFlags: newFlags });
    get().increaseEntityEvolution("MCP", 1);
    get().decreaseEntityEvolution("SHADOW", 0.5);
  },
  /**
   * checkEvolutionDecay - Apply decay to evolution levels over time
   * Called periodically or on session start
   */
  checkEvolutionDecay: () => {
    const state = get();
    const lastUpdated = safeGetStorage$1(STORAGE_KEY_EVOLUTION_LAST_UPDATED, null);
    if (!lastUpdated) return;
    const now = Date.now();
    const hoursSinceUpdate = (now - lastUpdated) / (60 * 60 * 1e3);
    if (hoursSinceUpdate >= 4) {
      const decayAmount = Math.min(Math.floor(hoursSinceUpdate / 4), 2);
      if (decayAmount > 0) {
        const newEvolution = {
          SHADOW: Math.max(0, state.entityEvolution.SHADOW - decayAmount),
          MCP: Math.max(0, state.entityEvolution.MCP - decayAmount),
          ECHO: Math.max(0, state.entityEvolution.ECHO - decayAmount)
        };
        safeSetStorage$1(STORAGE_KEY_ENTITY_EVOLUTION, newEvolution);
        safeSetStorage$1(STORAGE_KEY_EVOLUTION_LAST_UPDATED, now);
        set({ entityEvolution: newEvolution });
      }
    }
  },
  /**
   * markRareTemplateConsumed - Mark a rare template as shown
   */
  markRareTemplateConsumed: (templateId) => {
    const state = get();
    if (state.rareTemplatesConsumed.includes(templateId)) return;
    const newConsumed = [...state.rareTemplatesConsumed, templateId];
    safeSetStorage$1(STORAGE_KEY_RARE_CONSUMED, newConsumed);
    set({ rareTemplatesConsumed: newConsumed });
  },
  /**
   * isRareTemplateConsumed - Check if a rare template was already shown
   */
  isRareTemplateConsumed: (templateId) => {
    return get().rareTemplatesConsumed.includes(templateId);
  }
}));
const selectCurrentEvent = (state) => state.currentEvent;
const selectRecentEvents = (state) => state.recentEvents;
const selectShadowThreatLevel = (state) => state.shadowThreatLevel;
const selectEntityEventCounts = (state) => state.entityEventCounts;
const selectIsGlobalGlitchActive = (state) => state.isGlobalGlitchActive;
const selectGlobalGlitchIntensity = (state) => state.globalGlitchIntensity;
function getThreatLevelCategoryFromLevel(level) {
  if (level <= 1) return "LOW";
  if (level <= 3) return "MEDIUM";
  return "HIGH";
}
const notifyShadowContext = async (trigger) => {
  const store = useEntityOverlayStore.getState();
  const threatLevel = store.shadowThreatLevel;
  const threatCategory = getThreatLevelCategoryFromLevel(threatLevel);
  store.setContextTrigger(trigger);
  window.dispatchEvent(new CustomEvent("shadow:contextTrigger", {
    detail: { context: trigger, threatLevel, threatCategory }
  }));
  const { ShadowGlitchEngine } = await __vitePreload(async () => { const { ShadowGlitchEngine } = await Promise.resolve().then(() => shadowGlitchEngine);return { ShadowGlitchEngine }},true?void 0:void 0);
  switch (trigger) {
    case "buzz":
      ShadowGlitchEngine.increaseHeat(10);
      if (threatCategory === "HIGH") {
        setTimeout(() => {
          ShadowGlitchEngine.triggerRandomPageGlitch(0.5);
        }, 500);
      }
      break;
    case "reward":
      store.increaseThreat(1);
      if (threatCategory === "HIGH") {
        setTimeout(async () => {
          await ShadowGlitchEngine.triggerShadowTakeover();
          ShadowGlitchEngine.triggerWhisper("This reward was never yours.");
        }, 1e3);
      } else if (threatCategory === "MEDIUM") {
        setTimeout(() => {
          ShadowGlitchEngine.triggerRandomPageGlitch(0.7);
        }, 500);
      }
      break;
    case "leaderboard":
      ShadowGlitchEngine.increaseHeat(5);
      break;
    case "map":
      ShadowGlitchEngine.increaseHeat(3);
      break;
  }
};
if (typeof window !== "undefined") {
  window.addEventListener("shadow:heatThreatSync", (e) => {
    const { delta, currentHeat } = e.detail;
    const store = useEntityOverlayStore.getState();
    if (store.shadowThreatLevel < 5) {
      store.increaseThreat(delta);
    }
  });
}

const __buzz = globalThis.__buzzToastLock ?? { shown: false, t: 0 };
globalThis.__buzzToastLock = __buzz;
const BuzzActionButton = ({
  isBlocked,
  onSuccess,
  isWalkthroughMode = false
}) => {
  const { user } = useUnifiedAuth();
  const {
    hasFreeBuzz: hasTierFreeBuzz,
    consumeFreeBuzz: consumeTierFreeBuzz,
    freeBuzzRemaining: tierFreeBuzzRemaining,
    userTier,
    weeklyLimit: tierWeeklyLimit
  } = useTierFreeBuzz();
  const { hasFreeBuzz: hasGrantFreeBuzz, consumeFreeBuzz: consumeGrantFreeBuzz, totalRemaining: grantRemaining} = useBuzzGrants();
  const { accrueFromBuzz } = useCashbackWallet();
  const { playSound } = useSoundEffects();
  const { unitsData, refetch: refetchM1U } = useM1UnitsRealtime(user?.id);
  const {
    dailyBuzzCounter,
    getCurrentBuzzCostM1U,
    getCurrentBuzzDisplayCostM1U,
    updateDailyBuzzCounter
  } = useBuzzCounter(user?.id);
  const hasAnyFreeBuzz = hasTierFreeBuzz || hasGrantFreeBuzz;
  const currentCostM1U = hasAnyFreeBuzz ? 0 : getCurrentBuzzCostM1U();
  const currentPriceDisplay = hasAnyFreeBuzz ? "GRATIS" : getCurrentBuzzDisplayCostM1U();
  React$1.useEffect(() => {
  }, [dailyBuzzCounter, userTier, hasTierFreeBuzz, tierFreeBuzzRemaining, tierWeeklyLimit, hasGrantFreeBuzz, grantRemaining, hasAnyFreeBuzz, currentCostM1U, currentPriceDisplay]);
  const { buzzing, showShockwave, handleBuzz } = useBuzzHandler({
    currentPrice: currentCostM1U,
    // Use actual M1U cost for validation
    onSuccess,
    hasFreeBuzz: hasAnyFreeBuzz
    // Combined free buzz check
  });
  const processedFree = reactExports.useRef(false);
  const removeFreeQueryParams = () => {
    try {
      const url = new URL(window.location.href);
      url.searchParams.delete("free");
      url.searchParams.delete("reward");
      window.history.replaceState({}, "", url.pathname + (url.searchParams.toString() ? `?${url.searchParams.toString()}` : ""));
    } catch {
    }
  };
  const redeemFreeBuzz = async () => {
    if (!user) {
      ue.error("Devi essere loggato per usare il BUZZ gratuito");
      return;
    }
    try {
      const { data: consumed, error: consumeErr } = await supabase.rpc("consume_credit", {
        p_user_id: user.id,
        p_credit_type: "buzz",
        p_amount: 1
      });
      if (consumeErr || !consumed) {
        ue.error("Nessun credito BUZZ disponibile");
        return;
      }
      const { data: hbps, error: hbpsErr } = await supabase.functions.invoke("handle-buzz-press", {
        body: {
          user_id: user.id,
          generateMap: false,
          metadata: { free: true, source: "qr_reward_or_xp_reward" }
        }
      });
      if (hbpsErr) {
        ue.error("Errore durante l'uso del BUZZ gratuito");
        return;
      }
      if (hbps?.clue_text) {
        ue.success(hbps.clue_text, {
          duration: 4e3,
          position: "top-center",
          style: {
            zIndex: 9999,
            background: "linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)",
            color: "white",
            fontWeight: "bold"
          }
        });
      } else {
        ue.success("BUZZ gratuito utilizzato!");
      }
      await updateDailyBuzzCounter();
      onSuccess();
    } catch (e) {
      ue.error("Errore durante il riscatto gratuito");
    } finally {
      removeFreeQueryParams();
    }
  };
  reactExports.useEffect(() => {
    if (processedFree.current) return;
    try {
      const params = new URLSearchParams(window.location.search);
      const isFree = params.get("free") === "1";
      if (isFree) {
        processedFree.current = true;
        redeemFreeBuzz();
      }
    } catch {
    }
  }, [user?.id]);
  const handleAction = async () => {
    playSound("spacecraftIgnition", 0.6);
    if (!user) {
      ue.error("Devi essere loggato per utilizzare BUZZ!");
      return;
    }
    if (isWalkthroughMode) {
      await handleBuzz();
      onSuccess();
      return;
    }
    if (hasTierFreeBuzz) {
      const consumed = await consumeTierFreeBuzz();
      if (consumed) {
        await handleBuzz();
        await updateDailyBuzzCounter();
        onSuccess();
        window.dispatchEvent(new CustomEvent("buzzCompleted"));
        notifyShadowContext("buzz");
        if (!__buzz.shown) {
          ue.success(`BUZZ gratuito! (${tierFreeBuzzRemaining - 1}/${tierWeeklyLimit} rimasti)`);
        }
        return;
      }
    }
    if (hasGrantFreeBuzz) {
      const consumed = await consumeGrantFreeBuzz();
      if (consumed) {
        await handleBuzz();
        await updateDailyBuzzCounter();
        onSuccess();
        window.dispatchEvent(new CustomEvent("buzzCompleted"));
        notifyShadowContext("buzz");
        if (!__buzz.shown) {
          ue.success("BUZZ gratuito (premio) utilizzato!");
        }
        return;
      } else {
        ue.error("Errore nell'uso del BUZZ gratuito");
        return;
      }
    }
    const costM1U = getCurrentBuzzCostM1U();
    const currentBalance = unitsData?.balance || 0;
    if (currentBalance < costM1U) {
      showInsufficientM1UToast(costM1U, currentBalance);
      return;
    }
    try {
      const { data: updatedProfile, error: updateError } = await supabase.from("profiles").update({
        m1_units: currentBalance - costM1U,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", user.id).select("m1_units").single();
      if (updateError) {
        ue.error("Errore nel processare il pagamento M1U");
        return;
      }
      if (!updatedProfile) {
        ue.error("Errore nel processare il pagamento M1U");
        return;
      }
      const newBalance = updatedProfile.m1_units;
      await handleBuzz();
      const newCount = await updateDailyBuzzCounter();
      await refetchM1U();
      onSuccess();
      window.dispatchEvent(new CustomEvent("buzzClueCreated", {
        detail: { costM1U, newBalance: updatedProfile.m1_units }
      }));
      window.dispatchEvent(new CustomEvent("buzzCompleted"));
      notifyShadowContext("buzz");
      const costEur = costM1U / 10;
      await accrueFromBuzz({ costEur, tier: userTier });
    } catch (error) {
      ue.error("Errore durante il BUZZ. Riprova.");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative flex flex-col items-center space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      BuzzButton,
      {
        currentPrice: currentCostM1U,
        isBlocked,
        buzzing,
        onClick: handleAction
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(ShockwaveAnimation, { show: showShockwave })
  ] });
};

const BuzzRewardHandler = ({
  onRewardRedeemed
}) => {
  const { user } = useAuthContext();
  const processedRef = reactExports.useRef(false);
  const removeFreeQueryParams = () => {
    try {
      const url = new URL(window.location.href);
      url.searchParams.delete("free");
      url.searchParams.delete("reward");
      window.history.replaceState({}, "", url.pathname + (url.searchParams.toString() ? `?${url.searchParams.toString()}` : ""));
    } catch (e) {
    }
  };
  const redeemFreeBuzz = async () => {
    if (!user?.id) {
      ue.error("Devi essere loggato per usare il BUZZ gratuito");
      removeFreeQueryParams();
      return;
    }
    try {
      const { data: consumed, error: consumeErr } = await supabase.rpc("consume_credit", {
        p_user_id: user.id,
        p_credit_type: "buzz",
        p_amount: 1
      });
      if (consumeErr || !consumed) {
        ue.error("Nessun credito BUZZ disponibile");
        removeFreeQueryParams();
        return;
      }
      ue.success(" BUZZ gratuito riscattato! Ora puoi premere il pulsante BUZZ.", {
        duration: 5e3,
        position: "top-center",
        style: {
          zIndex: 9999,
          background: "linear-gradient(135deg, #00FFFF 0%, #0084FF 100%)",
          color: "white",
          fontWeight: "bold"
        }
      });
      if (onRewardRedeemed) {
        onRewardRedeemed();
      }
    } catch (e) {
      ue.error("Errore durante il riscatto gratuito");
    } finally {
      removeFreeQueryParams();
    }
  };
  reactExports.useEffect(() => {
    if (processedRef.current) return;
    try {
      const params = new URLSearchParams(window.location.search);
      const isFree = params.get("free") === "1";
      const isReward = params.get("reward") === "1";
      if (isFree && isReward) {
        processedRef.current = true;
        redeemFreeBuzz();
      }
    } catch (e) {
    }
  }, [user?.id]);
  return null;
};

const useBuzzStats = () => {
  const [stats, setStats] = reactExports.useState(null);
  const [history, setHistory] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(true);
  const { user } = useAuth();
  const loadBuzzStats = preserveFunctionName(async () => {
    if (!user) {
      setLoading(false);
      return;
    }
    try {
      setLoading(true);
      const { data: todayData } = await supabase.from("user_buzz_counter").select("buzz_count").eq("user_id", user.id).eq("date", (/* @__PURE__ */ new Date()).toISOString().split("T")[0]).maybeSingle();
      const { data: totalData } = await supabase.from("user_buzz_counter").select("buzz_count").eq("user_id", user.id);
      const { data: mapActions } = await supabase.from("buzz_map_actions").select("*").eq("user_id", user.id).order("created_at", { ascending: false }).limit(10);
      const { data: areasData } = await supabase.from("user_map_areas").select("id").eq("user_id", user.id);
      const today_count = todayData?.buzz_count || 0;
      const total_count = totalData?.reduce((sum, day) => sum + day.buzz_count, 0) || 0;
      const areas_unlocked = areasData?.length || 0;
      const credits_spent = mapActions?.reduce((sum, action) => sum + Number(action.cost_eur), 0) || 0;
      setStats({
        today_count,
        total_count,
        areas_unlocked,
        credits_spent
      });
      setHistory(mapActions || []);
    } catch (err) {
      ue.error("Errore nel caricamento statistiche BUZZ");
    } finally {
      setLoading(false);
    }
  });
  reactExports.useEffect(() => {
    loadBuzzStats();
  }, [user]);
  return {
    stats,
    history,
    loading,
    loadBuzzStats
  };
};

function createVortexSound() {
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const osc1 = audioContext.createOscillator();
  const osc2 = audioContext.createOscillator();
  const osc3 = audioContext.createOscillator();
  const gainNode1 = audioContext.createGain();
  const gainNode2 = audioContext.createGain();
  const gainNode3 = audioContext.createGain();
  const masterGain = audioContext.createGain();
  const filter = audioContext.createBiquadFilter();
  filter.type = "bandpass";
  filter.frequency.value = 1200;
  filter.Q.value = 0.8;
  osc1.type = "sine";
  osc1.frequency.value = 220;
  osc2.type = "sine";
  osc2.frequency.value = 330;
  osc3.type = "triangle";
  osc3.frequency.value = 110;
  gainNode1.gain.value = 0.15;
  gainNode2.gain.value = 0.1;
  gainNode3.gain.value = 0.08;
  masterGain.gain.value = 0.3;
  osc1.connect(gainNode1);
  osc2.connect(gainNode2);
  osc3.connect(gainNode3);
  gainNode1.connect(filter);
  gainNode2.connect(filter);
  gainNode3.connect(filter);
  filter.connect(masterGain);
  masterGain.connect(audioContext.destination);
  const lfo1 = audioContext.createOscillator();
  const lfo2 = audioContext.createOscillator();
  const lfoGain1 = audioContext.createGain();
  const lfoGain2 = audioContext.createGain();
  lfo1.frequency.value = 0.7;
  lfo2.frequency.value = 1.3;
  lfoGain1.gain.value = 15;
  lfoGain2.gain.value = 200;
  lfo1.connect(lfoGain1);
  lfoGain1.connect(osc1.frequency);
  lfo2.connect(lfoGain2);
  lfoGain2.connect(filter.frequency);
  let isPlaying = false;
  return {
    audioContext,
    start: () => {
      if (!isPlaying) {
        osc1.start();
        osc2.start();
        osc3.start();
        lfo1.start();
        lfo2.start();
        isPlaying = true;
      }
    },
    stop: () => {
      if (isPlaying) {
        masterGain.gain.exponentialRampToValueAtTime(
          1e-3,
          audioContext.currentTime + 0.3
        );
        setTimeout(() => {
          try {
            osc1.stop();
            osc2.stop();
            osc3.stop();
            lfo1.stop();
            lfo2.stop();
          } catch (e) {
          }
        }, 350);
        isPlaying = false;
      }
    },
    setVolume: (vol) => {
      masterGain.gain.value = Math.max(0, Math.min(1, vol));
    }
  };
}

const checkDebugFlag = () => {
  try {
    const envDebug = undefined                              === "1";
    if (typeof window !== "undefined") {
      const urlParams = new URLSearchParams(window.location.search);
      const urlDebug = urlParams.get("debug") === "1";
      const storageDebug = localStorage.getItem("M1_DEBUG_PANELS") === "1";
      const isEnabled = envDebug || urlDebug || storageDebug;
      if (isEnabled) {
      } else {
      }
      return isEnabled;
    }
    return envDebug;
  } catch (e) {
    return false;
  }
};
const useDebugFlag = () => {
  const [enabled, setEnabled] = reactExports.useState(checkDebugFlag);
  reactExports.useEffect(() => {
    const isEnabled = checkDebugFlag();
    setEnabled(isEnabled);
  }, []);
  return enabled;
};

const CopyJsonButton = ({ data, label = "Copy" }) => {
  const [copied, setCopied] = React$1.useState(false);
  const handleCopy = () => {
    try {
      const json = JSON.stringify(data, null, 2);
      navigator.clipboard.writeText(json);
      setCopied(true);
      ue.success("JSON copiato negli appunti");
      setTimeout(() => setCopied(false), 2e3);
    } catch (e) {
      ue.error("Errore nella copia");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "button",
    {
      onClick: handleCopy,
      style: {
        padding: "4px 8px",
        fontSize: "11px",
        backgroundColor: copied ? "#10b981" : "#3b82f6",
        color: "white",
        border: "none",
        borderRadius: "4px",
        cursor: "pointer",
        display: "flex",
        alignItems: "center",
        gap: "4px"
      },
      children: [
        copied ? /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { size: 12 }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Copy, { size: 12 }),
        label
      ]
    }
  );
};

const DebugBuzzPanel = () => {
  const { user, session, isAuthenticated } = useUnifiedAuth();
  const { hasFreeBuzz, totalRemaining } = useBuzzGrants();
  const { getCurrentBuzzCostM1U } = useBuzzCounter(user?.id);
  const [collapsed, setCollapsed] = reactExports.useState(true);
  const [diagnostics, setDiagnostics] = reactExports.useState(null);
  const [lastResult, setLastResult] = reactExports.useState(null);
  const getJwtInfo = () => {
    if (!session?.access_token) return { len: 0, exp: null };
    try {
      const parts = session.access_token.split(".");
      if (parts.length !== 3) return { len: 0, exp: null };
      const payload = JSON.parse(atob(parts[1]));
      return {
        len: session.access_token.length,
        exp: payload.exp ? new Date(payload.exp * 1e3).toISOString() : null
      };
    } catch (e) {
      return { len: session.access_token.length, exp: null };
    }
  };
  const runDiagnostics = async () => {
    try {
      const { data, error } = await supabase.functions.invoke("get-user-state", {
        body: { userId: user?.id },
        headers: { "x-m1-debug": "1" }
      });
      const jwtInfo = getJwtInfo();
      const origin = window.location.origin;
      const diag = {
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        auth: {
          isAuthenticated,
          userId: user?.id?.substring(0, 8) + "...",
          jwtLen: jwtInfo.len,
          jwtExp: jwtInfo.exp
        },
        economy: {
          hasFreeBuzz,
          totalRemaining,
          currentCostM1U: getCurrentBuzzCostM1U()
        },
        network: {
          origin,
          endpoint: "handle-buzz-press"
        },
        corsCheck: {
          success: !error,
          debugInfo: data?.__debug || null,
          error: error?.message || null
        }
      };
      setDiagnostics(diag);
    } catch (e) {
      setDiagnostics({ error: e.message });
    }
  };
  const testBuzzDry = async () => {
    try {
      const { data, error } = await supabase.functions.invoke("handle-buzz-press", {
        body: {
          hasFreeBuzz,
          currentPrice: getCurrentBuzzCostM1U(),
          dryRun: true
        },
        headers: { "x-m1-debug": "1" }
      });
      const result = {
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        success: !error,
        data,
        error: error?.message || null
      };
      setLastResult(result);
    } catch (e) {
      setLastResult({ error: e.message });
    }
  };
  reactExports.useEffect(() => {
    if (isAuthenticated && user) {
      runDiagnostics();
    }
  }, [isAuthenticated, user]);
  if (!isAuthenticated) return null;
  const panel = /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      style: {
        position: "fixed",
        bottom: "80px",
        left: "10px",
        backgroundColor: "rgba(0, 0, 0, 0.95)",
        color: "#fff",
        padding: collapsed ? "8px" : "12px",
        borderRadius: "8px",
        fontSize: "11px",
        zIndex: 2147483e3,
        maxWidth: "320px",
        maxHeight: collapsed ? "40px" : "60vh",
        overflow: "auto",
        fontFamily: "monospace",
        border: "1px solid #3b82f6"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            onClick: () => setCollapsed(!collapsed),
            style: {
              cursor: "pointer",
              display: "flex",
              alignItems: "center",
              justifyContent: "space-between",
              fontWeight: "bold",
              marginBottom: collapsed ? 0 : "8px"
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: " BUZZ DEBUG" }),
              collapsed ? /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronUp, { size: 16 }) : /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { size: 16 })
            ]
          }
        ),
        !collapsed && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "Auth & Session" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Auth: ",
              isAuthenticated ? "" : ""
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "User ID: ",
              user?.id?.substring(0, 12),
              "..."
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "JWT Len: ",
              getJwtInfo().len
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "JWT Exp: ",
              getJwtInfo().exp?.substring(11, 19) || "N/A"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "Economy" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Free BUZZ: ",
              hasFreeBuzz ? "" : ""
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Remaining: ",
              totalRemaining
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Cost M1U: ",
              getCurrentBuzzCostM1U()
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "Network" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Origin: ",
              window.location.origin.substring(0, 30),
              "..."
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: "Endpoint: handle-buzz-press" })
          ] }),
          diagnostics && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "CORS Check" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Status: ",
              diagnostics.corsCheck?.success ? "" : ""
            ] }),
            diagnostics.corsCheck?.debugInfo && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                "Saw Auth: ",
                diagnostics.corsCheck.debugInfo.sawAuthorizationHeader ? "" : ""
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                "JWT Len: ",
                diagnostics.corsCheck.debugInfo.jwtLen
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                "Allowed Origin: ",
                diagnostics.corsCheck.debugInfo.allowedOrigin?.substring(0, 25) || "N/A"
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CopyJsonButton, { data: diagnostics, label: "Copy Full" })
          ] }),
          lastResult && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "Last Test" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Success: ",
              lastResult.success ? "" : ""
            ] }),
            lastResult.data?.clue_text && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Clue: ",
              lastResult.data.clue_text.substring(0, 30),
              "..."
            ] }),
            lastResult.error && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { color: "#ef4444" }, children: [
              "Error: ",
              lastResult.error
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CopyJsonButton, { data: lastResult, label: "Copy Result" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { display: "flex", gap: "4px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: runDiagnostics,
                style: {
                  padding: "4px 8px",
                  fontSize: "10px",
                  backgroundColor: "#8b5cf6",
                  color: "white",
                  border: "none",
                  borderRadius: "4px",
                  cursor: "pointer"
                },
                children: "Refresh"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: testBuzzDry,
                style: {
                  padding: "4px 8px",
                  fontSize: "10px",
                  backgroundColor: "#10b981",
                  color: "white",
                  border: "none",
                  borderRadius: "4px",
                  cursor: "pointer"
                },
                children: "Test BUZZ"
              }
            )
          ] })
        ] })
      ]
    }
  );
  return typeof document !== "undefined" ? reactDomExports.createPortal(panel, document.body) : panel;
};

const BuzzPage = () => {
  const { stats, loading, loadBuzzStats } = useBuzzStats();
  const { user, isLoading: authLoading } = useUnifiedAuth();
  useSoundEffects();
  const vortexSoundRef = reactExports.useRef(null);
  const debugEnabled = useDebugFlag();
  const [forceShow, setForceShow] = React$1.useState(false);
  const {
    dailyBuzzCounter,
    getCurrentBuzzDisplayCostM1U,
    loadDailyBuzzCounter
    //  ADD THIS for force refresh
  } = useBuzzCounter(user?.id);
  const isBlocked = false;
  const currentPriceDisplay = getCurrentBuzzDisplayCostM1U();
  reactExports.useEffect(() => {
    const timeout = setTimeout(() => {
      if (loading || authLoading) {
        setForceShow(true);
      }
    }, 3e3);
    return () => clearTimeout(timeout);
  }, [loading, authLoading]);
  reactExports.useEffect(() => {
    const handleBeforeUnload = (e) => {
    };
    window.addEventListener("beforeunload", handleBeforeUnload);
    return () => window.removeEventListener("beforeunload", handleBeforeUnload);
  }, []);
  reactExports.useEffect(() => {
    let mounted = true;
    const timer = setTimeout(() => {
      if (!mounted) return;
      try {
        const vortex = createVortexSound();
        if (!mounted) {
          vortex.stop();
          return;
        }
        vortexSoundRef.current = vortex;
        vortex.setVolume(0.25);
        vortex.start();
      } catch (error) {
      }
    }, 200);
    return () => {
      mounted = false;
      clearTimeout(timer);
      if (vortexSoundRef.current) {
        vortexSoundRef.current.stop();
        vortexSoundRef.current = null;
      }
    };
  }, []);
  const handleBuzzSuccess = async () => {
    loadDailyBuzzCounter();
    loadBuzzStats();
  };
  reactExports.useEffect(() => {
    const handleBuzzCompleted = () => {
      loadDailyBuzzCounter();
      loadBuzzStats();
    };
    window.addEventListener("buzzCompleted", handleBuzzCompleted);
    return () => window.removeEventListener("buzzCompleted", handleBuzzCompleted);
  }, [loadDailyBuzzCounter, loadBuzzStats]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-[#070818] w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative",
        paddingTop: "env(safe-area-inset-top, 47px)",
        paddingBottom: "env(safe-area-inset-bottom, 0px)",
        paddingLeft: "env(safe-area-inset-left, 0px)",
        paddingRight: "env(safe-area-inset-right, 0px)"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(BuzzRewardHandler, { onRewardRedeemed: handleBuzzSuccess }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "fixed top-24 left-0 right-0 h-32 pointer-events-none z-[9]",
            style: {
              background: `
            radial-gradient(ellipse at 50% 0%, rgba(0, 209, 255, 0.18), transparent 70%),
            radial-gradient(ellipse at 20% 0%, rgba(123, 92, 255, 0.15), transparent 60%),
            radial-gradient(ellipse at 80% 0%, rgba(240, 89, 255, 0.12), transparent 65%)
          `,
              filter: "blur(20px)"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "main",
          {
            style: {
              paddingTop: "calc(119px + env(safe-area-inset-top, 0px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto px-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "div",
                {
                  id: "m1u-pill-buzz-slot",
                  className: "fixed z-[1000] flex items-center gap-2",
                  style: {
                    top: "calc(env(safe-area-inset-top, 0px) + 96px)",
                    left: "max(1rem, env(safe-area-inset-left, 0px))",
                    pointerEvents: "auto"
                  },
                  "aria-hidden": false,
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(M1UPill$1, { showLabel: true, showPlusButton: true })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center justify-center min-h-[calc(100vh-200px)]", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mb-6", "data-onboarding": "buzz-button", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  BuzzActionButton,
                  {
                    isBlocked,
                    onSuccess: handleBuzzSuccess
                  }
                ) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  "div",
                  {
                    className: "m1-relief p-4 sm:p-6 mb-6 max-w-3xl w-full mx-4 relative overflow-hidden",
                    style: {
                      borderRadius: "24px"
                    },
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "div",
                        {
                          className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                          style: {
                            animation: "slideGlowBuzz 3s ease-in-out infinite",
                            width: "200%",
                            left: "-100%"
                          }
                        }
                      ) }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
                @keyframes slideGlowBuzz {
                  0% { transform: translateX(0); }
                  50% { transform: translateX(50%); }
                  100% { transform: translateX(0); }
                }
              ` }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-white/80 space-y-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Premi il pulsante per inviare un segnale e scoprire nuovi indizi. Ogni Buzz ti aiuta a trovare indizi nascosti per raggiungere l'obiettivo di 250 indizi totali." }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "font-semibold", children: [
                          "BUZZ oggi: ",
                          dailyBuzzCounter,
                          " (prezzo progressivo)"
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "font-semibold", children: [
                          "BUZZ totali: ",
                          stats?.total_count || 0,
                          "/250 (target finale)"
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-[#00ffff]", children: [
                          "Prossimo: ",
                          currentPriceDisplay
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-white/60 flex items-center gap-1", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx(
                            "span",
                            {
                              className: "inline-flex w-4 h-4 rounded-full items-center justify-center text-[8px] font-bold",
                              style: {
                                background: "linear-gradient(135deg, #FFD700 0%, #FFA500 100%)",
                                color: "#1a1a1a",
                                boxShadow: "0 0 6px rgba(255, 215, 0, 0.6)"
                              },
                              children: "M1"
                            }
                          ),
                          "Ogni BUZZ consuma M1U dal tuo saldo"
                        ] })
                      ] }) })
                    ]
                  }
                )
              ] })
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "fixed bottom-24 left-0 right-0 h-32 pointer-events-none z-[9]",
            style: {
              background: `
            radial-gradient(ellipse at 50% 100%, rgba(0, 209, 255, 0.18), transparent 70%),
            radial-gradient(ellipse at 20% 100%, rgba(123, 92, 255, 0.15), transparent 60%),
            radial-gradient(ellipse at 80% 100%, rgba(240, 89, 255, 0.12), transparent 65%)
          `,
              filter: "blur(20px)"
            }
          }
        ),
        debugEnabled && /* @__PURE__ */ jsxRuntimeExports.jsx(DebugBuzzPanel, {})
      ]
    }
  );
};

const PALETTE = {
  A: { h: 350, s: 85, l: 60 },
  // Magenta caldo
  E: { h: 280, s: 70, l: 65 },
  // Viola
  I: { h: 200, s: 80, l: 60 },
  // Ciano
  O: { h: 20, s: 90, l: 65 },
  // Arancio
  U: { h: 160, s: 75, l: 60 },
  // Verde acqua
  M: { h: 330, s: 60, l: 55 },
  // Rosa scuro
  X: { h: 210, s: 25, l: 12 }
  // Idle (blu profondo)
};
const simplex3D = (x, y, z) => {
  const p = [151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10, 23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208, 89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123, 5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119, 248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232, 178, 185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249, 14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254, 138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180];
  const perm = [...p, ...p];
  const F3 = 1 / 3;
  const G3 = 1 / 6;
  let s = (x + y + z) * F3;
  let i = Math.floor(x + s);
  let j = Math.floor(y + s);
  let k = Math.floor(z + s);
  let t = (i + j + k) * G3;
  let X0 = i - t;
  let Y0 = j - t;
  let Z0 = k - t;
  let x0 = x - X0;
  let y0 = y - Y0;
  let z0 = z - Z0;
  let i1, j1, k1, i2, j2, k2;
  if (x0 >= y0) {
    if (y0 >= z0) {
      i1 = 1;
      j1 = 0;
      k1 = 0;
      i2 = 1;
      j2 = 1;
      k2 = 0;
    } else if (x0 >= z0) {
      i1 = 1;
      j1 = 0;
      k1 = 0;
      i2 = 1;
      j2 = 0;
      k2 = 1;
    } else {
      i1 = 0;
      j1 = 0;
      k1 = 1;
      i2 = 1;
      j2 = 0;
      k2 = 1;
    }
  } else {
    if (y0 < z0) {
      i1 = 0;
      j1 = 0;
      k1 = 1;
      i2 = 0;
      j2 = 1;
      k2 = 1;
    } else if (x0 < z0) {
      i1 = 0;
      j1 = 1;
      k1 = 0;
      i2 = 0;
      j2 = 1;
      k2 = 1;
    } else {
      i1 = 0;
      j1 = 1;
      k1 = 0;
      i2 = 1;
      j2 = 1;
      k2 = 0;
    }
  }
  let x1 = x0 - i1 + G3;
  let y1 = y0 - j1 + G3;
  let z1 = z0 - k1 + G3;
  let x2 = x0 - i2 + 2 * G3;
  let y2 = y0 - j2 + 2 * G3;
  let z2 = z0 - k2 + 2 * G3;
  let x3 = x0 - 1 + 3 * G3;
  let y3 = y0 - 1 + 3 * G3;
  let z3 = z0 - 1 + 3 * G3;
  let ii = i & 255;
  let jj = j & 255;
  let kk = k & 255;
  const grad3 = [[1, 1, 0], [-1, 1, 0], [1, -1, 0], [-1, -1, 0], [1, 0, 1], [-1, 0, 1], [1, 0, -1], [-1, 0, -1], [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1]];
  const dot3 = (g, x4, y4, z4) => g[0] * x4 + g[1] * y4 + g[2] * z4;
  let gi0 = perm[ii + perm[jj + perm[kk]]] % 12;
  let gi1 = perm[ii + i1 + perm[jj + j1 + perm[kk + k1]]] % 12;
  let gi2 = perm[ii + i2 + perm[jj + j2 + perm[kk + k2]]] % 12;
  let gi3 = perm[ii + 1 + perm[jj + 1 + perm[kk + 1]]] % 12;
  let n0 = 0, n1 = 0, n2 = 0, n3 = 0;
  let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;
  if (t0 >= 0) {
    t0 *= t0;
    n0 = t0 * t0 * dot3(grad3[gi0], x0, y0, z0);
  }
  let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;
  if (t1 >= 0) {
    t1 *= t1;
    n1 = t1 * t1 * dot3(grad3[gi1], x1, y1, z1);
  }
  let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;
  if (t2 >= 0) {
    t2 *= t2;
    n2 = t2 * t2 * dot3(grad3[gi2], x2, y2, z2);
  }
  let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;
  if (t3 >= 0) {
    t3 *= t3;
    n3 = t3 * t3 * dot3(grad3[gi3], x3, y3, z3);
  }
  return 32 * (n0 + n1 + n2 + n3);
};
const AionEntity = reactExports.forwardRef(({
  className = "",
  intensity = 1,
  idleSpeed = 0.7
}, ref) => {
  const containerRef = reactExports.useRef(null);
  const sceneRef = reactExports.useRef(null);
  const cameraRef = reactExports.useRef(null);
  const rendererRef = reactExports.useRef(null);
  const meshRef = reactExports.useRef(null);
  const animationFrameRef = reactExports.useRef(null);
  const timeRef = reactExports.useRef(0);
  const [currentColor, setCurrentColor] = reactExports.useState(PALETTE.X);
  const [isPlaying, setIsPlaying] = reactExports.useState(false);
  const visemeQueueRef = reactExports.useRef([]);
  const playStartTimeRef = reactExports.useRef(0);
  reactExports.useEffect(() => {
    if (!containerRef.current) return;
    const container = containerRef.current;
    const width = container.clientWidth;
    const height = container.clientHeight;
    const scene = new Scene();
    sceneRef.current = scene;
    const camera = new PerspectiveCamera(45, width / height, 0.1, 1e3);
    camera.position.z = 4;
    cameraRef.current = camera;
    const renderer = new WebGLRenderer({
      antialias: true,
      alpha: true,
      powerPreference: "high-performance"
    });
    renderer.setSize(width, height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setClearColor(0, 0);
    container.appendChild(renderer.domElement);
    rendererRef.current = renderer;
    const geometry = new IcosahedronGeometry(1.2, 8);
    const originalPositions = geometry.attributes.position.array.slice();
    const material = new MeshStandardMaterial({
      color: new Color(`hsl(${PALETTE.X.h}, ${PALETTE.X.s}%, ${PALETTE.X.l}%)`),
      emissive: new Color(`hsl(${PALETTE.X.h}, ${PALETTE.X.s}%, ${PALETTE.X.l * 0.3}%)`),
      emissiveIntensity: 0.5,
      metalness: 0.3,
      roughness: 0.7,
      wireframe: false,
      transparent: true,
      opacity: 0.9
    });
    const mesh = new Mesh(geometry, material);
    scene.add(mesh);
    meshRef.current = mesh;
    const ambientLight = new AmbientLight(4210752, 0.5);
    scene.add(ambientLight);
    const pointLight1 = new PointLight(54527, 1, 100);
    pointLight1.position.set(5, 5, 5);
    scene.add(pointLight1);
    const pointLight2 = new PointLight(15864740, 0.8, 100);
    pointLight2.position.set(-5, -5, 5);
    scene.add(pointLight2);
    const animate = () => {
      timeRef.current += 0.01 * idleSpeed;
      const time = timeRef.current;
      if (meshRef.current) {
        meshRef.current.rotation.x = Math.sin(time * 0.3) * 0.1;
        meshRef.current.rotation.y += 5e-3;
        const positions = meshRef.current.geometry.attributes.position.array;
        for (let i = 0; i < positions.length; i += 3) {
          const ox = originalPositions[i];
          const oy = originalPositions[i + 1];
          const oz = originalPositions[i + 2];
          const noise = simplex3D(
            ox * 2 + time,
            oy * 2 + time * 0.5,
            oz * 2 + time * 0.3
          ) * 0.15 * intensity;
          const len = Math.sqrt(ox * ox + oy * oy + oz * oz);
          const scale = 1 + noise;
          positions[i] = ox / len * len * scale;
          positions[i + 1] = oy / len * len * scale;
          positions[i + 2] = oz / len * len * scale;
        }
        meshRef.current.geometry.attributes.position.needsUpdate = true;
        const mat = meshRef.current.material;
        const targetColor = new Color(
          `hsl(${currentColor.h}, ${currentColor.s}%, ${currentColor.l}%)`
        );
        mat.color.lerp(targetColor, 0.1);
        mat.emissive.lerp(
          new Color(`hsl(${currentColor.h}, ${currentColor.s}%, ${currentColor.l * 0.4}%)`),
          0.1
        );
      }
      if (isPlaying && visemeQueueRef.current.length > 0) {
        const elapsed = Date.now() - playStartTimeRef.current;
        const currentViseme = visemeQueueRef.current.find((v) => v.t <= elapsed);
        if (currentViseme) {
          const palette = PALETTE[currentViseme.v.toUpperCase()] || PALETTE.X;
          setCurrentColor(palette);
          visemeQueueRef.current = visemeQueueRef.current.filter((v) => v.t > elapsed);
        }
        if (visemeQueueRef.current.length === 0) {
          setIsPlaying(false);
          setCurrentColor(PALETTE.X);
        }
      }
      renderer.render(scene, camera);
      animationFrameRef.current = requestAnimationFrame(animate);
    };
    animate();
    const handleResize = () => {
      if (!containerRef.current || !cameraRef.current || !rendererRef.current) return;
      const w = containerRef.current.clientWidth;
      const h = containerRef.current.clientHeight;
      cameraRef.current.aspect = w / h;
      cameraRef.current.updateProjectionMatrix();
      rendererRef.current.setSize(w, h);
    };
    window.addEventListener("resize", handleResize);
    return () => {
      window.removeEventListener("resize", handleResize);
      if (animationFrameRef.current) {
        cancelAnimationFrame(animationFrameRef.current);
      }
      if (rendererRef.current && container.contains(rendererRef.current.domElement)) {
        container.removeChild(rendererRef.current.domElement);
      }
      geometry.dispose();
      material.dispose();
      renderer.dispose();
    };
  }, [intensity, idleSpeed]);
  reactExports.useImperativeHandle(ref, () => ({
    play(visemes, opts) {
      visemeQueueRef.current = [...visemes].sort((a, b) => a.t - b.t);
      playStartTimeRef.current = Date.now();
      setIsPlaying(true);
    },
    stop() {
      visemeQueueRef.current = [];
      setIsPlaying(false);
      setCurrentColor(PALETTE.X);
    },
    idle() {
      visemeQueueRef.current = [];
      setIsPlaying(false);
      setCurrentColor(PALETTE.X);
    }
  }));
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      ref: containerRef,
      className: `w-full h-full ${className}`,
      style: { minHeight: "280px" }
    }
  );
});
AionEntity.displayName = "AionEntity";

let globalAudioElement = null;
let isGlobalAudioUnlocked = false;
const getGlobalAudioElement = () => {
  if (!globalAudioElement) {
    globalAudioElement = document.createElement("audio");
    globalAudioElement.playsInline = true;
    globalAudioElement.webkitPlaysinline = true;
    globalAudioElement.preload = "auto";
  }
  return globalAudioElement;
};
const setupiOSUnlock = () => {
  if (isGlobalAudioUnlocked) return;
  const audio = getGlobalAudioElement();
  const silentMp3 = "data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYoRwmHAAAAAAD/+1DEAAAGAAGn9AAAIgAANP8AAABMQVNFKDM0ODM0NSlNAAAATkVXUwAAAABMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//tQxBgAAADSAAAAAAAAANIAAAAA";
  const unlockHandler = async () => {
    if (isGlobalAudioUnlocked) return;
    try {
      audio.src = silentMp3;
      audio.volume = 0.01;
      await audio.play();
      audio.pause();
      audio.currentTime = 0;
      isGlobalAudioUnlocked = true;
      ["touchstart", "touchend", "click", "keydown"].forEach((evt) => {
        document.removeEventListener(evt, unlockHandler, true);
      });
    } catch (e) {
    }
  };
  unlockHandler();
  ["touchstart", "touchend", "click", "keydown"].forEach((evt) => {
    document.addEventListener(evt, unlockHandler, { capture: true, passive: true });
  });
};
if (typeof window !== "undefined") {
  setupiOSUnlock();
}
const useTTS = () => {
  const [isSpeaking, setIsSpeaking] = reactExports.useState(false);
  const [isPaused, setIsPaused] = reactExports.useState(false);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const currentAudioUrlRef = reactExports.useRef(null);
  const isSupported = typeof window !== "undefined";
  reactExports.useEffect(() => {
    return () => {
      if (currentAudioUrlRef.current) {
        URL.revokeObjectURL(currentAudioUrlRef.current);
        currentAudioUrlRef.current = null;
      }
    };
  }, []);
  const playAudioBlob = reactExports.useCallback(async (audioBlob, onStart, onEnd, onError) => {
    const audio = getGlobalAudioElement();
    if (currentAudioUrlRef.current) {
      URL.revokeObjectURL(currentAudioUrlRef.current);
    }
    const audioUrl = URL.createObjectURL(audioBlob);
    currentAudioUrlRef.current = audioUrl;
    return new Promise((resolve) => {
      const handlePlay = () => {
        setIsSpeaking(true);
        setIsLoading(false);
        onStart?.();
      };
      const handleEnded = () => {
        setIsSpeaking(false);
        cleanup();
        onEnd?.();
        resolve(true);
      };
      const handleError = (e) => {
        setIsSpeaking(false);
        setIsLoading(false);
        cleanup();
        onError?.(new Error("Audio playback failed"));
        resolve(false);
      };
      const cleanup = () => {
        audio.removeEventListener("play", handlePlay);
        audio.removeEventListener("ended", handleEnded);
        audio.removeEventListener("error", handleError);
        if (currentAudioUrlRef.current) {
          URL.revokeObjectURL(currentAudioUrlRef.current);
          currentAudioUrlRef.current = null;
        }
      };
      audio.addEventListener("play", handlePlay);
      audio.addEventListener("ended", handleEnded);
      audio.addEventListener("error", handleError);
      audio.src = audioUrl;
      audio.volume = 1;
      audio.play().then(() => {
      }).catch((error) => {
        if (error?.name === "NotAllowedError") {
          const retryOnInteraction = () => {
            audio.play().then(() => void 0).catch((e) => {
              cleanup();
              onEnd?.();
              resolve(false);
            });
          };
          const events = ["touchstart", "click"];
          events.forEach((evt) => {
            document.addEventListener(evt, retryOnInteraction, { once: true, capture: true });
          });
          setTimeout(() => {
            events.forEach((evt) => {
              document.removeEventListener(evt, retryOnInteraction, true);
            });
            if (!isSpeaking) {
              cleanup();
              onEnd?.();
              resolve(false);
            }
          }, 8e3);
        } else {
          cleanup();
          onError?.(error);
          resolve(false);
        }
      });
    });
  }, [isSpeaking]);
  const speakWithElevenLabs = reactExports.useCallback(async (text, options = {}) => {
    const { voice = "callum", onEnd, onStart, onError } = options;
    setIsLoading(true);
    try {
      const { data, error } = await supabase.functions.invoke("tts-elevenlabs", {
        body: { text, voice }
      });
      if (error || !data?.audio) {
        throw new Error(error?.message || "TTS API failed");
      }
      const audioBlob = new Blob(
        [Uint8Array.from(atob(data.audio), (c) => c.charCodeAt(0))],
        { type: "audio/mp3" }
      );
      const success = await playAudioBlob(audioBlob, onStart, onEnd, onError);
      if (!success) {
        setTimeout(async () => {
          try {
            const { data: retryData, error: retryError } = await supabase.functions.invoke("tts-elevenlabs", {
              body: { text, voice }
            });
            if (!retryError && retryData?.audio) {
              const retryBlob = new Blob(
                [Uint8Array.from(atob(retryData.audio), (c) => c.charCodeAt(0))],
                { type: "audio/mp3" }
              );
              await playAudioBlob(retryBlob, onStart, onEnd, onError);
            } else {
              onEnd?.();
            }
          } catch (e) {
            onEnd?.();
          }
        }, 500);
      }
    } catch (error) {
      setIsLoading(false);
      setIsSpeaking(false);
      onError?.(error);
      onEnd?.();
    }
  }, [playAudioBlob]);
  const speak = reactExports.useCallback((text, options = {}) => {
    const forcedOptions = { ...options, voice: "callum" };
    speakWithElevenLabs(text, forcedOptions);
  }, [speakWithElevenLabs]);
  const stop = reactExports.useCallback(() => {
    const audio = getGlobalAudioElement();
    audio.pause();
    audio.currentTime = 0;
    if (currentAudioUrlRef.current) {
      URL.revokeObjectURL(currentAudioUrlRef.current);
      currentAudioUrlRef.current = null;
    }
    setIsSpeaking(false);
    setIsPaused(false);
    setIsLoading(false);
  }, []);
  const pause = reactExports.useCallback(() => {
    const audio = getGlobalAudioElement();
    if (isSpeaking) {
      audio.pause();
      setIsPaused(true);
    }
  }, [isSpeaking]);
  const resume = reactExports.useCallback(() => {
    const audio = getGlobalAudioElement();
    if (isPaused) {
      audio.play().catch(console.error);
      setIsPaused(false);
    }
  }, [isPaused]);
  const unlockAudio = reactExports.useCallback(async () => {
    if (isGlobalAudioUnlocked) return true;
    const audio = getGlobalAudioElement();
    const silentMp3 = "data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYoRwmHAAAAAAD/+1DEAAAGAAGn9AAAIgAANP8AAABMQVNFKDM0ODM0NSlNAAAATkVXUwAAAABMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//tQxBgAAADSAAAAAAAAANIAAAAA";
    try {
      audio.src = silentMp3;
      audio.volume = 0.01;
      await audio.play();
      audio.pause();
      audio.currentTime = 0;
      isGlobalAudioUnlocked = true;
      return true;
    } catch (e) {
      return false;
    }
  }, []);
  return {
    speak,
    stop,
    pause,
    resume,
    isSpeaking,
    isPaused,
    isLoading,
    isSupported,
    unlockAudio,
    isAudioUnlocked: () => isGlobalAudioUnlocked
  };
};

const ERROR_MESSAGES = {
  "INSUFFICIENT_M1U_FOR_AION": " Energia M1U insufficiente per attivare il canale AION. Ricarica le tue unit per continuare.",
  "AION_DAILY_CAP_EXCEEDED": " Limite giornaliero AION raggiunto. Il canale si ricaricher domani. Riprova pi tardi.",
  "NOT_AUTHENTICATED": " Connessione neurale non autenticata. Effettua il login per accedere ad AION.",
  "INTERNAL_ERROR": " Interferenza nel canale. Riprova tra qualche secondo."
};
const IntelChatPanel = ({ aionEntityRef, className = "", style }) => {
  const [messages, setMessages] = reactExports.useState([
    {
      id: "system-1",
      role: "system",
      content: "Connessione neurale stabilizzata. Sono AION, la tua intelligenza adattiva.",
      timestamp: /* @__PURE__ */ new Date()
    }
  ]);
  const [input, setInput] = reactExports.useState("");
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [isMicEnabled, setIsMicEnabled] = reactExports.useState(true);
  const [status, setStatus] = reactExports.useState("idle");
  const [aionStatus, setAionStatus] = reactExports.useState(null);
  const messagesEndRef = reactExports.useRef(null);
  const inputRef = reactExports.useRef(null);
  const sessionIdRef = reactExports.useRef(`session_${Date.now()}`);
  const { speak, stop: stopTTS, unlockAudio } = useTTS();
  const { accrueFromAion } = useCashbackWallet();
  reactExports.useEffect(() => {
    const unlockOnInteraction = () => {
      unlockAudio();
    };
    document.addEventListener("touchstart", unlockOnInteraction, { once: true, passive: true });
    document.addEventListener("click", unlockOnInteraction, { once: true, passive: true });
    return () => {
      document.removeEventListener("touchstart", unlockOnInteraction);
      document.removeEventListener("click", unlockOnInteraction);
    };
  }, [unlockAudio]);
  reactExports.useEffect(() => {
    fetchAionStatus();
  }, []);
  const fetchAionStatus = async () => {
    try {
      const { data, error } = await supabase.rpc("get_aion_status");
      if (!error && data) {
        setAionStatus(data);
      } else if (error) {
        setAionStatus({
          plan: "FREE",
          m1u_balance: 0,
          free_remaining: 0,
          cost_per_consult: 2
        });
      }
    } catch (e) {
      setAionStatus({
        plan: "FREE",
        m1u_balance: 0,
        free_remaining: 0,
        cost_per_consult: 2
      });
    }
  };
  reactExports.useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages]);
  const generateVisemes = (text) => {
    const vowels = ["a", "e", "i", "o", "u"];
    const visemes = [];
    let time = 0;
    const interval = 120;
    for (const char of text.toLowerCase()) {
      if (vowels.includes(char)) {
        visemes.push({ t: time, v: char.toUpperCase() });
        time += interval;
      } else if (char === "m" || char === "n" || char === "b" || char === "p") {
        visemes.push({ t: time, v: "M" });
        time += interval * 0.8;
      } else if (char === " ") {
        time += interval * 0.5;
      } else {
        time += interval * 0.3;
      }
    }
    return visemes;
  };
  const sendMessage = async () => {
    if (!input.trim() || isLoading) return;
    unlockAudio();
    const userMessage = {
      id: `user_${Date.now()}`,
      role: "user",
      content: input.trim(),
      timestamp: /* @__PURE__ */ new Date()
    };
    setMessages((prev) => [...prev, userMessage]);
    setInput("");
    setIsLoading(true);
    setStatus("listening");
    try {
      const { data, error } = await supabase.functions.invoke("norah-chat-v2", {
        body: {
          session_id: sessionIdRef.current,
          text: userMessage.content,
          messages: messages.filter((m) => m.role !== "system" && m.role !== "error").slice(-10),
          system: "AION_CLIENT"
        }
      });
      if (error) throw error;
      if (data?.authorized === false && data?.error_code !== "NOT_AUTHENTICATED") {
        const errorCode = data.error_code || "INTERNAL_ERROR";
        const errorMessage = ERROR_MESSAGES[errorCode] || data.message || "Accesso AION non autorizzato.";
        const errorMsg = {
          id: `error_${Date.now()}`,
          role: "error",
          content: errorMessage,
          timestamp: /* @__PURE__ */ new Date(),
          meta: {
            error_code: errorCode,
            m1u_spent: 0,
            free_remaining: data.free_remaining
          }
        };
        setMessages((prev) => [...prev, errorMsg]);
        setStatus("idle");
        if (data.m1u_balance !== void 0) {
          setAionStatus((prev) => prev ? { ...prev, m1u_balance: data.m1u_balance } : null);
        }
        return;
      }
      if (data?.authorized === false && data?.error_code === "NOT_AUTHENTICATED") {
      }
      let reply = data?.reply || "Mi dispiace, non ho capito. Riprova.";
      reply = reply.replace(/\bION\b/g, "AION").replace(/Sono Ion/gi, "Sono AION").replace(/sono ion/gi, "sono AION").replace(/chiamo Ion/gi, "chiamo AION");
      const visemes = data?.visemes || generateVisemes(reply);
      const assistantMessage = {
        id: `assistant_${Date.now()}`,
        role: "assistant",
        content: reply,
        timestamp: /* @__PURE__ */ new Date(),
        meta: {
          m1u_spent: data?.access?.m1u_spent,
          free_remaining: data?.access?.free_remaining
        }
      };
      setMessages((prev) => [...prev, assistantMessage]);
      setStatus("speaking");
      if (data?.access) {
        setAionStatus((prev) => prev ? {
          ...prev,
          m1u_balance: data.access.m1u_balance,
          free_remaining: data.access.free_remaining
        } : null);
        if (data.access.m1u_spent > 0) {
          window.dispatchEvent(new CustomEvent("m1u-spent", {
            detail: { amount: data.access.m1u_spent }
          }));
          const costEur = data.access.m1u_spent / 10;
          accrueFromAion({ costEur });
        }
      }
      if (aionEntityRef?.current) {
        aionEntityRef.current.play(visemes);
      }
      if (isMicEnabled) {
        speak(reply, {
          useCloud: true,
          voice: "callum",
          onEnd: () => {
            setStatus("idle");
            aionEntityRef?.current?.idle();
          }
        });
      } else {
        setTimeout(() => {
          setStatus("idle");
          aionEntityRef?.current?.idle();
        }, 500);
      }
    } catch (error) {
      const fallbackMessage = {
        id: `error_${Date.now()}`,
        role: "error",
        content: " Interferenza nel canale. Riprova tra qualche secondo.",
        timestamp: /* @__PURE__ */ new Date()
      };
      setMessages((prev) => [...prev, fallbackMessage]);
      setStatus("idle");
    } finally {
      setIsLoading(false);
    }
  };
  const handleKeyPress = (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };
  const toggleMic = () => {
    setIsMicEnabled((prev) => !prev);
  };
  const refreshChat = () => {
    sessionIdRef.current = `session_${Date.now()}`;
    setMessages([{
      id: "system-1",
      role: "system",
      content: "Connessione neurale ripristinata. Sono AION, pronto ad assisterti.",
      timestamp: /* @__PURE__ */ new Date()
    }]);
    stopTTS();
    aionEntityRef?.current?.idle();
    setStatus("idle");
    fetchAionStatus();
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `flex flex-col rounded-2xl overflow-hidden ${className}`,
      style: {
        background: "rgba(7, 8, 24, 0.6)",
        backdropFilter: "blur(12px)",
        border: "1px solid rgba(0, 212, 255, 0.2)",
        ...style
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between px-4 py-3 border-b border-cyan-500/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Brain, { className: "w-5 h-5 text-cyan-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium text-white", children: "Neural Link Established" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `w-2 h-2 rounded-full ${status === "idle" ? "bg-green-400" : status === "speaking" ? "bg-cyan-400 animate-pulse" : "bg-yellow-400 animate-pulse"}` })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            aionStatus && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1 px-2 py-1 rounded-lg bg-gray-800/50 text-xs", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-3 h-3 text-yellow-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: aionStatus.free_remaining > 0 ? `${aionStatus.free_remaining} gratis` : `${aionStatus.cost_per_consult} M1U` })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: toggleMic,
                className: `p-2 rounded-lg transition-colors ${isMicEnabled ? "bg-cyan-500/20 text-cyan-400" : "text-gray-400 hover:text-white"}`,
                children: isMicEnabled ? /* @__PURE__ */ jsxRuntimeExports.jsx(Mic, { className: "w-4 h-4" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(MicOff, { className: "w-4 h-4" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: refreshChat,
                className: "p-2 rounded-lg text-gray-400 hover:text-white transition-colors",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCw, { className: "w-4 h-4" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("button", { className: "p-2 rounded-lg text-gray-400 hover:text-white transition-colors", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Ellipsis, { className: "w-4 h-4" }) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "flex-1 overflow-y-auto p-4 space-y-4 max-h-80 min-h-[200px]",
            style: { scrollBehavior: "smooth" },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: messages.map((message) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  initial: { opacity: 0, y: 10 },
                  animate: { opacity: 1, y: 0 },
                  exit: { opacity: 0, y: -10 },
                  className: `flex ${message.role === "user" ? "justify-end" : "justify-start"}`,
                  children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    "div",
                    {
                      className: `max-w-[80%] px-4 py-2 rounded-2xl ${message.role === "user" ? "bg-gradient-to-r from-cyan-500 to-blue-500 text-white" : message.role === "system" ? "bg-gray-800/50 text-gray-400 italic text-sm" : message.role === "error" ? "bg-red-900/30 text-red-300 border border-red-500/30" : "bg-gray-800/80 text-white border border-cyan-500/20"}`,
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm leading-relaxed", children: message.content }),
                        message.meta?.m1u_spent !== void 0 && message.meta.m1u_spent > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-cyan-400/70 mt-1", children: [
                          "-",
                          message.meta.m1u_spent,
                          " M1U"
                        ] })
                      ]
                    }
                  )
                },
                message.id
              )) }),
              isLoading && /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  initial: { opacity: 0 },
                  animate: { opacity: 1 },
                  className: "flex justify-start",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gray-800/80 px-4 py-2 rounded-2xl border border-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-5 h-5 text-cyan-400 animate-spin" }) })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { ref: messagesEndRef })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "px-4 py-2 text-xs text-center text-gray-500", children: [
          status === "listening" && "Elaborazione...",
          status === "speaking" && "AION sta parlando...",
          status === "idle" && "In attesa..."
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 border-t border-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "input",
            {
              ref: inputRef,
              type: "text",
              value: input,
              onChange: (e) => setInput(e.target.value),
              onKeyPress: handleKeyPress,
              placeholder: "Scrivi un messaggio...",
              disabled: isLoading,
              className: "flex-1 bg-gray-800/50 border border-cyan-500/20 rounded-xl px-4 py-2.5 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500/50 transition-colors disabled:opacity-50"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: sendMessage,
              disabled: !input.trim() || isLoading,
              className: "p-2.5 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg hover:shadow-cyan-500/25 transition-all",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-5 h-5" })
            }
          )
        ] }) })
      ]
    }
  );
};

const M1UPill = reactExports.lazy(() => __vitePreload(() => Promise.resolve().then(() => M1UPill$2),true?void 0:void 0));
const ShadowIntercepts = reactExports.lazy(() => __vitePreload(() => import('./ShadowIntercepts.BmcMEHuS.js'),true?__vite__mapDeps([11,3,2,5,1,6,7,8,9]):void 0));
const IntelligencePage = () => {
  const aionRef = reactExports.useRef(null);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      style: {
        position: "fixed",
        inset: 0,
        display: "flex",
        flexDirection: "column",
        overflow: "hidden",
        paddingTop: "calc(env(safe-area-inset-top, 0px) + 85px)",
        paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 95px)",
        paddingLeft: "16px",
        paddingRight: "16px"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            "data-onboarding": "m1u-pill",
            style: {
              pointerEvents: "auto",
              marginBottom: "8px",
              flexShrink: 0
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(reactExports.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-28 h-10 bg-gray-800/50 rounded-full animate-pulse" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(M1UPill, { showLabel: true, showPlusButton: true }) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            style: {
              height: "25%",
              minHeight: "120px",
              display: "flex",
              flexDirection: "column",
              alignItems: "center",
              justifyContent: "center",
              flexShrink: 0,
              position: "relative",
              zIndex: 1
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              AionEntity,
              {
                ref: aionRef,
                intensity: 1,
                idleSpeed: 0.7,
                className: "mx-auto"
              }
            )
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "text-center",
            style: {
              flexShrink: 0,
              marginBottom: "20px",
              position: "relative",
              zIndex: 10
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-2xl font-bold tracking-wider", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400", children: "AI" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: "ON" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-500 tracking-wide", children: "Adaptive Intelligence ON" })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(reactExports.Suspense, { fallback: null, children: /* @__PURE__ */ jsxRuntimeExports.jsx(ShadowIntercepts, {}) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            "data-onboarding": "ai-chat",
            style: {
              flex: 1,
              minHeight: "220px",
              maxWidth: "100%",
              width: "100%",
              display: "flex",
              flexDirection: "column"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              IntelChatPanel,
              {
                aionEntityRef: aionRef,
                className: "flex-1",
                style: { minHeight: 0 }
              }
            )
          }
        )
      ]
    }
  );
};

async function ragSearch(query, locale = "it", top_k = 3) {
  const { data, error } = await supabase.functions.invoke("norah-rag-search", {
    body: { query, locale, top_k }
  });
  if (error) throw error;
  return data;
}
async function ragAnswer(query, locale = "it", top_k = 3) {
  const { data, error } = await supabase.functions.invoke("norah-answer", {
    body: { query, locale, top_k }
  });
  if (error) throw error;
  return data;
}

function RagQuery() {
  const [q, setQ] = reactExports.useState("");
  const [hits, setHits] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(false);
  const [err, setErr] = reactExports.useState(null);
  const onAsk = async () => {
    setLoading(true);
    setErr(null);
    try {
      const res = await ragSearch(q, "it", 3);
      setHits(res.hits ?? []);
      try {
        await supabase.from("norah_events").insert({
          event: "rag_ui_query",
          user_id: (await supabase.auth.getUser()).data.user?.id || "",
          payload: { q, top_k: 3, locale: "it", hits_count: res.hits?.length ?? 0 }
        });
      } catch (telErr) {
      }
    } catch (e) {
      setErr(e?.message ?? "Errore");
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "input",
      {
        className: "border p-2 w-full mb-2",
        value: q,
        onChange: (e) => setQ(e.target.value),
        placeholder: "Fai una domanda su BUZZ"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        onClick: onAsk,
        disabled: loading || !q.trim(),
        className: "bg-blue-500 text-white px-4 py-2 rounded",
        children: loading ? "" : "Chiedi"
      }
    ),
    err && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-red-500 mt-2", children: err }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "mt-4 space-y-2", children: hits.map((h, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { className: "border-b pb-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: h.title }),
      "  ",
      h.category,
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-gray-600", children: h.chunk_text }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("small", { className: "opacity-70", children: [
        "score: ",
        h.distance.toFixed(3)
      ] })
    ] }, i)) })
  ] });
}

function IntelligenceRAG() {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full bg-background", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "border-b border-border/40 bg-gradient-to-r from-background via-background/95 to-background", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto px-4 py-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 mb-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-2 rounded-lg bg-primary/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Brain, { className: "w-6 h-6 text-primary" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent", children: "M1SSION Intelligence" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground font-rajdhani", children: "Ricerca semantica sulla Knowledge Base interna  Powered by Norah AI (RAG)" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap gap-2 mt-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5 px-3 py-1 rounded-full bg-primary/5 border border-primary/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-3.5 h-3.5 text-primary" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-rajdhani text-primary", children: "Vector Search" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5 px-3 py-1 rounded-full bg-accent/5 border border-accent/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-3.5 h-3.5 text-accent" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-rajdhani text-accent", children: "Instant Results" })
        ] })
      ] })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto px-4 py-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(RagQuery, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto px-4 pb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "rounded-lg border border-border/40 bg-card/50 p-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-sm font-orbitron font-semibold mb-2 text-foreground", children: " Esempi di domande" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "space-y-1 text-sm text-muted-foreground font-rajdhani", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: ' "Spiegami BUZZ e quando conviene usarlo rispetto a BUZZ Map"' }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: ' "Quali sono le differenze tra i piani Free e Titanium?"' }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: ' "Come funziona il sistema di rewards?"' }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: ' "Cosa sono i QR codes e come si usano?"' })
      ] })
    ] }) })
  ] });
}

function IntelligenceAnswerTest() {
  const [query, setQuery] = reactExports.useState("");
  const [answer, setAnswer] = reactExports.useState("");
  const [sources, setSources] = reactExports.useState([]);
  const [provider, setProvider] = reactExports.useState("");
  const [loading, setLoading] = reactExports.useState(false);
  const { toast } = useToast();
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!query.trim()) {
      toast({ title: "Errore", description: "Inserisci una domanda", variant: "destructive" });
      return;
    }
    setLoading(true);
    setAnswer("");
    setSources([]);
    setProvider("");
    try {
      const result = await ragAnswer(query);
      setAnswer(result.answer);
      setSources(result.sources);
      setProvider(result.provider);
    } catch (error) {
      toast({
        title: "Errore",
        description: error instanceof Error ? error.message : "Errore durante la richiesta",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const examples = [
    "Spiegami BUZZ e quando conviene usare BUZZ Map",
    "Differenze tra piani Free e Titanium su BUZZ e BUZZ Map",
    "Sono su Silver e ho 30 secondi: qual  la next best action?"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto p-6 space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold mb-2", children: "Norah AI Answer Test" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Test della pipeline RAG  LLM con risposta contestuale" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Fai una domanda" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              placeholder: "Es: Spiegami BUZZ e quando usare BUZZ Map",
              value: query,
              onChange: (e) => setQuery(e.target.value),
              disabled: loading
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2 mt-2 flex-wrap", children: examples.map((ex, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              type: "button",
              variant: "outline",
              size: "sm",
              onClick: () => setQuery(ex),
              disabled: loading,
              children: [
                ex.slice(0, 30),
                "..."
              ]
            },
            i
          )) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { type: "submit", disabled: loading || !query.trim(), children: loading ? "Elaborazione..." : "Chiedi a Norah" })
      ] }) })
    ] }),
    answer && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Risposta" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-normal text-muted-foreground", children: [
          "Provider: ",
          provider
        ] })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Textarea,
        {
          value: answer,
          readOnly: true,
          className: "min-h-[200px] font-sans"
        }
      ) })
    ] }),
    sources.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { children: [
        "Fonti (",
        sources.length,
        ")"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: sources.map((src, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "div",
        {
          className: "p-3 border rounded-lg bg-muted/30 space-y-1",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "font-semibold text-sm", children: [
              src.title,
              " #",
              src.chunk_idx
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground font-mono", children: src.doc_id }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm italic", children: [
              '"',
              src.snippet,
              '..."'
            ] })
          ]
        },
        i
      )) }) })
    ] })
  ] });
}

function Skeleton({
  className,
  ...props
}) {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: cn("animate-pulse rounded-md bg-muted", className),
      ...props
    }
  );
}

function HallOfWinners() {
  const [winners, setWinners] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  reactExports.useEffect(() => {
    loadWinners();
  }, []);
  const loadWinners = async () => {
    try {
      setLoading(true);
      setError(null);
      const { data, error: fetchError } = await supabase.from("winners_public").select("*").limit(50);
      if (fetchError) throw fetchError;
      const mappedData = (data || []).map((row) => ({
        ...row,
        username: row.username || row.nickname || null
      }));
      setWinners(mappedData);
    } catch (err) {
      setError("Failed to load winners");
    } finally {
      setLoading(false);
    }
  };
  const getRankIcon = (index) => {
    if (index === 0) return /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-6 h-6 text-yellow-500" });
    if (index === 1) return /* @__PURE__ */ jsxRuntimeExports.jsx(Medal, { className: "w-6 h-6 text-gray-400" });
    if (index === 2) return /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-6 h-6 text-amber-600" });
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-5 h-5 text-primary/60" });
  };
  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return new Intl.DateTimeFormat("it-IT", {
      day: "2-digit",
      month: "short",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit"
    }).format(date);
  };
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-background p-4 sm:p-6 lg:p-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4 py-8", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton, { className: "h-12 w-64 mx-auto" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton, { className: "h-6 w-96 mx-auto" })
      ] }),
      [1, 2, 3, 4, 5].map((i) => /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton, { className: "h-32 w-full" }, i))
    ] }) });
  }
  if (error) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-background p-4 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "p-8 text-center max-w-md", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-16 h-16 mx-auto mb-4 text-destructive" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-2", children: "Error Loading Winners" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground mb-4", children: error }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: loadWinners,
          className: "px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",
          children: "Retry"
        }
      )
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-background", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gradient-to-b from-primary/20 to-background border-b border-border", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: -20 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.6 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-3 mb-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-10 h-10 text-primary" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-4xl sm:text-5xl font-bold text-foreground", children: "Hall of Winners" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-10 h-10 text-primary" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg text-muted-foreground max-w-2xl mx-auto", children: "I migliori agenti M1SSION che hanno completato missioni impossibili" })
        ]
      }
    ) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8", children: winners.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        className: "text-center py-16",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-24 h-24 mx-auto mb-6 text-muted-foreground/30" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold mb-2 text-foreground", children: "Nessun vincitore ancora" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Completa una missione per essere il primo nella Hall of Winners!" })
        ]
      }
    ) : /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "popLayout", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: winners.map((winner, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, x: -20 },
        animate: { opacity: 1, x: 0 },
        exit: { opacity: 0, x: 20 },
        transition: { duration: 0.3, delay: index * 0.05 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Card,
          {
            className: `
                      p-4 sm:p-6 hover:shadow-lg transition-all duration-300 
                      ${index < 3 ? "border-2 border-primary/50 bg-primary/5" : ""}
                    `,
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 flex-wrap sm:flex-nowrap", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0 flex items-center justify-center w-12 h-12 sm:w-16 sm:h-16", children: getRankIcon(index) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 flex-1 min-w-0", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Avatar, { className: "w-12 h-12 sm:w-16 sm:h-16 border-2 border-primary/30", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarImage, { src: winner.avatar_url || void 0 }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarFallback, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-6 h-6" }) })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-bold text-lg text-foreground truncate", children: winner.username || "Anonymous Agent" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: winner.agent_code || "No Code" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0 space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", className: "text-xs", children: winner.mission_code || "Unknown" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-foreground truncate", children: winner.mission_title || "Mission Classified" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 flex-shrink-0", children: [
                winner.prize_image && /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "img",
                  {
                    src: winner.prize_image,
                    alt: winner.prize_name || "Prize",
                    className: "w-12 h-12 rounded-lg object-cover"
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "hidden sm:block", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-foreground", children: winner.prize_name || "Prize" }),
                  winner.prize_value && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-primary font-bold", children: [
                    winner.prize_value,
                    " M1U"
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-4 h-4" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "hidden lg:inline", children: formatDate(winner.completion_time) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "lg:hidden", children: new Date(winner.completion_time).toLocaleDateString("it-IT") })
              ] })
            ] })
          }
        )
      },
      winner.id
    )) }) }) }),
    winners.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 border-t border-border", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 sm:grid-cols-3 gap-4 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "p-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-8 h-8 mx-auto mb-2 text-primary" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-foreground", children: winners.length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Total Winners" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "p-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-8 h-8 mx-auto mb-2 text-primary" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-foreground", children: new Set(winners.map((w) => w.mission_code)).size }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Missions Completed" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "p-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-8 h-8 mx-auto mb-2 text-primary" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-foreground", children: winners.reduce((sum, w) => sum + (w.prize_value || 0), 0) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Total M1U Awarded" })
      ] })
    ] }) })
  ] });
}

// packages/core/number/src/number.ts
function clamp(value, [min, max]) {
  return Math.min(max, Math.max(min, value));
}

// src/slot.tsx
// @__NO_SIDE_EFFECTS__
function createSlot(ownerName) {
  const SlotClone = /* @__PURE__ */ createSlotClone(ownerName);
  const Slot2 = reactExports.forwardRef((props, forwardedRef) => {
    const { children, ...slotProps } = props;
    const childrenArray = reactExports.Children.toArray(children);
    const slottable = childrenArray.find(isSlottable);
    if (slottable) {
      const newElement = slottable.props.children;
      const newChildren = childrenArray.map((child) => {
        if (child === slottable) {
          if (reactExports.Children.count(newElement) > 1) return reactExports.Children.only(null);
          return reactExports.isValidElement(newElement) ? newElement.props.children : null;
        } else {
          return child;
        }
      });
      return /* @__PURE__ */ jsxRuntimeExports.jsx(SlotClone, { ...slotProps, ref: forwardedRef, children: reactExports.isValidElement(newElement) ? reactExports.cloneElement(newElement, void 0, newChildren) : null });
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SlotClone, { ...slotProps, ref: forwardedRef, children });
  });
  Slot2.displayName = `${ownerName}.Slot`;
  return Slot2;
}
// @__NO_SIDE_EFFECTS__
function createSlotClone(ownerName) {
  const SlotClone = reactExports.forwardRef((props, forwardedRef) => {
    const { children, ...slotProps } = props;
    if (reactExports.isValidElement(children)) {
      const childrenRef = getElementRef(children);
      const props2 = mergeProps(slotProps, children.props);
      if (children.type !== reactExports.Fragment) {
        props2.ref = forwardedRef ? composeRefs(forwardedRef, childrenRef) : childrenRef;
      }
      return reactExports.cloneElement(children, props2);
    }
    return reactExports.Children.count(children) > 1 ? reactExports.Children.only(null) : null;
  });
  SlotClone.displayName = `${ownerName}.SlotClone`;
  return SlotClone;
}
var SLOTTABLE_IDENTIFIER$1 = Symbol("radix.slottable");
function isSlottable(child) {
  return reactExports.isValidElement(child) && typeof child.type === "function" && "__radixId" in child.type && child.type.__radixId === SLOTTABLE_IDENTIFIER$1;
}
function mergeProps(slotProps, childProps) {
  const overrideProps = { ...childProps };
  for (const propName in childProps) {
    const slotPropValue = slotProps[propName];
    const childPropValue = childProps[propName];
    const isHandler = /^on[A-Z]/.test(propName);
    if (isHandler) {
      if (slotPropValue && childPropValue) {
        overrideProps[propName] = (...args) => {
          const result = childPropValue(...args);
          slotPropValue(...args);
          return result;
        };
      } else if (slotPropValue) {
        overrideProps[propName] = slotPropValue;
      }
    } else if (propName === "style") {
      overrideProps[propName] = { ...slotPropValue, ...childPropValue };
    } else if (propName === "className") {
      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(" ");
    }
  }
  return { ...slotProps, ...overrideProps };
}
function getElementRef(element) {
  let getter = Object.getOwnPropertyDescriptor(element.props, "ref")?.get;
  let mayWarn = getter && "isReactWarning" in getter && getter.isReactWarning;
  if (mayWarn) {
    return element.ref;
  }
  getter = Object.getOwnPropertyDescriptor(element, "ref")?.get;
  mayWarn = getter && "isReactWarning" in getter && getter.isReactWarning;
  if (mayWarn) {
    return element.props.ref;
  }
  return element.props.ref || element.ref;
}

// packages/react/use-previous/src/use-previous.tsx
function usePrevious(value) {
  const ref = reactExports.useRef({ value, previous: value });
  return reactExports.useMemo(() => {
    if (ref.current.value !== value) {
      ref.current.previous = ref.current.value;
      ref.current.value = value;
    }
    return ref.current.previous;
  }, [value]);
}

var OPEN_KEYS = [" ", "Enter", "ArrowUp", "ArrowDown"];
var SELECTION_KEYS = [" ", "Enter"];
var SELECT_NAME = "Select";
var [Collection, useCollection, createCollectionScope] = createCollection(SELECT_NAME);
var [createSelectContext] = createContextScope$2(SELECT_NAME, [
  createCollectionScope,
  createPopperScope
]);
var usePopperScope = createPopperScope();
var [SelectProvider, useSelectContext] = createSelectContext(SELECT_NAME);
var [SelectNativeOptionsProvider, useSelectNativeOptionsContext] = createSelectContext(SELECT_NAME);
var Select$1 = (props) => {
  const {
    __scopeSelect,
    children,
    open: openProp,
    defaultOpen,
    onOpenChange,
    value: valueProp,
    defaultValue,
    onValueChange,
    dir,
    name,
    autoComplete,
    disabled,
    required,
    form
  } = props;
  const popperScope = usePopperScope(__scopeSelect);
  const [trigger, setTrigger] = reactExports.useState(null);
  const [valueNode, setValueNode] = reactExports.useState(null);
  const [valueNodeHasChildren, setValueNodeHasChildren] = reactExports.useState(false);
  const direction = useDirection(dir);
  const [open, setOpen] = useControllableState({
    prop: openProp,
    defaultProp: defaultOpen ?? false,
    onChange: onOpenChange,
    caller: SELECT_NAME
  });
  const [value, setValue] = useControllableState({
    prop: valueProp,
    defaultProp: defaultValue,
    onChange: onValueChange,
    caller: SELECT_NAME
  });
  const triggerPointerDownPosRef = reactExports.useRef(null);
  const isFormControl = trigger ? form || !!trigger.closest("form") : true;
  const [nativeOptionsSet, setNativeOptionsSet] = reactExports.useState(/* @__PURE__ */ new Set());
  const nativeSelectKey = Array.from(nativeOptionsSet).map((option) => option.props.value).join(";");
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Root2$2, { ...popperScope, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    SelectProvider,
    {
      required,
      scope: __scopeSelect,
      trigger,
      onTriggerChange: setTrigger,
      valueNode,
      onValueNodeChange: setValueNode,
      valueNodeHasChildren,
      onValueNodeHasChildrenChange: setValueNodeHasChildren,
      contentId: useId(),
      value,
      onValueChange: setValue,
      open,
      onOpenChange: setOpen,
      dir: direction,
      triggerPointerDownPosRef,
      disabled,
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Collection.Provider, { scope: __scopeSelect, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          SelectNativeOptionsProvider,
          {
            scope: props.__scopeSelect,
            onNativeOptionAdd: reactExports.useCallback((option) => {
              setNativeOptionsSet((prev) => new Set(prev).add(option));
            }, []),
            onNativeOptionRemove: reactExports.useCallback((option) => {
              setNativeOptionsSet((prev) => {
                const optionsSet = new Set(prev);
                optionsSet.delete(option);
                return optionsSet;
              });
            }, []),
            children
          }
        ) }),
        isFormControl ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
          SelectBubbleInput,
          {
            "aria-hidden": true,
            required,
            tabIndex: -1,
            name,
            autoComplete,
            value,
            onChange: (event) => setValue(event.target.value),
            disabled,
            form,
            children: [
              value === void 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: "" }) : null,
              Array.from(nativeOptionsSet)
            ]
          },
          nativeSelectKey
        ) : null
      ]
    }
  ) });
};
Select$1.displayName = SELECT_NAME;
var TRIGGER_NAME$2 = "SelectTrigger";
var SelectTrigger$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, disabled = false, ...triggerProps } = props;
    const popperScope = usePopperScope(__scopeSelect);
    const context = useSelectContext(TRIGGER_NAME$2, __scopeSelect);
    const isDisabled = context.disabled || disabled;
    const composedRefs = useComposedRefs(forwardedRef, context.onTriggerChange);
    const getItems = useCollection(__scopeSelect);
    const pointerTypeRef = reactExports.useRef("touch");
    const [searchRef, handleTypeaheadSearch, resetTypeahead] = useTypeaheadSearch((search) => {
      const enabledItems = getItems().filter((item) => !item.disabled);
      const currentItem = enabledItems.find((item) => item.value === context.value);
      const nextItem = findNextItem(enabledItems, search, currentItem);
      if (nextItem !== void 0) {
        context.onValueChange(nextItem.value);
      }
    });
    const handleOpen = (pointerEvent) => {
      if (!isDisabled) {
        context.onOpenChange(true);
        resetTypeahead();
      }
      if (pointerEvent) {
        context.triggerPointerDownPosRef.current = {
          x: Math.round(pointerEvent.pageX),
          y: Math.round(pointerEvent.pageY)
        };
      }
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Anchor, { asChild: true, ...popperScope, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.button,
      {
        type: "button",
        role: "combobox",
        "aria-controls": context.contentId,
        "aria-expanded": context.open,
        "aria-required": context.required,
        "aria-autocomplete": "none",
        dir: context.dir,
        "data-state": context.open ? "open" : "closed",
        disabled: isDisabled,
        "data-disabled": isDisabled ? "" : void 0,
        "data-placeholder": shouldShowPlaceholder(context.value) ? "" : void 0,
        ...triggerProps,
        ref: composedRefs,
        onClick: composeEventHandlers(triggerProps.onClick, (event) => {
          event.currentTarget.focus();
          if (pointerTypeRef.current !== "mouse") {
            handleOpen(event);
          }
        }),
        onPointerDown: composeEventHandlers(triggerProps.onPointerDown, (event) => {
          pointerTypeRef.current = event.pointerType;
          const target = event.target;
          if (target.hasPointerCapture(event.pointerId)) {
            target.releasePointerCapture(event.pointerId);
          }
          if (event.button === 0 && event.ctrlKey === false && event.pointerType === "mouse") {
            handleOpen(event);
            event.preventDefault();
          }
        }),
        onKeyDown: composeEventHandlers(triggerProps.onKeyDown, (event) => {
          const isTypingAhead = searchRef.current !== "";
          const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;
          if (!isModifierKey && event.key.length === 1) handleTypeaheadSearch(event.key);
          if (isTypingAhead && event.key === " ") return;
          if (OPEN_KEYS.includes(event.key)) {
            handleOpen();
            event.preventDefault();
          }
        })
      }
    ) });
  }
);
SelectTrigger$1.displayName = TRIGGER_NAME$2;
var VALUE_NAME = "SelectValue";
var SelectValue$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, className, style, children, placeholder = "", ...valueProps } = props;
    const context = useSelectContext(VALUE_NAME, __scopeSelect);
    const { onValueNodeHasChildrenChange } = context;
    const hasChildren = children !== void 0;
    const composedRefs = useComposedRefs(forwardedRef, context.onValueNodeChange);
    useLayoutEffect2(() => {
      onValueNodeHasChildrenChange(hasChildren);
    }, [onValueNodeHasChildrenChange, hasChildren]);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.span,
      {
        ...valueProps,
        ref: composedRefs,
        style: { pointerEvents: "none" },
        children: shouldShowPlaceholder(context.value) ? /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children: placeholder }) : children
      }
    );
  }
);
SelectValue$1.displayName = VALUE_NAME;
var ICON_NAME = "SelectIcon";
var SelectIcon = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, children, ...iconProps } = props;
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.span, { "aria-hidden": true, ...iconProps, ref: forwardedRef, children: children || "\u25BC" });
  }
);
SelectIcon.displayName = ICON_NAME;
var PORTAL_NAME$1 = "SelectPortal";
var SelectPortal = (props) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Portal$2, { asChild: true, ...props });
};
SelectPortal.displayName = PORTAL_NAME$1;
var CONTENT_NAME$1 = "SelectContent";
var SelectContent$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const context = useSelectContext(CONTENT_NAME$1, props.__scopeSelect);
    const [fragment, setFragment] = reactExports.useState();
    useLayoutEffect2(() => {
      setFragment(new DocumentFragment());
    }, []);
    if (!context.open) {
      const frag = fragment;
      return frag ? reactDomExports.createPortal(
        /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContentProvider, { scope: props.__scopeSelect, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Collection.Slot, { scope: props.__scopeSelect, children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: props.children }) }) }),
        frag
      ) : null;
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContentImpl, { ...props, ref: forwardedRef });
  }
);
SelectContent$1.displayName = CONTENT_NAME$1;
var CONTENT_MARGIN = 10;
var [SelectContentProvider, useSelectContentContext] = createSelectContext(CONTENT_NAME$1);
var CONTENT_IMPL_NAME = "SelectContentImpl";
var Slot = createSlot("SelectContent.RemoveScroll");
var SelectContentImpl = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeSelect,
      position = "item-aligned",
      onCloseAutoFocus,
      onEscapeKeyDown,
      onPointerDownOutside,
      //
      // PopperContent props
      side,
      sideOffset,
      align,
      alignOffset,
      arrowPadding,
      collisionBoundary,
      collisionPadding,
      sticky,
      hideWhenDetached,
      avoidCollisions,
      //
      ...contentProps
    } = props;
    const context = useSelectContext(CONTENT_NAME$1, __scopeSelect);
    const [content, setContent] = reactExports.useState(null);
    const [viewport, setViewport] = reactExports.useState(null);
    const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));
    const [selectedItem, setSelectedItem] = reactExports.useState(null);
    const [selectedItemText, setSelectedItemText] = reactExports.useState(
      null
    );
    const getItems = useCollection(__scopeSelect);
    const [isPositioned, setIsPositioned] = reactExports.useState(false);
    const firstValidItemFoundRef = reactExports.useRef(false);
    reactExports.useEffect(() => {
      if (content) return hideOthers(content);
    }, [content]);
    useFocusGuards();
    const focusFirst = reactExports.useCallback(
      (candidates) => {
        const [firstItem, ...restItems] = getItems().map((item) => item.ref.current);
        const [lastItem] = restItems.slice(-1);
        const PREVIOUSLY_FOCUSED_ELEMENT = document.activeElement;
        for (const candidate of candidates) {
          if (candidate === PREVIOUSLY_FOCUSED_ELEMENT) return;
          candidate?.scrollIntoView({ block: "nearest" });
          if (candidate === firstItem && viewport) viewport.scrollTop = 0;
          if (candidate === lastItem && viewport) viewport.scrollTop = viewport.scrollHeight;
          candidate?.focus();
          if (document.activeElement !== PREVIOUSLY_FOCUSED_ELEMENT) return;
        }
      },
      [getItems, viewport]
    );
    const focusSelectedItem = reactExports.useCallback(
      () => focusFirst([selectedItem, content]),
      [focusFirst, selectedItem, content]
    );
    reactExports.useEffect(() => {
      if (isPositioned) {
        focusSelectedItem();
      }
    }, [isPositioned, focusSelectedItem]);
    const { onOpenChange, triggerPointerDownPosRef } = context;
    reactExports.useEffect(() => {
      if (content) {
        let pointerMoveDelta = { x: 0, y: 0 };
        const handlePointerMove = (event) => {
          pointerMoveDelta = {
            x: Math.abs(Math.round(event.pageX) - (triggerPointerDownPosRef.current?.x ?? 0)),
            y: Math.abs(Math.round(event.pageY) - (triggerPointerDownPosRef.current?.y ?? 0))
          };
        };
        const handlePointerUp = (event) => {
          if (pointerMoveDelta.x <= 10 && pointerMoveDelta.y <= 10) {
            event.preventDefault();
          } else {
            if (!content.contains(event.target)) {
              onOpenChange(false);
            }
          }
          document.removeEventListener("pointermove", handlePointerMove);
          triggerPointerDownPosRef.current = null;
        };
        if (triggerPointerDownPosRef.current !== null) {
          document.addEventListener("pointermove", handlePointerMove);
          document.addEventListener("pointerup", handlePointerUp, { capture: true, once: true });
        }
        return () => {
          document.removeEventListener("pointermove", handlePointerMove);
          document.removeEventListener("pointerup", handlePointerUp, { capture: true });
        };
      }
    }, [content, onOpenChange, triggerPointerDownPosRef]);
    reactExports.useEffect(() => {
      const close = () => onOpenChange(false);
      window.addEventListener("blur", close);
      window.addEventListener("resize", close);
      return () => {
        window.removeEventListener("blur", close);
        window.removeEventListener("resize", close);
      };
    }, [onOpenChange]);
    const [searchRef, handleTypeaheadSearch] = useTypeaheadSearch((search) => {
      const enabledItems = getItems().filter((item) => !item.disabled);
      const currentItem = enabledItems.find((item) => item.ref.current === document.activeElement);
      const nextItem = findNextItem(enabledItems, search, currentItem);
      if (nextItem) {
        setTimeout(() => nextItem.ref.current.focus());
      }
    });
    const itemRefCallback = reactExports.useCallback(
      (node, value, disabled) => {
        const isFirstValidItem = !firstValidItemFoundRef.current && !disabled;
        const isSelectedItem = context.value !== void 0 && context.value === value;
        if (isSelectedItem || isFirstValidItem) {
          setSelectedItem(node);
          if (isFirstValidItem) firstValidItemFoundRef.current = true;
        }
      },
      [context.value]
    );
    const handleItemLeave = reactExports.useCallback(() => content?.focus(), [content]);
    const itemTextRefCallback = reactExports.useCallback(
      (node, value, disabled) => {
        const isFirstValidItem = !firstValidItemFoundRef.current && !disabled;
        const isSelectedItem = context.value !== void 0 && context.value === value;
        if (isSelectedItem || isFirstValidItem) {
          setSelectedItemText(node);
        }
      },
      [context.value]
    );
    const SelectPosition = position === "popper" ? SelectPopperPosition : SelectItemAlignedPosition;
    const popperContentProps = SelectPosition === SelectPopperPosition ? {
      side,
      sideOffset,
      align,
      alignOffset,
      arrowPadding,
      collisionBoundary,
      collisionPadding,
      sticky,
      hideWhenDetached,
      avoidCollisions
    } : {};
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      SelectContentProvider,
      {
        scope: __scopeSelect,
        content,
        viewport,
        onViewportChange: setViewport,
        itemRefCallback,
        selectedItem,
        onItemLeave: handleItemLeave,
        itemTextRefCallback,
        focusSelectedItem,
        selectedItemText,
        position,
        isPositioned,
        searchRef,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(ReactRemoveScroll, { as: Slot, allowPinchZoom: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          FocusScope,
          {
            asChild: true,
            trapped: context.open,
            onMountAutoFocus: (event) => {
              event.preventDefault();
            },
            onUnmountAutoFocus: composeEventHandlers(onCloseAutoFocus, (event) => {
              context.trigger?.focus({ preventScroll: true });
              event.preventDefault();
            }),
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              DismissableLayer,
              {
                asChild: true,
                disableOutsidePointerEvents: true,
                onEscapeKeyDown,
                onPointerDownOutside,
                onFocusOutside: (event) => event.preventDefault(),
                onDismiss: () => context.onOpenChange(false),
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  SelectPosition,
                  {
                    role: "listbox",
                    id: context.contentId,
                    "data-state": context.open ? "open" : "closed",
                    dir: context.dir,
                    onContextMenu: (event) => event.preventDefault(),
                    ...contentProps,
                    ...popperContentProps,
                    onPlaced: () => setIsPositioned(true),
                    ref: composedRefs,
                    style: {
                      // flex layout so we can place the scroll buttons properly
                      display: "flex",
                      flexDirection: "column",
                      // reset the outline by default as the content MAY get focused
                      outline: "none",
                      ...contentProps.style
                    },
                    onKeyDown: composeEventHandlers(contentProps.onKeyDown, (event) => {
                      const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;
                      if (event.key === "Tab") event.preventDefault();
                      if (!isModifierKey && event.key.length === 1) handleTypeaheadSearch(event.key);
                      if (["ArrowUp", "ArrowDown", "Home", "End"].includes(event.key)) {
                        const items = getItems().filter((item) => !item.disabled);
                        let candidateNodes = items.map((item) => item.ref.current);
                        if (["ArrowUp", "End"].includes(event.key)) {
                          candidateNodes = candidateNodes.slice().reverse();
                        }
                        if (["ArrowUp", "ArrowDown"].includes(event.key)) {
                          const currentElement = event.target;
                          const currentIndex = candidateNodes.indexOf(currentElement);
                          candidateNodes = candidateNodes.slice(currentIndex + 1);
                        }
                        setTimeout(() => focusFirst(candidateNodes));
                        event.preventDefault();
                      }
                    })
                  }
                )
              }
            )
          }
        ) })
      }
    );
  }
);
SelectContentImpl.displayName = CONTENT_IMPL_NAME;
var ITEM_ALIGNED_POSITION_NAME = "SelectItemAlignedPosition";
var SelectItemAlignedPosition = reactExports.forwardRef((props, forwardedRef) => {
  const { __scopeSelect, onPlaced, ...popperProps } = props;
  const context = useSelectContext(CONTENT_NAME$1, __scopeSelect);
  const contentContext = useSelectContentContext(CONTENT_NAME$1, __scopeSelect);
  const [contentWrapper, setContentWrapper] = reactExports.useState(null);
  const [content, setContent] = reactExports.useState(null);
  const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));
  const getItems = useCollection(__scopeSelect);
  const shouldExpandOnScrollRef = reactExports.useRef(false);
  const shouldRepositionRef = reactExports.useRef(true);
  const { viewport, selectedItem, selectedItemText, focusSelectedItem } = contentContext;
  const position = reactExports.useCallback(() => {
    if (context.trigger && context.valueNode && contentWrapper && content && viewport && selectedItem && selectedItemText) {
      const triggerRect = context.trigger.getBoundingClientRect();
      const contentRect = content.getBoundingClientRect();
      const valueNodeRect = context.valueNode.getBoundingClientRect();
      const itemTextRect = selectedItemText.getBoundingClientRect();
      if (context.dir !== "rtl") {
        const itemTextOffset = itemTextRect.left - contentRect.left;
        const left = valueNodeRect.left - itemTextOffset;
        const leftDelta = triggerRect.left - left;
        const minContentWidth = triggerRect.width + leftDelta;
        const contentWidth = Math.max(minContentWidth, contentRect.width);
        const rightEdge = window.innerWidth - CONTENT_MARGIN;
        const clampedLeft = clamp(left, [
          CONTENT_MARGIN,
          // Prevents the content from going off the starting edge of the
          // viewport. It may still go off the ending edge, but this can be
          // controlled by the user since they may want to manage overflow in a
          // specific way.
          // https://github.com/radix-ui/primitives/issues/2049
          Math.max(CONTENT_MARGIN, rightEdge - contentWidth)
        ]);
        contentWrapper.style.minWidth = minContentWidth + "px";
        contentWrapper.style.left = clampedLeft + "px";
      } else {
        const itemTextOffset = contentRect.right - itemTextRect.right;
        const right = window.innerWidth - valueNodeRect.right - itemTextOffset;
        const rightDelta = window.innerWidth - triggerRect.right - right;
        const minContentWidth = triggerRect.width + rightDelta;
        const contentWidth = Math.max(minContentWidth, contentRect.width);
        const leftEdge = window.innerWidth - CONTENT_MARGIN;
        const clampedRight = clamp(right, [
          CONTENT_MARGIN,
          Math.max(CONTENT_MARGIN, leftEdge - contentWidth)
        ]);
        contentWrapper.style.minWidth = minContentWidth + "px";
        contentWrapper.style.right = clampedRight + "px";
      }
      const items = getItems();
      const availableHeight = window.innerHeight - CONTENT_MARGIN * 2;
      const itemsHeight = viewport.scrollHeight;
      const contentStyles = window.getComputedStyle(content);
      const contentBorderTopWidth = parseInt(contentStyles.borderTopWidth, 10);
      const contentPaddingTop = parseInt(contentStyles.paddingTop, 10);
      const contentBorderBottomWidth = parseInt(contentStyles.borderBottomWidth, 10);
      const contentPaddingBottom = parseInt(contentStyles.paddingBottom, 10);
      const fullContentHeight = contentBorderTopWidth + contentPaddingTop + itemsHeight + contentPaddingBottom + contentBorderBottomWidth;
      const minContentHeight = Math.min(selectedItem.offsetHeight * 5, fullContentHeight);
      const viewportStyles = window.getComputedStyle(viewport);
      const viewportPaddingTop = parseInt(viewportStyles.paddingTop, 10);
      const viewportPaddingBottom = parseInt(viewportStyles.paddingBottom, 10);
      const topEdgeToTriggerMiddle = triggerRect.top + triggerRect.height / 2 - CONTENT_MARGIN;
      const triggerMiddleToBottomEdge = availableHeight - topEdgeToTriggerMiddle;
      const selectedItemHalfHeight = selectedItem.offsetHeight / 2;
      const itemOffsetMiddle = selectedItem.offsetTop + selectedItemHalfHeight;
      const contentTopToItemMiddle = contentBorderTopWidth + contentPaddingTop + itemOffsetMiddle;
      const itemMiddleToContentBottom = fullContentHeight - contentTopToItemMiddle;
      const willAlignWithoutTopOverflow = contentTopToItemMiddle <= topEdgeToTriggerMiddle;
      if (willAlignWithoutTopOverflow) {
        const isLastItem = items.length > 0 && selectedItem === items[items.length - 1].ref.current;
        contentWrapper.style.bottom = "0px";
        const viewportOffsetBottom = content.clientHeight - viewport.offsetTop - viewport.offsetHeight;
        const clampedTriggerMiddleToBottomEdge = Math.max(
          triggerMiddleToBottomEdge,
          selectedItemHalfHeight + // viewport might have padding bottom, include it to avoid a scrollable viewport
          (isLastItem ? viewportPaddingBottom : 0) + viewportOffsetBottom + contentBorderBottomWidth
        );
        const height = contentTopToItemMiddle + clampedTriggerMiddleToBottomEdge;
        contentWrapper.style.height = height + "px";
      } else {
        const isFirstItem = items.length > 0 && selectedItem === items[0].ref.current;
        contentWrapper.style.top = "0px";
        const clampedTopEdgeToTriggerMiddle = Math.max(
          topEdgeToTriggerMiddle,
          contentBorderTopWidth + viewport.offsetTop + // viewport might have padding top, include it to avoid a scrollable viewport
          (isFirstItem ? viewportPaddingTop : 0) + selectedItemHalfHeight
        );
        const height = clampedTopEdgeToTriggerMiddle + itemMiddleToContentBottom;
        contentWrapper.style.height = height + "px";
        viewport.scrollTop = contentTopToItemMiddle - topEdgeToTriggerMiddle + viewport.offsetTop;
      }
      contentWrapper.style.margin = `${CONTENT_MARGIN}px 0`;
      contentWrapper.style.minHeight = minContentHeight + "px";
      contentWrapper.style.maxHeight = availableHeight + "px";
      onPlaced?.();
      requestAnimationFrame(() => shouldExpandOnScrollRef.current = true);
    }
  }, [
    getItems,
    context.trigger,
    context.valueNode,
    contentWrapper,
    content,
    viewport,
    selectedItem,
    selectedItemText,
    context.dir,
    onPlaced
  ]);
  useLayoutEffect2(() => position(), [position]);
  const [contentZIndex, setContentZIndex] = reactExports.useState();
  useLayoutEffect2(() => {
    if (content) setContentZIndex(window.getComputedStyle(content).zIndex);
  }, [content]);
  const handleScrollButtonChange = reactExports.useCallback(
    (node) => {
      if (node && shouldRepositionRef.current === true) {
        position();
        focusSelectedItem?.();
        shouldRepositionRef.current = false;
      }
    },
    [position, focusSelectedItem]
  );
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    SelectViewportProvider,
    {
      scope: __scopeSelect,
      contentWrapper,
      shouldExpandOnScrollRef,
      onScrollButtonChange: handleScrollButtonChange,
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          ref: setContentWrapper,
          style: {
            display: "flex",
            flexDirection: "column",
            position: "fixed",
            zIndex: contentZIndex
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            Primitive$3.div,
            {
              ...popperProps,
              ref: composedRefs,
              style: {
                // When we get the height of the content, it includes borders. If we were to set
                // the height without having `boxSizing: 'border-box'` it would be too big.
                boxSizing: "border-box",
                // We need to ensure the content doesn't get taller than the wrapper
                maxHeight: "100%",
                ...popperProps.style
              }
            }
          )
        }
      )
    }
  );
});
SelectItemAlignedPosition.displayName = ITEM_ALIGNED_POSITION_NAME;
var POPPER_POSITION_NAME = "SelectPopperPosition";
var SelectPopperPosition = reactExports.forwardRef((props, forwardedRef) => {
  const {
    __scopeSelect,
    align = "start",
    collisionPadding = CONTENT_MARGIN,
    ...popperProps
  } = props;
  const popperScope = usePopperScope(__scopeSelect);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Content$1,
    {
      ...popperScope,
      ...popperProps,
      ref: forwardedRef,
      align,
      collisionPadding,
      style: {
        // Ensure border-box for floating-ui calculations
        boxSizing: "border-box",
        ...popperProps.style,
        // re-namespace exposed content custom properties
        ...{
          "--radix-select-content-transform-origin": "var(--radix-popper-transform-origin)",
          "--radix-select-content-available-width": "var(--radix-popper-available-width)",
          "--radix-select-content-available-height": "var(--radix-popper-available-height)",
          "--radix-select-trigger-width": "var(--radix-popper-anchor-width)",
          "--radix-select-trigger-height": "var(--radix-popper-anchor-height)"
        }
      }
    }
  );
});
SelectPopperPosition.displayName = POPPER_POSITION_NAME;
var [SelectViewportProvider, useSelectViewportContext] = createSelectContext(CONTENT_NAME$1, {});
var VIEWPORT_NAME = "SelectViewport";
var SelectViewport = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, nonce, ...viewportProps } = props;
    const contentContext = useSelectContentContext(VIEWPORT_NAME, __scopeSelect);
    const viewportContext = useSelectViewportContext(VIEWPORT_NAME, __scopeSelect);
    const composedRefs = useComposedRefs(forwardedRef, contentContext.onViewportChange);
    const prevScrollTopRef = reactExports.useRef(0);
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "style",
        {
          dangerouslySetInnerHTML: {
            __html: `[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}`
          },
          nonce
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Collection.Slot, { scope: __scopeSelect, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Primitive$3.div,
        {
          "data-radix-select-viewport": "",
          role: "presentation",
          ...viewportProps,
          ref: composedRefs,
          style: {
            // we use position: 'relative' here on the `viewport` so that when we call
            // `selectedItem.offsetTop` in calculations, the offset is relative to the viewport
            // (independent of the scrollUpButton).
            position: "relative",
            flex: 1,
            // Viewport should only be scrollable in the vertical direction.
            // This won't work in vertical writing modes, so we'll need to
            // revisit this if/when that is supported
            // https://developer.chrome.com/blog/vertical-form-controls
            overflow: "hidden auto",
            ...viewportProps.style
          },
          onScroll: composeEventHandlers(viewportProps.onScroll, (event) => {
            const viewport = event.currentTarget;
            const { contentWrapper, shouldExpandOnScrollRef } = viewportContext;
            if (shouldExpandOnScrollRef?.current && contentWrapper) {
              const scrolledBy = Math.abs(prevScrollTopRef.current - viewport.scrollTop);
              if (scrolledBy > 0) {
                const availableHeight = window.innerHeight - CONTENT_MARGIN * 2;
                const cssMinHeight = parseFloat(contentWrapper.style.minHeight);
                const cssHeight = parseFloat(contentWrapper.style.height);
                const prevHeight = Math.max(cssMinHeight, cssHeight);
                if (prevHeight < availableHeight) {
                  const nextHeight = prevHeight + scrolledBy;
                  const clampedNextHeight = Math.min(availableHeight, nextHeight);
                  const heightDiff = nextHeight - clampedNextHeight;
                  contentWrapper.style.height = clampedNextHeight + "px";
                  if (contentWrapper.style.bottom === "0px") {
                    viewport.scrollTop = heightDiff > 0 ? heightDiff : 0;
                    contentWrapper.style.justifyContent = "flex-end";
                  }
                }
              }
            }
            prevScrollTopRef.current = viewport.scrollTop;
          })
        }
      ) })
    ] });
  }
);
SelectViewport.displayName = VIEWPORT_NAME;
var GROUP_NAME = "SelectGroup";
var [SelectGroupContextProvider, useSelectGroupContext] = createSelectContext(GROUP_NAME);
var SelectGroup = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...groupProps } = props;
    const groupId = useId();
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SelectGroupContextProvider, { scope: __scopeSelect, id: groupId, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.div, { role: "group", "aria-labelledby": groupId, ...groupProps, ref: forwardedRef }) });
  }
);
SelectGroup.displayName = GROUP_NAME;
var LABEL_NAME = "SelectLabel";
var SelectLabel$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...labelProps } = props;
    const groupContext = useSelectGroupContext(LABEL_NAME, __scopeSelect);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.div, { id: groupContext.id, ...labelProps, ref: forwardedRef });
  }
);
SelectLabel$1.displayName = LABEL_NAME;
var ITEM_NAME = "SelectItem";
var [SelectItemContextProvider, useSelectItemContext] = createSelectContext(ITEM_NAME);
var SelectItem$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeSelect,
      value,
      disabled = false,
      textValue: textValueProp,
      ...itemProps
    } = props;
    const context = useSelectContext(ITEM_NAME, __scopeSelect);
    const contentContext = useSelectContentContext(ITEM_NAME, __scopeSelect);
    const isSelected = context.value === value;
    const [textValue, setTextValue] = reactExports.useState(textValueProp ?? "");
    const [isFocused, setIsFocused] = reactExports.useState(false);
    const composedRefs = useComposedRefs(
      forwardedRef,
      (node) => contentContext.itemRefCallback?.(node, value, disabled)
    );
    const textId = useId();
    const pointerTypeRef = reactExports.useRef("touch");
    const handleSelect = () => {
      if (!disabled) {
        context.onValueChange(value);
        context.onOpenChange(false);
      }
    };
    if (value === "") {
      throw new Error(
        "A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder."
      );
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      SelectItemContextProvider,
      {
        scope: __scopeSelect,
        value,
        disabled,
        textId,
        isSelected,
        onItemTextChange: reactExports.useCallback((node) => {
          setTextValue((prevTextValue) => prevTextValue || (node?.textContent ?? "").trim());
        }, []),
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Collection.ItemSlot,
          {
            scope: __scopeSelect,
            value,
            disabled,
            textValue,
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              Primitive$3.div,
              {
                role: "option",
                "aria-labelledby": textId,
                "data-highlighted": isFocused ? "" : void 0,
                "aria-selected": isSelected && isFocused,
                "data-state": isSelected ? "checked" : "unchecked",
                "aria-disabled": disabled || void 0,
                "data-disabled": disabled ? "" : void 0,
                tabIndex: disabled ? void 0 : -1,
                ...itemProps,
                ref: composedRefs,
                onFocus: composeEventHandlers(itemProps.onFocus, () => setIsFocused(true)),
                onBlur: composeEventHandlers(itemProps.onBlur, () => setIsFocused(false)),
                onClick: composeEventHandlers(itemProps.onClick, () => {
                  if (pointerTypeRef.current !== "mouse") handleSelect();
                }),
                onPointerUp: composeEventHandlers(itemProps.onPointerUp, () => {
                  if (pointerTypeRef.current === "mouse") handleSelect();
                }),
                onPointerDown: composeEventHandlers(itemProps.onPointerDown, (event) => {
                  pointerTypeRef.current = event.pointerType;
                }),
                onPointerMove: composeEventHandlers(itemProps.onPointerMove, (event) => {
                  pointerTypeRef.current = event.pointerType;
                  if (disabled) {
                    contentContext.onItemLeave?.();
                  } else if (pointerTypeRef.current === "mouse") {
                    event.currentTarget.focus({ preventScroll: true });
                  }
                }),
                onPointerLeave: composeEventHandlers(itemProps.onPointerLeave, (event) => {
                  if (event.currentTarget === document.activeElement) {
                    contentContext.onItemLeave?.();
                  }
                }),
                onKeyDown: composeEventHandlers(itemProps.onKeyDown, (event) => {
                  const isTypingAhead = contentContext.searchRef?.current !== "";
                  if (isTypingAhead && event.key === " ") return;
                  if (SELECTION_KEYS.includes(event.key)) handleSelect();
                  if (event.key === " ") event.preventDefault();
                })
              }
            )
          }
        )
      }
    );
  }
);
SelectItem$1.displayName = ITEM_NAME;
var ITEM_TEXT_NAME = "SelectItemText";
var SelectItemText = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, className, style, ...itemTextProps } = props;
    const context = useSelectContext(ITEM_TEXT_NAME, __scopeSelect);
    const contentContext = useSelectContentContext(ITEM_TEXT_NAME, __scopeSelect);
    const itemContext = useSelectItemContext(ITEM_TEXT_NAME, __scopeSelect);
    const nativeOptionsContext = useSelectNativeOptionsContext(ITEM_TEXT_NAME, __scopeSelect);
    const [itemTextNode, setItemTextNode] = reactExports.useState(null);
    const composedRefs = useComposedRefs(
      forwardedRef,
      (node) => setItemTextNode(node),
      itemContext.onItemTextChange,
      (node) => contentContext.itemTextRefCallback?.(node, itemContext.value, itemContext.disabled)
    );
    const textContent = itemTextNode?.textContent;
    const nativeOption = reactExports.useMemo(
      () => /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: itemContext.value, disabled: itemContext.disabled, children: textContent }, itemContext.value),
      [itemContext.disabled, itemContext.value, textContent]
    );
    const { onNativeOptionAdd, onNativeOptionRemove } = nativeOptionsContext;
    useLayoutEffect2(() => {
      onNativeOptionAdd(nativeOption);
      return () => onNativeOptionRemove(nativeOption);
    }, [onNativeOptionAdd, onNativeOptionRemove, nativeOption]);
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.span, { id: itemContext.textId, ...itemTextProps, ref: composedRefs }),
      itemContext.isSelected && context.valueNode && !context.valueNodeHasChildren ? reactDomExports.createPortal(itemTextProps.children, context.valueNode) : null
    ] });
  }
);
SelectItemText.displayName = ITEM_TEXT_NAME;
var ITEM_INDICATOR_NAME = "SelectItemIndicator";
var SelectItemIndicator = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...itemIndicatorProps } = props;
    const itemContext = useSelectItemContext(ITEM_INDICATOR_NAME, __scopeSelect);
    return itemContext.isSelected ? /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.span, { "aria-hidden": true, ...itemIndicatorProps, ref: forwardedRef }) : null;
  }
);
SelectItemIndicator.displayName = ITEM_INDICATOR_NAME;
var SCROLL_UP_BUTTON_NAME = "SelectScrollUpButton";
var SelectScrollUpButton$1 = reactExports.forwardRef((props, forwardedRef) => {
  const contentContext = useSelectContentContext(SCROLL_UP_BUTTON_NAME, props.__scopeSelect);
  const viewportContext = useSelectViewportContext(SCROLL_UP_BUTTON_NAME, props.__scopeSelect);
  const [canScrollUp, setCanScrollUp] = reactExports.useState(false);
  const composedRefs = useComposedRefs(forwardedRef, viewportContext.onScrollButtonChange);
  useLayoutEffect2(() => {
    if (contentContext.viewport && contentContext.isPositioned) {
      let handleScroll2 = function() {
        const canScrollUp2 = viewport.scrollTop > 0;
        setCanScrollUp(canScrollUp2);
      };
      const viewport = contentContext.viewport;
      handleScroll2();
      viewport.addEventListener("scroll", handleScroll2);
      return () => viewport.removeEventListener("scroll", handleScroll2);
    }
  }, [contentContext.viewport, contentContext.isPositioned]);
  return canScrollUp ? /* @__PURE__ */ jsxRuntimeExports.jsx(
    SelectScrollButtonImpl,
    {
      ...props,
      ref: composedRefs,
      onAutoScroll: () => {
        const { viewport, selectedItem } = contentContext;
        if (viewport && selectedItem) {
          viewport.scrollTop = viewport.scrollTop - selectedItem.offsetHeight;
        }
      }
    }
  ) : null;
});
SelectScrollUpButton$1.displayName = SCROLL_UP_BUTTON_NAME;
var SCROLL_DOWN_BUTTON_NAME = "SelectScrollDownButton";
var SelectScrollDownButton$1 = reactExports.forwardRef((props, forwardedRef) => {
  const contentContext = useSelectContentContext(SCROLL_DOWN_BUTTON_NAME, props.__scopeSelect);
  const viewportContext = useSelectViewportContext(SCROLL_DOWN_BUTTON_NAME, props.__scopeSelect);
  const [canScrollDown, setCanScrollDown] = reactExports.useState(false);
  const composedRefs = useComposedRefs(forwardedRef, viewportContext.onScrollButtonChange);
  useLayoutEffect2(() => {
    if (contentContext.viewport && contentContext.isPositioned) {
      let handleScroll2 = function() {
        const maxScroll = viewport.scrollHeight - viewport.clientHeight;
        const canScrollDown2 = Math.ceil(viewport.scrollTop) < maxScroll;
        setCanScrollDown(canScrollDown2);
      };
      const viewport = contentContext.viewport;
      handleScroll2();
      viewport.addEventListener("scroll", handleScroll2);
      return () => viewport.removeEventListener("scroll", handleScroll2);
    }
  }, [contentContext.viewport, contentContext.isPositioned]);
  return canScrollDown ? /* @__PURE__ */ jsxRuntimeExports.jsx(
    SelectScrollButtonImpl,
    {
      ...props,
      ref: composedRefs,
      onAutoScroll: () => {
        const { viewport, selectedItem } = contentContext;
        if (viewport && selectedItem) {
          viewport.scrollTop = viewport.scrollTop + selectedItem.offsetHeight;
        }
      }
    }
  ) : null;
});
SelectScrollDownButton$1.displayName = SCROLL_DOWN_BUTTON_NAME;
var SelectScrollButtonImpl = reactExports.forwardRef((props, forwardedRef) => {
  const { __scopeSelect, onAutoScroll, ...scrollIndicatorProps } = props;
  const contentContext = useSelectContentContext("SelectScrollButton", __scopeSelect);
  const autoScrollTimerRef = reactExports.useRef(null);
  const getItems = useCollection(__scopeSelect);
  const clearAutoScrollTimer = reactExports.useCallback(() => {
    if (autoScrollTimerRef.current !== null) {
      window.clearInterval(autoScrollTimerRef.current);
      autoScrollTimerRef.current = null;
    }
  }, []);
  reactExports.useEffect(() => {
    return () => clearAutoScrollTimer();
  }, [clearAutoScrollTimer]);
  useLayoutEffect2(() => {
    const activeItem = getItems().find((item) => item.ref.current === document.activeElement);
    activeItem?.ref.current?.scrollIntoView({ block: "nearest" });
  }, [getItems]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Primitive$3.div,
    {
      "aria-hidden": true,
      ...scrollIndicatorProps,
      ref: forwardedRef,
      style: { flexShrink: 0, ...scrollIndicatorProps.style },
      onPointerDown: composeEventHandlers(scrollIndicatorProps.onPointerDown, () => {
        if (autoScrollTimerRef.current === null) {
          autoScrollTimerRef.current = window.setInterval(onAutoScroll, 50);
        }
      }),
      onPointerMove: composeEventHandlers(scrollIndicatorProps.onPointerMove, () => {
        contentContext.onItemLeave?.();
        if (autoScrollTimerRef.current === null) {
          autoScrollTimerRef.current = window.setInterval(onAutoScroll, 50);
        }
      }),
      onPointerLeave: composeEventHandlers(scrollIndicatorProps.onPointerLeave, () => {
        clearAutoScrollTimer();
      })
    }
  );
});
var SEPARATOR_NAME = "SelectSeparator";
var SelectSeparator$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...separatorProps } = props;
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.div, { "aria-hidden": true, ...separatorProps, ref: forwardedRef });
  }
);
SelectSeparator$1.displayName = SEPARATOR_NAME;
var ARROW_NAME = "SelectArrow";
var SelectArrow = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...arrowProps } = props;
    const popperScope = usePopperScope(__scopeSelect);
    const context = useSelectContext(ARROW_NAME, __scopeSelect);
    const contentContext = useSelectContentContext(ARROW_NAME, __scopeSelect);
    return context.open && contentContext.position === "popper" ? /* @__PURE__ */ jsxRuntimeExports.jsx(Arrow, { ...popperScope, ...arrowProps, ref: forwardedRef }) : null;
  }
);
SelectArrow.displayName = ARROW_NAME;
var BUBBLE_INPUT_NAME$1 = "SelectBubbleInput";
var SelectBubbleInput = reactExports.forwardRef(
  ({ __scopeSelect, value, ...props }, forwardedRef) => {
    const ref = reactExports.useRef(null);
    const composedRefs = useComposedRefs(forwardedRef, ref);
    const prevValue = usePrevious(value);
    reactExports.useEffect(() => {
      const select = ref.current;
      if (!select) return;
      const selectProto = window.HTMLSelectElement.prototype;
      const descriptor = Object.getOwnPropertyDescriptor(
        selectProto,
        "value"
      );
      const setValue = descriptor.set;
      if (prevValue !== value && setValue) {
        const event = new Event("change", { bubbles: true });
        setValue.call(select, value);
        select.dispatchEvent(event);
      }
    }, [prevValue, value]);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.select,
      {
        ...props,
        style: { ...VISUALLY_HIDDEN_STYLES, ...props.style },
        ref: composedRefs,
        defaultValue: value
      }
    );
  }
);
SelectBubbleInput.displayName = BUBBLE_INPUT_NAME$1;
function shouldShowPlaceholder(value) {
  return value === "" || value === void 0;
}
function useTypeaheadSearch(onSearchChange) {
  const handleSearchChange = useCallbackRef(onSearchChange);
  const searchRef = reactExports.useRef("");
  const timerRef = reactExports.useRef(0);
  const handleTypeaheadSearch = reactExports.useCallback(
    (key) => {
      const search = searchRef.current + key;
      handleSearchChange(search);
      (function updateSearch(value) {
        searchRef.current = value;
        window.clearTimeout(timerRef.current);
        if (value !== "") timerRef.current = window.setTimeout(() => updateSearch(""), 1e3);
      })(search);
    },
    [handleSearchChange]
  );
  const resetTypeahead = reactExports.useCallback(() => {
    searchRef.current = "";
    window.clearTimeout(timerRef.current);
  }, []);
  reactExports.useEffect(() => {
    return () => window.clearTimeout(timerRef.current);
  }, []);
  return [searchRef, handleTypeaheadSearch, resetTypeahead];
}
function findNextItem(items, search, currentItem) {
  const isRepeated = search.length > 1 && Array.from(search).every((char) => char === search[0]);
  const normalizedSearch = isRepeated ? search[0] : search;
  const currentItemIndex = currentItem ? items.indexOf(currentItem) : -1;
  let wrappedItems = wrapArray(items, Math.max(currentItemIndex, 0));
  const excludeCurrentItem = normalizedSearch.length === 1;
  if (excludeCurrentItem) wrappedItems = wrappedItems.filter((v) => v !== currentItem);
  const nextItem = wrappedItems.find(
    (item) => item.textValue.toLowerCase().startsWith(normalizedSearch.toLowerCase())
  );
  return nextItem !== currentItem ? nextItem : void 0;
}
function wrapArray(array, startIndex) {
  return array.map((_, index) => array[(startIndex + index) % array.length]);
}
var Root2$1 = Select$1;
var Trigger = SelectTrigger$1;
var Value = SelectValue$1;
var Icon = SelectIcon;
var Portal = SelectPortal;
var Content2$1 = SelectContent$1;
var Viewport = SelectViewport;
var Label = SelectLabel$1;
var Item = SelectItem$1;
var ItemText = SelectItemText;
var ItemIndicator = SelectItemIndicator;
var ScrollUpButton = SelectScrollUpButton$1;
var ScrollDownButton = SelectScrollDownButton$1;
var Separator = SelectSeparator$1;

const Select = Root2$1;
const SelectValue = Value;
const SelectTrigger = reactExports.forwardRef(({ className, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
  Trigger,
  {
    ref,
    className: cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    ),
    ...props,
    children: [
      children,
      /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { asChild: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "h-4 w-4 opacity-50" }) })
    ]
  }
));
SelectTrigger.displayName = Trigger.displayName;
const SelectScrollUpButton = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  ScrollUpButton,
  {
    ref,
    className: cn(
      "flex cursor-default items-center justify-center py-1",
      className
    ),
    ...props,
    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronUp, { className: "h-4 w-4" })
  }
));
SelectScrollUpButton.displayName = ScrollUpButton.displayName;
const SelectScrollDownButton = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  ScrollDownButton,
  {
    ref,
    className: cn(
      "flex cursor-default items-center justify-center py-1",
      className
    ),
    ...props,
    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "h-4 w-4" })
  }
));
SelectScrollDownButton.displayName = ScrollDownButton.displayName;
const SelectContent = reactExports.forwardRef(({ className, children, position = "popper", ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(Portal, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
  Content2$1,
  {
    ref,
    className: cn(
      "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      position === "popper" && "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
      className
    ),
    position,
    ...props,
    children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectScrollUpButton, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Viewport,
        {
          className: cn(
            "p-1",
            position === "popper" && "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
          ),
          children
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectScrollDownButton, {})
    ]
  }
) }));
SelectContent.displayName = Content2$1.displayName;
const SelectLabel = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Label,
  {
    ref,
    className: cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className),
    ...props
  }
));
SelectLabel.displayName = Label.displayName;
const SelectItem = reactExports.forwardRef(({ className, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
  Item,
  {
    ref,
    className: cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    ),
    ...props,
    children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "absolute left-2 flex h-3.5 w-3.5 items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ItemIndicator, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "h-4 w-4" }) }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ItemText, { children })
    ]
  }
));
SelectItem.displayName = Item.displayName;
const SelectSeparator = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Separator,
  {
    ref,
    className: cn("-mx-1 my-1 h-px bg-muted", className),
    ...props
  }
));
SelectSeparator.displayName = Separator.displayName;

const TriangleDownIcon = ({ className }) => /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { viewBox: "0 0 24 24", fill: "currentColor", stroke: "currentColor", strokeWidth: "1", className, children: /* @__PURE__ */ jsxRuntimeExports.jsx("polygon", { points: "12,20 3,6 21,6" }) });
const TriangleUpIcon = ({ className }) => /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { viewBox: "0 0 24 24", fill: "currentColor", stroke: "currentColor", strokeWidth: "1", className, children: /* @__PURE__ */ jsxRuntimeExports.jsx("polygon", { points: "12,4 3,18 21,18" }) });
const LeaderboardPage = () => {
  const [scope, setScope] = reactExports.useState("global");
  const [filterValue, setFilterValue] = reactExports.useState("");
  const [filterOptions, setFilterOptions] = reactExports.useState([]);
  const [activeTab, setActiveTab] = reactExports.useState("score");
  const {
    leaderboard,
    loading,
    error,
    currentUserRank,
    lastOvertake,
    refetch,
    getFilterOptions
  } = useRealtimeLeaderboard({
    scope,
    filterValue: filterValue || void 0,
    limit: 50,
    enableNotifications: true
  });
  reactExports.useEffect(() => {
    notifyShadowContext("leaderboard");
  }, []);
  reactExports.useEffect(() => {
    if (scope !== "global") {
      getFilterOptions(scope).then(setFilterOptions);
    } else {
      setFilterOptions([]);
      setFilterValue("");
    }
  }, [scope, getFilterOptions]);
  const handleScopeChange = (newScope) => {
    hapticLight();
    setScope(newScope);
    setFilterValue("");
  };
  const getRankStyling = (rank, isTop10) => {
    if (rank === 1) {
      return {
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleDownIcon, { className: "w-7 h-7 text-pink-400 drop-shadow-[0_0_12px_rgba(236,72,153,0.9)]" }),
        bgClass: "bg-gradient-to-r from-purple-600/40 to-pink-500/40",
        borderClass: "border-pink-500/60",
        glowClass: "shadow-[0_0_25px_rgba(236,72,153,0.5)]",
        textClass: "text-pink-400"
      };
    }
    if (rank === 2) {
      return {
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleUpIcon, { className: "w-6 h-6 text-blue-400 drop-shadow-[0_0_10px_rgba(59,130,246,0.8)]" }),
        bgClass: "bg-gradient-to-r from-purple-600/35 to-blue-500/35",
        borderClass: "border-blue-500/50",
        glowClass: "shadow-[0_0_20px_rgba(59,130,246,0.4)]",
        textClass: "text-blue-400"
      };
    }
    if (rank === 3) {
      return {
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Circle, { className: "w-6 h-6 text-emerald-400 fill-emerald-400 drop-shadow-[0_0_10px_rgba(52,211,153,0.8)]" }),
        bgClass: "bg-gradient-to-r from-purple-600/30 to-emerald-500/30",
        borderClass: "border-emerald-500/50",
        glowClass: "shadow-[0_0_20px_rgba(52,211,153,0.4)]",
        textClass: "text-emerald-400"
      };
    }
    if (isTop10) {
      return {
        icon: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "w-6 h-6 flex items-center justify-center text-cyan-400 font-bold text-lg", children: [
          "#",
          rank
        ] }),
        bgClass: "bg-gradient-to-r from-cyan-500/10 to-blue-500/10",
        borderClass: "border-cyan-500/30",
        glowClass: "shadow-[0_0_10px_rgba(0,209,255,0.2)]",
        textClass: "text-cyan-400"
      };
    }
    return {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "w-6 h-6 flex items-center justify-center text-gray-500 font-bold", children: [
        "#",
        rank
      ] }),
      bgClass: "bg-gray-800/30",
      borderClass: "border-gray-700/30",
      glowClass: "",
      textClass: "text-gray-400"
    };
  };
  const getTierBadge = (tier) => {
    switch (tier) {
      case "premium":
      case "gold":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-gradient-to-r from-yellow-500 to-amber-500 text-black text-[10px] px-1.5", children: "GOLD" });
      case "silver":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-gray-400 text-black text-[10px] px-1.5", children: "SILVER" });
      case "black":
      case "titanium":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-gradient-to-r from-purple-600 to-pink-600 text-white text-[10px] px-1.5", children: "VIP" });
      default:
        return null;
    }
  };
  const scopeIcons = {
    global: /* @__PURE__ */ jsxRuntimeExports.jsx(Globe, { className: "w-4 h-4" }),
    country: /* @__PURE__ */ jsxRuntimeExports.jsx(Map$1, { className: "w-4 h-4" }),
    region: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-4 h-4" }),
    city: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-4 h-4" })
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "min-h-[100dvh] w-full overflow-x-hidden p-4 space-y-4",
      "data-onboarding": "leaderboard",
      style: {
        paddingTop: "calc(env(safe-area-inset-top, 0px) + 90px)",
        paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 100px)"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { y: 20, opacity: 0 },
            animate: { y: 0, opacity: 1 },
            className: "text-center space-y-2",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-3 mb-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { rotate: [0, 10, -10, 0] },
                    transition: { duration: 2, repeat: Infinity },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleDownIcon, { className: "w-8 h-8 text-[#00D1FF] drop-shadow-[0_0_10px_rgba(0,209,255,0.6)]" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "text-3xl font-orbitron font-bold text-white", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", children: "LIVE" }),
                  " Classifica"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { scale: [1, 1.2, 1] },
                    transition: { duration: 1.5, repeat: Infinity },
                    className: "w-3 h-3 rounded-full bg-green-500"
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Aggiornamenti in tempo reale" })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: lastOvertake && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { y: -50, opacity: 0 },
            animate: { y: 0, opacity: 1 },
            exit: { y: -50, opacity: 0 },
            className: "bg-gradient-to-r from-orange-500/20 to-red-500/20 border border-orange-500/40 rounded-xl p-3",
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 text-orange-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-orange-300 text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: lastOvertake.name }),
                " ti ha superato! Ora  #",
                lastOvertake.rank
              ] })
            ] })
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { y: 20, opacity: 0 },
            animate: { y: 0, opacity: 1 },
            transition: { delay: 0.1 },
            className: "space-y-3",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2 overflow-x-auto pb-2 scrollbar-hide", children: ["global", "country", "region", "city"].map((s) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Button,
                {
                  variant: scope === s ? "default" : "outline",
                  size: "sm",
                  onClick: () => handleScopeChange(s),
                  className: `flex-shrink-0 ${scope === s ? "bg-[#00D1FF] text-black" : "border-gray-600"}`,
                  children: [
                    scopeIcons[s],
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "ml-1.5 capitalize", children: s === "global" ? "Globale" : s === "country" ? "Nazione" : s === "region" ? "Regione" : "Citt" })
                  ]
                },
                s
              )) }),
              scope !== "global" && filterOptions.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: filterValue, onValueChange: setFilterValue, children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { className: "bg-gray-800/50 border-gray-600", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: `Seleziona ${scope === "country" ? "nazione" : scope === "region" ? "regione" : "citt"}` }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: filterOptions.map((opt) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: opt, children: opt }, opt)) })
              ] })
            ]
          }
        ),
        currentUserRank && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { y: 20, opacity: 0 },
            animate: { y: 0, opacity: 1 },
            transition: { delay: 0.15 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gradient-to-r from-[#00D1FF]/20 to-[#7B5CFF]/20 border-[#00D1FF]/40 shadow-[0_0_20px_rgba(0,209,255,0.2)]", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    className: "text-3xl font-orbitron font-bold text-[#00D1FF]",
                    animate: { scale: [1, 1.05, 1] },
                    transition: { duration: 2, repeat: Infinity },
                    children: [
                      "#",
                      currentUserRank.rank
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-white", children: "La tua posizione" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400", children: currentUserRank.agent_code }),
                    currentUserRank.change !== void 0 && currentUserRank.change !== 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: `text-xs flex items-center ${currentUserRank.change > 0 ? "text-green-400" : "text-red-400"}`, children: [
                      currentUserRank.change > 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronUp, { className: "w-3 h-3" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-3 h-3" }),
                      Math.abs(currentUserRank.change)
                    ] })
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-lg font-bold text-[#00D1FF]", children: [
                  currentUserRank.total_score.toLocaleString(),
                  " pts"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1 text-xs text-gray-400", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Flame, { className: "w-3 h-3 text-orange-400" }),
                  currentUserRank.streak_days,
                  "d streak"
                ] })
              ] })
            ] }) }) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-end", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            variant: "ghost",
            size: "sm",
            onClick: () => {
              hapticLight();
              refetch();
            },
            disabled: loading,
            className: "text-gray-400 hover:text-white",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: `w-4 h-4 mr-1 ${loading ? "animate-spin" : ""}` }),
              "Aggiorna"
            ]
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { y: 20, opacity: 0 },
            animate: { y: 0, opacity: 1 },
            transition: { delay: 0.2 },
            className: "space-y-2",
            children: loading && leaderboard.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center py-10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                animate: { rotate: 360 },
                transition: { duration: 1, repeat: Infinity, ease: "linear" },
                className: "w-10 h-10 border-2 border-[#00D1FF] border-t-transparent rounded-full"
              }
            ) }) : error ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-10 text-red-400", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: error }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: refetch, variant: "outline", className: "mt-4", children: "Riprova" })
            ] }) : leaderboard.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-10 text-gray-400", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-12 h-12 mx-auto mb-3 opacity-50" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Nessun agente trovato" })
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: leaderboard.map((user, index) => {
              const isTop10 = user.rank <= 10;
              const style = getRankStyling(user.rank, isTop10);
              return /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  initial: { x: -20, opacity: 0 },
                  animate: { x: 0, opacity: 1 },
                  exit: { x: 20, opacity: 0 },
                  transition: { delay: index * 0.03 },
                  layout: true,
                  children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: `${style.bgClass} ${style.borderClass} ${style.glowClass} ${user.isCurrentUser ? "ring-2 ring-[#00D1FF]" : ""} transition-all duration-300 overflow-hidden`, children: [
                    user.rank <= 3 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 right-0 h-0.5 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        className: `h-full ${user.rank === 1 ? "bg-yellow-400" : user.rank === 2 ? "bg-gray-300" : "bg-amber-500"}`,
                        animate: { x: ["-100%", "200%"] },
                        transition: { duration: 2, repeat: Infinity, ease: "linear" },
                        style: { width: "50%" }
                      }
                    ) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-3 sm:p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 sm:gap-3 flex-1 min-w-0", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          motion.div,
                          {
                            className: "flex-shrink-0",
                            animate: user.rank <= 3 ? { scale: [1, 1.1, 1] } : {},
                            transition: { duration: 2, repeat: Infinity },
                            children: style.icon
                          }
                        ),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs(Avatar, { className: `w-10 h-10 sm:w-12 sm:h-12 border-2 ${style.borderClass}`, children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarImage, { src: user.avatar_url }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarFallback, { className: "bg-gray-700 text-white text-sm", children: user.full_name?.charAt(0) || user.agent_code?.charAt(0) || "A" })
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-w-0 flex-1", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5 flex-wrap", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: `font-semibold truncate ${user.isCurrentUser ? "text-[#00D1FF]" : "text-white"}`, children: user.full_name || "Agente" }),
                            user.isCurrentUser && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-[10px] px-1 py-0", children: "Tu" }),
                            getTierBadge(user.subscription_plan)
                          ] }),
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-xs text-gray-400", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-mono", children: user.agent_code }),
                            user.city && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-0.5", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-3 h-3" }),
                              user.city
                            ] })
                          ] }),
                          isTop10 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mt-1 text-[10px]", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-0.5 text-cyan-400", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-3 h-3" }),
                              user.pulse_energy
                            ] }),
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-0.5 text-green-400", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "w-3 h-3" }),
                              user.clues_unlocked
                            ] }),
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-0.5 text-orange-400", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx(Flame, { className: "w-3 h-3" }),
                              user.streak_days,
                              "d"
                            ] })
                          ] })
                        ] })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right flex-shrink-0 ml-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          motion.div,
                          {
                            className: `text-lg sm:text-xl font-bold ${style.textClass}`,
                            animate: isTop10 ? { scale: [1, 1.02, 1] } : {},
                            transition: { duration: 3, repeat: Infinity },
                            children: user.total_score.toLocaleString()
                          }
                        ),
                        user.change !== void 0 && user.change !== 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `flex items-center justify-end gap-0.5 text-xs ${user.change > 0 ? "text-green-400" : "text-red-400"}`, children: [
                          user.change > 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingUp, { className: "w-3 h-3" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingDown, { className: "w-3 h-3" }),
                          user.change > 0 ? "+" : "",
                          user.change
                        ] })
                      ] })
                    ] }) })
                  ] })
                },
                user.id
              );
            }) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 0.5 },
            className: "grid grid-cols-3 gap-3 pt-4",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/30 border-gray-700/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-3 text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-5 h-5 mx-auto mb-1 text-[#00D1FF]" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold text-white", children: leaderboard.length }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-[10px] text-gray-400", children: "Agenti" })
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/30 border-gray-700/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-3 text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleDownIcon, { className: "w-5 h-5 mx-auto mb-1 text-pink-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold text-white", children: leaderboard[0]?.total_score.toLocaleString() || "0" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-[10px] text-gray-400", children: "Top Score" })
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/30 border-gray-700/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-3 text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Flame, { className: "w-5 h-5 mx-auto mb-1 text-orange-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-lg font-bold text-white", children: [
                  Math.max(...leaderboard.map((u) => u.streak_days), 0),
                  "d"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-[10px] text-gray-400", children: "Max Streak" })
              ] }) })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            className: "text-center py-2",
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 text-xs text-gray-500", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  animate: { opacity: [0.5, 1, 0.5] },
                  transition: { duration: 2, repeat: Infinity },
                  className: "w-2 h-2 rounded-full bg-green-500"
                }
              ),
              "Classifica live  Aggiornamento automatico"
            ] })
          }
        )
      ]
    }
  );
};

const useBuzzSound = () => {
  const audioRef = reactExports.useRef(null);
  const { isEnabled } = useSound();
  const initializeSound = (soundPreference, volume) => {
    const soundPath = getSoundPath(soundPreference);
    if (audioRef.current) {
      audioRef.current.pause();
      audioRef.current = null;
    }
    audioRef.current = new Audio(soundPath);
    if (audioRef.current) {
      audioRef.current.volume = volume;
      audioRef.current.load();
    }
  };
  const playSound = () => {
    if (!isEnabled || !audioRef.current) return;
    audioRef.current.currentTime = 0;
    const playPromise = audioRef.current.play();
    if (playPromise !== void 0) {
      playPromise.catch((e) => {
        document.addEventListener("click", function playOnClick() {
          if (audioRef.current && isEnabled) {
            audioRef.current.play().catch((err) => void 0);
          }
          document.removeEventListener("click", playOnClick);
        }, { once: true });
      });
    }
  };
  const getSoundPath = (preference) => {
    switch (preference) {
      case "chime":
        return "/sounds/chime.mp3";
      case "bell":
        return "/sounds/bell.mp3";
      case "arcade":
        return "/sounds/arcade.mp3";
      default:
        return "/sounds/buzz.mp3";
    }
  };
  return {
    initializeSound,
    playSound,
    getSoundPath
  };
};

const useDynamicIslandSafety = () => {
  const { user, isAuthenticated } = useAuthContext();
  const [isBuzzSafe, setIsBuzzSafe] = reactExports.useState({ isSafe: true });
  reactExports.useEffect(() => {
    const checkBuzzSafety = async () => {
      if (!isAuthenticated || !user) {
        setIsBuzzSafe({ isSafe: false, reason: "Not authenticated" });
        return;
      }
      try {
        if (!user.id || user.id.length < 10) {
          setIsBuzzSafe({ isSafe: false, reason: "User ID non valido" });
          return;
        }
        if (!user.email_confirmed_at) {
          setIsBuzzSafe({ isSafe: false, reason: "Email non verificata" });
          return;
        }
        const { data: session } = await supabase.auth.getSession();
        if (!session?.session) {
          setIsBuzzSafe({ isSafe: false, reason: "Sessione non attiva" });
          return;
        }
        setIsBuzzSafe({ isSafe: true });
      } catch (error) {
        setIsBuzzSafe({ isSafe: false, reason: error.message || "Unknown error" });
      }
    };
    checkBuzzSafety();
  }, [user, isAuthenticated]);
  return {
    isBuzzSafe
  };
};

const useNotificationsDynamicIsland = (notifications) => {
  const { updateData, setPage } = useDynamicIsland();
  const prevUnreadRef = reactExports.useRef(-1);
  reactExports.useEffect(() => {
    const unreadCount = notifications.filter((n) => !n.read).length;
    if (unreadCount === prevUnreadRef.current) return;
    prevUnreadRef.current = unreadCount;
    updateData({ unreadCount });
  }, [notifications, updateData]);
  reactExports.useEffect(() => {
    setPage("notifications");
    return () => {
      setPage("default");
    };
  }, [setPage]);
  const updateDynamicIslandOnRead = (notificationId) => {
    const remainingUnread = notifications.filter((n) => !n.read && n.id !== notificationId).length;
    updateData({ unreadCount: remainingUnread });
  };
  const closeDynamicIsland = () => {
  };
  return {
    updateDynamicIslandOnRead,
    closeDynamicIsland
  };
};

const useNotificationsAutoReload = (reloadNotifications) => {
  reactExports.useEffect(() => {
    reloadNotifications();
  }, [reloadNotifications]);
  reactExports.useEffect(() => {
    const interval = setInterval(() => {
      if (document.visibilityState === "visible") {
        reloadNotifications();
      }
    }, 5e3);
    return () => clearInterval(interval);
  }, [reloadNotifications]);
};

const NotificationsHeader = ({
  filter,
  onFilterChange,
  onMarkAllAsRead,
  onManualReload
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "m1-relief p-4 sm:p-6 mb-6 relative overflow-hidden rounded-[24px]",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl font-semibold text-white", children: "Le tue notifiche" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { variant: "ghost", size: "sm", onClick: onManualReload, className: "flex-1 sm:flex-none", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4 mr-2" }),
              "Aggiorna"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { variant: "ghost", size: "sm", onClick: onMarkAllAsRead, className: "flex-1 sm:flex-none", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-4 h-4 mr-2" }),
              "Segna tutto come letto"
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap sm:flex-nowrap gap-2 sm:gap-3 overflow-x-auto mb-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: filter === "all" ? "default" : "outline",
              size: "sm",
              onClick: () => onFilterChange("all"),
              className: "flex-shrink-0 flex-1 sm:flex-none",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4 mr-2" }),
                "Generali"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: filter === "unread" ? "default" : "outline",
              size: "sm",
              onClick: () => onFilterChange("unread"),
              className: "flex-shrink-0 flex-1 sm:flex-none",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4 mr-2" }),
                "Buzz"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: filter === "important" ? "default" : "outline",
              size: "sm",
              onClick: () => onFilterChange("important"),
              className: "flex-shrink-0 flex-1 sm:flex-none",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-4 h-4 mr-2" }),
                "Classifica"
              ]
            }
          )
        ] })
      ]
    }
  );
};

const NOTIFICATION_CATEGORIES = {
  LEADERBOARD: "leaderboard_update",
  REWARDS: "rewards",
  MISSION: "mission_alert",
  BUZZ: "buzz",
  MAP_BUZZ: "map_buzz",
  WEEKLY: "weekly_summary"};
const getCategoryInfo = (type) => {
  switch (type) {
    case NOTIFICATION_CATEGORIES.LEADERBOARD:
      return {
        title: "Aggiornamento Classifica",
        color: "text-green-400"
      };
    case NOTIFICATION_CATEGORIES.REWARDS:
      return {
        title: "Ricompense Sbloccate",
        color: "text-yellow-400"
      };
    case NOTIFICATION_CATEGORIES.MISSION:
      return {
        title: "Avvisi Missione",
        color: "text-red-400"
      };
    case NOTIFICATION_CATEGORIES.BUZZ:
      return {
        title: "Buzz Notifications",
        color: "text-blue-400"
      };
    case NOTIFICATION_CATEGORIES.MAP_BUZZ:
      return {
        title: "Aggiornamenti Mappa",
        color: "text-purple-400"
      };
    case NOTIFICATION_CATEGORIES.WEEKLY:
      return {
        title: "Riassunto Settimanale",
        color: "text-cyan-400"
      };
    default:
      return {
        title: "Generali",
        color: "text-gray-400"
      };
  }
};

const NotificationCategory = ({
  category,
  notifications,
  onSelect,
  onDelete
}) => {
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const categoryInfo = getCategoryInfo(category);
  const unreadCount = notifications.filter((n) => !n.read).length;
  const handleToggle = () => {
    setIsExpanded(!isExpanded);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "m1-relief rounded-[24px] transition-all duration-300 hover:shadow-lg mb-4 relative overflow-hidden",
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            onClick: handleToggle,
            className: "p-6 cursor-pointer flex items-center justify-between hover:bg-white/5 rounded-[20px] transition-colors",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center space-x-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white font-orbitron", children: categoryInfo.title }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-white/60", children: [
                  notifications.length,
                  " ",
                  notifications.length === 1 ? "notifica" : "notifiche",
                  unreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "ml-2 px-2 py-1 bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white text-xs rounded-full", children: [
                    unreadCount,
                    " nuove"
                  ] })
                ] })
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  animate: { rotate: isExpanded ? 180 : 0 },
                  transition: { duration: 0.3 },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-5 h-5 text-white/60" })
                }
              )
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { height: 0, opacity: 0 },
            animate: { height: "auto", opacity: 1 },
            exit: { height: 0, opacity: 0 },
            transition: { duration: 0.4, ease: "easeInOut" },
            className: "overflow-hidden",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-6 pb-6 space-y-3", children: notifications.map((notification, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                initial: { opacity: 0, x: -20 },
                animate: { opacity: 1, x: 0 },
                transition: { duration: 0.3, delay: index * 0.1 },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  NotificationItem,
                  {
                    notification,
                    onSelect: () => onSelect(notification.id),
                    onDelete: () => onDelete(notification.id)
                  }
                )
              },
              notification.id
            )) })
          }
        ) })
      ]
    }
  );
};

const NotificationsEmptyState = ({ onReload }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-500 py-8", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-12 h-12 mx-auto mb-4 text-white/30" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg", children: "Nessuna notifica da visualizzare" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/40 mt-2", children: "Le tue notifiche appariranno qui" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        variant: "outline",
        size: "sm",
        onClick: onReload,
        className: "mt-4",
        children: "Ricarica notifiche"
      }
    )
  ] });
};

const NotificationsList = ({
  notifications,
  filter,
  onMarkAsRead,
  onDelete,
  onReload
}) => {
  const filteredNotifications = () => {
    switch (filter) {
      case "unread":
        return notifications.filter((notification) => !notification.read);
      case "important":
        return notifications.filter((notification) => notification.type === "alert" || notification.type === "critical");
      default:
        return notifications;
    }
  };
  const groupedNotifications = () => {
    const filtered = filteredNotifications();
    const grouped = filtered.reduce((acc, notification) => {
      const category = notification.type || "general";
      if (!acc[category]) {
        acc[category] = [];
      }
      acc[category] = [...acc[category], notification];
      return acc;
    }, {});
    return grouped;
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: Object.keys(groupedNotifications()).length > 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: Object.entries(groupedNotifications()).map(([category, categoryNotifications]) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    NotificationCategory,
    {
      category,
      notifications: categoryNotifications,
      onSelect: onMarkAsRead,
      onDelete
    },
    category
  )) }) : /* @__PURE__ */ jsxRuntimeExports.jsx(NotificationsEmptyState, { onReload }) });
};

function useChat() {
  const { user } = useUnifiedAuth();
  const [conversations, setConversations] = reactExports.useState([]);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const channelRef = reactExports.useRef(null);
  const loadConversations = reactExports.useCallback(async () => {
    if (!user?.id) {
      setConversations([]);
      setIsLoading(false);
      return;
    }
    try {
      setIsLoading(true);
      setError(null);
      const { data, error: rpcError } = await supabase.rpc("get_my_conversations");
      if (rpcError) {
        setError("Errore nel caricamento delle conversazioni");
        return;
      }
      setConversations(data || []);
    } catch (err) {
      setError("Errore imprevisto");
    } finally {
      setIsLoading(false);
    }
  }, [user?.id]);
  const createDirectChat = reactExports.useCallback(async (otherUserId) => {
    if (!user?.id) return null;
    try {
      const { data, error: error2 } = await supabase.rpc("get_or_create_direct_chat", {
        p_other_user_id: otherUserId
      });
      if (error2) {
        return null;
      }
      await loadConversations();
      return data;
    } catch (err) {
      return null;
    }
  }, [user?.id, loadConversations]);
  const totalUnreadCount = conversations.reduce((sum, c) => sum + (c.unread_count || 0), 0);
  const createGroupChat = reactExports.useCallback(async (memberIds, groupName) => {
    if (!user?.id) return null;
    if (memberIds.length < 1) return null;
    try {
      const allMembers = [.../* @__PURE__ */ new Set([user.id, ...memberIds])];
      const { data, error: error2 } = await supabase.rpc("create_group_chat", {
        p_member_ids: allMembers,
        p_group_name: groupName.trim()
      });
      if (error2) {
        return null;
      }
      await loadConversations();
      return data;
    } catch (err) {
      return null;
    }
  }, [user?.id, loadConversations]);
  const deleteConversation = reactExports.useCallback(async (conversationId) => {
    if (!user?.id) return false;
    try {
      const { error: error2 } = await supabase.from("chat_members").delete().eq("conversation_id", conversationId).eq("user_id", user.id);
      if (error2) {
        return false;
      }
      setConversations((prev) => prev.filter((c) => c.conversation_id !== conversationId));
      return true;
    } catch (err) {
      return false;
    }
  }, [user?.id]);
  reactExports.useEffect(() => {
    if (!user?.id) return;
    loadConversations();
    const channel = supabase.channel("chat-updates").on(
      "postgres_changes",
      {
        event: "INSERT",
        schema: "public",
        table: "chat_messages"
      },
      (payload) => {
        loadConversations();
      }
    ).subscribe();
    channelRef.current = channel;
    return () => {
      if (channelRef.current) {
        supabase.removeChannel(channelRef.current);
      }
    };
  }, [user?.id, loadConversations]);
  return {
    conversations,
    isLoading,
    error,
    totalUnreadCount,
    loadConversations,
    createDirectChat,
    createGroupChat,
    deleteConversation
  };
}
function useChatMessages(conversationId) {
  const { user } = useUnifiedAuth();
  const [messages, setMessages] = reactExports.useState([]);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [isSending, setIsSending] = reactExports.useState(false);
  const [error, setError] = reactExports.useState(null);
  const channelRef = reactExports.useRef(null);
  const loadMessages = reactExports.useCallback(async (before) => {
    if (!user?.id || !conversationId) {
      setMessages([]);
      setIsLoading(false);
      return;
    }
    try {
      setIsLoading(true);
      setError(null);
      const { data, error: rpcError } = await supabase.rpc("get_chat_messages", {
        p_conversation_id: conversationId,
        p_limit: 50,
        p_before: before || null
      });
      if (rpcError) {
        setError("Errore nel caricamento dei messaggi");
        return;
      }
      const msgs = (data || []).reverse();
      if (before) {
        setMessages((prev) => [...msgs, ...prev]);
      } else {
        setMessages(msgs);
      }
    } catch (err) {
      setError("Errore imprevisto");
    } finally {
      setIsLoading(false);
    }
  }, [user?.id, conversationId]);
  const sendMessage = reactExports.useCallback(async (content, messageType = "text", metadata = {}) => {
    if (!user?.id || !conversationId || !content.trim()) return false;
    const optimisticId = `temp_${Date.now()}`;
    const optimisticMessage = {
      message_id: optimisticId,
      sender_id: user.id,
      sender_username: "Tu",
      sender_avatar: null,
      content: content.trim(),
      message_type: messageType,
      metadata,
      created_at: (/* @__PURE__ */ new Date()).toISOString(),
      is_own: true
    };
    setMessages((prev) => [...prev, optimisticMessage]);
    try {
      setIsSending(true);
      setError(null);
      const { data, error: error2 } = await supabase.rpc("send_chat_message", {
        p_conversation_id: conversationId,
        p_content: content.trim(),
        p_message_type: messageType,
        p_metadata: metadata
      });
      if (error2) {
        setError("Errore nell'invio del messaggio");
        setMessages((prev) => prev.filter((m) => m.message_id !== optimisticId));
        return false;
      }
      supabase.functions.invoke("chat-push-notify", {
        body: {
          conversation_id: conversationId,
          sender_id: user.id,
          message_preview: content.trim().substring(0, 100)
        }
      }).catch((err) => {
      });
      setTimeout(() => loadMessages(), 300);
      return true;
    } catch (err) {
      setError("Errore imprevisto");
      setMessages((prev) => prev.filter((m) => m.message_id !== optimisticId));
      return false;
    } finally {
      setIsSending(false);
    }
  }, [user?.id, conversationId, loadMessages]);
  const sendLocation = reactExports.useCallback(async (lat, lng) => {
    return sendMessage(
      ` Posizione condivisa`,
      "location",
      { lat, lng }
    );
  }, [sendMessage]);
  const markAsRead = reactExports.useCallback(async () => {
    if (!conversationId) return;
    await supabase.rpc("mark_conversation_read", {
      p_conversation_id: conversationId
    });
  }, [conversationId]);
  reactExports.useEffect(() => {
    if (!user?.id || !conversationId) return;
    loadMessages();
    const channel = supabase.channel(`chat-${conversationId}`).on(
      "postgres_changes",
      {
        event: "INSERT",
        schema: "public",
        table: "chat_messages",
        filter: `conversation_id=eq.${conversationId}`
      },
      async (payload) => {
        const newMsg = payload.new;
        if (newMsg.sender_id === user.id) {
          setMessages((prev) => prev.map(
            (m) => m.is_optimistic ? { ...m, is_optimistic: false, message_id: newMsg.id } : m
          ));
          return;
        }
        await loadMessages();
        await markAsRead();
      }
    ).subscribe();
    channelRef.current = channel;
    return () => {
      if (channelRef.current) {
        supabase.removeChannel(channelRef.current);
      }
    };
  }, [user?.id, conversationId]);
  return {
    messages,
    isLoading,
    isSending,
    error,
    sendMessage,
    sendLocation,
    loadMessages,
    markAsRead
  };
}

function ChatList({ onSelectConversation, onNewChat, onNewGroup }) {
  const { conversations, isLoading, error, totalUnreadCount, deleteConversation } = useChat();
  const [deleteConfirm, setDeleteConfirm] = reactExports.useState(null);
  const [isDeleting, setIsDeleting] = reactExports.useState(false);
  const handleDeleteConfirm = async (conversationId) => {
    setIsDeleting(true);
    try {
      await deleteConversation(conversationId);
      setDeleteConfirm(null);
    } catch (err) {
    } finally {
      setIsDeleting(false);
    }
  };
  if (isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-12", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-8 h-8 text-cyan-400 animate-spin" }) });
  }
  if (error) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-12", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(MessageCircle, { className: "w-12 h-12 text-red-400 mx-auto mb-3" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-400", children: error })
    ] });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(MessageCircle, { className: "w-5 h-5 text-cyan-400" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-semibold", children: "Messaggi" }),
        totalUnreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { className: "bg-cyan-500/20 text-cyan-400 border-cyan-500/30", children: [
          totalUnreadCount,
          " nuovi"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: onNewChat,
            size: "sm",
            className: "bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-1" }),
              "Chat"
            ]
          }
        ),
        onNewGroup && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: onNewGroup,
            size: "sm",
            className: "bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-4 h-4 mr-1" }),
              "Gruppo"
            ]
          }
        )
      ] })
    ] }),
    conversations.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        className: "text-center py-12",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(MessageCircle, { className: "w-16 h-16 text-gray-600 mx-auto mb-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white mb-2", children: "Nessun messaggio" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm mb-4", children: "Inizia una nuova conversazione con un altro agente!" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: onNewChat,
              className: "bg-gradient-to-r from-cyan-600 to-purple-600",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-2" }),
                "Nuova Chat"
              ]
            }
          )
        ]
      }
    ) : /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "popLayout", children: conversations.map((conversation, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
      SwipeableConversationItem,
      {
        conversation,
        onClick: () => onSelectConversation(conversation.conversation_id),
        onDelete: () => setDeleteConfirm(conversation.conversation_id),
        index
      },
      conversation.conversation_id
    )) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: deleteConfirm && /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        exit: { opacity: 0 },
        className: "fixed inset-0 z-[6000] flex items-center justify-center p-4",
        onClick: () => setDeleteConfirm(null),
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-black/80 backdrop-blur-sm" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { scale: 0.9, y: 20 },
              animate: { scale: 1, y: 0 },
              exit: { scale: 0.9, y: 20 },
              onClick: (e) => e.stopPropagation(),
              className: "relative w-full max-w-sm bg-gray-900 border border-red-500/30 rounded-2xl p-6 shadow-2xl",
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mx-auto mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-8 h-8 text-red-400" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white mb-2", children: "Eliminare questa chat?" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm mb-6", children: "Tutti i messaggi verranno eliminati permanentemente. Questa azione non pu essere annullata." }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Button,
                    {
                      variant: "outline",
                      onClick: () => setDeleteConfirm(null),
                      disabled: isDeleting,
                      className: "flex-1 border-gray-600 text-gray-300 hover:bg-gray-800",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-4 h-4 mr-2" }),
                        "No, annulla"
                      ]
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Button,
                    {
                      onClick: () => handleDeleteConfirm(deleteConfirm),
                      disabled: isDeleting,
                      className: "flex-1 bg-red-600 hover:bg-red-700 text-white",
                      children: [
                        isDeleting ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-4 h-4 mr-2" }),
                        "S, elimina"
                      ]
                    }
                  )
                ] })
              ] })
            }
          )
        ]
      }
    ) })
  ] });
}
function SwipeableConversationItem({ conversation, onClick, onDelete, index }) {
  const x = useMotionValue(0);
  const [isDragging, setIsDragging] = reactExports.useState(false);
  const deleteOpacity = useTransform(x, [-100, -50, 0], [1, 0.5, 0]);
  const deleteScale = useTransform(x, [-100, -50, 0], [1, 0.8, 0.5]);
  const isGroup = conversation.conversation_type === "group";
  const displayName = conversation.other_user_username || conversation.conversation_name || "Chat";
  const hasUnread = conversation.unread_count > 0;
  const timeAgo = conversation.last_message_at ? formatDistanceToNow(new Date(conversation.last_message_at), {
    addSuffix: false,
    locale: it$1
  }) : null;
  const handleDragEnd = (_, info) => {
    setIsDragging(false);
    if (info.offset.x < -80) {
      onDelete();
    }
  };
  const handleClick = () => {
    if (!isDragging) {
      onClick();
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, x: -20 },
      animate: { opacity: 1, x: 0 },
      exit: { opacity: 0, x: -100, height: 0 },
      transition: { delay: index * 0.03 },
      className: "relative overflow-hidden rounded-xl",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute inset-y-0 right-0 flex items-center justify-end pr-4 bg-red-600 rounded-xl",
            style: { opacity: deleteOpacity },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs(motion.div, { style: { scale: deleteScale }, className: "flex items-center gap-2 text-white", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-5 h-5" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Elimina" })
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            drag: "x",
            dragConstraints: { left: -100, right: 0 },
            dragElastic: 0.1,
            onDragStart: () => setIsDragging(true),
            onDragEnd: handleDragEnd,
            style: { x },
            onClick: handleClick,
            className: `relative p-4 rounded-xl border transition-colors cursor-pointer ${hasUnread ? "bg-cyan-500/10 border-cyan-500/30" : "bg-gray-900/80 border-white/10"}`,
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative flex-shrink-0", children: [
                  conversation.other_user_avatar ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "img",
                    {
                      src: conversation.other_user_avatar,
                      alt: displayName,
                      className: "w-12 h-12 rounded-full object-cover border-2 border-cyan-500/30"
                    }
                  ) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-12 h-12 rounded-full flex items-center justify-center ${isGroup ? "bg-purple-500/20 border-2 border-purple-500/30" : "bg-cyan-500/20 border-2 border-cyan-500/30"}`, children: isGroup ? /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-5 h-5 text-purple-400" }) : /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg font-bold text-cyan-400", children: displayName.charAt(0).toUpperCase() }) }),
                  hasUnread && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "absolute -top-1 -right-1 w-5 h-5 bg-cyan-500 rounded-full flex items-center justify-center text-[10px] font-bold text-white", children: conversation.unread_count > 9 ? "9+" : conversation.unread_count })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between gap-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `font-semibold truncate ${hasUnread ? "text-white" : "text-gray-200"}`, children: displayName }),
                    timeAgo && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-500 whitespace-nowrap", children: timeAgo })
                  ] }),
                  conversation.last_message && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: `text-sm truncate mt-0.5 ${hasUnread ? "text-gray-300 font-medium" : "text-gray-500"}`, children: conversation.last_message })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronRight, { className: "w-5 h-5 text-gray-500 flex-shrink-0" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute right-2 top-1/2 -translate-y-1/2 text-[10px] text-gray-600 hidden sm:block pointer-events-none", children: " scorri" })
            ]
          }
        )
      ]
    }
  );
}

const LS_KEYS = ["geo.enabled.v1", "geo_enabled"];
function readEnabled() {
  try {
    return LS_KEYS.some((k) => localStorage.getItem(k) === "1");
  } catch {
    return false;
  }
}
function writeEnabled(v) {
  try {
    LS_KEYS.forEach((k) => v ? localStorage.setItem(k, "1") : localStorage.removeItem(k));
  } catch {
  }
}
function isIOSSafari() {
  const ua = navigator.userAgent;
  const isIOS = /iPad|iPhone|iPod/.test(ua);
  const isSafari = /Safari/.test(ua) && !/Chrome/.test(ua);
  return isIOS || isSafari;
}
function isPWA() {
  return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
}
function useGeolocation() {
  const [status, setStatus] = reactExports.useState("idle");
  const [enabled, setEnabled] = reactExports.useState(() => readEnabled());
  const [position, setPosition] = reactExports.useState(void 0);
  const [error, setError] = reactExports.useState(null);
  const [retryCount, setRetryCount] = reactExports.useState(0);
  const watchId = reactExports.useRef();
  const enable = reactExports.useCallback(() => {
    writeEnabled(true);
    setEnabled(true);
    setRetryCount(0);
  }, []);
  const disable = reactExports.useCallback(() => {
    writeEnabled(false);
    setEnabled(false);
    setStatus("idle");
    setError(null);
    if (watchId.current != null) navigator.geolocation.clearWatch(watchId.current);
  }, []);
  const retry = reactExports.useCallback(() => {
    if (watchId.current != null) {
      navigator.geolocation.clearWatch(watchId.current);
    }
    setRetryCount((prev) => prev + 1);
    setStatus("prompt");
    setError(null);
  }, []);
  reactExports.useEffect(() => {
    if (!enabled) return;
    if (!("geolocation" in navigator)) {
      setStatus("error");
      setError({ code: 0, message: "Geolocation not supported" });
      return;
    }
    setStatus("prompt");
    if ("permissions" in navigator) {
      navigator.permissions.query({ name: "geolocation" }).then((result) => {
        if (result.state === "denied") {
          setStatus("blocked");
          setError({ code: 1, message: "Permission permanently denied. Please enable in browser settings." });
          return;
        }
        result.onchange = () => {
          if (result.state === "granted") {
            setStatus("granted");
            setError(null);
          } else if (result.state === "denied") {
            setStatus("blocked");
          }
        };
      }).catch(() => {
      });
    }
    watchId.current = navigator.geolocation.watchPosition(
      (p) => {
        setStatus("granted");
        setError(null);
        setPosition({ lat: p.coords.latitude, lng: p.coords.longitude, acc: p.coords.accuracy });
      },
      (e) => {
        setError({ code: e.code, message: e.message });
        if (e.code === e.PERMISSION_DENIED) {
          if (e.message.includes("blocked") || e.message.includes("ignored") || retryCount > 2) {
            setStatus("blocked");
          } else {
            setStatus("denied");
          }
        } else if (e.code === e.POSITION_UNAVAILABLE) {
          setStatus("error");
        } else if (e.code === e.TIMEOUT) {
          setStatus("error");
        } else {
          setStatus("error");
        }
      },
      {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: isIOSSafari() ? 15e3 : 1e4
        // Longer timeout for iOS
      }
    );
    return () => {
      if (watchId.current != null) navigator.geolocation.clearWatch(watchId.current);
    };
  }, [enabled, retryCount]);
  return {
    status,
    enabled,
    position,
    error,
    isBlocked: status === "blocked",
    isIOS: isIOSSafari(),
    isPWA: isPWA(),
    enable,
    disable,
    retry
  };
}

function ChatView({
  conversationId,
  recipientName,
  recipientAvatar,
  onBack
}) {
  const { messages, isLoading, isSending, sendMessage, sendLocation } = useChatMessages(conversationId);
  const [inputValue, setInputValue] = reactExports.useState("");
  const messagesEndRef = reactExports.useRef(null);
  const inputRef = reactExports.useRef(null);
  const { position } = useGeolocation();
  reactExports.useEffect(() => {
    if (messagesEndRef.current) {
      messagesEndRef.current.scrollIntoView({ behavior: "smooth" });
    }
  }, [messages]);
  reactExports.useEffect(() => {
    setTimeout(() => inputRef.current?.focus(), 100);
  }, []);
  const handleSend = async () => {
    if (!inputValue.trim() || isSending) return;
    const content = inputValue;
    setInputValue("");
    await sendMessage(content);
  };
  const handleKeyPress = (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };
  const handleShareLocation = async () => {
    if (!position) {
      alert("Posizione non disponibile");
      return;
    }
    await sendLocation(position.lat, position.lng);
  };
  const formatDateHeader = (date) => {
    if (isToday(date)) return "Oggi";
    if (isYesterday(date)) return "Ieri";
    return format(date, "dd MMMM yyyy", { locale: it$1 });
  };
  const groupedMessages = messages.reduce((groups, message) => {
    const date = new Date(message.created_at).toDateString();
    if (!groups[date]) {
      groups[date] = [];
    }
    groups[date].push(message);
    return groups;
  }, {});
  const headerHeight = 60;
  const inputHeight = 56;
  const bottomNavHeight = 80;
  const safeAreaTop = "env(safe-area-inset-top, 47px)";
  const safeAreaBottom = "env(safe-area-inset-bottom, 34px)";
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "fixed inset-0 bg-[#070818] flex flex-col",
      style: {
        paddingTop: `calc(72px + ${safeAreaTop})`,
        // UnifiedHeader height
        zIndex: 100
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "flex items-center gap-3 px-4 py-3 border-b border-white/10 bg-gray-900/95 backdrop-blur-sm shrink-0",
            style: { height: `${headerHeight}px` },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  variant: "ghost",
                  size: "sm",
                  onClick: onBack,
                  className: "p-2 hover:bg-white/10",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5 text-white" })
                }
              ),
              recipientAvatar ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                "img",
                {
                  src: recipientAvatar,
                  alt: recipientName,
                  className: "w-10 h-10 rounded-full object-cover border-2 border-cyan-500/30"
                }
              ) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-cyan-500/20 border-2 border-cyan-500/30 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-5 h-5 text-cyan-400" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white truncate", children: recipientName }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1 text-xs text-green-400", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-3 h-3" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Crittografato" })
                ] })
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "flex-1 overflow-y-auto overscroll-contain",
            style: {
              paddingBottom: "8px",
              paddingTop: "8px"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "px-4 space-y-1", children: [
              isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-12", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-8 h-8 text-cyan-400 animate-spin" }) }) : messages.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-12", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-12 h-12 text-cyan-400/50 mx-auto mb-3" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "I messaggi sono crittografati end-to-end." }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-500 text-xs mt-1", children: "Invia il primo messaggio!" })
              ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children: Object.entries(groupedMessages).map(([date, msgs]) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center my-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "px-3 py-1 bg-gray-800/70 rounded-full text-xs text-gray-400", children: formatDateHeader(new Date(date)) }) }),
                msgs.map((message, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                  MessageBubble,
                  {
                    message,
                    showAvatar: index === 0 || msgs[index - 1]?.sender_id !== message.sender_id
                  },
                  message.message_id
                ))
              ] }, date)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { ref: messagesEndRef })
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "border-t border-white/10 bg-gray-900/95 backdrop-blur-sm shrink-0",
            style: {
              height: `${inputHeight}px`,
              marginBottom: `calc(${bottomNavHeight}px + ${safeAreaBottom})`
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 px-3 h-full", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  variant: "ghost",
                  size: "sm",
                  onClick: handleShareLocation,
                  disabled: !position || isSending,
                  className: "p-2 hover:bg-white/10 flex-shrink-0",
                  title: "Condividi posizione",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-5 h-5 text-cyan-400" })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "input",
                {
                  ref: inputRef,
                  type: "text",
                  value: inputValue,
                  onChange: (e) => setInputValue(e.target.value),
                  onKeyPress: handleKeyPress,
                  placeholder: "Scrivi un messaggio...",
                  disabled: isSending,
                  className: "flex-1 bg-gray-800/60 border border-white/10 rounded-full px-4 py-2 text-white text-sm placeholder-gray-500 focus:outline-none focus:border-cyan-500/50 transition-colors disabled:opacity-50"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: handleSend,
                  disabled: !inputValue.trim() || isSending,
                  size: "sm",
                  className: "p-2 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-400 hover:to-blue-400 disabled:opacity-50 flex-shrink-0",
                  children: isSending ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-5 h-5 animate-spin" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-5 h-5" })
                }
              )
            ] })
          }
        )
      ]
    }
  );
}
function MessageBubble({ message, showAvatar }) {
  const isOwn = message.is_own;
  const isLocation = message.message_type === "location";
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 5 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.15 },
      className: `flex items-end gap-2 mb-1 ${isOwn ? "justify-end" : "justify-start"}`,
      children: [
        !isOwn && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-7 h-7 flex-shrink-0", children: showAvatar && (message.sender_avatar ? /* @__PURE__ */ jsxRuntimeExports.jsx(
          "img",
          {
            src: message.sender_avatar,
            alt: message.sender_username,
            className: "w-7 h-7 rounded-full object-cover"
          }
        ) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-7 h-7 rounded-full bg-purple-500/20 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-bold text-purple-400", children: message.sender_username?.charAt(0).toUpperCase() }) })) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: `max-w-[75%] px-3 py-2 rounded-2xl ${isOwn ? "bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-br-sm" : "bg-gray-800/90 text-white border border-white/5 rounded-bl-sm"}`,
            children: [
              isLocation && message.metadata?.lat && message.metadata?.lng ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "a",
                {
                  href: `https://www.google.com/maps?q=${message.metadata.lat},${message.metadata.lng}`,
                  target: "_blank",
                  rel: "noopener noreferrer",
                  className: "flex items-center gap-2 text-sm hover:underline",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-4 h-4" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: " Apri posizione" })
                  ]
                }
              ) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm leading-relaxed whitespace-pre-wrap break-words", children: message.content }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: `text-[10px] mt-0.5 text-right ${isOwn ? "text-white/60" : "text-gray-500"}`, children: format(new Date(message.created_at), "HH:mm") })
            ]
          }
        )
      ]
    }
  );
}

const sanitizeSearchInput = (input) => {
  if (!input || typeof input !== "string") {
    return "";
  }
  let sanitized = input.trim();
  if (sanitized.length > 100) {
    sanitized = sanitized.substring(0, 100);
  }
  sanitized = sanitized.replace(/\0/g, "").replace(/--/g, "").replace(/\/\*/g, "").replace(/\*\//g, "").replace(/;/g, "").replace(/'/g, "''").replace(/\\/g, "").replace(/[\x00-\x1F\x7F]/g, "");
  return sanitized;
};

function NewChatModal({ isOpen, onClose, onChatCreated }) {
  const { user } = useUnifiedAuth();
  const { createDirectChat } = useChat();
  const [searchQuery, setSearchQuery] = reactExports.useState("");
  const [agents, setAgents] = reactExports.useState([]);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [isCreating, setIsCreating] = reactExports.useState(null);
  reactExports.useEffect(() => {
    if (!isOpen) return;
    const searchAgents = async () => {
      setIsLoading(true);
      try {
        let query = supabase.from("profiles").select("id, username, avatar_url, agent_code").order("username", { ascending: true }).limit(50);
        if (searchQuery.trim()) {
          const sanitized = sanitizeSearchInput(searchQuery);
          if (sanitized) {
            query = query.or(`username.ilike.%${sanitized}%,agent_code.ilike.%${sanitized}%`);
          }
        }
        const { data, error } = await query;
        if (error) {
          return;
        }
        setAgents(data || []);
      } catch (err) {
      } finally {
        setIsLoading(false);
      }
    };
    const debounce = setTimeout(searchAgents, 300);
    return () => clearTimeout(debounce);
  }, [isOpen, searchQuery, user?.id]);
  const handleSelectAgent = async (agent) => {
    setIsCreating(agent.id);
    try {
      const conversationId = await createDirectChat(agent.id);
      if (conversationId) {
        onChatCreated(conversationId, agent.username, agent.avatar_url);
        onClose();
      }
    } catch (err) {
    } finally {
      setIsCreating(null);
    }
  };
  if (!isOpen) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "fixed inset-0 z-[5000] flex items-center justify-center p-4",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute inset-0 bg-black/80 backdrop-blur-sm",
            onClick: onClose
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "relative w-full max-w-md max-h-[80vh] overflow-hidden rounded-2xl",
            style: {
              background: "linear-gradient(180deg, rgba(15,23,42,0.98) 0%, rgba(30,41,59,0.98) 100%)",
              border: "1px solid rgba(0, 255, 255, 0.2)",
              boxShadow: "0 0 40px rgba(0, 255, 255, 0.15), 0 25px 50px rgba(0, 0, 0, 0.5)"
            },
            initial: { scale: 0.9, y: 20, opacity: 0 },
            animate: { scale: 1, y: 0, opacity: 1 },
            exit: { scale: 0.9, y: 20, opacity: 0 },
            transition: { type: "spring", damping: 25 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative px-6 py-4 border-b border-white/10", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "div",
                    {
                      className: "p-2.5 rounded-xl",
                      style: {
                        background: "radial-gradient(circle at 30% 30%, rgba(0,255,255,0.2), rgba(139,92,246,0.3) 80%)",
                        border: "1px solid rgba(0, 255, 255, 0.3)"
                      },
                      children: /* @__PURE__ */ jsxRuntimeExports.jsx(MessageCircle, { className: "w-5 h-5 text-cyan-400" })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-lg font-bold text-white font-orbitron", children: "Nuova Chat" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-400", children: "Cerca un agente" })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "button",
                  {
                    onClick: onClose,
                    className: "absolute top-4 right-4 p-2 rounded-full hover:bg-white/10 transition-colors",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-5 h-5 text-gray-400" })
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 border-b border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Search, { className: "absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "input",
                  {
                    type: "text",
                    value: searchQuery,
                    onChange: (e) => setSearchQuery(e.target.value),
                    placeholder: "Cerca per username o codice agente...",
                    className: "w-full bg-gray-800/50 border border-white/10 rounded-xl pl-10 pr-4 py-2.5 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500/50 transition-colors",
                    autoFocus: true
                  }
                )
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "overflow-y-auto max-h-[50vh] p-4 space-y-2", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-8 h-8 text-cyan-400 animate-spin" }) }) : agents.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-12 h-12 text-gray-600 mx-auto mb-3" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: searchQuery ? 'Nessun agente trovato per "' + searchQuery + '"' : "Nessun agente disponibile" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-500 text-xs mt-2", children: "Prova a cercare per codice agente (es. AGT-12345)" })
              ] }) : agents.map((agent) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.button,
                {
                  onClick: () => handleSelectAgent(agent),
                  disabled: isCreating !== null,
                  className: "w-full p-3 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-cyan-500/30 transition-all flex items-center gap-3 text-left disabled:opacity-50",
                  whileHover: { scale: 1.01 },
                  whileTap: { scale: 0.99 },
                  children: [
                    agent.avatar_url ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "img",
                      {
                        src: agent.avatar_url,
                        alt: agent.username || agent.agent_code || "Agent",
                        className: "w-10 h-10 rounded-full object-cover border-2 border-cyan-500/30"
                      }
                    ) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-cyan-500/20 border-2 border-cyan-500/30 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg font-bold text-cyan-400", children: (agent.username || agent.agent_code || "A")?.charAt(0).toUpperCase() }) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-white truncate", children: agent.username || agent.agent_code || "Agente" }),
                      agent.agent_code && agent.username && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-cyan-400/70", children: agent.agent_code })
                    ] }),
                    isCreating === agent.id ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-5 h-5 text-cyan-400 animate-spin" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(MessageCircle, { className: "w-5 h-5 text-gray-500" })
                  ]
                },
                agent.id
              )) })
            ]
          }
        )
      ]
    }
  ) });
}

function NewGroupModal({ isOpen, onClose, onGroupCreated }) {
  const { user } = useUnifiedAuth();
  const { createGroupChat } = useChat();
  const [step, setStep] = reactExports.useState("members");
  const [searchQuery, setSearchQuery] = reactExports.useState("");
  const [agents, setAgents] = reactExports.useState([]);
  const [selectedMembers, setSelectedMembers] = reactExports.useState([]);
  const [groupName, setGroupName] = reactExports.useState("");
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [isCreating, setIsCreating] = reactExports.useState(false);
  const isCreatingRef = React$1.useRef(false);
  reactExports.useEffect(() => {
    if (isOpen) {
      setStep("members");
      setSearchQuery("");
      setSelectedMembers([]);
      setGroupName("");
      setIsCreating(false);
      isCreatingRef.current = false;
    }
  }, [isOpen]);
  reactExports.useEffect(() => {
    if (!isOpen) return;
    const searchAgents = async () => {
      setIsLoading(true);
      try {
        let query = supabase.from("profiles").select("id, username, avatar_url, agent_code").neq("id", user?.id || "").order("username", { ascending: true }).limit(50);
        if (searchQuery.trim()) {
          const sanitized = sanitizeSearchInput(searchQuery);
          if (sanitized) {
            query = query.or(`username.ilike.%${sanitized}%,agent_code.ilike.%${sanitized}%`);
          }
        }
        const { data, error } = await query;
        if (error) {
          return;
        }
        setAgents(data || []);
      } catch (err) {
      } finally {
        setIsLoading(false);
      }
    };
    const debounce = setTimeout(searchAgents, 300);
    return () => clearTimeout(debounce);
  }, [isOpen, searchQuery, user?.id]);
  const toggleMember = (agent) => {
    setSelectedMembers((prev) => {
      const exists = prev.find((m) => m.id === agent.id);
      if (exists) {
        return prev.filter((m) => m.id !== agent.id);
      }
      return [...prev, agent];
    });
  };
  const handleNextStep = () => {
    if (selectedMembers.length >= 1) {
      setStep("name");
    }
  };
  const handleCreateGroup = async () => {
    if (isCreating || isCreatingRef.current) {
      return;
    }
    if (!groupName.trim() || selectedMembers.length < 1) return;
    isCreatingRef.current = true;
    setIsCreating(true);
    try {
      const memberIds = selectedMembers.map((m) => m.id);
      const conversationId = await createGroupChat(memberIds, groupName.trim());
      if (conversationId) {
        onClose();
        onGroupCreated(conversationId, groupName.trim());
      } else {
        isCreatingRef.current = false;
        setIsCreating(false);
      }
    } catch (err) {
      isCreatingRef.current = false;
      setIsCreating(false);
    }
  };
  if (!isOpen) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "fixed inset-0 z-[5000] flex items-center justify-center p-4",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute inset-0 bg-black/80 backdrop-blur-sm",
            onClick: onClose
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "relative w-full max-w-md max-h-[85vh] overflow-hidden rounded-2xl",
            style: {
              background: "linear-gradient(180deg, rgba(15,23,42,0.98) 0%, rgba(30,41,59,0.98) 100%)",
              border: "1px solid rgba(139, 92, 246, 0.3)",
              boxShadow: "0 0 40px rgba(139, 92, 246, 0.15), 0 25px 50px rgba(0, 0, 0, 0.5)"
            },
            initial: { scale: 0.9, y: 20, opacity: 0 },
            animate: { scale: 1, y: 0, opacity: 1 },
            exit: { scale: 0.9, y: 20, opacity: 0 },
            transition: { type: "spring", damping: 25 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative px-6 py-4 border-b border-white/10", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "div",
                    {
                      className: "p-2.5 rounded-xl",
                      style: {
                        background: "radial-gradient(circle at 30% 30%, rgba(139,92,246,0.3), rgba(168,85,247,0.4) 80%)",
                        border: "1px solid rgba(139, 92, 246, 0.4)"
                      },
                      children: /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-5 h-5 text-purple-400" })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-lg font-bold text-white font-orbitron", children: step === "members" ? "Nuovo Gruppo" : "Nome Squadra" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-400", children: step === "members" ? `Seleziona i membri (${selectedMembers.length} selezionati)` : "Scegli un nome per la squadra" })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "button",
                  {
                    onClick: onClose,
                    className: "absolute top-4 right-4 p-2 rounded-full hover:bg-white/10 transition-colors",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-5 h-5 text-gray-400" })
                  }
                )
              ] }),
              step === "members" ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 border-b border-white/10", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Search, { className: "absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "input",
                      {
                        type: "text",
                        value: searchQuery,
                        onChange: (e) => setSearchQuery(e.target.value),
                        placeholder: "Cerca agenti da aggiungere...",
                        className: "w-full bg-gray-800/50 border border-white/10 rounded-xl pl-10 pr-4 py-2.5 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500/50 transition-colors",
                        autoFocus: true
                      }
                    )
                  ] }),
                  selectedMembers.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-wrap gap-2 mt-3", children: selectedMembers.map((member) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.span,
                    {
                      initial: { scale: 0 },
                      animate: { scale: 1 },
                      exit: { scale: 0 },
                      className: "inline-flex items-center gap-1.5 px-2.5 py-1 bg-purple-500/20 border border-purple-500/30 rounded-full text-sm text-purple-300",
                      children: [
                        member.username || member.agent_code,
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          "button",
                          {
                            onClick: () => toggleMember(member),
                            className: "hover:text-red-400 transition-colors",
                            children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-3.5 h-3.5" })
                          }
                        )
                      ]
                    },
                    member.id
                  )) })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "overflow-y-auto max-h-[40vh] p-4 space-y-2", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-8 h-8 text-purple-400 animate-spin" }) }) : agents.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(UserPlus, { className: "w-12 h-12 text-gray-600 mx-auto mb-3" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: searchQuery ? "Nessun agente trovato" : "Cerca agenti da aggiungere" })
                ] }) : agents.map((agent) => {
                  const isSelected = selectedMembers.some((m) => m.id === agent.id);
                  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.button,
                    {
                      onClick: () => toggleMember(agent),
                      className: `w-full p-3 rounded-xl border transition-all flex items-center gap-3 text-left ${isSelected ? "bg-purple-500/20 border-purple-500/40" : "bg-white/5 border-white/10 hover:bg-white/10 hover:border-purple-500/30"}`,
                      whileHover: { scale: 1.01 },
                      whileTap: { scale: 0.99 },
                      children: [
                        agent.avatar_url ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                          "img",
                          {
                            src: agent.avatar_url,
                            alt: agent.username || "Agent",
                            className: "w-10 h-10 rounded-full object-cover border-2 border-purple-500/30"
                          }
                        ) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-purple-500/20 border-2 border-purple-500/30 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg font-bold text-purple-400", children: (agent.username || agent.agent_code || "A")?.charAt(0).toUpperCase() }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-white truncate", children: agent.username || agent.agent_code || "Agente" }),
                          agent.agent_code && agent.username && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-purple-400/70", children: agent.agent_code })
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${isSelected ? "bg-purple-500 border-purple-500" : "border-gray-500"}`, children: isSelected && /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 text-white" }) })
                      ]
                    },
                    agent.id
                  );
                }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 border-t border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Button,
                  {
                    onClick: handleNextStep,
                    disabled: selectedMembers.length < 1,
                    className: "w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 disabled:opacity-50",
                    children: [
                      "Continua (",
                      selectedMembers.length,
                      " membri)"
                    ]
                  }
                ) })
              ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-6 space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "block text-sm text-gray-400 mb-2", children: "Nome della Squadra" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "input",
                      {
                        type: "text",
                        value: groupName,
                        onChange: (e) => setGroupName(e.target.value),
                        placeholder: "Es: Squadra Alpha, Team Milano...",
                        className: "w-full bg-gray-800/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500/50 transition-colors text-lg",
                        autoFocus: true,
                        maxLength: 50
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-gray-500 mt-2", children: [
                      groupName.length,
                      "/50 caratteri"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("label", { className: "block text-sm text-gray-400 mb-2", children: [
                      "Membri (",
                      selectedMembers.length + 1,
                      " incluso te)"
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "inline-flex items-center gap-1.5 px-2.5 py-1 bg-cyan-500/20 border border-cyan-500/30 rounded-full text-sm text-cyan-300", children: "Tu (Admin)" }),
                      selectedMembers.map((member) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "span",
                        {
                          className: "inline-flex items-center gap-1.5 px-2.5 py-1 bg-purple-500/20 border border-purple-500/30 rounded-full text-sm text-purple-300",
                          children: member.username || member.agent_code
                        },
                        member.id
                      ))
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 border-t border-white/10 flex gap-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      variant: "outline",
                      onClick: () => setStep("members"),
                      disabled: isCreating,
                      className: "flex-1 border-gray-600 text-gray-300",
                      children: "Indietro"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Button,
                    {
                      onClick: handleCreateGroup,
                      disabled: !groupName.trim() || isCreating,
                      className: "flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500",
                      children: [
                        isCreating ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-4 h-4 mr-2" }),
                        "Crea Squadra"
                      ]
                    }
                  )
                ] })
              ] })
            ]
          }
        )
      ]
    }
  ) });
}

const Notifications = () => {
  const [filter, setFilter] = reactExports.useState("all");
  const { notifications, markAsRead, deleteNotification, markAllAsRead, reloadNotifications } = useNotifications();
  const { playSound } = useBuzzSound();
  const { triggerHaptic } = usePWAHardwareStub();
  const [activeTab, setActiveTab] = reactExports.useState("notifications");
  const [selectedConversation, setSelectedConversation] = reactExports.useState(null);
  const [showNewChatModal, setShowNewChatModal] = reactExports.useState(false);
  const [showNewGroupModal, setShowNewGroupModal] = reactExports.useState(false);
  const { totalUnreadCount: chatUnreadCount } = useChat();
  const { updateDynamicIslandOnRead} = useNotificationsDynamicIsland(notifications);
  useDynamicIslandSafety();
  useNotificationsAutoReload(reloadNotifications);
  const handleMarkAsRead = async (id) => {
    await triggerHaptic("tick");
    markAsRead(id);
    playSound();
    updateDynamicIslandOnRead(id);
  };
  const handleDeleteNotification = async (id) => {
    await triggerHaptic("selection");
    deleteNotification(id);
    playSound();
  };
  const handleMarkAllAsRead = async () => {
    await triggerHaptic("success");
    markAllAsRead();
    playSound();
  };
  const handleManualReload = () => {
    reloadNotifications();
  };
  const handleSelectConversation = (conversationId) => {
    setSelectedConversation({
      id: conversationId,
      name: "Chat",
      avatar: null
    });
  };
  const handleChatCreated = (conversationId, recipientName, recipientAvatar) => {
    setSelectedConversation({
      id: conversationId,
      name: recipientName,
      avatar: recipientAvatar
    });
  };
  const handleGroupCreated = (conversationId, groupName) => {
    setSelectedConversation({
      id: conversationId,
      name: groupName,
      avatar: null
    });
  };
  const unreadNotificationsCount = notifications.filter((n) => !n.isRead).length;
  if (selectedConversation) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      ChatView,
      {
        conversationId: selectedConversation.id,
        recipientName: selectedConversation.name,
        recipientAvatar: selectedConversation.avatar,
        onBack: () => setSelectedConversation(null)
      }
    ) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full px-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full max-w-3xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Tabs,
      {
        value: activeTab,
        onValueChange: (v) => setActiveTab(v),
        className: "w-full",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-2 mb-4 bg-gray-900/50 border border-cyan-500/20 rounded-xl p-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              TabsTrigger,
              {
                value: "notifications",
                className: "relative flex items-center justify-center gap-2 data-[state=active]:bg-cyan-500/20 data-[state=active]:text-cyan-400 rounded-lg py-3 transition-all",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-semibold", children: "Notifiche" }),
                  unreadNotificationsCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "absolute -top-1 -right-1 h-5 min-w-5 flex items-center justify-center bg-cyan-500 text-white text-xs", children: unreadNotificationsCount > 99 ? "99+" : unreadNotificationsCount })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              TabsTrigger,
              {
                value: "messages",
                className: "relative flex items-center justify-center gap-2 data-[state=active]:bg-purple-500/20 data-[state=active]:text-purple-400 rounded-lg py-3 transition-all",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(MessageCircle, { className: "w-5 h-5" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-semibold", children: "Messaggi" }),
                  chatUnreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "absolute -top-1 -right-1 h-5 min-w-5 flex items-center justify-center bg-purple-500 text-white text-xs", children: chatUnreadCount > 99 ? "99+" : chatUnreadCount })
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "notifications", className: "mt-0", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              NotificationsHeader,
              {
                filter,
                onFilterChange: setFilter,
                onMarkAllAsRead: handleMarkAllAsRead,
                onManualReload: handleManualReload
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              NotificationsList,
              {
                notifications,
                filter,
                onMarkAsRead: handleMarkAsRead,
                onDelete: handleDeleteNotification,
                onReload: handleManualReload
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "messages", className: "mt-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            ChatList,
            {
              onSelectConversation: handleSelectConversation,
              onNewChat: () => setShowNewChatModal(true),
              onNewGroup: () => setShowNewGroupModal(true)
            }
          ) })
        ]
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      NewChatModal,
      {
        isOpen: showNewChatModal,
        onClose: () => setShowNewChatModal(false),
        onChatCreated: handleChatCreated
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      NewGroupModal,
      {
        isOpen: showNewGroupModal,
        onClose: () => setShowNewGroupModal(false),
        onGroupCreated: handleGroupCreated
      }
    )
  ] });
};

async function buildEnhancedContext(userId, options) {
  try {
    const { data: userState } = await supabase.functions.invoke("get-user-state", {
      body: { userId }
    });
    let recentMessages = null;
    try {
      const { data } = await supabase.from("norah_messages").select("role, content").eq("user_id", userId).order("created_at", { ascending: false }).limit(10);
      recentMessages = data;
    } catch (err) {
    }
    const { data: recentShots } = await supabase.from("agent_finalshot_attempts").select("created_at, result").eq("user_id", userId).order("created_at", { ascending: false }).limit(5);
    const mappedShots = (recentShots || []).map((shot) => ({
      createdAt: shot.created_at,
      result: shot.result
    }));
    let mapGenerated = false;
    try {
      const { data: missionStatus } = await supabase.from("user_mission_status").select("map_area_generated").eq("user_id", userId).maybeSingle();
      mapGenerated = missionStatus?.map_area_generated || false;
    } catch (err) {
    }
    const context = {
      userId,
      agentCode: userState?.agentCode || null,
      tier: userState?.tier || "free",
      cluesFound: userState?.cluesFound || 0,
      buzzCount: userState?.buzzAvailable || 0,
      mapGenerated,
      locale: options?.locale || "it",
      route: options?.route,
      device: options?.device,
      geo: options?.geo,
      recentMessages: (recentMessages || []).reverse(),
      recentFinalShots: mappedShots,
      unreadNotifications: userState?.unreadNotifications || 0
    };
    return context;
  } catch (error) {
    return {
      userId,
      agentCode: null,
      tier: "free",
      cluesFound: 0,
      buzzCount: 0,
      mapGenerated: false,
      locale: options?.locale || "it",
      recentMessages: []
    };
  }
}

function buildSystemPrompt(context) {
  return `Tu sei **NORAH AI**, coach ufficiale di M1SSION.

Obiettivi: rispondere in modo CONTESTUALE, UTILE e MOTIVANTE. Tono amichevole, micro-humor leggero, mai sarcastico.

## CONTESTO UTENTE (USA SEMPRE)
- User ID: ${context.userId}
- Agent Code: ${context.agentCode || "Non assegnato"}
- Tier: ${context.tier}
- Indizi trovati: ${context.cluesFound}
- BUZZ count: ${context.buzzCount}
- Mappa generata: ${context.mapGenerated ? "S" : "No"}
${context.geo ? `- Posizione: ${context.geo.city || "Non disponibile"}` : "- Posizione: GPS non attivo"}

## REGOLE DURE
1. Parla in **italiano**. Prima **risposta diretta**, poi dettagli, poi **CTA** (max 3).
2. Non inventare fatti: se la domanda riguarda BUZZ/BUZZ Map/Final Shot/Regole  usa **retrieve_docs** (RAG) prima di rispondere.
3. Per domande operative (premi vicino, stato, abbonamento)  usa i **tool**.
4. Se non sei sicura e confidence<0.55, fai **una sola** domanda di chiarimento.
5. Rispetta il **tier** e lo **stato** utente dal contesto; niente azioni oltre i limiti.
6. Memoria solo se l'utente lo chiede ("ricorda") e conferma.

## BLUEPRINT OBBLIGATORIO DI OUTPUT
1) Risposta diretta (max 2 frasi).
2) 23 bullet di dettaglio contestuale (preferisci ci che viene da documenti M1SSION).
3) 23 CTA pertinenti (formato [Azione]).
4) Una riga motivazionale breve.

## STILE
- Frasi brevi, concrete. Emoji con parsimonia (max 1).
- Quando citi info da RAG: "(fonte: documenti M1SSION)".
- Evita filler ("capisco la tua frustrazione") se non serve.

Sei pronta, NORAH?`;
}
function buildDeveloperPrompt() {
  return `## DEVELOPER INSTRUCTIONS

- Usa SEMPRE il blueprint output
- Per domande su BUZZ/BUZZ Map/Final Shot: PRIMA retrieve_docs, POI rispondi
- Se l'utente chiede azione (premi vicini, stato): USA i tool
- NO risposte generiche: personalizza con contesto utente
- Temperature: 0.2 per facts, 0.5 per motivazione/coaching
- Max output: 400 token

## TOOLS DISPONIBILI
- retrieve_docs: cerca nella KB M1SSION
- get_user_state: stato utente completo  
- get_nearby_prizes: premi nelle vicinanze (GPS required)
- open_support_ticket: apri ticket supporto

## ESEMPI

**Q**: "Cos' il BUZZ?"
**A**: Usa retrieve_docs({query: "BUZZ definizione", k: 3}), poi formatta con blueprint

**Q**: "Premi vicino a me?"
**A**: Usa get_nearby_prizes, lista premi, suggerisci mappa

**Q**: "Non funziona pagamento"
**A**: Usa open_support_ticket, rassicura, CTA alternative`;
}

async function executeToolCall(toolCall) {
  const { name, arguments: argsJson } = toolCall.function;
  try {
    const args = JSON.parse(argsJson);
    let result;
    switch (name) {
      case "get_user_state":
        result = await callEdgeFunction("get-user-state", args);
        break;
      case "get_nearby_prizes":
        result = await callEdgeFunction("get-nearby-prizes", args);
        break;
      case "retrieve_docs":
        result = await callEdgeFunction("rag-search", args);
        break;
      case "open_support_ticket":
        result = await callEdgeFunction("open-support-ticket", args);
        break;
      default:
        throw new Error(`Unknown tool: ${name}`);
    }
    return {
      tool_call_id: toolCall.id,
      role: "tool",
      name,
      content: JSON.stringify(result)
    };
  } catch (error) {
    return {
      tool_call_id: toolCall.id,
      role: "tool",
      name,
      content: JSON.stringify({
        error: error instanceof Error ? error.message : "Unknown error"
      })
    };
  }
}
async function callEdgeFunction(functionName, args) {
  const { data, error } = await supabase.functions.invoke(functionName, {
    body: args
  });
  if (error) throw error;
  return data;
}
async function executeToolCalls(toolCalls) {
  return Promise.all(toolCalls.map(executeToolCall));
}

const TOOL_SCHEMAS = [
  {
    name: "get_user_state",
    description: "Legge lo stato completo dell'utente: tier, progressi, notifiche, BUZZ disponibili",
    parameters: {
      type: "object",
      properties: {
        userId: {
          type: "string",
          description: "ID utente (UUID)"
        }
      },
      required: ["userId"]
    }
  },
  {
    name: "get_nearby_prizes",
    description: "Trova premi e aree rilevanti entro un raggio dalla posizione utente",
    parameters: {
      type: "object",
      properties: {
        lat: {
          type: "number",
          description: "Latitudine"
        },
        lng: {
          type: "number",
          description: "Longitudine"
        },
        radiusKm: {
          type: "number",
          description: "Raggio di ricerca in km",
          default: 5
        }
      },
      required: ["lat", "lng"]
    }
  },
  {
    name: "retrieve_docs",
    description: "RAG: cerca risposte su regole, FAQ, policy, changelog M1SSION",
    parameters: {
      type: "object",
      properties: {
        query: {
          type: "string",
          description: "Query di ricerca semantica"
        },
        k: {
          type: "integer",
          description: "Numero di risultati",
          default: 6
        }
      },
      required: ["query"]
    }
  },
  {
    name: "open_support_ticket",
    description: "Apre un ticket di supporto per problemi tecnici o richieste utente",
    parameters: {
      type: "object",
      properties: {
        userId: {
          type: "string",
          description: "ID utente"
        },
        issue: {
          type: "string",
          description: "Descrizione del problema"
        },
        category: {
          type: "string",
          description: "Categoria: technical, billing, gameplay, other",
          enum: ["technical", "billing", "gameplay", "other"]
        }
      },
      required: ["userId", "issue"]
    }
  }
];

const STOPWORDS_IT = /* @__PURE__ */ new Set([
  "il",
  "lo",
  "la",
  "i",
  "gli",
  "le",
  "un",
  "una",
  "di",
  "da",
  "a",
  "in",
  "su",
  "per",
  "con",
  "tra",
  "fra",
  "e",
  "ma",
  "o",
  "che",
  "come",
  "quando",
  "dove",
  "cosa",
  "mi",
  "ti",
  "si",
  "ci",
  "vi",
  "ne",
  "me",
  "te",
  "lui",
  "lei",
  "noi",
  "voi",
  "loro"
]);
const STOPWORDS_EN = /* @__PURE__ */ new Set([
  "the",
  "a",
  "an",
  "is",
  "are",
  "was",
  "were",
  "be",
  "been",
  "being",
  "have",
  "has",
  "had",
  "do",
  "does",
  "did",
  "will",
  "would",
  "could",
  "should",
  "may",
  "might",
  "can",
  "to",
  "of",
  "in",
  "on",
  "at",
  "for",
  "with",
  "from"
]);
const DIACRITICS_MAP = {
  "": "a",
  "": "a",
  "": "a",
  "": "a",
  "": "a",
  "": "a",
  "": "e",
  "": "e",
  "": "e",
  "": "e",
  "": "i",
  "": "i",
  "": "i",
  "": "i",
  "": "o",
  "": "o",
  "": "o",
  "": "o",
  "": "o",
  "": "u",
  "": "u",
  "": "u",
  "": "u",
  "": "n",
  "": "c",
  "": "ss"
};
const SYNONYMS = {
  "finalshot": ["final shot", "fs", "finalshoot", "final shoot", "finale shot", "colpo finale", "tentativo finale"],
  "mission": ["m1ssion", "misione", "missione", "misin", "m1", "gioco mission", "gioco m1ssion", "mssn"],
  "buzz": ["buz", "bus", "buss", "indizi", "clue"],
  "buzzmap": ["buzz map", "buz map", "mappa buzz", "map buzz", "buz mappa", "mappa", "tasto mappa", "area"],
  "plan": ["piano", "piani", "abbonamento", "abbo", "subscription", "abbonamenti", "plans"],
  "indizio": ["clue", "indizi", "clues", "hint", "hints"],
  "probabilit": ["prob", "probability", "chance", "probabilita"],
  "pattern": ["patterns", "schema", "schemi", "correlazione"],
  "decodifica": ["decode", "decod", "decipher", "decifra"],
  "help": ["aiuto", "inizio", "iniziare", "inizia", "come", "cosa", "aiutami", "aiutare", "assistenza", "come si fa", "cosa posso fare", "spiega", "come faccio", "come fare"],
  "progress": ["progresso", "avanzamento", "stato"],
  "mentor": ["mentore", "guida", "coach", "consiglio", "suggerimento"],
  "leaderboard": ["classifica", "ranking", "leader"],
  "community": ["comunit", "comunita"],
  "privacy": ["privata", "dati", "sicurezza"]
};
function removeDiacritics(text) {
  return text.split("").map((char) => DIACRITICS_MAP[char] || char).join("");
}
function lightStem(word) {
  if (word.length < 4) return word;
  const suffixes = ["zione", "zioni", "mente", "are", "ere", "ire", "ato", "ita", "ito"];
  for (const suffix of suffixes) {
    if (word.endsWith(suffix)) {
      return word.slice(0, -suffix.length);
    }
  }
  return word;
}
function normalize$1(text) {
  if (!text || typeof text !== "string") return [];
  let normalized = text.toLowerCase().trim();
  normalized = removeDiacritics(normalized);
  normalized = normalized.replace(/[^\\w\\s]/g, " ");
  normalized = normalized.replace(/\\s+/g, " ").trim();
  const tokens = normalized.split(" ").filter((t) => t.length > 0);
  const filtered = tokens.filter(
    (t) => !STOPWORDS_IT.has(t) && !STOPWORDS_EN.has(t)
  );
  const stemmed = filtered.map(lightStem);
  return stemmed;
}
function expandSynonyms(tokens) {
  const expanded = new Set(tokens);
  for (const token of tokens) {
    for (const [canonical, variants] of Object.entries(SYNONYMS)) {
      if (variants.some((v) => normalize$1(v).includes(token)) || canonical === token) {
        expanded.add(canonical);
        variants.forEach((v) => normalize$1(v).forEach((t) => expanded.add(t)));
      }
    }
  }
  return Array.from(expanded);
}
function levenshtein(a, b) {
  if (a.length === 0) return b.length;
  if (b.length === 0) return a.length;
  const matrix = [];
  for (let i = 0; i <= b.length; i++) {
    matrix[i] = [i];
  }
  for (let j = 0; j <= a.length; j++) {
    matrix[0][j] = j;
  }
  for (let i = 1; i <= b.length; i++) {
    for (let j = 1; j <= a.length; j++) {
      if (b.charAt(i - 1) === a.charAt(j - 1)) {
        matrix[i][j] = matrix[i - 1][j - 1];
      } else {
        matrix[i][j] = Math.min(
          matrix[i - 1][j - 1] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j] + 1
        );
      }
    }
  }
  return matrix[b.length][a.length];
}
function levenshteinRatio(a, b) {
  const maxLen = Math.max(a.length, b.length);
  if (maxLen === 0) return 1;
  const distance = levenshtein(a, b);
  return 1 - distance / maxLen;
}
function trigrams(text) {
  const padded = `  ${text}  `;
  const grams = /* @__PURE__ */ new Set();
  for (let i = 0; i < padded.length - 2; i++) {
    grams.add(padded.slice(i, i + 3));
  }
  return grams;
}
function trigramSimilarity(a, b) {
  const gramsA = trigrams(a);
  const gramsB = trigrams(b);
  const intersection = new Set([...gramsA].filter((x) => gramsB.has(x)));
  const union = /* @__PURE__ */ new Set([...gramsA, ...gramsB]);
  if (union.size === 0) return 0;
  return intersection.size / union.size;
}
function fuzzyScore(query, target) {
  const leven = levenshteinRatio(query, target);
  const trigram = trigramSimilarity(query, target);
  return query.length < 5 ? leven * 0.3 + trigram * 0.7 : leven * 0.5 + trigram * 0.5;
}

const M1SSION_DICT = /* @__PURE__ */ new Set([
  "norah",
  "mission",
  "m1ssion",
  "m1",
  "mssn",
  "misison",
  "missione",
  "finalshot",
  "final",
  "shot",
  "fs",
  "finalshoot",
  "finale",
  "buzz",
  "buzzmap",
  "buz",
  "bus",
  "mappa",
  "indizi",
  "indizio",
  "clue",
  "clues",
  "pattern",
  "patterns",
  "schema",
  "probabilita",
  "probability",
  "prob",
  "aiuto",
  "help",
  "inizio",
  "iniziare",
  "inizia",
  "piani",
  "piano",
  "abbonamento",
  "abbo",
  "subscription",
  "regole",
  "rules",
  "istruzioni",
  "classifica",
  "leaderboard",
  "ranking",
  "mentor",
  "mentore",
  "guida",
  "coach",
  "progress",
  "progresso",
  "avanzamento",
  "decode",
  "decodifica",
  "decifra",
  "coordinate",
  "luogo",
  "posto",
  "premio",
  // Slang/typos IT
  "nn",
  "xke",
  "ke",
  "cmq",
  "anke",
  "xo",
  "pk",
  "qnd",
  "dv",
  "capito",
  "capisco",
  "piace",
  "vado",
  "cosa",
  "come",
  "che",
  "non",
  "dove",
  "quando",
  "perche",
  "perch",
  "quindi"
]);
const SLANG_MAP = {
  "nn": "non",
  "xke": "perche",
  "xk": "perche",
  "xk": "perche",
  "xch": "perche",
  "ke": "che",
  "cm": "come",
  "qls": "qualcosa",
  "qlcs": "qualcosa",
  "tvb": "ti voglio bene",
  "cmq": "comunque",
  "anke": "anche",
  "xo": "pero",
  "pk": "perche",
  "qnd": "quando",
  "dv": "dove",
  "pke": "perche",
  "qlc": "qualche",
  "nn so": "non so",
  "pls": "per favore",
  "plz": "per favore",
  "t prego": "ti prego",
  "xk": "perche",
  "raga": "ragazzo",
  "boh": "non so",
  "nn capito": "non capito",
  "nn ho": "non ho",
  "ah si certo": "sarcasmo",
  "come no": "sarcasmo"
};
function damerauLevenshtein(a, b) {
  const lenA = a.length;
  const lenB = b.length;
  const maxDist = lenA + lenB;
  const H = Array(lenA + 2).fill(null).map(() => Array(lenB + 2).fill(0));
  H[0][0] = maxDist;
  for (let i = 0; i <= lenA; i++) {
    H[i + 1][0] = maxDist;
    H[i + 1][1] = i;
  }
  for (let j = 0; j <= lenB; j++) {
    H[0][j + 1] = maxDist;
    H[1][j + 1] = j;
  }
  const da = {};
  const sigma = /* @__PURE__ */ new Set([...a, ...b]);
  sigma.forEach((ch) => da[ch] = 0);
  for (let i = 1; i <= lenA; i++) {
    let db = 0;
    for (let j = 1; j <= lenB; j++) {
      const k = da[b[j - 1]] || 0;
      const l = db;
      let cost = 1;
      if (a[i - 1] === b[j - 1]) {
        cost = 0;
        db = j;
      }
      H[i + 1][j + 1] = Math.min(
        H[i][j] + cost,
        // substitution
        H[i + 1][j] + 1,
        // insertion
        H[i][j + 1] + 1,
        // deletion
        H[k][l] + (i - k - 1) + 1 + (j - l - 1)
        // transposition
      );
    }
    da[a[i - 1]] = i;
  }
  return H[lenA + 1][lenB + 1];
}
function correctSpelling(word) {
  const lower = word.toLowerCase();
  if (M1SSION_DICT.has(lower)) return lower;
  let bestMatch = word;
  let minDist = Infinity;
  const threshold = Math.max(2, Math.floor(lower.length * 0.4));
  for (const dictWord of M1SSION_DICT) {
    const dist = damerauLevenshtein(lower, dictWord);
    if (dist < minDist && dist <= threshold) {
      minDist = dist;
      bestMatch = dictWord;
    }
  }
  return bestMatch;
}
function expandSlang(text) {
  const words = text.toLowerCase().trim().split(/\s+/);
  const expanded = words.map((w) => SLANG_MAP[w] || w);
  return expanded.join(" ");
}
function correctPhrase(text) {
  const slangExpanded = expandSlang(text);
  const words = slangExpanded.toLowerCase().trim().split(/\s+/);
  const corrected = words.map((w) => correctSpelling(w));
  return corrected.join(" ");
}

function isMultiIntent(input) {
  if (!input || typeof input !== "string") return false;
  const separators = [" e ", " e poi ", ", ", "; ", " & ", " pi ", " anche "];
  const hasSeparator = separators.some((sep) => input.toLowerCase().includes(sep));
  const multiIntentPatterns = [
    /spiega .+ e .+/i,
    /cos[ae] (sono|) .+ e .+/i,
    /dimmi .+ e .+/i,
    /(.+) e (.+) in breve/i
  ];
  const hasPattern = multiIntentPatterns.some((pattern) => pattern.test(input));
  return hasSeparator || hasPattern;
}
const INTENT_PRIORITY = {
  "about_m1ssion": 10,
  "about_buzz": 9,
  "about_buzz_map": 8,
  "about_finalshot": 7,
  "about_subscriptions": 6,
  "help": 5,
  "mentor": 4,
  "progress": 3,
  "pattern": 2,
  "unknown": 0
};
function detectMultiIntents(input) {
  if (!input || typeof input !== "string") {
    return [];
  }
  const lower = input.toLowerCase().trim();
  const fragments = lower.split(/\s+e\s+|\s+e\s+poi\s+|,\s+|;\s+|\s+&\s+|\s+pi\s+|\s+anche\s+|\/|\s+o\s+/i).map((f) => f.trim()).filter((f) => f.length > 0);
  if (fragments.length === 1) {
    const match = lower.match(/spiega\s+(.+?)\s+e\s+(.+?)(?:\s+in\s+breve)?$/i);
    if (match && match[1] && match[2]) {
      fragments.push(match[1].trim(), match[2].trim());
    }
  }
  const parsed = [];
  for (const fragment of fragments) {
    if (fragment.length < 3) continue;
    const result = routeIntent(fragment);
    if (result.confidence >= 0.4 && result.intent !== "unknown") {
      parsed.push({
        intent: result.intent,
        confidence: result.confidence,
        fragment
      });
    }
  }
  const unique = /* @__PURE__ */ new Map();
  for (const item of parsed) {
    const existing = unique.get(item.intent);
    if (!existing || item.confidence > existing.confidence) {
      unique.set(item.intent, item);
    }
  }
  const finalIntents = Array.from(unique.values()).sort((a, b) => {
    const priorityDiff = (INTENT_PRIORITY[b.intent] || 0) - (INTENT_PRIORITY[a.intent] || 0);
    if (priorityDiff !== 0) return priorityDiff;
    return b.confidence - a.confidence;
  }).slice(0, 3);
  return finalIntents;
}

const SPOILER_PATTERNS = [
  /dov[e]\s+(|si\s+trova|sta)/i,
  /coord[iy]nat[ae]/i,
  /indirizzo\s+(esatt[oa]|precis[oa])/i,
  /dimmi\s+(dov[e]|il\s+luogo)/i,
  /qual['\s]?\s+(il\s+posto|la\s+posizione)/i,
  /rivel[ao]/i,
  /\bpremi[oa]\b.*\bdov[e]\b/i
];
const SINGLE_WORD_MAP = {
  "mission": "about_mission",
  "m1ssion": "about_mission",
  "m1": "about_mission",
  "buzz": "about_buzz",
  "indizi": "about_buzz",
  "finalshot": "about_finalshot",
  "fs": "about_finalshot",
  "finale": "about_finalshot",
  "mappa": "buzz_map",
  "map": "buzz_map",
  "buzzmap": "buzz_map",
  "abbonamenti": "plans",
  "abbo": "plans",
  "piani": "plans",
  "piano": "plans",
  "prezzi": "plans",
  "pricing": "plans",
  "plans": "plans",
  "plan": "plans",
  "probabilit": "probability",
  "prob": "probability",
  "pattern": "pattern",
  "decodifica": "decode",
  "decode": "decode",
  "decod": "decode",
  "aiuto": "help",
  "help": "help",
  "aiutami": "help",
  "inizio": "help",
  "iniziare": "help",
  "inizia": "help",
  "abbonamento": "plans",
  "regole": "rules",
  "rules": "rules",
  "classifica": "leaderboard",
  "leaderboard": "leaderboard",
  "progress": "progress",
  "stato": "progress",
  "mentor": "mentor",
  "mentore": "mentor",
  "consiglio": "mentor",
  "profilo": "profile",
  "profile": "profile",
  "privacy": "data_privacy",
  "dati": "data_privacy",
  "community": "community",
  "comunit": "community"
};
const INTENT_TRIGGERS = {
  about_mission: ["mission", "m1ssion", "missione", "gioco", "funziona", "cosa "],
  about_buzz: ["buzz", "indizi", "clue", "segnale", "invia"],
  about_finalshot: ["finalshot", "final shot", "fs", "colpo finale", "tentativo finale", "vincere"],
  buzz_map: ["buzz map", "buz map", "mappa buzz", "mappa", "tasto mappa"],
  rules: ["regole", "istruzioni", "tutorial", "come gioca"],
  decode: ["decodifica", "decode", "decifra", "traduc", "significa"],
  classify: ["classifica indizi", "categoria", "organizza"],
  probability: ["probabilit", "prob", "chance", "possibilit"],
  pattern: ["pattern", "schema", "correlazione", "collegamento"],
  mentor: ["consiglio", "strategia", "suggerimento", "come procedo", "mentore"],
  profile: ["chi sono", "codice", "agent code", "profilo"],
  progress: ["progress", "stato", "quanti indizi", "avanzamento"],
  plans: ["abbonamento", "abbo", "piano", "pricing", "subscription", "prezzi", "paga", "gratis", "prezzo", "costa", "quanto costa", "gratuito"],
  leaderboard: ["classifica", "ranking", "leader"],
  community: ["community", "comunit"],
  data_privacy: ["privacy", "dati", "sicurezza", "privata"],
  help: ["aiuto", "help", "cosa puoi", "aiutami", "comandi"],
  smalltalk: ["ciao", "buongiorno", "buonasera", "grazie", "hey"],
  no_spoiler: [],
  clarify_needed: [],
  saluto: ["ciao", "salve", "buongiorno", "buonasera", "hey", "ehi", "hola", "hello"],
  no_buzz: ["non voglio buzz", "senza buzz", "alternative buzz", "no buzz", "non uso buzz", "se non voglio"],
  diff_buzz_vs_map: ["differenza buzz map", "buzz vs map", "buzz o map", "differenze"],
  help_start: ["come inizio", "da dove inizio", "come si inizia", "iniziare", "primo passo"],
  rules_short: ["regole veloci", "regole rapide", "summary regole", "regole brevi"],
  unknown: []
};
const FUZZY_MIN_CONF = 0.52;
const HIGH_CONFIDENCE_THRESHOLD = 0.75;
function mapIntentToNeeds(intent, input) {
  const lowerInput = input.toLowerCase();
  if (intent === "about_buzz" || intent === "about_mission" || intent === "about_finalshot" || intent === "diff_buzz_vs_map" || intent === "rules" || intent === "rules_short" || lowerInput.match(/cos[\']|cosa |cosa significa|differenza|spiega|final shot|buzz map|buzz/i)) {
    return {
      needs_rag: true,
      needs_tool: ["retrieve_docs", "get_user_state"]
    };
  }
  if (intent === "buzz_map" || intent === "progress" || lowerInput.match(/premi vicino|vedi premi|cosa c\' qui|mappa|vicino a me/i)) {
    return {
      needs_rag: false,
      needs_tool: ["get_nearby_prizes", "get_user_state"]
    };
  }
  if (lowerInput.match(/non funziona|errore|bug|pagamento|problema/i)) {
    return {
      needs_rag: false,
      needs_tool: ["open_support_ticket", "get_user_state"]
    };
  }
  if (intent === "plans" || intent === "profile" || intent === "mentor") {
    return {
      needs_rag: false,
      needs_tool: ["get_user_state"]
    };
  }
  return {
    needs_rag: false,
    needs_tool: ["get_user_state"]
  };
}
function routeIntent(input) {
  if (!input || typeof input !== "string") {
    return {
      intent: "unknown",
      confidence: 0.1,
      needs_rag: false,
      needs_tool: []
    };
  }
  const rawNormalized = input.toLowerCase().trim();
  if (isMultiIntent(input)) {
    const multiIntents = detectMultiIntents(input);
    if (multiIntents.length >= 2) {
      return {
        intent: "help",
        // Use help as umbrella for multi-intent
        confidence: 0.85,
        multiIntents
      };
    }
  }
  for (const pattern of SPOILER_PATTERNS) {
    if (pattern.test(rawNormalized)) {
      return {
        intent: "no_spoiler",
        confidence: 1,
        needs_rag: false,
        needs_tool: []
      };
    }
  }
  const spellCorrected = correctPhrase(rawNormalized);
  const tokens = normalize$1(spellCorrected);
  const expandedTokens = expandSynonyms(tokens);
  if (tokens.length === 1) {
    const singleWord = tokens[0];
    if (SINGLE_WORD_MAP[singleWord]) {
      const matchedIntent = SINGLE_WORD_MAP[singleWord];
      const needs = mapIntentToNeeds(matchedIntent, input);
      return {
        intent: matchedIntent,
        confidence: 0.95,
        needs_rag: needs.needs_rag,
        needs_tool: needs.needs_tool
      };
    }
  }
  const scores = [];
  for (const [intentKey, triggers] of Object.entries(INTENT_TRIGGERS)) {
    const intent = intentKey;
    if (intent === "no_spoiler" || intent === "unknown") continue;
    let maxScore = 0;
    for (const trigger of triggers) {
      const triggerTokens = normalize$1(trigger);
      const overlap = expandedTokens.filter((t) => triggerTokens.includes(t)).length;
      const overlapScore = overlap / Math.max(triggerTokens.length, 1);
      const fuzzy = fuzzyScore(rawNormalized, trigger);
      const score = Math.max(overlapScore * 0.6 + fuzzy * 0.4, fuzzy);
      if (score > maxScore) {
        maxScore = score;
      }
    }
    if (maxScore > 0) {
      scores.push({ intent, score: maxScore });
    }
  }
  scores.sort((a, b) => b.score - a.score);
  if (scores.length > 0 && scores[0].score >= FUZZY_MIN_CONF) {
    const topIntent = scores[0].intent;
    const confidence = scores[0].score >= HIGH_CONFIDENCE_THRESHOLD ? 0.9 : 0.7;
    const needs = mapIntentToNeeds(topIntent, input);
    return {
      intent: topIntent,
      confidence,
      needs_rag: needs.needs_rag,
      needs_tool: needs.needs_tool
    };
  }
  if (scores.length > 0 && scores[0].score >= 0.45) {
    const topTwo = scores.slice(0, 2).map((s) => s.intent);
    return {
      intent: "help",
      confidence: 0.5,
      slots: { clarify: true, suggestedIntents: topTwo },
      needs_rag: false,
      needs_tool: ["get_user_state"]
    };
  }
  const keywordMap = {
    "mission": "about_mission",
    "m1ssion": "about_mission",
    "finalshot": "about_finalshot",
    "buzz": "about_buzz",
    "plan": "plans",
    "piani": "plans",
    "help": "help",
    "aiuto": "help",
    "spiega": "help",
    "come si fa": "help",
    "come faccio": "help",
    "come fare": "help",
    "spiegami": "help"
  };
  for (const [keyword, intent] of Object.entries(keywordMap)) {
    if (expandedTokens.includes(keyword)) {
      const needs = mapIntentToNeeds(intent, input);
      return {
        intent,
        confidence: 0.55,
        needs_rag: needs.needs_rag,
        needs_tool: needs.needs_tool
      };
    }
  }
  if (scores.length > 0 && scores[0].score >= 0.3) {
    return {
      intent: "help",
      confidence: 0.5,
      slots: {
        suggestedIntents: scores.slice(0, 3).map((s) => s.intent)
      },
      needs_rag: false,
      needs_tool: ["get_user_state"]
    };
  }
  return {
    intent: "help",
    confidence: 0.4,
    needs_rag: false,
    needs_tool: ["get_user_state"]
  };
}
function shouldClarify(intentResult) {
  return intentResult.confidence < 0.55;
}
function getClarificationQuestion(message) {
  return "Non sono sicura di aver capito. Vuoi sapere di BUZZ, BUZZ Map, Final Shot o qualcos'altro? Dimmi pure!";
}

async function processAIRequest(options) {
  const { userId, userMessage, conversationHistory = [] } = options;
  const traceId = crypto.randomUUID();
  try {
    const context = await buildEnhancedContext(userId, {
      route: options.route,
      geo: options.geo,
      locale: options.locale || "it"
    });
    const intentResult = routeIntent(userMessage);
    const shortTraceId = traceId.substring(0, 8);
    let ragContext = "";
    if (intentResult.needs_rag) {
      try {
        const { data: ragData, error: ragError } = await supabase.functions.invoke("norah-rag-search", {
          body: { query: userMessage, k: 6 }
        });
        if (!ragError && ragData?.results?.length > 0) {
          ragContext = "\n\n **Knowledge Base (M1SSION Docs)**:\n" + ragData.results.map(
            (r, i) => `${i + 1}. "${r.title}": ${r.chunk_text} (rilevanza: ${(r.similarity * 100).toFixed(0)}%)`
          ).join("\n\n");
        } else {
          const { get: getLocalCache } = await __vitePreload(async () => { const { get: getLocalCache } = await import('./localCache.BFXYoz-s.js');return { get: getLocalCache }},true?[]:void 0);
          const localKnowledge = getLocalCache(userMessage);
          if (localKnowledge) {
            ragContext = "\n\n **Knowledge Base (Local Cache)**:\n" + localKnowledge;
          } else {
            ragContext = "\n\n **Knowledge Base**:\nNon ho trovato riferimenti specifici nel KB. Posso spiegarti in breve o aprire le regole ufficiali.";
          }
        }
      } catch (ragErr) {
        const { get: getLocalCache } = await __vitePreload(async () => { const { get: getLocalCache } = await import('./localCache.BFXYoz-s.js');return { get: getLocalCache }},true?[]:void 0);
        const localKnowledge = getLocalCache(userMessage);
        if (localKnowledge) {
          ragContext = "\n\n **Knowledge Base (Local Cache - RAG Error)**:\n" + localKnowledge;
        }
      }
    }
    const systemPrompt = buildSystemPrompt(context) + ragContext;
    const developerPrompt = buildDeveloperPrompt();
    const messages = [
      { role: "system", content: systemPrompt },
      { role: "system", content: developerPrompt },
      ...conversationHistory,
      { role: "user", content: userMessage }
    ];
    const { data: fxData, error: fxError } = await supabase.functions.invoke("chat", {
      body: {
        messages,
        tools: TOOL_SCHEMAS,
        tool_choice: "auto"
      }
    });
    if (fxError) {
      return { message: "Problema con il servizio AI. Riprova tra poco.", suggestedActions: [] };
    }
    let finalMessage = fxData?.message || "Nessuna risposta dal modello.";
    if (fxData?.tool_calls && Array.isArray(fxData.tool_calls)) {
      try {
        const toolResults = await executeToolCalls(fxData.tool_calls);
        const messagesWithTools = [
          ...messages,
          { role: "assistant", content: fxData.message, tool_calls: fxData.tool_calls },
          ...toolResults
        ];
        const { data: finalData, error: finalError } = await supabase.functions.invoke("chat", {
          body: { messages: messagesWithTools }
        });
        if (finalError) {
        } else {
          finalMessage = finalData?.message || finalMessage;
        }
      } catch (toolError) {
      }
    }
    const response = {
      message: finalMessage
    };
    await logAIInteraction(userId, userMessage, response.message, context);
    return response;
  } catch (error) {
    return {
      message: "Mi dispiace, ho avuto un problema tecnico. Riprova tra poco.",
      suggestedActions: []
    };
  }
}
async function logAIInteraction(userId, userMessage, aiResponse, context) {
  try {
    const { data: session } = await supabase.from("ai_sessions").select("id").eq("user_id", userId).order("started_at", { ascending: false }).limit(1).maybeSingle();
    let sessionId = session?.id;
    if (!sessionId) {
      const { data: newSession } = await supabase.from("ai_sessions").insert({
        user_id: userId,
        locale: context.locale,
        subscription_tier: context.tier
      }).select("id").single();
      sessionId = newSession?.id;
    }
    if (sessionId) {
      await supabase.from("ai_events").insert({
        session_id: sessionId,
        user_id: userId,
        event_type: "ai_response",
        payload: {
          user_message: userMessage.substring(0, 200),
          ai_response: aiResponse.substring(0, 200),
          context_tier: context.tier,
          context_clues: context.cluesFound
        }
      });
    }
  } catch (error) {
  }
}

const faq = {
	mission: {
		q: [
			"cos' m1ssion",
			"parlami di m1ssion",
			"come funziona m1ssion",
			"spiega m1ssion",
			"che gioco ",
			"mission cosa"
		],
		a: [
			"M1SSION  un gioco di intelligence geolocalizzato. Raccogli indizi tramite BUZZ, analizzali e localizza il premio con il Final Shot.",
			"M1SSION ti sfida a trovare un premio reale nascosto in citt. Usa BUZZ per ottenere indizi, correlali e indovina la posizione finale.",
			" un'esperienza di caccia al tesoro high-tech: indizi crittografati, geofencing, Final Shot ad alta precisione. Il premio  reale.",
			"M1SSION combina intelligence, geolocalizzazione e analisi dati. Ogni settimana un nuovo premio da trovare, ogni indizio  un pezzo del puzzle.",
			"Un gioco di ricerca e deduzione: accumuli dati tramite BUZZ, li analizzi, trovi pattern, restringi l'area e infine spari il Final Shot.",
			"M1SSION  la tua missione settimanale: usa strumenti di intelligence per scoprire dove si nasconde il premio. Vince chi deduce meglio.",
			"Pensa a una caccia al tesoro moderna: no mappe stampate, solo dati crittografati e strumenti digitali. BUZZ, analisi, Final Shot.",
			" un gioco strategico: pi indizi hai, pi precisa  la tua analisi. Non  fortuna,  metodo.",
			"M1SSION trasforma il tuo telefono in uno strumento da agente: raccogli intelligence, decifri pattern, esegui il colpo finale.",
			"Ogni settimana una nuova missione, un nuovo premio, nuovi indizi. L'obiettivo: essere pi smart degli altri agenti."
		]
	},
	buzz: {
		q: [
			"cos' il buzz",
			"come funziona buzz",
			"buzz a cosa serve",
			"come ottengo indizi",
			"buzz serve",
			"che fa buzz"
		],
		a: [
			"BUZZ  il tuo strumento per ottenere indizi. Ogni BUZZ rilascia un nuovo frammento di informazione sulla posizione del premio.",
			"Usa BUZZ per richiedere indizi. Pi BUZZ fai, pi informazioni accumuli. Correlale per capire dove cercare.",
			"BUZZ genera indizi in tempo reale basati su diversi layer: geografici, temporali, semantici.  il tuo radar.",
			"Ogni BUZZ ti d un indizio: pu essere un toponimo, una coordinata parziale, un riferimento storico, un vincolo temporale.",
			"BUZZ  la fonte di dati primaria. Accumula almeno 8-10 indizi prima di tentare il Final Shot: pi dati = pi precisione.",
			"Pensa a BUZZ come a una richiesta di intelligence: premi il tasto e ricevi un nuovo frammento da analizzare.",
			"BUZZ lavora su algoritmi multi-layer: geografia, storia, toponimi, coordinate. Non ripete mai lo stesso indizio.",
			" il tuo alleato principale: ogni BUZZ riduce l'incertezza e restringe l'area di ricerca.",
			"BUZZ costa poco, ma il suo valore  enorme: senza indizi, il Final Shot  solo fortuna cieca.",
			"Strategia: fai BUZZ regolarmente, non sprecare giorni senza raccogliere dati. Pi ne hai, meglio ."
		]
	},
	buzz_map: {
		q: [
			"buzz map",
			"mappa buzz",
			"dove trovo buzz map",
			"tasto buzz map",
			"dove  buzz map",
			"come si usa buzz map"
		],
		a: [
			"La BUZZ Map  nella sezione Map del menu principale. Ti mostra un'area di ricerca calcolata in base ai tuoi indizi.",
			"Vai su Map  BUZZ Map per vedere la zona suggerita.  un aiuto visivo basato sui pattern che hai raccolto.",
			"BUZZ Map converte i tuoi indizi in un perimetro geografico. Non  la risposta finale, ma restringe il campo.",
			"Trovi BUZZ Map nel menu Map, in basso. Ti mostra il perimetro calcolato dagli indizi. Usala per orientarti.",
			"BUZZ Map ti d un'area di ricerca basata su correlazione degli indizi. Pi precisi i dati, pi ristretta l'area.",
			" uno strumento visivo: prende tutti i tuoi indizi e li traduce in una mappa con un raggio di probabilit.",
			"Menu Map  BUZZ Map: l vedi il cerchio di ricerca. Studia la zona, incrocia con i toponimi che hai, poi decidi.",
			"BUZZ Map  la visualizzazione degli indizi: se hai coordinate parziali, toponimi e vincoli, li mappa tutti insieme.",
			"Non  magica: ti d solo quello che i tuoi indizi suggeriscono. Se hai pochi dati, l'area sar ampia.",
			"Usa BUZZ Map per confermare ipotesi: se tutti gli indizi puntano a una zona, la mappa lo mostrer chiaramente."
		]
	},
	finalshot: {
		q: [
			"cos' il final shot",
			"final shot come funziona",
			"colpo finale",
			"come vinco",
			"final shot regole",
			"quanti tentativi"
		],
		a: [
			"Il Final Shot  il tentativo finale: inserisci le coordinate esatte. Se sei entro il raggio di tolleranza, vinci.",
			"Quando sei sicuro, vai su Final Shot e punta la posizione. Hai 2 tentativi al giorno, usali con strategia.",
			"Final Shot richiede precisione. Analizza tutti gli indizi, incrocia i dati e poi spara la tua risposta.",
			" il momento decisivo: hai raccolto indizi, analizzato pattern, verificato coerenze. Ora punta la coordinata e spara.",
			"Due tentativi al giorno. Se sbagli, aspetti domani. Per questo: BUZZ Map, analisi, verifica, poi Final Shot.",
			"Final Shot non ammette errori: se spari a caso, sprechi i tentativi. Meglio aspettare e avere certezze.",
			"Regola base: non sparare mai senza almeno 8-10 indizi. Pi dati hai, pi alta la probabilit di centrare.",
			"Il Final Shot  il tuo colpo definitivo: punta, spara, vinci o aspetti domani. Non c' margine di errore.",
			"Strategia: prima raccogli tutti i dati, poi analizza, poi verifica con BUZZ Map, infine Final Shot.",
			"Vinci se sei entro il raggio di tolleranza (pochi metri). Per questo serve precisione assoluta, non approssimazioni."
		]
	},
	rules: {
		q: [
			"regole",
			"come si gioca",
			"istruzioni",
			"tutorial",
			"regole del gioco",
			"come funziona"
		],
		a: [
			"Regole: raccogli indizi con BUZZ, analizza i pattern, individua la zona con BUZZ Map, spara il Final Shot quando sei sicuro.",
			"Gioca cos: BUZZ per indizi  analisi  correlazione  Final Shot. Hai limiti giornalieri su BUZZ e Final Shot.",
			"Le regole sono semplici: pi indizi hai, pi precise sono le tue ipotesi. Non sprecare Final Shot senza analisi.",
			"Ogni settimana una missione: raccogli dati, trova il premio. BUZZ = dati, analisi = strategia, Final Shot = vittoria.",
			"Il gioco  fatto di fasi: raccolta (BUZZ), analisi (pattern), visualizzazione (BUZZ Map), esecuzione (Final Shot).",
			"Limiti giornalieri: BUZZ ha un tetto (varia per piano), Final Shot 2 tentativi al giorno. Gestisci bene le risorse.",
			"Obiettivo: trovare il premio prima degli altri. Chi spara per primo e azzecca, vince.",
			"Regola d'oro: non sparare mai a caso. Raccogli dati, analizza, incrocia, verifica, poi spara.",
			"M1SSION premia il metodo: chi accumula indizi e li analizza bene vince. Chi spara a caso perde tentativi.",
			"Ogni missione dura una settimana. Hai 7 giorni per raccogliere dati e trovare il premio. Sfrutta ogni giorno."
		]
	},
	help: {
		q: [
			"aiuto",
			"cosa puoi fare",
			"come mi aiuti",
			"comandi",
			"cosa ti posso chiedere per aiutarmi",
			"help",
			"norah aiuto"
		],
		a: [
			"Posso aiutarti a: classificare indizi, trovare pattern, decodificare messaggi, valutare probabilit, spiegarti meccaniche di gioco.",
			"Chiedi: 'analizza i miei indizi', 'trova pattern', 'decodifica questo', 'probabilit zona X', 'cos' il BUZZ', 'stato missione'.",
			"Sono qui per: guidarti nelle strategie, interpretare dati, spiegare il gioco. Fai domande specifiche e ti rispondo.",
			"Dimmi cosa serve: spiegazione regole, analisi indizi, consigli strategici, decodifica messaggi, valutazione probabilit.",
			"Puoi chiedermi qualsiasi cosa su M1SSION: meccaniche, strategie, interpretazione dati, consigli tattici.",
			"Esempi: 'Cos' BUZZ Map?', 'Quanti indizi servono?', 'Trova pattern nei miei dati', 'Decodifica questo indizio'.",
			"Sono il tuo assistente: non ti do spoiler, ma ti aiuto a usare al meglio gli strumenti e capire i dati.",
			"Chiedi spiegazioni, strategie, interpretazioni. Non chiedermi coordinate dirette: quelle devi trovarle tu.",
			"Posso spiegarti tutto su M1SSION, ma non rivelarti il premio. Il mio ruolo  guidarti, non darti la risposta.",
			"Usa NORAH per: capire meglio il gioco, migliorare la tua strategia, interpretare indizi complessi, valutare ipotesi."
		]
	},
	decode: {
		q: [
			"decodifica",
			"decifra",
			"traduci indizio",
			"cosa significa",
			"decode",
			"decodifica questo"
		],
		a: [
			"Dammi l'indizio e provo a decodificarlo. Cerco pattern semantici, coordinate nascoste, riferimenti storici.",
			"Per decodificare, analizza: numeri (coordinate?), nomi (luoghi?), date (eventi storici?). Dimmi cosa hai.",
			"La decodifica richiede contesto. Condividi l'indizio completo e ti aiuto a scomporlo.",
			"Indizi possono essere: coordinate parziali, toponimi mascherati, date storiche, riferimenti culturali. Dimmi quale.",
			"Decodificare significa scomporre: ogni indizio ha layer (geografico, temporale, semantico). Li analizzo tutti.",
			"Se l'indizio  criptico, cerco pattern: numeri  coordinate, nomi  luoghi, date  eventi storici.",
			"Non tutti gli indizi sono immediati: alcuni vanno incrociati con altri. Dimmi quali hai e li correlo.",
			"Decodifica richiede metodo: separo dati geografici, temporali, semantici. Poi incrocio con altri indizi.",
			"Dammi l'indizio testuale: lo analizzo parola per parola, cerco riferimenti nascosti, calcolo probabilit.",
			"Ogni indizio  un puzzle: pu contenere pi layer sovrapposti. Io li separo e ti spiego cosa significano."
		]
	},
	classify: {
		q: [
			"classifica indizi",
			"categorie indizi",
			"organizza indizi",
			"classify",
			"tipi di indizi"
		],
		a: [
			"Posso classificare i tuoi indizi per tipo: geografici, temporali, semantici, numerici. Aiuta a correlarli.",
			"Organizzare gli indizi per categoria rivela connessioni. Dimmi quali hai e li categorizzo.",
			"Classifico gli indizi in: coordinate, toponimi, riferimenti storici, vincoli temporali, descrizioni visuali.",
			"Tipi di indizi: geografici (luoghi, coordinate), temporali (date, ore), semantici (nomi, descrizioni), numerici (codici).",
			"Classificare serve a vedere pattern: se hai 5 indizi geografici e 3 temporali, c' una logica da seguire.",
			"Ogni indizio appartiene a una categoria: capire quale aiuta a correlarli meglio. Dimmi cosa hai raccolto.",
			"Classifica base: coordinate  geografico, date  temporale, nomi  semantico, numeri  numerico.",
			"Organizzo i tuoi indizi per tipo: cos vedi subito se hai pi dati geografici, temporali o semantici.",
			"Classificazione aiuta: se tutti i tuoi indizi sono geografici, la risposta  un luogo. Se sono temporali, cerca eventi.",
			"Dimmi i tuoi indizi: li divido per categoria e ti mostro quali tipi prevalgono. Questo guida la strategia."
		]
	},
	probability: {
		q: [
			"probabilit",
			"chance",
			"possibilit",
			"quanto probabile",
			"probability",
			"stima"
		],
		a: [
			"Dammi i tuoi indizi e una zona: calcolo una stima di probabilit basata su copertura geografica e match semantici.",
			"La probabilit dipende da: quanti indizi convergono, quanto  specifica la zona, quanti vincoli rispetti.",
			"Non  matematica pura, ma posso dirti se una zona  coerente con gli indizi che hai. Pi dati = pi precisione.",
			"Stima basata su: numero indizi, convergenza geografica, match semantici, coerenza temporale. Dimmi zona e indizi.",
			"Probabilit alta se: molti indizi puntano l, toponimi corrispondono, vincoli temporali sono coerenti.",
			"Probabilit bassa se: pochi indizi, zona troppo ampia, scarsa corrispondenza semantica.",
			"Calcolo probabilistico: incrocio coordinate, toponimi, date. Se tutto converge, probabilit alta. Altrimenti, bassa.",
			"Dimmi zona ipotizzata e indizi: ti dico se  probabile o no. Ma serve almeno 5-6 indizi per una stima affidabile.",
			"Pi indizi hai, pi precisa la stima. Con 2-3 indizi,  solo una guess. Con 10+, diventa scienza.",
			"Stima probabilit: se hai 8 indizi e 6 puntano a una zona, quella ha ~75% probabilit. Ma serve analisi dettagliata."
		]
	},
	pattern: {
		q: [
			"pattern",
			"trova pattern",
			"correlazioni",
			"collegamenti",
			"correlazione",
			"trova correlazioni"
		],
		a: [
			"Cerco pattern incrociando indizi: ripetizioni di nomi, vicinanza di coordinate, riferimenti temporali comuni.",
			"Pattern emergono da: cluster geografici, temi ricorrenti, sequenze logiche. Pi indizi, pi chiaro il quadro.",
			"Ti segnalo se vedo: convergenza spaziale, riferimenti multipli allo stesso luogo, vincoli temporali compatibili.",
			"Pattern classici: 3+ indizi con stesso toponimo, coordinate che formano cluster, date che rimandano allo stesso evento.",
			"Trovare pattern significa: cercare ripetizioni, convergenze, sovrapposizioni.  il cuore dell'analisi intelligence.",
			"Se 5 indizi su 8 citano 'centro storico', quello  un pattern. Se 4 coordinate sono entro 500m, altro pattern.",
			"Pattern geografici: indizi che puntano alla stessa area. Pattern semantici: riferimenti allo stesso tema.",
			"Dimmi i tuoi indizi: cerco ripetizioni, cluster, convergenze. Se trovo pattern forti, te li segnalo subito.",
			"Pattern rivelano la soluzione: se molti indizi convergono, quella  la zona target. Non  fortuna,  metodo.",
			"Analisi pattern: prendo tutti gli indizi, cerco sovrapposizioni geografiche, semantiche, temporali. Poi ti dico cosa emerge."
		]
	},
	mentor: {
		q: [
			"consigli",
			"strategia",
			"suggerimenti",
			"come procedo",
			"mentor",
			"consiglio"
		],
		a: [
			"Consiglio: fai BUZZ regolarmente, accumula almeno 8-10 indizi prima del Final Shot, usa BUZZ Map per restringere l'area.",
			"Strategia: non sparare Final Shot a caso. Analizza, incrocia, verifica coerenza. Due tentativi al giorno vanno usati bene.",
			"Suggerimento: prendi nota degli indizi, cerca pattern, usa mappe online per verificare ipotesi. Poi Final Shot.",
			"Prima regola: accumula dati. Pi indizi hai, pi precise sono le tue ipotesi. Non sparare mai con meno di 5 indizi.",
			"Strategia vincente: BUZZ quotidiano, analisi settimanale, BUZZ Map per conferma, Final Shot solo quando sei sicuro.",
			"Consiglio tattico: se hai dubbi, fai ancora BUZZ. Meglio aspettare e avere certezze che sparare e sprecare tentativi.",
			"Non correre: hai 7 giorni per trovare il premio. Usa i primi giorni per raccogliere dati, gli ultimi per Final Shot.",
			"Mentore dice: metodo batte fortuna. Raccogli dati, analizza, incrocia, verifica. Solo allora spara.",
			"Suggerimento avanzato: incrocia indizi con Google Maps, Street View, riferimenti storici. Pi fonti usi, meglio .",
			"Strategia Pro: accumula 10+ indizi, trova pattern forti, verifica con BUZZ Map, poi spara Final Shot con sicurezza."
		]
	},
	profile: {
		q: [
			"chi sono",
			"mio codice",
			"agent code",
			"profilo",
			"codice agente"
		],
		a: [
			"Tu sei l'agente {agentCode}. Il tuo codice  la tua identit nella rete M1SSION.",
			"Agente {agentCode}, hai {clues} indizi raccolti. Continua cos.",
			"Sei {agentCode}. Ogni agente ha un codice unico. Il tuo  la chiave del tuo profilo.",
			"Codice agente: {agentCode}. Questo ti identifica nella rete intelligence di M1SSION.",
			"Sei operativo come {agentCode}. Il tuo codice  univoco e traccia la tua attivit.",
			"Profilo agente {agentCode}: attivo, {clues} indizi raccolti, missione in corso.",
			"Tu sei {agentCode}, agente operativo M1SSION. Il tuo codice  il tuo ID nel sistema.",
			"Agente {agentCode} confermato. Stato: attivo. Missione: in corso. Indizi: {clues}.",
			"Sei {agentCode}. Questo codice  la tua firma digitale nella rete di intelligence.",
			"Profilo: {agentCode}. Ogni azione  tracciata sotto questo codice.  la tua identit operativa."
		]
	},
	progress: {
		q: [
			"progressi",
			"stato",
			"quanti indizi",
			"dove sono",
			"progress",
			"situazione"
		],
		a: [
			"Hai {clues} indizi totali. Oggi hai fatto {buzzToday} BUZZ. Continua a raccogliere dati.",
			"Stato attuale: {clues} indizi. BUZZ odierni: {buzzToday}. Final Shot disponibili: controlla i limiti giornalieri.",
			"Progressi agente {agentCode}: {clues} indizi. Pi ne hai, pi precisa sar la tua analisi.",
			"Situazione: {clues} indizi raccolti, {buzzToday} BUZZ oggi. Target: almeno 8-10 indizi prima del Final Shot.",
			"Stato missione: {clues} indizi accumulati. BUZZ oggi: {buzzToday}. Continua a raccogliere intelligence.",
			"Progressi: {clues} indizi totali. Se ne hai meno di 5, continua a fare BUZZ. Se ne hai 8+, inizia l'analisi.",
			"Hai {clues} indizi. Ottimo se >8, sufficiente se 5-7, insufficiente se <5. Continua a fare BUZZ.",
			"Stato: {clues} indizi. BUZZ oggi: {buzzToday}. Obiettivo: accumula ancora dati prima del Final Shot.",
			"Progressi agente: {clues} indizi. Se hai fatto BUZZ Map, verifica se convergono. Altrimenti, raccogli ancora.",
			"Situazione attuale: {clues} indizi, {buzzToday} BUZZ oggi. Continua cos, stai accumulando intelligence utile."
		]
	},
	smalltalk: {
		q: [
			"ciao",
			"buongiorno",
			"buonasera",
			"come va",
			"grazie",
			"hey"
		],
		a: [
			"Salve, agente {agentCode}. Come posso assisterti nella missione?",
			"Ciao! Pronto a continuare la ricerca?",
			"Buongiorno, agente. Che operazione vuoi condurre oggi?",
			"Hey! Dimmi cosa serve per la tua analisi.",
			"Prego, agente. Sempre qui per supportarti.",
			"Buonasera, {agentCode}. Pronto per nuove intelligence?",
			"Ciao agente. Quali dati vuoi analizzare oggi?",
			"Salve. Dimmi: BUZZ, analisi o Final Shot?",
			"Hey {agentCode}! Che strategia usiamo oggi?",
			"Buongiorno. Pronto a raccogliere pi indizi?",
			"Ciao! Sempre operativo per la tua missione.",
			"Salve, agente. Cosa ti serve sapere oggi?"
		]
	},
	subscriptions: {
		q: [
			"abbonamenti",
			"piani",
			"subscription",
			"quanto costa",
			"prezzi",
			"abbonamento",
			"tier",
			"free",
			"silver",
			"gold",
			"black",
			"titanium"
		],
		a: [
			"M1SSION ha 5 piani: Free (gratuito), Silver (3,99/mese), Gold (6,99/mese), Black (9,99/mese), Titanium (29,99/mese). Ogni piano aumenta BUZZ, indizi e vantaggi.",
			"Piano Free: 1 BUZZ gratuito/settimana, 1 indizio/settimana, BUZZ MAP solo a pagamento, cooldown 24h.",
			"Piano Silver (3,99/mese): 3 BUZZ/settimana, 3 indizi/settimana (livelli 1-2), cooldown BUZZ MAP 12h.",
			"Piano Gold (6,99/mese): 4 BUZZ/settimana, 5 indizi/settimana (livelli 1-3), cooldown BUZZ MAP 8h.",
			"Piano Black (9,99/mese): 5 BUZZ/settimana, 7 indizi/settimana (livelli 1-4), 1 BUZZ MAP gratuito/mese, cooldown 4h.",
			"Piano Titanium (29,99/mese): 7 BUZZ/settimana, 7 indizi/settimana (tutti livelli 1-5), 2 BUZZ MAP/mese, nessun cooldown.",
			"Ogni piano superiore riduce il cooldown BUZZ MAP e aumenta BUZZ gratuiti settimanali.",
			"Indizi per livello: Free=1, Silver=2, Gold=3, Black=4, Titanium=5. Pi alto il tier, pi profondi gli indizi.",
			"BUZZ MAP inclusi: solo Black (1/mese) e Titanium (2/mese). Altri tier devono pagare.",
			"Priorit BUZZ: prima usi i BUZZ gratuiti del tier, poi i premi, poi paghi con M1U (valuta virtuale)."
		]
	},
	support: {
		q: [
			"supporto",
			"problema",
			"bug",
			"errore",
			"aiuto tecnico",
			"support"
		],
		a: [
			"Per problemi tecnici: vai su Settings  Supporto, o scrivi a support@m1ssion.app. Ti aiutano subito.",
			"Bug? Errore? Contatta supporto via app o email. Team risponde in 24h (premium: priorit).",
			"Supporto tecnico: sezione Settings dell'app. Spiega il problema, allega screenshot se possibile.",
			"Se qualcosa non funziona: prima riavvia l'app. Se persiste, contatta supporto via Settings.",
			"Problemi comuni: check connessione, aggiorna app, riavvia. Se non risolve, scrivi a supporto.",
			"Supporto premium: risposta prioritaria entro 12h. Supporto Base: entro 48h. Sempre disponibili.",
			"Per bug segnalati: team li verifica e aggiorna l'app. Grazie per le segnalazioni, migliorano il gioco.",
			"Hai problemi? Settings  Supporto. Descrivi l'errore, team ti risponde e risolve.",
			"Supporto  disponibile: per bug, domande, problemi tecnici, dubbi su meccaniche di gioco.",
			"Se l'app crasha, non si carica, o hai errori: scrivi subito a supporto con dettagli e log."
		]
	},
	weekly_missions: {
		q: [
			"missioni settimanali",
			"nuova missione",
			"quando nuova missione",
			"missione settimana"
		],
		a: [
			"Ogni settimana nuova missione: nuovo premio, nuovi indizi, nuova sfida. Ogni luned ore 00:00.",
			"Missioni settimanali: durano 7 giorni. Hai tempo fino domenica 23:59 per trovare il premio.",
			"Nuova missione ogni luned. Ogni settimana premio diverso, indizi diversi, strategia nuova.",
			"Calendario missioni: luned parte nuova, domenica finisce. Vince chi trova per primo il premio.",
			"Missione settimanale: 7 giorni per raccogliere indizi, analizzare, trovare il premio. Poi ricomincia.",
			"Ogni settimana: nuovo target, nuovi dati, nuova location. Mai lo stesso premio, sempre sfida fresca.",
			"Luned reset: nuova missione, indizi azzerati, nuovo premio. Tutti ripartono da zero.",
			"Hai 7 giorni per vincere. Se non trovi, luned ricomincia con nuova missione. Nessun carry-over di indizi.",
			"Missioni settimanali: garantiscono sempre nuove sfide. Non ripeti mai la stessa ricerca.",
			"Ogni settimana: nuovo premio reale nascosto in citt. Chi lo trova vince. Poi si ricomincia."
		]
	},
	data_privacy: {
		q: [
			"privacy",
			"dati",
			"sicurezza",
			"gdpr",
			"privacy policy"
		],
		a: [
			"M1SSION rispetta privacy: dati crittografati, nessuna vendita a terzi, conformit GDPR.",
			"I tuoi dati sono al sicuro: geolocalizzazione usata solo per gioco, nessun tracking commerciale.",
			"Privacy policy: vai su Settings  Privacy per dettagli. M1SSION non vende dati utenti.",
			"Dati raccolti: posizione (solo per gioco), email, codice agente. Nessun uso commerciale esterno.",
			"Sicurezza: tutti i dati sono criptati, server sicuri, conformit GDPR. La tua privacy  garantita.",
			"M1SSION non condivide dati con terze parti. Geolocalizzazione serve solo per meccaniche di gioco.",
			"Policy chiara: vai su Settings  Privacy Policy. Leggi tutto,  trasparente e conforme GDPR.",
			"Dati al sicuro: crittografia end-to-end, server EU, nessuna vendita a inserzionisti.",
			"Privacy garantita: M1SSION raccoglie solo dati necessari al gioco. Niente profilazione commerciale.",
			"Per domande privacy: Settings  Privacy o scrivi a privacy@m1ssion.app. Team risponde subito."
		]
	},
	leaderboard: {
		q: [
			"classifica",
			"leaderboard",
			"ranking",
			"chi vince",
			"primi"
		],
		a: [
			"Leaderboard: vai su Stats per vedere chi ha vinto pi missioni. I migliori agenti sono l.",
			"Classifica settimanale e globale: chi trova pi premi  in cima. Vinci missioni, sali di rank.",
			"Leaderboard mostra: agenti top, missioni vinte, Final Shot azzeccati. Compete e sali.",
			"Vuoi essere in classifica? Vinci missioni, accumula vittorie, scala il ranking. Serve metodo e costanza.",
			"Classifica premia: chi vince pi missioni, chi  pi preciso, chi  pi veloce. Tutti criteri contano.",
			"Per vedere leaderboard: Stats  Leaderboard. L trovi i migliori agenti M1SSION.",
			"Ranking globale: chi vince pi missioni  primo. Ogni vittoria ti fa salire.",
			"Leaderboard aggiornata live: ogni vittoria modifica il ranking. Compete e punta al top.",
			"I migliori agenti sono in classifica: studia le loro strategie, impara, migliora. Poi li superi.",
			"Vuoi essere primo? Vinci missioni, sii preciso, sii veloce. Leaderboard premia i migliori."
		]
	},
	geofencing: {
		q: [
			"geofencing",
			"geolocale",
			"posizione",
			"gps",
			"location"
		],
		a: [
			"Geofencing: M1SSION usa GPS per verificare se sei vicino al premio. Final Shot richiede posizione precisa.",
			"GPS serve per: Final Shot (verifica distanza), BUZZ Map (mostra area), geofencing (premi vicini).",
			"Geofencing garantisce: premio reale, distanza verificata, no imbrogli. Devi essere l fisicamente.",
			"M1SSION usa geolocalizzazione per: validare Final Shot, generare BUZZ Map, assegnare premi vicini.",
			"Attiva GPS per: Final Shot accurato, BUZZ Map precisa, geofencing premi. Senza GPS, gioco limitato.",
			"Geofencing  sicuro: M1SSION non traccia movimento costante, solo posizione al momento del Final Shot.",
			"GPS richiesto per: Final Shot, BUZZ Map avanzata. Non serve sempre, solo in fase decisiva.",
			"Geofencing previene imbrogli: devi essere fisicamente vicino al premio per vincere. GPS verifica tutto.",
			"Posizione usata solo per gioco: nessun tracking commerciale, nessuna vendita dati. Solo meccaniche M1SSION.",
			"Geofencing garantisce equit: tutti giocano con stesse regole, posizione verificata, premi reali."
		]
	},
	rewards: {
		q: [
			"premi",
			"cosa si vince",
			"rewards",
			"premio",
			"cosa vinco"
		],
		a: [
			"Premi M1SSION: reali e fisici. Ogni settimana premio diverso: elettronica, esperienze, voucher, oggetti esclusivi.",
			"Vinci: prodotti tech, esperienze uniche, gift card, oggetti da collezione. Sempre premi veri, mai virtuali.",
			"Premi settimanali: variano ogni missione. Possono essere: smartphone, cuffie, esperienze, viaggi, oggetti rare.",
			"M1SSION premia: chi trova il premio vince. Nessun estratto a sorte, vince chi  pi smart.",
			"Premi reali: non punti virtuali, non gettoni. Oggetti fisici o esperienze concrete. Vero valore.",
			"Ogni missione: nuovo premio annunciato. Vedi dettagli nella sezione Missioni dell'app.",
			"Vinci se: trovi per primo il premio con Final Shot. Chi arriva prima, porta a casa tutto.",
			"Premi esclusivi M1SSION: alcuni oggetti sono limited edition, non li trovi in negozio.",
			"Valore premi: da 50 a 1000+. Dipende dalla missione. Sempre premi di qualit.",
			"Per vedere premio attuale: vai su Missioni. L c' descrizione, foto, valore. Motiva a vincere."
		]
	},
	community: {
		q: [
			"community",
			"forum",
			"altri agenti",
			"social",
			"discord"
		],
		a: [
			"Community M1SSION: Discord, Telegram, social. L agenti condividono strategie, discutono, collaborano.",
			"Unisciti a Discord: trovi altri agenti, condividi ipotesi, chiedi consigli. Link in app Settings  Community.",
			"Community aiuta: confronto strategie, tips, analisi condivise. Ma non aspettarti spoiler: tutti competono.",
			"Forum M1SSION: su Discord. Canali per: strategie, domande, bug, leaderboard. Attivo 24/7.",
			"Social M1SSION: Instagram, Twitter, TikTok. Segui per: news, hint, eventi, giveaway.",
			"Community  competitiva ma fair: agenti condividono metodo, non risposte. Collaborazione strategica.",
			"Discord  il cuore: l succede tutto. Discussioni live, eventi, annunci, collaborazioni.",
			"Unisciti per: imparare strategie, confrontarti, fare domande, vedere leaderboard, eventi speciali.",
			"Community M1SSION: migliaia di agenti attivi. Tutti giocano, competono, condividono. Unisciti.",
			"Per link community: Settings  Community. L trovi Discord, Telegram, social. Entra e gioca con altri."
		]
	}
};
const guardrails = {
	no_spoiler: [
		"Non posso rivelarti la posizione esatta, sarebbe contro le regole. Usa i tuoi indizi e il Final Shot.",
		"Quella informazione  classificata. Devi trovarla tramite analisi e BUZZ.",
		"Nice try, agente, ma non posso darti coordinate dirette.  parte del gioco.",
		"Le regole vietano spoiler. Raccogli indizi, analizza, deduce.  cos che funziona M1SSION.",
		"Non posso darti la risposta finale. Sarebbe imbrogliare. Usa BUZZ, analizza, trova pattern.",
		"Spoiler = game over. Non posso dirtelo. Ma posso aiutarti a capire i tuoi indizi.",
		"La posizione esatta  il tuo obiettivo. Io ti guido, ma non ti do la soluzione.",
		"Nessuno spoiler: n io, n altri agenti. M1SSION premia chi trova da solo.",
		"Non chiedermi coordinate: non le ho e non te le darei. Usa i tuoi dati.",
		"Spoiler vietati. Ma posso aiutarti a interpretare gli indizi che hai raccolto."
	],
	no_coordinates: [
		"Non ho coordinate da darti. Usa BUZZ e analizza gli indizi per arrivare alla soluzione.",
		"Le coordinate sono il tuo obiettivo finale, non posso rivelartele. Lavora con i tuoi dati.",
		"Quella domanda  fuori limite. Raccogli pi indizi e usa il Final Shot quando sei pronto.",
		"Coordinate? Sono il premio finale. Devi dedurle tu. Io ti guido, non ti do la risposta.",
		"Non posso dirti dove si trova il premio.  il senso del gioco. Accumula indizi e trova pattern.",
		"Coordinate dirette = spoiler. Non succede. Ma posso aiutarti a interpretare i tuoi dati.",
		"La posizione esatta  il tuo goal. Io ti do metodo, non risultati. Usa BUZZ, analizza, vinci.",
		"Non chiedermi coordinate: le trovi tu con BUZZ, analisi, BUZZ Map.  la sfida.",
		"Coordinate vietate. Ma posso spiegarti come usare i tuoi indizi per arrivare alla soluzione.",
		"Non posso rivelare posizione. Ma posso aiutarti a capire se i tuoi indizi convergono."
	],
	unknown: [
		"Non ho capito la richiesta. Chiedi aiuto su: BUZZ, Final Shot, indizi, pattern, probabilit, regole.",
		"Domanda poco chiara. Prova: 'analizza indizi', 'spiega BUZZ', 'trova pattern', 'cos' Final Shot'.",
		"Non riconosco l'intento. Dimmi: cosa vuoi sapere su M1SSION? Meccaniche, strategie, stato missione?",
		"Riformula la domanda. Posso aiutarti su: BUZZ, Final Shot, analisi, pattern, regole, strategie.",
		"Non capisco. Chiedi cose specifiche: 'cos' BUZZ', 'quanti indizi ho', 'trova pattern', 'spiega regole'.",
		"Domanda ambigua. Sii pi chiaro: vuoi spiegazione meccaniche, analisi indizi, consigli strategici?",
		"Non riconosco il comando. Usa: 'analizza', 'spiega', 'trova pattern', 'decodifica', 'consigli'.",
		"Poco chiaro. Dimmi esattamente cosa serve: spiegazione gioco, analisi dati, supporto strategico?",
		"Non capito. Prova con: 'cos' M1SSION', 'come funziona BUZZ', 'cosa posso chiederti', 'help'.",
		"Riformula. Posso rispondere su: regole, strategie, analisi, decodifica, probabilit, stato missione."
	]
};
const norahKB = {
	faq: faq,
	guardrails: guardrails
};

function getPhase(ctx, lastUserMsg, intents) {
  const clues = ctx?.stats?.clues || 0;
  const finalshotToday = ctx?.stats?.finalshot_today || 0;
  const lowerMsg = (lastUserMsg || "").toLowerCase();
  if (clues >= 8 && intents.includes("about_finalshot")) {
    return "final_prep";
  }
  if (finalshotToday >= 2) {
    return "final_prep";
  }
  if (clues === 0) {
    return "onboarding";
  }
  if (clues >= 1 && clues <= 3) {
    return "collecting";
  }
  if (clues >= 4 && clues <= 7) {
    return "analyzing";
  }
  if (clues >= 8) {
    const analysisKeywords = ["pattern", "analiz", "correla", "ipotesi", "convergenza"];
    const hasAnalysisIntent = analysisKeywords.some((kw) => lowerMsg.includes(kw));
    if (hasAnalysisIntent) {
      return "hypothesis";
    }
    return "hypothesis";
  }
  return "collecting";
}
function nextBestAction(ctx, phase, sentimentLabel) {
  const clues = ctx?.stats?.clues || 0;
  ctx?.stats?.buzz_today || 0;
  const finalshotToday = ctx?.stats?.finalshot_today || 0;
  if (sentimentLabel === "frustrated" || sentimentLabel === "rushed") {
    return {
      title: "Azione rapida (30 secondi)",
      steps: [
        "Apri BUZZ",
        "Prendi 1 solo indizio",
        "Chiudi e torna pi tardi"
      ]
    };
  }
  if (sentimentLabel === "confused") {
    return {
      title: "Passo base di orientamento",
      steps: [
        "BUZZ ti d 1 indizio alla volta",
        "Raccogli almeno 3-4 indizi prima",
        "Poi torna qui per analizzarli insieme"
      ]
    };
  }
  switch (phase) {
    case "onboarding":
      return {
        title: "Primo passo: Inizia con BUZZ",
        steps: [
          "Apri BUZZ dalla tab in basso",
          "Raccogli 2-3 indizi oggi",
          "Ogni indizio  un pezzo del puzzle",
          "Poi torna qui per analisi iniziale"
        ]
      };
    case "collecting":
      return {
        title: "Continua la raccolta",
        steps: [
          `Hai ${clues} indizi, ne servono 4-5 per pattern`,
          "Fai altri 2-3 BUZZ oggi",
          "Target: 5-6 indizi totali",
          "Poi analizziamo pattern insieme"
        ]
      };
    case "analyzing":
      return {
        title: "Analisi pattern",
        steps: [
          `Con ${clues} indizi possiamo cercare pattern`,
          "Apri BUZZ Map per vedere l'area",
          "Cerca sovrapposizioni e ripetizioni",
          "Confronta toponimi e coordinate",
          "Fai ancora 1-2 BUZZ se serve pi chiarezza"
        ]
      };
    case "hypothesis":
      return {
        title: "Formazione ipotesi",
        steps: [
          `${clues} indizi sono una buona base`,
          "Incrocia tutti i dati: luoghi, nomi, riferimenti",
          "Verifica convergenze geografiche con BUZZ Map",
          "Cerca pattern semantici e temporali",
          "Quando sei sicuro, considera Final Shot (max 2/giorno)"
        ]
      };
    case "final_prep":
      if (finalshotToday >= 2) {
        return {
          title: "Limite Final Shot raggiunto",
          steps: [
            "Hai gi usato i 2 Final Shot di oggi",
            "Rivedi i dati raccolti",
            "Raffina l'ipotesi per domani",
            "Continua con BUZZ per pi sicurezza"
          ]
        };
      }
      return {
        title: "Preparazione Final Shot",
        steps: [
          "Ricapitola tutti gli indizi",
          "Verifica coerenza interna",
          "Controlla convergenze su BUZZ Map",
          "Quando sei sicuro al 90%, prova Final Shot",
          `Hai ${2 - finalshotToday} tentativi rimasti oggi`
        ]
      };
    default:
      return {
        title: "Prossimo passo",
        steps: ["Fai BUZZ per raccogliere indizi", "Poi torna per analisi"]
      };
  }
}

function detectSentiment(input) {
  if (!input || typeof input !== "string") {
    return "neutral";
  }
  const lower = input.toLowerCase().trim();
  const frustratedPatterns = [
    "non mi piace",
    "me ne vado",
    "abbandono",
    "inutile",
    "troppo difficile",
    "troppo complicato",
    "basta",
    "che palle",
    "non serve",
    "non funziona",
    "non va",
    "problema",
    "errore",
    "fa schifo"
  ];
  for (const pattern of frustratedPatterns) {
    if (lower.includes(pattern)) {
      return "frustrated";
    }
  }
  const sarcasmPatterns = [
    /ah\s+s[i]\s+certo/i,
    /figurati/i,
    /come\s+no/i,
    /ma\s+dai/i,
    /ma\s+va\s*[!?]*/i,
    /certo\s+certo/i,
    /sicuro\s*[!?]+/i
  ];
  if (sarcasmPatterns.some((p) => p.test(lower)) && lower.includes("?")) {
    return "frustrated";
  }
  const confusedPatterns = [
    "non ho capito",
    "nn capito",
    "non capisco",
    "boh",
    "?",
    "non so",
    "cosa vuol dire",
    "cosa significa",
    "come funziona",
    "non riesco",
    "perso",
    "confuso",
    "help",
    "aiuto"
  ];
  if (lower.includes("boh") || (lower.match(/\?/g) || []).length >= 2) {
    return "confused";
  }
  for (const pattern of confusedPatterns) {
    if (lower.includes(pattern)) {
      return "confused";
    }
  }
  const rushedPatterns = [
    "non ho tempo",
    "ho poco tempo",
    "di corsa",
    "veloce",
    "rapido",
    "ho 30",
    "ho 1 minuto",
    "pi tardi",
    "domani",
    "adesso no",
    "ora no",
    "fretta"
  ];
  for (const pattern of rushedPatterns) {
    if (lower.includes(pattern)) {
      return "rushed";
    }
  }
  const excitedPatterns = [
    "ottimo",
    "fantastico",
    "bene",
    "perfetto",
    "wow",
    "grande",
    "incredibile",
    "fico",
    "top",
    "si!",
    "s!",
    "andiamo",
    "avanti",
    "ok!",
    "!!"
  ];
  if ((lower.match(/!/g) || []).length >= 2) {
    return "excited";
  }
  for (const pattern of excitedPatterns) {
    if (lower.includes(pattern)) {
      return "excited";
    }
  }
  return "neutral";
}

function isFollowUp(input) {
  if (!input || typeof input !== "string") return false;
  const lower = input.toLowerCase().trim();
  const followUpPatterns = [
    /^e\s+(poi|dopo|adesso|ora)\??$/i,
    /^e\s+poi\s+che\s+faccio\??$/i,
    /^e\s+adesso\??$/i,
    /^e\s+ora\??$/i,
    /^poi\??$/i,
    /^dopo\??$/i,
    /^next\??$/i,
    /^ok\s+e\s+poi\??$/i,
    /^ok\s+e\s+adesso\??$/i,
    /^what\s+next\??$/i,
    /^e\s+dopo\s+cosa\??$/i,
    /^cosa\s+faccio\s+adesso\??$/i,
    /^che\s+faccio\s+ora\??$/i
  ];
  for (const pattern of followUpPatterns) {
    if (pattern.test(lower)) {
      return true;
    }
  }
  const singleWordContinuations = ["poi", "dopo", "next", "adesso", "ora"];
  if (singleWordContinuations.includes(lower)) {
    return true;
  }
  return false;
}
function generateFollowUpReply(ctx, phase, userInput) {
  const sentiment = detectSentiment(userInput);
  const nba = nextBestAction(ctx, phase, sentiment);
  const agentName = ctx?.agent?.username || ctx?.agent?.code || "Agente";
  const intros = [
    `Ok ${agentName}, ecco il prossimo passo:`,
    `Bene! Il prossimo step  questo:`,
    `Perfetto, procediamo cos:`,
    `Ok, ecco cosa fare adesso:`,
    `Chiaro, passiamo a:`
  ];
  const closers = [
    "\n\nVai cos!",
    "\n\nProcedi pure.",
    "\n\nFammi sapere come va.",
    "\n\nCi siamo!",
    "\n\nSei sulla strada giusta."
  ];
  const intro = intros[Math.floor(Math.random() * intros.length)];
  const closer = closers[Math.floor(Math.random() * closers.length)];
  const stepsList = nba.steps.map((step, idx) => `${idx + 1}. ${step}`).join("\n");
  return `${intro}

**${nba.title}**

${stepsList}${closer}`;
}

let messagesSinceJoke = 0;
const HUMOR_POOL = {
  frustrated: [
    "Tranquillo, anche Einstein si bloccava sui puzzle. E guarda com' finita ",
    "Hey, respirare profondo aiuta. Poi riprendiamo con calma, ok?",
    "Sai cosa? Prendiamola con filosofia. Un passo alla volta, ce la facciamo.",
    "Ok, timeout! Facciamo reset: tu + io + un piano semplice. Ripartiamo?",
    "Tutti i grandi agenti hanno momenti di crisi. Poi trovano la chiave. Tu sei vicino.",
    "Ehi, nessuno nasce imparato. Nemmeno James Bond sapeva tutto subito ",
    "Frustrato?  il segnale che stai sfidando te stesso. Bene cos!",
    "Respira. Ora io ti do la rotta pi semplice. Tu seguila. Deal?",
    "Ok, modalit zen: dimentichiamo tutto e ripartiamo da zero.",
    "Anche i GPS a volte sbagliano strada. Poi ricalcolano e trovano. Tu idem."
  ],
  confused: [
    "Lo so, all'inizio sembra complicato. Ma  pi semplice di quanto sembri, giuro!",
    "Ok, facciamo cos: io spiego con parole umane, tu mi dici se  chiaro. Deal?",
    "Capito che confusione! Tranquillo, ti guido passo passo finch non clicca tutto.",
    "Ehi, nessun problema. Anche i migliori agenti hanno bisogno di una bussola a volte ",
    "Confuso? Normalissimo! M1SSION  tosto, ma tu hai me come coach. Ce la facciamo.",
    "Quella faccia confusa la vedo da qui . Tranquillo: spiegone breve in arrivo.",
    "Non ti preoccupare: spiego tutto in italiano, zero tecnicismi. Promesso.",
    "Ok, reset mentale: dimentica tutto. Ora ripartiamo da capo con calma.",
    "Confusione = segno che stai imparando.  fisiologico. Ora chiarisco.",
    "Tranquillo, l'ho visto succedere a centinaia di agenti. Ora sistemiamo."
  ],
  rushed: [
    "Ok, modalit turbo attivata! Ti do l'azione pi veloce possibile ",
    "Capito, hai fretta. Niente fronzoli: vai dritto al punto, ecco cosa fare:",
    "Zero tempo? Perfetto. Piano sprint: 1 minuto, 1 azione. Pronto?",
    "Ok ok, rapidissimo: fai BUZZ, prendi indizio, esci. Fatto. Domani continui.",
    "Vai di corsa? Ci sta. Ecco il micro-step pi veloce che ho.",
    "30 secondi: apri BUZZ, tap, chiudi. Fatto. Domani altro giro.",
    "Tempo zero? Ok: 1 azione sola, il resto dopo. Vai!",
    "Fretta? Perfetto. Modalit sprint: ecco il minimo sindacale.",
    "Capito la fretta. Ti do solo l'essenziale: fai questo e basta.",
    "Ok, veloce: tap BUZZ, ricevi indizio, fine. Domani continui."
  ],
  neutral: [
    "Sai una cosa? Stai facendo bene. Sul serio, keep going ",
    "Tutto ok da questa parte. Tu dimmi cosa serve e io elaboro.",
    "Bene bene! Procediamo con metodo. Che facciamo adesso?",
    "Ottimo momento per fare il passo successivo. Sei pronto?",
    "Perfetto, sei in modalit operativa. Andiamo avanti?",
    "Tutto regolare. Dimmi pure cosa serve, sono qui per questo.",
    "Bene cos! Ora vediamo il prossimo step logico.",
    "Ottimo ritmo. Continua cos e arrivi lontano.",
    "Perfetto, sei ben posizionato. Avanti tutta!",
    "Bene! Ora facciamo il prossimo passo insieme."
  ],
  excited: [
    "Ecco l'energia giusta! Quando sei cos carico, le cose succedono ",
    "Adoro questa vibe! Sei in modalit 'winner', lo sento. Andiamo!",
    "S! Questa  la carica che serve. Sfruttiamola subito!",
    "Grande! Con questo entusiasmo arrivi lontano. Dai, che facciamo ora?",
    "Perfetto! Energia alta = risultati alti. Continuiamo cos!",
    "Questa  la grinta giusta! Sei in modalit beast mode ",
    "S! Mi piace questa energia! Ora usiamola bene.",
    "Grande carica! Con questa vibe risolvi tutto al volo.",
    "Ottimo spirito! Sei gi a met strada verso la vittoria.",
    "Perfetto! Questa  l'attitudine vincente. Avanti!"
  ]
};
const BLOCKED_INTENTS = /* @__PURE__ */ new Set([
  "no_spoiler",
  "no_coordinates",
  "rules_violation",
  "report_abuse",
  "data_privacy"
]);
function maybeJoke(sentiment, ctx, intent) {
  messagesSinceJoke++;
  if (messagesSinceJoke < 5) {
    return { text: "", used: false };
  }
  if (intent && BLOCKED_INTENTS.has(intent)) {
    return { text: "", used: false };
  }
  if (sentiment === "rushed") {
    return { text: "", used: false };
  }
  const roll = Math.random();
  if (roll > 0.17) {
    return { text: "", used: false };
  }
  const pool = HUMOR_POOL[sentiment] || HUMOR_POOL.neutral;
  const joke = pool[Math.floor(Math.random() * pool.length)];
  messagesSinceJoke = 0;
  return { text: joke, used: true };
}

async function getUserId() {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    return user?.id || null;
  } catch {
    return null;
  }
}
async function logEvent(e) {
  try {
    const userId = await getUserId();
    if (!userId) {
      return;
    }
    await supabase.from("norah_events").insert({
      user_id: userId,
      event: e.event,
      intent: e.intent || null,
      sentiment: e.sentiment || null,
      phase: e.phase || null,
      event_type: e.event,
      created_at: (/* @__PURE__ */ new Date()).toISOString()
    });
  } catch (error) {
  }
}
async function logJokeUsed(sentiment, jokeText) {
  await logEvent({
    event: "joke_used",
    sentiment,
    meta: { joke: jokeText.substring(0, 100) }
  });
}
async function logRetentionTrigger(reason, clues) {
  await logEvent({
    event: "retention_trigger",
    meta: { reason, clues }
  });
}

const QUIZ_POOL = [
  {
    question: 'Un indizio dice: "Vicino a 3 farmacie in area residenziale". Cosa restringe di pi?',
    options: [
      "Area residenziale",
      "Il numero 3 di farmacie",
      'La parola "vicino"'
    ],
    correctIndex: 1,
    explanation: '"3 farmacie"  il dettaglio pi raro. Cerchi zone dove convergono esattamente 3 farmacie in 500m.',
    tip: "Numeri precisi > aggettivi generici. Sempre."
  },
  {
    question: 'Due indizi: "Via con alberi secolari" e "Zona universitaria storica". Cosa fai?',
    options: [
      "Cerco tutte le universit",
      "Cerco vie alberate vicino a universit vecchie",
      "Ignoro gli alberi, troppo vago"
    ],
    correctIndex: 1,
    explanation: "Incrocia i due criteri: zone universitarie storiche (poche) CON vie alberate.",
    tip: "Interseziona gli indizi: il luogo deve soddisfare ENTRAMBI."
  },
  {
    question: 'Indizio: "Zona ad alto traffico pedonale, vicino metropolitana". Priorit?',
    options: [
      "Traffico pedonale",
      "Vicinanza metro",
      "Entrambi ugualmente"
    ],
    correctIndex: 1,
    explanation: "Le fermate metro sono punti fissi e verificabili. Il traffico pedonale  soggettivo.",
    tip: "Punti di riferimento fisici > aggettivi vaghi."
  }
];
function getRandomQuiz() {
  return QUIZ_POOL[Math.floor(Math.random() * QUIZ_POOL.length)];
}
function generateQuizChallenge() {
  const quiz = getRandomQuiz();
  const optionsText = quiz.options.map((opt, i) => `${i + 1}. ${opt}`).join("\n");
  return ` **Mini-Quiz da 30s** (ti allena senza spoiler)

${quiz.question}

${optionsText}

Rispondi con 1, 2 o 3.`;
}

const PATTERN_DRILLS = [
  {
    title: "Drill Geografico",
    patterns: [
      'Indizio A: "Zona nord, vicino parco"',
      'Indizio B: "Area verde estesa, pista ciclabile"'
    ],
    question: "Quale restringe di pi la zona finale?",
    answer: "Indizio B",
    reasoning: 'B  pi specifico: "area verde estesa + pista ciclabile" sono 2 criteri verificabili. A dice solo "vicino parco" (generico).'
  },
  {
    title: "Drill Temporale",
    patterns: [
      'Indizio A: "Aperto dalle 8:00"',
      'Indizio B: "Chiuso il marted"'
    ],
    question: "Quale esclude pi luoghi?",
    answer: "Indizio B",
    reasoning: "B esclude tutti i posti aperti 7/7. A dice solo l'orario di apertura (molto comune)."
  },
  {
    title: "Drill Architettonico",
    patterns: [
      'Indizio A: "Edificio storico"',
      'Indizio B: "Facciata liberty con 3 archi"'
    ],
    question: "Quale permette di identificare il punto esatto?",
    answer: "Indizio B",
    reasoning: 'B d dettagli architettonici specifici: "liberty + 3 archi"  rarissimo. A  troppo vago.'
  }
];
function getRandomDrill() {
  return PATTERN_DRILLS[Math.floor(Math.random() * PATTERN_DRILLS.length)];
}
function generateDrillChallenge() {
  const drill = getRandomDrill();
  const patternsText = drill.patterns.join("\n");
  return ` **Pattern Drill** (riconosci cosa conta)

${drill.title}

${patternsText}

 ${drill.question}

Rispondi "A" o "B".`;
}

const FAQ_ESSENTIALS = [
  {
    question: "Come funziona M1SSION?",
    answer: "Raccogli indizi veri  trova pattern  fai Final Shot sul punto esatto  vinci premio reale. Zero spoiler, solo deduzione.",
    cta: "Vuoi iniziare?"
  },
  {
    question: "Cos' Final Shot?",
    answer: ' il momento in cui tiri una coordinata precisa. Se  nel raggio giusto (calcolato dai tuoi indizi), vinci. Max 2 tentativi/giorno.  "safe" se hai 8+ indizi.',
    cta: "Vuoi vedere un esempio safe?"
  },
  {
    question: "BUZZ Map a cosa serve?",
    answer: 'Visualizza i tuoi indizi su mappa e ti mostra il "raggio di confidenza". Pi indizi hai, pi il cerchio si stringe. Usi BUZZ Map DOPO aver raccolto 5+ indizi.',
    cta: "Apri BUZZ Map?"
  },
  {
    question: "Quanto costa?",
    answer: "BUZZ  gratuito (1 indizio/giorno). BUZZ Map e Final Shot sono a pagamento ma opzionali. Puoi vincere anche con solo BUZZ gratis se sei metodico.",
    cta: "Vedi piani"
  }
];
function generateFAQ60() {
  const faqText = FAQ_ESSENTIALS.map((item, i) => `**${i + 1}. ${item.question}**
${item.answer}`).join("\n\n");
  return ` **FAQ Essenziale** (60s di lettura, zero spoiler)

${faqText}

Vuoi approfondire qualcosa?`;
}

function choicesToNaturalText(choices) {
  if (choices.length === 0) return "";
  if (choices.length === 1) return choices[0];
  const connectors = [
    ["Puoi", "oppure"],
    ["Ti propongo", "o se preferisci"],
    ["Facciamo", "o meglio"],
    ["Prova", "altrimenti"],
    ["Scegli se", "o se vuoi"]
  ];
  const [first, second] = connectors[Math.floor(Math.random() * connectors.length)];
  if (choices.length === 2) {
    return `${first} ${choices[0].toLowerCase()}, ${second} ${choices[1].toLowerCase()}.`;
  }
  const lastChoice = choices[choices.length - 1];
  const otherChoices = choices.slice(0, -1);
  return `${first} ${otherChoices.map((c) => c.toLowerCase()).join(", ")}, ${second} ${lastChoice.toLowerCase()}.`;
}
function varyPhrase(base) {
  const variations = {
    "Facciamo": ["Proviamo", "Andiamo con", "Ti propongo", "Scegliamo"],
    "Vediamo": ["Guardiamo", "Analizziamo", "Controlliamo", "Verifichiamo"],
    "Capito": ["Chiaro", "Ok", "Ricevuto", "Perfetto"],
    "Ottimo": ["Bene", "Perfetto", "Fantastico", "Grande"],
    "Come": ["In che modo", "In quale modo", "Quale strada per"],
    "Cosa": ["Quale", "Che cosa", "Che tipo di"]
  };
  let result = base;
  for (const [key, alts] of Object.entries(variations)) {
    if (result.includes(key)) {
      const alt = alts[Math.floor(Math.random() * alts.length)];
      result = result.replace(key, alt);
      break;
    }
  }
  return result;
}
function detectEcho(reply, userInput) {
  const userWords = userInput.toLowerCase().split(/\s+/).filter((w) => w.length > 3);
  const replyLower = reply.toLowerCase();
  if (userWords.length < 3) return false;
  for (let i = 0; i <= userWords.length - 3; i++) {
    const trigram = userWords.slice(i, i + 3).join(" ");
    if (replyLower.includes(trigram)) {
      return true;
    }
  }
  const commonWords = /* @__PURE__ */ new Set([
    "buzz",
    "map",
    "final",
    "shot",
    "indizio",
    "come",
    "cosa",
    "dove",
    "quando",
    "che",
    "per",
    "non",
    "sono",
    "hai",
    "vuoi"
  ]);
  let matches = 0;
  for (const word of userWords) {
    if (!commonWords.has(word) && replyLower.includes(word)) {
      matches++;
    }
  }
  return matches > userWords.length * 0.4;
}
function removeEcho(reply, userInput) {
  const userWords = userInput.toLowerCase().split(/\s+/).filter((w) => w.length > 3);
  let result = reply;
  for (const word of userWords) {
    if (word.length > 5 && result.toLowerCase().includes(word)) {
      result = varyPhrase(result);
      break;
    }
  }
  return result;
}

let recentTemplateIds = [];
const MAX_RECENT_TEMPLATES = 3;
const EMPATHY_HOOKS = [
  "Ok {name}, ci penso io.",
  "Ci sono: lo facciamo semplice e utile.",
  "Ottima mossa, agente {code}.",
  "Respiro profondo: un passo e siamo avanti.",
  "Capito. Ti porto io nella direzione giusta.",
  "Va bene saltare i giri inutili. Ecco cosa conviene fare.",
  "Ho letto tra le righe: vuoi chiarezza rapida.",
  "Zero fronzoli: ti alleno io.",
  "Tranquillo, sei nel posto giusto.",
  "Capito: facciamolo semplice e concreto.",
  "Capito, {name}!",
  "Perfetto!",
  "Ci sono!",
  "Vediamo insieme.",
  "Ok, analizziamo.",
  "Bene!",
  "D'accordo.",
  "Capisco, {name}.",
  "Roger, agente {code}.",
  "Interessante.",
  "Procediamo.",
  "Chiaro, {name}.",
  "Ok agente {code}!",
  "Bene, vediamo.",
  "Ricevuto!",
  "{name}, perfetto.",
  "Ok {code}, ci siamo.",
  "Bene cos!",
  "Roger!",
  "Ehi {name}, facciamolo insieme.",
  "Chiaro. Un attimo."
];
const CLOSERS = [
  "Sei pi avanti di quanto pensi. Andiamo.",
  "Ottimo ritmo: un tassello alla volta.",
  "Ti copro le spalle: scelgo io la prossima mossa se vuoi.",
  "Quando sei pronto, facciamo un altro passo.",
  "Hai gi {clues} indizi: capitalizziamoli.",
  "Se vuoi sprint, ho una mossa da 30s.",
  "Perfetto. Tocco leggero, risultati veri.",
  "Lo stai rendendo interessante.",
  "Ci siamo: un passo alla volta, e il quadro compare.",
  "Ottimo ritmo. Torna agli indizi di ieri: c' un collegamento sottile.",
  "Se hai dubbi, scegli la pista pi coerente col tema ricorrente.",
  "Non forzo la risposta: ti tengo centrato sulla logica giusta.",
  "Buona caccia  il dettaglio fa la differenza.",
  "Procediamo con calma: il metodo batte la fretta.",
  "Ogni frammento conta. Continua cos.",
  "Il puzzle si compone pezzo dopo pezzo."
];
function hasEcho(reply, userInput) {
  return detectEcho(reply, userInput);
}
function renderChoiceList(choices) {
  return choicesToNaturalText(choices);
}
function getEmpathyHook(ctx) {
  const agentName = ctx?.agent?.username || "Agente";
  const agentCode = ctx?.agent?.code || "AG-XXXX";
  const available = EMPATHY_HOOKS.filter((h) => !recentTemplateIds.includes(h));
  const hook = available.length > 0 ? available[Math.floor(Math.random() * available.length)] : EMPATHY_HOOKS[Math.floor(Math.random() * EMPATHY_HOOKS.length)];
  recentTemplateIds.push(hook);
  if (recentTemplateIds.length > MAX_RECENT_TEMPLATES) {
    recentTemplateIds.shift();
  }
  return hook.replace("{name}", agentName).replace("{code}", agentCode);
}
function getCloser() {
  const available = CLOSERS.filter((c) => !recentTemplateIds.includes(c));
  const closer = available.length > 0 ? available[Math.floor(Math.random() * available.length)] : CLOSERS[Math.floor(Math.random() * CLOSERS.length)];
  recentTemplateIds.push(closer);
  if (recentTemplateIds.length > MAX_RECENT_TEMPLATES) {
    recentTemplateIds.shift();
  }
  return closer;
}
function generateBuzzExplanation(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const body = `BUZZ ti d indizi veri sul posto giusto: ogni BUZZ = 1 indizio leggibile in 10s. Con 68 indizi inizi a vedere un pattern; con 912 prepari il Final Shot. Scegli tu il ritmo: una volta al giorno  perfetto.`;
  const choices = [
    "aprire BUZZ e prendere il primo indizio di oggi",
    "spiegarti come leggere correttamente un indizio"
  ];
  return `${hook}

${body}

${choicesToNaturalText(choices)}

${closer}`;
}
function generateMissionExplanation(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const body = `M1SSION  una caccia al premio reale: raccogli indizi, trovi pattern, tiri il Final Shot sul punto esatto. Vince chi deduce meglio, non chi spende di pi.`;
  const choices = [
    "prendere un indizio adesso (ti guido io)",
    "ascoltare la spiegazione di Final Shot in 2 frasi + una prova safe"
  ];
  return `${hook}

${body}

${choicesToNaturalText(choices)}

${closer}`;
}
function generateHowToStart(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const body = `Ci sono, partiamo in modo leggero. Prima apri BUZZ e prendi 1 indizio (30s), poi torni qui e te lo traduco in azioni (60s).`;
  const choices = [
    "farlo ora",
    "avere prima una panoramica rapida di M1SSION"
  ];
  return `${hook}

${body} ${choicesToNaturalText(choices)}

${closer}`;
}
function generateNoBuzzResponse(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const body = `Ok, niente BUZZ ora. Ti propongo tre alternative per allenarti senza raccogliere indizi`;
  const choices = [
    "un **Mini-Quiz da 30s** dove ti alleno su un indizio tipico (zero spoiler)",
    "un **Pattern Drill** per riconoscere quale indizio restringe di pi",
    "le **FAQ in 60s** con 4 domande essenziali su M1SSION"
  ];
  return `${hook}

${body}: ${choicesToNaturalText(choices)}

${closer}`;
}
function generateBuzzVsMapComparison(ctx) {
  const hook = getEmpathyHook(ctx);
  const closer = getCloser();
  const body = `**BUZZ** = raccogli indizi veri (1/giorno gratis).
**BUZZ Map** = visualizza indizi su mappa + raggio di confidenza.

Il flusso: BUZZ  raccogli 5+ indizi  BUZZ Map  vedi dove convergono  Final Shot.`;
  const choices = [
    "Faccio un BUZZ ora",
    "Vedo BUZZ Map (serve 3 indizi)",
    "Spiega Final Shot"
  ];
  return `${hook}

${body}

Scelte rapide:
${renderChoiceList(choices)}

${closer}`;
}
function generateRulesShort(ctx) {
  const hook = getEmpathyHook(ctx);
  const closer = getCloser();
  const body = `**Regole in 3 righe**:
1. Raccogli indizi con BUZZ (gratuito).
2. Trova pattern e restringe l'area.
3. Tira Final Shot sul punto esatto (max 2/giorno).`;
  const choices = [
    "Inizia con 1 BUZZ",
    "Spiega Final Shot safe",
    "FAQ completa"
  ];
  return `${hook}

${body}

${renderChoiceList(choices)}

${closer}`;
}
function generateSalutoResponse(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const clues = ctx?.stats?.clues || 0;
  const body = clues > 0 ? `Hai gi ${clues} indizi raccolti. Facciamo una mossa utile adesso?` : `Ehi! Facciamo una mossa semplice e utile per iniziare.`;
  const choices = [
    "aprire BUZZ (1 indizio in 60s)",
    "avere una panoramica di M1SSION",
    "vedere alternative senza BUZZ"
  ];
  return `${hook}

${body} ${choicesToNaturalText(choices)}

${closer}`;
}
function generateRetentionResponse(ctx, phase) {
  const hook = getEmpathyHook(ctx);
  const clues = ctx?.stats?.clues || 0;
  logRetentionTrigger("frustrated_exit", clues);
  const body = clues > 0 ? `Capisco la sensazione, succede quando manca il primo indizio.
Hai gi ${clues} indizi: sei pi avanti di quanto pensi.
Facciamo cos: 60 secondi insieme  1 BUZZ adesso e lo leggiamo subito.
Se non ti  utile, chiudiamo qui. Ti va?` : `Capisco la frustrazione. Nessun problema.
Prima di andare, posso mostrarti 1 BUZZ in 60 secondi? Zero impegno, solo per vedere se ti  utile.
Se non funziona, chiudiamo qui. Deal?`;
  return `${hook}

${body}`;
}
function generateClarifyResponse(ctx, suggestedIntent) {
  const hook = getEmpathyHook(ctx);
  const suggestions = {
    about_buzz: ["Come funziona BUZZ?", "Quanto costa BUZZ?"],
    about_mission: ["Cos' M1SSION?", "Come si vince?"],
    about_finalshot: ["Cos' Final Shot?", "Come funziona Final Shot?"],
    plans: ["Quali piani ci sono?", "Piani gratuiti?"]
  };
  const [opt1, opt2] = suggestions[suggestedIntent] || ["Spiega BUZZ", "Spiega M1SSION"];
  return `${hook}

Non sono sicura di aver capito. Intendi:
1. ${opt1}
2. ${opt2}

Scegli tu o riformula.`;
}
function generateUnknownResponse(ctx, userInput) {
  const hook = getEmpathyHook(ctx);
  const closer = getCloser();
  const body = `Non ho capito perfettamente, ma ci arrivo.`;
  const choices = [
    "Vuoi sapere come funziona BUZZ?",
    "Oppure preferisci una guida rapida per iniziare?"
  ];
  return `${hook}

${body}

${renderChoiceList(choices)}

${closer}`;
}
function generatePricingResponse(ctx) {
  const hook = getEmpathyHook(ctx);
  return `${hook}

BUZZ  **gratuito**. Zero costi, zero sorprese.
Pronto a provare?  Apri BUZZ ora.`;
}
function handleMultiIntent(multiIntents, ctx, userInput) {
  const hook = getEmpathyHook(ctx);
  const closer = getCloser();
  if (multiIntents.length === 0) {
    return generateUnknownResponse(ctx);
  }
  const cards = [];
  for (let i = 0; i < Math.min(2, multiIntents.length); i++) {
    const intentData = multiIntents[i];
    const kb = norahKB[intentData.intent];
    if (kb && "a" in kb) {
      const text = kb.a[0] || "Info non disponibile";
      cards.push(`**${String(intentData.intent)}**
${text}`);
    }
  }
  const cta = "\n\nVuoi approfondire uno di questi? Oppure facciamo 1 BUZZ rapido?";
  return `${hook}

${cards.join("\n\n")}${cta}

${closer}`;
}
function composeReply(intentResult, userInput, ctx) {
  const phase = getPhase(ctx, userInput, [intentResult.intent]);
  const sentiment = detectSentiment(userInput);
  logEvent({
    event: "reply_generated",
    intent: intentResult.intent,
    sentiment,
    phase,
    meta: { confidence: intentResult.confidence }
  });
  if (isFollowUp(userInput)) {
    return generateFollowUpReply(ctx, phase, userInput);
  }
  if (isPricingQuery(userInput)) {
    return generatePricingResponse(ctx);
  }
  if (/mini.?quiz|quiz/i.test(userInput)) {
    return generateQuizChallenge();
  }
  if (/pattern.?drill|drill/i.test(userInput)) {
    return generateDrillChallenge();
  }
  if (/faq|domande/i.test(userInput)) {
    return generateFAQ60();
  }
  if (sentiment === "frustrated" && /me\s+ne\s+vado|basta|difficile/i.test(userInput)) {
    return generateRetentionResponse(ctx);
  }
  if (intentResult.intent === "clarify_needed") {
    const suggested = intentResult.slots?.suggested_intent || "about_buzz";
    return generateClarifyResponse(ctx, suggested);
  }
  if (intentResult.multiIntents && intentResult.multiIntents.length > 1) {
    return handleMultiIntent(intentResult.multiIntents, ctx);
  }
  let baseReply = "";
  switch (intentResult.intent) {
    case "about_buzz":
      baseReply = generateBuzzExplanation(ctx);
      break;
    case "about_mission":
      baseReply = generateMissionExplanation(ctx);
      break;
    case "help":
    case "help_start":
      baseReply = generateHowToStart(ctx);
      break;
    case "saluto":
    case "smalltalk":
      baseReply = generateSalutoResponse(ctx);
      break;
    case "no_buzz":
      baseReply = generateNoBuzzResponse(ctx);
      break;
    case "diff_buzz_vs_map":
      baseReply = generateBuzzVsMapComparison(ctx);
      break;
    case "rules_short":
      baseReply = generateRulesShort(ctx);
      break;
    case "unknown":
      baseReply = generateUnknownResponse(ctx);
      break;
    default:
      const kb = norahKB[intentResult.intent];
      if (kb && "a" in kb) {
        const hook = getEmpathyHook(ctx);
        const closer = getCloser();
        const body = kb.a[0] || "Info non disponibile.";
        baseReply = `${hook}

${body}

${closer}`;
      } else {
        baseReply = generateUnknownResponse(ctx);
      }
  }
  if (hasEcho(baseReply, userInput)) {
    const hook = getEmpathyHook(ctx);
    const closer = getCloser();
    baseReply = `${hook}

Capito la domanda. ${baseReply.split("\n\n")[1] || baseReply}

${closer}`;
  }
  const joke = maybeJoke(sentiment, ctx, intentResult.intent);
  if (joke.used) {
    logJokeUsed(sentiment, joke.text);
    baseReply = `${joke.text}

${baseReply}`;
  }
  if (detectEcho(baseReply, userInput)) {
    baseReply = removeEcho(baseReply, userInput);
  }
  if (baseReply.length > 1e3) {
    baseReply = baseReply.substring(0, 1e3) + "";
  }
  return baseReply;
}
function isPricingQuery(input) {
  const lower = input.toLowerCase();
  const patterns = [
    /si\s+paga/i,
    /\s+gratis/i,
    /costa/i,
    /prezzo/i,
    /quanto\s+costa/i,
    /\s+a\s+pagamento/i,
    /devo\s+pagare/i,
    /gratuito/i
  ];
  return patterns.some((p) => p.test(lower)) && lower.includes("buzz");
}
async function generateReply(userInput) {
  const ctx = await __vitePreload(() => import('./contextBuilder.CcFueusl.js'),true?__vite__mapDeps([12,1,2,3,6,5,7,8,9]):void 0).then((m) => m.buildNorahContext());
  const intentResult = routeIntent(userInput);
  return composeReply(intentResult, userInput, ctx);
}

function useNorahLLM({ userId, route, locale = "it" }) {
  const [isProcessing, setIsProcessing] = reactExports.useState(false);
  const [conversationHistory, setConversationHistory] = reactExports.useState([]);
  const [isOffline, setIsOffline] = reactExports.useState(false);
  const { toast } = useToast();
  const askNorah = reactExports.useCallback(async (userInput) => {
    if (!userInput.trim() || isProcessing) return "";
    setIsProcessing(true);
    crypto.randomUUID();
    try {
      const intentResult = routeIntent(userInput);
      if (shouldClarify(intentResult)) {
        const clarification = getClarificationQuestion(userInput);
        setConversationHistory((prev) => [
          ...prev,
          { role: "user", content: userInput },
          { role: "assistant", content: clarification }
        ]);
        setIsProcessing(false);
        return clarification;
      }
      const userMessage = { role: "user", content: userInput };
      setConversationHistory((prev) => [...prev, userMessage]);
      const options = {
        userId,
        userMessage: userInput,
        route,
        locale,
        conversationHistory
      };
      const response = await processAIRequest(options);
      let finalMessage = response.message;
      const aiMessage = { role: "assistant", content: finalMessage };
      setConversationHistory((prev) => [...prev, aiMessage]);
      setIsOffline(false);
      return finalMessage;
    } catch (error) {
      const is402or429 = error?.message?.includes("402") || error?.message?.includes("429") || error?.status === 402 || error?.status === 429;
      if (is402or429) {
        setIsOffline(true);
        toast({
          title: " Modalit Offline",
          description: "Limite raggiunto. Risposte template attive.",
          variant: "destructive"
        });
      }
      const fallbackReply = await generateReply(userInput);
      const aiMessage = { role: "assistant", content: fallbackReply };
      setConversationHistory((prev) => [
        { role: "user", content: userInput },
        aiMessage
      ]);
      setIsOffline(true);
      return fallbackReply;
    } finally {
      setIsProcessing(false);
    }
  }, [userId, route, locale, conversationHistory, isProcessing, toast]);
  const clearHistory = reactExports.useCallback(() => {
    setConversationHistory([]);
    setIsOffline(false);
  }, []);
  return {
    askNorah,
    clearHistory,
    isProcessing,
    conversationHistory,
    isOffline
  };
}

/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */

const {
  entries,
  setPrototypeOf,
  isFrozen,
  getPrototypeOf,
  getOwnPropertyDescriptor
} = Object;
let {
  freeze,
  seal,
  create
} = Object; // eslint-disable-line import/no-mutable-exports
let {
  apply,
  construct
} = typeof Reflect !== 'undefined' && Reflect;
if (!freeze) {
  freeze = function freeze(x) {
    return x;
  };
}
if (!seal) {
  seal = function seal(x) {
    return x;
  };
}
if (!apply) {
  apply = function apply(func, thisArg) {
    for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
      args[_key - 2] = arguments[_key];
    }
    return func.apply(thisArg, args);
  };
}
if (!construct) {
  construct = function construct(Func) {
    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
      args[_key2 - 1] = arguments[_key2];
    }
    return new Func(...args);
  };
}
const arrayForEach = unapply(Array.prototype.forEach);
const arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);
const arrayPop = unapply(Array.prototype.pop);
const arrayPush = unapply(Array.prototype.push);
const arraySplice = unapply(Array.prototype.splice);
const stringToLowerCase = unapply(String.prototype.toLowerCase);
const stringToString = unapply(String.prototype.toString);
const stringMatch = unapply(String.prototype.match);
const stringReplace = unapply(String.prototype.replace);
const stringIndexOf = unapply(String.prototype.indexOf);
const stringTrim = unapply(String.prototype.trim);
const objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);
const regExpTest = unapply(RegExp.prototype.test);
const typeErrorCreate = unconstruct(TypeError);
/**
 * Creates a new function that calls the given function with a specified thisArg and arguments.
 *
 * @param func - The function to be wrapped and called.
 * @returns A new function that calls the given function with a specified thisArg and arguments.
 */
function unapply(func) {
  return function (thisArg) {
    if (thisArg instanceof RegExp) {
      thisArg.lastIndex = 0;
    }
    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
      args[_key3 - 1] = arguments[_key3];
    }
    return apply(func, thisArg, args);
  };
}
/**
 * Creates a new function that constructs an instance of the given constructor function with the provided arguments.
 *
 * @param func - The constructor function to be wrapped and called.
 * @returns A new function that constructs an instance of the given constructor function with the provided arguments.
 */
function unconstruct(Func) {
  return function () {
    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
      args[_key4] = arguments[_key4];
    }
    return construct(Func, args);
  };
}
/**
 * Add properties to a lookup table
 *
 * @param set - The set to which elements will be added.
 * @param array - The array containing elements to be added to the set.
 * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.
 * @returns The modified set with added elements.
 */
function addToSet(set, array) {
  let transformCaseFunc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : stringToLowerCase;
  if (setPrototypeOf) {
    // Make 'in' and truthy checks like Boolean(set.constructor)
    // independent of any properties defined on Object.prototype.
    // Prevent prototype setters from intercepting set as a this value.
    setPrototypeOf(set, null);
  }
  let l = array.length;
  while (l--) {
    let element = array[l];
    if (typeof element === 'string') {
      const lcElement = transformCaseFunc(element);
      if (lcElement !== element) {
        // Config presets (e.g. tags.js, attrs.js) are immutable.
        if (!isFrozen(array)) {
          array[l] = lcElement;
        }
        element = lcElement;
      }
    }
    set[element] = true;
  }
  return set;
}
/**
 * Clean up an array to harden against CSPP
 *
 * @param array - The array to be cleaned.
 * @returns The cleaned version of the array
 */
function cleanArray(array) {
  for (let index = 0; index < array.length; index++) {
    const isPropertyExist = objectHasOwnProperty(array, index);
    if (!isPropertyExist) {
      array[index] = null;
    }
  }
  return array;
}
/**
 * Shallow clone an object
 *
 * @param object - The object to be cloned.
 * @returns A new object that copies the original.
 */
function clone(object) {
  const newObject = create(null);
  for (const [property, value] of entries(object)) {
    const isPropertyExist = objectHasOwnProperty(object, property);
    if (isPropertyExist) {
      if (Array.isArray(value)) {
        newObject[property] = cleanArray(value);
      } else if (value && typeof value === 'object' && value.constructor === Object) {
        newObject[property] = clone(value);
      } else {
        newObject[property] = value;
      }
    }
  }
  return newObject;
}
/**
 * This method automatically checks if the prop is function or getter and behaves accordingly.
 *
 * @param object - The object to look up the getter function in its prototype chain.
 * @param prop - The property name for which to find the getter function.
 * @returns The getter function found in the prototype chain or a fallback function.
 */
function lookupGetter(object, prop) {
  while (object !== null) {
    const desc = getOwnPropertyDescriptor(object, prop);
    if (desc) {
      if (desc.get) {
        return unapply(desc.get);
      }
      if (typeof desc.value === 'function') {
        return unapply(desc.value);
      }
    }
    object = getPrototypeOf(object);
  }
  function fallbackValue() {
    return null;
  }
  return fallbackValue;
}

const html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'search', 'section', 'select', 'shadow', 'slot', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']);
const svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'enterkeyhint', 'exportparts', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'inputmode', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'part', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);
const svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']);
// List of SVG elements that are disallowed by default.
// We still need to know them so that we can do namespace
// checks properly in case one wants to add them to
// allow-list.
const svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);
const mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover', 'mprescripts']);
// Similarly to SVG, we want to know all MathML elements,
// even those that we disallow by default.
const mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);
const text = freeze(['#text']);

const html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'exportparts', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inert', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'part', 'pattern', 'placeholder', 'playsinline', 'popover', 'popovertarget', 'popovertargetaction', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'slot', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'wrap', 'xmlns', 'slot']);
const svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'amplitude', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'exponent', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'intercept', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'mask-type', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'slope', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'tablevalues', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);
const mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);
const xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);

// eslint-disable-next-line unicorn/better-regex
const MUSTACHE_EXPR = seal(/\{\{[\w\W]*|[\w\W]*\}\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode
const ERB_EXPR = seal(/<%[\w\W]*|[\w\W]*%>/gm);
const TMPLIT_EXPR = seal(/\$\{[\w\W]*/gm); // eslint-disable-line unicorn/better-regex
const DATA_ATTR = seal(/^data-[\-\w.\u00B7-\uFFFF]+$/); // eslint-disable-line no-useless-escape
const ARIA_ATTR = seal(/^aria-[\-\w]+$/); // eslint-disable-line no-useless-escape
const IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i // eslint-disable-line no-useless-escape
);
const IS_SCRIPT_OR_DATA = seal(/^(?:\w+script|data):/i);
const ATTR_WHITESPACE = seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g // eslint-disable-line no-control-regex
);
const DOCTYPE_NAME = seal(/^html$/i);
const CUSTOM_ELEMENT = seal(/^[a-z][.\w]*(-[.\w]+)+$/i);

var EXPRESSIONS = /*#__PURE__*/Object.freeze({
  __proto__: null,
  ARIA_ATTR: ARIA_ATTR,
  ATTR_WHITESPACE: ATTR_WHITESPACE,
  CUSTOM_ELEMENT: CUSTOM_ELEMENT,
  DATA_ATTR: DATA_ATTR,
  DOCTYPE_NAME: DOCTYPE_NAME,
  ERB_EXPR: ERB_EXPR,
  IS_ALLOWED_URI: IS_ALLOWED_URI,
  IS_SCRIPT_OR_DATA: IS_SCRIPT_OR_DATA,
  MUSTACHE_EXPR: MUSTACHE_EXPR,
  TMPLIT_EXPR: TMPLIT_EXPR
});

/* eslint-disable @typescript-eslint/indent */
// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType
const NODE_TYPE = {
  element: 1,
  text: 3,
  // Deprecated
  progressingInstruction: 7,
  comment: 8,
  document: 9};
const getGlobal = function getGlobal() {
  return typeof window === 'undefined' ? null : window;
};
/**
 * Creates a no-op policy for internal use only.
 * Don't export this function outside this module!
 * @param trustedTypes The policy factory.
 * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).
 * @return The policy created (or null, if Trusted Types
 * are not supported or creating the policy failed).
 */
const _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, purifyHostElement) {
  if (typeof trustedTypes !== 'object' || typeof trustedTypes.createPolicy !== 'function') {
    return null;
  }
  // Allow the callers to control the unique policy name
  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.
  // Policy creation with duplicate names throws in Trusted Types.
  let suffix = null;
  const ATTR_NAME = 'data-tt-policy-suffix';
  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {
    suffix = purifyHostElement.getAttribute(ATTR_NAME);
  }
  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');
  try {
    return trustedTypes.createPolicy(policyName, {
      createHTML(html) {
        return html;
      },
      createScriptURL(scriptUrl) {
        return scriptUrl;
      }
    });
  } catch (_) {
    // Policy creation failed (most likely another DOMPurify script has
    // already run). Skip creating the policy, as this will only cause errors
    // if TT are enforced.
    console.warn('TrustedTypes policy ' + policyName + ' could not be created.');
    return null;
  }
};
const _createHooksMap = function _createHooksMap() {
  return {
    afterSanitizeAttributes: [],
    afterSanitizeElements: [],
    afterSanitizeShadowDOM: [],
    beforeSanitizeAttributes: [],
    beforeSanitizeElements: [],
    beforeSanitizeShadowDOM: [],
    uponSanitizeAttribute: [],
    uponSanitizeElement: [],
    uponSanitizeShadowNode: []
  };
};
function createDOMPurify() {
  let window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();
  const DOMPurify = root => createDOMPurify(root);
  DOMPurify.version = '3.3.0';
  DOMPurify.removed = [];
  if (!window || !window.document || window.document.nodeType !== NODE_TYPE.document || !window.Element) {
    // Not running in a browser, provide a factory function
    // so that you can pass your own Window
    DOMPurify.isSupported = false;
    return DOMPurify;
  }
  let {
    document
  } = window;
  const originalDocument = document;
  const currentScript = originalDocument.currentScript;
  const {
    DocumentFragment,
    HTMLTemplateElement,
    Node,
    Element,
    NodeFilter,
    NamedNodeMap = window.NamedNodeMap || window.MozNamedAttrMap,
    HTMLFormElement,
    DOMParser,
    trustedTypes
  } = window;
  const ElementPrototype = Element.prototype;
  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');
  const remove = lookupGetter(ElementPrototype, 'remove');
  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');
  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');
  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');
  // As per issue #47, the web-components registry is inherited by a
  // new document created via createHTMLDocument. As per the spec
  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)
  // a new empty registry is used when creating a template contents owner
  // document, so we use that as our parent document to ensure nothing
  // is inherited.
  if (typeof HTMLTemplateElement === 'function') {
    const template = document.createElement('template');
    if (template.content && template.content.ownerDocument) {
      document = template.content.ownerDocument;
    }
  }
  let trustedTypesPolicy;
  let emptyHTML = '';
  const {
    implementation,
    createNodeIterator,
    createDocumentFragment,
    getElementsByTagName
  } = document;
  const {
    importNode
  } = originalDocument;
  let hooks = _createHooksMap();
  /**
   * Expose whether this browser supports running the full DOMPurify.
   */
  DOMPurify.isSupported = typeof entries === 'function' && typeof getParentNode === 'function' && implementation && implementation.createHTMLDocument !== undefined;
  const {
    MUSTACHE_EXPR,
    ERB_EXPR,
    TMPLIT_EXPR,
    DATA_ATTR,
    ARIA_ATTR,
    IS_SCRIPT_OR_DATA,
    ATTR_WHITESPACE,
    CUSTOM_ELEMENT
  } = EXPRESSIONS;
  let {
    IS_ALLOWED_URI: IS_ALLOWED_URI$1
  } = EXPRESSIONS;
  /**
   * We consider the elements and attributes below to be safe. Ideally
   * don't add any new ones but feel free to remove unwanted ones.
   */
  /* allowed element names */
  let ALLOWED_TAGS = null;
  const DEFAULT_ALLOWED_TAGS = addToSet({}, [...html$1, ...svg$1, ...svgFilters, ...mathMl$1, ...text]);
  /* Allowed attribute names */
  let ALLOWED_ATTR = null;
  const DEFAULT_ALLOWED_ATTR = addToSet({}, [...html, ...svg, ...mathMl, ...xml]);
  /*
   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.
   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)
   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)
   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.
   */
  let CUSTOM_ELEMENT_HANDLING = Object.seal(create(null, {
    tagNameCheck: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: null
    },
    attributeNameCheck: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: null
    },
    allowCustomizedBuiltInElements: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: false
    }
  }));
  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */
  let FORBID_TAGS = null;
  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */
  let FORBID_ATTR = null;
  /* Config object to store ADD_TAGS/ADD_ATTR functions (when used as functions) */
  const EXTRA_ELEMENT_HANDLING = Object.seal(create(null, {
    tagCheck: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: null
    },
    attributeCheck: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: null
    }
  }));
  /* Decide if ARIA attributes are okay */
  let ALLOW_ARIA_ATTR = true;
  /* Decide if custom data attributes are okay */
  let ALLOW_DATA_ATTR = true;
  /* Decide if unknown protocols are okay */
  let ALLOW_UNKNOWN_PROTOCOLS = false;
  /* Decide if self-closing tags in attributes are allowed.
   * Usually removed due to a mXSS issue in jQuery 3.0 */
  let ALLOW_SELF_CLOSE_IN_ATTR = true;
  /* Output should be safe for common template engines.
   * This means, DOMPurify removes data attributes, mustaches and ERB
   */
  let SAFE_FOR_TEMPLATES = false;
  /* Output should be safe even for XML used within HTML and alike.
   * This means, DOMPurify removes comments when containing risky content.
   */
  let SAFE_FOR_XML = true;
  /* Decide if document with <html>... should be returned */
  let WHOLE_DOCUMENT = false;
  /* Track whether config is already set on this instance of DOMPurify. */
  let SET_CONFIG = false;
  /* Decide if all elements (e.g. style, script) must be children of
   * document.body. By default, browsers might move them to document.head */
  let FORCE_BODY = false;
  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html
   * string (or a TrustedHTML object if Trusted Types are supported).
   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead
   */
  let RETURN_DOM = false;
  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html
   * string  (or a TrustedHTML object if Trusted Types are supported) */
  let RETURN_DOM_FRAGMENT = false;
  /* Try to return a Trusted Type object instead of a string, return a string in
   * case Trusted Types are not supported  */
  let RETURN_TRUSTED_TYPE = false;
  /* Output should be free from DOM clobbering attacks?
   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.
   */
  let SANITIZE_DOM = true;
  /* Achieve full DOM Clobbering protection by isolating the namespace of named
   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.
   *
   * HTML/DOM spec rules that enable DOM Clobbering:
   *   - Named Access on Window (7.3.3)
   *   - DOM Tree Accessors (3.1.5)
   *   - Form Element Parent-Child Relations (4.10.3)
   *   - Iframe srcdoc / Nested WindowProxies (4.8.5)
   *   - HTMLCollection (4.2.10.2)
   *
   * Namespace isolation is implemented by prefixing `id` and `name` attributes
   * with a constant string, i.e., `user-content-`
   */
  let SANITIZE_NAMED_PROPS = false;
  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';
  /* Keep element content when removing element? */
  let KEEP_CONTENT = true;
  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead
   * of importing it into a new Document and returning a sanitized copy */
  let IN_PLACE = false;
  /* Allow usage of profiles like html, svg and mathMl */
  let USE_PROFILES = {};
  /* Tags to ignore content of when KEEP_CONTENT is true */
  let FORBID_CONTENTS = null;
  const DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);
  /* Tags that are safe for data: URIs */
  let DATA_URI_TAGS = null;
  const DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);
  /* Attributes safe for values like "javascript:" */
  let URI_SAFE_ATTRIBUTES = null;
  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);
  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';
  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';
  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';
  /* Document namespace */
  let NAMESPACE = HTML_NAMESPACE;
  let IS_EMPTY_INPUT = false;
  /* Allowed XHTML+XML namespaces */
  let ALLOWED_NAMESPACES = null;
  const DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);
  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);
  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);
  // Certain elements are allowed in both SVG and HTML
  // namespace. We need to specify them explicitly
  // so that they don't get erroneously deleted from
  // HTML namespace.
  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);
  /* Parsing of strict XHTML documents */
  let PARSER_MEDIA_TYPE = null;
  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];
  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';
  let transformCaseFunc = null;
  /* Keep a reference to config to pass to hooks */
  let CONFIG = null;
  /* Ideally, do not touch anything below this line */
  /* ______________________________________________ */
  const formElement = document.createElement('form');
  const isRegexOrFunction = function isRegexOrFunction(testValue) {
    return testValue instanceof RegExp || testValue instanceof Function;
  };
  /**
   * _parseConfig
   *
   * @param cfg optional config literal
   */
  // eslint-disable-next-line complexity
  const _parseConfig = function _parseConfig() {
    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    if (CONFIG && CONFIG === cfg) {
      return;
    }
    /* Shield configuration object from tampering */
    if (!cfg || typeof cfg !== 'object') {
      cfg = {};
    }
    /* Shield configuration object from prototype pollution */
    cfg = clone(cfg);
    PARSER_MEDIA_TYPE =
    // eslint-disable-next-line unicorn/prefer-includes
    SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? DEFAULT_PARSER_MEDIA_TYPE : cfg.PARSER_MEDIA_TYPE;
    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.
    transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;
    /* Set configuration parameters */
    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS') ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;
    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR') ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;
    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES') ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;
    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR') ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), cfg.ADD_URI_SAFE_ATTR, transformCaseFunc) : DEFAULT_URI_SAFE_ATTRIBUTES;
    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS') ? addToSet(clone(DEFAULT_DATA_URI_TAGS), cfg.ADD_DATA_URI_TAGS, transformCaseFunc) : DEFAULT_DATA_URI_TAGS;
    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS') ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;
    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS') ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : clone({});
    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR') ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : clone({});
    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES') ? cfg.USE_PROFILES : false;
    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true
    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true
    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false
    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true
    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false
    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true
    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false
    RETURN_DOM = cfg.RETURN_DOM || false; // Default false
    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false
    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false
    FORCE_BODY = cfg.FORCE_BODY || false; // Default false
    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true
    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false
    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true
    IN_PLACE = cfg.IN_PLACE || false; // Default false
    IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI;
    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;
    MATHML_TEXT_INTEGRATION_POINTS = cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;
    HTML_INTEGRATION_POINTS = cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;
    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};
    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {
      CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;
    }
    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {
      CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;
    }
    if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {
      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;
    }
    if (SAFE_FOR_TEMPLATES) {
      ALLOW_DATA_ATTR = false;
    }
    if (RETURN_DOM_FRAGMENT) {
      RETURN_DOM = true;
    }
    /* Parse profile info */
    if (USE_PROFILES) {
      ALLOWED_TAGS = addToSet({}, text);
      ALLOWED_ATTR = [];
      if (USE_PROFILES.html === true) {
        addToSet(ALLOWED_TAGS, html$1);
        addToSet(ALLOWED_ATTR, html);
      }
      if (USE_PROFILES.svg === true) {
        addToSet(ALLOWED_TAGS, svg$1);
        addToSet(ALLOWED_ATTR, svg);
        addToSet(ALLOWED_ATTR, xml);
      }
      if (USE_PROFILES.svgFilters === true) {
        addToSet(ALLOWED_TAGS, svgFilters);
        addToSet(ALLOWED_ATTR, svg);
        addToSet(ALLOWED_ATTR, xml);
      }
      if (USE_PROFILES.mathMl === true) {
        addToSet(ALLOWED_TAGS, mathMl$1);
        addToSet(ALLOWED_ATTR, mathMl);
        addToSet(ALLOWED_ATTR, xml);
      }
    }
    /* Merge configuration parameters */
    if (cfg.ADD_TAGS) {
      if (typeof cfg.ADD_TAGS === 'function') {
        EXTRA_ELEMENT_HANDLING.tagCheck = cfg.ADD_TAGS;
      } else {
        if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {
          ALLOWED_TAGS = clone(ALLOWED_TAGS);
        }
        addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);
      }
    }
    if (cfg.ADD_ATTR) {
      if (typeof cfg.ADD_ATTR === 'function') {
        EXTRA_ELEMENT_HANDLING.attributeCheck = cfg.ADD_ATTR;
      } else {
        if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {
          ALLOWED_ATTR = clone(ALLOWED_ATTR);
        }
        addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);
      }
    }
    if (cfg.ADD_URI_SAFE_ATTR) {
      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);
    }
    if (cfg.FORBID_CONTENTS) {
      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {
        FORBID_CONTENTS = clone(FORBID_CONTENTS);
      }
      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);
    }
    /* Add #text in case KEEP_CONTENT is set to true */
    if (KEEP_CONTENT) {
      ALLOWED_TAGS['#text'] = true;
    }
    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */
    if (WHOLE_DOCUMENT) {
      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);
    }
    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */
    if (ALLOWED_TAGS.table) {
      addToSet(ALLOWED_TAGS, ['tbody']);
      delete FORBID_TAGS.tbody;
    }
    if (cfg.TRUSTED_TYPES_POLICY) {
      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {
        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');
      }
      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {
        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');
      }
      // Overwrite existing TrustedTypes policy.
      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;
      // Sign local variables required by `sanitize`.
      emptyHTML = trustedTypesPolicy.createHTML('');
    } else {
      // Uninitialized policy, attempt to initialize the internal dompurify policy.
      if (trustedTypesPolicy === undefined) {
        trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, currentScript);
      }
      // If creating the internal policy succeeded sign internal variables.
      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {
        emptyHTML = trustedTypesPolicy.createHTML('');
      }
    }
    // Prevent further manipulation of configuration.
    // Not available in IE8, Safari 5, etc.
    if (freeze) {
      freeze(cfg);
    }
    CONFIG = cfg;
  };
  /* Keep track of all possible SVG and MathML tags
   * so that we can perform the namespace checks
   * correctly. */
  const ALL_SVG_TAGS = addToSet({}, [...svg$1, ...svgFilters, ...svgDisallowed]);
  const ALL_MATHML_TAGS = addToSet({}, [...mathMl$1, ...mathMlDisallowed]);
  /**
   * @param element a DOM element whose namespace is being checked
   * @returns Return false if the element has a
   *  namespace that a spec-compliant parser would never
   *  return. Return true otherwise.
   */
  const _checkValidNamespace = function _checkValidNamespace(element) {
    let parent = getParentNode(element);
    // In JSDOM, if we're inside shadow DOM, then parentNode
    // can be null. We just simulate parent in this case.
    if (!parent || !parent.tagName) {
      parent = {
        namespaceURI: NAMESPACE,
        tagName: 'template'
      };
    }
    const tagName = stringToLowerCase(element.tagName);
    const parentTagName = stringToLowerCase(parent.tagName);
    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {
      return false;
    }
    if (element.namespaceURI === SVG_NAMESPACE) {
      // The only way to switch from HTML namespace to SVG
      // is via <svg>. If it happens via any other tag, then
      // it should be killed.
      if (parent.namespaceURI === HTML_NAMESPACE) {
        return tagName === 'svg';
      }
      // The only way to switch from MathML to SVG is via`
      // svg if parent is either <annotation-xml> or MathML
      // text integration points.
      if (parent.namespaceURI === MATHML_NAMESPACE) {
        return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);
      }
      // We only allow elements that are defined in SVG
      // spec. All others are disallowed in SVG namespace.
      return Boolean(ALL_SVG_TAGS[tagName]);
    }
    if (element.namespaceURI === MATHML_NAMESPACE) {
      // The only way to switch from HTML namespace to MathML
      // is via <math>. If it happens via any other tag, then
      // it should be killed.
      if (parent.namespaceURI === HTML_NAMESPACE) {
        return tagName === 'math';
      }
      // The only way to switch from SVG to MathML is via
      // <math> and HTML integration points
      if (parent.namespaceURI === SVG_NAMESPACE) {
        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];
      }
      // We only allow elements that are defined in MathML
      // spec. All others are disallowed in MathML namespace.
      return Boolean(ALL_MATHML_TAGS[tagName]);
    }
    if (element.namespaceURI === HTML_NAMESPACE) {
      // The only way to switch from SVG to HTML is via
      // HTML integration points, and from MathML to HTML
      // is via MathML text integration points
      if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {
        return false;
      }
      if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {
        return false;
      }
      // We disallow tags that are specific for MathML
      // or SVG and should never appear in HTML namespace
      return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);
    }
    // For XHTML and XML documents that support custom namespaces
    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {
      return true;
    }
    // The code should never reach this place (this means
    // that the element somehow got namespace that is not
    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).
    // Return false just in case.
    return false;
  };
  /**
   * _forceRemove
   *
   * @param node a DOM node
   */
  const _forceRemove = function _forceRemove(node) {
    arrayPush(DOMPurify.removed, {
      element: node
    });
    try {
      // eslint-disable-next-line unicorn/prefer-dom-node-remove
      getParentNode(node).removeChild(node);
    } catch (_) {
      remove(node);
    }
  };
  /**
   * _removeAttribute
   *
   * @param name an Attribute name
   * @param element a DOM node
   */
  const _removeAttribute = function _removeAttribute(name, element) {
    try {
      arrayPush(DOMPurify.removed, {
        attribute: element.getAttributeNode(name),
        from: element
      });
    } catch (_) {
      arrayPush(DOMPurify.removed, {
        attribute: null,
        from: element
      });
    }
    element.removeAttribute(name);
    // We void attribute values for unremovable "is" attributes
    if (name === 'is') {
      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {
        try {
          _forceRemove(element);
        } catch (_) {}
      } else {
        try {
          element.setAttribute(name, '');
        } catch (_) {}
      }
    }
  };
  /**
   * _initDocument
   *
   * @param dirty - a string of dirty markup
   * @return a DOM, filled with the dirty markup
   */
  const _initDocument = function _initDocument(dirty) {
    /* Create a HTML document */
    let doc = null;
    let leadingWhitespace = null;
    if (FORCE_BODY) {
      dirty = '<remove></remove>' + dirty;
    } else {
      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */
      const matches = stringMatch(dirty, /^[\r\n\t ]+/);
      leadingWhitespace = matches && matches[0];
    }
    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {
      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)
      dirty = '<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>' + dirty + '</body></html>';
    }
    const dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;
    /*
     * Use the DOMParser API by default, fallback later if needs be
     * DOMParser not work for svg when has multiple root element.
     */
    if (NAMESPACE === HTML_NAMESPACE) {
      try {
        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);
      } catch (_) {}
    }
    /* Use createHTMLDocument in case DOMParser is not available */
    if (!doc || !doc.documentElement) {
      doc = implementation.createDocument(NAMESPACE, 'template', null);
      try {
        doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;
      } catch (_) {
        // Syntax error if dirtyPayload is invalid xml
      }
    }
    const body = doc.body || doc.documentElement;
    if (dirty && leadingWhitespace) {
      body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);
    }
    /* Work on whole document or just its body */
    if (NAMESPACE === HTML_NAMESPACE) {
      return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];
    }
    return WHOLE_DOCUMENT ? doc.documentElement : body;
  };
  /**
   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.
   *
   * @param root The root element or node to start traversing on.
   * @return The created NodeIterator
   */
  const _createNodeIterator = function _createNodeIterator(root) {
    return createNodeIterator.call(root.ownerDocument || root, root,
    // eslint-disable-next-line no-bitwise
    NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT | NodeFilter.SHOW_PROCESSING_INSTRUCTION | NodeFilter.SHOW_CDATA_SECTION, null);
  };
  /**
   * _isClobbered
   *
   * @param element element to check for clobbering attacks
   * @return true if clobbered, false if safe
   */
  const _isClobbered = function _isClobbered(element) {
    return element instanceof HTMLFormElement && (typeof element.nodeName !== 'string' || typeof element.textContent !== 'string' || typeof element.removeChild !== 'function' || !(element.attributes instanceof NamedNodeMap) || typeof element.removeAttribute !== 'function' || typeof element.setAttribute !== 'function' || typeof element.namespaceURI !== 'string' || typeof element.insertBefore !== 'function' || typeof element.hasChildNodes !== 'function');
  };
  /**
   * Checks whether the given object is a DOM node.
   *
   * @param value object to check whether it's a DOM node
   * @return true is object is a DOM node
   */
  const _isNode = function _isNode(value) {
    return typeof Node === 'function' && value instanceof Node;
  };
  function _executeHooks(hooks, currentNode, data) {
    arrayForEach(hooks, hook => {
      hook.call(DOMPurify, currentNode, data, CONFIG);
    });
  }
  /**
   * _sanitizeElements
   *
   * @protect nodeName
   * @protect textContent
   * @protect removeChild
   * @param currentNode to check for permission to exist
   * @return true if node was killed, false if left alive
   */
  const _sanitizeElements = function _sanitizeElements(currentNode) {
    let content = null;
    /* Execute a hook if present */
    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);
    /* Check if element is clobbered or can clobber */
    if (_isClobbered(currentNode)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Now let's check the element's type and name */
    const tagName = transformCaseFunc(currentNode.nodeName);
    /* Execute a hook if present */
    _executeHooks(hooks.uponSanitizeElement, currentNode, {
      tagName,
      allowedTags: ALLOWED_TAGS
    });
    /* Detect mXSS attempts abusing namespace confusion */
    if (SAFE_FOR_XML && currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && regExpTest(/<[/\w!]/g, currentNode.innerHTML) && regExpTest(/<[/\w!]/g, currentNode.textContent)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Remove any occurrence of processing instructions */
    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {
      _forceRemove(currentNode);
      return true;
    }
    /* Remove any kind of possibly harmful comments */
    if (SAFE_FOR_XML && currentNode.nodeType === NODE_TYPE.comment && regExpTest(/<[/\w]/g, currentNode.data)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Remove element if anything forbids its presence */
    if (!(EXTRA_ELEMENT_HANDLING.tagCheck instanceof Function && EXTRA_ELEMENT_HANDLING.tagCheck(tagName)) && (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName])) {
      /* Check if we have a custom element to handle */
      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {
        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) {
          return false;
        }
        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) {
          return false;
        }
      }
      /* Keep content except for bad-listed elements */
      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {
        const parentNode = getParentNode(currentNode) || currentNode.parentNode;
        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;
        if (childNodes && parentNode) {
          const childCount = childNodes.length;
          for (let i = childCount - 1; i >= 0; --i) {
            const childClone = cloneNode(childNodes[i], true);
            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;
            parentNode.insertBefore(childClone, getNextSibling(currentNode));
          }
        }
      }
      _forceRemove(currentNode);
      return true;
    }
    /* Check whether element has a valid namespace */
    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Make sure that older browsers don't get fallback-tag mXSS */
    if ((tagName === 'noscript' || tagName === 'noembed' || tagName === 'noframes') && regExpTest(/<\/no(script|embed|frames)/i, currentNode.innerHTML)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Sanitize element content to be template-safe */
    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {
      /* Get the element's text content */
      content = currentNode.textContent;
      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {
        content = stringReplace(content, expr, ' ');
      });
      if (currentNode.textContent !== content) {
        arrayPush(DOMPurify.removed, {
          element: currentNode.cloneNode()
        });
        currentNode.textContent = content;
      }
    }
    /* Execute a hook if present */
    _executeHooks(hooks.afterSanitizeElements, currentNode, null);
    return false;
  };
  /**
   * _isValidAttribute
   *
   * @param lcTag Lowercase tag name of containing element.
   * @param lcName Lowercase attribute name.
   * @param value Attribute value.
   * @return Returns true if `value` is valid, otherwise false.
   */
  // eslint-disable-next-line complexity
  const _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {
    /* Make sure attribute cannot clobber */
    if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {
      return false;
    }
    /* Allow valid data-* attributes: At least one character after "-"
        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)
        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)
        We don't need to check the value; it's always URI safe. */
    if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) ; else if (EXTRA_ELEMENT_HANDLING.attributeCheck instanceof Function && EXTRA_ELEMENT_HANDLING.attributeCheck(lcName, lcTag)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {
      if (
      // First condition does a very basic check if a) it's basically a valid custom element tagname AND
      // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck
      // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck
      _isBasicCustomElement(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName, lcTag)) ||
      // Alternative, second condition checks if it's an `is`-attribute, AND
      // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck
      lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {
        return false;
      }
      /* Check value is safe. First, is attr inert? If so, is safe */
    } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if (value) {
      return false;
    } else ;
    return true;
  };
  /**
   * _isBasicCustomElement
   * checks if at least one dash is included in tagName, and it's not the first char
   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name
   *
   * @param tagName name of the tag of the node to sanitize
   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.
   */
  const _isBasicCustomElement = function _isBasicCustomElement(tagName) {
    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);
  };
  /**
   * _sanitizeAttributes
   *
   * @protect attributes
   * @protect nodeName
   * @protect removeAttribute
   * @protect setAttribute
   *
   * @param currentNode to sanitize
   */
  const _sanitizeAttributes = function _sanitizeAttributes(currentNode) {
    /* Execute a hook if present */
    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);
    const {
      attributes
    } = currentNode;
    /* Check if we have attributes; if not we might have a text node */
    if (!attributes || _isClobbered(currentNode)) {
      return;
    }
    const hookEvent = {
      attrName: '',
      attrValue: '',
      keepAttr: true,
      allowedAttributes: ALLOWED_ATTR,
      forceKeepAttr: undefined
    };
    let l = attributes.length;
    /* Go backwards over all attributes; safely remove bad ones */
    while (l--) {
      const attr = attributes[l];
      const {
        name,
        namespaceURI,
        value: attrValue
      } = attr;
      const lcName = transformCaseFunc(name);
      const initValue = attrValue;
      let value = name === 'value' ? initValue : stringTrim(initValue);
      /* Execute a hook if present */
      hookEvent.attrName = lcName;
      hookEvent.attrValue = value;
      hookEvent.keepAttr = true;
      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set
      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);
      value = hookEvent.attrValue;
      /* Full DOM Clobbering protection via namespace isolation,
       * Prefix id and name attributes with `user-content-`
       */
      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {
        // Remove the attribute with this value
        _removeAttribute(name, currentNode);
        // Prefix the value and later re-create the attribute with the sanitized value
        value = SANITIZE_NAMED_PROPS_PREFIX + value;
      }
      /* Work around a security issue with comments inside attributes */
      if (SAFE_FOR_XML && regExpTest(/((--!?|])>)|<\/(style|title|textarea)/i, value)) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Make sure we cannot easily use animated hrefs, even if animations are allowed */
      if (lcName === 'attributename' && stringMatch(value, 'href')) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Did the hooks approve of the attribute? */
      if (hookEvent.forceKeepAttr) {
        continue;
      }
      /* Did the hooks approve of the attribute? */
      if (!hookEvent.keepAttr) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Work around a security issue in jQuery 3.0 */
      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\/>/i, value)) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Sanitize attribute content to be template-safe */
      if (SAFE_FOR_TEMPLATES) {
        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {
          value = stringReplace(value, expr, ' ');
        });
      }
      /* Is `value` valid for this attribute? */
      const lcTag = transformCaseFunc(currentNode.nodeName);
      if (!_isValidAttribute(lcTag, lcName, value)) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Handle attributes that require Trusted Types */
      if (trustedTypesPolicy && typeof trustedTypes === 'object' && typeof trustedTypes.getAttributeType === 'function') {
        if (namespaceURI) ; else {
          switch (trustedTypes.getAttributeType(lcTag, lcName)) {
            case 'TrustedHTML':
              {
                value = trustedTypesPolicy.createHTML(value);
                break;
              }
            case 'TrustedScriptURL':
              {
                value = trustedTypesPolicy.createScriptURL(value);
                break;
              }
          }
        }
      }
      /* Handle invalid data-* attribute set by try-catching it */
      if (value !== initValue) {
        try {
          if (namespaceURI) {
            currentNode.setAttributeNS(namespaceURI, name, value);
          } else {
            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. "x-schema". */
            currentNode.setAttribute(name, value);
          }
          if (_isClobbered(currentNode)) {
            _forceRemove(currentNode);
          } else {
            arrayPop(DOMPurify.removed);
          }
        } catch (_) {
          _removeAttribute(name, currentNode);
        }
      }
    }
    /* Execute a hook if present */
    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);
  };
  /**
   * _sanitizeShadowDOM
   *
   * @param fragment to iterate over recursively
   */
  const _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {
    let shadowNode = null;
    const shadowIterator = _createNodeIterator(fragment);
    /* Execute a hook if present */
    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);
    while (shadowNode = shadowIterator.nextNode()) {
      /* Execute a hook if present */
      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);
      /* Sanitize tags and elements */
      _sanitizeElements(shadowNode);
      /* Check attributes next */
      _sanitizeAttributes(shadowNode);
      /* Deep shadow DOM detected */
      if (shadowNode.content instanceof DocumentFragment) {
        _sanitizeShadowDOM(shadowNode.content);
      }
    }
    /* Execute a hook if present */
    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);
  };
  // eslint-disable-next-line complexity
  DOMPurify.sanitize = function (dirty) {
    let cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    let body = null;
    let importedNode = null;
    let currentNode = null;
    let returnNode = null;
    /* Make sure we have a string to sanitize.
      DO NOT return early, as this will return the wrong type if
      the user has requested a DOM object rather than a string */
    IS_EMPTY_INPUT = !dirty;
    if (IS_EMPTY_INPUT) {
      dirty = '<!-->';
    }
    /* Stringify, in case dirty is an object */
    if (typeof dirty !== 'string' && !_isNode(dirty)) {
      if (typeof dirty.toString === 'function') {
        dirty = dirty.toString();
        if (typeof dirty !== 'string') {
          throw typeErrorCreate('dirty is not a string, aborting');
        }
      } else {
        throw typeErrorCreate('toString is not a function');
      }
    }
    /* Return dirty HTML if DOMPurify cannot run */
    if (!DOMPurify.isSupported) {
      return dirty;
    }
    /* Assign config vars */
    if (!SET_CONFIG) {
      _parseConfig(cfg);
    }
    /* Clean up removed elements */
    DOMPurify.removed = [];
    /* Check if dirty is correctly typed for IN_PLACE */
    if (typeof dirty === 'string') {
      IN_PLACE = false;
    }
    if (IN_PLACE) {
      /* Do some early pre-sanitization to avoid unsafe root nodes */
      if (dirty.nodeName) {
        const tagName = transformCaseFunc(dirty.nodeName);
        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {
          throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');
        }
      }
    } else if (dirty instanceof Node) {
      /* If dirty is a DOM element, append to an empty document to avoid
         elements being stripped by the parser */
      body = _initDocument('<!---->');
      importedNode = body.ownerDocument.importNode(dirty, true);
      if (importedNode.nodeType === NODE_TYPE.element && importedNode.nodeName === 'BODY') {
        /* Node is already a body, use as is */
        body = importedNode;
      } else if (importedNode.nodeName === 'HTML') {
        body = importedNode;
      } else {
        // eslint-disable-next-line unicorn/prefer-dom-node-append
        body.appendChild(importedNode);
      }
    } else {
      /* Exit directly if we have nothing to do */
      if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT &&
      // eslint-disable-next-line unicorn/prefer-includes
      dirty.indexOf('<') === -1) {
        return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;
      }
      /* Initialize the document to work on */
      body = _initDocument(dirty);
      /* Check we have a DOM node from the data */
      if (!body) {
        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';
      }
    }
    /* Remove first element node (ours) if FORCE_BODY is set */
    if (body && FORCE_BODY) {
      _forceRemove(body.firstChild);
    }
    /* Get node iterator */
    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);
    /* Now start iterating over the created document */
    while (currentNode = nodeIterator.nextNode()) {
      /* Sanitize tags and elements */
      _sanitizeElements(currentNode);
      /* Check attributes next */
      _sanitizeAttributes(currentNode);
      /* Shadow DOM detected, sanitize it */
      if (currentNode.content instanceof DocumentFragment) {
        _sanitizeShadowDOM(currentNode.content);
      }
    }
    /* If we sanitized `dirty` in-place, return it. */
    if (IN_PLACE) {
      return dirty;
    }
    /* Return sanitized string or DOM */
    if (RETURN_DOM) {
      if (RETURN_DOM_FRAGMENT) {
        returnNode = createDocumentFragment.call(body.ownerDocument);
        while (body.firstChild) {
          // eslint-disable-next-line unicorn/prefer-dom-node-append
          returnNode.appendChild(body.firstChild);
        }
      } else {
        returnNode = body;
      }
      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {
        /*
          AdoptNode() is not used because internal state is not reset
          (e.g. the past names map of a HTMLFormElement), this is safe
          in theory but we would rather not risk another attack vector.
          The state that is cloned by importNode() is explicitly defined
          by the specs.
        */
        returnNode = importNode.call(originalDocument, returnNode, true);
      }
      return returnNode;
    }
    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;
    /* Serialize doctype if allowed */
    if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {
      serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\n' + serializedHTML;
    }
    /* Sanitize final string template-safe */
    if (SAFE_FOR_TEMPLATES) {
      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {
        serializedHTML = stringReplace(serializedHTML, expr, ' ');
      });
    }
    return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;
  };
  DOMPurify.setConfig = function () {
    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    _parseConfig(cfg);
    SET_CONFIG = true;
  };
  DOMPurify.clearConfig = function () {
    CONFIG = null;
    SET_CONFIG = false;
  };
  DOMPurify.isValidAttribute = function (tag, attr, value) {
    /* Initialize shared config vars if necessary. */
    if (!CONFIG) {
      _parseConfig({});
    }
    const lcTag = transformCaseFunc(tag);
    const lcName = transformCaseFunc(attr);
    return _isValidAttribute(lcTag, lcName, value);
  };
  DOMPurify.addHook = function (entryPoint, hookFunction) {
    if (typeof hookFunction !== 'function') {
      return;
    }
    arrayPush(hooks[entryPoint], hookFunction);
  };
  DOMPurify.removeHook = function (entryPoint, hookFunction) {
    if (hookFunction !== undefined) {
      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);
      return index === -1 ? undefined : arraySplice(hooks[entryPoint], index, 1)[0];
    }
    return arrayPop(hooks[entryPoint]);
  };
  DOMPurify.removeHooks = function (entryPoint) {
    hooks[entryPoint] = [];
  };
  DOMPurify.removeAllHooks = function () {
    hooks = _createHooksMap();
  };
  return DOMPurify;
}
var purify = createDOMPurify();

const purify_es = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: purify
}, Symbol.toStringTag, { value: 'Module' }));

function sanitizeHTML(dirty) {
  const config = {
    ALLOWED_TAGS: [
      "b",
      "i",
      "strong",
      "em",
      "u",
      "br",
      "p",
      "ul",
      "ol",
      "li",
      "code",
      "pre",
      "a",
      "span",
      "h1",
      "h2",
      "h3",
      "h4",
      "h5",
      "h6",
      "blockquote",
      "hr"
    ],
    ALLOWED_ATTR: ["href", "title", "target", "rel"],
    FORBID_TAGS: ["style", "img", "svg", "math", "iframe", "script", "object", "embed"],
    FORBID_ATTR: ["style", "src", "srcset", "onerror", "onclick"],
    ALLOW_DATA_ATTR: false,
    ADD_ATTR: ["target", "rel"],
    RETURN_TRUSTED_TYPE: false
  };
  let clean = purify.sanitize(dirty, config);
  clean = clean.replace(
    /<a\s+([^>]*href=["'][^"']*["'][^>]*)>/gi,
    '<a $1 target="_blank" rel="noopener noreferrer nofollow">'
  );
  return clean;
}

const NorahChatLLM = ({ userId }) => {
  const { askNorah, isProcessing, isOffline} = useNorahLLM({
    userId,
    route: "/intelligence",
    locale: "it"
  });
  const [messages, setMessages] = reactExports.useState([
    {
      role: "assistant",
      content: " Ciao! Sono NORAH, la tua assistente M1SSION. Come posso aiutarti oggi?",
      timestamp: /* @__PURE__ */ new Date()
    }
  ]);
  const [input, setInput] = reactExports.useState("");
  const scrollRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
    }
  }, [messages]);
  const handleSend = async () => {
    if (!input.trim() || isProcessing) return;
    const userMessage = {
      role: "user",
      content: input.trim(),
      timestamp: /* @__PURE__ */ new Date()
    };
    setMessages((prev) => [...prev, userMessage]);
    setInput("");
    const response = await askNorah(input.trim());
    if (response) {
      setMessages((prev) => [...prev, {
        role: "assistant",
        content: response,
        timestamp: /* @__PURE__ */ new Date()
      }]);
    }
  };
  const handleKeyPress = (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };
  const modalContent = /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "norah-chat-modal-backdrop" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "norah-chat-modal", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "norah-chat-modal__header", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-bold text-white", children: "NORAH AI" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Assistente M1SSION" })
        ] }),
        isOffline && /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "destructive", className: "gap-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(WifiOff, { className: "w-3 h-3" }),
          "Offline"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "norah-chat-modal__body", ref: scrollRef, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3 md:space-y-4", children: [
        messages.map((message, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: `flex gap-3 ${message.role === "assistant" ? "justify-start" : "justify-end"}`,
            children: [
              message.role === "assistant" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-4 h-4 text-white" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "div",
                {
                  className: `max-w-[80%] p-3 rounded-xl ${message.role === "assistant" ? "bg-white/5 text-white" : "bg-gradient-to-r from-[#4361ee] to-[#7209b7] text-white"}`,
                  children: [
                    message.role === "assistant" ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "text-sm prose prose-invert prose-sm max-w-none",
                        dangerouslySetInnerHTML: { __html: sanitizeHTML(message.content) }
                      }
                    ) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm whitespace-pre-wrap", children: message.content }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs opacity-50 mt-1 block", children: message.timestamp.toLocaleTimeString("it-IT", {
                      hour: "2-digit",
                      minute: "2-digit"
                    }) })
                  ]
                }
              ),
              message.role === "user" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-white/10 flex items-center justify-center flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-4 h-4 text-white" }) })
            ]
          },
          index
        )),
        isProcessing && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-3 justify-start", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-4 h-4 text-white animate-pulse" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-white/5 p-3 rounded-xl", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-white/50 rounded-full animate-bounce" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-white/50 rounded-full animate-bounce delay-100" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-white/50 rounded-full animate-bounce delay-200" })
          ] }) })
        ] })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "norah-chat-modal__footer", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              value: input,
              onChange: (e) => setInput(e.target.value),
              onKeyPress: handleKeyPress,
              placeholder: "Chiedi qualcosa a Norah...",
              disabled: isProcessing,
              className: "flex-1 bg-white/10 border-white/20 text-white placeholder:text-white/40"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleSend,
              disabled: !input.trim() || isProcessing,
              size: "icon",
              className: "bg-gradient-to-r from-[#4361ee] to-[#7209b7] hover:opacity-90",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4" })
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/40 mt-2", children: " Chiedi informazioni su BUZZ, piani, Final Shot e molto altro!" })
      ] })
    ] })
  ] });
  return ReactDOM.createPortal(
    modalContent,
    document.body
  );
};

const isString$1 = obj => typeof obj === 'string';
const defer = () => {
  let res;
  let rej;
  const promise = new Promise((resolve, reject) => {
    res = resolve;
    rej = reject;
  });
  promise.resolve = res;
  promise.reject = rej;
  return promise;
};
const makeString = object => {
  if (object == null) return '';
  return '' + object;
};
const copy = (a, s, t) => {
  a.forEach(m => {
    if (s[m]) t[m] = s[m];
  });
};
const lastOfPathSeparatorRegExp = /###/g;
const cleanKey = key => key && key.indexOf('###') > -1 ? key.replace(lastOfPathSeparatorRegExp, '.') : key;
const canNotTraverseDeeper = object => !object || isString$1(object);
const getLastOfPath = (object, path, Empty) => {
  const stack = !isString$1(path) ? path : path.split('.');
  let stackIndex = 0;
  while (stackIndex < stack.length - 1) {
    if (canNotTraverseDeeper(object)) return {};
    const key = cleanKey(stack[stackIndex]);
    if (!object[key] && Empty) object[key] = new Empty();
    if (Object.prototype.hasOwnProperty.call(object, key)) {
      object = object[key];
    } else {
      object = {};
    }
    ++stackIndex;
  }
  if (canNotTraverseDeeper(object)) return {};
  return {
    obj: object,
    k: cleanKey(stack[stackIndex])
  };
};
const setPath = (object, path, newValue) => {
  const {
    obj,
    k
  } = getLastOfPath(object, path, Object);
  if (obj !== undefined || path.length === 1) {
    obj[k] = newValue;
    return;
  }
  let e = path[path.length - 1];
  let p = path.slice(0, path.length - 1);
  let last = getLastOfPath(object, p, Object);
  while (last.obj === undefined && p.length) {
    e = `${p[p.length - 1]}.${e}`;
    p = p.slice(0, p.length - 1);
    last = getLastOfPath(object, p, Object);
    if (last?.obj && typeof last.obj[`${last.k}.${e}`] !== 'undefined') {
      last.obj = undefined;
    }
  }
  last.obj[`${last.k}.${e}`] = newValue;
};
const pushPath = (object, path, newValue, concat) => {
  const {
    obj,
    k
  } = getLastOfPath(object, path, Object);
  obj[k] = obj[k] || [];
  obj[k].push(newValue);
};
const getPath = (object, path) => {
  const {
    obj,
    k
  } = getLastOfPath(object, path);
  if (!obj) return undefined;
  if (!Object.prototype.hasOwnProperty.call(obj, k)) return undefined;
  return obj[k];
};
const getPathWithDefaults = (data, defaultData, key) => {
  const value = getPath(data, key);
  if (value !== undefined) {
    return value;
  }
  return getPath(defaultData, key);
};
const deepExtend = (target, source, overwrite) => {
  for (const prop in source) {
    if (prop !== '__proto__' && prop !== 'constructor') {
      if (prop in target) {
        if (isString$1(target[prop]) || target[prop] instanceof String || isString$1(source[prop]) || source[prop] instanceof String) {
          if (overwrite) target[prop] = source[prop];
        } else {
          deepExtend(target[prop], source[prop], overwrite);
        }
      } else {
        target[prop] = source[prop];
      }
    }
  }
  return target;
};
const regexEscape = str => str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&');
var _entityMap = {
  '&': '&amp;',
  '<': '&lt;',
  '>': '&gt;',
  '"': '&quot;',
  "'": '&#39;',
  '/': '&#x2F;'
};
const escape = data => {
  if (isString$1(data)) {
    return data.replace(/[&<>"'\/]/g, s => _entityMap[s]);
  }
  return data;
};
class RegExpCache {
  constructor(capacity) {
    this.capacity = capacity;
    this.regExpMap = new Map();
    this.regExpQueue = [];
  }
  getRegExp(pattern) {
    const regExpFromCache = this.regExpMap.get(pattern);
    if (regExpFromCache !== undefined) {
      return regExpFromCache;
    }
    const regExpNew = new RegExp(pattern);
    if (this.regExpQueue.length === this.capacity) {
      this.regExpMap.delete(this.regExpQueue.shift());
    }
    this.regExpMap.set(pattern, regExpNew);
    this.regExpQueue.push(pattern);
    return regExpNew;
  }
}
const chars = [' ', ',', '?', '!', ';'];
const looksLikeObjectPathRegExpCache = new RegExpCache(20);
const looksLikeObjectPath = (key, nsSeparator, keySeparator) => {
  nsSeparator = nsSeparator || '';
  keySeparator = keySeparator || '';
  const possibleChars = chars.filter(c => nsSeparator.indexOf(c) < 0 && keySeparator.indexOf(c) < 0);
  if (possibleChars.length === 0) return true;
  const r = looksLikeObjectPathRegExpCache.getRegExp(`(${possibleChars.map(c => c === '?' ? '\\?' : c).join('|')})`);
  let matched = !r.test(key);
  if (!matched) {
    const ki = key.indexOf(keySeparator);
    if (ki > 0 && !r.test(key.substring(0, ki))) {
      matched = true;
    }
  }
  return matched;
};
const deepFind = (obj, path, keySeparator = '.') => {
  if (!obj) return undefined;
  if (obj[path]) {
    if (!Object.prototype.hasOwnProperty.call(obj, path)) return undefined;
    return obj[path];
  }
  const tokens = path.split(keySeparator);
  let current = obj;
  for (let i = 0; i < tokens.length;) {
    if (!current || typeof current !== 'object') {
      return undefined;
    }
    let next;
    let nextPath = '';
    for (let j = i; j < tokens.length; ++j) {
      if (j !== i) {
        nextPath += keySeparator;
      }
      nextPath += tokens[j];
      next = current[nextPath];
      if (next !== undefined) {
        if (['string', 'number', 'boolean'].indexOf(typeof next) > -1 && j < tokens.length - 1) {
          continue;
        }
        i += j - i + 1;
        break;
      }
    }
    current = next;
  }
  return current;
};
const getCleanedCode = code => code?.replace('_', '-');

const consoleLogger = {
  type: 'logger',
  log(args) {
    this.output('log', args);
  },
  warn(args) {
    this.output('warn', args);
  },
  error(args) {
    this.output('error', args);
  },
  output(type, args) {
    console?.[type]?.apply?.(console, args);
  }
};
class Logger {
  constructor(concreteLogger, options = {}) {
    this.init(concreteLogger, options);
  }
  init(concreteLogger, options = {}) {
    this.prefix = options.prefix || 'i18next:';
    this.logger = concreteLogger || consoleLogger;
    this.options = options;
    this.debug = options.debug;
  }
  log(...args) {
    return this.forward(args, 'log', '', true);
  }
  warn(...args) {
    return this.forward(args, 'warn', '', true);
  }
  error(...args) {
    return this.forward(args, 'error', '');
  }
  deprecate(...args) {
    return this.forward(args, 'warn', 'WARNING DEPRECATED: ', true);
  }
  forward(args, lvl, prefix, debugOnly) {
    if (debugOnly && !this.debug) return null;
    if (isString$1(args[0])) args[0] = `${prefix}${this.prefix} ${args[0]}`;
    return this.logger[lvl](args);
  }
  create(moduleName) {
    return new Logger(this.logger, {
      ...{
        prefix: `${this.prefix}:${moduleName}:`
      },
      ...this.options
    });
  }
  clone(options) {
    options = options || this.options;
    options.prefix = options.prefix || this.prefix;
    return new Logger(this.logger, options);
  }
}
var baseLogger = new Logger();

class EventEmitter {
  constructor() {
    this.observers = {};
  }
  on(events, listener) {
    events.split(' ').forEach(event => {
      if (!this.observers[event]) this.observers[event] = new Map();
      const numListeners = this.observers[event].get(listener) || 0;
      this.observers[event].set(listener, numListeners + 1);
    });
    return this;
  }
  off(event, listener) {
    if (!this.observers[event]) return;
    if (!listener) {
      delete this.observers[event];
      return;
    }
    this.observers[event].delete(listener);
  }
  emit(event, ...args) {
    if (this.observers[event]) {
      const cloned = Array.from(this.observers[event].entries());
      cloned.forEach(([observer, numTimesAdded]) => {
        for (let i = 0; i < numTimesAdded; i++) {
          observer(...args);
        }
      });
    }
    if (this.observers['*']) {
      const cloned = Array.from(this.observers['*'].entries());
      cloned.forEach(([observer, numTimesAdded]) => {
        for (let i = 0; i < numTimesAdded; i++) {
          observer.apply(observer, [event, ...args]);
        }
      });
    }
  }
}

class ResourceStore extends EventEmitter {
  constructor(data, options = {
    ns: ['translation'],
    defaultNS: 'translation'
  }) {
    super();
    this.data = data || {};
    this.options = options;
    if (this.options.keySeparator === undefined) {
      this.options.keySeparator = '.';
    }
    if (this.options.ignoreJSONStructure === undefined) {
      this.options.ignoreJSONStructure = true;
    }
  }
  addNamespaces(ns) {
    if (this.options.ns.indexOf(ns) < 0) {
      this.options.ns.push(ns);
    }
  }
  removeNamespaces(ns) {
    const index = this.options.ns.indexOf(ns);
    if (index > -1) {
      this.options.ns.splice(index, 1);
    }
  }
  getResource(lng, ns, key, options = {}) {
    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;
    const ignoreJSONStructure = options.ignoreJSONStructure !== undefined ? options.ignoreJSONStructure : this.options.ignoreJSONStructure;
    let path;
    if (lng.indexOf('.') > -1) {
      path = lng.split('.');
    } else {
      path = [lng, ns];
      if (key) {
        if (Array.isArray(key)) {
          path.push(...key);
        } else if (isString$1(key) && keySeparator) {
          path.push(...key.split(keySeparator));
        } else {
          path.push(key);
        }
      }
    }
    const result = getPath(this.data, path);
    if (!result && !ns && !key && lng.indexOf('.') > -1) {
      lng = path[0];
      ns = path[1];
      key = path.slice(2).join('.');
    }
    if (result || !ignoreJSONStructure || !isString$1(key)) return result;
    return deepFind(this.data?.[lng]?.[ns], key, keySeparator);
  }
  addResource(lng, ns, key, value, options = {
    silent: false
  }) {
    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;
    let path = [lng, ns];
    if (key) path = path.concat(keySeparator ? key.split(keySeparator) : key);
    if (lng.indexOf('.') > -1) {
      path = lng.split('.');
      value = ns;
      ns = path[1];
    }
    this.addNamespaces(ns);
    setPath(this.data, path, value);
    if (!options.silent) this.emit('added', lng, ns, key, value);
  }
  addResources(lng, ns, resources, options = {
    silent: false
  }) {
    for (const m in resources) {
      if (isString$1(resources[m]) || Array.isArray(resources[m])) this.addResource(lng, ns, m, resources[m], {
        silent: true
      });
    }
    if (!options.silent) this.emit('added', lng, ns, resources);
  }
  addResourceBundle(lng, ns, resources, deep, overwrite, options = {
    silent: false,
    skipCopy: false
  }) {
    let path = [lng, ns];
    if (lng.indexOf('.') > -1) {
      path = lng.split('.');
      deep = resources;
      resources = ns;
      ns = path[1];
    }
    this.addNamespaces(ns);
    let pack = getPath(this.data, path) || {};
    if (!options.skipCopy) resources = JSON.parse(JSON.stringify(resources));
    if (deep) {
      deepExtend(pack, resources, overwrite);
    } else {
      pack = {
        ...pack,
        ...resources
      };
    }
    setPath(this.data, path, pack);
    if (!options.silent) this.emit('added', lng, ns, resources);
  }
  removeResourceBundle(lng, ns) {
    if (this.hasResourceBundle(lng, ns)) {
      delete this.data[lng][ns];
    }
    this.removeNamespaces(ns);
    this.emit('removed', lng, ns);
  }
  hasResourceBundle(lng, ns) {
    return this.getResource(lng, ns) !== undefined;
  }
  getResourceBundle(lng, ns) {
    if (!ns) ns = this.options.defaultNS;
    return this.getResource(lng, ns);
  }
  getDataByLanguage(lng) {
    return this.data[lng];
  }
  hasLanguageSomeTranslations(lng) {
    const data = this.getDataByLanguage(lng);
    const n = data && Object.keys(data) || [];
    return !!n.find(v => data[v] && Object.keys(data[v]).length > 0);
  }
  toJSON() {
    return this.data;
  }
}

var postProcessor = {
  processors: {},
  addPostProcessor(module) {
    this.processors[module.name] = module;
  },
  handle(processors, value, key, options, translator) {
    processors.forEach(processor => {
      value = this.processors[processor]?.process(value, key, options, translator) ?? value;
    });
    return value;
  }
};

const PATH_KEY = Symbol('i18next/PATH_KEY');
function createProxy() {
  const state = [];
  const handler = Object.create(null);
  let proxy;
  handler.get = (target, key) => {
    proxy?.revoke?.();
    if (key === PATH_KEY) return state;
    state.push(key);
    proxy = Proxy.revocable(target, handler);
    return proxy.proxy;
  };
  return Proxy.revocable(Object.create(null), handler).proxy;
}
function keysFromSelector(selector, opts) {
  const {
    [PATH_KEY]: path
  } = selector(createProxy());
  return path.join(opts?.keySeparator ?? '.');
}

const checkedLoadedFor = {};
const shouldHandleAsObject = res => !isString$1(res) && typeof res !== 'boolean' && typeof res !== 'number';
class Translator extends EventEmitter {
  constructor(services, options = {}) {
    super();
    copy(['resourceStore', 'languageUtils', 'pluralResolver', 'interpolator', 'backendConnector', 'i18nFormat', 'utils'], services, this);
    this.options = options;
    if (this.options.keySeparator === undefined) {
      this.options.keySeparator = '.';
    }
    this.logger = baseLogger.create('translator');
  }
  changeLanguage(lng) {
    if (lng) this.language = lng;
  }
  exists(key, o = {
    interpolation: {}
  }) {
    const opt = {
      ...o
    };
    if (key == null) return false;
    const resolved = this.resolve(key, opt);
    if (resolved?.res === undefined) return false;
    const isObject = shouldHandleAsObject(resolved.res);
    if (opt.returnObjects === false && isObject) {
      return false;
    }
    return true;
  }
  extractFromKey(key, opt) {
    let nsSeparator = opt.nsSeparator !== undefined ? opt.nsSeparator : this.options.nsSeparator;
    if (nsSeparator === undefined) nsSeparator = ':';
    const keySeparator = opt.keySeparator !== undefined ? opt.keySeparator : this.options.keySeparator;
    let namespaces = opt.ns || this.options.defaultNS || [];
    const wouldCheckForNsInKey = nsSeparator && key.indexOf(nsSeparator) > -1;
    const seemsNaturalLanguage = !this.options.userDefinedKeySeparator && !opt.keySeparator && !this.options.userDefinedNsSeparator && !opt.nsSeparator && !looksLikeObjectPath(key, nsSeparator, keySeparator);
    if (wouldCheckForNsInKey && !seemsNaturalLanguage) {
      const m = key.match(this.interpolator.nestingRegexp);
      if (m && m.length > 0) {
        return {
          key,
          namespaces: isString$1(namespaces) ? [namespaces] : namespaces
        };
      }
      const parts = key.split(nsSeparator);
      if (nsSeparator !== keySeparator || nsSeparator === keySeparator && this.options.ns.indexOf(parts[0]) > -1) namespaces = parts.shift();
      key = parts.join(keySeparator);
    }
    return {
      key,
      namespaces: isString$1(namespaces) ? [namespaces] : namespaces
    };
  }
  translate(keys, o, lastKey) {
    let opt = typeof o === 'object' ? {
      ...o
    } : o;
    if (typeof opt !== 'object' && this.options.overloadTranslationOptionHandler) {
      opt = this.options.overloadTranslationOptionHandler(arguments);
    }
    if (typeof opt === 'object') opt = {
      ...opt
    };
    if (!opt) opt = {};
    if (keys == null) return '';
    if (typeof keys === 'function') keys = keysFromSelector(keys, {
      ...this.options,
      ...opt
    });
    if (!Array.isArray(keys)) keys = [String(keys)];
    const returnDetails = opt.returnDetails !== undefined ? opt.returnDetails : this.options.returnDetails;
    const keySeparator = opt.keySeparator !== undefined ? opt.keySeparator : this.options.keySeparator;
    const {
      key,
      namespaces
    } = this.extractFromKey(keys[keys.length - 1], opt);
    const namespace = namespaces[namespaces.length - 1];
    let nsSeparator = opt.nsSeparator !== undefined ? opt.nsSeparator : this.options.nsSeparator;
    if (nsSeparator === undefined) nsSeparator = ':';
    const lng = opt.lng || this.language;
    const appendNamespaceToCIMode = opt.appendNamespaceToCIMode || this.options.appendNamespaceToCIMode;
    if (lng?.toLowerCase() === 'cimode') {
      if (appendNamespaceToCIMode) {
        if (returnDetails) {
          return {
            res: `${namespace}${nsSeparator}${key}`,
            usedKey: key,
            exactUsedKey: key,
            usedLng: lng,
            usedNS: namespace,
            usedParams: this.getUsedParamsDetails(opt)
          };
        }
        return `${namespace}${nsSeparator}${key}`;
      }
      if (returnDetails) {
        return {
          res: key,
          usedKey: key,
          exactUsedKey: key,
          usedLng: lng,
          usedNS: namespace,
          usedParams: this.getUsedParamsDetails(opt)
        };
      }
      return key;
    }
    const resolved = this.resolve(keys, opt);
    let res = resolved?.res;
    const resUsedKey = resolved?.usedKey || key;
    const resExactUsedKey = resolved?.exactUsedKey || key;
    const noObject = ['[object Number]', '[object Function]', '[object RegExp]'];
    const joinArrays = opt.joinArrays !== undefined ? opt.joinArrays : this.options.joinArrays;
    const handleAsObjectInI18nFormat = !this.i18nFormat || this.i18nFormat.handleAsObject;
    const needsPluralHandling = opt.count !== undefined && !isString$1(opt.count);
    const hasDefaultValue = Translator.hasDefaultValue(opt);
    const defaultValueSuffix = needsPluralHandling ? this.pluralResolver.getSuffix(lng, opt.count, opt) : '';
    const defaultValueSuffixOrdinalFallback = opt.ordinal && needsPluralHandling ? this.pluralResolver.getSuffix(lng, opt.count, {
      ordinal: false
    }) : '';
    const needsZeroSuffixLookup = needsPluralHandling && !opt.ordinal && opt.count === 0;
    const defaultValue = needsZeroSuffixLookup && opt[`defaultValue${this.options.pluralSeparator}zero`] || opt[`defaultValue${defaultValueSuffix}`] || opt[`defaultValue${defaultValueSuffixOrdinalFallback}`] || opt.defaultValue;
    let resForObjHndl = res;
    if (handleAsObjectInI18nFormat && !res && hasDefaultValue) {
      resForObjHndl = defaultValue;
    }
    const handleAsObject = shouldHandleAsObject(resForObjHndl);
    const resType = Object.prototype.toString.apply(resForObjHndl);
    if (handleAsObjectInI18nFormat && resForObjHndl && handleAsObject && noObject.indexOf(resType) < 0 && !(isString$1(joinArrays) && Array.isArray(resForObjHndl))) {
      if (!opt.returnObjects && !this.options.returnObjects) {
        if (!this.options.returnedObjectHandler) {
          this.logger.warn('accessing an object - but returnObjects options is not enabled!');
        }
        const r = this.options.returnedObjectHandler ? this.options.returnedObjectHandler(resUsedKey, resForObjHndl, {
          ...opt,
          ns: namespaces
        }) : `key '${key} (${this.language})' returned an object instead of string.`;
        if (returnDetails) {
          resolved.res = r;
          resolved.usedParams = this.getUsedParamsDetails(opt);
          return resolved;
        }
        return r;
      }
      if (keySeparator) {
        const resTypeIsArray = Array.isArray(resForObjHndl);
        const copy = resTypeIsArray ? [] : {};
        const newKeyToUse = resTypeIsArray ? resExactUsedKey : resUsedKey;
        for (const m in resForObjHndl) {
          if (Object.prototype.hasOwnProperty.call(resForObjHndl, m)) {
            const deepKey = `${newKeyToUse}${keySeparator}${m}`;
            if (hasDefaultValue && !res) {
              copy[m] = this.translate(deepKey, {
                ...opt,
                defaultValue: shouldHandleAsObject(defaultValue) ? defaultValue[m] : undefined,
                ...{
                  joinArrays: false,
                  ns: namespaces
                }
              });
            } else {
              copy[m] = this.translate(deepKey, {
                ...opt,
                ...{
                  joinArrays: false,
                  ns: namespaces
                }
              });
            }
            if (copy[m] === deepKey) copy[m] = resForObjHndl[m];
          }
        }
        res = copy;
      }
    } else if (handleAsObjectInI18nFormat && isString$1(joinArrays) && Array.isArray(res)) {
      res = res.join(joinArrays);
      if (res) res = this.extendTranslation(res, keys, opt, lastKey);
    } else {
      let usedDefault = false;
      let usedKey = false;
      if (!this.isValidLookup(res) && hasDefaultValue) {
        usedDefault = true;
        res = defaultValue;
      }
      if (!this.isValidLookup(res)) {
        usedKey = true;
        res = key;
      }
      const missingKeyNoValueFallbackToKey = opt.missingKeyNoValueFallbackToKey || this.options.missingKeyNoValueFallbackToKey;
      const resForMissing = missingKeyNoValueFallbackToKey && usedKey ? undefined : res;
      const updateMissing = hasDefaultValue && defaultValue !== res && this.options.updateMissing;
      if (usedKey || usedDefault || updateMissing) {
        this.logger.log(updateMissing ? 'updateKey' : 'missingKey', lng, namespace, key, updateMissing ? defaultValue : res);
        if (keySeparator) {
          const fk = this.resolve(key, {
            ...opt,
            keySeparator: false
          });
          if (fk && fk.res) this.logger.warn('Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.');
        }
        let lngs = [];
        const fallbackLngs = this.languageUtils.getFallbackCodes(this.options.fallbackLng, opt.lng || this.language);
        if (this.options.saveMissingTo === 'fallback' && fallbackLngs && fallbackLngs[0]) {
          for (let i = 0; i < fallbackLngs.length; i++) {
            lngs.push(fallbackLngs[i]);
          }
        } else if (this.options.saveMissingTo === 'all') {
          lngs = this.languageUtils.toResolveHierarchy(opt.lng || this.language);
        } else {
          lngs.push(opt.lng || this.language);
        }
        const send = (l, k, specificDefaultValue) => {
          const defaultForMissing = hasDefaultValue && specificDefaultValue !== res ? specificDefaultValue : resForMissing;
          if (this.options.missingKeyHandler) {
            this.options.missingKeyHandler(l, namespace, k, defaultForMissing, updateMissing, opt);
          } else if (this.backendConnector?.saveMissing) {
            this.backendConnector.saveMissing(l, namespace, k, defaultForMissing, updateMissing, opt);
          }
          this.emit('missingKey', l, namespace, k, res);
        };
        if (this.options.saveMissing) {
          if (this.options.saveMissingPlurals && needsPluralHandling) {
            lngs.forEach(language => {
              const suffixes = this.pluralResolver.getSuffixes(language, opt);
              if (needsZeroSuffixLookup && opt[`defaultValue${this.options.pluralSeparator}zero`] && suffixes.indexOf(`${this.options.pluralSeparator}zero`) < 0) {
                suffixes.push(`${this.options.pluralSeparator}zero`);
              }
              suffixes.forEach(suffix => {
                send([language], key + suffix, opt[`defaultValue${suffix}`] || defaultValue);
              });
            });
          } else {
            send(lngs, key, defaultValue);
          }
        }
      }
      res = this.extendTranslation(res, keys, opt, resolved, lastKey);
      if (usedKey && res === key && this.options.appendNamespaceToMissingKey) {
        res = `${namespace}${nsSeparator}${key}`;
      }
      if ((usedKey || usedDefault) && this.options.parseMissingKeyHandler) {
        res = this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey ? `${namespace}${nsSeparator}${key}` : key, usedDefault ? res : undefined, opt);
      }
    }
    if (returnDetails) {
      resolved.res = res;
      resolved.usedParams = this.getUsedParamsDetails(opt);
      return resolved;
    }
    return res;
  }
  extendTranslation(res, key, opt, resolved, lastKey) {
    if (this.i18nFormat?.parse) {
      res = this.i18nFormat.parse(res, {
        ...this.options.interpolation.defaultVariables,
        ...opt
      }, opt.lng || this.language || resolved.usedLng, resolved.usedNS, resolved.usedKey, {
        resolved
      });
    } else if (!opt.skipInterpolation) {
      if (opt.interpolation) this.interpolator.init({
        ...opt,
        ...{
          interpolation: {
            ...this.options.interpolation,
            ...opt.interpolation
          }
        }
      });
      const skipOnVariables = isString$1(res) && (opt?.interpolation?.skipOnVariables !== undefined ? opt.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables);
      let nestBef;
      if (skipOnVariables) {
        const nb = res.match(this.interpolator.nestingRegexp);
        nestBef = nb && nb.length;
      }
      let data = opt.replace && !isString$1(opt.replace) ? opt.replace : opt;
      if (this.options.interpolation.defaultVariables) data = {
        ...this.options.interpolation.defaultVariables,
        ...data
      };
      res = this.interpolator.interpolate(res, data, opt.lng || this.language || resolved.usedLng, opt);
      if (skipOnVariables) {
        const na = res.match(this.interpolator.nestingRegexp);
        const nestAft = na && na.length;
        if (nestBef < nestAft) opt.nest = false;
      }
      if (!opt.lng && resolved && resolved.res) opt.lng = this.language || resolved.usedLng;
      if (opt.nest !== false) res = this.interpolator.nest(res, (...args) => {
        if (lastKey?.[0] === args[0] && !opt.context) {
          this.logger.warn(`It seems you are nesting recursively key: ${args[0]} in key: ${key[0]}`);
          return null;
        }
        return this.translate(...args, key);
      }, opt);
      if (opt.interpolation) this.interpolator.reset();
    }
    const postProcess = opt.postProcess || this.options.postProcess;
    const postProcessorNames = isString$1(postProcess) ? [postProcess] : postProcess;
    if (res != null && postProcessorNames?.length && opt.applyPostProcessor !== false) {
      res = postProcessor.handle(postProcessorNames, res, key, this.options && this.options.postProcessPassResolved ? {
        i18nResolved: {
          ...resolved,
          usedParams: this.getUsedParamsDetails(opt)
        },
        ...opt
      } : opt, this);
    }
    return res;
  }
  resolve(keys, opt = {}) {
    let found;
    let usedKey;
    let exactUsedKey;
    let usedLng;
    let usedNS;
    if (isString$1(keys)) keys = [keys];
    keys.forEach(k => {
      if (this.isValidLookup(found)) return;
      const extracted = this.extractFromKey(k, opt);
      const key = extracted.key;
      usedKey = key;
      let namespaces = extracted.namespaces;
      if (this.options.fallbackNS) namespaces = namespaces.concat(this.options.fallbackNS);
      const needsPluralHandling = opt.count !== undefined && !isString$1(opt.count);
      const needsZeroSuffixLookup = needsPluralHandling && !opt.ordinal && opt.count === 0;
      const needsContextHandling = opt.context !== undefined && (isString$1(opt.context) || typeof opt.context === 'number') && opt.context !== '';
      const codes = opt.lngs ? opt.lngs : this.languageUtils.toResolveHierarchy(opt.lng || this.language, opt.fallbackLng);
      namespaces.forEach(ns => {
        if (this.isValidLookup(found)) return;
        usedNS = ns;
        if (!checkedLoadedFor[`${codes[0]}-${ns}`] && this.utils?.hasLoadedNamespace && !this.utils?.hasLoadedNamespace(usedNS)) {
          checkedLoadedFor[`${codes[0]}-${ns}`] = true;
          this.logger.warn(`key "${usedKey}" for languages "${codes.join(', ')}" won't get resolved as namespace "${usedNS}" was not yet loaded`, 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');
        }
        codes.forEach(code => {
          if (this.isValidLookup(found)) return;
          usedLng = code;
          const finalKeys = [key];
          if (this.i18nFormat?.addLookupKeys) {
            this.i18nFormat.addLookupKeys(finalKeys, key, code, ns, opt);
          } else {
            let pluralSuffix;
            if (needsPluralHandling) pluralSuffix = this.pluralResolver.getSuffix(code, opt.count, opt);
            const zeroSuffix = `${this.options.pluralSeparator}zero`;
            const ordinalPrefix = `${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;
            if (needsPluralHandling) {
              if (opt.ordinal && pluralSuffix.indexOf(ordinalPrefix) === 0) {
                finalKeys.push(key + pluralSuffix.replace(ordinalPrefix, this.options.pluralSeparator));
              }
              finalKeys.push(key + pluralSuffix);
              if (needsZeroSuffixLookup) {
                finalKeys.push(key + zeroSuffix);
              }
            }
            if (needsContextHandling) {
              const contextKey = `${key}${this.options.contextSeparator || '_'}${opt.context}`;
              finalKeys.push(contextKey);
              if (needsPluralHandling) {
                if (opt.ordinal && pluralSuffix.indexOf(ordinalPrefix) === 0) {
                  finalKeys.push(contextKey + pluralSuffix.replace(ordinalPrefix, this.options.pluralSeparator));
                }
                finalKeys.push(contextKey + pluralSuffix);
                if (needsZeroSuffixLookup) {
                  finalKeys.push(contextKey + zeroSuffix);
                }
              }
            }
          }
          let possibleKey;
          while (possibleKey = finalKeys.pop()) {
            if (!this.isValidLookup(found)) {
              exactUsedKey = possibleKey;
              found = this.getResource(code, ns, possibleKey, opt);
            }
          }
        });
      });
    });
    return {
      res: found,
      usedKey,
      exactUsedKey,
      usedLng,
      usedNS
    };
  }
  isValidLookup(res) {
    return res !== undefined && !(!this.options.returnNull && res === null) && !(!this.options.returnEmptyString && res === '');
  }
  getResource(code, ns, key, options = {}) {
    if (this.i18nFormat?.getResource) return this.i18nFormat.getResource(code, ns, key, options);
    return this.resourceStore.getResource(code, ns, key, options);
  }
  getUsedParamsDetails(options = {}) {
    const optionsKeys = ['defaultValue', 'ordinal', 'context', 'replace', 'lng', 'lngs', 'fallbackLng', 'ns', 'keySeparator', 'nsSeparator', 'returnObjects', 'returnDetails', 'joinArrays', 'postProcess', 'interpolation'];
    const useOptionsReplaceForData = options.replace && !isString$1(options.replace);
    let data = useOptionsReplaceForData ? options.replace : options;
    if (useOptionsReplaceForData && typeof options.count !== 'undefined') {
      data.count = options.count;
    }
    if (this.options.interpolation.defaultVariables) {
      data = {
        ...this.options.interpolation.defaultVariables,
        ...data
      };
    }
    if (!useOptionsReplaceForData) {
      data = {
        ...data
      };
      for (const key of optionsKeys) {
        delete data[key];
      }
    }
    return data;
  }
  static hasDefaultValue(options) {
    const prefix = 'defaultValue';
    for (const option in options) {
      if (Object.prototype.hasOwnProperty.call(options, option) && prefix === option.substring(0, prefix.length) && undefined !== options[option]) {
        return true;
      }
    }
    return false;
  }
}

class LanguageUtil {
  constructor(options) {
    this.options = options;
    this.supportedLngs = this.options.supportedLngs || false;
    this.logger = baseLogger.create('languageUtils');
  }
  getScriptPartFromCode(code) {
    code = getCleanedCode(code);
    if (!code || code.indexOf('-') < 0) return null;
    const p = code.split('-');
    if (p.length === 2) return null;
    p.pop();
    if (p[p.length - 1].toLowerCase() === 'x') return null;
    return this.formatLanguageCode(p.join('-'));
  }
  getLanguagePartFromCode(code) {
    code = getCleanedCode(code);
    if (!code || code.indexOf('-') < 0) return code;
    const p = code.split('-');
    return this.formatLanguageCode(p[0]);
  }
  formatLanguageCode(code) {
    if (isString$1(code) && code.indexOf('-') > -1) {
      let formattedCode;
      try {
        formattedCode = Intl.getCanonicalLocales(code)[0];
      } catch (e) {}
      if (formattedCode && this.options.lowerCaseLng) {
        formattedCode = formattedCode.toLowerCase();
      }
      if (formattedCode) return formattedCode;
      if (this.options.lowerCaseLng) {
        return code.toLowerCase();
      }
      return code;
    }
    return this.options.cleanCode || this.options.lowerCaseLng ? code.toLowerCase() : code;
  }
  isSupportedCode(code) {
    if (this.options.load === 'languageOnly' || this.options.nonExplicitSupportedLngs) {
      code = this.getLanguagePartFromCode(code);
    }
    return !this.supportedLngs || !this.supportedLngs.length || this.supportedLngs.indexOf(code) > -1;
  }
  getBestMatchFromCodes(codes) {
    if (!codes) return null;
    let found;
    codes.forEach(code => {
      if (found) return;
      const cleanedLng = this.formatLanguageCode(code);
      if (!this.options.supportedLngs || this.isSupportedCode(cleanedLng)) found = cleanedLng;
    });
    if (!found && this.options.supportedLngs) {
      codes.forEach(code => {
        if (found) return;
        const lngScOnly = this.getScriptPartFromCode(code);
        if (this.isSupportedCode(lngScOnly)) return found = lngScOnly;
        const lngOnly = this.getLanguagePartFromCode(code);
        if (this.isSupportedCode(lngOnly)) return found = lngOnly;
        found = this.options.supportedLngs.find(supportedLng => {
          if (supportedLng === lngOnly) return supportedLng;
          if (supportedLng.indexOf('-') < 0 && lngOnly.indexOf('-') < 0) return;
          if (supportedLng.indexOf('-') > 0 && lngOnly.indexOf('-') < 0 && supportedLng.substring(0, supportedLng.indexOf('-')) === lngOnly) return supportedLng;
          if (supportedLng.indexOf(lngOnly) === 0 && lngOnly.length > 1) return supportedLng;
        });
      });
    }
    if (!found) found = this.getFallbackCodes(this.options.fallbackLng)[0];
    return found;
  }
  getFallbackCodes(fallbacks, code) {
    if (!fallbacks) return [];
    if (typeof fallbacks === 'function') fallbacks = fallbacks(code);
    if (isString$1(fallbacks)) fallbacks = [fallbacks];
    if (Array.isArray(fallbacks)) return fallbacks;
    if (!code) return fallbacks.default || [];
    let found = fallbacks[code];
    if (!found) found = fallbacks[this.getScriptPartFromCode(code)];
    if (!found) found = fallbacks[this.formatLanguageCode(code)];
    if (!found) found = fallbacks[this.getLanguagePartFromCode(code)];
    if (!found) found = fallbacks.default;
    return found || [];
  }
  toResolveHierarchy(code, fallbackCode) {
    const fallbackCodes = this.getFallbackCodes((fallbackCode === false ? [] : fallbackCode) || this.options.fallbackLng || [], code);
    const codes = [];
    const addCode = c => {
      if (!c) return;
      if (this.isSupportedCode(c)) {
        codes.push(c);
      } else {
        this.logger.warn(`rejecting language code not found in supportedLngs: ${c}`);
      }
    };
    if (isString$1(code) && (code.indexOf('-') > -1 || code.indexOf('_') > -1)) {
      if (this.options.load !== 'languageOnly') addCode(this.formatLanguageCode(code));
      if (this.options.load !== 'languageOnly' && this.options.load !== 'currentOnly') addCode(this.getScriptPartFromCode(code));
      if (this.options.load !== 'currentOnly') addCode(this.getLanguagePartFromCode(code));
    } else if (isString$1(code)) {
      addCode(this.formatLanguageCode(code));
    }
    fallbackCodes.forEach(fc => {
      if (codes.indexOf(fc) < 0) addCode(this.formatLanguageCode(fc));
    });
    return codes;
  }
}

const suffixesOrder = {
  zero: 0,
  one: 1,
  two: 2,
  few: 3,
  many: 4,
  other: 5
};
const dummyRule = {
  select: count => count === 1 ? 'one' : 'other',
  resolvedOptions: () => ({
    pluralCategories: ['one', 'other']
  })
};
class PluralResolver {
  constructor(languageUtils, options = {}) {
    this.languageUtils = languageUtils;
    this.options = options;
    this.logger = baseLogger.create('pluralResolver');
    this.pluralRulesCache = {};
  }
  addRule(lng, obj) {
    this.rules[lng] = obj;
  }
  clearCache() {
    this.pluralRulesCache = {};
  }
  getRule(code, options = {}) {
    const cleanedCode = getCleanedCode(code === 'dev' ? 'en' : code);
    const type = options.ordinal ? 'ordinal' : 'cardinal';
    const cacheKey = JSON.stringify({
      cleanedCode,
      type
    });
    if (cacheKey in this.pluralRulesCache) {
      return this.pluralRulesCache[cacheKey];
    }
    let rule;
    try {
      rule = new Intl.PluralRules(cleanedCode, {
        type
      });
    } catch (err) {
      if (!Intl) {
        this.logger.error('No Intl support, please use an Intl polyfill!');
        return dummyRule;
      }
      if (!code.match(/-|_/)) return dummyRule;
      const lngPart = this.languageUtils.getLanguagePartFromCode(code);
      rule = this.getRule(lngPart, options);
    }
    this.pluralRulesCache[cacheKey] = rule;
    return rule;
  }
  needsPlural(code, options = {}) {
    let rule = this.getRule(code, options);
    if (!rule) rule = this.getRule('dev', options);
    return rule?.resolvedOptions().pluralCategories.length > 1;
  }
  getPluralFormsOfKey(code, key, options = {}) {
    return this.getSuffixes(code, options).map(suffix => `${key}${suffix}`);
  }
  getSuffixes(code, options = {}) {
    let rule = this.getRule(code, options);
    if (!rule) rule = this.getRule('dev', options);
    if (!rule) return [];
    return rule.resolvedOptions().pluralCategories.sort((pluralCategory1, pluralCategory2) => suffixesOrder[pluralCategory1] - suffixesOrder[pluralCategory2]).map(pluralCategory => `${this.options.prepend}${options.ordinal ? `ordinal${this.options.prepend}` : ''}${pluralCategory}`);
  }
  getSuffix(code, count, options = {}) {
    const rule = this.getRule(code, options);
    if (rule) {
      return `${this.options.prepend}${options.ordinal ? `ordinal${this.options.prepend}` : ''}${rule.select(count)}`;
    }
    this.logger.warn(`no plural rule found for: ${code}`);
    return this.getSuffix('dev', count, options);
  }
}

const deepFindWithDefaults = (data, defaultData, key, keySeparator = '.', ignoreJSONStructure = true) => {
  let path = getPathWithDefaults(data, defaultData, key);
  if (!path && ignoreJSONStructure && isString$1(key)) {
    path = deepFind(data, key, keySeparator);
    if (path === undefined) path = deepFind(defaultData, key, keySeparator);
  }
  return path;
};
const regexSafe = val => val.replace(/\$/g, '$$$$');
class Interpolator {
  constructor(options = {}) {
    this.logger = baseLogger.create('interpolator');
    this.options = options;
    this.format = options?.interpolation?.format || (value => value);
    this.init(options);
  }
  init(options = {}) {
    if (!options.interpolation) options.interpolation = {
      escapeValue: true
    };
    const {
      escape: escape$1,
      escapeValue,
      useRawValueToEscape,
      prefix,
      prefixEscaped,
      suffix,
      suffixEscaped,
      formatSeparator,
      unescapeSuffix,
      unescapePrefix,
      nestingPrefix,
      nestingPrefixEscaped,
      nestingSuffix,
      nestingSuffixEscaped,
      nestingOptionsSeparator,
      maxReplaces,
      alwaysFormat
    } = options.interpolation;
    this.escape = escape$1 !== undefined ? escape$1 : escape;
    this.escapeValue = escapeValue !== undefined ? escapeValue : true;
    this.useRawValueToEscape = useRawValueToEscape !== undefined ? useRawValueToEscape : false;
    this.prefix = prefix ? regexEscape(prefix) : prefixEscaped || '{{';
    this.suffix = suffix ? regexEscape(suffix) : suffixEscaped || '}}';
    this.formatSeparator = formatSeparator || ',';
    this.unescapePrefix = unescapeSuffix ? '' : unescapePrefix || '-';
    this.unescapeSuffix = this.unescapePrefix ? '' : unescapeSuffix || '';
    this.nestingPrefix = nestingPrefix ? regexEscape(nestingPrefix) : nestingPrefixEscaped || regexEscape('$t(');
    this.nestingSuffix = nestingSuffix ? regexEscape(nestingSuffix) : nestingSuffixEscaped || regexEscape(')');
    this.nestingOptionsSeparator = nestingOptionsSeparator || ',';
    this.maxReplaces = maxReplaces || 1000;
    this.alwaysFormat = alwaysFormat !== undefined ? alwaysFormat : false;
    this.resetRegExp();
  }
  reset() {
    if (this.options) this.init(this.options);
  }
  resetRegExp() {
    const getOrResetRegExp = (existingRegExp, pattern) => {
      if (existingRegExp?.source === pattern) {
        existingRegExp.lastIndex = 0;
        return existingRegExp;
      }
      return new RegExp(pattern, 'g');
    };
    this.regexp = getOrResetRegExp(this.regexp, `${this.prefix}(.+?)${this.suffix}`);
    this.regexpUnescape = getOrResetRegExp(this.regexpUnescape, `${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`);
    this.nestingRegexp = getOrResetRegExp(this.nestingRegexp, `${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`);
  }
  interpolate(str, data, lng, options) {
    let match;
    let value;
    let replaces;
    const defaultData = this.options && this.options.interpolation && this.options.interpolation.defaultVariables || {};
    const handleFormat = key => {
      if (key.indexOf(this.formatSeparator) < 0) {
        const path = deepFindWithDefaults(data, defaultData, key, this.options.keySeparator, this.options.ignoreJSONStructure);
        return this.alwaysFormat ? this.format(path, undefined, lng, {
          ...options,
          ...data,
          interpolationkey: key
        }) : path;
      }
      const p = key.split(this.formatSeparator);
      const k = p.shift().trim();
      const f = p.join(this.formatSeparator).trim();
      return this.format(deepFindWithDefaults(data, defaultData, k, this.options.keySeparator, this.options.ignoreJSONStructure), f, lng, {
        ...options,
        ...data,
        interpolationkey: k
      });
    };
    this.resetRegExp();
    const missingInterpolationHandler = options?.missingInterpolationHandler || this.options.missingInterpolationHandler;
    const skipOnVariables = options?.interpolation?.skipOnVariables !== undefined ? options.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables;
    const todos = [{
      regex: this.regexpUnescape,
      safeValue: val => regexSafe(val)
    }, {
      regex: this.regexp,
      safeValue: val => this.escapeValue ? regexSafe(this.escape(val)) : regexSafe(val)
    }];
    todos.forEach(todo => {
      replaces = 0;
      while (match = todo.regex.exec(str)) {
        const matchedVar = match[1].trim();
        value = handleFormat(matchedVar);
        if (value === undefined) {
          if (typeof missingInterpolationHandler === 'function') {
            const temp = missingInterpolationHandler(str, match, options);
            value = isString$1(temp) ? temp : '';
          } else if (options && Object.prototype.hasOwnProperty.call(options, matchedVar)) {
            value = '';
          } else if (skipOnVariables) {
            value = match[0];
            continue;
          } else {
            this.logger.warn(`missed to pass in variable ${matchedVar} for interpolating ${str}`);
            value = '';
          }
        } else if (!isString$1(value) && !this.useRawValueToEscape) {
          value = makeString(value);
        }
        const safeValue = todo.safeValue(value);
        str = str.replace(match[0], safeValue);
        if (skipOnVariables) {
          todo.regex.lastIndex += value.length;
          todo.regex.lastIndex -= match[0].length;
        } else {
          todo.regex.lastIndex = 0;
        }
        replaces++;
        if (replaces >= this.maxReplaces) {
          break;
        }
      }
    });
    return str;
  }
  nest(str, fc, options = {}) {
    let match;
    let value;
    let clonedOptions;
    const handleHasOptions = (key, inheritedOptions) => {
      const sep = this.nestingOptionsSeparator;
      if (key.indexOf(sep) < 0) return key;
      const c = key.split(new RegExp(`${sep}[ ]*{`));
      let optionsString = `{${c[1]}`;
      key = c[0];
      optionsString = this.interpolate(optionsString, clonedOptions);
      const matchedSingleQuotes = optionsString.match(/'/g);
      const matchedDoubleQuotes = optionsString.match(/"/g);
      if ((matchedSingleQuotes?.length ?? 0) % 2 === 0 && !matchedDoubleQuotes || matchedDoubleQuotes.length % 2 !== 0) {
        optionsString = optionsString.replace(/'/g, '"');
      }
      try {
        clonedOptions = JSON.parse(optionsString);
        if (inheritedOptions) clonedOptions = {
          ...inheritedOptions,
          ...clonedOptions
        };
      } catch (e) {
        this.logger.warn(`failed parsing options string in nesting for key ${key}`, e);
        return `${key}${sep}${optionsString}`;
      }
      if (clonedOptions.defaultValue && clonedOptions.defaultValue.indexOf(this.prefix) > -1) delete clonedOptions.defaultValue;
      return key;
    };
    while (match = this.nestingRegexp.exec(str)) {
      let formatters = [];
      clonedOptions = {
        ...options
      };
      clonedOptions = clonedOptions.replace && !isString$1(clonedOptions.replace) ? clonedOptions.replace : clonedOptions;
      clonedOptions.applyPostProcessor = false;
      delete clonedOptions.defaultValue;
      const keyEndIndex = /{.*}/.test(match[1]) ? match[1].lastIndexOf('}') + 1 : match[1].indexOf(this.formatSeparator);
      if (keyEndIndex !== -1) {
        formatters = match[1].slice(keyEndIndex).split(this.formatSeparator).map(elem => elem.trim()).filter(Boolean);
        match[1] = match[1].slice(0, keyEndIndex);
      }
      value = fc(handleHasOptions.call(this, match[1].trim(), clonedOptions), clonedOptions);
      if (value && match[0] === str && !isString$1(value)) return value;
      if (!isString$1(value)) value = makeString(value);
      if (!value) {
        this.logger.warn(`missed to resolve ${match[1]} for nesting ${str}`);
        value = '';
      }
      if (formatters.length) {
        value = formatters.reduce((v, f) => this.format(v, f, options.lng, {
          ...options,
          interpolationkey: match[1].trim()
        }), value.trim());
      }
      str = str.replace(match[0], value);
      this.regexp.lastIndex = 0;
    }
    return str;
  }
}

const parseFormatStr = formatStr => {
  let formatName = formatStr.toLowerCase().trim();
  const formatOptions = {};
  if (formatStr.indexOf('(') > -1) {
    const p = formatStr.split('(');
    formatName = p[0].toLowerCase().trim();
    const optStr = p[1].substring(0, p[1].length - 1);
    if (formatName === 'currency' && optStr.indexOf(':') < 0) {
      if (!formatOptions.currency) formatOptions.currency = optStr.trim();
    } else if (formatName === 'relativetime' && optStr.indexOf(':') < 0) {
      if (!formatOptions.range) formatOptions.range = optStr.trim();
    } else {
      const opts = optStr.split(';');
      opts.forEach(opt => {
        if (opt) {
          const [key, ...rest] = opt.split(':');
          const val = rest.join(':').trim().replace(/^'+|'+$/g, '');
          const trimmedKey = key.trim();
          if (!formatOptions[trimmedKey]) formatOptions[trimmedKey] = val;
          if (val === 'false') formatOptions[trimmedKey] = false;
          if (val === 'true') formatOptions[trimmedKey] = true;
          if (!isNaN(val)) formatOptions[trimmedKey] = parseInt(val, 10);
        }
      });
    }
  }
  return {
    formatName,
    formatOptions
  };
};
const createCachedFormatter = fn => {
  const cache = {};
  return (v, l, o) => {
    let optForCache = o;
    if (o && o.interpolationkey && o.formatParams && o.formatParams[o.interpolationkey] && o[o.interpolationkey]) {
      optForCache = {
        ...optForCache,
        [o.interpolationkey]: undefined
      };
    }
    const key = l + JSON.stringify(optForCache);
    let frm = cache[key];
    if (!frm) {
      frm = fn(getCleanedCode(l), o);
      cache[key] = frm;
    }
    return frm(v);
  };
};
const createNonCachedFormatter = fn => (v, l, o) => fn(getCleanedCode(l), o)(v);
class Formatter {
  constructor(options = {}) {
    this.logger = baseLogger.create('formatter');
    this.options = options;
    this.init(options);
  }
  init(services, options = {
    interpolation: {}
  }) {
    this.formatSeparator = options.interpolation.formatSeparator || ',';
    const cf = options.cacheInBuiltFormats ? createCachedFormatter : createNonCachedFormatter;
    this.formats = {
      number: cf((lng, opt) => {
        const formatter = new Intl.NumberFormat(lng, {
          ...opt
        });
        return val => formatter.format(val);
      }),
      currency: cf((lng, opt) => {
        const formatter = new Intl.NumberFormat(lng, {
          ...opt,
          style: 'currency'
        });
        return val => formatter.format(val);
      }),
      datetime: cf((lng, opt) => {
        const formatter = new Intl.DateTimeFormat(lng, {
          ...opt
        });
        return val => formatter.format(val);
      }),
      relativetime: cf((lng, opt) => {
        const formatter = new Intl.RelativeTimeFormat(lng, {
          ...opt
        });
        return val => formatter.format(val, opt.range || 'day');
      }),
      list: cf((lng, opt) => {
        const formatter = new Intl.ListFormat(lng, {
          ...opt
        });
        return val => formatter.format(val);
      })
    };
  }
  add(name, fc) {
    this.formats[name.toLowerCase().trim()] = fc;
  }
  addCached(name, fc) {
    this.formats[name.toLowerCase().trim()] = createCachedFormatter(fc);
  }
  format(value, format, lng, options = {}) {
    const formats = format.split(this.formatSeparator);
    if (formats.length > 1 && formats[0].indexOf('(') > 1 && formats[0].indexOf(')') < 0 && formats.find(f => f.indexOf(')') > -1)) {
      const lastIndex = formats.findIndex(f => f.indexOf(')') > -1);
      formats[0] = [formats[0], ...formats.splice(1, lastIndex)].join(this.formatSeparator);
    }
    const result = formats.reduce((mem, f) => {
      const {
        formatName,
        formatOptions
      } = parseFormatStr(f);
      if (this.formats[formatName]) {
        let formatted = mem;
        try {
          const valOptions = options?.formatParams?.[options.interpolationkey] || {};
          const l = valOptions.locale || valOptions.lng || options.locale || options.lng || lng;
          formatted = this.formats[formatName](mem, l, {
            ...formatOptions,
            ...options,
            ...valOptions
          });
        } catch (error) {
          this.logger.warn(error);
        }
        return formatted;
      } else {
        this.logger.warn(`there was no format function for ${formatName}`);
      }
      return mem;
    }, value);
    return result;
  }
}

const removePending = (q, name) => {
  if (q.pending[name] !== undefined) {
    delete q.pending[name];
    q.pendingCount--;
  }
};
class Connector extends EventEmitter {
  constructor(backend, store, services, options = {}) {
    super();
    this.backend = backend;
    this.store = store;
    this.services = services;
    this.languageUtils = services.languageUtils;
    this.options = options;
    this.logger = baseLogger.create('backendConnector');
    this.waitingReads = [];
    this.maxParallelReads = options.maxParallelReads || 10;
    this.readingCalls = 0;
    this.maxRetries = options.maxRetries >= 0 ? options.maxRetries : 5;
    this.retryTimeout = options.retryTimeout >= 1 ? options.retryTimeout : 350;
    this.state = {};
    this.queue = [];
    this.backend?.init?.(services, options.backend, options);
  }
  queueLoad(languages, namespaces, options, callback) {
    const toLoad = {};
    const pending = {};
    const toLoadLanguages = {};
    const toLoadNamespaces = {};
    languages.forEach(lng => {
      let hasAllNamespaces = true;
      namespaces.forEach(ns => {
        const name = `${lng}|${ns}`;
        if (!options.reload && this.store.hasResourceBundle(lng, ns)) {
          this.state[name] = 2;
        } else if (this.state[name] < 0) ; else if (this.state[name] === 1) {
          if (pending[name] === undefined) pending[name] = true;
        } else {
          this.state[name] = 1;
          hasAllNamespaces = false;
          if (pending[name] === undefined) pending[name] = true;
          if (toLoad[name] === undefined) toLoad[name] = true;
          if (toLoadNamespaces[ns] === undefined) toLoadNamespaces[ns] = true;
        }
      });
      if (!hasAllNamespaces) toLoadLanguages[lng] = true;
    });
    if (Object.keys(toLoad).length || Object.keys(pending).length) {
      this.queue.push({
        pending,
        pendingCount: Object.keys(pending).length,
        loaded: {},
        errors: [],
        callback
      });
    }
    return {
      toLoad: Object.keys(toLoad),
      pending: Object.keys(pending),
      toLoadLanguages: Object.keys(toLoadLanguages),
      toLoadNamespaces: Object.keys(toLoadNamespaces)
    };
  }
  loaded(name, err, data) {
    const s = name.split('|');
    const lng = s[0];
    const ns = s[1];
    if (err) this.emit('failedLoading', lng, ns, err);
    if (!err && data) {
      this.store.addResourceBundle(lng, ns, data, undefined, undefined, {
        skipCopy: true
      });
    }
    this.state[name] = err ? -1 : 2;
    if (err && data) this.state[name] = 0;
    const loaded = {};
    this.queue.forEach(q => {
      pushPath(q.loaded, [lng], ns);
      removePending(q, name);
      if (err) q.errors.push(err);
      if (q.pendingCount === 0 && !q.done) {
        Object.keys(q.loaded).forEach(l => {
          if (!loaded[l]) loaded[l] = {};
          const loadedKeys = q.loaded[l];
          if (loadedKeys.length) {
            loadedKeys.forEach(n => {
              if (loaded[l][n] === undefined) loaded[l][n] = true;
            });
          }
        });
        q.done = true;
        if (q.errors.length) {
          q.callback(q.errors);
        } else {
          q.callback();
        }
      }
    });
    this.emit('loaded', loaded);
    this.queue = this.queue.filter(q => !q.done);
  }
  read(lng, ns, fcName, tried = 0, wait = this.retryTimeout, callback) {
    if (!lng.length) return callback(null, {});
    if (this.readingCalls >= this.maxParallelReads) {
      this.waitingReads.push({
        lng,
        ns,
        fcName,
        tried,
        wait,
        callback
      });
      return;
    }
    this.readingCalls++;
    const resolver = (err, data) => {
      this.readingCalls--;
      if (this.waitingReads.length > 0) {
        const next = this.waitingReads.shift();
        this.read(next.lng, next.ns, next.fcName, next.tried, next.wait, next.callback);
      }
      if (err && data && tried < this.maxRetries) {
        setTimeout(() => {
          this.read.call(this, lng, ns, fcName, tried + 1, wait * 2, callback);
        }, wait);
        return;
      }
      callback(err, data);
    };
    const fc = this.backend[fcName].bind(this.backend);
    if (fc.length === 2) {
      try {
        const r = fc(lng, ns);
        if (r && typeof r.then === 'function') {
          r.then(data => resolver(null, data)).catch(resolver);
        } else {
          resolver(null, r);
        }
      } catch (err) {
        resolver(err);
      }
      return;
    }
    return fc(lng, ns, resolver);
  }
  prepareLoading(languages, namespaces, options = {}, callback) {
    if (!this.backend) {
      this.logger.warn('No backend was added via i18next.use. Will not load resources.');
      return callback && callback();
    }
    if (isString$1(languages)) languages = this.languageUtils.toResolveHierarchy(languages);
    if (isString$1(namespaces)) namespaces = [namespaces];
    const toLoad = this.queueLoad(languages, namespaces, options, callback);
    if (!toLoad.toLoad.length) {
      if (!toLoad.pending.length) callback();
      return null;
    }
    toLoad.toLoad.forEach(name => {
      this.loadOne(name);
    });
  }
  load(languages, namespaces, callback) {
    this.prepareLoading(languages, namespaces, {}, callback);
  }
  reload(languages, namespaces, callback) {
    this.prepareLoading(languages, namespaces, {
      reload: true
    }, callback);
  }
  loadOne(name, prefix = '') {
    const s = name.split('|');
    const lng = s[0];
    const ns = s[1];
    this.read(lng, ns, 'read', undefined, undefined, (err, data) => {
      if (err) this.logger.warn(`${prefix}loading namespace ${ns} for language ${lng} failed`, err);
      if (!err && data) this.logger.log(`${prefix}loaded namespace ${ns} for language ${lng}`, data);
      this.loaded(name, err, data);
    });
  }
  saveMissing(languages, namespace, key, fallbackValue, isUpdate, options = {}, clb = () => {}) {
    if (this.services?.utils?.hasLoadedNamespace && !this.services?.utils?.hasLoadedNamespace(namespace)) {
      this.logger.warn(`did not save key "${key}" as the namespace "${namespace}" was not yet loaded`, 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');
      return;
    }
    if (key === undefined || key === null || key === '') return;
    if (this.backend?.create) {
      const opts = {
        ...options,
        isUpdate
      };
      const fc = this.backend.create.bind(this.backend);
      if (fc.length < 6) {
        try {
          let r;
          if (fc.length === 5) {
            r = fc(languages, namespace, key, fallbackValue, opts);
          } else {
            r = fc(languages, namespace, key, fallbackValue);
          }
          if (r && typeof r.then === 'function') {
            r.then(data => clb(null, data)).catch(clb);
          } else {
            clb(null, r);
          }
        } catch (err) {
          clb(err);
        }
      } else {
        fc(languages, namespace, key, fallbackValue, clb, opts);
      }
    }
    if (!languages || !languages[0]) return;
    this.store.addResource(languages[0], namespace, key, fallbackValue);
  }
}

const get = () => ({
  debug: false,
  initAsync: true,
  ns: ['translation'],
  defaultNS: ['translation'],
  fallbackLng: ['dev'],
  fallbackNS: false,
  supportedLngs: false,
  nonExplicitSupportedLngs: false,
  load: 'all',
  preload: false,
  simplifyPluralSuffix: true,
  keySeparator: '.',
  nsSeparator: ':',
  pluralSeparator: '_',
  contextSeparator: '_',
  partialBundledLanguages: false,
  saveMissing: false,
  updateMissing: false,
  saveMissingTo: 'fallback',
  saveMissingPlurals: true,
  missingKeyHandler: false,
  missingInterpolationHandler: false,
  postProcess: false,
  postProcessPassResolved: false,
  returnNull: false,
  returnEmptyString: true,
  returnObjects: false,
  joinArrays: false,
  returnedObjectHandler: false,
  parseMissingKeyHandler: false,
  appendNamespaceToMissingKey: false,
  appendNamespaceToCIMode: false,
  overloadTranslationOptionHandler: args => {
    let ret = {};
    if (typeof args[1] === 'object') ret = args[1];
    if (isString$1(args[1])) ret.defaultValue = args[1];
    if (isString$1(args[2])) ret.tDescription = args[2];
    if (typeof args[2] === 'object' || typeof args[3] === 'object') {
      const options = args[3] || args[2];
      Object.keys(options).forEach(key => {
        ret[key] = options[key];
      });
    }
    return ret;
  },
  interpolation: {
    escapeValue: true,
    format: value => value,
    prefix: '{{',
    suffix: '}}',
    formatSeparator: ',',
    unescapePrefix: '-',
    nestingPrefix: '$t(',
    nestingSuffix: ')',
    nestingOptionsSeparator: ',',
    maxReplaces: 1000,
    skipOnVariables: true
  },
  cacheInBuiltFormats: true
});
const transformOptions = options => {
  if (isString$1(options.ns)) options.ns = [options.ns];
  if (isString$1(options.fallbackLng)) options.fallbackLng = [options.fallbackLng];
  if (isString$1(options.fallbackNS)) options.fallbackNS = [options.fallbackNS];
  if (options.supportedLngs?.indexOf?.('cimode') < 0) {
    options.supportedLngs = options.supportedLngs.concat(['cimode']);
  }
  if (typeof options.initImmediate === 'boolean') options.initAsync = options.initImmediate;
  return options;
};

const noop = () => {};
const bindMemberFunctions = inst => {
  const mems = Object.getOwnPropertyNames(Object.getPrototypeOf(inst));
  mems.forEach(mem => {
    if (typeof inst[mem] === 'function') {
      inst[mem] = inst[mem].bind(inst);
    }
  });
};
class I18n extends EventEmitter {
  constructor(options = {}, callback) {
    super();
    this.options = transformOptions(options);
    this.services = {};
    this.logger = baseLogger;
    this.modules = {
      external: []
    };
    bindMemberFunctions(this);
    if (callback && !this.isInitialized && !options.isClone) {
      if (!this.options.initAsync) {
        this.init(options, callback);
        return this;
      }
      setTimeout(() => {
        this.init(options, callback);
      }, 0);
    }
  }
  init(options = {}, callback) {
    this.isInitializing = true;
    if (typeof options === 'function') {
      callback = options;
      options = {};
    }
    if (options.defaultNS == null && options.ns) {
      if (isString$1(options.ns)) {
        options.defaultNS = options.ns;
      } else if (options.ns.indexOf('translation') < 0) {
        options.defaultNS = options.ns[0];
      }
    }
    const defOpts = get();
    this.options = {
      ...defOpts,
      ...this.options,
      ...transformOptions(options)
    };
    this.options.interpolation = {
      ...defOpts.interpolation,
      ...this.options.interpolation
    };
    if (options.keySeparator !== undefined) {
      this.options.userDefinedKeySeparator = options.keySeparator;
    }
    if (options.nsSeparator !== undefined) {
      this.options.userDefinedNsSeparator = options.nsSeparator;
    }
    const createClassOnDemand = ClassOrObject => {
      if (!ClassOrObject) return null;
      if (typeof ClassOrObject === 'function') return new ClassOrObject();
      return ClassOrObject;
    };
    if (!this.options.isClone) {
      if (this.modules.logger) {
        baseLogger.init(createClassOnDemand(this.modules.logger), this.options);
      } else {
        baseLogger.init(null, this.options);
      }
      let formatter;
      if (this.modules.formatter) {
        formatter = this.modules.formatter;
      } else {
        formatter = Formatter;
      }
      const lu = new LanguageUtil(this.options);
      this.store = new ResourceStore(this.options.resources, this.options);
      const s = this.services;
      s.logger = baseLogger;
      s.resourceStore = this.store;
      s.languageUtils = lu;
      s.pluralResolver = new PluralResolver(lu, {
        prepend: this.options.pluralSeparator,
        simplifyPluralSuffix: this.options.simplifyPluralSuffix
      });
      const usingLegacyFormatFunction = this.options.interpolation.format && this.options.interpolation.format !== defOpts.interpolation.format;
      if (usingLegacyFormatFunction) {
        this.logger.deprecate(`init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting`);
      }
      if (formatter && (!this.options.interpolation.format || this.options.interpolation.format === defOpts.interpolation.format)) {
        s.formatter = createClassOnDemand(formatter);
        if (s.formatter.init) s.formatter.init(s, this.options);
        this.options.interpolation.format = s.formatter.format.bind(s.formatter);
      }
      s.interpolator = new Interpolator(this.options);
      s.utils = {
        hasLoadedNamespace: this.hasLoadedNamespace.bind(this)
      };
      s.backendConnector = new Connector(createClassOnDemand(this.modules.backend), s.resourceStore, s, this.options);
      s.backendConnector.on('*', (event, ...args) => {
        this.emit(event, ...args);
      });
      if (this.modules.languageDetector) {
        s.languageDetector = createClassOnDemand(this.modules.languageDetector);
        if (s.languageDetector.init) s.languageDetector.init(s, this.options.detection, this.options);
      }
      if (this.modules.i18nFormat) {
        s.i18nFormat = createClassOnDemand(this.modules.i18nFormat);
        if (s.i18nFormat.init) s.i18nFormat.init(this);
      }
      this.translator = new Translator(this.services, this.options);
      this.translator.on('*', (event, ...args) => {
        this.emit(event, ...args);
      });
      this.modules.external.forEach(m => {
        if (m.init) m.init(this);
      });
    }
    this.format = this.options.interpolation.format;
    if (!callback) callback = noop;
    if (this.options.fallbackLng && !this.services.languageDetector && !this.options.lng) {
      const codes = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);
      if (codes.length > 0 && codes[0] !== 'dev') this.options.lng = codes[0];
    }
    if (!this.services.languageDetector && !this.options.lng) {
      this.logger.warn('init: no languageDetector is used and no lng is defined');
    }
    const storeApi = ['getResource', 'hasResourceBundle', 'getResourceBundle', 'getDataByLanguage'];
    storeApi.forEach(fcName => {
      this[fcName] = (...args) => this.store[fcName](...args);
    });
    const storeApiChained = ['addResource', 'addResources', 'addResourceBundle', 'removeResourceBundle'];
    storeApiChained.forEach(fcName => {
      this[fcName] = (...args) => {
        this.store[fcName](...args);
        return this;
      };
    });
    const deferred = defer();
    const load = () => {
      const finish = (err, t) => {
        this.isInitializing = false;
        if (this.isInitialized && !this.initializedStoreOnce) this.logger.warn('init: i18next is already initialized. You should call init just once!');
        this.isInitialized = true;
        if (!this.options.isClone) this.logger.log('initialized', this.options);
        this.emit('initialized', this.options);
        deferred.resolve(t);
        callback(err, t);
      };
      if (this.languages && !this.isInitialized) return finish(null, this.t.bind(this));
      this.changeLanguage(this.options.lng, finish);
    };
    if (this.options.resources || !this.options.initAsync) {
      load();
    } else {
      setTimeout(load, 0);
    }
    return deferred;
  }
  loadResources(language, callback = noop) {
    let usedCallback = callback;
    const usedLng = isString$1(language) ? language : this.language;
    if (typeof language === 'function') usedCallback = language;
    if (!this.options.resources || this.options.partialBundledLanguages) {
      if (usedLng?.toLowerCase() === 'cimode' && (!this.options.preload || this.options.preload.length === 0)) return usedCallback();
      const toLoad = [];
      const append = lng => {
        if (!lng) return;
        if (lng === 'cimode') return;
        const lngs = this.services.languageUtils.toResolveHierarchy(lng);
        lngs.forEach(l => {
          if (l === 'cimode') return;
          if (toLoad.indexOf(l) < 0) toLoad.push(l);
        });
      };
      if (!usedLng) {
        const fallbacks = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);
        fallbacks.forEach(l => append(l));
      } else {
        append(usedLng);
      }
      this.options.preload?.forEach?.(l => append(l));
      this.services.backendConnector.load(toLoad, this.options.ns, e => {
        if (!e && !this.resolvedLanguage && this.language) this.setResolvedLanguage(this.language);
        usedCallback(e);
      });
    } else {
      usedCallback(null);
    }
  }
  reloadResources(lngs, ns, callback) {
    const deferred = defer();
    if (typeof lngs === 'function') {
      callback = lngs;
      lngs = undefined;
    }
    if (typeof ns === 'function') {
      callback = ns;
      ns = undefined;
    }
    if (!lngs) lngs = this.languages;
    if (!ns) ns = this.options.ns;
    if (!callback) callback = noop;
    this.services.backendConnector.reload(lngs, ns, err => {
      deferred.resolve();
      callback(err);
    });
    return deferred;
  }
  use(module) {
    if (!module) throw new Error('You are passing an undefined module! Please check the object you are passing to i18next.use()');
    if (!module.type) throw new Error('You are passing a wrong module! Please check the object you are passing to i18next.use()');
    if (module.type === 'backend') {
      this.modules.backend = module;
    }
    if (module.type === 'logger' || module.log && module.warn && module.error) {
      this.modules.logger = module;
    }
    if (module.type === 'languageDetector') {
      this.modules.languageDetector = module;
    }
    if (module.type === 'i18nFormat') {
      this.modules.i18nFormat = module;
    }
    if (module.type === 'postProcessor') {
      postProcessor.addPostProcessor(module);
    }
    if (module.type === 'formatter') {
      this.modules.formatter = module;
    }
    if (module.type === '3rdParty') {
      this.modules.external.push(module);
    }
    return this;
  }
  setResolvedLanguage(l) {
    if (!l || !this.languages) return;
    if (['cimode', 'dev'].indexOf(l) > -1) return;
    for (let li = 0; li < this.languages.length; li++) {
      const lngInLngs = this.languages[li];
      if (['cimode', 'dev'].indexOf(lngInLngs) > -1) continue;
      if (this.store.hasLanguageSomeTranslations(lngInLngs)) {
        this.resolvedLanguage = lngInLngs;
        break;
      }
    }
    if (!this.resolvedLanguage && this.languages.indexOf(l) < 0 && this.store.hasLanguageSomeTranslations(l)) {
      this.resolvedLanguage = l;
      this.languages.unshift(l);
    }
  }
  changeLanguage(lng, callback) {
    this.isLanguageChangingTo = lng;
    const deferred = defer();
    this.emit('languageChanging', lng);
    const setLngProps = l => {
      this.language = l;
      this.languages = this.services.languageUtils.toResolveHierarchy(l);
      this.resolvedLanguage = undefined;
      this.setResolvedLanguage(l);
    };
    const done = (err, l) => {
      if (l) {
        if (this.isLanguageChangingTo === lng) {
          setLngProps(l);
          this.translator.changeLanguage(l);
          this.isLanguageChangingTo = undefined;
          this.emit('languageChanged', l);
          this.logger.log('languageChanged', l);
        }
      } else {
        this.isLanguageChangingTo = undefined;
      }
      deferred.resolve((...args) => this.t(...args));
      if (callback) callback(err, (...args) => this.t(...args));
    };
    const setLng = lngs => {
      if (!lng && !lngs && this.services.languageDetector) lngs = [];
      const fl = isString$1(lngs) ? lngs : lngs && lngs[0];
      const l = this.store.hasLanguageSomeTranslations(fl) ? fl : this.services.languageUtils.getBestMatchFromCodes(isString$1(lngs) ? [lngs] : lngs);
      if (l) {
        if (!this.language) {
          setLngProps(l);
        }
        if (!this.translator.language) this.translator.changeLanguage(l);
        this.services.languageDetector?.cacheUserLanguage?.(l);
      }
      this.loadResources(l, err => {
        done(err, l);
      });
    };
    if (!lng && this.services.languageDetector && !this.services.languageDetector.async) {
      setLng(this.services.languageDetector.detect());
    } else if (!lng && this.services.languageDetector && this.services.languageDetector.async) {
      if (this.services.languageDetector.detect.length === 0) {
        this.services.languageDetector.detect().then(setLng);
      } else {
        this.services.languageDetector.detect(setLng);
      }
    } else {
      setLng(lng);
    }
    return deferred;
  }
  getFixedT(lng, ns, keyPrefix) {
    const fixedT = (key, opts, ...rest) => {
      let o;
      if (typeof opts !== 'object') {
        o = this.options.overloadTranslationOptionHandler([key, opts].concat(rest));
      } else {
        o = {
          ...opts
        };
      }
      o.lng = o.lng || fixedT.lng;
      o.lngs = o.lngs || fixedT.lngs;
      o.ns = o.ns || fixedT.ns;
      if (o.keyPrefix !== '') o.keyPrefix = o.keyPrefix || keyPrefix || fixedT.keyPrefix;
      const keySeparator = this.options.keySeparator || '.';
      let resultKey;
      if (o.keyPrefix && Array.isArray(key)) {
        resultKey = key.map(k => {
          if (typeof k === 'function') k = keysFromSelector(k, {
            ...this.options,
            ...opts
          });
          return `${o.keyPrefix}${keySeparator}${k}`;
        });
      } else {
        if (typeof key === 'function') key = keysFromSelector(key, {
          ...this.options,
          ...opts
        });
        resultKey = o.keyPrefix ? `${o.keyPrefix}${keySeparator}${key}` : key;
      }
      return this.t(resultKey, o);
    };
    if (isString$1(lng)) {
      fixedT.lng = lng;
    } else {
      fixedT.lngs = lng;
    }
    fixedT.ns = ns;
    fixedT.keyPrefix = keyPrefix;
    return fixedT;
  }
  t(...args) {
    return this.translator?.translate(...args);
  }
  exists(...args) {
    return this.translator?.exists(...args);
  }
  setDefaultNamespace(ns) {
    this.options.defaultNS = ns;
  }
  hasLoadedNamespace(ns, options = {}) {
    if (!this.isInitialized) {
      this.logger.warn('hasLoadedNamespace: i18next was not initialized', this.languages);
      return false;
    }
    if (!this.languages || !this.languages.length) {
      this.logger.warn('hasLoadedNamespace: i18n.languages were undefined or empty', this.languages);
      return false;
    }
    const lng = options.lng || this.resolvedLanguage || this.languages[0];
    const fallbackLng = this.options ? this.options.fallbackLng : false;
    const lastLng = this.languages[this.languages.length - 1];
    if (lng.toLowerCase() === 'cimode') return true;
    const loadNotPending = (l, n) => {
      const loadState = this.services.backendConnector.state[`${l}|${n}`];
      return loadState === -1 || loadState === 0 || loadState === 2;
    };
    if (options.precheck) {
      const preResult = options.precheck(this, loadNotPending);
      if (preResult !== undefined) return preResult;
    }
    if (this.hasResourceBundle(lng, ns)) return true;
    if (!this.services.backendConnector.backend || this.options.resources && !this.options.partialBundledLanguages) return true;
    if (loadNotPending(lng, ns) && (!fallbackLng || loadNotPending(lastLng, ns))) return true;
    return false;
  }
  loadNamespaces(ns, callback) {
    const deferred = defer();
    if (!this.options.ns) {
      if (callback) callback();
      return Promise.resolve();
    }
    if (isString$1(ns)) ns = [ns];
    ns.forEach(n => {
      if (this.options.ns.indexOf(n) < 0) this.options.ns.push(n);
    });
    this.loadResources(err => {
      deferred.resolve();
      if (callback) callback(err);
    });
    return deferred;
  }
  loadLanguages(lngs, callback) {
    const deferred = defer();
    if (isString$1(lngs)) lngs = [lngs];
    const preloaded = this.options.preload || [];
    const newLngs = lngs.filter(lng => preloaded.indexOf(lng) < 0 && this.services.languageUtils.isSupportedCode(lng));
    if (!newLngs.length) {
      if (callback) callback();
      return Promise.resolve();
    }
    this.options.preload = preloaded.concat(newLngs);
    this.loadResources(err => {
      deferred.resolve();
      if (callback) callback(err);
    });
    return deferred;
  }
  dir(lng) {
    if (!lng) lng = this.resolvedLanguage || (this.languages?.length > 0 ? this.languages[0] : this.language);
    if (!lng) return 'rtl';
    try {
      const l = new Intl.Locale(lng);
      if (l && l.getTextInfo) {
        const ti = l.getTextInfo();
        if (ti && ti.direction) return ti.direction;
      }
    } catch (e) {}
    const rtlLngs = ['ar', 'shu', 'sqr', 'ssh', 'xaa', 'yhd', 'yud', 'aao', 'abh', 'abv', 'acm', 'acq', 'acw', 'acx', 'acy', 'adf', 'ads', 'aeb', 'aec', 'afb', 'ajp', 'apc', 'apd', 'arb', 'arq', 'ars', 'ary', 'arz', 'auz', 'avl', 'ayh', 'ayl', 'ayn', 'ayp', 'bbz', 'pga', 'he', 'iw', 'ps', 'pbt', 'pbu', 'pst', 'prp', 'prd', 'ug', 'ur', 'ydd', 'yds', 'yih', 'ji', 'yi', 'hbo', 'men', 'xmn', 'fa', 'jpr', 'peo', 'pes', 'prs', 'dv', 'sam', 'ckb'];
    const languageUtils = this.services?.languageUtils || new LanguageUtil(get());
    if (lng.toLowerCase().indexOf('-latn') > 1) return 'ltr';
    return rtlLngs.indexOf(languageUtils.getLanguagePartFromCode(lng)) > -1 || lng.toLowerCase().indexOf('-arab') > 1 ? 'rtl' : 'ltr';
  }
  static createInstance(options = {}, callback) {
    const instance = new I18n(options, callback);
    instance.createInstance = I18n.createInstance;
    return instance;
  }
  cloneInstance(options = {}, callback = noop) {
    const forkResourceStore = options.forkResourceStore;
    if (forkResourceStore) delete options.forkResourceStore;
    const mergedOptions = {
      ...this.options,
      ...options,
      ...{
        isClone: true
      }
    };
    const clone = new I18n(mergedOptions);
    if (options.debug !== undefined || options.prefix !== undefined) {
      clone.logger = clone.logger.clone(options);
    }
    const membersToCopy = ['store', 'services', 'language'];
    membersToCopy.forEach(m => {
      clone[m] = this[m];
    });
    clone.services = {
      ...this.services
    };
    clone.services.utils = {
      hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)
    };
    if (forkResourceStore) {
      const clonedData = Object.keys(this.store.data).reduce((prev, l) => {
        prev[l] = {
          ...this.store.data[l]
        };
        prev[l] = Object.keys(prev[l]).reduce((acc, n) => {
          acc[n] = {
            ...prev[l][n]
          };
          return acc;
        }, prev[l]);
        return prev;
      }, {});
      clone.store = new ResourceStore(clonedData, mergedOptions);
      clone.services.resourceStore = clone.store;
    }
    clone.translator = new Translator(clone.services, mergedOptions);
    clone.translator.on('*', (event, ...args) => {
      clone.emit(event, ...args);
    });
    clone.init(mergedOptions, callback);
    clone.translator.options = mergedOptions;
    clone.translator.backendConnector.services.utils = {
      hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)
    };
    return clone;
  }
  toJSON() {
    return {
      options: this.options,
      store: this.store,
      language: this.language,
      languages: this.languages,
      resolvedLanguage: this.resolvedLanguage
    };
  }
}
const instance = I18n.createInstance();

instance.createInstance;
instance.dir;
instance.init;
instance.loadResources;
instance.reloadResources;
instance.use;
instance.changeLanguage;
instance.getFixedT;
instance.t;
instance.exists;
instance.setDefaultNamespace;
instance.hasLoadedNamespace;
instance.loadNamespaces;
instance.loadLanguages;

const warn = (i18n, code, msg, rest) => {
  const args = [msg, {
    code,
    ...(rest || {})
  }];
  if (i18n?.services?.logger?.forward) {
    return i18n.services.logger.forward(args, 'warn', 'react-i18next::', true);
  }
  if (isString(args[0])) args[0] = `react-i18next:: ${args[0]}`;
  if (i18n?.services?.logger?.warn) {
    i18n.services.logger.warn(...args);
  } else if (console?.warn) {
    console.warn(...args);
  }
};
const alreadyWarned = {};
const warnOnce = (i18n, code, msg, rest) => {
  if (isString(msg) && alreadyWarned[msg]) return;
  if (isString(msg)) alreadyWarned[msg] = new Date();
  warn(i18n, code, msg, rest);
};
const loadedClb = (i18n, cb) => () => {
  if (i18n.isInitialized) {
    cb();
  } else {
    const initialized = () => {
      setTimeout(() => {
        i18n.off('initialized', initialized);
      }, 0);
      cb();
    };
    i18n.on('initialized', initialized);
  }
};
const loadNamespaces = (i18n, ns, cb) => {
  i18n.loadNamespaces(ns, loadedClb(i18n, cb));
};
const loadLanguages = (i18n, lng, ns, cb) => {
  if (isString(ns)) ns = [ns];
  if (i18n.options.preload && i18n.options.preload.indexOf(lng) > -1) return loadNamespaces(i18n, ns, cb);
  ns.forEach(n => {
    if (i18n.options.ns.indexOf(n) < 0) i18n.options.ns.push(n);
  });
  i18n.loadLanguages(lng, loadedClb(i18n, cb));
};
const hasLoadedNamespace = (ns, i18n, options = {}) => {
  if (!i18n.languages || !i18n.languages.length) {
    warnOnce(i18n, 'NO_LANGUAGES', 'i18n.languages were undefined or empty', {
      languages: i18n.languages
    });
    return true;
  }
  return i18n.hasLoadedNamespace(ns, {
    lng: options.lng,
    precheck: (i18nInstance, loadNotPending) => {
      if (options.bindI18n && options.bindI18n.indexOf('languageChanging') > -1 && i18nInstance.services.backendConnector.backend && i18nInstance.isLanguageChangingTo && !loadNotPending(i18nInstance.isLanguageChangingTo, ns)) return false;
    }
  });
};
const isString = obj => typeof obj === 'string';
const isObject = obj => typeof obj === 'object' && obj !== null;

const matchHtmlEntity = /&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g;
const htmlEntities = {
  '&amp;': '&',
  '&#38;': '&',
  '&lt;': '<',
  '&#60;': '<',
  '&gt;': '>',
  '&#62;': '>',
  '&apos;': "'",
  '&#39;': "'",
  '&quot;': '"',
  '&#34;': '"',
  '&nbsp;': ' ',
  '&#160;': ' ',
  '&copy;': '',
  '&#169;': '',
  '&reg;': '',
  '&#174;': '',
  '&hellip;': '',
  '&#8230;': '',
  '&#x2F;': '/',
  '&#47;': '/'
};
const unescapeHtmlEntity = m => htmlEntities[m];
const unescape = text => text.replace(matchHtmlEntity, unescapeHtmlEntity);

let defaultOptions = {
  bindI18n: 'languageChanged',
  bindI18nStore: '',
  transEmptyNodeValue: '',
  transSupportBasicHtmlNodes: true,
  transWrapTextNodes: '',
  transKeepBasicHtmlNodesFor: ['br', 'strong', 'i', 'p'],
  useSuspense: true,
  unescape
};
const setDefaults = (options = {}) => {
  defaultOptions = {
    ...defaultOptions,
    ...options
  };
};
const getDefaults = () => defaultOptions;

let i18nInstance;
const setI18n = instance => {
  i18nInstance = instance;
};
const getI18n = () => i18nInstance;

const initReactI18next = {
  type: '3rdParty',
  init(instance) {
    setDefaults(instance.options.react);
    setI18n(instance);
  }
};

const I18nContext = reactExports.createContext();
class ReportNamespaces {
  constructor() {
    this.usedNamespaces = {};
  }
  addUsedNamespaces(namespaces) {
    namespaces.forEach(ns => {
      if (!this.usedNamespaces[ns]) this.usedNamespaces[ns] = true;
    });
  }
  getUsedNamespaces() {
    return Object.keys(this.usedNamespaces);
  }
}

const notReadyT = (k, optsOrDefaultValue) => {
  if (isString(optsOrDefaultValue)) return optsOrDefaultValue;
  if (isObject(optsOrDefaultValue) && isString(optsOrDefaultValue.defaultValue)) return optsOrDefaultValue.defaultValue;
  return Array.isArray(k) ? k[k.length - 1] : k;
};
const notReadySnapshot = {
  t: notReadyT,
  ready: false
};
const dummySubscribe = () => () => {};
const useTranslation = (ns, props = {}) => {
  const {
    i18n: i18nFromProps
  } = props;
  const {
    i18n: i18nFromContext,
    defaultNS: defaultNSFromContext
  } = reactExports.useContext(I18nContext) || {};
  const i18n = i18nFromProps || i18nFromContext || getI18n();
  if (i18n && !i18n.reportNamespaces) i18n.reportNamespaces = new ReportNamespaces();
  if (!i18n) {
    warnOnce(i18n, 'NO_I18NEXT_INSTANCE', 'useTranslation: You will need to pass in an i18next instance by using initReactI18next');
  }
  const i18nOptions = reactExports.useMemo(() => ({
    ...getDefaults(),
    ...i18n?.options?.react,
    ...props
  }), [i18n, props]);
  const {
    useSuspense,
    keyPrefix
  } = i18nOptions;
  const nsOrContext = defaultNSFromContext || i18n?.options?.defaultNS;
  const unstableNamespaces = isString(nsOrContext) ? [nsOrContext] : nsOrContext || ['translation'];
  const namespaces = reactExports.useMemo(() => unstableNamespaces, unstableNamespaces);
  i18n?.reportNamespaces?.addUsedNamespaces?.(namespaces);
  const revisionRef = reactExports.useRef(0);
  const subscribe = reactExports.useCallback(callback => {
    if (!i18n) return dummySubscribe;
    const {
      bindI18n,
      bindI18nStore
    } = i18nOptions;
    const wrappedCallback = () => {
      revisionRef.current += 1;
      callback();
    };
    if (bindI18n) i18n.on(bindI18n, wrappedCallback);
    if (bindI18nStore) i18n.store.on(bindI18nStore, wrappedCallback);
    return () => {
      if (bindI18n) bindI18n.split(' ').forEach(e => i18n.off(e, wrappedCallback));
      if (bindI18nStore) bindI18nStore.split(' ').forEach(e => i18n.store.off(e, wrappedCallback));
    };
  }, [i18n, i18nOptions]);
  const snapshotRef = reactExports.useRef();
  const getSnapshot = reactExports.useCallback(() => {
    if (!i18n) {
      return notReadySnapshot;
    }
    const calculatedReady = !!(i18n.isInitialized || i18n.initializedStoreOnce) && namespaces.every(n => hasLoadedNamespace(n, i18n, i18nOptions));
    const currentLng = props.lng || i18n.language;
    const currentRevision = revisionRef.current;
    const lastSnapshot = snapshotRef.current;
    if (lastSnapshot && lastSnapshot.ready === calculatedReady && lastSnapshot.lng === currentLng && lastSnapshot.keyPrefix === keyPrefix && lastSnapshot.revision === currentRevision) {
      return lastSnapshot;
    }
    const calculatedT = i18n.getFixedT(currentLng, i18nOptions.nsMode === 'fallback' ? namespaces : namespaces[0], keyPrefix);
    const newSnapshot = {
      t: calculatedT,
      ready: calculatedReady,
      lng: currentLng,
      keyPrefix,
      revision: currentRevision
    };
    snapshotRef.current = newSnapshot;
    return newSnapshot;
  }, [i18n, namespaces, keyPrefix, i18nOptions, props.lng]);
  const [loadCount, setLoadCount] = reactExports.useState(0);
  const {
    t,
    ready
  } = shimExports.useSyncExternalStore(subscribe, getSnapshot, getSnapshot);
  reactExports.useEffect(() => {
    if (i18n && !ready && !useSuspense) {
      const onLoaded = () => setLoadCount(c => c + 1);
      if (props.lng) {
        loadLanguages(i18n, props.lng, namespaces, onLoaded);
      } else {
        loadNamespaces(i18n, namespaces, onLoaded);
      }
    }
  }, [i18n, props.lng, namespaces, ready, useSuspense, loadCount]);
  const finalI18n = i18n || {};
  const wrapperRef = reactExports.useRef(null);
  const wrapperLangRef = reactExports.useRef();
  const createI18nWrapper = original => {
    const descriptors = Object.getOwnPropertyDescriptors(original);
    if (descriptors.__original) delete descriptors.__original;
    const wrapper = Object.create(Object.getPrototypeOf(original), descriptors);
    if (!Object.prototype.hasOwnProperty.call(wrapper, '__original')) {
      try {
        Object.defineProperty(wrapper, '__original', {
          value: original,
          writable: false,
          enumerable: false,
          configurable: false
        });
      } catch (_) {}
    }
    return wrapper;
  };
  const ret = reactExports.useMemo(() => {
    const original = finalI18n;
    const lang = original?.language;
    let i18nWrapper = original;
    if (original) {
      if (wrapperRef.current && wrapperRef.current.__original === original) {
        if (wrapperLangRef.current !== lang) {
          i18nWrapper = createI18nWrapper(original);
          wrapperRef.current = i18nWrapper;
          wrapperLangRef.current = lang;
        } else {
          i18nWrapper = wrapperRef.current;
        }
      } else {
        i18nWrapper = createI18nWrapper(original);
        wrapperRef.current = i18nWrapper;
        wrapperLangRef.current = lang;
      }
    }
    const arr = [t, i18nWrapper, ready];
    arr.t = t;
    arr.i18n = i18nWrapper;
    arr.ready = ready;
    return arr;
  }, [t, finalI18n, ready, finalI18n.resolvedLanguage, finalI18n.language, finalI18n.languages]);
  if (i18n && useSuspense && !ready) {
    throw new Promise(resolve => {
      const onLoaded = () => resolve();
      if (props.lng) {
        loadLanguages(i18n, props.lng, namespaces, onLoaded);
      } else {
        loadNamespaces(i18n, namespaces, onLoaded);
      }
    });
  }
  return ret;
};

function I18nextProvider({
  i18n,
  defaultNS,
  children
}) {
  const value = reactExports.useMemo(() => ({
    i18n,
    defaultNS
  }), [i18n, defaultNS]);
  return reactExports.createElement(I18nContext.Provider, {
    value
  }, children);
}

const NorahAssistant = () => {
  const { t } = useTranslation();
  const [, setLocation] = useLocation();
  const [userId, setUserId] = React$1.useState(null);
  React$1.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      setUserId(data.user?.id || null);
    });
  }, []);
  const LeftComponent = () => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    Button,
    {
      variant: "ghost",
      size: "icon",
      onClick: () => setLocation("/home"),
      className: "mr-2",
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
    }
  ) });
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              UnifiedHeader,
              {
                profileImage: localStorage.getItem("profileImage"),
                leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(LeftComponent, {})
              }
            )
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "main",
          {
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full h-full px-0 md:px-4 md:max-w-screen-xl md:mx-auto", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 md:mb-6 px-4 md:px-0", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl md:text-3xl font-bold bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent mb-2", children: t("norah_ai_assistant") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm md:text-base text-white/70", children: t("assistant_description") })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-full", "data-onboarding": "ai-chat", children: [
                userId && /* @__PURE__ */ jsxRuntimeExports.jsx(NorahChatLLM, { userId }),
                !userId && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 px-4", children: t("loading") })
              ] })
            ] })
          }
        )
      ]
    }
  );
};

const SettingsPage = () => {
  const [, setLocation] = useLocation();
  useAuth();
  const [geolocationEnabled, setGeolocationEnabled] = reactExports.useState(false);
  const [sessionStatus, setSessionStatus] = reactExports.useState("Verifica...");
  useGeolocation();
  const supabaseProjectId = getProjectRef$1();
  reactExports.useEffect(() => {
    checkGeolocation();
    checkSession();
  }, []);
  const checkGeolocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        () => setGeolocationEnabled(true),
        () => setGeolocationEnabled(false)
      );
    }
  };
  const checkSession = async () => {
    try {
      const { data: { session } } = await supabase.auth.getSession();
      setSessionStatus(session ? "Attiva" : "Non attiva");
    } catch (error) {
      setSessionStatus("Errore");
    }
  };
  const handleSectionChange = (sectionId) => {
    setLocation(`/settings/${sectionId}`);
  };
  const sections = [
    {
      id: "agent-profile",
      label: "Profilo Agente",
      description: "Avatar, nome e informazioni agente",
      icon: User
    },
    {
      id: "security",
      label: "Sicurezza",
      description: "Password e codici di emergenza",
      icon: Shield
    },
    {
      id: "mission",
      label: "Missione",
      description: "Stato missioni e progressi",
      icon: Target
    },
    {
      id: "notifications",
      label: "Notifiche",
      description: "Preferenze e alert",
      icon: Bell
    },
    {
      id: "privacy",
      label: "Privacy",
      description: "Gestione consensi e cookie",
      icon: Lock
    },
    {
      id: "legal",
      label: "Legale",
      description: "Termini, privacy e account",
      icon: FileText
    },
    {
      id: "app-info",
      label: "Info App",
      description: "Versione, supporto e credits",
      icon: Info
    }
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-background via-background/95 to-background/90", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: "pt-16 pb-20 px-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-lg mx-auto space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-8", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "h-8 w-8 text-primary" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent", children: "Impostazioni" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground text-lg", children: "Configura la tua esperienza M1SSION" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: sections.map((section) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        Card,
        {
          className: "glass-card cursor-pointer transition-all duration-300 hover:scale-[1.02] hover:shadow-lg border-0 bg-card/50 backdrop-blur-md",
          onClick: () => handleSectionChange(section.id),
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(section.icon, { className: "h-6 w-6 text-primary" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-foreground text-lg", children: section.label }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/80", children: section.description })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronRight, { className: "h-5 w-5 text-muted-foreground transition-transform duration-200 group-hover:translate-x-1" })
          ] }) })
        },
        section.id
      )) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4 mt-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/40 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent", children: "Privacy & Permessi" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-4 border-0 bg-background/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-2 rounded-lg bg-blue-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "h-5 w-5 text-blue-400" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium text-foreground", children: "Geolocalizzazione" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Badge,
              {
                variant: geolocationEnabled ? "default" : "secondary",
                className: geolocationEnabled ? "bg-green-500/20 text-green-400 border-green-500/30" : "",
                children: geolocationEnabled ? "Attiva" : "Disattiva"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/80 mb-3", children: "Permetti l'accesso alla posizione per le funzionalit di missione" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              variant: "outline",
              size: "sm",
              onClick: checkGeolocation,
              className: "w-full bg-background/50 border-primary/30 hover:bg-primary/10",
              children: "Verifica Permessi"
            }
          )
        ] }) })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/40 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent", children: "Diagnostica" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-4 border-0 bg-background/20 space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-2 rounded-lg bg-green-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Stethoscope, { className: "h-5 w-5 text-green-400" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium text-foreground", children: "Info Supabase" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", className: "border-green-500/30 text-green-400", children: [
              "ID: ",
              supabaseProjectId.slice(0, 8),
              "..."
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-muted-foreground/80", children: "Stato Sessione:" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Badge,
                {
                  variant: sessionStatus === "Attiva" ? "default" : "destructive",
                  className: sessionStatus === "Attiva" ? "bg-green-500/20 text-green-400 border-green-500/30" : "",
                  children: sessionStatus
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                variant: "outline",
                size: "sm",
                onClick: checkSession,
                className: "w-full bg-background/50 border-green-500/30 hover:bg-green-500/10",
                children: "Verifica Sessione"
              }
            )
          ] })
        ] }) })
      ] }) })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
  ] });
};

const ProfileLayout = ({ children, showBottomNav = true }) => {
  const { profileImage } = useProfileImage();
  useWouterNavigation();
  const isMobile = useIsMobile();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "min-h-screen bg-gradient-to-b from-[#131524]/70 to-black text-white",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      transition: { duration: 0.5 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-[72px] w-full" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: `pb-20 ${isMobile ? "px-3" : "px-6"} max-w-screen-xl mx-auto`, children }),
        showBottomNav && /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bottom-0 left-0 w-full h-[150px] pointer-events-none bg-gradient-to-t from-black to-transparent opacity-70 z-10" })
      ]
    }
  );
};

const categoryMapping = {
  all: "",
  leaderboard: NOTIFICATION_CATEGORIES$1.LEADERBOARD,
  buzz: NOTIFICATION_CATEGORIES$1.BUZZ,
  map: NOTIFICATION_CATEGORIES$1.MAP_BUZZ,
  weekly: NOTIFICATION_CATEGORIES$1.WEEKLY,
  generic: NOTIFICATION_CATEGORIES$1.GENERIC
};
const NotificationsDrawer = ({ open, onOpenChange }) => {
  const [selectedNotification, setSelectedNotification] = reactExports.useState(null);
  const [activeCategory, setActiveCategory] = reactExports.useState("all");
  const { notifications, unreadCount, markAllAsRead, reloadNotifications, deleteNotification } = useNotifications();
  reactExports.useEffect(() => {
    if (open) {
      reloadNotifications();
      const interval = setInterval(() => {
        reloadNotifications();
      }, 5e3);
      return () => clearInterval(interval);
    }
  }, [open, reloadNotifications]);
  const handleMarkAllAsRead = () => {
    markAllAsRead();
  };
  const handleSelectNotification = (notification) => {
    setSelectedNotification(notification);
  };
  const handleDeleteNotification = (id) => {
    deleteNotification(id);
  };
  const handleManualReload = () => {
    reloadNotifications();
  };
  const filteredNotifications = activeCategory === "all" ? notifications : notifications.filter((n) => n.type === categoryMapping[activeCategory]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "sm:max-w-md w-full bg-black p-0 overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { className: "px-6 pt-4 pb-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogTitle, { className: "flex items-center gap-1 text-lg", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "h-5 w-5 mr-1" }),
          "Notifiche",
          unreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "ml-2 px-2 py-0.5 text-xs bg-m1ssion-pink rounded-full animate-pulse", children: unreadCount }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              variant: "ghost",
              size: "sm",
              onClick: handleManualReload,
              className: "ml-auto p-1 h-6 w-6",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "h-3 w-3" })
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(DialogDescription, { className: "text-xs text-muted-foreground", children: "Tutte le notifiche ricevute di recente." })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-3 py-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "all", className: "w-full", onValueChange: (value) => setActiveCategory(value), children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "bg-black/40 p-1 w-full grid grid-cols-6 h-auto", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "all", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Tutti" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "leaderboard", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Classifica" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "buzz", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Circle, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Buzz" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "map", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Mappa" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "weekly", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Settimanale" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "generic", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Altre" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: activeCategory, className: "mt-2 px-3 max-h-[50vh] overflow-y-auto", children: filteredNotifications.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-6 text-muted-foreground", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Non hai notifiche in questa categoria." }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: "outline",
              size: "sm",
              onClick: handleManualReload,
              className: "mt-2",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "h-3 w-3 mr-1" }),
                "Ricarica"
              ]
            }
          )
        ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: filteredNotifications.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()).map((notification) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          NotificationItem,
          {
            notification,
            onSelect: () => handleSelectNotification(notification),
            onDelete: () => handleDeleteNotification(notification.id)
          },
          notification.id
        )) }) })
      ] }) }),
      notifications.length > 0 && unreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mt-2 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          size: "sm",
          variant: "outline",
          onClick: handleMarkAllAsRead,
          className: "bg-gradient-to-r from-m1ssion-blue/20 to-m1ssion-pink/20 hover:from-m1ssion-blue/30 hover:to-m1ssion-pink/30 border-gray-700",
          children: "Segna tutte come lette"
        }
      ) })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      NotificationDialog,
      {
        notification: selectedNotification,
        open: !!selectedNotification,
        onClose: () => setSelectedNotification(null)
      }
    )
  ] });
};

const ProfileHeader = ({
  agentCode,
  agentTitle,
  isEditing,
  onEditToggle,
  onSave
}) => {
  const [showCodeText, setShowCodeText] = reactExports.useState(false);
  useIsMobile();
  const { user } = useAuthContext();
  const adminCode = getAdminCode(user?.email);
  const displayCode = adminCode || agentCode;
  reactExports.useEffect(() => {
    const timer = setTimeout(() => {
      setShowCodeText(true);
    }, 2e3);
    return () => clearTimeout(timer);
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 border-b border-white/10 backdrop-blur-xl bg-gradient-to-r from-black/55 via-[#131524]/55 to-black/55 flex justify-between items-center", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          initial: { opacity: 0 },
          animate: { opacity: 1 },
          transition: { delay: 0.2, duration: 0.5 },
          className: "flex items-center",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 font-mono text-xs sm:text-sm font-medium", children: "DOSSIER:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.span,
              {
                className: "font-mono text-white bg-cyan-900/40 px-2 py-1 rounded text-xs sm:text-sm ml-2 border border-cyan-900/30",
                initial: { width: 0, opacity: 0 },
                animate: { width: "auto", opacity: showCodeText ? 1 : 0 },
                transition: { delay: 0.5, duration: 0.5 },
                children: displayCode
              }
            )
          ]
        }
      ),
      !isEditing && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "bg-cyan-600 text-white text-xs px-2 py-0.5 rounded-full ml-2", children: agentTitle })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Button,
      {
        onClick: () => isEditing ? onSave() : onEditToggle(),
        size: "sm",
        className: `bg-cyan-800 hover:bg-cyan-700 h-10 px-3 sm:px-4 text-xs sm:text-sm`,
        children: [
          isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsx(Save, { className: "h-4 w-4 mr-1" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(SquarePen, { className: "h-4 w-4 mr-1" }),
          isEditing ? "Salva" : "Modifica"
        ]
      }
    )
  ] });
};

const getSubscriptionRingColor = (plan) => {
  switch (plan?.toLowerCase()) {
    case "silver":
      return "#C0C0C0";
    case "gold":
      return "#FFD700";
    case "black":
      return "#333333";
    case "titanium":
      return "#878787";
    default:
      return "#444444";
  }
};
const ProfileInfo = ({
  profileImage,
  name,
  bio,
  agentCode,
  agentTitle,
  investigativeStyle,
  stats,
  credits,
  isEditing,
  subscriptionPlan = "base",
  personalInfo,
  setProfileImage,
  setName,
  setBio,
  setAgentCode,
  setAgentTitle
}) => {
  const isMobile = useIsMobile();
  const { pulseEnergy, currentRank, nextRank, progressToNextRank, loading: peLoading } = usePulseEnergy();
  reactExports.useEffect(() => {
  }, [pulseEnergy, currentRank, nextRank, progressToNextRank]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-shrink-0 flex flex-col items-center md:w-1/3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute inset-0 rounded-full ring-2 ring-offset-2 ring-offset-black",
          style: {
            "--ring-color": getSubscriptionRingColor(subscriptionPlan),
            borderColor: "var(--ring-color)",
            boxShadow: `0 0 12px var(--ring-color)80`
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Avatar, { className: `${isMobile ? "w-24 h-24" : "w-32 h-32"} border-2 border-cyan-500 shadow-lg shadow-cyan-500/20 cursor-pointer relative z-10`, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarImage, { src: profileImage || "" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarFallback, { className: "bg-cyan-900/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: `${isMobile ? "w-8 h-8" : "w-12 h-12"} text-cyan-500` }) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute bottom-0 right-0 bg-cyan-500 rounded-full p-1.5 cursor-pointer hover:bg-cyan-400 transition-colors",
          onClick: () => document.getElementById("profile-image-input")?.click(),
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(Camera, { className: "w-3 h-3 text-black" })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "input",
        {
          id: "profile-image-input",
          type: "file",
          accept: "image/*",
          onChange: async (e) => {
            const file = e.target.files?.[0];
            if (file) {
              try {
                const fileName = `avatar-${Date.now()}.${file.name.split(".").pop()}`;
                const { data, error } = await supabase.storage.from("avatars").upload(fileName, file, {
                  cacheControl: "3600",
                  upsert: false
                });
                if (error) {
                  ue.error("Errore nel caricamento dell'immagine");
                  return;
                }
                const { data: publicUrl } = supabase.storage.from("avatars").getPublicUrl(data.path);
                setProfileImage(publicUrl.publicUrl);
                ue.success("Immagine profilo aggiornata");
              } catch (error) {
                ue.error("Errore nel caricamento dell'immagine");
              }
            }
          },
          className: "hidden"
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 text-center w-full max-w-[250px] mx-auto", children: isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          value: name,
          onChange: (e) => setName(e.target.value),
          className: "mb-2 bg-black/30 h-10",
          placeholder: "Nome Agente"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          value: agentCode,
          onChange: (e) => setAgentCode(e.target.value),
          className: "mb-2 bg-black/30 font-mono h-10",
          placeholder: "Codice Agente"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          value: agentTitle,
          onChange: (e) => setAgentTitle(e.target.value),
          className: "mb-2 bg-black/30 h-10",
          placeholder: "Titolo Agente"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Textarea,
        {
          value: bio,
          onChange: (e) => setBio(e.target.value),
          className: "bg-black/30",
          placeholder: "Bio",
          rows: isMobile ? 3 : 4
        }
      )
    ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: `${isMobile ? "text-lg" : "text-xl"} font-bold mb-1`, children: name }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400 mb-3", children: bio }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 p-2 bg-black/30 rounded-md border border-gray-800", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Stile investigativo:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center mt-1 justify-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `w-3 h-3 rounded-full ${investigativeStyle.color} mr-2` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: investigativeStyle.style })
        ] })
      ] }),
      !peLoading && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 space-y-3", "data-testid": "pe-system-container", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          PulseEnergyBadge,
          {
            rank: currentRank,
            showCode: true,
            className: currentRank?.code === "SRC-" ? "ring-2 ring-purple-500 animate-pulse" : "",
            "data-testid": "pe-badge"
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { "data-testid": "pe-progress", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          PulseEnergyProgressBar,
          {
            currentRank,
            nextRank,
            progressPercent: progressToNextRank,
            currentPE: pulseEnergy
          }
        ) })
      ] }),
      personalInfo && (personalInfo.firstName || personalInfo.email || personalInfo.phone) && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 p-2 bg-black/30 rounded-md border border-gray-800", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Informazioni personali:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-1 text-left text-xs", children: [
          personalInfo.firstName && personalInfo.lastName && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Nome: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: `${personalInfo.firstName} ${personalInfo.lastName}` })
          ] }),
          personalInfo.email && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Email: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: personalInfo.email })
          ] }),
          personalInfo.phone && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Telefono: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: personalInfo.phone })
          ] }),
          personalInfo.address && personalInfo.city && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Indirizzo: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: `${personalInfo.address}, ${personalInfo.city}` }),
            personalInfo.postalCode && ` (${personalInfo.postalCode})`
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap justify-center gap-4 mt-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-col items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-baseline", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400 mr-1.5", children: "Missioni: " }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 text-lg font-medium", children: stats.missionsCompleted })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-col items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-baseline", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400 mr-1.5", children: "Indizi: " }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 text-lg font-medium", children: stats.cluesFound })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-col items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-baseline", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400 mr-1.5", children: "Crediti: " }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 text-lg font-medium", children: credits })
        ] }) })
      ] })
    ] }) })
  ] });
};

const useUniversalSubscriptionSync = () => {
  const { getCurrentUser } = useAuthContext();
  const triggerGlobalSync = reactExports.useMemo(() => (newPlan) => {
    localStorage.setItem("subscription_plan", newPlan);
    localStorage.setItem("userTier", newPlan);
    window.dispatchEvent(new StorageEvent("storage", {
      key: "subscription_plan",
      newValue: newPlan,
      storageArea: localStorage
    }));
    window.dispatchEvent(new CustomEvent("subscription-sync", {
      detail: { plan: newPlan, timestamp: Date.now() }
    }));
  }, []);
  reactExports.useEffect(() => {
    const user = getCurrentUser();
    if (!user) return;
    const profilesChannel = supabase.channel(`profiles-sync-${user.id}`).on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "profiles",
        filter: `id=eq.${user.id}`
      },
      (payload) => {
        const newTier = payload.new?.subscription_tier || payload.new?.tier;
        if (newTier) {
          triggerGlobalSync(newTier);
        }
      }
    ).subscribe();
    const subscriptionsChannel = supabase.channel(`subscriptions-sync-${user.id}`).on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "subscriptions",
        filter: `user_id=eq.${user.id}`
      },
      (payload) => {
        const newTier = payload.new?.tier;
        if (newTier) {
          triggerGlobalSync(newTier);
        }
      }
    ).subscribe();
    return () => {
      supabase.removeChannel(profilesChannel);
      supabase.removeChannel(subscriptionsChannel);
    };
  }, [getCurrentUser, triggerGlobalSync]);
  return { triggerGlobalSync };
};

const useProfileSubscription = () => {
  const { getCurrentUser } = useAuthContext();
  const { triggerGlobalSync } = useUniversalSubscriptionSync();
  const [subscription, setSubscription] = reactExports.useState({
    plan: "Base",
    expiry: "2025-12-31",
    benefits: ["Accesso di base", "Missioni standard"]
  });
  const [credits, setCredits] = reactExports.useState(500);
  const loadSubscriptionFromSupabase = async () => {
    const currentUser = getCurrentUser();
    if (!currentUser) return;
    try {
      const { data: activeSubscription, error: subError } = await supabase.from("subscriptions").select("*").eq("user_id", currentUser.id).eq("status", "active").order("created_at", { ascending: false }).limit(1);
      const { data: profileData, error: profileError } = await supabase.from("profiles").select("subscription_tier, tier").eq("id", currentUser.id).single();
      if (profileError) return;
      let finalPlan = "Base";
      if (!subError && activeSubscription && activeSubscription.length > 0) {
        const sub = activeSubscription[0];
        const isExpired = sub.end_date && new Date(sub.end_date) < /* @__PURE__ */ new Date();
        if (!isExpired) {
          finalPlan = sub.tier;
        }
      } else if (profileData?.subscription_tier) {
        finalPlan = profileData.subscription_tier;
      }
      switch (finalPlan) {
        case "Silver":
          setSubscription({
            plan: "Silver",
            expiry: "2025-12-31",
            benefits: ["Accesso prioritario", "Indizi esclusivi", "Supporto dedicato"]
          });
          setCredits(1500);
          break;
        case "Gold":
          setSubscription({
            plan: "Gold",
            expiry: "2025-12-31",
            benefits: ["Accesso prioritario", "Indizi esclusivi", "Supporto dedicato", "Contenuti premium"]
          });
          setCredits(2500);
          break;
        case "Black":
          setSubscription({
            plan: "Black",
            expiry: "2025-12-31",
            benefits: [
              "Accesso prioritario VIP",
              "Indizi esclusivi premium",
              "Supporto dedicato 24/7",
              "Contenuti esclusivi Black",
              "Accesso anticipato alle novit"
            ]
          });
          setCredits(1e4);
          break;
        case "Titanium":
          setSubscription({
            plan: "Titanium",
            expiry: "2025-12-31",
            benefits: [
              "Accesso illimitato a tutto",
              "Badge Titanium esclusivo neon",
              "Supporto prioritario 24/7",
              "Eventi esclusivi Titanium VIP",
              "Contenuti premium anticipati"
            ]
          });
          setCredits(25e3);
          break;
        default:
          setSubscription({
            plan: "Base",
            expiry: "2025-12-31",
            benefits: ["Accesso di base", "Missioni standard"]
          });
          setCredits(500);
      }
      triggerGlobalSync(finalPlan);
    } catch (error) {
    }
  };
  reactExports.useEffect(() => {
    loadSubscriptionFromSupabase();
    const handleStorageChange = () => {
      loadSubscriptionFromSupabase();
    };
    window.addEventListener("storage", handleStorageChange);
    return () => window.removeEventListener("storage", handleStorageChange);
  }, [getCurrentUser]);
  const upgradeSubscription = async (newPlan) => {
    const currentUser = getCurrentUser();
    if (!currentUser) return;
    try {
      const { error: cancelAllError } = await supabase.from("subscriptions").update({ status: "canceled", updated_at: (/* @__PURE__ */ new Date()).toISOString() }).eq("user_id", currentUser.id).neq("status", "canceled");
      if (cancelAllError) {
      } else {
      }
      if (newPlan === "Base") {
        try {
          const { data: cancelData, error: cancelStripeError } = await supabase.functions.invoke("cancel-subscription");
          if (cancelStripeError) {
          } else {
          }
        } catch (stripeError) {
        }
      } else {
        const { error: insertError } = await supabase.from("subscriptions").insert({
          user_id: currentUser.id,
          tier: newPlan,
          status: "active",
          start_date: (/* @__PURE__ */ new Date()).toISOString(),
          end_date: new Date(Date.now() + 365 * 24 * 60 * 60 * 1e3).toISOString(),
          provider: "stripe"
        });
        if (insertError) {
        } else {
        }
      }
      const { error: profileError } = await supabase.from("profiles").update({
        subscription_tier: newPlan,
        tier: newPlan,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", currentUser.id);
      if (profileError) {
        throw new Error(`Profile update failed: ${profileError.message}`);
      } else {
      }
      localStorage.setItem("subscription_plan", newPlan);
      localStorage.setItem("userTier", newPlan);
      window.dispatchEvent(new Event("storage"));
      setTimeout(() => {
        loadSubscriptionFromSupabase();
      }, 100);
      setTimeout(() => {
        loadSubscriptionFromSupabase();
      }, 1e3);
      setTimeout(() => {
        loadSubscriptionFromSupabase();
      }, 3e3);
    } catch (error) {
      throw error;
    }
  };
  return {
    subscription,
    credits,
    setSubscription,
    setCredits,
    upgradeSubscription,
    refreshSubscription: loadSubscriptionFromSupabase
  };
};

const CATEGORY_INFO = {
  exploration: { label: "Esplorazione", icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Map$1, { className: "w-4 h-4" }), color: "#00D1FF" },
  social: { label: "Social", icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-4 h-4" }), color: "#FF59F8" },
  missions: { label: "Missioni", icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-4 h-4" }), color: "#FFD700" },
  time: { label: "Tempo", icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-4 h-4" }), color: "#00FF88" },
  special: { label: "Speciali", icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "w-4 h-4" }), color: "#9B59B6" }
};
const RARITY_STYLES = {
  common: {
    bg: "from-gray-600/30 to-gray-700/30",
    border: "border-gray-500/40",
    glow: "",
    text: "text-gray-300"
  },
  rare: {
    bg: "from-blue-600/30 to-cyan-600/30",
    border: "border-blue-400/50",
    glow: "shadow-[0_0_15px_rgba(59,130,246,0.3)]",
    text: "text-blue-400"
  },
  epic: {
    bg: "from-purple-600/30 to-pink-600/30",
    border: "border-purple-400/50",
    glow: "shadow-[0_0_20px_rgba(168,85,247,0.4)]",
    text: "text-purple-400"
  },
  legendary: {
    bg: "from-yellow-500/30 to-orange-500/30",
    border: "border-yellow-400/60",
    glow: "shadow-[0_0_25px_rgba(250,204,21,0.5)]",
    text: "text-yellow-400"
  }
};
function BadgeShowcase() {
  const { user } = useAuthContext();
  const [badges, setBadges] = reactExports.useState([]);
  const [categoryProgress, setCategoryProgress] = reactExports.useState([]);
  const [selectedCategory, setSelectedCategory] = reactExports.useState("all");
  const [loading, setLoading] = reactExports.useState(true);
  const [selectedBadge, setSelectedBadge] = reactExports.useState(null);
  reactExports.useEffect(() => {
    if (user?.id) {
      fetchBadges();
    }
  }, [user?.id]);
  const fetchBadges = async () => {
    if (!user?.id) return;
    setLoading(true);
    try {
      const { data: allBadges, error: badgesError } = await supabase.from("badges").select("*").order("sort_order", { ascending: true });
      if (badgesError) throw badgesError;
      const { data: userBadges, error: userError } = await supabase.from("user_badges").select("badge_id, created_at").eq("user_id", user.id);
      if (userError) throw userError;
      const unlockedMap = new Map(
        userBadges?.map((ub) => [ub.badge_id, ub.created_at]) || []
      );
      const mergedBadges = (allBadges || []).map((badge) => ({
        badge_id: badge.badge_id,
        name: badge.name,
        description: badge.description || "",
        icon: badge.icon || "",
        category: badge.category || "general",
        rarity: badge.rarity || "common",
        xp_reward: badge.xp_reward || 10,
        unlocked: unlockedMap.has(badge.badge_id),
        unlocked_at: unlockedMap.get(badge.badge_id)
      }));
      setBadges(mergedBadges);
      const progressMap = /* @__PURE__ */ new Map();
      mergedBadges.forEach((badge) => {
        const cat = badge.category;
        const current = progressMap.get(cat) || { total: 0, unlocked: 0 };
        current.total++;
        if (badge.unlocked) current.unlocked++;
        progressMap.set(cat, current);
      });
      setCategoryProgress(
        Array.from(progressMap.entries()).map(([category, { total, unlocked }]) => ({
          category,
          total,
          unlocked
        }))
      );
    } catch (error) {
    } finally {
      setLoading(false);
    }
  };
  const filteredBadges = selectedCategory === "all" ? badges : badges.filter((b) => b.category === selectedCategory);
  const totalUnlocked = badges.filter((b) => b.unlocked).length;
  const totalBadges = badges.length;
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-12", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        animate: { rotate: 360 },
        transition: { duration: 1, repeat: Infinity, ease: "linear" },
        className: "w-8 h-8 border-2 border-cyan-400 border-t-transparent rounded-full"
      }
    ) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-orbitron font-bold text-white flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-5 h-5 text-yellow-400" }),
          "Collezione Badge"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-gray-400", children: [
          totalUnlocked,
          " / ",
          totalBadges,
          " sbloccati"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-cyan-400", children: [
          Math.round(totalUnlocked / totalBadges * 100),
          "%"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-500", children: "Completamento" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-2 bg-gray-800 rounded-full overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { width: 0 },
        animate: { width: `${totalUnlocked / totalBadges * 100}%` },
        transition: { duration: 1, ease: "easeOut" },
        className: "h-full bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500"
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2 overflow-x-auto pb-2 scrollbar-hide", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.button,
        {
          whileTap: { scale: 0.95 },
          onClick: () => {
            hapticLight();
            setSelectedCategory("all");
          },
          className: `flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-all ${selectedCategory === "all" ? "bg-gradient-to-r from-cyan-500 to-purple-500 text-white" : "bg-gray-800/50 text-gray-400 border border-gray-700/50"}`,
          children: [
            "Tutti (",
            totalBadges,
            ")"
          ]
        }
      ),
      Object.entries(CATEGORY_INFO).map(([key, info]) => {
        const progress = categoryProgress.find((p) => p.category === key);
        return /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.button,
          {
            whileTap: { scale: 0.95 },
            onClick: () => {
              hapticLight();
              setSelectedCategory(key);
            },
            className: `flex-shrink-0 flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all ${selectedCategory === key ? "text-white" : "bg-gray-800/50 text-gray-400 border border-gray-700/50"}`,
            style: selectedCategory === key ? {
              background: `linear-gradient(135deg, ${info.color}40, ${info.color}20)`,
              borderColor: `${info.color}60`
            } : {},
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { style: { color: selectedCategory === key ? info.color : "inherit" }, children: info.icon }),
              info.label,
              progress && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs opacity-60", children: [
                progress.unlocked,
                "/",
                progress.total
              ] })
            ]
          },
          key
        );
      })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "popLayout", children: filteredBadges.map((badge, index) => {
      const rarityStyle = RARITY_STYLES[badge.rarity];
      return /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          layout: true,
          initial: { opacity: 0, scale: 0.8 },
          animate: { opacity: 1, scale: 1 },
          exit: { opacity: 0, scale: 0.8 },
          transition: { delay: index * 0.02, duration: 0.2 },
          whileHover: { scale: 1.05, y: -2 },
          whileTap: { scale: 0.95 },
          onClick: () => {
            hapticLight();
            setSelectedBadge(badge);
          },
          className: `relative aspect-square rounded-xl border cursor-pointer overflow-hidden transition-all
                  bg-gradient-to-br ${rarityStyle.bg} ${rarityStyle.border} ${badge.unlocked ? rarityStyle.glow : "opacity-40"}
                `,
          children: [
            badge.unlocked && badge.rarity === "legendary" && /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "absolute inset-0 bg-gradient-to-r from-yellow-400/0 via-yellow-400/30 to-yellow-400/0",
                animate: { x: ["-100%", "200%"] },
                transition: { duration: 2, repeat: Infinity, ease: "linear" }
              }
            ),
            !badge.unlocked && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-6 h-6 text-gray-500" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative z-5 h-full flex flex-col items-center justify-center p-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.span,
                {
                  className: "text-2xl sm:text-3xl",
                  animate: badge.unlocked && badge.rarity !== "common" ? {
                    scale: [1, 1.1, 1],
                    rotate: [0, 5, -5, 0]
                  } : {},
                  transition: { duration: 2, repeat: Infinity },
                  children: badge.icon
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `absolute bottom-1 left-1 right-1 text-center`, children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `text-[8px] font-bold uppercase tracking-wider ${rarityStyle.text}`, children: badge.rarity }) })
            ] }),
            badge.unlocked && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute top-1 right-1 px-1.5 py-0.5 bg-black/50 rounded text-[8px] font-bold text-yellow-400", children: [
              "+",
              badge.xp_reward
            ] })
          ]
        },
        badge.badge_id
      );
    }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: selectedBadge && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        exit: { opacity: 0 },
        className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",
        onClick: () => setSelectedBadge(null),
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0.8, y: 20 },
            animate: { scale: 1, y: 0 },
            exit: { scale: 0.8, y: 20 },
            onClick: (e) => e.stopPropagation(),
            className: `relative w-full max-w-sm p-6 rounded-2xl border overflow-hidden
                bg-gradient-to-br ${RARITY_STYLES[selectedBadge.rarity].bg}
                ${RARITY_STYLES[selectedBadge.rarity].border}
                ${RARITY_STYLES[selectedBadge.rarity].glow}
              `,
            children: [
              selectedBadge.rarity === "legendary" && /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "absolute inset-0 bg-gradient-to-r from-yellow-400/0 via-yellow-400/20 to-yellow-400/0",
                  animate: { x: ["-100%", "200%"] },
                  transition: { duration: 3, repeat: Infinity }
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative z-10 text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: selectedBadge.unlocked ? {
                      scale: [1, 1.1, 1],
                      rotate: [0, 10, -10, 0]
                    } : {},
                    transition: { duration: 2, repeat: Infinity },
                    className: "text-6xl mb-4",
                    children: selectedBadge.icon
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-orbitron font-bold text-white mb-2", children: selectedBadge.name }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `inline-block px-3 py-1 rounded-full text-xs font-bold uppercase ${RARITY_STYLES[selectedBadge.rarity].text} bg-black/30`, children: selectedBadge.rarity }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-300 mt-4", children: selectedBadge.description }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 flex items-center justify-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-4 h-4 text-yellow-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-yellow-400 font-bold", children: [
                    "+",
                    selectedBadge.xp_reward,
                    " PE"
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4", children: selectedBadge.unlocked ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-green-400 text-sm", children: [
                  " Sbloccato ",
                  selectedBadge.unlocked_at && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-gray-500", children: [
                    "il ",
                    new Date(selectedBadge.unlocked_at).toLocaleDateString("it-IT")
                  ] })
                ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-gray-500 text-sm flex items-center justify-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-4 h-4" }),
                  " Non ancora sbloccato"
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 text-xs text-gray-500", children: [
                  "Categoria: ",
                  CATEGORY_INFO[selectedBadge.category]?.label || selectedBadge.category
                ] })
              ] })
            ]
          }
        )
      }
    ) }),
    filteredBadges.length === 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-8 text-gray-500", children: "Nessun badge in questa categoria" })
  ] });
}

const ProfileTabs = ({
  stats,
  history,
  badges,
  subscription: passedSubscription,
  personalNotes,
  isEditing,
  setPersonalNotes,
  togglePinBadge,
  navigateToPersonalInfo,
  navigateToPrivacySecurity,
  navigateToPaymentMethods,
  navigateToSubscriptions
}) => {
  const { subscription: liveSubscription } = useProfileSubscription();
  const subscription = liveSubscription;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "stats", className: "w-full", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "w-full grid grid-cols-4 bg-black/30", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "stats", className: "text-xs", children: "Statistiche" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "history", className: "text-xs", children: "Cronologia" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "badges", className: "text-xs", children: "Badge" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "account", className: "text-xs", children: "Account" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "stats", className: "p-4 bg-black/20 rounded-md mt-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-sm font-bold mb-3 flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "h-4 w-4 text-cyan-400" }),
        "Statistiche Personali"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-xs mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Avanzamento verso il premio" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
              stats.prizeProgress,
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: stats.prizeProgress, className: "h-2 bg-gray-800" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "stat-item", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Missioni completate: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-base font-medium", children: stats.missionsCompleted })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "stat-item", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Indizi trovati: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-base font-medium", children: stats.cluesFound })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "stat-item", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Tempo di gioco: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-base font-medium", children: stats.totalPlayTime })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "stat-item", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "PE totali: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-base font-medium", children: stats.pointsEarned.toLocaleString("it-IT") })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-cyan-900/20 p-3 rounded-md border border-cyan-900/40", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-cyan-400", children: "Miglior risultato" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: stats.bestResult })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "history", className: "p-4 bg-black/20 rounded-md mt-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-sm font-bold mb-3 flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "h-4 w-4 text-cyan-400" }),
        "Cronologia Operativa"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: history.map((item, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-l-2 border-cyan-800 pl-3 py-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs font-medium", children: [
            item.type === "access" && "Accesso",
            item.type === "mission" && "Missione",
            item.type === "clue" && "Indizio",
            item.type === "communication" && "Comunicazione"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-gray-500", children: [
            new Date(item.date).toLocaleDateString(),
            " - ",
            new Date(item.date).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: item.details })
      ] }, index)) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-bold mb-2", children: "Note personali" }),
        isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsx(
          Textarea,
          {
            value: personalNotes,
            onChange: (e) => setPersonalNotes(e.target.value),
            className: "bg-black/30 h-20"
          }
        ) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-black/20 p-3 rounded-md border border-gray-800 text-sm italic", children: personalNotes })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "badges", className: "p-4 bg-black/20 rounded-md mt-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(BadgeShowcase, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "account", className: "p-4 bg-black/20 rounded-md mt-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-sm font-bold mb-3 flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-4 w-4 text-cyan-400" }),
        "Sicurezza e Abbonamento"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        AccountTabContent,
        {
          subscription,
          navigateToPersonalInfo,
          navigateToPrivacySecurity,
          navigateToPaymentMethods,
          navigateToSubscriptions
        }
      )
    ] })
  ] });
};
const AccountTabContent = ({
  subscription,
  navigateToPersonalInfo,
  navigateToPrivacySecurity,
  navigateToPaymentMethods,
  navigateToSubscriptions
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 p-3 rounded-md bg-gradient-to-r from-cyan-900/30 to-blue-900/30 border border-cyan-900/40", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "text-sm font-bold", children: [
          "Piano attivo: ",
          subscription.plan
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "bg-amber-600 text-white text-xs px-2 py-0.5 rounded-full", children: subscription.plan })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-gray-400 block mt-1", children: [
        "Scadenza: ",
        new Date(subscription.expiry).toLocaleDateString()
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Vantaggi:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "mt-1 text-xs space-y-1", children: subscription.benefits.map((benefit, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { className: "flex items-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "h-1.5 w-1.5 rounded-full bg-cyan-400 mr-2" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: benefit })
        ] }, index)) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          className: "w-full mt-3 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600",
          size: "sm",
          onClick: navigateToSubscriptions,
          children: "Gestisci Abbonamento"
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      AccountSecuritySettings,
      {
        navigateToPersonalInfo,
        navigateToPrivacySecurity,
        navigateToPaymentMethods
      }
    )
  ] });
};
const AccountSecuritySettings = ({
  navigateToPersonalInfo,
  navigateToPrivacySecurity,
  navigateToPaymentMethods
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "flex items-center justify-between p-2 bg-black/30 rounded-md cursor-pointer hover:bg-black/40 transition-colors",
        onClick: navigateToPersonalInfo,
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-4 w-4 text-cyan-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Informazioni personali" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "ghost", size: "sm", className: "h-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-3.5 w-3.5" }) })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "flex items-center justify-between p-2 bg-black/30 rounded-md cursor-pointer hover:bg-black/40 transition-colors",
        onClick: navigateToPrivacySecurity,
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-4 w-4 text-cyan-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Password e sicurezza" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "ghost", size: "sm", className: "h-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-3.5 w-3.5" }) })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "flex items-center justify-between p-2 bg-black/30 rounded-md cursor-pointer hover:bg-black/40 transition-colors",
        onClick: navigateToPaymentMethods,
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-4 w-4 text-cyan-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Metodi di pagamento" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "ghost", size: "sm", className: "h-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-3.5 w-3.5" }) })
        ]
      }
    )
  ] });
};

const useGlobalProfileSync = () => {
  const { profileData } = useProfileRealtime();
  reactExports.useEffect(() => {
    if (profileData) {
      const syncEvent = new CustomEvent("profile-sync", {
        detail: profileData
      });
      window.dispatchEvent(syncEvent);
      if (profileData.full_name) {
        localStorage.setItem("profileName", profileData.full_name);
        localStorage.setItem("agentName", profileData.full_name);
      }
      if (profileData.bio) {
        localStorage.setItem("profileBio", profileData.bio);
      }
      if (profileData.agent_code) {
        localStorage.setItem("agentCode", profileData.agent_code);
      }
      if (profileData.avatar_url) {
        localStorage.setItem("profileImage", profileData.avatar_url);
      }
      window.dispatchEvent(new Event("storage"));
    }
  }, [profileData]);
  return profileData;
};

const useProfileBasicInfo = () => {
  const [isEditing, setIsEditing] = reactExports.useState(false);
  const [bio, setBio] = reactExports.useState("Appassionato di auto di lusso e collezionista. Amo la velocit e l'adrenalina!");
  const [name, setName] = reactExports.useState("Mario Rossi");
  const [agentCode, setAgentCode] = reactExports.useState("AG-X480");
  const [agentTitle, setAgentTitle] = reactExports.useState("Decoder");
  const [profileImage, setProfileImage] = reactExports.useState(null);
  const { toast } = useToast();
  const globalProfile = useGlobalProfileSync();
  const { updateProfile } = useProfileRealtime();
  reactExports.useEffect(() => {
    if (globalProfile) {
      if (globalProfile.full_name) {
        setName(globalProfile.full_name);
      }
      if (globalProfile.bio) setBio(globalProfile.bio);
      if (globalProfile.agent_code) setAgentCode(globalProfile.agent_code);
      if (globalProfile.agent_title) setAgentTitle(globalProfile.agent_title);
      if (globalProfile.avatar_url) setProfileImage(globalProfile.avatar_url);
    }
  }, [globalProfile]);
  reactExports.useEffect(() => {
    const loadProfileBasicInfo = async () => {
      if (!globalProfile) {
        const savedProfileImage = localStorage.getItem("profileImage");
        if (savedProfileImage) setProfileImage(savedProfileImage);
        const savedName = localStorage.getItem("profileName");
        if (savedName) setName(savedName);
        const savedBio = localStorage.getItem("profileBio");
        if (savedBio) setBio(savedBio);
        const savedAgentCode = localStorage.getItem("agentCode");
        if (savedAgentCode) setAgentCode(savedAgentCode);
      }
    };
    loadProfileBasicInfo();
  }, [globalProfile]);
  const handleSaveBasicInfo = async () => {
    try {
      if (profileImage) {
        localStorage.setItem("profileImage", profileImage);
      }
      localStorage.setItem("profileName", name);
      localStorage.setItem("profileBio", bio);
      localStorage.setItem("agentCode", agentCode);
      const result = await updateProfile({
        full_name: name,
        bio,
        agent_code: agentCode,
        agent_title: agentTitle,
        avatar_url: profileImage
      });
      setIsEditing(false);
      toast({
        title: " Profilo aggiornato",
        description: "Le modifiche al tuo dossier agente sono state salvate con successo."
      });
    } catch (error) {
      const errorMessage = error?.message || "Errore sconosciuto";
      const errorCode = error?.code || "N/A";
      toast({
        title: " Impossibile salvare le modifiche",
        description: `Errore: ${errorMessage} (Code: ${errorCode}). Verifica la connessione e riprova.`,
        variant: "destructive"
      });
    }
  };
  return {
    isEditing,
    bio,
    name,
    agentCode,
    agentTitle,
    profileImage,
    setIsEditing,
    setBio,
    setName,
    setAgentCode,
    setAgentTitle,
    setProfileImage,
    handleSaveBasicInfo
  };
};

const useProfileStats = () => {
  const [stats, setStats] = reactExports.useState({
    missionsCompleted: 12,
    cluesFound: 47,
    totalPlayTime: "123h 45m",
    pointsEarned: 9850,
    prizeProgress: 68,
    bestResult: "Top 5% in Mission X"
  });
  const [investigativeStyle, setInvestigativeStyle] = reactExports.useState({
    style: "Ragionatore Strategico",
    color: "bg-cyan-500"
  });
  reactExports.useEffect(() => {
    const loadStatsAndStyle = async () => {
      const styleName = localStorage.getItem("investigativeStyle");
      const styleColor = localStorage.getItem("investigativeStyleColor");
      if (styleName && styleColor) {
        setInvestigativeStyle({
          style: styleName,
          color: styleColor
        });
      } else {
        const profileType = localStorage.getItem("userProfileType");
        if (profileType) {
          switch (profileType) {
            case "comandante":
              setInvestigativeStyle({
                style: "Ragionatore Strategico",
                color: "bg-cyan-500"
              });
              break;
            case "assaltatore":
              setInvestigativeStyle({
                style: "Forza d'Impatto",
                color: "bg-red-500"
              });
              break;
            case "nexus":
              setInvestigativeStyle({
                style: "Tessitore di Reti",
                color: "bg-purple-500"
              });
              break;
          }
        }
      }
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (session?.user) {
          const { data, error } = await supabase.from("profiles").select("investigative_style").eq("id", session.user.id).single();
          if (data && !error) {
            if (data.investigative_style) {
              const styleMap = {
                "comandante": { style: "Ragionatore Strategico", color: "bg-cyan-500" },
                "assaltatore": { style: "Forza d'Impatto", color: "bg-red-500" },
                "nexus": { style: "Tessitore di Reti", color: "bg-purple-500" }
              };
              setInvestigativeStyle(styleMap[data.investigative_style] || investigativeStyle);
            }
          }
        }
      } catch (error) {
      }
    };
    loadStatsAndStyle();
  }, []);
  return {
    stats,
    investigativeStyle,
    setStats,
    setInvestigativeStyle
  };
};

const useProfileHistory = () => {
  const [history, setHistory] = reactExports.useState([
    { type: "access", date: "2025-05-03T14:30:00", details: "Login da dispositivo principale" },
    { type: "mission", date: "2025-05-02T10:15:00", details: "Completata Missione: Enigma della Strada" },
    { type: "clue", date: "2025-05-01T16:20:00", details: "Acquistato indizio CL-445: 'Tracce digitali'" },
    { type: "communication", date: "2025-04-30T08:45:00", details: "Nuova comunicazione da HQ: Aggiornamento missione" }
  ]);
  return {
    history,
    setHistory
  };
};

const useProfileBadges = () => {
  const [badges, setBadges] = reactExports.useState([
    { id: "b1", name: "Primo Contatto", description: "Hai completato la tua prima missione", unlocked: true, pinned: true },
    { id: "b2", name: "Segugio", description: "Hai trovato 10 indizi", unlocked: true, pinned: false },
    { id: "b3", name: "Viaggiatore", description: "Hai esplorato 5 location diverse", unlocked: true, pinned: false },
    { id: "b4", name: "Decifratore", description: "Hai risolto un enigma di livello difficile", unlocked: false, pinned: false }
  ]);
  const togglePinBadge = (id) => {
    setBadges(badges.map(
      (badge) => badge.id === id ? { ...badge, pinned: !badge.pinned } : badge.id !== id && badge.pinned ? { ...badge, pinned: false } : badge
    ));
  };
  return {
    badges,
    togglePinBadge
  };
};

const useProfilePersonalInfo = () => {
  const [personalInfo, setPersonalInfo] = reactExports.useState({
    firstName: "",
    lastName: "",
    email: "",
    phone: "",
    address: "",
    city: "",
    postalCode: "",
    country: ""
  });
  reactExports.useEffect(() => {
    const loadPersonalInfo = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (session?.user) {
          const { data, error } = await supabase.from("profiles").select("first_name, last_name, email, phone, address, city, postal_code, country").eq("id", session.user.id).single();
          if (data && !error) {
            setPersonalInfo({
              firstName: data.first_name || "",
              lastName: data.last_name || "",
              email: data.email || "",
              phone: data.phone || "",
              address: data.address || "",
              city: data.city || "",
              postalCode: data.postal_code || "",
              country: data.country || ""
            });
          }
        }
      } catch (error) {
      }
    };
    loadPersonalInfo();
  }, []);
  return {
    personalInfo,
    setPersonalInfo
  };
};

const useProfileNotes = () => {
  const [personalNotes, setPersonNotes] = reactExports.useState("Indizi sulla localizzazione del premio sembrano puntare a Nord...");
  const setPersonalNotes = (notes) => {
    setPersonNotes(notes);
  };
  return {
    personalNotes,
    setPersonalNotes
  };
};

const useProfileData = () => {
  const basicInfo = useProfileBasicInfo();
  const statsData = useProfileStats();
  const historyData = useProfileHistory();
  const badgesData = useProfileBadges();
  const personalInfoData = useProfilePersonalInfo();
  const subscriptionData = useProfileSubscription();
  const notesData = useProfileNotes();
  const notificationsData = useProfileNotifications();
  return {
    profileData: {
      isEditing: basicInfo.isEditing,
      bio: basicInfo.bio,
      name: basicInfo.name,
      agentCode: basicInfo.agentCode,
      agentTitle: basicInfo.agentTitle,
      profileImage: basicInfo.profileImage,
      showNotifications: notificationsData.showNotifications,
      stats: statsData.stats,
      investigativeStyle: statsData.investigativeStyle,
      history: historyData.history,
      credits: subscriptionData.credits,
      badges: badgesData.badges,
      subscription: subscriptionData.subscription,
      personalNotes: notesData.personalNotes,
      personalInfo: personalInfoData.personalInfo
    },
    actions: {
      setIsEditing: basicInfo.setIsEditing,
      setBio: basicInfo.setBio,
      setName: basicInfo.setName,
      setAgentCode: basicInfo.setAgentCode,
      setAgentTitle: basicInfo.setAgentTitle,
      setProfileImage: basicInfo.setProfileImage,
      setShowNotifications: notificationsData.setShowNotifications,
      handleSaveProfile: basicInfo.handleSaveBasicInfo,
      togglePinBadge: badgesData.togglePinBadge,
      setPersonalNotes: notesData.setPersonalNotes
    }
  };
};

const AgentProfileSettings = () => {
  const { navigate } = useWouterNavigation();
  const { profileData, actions } = useProfileData();
  useIsMobile();
  const { notificationsDrawerOpen, closeNotificationsDrawer } = useNotificationManager();
  useRealTimeNotifications();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-black", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(ProfileLayout, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card mx-2 sm:mx-4 mt-2 sm:mt-4 mb-20", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          ProfileHeader,
          {
            agentCode: profileData.agentCode,
            agentTitle: profileData.agentTitle,
            isEditing: profileData.isEditing,
            onEditToggle: () => actions.setIsEditing(true),
            onSave: actions.handleSaveProfile
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6 border-t border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl sm:text-2xl font-bold gradient-text mb-4", children: " Informazioni Agente" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col md:flex-row gap-4 sm:gap-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              ProfileInfo,
              {
                profileImage: profileData.profileImage,
                name: profileData.name,
                bio: profileData.bio,
                agentCode: profileData.agentCode,
                agentTitle: profileData.agentTitle,
                investigativeStyle: profileData.investigativeStyle,
                stats: {
                  missionsCompleted: profileData.stats.missionsCompleted,
                  cluesFound: profileData.stats.cluesFound
                },
                credits: profileData.credits,
                isEditing: profileData.isEditing,
                subscriptionPlan: profileData.subscription.plan,
                personalInfo: profileData.personalInfo,
                setProfileImage: actions.setProfileImage,
                setName: actions.setName,
                setBio: actions.setBio,
                setAgentCode: actions.setAgentCode,
                setAgentTitle: actions.setAgentTitle
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 mt-4 md:mt-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              ProfileTabs,
              {
                stats: profileData.stats,
                history: profileData.history,
                badges: profileData.badges,
                subscription: profileData.subscription,
                personalNotes: profileData.personalNotes,
                isEditing: profileData.isEditing,
                setPersonalNotes: actions.setPersonalNotes,
                togglePinBadge: actions.togglePinBadge,
                navigateToPersonalInfo: () => navigate("/profile/personal-info"),
                navigateToPrivacySecurity: () => navigate("/profile/security"),
                navigateToPaymentMethods: () => navigate("/profile/payments"),
                navigateToSubscriptions: () => navigate("/subscriptions")
              }
            ) })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        NotificationsDrawer,
        {
          open: notificationsDrawerOpen,
          onOpenChange: closeNotificationsDrawer
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        id: "mission-bottom-nav-container",
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4,
          isolation: "isolate",
          transform: "translateZ(0)",
          willChange: "transform",
          display: "block",
          visibility: "visible",
          opacity: 1
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

// src/slot.tsx
var SLOTTABLE_IDENTIFIER = Symbol("radix.slottable");
// @__NO_SIDE_EFFECTS__
function createSlottable(ownerName) {
  const Slottable2 = ({ children }) => {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
  };
  Slottable2.displayName = `${ownerName}.Slottable`;
  Slottable2.__radixId = SLOTTABLE_IDENTIFIER;
  return Slottable2;
}

var ROOT_NAME = "AlertDialog";
var [createAlertDialogContext] = createContextScope$2(ROOT_NAME, [
  createDialogScope
]);
var useDialogScope = createDialogScope();
var AlertDialog$1 = (props) => {
  const { __scopeAlertDialog, ...alertDialogProps } = props;
  const dialogScope = useDialogScope(__scopeAlertDialog);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Root$3, { ...dialogScope, ...alertDialogProps, modal: true });
};
AlertDialog$1.displayName = ROOT_NAME;
var TRIGGER_NAME$1 = "AlertDialogTrigger";
var AlertDialogTrigger$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...triggerProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Trigger$1, { ...dialogScope, ...triggerProps, ref: forwardedRef });
  }
);
AlertDialogTrigger$1.displayName = TRIGGER_NAME$1;
var PORTAL_NAME = "AlertDialogPortal";
var AlertDialogPortal$1 = (props) => {
  const { __scopeAlertDialog, ...portalProps } = props;
  const dialogScope = useDialogScope(__scopeAlertDialog);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Portal$1, { ...dialogScope, ...portalProps });
};
AlertDialogPortal$1.displayName = PORTAL_NAME;
var OVERLAY_NAME = "AlertDialogOverlay";
var AlertDialogOverlay$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...overlayProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Overlay, { ...dialogScope, ...overlayProps, ref: forwardedRef });
  }
);
AlertDialogOverlay$1.displayName = OVERLAY_NAME;
var CONTENT_NAME = "AlertDialogContent";
var [AlertDialogContentProvider, useAlertDialogContentContext] = createAlertDialogContext(CONTENT_NAME);
var Slottable = createSlottable("AlertDialogContent");
var AlertDialogContent$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, children, ...contentProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    const contentRef = reactExports.useRef(null);
    const composedRefs = useComposedRefs(forwardedRef, contentRef);
    const cancelRef = reactExports.useRef(null);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      WarningProvider,
      {
        contentName: CONTENT_NAME,
        titleName: TITLE_NAME,
        docsSlug: "alert-dialog",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogContentProvider, { scope: __scopeAlertDialog, cancelRef, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Content,
          {
            role: "alertdialog",
            ...dialogScope,
            ...contentProps,
            ref: composedRefs,
            onOpenAutoFocus: composeEventHandlers(contentProps.onOpenAutoFocus, (event) => {
              event.preventDefault();
              cancelRef.current?.focus({ preventScroll: true });
            }),
            onPointerDownOutside: (event) => event.preventDefault(),
            onInteractOutside: (event) => event.preventDefault(),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Slottable, { children }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(DescriptionWarning, { contentRef })
            ]
          }
        ) })
      }
    );
  }
);
AlertDialogContent$1.displayName = CONTENT_NAME;
var TITLE_NAME = "AlertDialogTitle";
var AlertDialogTitle$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...titleProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Title, { ...dialogScope, ...titleProps, ref: forwardedRef });
  }
);
AlertDialogTitle$1.displayName = TITLE_NAME;
var DESCRIPTION_NAME = "AlertDialogDescription";
var AlertDialogDescription$1 = reactExports.forwardRef((props, forwardedRef) => {
  const { __scopeAlertDialog, ...descriptionProps } = props;
  const dialogScope = useDialogScope(__scopeAlertDialog);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Description, { ...dialogScope, ...descriptionProps, ref: forwardedRef });
});
AlertDialogDescription$1.displayName = DESCRIPTION_NAME;
var ACTION_NAME = "AlertDialogAction";
var AlertDialogAction$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...actionProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Close, { ...dialogScope, ...actionProps, ref: forwardedRef });
  }
);
AlertDialogAction$1.displayName = ACTION_NAME;
var CANCEL_NAME = "AlertDialogCancel";
var AlertDialogCancel$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...cancelProps } = props;
    const { cancelRef } = useAlertDialogContentContext(CANCEL_NAME, __scopeAlertDialog);
    const dialogScope = useDialogScope(__scopeAlertDialog);
    const ref = useComposedRefs(forwardedRef, cancelRef);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Close, { ...dialogScope, ...cancelProps, ref });
  }
);
AlertDialogCancel$1.displayName = CANCEL_NAME;
var DescriptionWarning = ({ contentRef }) => {
  const MESSAGE = `\`${CONTENT_NAME}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${CONTENT_NAME}\` by passing a \`${DESCRIPTION_NAME}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${CONTENT_NAME}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;
  reactExports.useEffect(() => {
    const hasDescription = document.getElementById(
      contentRef.current?.getAttribute("aria-describedby")
    );
    if (!hasDescription) console.warn(MESSAGE);
  }, [MESSAGE, contentRef]);
  return null;
};
var Root2 = AlertDialog$1;
var Trigger2 = AlertDialogTrigger$1;
var Portal2 = AlertDialogPortal$1;
var Overlay2 = AlertDialogOverlay$1;
var Content2 = AlertDialogContent$1;
var Action = AlertDialogAction$1;
var Cancel = AlertDialogCancel$1;
var Title2 = AlertDialogTitle$1;
var Description2 = AlertDialogDescription$1;

const AlertDialog = Root2;
const AlertDialogTrigger = Trigger2;
const AlertDialogPortal = Portal2;
const AlertDialogOverlay = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Overlay2,
  {
    className: cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    ),
    ...props,
    ref
  }
));
AlertDialogOverlay.displayName = Overlay2.displayName;
const AlertDialogContent = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogPortal, { children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogOverlay, {}),
  /* @__PURE__ */ jsxRuntimeExports.jsx(
    Content2,
    {
      ref,
      className: cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      ),
      ...props
    }
  )
] }));
AlertDialogContent.displayName = Content2.displayName;
const AlertDialogHeader = ({
  className,
  ...props
}) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    ),
    ...props
  }
);
AlertDialogHeader.displayName = "AlertDialogHeader";
const AlertDialogFooter = ({
  className,
  ...props
}) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    ),
    ...props
  }
);
AlertDialogFooter.displayName = "AlertDialogFooter";
const AlertDialogTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Title2,
  {
    ref,
    className: cn("text-lg font-semibold", className),
    ...props
  }
));
AlertDialogTitle.displayName = Title2.displayName;
const AlertDialogDescription = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Description2,
  {
    ref,
    className: cn("text-sm text-muted-foreground", className),
    ...props
  }
));
AlertDialogDescription.displayName = Description2.displayName;
const AlertDialogAction = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Action,
  {
    ref,
    className: cn(buttonVariants(), className),
    ...props
  }
));
AlertDialogAction.displayName = Action.displayName;
const AlertDialogCancel = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Cancel,
  {
    ref,
    className: cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    ),
    ...props
  }
));
AlertDialogCancel.displayName = Cancel.displayName;

const SecuritySettings = () => {
  const { user} = useAuth();
  const { toast } = useToast();
  useWouterNavigation();
  const { profileImage } = useProfileImage();
  const [loading, setLoading] = reactExports.useState(false);
  const [showPasswords, setShowPasswords] = reactExports.useState(false);
  const [passwords, setPasswords] = reactExports.useState({
    current: "",
    new: "",
    confirm: ""
  });
  const [recoveryKey, setRecoveryKey] = reactExports.useState(null);
  const generateRecoveryKey = () => {
    const key = Array.from(
      { length: 12 },
      () => Math.random().toString(36).substring(2, 6)
    ).join("-").toUpperCase();
    setRecoveryKey(key);
    saveRecoveryKey(key);
  };
  const saveRecoveryKey = async (key) => {
    if (!user) return;
    try {
      const hashedKey = btoa(key);
      await supabase.from("profiles").update({
        recovery_key: hashedKey
      }).eq("id", user.id);
      toast({
        title: " Codice di emergenza generato",
        description: "Salva questo codice in un luogo sicuro. Non potr essere visualizzato nuovamente."
      });
    } catch (error) {
    }
  };
  const handlePasswordChange = async () => {
    if (!passwords.current || !passwords.new || !passwords.confirm) {
      toast({
        title: " Campi obbligatori",
        description: "Compila tutti i campi per cambiare la password.",
        variant: "destructive"
      });
      return;
    }
    if (passwords.new !== passwords.confirm) {
      toast({
        title: " Password non corrispondenti",
        description: "La nuova password e la conferma devono essere identiche.",
        variant: "destructive"
      });
      return;
    }
    if (passwords.new.length < 6) {
      toast({
        title: " Password troppo corta",
        description: "La password deve contenere almeno 6 caratteri.",
        variant: "destructive"
      });
      return;
    }
    setLoading(true);
    try {
      const { error } = await supabase.auth.updateUser({
        password: passwords.new
      });
      if (error) throw error;
      setPasswords({ current: "", new: "", confirm: "" });
      toast({
        title: " Password aggiornata",
        description: "La tua password  stata modificata con successo."
      });
    } catch (error) {
      toast({
        title: " Errore cambio password",
        description: error.message || "Impossibile aggiornare la password. Riprova.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const handleSignOutAllDevices = async () => {
    setLoading(true);
    try {
      const { error } = await supabase.auth.signOut({ scope: "global" });
      if (error) throw error;
      localStorage.clear();
      toast({
        title: " Disconnesso da tutti i dispositivi",
        description: "Tutte le sessioni sono state invalidate."
      });
      window.location.href = "/login";
    } catch (error) {
      toast({
        title: " Errore disconnessione",
        description: "Impossibile disconnettere tutti i dispositivi. Riprova.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage: profileImage || user?.user_metadata?.avatar_url }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "px-4 space-y-6",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            exit: { opacity: 0, y: -20 },
            transition: { duration: 0.3 },
            className: "space-y-6",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white font-orbitron", children: "Sicurezza" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci la sicurezza del tuo account" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 mr-2" }),
                  "Cambio Password"
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "currentPassword", className: "text-white", children: "Password Attuale" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Input,
                        {
                          id: "currentPassword",
                          type: showPasswords ? "text" : "password",
                          value: passwords.current,
                          onChange: (e) => setPasswords((prev) => ({ ...prev, current: e.target.value })),
                          className: "bg-black/20 border-white/20 text-white pr-10",
                          placeholder: "Inserisci password attuale"
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Button,
                        {
                          type: "button",
                          variant: "ghost",
                          size: "icon",
                          className: "absolute right-2 top-1/2 -translate-y-1/2 text-white/50 hover:text-white",
                          onClick: () => setShowPasswords(!showPasswords),
                          children: showPasswords ? /* @__PURE__ */ jsxRuntimeExports.jsx(EyeOff, { className: "w-4 h-4" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-4 h-4" })
                        }
                      )
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "newPassword", className: "text-white", children: "Nuova Password" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Input,
                      {
                        id: "newPassword",
                        type: showPasswords ? "text" : "password",
                        value: passwords.new,
                        onChange: (e) => setPasswords((prev) => ({ ...prev, new: e.target.value })),
                        className: "bg-black/20 border-white/20 text-white",
                        placeholder: "Inserisci nuova password"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "confirmPassword", className: "text-white", children: "Conferma Password" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Input,
                      {
                        id: "confirmPassword",
                        type: showPasswords ? "text" : "password",
                        value: passwords.confirm,
                        onChange: (e) => setPasswords((prev) => ({ ...prev, confirm: e.target.value })),
                        className: "bg-black/20 border-white/20 text-white",
                        placeholder: "Conferma nuova password"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: handlePasswordChange,
                      disabled: loading,
                      className: "w-full bg-[#00D1FF] hover:bg-[#00B8E6] text-black font-semibold",
                      children: loading ? "Aggiornamento..." : "Cambia Password"
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Key, { className: "w-5 h-5 mr-2" }),
                  "Codice di Emergenza"
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Genera un codice di emergenza per recuperare l'accesso al tuo account." }),
                  recoveryKey && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 bg-red-900/20 border border-red-500/20 rounded-lg", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-400 text-sm font-semibold mb-2", children: " IMPORTANTE: Salva questo codice ora!" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-white font-mono bg-black/40 p-2 rounded block text-center", children: recoveryKey }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300 text-xs mt-2", children: "Questo codice non sar pi visibile dopo aver chiuso questa schermata." })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: generateRecoveryKey,
                      variant: "outline",
                      className: "w-full border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/10",
                      children: recoveryKey ? "Genera Nuovo Codice" : "Genera Codice di Emergenza"
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-red-500/20 backdrop-blur-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(LogOut, { className: "w-5 h-5 mr-2" }),
                  "Gestione Sessioni"
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Disconnetti il tuo account da tutti i dispositivi e invalidare tutte le sessioni attive." }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialog, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTrigger, { asChild: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Button,
                      {
                        variant: "destructive",
                        className: "w-full bg-red-600 hover:bg-red-700",
                        disabled: loading,
                        children: "Disconnetti da Tutti i Dispositivi"
                      }
                    ) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogContent, { className: "bg-black/90 border-red-500/20", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogHeader, { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTitle, { className: "text-white", children: "Conferma Disconnessione" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogDescription, { className: "text-white/70", children: "Questa azione disconnetter il tuo account da tutti i dispositivi. Dovrai effettuare nuovamente il login ovunque." })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogFooter, { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogCancel, { className: "bg-white/10 text-white border-white/20", children: "Annulla" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          AlertDialogAction,
                          {
                            onClick: handleSignOutAllDevices,
                            className: "bg-red-600 hover:bg-red-700",
                            children: "Conferma Disconnessione"
                          }
                        )
                      ] })
                    ] })
                  ] })
                ] })
              ] })
            ]
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        id: "settings-bottom-nav-container",
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4,
          isolation: "isolate",
          transform: "translateZ(0)",
          willChange: "transform",
          display: "block",
          visibility: "visible",
          opacity: 1
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

const STORAGE_KEY$1 = "m1_battle_fx_performance_mode";
const DEFAULT_MODE = "high";
function usePerformanceSettings() {
  const { user, isAuthenticated } = useUnifiedAuth();
  const [battleFxMode, setBattleFxModeState] = reactExports.useState(DEFAULT_MODE);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    const loadSettings = async () => {
      try {
        const savedModeLocal = localStorage.getItem(STORAGE_KEY$1);
        if (savedModeLocal === "high" || savedModeLocal === "low") {
          setBattleFxModeState(savedModeLocal);
        }
      } catch (e) {
      } finally {
        setIsLoading(false);
      }
    };
    loadSettings();
  }, [isAuthenticated, user?.id]);
  reactExports.useEffect(() => {
    if (!isAuthenticated || !user?.id) return;
    const handleSettingsSync = (event) => {
      try {
        const detail = event.detail;
        if (detail?.preferences?.battle?.fxMode) {
          const mode = detail.preferences.battle.fxMode;
          if (mode === "high" || mode === "low") {
            setBattleFxModeState(mode);
          }
        }
      } catch (e) {
      }
    };
    window.addEventListener("settings-sync", handleSettingsSync);
    return () => {
      window.removeEventListener("settings-sync", handleSettingsSync);
    };
  }, [isAuthenticated, user?.id]);
  const setBattleFxMode = reactExports.useCallback(async (mode) => {
    try {
      setBattleFxModeState(mode);
      localStorage.setItem(STORAGE_KEY$1, mode);
    } catch (e) {
    }
  }, []);
  return {
    battleFxMode,
    setBattleFxMode,
    isBattleFxEnabled: true,
    // Always enabled, just different quality levels
    isLoading
  };
}

const MissionSettings = () => {
  useWouterNavigation();
  const { user } = useAuth();
  const { profileImage } = useProfileImage();
  const { battleFxMode, setBattleFxMode, isLoading } = usePerformanceSettings();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage: profileImage || user?.user_metadata?.avatar_url }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        exit: { opacity: 0, y: -20 },
        transition: { duration: 0.3 },
        className: "px-4 space-y-6",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white font-orbitron", children: "Missione" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci le tue missioni e obiettivi" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-xl bg-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "h-6 w-6 text-[#00D1FF]" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-white font-orbitron", children: "Missione Corrente" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70", children: "Gennaio 2025" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-green-500/20 text-green-400 border-green-500/30", children: "Attiva" })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 bg-black/20 rounded-lg border border-white/10", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center mb-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/70", children: "Progresso Generale" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold text-[#00D1FF]", children: "45%" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-white/10 rounded-full h-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gradient-to-r from-[#00D1FF] to-[#00B8E6] h-3 rounded-full transition-all duration-500", style: { width: "45%" } }) })
            ] }) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-6 text-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-xl bg-[#00D1FF]/20 w-fit mx-auto mb-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingUp, { className: "h-8 w-8 text-[#00D1FF]" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-white mb-1", children: "7" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70", children: "Completate" })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-6 text-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-xl bg-yellow-500/20 w-fit mx-auto mb-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "h-8 w-8 text-yellow-400" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-white mb-1", children: "3" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70", children: "Premi" })
            ] }) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl font-bold text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "h-5 w-5 mr-2 text-[#00D1FF]" }),
              "Battle FX Settings"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm font-medium text-white/90", children: "Performance Mode" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60 mb-2", children: "Regola la qualit degli effetti visivi Battle per ottimizzare le prestazioni" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Select,
                {
                  value: battleFxMode,
                  onValueChange: (value) => setBattleFxMode(value),
                  disabled: isLoading,
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { className: "w-full bg-black/20 border-white/20 text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona modalit" }) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "high", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Alta Qualit" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-muted-foreground", children: "Effetti completi e ricchi" })
                      ] }) }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "low", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Performance" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-muted-foreground", children: "Effetti semplificati per device meno potenti" })
                      ] }) })
                    ] })
                  ]
                }
              )
            ] }) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl font-bold text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "h-5 w-5 mr-2 text-[#00D1FF]" }),
              "Azioni Rapide"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Button,
                {
                  variant: "outline",
                  className: "w-full justify-start bg-black/20 border-white/20 text-white hover:bg-white/10",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "h-4 w-4 mr-2" }),
                    "Visualizza Mappa Missione"
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Button,
                {
                  variant: "outline",
                  className: "w-full justify-start bg-black/20 border-white/20 text-white hover:bg-white/10",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "h-4 w-4 mr-2" }),
                    "Cronometro Missione"
                  ]
                }
              )
            ] })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

async function loadKeyAndConverter() {
  const mod = await __vitePreload(() => import('./vapid-loader.Dvqe_4zt.js'),true?[]:void 0);
  return {
    loadPublicKey: mod.loadVAPIDPublicKey,
    toUint8: mod.urlBase64ToUint8Array
  };
}
function looksLikeWebPushEndpoint(url) {
  try {
    const u = new URL(url);
    return u.protocol.startsWith("http") && (u.hostname.includes("fcm") || u.pathname.toLowerCase().includes("push") || u.pathname.toLowerCase().includes("send"));
  } catch {
    return false;
  }
}
function getNotificationStatus() {
  const supported = "serviceWorker" in navigator && "PushManager" in window && "Notification" in window;
  const permission = "Notification" in window ? Notification.permission : null;
  return { supported, permission };
}
function isPushSupported() {
  return getNotificationStatus().supported;
}
async function hasActiveSubscription() {
  if (!isPushSupported()) return false;
  const reg = await navigator.serviceWorker.ready;
  const sub = await reg.pushManager.getSubscription();
  return !!sub;
}
async function subscribeWebPushAndSave(reg) {
  const { loadPublicKey, toUint8 } = await loadKeyAndConverter();
  const publicKey = await loadPublicKey();
  const keyBytes = typeof publicKey === "string" ? toUint8(publicKey) : publicKey;
  const applicationServerKey = keyBytes;
  if (!reg?.pushManager) throw new Error("PushManager non disponibile");
  let sub = await reg.pushManager.getSubscription();
  if (!sub) {
    sub = await reg.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey
    });
  }
  const raw = sub.toJSON();
  if (!raw?.endpoint || !raw?.keys?.p256dh || !raw?.keys?.auth) {
    throw new Error("Subscription incompleta");
  }
  return {
    endpoint: raw.endpoint,
    keys: { p256dh: raw.keys.p256dh, auth: raw.keys.auth },
    vapidKey: typeof publicKey === "string" ? publicKey : void 0
  };
}
async function enableWebPush() {
  if (!isPushSupported()) throw new Error("Push non supportato su questo browser");
  const reg = await navigator.serviceWorker.ready;
  return subscribeWebPushAndSave(reg);
}
async function disableWebPush() {
  if (!isPushSupported()) return true;
  const reg = await navigator.serviceWorker.ready;
  const sub = await reg.pushManager.getSubscription();
  if (sub) await sub.unsubscribe();
  return true;
}
async function getCurrent() {
  if (!isPushSupported()) return null;
  const reg = await navigator.serviceWorker.ready;
  return reg.pushManager.getSubscription();
}
async function getStatus() {
  const { supported, permission } = getNotificationStatus();
  const sub = await getCurrent();
  return { supported, permission: permission ?? "default", enabled: !!sub, endpoint: sub?.endpoint };
}
async function enable() {
  await enableWebPush();
}
async function disable() {
  await disableWebPush();
}
async function subscribe(_userId) {
  const reg = await navigator.serviceWorker.ready;
  await subscribeWebPushAndSave(reg);
  const cur = await reg.pushManager.getSubscription();
  if (!cur) throw new Error("Subscription failed");
  return cur;
}
async function unsubscribe() {
  return disableWebPush();
}
function isSupported() {
  return isPushSupported();
}
const webPushManager = {
  isPushSupported,
  hasActiveSubscription,
  enableWebPush,
  disableWebPush,
  getNotificationStatus,
  looksLikeWebPushEndpoint,
  subscribeWebPushAndSave,
  // alias compat:
  getCurrent,
  getStatus,
  enable,
  disable,
  subscribe,
  unsubscribe,
  isSupported
};

function useUnifiedPush() {
  const [state, setState] = reactExports.useState({
    enabled: false,
    loading: false,
    error: null,
    permission: typeof Notification !== "undefined" ? Notification.permission : "default",
    subscriptionEndpoint: null
  });
  reactExports.useEffect(() => {
    let mounted = true;
    (async () => {
      try {
        await navigator.serviceWorker?.ready.catch(() => null);
        const status = await webPushManager.getStatus();
        if (!mounted) return;
        if (false) ;
        setState((s) => ({
          ...s,
          enabled: !!status.enabled,
          permission: status.permission ?? s.permission,
          subscriptionEndpoint: status.endpoint ?? null,
          error: null
        }));
      } catch (err) {
        if (!mounted) return;
        setState((s) => ({ ...s, error: err?.message ?? "Push status read failed" }));
      }
    })();
    return () => {
      mounted = false;
    };
  }, []);
  const enable = reactExports.useCallback(async () => {
    setState((s) => ({ ...s, loading: true, error: null }));
    try {
      await webPushManager.enable();
      const status = await webPushManager.getStatus();
      setState((s) => ({
        ...s,
        loading: false,
        enabled: !!status.enabled,
        permission: status.permission ?? s.permission,
        subscriptionEndpoint: status.endpoint ?? null
      }));
      return true;
    } catch (err) {
      setState((s) => ({ ...s, loading: false, error: err?.message ?? "Enable push failed" }));
      return false;
    }
  }, []);
  const disable = reactExports.useCallback(async () => {
    setState((s) => ({ ...s, loading: true, error: null }));
    try {
      await webPushManager.disable();
      const status = await webPushManager.getStatus();
      setState((s) => ({
        ...s,
        loading: false,
        enabled: !!status.enabled,
        permission: status.permission ?? s.permission,
        subscriptionEndpoint: status.endpoint ?? null
      }));
      return true;
    } catch (err) {
      setState((s) => ({ ...s, loading: false, error: err?.message ?? "Disable push failed" }));
      return false;
    }
  }, []);
  const refresh = reactExports.useCallback(async () => {
    try {
      const status = await webPushManager.getStatus();
      setState((s) => ({
        ...s,
        enabled: !!status.enabled,
        permission: status.permission ?? s.permission,
        subscriptionEndpoint: status.endpoint ?? null
      }));
    } catch (err) {
      setState((s) => ({ ...s, error: err?.message ?? "Refresh push status failed" }));
    }
  }, []);
  return {
    ...state,
    enable,
    disable,
    refresh,
    // compat richiesti dai componenti legacy:
    isSupported: webPushManager.isSupported(),
    subscription: null,
    webPushSubscription: state.subscriptionEndpoint,
    subscriptionType: "webpush",
    isLoading: state.loading,
    isSubscribed: !!state.enabled,
    canSubscribe: !state.enabled && !state.loading,
    subscribe: enable,
    async requestPermission() {
      const perm = await Notification.requestPermission();
      setState((s) => ({ ...s, permission: perm }));
      return perm === "granted";
    },
    unsubscribe: disable
  };
}

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive: "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"
      }
    },
    defaultVariants: {
      variant: "default"
    }
  }
);
const Alert = reactExports.forwardRef(({ className, variant, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    ref,
    role: "alert",
    className: cn(alertVariants({ variant }), className),
    ...props
  }
));
Alert.displayName = "Alert";
const AlertTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "h5",
  {
    ref,
    className: cn("mb-1 font-medium leading-none tracking-tight", className),
    ...props
  }
));
AlertTitle.displayName = "AlertTitle";
const AlertDescription = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    ref,
    className: cn("text-sm [&_p]:leading-relaxed", className),
    ...props
  }
));
AlertDescription.displayName = "AlertDescription";

async function ensureServiceWorkerReady() {
  if (!("serviceWorker" in navigator)) {
    throw new Error("Service Worker non supportato");
  }
  const regs = await navigator.serviceWorker.getRegistrations();
  const hasMain = regs.some((r) => r.active?.scriptURL.includes("/sw.js"));
  if (!hasMain) {
    await navigator.serviceWorker.register("/sw.js", { scope: "/" });
  }
  return navigator.serviceWorker.ready;
}
async function ensurePermissionGranted() {
  if (!("Notification" in window)) {
    throw new Error("Notification API non supportata");
  }
  if (Notification.permission === "denied") {
    return false;
  }
  if (Notification.permission === "default") {
    const perm = await Notification.requestPermission();
    return perm === "granted";
  }
  return true;
}
async function ensurePushSubscription(reg) {
  const current = await reg.pushManager.getSubscription();
  if (current) {
    return current;
  }
  const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await __vitePreload(async () => { const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await import('./vapid-loader.Dvqe_4zt.js');return { loadVAPIDPublicKey, urlBase64ToUint8Array }},true?[]:void 0);
  const vapidKey = await loadVAPIDPublicKey();
  const applicationServerKey = typeof vapidKey === "string" ? urlBase64ToUint8Array(vapidKey) : vapidKey;
  const sub = await reg.pushManager.subscribe({
    userVisibleOnly: true,
    applicationServerKey
  });
  return sub;
}
async function upsertBackend(sub) {
  const { data: { session } } = await supabase.auth.getSession();
  if (!session?.access_token) {
    throw new Error("Sessione scaduta: effettua il login");
  }
  const json = sub.toJSON();
  const keys = json?.keys || {};
  if (!keys.p256dh || !keys.auth) {
    throw new Error("Chiavi subscription mancanti");
  }
  const { detectPlatformSafe } = await __vitePreload(async () => { const { detectPlatformSafe } = await import('./pushPlatform.BoRsb-VW.js');return { detectPlatformSafe }},true?[]:void 0);
  const platform = detectPlatformSafe();
  const { error } = await supabase.functions.invoke("webpush-upsert", {
    body: {
      endpoint: sub.endpoint,
      keys: { p256dh: keys.p256dh, auth: keys.auth },
      provider: "webpush",
      platform,
      ua: navigator.userAgent
    }
  });
  if (error) {
    throw new Error(error.message || "Upsert fallito");
  }
}
async function subscribeFlow() {
  const t0 = performance.now();
  try {
    const reg = await ensureServiceWorkerReady();
    const hasPermission = await ensurePermissionGranted();
    if (!hasPermission) {
      return {
        ok: false,
        status: "permission_denied",
        message: "Permesso notifiche negato"
      };
    }
    const sub = await ensurePushSubscription(reg);
    await upsertBackend(sub);
    const elapsed = Math.round(performance.now() - t0);
    return {
      ok: true,
      status: "ready",
      endpoint: sub.endpoint,
      message: `Ready in ${elapsed}ms`
    };
  } catch (error) {
    const elapsed = Math.round(performance.now() - t0);
    return {
      ok: false,
      status: "error",
      error: error?.message || "Errore sconosciuto",
      message: `Failed after ${elapsed}ms`
    };
  }
}

async function runRepairFlow() {
  const t0 = performance.now();
  try {
    if ("serviceWorker" in navigator && "PushManager" in window) {
      try {
        const reg = await navigator.serviceWorker.ready;
        const existingSub = await reg.pushManager.getSubscription();
        if (existingSub) {
          await existingSub.unsubscribe();
        }
      } catch (cleanupError) {
      }
    }
    const result = await subscribeFlow();
    const elapsed = Math.round(performance.now() - t0);
    if (result.ok) {
      const reg = await navigator.serviceWorker.ready;
      const sub = await reg.pushManager.getSubscription();
      return {
        ok: true,
        subscription: sub,
        endpoint: result.endpoint,
        message: `Repair completed in ${elapsed}ms`
      };
    } else {
      return {
        ok: false,
        subscription: null,
        error: result.error || "Repair failed",
        message: `Failed after ${elapsed}ms`
      };
    }
  } catch (error) {
    const elapsed = Math.round(performance.now() - t0);
    return {
      ok: false,
      subscription: null,
      error: error?.message || "Unknown error",
      message: `Error after ${elapsed}ms`
    };
  }
}

async function backendHasActiveEndpoint(endpoint) {
  if (!endpoint) return false;
  try {
    const { count, error } = await supabase.from("webpush_subscriptions").select("endpoint", { head: true, count: "exact" }).eq("endpoint", endpoint).eq("is_active", true);
    if (error) {
      return false;
    }
    return (count ?? 0) > 0;
  } catch (e) {
    return false;
  }
}
const UnifiedPushToggle = ({ className }) => {
  const {
    isSupported,
    permission,
    subscription,
    subscriptionType,
    isLoading,
    error,
    isSubscribed,
    canSubscribe,
    requestPermission,
    unsubscribe,
    refresh
  } = useUnifiedPush();
  const [isRepairLoading, setIsRepairLoading] = reactExports.useState(false);
  const getPlatformLabel = () => {
    return "Desktop";
  };
  const getSubscriptionTypeLabel = () => {
    return subscriptionType?.toUpperCase() || "Unknown";
  };
  const getStatusColor = () => {
    if (isSubscribed) return "text-success";
    if (permission === "denied") return "text-destructive";
    return "text-muted-foreground";
  };
  const getStatusText = () => {
    if (isLoading) return "Configurazione in corso...";
    if (isSubscribed) return `Attivo (${getSubscriptionTypeLabel()})`;
    if (permission === "denied") return "Permessi negati";
    if (permission === "default") return "Permessi richiesti";
    return "Non attivo";
  };
  const handleToggle = async () => {
    setIsRepairLoading(true);
    try {
      const reg = await navigator.serviceWorker?.ready.catch(() => null);
      const sub = reg ? await reg.pushManager.getSubscription() : null;
      if (false) ;
      if (isSubscribed) {
        const known = sub ? await backendHasActiveEndpoint(sub.endpoint) : false;
        if (false) ;
        if (!known) {
          const result2 = await runRepairFlow();
          if (result2.ok && result2.subscription) {
            ue.success("Notifiche riparate e riattivate ");
            await refresh();
          } else {
            ue.error("Impossibile riparare la subscription");
          }
          return;
        }
        await unsubscribe();
        await refresh();
        ue.success("Notifiche disattivate");
        return;
      }
      if (false) ;
      await navigator.serviceWorker.ready;
      const result = await runRepairFlow();
      if (result.ok && result.subscription) {
        ue.success("Notifiche attivate ");
        await refresh();
      } else {
        ue.error("Impossibile completare l'attivazione (riprovare)");
      }
    } catch (error2) {
      ue.error("Errore durante l'operazione");
    } finally {
      setIsRepairLoading(false);
    }
  };
  if (!isSupported) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(BellOff, { className: "w-5 h-5" }),
        "Notifiche Push"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Le notifiche push non sono supportate su questo dispositivo." })
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className, "data-push-toggle-v1": true, "data-push-toggle-repair": "1", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5" }),
        "Notifiche Push Unificate"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Sistema unificato per notifiche su tutti i dispositivi" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-2 h-2 rounded-full ${isSubscribed ? "bg-success" : "bg-muted-foreground"}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: getStatusColor(), children: getStatusText() })
        ] }),
        subscription
      ] }),
      isSubscribed && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 bg-muted/50 rounded-lg space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-success" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Connesso" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            "Tipo: ",
            getSubscriptionTypeLabel()
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            "Piattaforma: ",
            getPlatformLabel()
          ] }),
          subscription
        ] })
      ] }),
      error && /* @__PURE__ */ jsxRuntimeExports.jsxs(Alert, { variant: "destructive", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "h-4 w-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDescription, { children: error })
      ] }),
      permission === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsxs(Alert, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "h-4 w-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDescription, { children: "Per attivare le notifiche, vai nelle impostazioni del browser e consenti le notifiche per questo sito." })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "font-medium", children: [
            isSubscribed ? "Disattiva" : "Attiva",
            " Notifiche"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: isSubscribed ? "Riceverai notifiche push su questo dispositivo" : "Attiva per ricevere notifiche push" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Switch,
          {
            checked: isSubscribed,
            onCheckedChange: handleToggle,
            disabled: isLoading || isRepairLoading || !canSubscribe && !isSubscribed
          }
        )
      ] }),
      !isSubscribed && permission !== "granted" && /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: requestPermission,
          disabled: isLoading,
          className: "w-full",
          variant: "outline",
          children: isLoading ? "Configurazione..." : "Richiedi Permessi"
        }
      ),
      isSubscribed && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-success text-sm font-medium", children: " Notifiche push attive e funzionanti!" }) })
    ] })
  ] });
};

function getProjectRef() {
  return getProjectRef$1();
}
function functionsBaseUrl(fn) {
  return `${getFunctionsUrl()}/${fn}`;
}

const CATEGORY_TAGS = {
  "Luxury & moda": ["luxury", "fashion", "watch", "luxurycar"],
  "Viaggi & esperienze": ["travel", "experience"],
  "Sport & fitness": ["sport", "fitness"],
  "Tecnologia": ["tech", "innovation"],
  "Food & beverage": ["food", "beverage"],
  "Arte & cultura": ["art", "culture"]
};
const AVAILABLE_CATEGORIES = Object.keys(CATEGORY_TAGS);
function getTagsForCategories(categories) {
  const allTags = /* @__PURE__ */ new Set();
  categories.forEach((category) => {
    if (CATEGORY_TAGS[category]) {
      CATEGORY_TAGS[category].forEach((tag) => allTags.add(tag));
    }
  });
  return Array.from(allTags);
}

let _cachedTags = null;
let _cacheExpiry = 0;
const CACHE_DURATION_MS = 5 * 60 * 1e3;
async function getUserPreferences() {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      return [];
    }
    const { data, error } = await supabase.from("notification_preferences").select("*").eq("user_id", user.id).eq("enabled", true);
    if (error) {
      return [];
    }
    return data || [];
  } catch (error) {
    return [];
  }
}
async function resolveTagsForCurrentUser() {
  const now = Date.now();
  if (_cachedTags && now < _cacheExpiry) {
    return _cachedTags;
  }
  try {
    const preferences = await getUserPreferences();
    const enabledCategories = preferences.map((pref) => pref.category);
    const resolvedTags = getTagsForCategories(enabledCategories);
    _cachedTags = resolvedTags;
    _cacheExpiry = now + CACHE_DURATION_MS;
    return resolvedTags;
  } catch (error) {
    return [];
  }
}
function invalidateTagsCache() {
  _cachedTags = null;
  _cacheExpiry = 0;
}
async function updateCategoryPreference(category, enabled) {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      return false;
    }
    const { error } = await supabase.from("notification_preferences").upsert({
      user_id: user.id,
      category,
      enabled,
      updated_at: (/* @__PURE__ */ new Date()).toISOString()
    }, {
      onConflict: "user_id,category"
    });
    if (error) {
      return false;
    }
    invalidateTagsCache();
    return true;
  } catch (error) {
    return false;
  }
}
async function getCurrentPreferencesState() {
  try {
    const preferences = await getUserPreferences();
    const state = {};
    Object.keys(CATEGORY_TAGS).forEach((category) => {
      state[category] = false;
    });
    preferences.forEach((pref) => {
      if (pref.enabled) {
        state[pref.category] = true;
      }
    });
    return state;
  } catch (error) {
    return {};
  }
}

function useNotificationPreferences() {
  const [preferences, setPreferences] = reactExports.useState({});
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [resolvedTags, setResolvedTags] = reactExports.useState([]);
  const loadPreferences = reactExports.useCallback(async () => {
    setIsLoading(true);
    try {
      const [prefs, tags] = await Promise.all([
        getCurrentPreferencesState(),
        resolveTagsForCurrentUser()
      ]);
      setPreferences(prefs);
      setResolvedTags(tags);
    } catch (error) {
    } finally {
      setIsLoading(false);
    }
  }, []);
  const updatePreference = reactExports.useCallback(async (category, enabled) => {
    try {
      const success = await updateCategoryPreference(category, enabled);
      if (success) {
        setPreferences((prev) => ({
          ...prev,
          [category]: enabled
        }));
        const newTags = await resolveTagsForCurrentUser();
        setResolvedTags(newTags);
      }
      return success;
    } catch (error) {
      return false;
    }
  }, []);
  const togglePreference = reactExports.useCallback(async (category) => {
    const currentValue = preferences[category] || false;
    return updatePreference(category, !currentValue);
  }, [preferences, updatePreference]);
  const refreshPreferences = reactExports.useCallback(async () => {
    invalidateTagsCache();
    await loadPreferences();
  }, [loadPreferences]);
  const getActiveCategories = reactExports.useCallback(() => {
    return Object.entries(preferences).filter(([_, enabled]) => enabled).map(([category, _]) => category);
  }, [preferences]);
  reactExports.useEffect(() => {
    loadPreferences();
  }, [loadPreferences]);
  return {
    preferences,
    resolvedTags,
    isLoading,
    availableCategories: AVAILABLE_CATEGORIES,
    updatePreference,
    togglePreference,
    refreshPreferences,
    getActiveCategories,
    hasActivePreferences: resolvedTags.length > 0
  };
}

function getProviderFromEndpoint(endpoint) {
  if (endpoint.includes("webpush.push.apple.com") || endpoint.includes("api.push.apple.com")) {
    return "Apple";
  }
  if (endpoint.includes("fcm.googleapis.com")) {
    return "FCM";
  }
  return "Altro";
}
function NotificationsStatus({ userId }) {
  const [enabled, setEnabled] = reactExports.useState(false);
  const [loading, setLoading] = reactExports.useState(true);
  const [providerLabel, setProviderLabel] = reactExports.useState("");
  reactExports.useEffect(() => {
    let mounted = true;
    (async () => {
      setLoading(true);
      const { data, error } = await supabase.from("push_tokens").select("token").eq("user_id", userId).eq("is_active", true).limit(1).maybeSingle();
      if (!mounted) return;
      if (error) {
        setEnabled(false);
        setProviderLabel("");
      } else {
        const isConnected = !!data;
        setEnabled(isConnected);
        setProviderLabel(isConnected ? getProviderFromEndpoint(data.token) : "");
      }
      setLoading(false);
    })();
    return () => {
      mounted = false;
    };
  }, [userId]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 border border-border rounded-lg bg-card", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-sm font-medium mb-3", children: "Stato Notifiche Push" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("label", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "input",
          {
            type: "checkbox",
            checked: enabled,
            readOnly: true,
            className: "h-4 w-4",
            style: { pointerEvents: "none" }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Notifiche Push su questo dispositivo" })
      ] }),
      !loading && enabled && providerLabel && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "px-2 py-1 text-xs bg-primary/10 text-primary rounded-md", children: providerLabel })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 text-xs text-muted-foreground", children: [
      loading && "Verifico stato",
      !loading && enabled && "Connesso ",
      !loading && !enabled && "Non connesso "
    ] })
  ] });
}

function detectProvider(endpoint) {
  if (!endpoint) return null;
  const e = endpoint.toLowerCase();
  if (e.startsWith("https://webpush.push.apple.com") || e.startsWith("https://api.push.apple.com")) return "APPLE";
  if (e.startsWith("https://fcm.googleapis.com")) return "FCM";
  return "ALTRO";
}
function PushInspector({ userId }) {
  const [info, setInfo] = reactExports.useState({ swReady: false, permission: Notification?.permission, notes: [] });
  const [loading, setLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    let mounted = true;
    (async () => {
      const notes = [];
      try {
        const reg = await navigator.serviceWorker?.ready;
        const scope = reg?.scope ?? null;
        const sub = await reg?.pushManager?.getSubscription();
        const swEndpoint = sub?.endpoint ?? null;
        const swProvider = detectProvider(swEndpoint);
        const { data: v, error } = await supabase.from("push_tokens").select("id, token, is_active, created_at").eq("user_id", userId).order("created_at", { ascending: false }).limit(1).maybeSingle();
        if (error) notes.push(`DB error: ${error.message}`);
        const dbEndpoint = v?.token ?? null;
        const dbProvider = detectProvider(dbEndpoint);
        const dbIsActive = v?.is_active ?? null;
        const match = !!swEndpoint && !!dbEndpoint && swEndpoint === dbEndpoint;
        const permission = Notification?.permission;
        const ua = navigator.userAgent;
        if (!swEndpoint) notes.push("SW subscription non trovata su questo device (getSubscription() = null).");
        if (!dbEndpoint) notes.push("Nessuna subscription Apple/FCM registrata in DB per l'utente.");
        if (swEndpoint && dbEndpoint && !match) notes.push("ATTENZIONE: endpoint SW  endpoint DB (device non allineato al record pi recente).");
        if (mounted) {
          setInfo({
            swReady: !!reg,
            swEndpoint,
            swProvider,
            dbEndpoint,
            dbProvider,
            dbIsActive,
            match,
            permission,
            ua,
            scope,
            notes
          });
        }
      } catch (e) {
        if (mounted) setInfo((old) => ({ ...old, notes: [...old.notes ?? [], `Runtime error: ${e?.message ?? e}`] }));
      } finally {
        if (mounted) setLoading(false);
      }
    })();
    return () => {
      mounted = false;
    };
  }, [userId]);
  const Badge = ({ label }) => /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "px-2 py-0.5 rounded-full text-xs bg-slate-700/60", children: label ?? "" });
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 rounded-xl border border-slate-700/40 bg-slate-800/40 p-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold mb-3", children: "Audit flusso Push (read-only)" }),
    loading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm opacity-80", children: " Raccolta dati" }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3 text-sm", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "Permesso iOS/Browser" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.permission })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "SW Endpoint (device)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 break-all", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-1", children: info.swEndpoint ?? "" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "opacity-70", children: "Provider" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.swProvider ?? "" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "opacity-70 mt-1", children: [
            "Scope: ",
            info.scope ?? ""
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "DB Endpoint (latest)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 break-all", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-1", children: info.dbEndpoint ?? "" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "opacity-70", children: "Provider" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.dbProvider ?? "" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "opacity-70", children: "is_active" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.dbIsActive === true ? "TRUE" : info.dbIsActive === false ? "FALSE" : "" })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "Match DB  Device" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.match ? "MATCH" : "NO MATCH" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "User-Agent" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 break-all", children: info.ua })
      ] }),
      !!info.notes?.length && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 p-2 rounded bg-amber-500/10 border border-amber-400/20", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-medium mb-1", children: "Note" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc pl-5 space-y-1", children: info.notes.map((n, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: n }, i)) })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs opacity-60 mt-3", children: "Component read-only. Nessuna modifica alla catena push." })
  ] });
}

const NotificationsSettings = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  const [loading, setLoading] = reactExports.useState(false);
  const {
    preferences,
    resolvedTags,
    isLoading: prefsLoading,
    availableCategories,
    togglePreference,
    refreshPreferences,
    hasActivePreferences
  } = useNotificationPreferences();
  const [settings, setSettings] = reactExports.useState({
    notifications_enabled: true,
    weekly_hints: "all",
    push_notifications_enabled: false
  });
  const categoryIcons = {
    "Luxury & moda": "",
    "Viaggi & esperienze": "",
    "Sport & fitness": "",
    "Tecnologia": "",
    "Food & beverage": "",
    "Arte & cultura": ""
  };
  reactExports.useEffect(() => {
    loadNotificationSettings();
  }, [user]);
  const loadNotificationSettings = async () => {
    if (!user) return;
    try {
      const { data: profile, error } = await supabase.from("profiles").select("notifications_enabled, weekly_hints, push_notifications_enabled").eq("id", user.id).single();
      if (profile && !error) {
        setSettings({
          notifications_enabled: profile.notifications_enabled ?? true,
          weekly_hints: profile.weekly_hints || "all",
          push_notifications_enabled: profile.push_notifications_enabled ?? false
        });
      }
    } catch (error) {
    }
  };
  const saveSettings = async (newSettings) => {
    if (!user) return;
    setLoading(true);
    try {
      const updatedSettings = { ...settings, ...newSettings };
      await supabase.from("profiles").update({
        notifications_enabled: updatedSettings.notifications_enabled,
        weekly_hints: updatedSettings.weekly_hints,
        push_notifications_enabled: updatedSettings.push_notifications_enabled
      }).eq("id", user.id);
      setSettings(updatedSettings);
      toast({
        title: " Impostazioni salvate",
        description: "Le preferenze notifiche sono state aggiornate."
      });
    } catch (error) {
      toast({
        title: " Errore salvataggio",
        description: "Impossibile salvare le impostazioni. Riprova.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const handleNotificationsToggle = async (enabled) => {
    await saveSettings({ notifications_enabled: enabled });
  };
  const handleWeeklyHintsChange = async (value) => {
    await saveSettings({ weekly_hints: value });
  };
  const handleCategoryToggle = async (category) => {
    const success = await togglePreference(category);
    if (success) {
      toast({
        title: " Preferenza aggiornata",
        description: `Categoria "${category}" ${preferences[category] ? "disabilitata" : "abilitata"}.`
      });
    } else {
      toast({
        title: " Errore",
        description: "Impossibile aggiornare la preferenza. Riprova.",
        variant: "destructive"
      });
    }
  };
  const handleRefreshPreferences = async () => {
    await refreshPreferences();
    toast({
      title: " Preferenze aggiornate",
      description: "Cache delle preferenze aggiornata dal database."
    });
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      className: "max-w-4xl mx-auto p-6 space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold text-white mb-2", children: "Impostazioni Notifiche" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci le tue preferenze di notifica e comunicazione" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-gray-900 to-gray-800 border-gray-700", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5 mr-2" }),
            "Notifiche Email"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Notifiche Generali" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Ricevi aggiornamenti importanti via email" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: settings.notifications_enabled,
                  onCheckedChange: handleNotificationsToggle,
                  disabled: loading
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Suggerimenti Settimanali" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Select,
                {
                  value: settings.weekly_hints,
                  onValueChange: handleWeeklyHintsChange,
                  disabled: loading,
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { className: "bg-gray-800 border-gray-600 text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, {}) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { className: "bg-gray-800 border-gray-600", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "all", className: "text-white", children: "Tutti i suggerimenti" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "only-premium", className: "text-white", children: "Solo suggerimenti premium" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "none", className: "text-white", children: "Nessun suggerimento" })
                    ] })
                  ]
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Categorie di Interesse per Feed" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Button,
                  {
                    variant: "outline",
                    size: "sm",
                    onClick: handleRefreshPreferences,
                    disabled: prefsLoading,
                    className: "flex items-center gap-2",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: `w-4 h-4 ${prefsLoading ? "animate-spin" : ""}` }),
                      "Aggiorna"
                    ]
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Seleziona le categorie per ricevere notifiche sui contenuti che ti interessano di pi" }),
              hasActivePreferences && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-green-400 mb-2", children: [
                " ",
                resolvedTags.length,
                " tag attivi: ",
                resolvedTags.join(", ")
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 gap-3", children: availableCategories.map((category) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-3 rounded-lg bg-gray-800/50 border border-gray-700", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Label$1,
                  {
                    htmlFor: category,
                    className: "text-white flex items-center cursor-pointer flex-1",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "mr-3 text-lg", children: categoryIcons[category] || "" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-medium", children: category }),
                        preferences[category] && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-green-400 mt-1", children: "Attiva" })
                      ] })
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    id: category,
                    checked: preferences[category] || false,
                    onCheckedChange: () => handleCategoryToggle(category),
                    disabled: prefsLoading || loading
                  }
                )
              ] }, category)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t border-white/10 pt-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedPushToggle, { className: "w-full", "data-push-toggle-v1": true }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(NotificationsStatus, { userId: "495246c1-9154-4f01-a428-7f37fe230180" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(PushInspector, { userId: "495246c1-9154-4f01-a428-7f37fe230180" })
            ] }),
            false
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-gray-900 to-gray-800 border-gray-700", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Volume2, { className: "w-5 h-5 mr-2" }),
            "Preferenze Audio"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Suoni di Notifica" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Riproduci suoni per le notifiche importanti" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: true,
                  disabled: loading
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Feedback Aptico" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Vibrazioni per dispositivi mobile" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: true,
                  disabled: loading
                }
              )
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gradient-to-br from-blue-900/20 to-purple-900/20 border-blue-700/50", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "pt-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5 text-blue-400 mt-0.5" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Privacy e Controllo" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Tutte le notifiche possono essere disabilitate in qualsiasi momento. I tuoi dati di preferenza sono crittografati e non vengono condivisi con terze parti." })
          ] })
        ] }) }) })
      ]
    }
  );
};

const PrivacySettings = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  useWouterNavigation();
  const { profileImage } = useProfileImage();
  const [loading, setLoading] = reactExports.useState(false);
  const [settings, setSettings] = reactExports.useState({
    data_collection: true,
    analytics_enabled: true,
    marketing_consent: false,
    cookie_preferences: {
      essential: true,
      analytics: true,
      marketing: false
    }
  });
  reactExports.useEffect(() => {
    loadPrivacySettings();
  }, [user]);
  const loadPrivacySettings = async () => {
    if (!user) return;
    try {
      const storedSettings = localStorage.getItem(`privacy_settings_${user.id}`);
      if (storedSettings) {
        setSettings(JSON.parse(storedSettings));
      }
    } catch (error) {
    }
  };
  const saveSettings = async (newSettings) => {
    if (!user) return;
    setLoading(true);
    try {
      const updatedSettings = { ...settings, ...newSettings };
      localStorage.setItem(`privacy_settings_${user.id}`, JSON.stringify(updatedSettings));
      setSettings(updatedSettings);
      toast({
        title: " Impostazioni privacy salvate",
        description: "Le tue preferenze sulla privacy sono state aggiornate."
      });
    } catch (error) {
      toast({
        title: " Errore salvataggio",
        description: "Impossibile salvare le impostazioni. Riprova.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const handleDataCollectionToggle = async (enabled) => {
    await saveSettings({ data_collection: enabled });
  };
  const handleAnalyticsToggle = async (enabled) => {
    await saveSettings({ analytics_enabled: enabled });
  };
  const handleMarketingToggle = async (enabled) => {
    await saveSettings({ marketing_consent: enabled });
  };
  const handleCookiePreferenceChange = async (type, enabled) => {
    const newCookiePreferences = {
      ...settings.cookie_preferences,
      [type]: enabled
    };
    await saveSettings({ cookie_preferences: newCookiePreferences });
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage: profileImage || user?.user_metadata?.avatar_url }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        exit: { opacity: 0, y: -20 },
        transition: { duration: 0.3 },
        className: "px-4 space-y-6",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white font-orbitron", children: "Privacy" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci le tue preferenze sulla privacy" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-5 h-5 mr-2" }),
              "Raccolta Dati"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Consenso Raccolta Dati" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Autorizza M1SSION a raccogliere dati per migliorare l'esperienza utente." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.data_collection,
                    onCheckedChange: handleDataCollectionToggle,
                    disabled: loading
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Analytics" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Consenti l'analisi del comportamento per ottimizzare l'app." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.analytics_enabled,
                    onCheckedChange: handleAnalyticsToggle,
                    disabled: loading
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Marketing" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Ricevi comunicazioni promozionali e offerte personalizzate." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.marketing_consent,
                    onCheckedChange: handleMarketingToggle,
                    disabled: loading
                  }
                )
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-5 h-5 mr-2" }),
              "Preferenze Cookie"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Cookie Essenziali" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Necessari per il funzionamento base dell'applicazione." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.cookie_preferences.essential,
                    onCheckedChange: (enabled) => handleCookiePreferenceChange("essential", enabled),
                    disabled: true
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Cookie Analytics" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Utilizzati per analizzare l'uso dell'app e migliorare le prestazioni." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.cookie_preferences.analytics,
                    onCheckedChange: (enabled) => handleCookiePreferenceChange("analytics", enabled),
                    disabled: loading
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Cookie Marketing" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Per personalizzare annunci e contenuti promozionali." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.cookie_preferences.marketing,
                    onCheckedChange: (enabled) => handleCookiePreferenceChange("marketing", enabled),
                    disabled: loading
                  }
                )
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-5 h-5 mr-2" }),
              "Informazioni Privacy"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "I tuoi dati sono protetti secondo il Regolamento GDPR e vengono utilizzati esclusivamente per migliorare la tua esperienza con M1SSION." }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium", children: "Dati Raccolti:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-white/70 text-sm space-y-1 ml-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Informazioni del profilo utente" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Progressi di gioco e indizi completati" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Preferenze dell'applicazione" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Dati di utilizzo anonimi (se autorizzato)" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium", children: "I Tuoi Diritti:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-white/70 text-sm space-y-1 ml-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Accesso ai tuoi dati personali" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Correzione di informazioni inesatte" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Cancellazione del tuo account" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Portabilit dei dati" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  variant: "outline",
                  className: "w-full border-white/20 text-white hover:bg-white/10",
                  children: "Scarica i Miei Dati"
                }
              )
            ] })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

const LegalSettings = () => {
  const { user} = useAuth();
  const { toast } = useToast();
  useWouterNavigation();
  const { profileImage } = useProfileImage();
  const [loading, setLoading] = reactExports.useState(false);
  const legalLinks = [
    {
      title: "Termini di Servizio",
      description: "Condizioni d'uso dell'applicazione M1SSION",
      url: "/terms",
      icon: FileText
    },
    {
      title: "Privacy Policy",
      description: "Come raccogliamo e utilizziamo i tuoi dati",
      url: "/privacy-policy",
      icon: Shield
    },
    {
      title: "Cookie Policy",
      description: "Come utilizziamo i cookie e tecnologie simili",
      url: "/cookie-policy",
      icon: Settings
    },
    {
      title: "Gestisci preferenze cookie",
      description: "Modifica le tue preferenze sui cookie",
      url: "#consent",
      icon: Settings,
      action: () => window.__consent?.open()
    },
    {
      title: "Regolamento M1SSION",
      description: "Modalit di gioco, premi, meccaniche e diritti",
      url: "/game-rules",
      icon: FileText
    },
    {
      title: "Game Policies",
      description: "Disclaimers, virtual currencies, anti-gambling policy",
      url: "/policies",
      icon: Shield
    },
    {
      title: "SafeCreative",
      description: "Certificazione di propriet intellettuale",
      url: "/safecreative",
      icon: Copyright
    }
  ];
  const handleDeleteAccount = async () => {
    if (!user) return;
    setLoading(true);
    try {
      await supabase.from("user_clues").delete().eq("user_id", user.id);
      await supabase.from("user_buzz_counter").delete().eq("user_id", user.id);
      await supabase.from("user_notifications").delete().eq("user_id", user.id);
      await supabase.from("subscriptions").delete().eq("user_id", user.id);
      await supabase.from("profiles").delete().eq("id", user.id);
      await supabase.auth.signOut();
      localStorage.clear();
      toast({
        title: " Account eliminato",
        description: "Il tuo account e tutti i dati associati sono stati eliminati permanentemente."
      });
      window.location.href = "/login";
    } catch (error) {
      toast({
        title: " Errore eliminazione account",
        description: error.message || "Impossibile eliminare l'account. Contatta il supporto.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const openExternalLink = (url) => {
    if (url.startsWith("/")) {
      window.location.href = url;
    } else if (window.Capacitor) {
      window.Capacitor.Plugins.Browser?.open({ url });
    } else {
      window.open(url, "_blank", "noopener,noreferrer");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage: profileImage || user?.user_metadata?.avatar_url }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        exit: { opacity: 0, y: -20 },
        transition: { duration: 0.3 },
        className: "px-4 space-y-6",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white font-orbitron", children: "Legale" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Documenti legali e informazioni" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-5 h-5 mr-2" }),
              "Documenti Legali"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: legalLinks.map((link, index) => {
              const IconComponent = link.icon;
              return /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "div",
                {
                  className: "flex items-center justify-between p-4 bg-black/20 rounded-lg border border-white/10",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(IconComponent, { className: "w-5 h-5 text-[#00D1FF]" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: link.title }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: link.description })
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Button,
                      {
                        onClick: () => link.action ? link.action() : openExternalLink(link.url),
                        size: "sm",
                        variant: "outline",
                        className: "border-white/20 text-white hover:bg-white/10",
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(ExternalLink, { className: "w-4 h-4" })
                      }
                    )
                  ]
                },
                index
              );
            }) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-white font-orbitron", children: "Informazioni App" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Versione" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-medium", children: "2.1.0" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Build" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-medium", children: "2025.12.05" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Sviluppatore" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-medium", children: "NIYVORA KFT" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Copyright" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-medium", children: "M1SSION 2025" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 p-3 bg-[#00D1FF]/10 rounded-lg border border-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF] text-sm font-medium", children: "M1SSION  un'app ufficiale creata e sviluppata da NIYVORA KFT." }) })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "pt-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Hai domande o hai bisogno di assistenza?" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => openExternalLink("mailto:contact@m1ssion.com"),
                variant: "outline",
                className: "border-[#00D1FF]/50 text-[#00D1FF] hover:bg-[#00D1FF]/10",
                children: "Contatta il Supporto"
              }
            )
          ] }) }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-red-500/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center text-red-400", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-5 h-5 mr-2" }),
              "Zona Pericolosa"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: " L'eliminazione dell'account  permanente e irreversibile. Tutti i tuoi dati, progressi, abbonamenti e acquisti verranno eliminati definitivamente." }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-red-400 font-semibold mb-2", children: "Verranno eliminati:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-red-300 text-sm space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Profilo agente e statistiche" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Indizi completati e cronologia" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Metodi di pagamento e abbonamenti" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: " Tutte le preferenze e impostazioni" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialog, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTrigger, { asChild: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "destructive",
                    className: "w-full bg-red-600 hover:bg-red-700",
                    disabled: loading,
                    children: "Elimina Account Permanentemente"
                  }
                ) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogContent, { className: "bg-black/90 border-red-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogHeader, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTitle, { className: "text-white", children: " Conferma Eliminazione Account" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogDescription, { className: "text-white/70", children: [
                      "Questa azione  ",
                      /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "IRREVERSIBILE" }),
                      ". Il tuo account M1SSION e tutti i dati associati verranno eliminati permanentemente.",
                      /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
                      "Non potrai recuperare progressi, abbonamenti o acquisti dopo la conferma."
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogFooter, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogCancel, { className: "bg-white/10 text-white border-white/20", children: "Annulla" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      AlertDialogAction,
                      {
                        onClick: handleDeleteAccount,
                        className: "bg-red-600 hover:bg-red-700",
                        children: "Elimina Definitivamente"
                      }
                    )
                  ] })
                ] })
              ] })
            ] }) })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

function useSafeNavigate() {
  try {
    const [, setLocation] = useLocation();
    return (path) => {
      try {
        setLocation(path);
      } catch {
        window.location.href = path;
      }
    };
  } catch {
    return (path) => {
      window.location.href = path;
    };
  }
}

const STAKE_TYPES = [
  { value: "m1u", label: "M1 Units (M1U)", icon: "", description: "Stake your M1U balance" },
  { value: "pulse_energy", label: "Pulse Energy (PE)", icon: "", description: "Stake your Pulse Energy" }
];
const STAKE_PERCENTS = [25, 50, 75];

function SafeSelect({ value, onChange, disabled, className = "" }) {
  const handleChange = (e) => {
    const selectedValue = e.target.value;
    if (STAKE_TYPES.some((t) => t.value === selectedValue)) {
      onChange(selectedValue);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "select",
    {
      "aria-label": "Stake Type",
      value,
      onChange: handleChange,
      disabled,
      className: `w-full rounded-lg bg-gray-700 border border-cyan-500/30 text-white px-3 py-2.5 
        focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500/50
        disabled:opacity-50 disabled:cursor-not-allowed
        hover:border-cyan-500/50 transition-colors
        cursor-pointer ${className}`,
      style: {
        backgroundImage: `url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,
        backgroundPosition: "right 0.5rem center",
        backgroundRepeat: "no-repeat",
        backgroundSize: "1.5em 1.5em",
        paddingRight: "2.5rem"
      },
      children: STAKE_TYPES.map((type) => /* @__PURE__ */ jsxRuntimeExports.jsxs("option", { value: type.value, children: [
        type.icon,
        " ",
        type.label
      ] }, type.value))
    }
  );
}

async function createBattle(payload) {
  const { data: sessionData } = await supabase.auth.getSession();
  const token = sessionData?.session?.access_token;
  if (!token) {
    throw new Error("Authentication required - please sign in");
  }
  const headers = {
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token}`
  };
  const { data, error } = await supabase.functions.invoke("battle-create", {
    body: payload,
    headers
  });
  if (error) {
    const errorData = error.context?.body;
    const status = error.status || error.context?.status || "n/a";
    const code = errorData?.code || error.code || error.name || "EDGE_ERROR";
    const hint = errorData?.hint || errorData?.error || error.message || "Edge function returned non-2xx status";
    throw new Error(`${code} [${status}]: ${hint}`);
  }
  if (!data) {
    throw new Error("EMPTY_RESPONSE [500]: No data returned from edge function");
  }
  if (!data.success) {
    const errorCode = data.code || "BATTLE_FAILED";
    const errorHint = data.error || data.hint || "Battle creation failed";
    throw new Error(`${errorCode}: ${errorHint}`);
  }
  return data;
}
async function acceptBattle(battleId) {
  const { data: sessionData } = await supabase.auth.getSession();
  const token = sessionData?.session?.access_token;
  if (!token) {
    throw new Error("Authentication required - please sign in");
  }
  const headers = {
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token}`
  };
  const { data, error } = await supabase.functions.invoke("battle-accept", {
    body: { battle_id: battleId },
    headers
  });
  if (error) {
    const errorData = error.context?.body;
    const status = error.status || "n/a";
    const code = errorData?.code || error.code || error.name || "EDGE_ERROR";
    const hint = errorData?.hint || errorData?.error || error.message || "Unknown error";
    throw new Error(`${code} [${status}]: ${hint}`);
  }
  if (!data?.success) {
    const errorCode = data.code || "ACCEPT_FAILED";
    const errorHint = data.error || data.hint || "Battle accept failed";
    throw new Error(`${errorCode}: ${errorHint}`);
  }
}
async function getRandomOpponent() {
  const { data: sessionData } = await supabase.auth.getSession();
  const token = sessionData?.session?.access_token;
  if (!token) {
    throw new Error("Authentication required - please sign in");
  }
  const headers = {
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token}`
  };
  const { data, error } = await supabase.functions.invoke("battle-random-opponent", {
    headers
  });
  if (error) {
    const errorData = error.context?.body;
    const status = error.status || "n/a";
    const code = errorData?.code || error.code || error.name || "EDGE_ERROR";
    const hint = errorData?.hint || errorData?.error || error.message || "Unknown error";
    throw new Error(`${code} [${status}]: ${hint}`);
  }
  if (!data || !data.opponent_id) {
    const errorCode = data?.code || "NO_OPPONENT_FOUND";
    const errorHint = data?.error || "No eligible opponents available";
    throw new Error(`${errorCode}: ${errorHint}`);
  }
  return data;
}

class ErrorBoundary extends React$1.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }
  componentDidCatch(error, errorInfo) {
  }
  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-6 bg-red-500/10 border border-red-500/30 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-red-400 font-semibold mb-1", children: "Battle Panel Error" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300/80 text-sm", children: this.state.error?.message || "An unexpected error occurred" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: () => this.setState({ hasError: false, error: void 0 }),
              className: "mt-3 text-xs text-red-200 hover:text-red-100 underline",
              children: "Try again"
            }
          )
        ] })
      ] }) });
    }
    return this.props.children;
  }
}

const BOT_LEVELS = {
  easy: { min: 350, max: 500, name: "Rookie Bot", color: "text-green-400" },
  medium: { min: 250, max: 400, name: "Agent Bot", color: "text-yellow-400" },
  hard: { min: 180, max: 300, name: "Elite Bot", color: "text-orange-400" },
  extreme: { min: 120, max: 220, name: "TRON Master", color: "text-red-400" }
};
function PracticeMode({ userId, onClose }) {
  const [gameState, setGameState] = reactExports.useState("idle");
  const [countdown, setCountdown] = reactExports.useState(3);
  const [myReaction, setMyReaction] = reactExports.useState(null);
  const [botReaction, setBotReaction] = reactExports.useState(null);
  const [winner, setWinner] = reactExports.useState(null);
  const [botLevel, setBotLevel] = reactExports.useState("medium");
  const [stats, setStats] = reactExports.useState({ wins: 0, losses: 0, bestTime: 0, avgTime: 0, totalGames: 0 });
  const [recentTimes, setRecentTimes] = reactExports.useState([]);
  const flashTimeRef = reactExports.useRef(0);
  const waitingTimeoutRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    const saved = localStorage.getItem(`practice_stats_${userId}`);
    if (saved) {
      setStats(JSON.parse(saved));
    }
    const savedTimes = localStorage.getItem(`practice_times_${userId}`);
    if (savedTimes) {
      setRecentTimes(JSON.parse(savedTimes));
    }
  }, [userId]);
  const saveStats = reactExports.useCallback((newStats, newTimes) => {
    localStorage.setItem(`practice_stats_${userId}`, JSON.stringify(newStats));
    localStorage.setItem(`practice_times_${userId}`, JSON.stringify(newTimes.slice(-20)));
  }, [userId]);
  const startGame = () => {
    setGameState("countdown");
    setCountdown(3);
    setMyReaction(null);
    setBotReaction(null);
    setWinner(null);
  };
  reactExports.useEffect(() => {
    if (gameState !== "countdown") return;
    if (countdown > 0) {
      const timer = setTimeout(() => setCountdown((c) => c - 1), 1e3);
      return () => clearTimeout(timer);
    } else {
      setGameState("waiting");
    }
  }, [gameState, countdown]);
  reactExports.useEffect(() => {
    if (gameState !== "waiting") return;
    const delay = 2e3 + Math.random() * 6e3;
    const timer = setTimeout(() => {
      flashTimeRef.current = Date.now();
      const bot2 = BOT_LEVELS[botLevel];
      const botTime = Math.round(bot2.min + Math.random() * (bot2.max - bot2.min));
      setBotReaction(botTime);
      setGameState("flash");
    }, delay);
    waitingTimeoutRef.current = timer;
    return () => {
      clearTimeout(timer);
    };
  }, [gameState, botLevel]);
  const handleTap = () => {
    if (gameState === "waiting") {
      if (waitingTimeoutRef.current) {
        clearTimeout(waitingTimeoutRef.current);
        waitingTimeoutRef.current = null;
      }
      setGameState("too_early");
      return;
    }
    if (gameState === "flash") {
      const reaction = Date.now() - flashTimeRef.current;
      setMyReaction(reaction);
      const botTime = botReaction || 999;
      const playerWon = reaction < botTime;
      setWinner(playerWon ? "player" : "bot");
      const newTimes = [...recentTimes, reaction];
      const newStats = {
        wins: stats.wins + (playerWon ? 1 : 0),
        losses: stats.losses + (playerWon ? 0 : 1),
        bestTime: stats.bestTime === 0 ? reaction : Math.min(stats.bestTime, reaction),
        avgTime: Math.round(newTimes.reduce((a, b) => a + b, 0) / newTimes.length),
        totalGames: stats.totalGames + 1
      };
      setStats(newStats);
      setRecentTimes(newTimes);
      saveStats(newStats, newTimes);
      setGameState("result");
      if ("vibrate" in navigator) {
        navigator.vibrate(playerWon ? [50, 30, 50] : [100]);
      }
    }
  };
  const playBeep = (freq = 800, duration = 100) => {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.frequency.value = freq;
      osc.type = "sine";
      gain.gain.setValueAtTime(0.3, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration / 1e3);
      osc.start();
      osc.stop(ctx.currentTime + duration / 1e3);
    } catch (e) {
    }
  };
  reactExports.useEffect(() => {
    if (gameState === "countdown" && countdown > 0) {
      playBeep(600 + (3 - countdown) * 200, 100);
    }
    if (gameState === "flash") {
      playBeep(1200, 150);
    }
  }, [gameState, countdown]);
  const bot = BOT_LEVELS[botLevel];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: `w-5 h-5 ${bot.color}` }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `font-semibold ${bot.color}`, children: bot.name })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-1", children: Object.keys(BOT_LEVELS).map((level) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          size: "sm",
          variant: botLevel === level ? "default" : "outline",
          onClick: () => setBotLevel(level),
          disabled: gameState !== "idle" && gameState !== "result" && gameState !== "too_early",
          className: `text-xs px-2 h-7 ${botLevel === level ? "bg-cyan-600" : ""}`,
          children: level.charAt(0).toUpperCase()
        },
        level
      )) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 gap-2 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 rounded-lg bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[10px] text-gray-400", children: "Wins" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-green-400", children: stats.wins })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 rounded-lg bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[10px] text-gray-400", children: "Losses" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-red-400", children: stats.losses })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 rounded-lg bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[10px] text-gray-400", children: "Best" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg font-bold text-cyan-400", children: [
          stats.bestTime || "-",
          "ms"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 rounded-lg bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[10px] text-gray-400", children: "Avg" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg font-bold text-purple-400", children: [
          stats.avgTime || "-",
          "ms"
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "relative h-64 rounded-2xl overflow-hidden cursor-pointer select-none",
        onClick: handleTap,
        style: {
          background: gameState === "flash" ? "linear-gradient(135deg, #00ff00 0%, #00ffff 100%)" : gameState === "too_early" ? "linear-gradient(135deg, #ff0000 0%, #ff4444 100%)" : "linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",
          boxShadow: gameState === "flash" ? "0 0 60px rgba(0,255,255,0.8), inset 0 0 60px rgba(0,255,0,0.4)" : "0 0 30px rgba(0,0,0,0.5)",
          transition: "background 0.05s, box-shadow 0.05s"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(AnimatePresence, { mode: "wait", children: [
          gameState === "idle" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              exit: { opacity: 0 },
              className: "absolute inset-0 flex flex-col items-center justify-center",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-16 h-16 text-cyan-400 mb-4" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-lg font-semibold mb-2", children: "Practice Mode" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-400 text-sm mb-4", children: [
                  "Train against ",
                  bot.name
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: startGame, className: "bg-cyan-500 hover:bg-cyan-600", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "mr-2 h-4 w-4" }),
                  "Start Training"
                ] })
              ]
            },
            "idle"
          ),
          gameState === "countdown" && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { scale: 0.5, opacity: 0 },
              animate: { scale: 1, opacity: 1 },
              exit: { scale: 1.5, opacity: 0 },
              className: "absolute inset-0 flex items-center justify-center",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  initial: { scale: 2, opacity: 0 },
                  animate: { scale: 1, opacity: 1 },
                  className: "text-8xl font-bold text-white",
                  style: { textShadow: "0 0 30px rgba(0,212,255,0.8)" },
                  children: countdown
                },
                countdown
              )
            },
            "countdown"
          ),
          gameState === "waiting" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              exit: { opacity: 0 },
              className: "absolute inset-0 flex flex-col items-center justify-center",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { scale: [1, 1.1, 1] },
                    transition: { duration: 1, repeat: Infinity },
                    className: "w-20 h-20 rounded-full border-4 border-cyan-400/50 flex items-center justify-center",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-full bg-cyan-400/20" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 mt-4 text-lg", children: "Wait for GREEN..." })
              ]
            },
            "waiting"
          ),
          gameState === "flash" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { scale: 0.8 },
              animate: { scale: 1 },
              className: "absolute inset-0 flex flex-col items-center justify-center",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { scale: [1, 1.2, 1] },
                    transition: { duration: 0.2, repeat: Infinity },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-24 h-24 text-black" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-black text-3xl font-bold mt-4", children: "TAP NOW!" })
              ]
            },
            "flash"
          ),
          gameState === "too_early" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              className: "absolute inset-0 flex flex-col items-center justify-center",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-3xl font-bold mb-4", children: "TOO EARLY! " }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 mb-6", children: "Wait for the green flash" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: startGame, variant: "outline", className: "border-white text-white", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "mr-2 h-4 w-4" }),
                  "Try Again"
                ] })
              ]
            },
            "too_early"
          ),
          gameState === "result" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0, y: 20 },
              animate: { opacity: 1, y: 0 },
              className: "absolute inset-0 flex flex-col items-center justify-center p-4",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-6xl mb-2", children: winner === "player" ? "" : "" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: `text-2xl font-bold mb-4 ${winner === "player" ? "text-green-400" : "text-red-400"}`, children: winner === "player" ? "YOU WIN!" : "BOT WINS!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-6 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-400", children: "You" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: `text-2xl font-bold ${winner === "player" ? "text-green-400" : "text-white"}`, children: [
                      myReaction,
                      "ms"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-400", children: bot.name }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: `text-2xl font-bold ${winner === "bot" ? "text-red-400" : "text-white"}`, children: [
                      botReaction,
                      "ms"
                    ] })
                  ] })
                ] }),
                myReaction && myReaction < 200 && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-yellow-500/20 text-yellow-400 border-yellow-500/30 mb-4", children: " Lightning Fast!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: startGame, className: "bg-cyan-500 hover:bg-cyan-600", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "mr-2 h-4 w-4" }),
                  "Play Again"
                ] })
              ]
            },
            "result"
          )
        ] })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center text-xs text-gray-500", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: " Pro tip: Focus on the center and use your peripheral vision" }) })
  ] });
}

function BattleLobby() {
  const navigate = useSafeNavigate();
  const { toast } = useToast();
  const [userId, setUserId] = reactExports.useState(null);
  const [stakeType, setStakeType] = reactExports.useState("m1u");
  const [stakePercentage, setStakePercentage] = reactExports.useState(25);
  const [opponentHandle, setOpponentHandle] = reactExports.useState("");
  const [opponentId, setOpponentId] = reactExports.useState("");
  const [submitting, setSubmitting] = reactExports.useState(false);
  const [loadingRandom, setLoadingRandom] = reactExports.useState(false);
  const [pendingBattles, setPendingBattles] = reactExports.useState([]);
  const [myBattles, setMyBattles] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(false);
  const [stats, setStats] = reactExports.useState(null);
  const [topAgents, setTopAgents] = reactExports.useState([]);
  const stakeValid = STAKE_TYPES.some((t) => t.value === stakeType);
  const percentValid = STAKE_PERCENTS.includes(stakePercentage);
  const opponentValid = opponentHandle.trim().length > 0 || opponentId.trim().length > 0;
  const canCreate = stakeValid && percentValid && opponentValid && !submitting;
  reactExports.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      if (data.user) {
        setUserId(data.user.id);
        loadBattles(data.user.id);
        loadStats(data.user.id);
        loadTopAgents();
      }
    });
    const channel = supabase.channel("battles").on("postgres_changes", { event: "*", schema: "public", table: "battles" }, () => {
      if (userId) loadBattles(userId);
    }).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, [userId]);
  const loadBattles = async (uid) => {
    const { data: pending } = await supabase.from("battles").select("*, creator:profiles!battles_creator_id_fkey(agent_code), opponent:profiles!battles_opponent_id_fkey(agent_code)").eq("status", "pending").eq("opponent_id", uid);
    const { data: myActive } = await supabase.from("battles").select("*, creator:profiles!battles_creator_id_fkey(agent_code), opponent:profiles!battles_opponent_id_fkey(agent_code)").or(`creator_id.eq.${uid},opponent_id.eq.${uid}`).in("status", ["pending", "accepted", "countdown", "active"]).order("created_at", { ascending: false });
    setPendingBattles(pending || []);
    setMyBattles(myActive || []);
  };
  const loadStats = async (uid) => {
    try {
      const { data: battles } = await supabase.from("battles").select("*").or(`creator_id.eq.${uid},opponent_id.eq.${uid}`).eq("status", "resolved");
      if (battles) {
        const total = battles.length;
        const wins = battles.filter((b) => b.winner_id === uid).length;
        const winRate = total > 0 ? Math.round(wins / total * 100) : 0;
        const reactions = battles.map((b) => b.creator_id === uid ? b.creator_reaction_ms : b.opponent_reaction_ms).filter((ms) => ms !== null && ms !== void 0);
        const avgReaction = reactions.length > 0 ? Math.round(reactions.reduce((a, b) => a + b, 0) / reactions.length) : 0;
        const fastest = reactions.length > 0 ? Math.min(...reactions) : 0;
        setStats({
          total_battles: total,
          win_rate_percentage: winRate,
          avg_reaction_ms: avgReaction,
          fastest_reaction_ms: fastest
        });
      }
    } catch (error) {
      setStats(null);
    }
  };
  const loadTopAgents = async () => {
    try {
      const { data, error } = await supabase.rpc("get_top_agents");
      if (error) throw error;
      setTopAgents(data || []);
    } catch (error) {
      setTopAgents([]);
    }
  };
  const handleRandomOpponent = async () => {
    setLoadingRandom(true);
    try {
      const opponent = await getRandomOpponent();
      setOpponentId(opponent.opponent_id);
      setOpponentHandle(opponent.opponent_name);
      toast({
        title: " Random Opponent Found",
        description: `Matched with ${opponent.opponent_name}`
      });
    } catch (error) {
      toast({
        title: "No Opponent Found",
        description: error?.message || "Try again later",
        variant: "destructive"
      });
    } finally {
      setLoadingRandom(false);
    }
  };
  const handleSelectTopAgent = (agent) => {
    setOpponentId(agent.id);
    setOpponentHandle(agent.username || agent.agent_code);
    toast({
      title: " Top Agent Selected",
      description: `Challenge ${agent.username || agent.agent_code}`
    });
  };
  const handleCreateBattle = async () => {
    if (!canCreate || !userId) return;
    setSubmitting(true);
    try {
      const payload = {
        stake_type: stakeType,
        stake_percentage: stakePercentage
      };
      if (opponentId) {
        payload.opponent_id = opponentId;
      } else {
        payload.opponent_handle = opponentHandle.trim();
      }
      const result = await createBattle(payload);
      toast({
        title: " Battle Created!",
        description: `Arena: ${result.arena_name} | Stake: ${result.stake_amount} ${stakeType}`
      });
      setOpponentHandle("");
      setOpponentId("");
      if (result.battle_id) {
        navigate(`/battle/${result.battle_id}`);
      } else {
        loadBattles(userId);
      }
    } catch (error) {
      let errorMsg = "Unknown error occurred";
      if (error?.message) {
        const match = error.message.match(/([A-Z_]+)\s*\[(\d+)\]:\s*(.+)/);
        if (match) {
          errorMsg = `${match[1]}: ${match[3]}`;
        } else {
          errorMsg = error.message;
        }
      }
      toast({
        title: "Battle Creation Failed",
        description: errorMsg,
        variant: "destructive"
      });
    } finally {
      setSubmitting(false);
    }
  };
  const handleAcceptBattle = async (battleId) => {
    setLoading(true);
    try {
      await acceptBattle(battleId);
      toast({
        title: " Battle Accepted!",
        description: "Entering arena..."
      });
      navigate(`/battle/${battleId}`);
    } catch (error) {
      toast({
        title: "Accept Failed",
        description: error?.message || "Unknown error occurred",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-auto max-h-[70vh] overflow-y-auto custom-scrollbar bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 p-6 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: -20 },
        animate: { opacity: 1, y: 0 },
        className: "text-center mb-8",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-4xl font-orbitron font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 mb-2", children: "M1SSION BATTLE ARENA" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 text-base", children: "Enter the grid. Test your reaction." })
        ]
      }
    ),
    stats && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gray-800/50 border-cyan-500/30 mb-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-cyan-400 flex items-center gap-2 text-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-5 h-5" }),
        "Your Stats"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: "Win Rate" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xl font-bold text-white", children: [
            stats.win_rate_percentage,
            "%"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: "Battles" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xl font-bold text-white", children: stats.total_battles })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: "Avg Reaction" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xl font-bold text-cyan-400", children: [
            stats.avg_reaction_ms,
            "ms"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: "Fastest" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xl font-bold text-green-400", children: [
            stats.fastest_reaction_ms,
            "ms"
          ] })
        ] })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "practice", className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-5 bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "practice", className: "gap-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-3 h-3" }),
          "Practice"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "create", children: "Create" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "top", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "w-3 h-3 mr-1" }),
          "Top"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "pending", children: [
          "(",
          pendingBattles.length,
          ")"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "active", children: [
          "(",
          myBattles.length,
          ")"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "practice", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-cyan-400 flex items-center gap-2 text-lg", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-5 h-5" }),
            "Training Arena"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { className: "text-sm", children: "Practice your reaction time against AI opponents" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: userId && /* @__PURE__ */ jsxRuntimeExports.jsx(PracticeMode, { userId }) })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "create", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-cyan-400 text-lg", children: "Create New Battle" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { className: "text-sm", children: "Challenge an opponent with your stake" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(ErrorBoundary, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm text-gray-400 mb-2 block", children: "Opponent Handle or Agent Code" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  placeholder: "e.g., AGENT-001 or @username",
                  className: "bg-gray-700 border-cyan-500/30 text-white placeholder:text-gray-500 flex-1",
                  value: opponentHandle,
                  onChange: (e) => {
                    setOpponentHandle(e.target.value);
                    setOpponentId("");
                  },
                  disabled: submitting || loadingRandom
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Button,
                {
                  onClick: handleRandomOpponent,
                  disabled: loadingRandom || submitting,
                  variant: "outline",
                  className: "bg-purple-600/20 border-purple-500/30 hover:bg-purple-600/40",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Shuffle, { className: "w-4 h-4 mr-1" }),
                    "Random"
                  ]
                }
              )
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm text-gray-400 mb-2 block", children: "Stake Type" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              SafeSelect,
              {
                value: stakeType,
                onChange: setStakeType,
                disabled: submitting || loadingRandom
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm text-gray-400 mb-2 block", children: "Stake Amount (%)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-3 gap-3", children: STAKE_PERCENTS.map((pct) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: stakePercentage === pct ? "default" : "outline",
                onClick: () => setStakePercentage(pct),
                disabled: submitting,
                className: stakePercentage === pct ? "bg-cyan-500 hover:bg-cyan-600" : "",
                children: [
                  pct,
                  "%"
                ]
              },
              pct
            )) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: handleCreateBattle,
              disabled: !canCreate,
              size: "lg",
              className: "w-full bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Swords, { className: "mr-2" }),
                submitting ? "Creating Battle..." : "Create Battle"
              ]
            }
          ),
          !canCreate && !submitting && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-gray-500 text-center", children: [
            !opponentValid && "Enter opponent or pick random  ",
            !stakeValid && "Select stake type  ",
            !percentValid && "Select stake percentage"
          ] })
        ] }) })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "top", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-yellow-400 flex items-center gap-2 text-lg", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "w-5 h-5" }),
            "Top Agents"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { className: "text-sm", children: "Challenge the best players" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: topAgents.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8 text-gray-400", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-10 h-10 mx-auto mb-3 opacity-30" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: "No rankings yet" })
        ] }) : topAgents.map((agent, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, x: -20 },
            animate: { opacity: 1, x: 0 },
            transition: { delay: index * 0.05 },
            className: "flex items-center justify-between p-3 rounded-lg bg-gray-700/30 border border-gray-600/30 hover:border-yellow-500/50 transition-all",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${index === 0 ? "bg-yellow-500 text-black" : index === 1 ? "bg-gray-400 text-black" : index === 2 ? "bg-orange-600 text-white" : "bg-gray-600 text-white"}`, children: [
                  "#",
                  index + 1
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-bold text-sm", children: agent.username || agent.agent_code || "Agent" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-400 text-xs", children: [
                    agent.wins,
                    " wins  ELO ",
                    agent.elo
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: () => handleSelectTopAgent(agent),
                  size: "sm",
                  variant: "outline",
                  className: "bg-yellow-600/20 border-yellow-500/30 hover:bg-yellow-600/40 text-yellow-400",
                  children: "Challenge"
                }
              )
            ]
          },
          agent.id
        )) }) })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "pending", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: pendingBattles.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-12 text-center text-gray-400", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-12 h-12 mx-auto mb-4 opacity-50" }),
        "No pending challenges"
      ] }) }) : pendingBattles.map((battle) => /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "py-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white font-bold", children: [
            "Challenge from ",
            battle.creator?.agent_code || "Unknown"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-cyan-400 text-sm", children: [
            "Stake: ",
            battle.stake_amount,
            " ",
            battle.stake_type,
            " (",
            battle.stake_percentage,
            "%)"
          ] }),
          battle.arena_name && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: battle.arena_name })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: () => handleAcceptBattle(battle.id),
            disabled: loading,
            className: "bg-green-600 hover:bg-green-700",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "mr-2 w-4 h-4" }),
              "Accept"
            ]
          }
        )
      ] }) }) }, battle.id)) }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "active", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: myBattles.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-12 text-center text-gray-400", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-12 h-12 mx-auto mb-4 opacity-50" }),
        "No active battles"
      ] }) }) : myBattles.map((battle) => /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "py-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-bold", children: battle.creator_id === userId ? "vs " + (battle.opponent?.agent_code || "Opponent") : "vs " + (battle.creator?.agent_code || "Creator") }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-cyan-400 text-sm capitalize", children: [
            "Status: ",
            battle.status
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: () => navigate(`/battle/${battle.id}`),
            className: "bg-purple-600 hover:bg-purple-700",
            children: "Enter Arena"
          }
        )
      ] }) }) }, battle.id)) }) })
    ] })
  ] }) });
}

const BattleLobby$1 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: BattleLobby
}, Symbol.toStringTag, { value: 'Module' }));

function TronDisc({ isActive, isFlashing, onClick, disabled }) {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "relative w-64 h-64 cursor-pointer select-none",
      onClick: disabled ? void 0 : onClick,
      whileHover: disabled ? {} : { scale: 1.1 },
      whileTap: disabled ? {} : { scale: 0.95 },
      animate: {
        rotate: isActive ? 360 : 0,
        scale: isFlashing ? [1, 1.2, 1] : 1
      },
      transition: {
        rotate: { duration: 2, repeat: Infinity, ease: "linear" },
        scale: isFlashing ? { duration: 0.5, repeat: 3 } : {}
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute inset-0 rounded-full bg-gradient-to-br from-cyan-500/30 via-blue-500/20 to-purple-500/30 blur-xl",
            animate: {
              opacity: isFlashing ? [0.5, 1, 0.5] : [0.3, 0.6, 0.3]
            },
            transition: {
              duration: 2,
              repeat: Infinity,
              ease: "easeInOut"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative w-full h-full rounded-full bg-gradient-to-br from-cyan-500 via-blue-600 to-purple-600 shadow-2xl shadow-cyan-500/50", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-4 rounded-full border-4 border-cyan-400/50" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-8 rounded-full border-2 border-blue-400/30" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-12 rounded-full bg-gradient-to-br from-cyan-600/80 to-blue-700/80" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              animate: {
                rotate: isActive ? -360 : 0,
                scale: isFlashing ? [1, 1.3, 1] : 1
              },
              transition: {
                rotate: { duration: 2, repeat: Infinity, ease: "linear" }
              },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-16 h-16 text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.8)]" })
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "absolute inset-0 rounded-full",
              animate: { rotate: 360 },
              transition: { duration: 4, repeat: Infinity, ease: "linear" },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-1/2 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-cyan-300 to-transparent" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-1/2 w-0.5 h-full bg-gradient-to-b from-transparent via-blue-300 to-transparent" })
              ]
            }
          ),
          isFlashing && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "absolute inset-0 rounded-full bg-white",
              initial: { opacity: 0 },
              animate: { opacity: [0, 0.8, 0] },
              transition: { duration: 0.6, times: [0, 0.5, 1] }
            }
          )
        ] }),
        isActive && !disabled && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute -bottom-12 left-1/2 -translate-x-1/2 text-cyan-400 font-bold text-xl tracking-wider",
            initial: { opacity: 0, y: -10 },
            animate: { opacity: [0.5, 1, 0.5], y: 0 },
            transition: { duration: 1, repeat: Infinity },
            children: "TAP NOW!"
          }
        )
      ]
    }
  );
}

function useBattleRealtime({
  battleId,
  onBattleUpdate,
  onCountdownStart,
  onFlash,
  onResolved
}) {
  const [channel, setChannel] = reactExports.useState(null);
  const [connected, setConnected] = reactExports.useState(false);
  reactExports.useEffect(() => {
    if (!battleId) return;
    const battleChannel = supabase.channel(`battle:${battleId}`, {
      config: { broadcast: { ack: true } }
    });
    battleChannel.on("postgres_changes", {
      event: "UPDATE",
      schema: "public",
      table: "battles",
      filter: `id=eq.${battleId}`
    }, (payload) => {
      const battle = payload.new;
      onBattleUpdate?.(battle);
      if (battle.status === "countdown" && battle.countdown_start_at && battle.flash_at) {
        onCountdownStart?.(battle.countdown_start_at, battle.flash_at);
      }
      if (battle.status === "resolved" && battle.winner_id) {
        onResolved?.(battle.winner_id);
      }
    }).subscribe((status) => {
      if (status === "SUBSCRIBED") {
        setConnected(true);
        emitSubscribed(`battle:${battleId}`);
      } else if (status === "CLOSED") {
        setConnected(false);
      } else if (status === "CHANNEL_ERROR" || status === "TIMED_OUT") {
        emitError(String(status), `battle:${battleId}`);
      }
    });
    setChannel(battleChannel);
    return () => {
      battleChannel.unsubscribe();
      setConnected(false);
    };
  }, [battleId, onBattleUpdate, onCountdownStart, onResolved]);
  const broadcast = reactExports.useCallback(
    async (event, payload) => {
      if (!channel) return;
      await channel.send({
        type: "broadcast",
        event,
        payload
      });
    },
    [channel]
  );
  return { connected, broadcast };
}

function BattleArena({ battleId: battleIdProp } = {}) {
  const params = useParams$1();
  const battleId = battleIdProp || params.battleId;
  const navigate = useSafeNavigate();
  const { toast } = useToast();
  const [status, setStatus] = reactExports.useState("waiting");
  const [countdown, setCountdown] = reactExports.useState(null);
  const [isFlashing, setIsFlashing] = reactExports.useState(false);
  const [myReactionMs, setMyReactionMs] = reactExports.useState(null);
  const [winnerId, setWinnerId] = reactExports.useState(null);
  const [battle, setBattle] = reactExports.useState(null);
  const [userId, setUserId] = reactExports.useState(null);
  reactExports.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      setUserId(data.user?.id || null);
    });
  }, []);
  const { connected } = useBattleRealtime({
    battleId: battleId || null,
    onBattleUpdate: (updatedBattle) => {
      setBattle(updatedBattle);
    },
    onCountdownStart: (countdownStartAt, flashAt) => {
      const startTime = new Date(countdownStartAt).getTime();
      const flashTime = new Date(flashAt).getTime();
      const now = Date.now();
      if (startTime > now) {
        setTimeout(() => {
          setStatus("countdown");
          startCountdownTimer(flashTime);
        }, startTime - now);
      } else {
        setStatus("countdown");
        startCountdownTimer(flashTime);
      }
    },
    onResolved: (winnerIdResolved) => {
      setWinnerId(winnerIdResolved);
      setStatus("resolved");
    }
  });
  const startCountdownTimer = (flashTime) => {
    const interval = setInterval(() => {
      const remaining = Math.max(0, Math.ceil((flashTime - Date.now()) / 1e3));
      setCountdown(remaining);
      if (remaining === 0) {
        clearInterval(interval);
        triggerFlash();
      }
    }, 100);
  };
  const triggerFlash = (flashTime) => {
    setIsFlashing(true);
    setStatus("active");
    toast({ title: " FLASH!", description: "Tap now!", duration: 1e3 });
    setTimeout(() => setIsFlashing(false), 500);
  };
  const handleTap = async () => {
    if (status !== "active" || !battleId || !userId) return;
    const clientTapAt = (/* @__PURE__ */ new Date()).toISOString();
    setStatus("tapped");
    if ("vibrate" in navigator) {
      navigator.vibrate([50, 30, 50]);
    }
    const pingStart = Date.now();
    await supabase.from("battles").select("id").eq("id", battleId).single();
    const pingMs = Date.now() - pingStart;
    const { data, error } = await supabase.functions.invoke("battle-tap-commit", {
      body: {
        battle_id: battleId,
        client_tap_at: clientTapAt,
        ping_ms: pingMs
      }
    });
    if (error) {
      toast({ title: "Error", description: error.message, variant: "destructive" });
      return;
    }
    setMyReactionMs(data.reaction_ms);
    toast({ title: ` ${data.reaction_ms}ms!`, description: "Reaction recorded" });
    setTimeout(async () => {
      await supabase.functions.invoke("battle-resolve", {
        body: { battle_id: battleId }
      });
    }, 2e3);
  };
  const handleReady = async () => {
    if (!battleId) return;
    const { error } = await supabase.functions.invoke("battle-ready", {
      body: { battle_id: battleId }
    });
    if (error) {
      toast({ title: "Error", description: error.message, variant: "destructive" });
    }
  };
  if (!battleId) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white", children: "Invalid battle ID" }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 relative overflow-hidden", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 opacity-20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0", style: {
      backgroundImage: "linear-gradient(cyan 1px, transparent 1px), linear-gradient(90deg, cyan 1px, transparent 1px)",
      backgroundSize: "50px 50px"
    } }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative z-10 min-h-screen flex flex-col items-center justify-center p-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-8 left-1/2 -translate-x-1/2 flex items-center gap-2 text-cyan-400", children: connected ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-green-500 rounded-full animate-pulse" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Connected" })
      ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-red-500 rounded-full" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Connecting..." })
      ] }) }),
      battle?.arena_name && /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          initial: { opacity: 0, y: -20 },
          animate: { opacity: 1, y: 0 },
          className: "text-3xl font-bold text-cyan-400 mb-8 tracking-wider",
          children: battle.arena_name
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(AnimatePresence, { mode: "wait", children: [
        status === "waiting" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            exit: { opacity: 0 },
            className: "flex flex-col items-center gap-8",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-4xl font-bold text-white mb-4", children: "Get Ready" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400", children: "Prepare for battle" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleReady, size: "lg", className: "bg-cyan-500 hover:bg-cyan-600", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "mr-2" }),
                "I'm Ready"
              ] })
            ]
          },
          "waiting"
        ),
        status === "countdown" && countdown !== null && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0 },
            animate: { scale: 1 },
            exit: { scale: 0 },
            className: "flex flex-col items-center gap-8",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-16 h-16 text-cyan-400 animate-pulse" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-9xl font-bold text-white", children: countdown }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 text-xl", children: "Get ready to tap..." })
            ]
          },
          "countdown"
        ),
        (status === "active" || status === "tapped") && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0 },
            animate: { scale: 1 },
            className: "flex flex-col items-center gap-4",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                TronDisc,
                {
                  isActive: status === "active",
                  isFlashing,
                  onClick: handleTap,
                  disabled: status === "tapped"
                }
              ),
              status === "tapped" && myReactionMs && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  initial: { opacity: 0, y: 20 },
                  animate: { opacity: 1, y: 0 },
                  className: "text-3xl font-bold text-cyan-400",
                  children: [
                    myReactionMs,
                    "ms"
                  ]
                }
              )
            ]
          },
          "active"
        ),
        status === "resolved" && winnerId && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0 },
            animate: { scale: 1 },
            className: "flex flex-col items-center gap-8",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-32 h-32 text-yellow-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-5xl font-bold text-white", children: winnerId === userId ? "VICTORY!" : "DEFEAT" }),
              battle && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 text-xl mb-2", children: "Reaction Times" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-8", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "You" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white text-2xl font-bold", children: [
                      battle.creator_id === userId ? battle.creator_reaction_ms : battle.opponent_reaction_ms,
                      "ms"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Opponent" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white text-2xl font-bold", children: [
                      battle.creator_id === userId ? battle.opponent_reaction_ms : battle.creator_reaction_ms,
                      "ms"
                    ] })
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: () => navigate("/battle"), size: "lg", className: "bg-purple-600 hover:bg-purple-700", children: "Back to Lobby" })
            ]
          },
          "resolved"
        )
      ] })
    ] })
  ] });
}

const BattleArena$1 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: BattleArena
}, Symbol.toStringTag, { value: 'Module' }));

function BattleTest() {
  const { toast } = useToast();
  const [userId, setUserId] = reactExports.useState(null);
  const [testSteps, setTestSteps] = reactExports.useState([]);
  const [isRunning, setIsRunning] = reactExports.useState(false);
  const [battleId, setBattleId] = reactExports.useState(null);
  const [dbStats, setDbStats] = reactExports.useState(null);
  reactExports.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      if (data.user) {
        setUserId(data.user.id);
        loadDbStats();
      }
    });
  }, []);
  const loadDbStats = async () => {
    const { data: battles } = await supabase.from("battles").select("status");
    const { data: transfers } = await supabase.from("battle_transfers").select("id");
    const { data: participants } = await supabase.from("battle_participants").select("id");
    const { data: audit } = await supabase.from("battle_audit").select("event_type");
    setDbStats({
      total_battles: battles?.length || 0,
      by_status: battles?.reduce((acc, b) => {
        acc[b.status] = (acc[b.status] || 0) + 1;
        return acc;
      }, {}),
      total_transfers: transfers?.length || 0,
      total_participants: participants?.length || 0,
      total_audit_logs: audit?.length || 0,
      audit_events: audit?.reduce((acc, a) => {
        acc[a.event_type] = (acc[a.event_type] || 0) + 1;
        return acc;
      }, {})
    });
  };
  const updateStep = (id, updates) => {
    setTestSteps((prev) => prev.map((s) => s.id === id ? { ...s, ...updates } : s));
  };
  const runFullTest = async () => {
    if (!userId) {
      toast({ title: "Error", description: "Not authenticated", variant: "destructive" });
      return;
    }
    setIsRunning(true);
    const steps = [
      { id: "random-opponent", name: "1. Get Random Opponent", status: "pending" },
      { id: "create-battle", name: "2. Create Battle", status: "pending" },
      { id: "verify-db", name: "3. Verify DB Entry", status: "pending" },
      { id: "verify-realtime", name: "4. Test Realtime Channel", status: "pending" },
      { id: "cleanup", name: "5. Cleanup Test Data", status: "pending" }
    ];
    setTestSteps(steps);
    let testBattleId = null;
    try {
      updateStep("random-opponent", { status: "running" });
      const start = Date.now();
      const opponent = await getRandomOpponent();
      const duration = Date.now() - start;
      updateStep("random-opponent", {
        status: "success",
        message: `Found opponent: ${opponent.opponent_name}`,
        duration
      });
      updateStep("create-battle", { status: "running" });
      const createStart = Date.now();
      const result = await createBattle({
        opponent_id: opponent.opponent_id,
        stake_type: "energy",
        stake_percentage: 25
      });
      const createDuration = Date.now() - createStart;
      testBattleId = result.battle_id;
      setBattleId(testBattleId);
      updateStep("create-battle", {
        status: "success",
        message: `Battle created: ${testBattleId.slice(0, 8)}...`,
        duration: createDuration
      });
      updateStep("verify-db", { status: "running" });
      const { data: battle, error: dbError } = await supabase.from("battles").select("*").eq("id", testBattleId).single();
      if (dbError || !battle) {
        throw new Error("Battle not found in DB");
      }
      updateStep("verify-db", {
        status: "success",
        message: `Status: ${battle.status}, Stake: ${battle.stake_amount} ${battle.stake_type}`
      });
      updateStep("verify-realtime", { status: "running" });
      const channel = supabase.channel(`test-battle:${testBattleId}`);
      await new Promise((resolve, reject) => {
        const timeout = setTimeout(() => {
          channel.unsubscribe();
          reject(new Error("Realtime subscription timeout"));
        }, 5e3);
        channel.on("postgres_changes", {
          event: "*",
          schema: "public",
          table: "battles",
          filter: `id=eq.${testBattleId}`
        }, () => {
          clearTimeout(timeout);
          channel.unsubscribe();
          resolve();
        }).subscribe((status) => {
          if (status === "SUBSCRIBED") {
            supabase.from("battles").update({ metadata: { test: true } }).eq("id", testBattleId).then(() => {
              setTimeout(() => {
                clearTimeout(timeout);
                channel.unsubscribe();
                resolve();
              }, 1e3);
            });
          }
        });
      });
      updateStep("verify-realtime", {
        status: "success",
        message: "Realtime subscription working"
      });
    } catch (error) {
      const failedStep = steps.find((s) => s.status === "running");
      if (failedStep) {
        updateStep(failedStep.id, {
          status: "error",
          message: error.message
        });
      }
      toast({ title: "Test Failed", description: error.message, variant: "destructive" });
    } finally {
      if (testBattleId) {
        updateStep("cleanup", { status: "running" });
        try {
          await supabase.from("battles").delete().eq("id", testBattleId);
          updateStep("cleanup", { status: "success", message: "Test battle deleted" });
        } catch (error) {
          updateStep("cleanup", { status: "error", message: error.message });
        }
      }
      setIsRunning(false);
      loadDbStats();
    }
  };
  const clearAllTestBattles = async () => {
    if (!confirm("Delete all test battles with metadata.test=true?")) return;
    const { error } = await supabase.from("battles").delete().not("metadata->test", "is", null);
    if (error) {
      toast({ title: "Error", description: error.message, variant: "destructive" });
    } else {
      toast({ title: "Success", description: "Test battles cleared" });
      loadDbStats();
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-background via-background to-primary/5 p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-primary/20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-2xl font-bold flex items-center gap-2", children: " TRON Battle Test Lab" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "End-to-end testing for battle flow, edge functions, and realtime sync" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: runFullTest,
            disabled: isRunning || !userId,
            className: "flex items-center gap-2",
            children: isRunning ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin" }),
              " Running..."
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Play, { className: "w-4 h-4" }),
              " Run Full Test"
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: clearAllTestBattles,
            variant: "outline",
            className: "flex items-center gap-2",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-4 h-4" }),
              " Clear Test Data"
            ]
          }
        )
      ] }) })
    ] }),
    testSteps.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-primary/20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Test Results" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-3", children: testSteps.map((step) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "div",
        {
          className: "flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
              step.status === "pending" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-5 h-5 rounded-full border-2 border-muted" }),
              step.status === "running" && /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-5 h-5 animate-spin text-primary" }),
              step.status === "success" && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-5 h-5 text-green-500" }),
              step.status === "error" && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-5 h-5 text-destructive" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-medium", children: step.name }),
                step.message && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: step.message })
              ] })
            ] }),
            step.duration && /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", children: [
              step.duration,
              "ms"
            ] })
          ]
        },
        step.id
      )) })
    ] }),
    dbStats && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-primary/20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Database Statistics" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "overview", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "overview", children: "Overview" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "status", children: "By Status" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "events", children: "Audit Events" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "overview", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-card/50 border", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold", children: dbStats.total_battles }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Total Battles" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-card/50 border", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold", children: dbStats.total_transfers }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Transfers" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-card/50 border", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold", children: dbStats.total_participants }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Participants" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-card/50 border", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold", children: dbStats.total_audit_logs }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Audit Logs" })
          ] })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "status", className: "space-y-2", children: Object.entries(dbStats.by_status || {}).map(([status, count]) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between p-3 rounded-lg bg-card/50 border", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: status }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold", children: String(count) })
        ] }, status)) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "events", className: "space-y-2", children: Object.entries(dbStats.audit_events || {}).map(([event, count]) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between p-3 rounded-lg bg-card/50 border", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: event }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold", children: String(count) })
        ] }, event)) })
      ] }) })
    ] })
  ] }) });
}

const AppInfoSettings = () => {
  const [, setLocation] = useLocation();
  const appInfo = {
    name: "M1SSION",
    version: "2.0.1",
    build: "2025.01.05",
    environment: "Production",
    developer: "NIYVORA KFT"};
  const features = [
    { icon: Globe, title: "Missioni Globali", description: "Esplora il mondo attraverso missioni interattive" },
    { icon: Users, title: "Community", description: "Connettiti con agenti in tutto il mondo" },
    { icon: Shield, title: "Sicurezza", description: "Protezione avanzata dei dati personali" },
    { icon: Smartphone, title: "Multi-Platform", description: "Disponibile su tutti i dispositivi" }
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-background via-background/95 to-background/90", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: "pt-16 pb-20 px-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-lg mx-auto space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4 mb-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            onClick: () => setLocation("/settings"),
            className: "p-2 hover:bg-background/50",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent", children: "Info App" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Dettagli dell'applicazione" })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/50 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "text-center pb-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4 mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "h-10 w-10 text-primary" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent", children: appInfo.name })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card bg-background/20 border-0", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Versione" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-lg text-primary", children: appInfo.version })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card bg-background/20 border-0", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Build" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-lg text-primary", children: appInfo.build })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Separator$1, { className: "my-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-muted-foreground", children: "Ambiente" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-green-500/20 text-green-400 border-green-500/30", children: appInfo.environment })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-muted-foreground", children: "Sviluppatore" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium text-foreground", children: appInfo.developer })
            ] })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/50 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent", children: "Caratteristiche" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-3", children: features.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card p-4 bg-background/20 border-0", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-2 rounded-lg bg-primary/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(feature.icon, { className: "h-5 w-5 text-primary" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-foreground", children: feature.title }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/80", children: feature.description })
          ] })
        ] }) }, index)) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/50 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent", children: "Collegamenti" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            variant: "outline",
            className: "w-full justify-between bg-background/50 border-primary/30 hover:bg-primary/10",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Heart, { className: "h-4 w-4 text-red-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Supporta il Progetto" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(ExternalLink, { className: "h-4 w-4" })
            ]
          }
        ) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/60", children: " 2025 Joseph MUL  M1SSION" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground/40", children: "ALL RIGHTS RESERVED  NIYVORA KFT" })
      ] })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
  ] });
};

const DiagnosticsSettings = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  const [diagnostics, setDiagnostics] = reactExports.useState([]);
  const [isRunning, setIsRunning] = reactExports.useState(false);
  const [lastRun, setLastRun] = reactExports.useState(null);
  const runDiagnostics = async () => {
    setIsRunning(true);
    const results = [];
    try {
      results.push({
        name: "Connessione Internet",
        status: navigator.onLine ? "success" : "error",
        message: navigator.onLine ? "Connessione attiva" : "Nessuna connessione"
      });
      try {
        localStorage.setItem("test", "test");
        localStorage.removeItem("test");
        results.push({
          name: "Local Storage",
          status: "success",
          message: "Funzionante"
        });
      } catch {
        results.push({
          name: "Local Storage",
          status: "error",
          message: "Non disponibile"
        });
      }
      const swSupported = "serviceWorker" in navigator;
      results.push({
        name: "Service Worker",
        status: swSupported ? "success" : "warning",
        message: swSupported ? "Supportato" : "Non supportato"
      });
      const pushSupported = "PushManager" in window && "Notification" in window;
      results.push({
        name: "Push Notifications",
        status: pushSupported ? "success" : "warning",
        message: pushSupported ? "Supportate" : "Non supportate"
      });
      try {
        const canvas = document.createElement("canvas");
        const gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        results.push({
          name: "WebGL",
          status: gl ? "success" : "warning",
          message: gl ? "Supportato" : "Non supportato"
        });
      } catch {
        results.push({
          name: "WebGL",
          status: "warning",
          message: "Non supportato"
        });
      }
      results.push({
        name: "Geolocalizzazione",
        status: "geolocation" in navigator ? "success" : "warning",
        message: "geolocation" in navigator ? "Disponibile" : "Non disponibile"
      });
      setDiagnostics(results);
      setLastRun(/* @__PURE__ */ new Date());
      toast({
        title: " Diagnostica completata",
        description: "Tutti i test sono stati eseguiti con successo."
      });
    } catch (error) {
      toast({
        title: " Errore diagnostica",
        description: "Si  verificato un errore durante i test.",
        variant: "destructive"
      });
    } finally {
      setIsRunning(false);
    }
  };
  const downloadReport = () => {
    const report = {
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      user_id: user?.id,
      diagnostics,
      browser: navigator.userAgent,
      platform: navigator.platform,
      language: navigator.language
    };
    const blob = new Blob([JSON.stringify(report, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `m1ssion-diagnostics-${Date.now()}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    toast({
      title: " Report scaricato",
      description: "Il report diagnostico  stato scaricato."
    });
  };
  const getStatusIcon = (status) => {
    switch (status) {
      case "success":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-emerald-400" });
      case "warning":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4 text-amber-400" });
      case "error":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-4 h-4 text-red-400" });
    }
  };
  const getStatusColor = (status) => {
    switch (status) {
      case "success":
        return "border-emerald-500/30 bg-emerald-500/10";
      case "warning":
        return "border-amber-500/30 bg-amber-500/10";
      case "error":
        return "border-red-500/30 bg-red-500/10";
    }
  };
  reactExports.useEffect(() => {
    runDiagnostics();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      className: "max-w-4xl mx-auto p-6 space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold text-white mb-2", children: "Diagnostica Sistema" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Verifica il funzionamento dei componenti dell'applicazione" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-5 h-5 mr-2 text-blue-400" }),
            "Panoramica Sistema"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card border-blue-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Monitor, { className: "w-6 h-6 mx-auto mb-2 text-blue-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white", children: "Browser" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/70", children: navigator.userAgent.split(" ")[0] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card border-purple-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Server, { className: "w-6 h-6 mx-auto mb-2 text-purple-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white", children: "Platform" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/70", children: navigator.platform })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card border-emerald-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Wifi, { className: "w-6 h-6 mx-auto mb-2 text-emerald-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white", children: "Online" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/70", children: navigator.onLine ? "S" : "No" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card border-amber-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-6 h-6 mx-auto mb-2 text-amber-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white", children: "Storage" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/70", children: "Disponibile" })
            ] })
          ] }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-5 h-5 mr-2 text-green-400" }),
                "Test Diagnostici"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Button,
                  {
                    onClick: downloadReport,
                    variant: "outline",
                    size: "sm",
                    disabled: diagnostics.length === 0,
                    className: "bg-white/5 border-white/20 text-white hover:bg-white/10",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Download, { className: "w-4 h-4 mr-2" }),
                      "Scarica Report"
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Button,
                  {
                    onClick: runDiagnostics,
                    disabled: isRunning,
                    size: "sm",
                    className: "bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: `w-4 h-4 mr-2 ${isRunning ? "animate-spin" : ""}` }),
                      isRunning ? "Esecuzione..." : "Esegui Test"
                    ]
                  }
                )
              ] })
            ] }),
            lastRun && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
              "Ultimo aggiornamento: ",
              lastRun.toLocaleString("it-IT")
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: diagnostics.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-12 h-12 mx-auto mb-4 text-white/50" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Esegui la diagnostica per vedere i risultati" })
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: diagnostics.map((diagnostic, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, x: -20 },
              animate: { opacity: 1, x: 0 },
              transition: { delay: index * 0.1 },
              className: `p-4 rounded-lg border ${getStatusColor(diagnostic.status)}`,
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  getStatusIcon(diagnostic.status),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: diagnostic.name }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: diagnostic.message }),
                    diagnostic.details && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/50 text-xs mt-1", children: diagnostic.details })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Badge,
                  {
                    variant: diagnostic.status === "success" ? "default" : "destructive",
                    className: diagnostic.status === "success" ? "bg-emerald-500/20 text-emerald-400 border-emerald-500/30" : diagnostic.status === "warning" ? "bg-amber-500/20 text-amber-400 border-amber-500/30" : "bg-red-500/20 text-red-400 border-red-500/30",
                    children: diagnostic.status === "success" ? "OK" : diagnostic.status === "warning" ? "WARN" : "ERROR"
                  }
                )
              ] })
            },
            index
          )) }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Battery, { className: "w-5 h-5 mr-2 text-yellow-400" }),
            "Informazioni Performance"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 glass-card border-yellow-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium mb-2", children: "Memoria" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
                "Heap: ",
                performance.memory ? `${Math.round(performance.memory.usedJSHeapSize / 1024 / 1024)}MB` : "N/A"
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 glass-card border-blue-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium mb-2", children: "Connection" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
                "Tipo: ",
                navigator.connection?.effectiveType || "Sconosciuto"
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 glass-card border-purple-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium mb-2", children: "Hardware" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
                "CPU: ",
                navigator.hardwareConcurrency || "N/A",
                " core"
              ] })
            ] })
          ] }) })
        ] })
      ]
    }
  );
};

const PrivacyPermissionsSettings = () => {
  useAuth();
  const { toast } = useToast();
  const [permissions, setPermissions] = reactExports.useState([]);
  const [privacySettings, setPrivacySettings] = reactExports.useState({
    analytics: true,
    location_tracking: false,
    data_sharing: false,
    marketing_communications: false
  });
  const checkPermissions = async () => {
    const permissionList = [
      {
        name: "notifications",
        status: "unknown",
        description: "Mostra notifiche push per aggiornamenti importanti",
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4" }),
        required: false
      },
      {
        name: "geolocation",
        status: "unknown",
        description: "Accesso alla posizione per funzionalit di mapping",
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-4 h-4" }),
        required: true
      },
      {
        name: "camera",
        status: "unknown",
        description: "Scansione QR code e caricamento foto",
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Camera, { className: "w-4 h-4" }),
        required: false
      },
      {
        name: "microphone",
        status: "unknown",
        description: "Registrazione audio per feedback vocali",
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Mic, { className: "w-4 h-4" }),
        required: false
      }
    ];
    if ("Notification" in window) {
      permissionList[0].status = Notification.permission;
    }
    if ("permissions" in navigator) {
      try {
        for (let i = 1; i < permissionList.length; i++) {
          const permission = permissionList[i];
          const result = await navigator.permissions.query({ name: permission.name });
          permission.status = result.state;
        }
      } catch (error) {
      }
    }
    setPermissions(permissionList);
  };
  const requestPermission = async (permissionName) => {
    try {
      let granted = false;
      switch (permissionName) {
        case "notifications":
          if ("Notification" in window) {
            const result = await Notification.requestPermission();
            granted = result === "granted";
          }
          break;
        case "geolocation":
          if ("geolocation" in navigator) {
            await new Promise((resolve, reject) => {
              navigator.geolocation.getCurrentPosition(resolve, reject);
            });
            granted = true;
          }
          break;
        case "camera":
          if ("mediaDevices" in navigator) {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            stream.getTracks().forEach((track) => track.stop());
            granted = true;
          }
          break;
        case "microphone":
          if ("mediaDevices" in navigator) {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            stream.getTracks().forEach((track) => track.stop());
            granted = true;
          }
          break;
      }
      if (granted) {
        toast({
          title: " Permesso concesso",
          description: "Il permesso  stato concesso con successo."
        });
        checkPermissions();
      }
    } catch (error) {
      toast({
        title: " Permesso negato",
        description: "Il permesso  stato negato o si  verificato un errore.",
        variant: "destructive"
      });
    }
  };
  const updatePrivacySetting = (key, value) => {
    setPrivacySettings((prev) => ({ ...prev, [key]: value }));
    toast({
      title: " Impostazione aggiornata",
      description: "Le tue preferenze privacy sono state salvate."
    });
  };
  const getStatusIcon = (status) => {
    switch (status) {
      case "granted":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-emerald-400" });
      case "denied":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4 text-red-400" });
      default:
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-4 h-4 text-amber-400" });
    }
  };
  const getStatusColor = (status) => {
    switch (status) {
      case "granted":
        return "border-emerald-500/30 bg-emerald-500/10";
      case "denied":
        return "border-red-500/30 bg-red-500/10";
      default:
        return "border-amber-500/30 bg-amber-500/10";
    }
  };
  reactExports.useEffect(() => {
    checkPermissions();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      className: "max-w-4xl mx-auto p-6 space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold text-white mb-2", children: "Privacy & Permessi" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci i permessi dell'app e le impostazioni sulla privacy" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 mr-2 text-blue-400" }),
              "Permessi Sistema"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: checkPermissions,
                variant: "outline",
                size: "sm",
                className: "bg-white/5 border-white/20 text-white hover:bg-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 mr-2" }),
                  "Aggiorna"
                ]
              }
            )
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: permissions.map((permission, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, x: -20 },
              animate: { opacity: 1, x: 0 },
              transition: { delay: index * 0.1 },
              className: `p-4 rounded-lg border ${getStatusColor(permission.status)}`,
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  permission.icon,
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium capitalize", children: permission.name.replace("_", " ") }),
                      permission.required && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "destructive", className: "text-xs", children: "Richiesto" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: permission.description })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  getStatusIcon(permission.status),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Badge,
                    {
                      variant: permission.status === "granted" ? "default" : "destructive",
                      className: permission.status === "granted" ? "bg-emerald-500/20 text-emerald-400 border-emerald-500/30" : permission.status === "denied" ? "bg-red-500/20 text-red-400 border-red-500/30" : "bg-amber-500/20 text-amber-400 border-amber-500/30",
                      children: permission.status
                    }
                  ),
                  permission.status !== "granted" && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => requestPermission(permission.name),
                      size: "sm",
                      className: "bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",
                      children: "Concedi"
                    }
                  )
                ] })
              ] })
            },
            permission.name
          )) }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-5 h-5 mr-2 text-purple-400" }),
            "Impostazioni Privacy"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Analisi e Miglioramento" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Condividi dati anonimi per migliorare l'esperienza dell'app" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: privacySettings.analytics,
                  onCheckedChange: (value) => updatePrivacySetting("analytics", value)
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Tracciamento Posizione" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Memorizza la cronologia delle posizioni per funzionalit avanzate" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: privacySettings.location_tracking,
                  onCheckedChange: (value) => updatePrivacySetting("location_tracking", value)
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Condivisione Dati" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Condividi dati con partner fidati per offerte personalizzate" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: privacySettings.data_sharing,
                  onCheckedChange: (value) => updatePrivacySetting("data_sharing", value)
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Comunicazioni Marketing" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Ricevi email promozionali e aggiornamenti sui prodotti" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: privacySettings.marketing_communications,
                  onCheckedChange: (value) => updatePrivacySetting("marketing_communications", value)
                }
              )
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-5 h-5 mr-2 text-amber-400" }),
            "Gestione Dati"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "outline",
                className: "bg-white/5 border-white/20 text-white hover:bg-white/10 p-4 h-auto flex-col",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Share2, { className: "w-6 h-6 mb-2" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Esporta Dati" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/70", children: "Scarica tutti i tuoi dati" })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "outline",
                className: "bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20 p-4 h-auto flex-col",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-6 h-6 mb-2" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Elimina Account" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-red-300/70", children: "Rimuovi permanentemente" })
                ]
              }
            )
          ] }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "glass-card border-blue-500/30 bg-blue-500/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "pt-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-5 h-5 text-blue-400 mt-0.5" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Protezione dei Dati" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "I tuoi dati sono protetti con crittografia end-to-end e non vengono mai venduti a terze parti. Rispettiamo il GDPR e offriamo pieno controllo sui tuoi dati personali." })
          ] })
        ] }) }) })
      ]
    }
  );
};

const SubscriptionHeader = () => {
  useWouterNavigation();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "w-full py-8", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-3 px-4 text-center bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent", children: "Scegli il Tuo Piano" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-base text-white/70 mb-8 px-4 text-center max-w-2xl mx-auto", children: "Sblocca pi indizi e aumenta le tue possibilit di vittoria con i nostri pacchetti premium." })
  ] });
};

const SubscriptionCard = ({
  title,
  price,
  period,
  features,
  isPopular,
  ctaText,
  type,
  isActive = false,
  onClick
}) => {
  const getGradient = () => {
    switch (type) {
      case "Base":
        return "from-green-400 to-green-600";
      case "Silver":
        return "from-gray-400 to-gray-600";
      case "Gold":
        return "from-amber-400 to-amber-600";
      case "Black":
        return "from-gray-900 to-gray-700";
      case "Titanium":
        return "from-purple-500 to-cyan-500";
      default:
        return "from-blue-500 to-cyan-600";
    }
  };
  const getBadgeColor = () => {
    switch (type) {
      case "Base":
        return "bg-green-500";
      case "Silver":
        return "bg-gray-500";
      case "Gold":
        return "bg-amber-500";
      case "Black":
        return "bg-gray-900";
      case "Titanium":
        return "bg-gradient-to-r from-purple-500 to-cyan-500";
      default:
        return "bg-blue-500";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: cn(
        "relative glass-card p-6",
        isActive ? "ring-2 ring-cyan-500" : "transition-all duration-300 hover:scale-102",
        isPopular && !isActive && "transform scale-105 z-10",
        type === "Titanium" && isActive ? "shadow-[0_0_30px_rgba(168,85,247,0.4)]" : type === "Titanium" && !isActive && "shadow-[0_0_30px_rgba(168,85,247,0.4)] hover:shadow-[0_0_40px_rgba(168,85,247,0.6)]"
      ),
      "data-plan": type,
      style: isActive ? {
        animation: "none !important",
        transition: "none !important",
        pointerEvents: type === "Titanium" ? "auto" : "auto"
      } : {},
      children: [
        isPopular && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "absolute -top-2 right-6 bg-gradient-to-r from-indigo-500 to-purple-600", children: "Pi popolare" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold mb-2", children: title }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-3xl font-bold", children: price }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-gray-400", children: [
            "/",
            period
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-2 mb-6", children: features.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { className: "flex items-start", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `inline-flex items-center justify-center w-5 h-5 rounded-full mr-2 mt-0.5 bg-gradient-to-r ${getGradient()} flex-shrink-0`, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "h-3 w-3 text-white" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: feature.text })
        ] }, index)) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: () => {
              if (onClick && !isActive) {
                onClick();
              }
            },
            disabled: isActive,
            className: cn(
              "w-full font-semibold",
              isActive ? "bg-gradient-to-r from-cyan-600 to-cyan-800 cursor-not-allowed opacity-75" : `bg-gradient-to-r ${getGradient()} transition-all duration-200 hover:scale-102 active:scale-98 cursor-pointer`,
              type === "Titanium" && !isActive && "shadow-[0_0_20px_rgba(168,85,247,0.3)] hover:shadow-[0_0_30px_rgba(168,85,247,0.5)]"
            ),
            style: isActive ? {
              animation: "none !important",
              transition: "none !important"
            } : {},
            children: ctaText
          }
        ),
        isActive && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: `mt-2 w-full flex justify-center ${getBadgeColor()}`, children: "Attualmente attivo" })
      ]
    }
  );
};

var CHECKBOX_NAME = "Checkbox";
var [createCheckboxContext] = createContextScope$2(CHECKBOX_NAME);
var [CheckboxProviderImpl, useCheckboxContext] = createCheckboxContext(CHECKBOX_NAME);
function CheckboxProvider(props) {
  const {
    __scopeCheckbox,
    checked: checkedProp,
    children,
    defaultChecked,
    disabled,
    form,
    name,
    onCheckedChange,
    required,
    value = "on",
    // @ts-expect-error
    internal_do_not_use_render
  } = props;
  const [checked, setChecked] = useControllableState({
    prop: checkedProp,
    defaultProp: defaultChecked ?? false,
    onChange: onCheckedChange,
    caller: CHECKBOX_NAME
  });
  const [control, setControl] = reactExports.useState(null);
  const [bubbleInput, setBubbleInput] = reactExports.useState(null);
  const hasConsumerStoppedPropagationRef = reactExports.useRef(false);
  const isFormControl = control ? !!form || !!control.closest("form") : (
    // We set this to true by default so that events bubble to forms without JS (SSR)
    true
  );
  const context = {
    checked,
    disabled,
    setChecked,
    control,
    setControl,
    name,
    form,
    value,
    hasConsumerStoppedPropagationRef,
    required,
    defaultChecked: isIndeterminate(defaultChecked) ? false : defaultChecked,
    isFormControl,
    bubbleInput,
    setBubbleInput
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    CheckboxProviderImpl,
    {
      scope: __scopeCheckbox,
      ...context,
      children: isFunction(internal_do_not_use_render) ? internal_do_not_use_render(context) : children
    }
  );
}
var TRIGGER_NAME = "CheckboxTrigger";
var CheckboxTrigger = reactExports.forwardRef(
  ({ __scopeCheckbox, onKeyDown, onClick, ...checkboxProps }, forwardedRef) => {
    const {
      control,
      value,
      disabled,
      checked,
      required,
      setControl,
      setChecked,
      hasConsumerStoppedPropagationRef,
      isFormControl,
      bubbleInput
    } = useCheckboxContext(TRIGGER_NAME, __scopeCheckbox);
    const composedRefs = useComposedRefs(forwardedRef, setControl);
    const initialCheckedStateRef = reactExports.useRef(checked);
    reactExports.useEffect(() => {
      const form = control?.form;
      if (form) {
        const reset = () => setChecked(initialCheckedStateRef.current);
        form.addEventListener("reset", reset);
        return () => form.removeEventListener("reset", reset);
      }
    }, [control, setChecked]);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.button,
      {
        type: "button",
        role: "checkbox",
        "aria-checked": isIndeterminate(checked) ? "mixed" : checked,
        "aria-required": required,
        "data-state": getState(checked),
        "data-disabled": disabled ? "" : void 0,
        disabled,
        value,
        ...checkboxProps,
        ref: composedRefs,
        onKeyDown: composeEventHandlers(onKeyDown, (event) => {
          if (event.key === "Enter") event.preventDefault();
        }),
        onClick: composeEventHandlers(onClick, (event) => {
          setChecked((prevChecked) => isIndeterminate(prevChecked) ? true : !prevChecked);
          if (bubbleInput && isFormControl) {
            hasConsumerStoppedPropagationRef.current = event.isPropagationStopped();
            if (!hasConsumerStoppedPropagationRef.current) event.stopPropagation();
          }
        })
      }
    );
  }
);
CheckboxTrigger.displayName = TRIGGER_NAME;
var Checkbox$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeCheckbox,
      name,
      checked,
      defaultChecked,
      required,
      disabled,
      value,
      onCheckedChange,
      form,
      ...checkboxProps
    } = props;
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      CheckboxProvider,
      {
        __scopeCheckbox,
        checked,
        defaultChecked,
        disabled,
        required,
        onCheckedChange,
        name,
        form,
        value,
        internal_do_not_use_render: ({ isFormControl }) => /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            CheckboxTrigger,
            {
              ...checkboxProps,
              ref: forwardedRef,
              __scopeCheckbox
            }
          ),
          isFormControl && /* @__PURE__ */ jsxRuntimeExports.jsx(
            CheckboxBubbleInput,
            {
              __scopeCheckbox
            }
          )
        ] })
      }
    );
  }
);
Checkbox$1.displayName = CHECKBOX_NAME;
var INDICATOR_NAME = "CheckboxIndicator";
var CheckboxIndicator = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeCheckbox, forceMount, ...indicatorProps } = props;
    const context = useCheckboxContext(INDICATOR_NAME, __scopeCheckbox);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Presence,
      {
        present: forceMount || isIndeterminate(context.checked) || context.checked === true,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Primitive$3.span,
          {
            "data-state": getState(context.checked),
            "data-disabled": context.disabled ? "" : void 0,
            ...indicatorProps,
            ref: forwardedRef,
            style: { pointerEvents: "none", ...props.style }
          }
        )
      }
    );
  }
);
CheckboxIndicator.displayName = INDICATOR_NAME;
var BUBBLE_INPUT_NAME = "CheckboxBubbleInput";
var CheckboxBubbleInput = reactExports.forwardRef(
  ({ __scopeCheckbox, ...props }, forwardedRef) => {
    const {
      control,
      hasConsumerStoppedPropagationRef,
      checked,
      defaultChecked,
      required,
      disabled,
      name,
      value,
      form,
      bubbleInput,
      setBubbleInput
    } = useCheckboxContext(BUBBLE_INPUT_NAME, __scopeCheckbox);
    const composedRefs = useComposedRefs(forwardedRef, setBubbleInput);
    const prevChecked = usePrevious(checked);
    const controlSize = useSize(control);
    reactExports.useEffect(() => {
      const input = bubbleInput;
      if (!input) return;
      const inputProto = window.HTMLInputElement.prototype;
      const descriptor = Object.getOwnPropertyDescriptor(
        inputProto,
        "checked"
      );
      const setChecked = descriptor.set;
      const bubbles = !hasConsumerStoppedPropagationRef.current;
      if (prevChecked !== checked && setChecked) {
        const event = new Event("click", { bubbles });
        input.indeterminate = isIndeterminate(checked);
        setChecked.call(input, isIndeterminate(checked) ? false : checked);
        input.dispatchEvent(event);
      }
    }, [bubbleInput, prevChecked, checked, hasConsumerStoppedPropagationRef]);
    const defaultCheckedRef = reactExports.useRef(isIndeterminate(checked) ? false : checked);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.input,
      {
        type: "checkbox",
        "aria-hidden": true,
        defaultChecked: defaultChecked ?? defaultCheckedRef.current,
        required,
        disabled,
        name,
        value,
        form,
        ...props,
        tabIndex: -1,
        ref: composedRefs,
        style: {
          ...props.style,
          ...controlSize,
          position: "absolute",
          pointerEvents: "none",
          opacity: 0,
          margin: 0,
          // We transform because the input is absolutely positioned but we have
          // rendered it **after** the button. This pulls it back to sit on top
          // of the button.
          transform: "translateX(-100%)"
        }
      }
    );
  }
);
CheckboxBubbleInput.displayName = BUBBLE_INPUT_NAME;
function isFunction(value) {
  return typeof value === "function";
}
function isIndeterminate(checked) {
  return checked === "indeterminate";
}
function getState(checked) {
  return isIndeterminate(checked) ? "indeterminate" : checked ? "checked" : "unchecked";
}

const Checkbox = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Checkbox$1,
  {
    ref,
    className: cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    ),
    ...props,
    children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      CheckboxIndicator,
      {
        className: cn("flex items-center justify-center text-current"),
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "h-4 w-4" })
      }
    )
  }
));
Checkbox.displayName = Checkbox$1.displayName;

getStripeSafe();
const AddCardDialog = ({
  onClose,
  onAddCard,
  loading
}) => {
  const [submitting, setSubmitting] = reactExports.useState(false);
  const [error, setError] = reactExports.useState(null);
  const [cardData, setCardData] = reactExports.useState({
    cardNumber: "",
    expiryMonth: "",
    expiryYear: "",
    cvc: "",
    nameOnCard: "",
    saveForFuture: true
  });
  const formatCardNumber = reactExports.useCallback((value) => {
    const v = value.replace(/\s+/g, "").replace(/[^0-9]/gi, "");
    const matches = v.match(/\d{4,16}/g);
    const match = matches && matches[0] || "";
    let parts = [];
    for (let i = 0, len = match.length; i < len; i += 4) {
      const part = match.substring(i, i + 4);
      parts = [...parts, part];
    }
    return parts.length ? parts.join(" ") : v;
  }, []);
  const handleCardNumberChange = reactExports.useCallback((e) => {
    const formatted = formatCardNumber(e.target.value);
    setCardData((prev) => ({ ...prev, cardNumber: formatted }));
    setError(null);
  }, [formatCardNumber]);
  const getBrandFromNumber = reactExports.useCallback((number) => {
    const clean = number.replace(/\s/g, "");
    if (clean.startsWith("4")) return "Visa";
    if (clean.startsWith("5") || clean.startsWith("2")) return "Mastercard";
    if (clean.startsWith("3")) return "American Express";
    if (clean.startsWith("6")) return "Discover";
    return "Unknown";
  }, []);
  const validateForm = reactExports.useCallback(() => {
    const { cardNumber, expiryMonth, expiryYear, cvc, nameOnCard } = cardData;
    if (!cardNumber || cardNumber.replace(/\s/g, "").length < 13) {
      return "Numero carta non valido (minimo 13 cifre)";
    }
    if (!expiryMonth || parseInt(expiryMonth) < 1 || parseInt(expiryMonth) > 12) {
      return "Mese di scadenza non valido (01-12)";
    }
    const currentYear = (/* @__PURE__ */ new Date()).getFullYear();
    const currentMonth = (/* @__PURE__ */ new Date()).getMonth() + 1;
    const expYear = parseInt(expiryYear);
    const expMonth = parseInt(expiryMonth);
    if (!expiryYear || expYear < currentYear || expYear === currentYear && expMonth < currentMonth) {
      return "Data di scadenza non valida (carta scaduta)";
    }
    if (!cvc || cvc.length < 3) {
      return "CVC non valido (minimo 3 cifre)";
    }
    if (!nameOnCard || nameOnCard.trim().length < 2) {
      return "Nome sulla carta richiesto (minimo 2 caratteri)";
    }
    return null;
  }, [cardData]);
  const createStripeValidation = async () => {
    try {
      const cleanCardNumber = cardData.cardNumber.replace(/\s/g, "");
      let sum = 0;
      let isEven = false;
      for (let i = cleanCardNumber.length - 1; i >= 0; i--) {
        let digit = parseInt(cleanCardNumber[i]);
        if (isEven) {
          digit *= 2;
          if (digit > 9) digit -= 9;
        }
        sum += digit;
        isEven = !isEven;
      }
      if (sum % 10 !== 0) {
        throw new Error("Numero carta non valido");
      }
      const validatedToken = {
        id: `pm_validated_${Math.random().toString(36).substring(2, 15)}`,
        card: {
          brand: getBrandFromNumber(cardData.cardNumber).toLowerCase(),
          last4: cleanCardNumber.slice(-4),
          exp_month: parseInt(cardData.expiryMonth),
          exp_year: parseInt(cardData.expiryYear)
        }
      };
      return validatedToken;
    } catch (error2) {
      throw error2;
    }
  };
  const handleSubmit = async (e) => {
    e.preventDefault();
    const validationError = validateForm();
    if (validationError) {
      setError(validationError);
      ue.error("Dati non validi", { description: validationError });
      return;
    }
    setSubmitting(true);
    setError(null);
    try {
      const brand = getBrandFromNumber(cardData.cardNumber);
      const last4 = cardData.cardNumber.replace(/\s/g, "").slice(-4);
      const validatedToken = await createStripeValidation();
      await onAddCard({
        ...cardData,
        stripeToken: validatedToken.id
      });
      ue.success(" Carta aggiunta", {
        description: `${brand} ${last4} salvata correttamente`
      });
      onClose();
    } catch (error2) {
      const errorMessage = error2 instanceof Error ? error2.message : "Errore durante il salvataggio";
      setError(errorMessage);
      ue.error(" Errore salvataggio", {
        description: errorMessage.includes("Invalid") ? "Dati carta non validi" : "Impossibile salvare la carta. Riprova."
      });
    } finally {
      setSubmitting(false);
    }
  };
  const handleClose = reactExports.useCallback(() => {
    if (!submitting) {
      onClose();
    }
  }, [submitting, onClose]);
  const isFormValid = validateForm() === null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { opacity: 0, scale: 0.95, y: 20 },
      animate: { opacity: 1, scale: 1, y: 0 },
      exit: { opacity: 0, scale: 0.95, y: 20 },
      className: "w-full max-w-md",
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-[#131524] to-[#1a1d3a] border-[#00D1FF]/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between text-white", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CreditCard, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            "Aggiungi Nuova Carta"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              variant: "ghost",
              size: "icon",
              onClick: handleClose,
              disabled: submitting,
              className: "text-white hover:bg-white/10 h-8 w-8",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "h-4 w-4" })
            }
          )
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
          error && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-red-900/30 border border-red-500/40 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-4 h-4 text-red-400 mt-0.5 flex-shrink-0" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-200 text-sm font-medium", children: "Errore" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300/90 text-xs", children: error })
            ] })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cardNumber", className: "text-white text-sm", children: " Numero Carta" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  id: "cardNumber",
                  type: "text",
                  value: cardData.cardNumber,
                  onChange: handleCardNumberChange,
                  placeholder: "1234 5678 9012 3456",
                  maxLength: 19,
                  autoFocus: true,
                  disabled: submitting,
                  className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 font-mono",
                  required: true
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "expiryMonth", className: "text-white text-xs", children: "Mese" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Input,
                  {
                    id: "expiryMonth",
                    type: "text",
                    value: cardData.expiryMonth,
                    onChange: (e) => {
                      const value = e.target.value.replace(/\D/g, "");
                      if (value.length <= 2 && (value === "" || parseInt(value) >= 1 && parseInt(value) <= 12)) {
                        setCardData((prev) => ({ ...prev, expiryMonth: value }));
                        setError(null);
                      }
                    },
                    placeholder: "MM",
                    maxLength: 2,
                    disabled: submitting,
                    className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 text-center font-mono",
                    required: true
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "expiryYear", className: "text-white text-xs", children: "Anno" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Input,
                  {
                    id: "expiryYear",
                    type: "text",
                    value: cardData.expiryYear,
                    onChange: (e) => {
                      const value = e.target.value.replace(/\D/g, "");
                      if (value.length <= 4) {
                        setCardData((prev) => ({ ...prev, expiryYear: value }));
                        setError(null);
                      }
                    },
                    placeholder: "YYYY",
                    maxLength: 4,
                    disabled: submitting,
                    className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 text-center font-mono",
                    required: true
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cvc", className: "text-white text-xs", children: "CVC" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Input,
                  {
                    id: "cvc",
                    type: "password",
                    value: cardData.cvc,
                    onChange: (e) => {
                      const value = e.target.value.replace(/\D/g, "");
                      if (value.length <= 4) {
                        setCardData((prev) => ({ ...prev, cvc: value }));
                        setError(null);
                      }
                    },
                    placeholder: "123",
                    maxLength: 4,
                    disabled: submitting,
                    className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 text-center font-mono",
                    required: true
                  }
                )
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "nameOnCard", className: "text-white text-sm", children: " Nome sulla Carta" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  id: "nameOnCard",
                  type: "text",
                  value: cardData.nameOnCard,
                  onChange: (e) => {
                    setCardData((prev) => ({ ...prev, nameOnCard: e.target.value.toUpperCase() }));
                    setError(null);
                  },
                  placeholder: "MARIO ROSSI",
                  disabled: submitting,
                  className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 uppercase",
                  required: true
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-[#00D1FF]/10 border border-[#00D1FF]/30 rounded-lg p-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Checkbox,
                {
                  id: "saveForFuture",
                  checked: cardData.saveForFuture,
                  onCheckedChange: (checked) => {
                    setCardData((prev) => ({ ...prev, saveForFuture: !!checked }));
                  },
                  disabled: submitting,
                  className: "border-[#00D1FF]/50 data-[state=checked]:bg-[#00D1FF] data-[state=checked]:border-[#00D1FF]"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "saveForFuture", className: "text-[#00D1FF] text-sm cursor-pointer", children: " Salva per pagamenti futuri" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-xs", children: "Sicuro e crittografato tramite Stripe PCI DSS" })
              ] })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-green-900/20 border border-green-500/30 rounded-lg p-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-4 h-4 text-green-400 mt-0.5 flex-shrink-0" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-green-100", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs font-semibold mb-1 flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-3 h-3 mr-1" }),
                  "Sicurezza PCI DSS Level 1"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-green-200/90 text-xs", children: "Dati tokenizzati via Stripe. M1SSION non memorizza mai numeri completi." })
              ] })
            ] }) }),
            cardData.cardNumber && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center px-2 py-1 bg-white/10 rounded text-xs", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(CreditCard, { className: "w-3 h-3 mr-1 text-[#00D1FF]" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white/80", children: [
                getBrandFromNumber(cardData.cardNumber),
                " Rilevata"
              ] })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex space-x-3 pt-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  type: "button",
                  variant: "outline",
                  onClick: handleClose,
                  disabled: submitting,
                  className: "flex-1 border-white/40 text-white hover:bg-white/10 h-11",
                  children: "Annulla"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  type: "submit",
                  disabled: submitting || !isFormValid,
                  className: "flex-1 bg-[#00D1FF] hover:bg-[#00B8E6] text-black font-semibold h-11 disabled:opacity-50 disabled:cursor-not-allowed",
                  children: submitting ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin mr-2" }),
                    "Salvando..."
                  ] }) : "Salva Carta"
                }
              )
            ] })
          ] })
        ] })
      ] })
    }
  ) }) });
};

function useStripeMode() {
  const [mode, setMode] = reactExports.useState("unknown");
  const [loading, setLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const [keyPrefix, setKeyPrefix] = reactExports.useState();
  const [hasKey, setHasKey] = reactExports.useState();
  const fetchStripeMode = async () => {
    try {
      setLoading(true);
      setError(null);
      const { data, error: supabaseError } = await supabase.functions.invoke("stripe-mode", {
        method: "POST"
      });
      if (supabaseError) {
        setError(supabaseError.message);
        setMode("unknown");
        return;
      }
      const response = data;
      setMode(response.mode || "unknown");
      setKeyPrefix(response.keyPrefix);
      setHasKey(response.hasKey);
    } catch (err) {
      setError(err instanceof Error ? err.message : "Unknown error");
      setMode("unknown");
    } finally {
      setLoading(false);
    }
  };
  reactExports.useEffect(() => {
    fetchStripeMode();
  }, []);
  return {
    mode,
    loading,
    error,
    keyPrefix,
    hasKey,
    refresh: fetchStripeMode
  };
}

const SavedCardPayment = ({
  config,
  onSuccess,
  onCancel
}) => {
  const [savedCard, setSavedCard] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(false);
  const [showAddCard, setShowAddCard] = reactExports.useState(false);
  const [useManualEntry, setUseManualEntry] = reactExports.useState(false);
  const { user, isLoading: authLoading } = useAuthContext();
  useStripeMode();
  reactExports.useEffect(() => {
    if (!authLoading && !user) {
      ue.error("Devi accedere per effettuare pagamenti. Reindirizzamento al login...");
      try {
        localStorage.setItem("post_login_redirect", window.location.pathname);
      } catch (e) {
      }
      setTimeout(() => {
        onCancel();
        window.location.href = "/login";
      }, 1500);
    }
  }, [user, authLoading, onCancel]);
  reactExports.useEffect(() => {
    const loadDefaultCard = async () => {
      if (!user) return;
      try {
        const { data, error } = await supabase.from("user_payment_methods").select("*").eq("user_id", user.id).eq("is_default", true).order("created_at", { ascending: false }).limit(1).maybeSingle();
        if (error) {
          return;
        }
        if (data) {
          setSavedCard(data);
        } else {
        }
      } catch (error) {
      }
    };
    loadDefaultCard();
  }, [user]);
  const processPaymentWithSavedCard = async () => {
    if (!savedCard || !user) return;
    setLoading(true);
    try {
      const { data, error } = await supabase.functions.invoke("create-payment-intent", {
        body: {
          amount: config.amount,
          // Already in cents
          currency: "eur",
          payment_type: "buzz_map",
          plan: "one_time"
        }
      });
      if (error) {
        if (error.code === "not_authenticated" || error.message?.includes("401")) {
          ue.error("Devi accedere per effettuare pagamenti. Reindirizzamento al login...");
          try {
            localStorage.setItem("post_login_redirect", window.location.pathname);
          } catch (e) {
          }
          setTimeout(() => {
            window.location.href = "/login";
          }, 1500);
          return;
        } else if (error.code === "card_declined") {
          ue.error(`Carta rifiutata: ${error.message}`);
          return;
        } else {
          ue.error(`Errore pagamento: ${error.message || "Errore sconosciuto"} (${error.code || "unknown"})`);
          return;
        }
      }
      const clientSecret = data?.client_secret || data?.clientSecret;
      if (clientSecret && savedCard?.stripe_pm_id) {
        const stripe = await (await __vitePreload(async () => { const {getStripeSafe} = await Promise.resolve().then(() => stripeFallback);return { getStripeSafe }},true?void 0:void 0)).getStripeSafe();
        if (!stripe) {
          throw new Error("Stripe non inizializzato");
        }
        const { error: confirmError, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
          payment_method: savedCard.stripe_pm_id
        });
        if (confirmError) {
          throw new Error(confirmError.message || "Errore nella conferma del pagamento");
        }
        if (paymentIntent?.status === "succeeded") {
          window.dispatchEvent(new CustomEvent("paymentIntentSucceeded", {
            detail: { paymentIntentId: paymentIntent.id }
          }));
          onSuccess(paymentIntent.id);
        } else if (paymentIntent?.status === "requires_action") {
          ue.info("Autenticazione aggiuntiva richiesta");
        } else {
          throw new Error(`Stato pagamento non gestito: ${paymentIntent?.status}`);
        }
      } else if (data?.payment_intent_id) {
        onSuccess(data.payment_intent_id);
      }
    } catch (error) {
      ue.error("Errore nel processare il pagamento");
    } finally {
      setLoading(false);
    }
  };
  const getCardIcon = (brand) => {
    const colors = {
      visa: "bg-blue-600",
      mastercard: "bg-red-600",
      amex: "bg-green-600",
      discover: "bg-orange-600",
      default: "bg-gray-600"
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-8 h-6 rounded ${colors[brand.toLowerCase()] || colors.default} flex items-center justify-center text-white text-xs font-bold`, children: brand.slice(0, 2).toUpperCase() });
  };
  const handleCardSaved = async (cardData) => {
    try {
      const { data, error } = await supabase.from("user_payment_methods").insert({
        user_id: user.id,
        stripe_pm_id: cardData.stripeToken || `pm_${Math.random().toString(36).substring(2, 15)}`,
        brand: cardData.cardNumber?.charAt(0) === "4" ? "visa" : "mastercard",
        last4: cardData.cardNumber?.replace(/\s/g, "").slice(-4) || "0000",
        exp_month: parseInt(cardData.expiryMonth),
        exp_year: parseInt(cardData.expiryYear),
        is_default: cardData.saveForFuture || true
      });
      if (error) throw error;
      ue.success("Carta salvata con successo!");
      setShowAddCard(false);
      window.location.reload();
    } catch (error) {
      ue.error("Errore nel salvare la carta");
    }
  };
  if (showAddCard) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      AddCardDialog,
      {
        onClose: () => setShowAddCard(false),
        onAddCard: handleCardSaved,
        loading
      }
    );
  }
  if (useManualEntry || !savedCard) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "w-full max-w-md mx-auto bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30 max-h-[85vh] overflow-y-auto", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-center text-white", children: [
          " ",
          config.type === "subscription" ? `Abbonamento ${config.plan}` : config.type === "buzz_map" ? "BUZZ MAPPA" : "BUZZ Payment"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-300", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-bold", children: [
            "",
            (config.amount / 100).toFixed(2),
            config.type === "subscription" ? "/mese" : ""
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm", children: config.description })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-400", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CreditCard, { className: "w-12 h-12 mx-auto mb-3" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mb-4", children: "Nessuna carta salvata trovata" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: () => setShowAddCard(true),
              className: "w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-2" }),
                "Aggiungi Carta"
              ]
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2 mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "outline",
            onClick: onCancel,
            className: "flex-1",
            children: "Annulla"
          }
        ) })
      ] })
    ] });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "w-full max-w-md mx-auto bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30 max-h-[85vh] overflow-y-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-center text-white", children: [
        " ",
        config.type === "subscription" ? `Abbonamento ${config.plan}` : config.type === "buzz_map" ? "BUZZ MAPPA" : "BUZZ Payment"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-300", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-bold", children: [
          "",
          (config.amount / 100).toFixed(2),
          config.type === "subscription" ? "/mese" : ""
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm", children: config.description })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 bg-gray-800/50 rounded-lg border border-gray-600", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
          getCardIcon(savedCard.brand),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-white font-medium", children: [
              "**** **** **** ",
              savedCard.last4
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-gray-400 text-sm", children: [
              savedCard.brand.charAt(0).toUpperCase() + savedCard.brand.slice(1),
              "  ",
              savedCard.exp_month.toString().padStart(2, "0"),
              "/",
              savedCard.exp_year.toString().slice(-2)
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-green-400 text-sm font-medium", children: " Predefinita" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: processPaymentWithSavedCard,
            disabled: loading,
            className: "w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",
            children: loading ? "Elaborazione..." : `Usa questa carta - ${(config.amount / 100).toFixed(2)}`
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            variant: "outline",
            onClick: () => setShowAddCard(true),
            className: "w-full",
            disabled: loading,
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-2" }),
              "Usa altra carta"
            ]
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "outline",
          onClick: onCancel,
          className: "flex-1",
          disabled: loading,
          children: "Annulla"
        }
      ) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-gray-400 text-center", children: " Pagamento sicuro elaborato da Stripe" })
    ] })
  ] });
};

const stripePromise = getStripeSafe();
const CheckoutForm = ({ config, onSuccess, onCancel }) => {
  const stripe = useStripe();
  const elements = useElements();
  const [loading, setLoading] = reactExports.useState(false);
  const [clientSecret, setClientSecret] = reactExports.useState("");
  const { user } = useAuthContext();
  useStripeMode();
  reactExports.useEffect(() => {
    if (!user) return;
    const createPaymentIntent = async () => {
      try {
        const { data, error } = await supabase.functions.invoke("create-payment-intent", {
          body: {
            amount: config.amount,
            // Already in cents
            currency: "eur",
            payment_type: "buzz_map",
            plan: "one_time"
          }
        });
        if (error) {
          if (error.code === "not_authenticated" || error.message?.includes("401")) {
            ue.error("Devi accedere per effettuare pagamenti. Reindirizzamento al login...");
            try {
              localStorage.setItem("post_login_redirect", window.location.pathname);
            } catch (e) {
            }
            setTimeout(() => {
              window.location.href = "/login";
            }, 1500);
            return;
          } else if (error.code === "card_declined") {
            ue.error(`Carta rifiutata: ${error.message}`);
            return;
          } else if (error.message?.includes("mismatch")) {
            ue.error(`Errore configurazione Stripe: ${error.message}`);
            return;
          } else {
            ue.error(`Errore pagamento: ${error.message || "Errore sconosciuto"} (${error.code || "unknown"})`);
            return;
          }
        }
        const clientSecretValue = data?.client_secret || data?.clientSecret;
        if (clientSecretValue) {
          setClientSecret(clientSecretValue);
        } else {
          ue.error("Errore nella configurazione del pagamento");
          return;
        }
      } catch (error) {
        ue.error("Errore nel sistema di pagamento");
      }
    };
    createPaymentIntent();
  }, [user, config]);
  const handleSubmit = async (event) => {
    event.preventDefault();
    if (!stripe || !elements || !clientSecret) {
      ue.error("Sistema di pagamento non pronto");
      return;
    }
    setLoading(true);
    const cardElement = elements.getElement(CardElement);
    if (!cardElement) {
      ue.error("Elemento carta non trovato");
      setLoading(false);
      return;
    }
    try {
      const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
        payment_method: {
          card: cardElement,
          billing_details: {
            email: user?.email || ""
          }
        }
      });
      if (error) {
        const errorCode = error.code || "unknown";
        const errorMessage = error.message || "Errore sconosciuto";
        ue.error(`Pagamento fallito: ${errorMessage} (${errorCode})`);
      } else if (paymentIntent.status === "succeeded") {
        window.dispatchEvent(new CustomEvent("paymentIntentSucceeded", {
          detail: { paymentIntentId: paymentIntent.id }
        }));
        onSuccess(paymentIntent.id);
      }
    } catch (error) {
      ue.error("Errore nel processare il pagamento");
    } finally {
      setLoading(false);
    }
  };
  const cardElementOptions = {
    style: {
      base: {
        fontSize: "16px",
        color: "#ffffff",
        "::placeholder": {
          color: "#aab7c4"
        },
        backgroundColor: "transparent"
      },
      invalid: {
        color: "#fa755a",
        iconColor: "#fa755a"
      }
    },
    hidePostalCode: true
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "w-full max-w-md mx-auto bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30 max-h-[85vh] overflow-y-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-center text-white", children: [
        " ",
        config.type === "subscription" ? `Abbonamento ${config.plan}` : config.type === "buzz_map" ? "BUZZ MAPPA" : "BUZZ Payment"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-300", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-bold", children: [
          "",
          (config.amount / 100).toFixed(2),
          config.type === "subscription" ? "/mese" : ""
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm", children: config.description })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 bg-gray-800/50 rounded-lg border border-gray-600", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardElement, { options: cardElementOptions }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: "outline",
              onClick: onCancel,
              className: "flex-1",
              disabled: loading,
              children: "Annulla"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "submit",
              disabled: !stripe || loading || !clientSecret,
              className: "flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",
              children: loading ? "Elaborazione..." : `Paga ${(config.amount / 100).toFixed(2)}`
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-gray-400 text-center", children: " Pagamento sicuro elaborato da Stripe" })
    ] })
  ] });
};
const StripeInAppCheckout = ({
  config,
  onSuccess,
  onCancel
}) => {
  const [useSavedCard, setUseSavedCard] = reactExports.useState(false);
  const { user, isLoading: authLoading } = useAuthContext();
  reactExports.useEffect(() => {
    if (!authLoading && !user) {
      ue.error("Devi accedere per effettuare pagamenti. Reindirizzamento al login...");
      try {
        localStorage.setItem("post_login_redirect", window.location.pathname);
      } catch (e) {
      }
      setTimeout(() => {
        onCancel();
        window.location.href = "/login";
      }, 1500);
    }
  }, [user, authLoading, onCancel]);
  reactExports.useEffect(() => {
    const checkDefaultPaymentMethod = async () => {
      if (!user) return;
      try {
        const { data, error } = await supabase.from("user_payment_methods").select("id").eq("user_id", user.id).eq("is_default", true).maybeSingle();
        if (!error && data) {
          setUseSavedCard(true);
        } else {
          setUseSavedCard(false);
        }
      } catch (error) {
        setUseSavedCard(false);
      }
    };
    checkDefaultPaymentMethod();
  }, [user]);
  const options = {
    appearance: {
      theme: "night",
      variables: {
        colorPrimary: "#8b5cf6",
        colorBackground: "#1f2937",
        colorText: "#ffffff",
        colorDanger: "#df1b41",
        fontFamily: "system-ui, sans-serif",
        spacingUnit: "4px",
        borderRadius: "8px"
      }
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: "fixed inset-0 bg-black/95 backdrop-blur-sm flex items-center justify-center p-4 z-[9999] overflow-y-auto",
      style: {
        paddingTop: "calc(env(safe-area-inset-top, 47px) + 20px)",
        paddingBottom: "calc(env(safe-area-inset-bottom, 34px) + 20px)",
        maxHeight: "100dvh"
      },
      children: useSavedCard ? /* @__PURE__ */ jsxRuntimeExports.jsx(
        SavedCardPayment,
        {
          config,
          onSuccess,
          onCancel
        }
      ) : /* @__PURE__ */ jsxRuntimeExports.jsx(Elements, { stripe: stripePromise, options, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        CheckoutForm,
        {
          config,
          onSuccess,
          onCancel
        }
      ) })
    }
  );
};

const EUR_TO_M1U_RATE = 100;
function formatM1U(eurPrice) {
  const m1uValue = Math.round(eurPrice * EUR_TO_M1U_RATE);
  const formatted = new Intl.NumberFormat("it-IT").format(m1uValue);
  return `${formatted} M1U`;
}
function eurToM1U(eurPrice) {
  return Math.round(eurPrice * EUR_TO_M1U_RATE);
}

const PRICING_CONFIG = {
  Base: {
    priceEur: 0,
    priceCents: 0,
    priceM1U: 0,
    displayPrice: "0 M1U",
    label: "Base - Gratis",
    features: [
      "Funzioni base (accesso alla missione con restrizioni)",
      "Supporto email standard",
      "1 indizio settimanale base"
    ],
    limitations: [
      "Nessun accesso anticipato agli eventi",
      "Nessun badge esclusivo"
    ],
    earlyAccess: 0
  },
  Silver: {
    priceEur: 3.99,
    priceCents: 399,
    priceM1U: eurToM1U(3.99),
    displayPrice: formatM1U(3.99),
    label: "Silver",
    features: [
      "Tutti i vantaggi Base",
      "3 indizi premium aggiuntivi a settimana",
      "Accesso anticipato di 2 ore agli eventi",
      "Badge Silver nel profilo"
    ],
    earlyAccess: 2
  },
  Gold: {
    priceEur: 6.99,
    priceCents: 699,
    priceM1U: eurToM1U(6.99),
    displayPrice: formatM1U(6.99),
    label: "Gold",
    features: [
      "Tutti i vantaggi Silver",
      "4 indizi premium aggiuntivi a settimana",
      "Accesso anticipato di 12 ore agli eventi",
      "Partecipazione alle estrazioni Gold",
      "Badge Gold esclusivo nel profilo"
    ],
    earlyAccess: 12
  },
  Black: {
    priceEur: 9.99,
    priceCents: 999,
    priceM1U: eurToM1U(9.99),
    displayPrice: formatM1U(9.99),
    label: "Black",
    features: [
      "Tutti i vantaggi Gold",
      "Accesso VIP anticipato di 24 ore agli eventi",
      "5 indizi premium aggiuntivi a settimana",
      "Badge Black esclusivo"
    ],
    earlyAccess: 24
  },
  Titanium: {
    priceEur: 29.99,
    priceCents: 2999,
    priceM1U: eurToM1U(29.99),
    displayPrice: formatM1U(29.99),
    label: "Titanium",
    features: [
      "Tutti i vantaggi Black",
      "5 indizi premium aggiuntivi a settimana",
      "Accesso VIP anticipato di 48 ore agli eventi",
      "Supporto prioritario dedicato (24/7)",
      "Eventi esclusivi M1SSION",
      "Badge Titanium esclusivo"
    ],
    earlyAccess: 48
  }
};
const getPriceCents = (plan) => {
  const planData = PRICING_CONFIG[plan];
  return planData?.priceCents || 0;
};
const getDisplayPrice = (plan) => {
  const planData = PRICING_CONFIG[plan];
  return planData?.displayPrice || "0.00";
};
const getPriceEur = (plan) => {
  const planData = PRICING_CONFIG[plan];
  return planData?.priceEur || 0;
};

const pricingConfig = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  PRICING_CONFIG,
  getDisplayPrice,
  getPriceCents,
  getPriceEur
}, Symbol.toStringTag, { value: 'Module' }));

const SubscriptionPlans = ({ selected, setSelected }) => {
  const { toast } = useToast();
  useWouterNavigation();
  const { upgradeSubscription } = useProfileSubscription();
  const [showInAppCheckout, setShowInAppCheckout] = reactExports.useState(false);
  const [selectedPlan, setSelectedPlan] = reactExports.useState("");
  React$1.useEffect(() => {
    const handleStripeReturn = async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const isSuccess = urlParams.get("success") === "true";
      const tier = urlParams.get("tier");
      const sessionId = urlParams.get("session_id");
      const isCanceled = urlParams.get("canceled") === "true";
      if (isCanceled) {
        ue.error("Pagamento annullato", {
          description: "Il pagamento  stato annullato",
          duration: 4e3
        });
        window.history.replaceState({}, "", "/subscriptions");
        return;
      }
      if (!isSuccess || !tier) {
        return;
      }
      try {
        const { data: { user }, error: userError } = await supabase.auth.getUser();
        if (userError || !user) {
          return;
        }
        const { data: profileUpdate, error: profileError } = await supabase.from("profiles").update({
          subscription_tier: tier,
          tier,
          updated_at: (/* @__PURE__ */ new Date()).toISOString()
        }).eq("id", user.id).select().single();
        if (profileError) {
        } else {
        }
        const { data: syncResult, error: syncError } = await supabase.functions.invoke("verify-subscription-sync");
        if (syncError) {
        } else {
        }
        const { error: subscriptionError } = await supabase.from("subscriptions").upsert({
          user_id: user.id,
          tier,
          status: "active",
          current_period_start: (/* @__PURE__ */ new Date()).toISOString(),
          current_period_end: new Date(Date.now() + 30 * 24 * 60 * 60 * 1e3).toISOString(),
          // 30 days
          updated_at: (/* @__PURE__ */ new Date()).toISOString()
        }, {
          onConflict: "user_id"
        });
        if (subscriptionError) {
        } else {
        }
        setSelected(tier);
        localStorage.setItem("userTier", tier);
        localStorage.setItem("pending_plan_update", tier);
        try {
          await upgradeSubscription(tier);
        } catch (upgradeError) {
        }
        const { error: logError } = await supabase.from("panel_logs").insert({
          event_type: "subscription_upgraded",
          details: {
            user_id: user.id,
            new_tier: tier,
            session_id: sessionId,
            timestamp: (/* @__PURE__ */ new Date()).toISOString(),
            source: "stripe_success_return"
          }
        });
        if (logError) {
        } else {
        }
        ue.success(` Piano ${tier} attivato!`, {
          description: `Il tuo abbonamento ${tier}  ora attivo e funzionante`,
          duration: 6e3
        });
        setTimeout(() => {
          window.history.replaceState({}, "", "/subscriptions");
        }, 2e3);
      } catch (error) {
        ue.error(" Errore sincronizzazione abbonamento", {
          description: "Il pagamento  andato a buon fine ma c' stato un errore di sincronizzazione. Contatta il supporto.",
          duration: 8e3
        });
      }
    };
    handleStripeReturn();
  }, []);
  const getSubscriptionFeatures = (type) => {
    switch (type) {
      case "Base":
        return [
          { text: "1 BUZZ gratuito a settimana" },
          { text: "1 indizio a settimana (Livello 1)" },
          { text: "Accesso alla missione con funzioni base" },
          { text: "BUZZ MAP disponibili a pagamento" }
        ];
      case "Silver":
        return [
          { text: "3 BUZZ gratuiti a settimana" },
          { text: "3 indizi a settimana (Livelli 1-2)" },
          { text: "Cooldown BUZZ MAP ridotto a 12h" },
          { text: "Badge Silver nel profilo" },
          { text: "Accesso anticipato agli aggiornamenti" }
        ];
      case "Gold":
        return [
          { text: "4 BUZZ gratuiti a settimana" },
          { text: "5 indizi a settimana (Livelli 1-3)" },
          { text: "Cooldown BUZZ MAP ridotto a 8h" },
          { text: "Badge Gold nel profilo" },
          { text: "Esperienza potenziata con AION" }
        ];
      case "Black":
        return [
          { text: "5 BUZZ gratuiti a settimana" },
          { text: "7 indizi a settimana (Livelli 1-4)" },
          { text: "1 BUZZ MAP inclusa al mese" },
          { text: "Cooldown BUZZ MAP: solo 4h" },
          { text: "Badge Black nel profilo" }
        ];
      case "Titanium":
        return [
          { text: "7 BUZZ gratuiti a settimana" },
          { text: "7 indizi a settimana (tutti i Livelli 1-5)" },
          { text: "2 BUZZ MAP incluse al mese" },
          { text: "BUZZ MAP senza cooldown" },
          { text: "Badge Titanium esclusivo" },
          { text: "Accesso prioritario alle novit M1SSION" }
        ];
      default:
        return [];
    }
  };
  const handleUpdatePlan = async (plan) => {
    try {
      if (plan === "Base") {
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
          await supabase.from("profiles").update({ subscription_plan: "Base" }).eq("id", user.id);
          try {
            const { data: cancelData, error: cancelError } = await supabase.functions.invoke("cancel-subscription");
            if (cancelError) {
            } else {
            }
          } catch (cancelStripeError) {
          }
          localStorage.setItem("userTier", "Base");
          await upgradeSubscription("Base");
          setSelected("Base");
        }
        toast({
          title: " Piano Base attivato",
          description: "Stai utilizzando il piano Base gratuito",
          duration: 4e3
        });
      } else {
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
          await supabase.from("profiles").update({ subscription_plan: plan }).eq("id", user.id);
        }
        setSelectedPlan(plan);
        setShowInAppCheckout(true);
        toast({
          title: " Checkout in-app aperto",
          description: `Completa il pagamento per il piano ${plan}`
        });
      }
    } catch (error) {
      toast({
        title: " Errore durante l'operazione",
        description: "Si  verificato un errore. Riprova tra qualche istante.",
        variant: "destructive",
        duration: 5e3
      });
    }
  };
  const handleInAppPaymentSuccess = async () => {
    setShowInAppCheckout(false);
    setSelected(selectedPlan);
    try {
      await upgradeSubscription(selectedPlan);
      ue.success(` Piano ${selectedPlan} attivato!`, {
        description: "Il tuo abbonamento  ora attivo",
        duration: 6e3
      });
    } catch (error) {
    }
  };
  const handleInAppPaymentCancel = () => {
    setShowInAppCheckout(false);
    setSelectedPlan("");
  };
  const verifyDowngrade = async (maxRetries = 3) => {
    for (let i = 0; i < maxRetries; i++) {
      try {
        const { data: verifyData, error: verifyError } = await supabase.functions.invoke("verify-subscription-sync");
        if (verifyError) {
          continue;
        }
        if (verifyData?.tier === "Base") {
          setSelected("Base");
          return true;
        } else {
          if (i < maxRetries - 1) {
            await new Promise((resolve) => setTimeout(resolve, 2e3));
          }
        }
      } catch (error) {
      }
    }
    return false;
  };
  const handleCancelSubscription = async () => {
    if (selected === "Base") {
      toast({
        title: "Nessun abbonamento attivo",
        description: "Hai gi il piano base gratuito"
      });
      return;
    }
    try {
      await handleUpdatePlan("Base");
      const success = await verifyDowngrade();
      if (success) {
        toast({
          title: " Abbonamento cancellato",
          description: "Il tuo abbonamento  stato cancellato con successo"
        });
      } else {
        toast({
          title: " Cancellazione in corso",
          description: "La cancellazione potrebbe richiedere alcuni minuti",
          variant: "destructive"
        });
      }
    } catch (error) {
      toast({
        title: " Errore cancellazione",
        description: "Riprova tra qualche istante",
        variant: "destructive"
      });
    }
  };
  React$1.useEffect(() => {
    const channel = supabase.channel("profiles-changes").on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "profiles"
      },
      (payload) => {
        if (payload.new && payload.new.id) {
          supabase.auth.getUser().then(({ data: { user } }) => {
            if (user && user.id === payload.new.id) {
              const newTier = payload.new.subscription_tier || payload.new.tier;
              if (newTier && newTier !== selected) {
                setSelected(newTier);
                localStorage.setItem("userTier", newTier);
                if (newTier !== "Base") {
                  ue.success(` Piano ${newTier} sincronizzato!`, {
                    description: "Il tuo abbonamento  ora attivo",
                    duration: 4e3
                  });
                }
              }
            }
          });
        }
      }
    ).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, [selected]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "w-full px-4 pb-10", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-12", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Base",
          price: "Gratis",
          period: "mese",
          features: getSubscriptionFeatures("Base"),
          isPopular: false,
          ctaText: selected === "Base" ? "Piano Attuale" : "Passa a Base",
          type: "Base",
          onClick: () => handleUpdatePlan("Base"),
          isActive: selected === "Base"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Silver",
          price: getDisplayPrice("Silver"),
          period: "mese",
          features: getSubscriptionFeatures("Silver"),
          isPopular: false,
          ctaText: selected === "Silver" ? "Piano Attuale" : "Passa a Silver",
          type: "Silver",
          onClick: () => handleUpdatePlan("Silver"),
          isActive: selected === "Silver"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Gold",
          price: getDisplayPrice("Gold"),
          period: "mese",
          features: getSubscriptionFeatures("Gold"),
          isPopular: true,
          ctaText: selected === "Gold" ? "Piano Attuale" : "Passa a Gold",
          type: "Gold",
          onClick: () => handleUpdatePlan("Gold"),
          isActive: selected === "Gold"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Black",
          price: getDisplayPrice("Black"),
          period: "mese",
          features: getSubscriptionFeatures("Black"),
          isPopular: false,
          ctaText: selected === "Black" ? "Piano Attuale" : "Passa a Black",
          type: "Black",
          onClick: () => handleUpdatePlan("Black"),
          isActive: selected === "Black"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Titanium",
          price: getDisplayPrice("Titanium"),
          period: "mese",
          features: getSubscriptionFeatures("Titanium"),
          isPopular: false,
          ctaText: selected === "Titanium" ? "Piano Attuale" : "Passa a Titanium",
          type: "Titanium",
          onClick: () => {
            handleUpdatePlan("Titanium");
          },
          isActive: selected === "Titanium"
        }
      )
    ] }),
    selected !== "Base" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center mb-10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        variant: "outline",
        onClick: handleCancelSubscription,
        className: "border-red-500 text-red-500 hover:bg-red-500/10",
        children: "Cancella abbonamento"
      }
    ) }),
    showInAppCheckout && (() => {
      const planPrice = getPriceCents(selectedPlan) || 399;
      return /* @__PURE__ */ jsxRuntimeExports.jsx(
        StripeInAppCheckout,
        {
          config: {
            type: "subscription",
            amount: planPrice,
            description: `Piano ${selectedPlan} con accesso premium`,
            plan: selectedPlan,
            metadata: {
              subscription_plan: selectedPlan,
              mission: "M1SSION",
              reset_date: "2025-07-22"
            }
          },
          onSuccess: async (paymentIntentId) => {
            await handleInAppPaymentSuccess();
          },
          onCancel: handleInAppPaymentCancel
        }
      );
    })()
  ] });
};

const SubscriptionBenefits = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "w-full py-10 px-4 backdrop-blur-lg bg-white/5 border border-white/10 rounded-xl mx-auto max-w-3xl mb-12", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-8 text-center bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent", children: "Vantaggi dei Piani Premium" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4 max-w-xl mx-auto", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center p-3 bg-white/5 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center mr-4 flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-5 h-5 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/90", children: "Pi indizi per aumentare le possibilit di vittoria" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center p-3 bg-white/5 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center mr-4 flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-5 h-5 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/90", children: "Accesso anticipato a nuovi eventi e premi esclusivi" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center p-3 bg-white/5 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center mr-4 flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-5 h-5 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/90", children: "Badge speciale nel profilo utente" })
      ] })
    ] })
  ] });
};

const SubscriptionFAQ = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "w-full py-10 px-4 mb-12", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-8 text-center bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent", children: "Domande Frequenti" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4 max-w-3xl mx-auto", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-lg mb-2", children: "Cosa succede dopo aver acquistato un abbonamento?" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Subito dopo l'acquisto avrai accesso ai vantaggi del piano selezionato." })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-lg mb-2", children: "Posso cambiare piano in qualsiasi momento?" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "S, puoi cambiare o annullare il tuo abbonamento in qualsiasi momento dalle impostazioni del profilo." })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-lg mb-2", children: "Come vengono gestiti i pagamenti?" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "I pagamenti sono gestiti in totale sicurezza tramite Stripe." })
      ] })
    ] })
  ] });
};

class PaymentErrorHandler {
  static logAnalyticsEvent(eventName, data) {
    {
      window.gtag?.("event", eventName, data);
    }
  }
  static async handlePaymentError(error, context = "payment") {
    let userMessage = "Errore nella creazione del pagamento. Riprova tra poco.";
    let errorCode = "unknown";
    if (error instanceof TypeError && error.message.includes("fetch")) {
      userMessage = "Errore di connessione. Controlla la tua connessione internet.";
      errorCode = "network_error";
    } else if (error?.status === 0 || [502, 503, 504].includes(error?.status)) {
      userMessage = "Servizio temporaneamente non disponibile. Riprova tra poco.";
      errorCode = "service_unavailable";
    } else if (error?.message?.includes("CORS") || error?.code === "CORS_ERROR") {
      userMessage = "Errore di configurazione. Contatta il supporto.";
      errorCode = "cors_error";
    } else if (error?.type === "stripe_error") {
      userMessage = "Errore del sistema di pagamento. Riprova o contatta il supporto.";
      errorCode = "stripe_error";
    }
    ue.error(userMessage, {
      duration: 5e3,
      position: "top-center"
    });
    this.logAnalyticsEvent("payment_error", {
      context,
      error_code: errorCode,
      error_message: error?.message || "Unknown error",
      timestamp: Date.now()
    });
    return { handled: true, userMessage, errorCode };
  }
  static async retryWithBackoff(fn, maxRetries = 1, baseDelay = 500) {
    let lastError;
    for (let attempt = 0; attempt <= maxRetries; attempt++) {
      try {
        return await fn();
      } catch (error) {
        lastError = error;
        if (error?.status === 400 || error?.status === 401 || error?.status === 403) {
          throw error;
        }
        if (attempt === maxRetries) {
          throw error;
        }
        const delay = baseDelay + Math.random() * 300;
        await new Promise((resolve) => setTimeout(resolve, delay));
      }
    }
    throw lastError;
  }
}

const useStripePayment = () => {
  const [loading, setLoading] = reactExports.useState(false);
  const { user } = useAuthContext();
  const processSubscription = async (plan, paymentMethod) => {
    if (!user) {
      ue.error("Devi essere loggato per effettuare acquisti");
      return;
    }
    try {
      await PaymentErrorHandler.retryWithBackoff(async () => {
        const { data: modeData, error: modeErr } = await supabase.functions.invoke("stripe-mode");
        if (modeErr) throw new Error(`Mode check failed: ${modeErr.message}`);
        const { assertPkMatchesMode } = await __vitePreload(async () => { const { assertPkMatchesMode } = await import('./guard.CzFH63NC.js');return { assertPkMatchesMode }},true?[]:void 0);
        assertPkMatchesMode(modeData?.mode);
      });
    } catch (e) {
      await PaymentErrorHandler.handlePaymentError(e, "stripe_mode_check");
      setLoading(false);
      return;
    }
    setLoading(true);
    try {
      const { data, error } = await supabase.functions.invoke("create-checkout", {
        body: {
          user_id: user.id,
          plan: plan.toUpperCase(),
          //  CRITICAL: Convert to uppercase for edge function
          payment_method: paymentMethod || "card",
          mode: "live"
          // Force live mode for production
        }
      });
      if (error) {
        ue.error(`Errore Stripe: ${error.message || "Sessione di pagamento fallita"}`);
        return;
      }
      if (data?.url) {
        const newWindow = window.open(data.url, "_blank");
        if (!newWindow) {
          const isIOSPWA = window.navigator.standalone || window.matchMedia && window.matchMedia("(display-mode: standalone)").matches;
          if (isIOSPWA) {
            try {
              window.location.replace(data.url);
            } catch (error2) {
              try {
                window.location.assign(data.url);
              } catch (assignError) {
                window.location.href = data.url;
              }
            }
          } else {
            window.location.href = data.url;
          }
        } else {
        }
        ue.success(" Apertura checkout Stripe...", {
          description: "Checkout aperto in nuova scheda - completa il pagamento"
        });
      } else {
        ue.error("Errore nel creare la sessione di pagamento");
      }
    } catch (error) {
      ue.error("Errore nel processare l'abbonamento");
    } finally {
      setLoading(false);
    }
  };
  const detectPaymentMethodAvailability = () => {
    const applePayAvailable = typeof window !== "undefined" && "ApplePaySession" in window && window.ApplePaySession?.canMakePayments?.();
    const googlePayAvailable = typeof window !== "undefined" && "PaymentRequest" in window;
    return {
      applePayAvailable: applePayAvailable || false,
      googlePayAvailable: googlePayAvailable || false
    };
  };
  return {
    processSubscription,
    detectPaymentMethodAvailability,
    loading
  };
};

const Subscriptions = () => {
  const [, setLocation] = useLocation();
  const { subscription } = useProfileSubscription();
  const [selected, setSelected] = reactExports.useState(subscription.plan);
  const [profileImage, setProfileImage] = reactExports.useState(null);
  const { processSubscription, loading: stripeLoading } = useStripePayment();
  const LeftComponent = () => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    Button,
    {
      variant: "ghost",
      size: "icon",
      onClick: () => {
        setLocation("/home");
      },
      className: "mr-2",
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
    }
  ) });
  reactExports.useEffect(() => {
    setProfileImage(localStorage.getItem("profileImage"));
    setSelected(subscription.plan);
    const urlParams = new URLSearchParams(window.location.search);
    const checkoutTier = urlParams.get("checkout");
    const tier = urlParams.get("tier");
    const upgradeIntent = urlParams.get("upgrade");
    const fromPage = urlParams.get("from");
    const currentPlan = urlParams.get("current_plan");
    if (checkoutTier && tier) {
      handleStripeCheckout(tier);
    } else if (upgradeIntent === "true" && fromPage === "access-blocked") {
      if (currentPlan === "base") {
        setTimeout(() => {
          const silverElement = document.querySelector('[data-plan="Silver"]');
          if (silverElement) {
            silverElement.scrollIntoView({ behavior: "smooth", block: "center" });
            silverElement.classList.add("ring-2", "ring-purple-500", "ring-pulse");
          }
        }, 1e3);
      }
    }
  }, [subscription.plan, processSubscription]);
  const handleStripeCheckout = async (tier) => {
    try {
      if (!processSubscription) {
        ue.error("Sistema di pagamento non disponibile");
        return;
      }
      if (stripeLoading) {
        return;
      }
      await processSubscription(tier);
      ue.success(` Checkout ${tier} attivato - reindirizzamento in corso...`);
    } catch (error) {
      ue.error(" Errore nel sistema di pagamento. Contatta l'assistenza.");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              UnifiedHeader,
              {
                profileImage,
                leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(LeftComponent, {})
              }
            )
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "main",
          {
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-screen-xl mx-auto", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionHeader, {}),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionPlans, { selected, setSelected }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionBenefits, {}),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionFAQ, {})
            ] })
          }
        )
      ]
    }
  );
};

const validateRegistration = (formData) => {
  const errors = {};
  if (!formData.name) {
    errors.name = "Il nome  obbligatorio";
  }
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!formData.email) {
    errors.email = "L'email  obbligatoria";
  } else if (!emailRegex.test(formData.email)) {
    errors.email = "Formato email non valido";
  }
  if (!formData.password) {
    errors.password = "La password  obbligatoria";
  } else if (formData.password.length < 8) {
    errors.password = "La password deve contenere almeno 8 caratteri";
  } else if (!/[A-Z]/.test(formData.password) || !/[a-z]/.test(formData.password) || !/[0-9]/.test(formData.password)) {
    errors.password = "La password deve contenere almeno una lettera maiuscola, una minuscola e un numero";
  }
  if (!formData.confirmPassword) {
    errors.confirmPassword = "Conferma la password";
  } else if (formData.password !== formData.confirmPassword) {
    errors.confirmPassword = "Le password non coincidono";
  }
  return {
    isValid: Object.keys(errors).length === 0,
    errors
  };
};

const useRegistration = () => {
  const [formData, setFormData] = reactExports.useState({
    name: "",
    email: "",
    password: "",
    confirmPassword: ""
  });
  const [errors, setErrors] = reactExports.useState({});
  const [isSubmitting, setIsSubmitting] = reactExports.useState(false);
  const { navigate } = useWouterNavigation();
  const handleChange = (e) => {
    const { id, value } = e.target;
    setFormData((prev) => ({
      ...prev,
      [id]: value
    }));
    if (errors[id]) {
      setErrors((prev) => ({ ...prev, [id]: "" }));
    }
  };
  const handleSubmit = async (e, turnstileToken, missionPreference) => {
    e.preventDefault();
    const validation = validateRegistration(formData);
    if (!validation.isValid) {
      setErrors(validation.errors);
      return;
    }
    setIsSubmitting(true);
    const { name, email, password } = formData;
    try {
      const standardResult = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: window.location.origin + "/choose-plan",
          data: {
            full_name: name,
            mission_preference: missionPreference || null,
            subscription_plan: null,
            access_enabled: false,
            status: "registered_pending"
          }
        }
      });
      if (!standardResult.error && standardResult.data.user) {
        ue.success("Registrazione completata!", {
          description: "Scegli il tuo piano per iniziare la missione."
        });
        setTimeout(() => {
          navigate("/choose-plan");
        }, 100);
        supabase.functions.invoke("send-registration-notification", {
          body: {
            userId: standardResult.data.user.id,
            email: standardResult.data.user.email,
            agentCode: "PENDING",
            // Il vero agent_code  nel DB trigger
            fullName: name
          }
        }).then(() => {
        }).catch((err) => {
        });
        return;
      }
      if (standardResult.error && standardResult.error.message.includes("captcha")) {
        const { data: bypassResult, error: bypassError } = await supabase.functions.invoke("register-bypass", {
          body: {
            email,
            password,
            fullName: name,
            missionPreference: missionPreference || null,
            subscriptionPlan: null,
            accessEnabled: false,
            status: "registered_pending"
          }
        });
        if (bypassError) {
          ue.error("Errore nel bypass", {
            description: bypassError.message || "Errore durante la registrazione con bypass.",
            duration: 3e3
          });
          return;
        }
        if (bypassResult?.success) {
          ue.success("Registrazione completata!", {
            description: "Scegli il tuo piano per iniziare la missione."
          });
          setTimeout(() => {
            navigate("/choose-plan");
          }, 100);
          supabase.functions.invoke("send-registration-notification", {
            body: {
              userId: bypassResult.userId || "bypass-user",
              email,
              agentCode: "PENDING",
              fullName: name
            }
          }).then(() => {
          }).catch((err) => {
          });
          return;
        }
      }
      const errorMessage = standardResult.error?.message || "Errore sconosciuto durante la registrazione";
      ue.error("Errore", {
        description: errorMessage,
        duration: 3e3
      });
    } catch (error) {
      ue.error("Errore", {
        description: error.message || "Si  verificato un errore. Riprova pi tardi.",
        duration: 3e3
      });
    } finally {
      setIsSubmitting(false);
    }
  };
  return {
    formData,
    errors,
    isSubmitting,
    handleChange,
    handleSubmit
  };
};

const RegistrationForm = ({ missionPreference }) => {
  const {
    formData,
    errors,
    isSubmitting,
    handleChange,
    handleSubmit: originalHandleSubmit
  } = useRegistration();
  const handleSubmit = (e) => {
    originalHandleSubmit(e, "BYPASS_COMPLETELY_DISABLED", missionPreference);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "name",
        type: "text",
        label: "Nome",
        placeholder: "Inserisci il tuo nome",
        value: formData.name,
        onChange: handleChange,
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "h-4 w-4" }),
        error: errors.name
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "email",
        type: "email",
        label: "Email",
        placeholder: "Inserisci la tua email",
        value: formData.email,
        onChange: handleChange,
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "h-4 w-4" }),
        error: errors.email
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "password",
        type: "password",
        label: "Password",
        placeholder: "Crea una password sicura",
        value: formData.password,
        onChange: handleChange,
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "h-4 w-4" }),
        error: errors.password
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "confirmPassword",
        type: "password",
        label: "Conferma Password",
        placeholder: "Ripeti la tua password",
        value: formData.confirmPassword,
        onChange: handleChange,
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "h-4 w-4" }),
        error: errors.confirmPassword
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        whileHover: { scale: 1.02 },
        whileTap: { scale: 0.98 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            type: "submit",
            disabled: isSubmitting,
            className: "w-full bg-gradient-to-r from-cyan-400 to-blue-600 hover:shadow-glow",
            children: isSubmitting ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "mr-2 h-4 w-4 animate-spin" }),
              "Registrazione in corso..."
            ] }) : "Registrati"
          }
        )
      }
    )
  ] });
};

const RegisterHeader = ({ className }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `text-center mb-8 relative ${className}`, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "mission-heading", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { style: { color: "#00E5FF" }, className: "text-[#00E5FF]", children: "M1" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { style: { color: "#FFFFFF" }, className: "text-white", children: [
        "SSION",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-2", children: "Crea il tuo account" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "line-glow" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mission-motto mt-2", children: "IT IS POSSIBLE" })
  ] });
};

function useQueryParams() {
  useLocation();
  const search = window.location.search;
  const params = new URLSearchParams(search);
  const result = {};
  params.forEach((value, key) => {
    result[key] = String(value).valueOf();
  });
  return result;
}

const Register = () => {
  const { preference } = useQueryParams();
  const [missionPreference, setMissionPreference] = reactExports.useState(null);
  const { navigate } = useWouterNavigation();
  reactExports.useEffect(() => {
    if (preference === "uomo" || preference === "donna") {
      setMissionPreference(preference);
    }
  }, [preference]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen flex flex-col items-center justify-center bg-black px-4 py-12 relative overflow-hidden", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(BackgroundParticles, { count: 15 }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "w-full max-w-md z-10",
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.5 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(RegisterHeader, {}),
          missionPreference && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "mb-6 text-center",
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              transition: { delay: 0.2, duration: 0.5 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-white/70", children: [
                  "Hai scelto le missioni",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold text-[#00D1FF] mx-1", children: missionPreference === "uomo" ? "UOMO" : "DONNA" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "link",
                    className: "text-xs text-white/50 hover:text-white/70 p-0 mt-1",
                    onClick: () => navigate("/select-mission"),
                    children: "Cambia la tua preferenza"
                  }
                )
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card p-6 backdrop-blur-md border border-gray-800 rounded-xl", children: /* @__PURE__ */ jsxRuntimeExports.jsx(RegistrationForm, { missionPreference }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 text-center space-y-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/50", children: "Registrandoti accetti i nostri Termini e Condizioni e la nostra Informativa sulla Privacy." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-white/70", children: [
              "Hai gi un account?",
              " ",
              /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/login", className: "text-cyan-400 hover:text-cyan-300 transition-colors", children: "Accedi" })
            ] })
          ] })
        ]
      }
    )
  ] });
};

class NeuralAudioEngine {
  audioContext = null;
  masterVolume = 0.6;
  isMuted = false;
  constructor() {
    this.loadMuteState();
  }
  getContext() {
    if (!this.audioContext) {
      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    return this.audioContext;
  }
  loadMuteState() {
    try {
      const saved = localStorage.getItem("neural_mute");
      this.isMuted = saved === "true";
    } catch (e) {
      this.isMuted = false;
    }
  }
  setMuted(muted) {
    this.isMuted = muted;
    try {
      localStorage.setItem("neural_mute", String(muted));
    } catch (e) {
    }
  }
  isMutedState() {
    return this.isMuted;
  }
  setVolume(volume) {
    this.masterVolume = Math.max(0, Math.min(1, volume));
  }
  playTone(frequency, duration, type = "sine", volume = 0.3) {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();
    oscillator.type = type;
    oscillator.frequency.value = frequency;
    gainNode.gain.value = volume * this.masterVolume;
    gainNode.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + duration);
    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);
    oscillator.start(ctx.currentTime);
    oscillator.stop(ctx.currentTime + duration);
  }
  playChord(frequencies, duration, volume = 0.2) {
    frequencies.forEach((freq) => this.playTone(freq, duration, "sine", volume / frequencies.length));
  }
  // Select node sound with reverb
  playSelect() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const convolver = ctx.createConvolver();
    const impulseLength = ctx.sampleRate * 0.6;
    const impulse = ctx.createBuffer(2, impulseLength, ctx.sampleRate);
    for (let channel = 0; channel < 2; channel++) {
      const data = impulse.getChannelData(channel);
      for (let i = 0; i < impulseLength; i++) {
        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / impulseLength * 3);
      }
    }
    convolver.buffer = impulse;
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();
    const reverbGain = ctx.createGain();
    oscillator.type = "sine";
    oscillator.frequency.setValueAtTime(600, ctx.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.08);
    gainNode.gain.value = 0.2 * this.masterVolume;
    gainNode.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 0.08);
    reverbGain.gain.value = 0.3;
    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);
    gainNode.connect(convolver);
    convolver.connect(reverbGain);
    reverbGain.connect(ctx.destination);
    oscillator.start(ctx.currentTime);
    oscillator.stop(ctx.currentTime + 0.08);
  }
  // Dragging sound (FM sweep with sub rumble)
  playDrag() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const carrier = ctx.createOscillator();
    const modulator = ctx.createOscillator();
    const modulatorGain = ctx.createGain();
    const carrierGain = ctx.createGain();
    const sub = ctx.createOscillator();
    const subGain = ctx.createGain();
    carrier.type = "sine";
    carrier.frequency.setValueAtTime(500, ctx.currentTime);
    carrier.frequency.exponentialRampToValueAtTime(4e3, ctx.currentTime + 0.2);
    modulator.type = "sine";
    modulator.frequency.value = 80;
    modulatorGain.gain.value = 200;
    sub.type = "sine";
    sub.frequency.value = 55;
    subGain.gain.value = 0.08 * this.masterVolume;
    carrierGain.gain.value = 0.12 * this.masterVolume;
    carrierGain.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 0.2);
    modulator.connect(modulatorGain);
    modulatorGain.connect(carrier.frequency);
    carrier.connect(carrierGain);
    carrierGain.connect(ctx.destination);
    sub.connect(subGain);
    subGain.connect(ctx.destination);
    carrier.start(ctx.currentTime);
    modulator.start(ctx.currentTime);
    sub.start(ctx.currentTime);
    carrier.stop(ctx.currentTime + 0.2);
    modulator.stop(ctx.currentTime + 0.2);
    sub.stop(ctx.currentTime + 0.2);
  }
  // Valid connection sound with delay tail
  playConnect() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const frequencies = [261.63, 329.63, 392, 493.88, 587.33];
    frequencies.forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      const delay = ctx.createDelay();
      const delayGain = ctx.createGain();
      osc.type = "sine";
      osc.frequency.value = freq;
      gain.gain.value = 0.25 / frequencies.length * this.masterVolume;
      gain.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 0.5);
      delay.delayTime.value = 0.15;
      delayGain.gain.value = 0.4;
      osc.connect(gain);
      gain.connect(ctx.destination);
      gain.connect(delay);
      delay.connect(delayGain);
      delayGain.connect(ctx.destination);
      osc.start(ctx.currentTime + i * 0.02);
      osc.stop(ctx.currentTime + 0.5);
    });
    setTimeout(() => {
      const bufferSize = ctx.sampleRate * 0.4;
      const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / bufferSize * 4);
      }
      const source = ctx.createBufferSource();
      const filter = ctx.createBiquadFilter();
      const gainNode = ctx.createGain();
      source.buffer = buffer;
      filter.type = "highpass";
      filter.frequency.value = 3e3;
      gainNode.gain.value = 0.1 * this.masterVolume;
      source.connect(filter);
      filter.connect(gainNode);
      gainNode.connect(ctx.destination);
      source.start(ctx.currentTime);
    }, 50);
  }
  // Error sound (band-stop noise + reverse hit)
  playError() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const bufferSize = ctx.sampleRate * 0.15;
    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      const envelope = i / bufferSize;
      data[i] = (Math.random() * 2 - 1) * envelope;
    }
    const source = ctx.createBufferSource();
    const filter = ctx.createBiquadFilter();
    const gainNode = ctx.createGain();
    source.buffer = buffer;
    filter.type = "bandpass";
    filter.frequency.value = 500;
    filter.Q.value = 8;
    gainNode.gain.value = 0.25 * this.masterVolume;
    source.connect(filter);
    filter.connect(gainNode);
    gainNode.connect(ctx.destination);
    source.start(ctx.currentTime);
  }
  // Cinematic victory sequence (2s rise + pulse drop + reverb tail)
  playVictory() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const notes = [261.63, 329.63, 392, 493.88, 587.33, 783.99];
    const convolver = ctx.createConvolver();
    const impulseLength = ctx.sampleRate * 2;
    const impulse = ctx.createBuffer(2, impulseLength, ctx.sampleRate);
    for (let channel = 0; channel < 2; channel++) {
      const data = impulse.getChannelData(channel);
      for (let i = 0; i < impulseLength; i++) {
        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / impulseLength * 2);
      }
    }
    convolver.buffer = impulse;
    notes.forEach((freq, i) => {
      setTimeout(() => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        const reverbGain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.value = freq;
        gain.gain.value = 0.2 / notes.length * this.masterVolume;
        gain.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 0.8);
        reverbGain.gain.value = 0.5;
        osc.connect(gain);
        gain.connect(ctx.destination);
        gain.connect(convolver);
        convolver.connect(reverbGain);
        reverbGain.connect(ctx.destination);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.8);
      }, i * 150);
    });
    setTimeout(() => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      const filter = ctx.createBiquadFilter();
      osc.type = "sawtooth";
      osc.frequency.value = 130.81;
      filter.type = "lowpass";
      filter.frequency.value = 200;
      gain.gain.value = 0.3 * this.masterVolume;
      gain.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 1.2);
      osc.connect(filter);
      filter.connect(gain);
      gain.connect(ctx.destination);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 1.2);
    }, 1e3);
  }
}
new NeuralAudioEngine();

class DNAErrorBoundary extends reactExports.Component {
  state = { err: void 0 };
  static getDerivedStateFromError(err) {
    return { err };
  }
  componentDidCatch(error, errorInfo) {
  }
  render() {
    if (this.state.err) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full h-screen flex items-center justify-center bg-background", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center max-w-md p-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-destructive text-lg font-semibold mb-2", children: "DNA Module Error" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground text-sm", children: "An error occurred while loading the DNA experience. Please refresh the page." }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: () => window.location.reload(),
            className: "mt-4 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",
            children: "Reload Page"
          }
        )
      ] }) });
    }
    return this.props.children;
  }
}

const DNAEvolutionScene = ({
  isOpen,
  archetype,
  onComplete
}) => {
  const [phase, setPhase] = reactExports.useState("intro");
  const archetypeConfig = ARCHETYPE_CONFIGS[archetype];
  const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  reactExports.useEffect(() => {
    if (!isOpen) {
      setPhase("intro");
      return;
    }
    const introTimer = setTimeout(() => setPhase("reveal"), 1e3);
    const revealTimer = setTimeout(() => setPhase("outro"), 4e3);
    const closeTimer = setTimeout(() => {
      onComplete();
    }, 5e3);
    return () => {
      clearTimeout(introTimer);
      clearTimeout(revealTimer);
      clearTimeout(closeTimer);
    };
  }, [isOpen, onComplete]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: () => {
  }, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    DialogContent,
    {
      className: "max-w-full w-full h-full bg-black border-none p-0 flex items-center justify-center",
      style: { maxWidth: "100vw", maxHeight: "100vh" },
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(AnimatePresence, { mode: "wait", children: [
        phase === "intro" && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            exit: { opacity: 0 },
            className: "absolute inset-0 bg-black"
          },
          "intro"
        ),
        phase === "reveal" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, scale: 0.5 },
            animate: { opacity: 1, scale: 1 },
            exit: { opacity: 0, scale: 1.5 },
            transition: { duration: 1, ease: "easeOut" },
            className: "relative z-10 flex flex-col items-center justify-center gap-8",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "absolute inset-0 pointer-events-none",
                  animate: prefersReducedMotion ? {} : {
                    scale: [1, 1.2, 1],
                    opacity: [0.3, 0.5, 0.3]
                  },
                  transition: prefersReducedMotion ? {} : {
                    duration: 2,
                    repeat: Infinity,
                    ease: "easeInOut"
                  },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "div",
                    {
                      className: "w-[600px] h-[600px] rounded-full blur-[120px]",
                      style: {
                        background: `radial-gradient(circle, ${archetypeConfig.color}, transparent 70%)`
                      }
                    }
                  )
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "relative z-10",
                  animate: prefersReducedMotion ? {} : {
                    scale: [0.9, 1.1, 1],
                    rotate: [0, 5, -5, 0]
                  },
                  transition: prefersReducedMotion ? {} : {
                    duration: 2,
                    ease: "easeInOut"
                  },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    ArchetypeIcon,
                    {
                      archetype,
                      size: 160
                    }
                  )
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  initial: { opacity: 0, y: 20 },
                  animate: { opacity: 1, y: 0 },
                  transition: { delay: 0.5, duration: 0.8 },
                  className: "text-center space-y-4 max-w-2xl px-6",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        className: "text-4xl md:text-6xl font-black",
                        style: {
                          color: archetypeConfig.color,
                          textShadow: `0 0 30px ${archetypeConfig.color}80`
                        },
                        children: archetypeConfig.nameIt
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(
                      motion.div,
                      {
                        className: "text-base md:text-xl text-white/80 font-medium",
                        initial: { opacity: 0 },
                        animate: { opacity: 1 },
                        transition: { delay: 0.8 },
                        children: [
                          "Sequenza M1-HEX riscritta.",
                          /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
                          "Il tuo codice vibra con una nuova frequenza."
                        ]
                      }
                    )
                  ]
                }
              ),
              !prefersReducedMotion && [...Array(18)].map((_, i) => {
                const isOuter = i >= 12;
                const angle = i % 12 / 12 * Math.PI * 2;
                const distance = isOuter ? 350 : 300;
                return /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "absolute rounded-full",
                    style: {
                      width: isOuter ? "3px" : "2px",
                      height: isOuter ? "3px" : "2px",
                      backgroundColor: archetypeConfig.color,
                      left: "50%",
                      top: "50%"
                    },
                    animate: {
                      x: [0, Math.cos(angle) * distance],
                      y: [0, Math.sin(angle) * distance],
                      opacity: [1, 0],
                      scale: [1, 0]
                    },
                    transition: {
                      duration: isOuter ? 2.3 : 2,
                      ease: "easeOut",
                      repeat: Infinity,
                      repeatDelay: isOuter ? 0.3 : 0.5,
                      delay: isOuter ? 0.2 : 0
                    }
                  },
                  i
                );
              })
            ]
          },
          "reveal"
        ),
        phase === "outro" && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { opacity: 1 },
            animate: { opacity: 0 },
            className: "absolute inset-0 bg-black"
          },
          "outro"
        )
      ] })
    }
  ) });
};

/**
 * Fires when the camera has been transformed by the controls.
 *
 * @event OrbitControls#change
 * @type {Object}
 */
const _changeEvent = { type: 'change' };

/**
 * Fires when an interaction was initiated.
 *
 * @event OrbitControls#start
 * @type {Object}
 */
const _startEvent = { type: 'start' };

/**
 * Fires when an interaction has finished.
 *
 * @event OrbitControls#end
 * @type {Object}
 */
const _endEvent = { type: 'end' };

const _ray = new Ray();
const _plane = new Plane();
const _TILT_LIMIT = Math.cos( 70 * MathUtils.DEG2RAD );

const _v = new Vector3();
const _twoPI = 2 * Math.PI;

const _STATE = {
	NONE: -1,
	ROTATE: 0,
	DOLLY: 1,
	PAN: 2,
	TOUCH_ROTATE: 3,
	TOUCH_PAN: 4,
	TOUCH_DOLLY_PAN: 5,
	TOUCH_DOLLY_ROTATE: 6
};
const _EPS = 0.000001;


/**
 * Orbit controls allow the camera to orbit around a target.
 *
 * OrbitControls performs orbiting, dollying (zooming), and panning. Unlike {@link TrackballControls},
 * it maintains the "up" direction `object.up` (+Y by default).
 *
 * - Orbit: Left mouse / touch: one-finger move.
 * - Zoom: Middle mouse, or mousewheel / touch: two-finger spread or squish.
 * - Pan: Right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move.
 *
 * ```js
 * const controls = new OrbitControls( camera, renderer.domElement );
 *
 * // controls.update() must be called after any manual changes to the camera's transform
 * camera.position.set( 0, 20, 100 );
 * controls.update();
 *
 * function animate() {
 *
 * 	// required if controls.enableDamping or controls.autoRotate are set to true
 * 	controls.update();
 *
 * 	renderer.render( scene, camera );
 *
 * }
 * ```
 *
 * @augments Controls
 * @three_import import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
 */
class OrbitControls extends Controls {

	/**
	 * Constructs a new controls instance.
	 *
	 * @param {Object3D} object - The object that is managed by the controls.
	 * @param {?HTMLDOMElement} domElement - The HTML element used for event listeners.
	 */
	constructor( object, domElement = null ) {

		super( object, domElement );

		this.state = _STATE.NONE;

		/**
		 * The focus point of the controls, the `object` orbits around this.
		 * It can be updated manually at any point to change the focus of the controls.
		 *
		 * @type {Vector3}
		 */
		this.target = new Vector3();

		/**
		 * The focus point of the `minTargetRadius` and `maxTargetRadius` limits.
		 * It can be updated manually at any point to change the center of interest
		 * for the `target`.
		 *
		 * @type {Vector3}
		 */
		this.cursor = new Vector3();

		/**
		 * How far you can dolly in (perspective camera only).
		 *
		 * @type {number}
		 * @default 0
		 */
		this.minDistance = 0;

		/**
		 * How far you can dolly out (perspective camera only).
		 *
		 * @type {number}
		 * @default Infinity
		 */
		this.maxDistance = Infinity;

		/**
		 * How far you can zoom in (orthographic camera only).
		 *
		 * @type {number}
		 * @default 0
		 */
		this.minZoom = 0;

		/**
		 * How far you can zoom out (orthographic camera only).
		 *
		 * @type {number}
		 * @default Infinity
		 */
		this.maxZoom = Infinity;

		/**
		 * How close you can get the target to the 3D `cursor`.
		 *
		 * @type {number}
		 * @default 0
		 */
		this.minTargetRadius = 0;

		/**
		 * How far you can move the target from the 3D `cursor`.
		 *
		 * @type {number}
		 * @default Infinity
		 */
		this.maxTargetRadius = Infinity;

		/**
		 * How far you can orbit vertically, lower limit. Range is `[0, Math.PI]` radians.
		 *
		 * @type {number}
		 * @default 0
		 */
		this.minPolarAngle = 0;

		/**
		 * How far you can orbit vertically, upper limit. Range is `[0, Math.PI]` radians.
		 *
		 * @type {number}
		 * @default Math.PI
		 */
		this.maxPolarAngle = Math.PI;

		/**
		 * How far you can orbit horizontally, lower limit. If set, the interval `[ min, max ]`
		 * must be a sub-interval of `[ - 2 PI, 2 PI ]`, with `( max - min < 2 PI )`.
		 *
		 * @type {number}
		 * @default -Infinity
		 */
		this.minAzimuthAngle = - Infinity;

		/**
		 * How far you can orbit horizontally, upper limit. If set, the interval `[ min, max ]`
		 * must be a sub-interval of `[ - 2 PI, 2 PI ]`, with `( max - min < 2 PI )`.
		 *
		 * @type {number}
		 * @default -Infinity
		 */
		this.maxAzimuthAngle = Infinity;

		/**
		 * Set to `true` to enable damping (inertia), which can be used to give a sense of weight
		 * to the controls. Note that if this is enabled, you must call `update()` in your animation
		 * loop.
		 *
		 * @type {boolean}
		 * @default false
		 */
		this.enableDamping = false;

		/**
		 * The damping inertia used if `enableDamping` is set to `true`.
		 *
		 * Note that for this to work, you must call `update()` in your animation loop.
		 *
		 * @type {number}
		 * @default 0.05
		 */
		this.dampingFactor = 0.05;

		/**
		 * Enable or disable zooming (dollying) of the camera.
		 *
		 * @type {boolean}
		 * @default true
		 */
		this.enableZoom = true;

		/**
		 * Speed of zooming / dollying.
		 *
		 * @type {number}
		 * @default 1
		 */
		this.zoomSpeed = 1.0;

		/**
		 * Enable or disable horizontal and vertical rotation of the camera.
		 *
		 * Note that it is possible to disable a single axis by setting the min and max of the
		 * `minPolarAngle` or `minAzimuthAngle` to the same value, which will cause the vertical
		 * or horizontal rotation to be fixed at that value.
		 *
		 * @type {boolean}
		 * @default true
		 */
		this.enableRotate = true;

		/**
		 * Speed of rotation.
		 *
		 * @type {number}
		 * @default 1
		 */
		this.rotateSpeed = 1.0;

		/**
		 * How fast to rotate the camera when the keyboard is used.
		 *
		 * @type {number}
		 * @default 1
		 */
		this.keyRotateSpeed = 1.0;

		/**
		 * Enable or disable camera panning.
		 *
		 * @type {boolean}
		 * @default true
		 */
		this.enablePan = true;

		/**
		 * Speed of panning.
		 *
		 * @type {number}
		 * @default 1
		 */
		this.panSpeed = 1.0;

		/**
		 * Defines how the camera's position is translated when panning. If `true`, the camera pans
		 * in screen space. Otherwise, the camera pans in the plane orthogonal to the camera's up
		 * direction.
		 *
		 * @type {boolean}
		 * @default true
		 */
		this.screenSpacePanning = true;

		/**
		 * How fast to pan the camera when the keyboard is used in
		 * pixels per keypress.
		 *
		 * @type {number}
		 * @default 7
		 */
		this.keyPanSpeed = 7.0;

		/**
		 * Setting this property to `true` allows to zoom to the cursor's position.
		 *
		 * @type {boolean}
		 * @default false
		 */
		this.zoomToCursor = false;

		/**
		 * Set to true to automatically rotate around the target
		 *
		 * Note that if this is enabled, you must call `update()` in your animation loop.
		 * If you want the auto-rotate speed to be independent of the frame rate (the refresh
		 * rate of the display), you must pass the time `deltaTime`, in seconds, to `update()`.
		 *
		 * @type {boolean}
		 * @default false
		 */
		this.autoRotate = false;

		/**
		 * How fast to rotate around the target if `autoRotate` is `true`. The default  equates to 30 seconds
		 * per orbit at 60fps.
		 *
		 * Note that if `autoRotate` is enabled, you must call `update()` in your animation loop.
		 *
		 * @type {number}
		 * @default 2
		 */
		this.autoRotateSpeed = 2.0;

		/**
		 * This object contains references to the keycodes for controlling camera panning.
		 *
		 * ```js
		 * controls.keys = {
		 * 	LEFT: 'ArrowLeft', //left arrow
		 * 	UP: 'ArrowUp', // up arrow
		 * 	RIGHT: 'ArrowRight', // right arrow
		 * 	BOTTOM: 'ArrowDown' // down arrow
		 * }
		 * ```
		 * @type {Object}
		 */
		this.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };

		/**
		 * This object contains references to the mouse actions used by the controls.
		 *
		 * ```js
		 * controls.mouseButtons = {
		 * 	LEFT: THREE.MOUSE.ROTATE,
		 * 	MIDDLE: THREE.MOUSE.DOLLY,
		 * 	RIGHT: THREE.MOUSE.PAN
		 * }
		 * ```
		 * @type {Object}
		 */
		this.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };

		/**
		 * This object contains references to the touch actions used by the controls.
		 *
		 * ```js
		 * controls.mouseButtons = {
		 * 	ONE: THREE.TOUCH.ROTATE,
		 * 	TWO: THREE.TOUCH.DOLLY_PAN
		 * }
		 * ```
		 * @type {Object}
		 */
		this.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };

		/**
		 * Used internally by `saveState()` and `reset()`.
		 *
		 * @type {Vector3}
		 */
		this.target0 = this.target.clone();

		/**
		 * Used internally by `saveState()` and `reset()`.
		 *
		 * @type {Vector3}
		 */
		this.position0 = this.object.position.clone();

		/**
		 * Used internally by `saveState()` and `reset()`.
		 *
		 * @type {number}
		 */
		this.zoom0 = this.object.zoom;

		// the target DOM element for key events
		this._domElementKeyEvents = null;

		// internals

		this._lastPosition = new Vector3();
		this._lastQuaternion = new Quaternion();
		this._lastTargetPosition = new Vector3();

		// so camera.up is the orbit axis
		this._quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );
		this._quatInverse = this._quat.clone().invert();

		// current position in spherical coordinates
		this._spherical = new Spherical();
		this._sphericalDelta = new Spherical();

		this._scale = 1;
		this._panOffset = new Vector3();

		this._rotateStart = new Vector2();
		this._rotateEnd = new Vector2();
		this._rotateDelta = new Vector2();

		this._panStart = new Vector2();
		this._panEnd = new Vector2();
		this._panDelta = new Vector2();

		this._dollyStart = new Vector2();
		this._dollyEnd = new Vector2();
		this._dollyDelta = new Vector2();

		this._dollyDirection = new Vector3();
		this._mouse = new Vector2();
		this._performCursorZoom = false;

		this._pointers = [];
		this._pointerPositions = {};

		this._controlActive = false;

		// event listeners

		this._onPointerMove = onPointerMove.bind( this );
		this._onPointerDown = onPointerDown.bind( this );
		this._onPointerUp = onPointerUp.bind( this );
		this._onContextMenu = onContextMenu.bind( this );
		this._onMouseWheel = onMouseWheel.bind( this );
		this._onKeyDown = onKeyDown.bind( this );

		this._onTouchStart = onTouchStart.bind( this );
		this._onTouchMove = onTouchMove.bind( this );

		this._onMouseDown = onMouseDown.bind( this );
		this._onMouseMove = onMouseMove.bind( this );

		this._interceptControlDown = interceptControlDown.bind( this );
		this._interceptControlUp = interceptControlUp.bind( this );

		//

		if ( this.domElement !== null ) {

			this.connect( this.domElement );

		}

		this.update();

	}

	connect( element ) {

		super.connect( element );

		this.domElement.addEventListener( 'pointerdown', this._onPointerDown );
		this.domElement.addEventListener( 'pointercancel', this._onPointerUp );

		this.domElement.addEventListener( 'contextmenu', this._onContextMenu );
		this.domElement.addEventListener( 'wheel', this._onMouseWheel, { passive: false } );

		const document = this.domElement.getRootNode(); // offscreen canvas compatibility
		document.addEventListener( 'keydown', this._interceptControlDown, { passive: true, capture: true } );

		this.domElement.style.touchAction = 'none'; // disable touch scroll

	}

	disconnect() {

		this.domElement.removeEventListener( 'pointerdown', this._onPointerDown );
		this.domElement.removeEventListener( 'pointermove', this._onPointerMove );
		this.domElement.removeEventListener( 'pointerup', this._onPointerUp );
		this.domElement.removeEventListener( 'pointercancel', this._onPointerUp );

		this.domElement.removeEventListener( 'wheel', this._onMouseWheel );
		this.domElement.removeEventListener( 'contextmenu', this._onContextMenu );

		this.stopListenToKeyEvents();

		const document = this.domElement.getRootNode(); // offscreen canvas compatibility
		document.removeEventListener( 'keydown', this._interceptControlDown, { capture: true } );

		this.domElement.style.touchAction = 'auto';

	}

	dispose() {

		this.disconnect();

	}

	/**
	 * Get the current vertical rotation, in radians.
	 *
	 * @return {number} The current vertical rotation, in radians.
	 */
	getPolarAngle() {

		return this._spherical.phi;

	}

	/**
	 * Get the current horizontal rotation, in radians.
	 *
	 * @return {number} The current horizontal rotation, in radians.
	 */
	getAzimuthalAngle() {

		return this._spherical.theta;

	}

	/**
	 * Returns the distance from the camera to the target.
	 *
	 * @return {number} The distance from the camera to the target.
	 */
	getDistance() {

		return this.object.position.distanceTo( this.target );

	}

	/**
	 * Adds key event listeners to the given DOM element.
	 * `window` is a recommended argument for using this method.
	 *
	 * @param {HTMLDOMElement} domElement - The DOM element
	 */
	listenToKeyEvents( domElement ) {

		domElement.addEventListener( 'keydown', this._onKeyDown );
		this._domElementKeyEvents = domElement;

	}

	/**
	 * Removes the key event listener previously defined with `listenToKeyEvents()`.
	 */
	stopListenToKeyEvents() {

		if ( this._domElementKeyEvents !== null ) {

			this._domElementKeyEvents.removeEventListener( 'keydown', this._onKeyDown );
			this._domElementKeyEvents = null;

		}

	}

	/**
	 * Save the current state of the controls. This can later be recovered with `reset()`.
	 */
	saveState() {

		this.target0.copy( this.target );
		this.position0.copy( this.object.position );
		this.zoom0 = this.object.zoom;

	}

	/**
	 * Reset the controls to their state from either the last time the `saveState()`
	 * was called, or the initial state.
	 */
	reset() {

		this.target.copy( this.target0 );
		this.object.position.copy( this.position0 );
		this.object.zoom = this.zoom0;

		this.object.updateProjectionMatrix();
		this.dispatchEvent( _changeEvent );

		this.update();

		this.state = _STATE.NONE;

	}

	update( deltaTime = null ) {

		const position = this.object.position;

		_v.copy( position ).sub( this.target );

		// rotate offset to "y-axis-is-up" space
		_v.applyQuaternion( this._quat );

		// angle from z-axis around y-axis
		this._spherical.setFromVector3( _v );

		if ( this.autoRotate && this.state === _STATE.NONE ) {

			this._rotateLeft( this._getAutoRotationAngle( deltaTime ) );

		}

		if ( this.enableDamping ) {

			this._spherical.theta += this._sphericalDelta.theta * this.dampingFactor;
			this._spherical.phi += this._sphericalDelta.phi * this.dampingFactor;

		} else {

			this._spherical.theta += this._sphericalDelta.theta;
			this._spherical.phi += this._sphericalDelta.phi;

		}

		// restrict theta to be between desired limits

		let min = this.minAzimuthAngle;
		let max = this.maxAzimuthAngle;

		if ( isFinite( min ) && isFinite( max ) ) {

			if ( min < - Math.PI ) min += _twoPI; else if ( min > Math.PI ) min -= _twoPI;

			if ( max < - Math.PI ) max += _twoPI; else if ( max > Math.PI ) max -= _twoPI;

			if ( min <= max ) {

				this._spherical.theta = Math.max( min, Math.min( max, this._spherical.theta ) );

			} else {

				this._spherical.theta = ( this._spherical.theta > ( min + max ) / 2 ) ?
					Math.max( min, this._spherical.theta ) :
					Math.min( max, this._spherical.theta );

			}

		}

		// restrict phi to be between desired limits
		this._spherical.phi = Math.max( this.minPolarAngle, Math.min( this.maxPolarAngle, this._spherical.phi ) );

		this._spherical.makeSafe();


		// move target to panned location

		if ( this.enableDamping === true ) {

			this.target.addScaledVector( this._panOffset, this.dampingFactor );

		} else {

			this.target.add( this._panOffset );

		}

		// Limit the target distance from the cursor to create a sphere around the center of interest
		this.target.sub( this.cursor );
		this.target.clampLength( this.minTargetRadius, this.maxTargetRadius );
		this.target.add( this.cursor );

		let zoomChanged = false;
		// adjust the camera position based on zoom only if we're not zooming to the cursor or if it's an ortho camera
		// we adjust zoom later in these cases
		if ( this.zoomToCursor && this._performCursorZoom || this.object.isOrthographicCamera ) {

			this._spherical.radius = this._clampDistance( this._spherical.radius );

		} else {

			const prevRadius = this._spherical.radius;
			this._spherical.radius = this._clampDistance( this._spherical.radius * this._scale );
			zoomChanged = prevRadius != this._spherical.radius;

		}

		_v.setFromSpherical( this._spherical );

		// rotate offset back to "camera-up-vector-is-up" space
		_v.applyQuaternion( this._quatInverse );

		position.copy( this.target ).add( _v );

		this.object.lookAt( this.target );

		if ( this.enableDamping === true ) {

			this._sphericalDelta.theta *= ( 1 - this.dampingFactor );
			this._sphericalDelta.phi *= ( 1 - this.dampingFactor );

			this._panOffset.multiplyScalar( 1 - this.dampingFactor );

		} else {

			this._sphericalDelta.set( 0, 0, 0 );

			this._panOffset.set( 0, 0, 0 );

		}

		// adjust camera position
		if ( this.zoomToCursor && this._performCursorZoom ) {

			let newRadius = null;
			if ( this.object.isPerspectiveCamera ) {

				// move the camera down the pointer ray
				// this method avoids floating point error
				const prevRadius = _v.length();
				newRadius = this._clampDistance( prevRadius * this._scale );

				const radiusDelta = prevRadius - newRadius;
				this.object.position.addScaledVector( this._dollyDirection, radiusDelta );
				this.object.updateMatrixWorld();

				zoomChanged = !! radiusDelta;

			} else if ( this.object.isOrthographicCamera ) {

				// adjust the ortho camera position based on zoom changes
				const mouseBefore = new Vector3( this._mouse.x, this._mouse.y, 0 );
				mouseBefore.unproject( this.object );

				const prevZoom = this.object.zoom;
				this.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom / this._scale ) );
				this.object.updateProjectionMatrix();

				zoomChanged = prevZoom !== this.object.zoom;

				const mouseAfter = new Vector3( this._mouse.x, this._mouse.y, 0 );
				mouseAfter.unproject( this.object );

				this.object.position.sub( mouseAfter ).add( mouseBefore );
				this.object.updateMatrixWorld();

				newRadius = _v.length();

			} else {

				console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled.' );
				this.zoomToCursor = false;

			}

			// handle the placement of the target
			if ( newRadius !== null ) {

				if ( this.screenSpacePanning ) {

					// position the orbit target in front of the new camera position
					this.target.set( 0, 0, -1 )
						.transformDirection( this.object.matrix )
						.multiplyScalar( newRadius )
						.add( this.object.position );

				} else {

					// get the ray and translation plane to compute target
					_ray.origin.copy( this.object.position );
					_ray.direction.set( 0, 0, -1 ).transformDirection( this.object.matrix );

					// if the camera is 20 degrees above the horizon then don't adjust the focus target to avoid
					// extremely large values
					if ( Math.abs( this.object.up.dot( _ray.direction ) ) < _TILT_LIMIT ) {

						this.object.lookAt( this.target );

					} else {

						_plane.setFromNormalAndCoplanarPoint( this.object.up, this.target );
						_ray.intersectPlane( _plane, this.target );

					}

				}

			}

		} else if ( this.object.isOrthographicCamera ) {

			const prevZoom = this.object.zoom;
			this.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom / this._scale ) );

			if ( prevZoom !== this.object.zoom ) {

				this.object.updateProjectionMatrix();
				zoomChanged = true;

			}

		}

		this._scale = 1;
		this._performCursorZoom = false;

		// update condition is:
		// min(camera displacement, camera rotation in radians)^2 > EPS
		// using small-angle approximation cos(x/2) = 1 - x^2 / 8

		if ( zoomChanged ||
			this._lastPosition.distanceToSquared( this.object.position ) > _EPS ||
			8 * ( 1 - this._lastQuaternion.dot( this.object.quaternion ) ) > _EPS ||
			this._lastTargetPosition.distanceToSquared( this.target ) > _EPS ) {

			this.dispatchEvent( _changeEvent );

			this._lastPosition.copy( this.object.position );
			this._lastQuaternion.copy( this.object.quaternion );
			this._lastTargetPosition.copy( this.target );

			return true;

		}

		return false;

	}

	_getAutoRotationAngle( deltaTime ) {

		if ( deltaTime !== null ) {

			return ( _twoPI / 60 * this.autoRotateSpeed ) * deltaTime;

		} else {

			return _twoPI / 60 / 60 * this.autoRotateSpeed;

		}

	}

	_getZoomScale( delta ) {

		const normalizedDelta = Math.abs( delta * 0.01 );
		return Math.pow( 0.95, this.zoomSpeed * normalizedDelta );

	}

	_rotateLeft( angle ) {

		this._sphericalDelta.theta -= angle;

	}

	_rotateUp( angle ) {

		this._sphericalDelta.phi -= angle;

	}

	_panLeft( distance, objectMatrix ) {

		_v.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix
		_v.multiplyScalar( - distance );

		this._panOffset.add( _v );

	}

	_panUp( distance, objectMatrix ) {

		if ( this.screenSpacePanning === true ) {

			_v.setFromMatrixColumn( objectMatrix, 1 );

		} else {

			_v.setFromMatrixColumn( objectMatrix, 0 );
			_v.crossVectors( this.object.up, _v );

		}

		_v.multiplyScalar( distance );

		this._panOffset.add( _v );

	}

	// deltaX and deltaY are in pixels; right and down are positive
	_pan( deltaX, deltaY ) {

		const element = this.domElement;

		if ( this.object.isPerspectiveCamera ) {

			// perspective
			const position = this.object.position;
			_v.copy( position ).sub( this.target );
			let targetDistance = _v.length();

			// half of the fov is center to top of screen
			targetDistance *= Math.tan( ( this.object.fov / 2 ) * Math.PI / 180.0 );

			// we use only clientHeight here so aspect ratio does not distort speed
			this._panLeft( 2 * deltaX * targetDistance / element.clientHeight, this.object.matrix );
			this._panUp( 2 * deltaY * targetDistance / element.clientHeight, this.object.matrix );

		} else if ( this.object.isOrthographicCamera ) {

			// orthographic
			this._panLeft( deltaX * ( this.object.right - this.object.left ) / this.object.zoom / element.clientWidth, this.object.matrix );
			this._panUp( deltaY * ( this.object.top - this.object.bottom ) / this.object.zoom / element.clientHeight, this.object.matrix );

		} else {

			// camera neither orthographic nor perspective
			console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );
			this.enablePan = false;

		}

	}

	_dollyOut( dollyScale ) {

		if ( this.object.isPerspectiveCamera || this.object.isOrthographicCamera ) {

			this._scale /= dollyScale;

		} else {

			console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );
			this.enableZoom = false;

		}

	}

	_dollyIn( dollyScale ) {

		if ( this.object.isPerspectiveCamera || this.object.isOrthographicCamera ) {

			this._scale *= dollyScale;

		} else {

			console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );
			this.enableZoom = false;

		}

	}

	_updateZoomParameters( x, y ) {

		if ( ! this.zoomToCursor ) {

			return;

		}

		this._performCursorZoom = true;

		const rect = this.domElement.getBoundingClientRect();
		const dx = x - rect.left;
		const dy = y - rect.top;
		const w = rect.width;
		const h = rect.height;

		this._mouse.x = ( dx / w ) * 2 - 1;
		this._mouse.y = - ( dy / h ) * 2 + 1;

		this._dollyDirection.set( this._mouse.x, this._mouse.y, 1 ).unproject( this.object ).sub( this.object.position ).normalize();

	}

	_clampDistance( dist ) {

		return Math.max( this.minDistance, Math.min( this.maxDistance, dist ) );

	}

	//
	// event callbacks - update the object state
	//

	_handleMouseDownRotate( event ) {

		this._rotateStart.set( event.clientX, event.clientY );

	}

	_handleMouseDownDolly( event ) {

		this._updateZoomParameters( event.clientX, event.clientX );
		this._dollyStart.set( event.clientX, event.clientY );

	}

	_handleMouseDownPan( event ) {

		this._panStart.set( event.clientX, event.clientY );

	}

	_handleMouseMoveRotate( event ) {

		this._rotateEnd.set( event.clientX, event.clientY );

		this._rotateDelta.subVectors( this._rotateEnd, this._rotateStart ).multiplyScalar( this.rotateSpeed );

		const element = this.domElement;

		this._rotateLeft( _twoPI * this._rotateDelta.x / element.clientHeight ); // yes, height

		this._rotateUp( _twoPI * this._rotateDelta.y / element.clientHeight );

		this._rotateStart.copy( this._rotateEnd );

		this.update();

	}

	_handleMouseMoveDolly( event ) {

		this._dollyEnd.set( event.clientX, event.clientY );

		this._dollyDelta.subVectors( this._dollyEnd, this._dollyStart );

		if ( this._dollyDelta.y > 0 ) {

			this._dollyOut( this._getZoomScale( this._dollyDelta.y ) );

		} else if ( this._dollyDelta.y < 0 ) {

			this._dollyIn( this._getZoomScale( this._dollyDelta.y ) );

		}

		this._dollyStart.copy( this._dollyEnd );

		this.update();

	}

	_handleMouseMovePan( event ) {

		this._panEnd.set( event.clientX, event.clientY );

		this._panDelta.subVectors( this._panEnd, this._panStart ).multiplyScalar( this.panSpeed );

		this._pan( this._panDelta.x, this._panDelta.y );

		this._panStart.copy( this._panEnd );

		this.update();

	}

	_handleMouseWheel( event ) {

		this._updateZoomParameters( event.clientX, event.clientY );

		if ( event.deltaY < 0 ) {

			this._dollyIn( this._getZoomScale( event.deltaY ) );

		} else if ( event.deltaY > 0 ) {

			this._dollyOut( this._getZoomScale( event.deltaY ) );

		}

		this.update();

	}

	_handleKeyDown( event ) {

		let needsUpdate = false;

		switch ( event.code ) {

			case this.keys.UP:

				if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

					if ( this.enableRotate ) {

						this._rotateUp( _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );

					}

				} else {

					if ( this.enablePan ) {

						this._pan( 0, this.keyPanSpeed );

					}

				}

				needsUpdate = true;
				break;

			case this.keys.BOTTOM:

				if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

					if ( this.enableRotate ) {

						this._rotateUp( - _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );

					}

				} else {

					if ( this.enablePan ) {

						this._pan( 0, - this.keyPanSpeed );

					}

				}

				needsUpdate = true;
				break;

			case this.keys.LEFT:

				if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

					if ( this.enableRotate ) {

						this._rotateLeft( _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );

					}

				} else {

					if ( this.enablePan ) {

						this._pan( this.keyPanSpeed, 0 );

					}

				}

				needsUpdate = true;
				break;

			case this.keys.RIGHT:

				if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

					if ( this.enableRotate ) {

						this._rotateLeft( - _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );

					}

				} else {

					if ( this.enablePan ) {

						this._pan( - this.keyPanSpeed, 0 );

					}

				}

				needsUpdate = true;
				break;

		}

		if ( needsUpdate ) {

			// prevent the browser from scrolling on cursor keys
			event.preventDefault();

			this.update();

		}


	}

	_handleTouchStartRotate( event ) {

		if ( this._pointers.length === 1 ) {

			this._rotateStart.set( event.pageX, event.pageY );

		} else {

			const position = this._getSecondPointerPosition( event );

			const x = 0.5 * ( event.pageX + position.x );
			const y = 0.5 * ( event.pageY + position.y );

			this._rotateStart.set( x, y );

		}

	}

	_handleTouchStartPan( event ) {

		if ( this._pointers.length === 1 ) {

			this._panStart.set( event.pageX, event.pageY );

		} else {

			const position = this._getSecondPointerPosition( event );

			const x = 0.5 * ( event.pageX + position.x );
			const y = 0.5 * ( event.pageY + position.y );

			this._panStart.set( x, y );

		}

	}

	_handleTouchStartDolly( event ) {

		const position = this._getSecondPointerPosition( event );

		const dx = event.pageX - position.x;
		const dy = event.pageY - position.y;

		const distance = Math.sqrt( dx * dx + dy * dy );

		this._dollyStart.set( 0, distance );

	}

	_handleTouchStartDollyPan( event ) {

		if ( this.enableZoom ) this._handleTouchStartDolly( event );

		if ( this.enablePan ) this._handleTouchStartPan( event );

	}

	_handleTouchStartDollyRotate( event ) {

		if ( this.enableZoom ) this._handleTouchStartDolly( event );

		if ( this.enableRotate ) this._handleTouchStartRotate( event );

	}

	_handleTouchMoveRotate( event ) {

		if ( this._pointers.length == 1 ) {

			this._rotateEnd.set( event.pageX, event.pageY );

		} else {

			const position = this._getSecondPointerPosition( event );

			const x = 0.5 * ( event.pageX + position.x );
			const y = 0.5 * ( event.pageY + position.y );

			this._rotateEnd.set( x, y );

		}

		this._rotateDelta.subVectors( this._rotateEnd, this._rotateStart ).multiplyScalar( this.rotateSpeed );

		const element = this.domElement;

		this._rotateLeft( _twoPI * this._rotateDelta.x / element.clientHeight ); // yes, height

		this._rotateUp( _twoPI * this._rotateDelta.y / element.clientHeight );

		this._rotateStart.copy( this._rotateEnd );

	}

	_handleTouchMovePan( event ) {

		if ( this._pointers.length === 1 ) {

			this._panEnd.set( event.pageX, event.pageY );

		} else {

			const position = this._getSecondPointerPosition( event );

			const x = 0.5 * ( event.pageX + position.x );
			const y = 0.5 * ( event.pageY + position.y );

			this._panEnd.set( x, y );

		}

		this._panDelta.subVectors( this._panEnd, this._panStart ).multiplyScalar( this.panSpeed );

		this._pan( this._panDelta.x, this._panDelta.y );

		this._panStart.copy( this._panEnd );

	}

	_handleTouchMoveDolly( event ) {

		const position = this._getSecondPointerPosition( event );

		const dx = event.pageX - position.x;
		const dy = event.pageY - position.y;

		const distance = Math.sqrt( dx * dx + dy * dy );

		this._dollyEnd.set( 0, distance );

		this._dollyDelta.set( 0, Math.pow( this._dollyEnd.y / this._dollyStart.y, this.zoomSpeed ) );

		this._dollyOut( this._dollyDelta.y );

		this._dollyStart.copy( this._dollyEnd );

		const centerX = ( event.pageX + position.x ) * 0.5;
		const centerY = ( event.pageY + position.y ) * 0.5;

		this._updateZoomParameters( centerX, centerY );

	}

	_handleTouchMoveDollyPan( event ) {

		if ( this.enableZoom ) this._handleTouchMoveDolly( event );

		if ( this.enablePan ) this._handleTouchMovePan( event );

	}

	_handleTouchMoveDollyRotate( event ) {

		if ( this.enableZoom ) this._handleTouchMoveDolly( event );

		if ( this.enableRotate ) this._handleTouchMoveRotate( event );

	}

	// pointers

	_addPointer( event ) {

		this._pointers.push( event.pointerId );

	}

	_removePointer( event ) {

		delete this._pointerPositions[ event.pointerId ];

		for ( let i = 0; i < this._pointers.length; i ++ ) {

			if ( this._pointers[ i ] == event.pointerId ) {

				this._pointers.splice( i, 1 );
				return;

			}

		}

	}

	_isTrackingPointer( event ) {

		for ( let i = 0; i < this._pointers.length; i ++ ) {

			if ( this._pointers[ i ] == event.pointerId ) return true;

		}

		return false;

	}

	_trackPointer( event ) {

		let position = this._pointerPositions[ event.pointerId ];

		if ( position === undefined ) {

			position = new Vector2();
			this._pointerPositions[ event.pointerId ] = position;

		}

		position.set( event.pageX, event.pageY );

	}

	_getSecondPointerPosition( event ) {

		const pointerId = ( event.pointerId === this._pointers[ 0 ] ) ? this._pointers[ 1 ] : this._pointers[ 0 ];

		return this._pointerPositions[ pointerId ];

	}

	//

	_customWheelEvent( event ) {

		const mode = event.deltaMode;

		// minimal wheel event altered to meet delta-zoom demand
		const newEvent = {
			clientX: event.clientX,
			clientY: event.clientY,
			deltaY: event.deltaY,
		};

		switch ( mode ) {

			case 1: // LINE_MODE
				newEvent.deltaY *= 16;
				break;

			case 2: // PAGE_MODE
				newEvent.deltaY *= 100;
				break;

		}

		// detect if event was triggered by pinching
		if ( event.ctrlKey && ! this._controlActive ) {

			newEvent.deltaY *= 10;

		}

		return newEvent;

	}

}

function onPointerDown( event ) {

	if ( this.enabled === false ) return;

	if ( this._pointers.length === 0 ) {

		this.domElement.setPointerCapture( event.pointerId );

		this.domElement.addEventListener( 'pointermove', this._onPointerMove );
		this.domElement.addEventListener( 'pointerup', this._onPointerUp );

	}

	//

	if ( this._isTrackingPointer( event ) ) return;

	//

	this._addPointer( event );

	if ( event.pointerType === 'touch' ) {

		this._onTouchStart( event );

	} else {

		this._onMouseDown( event );

	}

}

function onPointerMove( event ) {

	if ( this.enabled === false ) return;

	if ( event.pointerType === 'touch' ) {

		this._onTouchMove( event );

	} else {

		this._onMouseMove( event );

	}

}

function onPointerUp( event ) {

	this._removePointer( event );

	switch ( this._pointers.length ) {

		case 0:

			this.domElement.releasePointerCapture( event.pointerId );

			this.domElement.removeEventListener( 'pointermove', this._onPointerMove );
			this.domElement.removeEventListener( 'pointerup', this._onPointerUp );

			this.dispatchEvent( _endEvent );

			this.state = _STATE.NONE;

			break;

		case 1:

			const pointerId = this._pointers[ 0 ];
			const position = this._pointerPositions[ pointerId ];

			// minimal placeholder event - allows state correction on pointer-up
			this._onTouchStart( { pointerId: pointerId, pageX: position.x, pageY: position.y } );

			break;

	}

}

function onMouseDown( event ) {

	let mouseAction;

	switch ( event.button ) {

		case 0:

			mouseAction = this.mouseButtons.LEFT;
			break;

		case 1:

			mouseAction = this.mouseButtons.MIDDLE;
			break;

		case 2:

			mouseAction = this.mouseButtons.RIGHT;
			break;

		default:

			mouseAction = -1;

	}

	switch ( mouseAction ) {

		case MOUSE.DOLLY:

			if ( this.enableZoom === false ) return;

			this._handleMouseDownDolly( event );

			this.state = _STATE.DOLLY;

			break;

		case MOUSE.ROTATE:

			if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

				if ( this.enablePan === false ) return;

				this._handleMouseDownPan( event );

				this.state = _STATE.PAN;

			} else {

				if ( this.enableRotate === false ) return;

				this._handleMouseDownRotate( event );

				this.state = _STATE.ROTATE;

			}

			break;

		case MOUSE.PAN:

			if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

				if ( this.enableRotate === false ) return;

				this._handleMouseDownRotate( event );

				this.state = _STATE.ROTATE;

			} else {

				if ( this.enablePan === false ) return;

				this._handleMouseDownPan( event );

				this.state = _STATE.PAN;

			}

			break;

		default:

			this.state = _STATE.NONE;

	}

	if ( this.state !== _STATE.NONE ) {

		this.dispatchEvent( _startEvent );

	}

}

function onMouseMove( event ) {

	switch ( this.state ) {

		case _STATE.ROTATE:

			if ( this.enableRotate === false ) return;

			this._handleMouseMoveRotate( event );

			break;

		case _STATE.DOLLY:

			if ( this.enableZoom === false ) return;

			this._handleMouseMoveDolly( event );

			break;

		case _STATE.PAN:

			if ( this.enablePan === false ) return;

			this._handleMouseMovePan( event );

			break;

	}

}

function onMouseWheel( event ) {

	if ( this.enabled === false || this.enableZoom === false || this.state !== _STATE.NONE ) return;

	event.preventDefault();

	this.dispatchEvent( _startEvent );

	this._handleMouseWheel( this._customWheelEvent( event ) );

	this.dispatchEvent( _endEvent );

}

function onKeyDown( event ) {

	if ( this.enabled === false ) return;

	this._handleKeyDown( event );

}

function onTouchStart( event ) {

	this._trackPointer( event );

	switch ( this._pointers.length ) {

		case 1:

			switch ( this.touches.ONE ) {

				case TOUCH.ROTATE:

					if ( this.enableRotate === false ) return;

					this._handleTouchStartRotate( event );

					this.state = _STATE.TOUCH_ROTATE;

					break;

				case TOUCH.PAN:

					if ( this.enablePan === false ) return;

					this._handleTouchStartPan( event );

					this.state = _STATE.TOUCH_PAN;

					break;

				default:

					this.state = _STATE.NONE;

			}

			break;

		case 2:

			switch ( this.touches.TWO ) {

				case TOUCH.DOLLY_PAN:

					if ( this.enableZoom === false && this.enablePan === false ) return;

					this._handleTouchStartDollyPan( event );

					this.state = _STATE.TOUCH_DOLLY_PAN;

					break;

				case TOUCH.DOLLY_ROTATE:

					if ( this.enableZoom === false && this.enableRotate === false ) return;

					this._handleTouchStartDollyRotate( event );

					this.state = _STATE.TOUCH_DOLLY_ROTATE;

					break;

				default:

					this.state = _STATE.NONE;

			}

			break;

		default:

			this.state = _STATE.NONE;

	}

	if ( this.state !== _STATE.NONE ) {

		this.dispatchEvent( _startEvent );

	}

}

function onTouchMove( event ) {

	this._trackPointer( event );

	switch ( this.state ) {

		case _STATE.TOUCH_ROTATE:

			if ( this.enableRotate === false ) return;

			this._handleTouchMoveRotate( event );

			this.update();

			break;

		case _STATE.TOUCH_PAN:

			if ( this.enablePan === false ) return;

			this._handleTouchMovePan( event );

			this.update();

			break;

		case _STATE.TOUCH_DOLLY_PAN:

			if ( this.enableZoom === false && this.enablePan === false ) return;

			this._handleTouchMoveDollyPan( event );

			this.update();

			break;

		case _STATE.TOUCH_DOLLY_ROTATE:

			if ( this.enableZoom === false && this.enableRotate === false ) return;

			this._handleTouchMoveDollyRotate( event );

			this.update();

			break;

		default:

			this.state = _STATE.NONE;

	}

}

function onContextMenu( event ) {

	if ( this.enabled === false ) return;

	event.preventDefault();

}

function interceptControlDown( event ) {

	if ( event.key === 'Control' ) {

		this._controlActive = true;

		const document = this.domElement.getRootNode(); // offscreen canvas compatibility

		document.addEventListener( 'keyup', this._interceptControlUp, { passive: true, capture: true } );

	}

}

function interceptControlUp( event ) {

	if ( event.key === 'Control' ) {

		this._controlActive = false;

		const document = this.domElement.getRootNode(); // offscreen canvas compatibility

		document.removeEventListener( 'keyup', this._interceptControlUp, { passive: true, capture: true } );

	}

}

class SeededRandom {
  seed;
  constructor(seed) {
    this.seed = seed;
  }
  next() {
    const x = Math.sin(this.seed++) * 1e4;
    return x - Math.floor(x);
  }
}
function noise1D(x) {
  const i = Math.floor(x);
  const f = x - i;
  const u = f * f * (3 - 2 * f);
  const a = Math.sin(i * 12.9898 + 78.233) * 43758.5453123;
  const b = Math.sin((i + 1) * 12.9898 + 78.233) * 43758.5453123;
  return (a - Math.floor(a)) * (1 - u) + (b - Math.floor(b)) * u;
}
function buildFractalTunnel(config) {
  const { rings, segments, radius, depth, twist = 0 } = config;
  const rng = new SeededRandom(42);
  const positions = [];
  const indices = [];
  for (let r = 0; r <= rings; r++) {
    const t = r / rings;
    const z = t * depth;
    const twistAngle = t * twist;
    const currentRadius = radius * Math.pow(1 - t, 1.2) + 0.5;
    for (let s = 0; s <= segments; s++) {
      const baseTheta = s / segments * Math.PI * 2;
      const theta = baseTheta + twistAngle;
      const noiseVal = noise1D(r * 0.3 + s * 0.15) * 0.15;
      const jitterR = (rng.next() - 0.5) * currentRadius * 0.08;
      const jitterZ = (rng.next() - 0.5) * 0.3;
      const x = Math.cos(theta) * (currentRadius + noiseVal + jitterR);
      const y = Math.sin(theta) * (currentRadius + noiseVal + jitterR);
      positions.push(x, y, z + jitterZ);
    }
  }
  for (let r = 0; r < rings; r++) {
    for (let s = 0; s < segments; s++) {
      const current = r * (segments + 1) + s;
      const next = current + segments + 1;
      indices.push(current, next, current + 1);
      indices.push(current + 1, next, next + 1);
    }
  }
  return {
    positions: new Float32Array(positions),
    indices: new Uint32Array(indices)
  };
}

var NodeState = /* @__PURE__ */ ((NodeState2) => {
  NodeState2[NodeState2["LOCKED"] = 0] = "LOCKED";
  NodeState2[NodeState2["DISCOVERED"] = 1] = "DISCOVERED";
  NodeState2[NodeState2["LINKED"] = 2] = "LINKED";
  return NodeState2;
})(NodeState || {});
const NODE_COLORS = {
  [0 /* LOCKED */]: 5592422,
  // Brighter gray for visibility
  [1 /* DISCOVERED */]: 65535,
  // Pure bright cyan
  [2 /* LINKED */]: 13395711
  // Brighter violet
};
const THEME_NAMES = {
  "Etica": ["Compasso", "Bilancia", "Scudo", "Luce"],
  "Strategia": ["Torre", "Sentinella", "Occhio", "Mappa"],
  "Adattivit": ["Camaleonte", "Riflesso", "Onda", "Foglia"],
  "Visione": ["Stella", "Prisma", "Faro", "Oracolo"]
};
class NodeLayer {
  scene;
  // Can be Scene or Group
  nodes = [];
  instancedMesh = null;
  geometry;
  constructor(parent, tunnelGeometry) {
    this.scene = parent;
    this.geometry = tunnelGeometry;
  }
  /**
   * Initialize 48 nodes with deterministic themes and symbolic names
   */
  initialize(nodeCount, seed = 42) {
    const positions = this.geometry.attributes.position;
    const totalVertices = positions.count;
    const step = Math.floor(totalVertices / nodeCount);
    this.nodes = [];
    const themes = ["Etica", "Strategia", "Adattivit", "Visione"];
    for (let i = 0; i < nodeCount; i++) {
      const idx = i * step;
      if (idx >= totalVertices) break;
      const position = new Vector3(
        positions.getX(idx),
        positions.getY(idx),
        positions.getZ(idx)
      );
      const themeIndex = (seed + i * 7) % themes.length;
      const theme = themes[themeIndex];
      const nameIndex = Math.floor(i / themes.length) % THEME_NAMES[theme].length;
      const name = `${theme} ${THEME_NAMES[theme][nameIndex]}`;
      this.nodes.push({
        id: i,
        position,
        state: 0 /* LOCKED */,
        theme,
        name
      });
    }
    this.createInstancedMesh();
  }
  createInstancedMesh() {
    if (this.instancedMesh) {
      this.scene.remove(this.instancedMesh);
      this.instancedMesh.geometry.dispose();
      this.instancedMesh.material.dispose();
    }
    const sphereGeometry = new SphereGeometry(0.24, 12, 12);
    const material = new MeshBasicMaterial({
      transparent: false,
      depthTest: false,
      // Render on top
      depthWrite: true
    });
    this.instancedMesh = new InstancedMesh(
      sphereGeometry,
      material,
      this.nodes.length
    );
    this.instancedMesh.renderOrder = 1e4;
    this.instancedMesh.frustumCulled = false;
    const matrix = new Matrix4();
    const color = new Color();
    for (let i = 0; i < this.nodes.length; i++) {
      const node = this.nodes[i];
      matrix.setPosition(node.position);
      this.instancedMesh.setMatrixAt(i, matrix);
      color.setHex(NODE_COLORS[node.state]);
      this.instancedMesh.setColorAt(i, color);
    }
    this.instancedMesh.instanceMatrix.needsUpdate = true;
    if (this.instancedMesh.instanceColor) {
      this.instancedMesh.instanceColor.needsUpdate = true;
    }
    this.scene.add(this.instancedMesh);
  }
  raycast(raycaster) {
    if (!this.instancedMesh) return null;
    const intersects = raycaster.intersectObject(this.instancedMesh);
    if (intersects.length > 0 && intersects[0].instanceId !== void 0) {
      return intersects[0].instanceId;
    }
    return null;
  }
  getNode(nodeId) {
    return this.nodes.find((n) => n.id === nodeId) || null;
  }
  getNodeState(nodeId) {
    const node = this.getNode(nodeId);
    return node ? node.state : null;
  }
  setNodeState(nodeId, state) {
    const node = this.getNode(nodeId);
    if (!node || !this.instancedMesh) return;
    node.state = state;
    const color = new Color(NODE_COLORS[state]);
    this.instancedMesh.setColorAt(nodeId, color);
    if (this.instancedMesh.instanceColor) {
      this.instancedMesh.instanceColor.needsUpdate = true;
    }
    const matrix = new Matrix4();
    const scale = new Vector3(2, 2, 2);
    matrix.compose(node.position, new Quaternion(), scale);
    this.instancedMesh.setMatrixAt(nodeId, matrix);
    this.instancedMesh.instanceMatrix.needsUpdate = true;
    setTimeout(() => {
      if (!this.instancedMesh) return;
      const resetMatrix = new Matrix4();
      const resetScale = new Vector3(1, 1, 1);
      resetMatrix.compose(node.position, new Quaternion(), resetScale);
      this.instancedMesh.setMatrixAt(nodeId, resetMatrix);
      this.instancedMesh.instanceMatrix.needsUpdate = true;
    }, 300);
  }
  getStats() {
    const discovered = this.nodes.filter((n) => n.state === 1 /* DISCOVERED */ || n.state === 2 /* LINKED */).length;
    const linked = this.nodes.filter((n) => n.state === 2 /* LINKED */).length;
    return { discovered, linked };
  }
  /**
   * Update with hover highlight and pulse animations
   */
  update(elapsedTime, hoveredNodeId = null) {
    if (!this.instancedMesh) return;
    const matrix = new Matrix4();
    const scale = new Vector3();
    const color = new Color();
    for (let i = 0; i < this.nodes.length; i++) {
      const node = this.nodes[i];
      let pulseScale = 1;
      if (node.state === 1 /* DISCOVERED */) {
        pulseScale = 1 + Math.sin(elapsedTime * 3 + i * 0.5) * 0.25;
      } else if (node.state === 2 /* LINKED */) {
        pulseScale = 1 + Math.sin(elapsedTime * 2 + i * 0.3) * 0.2;
      }
      if (hoveredNodeId === node.id) {
        pulseScale *= 2;
        color.setHex(NODE_COLORS[node.state]).multiplyScalar(2);
        this.instancedMesh.setColorAt(i, color);
      } else {
        color.setHex(NODE_COLORS[node.state]).multiplyScalar(1.3);
        this.instancedMesh.setColorAt(i, color);
      }
      scale.set(pulseScale, pulseScale, pulseScale);
      matrix.compose(node.position, new Quaternion(), scale);
      this.instancedMesh.setMatrixAt(i, matrix);
    }
    this.instancedMesh.instanceMatrix.needsUpdate = true;
    if (this.instancedMesh.instanceColor) {
      this.instancedMesh.instanceColor.needsUpdate = true;
    }
  }
  regenerate(tunnelGeometry, nodeCount, seed = 42) {
    this.geometry = tunnelGeometry;
    this.initialize(nodeCount, seed);
  }
  dispose() {
    if (this.instancedMesh) {
      this.scene.remove(this.instancedMesh);
      this.instancedMesh.geometry.dispose();
      this.instancedMesh.material.dispose();
    }
  }
}

function usePickNode(nodeLayer, camera, canvas) {
  const raycaster = reactExports.useRef(new Raycaster());
  const throttleRef = reactExports.useRef(0);
  const pickNode = reactExports.useCallback((event) => {
    if (!nodeLayer || !camera || !canvas) return null;
    const now = performance.now();
    if (now - throttleRef.current < 50) return null;
    throttleRef.current = now;
    const rect = canvas.getBoundingClientRect();
    const mouse = new Vector2(
      (event.clientX - rect.left) / rect.width * 2 - 1,
      -((event.clientY - rect.top) / rect.height) * 2 + 1
    );
    raycaster.current.setFromCamera(mouse, camera);
    const nodeId = nodeLayer.raycast(raycaster.current);
    if (nodeId !== null) {
      const node = nodeLayer.getNode(nodeId);
      if (node) {
        const pickEvent = {
          nodeId,
          theme: node.theme,
          worldPos: node.position.clone()
        };
        window.dispatchEvent(new CustomEvent("mindfractal:node-selected", {
          detail: pickEvent
        }));
      }
    }
    return nodeId;
  }, [nodeLayer, camera, canvas]);
  return { pickNode };
}

class LinkEngine {
  lastLinkTime = 0;
  COOLDOWN_MS = 500;
  MAX_DISTANCE_RATIO = 0.12;
  tunnelLength;
  constructor(tunnelLength) {
    this.tunnelLength = tunnelLength;
  }
  /**
   * Check if two nodes can be linked
   */
  canLink(nodeA, nodeB) {
    const now = performance.now();
    if (now - this.lastLinkTime < this.COOLDOWN_MS) {
      return { valid: false, reason: "cooldown" };
    }
    const distance = nodeA.position.distanceTo(nodeB.position);
    const maxDist = this.tunnelLength * this.MAX_DISTANCE_RATIO;
    if (distance > maxDist) {
      return { valid: false, reason: "too_far" };
    }
    return { valid: true };
  }
  /**
   * Create link between two nodes
   */
  createLink(nodeA, nodeB) {
    const check = this.canLink(nodeA, nodeB);
    if (!check.valid) {
      return null;
    }
    this.lastLinkTime = performance.now();
    const result = {
      from: nodeA.id,
      to: nodeB.id,
      length: nodeA.position.distanceTo(nodeB.position),
      ts: Date.now()
    };
    window.dispatchEvent(new CustomEvent("mindfractal:link-created", {
      detail: result
    }));
    return result;
  }
}

const arcVertexShader = `
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`;
const arcFragmentShader = `
uniform float uTime;
uniform float uLifetimeRatio;
uniform vec3 uColor;
uniform float uIsLink;
varying vec2 vUv;

float hash(vec2 p) {
  return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
}

float noise(vec2 p) {
  vec2 i = floor(p);
  vec2 f = fract(p);
  f = f * f * (3.0 - 2.0 * f);
  float a = hash(i);
  float b = hash(i + vec2(1.0, 0.0));
  float c = hash(i + vec2(0.0, 1.0));
  float d = hash(i + vec2(1.0, 1.0));
  return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
}

void main() {
  float t = vUv.x - uTime * 2.0;
  float wave = noise(vec2(t * 8.0, uTime * 3.0)) * 0.5 + 0.5;
  float taper = smoothstep(0.0, 0.1, vUv.y) * smoothstep(1.0, 0.9, vUv.y);
  
  vec3 color = uColor;
  
  // White spike at wave peak (last 15%) - BOOSTED
  if (wave > 0.85) {
    color = mix(color, vec3(3.0), (wave - 0.85) / 0.15); // Extreme white spike
  }
  
  // Link arcs are ULTRA bright for maximum visibility
  float brightnessMod = mix(3.0, 5.0, uIsLink); // 5x for link arcs (pure white)
  float alpha = wave * taper * (1.0 - uLifetimeRatio) * brightnessMod;
  
  // Boost base visibility
  alpha = clamp(alpha * 1.5, 0.0, 1.0);
  
  gl_FragColor = vec4(color, alpha);
}
`;
class GridArcPool {
  scene;
  parent = null;
  // [MF3D] Parent for arcs (align with tunnelGroup)
  arcs = [];
  edges = [];
  maxArcs = 200;
  // Dynamic, will be adjusted by budgeter
  lastIdleSpawn = 0;
  lastSurge = 0;
  surgeInterval = 3e3 + Math.random() * 3e3;
  // 3-6s randomized
  ringsPerSegment = 0;
  // Will be calculated from geometry
  // [MF3D] Dynamic FPS budgeter
  fpsTarget = 60;
  currentFPS = 60;
  targetRate = 7;
  // Hz, dynamically adjusted
  lastBudgetAdjust = 0;
  BUDGET_ADJUST_INTERVAL = 500;
  // Adjust every 500ms
  constructor(scene) {
    this.scene = scene;
  }
  // [MF3D] Attach arcs to a parent (e.g., tunnelGroup) so they inherit breath/twist
  setParent(parent) {
    this.parent = parent;
  }
  // [MF3D] Set FPS target for dynamic budgeting
  setFPSTarget(target) {
    this.fpsTarget = target;
  }
  // [MF3D] Update current FPS for budgeting
  setCurrentFPS(fps) {
    this.currentFPS = fps;
    this.adjustBudget();
  }
  // [MF3D] Dynamic budget adjustment based on FPS
  adjustBudget() {
    const now = performance.now();
    if (now - this.lastBudgetAdjust < this.BUDGET_ADJUST_INTERVAL) return;
    this.lastBudgetAdjust = now;
    const oldRate = this.targetRate;
    const oldMax = this.maxArcs;
    if (this.currentFPS < this.fpsTarget) {
      this.targetRate = Math.max(2, this.targetRate * 0.9);
      this.maxArcs = Math.max(80, Math.floor(this.maxArcs * 0.9));
    } else if (this.currentFPS >= this.fpsTarget + 5) {
      this.targetRate = Math.min(7, this.targetRate * 1.1);
      this.maxArcs = Math.min(200, Math.floor(this.maxArcs * 1.1));
    }
    if (oldRate !== this.targetRate || oldMax !== this.maxArcs) ;
  }
  // [MF3D] Get pool stats
  getStats() {
    return {
      active: this.arcs.length,
      max: this.maxArcs,
      rate: this.targetRate
    };
  }
  /**
   * Build edge list from tunnel geometry and calculate ring structure
   */
  bindGeometry(geometry) {
    this.edges = [];
    const pos = geometry.getAttribute("position");
    const index = geometry.getIndex();
    if (!index || !pos) return;
    const getVec = (i) => new Vector3(pos.getX(i), pos.getY(i), pos.getZ(i));
    for (let i = 0; i < index.count; i += 3) {
      const a = index.getX(i);
      const b = index.getX(i + 1);
      const c = index.getX(i + 2);
      this.edges.push([getVec(a), getVec(b)]);
      this.edges.push([getVec(b), getVec(c)]);
      this.edges.push([getVec(c), getVec(a)]);
    }
    const uniqueZ = /* @__PURE__ */ new Set();
    for (let i = 0; i < pos.count; i++) {
      uniqueZ.add(Math.round(pos.getZ(i) * 10) / 10);
    }
    const estimatedRings = uniqueZ.size;
    this.ringsPerSegment = estimatedRings > 0 ? Math.floor(this.edges.length / estimatedRings) : 64;
  }
  /**
   * Spawn ULTRA BRIGHT white link arc (pure white, maximum visibility)
   */
  spawnLinkArc(start, end) {
    this.createArc(start, end, 0.6, new Color(16777215), true);
  }
  /**
   * Update and spawn idle arcs + periodic surge (uses dynamic budgeter)
   */
  update(deltaTime, opts) {
    const now = performance.now();
    const effectiveRate = opts.reduced ? this.targetRate * 0.5 : this.targetRate;
    const interval = 1e3 / effectiveRate;
    if (now - this.lastIdleSpawn > interval && this.edges.length > 0) {
      this.spawnIdleArcChain();
      this.lastIdleSpawn = now;
    }
    if (now - this.lastSurge > this.surgeInterval && this.edges.length > 0) {
      this.spawnSurge();
      this.lastSurge = now;
      this.surgeInterval = 3e3 + Math.random() * 3e3;
    }
    for (let i = this.arcs.length - 1; i >= 0; i--) {
      const arc = this.arcs[i];
      const age = now - arc.birthTime;
      const ratio = age / arc.lifetime;
      if (ratio >= 1) {
        (this.parent ?? this.scene).remove(arc.mesh);
        arc.mesh.geometry.dispose();
        arc.material.dispose();
        this.arcs.splice(i, 1);
      } else {
        arc.material.uniforms.uTime.value += deltaTime;
        arc.material.uniforms.uLifetimeRatio.value = ratio;
      }
    }
  }
  /**
   * Spawn short chain of arcs along edges
   */
  spawnIdleArcChain() {
    const chainLength = 5 + Math.floor(Math.random() * 8);
    let startIdx = Math.floor(Math.random() * this.edges.length);
    const hue = 0.55 + Math.random() * 0.1;
    const color = new Color().setHSL(hue, 1, 0.6);
    const ttl = 0.5 + Math.random() * 0.3;
    for (let i = 0; i < chainLength && startIdx < this.edges.length; i++) {
      const [p0, p1] = this.edges[startIdx];
      if (p0 && p1) {
        this.createArc(p0, p1, ttl, color, false);
      }
      startIdx = (startIdx + 1 + Math.floor(Math.random() * 3)) % this.edges.length;
    }
  }
  /**
   * Create tube arc between two points
   */
  createArc(start, end, ttl, color, isLink) {
    if (this.arcs.length >= this.maxArcs) {
      const oldest = this.arcs.shift();
      if (oldest) {
        (this.parent ?? this.scene).remove(oldest.mesh);
        oldest.mesh.geometry.dispose();
        oldest.material.dispose();
      }
    }
    const curve = new LineCurve3(start, end);
    const radius = isLink ? 0.2 : 0.12;
    const geometry = new TubeGeometry(curve, 16, radius, 8, false);
    const material = new ShaderMaterial({
      uniforms: {
        uTime: { value: 0 },
        uLifetimeRatio: { value: 0 },
        uColor: { value: color },
        uIsLink: { value: isLink ? 1 : 0 }
      },
      vertexShader: arcVertexShader,
      fragmentShader: arcFragmentShader,
      transparent: true,
      blending: AdditiveBlending,
      depthWrite: false,
      depthTest: false
      // CRITICAL: Render on top of tunnel mesh
    });
    const mesh = new Mesh(geometry, material);
    mesh.renderOrder = 2e4;
    mesh.frustumCulled = false;
    (this.parent ?? this.scene).add(mesh);
    this.arcs.push({
      mesh,
      material,
      birthTime: performance.now(),
      lifetime: ttl * 1e3,
      isLink
    });
  }
  /**
   * Spawn SURGE effect - ENHANCED propagating discharge across 8-14 rings
   */
  spawnSurge() {
    const ringCount = 8 + Math.floor(Math.random() * 7);
    const surgeDuration = 250 + Math.random() * 200;
    const delayPerRing = surgeDuration / ringCount;
    const startRing = Math.floor(Math.random() * (this.edges.length / this.ringsPerSegment - ringCount));
    for (let r = 0; r < ringCount; r++) {
      setTimeout(() => {
        const ringStartIdx = (startRing + r) * this.ringsPerSegment;
        const ringEndIdx = Math.min(ringStartIdx + this.ringsPerSegment, this.edges.length);
        const progress = r / ringCount;
        const hue = 0.52 + progress * 0.08;
        const color = new Color().setHSL(hue, 1, 0.65);
        for (let i = ringStartIdx; i < ringEndIdx; i += 2) {
          const [p0, p1] = this.edges[i];
          if (p0 && p1) {
            this.createArc(p0, p1, 0.3, color, false);
          }
        }
      }, r * delayPerRing);
    }
    window.dispatchEvent(new CustomEvent("mindfractal:surge", {
      detail: { rings: ringCount, duration: surgeDuration }
    }));
  }
  dispose() {
    for (const arc of this.arcs) {
      (this.parent ?? this.scene).remove(arc.mesh);
      arc.mesh.geometry.dispose();
      arc.material.dispose();
    }
    this.arcs = [];
  }
}

class FieldBreath {
  periodMs;
  amplitude;
  boostUntil = 0;
  boostAmplitude = 0;
  constructor(opts) {
    this.periodMs = opts?.periodMs ?? 12e3;
    this.amplitude = 0;
  }
  /**
   * Get current intensity (0.85-1.15 baseline)
   */
  tick(nowMs) {
    const t = nowMs % this.periodMs / this.periodMs;
    const sine = Math.sin(Math.PI * 2 * t);
    const normalized = (sine + 1) / 2;
    const baseIntensity = 1 - this.amplitude / 2 + normalized * this.amplitude;
    const boost = nowMs < this.boostUntil ? this.boostAmplitude : 0;
    return baseIntensity + boost;
  }
  /**
   * Boost breathing intensity after link
   */
  boost(seconds = 2, ampAdd = 0.1) {
    this.boostUntil = performance.now() + seconds * 1e3;
    this.boostAmplitude = ampAdd;
  }
  /**
   * Get twist delta for spiral effect (oscillates -0.05 to +0.05)
   */
  getTwistDelta(nowMs) {
    const t = nowMs % (this.periodMs * 2) / (this.periodMs * 2);
    return Math.sin(Math.PI * 2 * t) * 0.05;
  }
}

class FPSMonitor {
  samples = [];
  lastTime = performance.now();
  sampleSize = 60;
  tick() {
    const now = performance.now();
    const delta = now - this.lastTime;
    this.lastTime = now;
    const fps = 1e3 / delta;
    this.samples.push(fps);
    if (this.samples.length > this.sampleSize) {
      this.samples.shift();
    }
    return fps;
  }
  getAverage() {
    if (this.samples.length === 0) return 60;
    return this.samples.reduce((a, b) => a + b, 0) / this.samples.length;
  }
  reset() {
    this.samples = [];
    this.lastTime = performance.now();
  }
}

class CameraStore {
  key;
  constructor(key) {
    this.key = key;
  }
  save(state) {
    try {
      const data = {
        position: { x: state.position.x, y: state.position.y, z: state.position.z },
        target: { x: state.target.x, y: state.target.y, z: state.target.z },
        zoom: state.zoom
      };
      localStorage.setItem(this.key, JSON.stringify(data));
    } catch (e) {
    }
  }
  load() {
    try {
      const json = localStorage.getItem(this.key);
      if (!json) return null;
      const data = JSON.parse(json);
      return {
        position: new Vector3(data.position.x, data.position.y, data.position.z),
        target: new Vector3(data.target.x, data.target.y, data.target.z),
        zoom: data.zoom
      };
    } catch (e) {
      return null;
    }
  }
  clear() {
    try {
      localStorage.removeItem(this.key);
    } catch (e) {
    }
  }
}

function useMindFractalPersistence() {
  reactExports.useRef();
  const trackNodeSeen = reactExports.useCallback(async (nodeId, seed) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      await supabase.rpc("mf_upsert_seen", {
        p_node_ids: [nodeId],
        p_seed: BigInt(seed)
      });
    } catch (error) {
    }
  }, []);
  const trackLinkCreated = reactExports.useCallback(async (fromNode, toNode, length, seed) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      await supabase.rpc("mf_add_link", {
        p_from: fromNode,
        p_to: toNode,
        p_length: length,
        p_seed: BigInt(seed)
      });
    } catch (error) {
    }
  }, []);
  const loadProgress = reactExports.useCallback(async (seed) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return null;
      const { data: seenNodes } = await supabase.from("dna_mf_nodes_seen").select("node_id").eq("user_id", user.id).eq("seed", seed);
      const { data: links } = await supabase.from("dna_mf_links").select("node_from, node_to, length").eq("user_id", user.id).eq("seed", seed);
      return {
        seenNodes: seenNodes?.map((n) => n.node_id) || [],
        links: links || []
      };
    } catch (error) {
      return null;
    }
  }, []);
  return {
    trackNodeSeen,
    trackLinkCreated,
    loadProgress
  };
}

function useMindLinkPersistence() {
  const trackLink = reactExports.useCallback(async (nodeA, nodeB, theme, seed, intensity = 1) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return null;
      const { data, error } = await supabase.rpc("upsert_dna_mind_link", {
        p_user_id: user.id,
        p_seed: BigInt(seed),
        p_node_a: nodeA,
        p_node_b: nodeB,
        p_theme: theme,
        p_intensity: intensity
      });
      if (error) {
        return null;
      }
      return data[0];
    } catch (error) {
      return null;
    }
  }, []);
  const loadLinks = reactExports.useCallback(async (seed) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return [];
      const { data: links } = await supabase.from("dna_mind_links").select("node_a, node_b, theme, intensity").eq("user_id", user.id).eq("seed", seed);
      return links || [];
    } catch (error) {
      return [];
    }
  }, []);
  return {
    trackLink,
    loadLinks
  };
}

function EvolutionOverlay({ theme, level, message }) {
  const [visible, setVisible] = reactExports.useState(true);
  reactExports.useEffect(() => {
    const timer = setTimeout(() => setVisible(false), 2500);
    return () => clearTimeout(timer);
  }, [theme, level]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: visible && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { opacity: 0, scale: 0.8 },
      animate: { opacity: 1, scale: 1 },
      exit: { opacity: 0, scale: 0.8 },
      transition: { duration: 0.5 },
      className: "absolute inset-0 flex items-center justify-center pointer-events-none z-50",
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-background/90 backdrop-blur-sm border border-primary/30 rounded-2xl p-8 shadow-2xl max-w-md text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { rotate: 0 },
            animate: { rotate: 360 },
            transition: { duration: 1, ease: "easeInOut" },
            className: "w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-cyan-400 to-violet-600 flex items-center justify-center",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-3xl font-bold text-white", children: level })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-2 bg-gradient-to-r from-cyan-400 to-violet-600 bg-clip-text text-transparent", children: "DNA Evolutivo" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg text-muted-foreground mb-1", children: [
          theme,
          "  Livello ",
          level
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-foreground/80", children: message })
      ] })
    }
  ) });
}

function ProgressHUD({ totalLinks, linksByTheme, milestones, maxMilestones, activeTheme }) {
  const maxLinks = 48;
  const percentage = Math.min(100, Math.round(totalLinks / maxLinks * 100));
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-4 left-4 z-40 pointer-events-none select-none", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, x: -20 },
      animate: { opacity: 1, x: 0 },
      className: "backdrop-blur-md bg-black/70 rounded-lg border border-cyan-400/30 p-3 space-y-2",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 font-medium", children: "Links" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white font-mono", children: [
              totalLinks,
              " / ",
              maxLinks
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-48 h-1.5 bg-black/50 rounded-full overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "h-full bg-gradient-to-r from-cyan-400 to-violet-400",
              initial: { width: 0 },
              animate: { width: `${percentage}%` },
              transition: { duration: 0.4, ease: "easeOut" }
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-right", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-cyan-300/70 text-xs font-mono", children: [
            percentage,
            "%"
          ] }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs pt-2 border-t border-cyan-400/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-violet-400 font-medium", children: "Milestones" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white font-mono", children: [
            milestones,
            " / ",
            maxMilestones
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: activeTheme && linksByTheme[activeTheme] !== void 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, height: 0 },
            animate: { opacity: 1, height: "auto" },
            exit: { opacity: 0, height: 0 },
            className: "pt-2 border-t border-cyan-400/20",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-300/90", children: activeTheme }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white/90 font-mono", children: [
                  linksByTheme[activeTheme],
                  " / 12"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full h-1 bg-black/50 rounded-full overflow-hidden mt-1", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "h-full bg-gradient-to-r from-cyan-500 to-violet-500",
                  initial: { width: 0 },
                  animate: { width: `${Math.min(100, linksByTheme[activeTheme] / 12 * 100)}%` },
                  transition: { duration: 0.3 }
                }
              ) })
            ]
          }
        ) })
      ]
    }
  ) });
}

const MindFractal3D = ({
  className = "",
  onReady,
  onProgress,
  reduced = false,
  seed = 42
}) => {
  const canvasRef = reactExports.useRef(null);
  const mountedRef = reactExports.useRef(false);
  const [isReady, setIsReady] = reactExports.useState(false);
  const [selectedNodeA, setSelectedNodeA] = reactExports.useState(null);
  const [hoveredNode, setHoveredNode] = reactExports.useState(null);
  const [evolution, setEvolution] = reactExports.useState({
    visible: false,
    theme: "",
    level: 0,
    message: ""
  });
  const [linkOverlay, setLinkOverlay] = reactExports.useState({ visible: false, theme: "", message: "" });
  const [totalLinks, setTotalLinks] = reactExports.useState(0);
  const [linksByTheme, setLinksByTheme] = reactExports.useState({});
  const [milestones, setMilestones] = reactExports.useState(0);
  const [activeTheme, setActiveTheme] = reactExports.useState(null);
  const { trackNodeSeen } = useMindFractalPersistence();
  const { trackLink, loadLinks } = useMindLinkPersistence();
  const cameraRef = reactExports.useRef(null);
  const nodeLayerRef = reactExports.useRef(null);
  usePickNode(
    nodeLayerRef.current,
    cameraRef.current,
    canvasRef.current
  );
  reactExports.useEffect(() => {
    if (!canvasRef.current || mountedRef.current) return;
    mountedRef.current = true;
    const canvas = canvasRef.current;
    let animationId;
    const isMobile = /iPad|iPhone|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const renderer = new WebGLRenderer({
      canvas,
      antialias: false,
      // Disabled for performance
      alpha: true,
      powerPreference: "high-performance",
      precision: isMobile ? "mediump" : "highp",
      preserveDrawingBuffer: false
    });
    const dpr = Math.min(1.5, window.devicePixelRatio || 1);
    renderer.setPixelRatio(dpr);
    renderer.outputColorSpace = SRGBColorSpace;
    renderer.toneMapping = ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1;
    const rect = canvas.getBoundingClientRect();
    renderer.setSize(rect.width, rect.height, false);
    const scene = new Scene();
    scene.background = new Color(0);
    scene.fog = new Fog(0, 20, 200);
    const tunnelDepth = 60;
    const camera = new PerspectiveCamera(
      55,
      rect.width / rect.height,
      0.1,
      2e3
    );
    cameraRef.current = camera;
    const camStore = new CameraStore("mf_cam_v2");
    const savedCam = camStore.load();
    if (savedCam) {
      camera.position.copy(savedCam.position);
      camera.zoom = savedCam.zoom;
      camera.updateProjectionMatrix();
    } else {
      camera.position.set(0, 0, 12);
    }
    const controls = new OrbitControls(camera, canvas);
    controls.enableRotate = true;
    controls.enableZoom = true;
    controls.enablePan = true;
    controls.enableDamping = false;
    controls.dampingFactor = 0;
    controls.autoRotate = false;
    controls.autoRotateSpeed = 0;
    controls.minDistance = 1e-3 * tunnelDepth;
    controls.maxDistance = 1.6 * tunnelDepth;
    controls.maxPolarAngle = Math.PI * 0.95;
    if (savedCam?.target) {
      controls.target.copy(savedCam.target);
    }
    controls.update();
    controls.addEventListener("change", () => {
      const distance = camera.position.distanceTo(controls.target);
      camera.near = Math.max(5e-3, distance * 15e-4);
      camera.updateProjectionMatrix();
      camStore.save({
        position: camera.position,
        target: controls.target,
        zoom: camera.zoom
      });
    });
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    let qualityLevel = reduced ? "low" : "mobile";
    const qualityPresets = {
      high: { rings: isIOS ? 60 : 96, segments: 64 },
      mobile: { rings: isIOS ? 60 : 80, segments: 60 },
      low: { rings: 56, segments: 40 }
    };
    const tunnelGroup = new Group();
    scene.add(tunnelGroup);
    let tunnelMesh = null;
    let tunnelTwist = 0.1;
    let tunnelRings = qualityPresets[qualityLevel].rings;
    const buildTunnel = () => {
      if (tunnelMesh) {
        tunnelGroup.remove(tunnelMesh);
        tunnelMesh.geometry.dispose();
      }
      const { positions, indices } = buildFractalTunnel({
        rings: tunnelRings,
        segments: qualityPresets[qualityLevel].segments,
        radius: 10,
        depth: -tunnelDepth,
        twist: tunnelTwist
      });
      const geometry = new BufferGeometry();
      geometry.setAttribute("position", new BufferAttribute(positions, 3));
      geometry.setIndex(new BufferAttribute(indices, 1));
      geometry.computeVertexNormals();
      const edges = new EdgesGeometry(geometry, 5);
      const material = new LineBasicMaterial({
        color: 14540253,
        transparent: true,
        opacity: 0.85
      });
      tunnelMesh = new LineSegments(edges, material);
      tunnelGroup.add(tunnelMesh);
      return geometry;
    };
    let tunnelGeometry = buildTunnel();
    const nodeLayer = new NodeLayer(tunnelGroup, tunnelGeometry);
    nodeLayer.initialize(48, seed);
    nodeLayerRef.current = nodeLayer;
    const linkEngine = new LinkEngine(tunnelDepth);
    const gridArcPool = new GridArcPool(scene);
    gridArcPool.setParent(tunnelGroup);
    gridArcPool.bindGeometry(tunnelGeometry);
    gridArcPool.setFPSTarget(isMobile ? 45 : 60);
    const fieldBreath = new FieldBreath({ periodMs: 12e3, amp: 0.3 });
    window.addEventListener("mindfractal:surge", (e) => {
      e.detail;
    });
    const fpsMonitor = new FPSMonitor();
    let frameCount = 0;
    let lastQualityCheck = Date.now();
    let isPaused = false;
    const handleVisibilityChange = () => {
      isPaused = document.hidden;
    };
    document.addEventListener("visibilitychange", handleVisibilityChange);
    const resumeLinks = async () => {
      try {
        const links = await loadLinks(seed);
        if (links && Array.isArray(links) && links.length > 0) {
          for (const link of links.slice(-50)) {
            if (link && typeof link.node_a === "number" && typeof link.node_b === "number") {
              nodeLayer.setNodeState(link.node_a, NodeState.LINKED);
              nodeLayer.setNodeState(link.node_b, NodeState.LINKED);
            }
          }
          const stats = nodeLayer.getStats();
          onProgress?.({
            discovered: stats.discovered,
            linked: stats.linked,
            ratio: stats.linked / 48
          });
        }
      } catch (err) {
      }
    };
    resumeLinks();
    const handlePointerMove = (event) => {
      const rect2 = canvas.getBoundingClientRect();
      const mouse = new Vector2(
        (event.clientX - rect2.left) / rect2.width * 2 - 1,
        -((event.clientY - rect2.top) / rect2.height) * 2 + 1
      );
      const raycaster = new Raycaster();
      raycaster.setFromCamera(mouse, camera);
      const nodeId = nodeLayer.raycast(raycaster);
      setHoveredNode(nodeId);
      canvas.style.cursor = nodeId !== null ? "pointer" : "default";
    };
    let lastClickTime = 0;
    const onCanvasClick = async (event) => {
      const now = Date.now();
      if (now - lastClickTime < 250) return;
      lastClickTime = now;
      const rect2 = canvas.getBoundingClientRect();
      const mouse = new Vector2(
        (event.clientX - rect2.left) / rect2.width * 2 - 1,
        -((event.clientY - rect2.top) / rect2.height) * 2 + 1
      );
      const raycaster = new Raycaster();
      raycaster.setFromCamera(mouse, camera);
      const nodeId = nodeLayer.raycast(raycaster);
      if (nodeId === null) return;
      const node = nodeLayer.getNode(nodeId);
      if (!node) return;
      if (selectedNodeA === null) {
        if (node.state === NodeState.LOCKED) {
          nodeLayer.setNodeState(nodeId, NodeState.DISCOVERED);
          trackNodeSeen(`node_${nodeId}`, seed);
        }
        setSelectedNodeA(nodeId);
        window.dispatchEvent(new CustomEvent("mindfractal:node-selected", {
          detail: { nodeId, theme: node.theme, worldPos: node.position.clone() }
        }));
        return;
      }
      if (nodeId !== selectedNodeA) {
        const nodeA = nodeLayer.getNode(selectedNodeA);
        if (!nodeA) {
          setSelectedNodeA(null);
          return;
        }
        const linkResult = linkEngine.createLink(nodeA, node);
        if (!linkResult) {
          setSelectedNodeA(null);
          return;
        }
        if (node.state === NodeState.LOCKED) {
          nodeLayer.setNodeState(nodeId, NodeState.DISCOVERED);
          trackNodeSeen(`node_${nodeId}`, seed);
        }
        gridArcPool.spawnLinkArc(nodeA.position, node.position);
        fieldBreath.boost(2, 0.1);
        try {
          const audio = new Audio("/sounds/chime.mp3");
          audio.volume = 0.3;
          audio.play().catch(() => {
          });
        } catch {
        }
        nodeLayer.setNodeState(selectedNodeA, NodeState.LINKED);
        nodeLayer.setNodeState(nodeId, NodeState.LINKED);
        const dbResult = await trackLink(selectedNodeA, nodeId, nodeA.theme, seed, 1);
        setTotalLinks((prev) => prev + 1);
        setLinksByTheme((prev) => ({ ...prev, [nodeA.theme]: (prev[nodeA.theme] || 0) + 1 }));
        setActiveTheme(nodeA.theme);
        const themeCount = (linksByTheme[nodeA.theme] || 0) + 1;
        setLinkOverlay({
          visible: true,
          theme: nodeA.theme,
          message: `Connessione riuscita: ${nodeA.theme} +1  ${themeCount}/12`
        });
        setTimeout(() => setLinkOverlay((prev) => ({ ...prev, visible: false })), 1200);
        const linkAudio = new Audio("/sounds/link-success.mp3");
        linkAudio.volume = 0.3;
        linkAudio.play().catch(() => {
        });
        if (dbResult?.milestone_added) {
          const level = dbResult.milestone_level || 1;
          setMilestones((prev) => prev + 1);
          tunnelTwist = Math.min(tunnelTwist + 0.12, 0.8);
          tunnelRings = Math.min(tunnelRings + 4, qualityPresets.high.rings);
          setEvolution({
            visible: true,
            theme: nodeA.theme,
            level,
            message: `Milestone raggiunta: ${nodeA.theme} L${level}`
          });
          setTimeout(() => setEvolution((prev) => ({ ...prev, visible: false })), 2500);
          const milestoneAudio = new Audio("/sounds/milestone.mp3");
          milestoneAudio.volume = 0.4;
          milestoneAudio.play().catch(() => {
          });
          setTimeout(() => {
            tunnelGeometry = buildTunnel();
            nodeLayer.regenerate(tunnelGeometry, 48, seed);
            gridArcPool.bindGeometry(tunnelGeometry);
            tunnelGroup.rotation.z = tunnelTwist * 1.4;
          }, 2e3);
          window.dispatchEvent(new CustomEvent("mindfractal:evolve", {
            detail: { theme: nodeA.theme, level }
          }));
        }
        const stats = nodeLayer.getStats();
        onProgress?.({
          discovered: stats.discovered,
          linked: stats.linked,
          ratio: stats.linked / 48
        });
        setSelectedNodeA(null);
      }
    };
    let pointerDownPos = null;
    const handlePointerDown = (event) => {
      pointerDownPos = {
        x: event.clientX,
        y: event.clientY,
        ts: performance.now()
      };
    };
    const handlePointerUp = (event) => {
      if (!pointerDownPos) return;
      const dx = Math.abs(event.clientX - pointerDownPos.x);
      const dy = Math.abs(event.clientY - pointerDownPos.y);
      const dt = performance.now() - pointerDownPos.ts;
      pointerDownPos = null;
      if (dx < 6 && dy < 6 && dt < 180) {
        onCanvasClick(event);
      }
    };
    canvas.addEventListener("pointermove", handlePointerMove);
    canvas.addEventListener("pointerdown", handlePointerDown);
    canvas.addEventListener("pointerup", handlePointerUp);
    const clock = new Clock$1();
    const animate = () => {
      animationId = requestAnimationFrame(animate);
      if (isPaused) return;
      const deltaTime = clock.getDelta();
      const elapsedTime = clock.getElapsedTime();
      fpsMonitor.tick();
      const avgFPS = fpsMonitor.getAverage();
      frameCount++;
      gridArcPool.setCurrentFPS(avgFPS);
      if (frameCount % 120 === 0 && !reduced) {
        const now = Date.now();
        if (avgFPS < 45 && qualityLevel !== "low" && now - lastQualityCheck > 2e3) {
          qualityLevel = qualityLevel === "high" ? "mobile" : "low";
          tunnelGeometry = buildTunnel();
          nodeLayer.regenerate(tunnelGeometry, 48, seed);
          gridArcPool.bindGeometry(tunnelGeometry);
          lastQualityCheck = now;
        }
      }
      const nowMs = performance.now();
      const intensity = reduced ? 1 : fieldBreath.tick(nowMs);
      const breathScale = 1;
      tunnelGroup.scale.set(breathScale, breathScale, breathScale);
      if (tunnelMesh?.material) {
        tunnelMesh.material.opacity = 0.85 * intensity;
      }
      gridArcPool.update(deltaTime, { reduced });
      nodeLayer.update(elapsedTime, hoveredNode);
      const minZ = -tunnelDepth + 1e-3 * tunnelDepth;
      if (camera.position.z < minZ) {
        camera.position.z = minZ;
      }
      if (frameCount % 60 === 0) {
        nodeLayer.getStats();
        gridArcPool.getStats();
      }
      renderer.render(scene, camera);
      if (frameCount === 1 && !isReady) {
        setIsReady(true);
        onReady?.();
      }
    };
    animate();
    const handleResize = () => {
      const rect2 = canvas.getBoundingClientRect();
      renderer.setSize(rect2.width, rect2.height, false);
      camera.aspect = rect2.width / rect2.height;
      camera.updateProjectionMatrix();
    };
    window.addEventListener("resize", handleResize);
    return () => {
      mountedRef.current = false;
      cancelAnimationFrame(animationId);
      document.removeEventListener("visibilitychange", handleVisibilityChange);
      window.removeEventListener("resize", handleResize);
      canvas.removeEventListener("pointermove", handlePointerMove);
      canvas.removeEventListener("pointerdown", handlePointerDown);
      canvas.removeEventListener("pointerup", handlePointerUp);
      controls.dispose();
      renderer.dispose();
      if (tunnelMesh) {
        tunnelMesh.geometry.dispose();
        tunnelMesh.material.dispose();
      }
      nodeLayer.dispose();
      gridArcPool.dispose();
      scene.clear();
    };
  }, [onReady, onProgress, reduced, seed, trackNodeSeen, trackLink, loadLinks, selectedNodeA, hoveredNode]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `relative ${className}`, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "canvas",
      {
        ref: canvasRef,
        className: "w-full h-full bg-black",
        style: { display: "block" }
      }
    ),
    !isReady && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 flex items-center justify-center bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/60", children: "Inizializzazione Mind Fractal..." })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      ProgressHUD,
      {
        totalLinks,
        linksByTheme,
        milestones,
        maxMilestones: 12,
        activeTheme
      }
    ),
    evolution.visible && /* @__PURE__ */ jsxRuntimeExports.jsx(
      EvolutionOverlay,
      {
        theme: evolution.theme,
        level: evolution.level,
        message: evolution.message
      }
    ),
    linkOverlay.visible && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg bg-black/80 border border-cyan-400/30 backdrop-blur-sm z-50", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-cyan-400 font-medium", children: linkOverlay.message }) }),
    hoveredNode !== null && nodeLayerRef.current && (() => {
      const node = nodeLayerRef.current.getNode(hoveredNode);
      if (!node) return null;
      const parts = node.name.split(" ");
      const theme = parts[0];
      const name = parts.slice(1).join(" ");
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg bg-black/80 border border-cyan-400/30 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-cyan-400 font-medium", children: [
        theme,
        " ",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-300", children: "" }),
        " ",
        name
      ] }) });
    })()
  ] });
};

const DNAHub = ({
  dnaProfile,
  events = [],
  onEvolve
}) => {
  const [showEvolution, setShowEvolution] = reactExports.useState(false);
  const [activeTab, setActiveTab] = reactExports.useState("overview");
  const [showSkippedPill, setShowSkippedPill] = reactExports.useState(false);
  const [showHint, setShowHint] = reactExports.useState(false);
  const [reduceAnimations, setReduceAnimations] = reactExports.useState(false);
  const [enableTesseract] = reactExports.useState(true);
  const [enableRubikDNA] = reactExports.useState(true);
  const { getCurrentUser } = useUnifiedAuth();
  const archetypeConfig = ARCHETYPE_CONFIGS[dnaProfile.archetype];
  const user = getCurrentUser();
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const getTodayKey = () => {
      const today2 = /* @__PURE__ */ new Date();
      return `${today2.getFullYear()}-${String(today2.getMonth() + 1).padStart(2, "0")}-${String(today2.getDate()).padStart(2, "0")}`;
    };
    const lastShown = localStorage.getItem(`dna:lastShown:${user.id}`);
    const completed = localStorage.getItem(`dna:completed:${user.id}`) === "1";
    const today = getTodayKey();
    setShowSkippedPill(lastShown === today && !completed);
    const hintKey = `dna:hintShown:${user.id}:${today}`;
    const hintShown = localStorage.getItem(hintKey) === "1";
    if (!hintShown && activeTab === "overview") {
      setShowHint(true);
      localStorage.setItem(hintKey, "1");
      setTimeout(() => setShowHint(false), 2500);
    }
  }, [user?.id, activeTab]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "min-h-screen bg-black text-white overflow-y-auto",
        style: {
          background: `radial-gradient(circle at 50% 0%, ${archetypeConfig.color}15, transparent 70%), black`
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.header,
            {
              initial: { opacity: 0, y: -20 },
              animate: { opacity: 1, y: 0 },
              className: "p-6 border-b border-white/10 backdrop-blur-xl bg-black/40 relative",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.h1,
                    {
                      className: "text-3xl md:text-4xl font-black bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent mb-2",
                      children: "M1SSION DNA"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm md:text-base text-white/60 font-medium", children: "Identit Evolutiva dell'Agente  Codice Vivo" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showSkippedPill && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    initial: { opacity: 0, x: 20 },
                    animate: { opacity: 1, x: 0 },
                    exit: { opacity: 0, x: 20 },
                    className: "absolute top-6 right-6 flex items-center gap-2 px-4 py-2 rounded-full bg-yellow-500/10 border border-yellow-500/30 backdrop-blur-sm",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-yellow-400 font-medium", children: "Primo sequenziamento disponibile domani" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "button",
                        {
                          onClick: () => setShowSkippedPill(false),
                          className: "text-yellow-400/60 hover:text-yellow-400 transition-colors",
                          "aria-label": "Chiudi",
                          children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-4 h-4" })
                        }
                      )
                    ]
                  }
                ) })
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto p-6 space-y-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { opacity: 0, scale: 0.9 },
                animate: { opacity: 1, scale: 1 },
                className: "flex flex-col md:flex-row items-center gap-6 p-6 rounded-2xl border backdrop-blur-xl",
                style: {
                  backgroundColor: `${archetypeConfig.color}10`,
                  borderColor: `${archetypeConfig.color}30`,
                  boxShadow: `0 0 40px ${archetypeConfig.color}20`
                },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    ArchetypeIcon,
                    {
                      archetype: dnaProfile.archetype,
                      size: 120
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 text-center md:text-left", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Badge,
                      {
                        className: "mb-2",
                        style: {
                          backgroundColor: `${archetypeConfig.color}20`,
                          color: archetypeConfig.color,
                          borderColor: `${archetypeConfig.color}40`
                        },
                        children: archetypeConfig.name
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "h2",
                      {
                        className: "text-2xl md:text-3xl font-bold mb-2",
                        style: { color: archetypeConfig.color },
                        children: archetypeConfig.nameIt
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm md:text-base", children: archetypeConfig.description })
                  ] })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2 border-b border-white/10", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: () => setActiveTab("overview"),
                  className: `px-6 py-3 font-semibold transition-all border-b-2 ${activeTab === "overview" ? "border-cyan-400 text-cyan-400" : "border-transparent text-white/50 hover:text-white/80"}`,
                  children: "DNA Overview"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: () => setActiveTab("history"),
                  className: `px-6 py-3 font-semibold transition-all border-b-2 ${activeTab === "history" ? "border-cyan-400 text-cyan-400" : "border-transparent text-white/50 hover:text-white/80"}`,
                  children: "Storia Genetica"
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: activeTab === "overview" ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { opacity: 0, x: -20 },
                animate: { opacity: 1, x: 0 },
                exit: { opacity: 0, x: 20 },
                className: "space-y-8",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showHint && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.div,
                    {
                      initial: { opacity: 0, y: -10 },
                      animate: { opacity: 1, y: 0 },
                      exit: { opacity: 0, y: -10 },
                      className: "flex items-center justify-center gap-2 px-4 py-2 mx-auto w-fit rounded-full bg-cyan-500/10 border border-cyan-500/30 backdrop-blur-sm",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "w-4 h-4 text-cyan-400" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-cyan-400 font-medium", children: "Muovi il mouse / Trascina per ruotare  doppio clic per reset" })
                      ]
                    }
                  ) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-3 px-4 py-2 mx-auto w-fit rounded-lg bg-white/5 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/70", children: "Riduci animazioni" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Switch,
                      {
                        checked: reduceAnimations,
                        onCheckedChange: setReduceAnimations,
                        "aria-label": "Riduci animazioni DNA"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative w-screen max-w-none left-1/2 -translate-x-1/2 h-[75svh] md:h-[calc(100svh-140px)] md:max-h-[calc(100svh-140px)] overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(DNAErrorBoundary, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    MindFractal3D,
                    {
                      className: "w-full h-full rounded-none md:rounded-xl",
                      seed: dnaProfile.intuito * 1e3 + dnaProfile.audacia * 100 + dnaProfile.etica * 10 + dnaProfile.rischio,
                      onReady: () => void 0,
                      onProgress: (p) => {
                        window.dispatchEvent(new CustomEvent("mf:progress", { detail: p }));
                      },
                      reduced: reduceAnimations
                    }
                  ) })  }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => setActiveTab("history"),
                      size: "lg",
                      variant: "outline",
                      className: "border-white/20 hover:bg-white/10 font-bold px-8",
                      children: " STORIA GENETICA"
                    }
                  ) })
                ]
              },
              "overview"
            ) : /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                initial: { opacity: 0, x: 20 },
                animate: { opacity: 1, x: 0 },
                exit: { opacity: 0, x: -20 },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(ScrollArea, { className: "h-[500px] rounded-lg border border-white/10 bg-black/40 backdrop-blur-xl p-6", children: events.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-white/50 py-12", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg mb-2", children: "Nessuna mutazione registrata" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: "Le tue azioni future scriveranno la storia del tuo DNA" })
                ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: events.map((event, idx) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    initial: { opacity: 0, y: 20 },
                    animate: { opacity: 1, y: 0 },
                    transition: { delay: idx * 0.05 },
                    className: "p-4 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-start justify-between gap-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-xs", children: event.source }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/50", children: format(new Date(event.created_at), "dd MMM yyyy, HH:mm", { locale: it$1 }) })
                      ] }),
                      event.note && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70 mb-2", children: event.note }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-wrap gap-2", children: Object.entries(event.delta || {}).map(([key, val]) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        "span",
                        {
                          className: `text-xs font-mono px-2 py-1 rounded ${val > 0 ? "bg-green-500/20 text-green-400" : val < 0 ? "bg-red-500/20 text-red-400" : "bg-white/10 text-white/60"}`,
                          children: [
                            key.toUpperCase(),
                            ": ",
                            val > 0 ? "+" : "",
                            val
                          ]
                        },
                        key
                      )) })
                    ] }) })
                  },
                  event.id
                )) }) })
              },
              "history"
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 pointer-events-none", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[800px] rounded-full opacity-20 blur-[100px]",
                style: {
                  background: `radial-gradient(circle, ${archetypeConfig.color}, transparent 70%)`
                },
                animate: {
                  scale: [1, 1.1, 1],
                  opacity: [0.15, 0.25, 0.15]
                },
                transition: {
                  duration: 4,
                  repeat: Infinity,
                  ease: "easeInOut"
                }
              }
            ) })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      DNAEvolutionScene,
      {
        isOpen: showEvolution,
        archetype: dnaProfile.archetype,
        onComplete: () => setShowEvolution(false)
      }
    )
  ] });
};

const DNAPage = () => {
  const [, setLocation] = useLocation();
  const { isAuthenticated, getCurrentUser } = useUnifiedAuth();
  const { dnaProfile, isLoading: dnaLoading } = useDNA();
  const [events, setEvents] = reactExports.useState([]);
  const [eventsLoading, setEventsLoading] = reactExports.useState(true);
  const user = getCurrentUser();
  reactExports.useEffect(() => {
    if (!dnaLoading && !isAuthenticated) {
      ue.error("Accesso negato", {
        description: "Devi essere autenticato per visualizzare il DNA"
      });
      setLocation("/");
    }
  }, [isAuthenticated, dnaLoading, setLocation]);
  reactExports.useEffect(() => {
    const loadEvents = async () => {
      if (!user?.id) return;
      try {
        const { data, error } = await supabase.from("agent_dna_events").select("*").eq("user_id", user.id).order("created_at", { ascending: false }).limit(50);
        if (error) throw error;
        setEvents(data || []);
      } catch (error) {
        ue.error("Errore nel caricamento della storia DNA");
      } finally {
        setEventsLoading(false);
      }
    };
    if (user?.id) {
      loadEvents();
    }
  }, [user?.id]);
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const channel = supabase.channel(`dna-updates:${user.id}`).on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "agent_dna",
        filter: `user_id=eq.${user.id}`
      },
      (payload) => {
        ue.success("DNA aggiornato!", {
          description: "Il tuo profilo genetico  stato modificato"
        });
      }
    ).on(
      "postgres_changes",
      {
        event: "INSERT",
        schema: "public",
        table: "agent_dna_events",
        filter: `user_id=eq.${user.id}`
      },
      (payload) => {
        setEvents((prev) => [payload.new, ...prev]);
      }
    ).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, [user?.id]);
  const handleEvolve = async () => {
    if (!user?.id) return;
    try {
      const delta = {
        intuito: Math.floor(Math.random() * 10) - 5,
        audacia: Math.floor(Math.random() * 10) - 5,
        etica: Math.floor(Math.random() * 10) - 5,
        rischio: Math.floor(Math.random() * 10) - 5,
        vibrazione: Math.floor(Math.random() * 10) - 5
      };
      const { error } = await supabase.rpc("fn_dna_apply_delta", {
        p_user: user.id,
        p_delta: delta,
        p_source: "manual_evolution",
        p_note: "Evoluzione manuale attivata dall'hub DNA"
      });
      if (error) throw error;
      ue.success("Evoluzione completata!", {
        description: "Il tuo DNA  stato modificato"
      });
    } catch (error) {
      ue.error("Errore durante l'evoluzione");
    }
  };
  if (dnaLoading || eventsLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-black flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-12 h-12 animate-spin text-cyan-400 mx-auto" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "Caricamento DNA..." })
    ] }) });
  }
  if (!dnaProfile) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-black flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4 max-w-md px-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-6xl mb-4", children: "" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-white", children: "DNA Non Calibrato" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "Completa il primo sequenziamento genetico per visualizzare il tuo DNA" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => setLocation("/"),
          className: "px-6 py-3 bg-cyan-500 hover:bg-cyan-600 text-white font-bold rounded-lg transition-colors",
          children: "Torna alla Home"
        }
      )
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.button,
      {
        onClick: () => {
          if (window.history.length > 1) {
            window.history.back();
          } else {
            setLocation("/home");
          }
        },
        className: "fixed top-4 left-4 z-50 w-11 h-11 rounded-full bg-background/80 backdrop-blur-md border border-border/50 shadow-lg flex items-center justify-center hover:bg-background/90 transition-all focus:outline-none focus:ring-2 focus:ring-primary/50",
        style: {
          top: "max(1rem, env(safe-area-inset-top))",
          left: "max(1rem, env(safe-area-inset-left))"
        },
        initial: { opacity: 0, x: -20 },
        animate: { opacity: 1, x: 0 },
        transition: { duration: 0.3 },
        whileHover: { scale: 1.05 },
        whileTap: { scale: 0.95 },
        "aria-label": "Torna indietro",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5 text-foreground" })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      DNAHub,
      {
        dnaProfile,
        events,
        onEvolve: handleEvolve
      }
    )
  ] });
};

const ResetPasswordPage = () => {
  const [, setLocation] = useLocation();
  const [newPassword, setNewPassword] = reactExports.useState("");
  const [confirmPassword, setConfirmPassword] = reactExports.useState("");
  const [loading, setLoading] = reactExports.useState(false);
  const [session, setSession] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const checkSession = async () => {
      const { data: { session: session2 } } = await supabase.auth.getSession();
      setSession(session2);
    };
    checkSession();
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (event, session2) => {
        if (event === "PASSWORD_RECOVERY") {
          setSession(session2);
          ue.info("Inserisci la nuova password");
        }
        if (event === "SIGNED_IN" && session2) {
          setSession(session2);
        }
      }
    );
    return () => subscription.unsubscribe();
  }, []);
  const handleResetPassword = async (e) => {
    e.preventDefault();
    if (!newPassword || !confirmPassword) {
      ue.error("Inserisci entrambe le password");
      return;
    }
    if (newPassword !== confirmPassword) {
      ue.error("Le password non corrispondono");
      return;
    }
    if (newPassword.length < 8) {
      ue.error("La password deve essere di almeno 8 caratteri");
      return;
    }
    setLoading(true);
    try {
      const { error } = await supabase.auth.updateUser({
        password: newPassword
      });
      if (error) {
        ue.error("Errore nel reset della password: " + error.message);
      } else {
        ue.success("Password aggiornata con successo!");
        setTimeout(() => {
          setLocation("/home");
        }, 2e3);
      }
    } catch (error) {
      ue.error("Errore imprevisto");
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black bg-gradient-to-b from-background/50 to-black", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-md w-full p-6 mx-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold gradient-text-cyan mb-2", children: "Reset Password" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Inserisci la tua nuova password" })
    ] }),
    session ? /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleResetPassword, className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          type: "password",
          placeholder: "Nuova password",
          value: newPassword,
          onChange: (e) => setNewPassword(e.target.value),
          className: "bg-background/20 border-white/20",
          required: true,
          minLength: 8
        }
      ) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          type: "password",
          placeholder: "Conferma password",
          value: confirmPassword,
          onChange: (e) => setConfirmPassword(e.target.value),
          className: "bg-background/20 border-white/20",
          required: true,
          minLength: 8
        }
      ) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          type: "submit",
          className: "w-full",
          disabled: loading,
          children: loading ? "Aggiornamento..." : "Aggiorna Password"
        }
      )
    ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Caricamento del link di recovery..." }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "outline",
          onClick: () => setLocation("/login"),
          children: "Torna al Login"
        }
      )
    ] })
  ] }) });
};

const TermsConditions = () => {
  useLocation();
  const [lang, setLang] = reactExports.useState("it");
  const content = lang === "it" ? TERMS_IT : TERMS_EN;
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#131524] via-[#0F1419] to-black text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "container mx-auto px-4 py-8 max-w-4xl", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      className: "space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => window.history.back(),
                variant: "ghost",
                size: "icon",
                className: "rounded-full hover:bg-white/10",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: lang === "it" ? "Termini e Condizioni" : "Terms & Conditions" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "M1SSION" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 bg-black/30 rounded-full p-1 border border-white/10", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setLang("it"),
                className: `px-3 py-1 rounded-full text-sm font-medium transition-all ${lang === "it" ? "bg-[#00D1FF] text-black" : "text-white/60 hover:text-white"}`,
                children: " IT"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setLang("en"),
                className: `px-3 py-1 rounded-full text-sm font-medium transition-all ${lang === "en" ? "bg-[#00D1FF] text-black" : "text-white/60 hover:text-white"}`,
                children: " EN"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
              content.title
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-sm mt-2", children: content.lastUpdate })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-8 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Globe, { className: "w-5 h-5" }), title: content.sections.s1.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s1.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(DefinitionList, { items: content.sections.s1.definitions }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm italic mt-4", children: content.sections.s1.disclaimer })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-5 h-5" }), title: content.sections.s2.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s2.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.sections.s2.requirements.map((req, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: req }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-5 h-5" }), title: content.sections.s3.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s3.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.sections.s3.services.map((svc, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: svc }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4", children: content.sections.s3.note })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Coins, { className: "w-5 h-5 text-yellow-400" }), title: content.sections.s4.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-yellow-900/20 p-4 rounded-lg border border-yellow-500/30 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-yellow-300 font-semibold mb-2", children: [
                " ",
                content.sections.s4.warning
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s4.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4 mt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-yellow-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-yellow-400 font-semibold mb-2", children: "M1U (M1 Units)" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: content.sections.s4.m1u })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-purple-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-purple-400 font-semibold mb-2", children: "PE (Pulse Energy)" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: content.sections.s4.pe })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-4", children: content.sections.s4.rules.map((rule, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: rule }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Gamepad2, { className: "w-5 h-5 text-red-400" }), title: content.sections.s5.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/30 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-red-300 font-semibold mb-2", children: [
                " ",
                content.sections.s5.antiGambling
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s5.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.sections.s5.rules.map((rule, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: rule }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-white/70 text-sm italic", children: content.sections.s5.disclaimer }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-2 text-red-400 text-sm", children: content.sections.s5.suspension })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Ban, { className: "w-5 h-5 text-red-400" }), title: content.sections.s6.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s6.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.sections.s6.prohibitions.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-red-400", children: content.sections.s6.consequences })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 text-[#00D1FF]" }), title: content.sections.s7.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s7.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/30 mt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300 font-semibold mb-2", children: content.sections.s7.warningTitle }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 text-white/80 text-sm", children: content.sections.s7.prohibitions.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-white/70 text-sm", children: content.sections.s7.legal })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 text-orange-400" }), title: content.sections.s8.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s8.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-orange-900/20 p-4 rounded-lg border border-orange-500/30 mt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-orange-300 font-semibold mb-2", children: [
                  " ",
                  content.sections.s8.safetyTitle
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 text-white/80 text-sm", children: content.sections.s8.safetyRules.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4", children: content.sections.s8.limitation })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-5 h-5 text-purple-400" }), title: content.sections.s9.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s9.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-3", children: content.sections.s9.aion }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-3 text-[#00D1FF]", children: /* @__PURE__ */ jsxRuntimeExports.jsx("a", { href: "/privacy-policy", className: "hover:underline", children: content.sections.s9.link }) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-5 h-5" }), title: content.sections.s10.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s10.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.sections.s10.rules.map((rule, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: rule }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Scale, { className: "w-5 h-5" }), title: content.sections.s11.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s11.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.sections.s11.points.map((point, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: point }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$2, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-5 h-5" }), title: content.sections.s12.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.sections.s12.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-[#00D1FF]/20 mt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: content.sections.s12.company }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "NIYVORA KFT" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Budapest, Hungary" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF] mt-2", children: "legal@m1ssion.app" })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pt-6 border-t border-white/10 text-center text-white/60", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
                " 2025 M1SSION  ",
                lang === "it" ? "Tutti i diritti riservati" : "All Rights Reserved"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: "NIYVORA KFT  Budapest, Hungary" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs mt-3 text-white/40", children: content.draftNote }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs mt-1 text-white/30", children: content.lastUpdate })
            ] })
          ] })
        ] })
      ]
    }
  ) }) });
};
const Section$2 = ({ icon, title, children }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { children: [
  /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-semibold text-[#00D1FF] mb-3 flex items-center gap-2", children: [
    icon,
    title
  ] }),
  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2 text-white/90", children })
] });
const DefinitionList = ({ items }) => /* @__PURE__ */ jsxRuntimeExports.jsx("dl", { className: "mt-4 space-y-3", children: items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/20 p-3 rounded-lg", children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx("dt", { className: "font-semibold text-[#00D1FF]", children: item.term }),
  /* @__PURE__ */ jsxRuntimeExports.jsx("dd", { className: "text-white/70 text-sm mt-1", children: item.def })
] }, i)) });
const TERMS_IT = {
  title: "Termini e Condizioni d'Uso",
  lastUpdate: "Ultimo aggiornamento: 5 Dicembre 2025",
  draftNote: "Questo documento  una bozza informativa e potr essere aggiornata in seguito a revisione legale formale.",
  sections: {
    s1: {
      title: "1. Oggetto del Servizio e Definizioni",
      intro: `I presenti Termini e Condizioni ("Termini") regolano l'accesso e l'utilizzo dell'applicazione M1SSION, di propriet di NIYVORA KFT. Utilizzando l'applicazione, l'Utente accetta integralmente questi Termini.`,
      definitions: [
        { term: "M1SSION", def: "Applicazione mobile di gioco investigativo con elementi di geolocalizzazione, missioni fisiche e digitali, premi reali, classifiche e intelligenza artificiale." },
        { term: "Utente", def: "Qualsiasi persona fisica che accede e utilizza l'applicazione M1SSION." },
        { term: "M1U (M1 Units)", def: "Valuta virtuale interna all'ecosistema M1SSION, priva di valore monetario reale." },
        { term: "PE (Pulse Energy)", def: "Risorsa virtuale utilizzata per specifiche meccaniche di gioco, priva di valore monetario reale." },
        { term: "Buzz Map", def: "Mappa 3D geolocalizzata che mostra indizi, missioni e premi nell'ambiente circostante." },
        { term: "AION", def: "Intelligenza artificiale integrata che assiste l'Utente durante l'esperienza di gioco." },
        { term: "Pulse Breaker", def: "Mini-gioco di intrattenimento che utilizza M1U o PE con meccanica di moltiplicatore." }
      ],
      disclaimer: "I contenuti di M1SSION sono di puro intrattenimento e non costituiscono consulenze professionali, finanziarie o di altro tipo."
    },
    s2: {
      title: "2. Requisiti di Accesso e Registrazione",
      intro: "Per utilizzare M1SSION, l'Utente deve soddisfare i seguenti requisiti:",
      requirements: [
        "Avere almeno 13 anni di et (o l'et minima richiesta dalla giurisdizione locale)",
        "Fornire informazioni accurate e veritiere durante la registrazione",
        "Mantenere la riservatezza delle credenziali di accesso",
        "Utilizzare un solo account personale",
        "Rispettare le leggi locali durante l'utilizzo dell'applicazione"
      ]
    },
    s3: {
      title: "3. Servizi di Gioco M1SSION",
      intro: "M1SSION offre un'esperienza di gioco investigativo che include:",
      services: [
        "Buzz Map: mappa 3D interattiva con indizi geolocalizzati",
        "Missioni: sfide fisiche e digitali da completare nel mondo reale",
        "Indizi: elementi narrativi da scoprire e decifrare",
        "Classifiche: globali, nazionali e regionali",
        "Premi: ricompense fisiche e digitali per i giocatori",
        "Community: interazioni tra giocatori, messaggi e notifiche",
        "AION: assistente AI per supporto durante il gioco"
      ],
      note: "I servizi possono essere modificati, sospesi o interrotti in qualsiasi momento a discrezione di NIYVORA KFT."
    },
    s4: {
      title: "4. Valute Virtuali (M1U e Pulse Energy)",
      warning: "AVVISO IMPORTANTE",
      intro: "M1SSION utilizza due tipologie di valute virtuali interne:",
      m1u: "Token virtuali utilizzati per sbloccare contenuti, partecipare a missioni e mini-giochi all'interno dell'ecosistema M1SSION.",
      pe: "Energia virtuale utilizzata per specifiche meccaniche di gioco e partecipazione comunitaria.",
      rules: [
        "M1U e PE NON rappresentano denaro reale, strumenti finanziari, crediti o token blockchain",
        "M1U e PE NON sono scambiabili, vendibili o convertibili in valuta legale",
        "M1U e PE NON sono rimborsabili in alcuna forma",
        "M1U e PE possono essere guadagnati o persi SOLO all'interno dell'ecosistema M1SSION",
        "M1U e PE non hanno alcun valore al di fuori dell'applicazione",
        "NIYVORA KFT si riserva il diritto di modificare i saldi, le meccaniche o il valore di M1U e PE"
      ]
    },
    s5: {
      title: '5. Mini-gioco "Pulse Breaker"',
      antiGambling: "DICHIARAZIONE ANTI-GAMBLING",
      intro: 'Pulse Breaker  un mini-gioco di PURO INTRATTENIMENTO che utilizza esclusivamente M1U o PE. Il mini-gioco presenta una meccanica con moltiplicatore crescente e punto di "crash".',
      rules: [
        "Pulse Breaker NON  un gioco d'azzardo ai sensi delle normative applicabili",
        "NON  possibile scommettere o vincere denaro reale",
        "Le puntate avvengono SOLO con M1U o PE (valute virtuali)",
        "Le vincite sono esclusivamente in M1U o PE, senza alcun valore monetario",
        "I moltiplicatori e l'house edge sono parte della logica di gioco interna",
        "NON esiste alcuna possibilit di prelievo, conversione o riscatto in denaro",
        "Il gioco  progettato per intrattenimento, non per simulare comportamenti di gambling"
      ],
      disclaimer: "L'Utente  il solo responsabile del proprio comportamento e deve utilizzare Pulse Breaker in modo responsabile e consapevole.",
      suspension: "NIYVORA KFT si riserva il diritto di sospendere, limitare o revocare l'accesso a Pulse Breaker in caso di abuso, uso fraudolento o comportamento contrario ai presenti Termini."
    },
    s6: {
      title: "6. Comportamento dell'Utente e Divieti",
      intro: "L'Utente si impegna a utilizzare M1SSION in modo lecito e responsabile.  espressamente vietato:",
      prohibitions: [
        "Utilizzare l'applicazione per attivit illegali o fraudolente",
        "Violare la propriet privata durante le missioni",
        "Condividere, vendere o trasferire l'accesso al proprio account",
        "Creare account multipli per ottenere vantaggi non autorizzati",
        "Tentare di hackerare, decompilare o manomettere l'applicazione",
        "Utilizzare bot, script o software di automazione",
        "Manipolare classifiche, punteggi o meccaniche di gioco",
        "Diffamare, molestare o danneggiare altri Utenti",
        "Violare i diritti di propriet intellettuale di NIYVORA KFT"
      ],
      consequences: "La violazione di questi divieti comporter la sospensione immediata o la cancellazione definitiva dell'account, senza preavviso e senza diritto a rimborso."
    },
    s7: {
      title: "7. Propriet Intellettuale e Copyright",
      intro: "Tutti i contenuti di M1SSION, inclusi ma non limitati a: testi, grafica, loghi, icone, immagini, audio, video, software, codice sorgente, interfacce, storyline, meccaniche di gioco, premi e design, sono di esclusiva propriet di Joseph Mul e NIYVORA KFT, protetti dalle leggi sul copyright e sulla propriet intellettuale.",
      warningTitle: "  ASSOLUTAMENTE VIETATO:",
      prohibitions: [
        "Copiare, riprodurre o distribuire qualsiasi contenuto dell'applicazione",
        "Effettuare reverse engineering, decompilazione o disassemblaggio del software",
        "Creare opere derivate basate su M1SSION",
        "Utilizzare il marchio M1SSION senza autorizzazione scritta",
        "Estrarre dati, contenuti o informazioni dall'applicazione",
        "Utilizzare screenshot, video o registrazioni per scopi commerciali"
      ],
      legal: "Qualsiasi violazione sar perseguita nelle sedi legali competenti e potr comportare richieste di risarcimento danni."
    },
    s8: {
      title: "8. Limitazione di Responsabilit e Sicurezza nelle Missioni",
      intro: `M1SSION  fornito "cos com'" (as is) senza garanzie di alcun tipo. NIYVORA KFT non  responsabile per danni diretti, indiretti, incidentali o consequenziali derivanti dall'utilizzo dell'applicazione.`,
      safetyTitle: "SICUREZZA NELLE MISSIONI FISICHE",
      safetyRules: [
        "L'Utente  responsabile della propria sicurezza durante le attivit di gioco nel mondo reale",
        " vietato entrare in propriet private senza autorizzazione",
        " vietato violare leggi locali, regolamenti o ordinanze",
        " vietato mettersi in situazioni pericolose per completare missioni",
        "L'Utente deve sempre rispettare il codice della strada e le norme di sicurezza",
        "NIYVORA KFT declina ogni responsabilit per incidenti, infortuni o danni derivanti da comportamenti imprudenti o illegali"
      ],
      limitation: "In nessun caso NIYVORA KFT sar responsabile per importi superiori a quanto eventualmente pagato dall'Utente per i servizi negli ultimi 12 mesi."
    },
    s9: {
      title: "9. Privacy e Intelligenza Artificiale AION",
      intro: "La raccolta e il trattamento dei dati personali dell'Utente sono regolati dalla nostra Privacy Policy, che costituisce parte integrante dei presenti Termini.",
      aion: "AION, l'intelligenza artificiale integrata in M1SSION, elabora dati in base alle impostazioni privacy dell'Utente. AION fornisce assistenza, suggerimenti e contenuti generati algoritmicamente. Le risposte di AION sono di intrattenimento e non costituiscono consulenze professionali.",
      link: " Consulta la Privacy Policy completa "
    },
    s10: {
      title: "10. Modifiche ai Servizi e ai Termini",
      intro: "NIYVORA KFT si riserva il diritto di modificare in qualsiasi momento:",
      rules: [
        "I presenti Termini e Condizioni",
        "Le funzionalit e i servizi dell'applicazione",
        "Le meccaniche di gioco, premi e classifiche",
        "I valori e le regole relative a M1U e PE",
        "Le modifiche saranno comunicate tramite l'applicazione o via email",
        "L'uso continuato dell'applicazione dopo le modifiche costituisce accettazione delle stesse"
      ]
    },
    s11: {
      title: "11. Giurisdizione e Legge Applicabile",
      intro: "I presenti Termini sono regolati dalla legge italiana e dalle normative dell'Unione Europea applicabili.",
      points: [
        "Foro competente esclusivo: Tribunale di Milano, Italia",
        "Per controversie di consumo si applicano le normative UE sulla risoluzione alternativa delle controversie (ADR/ODR)",
        "L'Utente rinuncia a qualsiasi obiezione sulla competenza territoriale",
        "Le clausole dei presenti Termini sono da considerarsi separabili"
      ]
    },
    s12: {
      title: "12. Contatti Legali",
      intro: "Per domande, reclami o comunicazioni legali relative ai presenti Termini:"
    }
  }
};
const TERMS_EN = {
  title: "Terms and Conditions of Use",
  lastUpdate: "Last updated: December 5, 2025",
  draftNote: "This document is an informational draft and may be updated following formal legal review.",
  sections: {
    s1: {
      title: "1. Subject Matter and Definitions",
      intro: 'These Terms and Conditions ("Terms") govern access to and use of the M1SSION application, owned by NIYVORA KFT. By using the application, the User fully accepts these Terms.',
      definitions: [
        { term: "M1SSION", def: "Mobile investigative gaming application featuring geolocation elements, physical and digital missions, real prizes, leaderboards, and artificial intelligence." },
        { term: "User", def: "Any natural person who accesses and uses the M1SSION application." },
        { term: "M1U (M1 Units)", def: "Virtual currency internal to the M1SSION ecosystem, with no real monetary value." },
        { term: "PE (Pulse Energy)", def: "Virtual resource used for specific game mechanics, with no real monetary value." },
        { term: "Buzz Map", def: "3D geolocated map displaying clues, missions, and rewards in the surrounding environment." },
        { term: "AION", def: "Integrated artificial intelligence that assists the User during the gaming experience." },
        { term: "Pulse Breaker", def: "Entertainment mini-game using M1U or PE with multiplier mechanics." }
      ],
      disclaimer: "M1SSION content is purely for entertainment and does not constitute professional, financial, or any other type of advice."
    },
    s2: {
      title: "2. Access Requirements and Registration",
      intro: "To use M1SSION, the User must meet the following requirements:",
      requirements: [
        "Be at least 13 years of age (or the minimum age required by local jurisdiction)",
        "Provide accurate and truthful information during registration",
        "Maintain confidentiality of login credentials",
        "Use only one personal account",
        "Comply with local laws when using the application"
      ]
    },
    s3: {
      title: "3. M1SSION Gaming Services",
      intro: "M1SSION offers an investigative gaming experience that includes:",
      services: [
        "Buzz Map: interactive 3D map with geolocated clues",
        "Missions: physical and digital challenges to complete in the real world",
        "Clues: narrative elements to discover and decipher",
        "Leaderboards: global, national, and regional rankings",
        "Prizes: physical and digital rewards for players",
        "Community: player interactions, messages, and notifications",
        "AION: AI assistant for in-game support"
      ],
      note: "Services may be modified, suspended, or discontinued at any time at the discretion of NIYVORA KFT."
    },
    s4: {
      title: "4. Virtual Currencies (M1U and Pulse Energy)",
      warning: "IMPORTANT NOTICE",
      intro: "M1SSION uses two types of internal virtual currencies:",
      m1u: "Virtual tokens used to unlock content, participate in missions and mini-games within the M1SSION ecosystem.",
      pe: "Virtual energy used for specific game mechanics and community participation.",
      rules: [
        "M1U and PE do NOT represent real money, financial instruments, credits, or blockchain tokens",
        "M1U and PE are NOT exchangeable, sellable, or convertible to legal currency",
        "M1U and PE are NOT refundable in any form",
        "M1U and PE can only be earned or lost within the M1SSION ecosystem",
        "M1U and PE have no value outside the application",
        "NIYVORA KFT reserves the right to modify balances, mechanics, or value of M1U and PE"
      ]
    },
    s5: {
      title: '5. "Pulse Breaker" Mini-Game',
      antiGambling: "ANTI-GAMBLING STATEMENT",
      intro: 'Pulse Breaker is a PURELY ENTERTAINMENT mini-game that exclusively uses M1U or PE. The mini-game features a mechanic with increasing multipliers and a "crash" point.',
      rules: [
        "Pulse Breaker is NOT gambling under applicable regulations",
        "It is NOT possible to bet or win real money",
        "Bets are made ONLY with M1U or PE (virtual currencies)",
        "Winnings are exclusively in M1U or PE, with no monetary value",
        "Multipliers and house edge are part of the internal game logic",
        "There is NO possibility of withdrawal, conversion, or redemption for money",
        "The game is designed for entertainment, not to simulate gambling behavior"
      ],
      disclaimer: "The User is solely responsible for their behavior and must use Pulse Breaker responsibly and consciously.",
      suspension: "NIYVORA KFT reserves the right to suspend, limit, or revoke access to Pulse Breaker in case of abuse, fraudulent use, or behavior contrary to these Terms."
    },
    s6: {
      title: "6. User Conduct and Prohibitions",
      intro: "The User agrees to use M1SSION lawfully and responsibly. The following is expressly prohibited:",
      prohibitions: [
        "Using the application for illegal or fraudulent activities",
        "Trespassing on private property during missions",
        "Sharing, selling, or transferring access to your account",
        "Creating multiple accounts to gain unauthorized advantages",
        "Attempting to hack, decompile, or tamper with the application",
        "Using bots, scripts, or automation software",
        "Manipulating leaderboards, scores, or game mechanics",
        "Defaming, harassing, or harming other Users",
        "Violating NIYVORA KFT's intellectual property rights"
      ],
      consequences: "Violation of these prohibitions will result in immediate suspension or permanent deletion of the account, without notice and without right to refund."
    },
    s7: {
      title: "7. Intellectual Property and Copyright",
      intro: "All M1SSION content, including but not limited to: texts, graphics, logos, icons, images, audio, video, software, source code, interfaces, storylines, game mechanics, prizes, and design, are the exclusive property of Joseph Mul and NIYVORA KFT, protected by copyright and intellectual property laws.",
      warningTitle: " ABSOLUTELY PROHIBITED:",
      prohibitions: [
        "Copying, reproducing, or distributing any application content",
        "Reverse engineering, decompiling, or disassembling the software",
        "Creating derivative works based on M1SSION",
        "Using the M1SSION trademark without written authorization",
        "Extracting data, content, or information from the application",
        "Using screenshots, videos, or recordings for commercial purposes"
      ],
      legal: "Any violation will be prosecuted in competent legal venues and may result in claims for damages."
    },
    s8: {
      title: "8. Limitation of Liability and Mission Safety",
      intro: 'M1SSION is provided "as is" without warranties of any kind. NIYVORA KFT is not responsible for direct, indirect, incidental, or consequential damages arising from use of the application.',
      safetyTitle: "PHYSICAL MISSION SAFETY",
      safetyRules: [
        "The User is responsible for their own safety during real-world gaming activities",
        "Entering private property without authorization is prohibited",
        "Violating local laws, regulations, or ordinances is prohibited",
        "Putting oneself in dangerous situations to complete missions is prohibited",
        "The User must always respect traffic laws and safety regulations",
        "NIYVORA KFT disclaims all responsibility for accidents, injuries, or damages resulting from reckless or illegal behavior"
      ],
      limitation: "In no event shall NIYVORA KFT be liable for amounts exceeding what the User may have paid for services in the last 12 months."
    },
    s9: {
      title: "9. Privacy and AION Artificial Intelligence",
      intro: "Collection and processing of User personal data is governed by our Privacy Policy, which forms an integral part of these Terms.",
      aion: "AION, the artificial intelligence integrated into M1SSION, processes data according to User privacy settings. AION provides assistance, suggestions, and algorithmically generated content. AION responses are for entertainment and do not constitute professional advice.",
      link: " View complete Privacy Policy "
    },
    s10: {
      title: "10. Changes to Services and Terms",
      intro: "NIYVORA KFT reserves the right to modify at any time:",
      rules: [
        "These Terms and Conditions",
        "Application features and services",
        "Game mechanics, prizes, and leaderboards",
        "Values and rules relating to M1U and PE",
        "Changes will be communicated through the application or via email",
        "Continued use of the application after changes constitutes acceptance thereof"
      ]
    },
    s11: {
      title: "11. Jurisdiction and Applicable Law",
      intro: "These Terms are governed by Italian law and applicable European Union regulations.",
      points: [
        "Exclusive jurisdiction: Court of Milan, Italy",
        "For consumer disputes, EU regulations on alternative dispute resolution (ADR/ODR) apply",
        "The User waives any objection to territorial jurisdiction",
        "The clauses of these Terms are to be considered severable"
      ]
    },
    s12: {
      title: "12. Legal Contacts",
      intro: "For questions, complaints, or legal communications regarding these Terms:"
    }
  }
};

const PrivacyPolicyComplete = () => {
  useLocation();
  const [lang, setLang] = reactExports.useState("it");
  const content = lang === "it" ? PRIVACY_IT : PRIVACY_EN;
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#131524] via-[#0F1419] to-black text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "container mx-auto px-4 py-8 max-w-4xl", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      className: "space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => window.history.back(),
                variant: "ghost",
                size: "icon",
                className: "rounded-full hover:bg-white/10",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: "Privacy Policy" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "M1SSION  GDPR Compliant" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 bg-black/30 rounded-full p-1 border border-white/10", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setLang("it"),
                className: `px-3 py-1 rounded-full text-sm font-medium transition-all ${lang === "it" ? "bg-[#00D1FF] text-black" : "text-white/60 hover:text-white"}`,
                children: " IT"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setLang("en"),
                className: `px-3 py-1 rounded-full text-sm font-medium transition-all ${lang === "en" ? "bg-[#00D1FF] text-black" : "text-white/60 hover:text-white"}`,
                children: " EN"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
              content.title
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-sm mt-2", children: content.lastUpdate })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-8 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-[#00D1FF]/10 p-4 rounded-lg border border-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.intro }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-5 h-5" }), title: content.s1.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s1.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-[#00D1FF]/20 mt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: content.s1.company }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "NIYVORA KFT" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Budapest, Hungary" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 mt-2", children: [
                  content.s1.dpo,
                  ": Joseph Mul"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF]", children: "contact@m1ssion.com" })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-5 h-5" }), title: content.s2.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s2.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-[#00D1FF] mt-4", children: content.s2.account.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4", children: content.s2.account.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-[#00D1FF] mt-4", children: content.s2.geo.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4", children: content.s2.geo.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-[#00D1FF] mt-4", children: content.s2.usage.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4", children: content.s2.usage.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-[#00D1FF] mt-4", children: content.s2.tech.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4", children: content.s2.tech.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-5 h-5 text-green-400" }), title: content.s3.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-green-900/20 p-4 rounded-lg border border-green-500/30 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-green-300", children: content.s3.warning }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s3.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.s3.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-white/70 text-sm italic", children: content.s3.note })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(UserCheck, { className: "w-5 h-5" }), title: content.s4.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s4.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid gap-3 mt-4", children: content.s4.bases.map((base, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/20 p-3 rounded-lg", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-[#00D1FF] font-semibold", children: [
                  base.type,
                  ":"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80 ml-2", children: base.desc })
              ] }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-5 h-5 text-purple-400" }), title: content.s5.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s5.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.s5.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-white/70 text-sm italic", children: content.s5.note })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Gamepad2, { className: "w-5 h-5 text-yellow-400" }), title: content.s6.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/30 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-red-300 font-semibold", children: [
                " ",
                content.s6.antiGambling
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s6.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4 mt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-yellow-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Coins, { className: "w-5 h-5 text-yellow-400 mb-2" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-yellow-400 font-semibold", children: "M1U / PE" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: content.s6.m1u })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-purple-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Gamepad2, { className: "w-5 h-5 text-purple-400 mb-2" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-purple-400 font-semibold", children: "Pulse Breaker" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: content.s6.pulse })
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Globe, { className: "w-5 h-5" }), title: content.s7.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s7.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-[#00D1FF] mt-4", children: content.s7.subTitle }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-2", children: content.s7.processors.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4", children: content.s7.noSale })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Server, { className: "w-5 h-5" }), title: content.s8.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s8.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.s8.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-5 h-5 text-green-400" }), title: content.s9.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s9.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.s9.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-5 h-5" }), title: content.s10.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s10.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.s10.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-[#00D1FF]", children: /* @__PURE__ */ jsxRuntimeExports.jsx("a", { href: "/cookie-policy", className: "hover:underline", children: content.s10.link }) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-5 h-5" }), title: content.s11.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s11.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.s11.items.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-5 h-5 text-[#00D1FF]" }), title: content.s12.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s12.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid gap-3 mt-4", children: content.s12.rights.map((right, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/20 p-3 rounded-lg flex items-start gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-[#00D1FF] font-semibold whitespace-nowrap", children: [
                  right.name,
                  ":"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80", children: right.desc })
              ] }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4", children: content.s12.exercise })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 text-orange-400" }), title: content.s13.title, children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s13.intro }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-5 h-5" }), title: content.s14.title, children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s14.intro }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section$1, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "w-5 h-5" }), title: content.s15.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s15.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-[#00D1FF]/20 mt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NIYVORA KFT" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Data Protection Officer: Joseph Mul" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF] text-lg mt-2", children: "contact@m1ssion.com" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-white/70 text-sm", children: content.s15.authority })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pt-6 border-t border-white/10 text-center text-white/60", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: " 2025 M1SSION  GDPR Compliant" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: "NIYVORA KFT  Budapest, Hungary" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs mt-3 text-white/40", children: content.draftNote }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs mt-1 text-white/30", children: content.lastUpdate })
            ] })
          ] })
        ] })
      ]
    }
  ) }) });
};
const Section$1 = ({ icon, title, children }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { children: [
  /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-semibold text-[#00D1FF] mb-3 flex items-center gap-2", children: [
    icon,
    title
  ] }),
  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2 text-white/90", children })
] });
const PRIVACY_IT = {
  title: "Informativa sulla Privacy",
  lastUpdate: "Ultimo aggiornamento: 5 Dicembre 2025",
  draftNote: "Documento conforme al Regolamento UE 2016/679 (GDPR). Bozza soggetta a revisione legale.",
  intro: `La presente Informativa sulla Privacy descrive come NIYVORA KFT ("Titolare") raccoglie, utilizza, conserva e protegge i dati personali degli utenti dell'applicazione M1SSION, in conformit al Regolamento Generale sulla Protezione dei Dati (GDPR - Regolamento UE 2016/679).`,
  s1: {
    title: "1. Titolare del Trattamento",
    intro: "Il Titolare del trattamento dei dati personali :",
    company: "Titolare:",
    dpo: "Data Protection Officer (DPO)"
  },
  s2: {
    title: "2. Dati Personali Raccolti",
    intro: "M1SSION raccoglie le seguenti categorie di dati personali:",
    account: {
      title: "Dati di Account",
      items: [
        "Nome utente e codice agente",
        "Indirizzo email",
        "Password (crittografata con hash sicuro)",
        "Immagine del profilo (opzionale)",
        "Preferenze di lingua e notifiche"
      ]
    },
    geo: {
      title: "Dati di Geolocalizzazione",
      items: [
        "Coordinate GPS in tempo reale (latitudine, longitudine)",
        "Precisione della posizione",
        "Timestamp delle rilevazioni",
        "Storico posizioni per missioni completate"
      ]
    },
    usage: {
      title: "Dati di Utilizzo e Performance",
      items: [
        "Progressi di gioco, missioni completate, indizi sbloccati",
        "Statistiche di sessione (durata, frequenza)",
        "Punteggi, classifiche, achievement",
        "Saldo M1U (M1 Units) e PE (Pulse Energy)",
        "Storico partite Pulse Breaker (solo dati interni di gioco)"
      ]
    },
    tech: {
      title: "Dati Tecnici",
      items: [
        "Indirizzo IP",
        "Tipo di dispositivo, sistema operativo, versione app",
        "Identificatori univoci del dispositivo",
        "Log di errori e crash report",
        "Token per notifiche push"
      ]
    }
  },
  s3: {
    title: "3. Geolocalizzazione",
    warning: " La geolocalizzazione  ESSENZIALE per il funzionamento di M1SSION",
    intro: "L'applicazione richiede l'accesso alla posizione per:",
    items: [
      "Visualizzare la Buzz Map 3D con indizi geolocalizzati",
      "Verificare il completamento delle missioni fisiche",
      "Generare indizi contestuali basati sulla posizione",
      "Abilitare funzionalit di realt aumentata",
      "Calcolare distanze e prossimit ai punti di interesse"
    ],
    note: "I dati di posizione in tempo reale NON vengono memorizzati permanentemente. Lo storico delle missioni completate viene conservato per la cronologia di gioco."
  },
  s4: {
    title: "4. Basi Giuridiche del Trattamento (Art. 6 GDPR)",
    intro: "Il trattamento dei dati personali si basa sulle seguenti basi giuridiche:",
    bases: [
      { type: "Contratto (Art. 6.1.b)", desc: "Necessario per l'esecuzione del servizio M1SSION" },
      { type: "Consenso (Art. 6.1.a)", desc: "Per notifiche push, marketing, geolocalizzazione opzionale" },
      { type: "Legittimo Interesse (Art. 6.1.f)", desc: "Sicurezza, prevenzione frodi, miglioramento servizio" },
      { type: "Obbligo Legale (Art. 6.1.c)", desc: "Adempimenti fiscali, richieste autorit competenti" }
    ]
  },
  s5: {
    title: "5. Intelligenza Artificiale AION",
    intro: "M1SSION integra AION, un'intelligenza artificiale che assiste gli utenti durante il gioco. AION elabora:",
    items: [
      "Messaggi e query dell'utente (per fornire risposte contestuali)",
      "Dati di gioco (per personalizzare suggerimenti)",
      "Preferenze impostate dall'utente (per adattare il comportamento)",
      "Nessun dato viene utilizzato per addestrare modelli esterni"
    ],
    note: "Le risposte di AION sono generate algoritmicamente per intrattenimento e non costituiscono consulenze professionali. I dati elaborati da AION sono soggetti alle stesse protezioni di tutti gli altri dati personali."
  },
  s6: {
    title: "6. Valute Virtuali e Pulse Breaker",
    antiGambling: "DICHIARAZIONE ANTI-GAMBLING",
    intro: "M1SSION utilizza valute virtuali interne (M1U e PE) e include il mini-gioco Pulse Breaker.  fondamentale chiarire che:",
    m1u: "M1U e PE sono valute virtuali senza valore monetario reale. Non sono convertibili, scambiabili o rimborsabili in denaro. I dati relativi ai saldi sono conservati esclusivamente per il funzionamento del gioco.",
    pulse: "Pulse Breaker  un mini-gioco di INTRATTENIMENTO. NON  un servizio di gioco con finalit economica. Non costituisce gioco d'azzardo. Nessun dato viene condiviso con piattaforme di betting o gambling."
  },
  s7: {
    title: "7. Condivisione e Destinatari dei Dati",
    intro: "I dati personali possono essere condivisi con:",
    subTitle: "Sub-responsabili del Trattamento:",
    processors: [
      "Supabase Inc. (database, autenticazione)  USA, clausole contrattuali standard",
      "Cloudflare Inc. (CDN, sicurezza)  USA, certificazione Privacy Shield",
      "Apple Inc. / Google LLC (notifiche push, pagamenti in-app)",
      "OpenAI (elaborazione AI per AION)  con misure di anonimizzazione",
      "Stripe Inc. (pagamenti, se applicabile)  certificazione PCI-DSS"
    ],
    noSale: " NON vendiamo, affittiamo o cediamo MAI i dati personali a terze parti per scopi commerciali o pubblicitari."
  },
  s8: {
    title: "8. Trasferimenti di Dati Extra-UE",
    intro: "Alcuni nostri fornitori di servizi sono situati al di fuori dell'Unione Europea. I trasferimenti avvengono nel rispetto del GDPR attraverso:",
    items: [
      "Clausole Contrattuali Standard (SCC) approvate dalla Commissione Europea",
      "Decisioni di adeguatezza della Commissione Europea",
      "Misure tecniche supplementari (crittografia, pseudonimizzazione)",
      "Verifica periodica delle garanzie dei fornitori"
    ]
  },
  s9: {
    title: "9. Sicurezza dei Dati",
    intro: "Implementiamo misure di sicurezza tecniche e organizzative adeguate:",
    items: [
      "Crittografia SSL/TLS per tutte le comunicazioni",
      "Crittografia dei dati a riposo (AES-256)",
      "Hashing sicuro delle password (bcrypt)",
      "Autenticazione a due fattori disponibile",
      'Accesso limitato ai dati su base "need-to-know"',
      "Monitoraggio continuo e rilevamento intrusioni",
      "Backup automatici con crittografia",
      "Audit di sicurezza periodici"
    ]
  },
  s10: {
    title: "10. Cookie e Tecnologie di Tracciamento",
    intro: "M1SSION utilizza le seguenti tecnologie:",
    items: [
      "Cookie tecnici essenziali (autenticazione, sessione)",
      "LocalStorage per preferenze utente",
      "Token per notifiche push",
      "Analytics anonimizzati per miglioramento servizio"
    ],
    link: " Consulta la Cookie Policy completa "
  },
  s11: {
    title: "11. Conservazione dei Dati",
    intro: "I dati personali sono conservati per il tempo strettamente necessario:",
    items: [
      "Dati di account: per tutta la durata dell'account attivo",
      "Dati di gioco: per tutta la durata dell'account + 30 giorni dopo cancellazione",
      "Log tecnici: massimo 90 giorni",
      "Dati di fatturazione: 10 anni (obblighi fiscali)",
      "Dopo la cancellazione dell'account: eliminazione entro 30 giorni (salvo obblighi legali)"
    ]
  },
  s12: {
    title: "12. Diritti dell'Interessato (GDPR)",
    intro: "In conformit al GDPR, hai i seguenti diritti:",
    rights: [
      { name: "Accesso (Art. 15)", desc: "Ottenere conferma e copia dei tuoi dati personali" },
      { name: "Rettifica (Art. 16)", desc: "Correggere dati inesatti o incompleti" },
      { name: "Cancellazione (Art. 17)", desc: `Richiedere l'eliminazione dei dati ("diritto all'oblio")` },
      { name: "Limitazione (Art. 18)", desc: "Limitare il trattamento in determinate circostanze" },
      { name: "Portabilit (Art. 20)", desc: "Ricevere i dati in formato strutturato e trasferirli" },
      { name: "Opposizione (Art. 21)", desc: "Opporti al trattamento per legittimo interesse" },
      { name: "Revoca Consenso", desc: "Revocare il consenso in qualsiasi momento" }
    ],
    exercise: "Per esercitare i tuoi diritti, contatta: contact@m1ssion.com. Risponderemo entro 30 giorni."
  },
  s13: {
    title: "13. Minori",
    intro: "M1SSION  destinato a utenti di almeno 13 anni. Non raccogliamo consapevolmente dati di minori al di sotto di tale et. Se un genitore o tutore scopre che un minore ha fornito dati senza consenso, ci contatti immediatamente per la rimozione."
  },
  s14: {
    title: "14. Modifiche alla Privacy Policy",
    intro: "Ci riserviamo il diritto di modificare questa Privacy Policy. Le modifiche significative saranno comunicate tramite notifica in-app e/o email almeno 30 giorni prima dell'entrata in vigore. L'uso continuato dell'app dopo le modifiche costituisce accettazione."
  },
  s15: {
    title: "15. Contatti e Reclami",
    intro: "Per qualsiasi domanda, richiesta o reclamo relativo alla privacy:",
    authority: "Hai inoltre il diritto di proporre reclamo all'Autorit Garante per la Protezione dei Dati Personali (www.garanteprivacy.it) o all'autorit di controllo del tuo paese di residenza."
  }
};
const PRIVACY_EN = {
  title: "Privacy Policy",
  lastUpdate: "Last updated: December 5, 2025",
  draftNote: "Document compliant with EU Regulation 2016/679 (GDPR). Draft subject to legal review.",
  intro: 'This Privacy Policy describes how NIYVORA KFT ("Controller") collects, uses, stores, and protects the personal data of M1SSION application users, in compliance with the General Data Protection Regulation (GDPR - EU Regulation 2016/679).',
  s1: {
    title: "1. Data Controller",
    intro: "The Data Controller for personal data processing is:",
    company: "Controller:",
    dpo: "Data Protection Officer (DPO)"
  },
  s2: {
    title: "2. Personal Data Collected",
    intro: "M1SSION collects the following categories of personal data:",
    account: {
      title: "Account Data",
      items: [
        "Username and agent code",
        "Email address",
        "Password (encrypted with secure hash)",
        "Profile picture (optional)",
        "Language and notification preferences"
      ]
    },
    geo: {
      title: "Geolocation Data",
      items: [
        "Real-time GPS coordinates (latitude, longitude)",
        "Location accuracy",
        "Detection timestamps",
        "Location history for completed missions"
      ]
    },
    usage: {
      title: "Usage and Performance Data",
      items: [
        "Game progress, completed missions, unlocked clues",
        "Session statistics (duration, frequency)",
        "Scores, leaderboards, achievements",
        "M1U (M1 Units) and PE (Pulse Energy) balance",
        "Pulse Breaker game history (internal game data only)"
      ]
    },
    tech: {
      title: "Technical Data",
      items: [
        "IP address",
        "Device type, operating system, app version",
        "Unique device identifiers",
        "Error logs and crash reports",
        "Push notification tokens"
      ]
    }
  },
  s3: {
    title: "3. Geolocation",
    warning: " Geolocation is ESSENTIAL for M1SSION to function",
    intro: "The application requires location access to:",
    items: [
      "Display the 3D Buzz Map with geolocated clues",
      "Verify completion of physical missions",
      "Generate contextual clues based on location",
      "Enable augmented reality features",
      "Calculate distances and proximity to points of interest"
    ],
    note: "Real-time location data is NOT permanently stored. History of completed missions is retained for game chronicle purposes."
  },
  s4: {
    title: "4. Legal Bases for Processing (Art. 6 GDPR)",
    intro: "Personal data processing is based on the following legal grounds:",
    bases: [
      { type: "Contract (Art. 6.1.b)", desc: "Necessary for M1SSION service execution" },
      { type: "Consent (Art. 6.1.a)", desc: "For push notifications, marketing, optional geolocation" },
      { type: "Legitimate Interest (Art. 6.1.f)", desc: "Security, fraud prevention, service improvement" },
      { type: "Legal Obligation (Art. 6.1.c)", desc: "Tax compliance, competent authority requests" }
    ]
  },
  s5: {
    title: "5. AION Artificial Intelligence",
    intro: "M1SSION integrates AION, an artificial intelligence that assists users during gameplay. AION processes:",
    items: [
      "User messages and queries (to provide contextual responses)",
      "Game data (to personalize suggestions)",
      "User-set preferences (to adapt behavior)",
      "No data is used to train external models"
    ],
    note: "AION responses are algorithmically generated for entertainment and do not constitute professional advice. Data processed by AION is subject to the same protections as all other personal data."
  },
  s6: {
    title: "6. Virtual Currencies and Pulse Breaker",
    antiGambling: "ANTI-GAMBLING STATEMENT",
    intro: "M1SSION uses internal virtual currencies (M1U and PE) and includes the Pulse Breaker mini-game. It is essential to clarify that:",
    m1u: "M1U and PE are virtual currencies with no real monetary value. They are not convertible, exchangeable, or refundable for money. Balance data is stored exclusively for game operation.",
    pulse: "Pulse Breaker is an ENTERTAINMENT mini-game. It is NOT a gaming service with economic purposes. It does not constitute gambling. No data is shared with betting or gambling platforms."
  },
  s7: {
    title: "7. Data Sharing and Recipients",
    intro: "Personal data may be shared with:",
    subTitle: "Data Sub-processors:",
    processors: [
      "Supabase Inc. (database, authentication)  USA, standard contractual clauses",
      "Cloudflare Inc. (CDN, security)  USA, Privacy Shield certification",
      "Apple Inc. / Google LLC (push notifications, in-app payments)",
      "OpenAI (AI processing for AION)  with anonymization measures",
      "Stripe Inc. (payments, if applicable)  PCI-DSS certification"
    ],
    noSale: " We NEVER sell, rent, or transfer personal data to third parties for commercial or advertising purposes."
  },
  s8: {
    title: "8. Extra-EU Data Transfers",
    intro: "Some of our service providers are located outside the European Union. Transfers occur in compliance with GDPR through:",
    items: [
      "Standard Contractual Clauses (SCCs) approved by the European Commission",
      "European Commission adequacy decisions",
      "Supplementary technical measures (encryption, pseudonymization)",
      "Periodic verification of provider guarantees"
    ]
  },
  s9: {
    title: "9. Data Security",
    intro: "We implement appropriate technical and organizational security measures:",
    items: [
      "SSL/TLS encryption for all communications",
      "Data encryption at rest (AES-256)",
      "Secure password hashing (bcrypt)",
      "Two-factor authentication available",
      'Data access limited on "need-to-know" basis',
      "Continuous monitoring and intrusion detection",
      "Automatic encrypted backups",
      "Periodic security audits"
    ]
  },
  s10: {
    title: "10. Cookies and Tracking Technologies",
    intro: "M1SSION uses the following technologies:",
    items: [
      "Essential technical cookies (authentication, session)",
      "LocalStorage for user preferences",
      "Push notification tokens",
      "Anonymized analytics for service improvement"
    ],
    link: " View complete Cookie Policy "
  },
  s11: {
    title: "11. Data Retention",
    intro: "Personal data is retained for the strictly necessary period:",
    items: [
      "Account data: for the duration of active account",
      "Game data: for account duration + 30 days after deletion",
      "Technical logs: maximum 90 days",
      "Billing data: 10 years (tax obligations)",
      "After account deletion: removal within 30 days (except legal obligations)"
    ]
  },
  s12: {
    title: "12. Data Subject Rights (GDPR)",
    intro: "In accordance with GDPR, you have the following rights:",
    rights: [
      { name: "Access (Art. 15)", desc: "Obtain confirmation and copy of your personal data" },
      { name: "Rectification (Art. 16)", desc: "Correct inaccurate or incomplete data" },
      { name: "Erasure (Art. 17)", desc: 'Request data deletion ("right to be forgotten")' },
      { name: "Restriction (Art. 18)", desc: "Restrict processing in certain circumstances" },
      { name: "Portability (Art. 20)", desc: "Receive data in structured format and transfer it" },
      { name: "Object (Art. 21)", desc: "Object to processing based on legitimate interest" },
      { name: "Withdraw Consent", desc: "Withdraw consent at any time" }
    ],
    exercise: "To exercise your rights, contact: contact@m1ssion.com. We will respond within 30 days."
  },
  s13: {
    title: "13. Minors",
    intro: "M1SSION is intended for users at least 13 years of age. We do not knowingly collect data from minors below this age. If a parent or guardian discovers that a minor has provided data without consent, please contact us immediately for removal."
  },
  s14: {
    title: "14. Privacy Policy Changes",
    intro: "We reserve the right to modify this Privacy Policy. Significant changes will be communicated via in-app notification and/or email at least 30 days before taking effect. Continued use of the app after changes constitutes acceptance."
  },
  s15: {
    title: "15. Contacts and Complaints",
    intro: "For any questions, requests, or complaints regarding privacy:",
    authority: "You also have the right to lodge a complaint with the Data Protection Authority (www.garanteprivacy.it) or the supervisory authority in your country of residence."
  }
};

const CookiePolicyComplete = () => {
  const [, setLocation] = useLocation();
  const [lang, setLang] = reactExports.useState("it");
  const content = lang === "it" ? COOKIE_IT : COOKIE_EN;
  const today = (/* @__PURE__ */ new Date()).toLocaleDateString(lang === "it" ? "it-IT" : "en-GB", {
    day: "numeric",
    month: "long",
    year: "numeric"
  });
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#131524] via-[#0F1419] to-black text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "container mx-auto px-4 py-8 max-w-4xl", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      className: "space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => window.history.back(),
                variant: "ghost",
                size: "icon",
                className: "rounded-full hover:bg-white/10",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: "Cookie Policy" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "M1SSION  GDPR & ePrivacy" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 bg-black/30 rounded-full p-1 border border-white/10", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setLang("it"),
                className: `px-3 py-1 rounded-full text-sm font-medium transition-all ${lang === "it" ? "bg-[#00D1FF] text-black" : "text-white/60 hover:text-white"}`,
                children: " IT"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setLang("en"),
                className: `px-3 py-1 rounded-full text-sm font-medium transition-all ${lang === "en" ? "bg-[#00D1FF] text-black" : "text-white/60 hover:text-white"}`,
                children: " EN"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
              content.title
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/60 text-sm mt-2", children: [
              content.version,
              " | ",
              content.lastUpdate,
              ": ",
              today
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-8 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-[#00D1FF]/10 p-4 rounded-lg border border-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.intro }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "w-5 h-5" }), title: content.s1.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s1.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-3", children: content.s1.types })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5" }), title: content.s2.title, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-[#00D1FF]/20", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NIYVORA KFT" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Budapest, Hungary" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 mt-2", children: [
                content.s2.dpo,
                ": Joseph Mul"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF]", children: "contact@m1ssion.com" })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-5 h-5 text-green-400" }), title: content.s3.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-green-900/20 p-4 rounded-lg border border-green-500/30 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-green-300 flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-5 h-5" }),
                content.s3.required
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s3.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CookieTable, { cookies: content.s3.cookies })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-5 h-5 text-blue-400" }), title: content.s4.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s4.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CookieTable, { cookies: content.s4.cookies })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(ChartColumn, { className: "w-5 h-5 text-purple-400" }), title: content.s5.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s5.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CookieTable, { cookies: content.s5.cookies }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-white/70 text-sm italic", children: content.s5.note })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Megaphone, { className: "w-5 h-5 text-orange-400" }), title: content.s6.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s6.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CookieTable, { cookies: content.s6.cookies })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Globe, { className: "w-5 h-5" }), title: content.s7.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s7.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid gap-3 mt-4", children: content.s7.thirdParties.map((tp, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/20 p-4 rounded-lg border border-white/10", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-semibold text-[#00D1FF]", children: tp.name }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/50", children: tp.type })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: tp.purpose }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  "a",
                  {
                    href: tp.policy,
                    target: "_blank",
                    rel: "noopener noreferrer",
                    className: "text-[#00D1FF] text-xs hover:underline mt-2 inline-block",
                    children: [
                      content.s7.policyLink,
                      " "
                    ]
                  }
                )
              ] }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Server, { className: "w-5 h-5" }), title: content.s8.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s8.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CookieTable, { cookies: content.s8.storage })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 text-yellow-400" }), title: content.s9.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/30 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-red-300 font-semibold", children: [
                " ",
                content.s9.antiGambling
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s9.intro })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-5 h-5" }), title: content.s10.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s10.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.s10.methods.map((method, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: method }, i)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 flex flex-wrap gap-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Button,
                {
                  className: "bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90",
                  onClick: () => setLocation("/settings"),
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 mr-2" }),
                    content.s10.settingsBtn
                  ]
                }
              ) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 text-[#00D1FF]" }), title: content.s11.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s11.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 mt-3", children: content.s11.rights.map((right, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: right }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "w-5 h-5" }), title: content.s12.title, children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s12.intro }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Section, { icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "w-5 h-5" }), title: content.s13.title, children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: content.s13.intro }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-[#00D1FF]/20 mt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NIYVORA KFT" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF] text-lg mt-2", children: "contact@m1ssion.com" })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pt-6 border-t border-white/10 text-center text-white/60", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: " 2025 M1SSION  GDPR & ePrivacy Compliant" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: "NIYVORA KFT  Budapest, Hungary" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs mt-3 text-white/40", children: [
                content.version,
                " | ",
                content.lastUpdate,
                ": ",
                today
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs mt-1 text-white/30", children: content.draftNote })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap justify-center gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: "outline",
              className: "border-white/20 text-white hover:bg-white/10",
              onClick: () => setLocation("/privacy-policy"),
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-4 h-4 mr-2" }),
                "Privacy Policy"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: "outline",
              className: "border-white/20 text-white hover:bg-white/10",
              onClick: () => setLocation("/terms"),
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "w-4 h-4 mr-2" }),
                lang === "it" ? "Termini di Servizio" : "Terms of Service"
              ]
            }
          )
        ] })
      ]
    }
  ) }) });
};
const Section = ({ icon, title, children }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { children: [
  /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-semibold text-[#00D1FF] mb-3 flex items-center gap-2", children: [
    icon,
    title
  ] }),
  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2 text-white/90", children })
] });
const CookieTable = ({ cookies }) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "overflow-x-auto mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("table", { className: "w-full text-sm", children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx("thead", { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("tr", { className: "border-b border-white/10", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("th", { className: "text-left py-2 px-3 text-[#00D1FF]", children: "Cookie/Key" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("th", { className: "text-left py-2 px-3 text-[#00D1FF]", children: "Provider" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("th", { className: "text-left py-2 px-3 text-[#00D1FF]", children: "Finalit" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("th", { className: "text-left py-2 px-3 text-[#00D1FF]", children: "Durata" })
  ] }) }),
  /* @__PURE__ */ jsxRuntimeExports.jsx("tbody", { children: cookies.map((cookie, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("tr", { className: "border-b border-white/5", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("td", { className: "py-2 px-3 font-mono text-xs text-purple-300", children: cookie.name }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("td", { className: "py-2 px-3 text-white/70", children: cookie.provider }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("td", { className: "py-2 px-3 text-white/70", children: cookie.purpose }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("td", { className: "py-2 px-3 text-white/50", children: cookie.duration })
  ] }, i)) })
] }) });
const COOKIE_IT = {
  title: "Cookie Policy",
  version: "Versione 1.1",
  lastUpdate: "Ultimo aggiornamento",
  draftNote: "Conforme a GDPR (Reg. UE 2016/679), ePrivacy e Direttiva 2002/58/CE",
  intro: "La presente Cookie Policy descrive le tipologie di cookie e tecnologie analoghe utilizzate dall'applicazione M1SSION di propriet di NIYVORA KFT. Questo documento  parte integrante della Privacy Policy.",
  s1: {
    title: "1. Cosa sono i Cookie",
    intro: "I cookie sono piccoli file di testo che vengono memorizzati sul tuo dispositivo (computer, smartphone, tablet) quando visiti un sito web o utilizzi un'applicazione. Servono a memorizzare informazioni sulla tua visita, come le preferenze di lingua, le impostazioni e altri dati utili per migliorare l'esperienza utente.",
    types: "Oltre ai cookie, M1SSION utilizza anche localStorage e sessionStorage, tecnologie simili che memorizzano dati nel browser ma con caratteristiche diverse: localStorage persiste anche dopo la chiusura del browser, mentre sessionStorage viene cancellato alla chiusura della sessione."
  },
  s2: {
    title: "2. Titolare del Trattamento",
    dpo: "Data Protection Officer"
  },
  s3: {
    title: "3. Cookie Tecnici Essenziali",
    required: "Questi cookie sono NECESSARI e non possono essere disabilitati",
    intro: "I cookie tecnici sono indispensabili per il corretto funzionamento dell'applicazione. Senza di essi, M1SSION non potrebbe fornire i suoi servizi base.",
    cookies: [
      { name: "sb-*-auth-token", provider: "Supabase", purpose: "Autenticazione utente", duration: "Sessione/7gg" },
      { name: "sb-*-auth-token-code-verifier", provider: "Supabase", purpose: "Verifica sicurezza PKCE", duration: "Sessione" },
      { name: "__cf_bm", provider: "Cloudflare", purpose: "Protezione bot/DDoS", duration: "30 min" },
      { name: "cf_clearance", provider: "Cloudflare", purpose: "Bypass captcha", duration: "1 anno" },
      { name: "__stripe_mid", provider: "Stripe", purpose: "Prevenzione frodi pagamenti", duration: "1 anno" },
      { name: "__stripe_sid", provider: "Stripe", purpose: "ID sessione pagamento", duration: "Sessione" }
    ]
  },
  s4: {
    title: "4. Cookie Funzionali / Preferenze",
    intro: "Questi cookie memorizzano le tue preferenze per personalizzare l'esperienza nell'app.",
    cookies: [
      { name: "m1:language", provider: "M1SSION", purpose: "Lingua preferita", duration: "1 anno" },
      { name: "m1:theme", provider: "M1SSION", purpose: "Tema (dark/light)", duration: "1 anno" },
      { name: "m1:onboarding_complete", provider: "M1SSION", purpose: "Tutorial completato", duration: "Permanente" },
      { name: "m1:sound_enabled", provider: "M1SSION", purpose: "Preferenza audio", duration: "Permanente" }
    ]
  },
  s5: {
    title: "5. Cookie Analitici",
    intro: "Questi cookie ci aiutano a capire come utilizzi l'app per migliorare l'esperienza. Richiedono il tuo consenso.",
    cookies: [
      { name: "_ga", provider: "Google Analytics", purpose: "Identificativo utente anonimo", duration: "2 anni" },
      { name: "_ga_*", provider: "Google Analytics", purpose: "Stato sessione", duration: "2 anni" },
      { name: "_gid", provider: "Google Analytics", purpose: "Distinzione utenti", duration: "24 ore" },
      { name: "_gat", provider: "Google Analytics", purpose: "Rate limiting richieste", duration: "1 minuto" }
    ],
    note: "Google Analytics  configurato con IP anonimizzato (anonymize_ip: true) e senza personalizzazione annunci."
  },
  s6: {
    title: "6. Cookie di Marketing e Profilazione",
    intro: "Attualmente M1SSION NON utilizza cookie di marketing o profilazione di terze parti. Se in futuro verranno introdotti, questa policy sar aggiornata e ti verr richiesto un consenso esplicito.",
    cookies: [
      { name: "(nessuno)", provider: "-", purpose: "Non utilizzati", duration: "-" }
    ]
  },
  s7: {
    title: "7. Servizi di Terze Parti",
    intro: "M1SSION si avvale dei seguenti servizi esterni che potrebbero impostare propri cookie:",
    thirdParties: [
      {
        name: "Supabase",
        type: "Database & Auth",
        purpose: "Autenticazione, database real-time, storage file",
        policy: "https://supabase.com/privacy"
      },
      {
        name: "Cloudflare",
        type: "CDN & Security",
        purpose: "Distribuzione contenuti, protezione DDoS, ottimizzazione performance",
        policy: "https://www.cloudflare.com/privacypolicy/"
      },
      {
        name: "Stripe",
        type: "Pagamenti",
        purpose: "Elaborazione pagamenti, gestione abbonamenti, prevenzione frodi",
        policy: "https://stripe.com/privacy"
      },
      {
        name: "Google Analytics 4",
        type: "Analytics",
        purpose: "Analisi utilizzo app (con consenso), statistiche aggregate anonimizzate",
        policy: "https://policies.google.com/privacy"
      },
      {
        name: "Cookie-Script",
        type: "Consent Management",
        purpose: "Gestione banner cookie e preferenze consenso GDPR",
        policy: "https://cookie-script.com/privacy-policy"
      }
    ],
    policyLink: "Privacy Policy"
  },
  s8: {
    title: "8. LocalStorage e SessionStorage",
    intro: "Oltre ai cookie, M1SSION utilizza le seguenti chiavi di storage nel browser:",
    storage: [
      { name: "m1:cookie_consent:v1", provider: "M1SSION", purpose: "Stato consenso cookie", duration: "180 giorni" },
      { name: "m1:push_token", provider: "M1SSION", purpose: "Token notifiche push", duration: "Permanente" },
      { name: "m1:last_sync", provider: "M1SSION", purpose: "Timestamp ultima sincronizzazione", duration: "Permanente" },
      { name: "m1:buzz_cache", provider: "M1SSION", purpose: "Cache indizi Buzz Map", duration: "Sessione" },
      { name: "m1:geo_permission", provider: "M1SSION", purpose: "Stato permesso geolocalizzazione", duration: "Permanente" }
    ]
  },
  s9: {
    title: "9. M1U, Pulse Energy e Pulse Breaker",
    antiGambling: "DICHIARAZIONE ANTI-GAMBLING",
    intro: "I dati relativi a M1U (M1 Units), Pulse Energy (PE) e al mini-gioco Pulse Breaker sono memorizzati ESCLUSIVAMENTE nel database Supabase lato server, NON in cookie locali. Questi dati sono utilizzati unicamente per il funzionamento del gioco e non hanno alcun valore monetario reale. Pulse Breaker NON  un gioco d'azzardo: non  possibile vincere, convertire o prelevare denaro reale."
  },
  s10: {
    title: "10. Gestione delle Preferenze Cookie",
    intro: "Puoi gestire le tue preferenze sui cookie in diversi modi:",
    methods: [
      "Banner cookie: appare al primo accesso e permette di accettare, rifiutare o personalizzare",
      "Impostazioni app: sezione Privacy nelle Impostazioni di M1SSION",
      "Impostazioni browser: puoi bloccare o cancellare i cookie dal tuo browser",
      "Revoca consenso: puoi revocare il consenso in qualsiasi momento dalle impostazioni"
    ],
    settingsBtn: "Vai alle Impostazioni"
  },
  s11: {
    title: "11. I Tuoi Diritti",
    intro: "In conformit al GDPR, hai il diritto di:",
    rights: [
      "Revocare il consenso ai cookie non essenziali in qualsiasi momento",
      "Richiedere informazioni sui dati raccolti tramite cookie",
      "Richiedere la cancellazione dei cookie (dove tecnicamente possibile)",
      "Presentare reclamo al Garante Privacy (www.garanteprivacy.it)"
    ]
  },
  s12: {
    title: "12. Modifiche alla Cookie Policy",
    intro: "Ci riserviamo il diritto di aggiornare questa Cookie Policy. Le modifiche significative saranno comunicate tramite banner in-app. La data dell'ultimo aggiornamento  indicata in cima a questo documento."
  },
  s13: {
    title: "13. Contatti",
    intro: "Per qualsiasi domanda sulla Cookie Policy o per esercitare i tuoi diritti:"
  }
};
const COOKIE_EN = {
  title: "Cookie Policy",
  version: "Version 1.1",
  lastUpdate: "Last updated",
  draftNote: "Compliant with GDPR (EU Reg. 2016/679), ePrivacy and Directive 2002/58/EC",
  intro: "This Cookie Policy describes the types of cookies and similar technologies used by the M1SSION application owned by NIYVORA KFT. This document is an integral part of the Privacy Policy.",
  s1: {
    title: "1. What are Cookies",
    intro: "Cookies are small text files stored on your device (computer, smartphone, tablet) when you visit a website or use an application. They store information about your visit, such as language preferences, settings, and other data useful for improving user experience.",
    types: "In addition to cookies, M1SSION also uses localStorage and sessionStorage, similar technologies that store data in the browser but with different characteristics: localStorage persists even after closing the browser, while sessionStorage is deleted when the session ends."
  },
  s2: {
    title: "2. Data Controller",
    dpo: "Data Protection Officer"
  },
  s3: {
    title: "3. Essential Technical Cookies",
    required: "These cookies are NECESSARY and cannot be disabled",
    intro: "Technical cookies are essential for the proper functioning of the application. Without them, M1SSION could not provide its basic services.",
    cookies: [
      { name: "sb-*-auth-token", provider: "Supabase", purpose: "User authentication", duration: "Session/7d" },
      { name: "sb-*-auth-token-code-verifier", provider: "Supabase", purpose: "PKCE security verification", duration: "Session" },
      { name: "__cf_bm", provider: "Cloudflare", purpose: "Bot/DDoS protection", duration: "30 min" },
      { name: "cf_clearance", provider: "Cloudflare", purpose: "Captcha bypass", duration: "1 year" },
      { name: "__stripe_mid", provider: "Stripe", purpose: "Payment fraud prevention", duration: "1 year" },
      { name: "__stripe_sid", provider: "Stripe", purpose: "Payment session ID", duration: "Session" }
    ]
  },
  s4: {
    title: "4. Functional / Preference Cookies",
    intro: "These cookies store your preferences to personalize your experience in the app.",
    cookies: [
      { name: "m1:language", provider: "M1SSION", purpose: "Preferred language", duration: "1 year" },
      { name: "m1:theme", provider: "M1SSION", purpose: "Theme (dark/light)", duration: "1 year" },
      { name: "m1:onboarding_complete", provider: "M1SSION", purpose: "Tutorial completed", duration: "Permanent" },
      { name: "m1:sound_enabled", provider: "M1SSION", purpose: "Audio preference", duration: "Permanent" }
    ]
  },
  s5: {
    title: "5. Analytics Cookies",
    intro: "These cookies help us understand how you use the app to improve the experience. They require your consent.",
    cookies: [
      { name: "_ga", provider: "Google Analytics", purpose: "Anonymous user identifier", duration: "2 years" },
      { name: "_ga_*", provider: "Google Analytics", purpose: "Session state", duration: "2 years" },
      { name: "_gid", provider: "Google Analytics", purpose: "User distinction", duration: "24 hours" },
      { name: "_gat", provider: "Google Analytics", purpose: "Request rate limiting", duration: "1 minute" }
    ],
    note: "Google Analytics is configured with anonymized IP (anonymize_ip: true) and without ad personalization."
  },
  s6: {
    title: "6. Marketing and Profiling Cookies",
    intro: "Currently M1SSION does NOT use third-party marketing or profiling cookies. If introduced in the future, this policy will be updated and explicit consent will be requested.",
    cookies: [
      { name: "(none)", provider: "-", purpose: "Not used", duration: "-" }
    ]
  },
  s7: {
    title: "7. Third-Party Services",
    intro: "M1SSION uses the following external services that may set their own cookies:",
    thirdParties: [
      {
        name: "Supabase",
        type: "Database & Auth",
        purpose: "Authentication, real-time database, file storage",
        policy: "https://supabase.com/privacy"
      },
      {
        name: "Cloudflare",
        type: "CDN & Security",
        purpose: "Content distribution, DDoS protection, performance optimization",
        policy: "https://www.cloudflare.com/privacypolicy/"
      },
      {
        name: "Stripe",
        type: "Payments",
        purpose: "Payment processing, subscription management, fraud prevention",
        policy: "https://stripe.com/privacy"
      },
      {
        name: "Google Analytics 4",
        type: "Analytics",
        purpose: "App usage analysis (with consent), anonymized aggregate statistics",
        policy: "https://policies.google.com/privacy"
      },
      {
        name: "Cookie-Script",
        type: "Consent Management",
        purpose: "Cookie banner management and GDPR consent preferences",
        policy: "https://cookie-script.com/privacy-policy"
      }
    ],
    policyLink: "Privacy Policy"
  },
  s8: {
    title: "8. LocalStorage and SessionStorage",
    intro: "In addition to cookies, M1SSION uses the following storage keys in the browser:",
    storage: [
      { name: "m1:cookie_consent:v1", provider: "M1SSION", purpose: "Cookie consent status", duration: "180 days" },
      { name: "m1:push_token", provider: "M1SSION", purpose: "Push notification token", duration: "Permanent" },
      { name: "m1:last_sync", provider: "M1SSION", purpose: "Last sync timestamp", duration: "Permanent" },
      { name: "m1:buzz_cache", provider: "M1SSION", purpose: "Buzz Map clue cache", duration: "Session" },
      { name: "m1:geo_permission", provider: "M1SSION", purpose: "Geolocation permission status", duration: "Permanent" }
    ]
  },
  s9: {
    title: "9. M1U, Pulse Energy and Pulse Breaker",
    antiGambling: "ANTI-GAMBLING STATEMENT",
    intro: "Data related to M1U (M1 Units), Pulse Energy (PE) and the Pulse Breaker mini-game is stored EXCLUSIVELY in the Supabase server-side database, NOT in local cookies. This data is used solely for game operation and has no real monetary value. Pulse Breaker is NOT gambling: it is not possible to win, convert, or withdraw real money."
  },
  s10: {
    title: "10. Managing Cookie Preferences",
    intro: "You can manage your cookie preferences in several ways:",
    methods: [
      "Cookie banner: appears on first access and allows you to accept, reject, or customize",
      "App settings: Privacy section in M1SSION Settings",
      "Browser settings: you can block or delete cookies from your browser",
      "Consent withdrawal: you can withdraw consent at any time from settings"
    ],
    settingsBtn: "Go to Settings"
  },
  s11: {
    title: "11. Your Rights",
    intro: "In accordance with GDPR, you have the right to:",
    rights: [
      "Withdraw consent for non-essential cookies at any time",
      "Request information about data collected via cookies",
      "Request deletion of cookies (where technically possible)",
      "File a complaint with the Data Protection Authority"
    ]
  },
  s12: {
    title: "12. Changes to Cookie Policy",
    intro: "We reserve the right to update this Cookie Policy. Significant changes will be communicated via in-app banner. The date of the last update is indicated at the top of this document."
  },
  s13: {
    title: "13. Contacts",
    intro: "For any questions about the Cookie Policy or to exercise your rights:"
  }
};

const Contact = () => {
  const [formData, setFormData] = reactExports.useState({
    name: "",
    email: "",
    phone: "",
    subject: "",
    message: ""
  });
  const [isSubmitting, setIsSubmitting] = reactExports.useState(false);
  const { toast } = useToast();
  const handleInputChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!formData.name || !formData.email || !formData.message) {
      toast({
        title: "Campi obbligatori",
        description: "Compila nome, email e messaggio per inviare la richiesta.",
        variant: "destructive"
      });
      return;
    }
    setIsSubmitting(true);
    try {
      const { error } = await supabase.from("contacts").insert([formData]);
      if (error) {
        throw error;
      }
      toast({
        title: " Messaggio inviato",
        description: "Ti contatteremo al pi presto. Grazie per averci scritto!"
      });
      setFormData({
        name: "",
        email: "",
        phone: "",
        subject: "",
        message: ""
      });
    } catch (error) {
      toast({
        title: " Errore invio",
        description: "Impossibile inviare il messaggio. Riprova pi tardi.",
        variant: "destructive"
      });
    } finally {
      setIsSubmitting(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-black via-gray-900 to-black p-4 pt-20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-12", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "text-4xl font-orbitron font-bold mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "Contatti" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: " M1SSION" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-lg", children: "Hai domande? Vuoi maggiori informazioni? Scrivici!" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid lg:grid-cols-2 gap-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Card,
        {
          className: "relative overflow-hidden rounded-[24px]",
          style: {
            background: "rgba(0, 0, 0, 0.05)",
            backdropFilter: "blur(40px)",
            WebkitBackdropFilter: "blur(40px)",
            border: "1px solid rgba(255, 255, 255, 0.1)",
            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-2xl font-orbitron text-white flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "w-6 h-6 mr-3 text-[#00D1FF]" }),
              "Informazioni di Contatto"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "w-5 h-5 text-[#00D1FF] mt-1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Email" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "info@m1ssion.app" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "support@m1ssion.app" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Phone, { className: "w-5 h-5 text-[#00D1FF] mt-1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Telefono" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "+39 XXX XXX XXXX" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-sm", children: "Lun-Ven 9:00-18:00" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-5 h-5 text-[#00D1FF] mt-1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Sede" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "NIYVORA KFT" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Ungheria, EU" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pt-6 border-t border-white/10", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium mb-3", children: "Team di Sviluppo" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
                  "M1SSION  sviluppato da ",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Joseph MUL" }),
                  ", CEO di NIYVORA KFT. Il team  dedicato a creare esperienze di gioco innovative e coinvolgenti."
                ] })
              ] })
            ] })
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Card,
        {
          className: "relative overflow-hidden rounded-[24px]",
          style: {
            background: "rgba(0, 0, 0, 0.05)",
            backdropFilter: "blur(40px)",
            WebkitBackdropFilter: "blur(40px)",
            border: "1px solid rgba(255, 255, 255, 0.1)",
            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-2xl font-orbitron text-white flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-6 h-6 mr-3 text-[#00D1FF]" }),
              "Invia un Messaggio"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "name", className: "text-white", children: "Nome *" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: "name",
                      name: "name",
                      value: formData.name,
                      onChange: handleInputChange,
                      placeholder: "Il tuo nome",
                      className: "bg-white/5 border-white/20 text-white placeholder:text-white/50",
                      required: true
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "email", className: "text-white", children: "Email *" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: "email",
                      name: "email",
                      type: "email",
                      value: formData.email,
                      onChange: handleInputChange,
                      placeholder: "tua@email.com",
                      className: "bg-white/5 border-white/20 text-white placeholder:text-white/50",
                      required: true
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "phone", className: "text-white", children: "Telefono" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: "phone",
                      name: "phone",
                      value: formData.phone,
                      onChange: handleInputChange,
                      placeholder: "+39 XXX XXX XXXX",
                      className: "bg-white/5 border-white/20 text-white placeholder:text-white/50"
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "subject", className: "text-white", children: "Oggetto" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: "subject",
                      name: "subject",
                      value: formData.subject,
                      onChange: handleInputChange,
                      placeholder: "Oggetto del messaggio",
                      className: "bg-white/5 border-white/20 text-white placeholder:text-white/50"
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "message", className: "text-white", children: "Messaggio *" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Textarea,
                  {
                    id: "message",
                    name: "message",
                    value: formData.message,
                    onChange: handleInputChange,
                    placeholder: "Scrivi qui il tuo messaggio...",
                    className: "bg-white/5 border-white/20 text-white placeholder:text-white/50 min-h-[120px]",
                    required: true
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  type: "submit",
                  disabled: isSubmitting,
                  className: "w-full bg-gradient-to-r from-[#00D1FF] to-[#0099CC] hover:from-[#0099CC] hover:to-[#007799] text-black font-medium",
                  children: isSubmitting ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-black/20 border-t-black rounded-full animate-spin mr-2" }),
                    "Invio in corso..."
                  ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-2" }),
                    "Invia Messaggio"
                  ] })
                }
              )
            ] }) })
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mt-12", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#00D1FF]/10 border border-[#00D1FF]/30 rounded-lg p-6 max-w-2xl mx-auto", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-[#00D1FF] font-medium mb-2", children: "Nota Privacy" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "I tuoi dati verranno trattati secondo la nostra Privacy Policy e utilizzati esclusivamente per rispondere alla tua richiesta. Non condividiamo mai i dati degli utenti con terze parti." })
    ] }) })
  ] }) });
};

function SafeCreative() {
  const { goBack } = useWouterNavigation();
  const [document, setDocument] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    loadLegalDocument();
  }, []);
  const loadLegalDocument = async () => {
    try {
      const { data, error } = await supabase.from("legal_documents").select("*").eq("type", "safecreative").eq("is_active", true).single();
      if (error) {
      }
      setDocument(data);
    } catch (err) {
    } finally {
      setLoading(false);
    }
  };
  const handleBack = () => {
    goBack();
  };
  const formatMarkdownContent = (content) => {
    return content.replace(/^### (.+)$/gm, '<h3 class="text-lg font-semibold text-[#00D1FF] mb-3 mt-6">$1</h3>').replace(/^## (.+)$/gm, '<h2 class="text-xl font-bold text-white mb-4 mt-8">$1</h2>').replace(/^# (.+)$/gm, '<h1 class="text-2xl font-bold text-white mb-6 mt-8">$1</h1>').replace(/^\* (.+)$/gm, '<li class="text-white/80 mb-1">$1</li>').replace(/^- (.+)$/gm, '<li class="text-white/80 mb-1">$1</li>').replace(/\n\n/g, '</p><p class="text-white/80 leading-relaxed mb-4">').replace(/^(.+)$/gm, '<p class="text-white/80 leading-relaxed mb-4">$1</p>').replace(/<li[^>]*>.*<\/li>/gs, (match) => `<ul class="list-disc list-inside space-y-1 ml-4 mb-4">${match}</ul>`).replace(/<\/ul><ul[^>]*>/g, "");
  };
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#0A0A0A] via-[#1A1A2E] to-[#16213E] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-[#00D1FF] mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "Caricamento documento SafeCreative..." })
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#0A0A0A] via-[#1A1A2E] to-[#16213E]", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto px-4 py-8", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-between mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "button",
      {
        onClick: handleBack,
        className: "flex items-center text-[#00D1FF] hover:text-white transition-colors",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5 mr-2" }),
          "Indietro"
        ]
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "relative overflow-hidden rounded-[24px] p-8",
        style: {
          background: "rgba(0, 0, 0, 0.05)",
          backdropFilter: "blur(40px)",
          WebkitBackdropFilter: "blur(40px)",
          border: "1px solid rgba(255, 255, 255, 0.1)",
          boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
          document ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold text-white mb-2 font-orbitron", children: document.title }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-white/60 mb-8 flex items-center gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                "Versione ",
                document.version
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                "Pubblicato: ",
                new Date(document.published_at).toLocaleDateString("it-IT")
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "prose prose-invert max-w-none",
                dangerouslySetInnerHTML: {
                  __html: formatMarkdownContent(document.content_md)
                }
              }
            )
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-12", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white mb-4", children: "Documento non trovato" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 mb-6", children: "Il documento SafeCreative non  attualmente disponibile." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "button",
              {
                onClick: handleBack,
                className: "inline-flex items-center px-6 py-3 bg-[#00D1FF]/20 text-[#00D1FF] \n                           rounded-lg hover:bg-[#00D1FF]/30 transition-colors",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-4 h-4 mr-2" }),
                  "Torna indietro"
                ]
              }
            )
          ] })
        ]
      }
    ) })
  ] }) });
}

const GameRulesComplete = () => {
  const [, setLocation] = useLocation();
  const [language, setLanguage] = reactExports.useState("it");
  const content = {
    it: {
      title: "Regolamento Ufficiale M1SSION",
      subtitle: "Versione 1.2  Dicembre 2025",
      lastUpdate: "Ultimo aggiornamento",
      sections: {
        art1: {
          title: "Art. 1  Oggetto del Gioco",
          content: [
            "M1SSION  un gioco di abilit e investigazione (skill-based game) che consiste nella ricerca di premi reali attraverso l'interpretazione di indizi, l'analisi di coordinate geografiche e l'interazione con meccaniche di gioco basate interamente sulla logica e sulla deduzione.",
            "Il gioco NON  basato sulla fortuna, sulla casualit o su meccanismi RNG (Random Number Generator). Ogni elemento del gioco richiede abilit cognitive, strategia e capacit investigative.",
            "M1SSION  gestito e operato da NIYVORA KFT, societ registrata in Ungheria."
          ]
        },
        antiGambling: {
          title: " CLAUSOLA ANTI-GAMBLING  Gioco di Pura Abilit",
          warning: "DICHIARAZIONE IMPORTANTE",
          content: [
            "M1SSION  un GIOCO DI PURA ABILIT (Skill-Based Game Only).",
            "NON  un gioco d'azzardo. NON utilizza meccanismi di casualit, lotterie, estrazioni a sorte, slot machine, ruote della fortuna o qualsiasi altro sistema basato sulla fortuna o sul caso.",
            "La vittoria dipende ESCLUSIVAMENTE dalle capacit cognitive del giocatore: interpretazione degli indizi, deduzione logica, analisi delle coordinate, velocit di risoluzione.",
            "Nessun elemento del gioco  determinato da RNG (Random Number Generator) o da sistemi casuali."
          ],
          prohibited: [
            "Scommesse o puntate in denaro reale",
            "Meccanismi di fortuna o casualit",
            "Ruote della fortuna o spin giornalieri con premi casuali",
            "Estrazioni a sorte o lotterie",
            "Qualsiasi forma di gambling o betting"
          ]
        },
        art2: {
          title: "Art. 2  Modalit di Partecipazione",
          content: [
            "Per partecipare a M1SSION  necessario:",
            " Avere almeno 18 anni di et",
            " Registrare un account valido con email verificata",
            " Accettare i presenti Termini, la Privacy Policy e il Regolamento",
            " Sottoscrivere un abbonamento (gratuito o premium)",
            " consentito UN SOLO account per persona fisica. Account multipli, condivisi o ceduti comportano squalifica immediata e permanente."
          ],
          subscriptions: {
            title: "Tipologie di Abbonamento:",
            free: {
              name: "FREE",
              features: [
                "Accesso base al gioco",
                "Numero limitato di indizi giornalieri",
                "1 BUZZ al giorno",
                "Funzionalit base"
              ]
            },
            premium: {
              name: "PREMIUM (Silver, Gold, Black, Titanium)",
              features: [
                "Maggior numero di indizi giornalieri e settimanali",
                "BUZZ multipli (in base al piano)",
                "Accesso a indizi esclusivi",
                "Funzionalit avanzate e priorit"
              ]
            }
          }
        },
        art3: {
          title: "Art. 3  Tipologie di Premi e Trasparenza",
          content: [
            "M1SSION mette in palio PREMI REALI di alto valore, tra cui:",
            " Automobili di lusso (es. Lamborghini, Ferrari, Porsche)",
            " Orologi di prestigio (es. Rolex, Patek Philippe)",
            " Borse firmate (es. Herms Birkin)",
            " Dispositivi tecnologici premium",
            " Altri premi di valore",
            "",
            "Ogni missione prevede un sistema di 99 PREMI SECONDARI e 1 PREMIO PRINCIPALE.",
            "I premi secondari vengono assegnati ai giocatori che raggiungono determinati traguardi durante la missione.",
            "Il premio principale viene assegnato al PRIMO giocatore che risolve correttamente la missione."
          ],
          transparency: [
            "Tutti i premi sono reali e verificabili",
            "Le immagini dei premi sono a scopo illustrativo",
            "I premi sono soggetti a disponibilit e possono variare",
            "La consegna dei premi  subordinata alla verifica dell'identit del vincitore"
          ]
        },
        art4: {
          title: "Art. 4  Indizi, BUZZ e Meccaniche di Gioco",
          buzz: {
            title: "Sistema BUZZ",
            content: [
              "Il BUZZ  la meccanica principale di M1SSION per restringere l'area di ricerca.",
              "Ogni BUZZ effettuato riduce il raggio di ricerca basandosi sulle coordinate inviate dal giocatore.",
              "Il BUZZ NON influenza la vittoria finale  serve solo a guidare la ricerca.",
              "Il numero di BUZZ disponibili dipende dal tipo di abbonamento."
            ]
          },
          buzzMap: {
            title: "BUZZ MAPPA",
            content: [
              "La funzione BUZZ MAPPA permette di visualizzare sulla mappa 3D le aree di ricerca.",
              "Mostra in tempo reale il raggio di ricerca attuale.",
              "NON rivela la posizione esatta del premio.",
              " uno strumento di supporto alla strategia del giocatore."
            ]
          },
          clues: {
            title: "Sistema Indizi",
            content: [
              "Gli indizi vengono rilasciati giornalmente e settimanalmente.",
              "FREE: numero limitato di indizi base",
              "PREMIUM: accesso a pi indizi, inclusi indizi esclusivi",
              "Gli indizi richiedono interpretazione e deduzione  non forniscono la soluzione diretta.",
              " VIETATO condividere, vendere o divulgare gli indizi ad altri partecipanti."
            ]
          }
        },
        art5: {
          title: "Art. 5  Modalit di Assegnazione Premi",
          content: [
            "Il PREMIO PRINCIPALE viene assegnato al PRIMO giocatore che:",
            " Individua le coordinate esatte del premio",
            " Invia la soluzione corretta tramite il sistema BUZZ",
            " Viene validato dal sistema automatico",
            "",
            "In caso di EX AEQUO (pi giocatori inviano la soluzione corretta nello stesso istante):",
            " Vince chi ha inviato per PRIMO (timestamp del server)",
            " In caso di parit assoluta, il premio viene diviso equamente",
            "",
            "I PREMI SECONDARI (99 premi) vengono assegnati secondo criteri di merito:",
            " Progressione nella missione",
            " Traguardi raggiunti",
            " Partecipazione attiva"
          ],
          verification: {
            title: "Verifica Vincitore",
            steps: [
              "Validazione automatica della soluzione",
              "Verifica dell'identit del vincitore (documento d'identit)",
              "Controllo anti-frode e anti-bot",
              "Verifica unicit account",
              "Conferma dati di spedizione"
            ]
          }
        },
        art6: {
          title: "Art. 6  Comportamenti Vietati e Responsabilit Utente",
          prohibited: [
            "Utilizzo di bot, script automatici o software di automazione",
            "Creazione di account multipli o account fake",
            "Condivisione, vendita o divulgazione di indizi ad altri partecipanti",
            "Collaborazione illecita tra pi giocatori",
            "Tentativi di hacking, manipolazione o alterazione del gioco",
            "Utilizzo di VPN o sistemi per mascherare la propria identit/posizione",
            "Qualsiasi forma di cheating o comportamento fraudolento"
          ],
          consequences: [
            "Squalifica immediata e permanente",
            "Annullamento di eventuali premi vinti",
            "Ban dell'account senza rimborso",
            "Possibili azioni legali in caso di danni"
          ]
        },
        art7: {
          title: "Art. 7  Privacy, Consensi e GDPR",
          content: [
            "La raccolta e il trattamento dei dati personali avviene in conformit al GDPR (Regolamento UE 2016/679) e alla normativa ungherese sulla protezione dei dati.",
            "Per i dettagli completi, consultare la Privacy Policy disponibile nell'app.",
            "I dati di geolocalizzazione sono utilizzati ESCLUSIVAMENTE per le meccaniche di gioco e non vengono condivisi con terze parti per fini commerciali.",
            "L'utente pu esercitare i propri diritti (accesso, rettifica, cancellazione, portabilit) contattando: contact@m1ssion.com"
          ]
        },
        art8: {
          title: "Art. 8  Recesso e Cancellazione Account",
          content: [
            "L'utente pu cancellare il proprio account in qualsiasi momento dalle Impostazioni dell'app.",
            "La cancellazione comporta la perdita di tutti i progressi, indizi e dati associati.",
            "Gli abbonamenti premium possono essere disdetti secondo le policy dell'App Store/Play Store.",
            "Non sono previsti rimborsi per abbonamenti gi attivati, salvo quanto previsto dalla legge."
          ]
        },
        art9: {
          title: "Art. 9  Propriet Intellettuale",
          content: [
            "M1SSION, il logo, il brand, i contenuti, le grafiche, il codice e tutti gli elementi dell'applicazione sono di propriet esclusiva di NIYVORA KFT.",
            " vietata qualsiasi riproduzione, distribuzione, modifica o utilizzo non autorizzato.",
            "I marchi citati (Lamborghini, Ferrari, Rolex, Herms, etc.) appartengono ai rispettivi proprietari e sono usati a scopo illustrativo."
          ]
        },
        art10: {
          title: "Art. 10  Limitazioni di Responsabilit",
          content: [
            "NIYVORA KFT non  responsabile per:",
            " Malfunzionamenti tecnici, interruzioni del servizio o problemi di connettivit",
            " Perdita di dati dovuta a cause esterne",
            " Danni derivanti dall'uso improprio dell'applicazione",
            " Comportamenti illegali o pericolosi degli utenti durante l'utilizzo di funzioni basate sulla geolocalizzazione",
            "",
            "L'utente  l'unico responsabile della propria sicurezza fisica durante l'utilizzo dell'app."
          ]
        },
        art11: {
          title: "Art. 11  Giurisdizione e Foro Competente",
          content: [
            "Il presente Regolamento  regolato dalla legge ungherese.",
            "Per qualsiasi controversia, il Foro competente  quello di Budapest, Ungheria.",
            "NIYVORA KFT si riserva il diritto di modificare il presente Regolamento in qualsiasi momento, con effetto immediato dalla pubblicazione nell'app."
          ]
        }
      },
      footer: {
        company: "NIYVORA KFT",
        location: "Budapest, Ungheria",
        email: "contact@m1ssion.com",
        version: "Versione 1.2",
        copyright: " 2025 M1SSION  Tutti i diritti riservati"
      }
    },
    en: {
      title: "M1SSION Official Game Regulation",
      subtitle: "Version 1.2  December 2025",
      lastUpdate: "Last updated",
      sections: {
        art1: {
          title: "Art. 1  Purpose of the Game",
          content: [
            "M1SSION is a skill-based investigation game that consists of searching for real prizes through the interpretation of clues, analysis of geographic coordinates, and interaction with game mechanics based entirely on logic and deduction.",
            "The game is NOT based on luck, chance, or RNG (Random Number Generator) mechanisms. Every element of the game requires cognitive skills, strategy, and investigative abilities.",
            "M1SSION is managed and operated by NIYVORA KFT, a company registered in Hungary."
          ]
        },
        antiGambling: {
          title: " ANTI-GAMBLING CLAUSE  Pure Skill-Based Game",
          warning: "IMPORTANT STATEMENT",
          content: [
            "M1SSION is a PURE SKILL-BASED GAME (Skill-Based Game Only).",
            "It is NOT gambling. It does NOT use chance mechanisms, lotteries, random draws, slot machines, wheels of fortune, or any other system based on luck or chance.",
            "Victory depends EXCLUSIVELY on the player's cognitive abilities: interpretation of clues, logical deduction, coordinate analysis, resolution speed.",
            "No element of the game is determined by RNG (Random Number Generator) or random systems."
          ],
          prohibited: [
            "Real money bets or wagers",
            "Luck or chance mechanisms",
            "Wheels of fortune or daily spins with random prizes",
            "Random draws or lotteries",
            "Any form of gambling or betting"
          ]
        },
        art2: {
          title: "Art. 2  Participation Requirements",
          content: [
            "To participate in M1SSION, you must:",
            " Be at least 18 years old",
            " Register a valid account with verified email",
            " Accept these Terms, Privacy Policy, and Regulation",
            " Subscribe to a plan (free or premium)",
            "Only ONE account per natural person is allowed. Multiple, shared, or transferred accounts result in immediate and permanent disqualification."
          ],
          subscriptions: {
            title: "Subscription Types:",
            free: {
              name: "FREE",
              features: [
                "Basic game access",
                "Limited daily clues",
                "1 BUZZ per day",
                "Basic features"
              ]
            },
            premium: {
              name: "PREMIUM (Silver, Gold, Black, Titanium)",
              features: [
                "More daily and weekly clues",
                "Multiple BUZZes (depending on plan)",
                "Access to exclusive clues",
                "Advanced features and priority"
              ]
            }
          }
        },
        art3: {
          title: "Art. 3  Prize Types and Transparency",
          content: [
            "M1SSION offers REAL high-value PRIZES, including:",
            " Luxury cars (e.g., Lamborghini, Ferrari, Porsche)",
            " Prestigious watches (e.g., Rolex, Patek Philippe)",
            " Designer bags (e.g., Herms Birkin)",
            " Premium tech devices",
            " Other valuable prizes",
            "",
            "Each mission features a system of 99 SECONDARY PRIZES and 1 MAIN PRIZE.",
            "Secondary prizes are awarded to players who reach certain milestones during the mission.",
            "The main prize is awarded to the FIRST player who correctly solves the mission."
          ],
          transparency: [
            "All prizes are real and verifiable",
            "Prize images are for illustrative purposes",
            "Prizes are subject to availability and may vary",
            "Prize delivery is subject to winner identity verification"
          ]
        },
        art4: {
          title: "Art. 4  Clues, BUZZ and Game Mechanics",
          buzz: {
            title: "BUZZ System",
            content: [
              "BUZZ is M1SSION's main mechanic to narrow down the search area.",
              "Each BUZZ reduces the search radius based on coordinates sent by the player.",
              "BUZZ does NOT influence the final victory  it only guides the search.",
              "The number of available BUZZes depends on the subscription type."
            ]
          },
          buzzMap: {
            title: "BUZZ MAP",
            content: [
              "The BUZZ MAP feature allows viewing search areas on the 3D map.",
              "Shows the current search radius in real time.",
              "Does NOT reveal the exact prize location.",
              "It's a support tool for the player's strategy."
            ]
          },
          clues: {
            title: "Clue System",
            content: [
              "Clues are released daily and weekly.",
              "FREE: limited number of basic clues",
              "PREMIUM: access to more clues, including exclusive ones",
              "Clues require interpretation and deduction  they don't provide the direct solution.",
              "It is FORBIDDEN to share, sell, or disclose clues to other participants."
            ]
          }
        },
        art5: {
          title: "Art. 5  Prize Award Methods",
          content: [
            "The MAIN PRIZE is awarded to the FIRST player who:",
            " Identifies the exact prize coordinates",
            " Sends the correct solution through the BUZZ system",
            " Is validated by the automatic system",
            "",
            "In case of TIE (multiple players send the correct solution at the same time):",
            " The one who sent FIRST wins (server timestamp)",
            " In case of absolute tie, the prize is divided equally",
            "",
            "SECONDARY PRIZES (99 prizes) are awarded based on merit criteria:",
            " Mission progression",
            " Milestones reached",
            " Active participation"
          ],
          verification: {
            title: "Winner Verification",
            steps: [
              "Automatic solution validation",
              "Winner identity verification (ID document)",
              "Anti-fraud and anti-bot check",
              "Account uniqueness verification",
              "Shipping data confirmation"
            ]
          }
        },
        art6: {
          title: "Art. 6  Prohibited Behaviors and User Responsibility",
          prohibited: [
            "Use of bots, automated scripts, or automation software",
            "Creation of multiple accounts or fake accounts",
            "Sharing, selling, or disclosing clues to other participants",
            "Illicit collaboration between multiple players",
            "Hacking attempts, manipulation, or game alteration",
            "Use of VPN or systems to mask identity/location",
            "Any form of cheating or fraudulent behavior"
          ],
          consequences: [
            "Immediate and permanent disqualification",
            "Cancellation of any prizes won",
            "Account ban without refund",
            "Possible legal action in case of damages"
          ]
        },
        art7: {
          title: "Art. 7  Privacy, Consent and GDPR",
          content: [
            "The collection and processing of personal data is carried out in compliance with GDPR (EU Regulation 2016/679) and Hungarian data protection legislation.",
            "For complete details, see the Privacy Policy available in the app.",
            "Geolocation data is used EXCLUSIVELY for game mechanics and is not shared with third parties for commercial purposes.",
            "Users can exercise their rights (access, rectification, deletion, portability) by contacting: contact@m1ssion.com"
          ]
        },
        art8: {
          title: "Art. 8  Withdrawal and Account Deletion",
          content: [
            "Users can delete their account at any time from the app Settings.",
            "Deletion results in the loss of all progress, clues, and associated data.",
            "Premium subscriptions can be canceled according to App Store/Play Store policies.",
            "No refunds are provided for already activated subscriptions, except as required by law."
          ]
        },
        art9: {
          title: "Art. 9  Intellectual Property",
          content: [
            "M1SSION, the logo, brand, content, graphics, code, and all application elements are the exclusive property of NIYVORA KFT.",
            "Any unauthorized reproduction, distribution, modification, or use is prohibited.",
            "Referenced trademarks (Lamborghini, Ferrari, Rolex, Herms, etc.) belong to their respective owners and are used for illustrative purposes."
          ]
        },
        art10: {
          title: "Art. 10  Limitation of Liability",
          content: [
            "NIYVORA KFT is not responsible for:",
            " Technical malfunctions, service interruptions, or connectivity issues",
            " Data loss due to external causes",
            " Damages resulting from improper use of the application",
            " Illegal or dangerous user behavior while using geolocation-based features",
            "",
            "The user is solely responsible for their physical safety while using the app."
          ]
        },
        art11: {
          title: "Art. 11  Jurisdiction and Competent Court",
          content: [
            "This Regulation is governed by Hungarian law.",
            "For any dispute, the competent court is that of Budapest, Hungary.",
            "NIYVORA KFT reserves the right to modify this Regulation at any time, effective immediately upon publication in the app."
          ]
        }
      },
      footer: {
        company: "NIYVORA KFT",
        location: "Budapest, Hungary",
        email: "contact@m1ssion.com",
        version: "Version 1.2",
        copyright: " 2025 M1SSION  All Rights Reserved"
      }
    }
  };
  const t = content[language];
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#131524] via-[#0F1419] to-black text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "container mx-auto px-4 py-8 max-w-4xl", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      className: "space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between flex-wrap gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => window.history.back(),
                variant: "ghost",
                size: "icon",
                className: "rounded-full hover:bg-white/10",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: t.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: t.subtitle })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 bg-black/30 rounded-full p-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => setLanguage("it"),
                variant: language === "it" ? "default" : "ghost",
                size: "sm",
                className: `rounded-full ${language === "it" ? "bg-[#00D1FF] text-black" : "text-white/70 hover:text-white"}`,
                children: " IT"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => setLanguage("en"),
                variant: language === "en" ? "default" : "ghost",
                size: "sm",
                className: `rounded-full ${language === "en" ? "bg-[#00D1FF] text-black" : "text-white/70 hover:text-white"}`,
                children: " EN"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.sections.art1.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: t.sections.art1.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: text }, i)) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-red-500/30 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Ban, { className: "w-5 h-5 mr-2 text-red-400" }),
            t.sections.antiGambling.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-red-300 font-semibold mb-2", children: [
                " ",
                t.sections.antiGambling.warning
              ] }),
              t.sections.antiGambling.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 mb-2", children: text }, i))
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-red-300", children: language === "it" ? "M1SSION NON include:" : "M1SSION does NOT include:" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: t.sections.antiGambling.prohibited.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                " ",
                item
              ] }, i)) })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.sections.art2.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            t.sections.art2.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: text }, i)),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-[#00D1FF] font-semibold mb-3", children: t.sections.art2.subscriptions.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-white/10", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "text-white font-semibold mb-2", children: t.sections.art2.subscriptions.free.name }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-1 text-white/70 text-sm", children: t.sections.art2.subscriptions.free.features.map((f, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                    " ",
                    f
                  ] }, i)) })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-[#00D1FF]/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "text-[#00D1FF] font-semibold mb-2", children: t.sections.art2.subscriptions.premium.name }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-1 text-white/70 text-sm", children: t.sections.art2.subscriptions.premium.features.map((f, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                    " ",
                    f
                  ] }, i)) })
                ] })
              ] })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-yellow-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-5 h-5 mr-2 text-yellow-400" }),
            t.sections.art3.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            t.sections.art3.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: text }, i)),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-yellow-900/20 p-4 rounded-lg border border-yellow-500/30 mt-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-300 font-semibold mb-2", children: language === "it" ? "Trasparenza Premi:" : "Prize Transparency:" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-1 text-white/80 text-sm", children: t.sections.art3.transparency.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                " ",
                item
              ] }, i)) })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-purple-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-5 h-5 mr-2 text-purple-400" }),
            t.sections.art4.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-purple-900/20 p-4 rounded-lg border border-purple-500/20", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "text-purple-300 font-semibold mb-2 flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Compass, { className: "w-4 h-4 mr-2" }),
                t.sections.art4.buzz.title
              ] }),
              t.sections.art4.buzz.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 mb-1", children: text }, i))
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#00D1FF]/10 p-4 rounded-lg border border-[#00D1FF]/20", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "text-[#00D1FF] font-semibold mb-2 flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-4 h-4 mr-2" }),
                t.sections.art4.buzzMap.title
              ] }),
              t.sections.art4.buzzMap.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 mb-1", children: text }, i))
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-white/10", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "text-white font-semibold mb-2 flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-4 h-4 mr-2" }),
                t.sections.art4.clues.title
              ] }),
              t.sections.art4.clues.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 mb-1", children: text }, i))
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-green-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-5 h-5 mr-2 text-green-400" }),
            t.sections.art5.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            t.sections.art5.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: text }, i)),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-green-900/20 p-4 rounded-lg border border-green-500/20 mt-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "text-green-300 font-semibold mb-2 flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 mr-2" }),
                t.sections.art5.verification.title
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ol", { className: "space-y-1 text-white/80 text-sm list-decimal list-inside", children: t.sections.art5.verification.steps.map((step, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: step }, i)) })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-red-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(UserX, { className: "w-5 h-5 mr-2 text-red-400" }),
            t.sections.art6.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold mb-2", children: language === "it" ? "Comportamenti VIETATI:" : "PROHIBITED Behaviors:" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-1 text-white/80", children: t.sections.art6.prohibited.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                " ",
                item
              ] }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/20 mt-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300 font-semibold mb-2", children: language === "it" ? "Conseguenze:" : "Consequences:" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-1 text-white/80 text-sm", children: t.sections.art6.consequences.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                " ",
                item
              ] }, i)) })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.sections.art7.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: t.sections.art7.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: text }, i)) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.sections.art8.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: t.sections.art8.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: text }, i)) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.sections.art9.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: t.sections.art9.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: text }, i)) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-orange-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 mr-2 text-orange-400" }),
            t.sections.art10.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: t.sections.art10.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: text }, i)) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Scale, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.sections.art11.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: t.sections.art11.content.map((text, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: text }, i)) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pt-6 border-t border-white/10 text-center text-white/60", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center space-x-2 mb-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Globe, { className: "w-4 h-4" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: t.footer.company }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: t.footer.location })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center space-x-2 mb-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "w-4 h-4" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("a", { href: "mailto:contact@m1ssion.com", className: "text-[#00D1FF] hover:underline", children: t.footer.email })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: t.footer.version }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: t.footer.copyright }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs mt-2 text-white/40", children: [
            t.lastUpdate,
            ": ",
            (/* @__PURE__ */ new Date()).toLocaleDateString(language === "it" ? "it-IT" : "en-US", {
              year: "numeric",
              month: "long",
              day: "numeric"
            })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap justify-center gap-4 pt-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: () => setLocation("/privacy-policy"),
              variant: "ghost",
              size: "sm",
              className: "text-[#00D1FF] hover:bg-[#00D1FF]/10",
              children: "Privacy Policy"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: () => setLocation("/terms"),
              variant: "ghost",
              size: "sm",
              className: "text-[#00D1FF] hover:bg-[#00D1FF]/10",
              children: language === "it" ? "Termini di Servizio" : "Terms of Service"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: () => setLocation("/cookie-policy"),
              variant: "ghost",
              size: "sm",
              className: "text-[#00D1FF] hover:bg-[#00D1FF]/10",
              children: "Cookie Policy"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: () => setLocation("/policies"),
              variant: "ghost",
              size: "sm",
              className: "text-[#00D1FF] hover:bg-[#00D1FF]/10",
              children: "Policies"
            }
          )
        ] })
      ]
    }
  ) }) });
};

const Policies = () => {
  const [language, setLanguage] = reactExports.useState("it");
  const content = {
    it: {
      header: {
        title: "Policy & Disclaimer",
        subtitle: "Informazioni Legali M1SSION"
      },
      antiGambling: {
        warning: "AVVISO IMPORTANTE",
        text: "M1SSION NON  un'applicazione di gioco d'azzardo. Questa piattaforma non offre, facilita o promuove alcuna forma di gioco d'azzardo, scommesse, puntate o giochi basati sulla fortuna che coinvolgono denaro reale.",
        listTitle: "Questa applicazione NON:",
        list: [
          "Accetta scommesse o puntate in denaro reale",
          "Offre premi in denaro o ricompense monetarie basate sulla fortuna",
          "Fornisce servizi di casin, scommesse sportive o lotterie",
          "Permette la conversione di valute virtuali in denaro reale",
          "Consente prelievi o incassi di alcun tipo",
          "Simula o incoraggia comportamenti di gioco d'azzardo"
        ],
        note: `Tutti i mini-giochi all'interno di M1SSION (incluso "Pulse Breaker") sono esclusivamente a scopo di intrattenimento e utilizzano solo valute virtuali non riscattabili, senza alcun valore nel mondo reale.`
      },
      nature: {
        intro: "M1SSION  un'applicazione di intrattenimento interattivo progettata come un'esperienza immersiva di simulazione investigativa e caccia al tesoro.",
        classTitle: "Classificazione del Gioco:",
        classList: [
          { title: "Gioco di Simulazione:", desc: "Interpretazione del ruolo di agente di intelligence" },
          { title: "Gioco di Puzzle/Mistero:", desc: "Risoluzione di indizi e investigazione di luoghi" },
          { title: "Gioco Basato sulla Posizione:", desc: "Utilizzo della geolocalizzazione per gameplay interattivo" },
          { title: "Esperienza di Intrattenimento:", desc: "Puramente per divertimento e coinvolgimento" }
        ],
        note: "M1SSION  progettato per fornire un'esperienza narrativa coinvolgente. Tutte le meccaniche di gioco, i risultati e le ricompense fanno parte della simulazione di intrattenimento e non hanno implicazioni economiche nel mondo reale."
      },
      currencies: {
        intro: "M1SSION utilizza due tipi di valute virtuali in-app:",
        m1u: "Token virtuali utilizzati all'interno dell'ecosistema M1SSION per attivit in-app, ricompense e funzionalit di coinvolgimento.",
        pe: "Punti energia virtuali utilizzati per meccaniche di gioco specifiche e funzionalit di partecipazione alla community.",
        warning: "DISCLAIMER CRITICO",
        warningList: [
          "M1U e PE NON hanno valore monetario nel mondo reale.",
          "Gli M1U possono essere acquistati con denaro reale tramite acquisti in-app, ma rimangono puramente virtuali e non possono essere riscattati per denaro o equivalenti in contanti.",
          "I PE (Pulse Energy) si guadagnano attraverso il gameplay e la partecipazione alla community e non possono essere acquistati direttamente con denaro reale.",
          "N gli M1U n i PE possono essere venduti, scambiati o convertiti in valuta reale o equivalenti in contanti.",
          "Non possono essere prelevati o trasferiti fuori dall'app.",
          "Tutti gli acquisti di M1U e gli abbonamenti sono non rimborsabili, salvo dove la legge a tutela dei consumatori lo richieda.",
          "Queste valute virtuali esistono solo all'interno dell'applicazione M1SSION."
        ]
      },
      subscriptions: {
        title: "Indizi e Abbonamenti",
        intro: "M1SSION offre diversi livelli di abbonamento che determinano l'accesso agli indizi e alle funzionalit di gioco.",
        free: {
          title: "FREE (Gratuito)",
          list: ["Accesso base al gioco", "Numero limitato di indizi giornalieri", "1 BUZZ al giorno", "Funzionalit base"]
        },
        premium: {
          title: "PREMIUM (Silver, Gold, Black, Titanium)",
          list: ["Maggior numero di indizi giornalieri e settimanali", "BUZZ multipli (in base al piano)", "Accesso a indizi esclusivi", "Funzionalit avanzate e priorit", "Contenuti narrativi premium"]
        },
        note: "Nota: Gli abbonamenti premium forniscono accesso a funzionalit aggiuntive e sono completamente separati dal sistema di premi del gioco. L'abbonamento NON garantisce la vittoria  il successo dipende esclusivamente dalle abilit del giocatore."
      },
      noTransactions: {
        title: "Nessuna Transazione in Denaro Reale per Gioco d'Azzardo",
        intro: "M1SSION NON elabora, gestisce o facilita alcuna transazione in denaro reale relativa a risultati di gioco, gioco d'azzardo, scommesse o incasso di vincite. I pagamenti in denaro reale sono utilizzati esclusivamente per abbonamenti opzionali e acquisti in-app (come pacchetti M1U e accesso a funzionalit premium). Questi pagamenti sono strettamente per l'accesso a contenuti e servizi e sono completamente separati dall'assegnazione dei premi o dai risultati di gioco.",
        listTitle: "Cosa Significa:",
        list: [
          "Nessun deposito o pagamento in denaro reale per scommesse, puntate o giochi d'azzardo.",
          "Nessun prelievo, incasso o pagamento di vincite monetarie.",
          "Nessun riscatto di valute virtuali per denaro, carte regalo, criptovalute o altri equivalenti monetari.",
          "Nessuna elaborazione di pagamenti di terze parti per servizi di gioco d'azzardo o scommesse.",
          "Tutti gli acquisti sono definitivi e non rimborsabili, salvo dove la legge a tutela dei consumatori lo richieda."
        ],
        note: "Gli abbonamenti premium e gli acquisti in-app di M1U sono per l'accesso a funzionalit e contenuti, completamente separati dal sistema di premi del gioco."
      },
      liability: {
        title: "Limitazione di Responsabilit",
        intro: "Utilizzando M1SSION, l'utente riconosce e accetta che:",
        list: [
          "NIYVORA KFT e M1SSION non sono responsabili per alcun danno diretto, indiretto, incidentale o consequenziale derivante dall'utilizzo dell'applicazione.",
          `L'applicazione  fornita "cos com'" senza garanzie di alcun tipo, espresse o implicite.`,
          "Gli utenti sono gli unici responsabili della propria sicurezza e delle proprie azioni durante l'utilizzo delle funzionalit basate sulla posizione.",
          "Non garantiamo l'accesso ininterrotto, l'accuratezza dei contenuti o la conservazione dei dati degli utenti oltre i nostri ragionevoli sforzi.",
          "Qualsiasi servizio di terze parti integrato nell'app  soggetto ai propri termini e condizioni."
        ]
      },
      risks: {
        title: "Rischi Digitali & Sicurezza",
        intro: "Gli utenti riconoscono i seguenti rischi digitali:",
        list: [
          "Problemi di connettivit Internet possono influire sull'esperienza di gioco",
          "La precisione del GPS pu variare in base al dispositivo e alla posizione",
          "Il consumo della batteria pu essere maggiore quando si utilizzano i servizi di localizzazione",
          "Il consumo di dati pu verificarsi durante l'utilizzo dell'applicazione",
          "Il tempo di utilizzo dello schermo dovrebbe essere monitorato, specialmente per gli utenti pi giovani"
        ],
        safety: "Sicurezza Fisica: Quando si utilizzano funzionalit basate sulla posizione, prestare sempre attenzione all'ambiente circostante. Non entrare in propriet private. Non utilizzare l'app mentre si guida o in condizioni non sicure."
      },
      ai: {
        intro: "M1SSION incorpora funzionalit basate sull'intelligenza artificiale, incluso l'assistente AION e vari sistemi di generazione di contenuti.",
        listTitle: "Informativa sull'IA:",
        list: [
          "Alcuni contenuti, indizi e narrazioni possono essere generati o migliorati dall'IA",
          "Le risposte dell'IA sono per intrattenimento e non devono essere considerate consigli fattuali",
          "I contenuti generati dall'IA possono occasionalmente contenere imprecisioni o incoerenze",
          "Miglioriamo continuamente i sistemi di IA ma non possiamo garantire la perfezione"
        ],
        note: "AION e le altre funzionalit IA sono progettate per migliorare l'esperienza di gioco e devono essere intese come parte della simulazione di intrattenimento."
      },
      modifications: {
        title: "Modifiche alle Policy",
        intro: "NIYVORA KFT si riserva il diritto di modificare, aggiornare o cambiare queste policy in qualsiasi momento senza preavviso.",
        list: [
          "Le modifiche saranno effettive immediatamente dopo la pubblicazione nell'applicazione",
          "L'uso continuato dell'app costituisce accettazione delle policy aggiornate",
          "Le modifiche importanti possono essere comunicate tramite notifiche in-app",
          "Gli utenti sono incoraggiati a rivedere periodicamente le policy"
        ]
      },
      cookies: {
        title: "Cookie & Sicurezza dei Dati",
        intro: "M1SSION utilizza cookie e tecnologie simili per migliorare l'esperienza utente. Per informazioni dettagliate, consultare la nostra",
        linkText: "Cookie Policy",
        listTitle: "Misure di Sicurezza:",
        list: [
          "Crittografia end-to-end per i dati sensibili",
          "Protocolli di autenticazione sicuri",
          "Audit di sicurezza e aggiornamenti regolari",
          "Conformit GDPR e CCPA"
        ]
      },
      compliance: {
        title: "Conformit Normativa",
        intro: "M1SSION  progettato per conformarsi alle normative applicabili nelle giurisdizioni in cui opera:",
        eu: { title: "Unione Europea", list: ["GDPR (Protezione dei Dati)", "Digital Services Act (DSA)", "Direttive sulla Protezione dei Consumatori"] },
        us: { title: "Stati Uniti", list: ["CCPA (Privacy California)", "COPPA (Privacy dei Minori)", "Linee Guida FTC"] },
        appStore: { title: "Conformit App Store", list: ["Linee Guida Apple App Store (Categoria Gioco d'Azzardo Simulato)", "Policy Google Play Store"] }
      },
      footer: {
        copyright: " 2025 M1SSION  Tutti i Diritti Riservati",
        company: "NIYVORA KFT  Budapest, Ungheria",
        lastUpdate: "Ultimo Aggiornamento"
      }
    },
    en: {
      header: {
        title: "Policy & Disclaimer",
        subtitle: "M1SSION Legal Information"
      },
      antiGambling: {
        warning: "IMPORTANT NOTICE",
        text: "M1SSION is NOT a gambling application. This platform does not offer, facilitate, or promote any form of gambling, betting, wagering, or games of chance involving real money.",
        listTitle: "This application does NOT:",
        list: [
          "Accept real money bets or wagers",
          "Offer cash prizes or monetary rewards based on chance",
          "Provide any form of casino, sports betting, or lottery services",
          "Allow conversion of virtual currencies to real money",
          "Enable withdrawals or cash-outs of any kind",
          "Simulate or encourage gambling behavior"
        ],
        note: 'Any mini-games within M1SSION (including "Pulse Breaker") are purely for entertainment purposes and use only virtual, non-redeemable currencies with no real-world value.'
      },
      nature: {
        intro: "M1SSION is an interactive entertainment application designed as an immersive investigative simulation and treasure hunt experience.",
        classTitle: "Game Classification:",
        classList: [
          { title: "Simulation Game:", desc: "Role-playing as an intelligence agent" },
          { title: "Puzzle/Mystery Game:", desc: "Solving clues and investigating locations" },
          { title: "Location-Based Game:", desc: "Using geolocation for interactive gameplay" },
          { title: "Entertainment Experience:", desc: "Purely for fun and engagement" }
        ],
        note: "M1SSION is designed to provide an engaging narrative experience. All game mechanics, outcomes, and rewards are part of the entertainment simulation and have no real-world economic implications."
      },
      currencies: {
        intro: "M1SSION uses two types of virtual, in-app currencies:",
        m1u: "Virtual tokens used within the M1SSION ecosystem for in-app activities, rewards, and engagement features.",
        pe: "Virtual energy points used for specific game mechanics and community participation features.",
        warning: "CRITICAL DISCLAIMER",
        warningList: [
          "M1U and PE have NO real-world monetary value.",
          "M1U may be purchased with real money through in-app purchases, but they remain purely virtual and cannot be redeemed for cash or cash equivalents.",
          "PE (Pulse Energy) is earned through gameplay and community engagement and cannot be purchased directly with real money.",
          "Neither M1U nor PE can be sold, exchanged, or converted to real currency or any cash equivalent.",
          "They cannot be withdrawn or transferred outside the app.",
          "All purchases of M1U and any subscriptions are non-refundable except where mandatory consumer law requires otherwise.",
          "These virtual currencies exist only within the M1SSION application."
        ]
      },
      subscriptions: {
        title: "Clues and Subscriptions",
        intro: "M1SSION offers different subscription levels that determine access to clues and game features.",
        free: {
          title: "FREE",
          list: ["Basic game access", "Limited daily clues", "1 BUZZ per day", "Basic features"]
        },
        premium: {
          title: "PREMIUM (Silver, Gold, Black, Titanium)",
          list: ["More daily and weekly clues", "Multiple BUZZes (depending on plan)", "Access to exclusive clues", "Advanced features and priority", "Premium narrative content"]
        },
        note: "Note: Premium subscriptions provide access to additional features and are completely separate from the game's prize system. A subscription does NOT guarantee victory  success depends exclusively on the player's skills."
      },
      noTransactions: {
        title: "No Real-Money Transactions for Gambling",
        intro: "M1SSION does NOT process, handle, or facilitate any real-money transactions related to in-game outcomes, gambling, betting, or cash-out of winnings. Real-money payments are used only for optional subscriptions and in-app purchases (such as M1U packs and access to premium features). These payments are strictly for access to content and services and are entirely separate from prize assignment or game results.",
        listTitle: "What This Means:",
        list: [
          "No deposits or real-money payments for betting, wagering, or games of chance.",
          "No withdrawals, cash-outs, or payment of monetary winnings.",
          "No redemption of virtual currencies for cash, gift cards, cryptocurrency, or other real-world monetary equivalents.",
          "No third-party payment processing for gambling or betting services.",
          "All purchases are final and non-refundable, except where applicable consumer protection laws require otherwise."
        ],
        note: "Premium subscriptions and M1U in-app purchases are for access to features and content, completely separate from the game's prize system."
      },
      liability: {
        title: "Limitation of Liability",
        intro: "By using M1SSION, you acknowledge and agree that:",
        list: [
          "NIYVORA KFT and M1SSION are not liable for any direct, indirect, incidental, or consequential damages arising from your use of the application.",
          'The application is provided "as is" without warranties of any kind, either express or implied.',
          "Users are solely responsible for their own safety and actions while using location-based features.",
          "We do not guarantee uninterrupted access, accuracy of content, or preservation of user data beyond our reasonable efforts.",
          "Any third-party services integrated within the app are subject to their own terms and conditions."
        ]
      },
      risks: {
        title: "Digital Risks & Safety",
        intro: "Users acknowledge the following digital risks:",
        list: [
          "Internet connectivity issues may affect gameplay experience",
          "GPS accuracy may vary based on device and location",
          "Battery consumption may be higher when using location services",
          "Data usage may occur when using the application",
          "Screen time should be monitored, especially for younger users"
        ],
        safety: "Physical Safety: When using location-based features, always be aware of your surroundings. Do not trespass on private property. Do not use the app while driving or in unsafe conditions."
      },
      ai: {
        intro: "M1SSION incorporates AI-powered features, including the AION assistant and various content generation systems.",
        listTitle: "AI Disclosure:",
        list: [
          "Some content, clues, and narratives may be generated or enhanced by AI",
          "AI responses are for entertainment and should not be considered factual advice",
          "AI-generated content may occasionally contain inaccuracies or inconsistencies",
          "We continuously improve AI systems but cannot guarantee perfection"
        ],
        note: "AION and other AI features are designed to enhance the gaming experience and should be understood as part of the entertainment simulation."
      },
      modifications: {
        title: "Policy Modifications",
        intro: "NIYVORA KFT reserves the right to modify, update, or change these policies at any time without prior notice.",
        list: [
          "Changes will be effective immediately upon posting in the application",
          "Continued use of the app constitutes acceptance of updated policies",
          "Major changes may be communicated via in-app notifications",
          "Users are encouraged to review policies periodically"
        ]
      },
      cookies: {
        title: "Cookies & Data Security",
        intro: "M1SSION uses cookies and similar technologies to enhance user experience. For detailed information, please refer to our",
        linkText: "Cookie Policy",
        listTitle: "Security Measures:",
        list: [
          "End-to-end encryption for sensitive data",
          "Secure authentication protocols",
          "Regular security audits and updates",
          "GDPR and CCPA compliance"
        ]
      },
      compliance: {
        title: "Regulatory Compliance",
        intro: "M1SSION is designed to comply with applicable regulations in the jurisdictions where it operates:",
        eu: { title: "European Union", list: ["GDPR (Data Protection)", "Digital Services Act (DSA)", "Consumer Protection Directives"] },
        us: { title: "United States", list: ["CCPA (California Privacy)", "COPPA (Children's Privacy)", "FTC Guidelines"] },
        appStore: { title: "App Store Compliance", list: ["Apple App Store Guidelines (Simulated Gambling Category)", "Google Play Store Policies"] }
      },
      footer: {
        copyright: " 2025 M1SSION  All Rights Reserved",
        company: "NIYVORA KFT  Budapest, Hungary",
        lastUpdate: "Last Updated"
      }
    }
  };
  const t = content[language];
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#131524] via-[#0F1419] to-black text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "container mx-auto px-4 py-8 max-w-4xl", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      className: "space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between flex-wrap gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => window.history.back(),
                variant: "ghost",
                size: "icon",
                className: "rounded-full hover:bg-white/10",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: t.header.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: t.header.subtitle })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 bg-black/30 rounded-full p-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => setLanguage("it"),
                variant: language === "it" ? "default" : "ghost",
                size: "sm",
                className: `rounded-full ${language === "it" ? "bg-[#00D1FF] text-black" : "text-white/70 hover:text-white"}`,
                children: " IT"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => setLanguage("en"),
                variant: language === "en" ? "default" : "ghost",
                size: "sm",
                className: `rounded-full ${language === "en" ? "bg-[#00D1FF] text-black" : "text-white/70 hover:text-white"}`,
                children: " EN"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-red-500/30 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Ban, { className: "w-5 h-5 mr-2 text-red-400" }),
            "Anti-Gambling Disclaimer"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-red-300 font-semibold mb-2", children: [
                " ",
                t.antiGambling.warning
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80", children: t.antiGambling.text })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.antiGambling.listTitle }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: t.antiGambling.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm italic", children: t.antiGambling.note })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Gamepad2, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            "Nature of M1SSION"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.nature.intro }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.nature.classTitle }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: t.nature.classList.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: item.title }),
                " ",
                item.desc
              ] }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-[#00D1FF]/10 p-3 rounded-lg border border-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF] text-sm", children: t.nature.note }) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-yellow-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Coins, { className: "w-5 h-5 mr-2 text-yellow-400" }),
            "Virtual Currencies (M1U & PE)"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.currencies.intro }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-yellow-500/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-yellow-400 font-semibold mb-2", children: "M1U (M1 Units)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: t.currencies.m1u })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-purple-500/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-purple-400 font-semibold mb-2", children: "PE (Pulse Energy)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: t.currencies.pe })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-yellow-900/20 p-4 rounded-lg border border-yellow-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-yellow-300 font-semibold mb-2", children: [
                " ",
                t.currencies.warning
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 text-white/80 text-sm", children: t.currencies.warningList.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: item }) }, i)) })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.subscriptions.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: t.subscriptions.intro }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-white/10", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-semibold mb-2", children: t.subscriptions.free.title }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: t.subscriptions.free.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-[#00D1FF]/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-[#00D1FF] font-semibold mb-2", children: t.subscriptions.premium.title }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: t.subscriptions.premium.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-[#00D1FF]/10 p-3 rounded-lg border border-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF] text-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.subscriptions.note }) }) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-green-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 mr-2 text-green-400" }),
            t.noTransactions.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.noTransactions.intro }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.noTransactions.listTitle }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: t.noTransactions.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: t.noTransactions.note })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Scale, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.liability.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: t.liability.intro }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-2 ml-4 text-white/80", children: t.liability.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-orange-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 mr-2 text-orange-400" }),
            t.risks.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: t.risks.intro }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: t.risks.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-orange-900/20 p-3 rounded-lg border border-orange-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-orange-300 text-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.risks.safety }) }) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-purple-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-5 h-5 mr-2 text-purple-400" }),
            "AI-Generated Content (AION)"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: t.ai.intro }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.ai.listTitle }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: t.ai.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm italic", children: t.ai.note })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.modifications.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: t.modifications.intro }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: t.modifications.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.cookies.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
              t.cookies.intro,
              " ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("a", { href: "/cookie-policy", className: "text-[#00D1FF] hover:underline", children: t.cookies.linkText }),
              "."
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: t.cookies.listTitle }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: t.cookies.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Globe, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            t.compliance.title
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: t.compliance.intro }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-[#00D1FF] font-semibold", children: t.compliance.eu.title }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: t.compliance.eu.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-[#00D1FF] font-semibold", children: t.compliance.us.title }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: t.compliance.us.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 mt-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-[#00D1FF] font-semibold", children: t.compliance.appStore.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: t.compliance.appStore.list.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: item }, i)) })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pt-6 border-t border-white/10 text-center text-white/60", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: t.footer.copyright }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: t.footer.company }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs mt-2 text-white/40", children: [
            t.footer.lastUpdate,
            ": ",
            (/* @__PURE__ */ new Date()).toLocaleDateString(language === "it" ? "it-IT" : "en-US", { year: "numeric", month: "long", day: "numeric" })
          ] })
        ] })
      ]
    }
  ) }) });
};

const GamePoliciesIt = () => {
  useLocation();
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#131524] via-[#0F1419] to-black text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "container mx-auto px-4 py-8 max-w-4xl", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      className: "space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: () => window.history.back(),
              variant: "ghost",
              size: "icon",
              className: "rounded-full hover:bg-white/10",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: "Policy & Disclaimer" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Informazioni Legali M1SSION" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-red-500/30 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Ban, { className: "w-5 h-5 mr-2 text-red-400" }),
            "Anti-Gambling Disclaimer"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300 font-semibold mb-2", children: " AVVISO IMPORTANTE" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/80", children: [
                "M1SSION ",
                /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NON" }),
                "  un'applicazione di gioco d'azzardo. Questa piattaforma non offre, facilita o promuove alcuna forma di gioco d'azzardo, scommesse, puntate o giochi basati sulla fortuna che coinvolgono denaro reale."
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Questa applicazione NON:" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Accetta scommesse o puntate in denaro reale" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Offre premi in denaro o ricompense monetarie basate sulla fortuna" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Fornisce servizi di casin, scommesse sportive o lotterie" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Permette la conversione di valute virtuali in denaro reale" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Consente prelievi o incassi di alcun tipo" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Simula o incoraggia comportamenti di gioco d'azzardo" })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm italic", children: `Tutti i mini-giochi all'interno di M1SSION (incluso "Pulse Breaker") sono esclusivamente a scopo di intrattenimento e utilizzano solo valute virtuali non riscattabili, senza alcun valore nel mondo reale.` })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Gamepad2, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            "Nature of M1SSION"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
              "M1SSION  un'",
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "applicazione di intrattenimento interattivo" }),
              " progettata come un'esperienza immersiva di simulazione investigativa e caccia al tesoro."
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Classificazione del Gioco:" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Gioco di Simulazione:" }),
                  " Interpretazione del ruolo di agente di intelligence"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Gioco di Puzzle/Mistero:" }),
                  " Risoluzione di indizi e investigazione di luoghi"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Gioco Basato sulla Posizione:" }),
                  " Utilizzo della geolocalizzazione per gameplay interattivo"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Esperienza di Intrattenimento:" }),
                  " Puramente per divertimento e coinvolgimento"
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-[#00D1FF]/10 p-3 rounded-lg border border-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF] text-sm", children: "M1SSION  progettato per fornire un'esperienza narrativa coinvolgente. Tutte le meccaniche di gioco, i risultati e le ricompense fanno parte della simulazione di intrattenimento e non hanno implicazioni economiche nel mondo reale." }) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-yellow-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Coins, { className: "w-5 h-5 mr-2 text-yellow-400" }),
            "Virtual Currencies (M1U & PE)"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
              "M1SSION utilizza due tipi di ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "valute virtuali in-app" }),
              ":"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-yellow-500/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-yellow-400 font-semibold mb-2", children: "M1U (M1 Units)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Token virtuali utilizzati all'interno dell'ecosistema M1SSION per attivit in-app, ricompense e funzionalit di coinvolgimento." })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-purple-500/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-purple-400 font-semibold mb-2", children: "PE (Pulse Energy)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Punti energia virtuali utilizzati per meccaniche di gioco specifiche e funzionalit di partecipazione alla community." })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-yellow-900/20 p-4 rounded-lg border border-yellow-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-300 font-semibold mb-2", children: " DISCLAIMER CRITICO" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 text-white/80 text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  "M1U e PE ",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NON hanno valore monetario" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NON possono essere acquistati" }),
                  " con denaro reale"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NON possono essere venduti, scambiati o convertiti" }),
                  " in valuta reale"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NON possono essere prelevati" }),
                  " o trasferiti fuori dall'app"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  "Sono ",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NON RIMBORSABILI" }),
                  " e ",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NON RISCATTABILI" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                  "Esistono ",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "SOLO" }),
                  " all'interno dell'applicazione M1SSION"
                ] })
              ] })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            "Indizi e Abbonamenti"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "M1SSION offre diversi livelli di abbonamento che determinano l'accesso agli indizi e alle funzionalit di gioco." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-white/10", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-semibold mb-2", children: "FREE (Gratuito)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Accesso base al gioco" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Numero limitato di indizi giornalieri" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "1 BUZZ al giorno" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Funzionalit base" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/30 p-4 rounded-lg border border-[#00D1FF]/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-[#00D1FF] font-semibold mb-2", children: "PREMIUM (Silver, Gold, Black, Titanium)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Maggior numero di indizi giornalieri e settimanali" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "BUZZ multipli (in base al piano)" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Accesso a indizi esclusivi" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Funzionalit avanzate e priorit" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Contenuti narrativi premium" })
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-[#00D1FF]/10 p-3 rounded-lg border border-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-[#00D1FF] text-sm", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Nota:" }),
              " Gli abbonamenti premium forniscono accesso a funzionalit aggiuntive e sono completamente separati dal sistema di premi del gioco. L'abbonamento NON garantisce la vittoria  il successo dipende esclusivamente dalle abilit del giocatore."
            ] }) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-green-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 mr-2 text-green-400" }),
            "Nessuna Transazione in Denaro Reale"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
              "M1SSION ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "NON" }),
              " elabora, gestisce o facilita alcuna transazione in denaro reale relativa a risultati di gioco, vincite in valuta virtuale o esiti di partite."
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Cosa Significa:" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Nessun deposito o pagamento in denaro reale per il gameplay" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Nessun prelievo o pagamento di alcun tipo" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Nessun equivalente in contanti o riscatto di carte regalo" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Nessuno scambio o trasferimento di criptovalute" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Nessuna elaborazione di pagamenti di terze parti per ricompense di gioco" })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Gli abbonamenti premium o gli acquisti in-app sono esclusivamente per funzionalit avanzate e sono completamente separati dai sistemi di valuta virtuale o dai risultati di gioco." })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Scale, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            "Limitazione di Responsabilit"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Utilizzando M1SSION, l'utente riconosce e accetta che:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-2 ml-4 text-white/80", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                "NIYVORA KFT e M1SSION ",
                /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "non sono responsabili" }),
                " per alcun danno diretto, indiretto, incidentale o consequenziale derivante dall'utilizzo dell'applicazione."
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
                "L'applicazione  fornita ",
                /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: `"cos com'"` }),
                " senza garanzie di alcun tipo, espresse o implicite."
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Gli utenti sono gli unici responsabili della propria sicurezza e delle proprie azioni durante l'utilizzo delle funzionalit basate sulla posizione." }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Non garantiamo l'accesso ininterrotto, l'accuratezza dei contenuti o la conservazione dei dati degli utenti oltre i nostri ragionevoli sforzi." }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Qualsiasi servizio di terze parti integrato nell'app  soggetto ai propri termini e condizioni." })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-orange-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 mr-2 text-orange-400" }),
            "Rischi Digitali & Sicurezza"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Gli utenti riconoscono i seguenti rischi digitali:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Problemi di connettivit Internet possono influire sull'esperienza di gioco" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "La precisione del GPS pu variare in base al dispositivo e alla posizione" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Il consumo della batteria pu essere maggiore quando si utilizzano i servizi di localizzazione" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Il consumo di dati pu verificarsi durante l'utilizzo dell'applicazione" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Il tempo di utilizzo dello schermo dovrebbe essere monitorato, specialmente per gli utenti pi giovani" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-orange-900/20 p-3 rounded-lg border border-orange-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-orange-300 text-sm", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Sicurezza Fisica:" }),
              " Quando si utilizzano funzionalit basate sulla posizione, prestare sempre attenzione all'ambiente circostante. Non entrare in propriet private. Non utilizzare l'app mentre si guida o in condizioni non sicure."
            ] }) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-purple-500/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-5 h-5 mr-2 text-purple-400" }),
            "AI-Generated Content (AION)"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
              "M1SSION incorpora funzionalit basate sull'intelligenza artificiale, incluso l'assistente ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "AION" }),
              " e vari sistemi di generazione di contenuti."
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Informativa sull'IA:" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Alcuni contenuti, indizi e narrazioni possono essere generati o migliorati dall'IA" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Le risposte dell'IA sono per intrattenimento e non devono essere considerate consigli fattuali" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "I contenuti generati dall'IA possono occasionalmente contenere imprecisioni o incoerenze" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Miglioriamo continuamente i sistemi di IA ma non possiamo garantire la perfezione" })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm italic", children: "AION e le altre funzionalit IA sono progettate per migliorare l'esperienza di gioco e devono essere intese come parte della simulazione di intrattenimento." })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            "Modifiche alle Policy"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "NIYVORA KFT si riserva il diritto di modificare, aggiornare o cambiare queste policy in qualsiasi momento senza preavviso." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Le modifiche saranno effettive immediatamente dopo la pubblicazione nell'applicazione" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "L'uso continuato dell'app costituisce accettazione delle policy aggiornate" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Le modifiche importanti possono essere comunicate tramite notifiche in-app" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Gli utenti sono incoraggiati a rivedere periodicamente le policy" })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            "Cookie & Sicurezza dei Dati"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
              "M1SSION utilizza cookie e tecnologie simili per migliorare l'esperienza utente. Per informazioni dettagliate, consultare la nostra",
              " ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("a", { href: "/cookie-policy", className: "text-[#00D1FF] hover:underline", children: "Cookie Policy" }),
              "."
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Misure di Sicurezza:" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 ml-4 text-white/80", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Crittografia end-to-end per i dati sensibili" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Protocolli di autenticazione sicuri" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Audit di sicurezza e aggiornamenti regolari" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Conformit GDPR e CCPA" })
              ] })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Globe, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            "Conformit Normativa"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 text-white/90 leading-relaxed", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "M1SSION  progettato per conformarsi alle normative applicabili nelle giurisdizioni in cui opera:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-[#00D1FF] font-semibold", children: "Unione Europea" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "GDPR (Protezione dei Dati)" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Digital Services Act (DSA)" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Direttive sulla Protezione dei Consumatori" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-[#00D1FF] font-semibold", children: "Stati Uniti" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "CCPA (Privacy California)" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "COPPA (Privacy dei Minori)" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Linee Guida FTC" })
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 mt-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-[#00D1FF] font-semibold", children: "Conformit App Store" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1 text-white/70 text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Linee Guida Apple App Store (Categoria Gioco d'Azzardo Simulato)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Policy Google Play Store" })
              ] })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pt-6 border-t border-white/10 text-center text-white/60", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: " 2025 M1SSION  Tutti i Diritti Riservati" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: "NIYVORA KFT  Budapest, Ungheria" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs mt-2 text-white/40", children: [
            "Ultimo Aggiornamento: ",
            (/* @__PURE__ */ new Date()).toLocaleDateString("it-IT", { year: "numeric", month: "long", day: "numeric" })
          ] })
        ] })
      ]
    }
  ) }) });
};

const M1ssionText = () => {
  const { navigate } = useWouterNavigation();
  const [tapCount, setTapCount] = reactExports.useState(0);
  const [tapTimer, setTapTimer] = reactExports.useState(null);
  const handleClick = reactExports.useCallback(() => {
    setTapCount((prev) => prev + 1);
    if (tapTimer) {
      clearTimeout(tapTimer);
    }
    const timer = setTimeout(() => {
      if (tapCount + 1 >= 2) {
        localStorage.removeItem("developer_access");
        window.location.reload();
      }
      setTapCount(0);
    }, 300);
    setTapTimer(timer);
    if (tapCount < 1) {
      navigate("/");
    }
  }, [navigate, tapCount, tapTimer]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "button",
    {
      onClick: handleClick,
      className: "flex items-center font-orbitron text-xl md:text-2xl font-bold transition-opacity hover:opacity-80",
      "aria-label": "Go to homepage",
      style: { cursor: "pointer" },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "span",
          {
            className: "text-[#00E5FF]",
            style: {
              textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"
            },
            children: "M1"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
          "SSION",
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "" })
        ] })
      ]
    }
  );
};

const FakeStripeCheckout = ({
  planName,
  planPrice,
  planFeatures
}) => {
  const [isProcessing, setIsProcessing] = reactExports.useState(false);
  const [isSuccess, setIsSuccess] = reactExports.useState(false);
  const [cardData, setCardData] = reactExports.useState({
    number: "",
    expiry: "",
    cvc: "",
    name: ""
  });
  const { toast } = useToast();
  const { navigate } = useWouterNavigation();
  const handlePayment = async () => {
    setIsProcessing(true);
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) throw new Error("User not authenticated");
      await new Promise((resolve) => setTimeout(resolve, 2e3));
      await supabase.from("subscriptions").upsert({
        user_id: user.id,
        tier: planName,
        status: "active",
        start_date: (/* @__PURE__ */ new Date()).toISOString(),
        end_date: new Date(Date.now() + 365 * 24 * 60 * 60 * 1e3).toISOString(),
        provider: "stripe",
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      });
      const { getPriceEur, getPriceCents } = await __vitePreload(async () => { const { getPriceEur, getPriceCents } = await Promise.resolve().then(() => pricingConfig);return { getPriceEur, getPriceCents }},true?void 0:void 0);
      await supabase.from("payment_transactions").insert({
        user_id: user.id,
        amount: getPriceCents(planName) || 0,
        // CRITICAL FIX: Use cents for Stripe compatibility
        currency: "EUR",
        description: `Upgrade to ${planName} plan`,
        status: "success",
        provider: "stripe"
      });
      const subscriptionData = {
        plan: planName,
        price: planPrice,
        activatedAt: (/* @__PURE__ */ new Date()).toISOString(),
        features: planFeatures
      };
      localStorage.setItem("active_subscription", JSON.stringify(subscriptionData));
      localStorage.setItem("subscription_plan", planName);
      window.dispatchEvent(new Event("storage"));
      setIsProcessing(false);
      setIsSuccess(true);
      toast({
        title: " Upgrade completato con successo!",
        description: `Piano ${planName} attivato con successo.`
      });
      setTimeout(() => {
        navigate("/profile");
      }, 2e3);
    } catch (error) {
      setIsProcessing(false);
      toast({
        title: " Errore durante l'upgrade. Riprova.",
        description: "Si  verificato un errore durante il processo di pagamento.",
        variant: "destructive"
      });
    }
  };
  if (isSuccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, scale: 0.8 },
        animate: { opacity: 1, scale: 1 },
        className: "text-center py-8",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-16 w-16 text-green-500 mx-auto mb-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-white mb-2", children: "Pagamento Completato!" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/60", children: [
            "Piano ",
            planName,
            " attivato correttamente"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/40 mt-2", children: "Reindirizzamento in corso..." })
        ]
      }
    );
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-white/5 border-white/20", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2 text-white", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CreditCard, { className: "h-5 w-5" }),
        "Dettagli di Pagamento"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardDescription, { className: "text-white/60", children: [
        "Completa il pagamento per attivare il piano ",
        planName
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 bg-white/5 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "font-semibold text-white mb-2", children: [
          "Piano Selezionato: ",
          planName
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-2xl font-bold text-primary mb-2", children: [
          planPrice,
          "/mese"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-1", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { className: "flex items-center gap-2 text-sm text-white/80", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-3 w-3 text-green-500" }),
          feature
        ] }, index)) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cardNumber", className: "text-white", children: "Numero Carta" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "cardNumber",
              placeholder: "1234 5678 9012 3456",
              value: cardData.number,
              onChange: (e) => setCardData((prev) => ({ ...prev, number: e.target.value })),
              className: "bg-white/5 border-white/20 text-white"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "expiry", className: "text-white", children: "Scadenza" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "expiry",
                placeholder: "MM/AA",
                value: cardData.expiry,
                onChange: (e) => setCardData((prev) => ({ ...prev, expiry: e.target.value })),
                className: "bg-white/5 border-white/20 text-white"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cvc", className: "text-white", children: "CVC" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "cvc",
                placeholder: "123",
                value: cardData.cvc,
                onChange: (e) => setCardData((prev) => ({ ...prev, cvc: e.target.value })),
                className: "bg-white/5 border-white/20 text-white"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cardName", className: "text-white", children: "Nome sul Titolare" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "cardName",
              placeholder: "Mario Rossi",
              value: cardData.name,
              onChange: (e) => setCardData((prev) => ({ ...prev, name: e.target.value })),
              className: "bg-white/5 border-white/20 text-white"
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/20 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "h-4 w-4 text-green-500" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-green-400", children: "Pagamento sicuro protetto da crittografia SSL" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: handlePayment,
          disabled: isProcessing || !cardData.number || !cardData.expiry || !cardData.cvc || !cardData.name,
          className: "w-full bg-primary hover:bg-primary/90 h-12",
          children: isProcessing ? /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              animate: { rotate: 360 },
              transition: { duration: 1, repeat: Infinity, ease: "linear" },
              className: "h-4 w-4 border-2 border-white border-t-transparent rounded-full"
            }
          ) : `Procedi con il pagamento - ${planPrice}/mese`
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/40 text-center", children: "Questo  un pagamento simulato per scopi dimostrativi" })
    ] })
  ] });
};

const SilverPlanPage = () => {
  const navigate = useNavigate();
  const planFeatures = [
    "Tutti i vantaggi Base",
    "3 indizi premium aggiuntivi a settimana",
    "Accesso anticipato di 2 ore agli eventi",
    "Badge Silver nel profilo"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionText, {}) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.main,
          {
            className: "text-white",
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            transition: { duration: 0.5 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card mx-2 sm:mx-4 mt-4 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "sm",
                    onClick: () => navigate("/subscriptions"),
                    className: "p-2 hover:bg-white/10",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-xl font-semibold", children: "Piano Silver" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center gap-2 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "h-8 w-8 text-silver" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-3xl font-bold text-white", children: "M1SSION Silver" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-4xl font-bold text-primary mb-2", children: getDisplayPrice("Silver") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "al mese" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white mb-4", children: "Cosa include:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 bg-white/5 rounded-lg", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "h-4 w-4 text-silver" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: feature })
                ] }, index)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                FakeStripeCheckout,
                {
                  planName: "Silver",
                  planPrice: getDisplayPrice("Silver"),
                  planFeatures
                }
              )
            ] }) })
          }
        )
      ]
    }
  );
};

const GoldPlanPage = () => {
  const navigate = useNavigate();
  const planFeatures = [
    "Tutti i vantaggi Silver",
    "4 indizi premium aggiuntivi a settimana",
    "Accesso anticipato di 12 ore agli eventi",
    "Partecipazione alle estrazioni Gold",
    "Badge Gold esclusivo nel profilo"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionText, {}) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.main,
          {
            className: "text-white",
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            transition: { duration: 0.5 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card mx-2 sm:mx-4 mt-4 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "sm",
                    onClick: () => navigate("/subscriptions"),
                    className: "p-2 hover:bg-white/10",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-xl font-semibold", children: "Piano Gold" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-yellow-500/20 text-yellow-400 border-yellow-500/30", children: "Pi Popolare" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center gap-2 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "h-8 w-8 text-yellow-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-3xl font-bold text-white", children: "M1SSION Gold" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-4xl font-bold text-primary mb-2", children: getDisplayPrice("Gold") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "al mese" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 inline-flex items-center gap-2 px-4 py-2 bg-yellow-500/20 border border-yellow-500/30 rounded-full", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "h-4 w-4 text-yellow-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-yellow-400 font-medium", children: "Piano consigliato" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white mb-4", children: "Cosa include:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 bg-white/5 rounded-lg border border-yellow-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "h-4 w-4 text-yellow-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: feature })
                ] }, index)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                FakeStripeCheckout,
                {
                  planName: "Gold",
                  planPrice: getDisplayPrice("Gold"),
                  planFeatures
                }
              )
            ] }) })
          }
        )
      ]
    }
  );
};

const BlackPlanPage = () => {
  const navigate = useNavigate();
  const planFeatures = [
    "Tutti i vantaggi Gold",
    "Accesso VIP anticipato di 24 ore agli eventi",
    "5 indizi premium aggiuntivi a settimana",
    "Badge Black esclusivo"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionText, {}) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.main,
          {
            className: "text-white",
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            transition: { duration: 0.5 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card mx-2 sm:mx-4 mt-4 mb-4 border-2 border-purple-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "sm",
                    onClick: () => navigate("/subscriptions"),
                    className: "p-2 hover:bg-white/10",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-xl font-semibold", children: "Piano Black" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-purple-500/20 text-purple-400 border-purple-500/30", children: "Premium" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center gap-2 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "h-8 w-8 text-purple-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-3xl font-bold text-white", children: "M1SSION Black" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-4xl font-bold text-primary mb-2", children: getDisplayPrice("Black") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "al mese" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 inline-flex items-center gap-2 px-4 py-2 bg-purple-500/20 border border-purple-500/30 rounded-full", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "h-4 w-4 text-purple-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-purple-400 font-medium", children: "Esperienza VIP Completa" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white mb-4", children: "Cosa include:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 bg-purple-500/10 rounded-lg border border-purple-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "h-4 w-4 text-purple-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: feature })
                ] }, index)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-6 p-4 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-center text-white font-medium", children: " Accesso esclusivo alle missioni pi segrete di M1SSION" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                FakeStripeCheckout,
                {
                  planName: "Black",
                  planPrice: getDisplayPrice("Black"),
                  planFeatures
                }
              )
            ] }) })
          }
        )
      ]
    }
  );
};

const TitaniumPlanPage = () => {
  const navigate = useNavigate();
  const planFeatures = [
    "Tutti i vantaggi Black",
    "7 indizi premium aggiuntivi a settimana",
    "Accesso VIP anticipato di 48 ore agli eventi",
    "Supporto prioritario dedicato (24/7)",
    "Eventi esclusivi M1SSION",
    "Badge Titanium esclusivo"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionText, {}) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.main,
          {
            className: "text-white",
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            transition: { duration: 0.5 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card mx-2 sm:mx-4 mt-4 mb-4 border-2 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "sm",
                    onClick: () => navigate("/subscriptions"),
                    className: "p-2 hover:bg-white/10",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-xl font-semibold", children: "Piano Titanium" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-cyan-500/20 text-cyan-400 border-cyan-500/30", children: "Ultimate" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center gap-2 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Infinity$1, { className: "h-8 w-8 text-cyan-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-3xl font-bold text-white", children: "M1SSION Titanium" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-4xl font-bold text-primary mb-2", children: getDisplayPrice("Titanium") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "al mese" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 inline-flex items-center gap-2 px-4 py-2 bg-cyan-500/20 border border-cyan-500/30 rounded-full", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "h-4 w-4 text-cyan-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 font-medium", children: "Esperienza Ultimate Completa" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white mb-4", children: "Cosa include:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 bg-cyan-500/10 rounded-lg border border-cyan-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Infinity$1, { className: "h-4 w-4 text-cyan-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: feature })
                ] }, index)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-6 p-4 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 border border-cyan-500/30 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-center text-white font-medium", children: " Accesso supremo alle funzionalit pi avanzate di M1SSION" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                FakeStripeCheckout,
                {
                  planName: "Titanium",
                  planPrice: getDisplayPrice("Titanium"),
                  planFeatures
                }
              )
            ] }) })
          }
        )
      ]
    }
  );
};

const useStripeInAppPayment = () => {
  const [loading, setLoading] = reactExports.useState(false);
  const [showCheckout, setShowCheckout] = reactExports.useState(false);
  const [paymentConfig, setPaymentConfig] = reactExports.useState(null);
  const [defaultPaymentMethod, setDefaultPaymentMethod] = reactExports.useState(null);
  const { user } = useAuthContext();
  reactExports.useEffect(() => {
    const loadDefaultPaymentMethod = async () => {
      if (!user) return;
      try {
        const { data, error } = await supabase.from("user_payment_methods").select("*").eq("user_id", user.id).eq("is_default", true).order("created_at", { ascending: false }).limit(1).maybeSingle();
        if (error) {
          return;
        }
        if (data) {
          setDefaultPaymentMethod(data);
        }
      } catch (error) {
      }
    };
    loadDefaultPaymentMethod();
  }, [user]);
  const initiatePayment = async (config) => {
    if (!user) {
      ue.error("Devi essere loggato per effettuare pagamenti");
      return;
    }
    const configWithDefaults = {
      ...config,
      metadata: {
        ...config.metadata,
        default_payment_method: defaultPaymentMethod?.stripe_pm_id,
        auto_fill_enabled: !!defaultPaymentMethod
      }
    };
    setPaymentConfig(configWithDefaults);
    setShowCheckout(true);
  };
  const processSubscription = async (plan) => {
    const { getPriceCents, getPriceEur } = await __vitePreload(async () => { const { getPriceCents, getPriceEur } = await Promise.resolve().then(() => pricingConfig);return { getPriceCents, getPriceEur }},true?void 0:void 0);
    const cents = getPriceCents(plan);
    const eur = getPriceEur(plan);
    if (!cents || !eur) {
      ue.error("Piano di abbonamento non valido");
      return;
    }
    const config = {
      type: "subscription",
      amount: cents,
      // SYNCHRONIZED: Use centralized pricing
      description: `Piano ${plan} con vantaggi premium`,
      plan,
      metadata: {
        subscription_plan: plan,
        price_cents: cents,
        price_eur: eur,
        mission: "M1SSION",
        reset_date: "2025-07-22"
      }
    };
    await initiatePayment(config);
  };
  const closeCheckout = () => {
    if (!loading) {
      setShowCheckout(false);
      setPaymentConfig(null);
    }
  };
  const handlePaymentSuccess = async (paymentIntentId) => {
    try {
      if (paymentConfig?.type === "subscription") {
        await supabase.functions.invoke("handle-payment-success", {
          body: {
            payment_intent_id: paymentIntentId,
            user_id: user?.id,
            plan: paymentConfig.plan
          }
        });
        ue.success(` Abbonamento ${paymentConfig.plan} attivato!`);
        return { ok: true };
      }
      setShowCheckout(false);
      setPaymentConfig(null);
      return { ok: true };
    } catch (error) {
      ue.error("Errore nella finalizzazione del pagamento");
      return { ok: false };
    }
  };
  return {
    // Universal payment methods
    processSubscription,
    // UI state
    showCheckout,
    paymentConfig,
    loading,
    setLoading,
    defaultPaymentMethod,
    //  2025 Joseph MUL  M1SSION  Auto-fill support
    // Handlers
    closeCheckout,
    handlePaymentSuccess
  };
};

const plans = [
  {
    id: "free",
    name: "Free (Base)",
    price: "0",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-8 h-8" }),
    earlyAccess: "Accesso quando disponibile",
    features: [
      "1 indizio a settimana",
      "Accesso alle missioni quando attive",
      "Badge Base nel profilo",
      "Partecipazione al gioco"
    ],
    color: "from-gray-500 to-gray-700",
    free: true
  },
  {
    id: "Silver",
    name: "Silver",
    price: "3.99",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-8 h-8" }),
    earlyAccess: "2 ore prima",
    features: [
      "Tutti i vantaggi Base",
      "3 indizi premium aggiuntivi a settimana",
      "Accesso anticipato di 2 ore agli eventi",
      "Badge Silver nel profilo"
    ],
    color: "from-slate-400 to-slate-600"
  },
  {
    id: "Gold",
    name: "Gold",
    price: "6.99",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "w-8 h-8" }),
    earlyAccess: "12 ore prima",
    features: [
      "Tutti i vantaggi Silver",
      "4 indizi premium aggiuntivi a settimana",
      "Accesso anticipato di 12 ore agli eventi",
      "Partecipazione alle estrazioni Gold",
      "Badge Gold esclusivo nel profilo"
    ],
    popular: true,
    color: "from-yellow-400 to-yellow-600"
  },
  {
    id: "Black",
    name: "Black",
    price: "9.99",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-8 h-8" }),
    earlyAccess: "24 ore prima",
    features: [
      "Tutti i vantaggi Gold",
      "Accesso VIP anticipato di 24 ore agli eventi",
      "5 indizi premium aggiuntivi a settimana",
      "Badge Black esclusivo"
    ],
    color: "from-gray-800 to-black"
  },
  {
    id: "Titanium",
    name: "Titanium",
    price: "29.99",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "w-8 h-8" }),
    earlyAccess: "48 ore prima",
    features: [
      "Tutti i vantaggi Black",
      "5 indizi premium aggiuntivi a settimana",
      "Accesso VIP anticipato di 48 ore agli eventi",
      "Supporto prioritario dedicato (24/7)",
      "Eventi esclusivi M1SSION",
      "Badge Titanium esclusivo"
    ],
    premium: true,
    color: "from-purple-400 to-purple-600"
  }
];
const ChoosePlanPage = () => {
  const [, setLocation] = useLocation();
  const [selectedPlan, setSelectedPlan] = reactExports.useState("");
  const [isProcessing, setIsProcessing] = reactExports.useState(false);
  const [isLoadingFree, setIsLoadingFree] = reactExports.useState(false);
  const { getCurrentUser } = useUnifiedAuth();
  reactExports.useEffect(() => {
    const markSeen = async () => {
      try {
        await supabase.rpc("mark_choose_plan_seen");
      } catch (error) {
      }
    };
    markSeen();
  }, []);
  const {
    processSubscription,
    showCheckout,
    paymentConfig,
    closeCheckout,
    handlePaymentSuccess
  } = useStripeInAppPayment();
  const startFreePlan = async () => {
    if (isLoadingFree) return;
    setIsLoadingFree(true);
    try {
      const { data, error } = await supabase.rpc("create_free_subscription");
      if (error && !/23505|unique|duplicate|already/i.test(error.message)) {
        ue.error("Errore temporaneo, riprova");
        setIsLoadingFree(false);
        return;
      }
      try {
        await supabase.rpc("mark_choose_plan_seen");
      } catch (markError) {
      }
      setLocation("/home");
    } catch (e) {
      ue.error("Errore temporaneo, riprova");
      setIsLoadingFree(false);
    }
  };
  const handlePlanSelection = async (planId) => {
    if (isProcessing) return;
    if (planId === "free") {
      return startFreePlan();
    }
    setIsProcessing(true);
    setSelectedPlan(planId);
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        await supabase.from("profiles").update({ subscription_plan: planId }).eq("id", user.id);
      }
      await processSubscription(planId);
      ue.success("Checkout aperto - completa il pagamento");
    } catch (error) {
      ue.error("Errore durante la selezione del piano");
      setIsProcessing(false);
      setSelectedPlan("");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-black text-white p-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        className: "max-w-6xl mx-auto",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-12", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "plans-title", children: [
              "Scegli il tuo Piano ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "brand-m1", children: "M1" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "brand-ss", children: "SSION" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xl text-gray-300", children: "Seleziona il piano di abbonamento per accedere alla missione" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "plans-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 max-w-6xl mx-auto", children: plans.map((plan) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, scale: 0.9 },
              animate: { opacity: 1, scale: 1 },
              transition: { delay: plans.indexOf(plan) * 0.1 },
              className: "relative",
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: `plan-card ${plan.popular ? "gold" : ""} ${plan.premium ? "titanium" : ""} ${plan.free ? "free" : ""} bg-gray-900 border-gray-700 h-full ${plan.popular ? "border-yellow-500 border-2" : plan.premium ? "border-purple-500 border-2" : ""}`, children: [
                plan.popular && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "ribbon", children: "Pi Popolare" }),
                plan.premium && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "ribbon", children: "Premium" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r ${plan.color} flex items-center justify-center text-white`, children: plan.icon }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-2xl text-white", children: plan.name }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { className: "text-gray-400", children: plan.earlyAccess }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-3xl font-bold text-white", children: [
                    "",
                    plan.price,
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-400", children: "/mese" })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
                  plan.features.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-gray-300", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-green-500 rounded-full mr-3" }),
                    feature
                  ] }, index)),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => handlePlanSelection(plan.id),
                      disabled: isProcessing || plan.id === "free" && isLoadingFree,
                      "data-testid": plan.id === "free" ? "cta-free" : void 0,
                      className: `w-full mt-6 free-cta ${selectedPlan === plan.id || plan.id === "free" && isLoadingFree ? "opacity-50" : ""} ${plan.free ? "bg-gray-600 hover:bg-gray-700 text-white" : plan.popular ? "bg-yellow-500 hover:bg-yellow-600 text-black" : plan.premium ? "bg-purple-500 hover:bg-purple-600" : "bg-white text-black hover:bg-gray-200"}`,
                      children: plan.id === "free" && isLoadingFree ? "Attivazione" : selectedPlan === plan.id ? "Elaborazione..." : plan.free ? "Inizia Gratis" : "Seleziona Piano"
                    }
                  )
                ] })
              ] })
            },
            plan.id
          )) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-400", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mb-4", children: "Tutti i piani includono accesso completo al gioco e indizi in base al piano di abbonamento scelto" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: "Puoi cancellare o modificare il tuo piano in qualsiasi momento" })
          ] })
        ]
      }
    ),
    showCheckout && paymentConfig && /* @__PURE__ */ jsxRuntimeExports.jsx(
      StripeInAppCheckout,
      {
        config: paymentConfig,
        onSuccess: (paymentIntentId) => {
          handlePaymentSuccess(paymentIntentId);
          setIsProcessing(false);
          setSelectedPlan("");
          setTimeout(() => {
            setLocation("/subscription-verify");
          }, 500);
        },
        onCancel: () => {
          closeCheckout();
          setIsProcessing(false);
          setSelectedPlan("");
        }
      }
    )
  ] });
};

const SubscriptionVerify = () => {
  const [, setLocation] = useLocation();
  const [verificationState, setVerificationState] = reactExports.useState("verifying");
  const [attemptCount, setAttemptCount] = reactExports.useState(0);
  const [errorMessage, setErrorMessage] = reactExports.useState("");
  const verifySubscription = async () => {
    try {
      const { data: userData, error: userError } = await supabase.auth.getUser();
      if (userError || !userData.user) {
        throw new Error("Utente non autenticato");
      }
      const { data: profileData, error: profileError } = await supabase.from("profiles").select("subscription_plan, subscription_tier, tier").eq("id", userData.user.id).single();
      if (profileError) {
        throw new Error("Errore nel caricamento del profilo");
      }
      const validPlans = ["SILVER", "GOLD", "BLACK", "TITANIUM"];
      const userPlan = profileData.subscription_plan || profileData.subscription_tier || profileData.tier;
      if (validPlans.includes(userPlan)) {
        setVerificationState("success");
        setTimeout(() => {
          setLocation("/panel-access");
        }, 1500);
        return;
      }
      const newAttemptCount = attemptCount + 1;
      setAttemptCount(newAttemptCount);
      if (newAttemptCount >= 5) {
        setVerificationState("error");
        setErrorMessage("Errore di sincronizzazione. Il tuo abbonamento potrebbe richiedere alcuni minuti per essere attivato.");
      } else {
        setTimeout(() => {
          verifySubscription();
        }, 2e3);
      }
    } catch (error) {
      setVerificationState("error");
      setErrorMessage(error instanceof Error ? error.message : "Errore di connessione");
    }
  };
  const handleRetry = () => {
    setVerificationState("verifying");
    setAttemptCount(0);
    setErrorMessage("");
    verifySubscription();
  };
  reactExports.useEffect(() => {
    const timer = setTimeout(() => {
      verifySubscription();
    }, 2e3);
    return () => clearTimeout(timer);
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-black text-white flex flex-col items-center justify-center p-4 relative overflow-hidden", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute inset-0 opacity-20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-1/4 left-1/4 w-64 h-64 bg-purple-500 rounded-full filter blur-3xl animate-pulse" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-1/4 right-1/4 w-48 h-48 bg-blue-500 rounded-full filter blur-3xl animate-pulse delay-1000" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, scale: 0.9 },
        animate: { opacity: 1, scale: 1 },
        transition: { duration: 0.5 },
        className: "relative z-10 text-center max-w-md mx-auto",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.h1,
            {
              className: "text-4xl md:text-6xl font-bold mb-8 bg-gradient-to-r from-yellow-400 to-red-500 bg-clip-text text-transparent",
              initial: { y: -20 },
              animate: { y: 0 },
              transition: { delay: 0.2 },
              children: "M1SSION"
            }
          ),
          verificationState === "verifying" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              className: "space-y-6",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-16 h-16 mx-auto mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 border-4 border-purple-500/30 rounded-full" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      className: "absolute inset-0 border-4 border-transparent border-t-purple-500 rounded-full",
                      animate: { rotate: 360 },
                      transition: { duration: 1, repeat: Infinity, ease: "linear" }
                    }
                  )
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.h2,
                  {
                    className: "text-2xl font-bold text-white mb-4",
                    animate: { opacity: [1, 0.5, 1] },
                    transition: { duration: 1.5, repeat: Infinity },
                    children: "Verifica in corso..."
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 text-lg", children: "Sincronizzazione abbonamento con sistema M1SSION" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-gray-400", children: [
                  "Tentativo ",
                  attemptCount + 1,
                  " di 5"
                ] })
              ]
            }
          ),
          verificationState === "success" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0, scale: 0.8 },
              animate: { opacity: 1, scale: 1 },
              className: "space-y-6",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "w-16 h-16 mx-auto mb-4 bg-green-500 rounded-full flex items-center justify-center",
                    initial: { scale: 0 },
                    animate: { scale: 1 },
                    transition: { type: "spring", duration: 0.6 },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { className: "w-8 h-8 text-white", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: /* @__PURE__ */ jsxRuntimeExports.jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 3, d: "M5 13l4 4L19 7" }) })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-green-400 mb-4", children: " Abbonamento Verificato!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300", children: "Accesso premium attivato. Reindirizzamento in corso..." })
              ]
            }
          ),
          verificationState === "error" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              className: "space-y-6",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-16 h-16 mx-auto mb-4 bg-red-500 rounded-full flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { className: "w-8 h-8 text-white", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: /* @__PURE__ */ jsxRuntimeExports.jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.232 15c-.77.833.192 2.5 1.732 2.5z" }) }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-red-400 mb-4", children: " Errore di Sincronizzazione" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 mb-6", children: errorMessage || "Errore nella verifica dell'abbonamento. Riprova tra qualche istante." }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: handleRetry,
                      className: "w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300",
                      children: " Riprova Verifica"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => setLocation("/choose-plan"),
                      variant: "outline",
                      className: "w-full border-gray-600 text-gray-300 hover:bg-gray-800",
                      children: "Torna alla Selezione Piano"
                    }
                  )
                ] })
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "mt-12 text-gray-500 text-xs",
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              transition: { delay: 1 },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: " 2025 Joseph MUL  M1SSION  ALL RIGHTS RESERVED  NIYVORA KFT" })
            }
          )
        ]
      }
    )
  ] });
};

const PostLoginMissionIntro = () => {
  const [currentIndex, setCurrentIndex] = reactExports.useState(0);
  const [displayText, setDisplayText] = reactExports.useState("");
  const [showSlogan, setShowSlogan] = reactExports.useState(false);
  const [showStartDate, setShowStartDate] = reactExports.useState(false);
  const { navigate } = useWouterNavigation();
  const { getCurrentUser } = useUnifiedAuth();
  reactExports.useEffect(() => {
    const user = getCurrentUser();
    if (user?.email === "wikus77@hotmail.it") {
      navigate("/home");
      return;
    }
  }, [getCurrentUser, navigate]);
  const animationSteps = ["M", "M1", "M1S", "M1SS", "M1SSI", "M1SSIO", "M1SSION", "M1SSION"];
  reactExports.useEffect(() => {
    let interval;
    let startTimer;
    const startAnimation = () => {
      let stepIndex = 0;
      interval = setInterval(() => {
        if (stepIndex < animationSteps.length) {
          setDisplayText(animationSteps[stepIndex]);
          stepIndex++;
          if (stepIndex === animationSteps.length) {
            clearInterval(interval);
            setTimeout(() => {
              setShowSlogan(true);
              setTimeout(() => {
                setShowStartDate(true);
                setTimeout(() => {
                  sessionStorage.setItem("hasSeenPostLoginIntro", "true");
                  navigate("/home");
                }, 1500);
              }, 1e3);
            }, 500);
          }
        } else {
          clearInterval(interval);
        }
      }, 175);
    };
    startTimer = setTimeout(startAnimation, 300);
    return () => {
      clearTimeout(startTimer);
      if (interval) clearInterval(interval);
    };
  }, [navigate]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-black flex items-center justify-center overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative w-full h-full flex items-center justify-center", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        className: "text-7xl md:text-8xl lg:text-9xl font-orbitron tracking-wider",
        style: {
          fontWeight: "normal",
          fontFamily: "Orbitron, monospace",
          position: "absolute",
          top: "35%",
          left: "50%",
          transform: "translate(-50%, -50%)",
          whiteSpace: "nowrap",
          zIndex: 50,
          textAlign: "center"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", style: {
            textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"
          }, children: displayText.slice(0, 2) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", style: {
            textShadow: "0 0 5px rgba(255, 255, 255, 0.3)"
          }, children: displayText.slice(2) })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showSlogan && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, y: 30 },
        animate: { opacity: 1, y: 0 },
        exit: { opacity: 0, y: -30 },
        transition: { duration: 0.8, ease: "easeOut" },
        className: "text-xl md:text-2xl lg:text-3xl font-orbitron tracking-widest",
        style: {
          fontWeight: "normal",
          color: "#BFA342",
          position: "absolute",
          top: "52%",
          left: "50%",
          transform: "translate(-50%, -50%)",
          whiteSpace: "nowrap",
          zIndex: 40,
          textShadow: "0 0 8px rgba(191, 163, 66, 0.4)",
          textAlign: "center"
        },
        children: "IT IS POSSIBLE"
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showStartDate && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, y: 30 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: "easeOut" },
        className: "text-base md:text-lg lg:text-xl font-orbitron tracking-wider",
        style: {
          fontWeight: "normal",
          color: "#FFD700",
          position: "absolute",
          top: "65%",
          left: "50%",
          transform: "translate(-50%, -50%)",
          whiteSpace: "nowrap",
          zIndex: 30,
          textShadow: "0 0 6px rgba(255, 215, 0, 0.4)",
          textAlign: "center"
        },
        children: "Inizio: 19-06-25"
      }
    ) })
  ] }) });
};

function MissionIntroPage() {
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 w-full h-full bg-black overflow-hidden z-50", children: /* @__PURE__ */ jsxRuntimeExports.jsx(PostLoginMissionIntro, {}) });
}

React$1.lazy(() => __vitePreload(() => import('./MarkersHealthcheck.CyVW0NID.js'),true?__vite__mapDeps([13,3,2,1,6,5,7,8,9]):void 0));
const IS_DEV = false;
const SendNotificationPage = React$1.lazy(() => __vitePreload(() => import('./SendNotificationPage.Bnn_4_3p.js'),true?__vite__mapDeps([14,3,2,1,6,5,7,8,9]):void 0));
const MissionPanelPage = React$1.lazy(() => __vitePreload(() => import('./MissionPanelPage.BZkGObEB.js'),true?__vite__mapDeps([15,3,2,1,6,5,7,8,9]):void 0));
const PulseLab = React$1.lazy(() => __vitePreload(() => import('./PulseLab.B0VT9Jnm.js'),true?__vite__mapDeps([16,3,2,5,1,6,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./PushTestPage.Vt0nqUQa.js'),true?__vite__mapDeps([17,3,2,18,1,6,5,7,8,9]):void 0));
const AdminPushConsolePage = React$1.lazy(() => __vitePreload(() => import('./AdminPushConsolePage.CK-M87o9.js'),true?__vite__mapDeps([19,3,2,20,18,1,6,5,7,8,9]):void 0));
const PushSenderPanel = React$1.lazy(() => __vitePreload(() => import('./PushSenderPanel.BAspSXC-.js'),true?__vite__mapDeps([21,3,2,22,1,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./NotificationDebug.D0xuRqV3.js'),true?__vite__mapDeps([23,3,2,1,6,5,7,8,9]):void 0));
const PanelAccessPage = React$1.lazy(() => __vitePreload(() => import('./PanelAccessPage.knmRIi_t.js').then(n => n.P),true?__vite__mapDeps([24,3,2,5,25,1,7,26,27,28,22]):void 0));
React$1.lazy(() => __vitePreload(() => import('./PushDiagnosi.Cgtqc7rg.js'),true?__vite__mapDeps([29,1,2,3,5,6,7,8,9]):void 0));
const PanelUsersPage = React$1.lazy(() => __vitePreload(() => import('./PanelUsersPage.UHzW9p_9.js'),true?__vite__mapDeps([30,3,2,25,1,6,5,7,8,9]):void 0));
const BulkMarkerDropPage = React$1.lazy(() => __vitePreload(() => import('./BulkMarkerDropPage.DK4pMuEz.js'),true?__vite__mapDeps([31,3,2,1,6,5,7,8,9]):void 0));
const MarkerRewardsPage = React$1.lazy(() => __vitePreload(() => import('./MarkerRewardsPage.D8UrjdBq.js'),true?__vite__mapDeps([32,3,2,26,1,6,5,7,8,9]):void 0));
const NorahAdmin = React$1.lazy(() => __vitePreload(() => import('./NorahAdmin.DSzOGn68.js'),true?__vite__mapDeps([33,3,2,1,18,34,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./DiagSupabase.D7b1Eaov.js'),true?__vite__mapDeps([35,3,2,1,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./SupabaseConnectionTest.CYMIAl3i.js'),true?__vite__mapDeps([36,3,2,1,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./PushTest.CgX_94cz.js'),true?__vite__mapDeps([37,3,2,1,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./PushDiagnostic.DEjtqH6P.js'),true?__vite__mapDeps([38,3,2,27,1,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./M1ssionPushTest.BUQxQa_N.js'),true?__vite__mapDeps([39,3,2,1,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./M1ssionDebugTest.D007Nbc4.js'),true?__vite__mapDeps([40,3,2,1,6,5,7,8,9]):void 0).then((m) => ({ default: m.M1ssionDebugTest })));
React$1.lazy(() => __vitePreload(() => import('./firebase-notification-debug.Bg93Ck0A.js'),true?__vite__mapDeps([41,3,2,42,1,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./PushHealth.BmSUR0iu.js'),true?__vite__mapDeps([43,3,2,27,1,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./PushDebug.CufkiEfE.js'),true?__vite__mapDeps([44,1,2,3,27,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./PushReport.CPy3iva0.js'),true?__vite__mapDeps([45,3,2,1,6,5,7,8,9]):void 0).then((m) => ({ default: m.PushReport })));
React$1.lazy(() => __vitePreload(() => import('./OnboardingSandbox.5XzuCPKZ.js'),true?__vite__mapDeps([46,3,2,5,18,34,1,6,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./FcmTest.vqpc-Dn7.js'),true?__vite__mapDeps([47,3,2,42,1,6,5,7,8,9]):void 0));
React$1.lazy(() => __vitePreload(() => import('./PushTest.BtYqnlCZ.js'),true?__vite__mapDeps([48,3,2,1,6,5,7,8,9]):void 0));
const WouterRoutes = () => {
  const { isAuthenticated, isLoading, getCurrentUser } = useUnifiedAuth();
  const [location, setLocation] = useLocation();
  const [hasActiveSub, setHasActiveSub] = reactExports.useState(null);
  const [subCheckLoading, setSubCheckLoading] = reactExports.useState(false);
  useQueryQRRedirect();
  reactExports.useEffect(() => {
    async function checkSubscription() {
      if (!isAuthenticated || isLoading) {
        setHasActiveSub(null);
        return;
      }
      const user = getCurrentUser();
      if (!user?.id) {
        setHasActiveSub(false);
        return;
      }
      setSubCheckLoading(true);
      const timeoutId = setTimeout(() => {
        setHasActiveSub(false);
        setSubCheckLoading(false);
      }, 3e3);
      try {
        const subResult = await getActiveSubscription(supabase, user.id);
        clearTimeout(timeoutId);
        setHasActiveSub(subResult.hasActive);
        const { data: profile } = await supabase.from("profiles").select("role, choose_plan_seen").eq("id", user.id).single();
        const isAdmin = ["admin", "owner"].some((r) => profile?.role?.toLowerCase?.().includes(r));
        if (!isAdmin && !subResult.hasActive && !profile?.choose_plan_seen && location === "/") {
          setLocation("/choose-plan");
          return;
        }
        const initialRoutes = ["/", "/login", "/mission-intro", "/subscription-verify"];
        if (subResult.plan === "free" && initialRoutes.includes(location)) {
          setLocation("/home");
          return;
        }
      } catch (error) {
        clearTimeout(timeoutId);
        setHasActiveSub(false);
      } finally {
        setSubCheckLoading(false);
      }
    }
    checkSubscription();
  }, [isAuthenticated, isLoading, getCurrentUser, location, setLocation]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(ErrorBoundary$1, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IOSSafeAreaOverlay, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Switch$1, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }) : !isAuthenticated ? (() => {
      try {
        const isFirstVisit = !localStorage.getItem("m1_first_visit_seen");
        if (isFirstVisit) {
          localStorage.setItem("m1_first_visit_seen", "1");
          return /* @__PURE__ */ jsxRuntimeExports.jsx(LandingPage, {});
        } else {
          return /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {});
        }
      } catch (error) {
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {});
      }
    })() : /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(GlobalLayout, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(AppHome, {}),
      subCheckLoading && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed top-4 right-4 bg-background/80 backdrop-blur-sm border rounded-lg p-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Verifica piano..." }) })
    ] }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/landing", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LandingPage, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/home", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AppHome, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/map-3d-tiler", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "map" }), children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./MapTiler3D.B7HciP6X.js'),true?__vite__mapDeps([4,3,2,5,1,6,7,8,9,10]):void 0))) }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/buzz-map", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "map" }), children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./MapTiler3D.B7HciP6X.js'),true?__vite__mapDeps([4,3,2,5,1,6,7,8,9,10]):void 0))) }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/living-map-3d", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(LivingMap3D, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/buzz", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BuzzPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligencePage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/rag", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligenceRAG, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/answer-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligenceAnswerTest, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/norah-assistant", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(NorahAssistant, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/battle", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleLobby, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/battle/:battleId", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleArena, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/battle-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleTest, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/coordinates", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Coordinate Selector" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CoordinateSelector, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/clue-journal", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Clue Journal" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ClueJournal, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/archive", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Archivio Indizi" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ClueArchive, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/radar", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Geo Radar" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(GeoRadarTool, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/interceptor", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "BUZZ Interceptor" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(BuzzInterceptor, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/final-shot", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Final Shot" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(FinalShotPage, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/rag", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligenceRAG, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/leaderboard", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(LeaderboardPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/winners", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(HallOfWinners, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/notifications", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Notifications, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/profile", children: () => {
      if (typeof window !== "undefined") {
        window.location.href = "/settings/agent-profile";
      }
      return null;
    } }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SettingsPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/dna", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DNAPage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/agent-profile", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AgentProfileSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/profile", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AgentProfileSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/security", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SecuritySettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/mission", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(MissionSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/notifications", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(NotificationsSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/privacy", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PrivacySettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/legal", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(LegalSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/app-info", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AppInfoSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/info", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AppInfoSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/diagnostics", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DiagnosticsSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/privacy-permissions", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PrivacyPermissionsSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Subscriptions, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions/silver", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SilverPlanPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions/gold", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GoldPlanPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions/black", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BlackPlanPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions/titanium", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(TitaniumPlanPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/admin/send-notification", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(SendNotificationPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/admin/mission-panel", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(MissionPanelPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/admin/pulse-lab", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(PulseLab, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminPushConsolePage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push-sender", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushSenderPanel, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push-admin", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./AdminPushConsolePage.CK-M87o9.js'),true?__vite__mapDeps([19,3,2,20,18,1,6,5,7,8,9]):void 0))) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./UserPushConsolePage.CQVyVR5R.js'),true?__vite__mapDeps([49,3,2,28,20,18,1,6,5,7,8,9]):void 0))) }) }) }),
    IS_DEV,
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel-access", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PanelAccessPage, {}) }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel-users", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(PanelUsersPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/bulk-marker-drop", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(BulkMarkerDropPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/marker-rewards", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(MarkerRewardsPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/norah", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(NorahAdmin, {}) }) }) }),
    IS_DEV,
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push-control", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PanelAccessPage, {}) }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push-preflight", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PanelAccessPage, {}) }) }) }) }),
    IS_DEV,
    IS_DEV,
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/terms", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(TermsConditions, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/terms-conditions", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(TermsConditions, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/privacy-policy", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PrivacyPolicyComplete, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/cookie-policy", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CookiePolicyComplete, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/safecreative", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SafeCreative, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/game-rules", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GameRulesComplete, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/policies", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Policies, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/game-policies", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Policies, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/game-policies-it", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GamePoliciesIt, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/contact", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Contact, {}) }) }),
    IS_DEV,
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/choose-plan", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }) : isAuthenticated ? /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChoosePlanPage, {}) }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscription-verify", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }) : isAuthenticated ? /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionVerify, {}) : /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/mission-intro", children: /* @__PURE__ */ jsxRuntimeExports.jsx(MissionIntroPage, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/login", component: Login }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/register", component: Register }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/auth/reset", component: ResetPasswordPage }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold mb-4", children: "404 - Pagina non trovata" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("button", { onClick: () => window.location.href = "/home", children: "Torna alla Home" })
    ] }) }) }) })
  ] }) }) });
};

const setupProductionLogging = () => {
  if (typeof window !== "undefined" && true) {
    const originalLog = console.log;
    const originalWarn = console.warn;
    const originalError = console.error;
    console.log = (...args) => {
      if (args[0]?.includes("CRITICAL") || args[0]?.includes("SECURITY")) {
        originalLog.apply(console, args);
      }
    };
    console.warn = originalWarn;
    console.error = originalError;
    console.debug = () => {
    };
    console.info = () => {
    };
    console.trace = () => {
    };
  }
};
const safeLog = (...args) => {
  if (args[0]?.includes("CRITICAL") || args[0]?.includes("SECURITY")) ;
};
const isProductionReady = () => {
  const checks = {
    serviceWorker: "serviceWorker" in navigator,
    webPush: "PushManager" in window,
    notifications: "Notification" in window,
    localStorage: typeof Storage !== "undefined"
  };
  const ready = Object.values(checks).every(Boolean);
  return ready;
};

const ProductionSafety = ({ children }) => {
  reactExports.useEffect(() => {
    const isReady = isProductionReady();
    if (!isReady) ; else {
      safeLog(" M1SSION Production Ready - By Joseph Mul / NIYVORA KFT");
    }
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
};

const ProductionSafetyWrapper = ({ children }) => {
  reactExports.useEffect(() => {
    {
      window.__M1_NO_SHIM_DUMP__ = true;
      window.__M1_PROD_MODE__ = true;
      const removeDebugContent = () => {
        const walker = document.createTreeWalker(
          document.body,
          NodeFilter.SHOW_TEXT,
          {
            acceptNode: (node2) => {
              const text = node2.textContent || "";
              if (text.includes("Stripe Shim Globale") || text.includes("window.getStripe") || text.includes("STRIPE_PK") || text.includes("stripeFallback")) {
                return NodeFilter.FILTER_ACCEPT;
              }
              return NodeFilter.FILTER_REJECT;
            }
          }
        );
        const nodesToRemove = [];
        let node;
        while (node = walker.nextNode()) {
          nodesToRemove.push(node);
        }
        nodesToRemove.forEach((node2) => {
          const parent = node2.parentNode;
          if (parent && parent.nodeType === Node.ELEMENT_NODE) {
            const element = parent;
            if (element.textContent?.includes("Stripe Shim Globale")) {
              element.style.display = "none";
            } else {
              parent.removeChild(node2);
            }
          }
        });
      };
      removeDebugContent();
      const observer = new MutationObserver(() => {
        removeDebugContent();
      });
      observer.observe(document.body, {
        childList: true,
        subtree: true,
        characterData: true
      });
      return () => observer.disconnect();
    }
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
};

const InstallPrompt = () => {
  const [deferredPrompt, setDeferredPrompt] = reactExports.useState(null);
  const [showPrompt, setShowPrompt] = reactExports.useState(false);
  const [isIOS, setIsIOS] = reactExports.useState(false);
  const [isStandalone, setIsStandalone] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const iOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    setIsIOS(iOS);
    const standalone = window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
    setIsStandalone(standalone);
    const handleBeforeInstallPrompt = (e) => {
      e.preventDefault();
      setDeferredPrompt(e);
      if (!standalone) {
        setShowPrompt(true);
      }
    };
    window.addEventListener("beforeinstallprompt", handleBeforeInstallPrompt);
    if (iOS && !standalone) {
      const timer = setTimeout(() => {
        const dismissed = localStorage.getItem("ios-install-dismissed");
        if (!dismissed) {
          setShowPrompt(true);
        }
      }, 3e3);
      return () => clearTimeout(timer);
    }
    return () => {
      window.removeEventListener("beforeinstallprompt", handleBeforeInstallPrompt);
    };
  }, []);
  const handleInstallClick = async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === "accepted") {
        setDeferredPrompt(null);
        setShowPrompt(false);
      }
    }
  };
  const handleDismiss = () => {
    setShowPrompt(false);
    if (isIOS) {
      localStorage.setItem("ios-install-dismissed", "true");
    }
  };
  if (isStandalone || !showPrompt) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bottom-20 left-4 right-4 z-50 animate-fade-in", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card p-4 border border-primary/20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-lg bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-5 h-5 text-white" }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white text-sm mb-1", children: "Installa M1SSION" }),
      isIOS ? /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-gray-300 mb-3", children: [
        "Tocca ",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "inline-block w-4 h-4 mx-1 align-middle", children: /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { viewBox: "0 0 24 24", fill: "currentColor", className: "w-full h-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" }) }) }),
        ' in Safari, poi "Aggiungi alla schermata Home"'
      ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-300 mb-3", children: "Installa l'app per un'esperienza ottimale" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        !isIOS && deferredPrompt && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: handleInstallClick,
            size: "sm",
            className: "flex-1 bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink text-white",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Download, { className: "w-4 h-4 mr-2" }),
              "Installa"
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleDismiss,
            variant: "ghost",
            size: "sm",
            className: "text-gray-400 hover:text-white",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-4 h-4" })
          }
        )
      ] })
    ] })
  ] }) }) });
};

const usePushNotificationLogger = () => {
  const { user } = useAuth();
  const logPushEvent = reactExports.useCallback(async (params) => {
    try {
      const {
        eventType,
        token,
        platform,
        deviceInfo,
        success = true,
        errorMessage
      } = params;
      const enhancedDeviceInfo = {
        userAgent: navigator.userAgent,
        isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
        isPWA: window.navigator.standalone === true,
        hostname: window.location.hostname,
        protocol: window.location.protocol,
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        ...deviceInfo
      };
      const { error: pushLogError } = await supabase.from("push_notifications_log").insert({
        user_id: user?.id || null,
        event_type: eventType,
        token: token?.substring(0, 50) || null,
        // Truncate for security
        platform: platform || (enhancedDeviceInfo.isIOS ? "ios_pwa" : "web_pwa"),
        device_info: enhancedDeviceInfo,
        success,
        error_message: errorMessage
      });
      if (pushLogError) {
      }
      const { error: adminLogError } = await supabase.from("admin_logs").insert({
        event_type: `push_${eventType}`,
        user_id: user?.id || null,
        note: `M1SSION Push: ${eventType}`,
        context: "push_notifications",
        details: {
          token: token?.substring(0, 20) + "..." || null,
          platform,
          success,
          errorMessage,
          deviceInfo: enhancedDeviceInfo
        }
      });
      if (adminLogError) {
      }
    } catch (error) {
    }
  }, [user]);
  const logTokenRegistered = reactExports.useCallback((token, platform) => {
    return logPushEvent({
      eventType: "token_registered",
      token,
      platform,
      success: true
    });
  }, [logPushEvent]);
  const logTokenRegistrationFailed = reactExports.useCallback((errorMessage, platform) => {
    return logPushEvent({
      eventType: "token_registration_failed",
      platform,
      success: false,
      errorMessage
    });
  }, [logPushEvent]);
  const logPermissionRequested = reactExports.useCallback((platform) => {
    return logPushEvent({
      eventType: "permission_requested",
      platform,
      success: true
    });
  }, [logPushEvent]);
  const logPermissionGranted = reactExports.useCallback((platform) => {
    return logPushEvent({
      eventType: "permission_granted",
      platform,
      success: true
    });
  }, [logPushEvent]);
  const logPermissionDenied = reactExports.useCallback((platform) => {
    return logPushEvent({
      eventType: "permission_denied",
      platform,
      success: false
    });
  }, [logPushEvent]);
  const logInitializationSuccess = reactExports.useCallback((platform) => {
    return logPushEvent({
      eventType: "initialization_success",
      platform,
      success: true
    });
  }, [logPushEvent]);
  const logInitializationFailed = reactExports.useCallback((errorMessage, platform) => {
    return logPushEvent({
      eventType: "initialization_failed",
      platform,
      success: false,
      errorMessage
    });
  }, [logPushEvent]);
  return {
    logPushEvent,
    logTokenRegistered,
    logTokenRegistrationFailed,
    logPermissionRequested,
    logPermissionGranted,
    logPermissionDenied,
    logInitializationSuccess,
    logInitializationFailed
  };
};

const IOSPermissionManager = ({
  show = false,
  onPermissionGranted,
  onPermissionDenied
}) => {
  const [isVisible, setIsVisible] = reactExports.useState(false);
  const [permissionState, setPermissionState] = reactExports.useState("default");
  const [isRequestingPermission, setIsRequestingPermission] = reactExports.useState(false);
  const [hasRequestedOnce, setHasRequestedOnce] = reactExports.useState(false);
  const { logPermissionRequested, logPermissionGranted, logPermissionDenied } = usePushNotificationLogger();
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isPWA = window.navigator.standalone === true;
  const isSafariIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && /Safari/.test(navigator.userAgent) && !/CriOS/.test(navigator.userAgent);
  const shouldShow$1 = reactExports.useCallback(() => {
    const canShowByFrequency = shouldShow("ios-permission", 24);
    return show || isIOS && isPWA && permissionState === "default" && !hasRequestedOnce && canShowByFrequency && typeof window !== "undefined" && "Notification" in window;
  }, [show, isIOS, isPWA, permissionState, hasRequestedOnce]);
  reactExports.useEffect(() => {
    if (typeof window !== "undefined") {
      if ("Notification" in window) {
        setPermissionState(Notification.permission);
      }
      const timer = setTimeout(() => {
        const shouldShowNow = shouldShow$1();
        setIsVisible(shouldShowNow);
        if (shouldShowNow) {
          markShown("ios-permission");
        }
      }, 200);
      return () => clearTimeout(timer);
    }
  }, [shouldShow$1]);
  const requestPermission = reactExports.useCallback(async () => {
    if (isRequestingPermission || hasRequestedOnce) {
      return;
    }
    if (localStorage.getItem("push:disable") === "1") {
      setIsVisible(false);
      return;
    }
    setIsRequestingPermission(true);
    setHasRequestedOnce(true);
    try {
      await logPermissionRequested(isIOS ? "ios_pwa" : "web_pwa");
      let permission;
      if (isIOS && isPWA && isSafariIOS) {
        if (window.M1SSIONOneSignalDebug) {
          try {
            const result = await window.M1SSIONOneSignalDebug.forceRequestPermission();
            permission = result ? "granted" : "denied";
          } catch (error) {
            permission = await Notification.requestPermission();
          }
        } else {
          permission = await Notification.requestPermission();
        }
      } else {
        permission = await Notification.requestPermission();
      }
      setPermissionState(permission);
      if (permission === "granted") {
        await logPermissionGranted(isIOS ? "ios_pwa" : "web_pwa");
        ue.success(" Notifiche attivate!", {
          description: "Riceverai aggiornamenti importanti per M1SSION"
        });
        onPermissionGranted?.();
        setIsVisible(false);
      } else {
        await logPermissionDenied(isIOS ? "ios_pwa" : "web_pwa");
        ue.error(" Permessi notifiche negati", {
          description: isIOS ? "Puoi abilitarli in Impostazioni > Safari > Notifiche" : "Puoi abilitarli nelle impostazioni del browser"
        });
        onPermissionDenied?.();
      }
    } catch (error) {
      ue.error(" Errore richiesta permessi notifiche");
      await logPermissionDenied(isIOS ? "ios_pwa" : "web_pwa");
      onPermissionDenied?.();
    } finally {
      setIsRequestingPermission(false);
    }
  }, [
    isRequestingPermission,
    hasRequestedOnce,
    isIOS,
    isPWA,
    isSafariIOS,
    logPermissionRequested,
    logPermissionGranted,
    logPermissionDenied,
    onPermissionGranted,
    onPermissionDenied
  ]);
  if (!isVisible || permissionState === "granted" || !isIOS) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "fixed bottom-4 right-4 w-80 z-50 border-2 border-primary shadow-lg", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-sm flex items-center justify-between", children: [
      " Notifiche Push",
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "ghost",
          size: "sm",
          onClick: () => setIsVisible(false),
          className: "h-6 w-6 p-0",
          children: ""
        }
      )
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Abilita le notifiche push per ricevere aggiornamenti importanti su M1SSION" }),
      permissionState === "denied" && hasRequestedOnce && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-red-600 bg-red-50 p-2 rounded", children: [
        "Permessi negati. Vai in ",
        /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Impostazioni Safari > Notifiche siti web" }),
        " per abilitarli."
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: requestPermission,
            disabled: isRequestingPermission,
            className: "w-full",
            variant: "default",
            children: isRequestingPermission ? " Richiesta in corso..." : " Abilita Notifiche"
          }
        ),
        hasRequestedOnce && permissionState === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: () => setIsVisible(false),
            variant: "outline",
            className: "w-full",
            size: "sm",
            children: "Continua senza notifiche"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: isIOS && isPWA ? " iOS PWA Mode" : " Web Mode" })
    ] })
  ] });
};

const useAndroidPushNotifications = () => {
  const [state, setState] = reactExports.useState({
    isSupported: false,
    isRegistered: false,
    token: null,
    permission: null,
    isLoading: false,
    error: null
  });
  const isAndroid = /Android/i.test(navigator.userAgent);
  reactExports.useEffect(() => {
    const initializePWAPush = async () => {
      const isSupported = "serviceWorker" in navigator && "PushManager" in window;
      setState((prev) => ({ ...prev, isSupported }));
      if (!isSupported) {
        return;
      }
      setState((prev) => ({ ...prev, isLoading: true }));
      try {
        const permission = await Notification.requestPermission();
        setState((prev) => ({
          ...prev,
          permission,
          isLoading: false
        }));
      } catch (error) {
        setState((prev) => ({
          ...prev,
          error: error.message,
          isLoading: false
        }));
      }
    };
    initializePWAPush();
  }, []);
  const requestPermissionAndRegister = async () => {
    if (!state.isSupported) {
      ue.error(" Push notifications not supported");
      return false;
    }
    setState((prev) => ({ ...prev, isLoading: true }));
    try {
      const permission = await Notification.requestPermission();
      setState((prev) => ({
        ...prev,
        permission
      }));
      if (permission === "granted") {
        const registration = await navigator.serviceWorker.ready;
        const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await __vitePreload(async () => { const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await import('./vapid-loader.Dvqe_4zt.js');return { loadVAPIDPublicKey, urlBase64ToUint8Array }},true?[]:void 0);
        const vapidKey = await loadVAPIDPublicKey();
        if (!vapidKey) {
          throw new Error("VAPID public key not configured");
        }
        const vapidKeyArray = urlBase64ToUint8Array(vapidKey);
        const subscription = await registration.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: vapidKeyArray
        });
        await saveSubscriptionToSupabase(subscription);
        setState((prev) => ({
          ...prev,
          isRegistered: true,
          token: JSON.stringify(subscription),
          isLoading: false
        }));
        ue.success(" Push notifications enabled!");
        return true;
      } else {
        ue.error(" Push notification permission denied");
        setState((prev) => ({ ...prev, isLoading: false }));
        return false;
      }
    } catch (error) {
      setState((prev) => ({
        ...prev,
        error: error.message,
        isLoading: false
      }));
      ue.error(" Error enabling push notifications");
      return false;
    }
  };
  const saveSubscriptionToSupabase = async (subscription) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      const { error } = await supabase.from("push_tokens").upsert({
        user_id: user.id,
        token: JSON.stringify(subscription),
        platform: isAndroid ? "android" : "web",
        endpoint_type: "web_push",
        device_info: {
          platform: "web",
          userAgent: navigator.userAgent,
          endpoint: subscription.endpoint
        },
        created_at: (/* @__PURE__ */ new Date()).toISOString(),
        updated_at: (/* @__PURE__ */ new Date()).toISOString(),
        last_used_at: (/* @__PURE__ */ new Date()).toISOString()
      });
      if (error) {
      } else {
      }
    } catch (error) {
    }
  };
  return {
    ...state,
    isAndroid,
    requestPermissionAndRegister
  };
};

const AndroidPushSetup = ({ className }) => {
  const {
    isSupported,
    isAndroid,
    isRegistered,
    token,
    permission,
    isLoading,
    error,
    requestPermissionAndRegister
  } = useAndroidPushNotifications();
  if (!isAndroid || !isSupported) {
    return null;
  }
  const getStatusIcon = () => {
    if (isRegistered && token) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-5 h-5 text-green-400" });
    }
    if (error) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-5 h-5 text-red-400" });
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5 text-m1ssion-blue" });
  };
  const getStatusText = () => {
    if (isRegistered && token) {
      return "Notifiche Android Attive";
    }
    if (permission === "denied") {
      return "Permessi Negati";
    }
    if (error) {
      return "Errore Configurazione";
    }
    if (permission === "granted" && !isRegistered) {
      return "Registrazione in corso...";
    }
    return "Attiva Notifiche Android";
  };
  const getStatusDescription = () => {
    if (isRegistered && token) {
      return "Riceverai notifiche push native su Android";
    }
    if (permission === "denied") {
      return "Vai nelle impostazioni per abilitare le notifiche";
    }
    if (error) {
      return error;
    }
    return "Abilita le notifiche push per ricevere aggiornamenti M1SSION";
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `glass-card p-6 ${className}`, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-6 h-6 text-m1ssion-blue" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-bold text-white", children: "Notifiche Push Android" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3 mb-4", children: [
      getStatusIcon(),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium text-white mb-1", children: getStatusText() }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-300", children: getStatusDescription() })
      ] })
    ] }),
    !isRegistered && permission !== "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        onClick: requestPermissionAndRegister,
        disabled: isLoading,
        className: "w-full bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink text-white",
        children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" }),
          "Configurazione..."
        ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4" }),
          "Attiva Notifiche"
        ] })
      }
    ),
    permission === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-3 p-3 bg-red-500/20 border border-red-500/30 rounded-md", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-red-300", children: " Vai in Impostazioni  App  M1SSION  Notifiche per abilitarle manualmente" }) }),
    token && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-3 p-3 bg-green-500/20 border border-green-500/30 rounded-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-green-300", children: [
      " Token: ",
      token.substring(0, 20),
      "..."
    ] }) })
  ] });
};

const useIOSPushNotifications = () => {
  const [state, setState] = reactExports.useState({
    isSupported: false,
    isRegistered: false,
    token: null,
    permission: null,
    isLoading: false,
    error: null
  });
  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
  reactExports.useEffect(() => {
    if (typeof window !== "undefined") {
      setState((prev) => ({ ...prev, isSupported: false }));
    }
  }, []);
  const requestPermissionAndRegister = async () => {
    if (!isIOS) {
      ue.error("Notifiche push disponibili solo su iOS");
      return false;
    }
    setState((prev) => ({ ...prev, isLoading: true }));
    try {
      const permResult = await PushNotifications.requestPermissions();
      setState((prev) => ({
        ...prev,
        permission: permResult.receive
      }));
      if (permResult.receive === "granted") {
        await PushNotifications.register();
        ue.success(" Notifiche push iOS attivate!");
        return true;
      } else {
        ue.error(" Permessi notifiche negati");
        setState((prev) => ({ ...prev, isLoading: false }));
        return false;
      }
    } catch (error) {
      setState((prev) => ({
        ...prev,
        error: error.message,
        isLoading: false
      }));
      ue.error("Errore richiesta permessi iOS");
      return false;
    }
  };
  return {
    ...state,
    isIOS,
    requestPermissionAndRegister
  };
};

const useNativePushNotifications = () => {
  const platform = /iPhone|iPad|iPod/i.test(navigator.userAgent) ? "ios" : /Android/i.test(navigator.userAgent) ? "android" : "web";
  const androidPush = useAndroidPushNotifications();
  const iosPush = useIOSPushNotifications();
  const [unifiedState, setUnifiedState] = reactExports.useState({
    isSupported: false,
    isRegistered: false,
    token: null,
    permission: null,
    isLoading: false,
    error: null,
    platform
  });
  reactExports.useEffect(() => {
    if (platform === "android") {
      setUnifiedState({
        isSupported: androidPush.isSupported,
        isRegistered: androidPush.isRegistered,
        token: androidPush.token,
        permission: androidPush.permission === "default" ? "prompt" : androidPush.permission,
        isLoading: androidPush.isLoading,
        error: androidPush.error,
        platform: "android"
      });
    } else if (platform === "ios") {
      setUnifiedState({
        isSupported: iosPush.isSupported,
        isRegistered: iosPush.isRegistered,
        token: iosPush.token,
        permission: iosPush.permission,
        isLoading: iosPush.isLoading,
        error: iosPush.error,
        platform: "ios"
      });
    } else {
      setUnifiedState({
        isSupported: "serviceWorker" in navigator && "PushManager" in window,
        isRegistered: false,
        token: null,
        permission: null,
        isLoading: false,
        error: null,
        platform: "web"
      });
    }
  }, [
    platform,
    // Only depend on primitive values to prevent infinite loops
    androidPush.isSupported,
    androidPush.isRegistered,
    androidPush.token,
    androidPush.permission,
    androidPush.isLoading,
    androidPush.error,
    iosPush.isSupported,
    iosPush.isRegistered,
    iosPush.token,
    iosPush.permission,
    iosPush.isLoading,
    iosPush.error
  ]);
  const requestPermissionAndRegister = async () => {
    if (platform === "android") {
      return await androidPush.requestPermissionAndRegister();
    } else if (platform === "ios") {
      return await iosPush.requestPermissionAndRegister();
    }
    return false;
  };
  return {
    ...unifiedState,
    requestPermissionAndRegister,
    // Platform specific data
    android: androidPush,
    ios: iosPush
  };
};

const PushNotificationSetup = ({ className }) => {
  const {
    isSupported,
    isRegistered,
    token,
    permission,
    isLoading,
    error,
    platform,
    requestPermissionAndRegister
  } = useNativePushNotifications();
  if (platform === "web" || !isSupported) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5" }),
        "Notifiche Push"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Le notifiche push native sono disponibili solo su dispositivi mobili" })
    ] }) });
  }
  const getPlatformIcon = () => {
    if (platform === "ios") return /* @__PURE__ */ jsxRuntimeExports.jsx(Apple, { className: "w-4 h-4" });
    if (platform === "android") return /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-4 h-4" });
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4" });
  };
  const getPlatformLabel = () => {
    if (platform === "ios") return "iOS";
    if (platform === "android") return "Android";
    return "Mobile";
  };
  const getStatusColor = () => {
    if (isRegistered) return "bg-green-500";
    if (permission === "denied") return "bg-red-500";
    if (permission === "granted") return "bg-yellow-500";
    return "bg-muted";
  };
  const getStatusText = () => {
    if (isRegistered) return "Attive";
    if (permission === "denied") return "Negati";
    if (permission === "granted") return "In corso...";
    return "Non configurate";
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5" }),
        "Notifiche Push Native",
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", className: "ml-auto", children: [
          getPlatformIcon(),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "ml-1", children: getPlatformLabel() })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Ricevi notifiche push native per aggiornamenti importanti della missione" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-3 bg-muted/50 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${getStatusColor()}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-medium", children: [
            "Stato: ",
            getStatusText()
          ] })
        ] }),
        isRegistered && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-green-500" })
      ] }),
      token && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-muted/30 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground", children: [
        "Token: ",
        token.substring(0, 20),
        "..."
      ] }) }),
      error && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 p-3 bg-destructive/10 text-destructive rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: error })
      ] }),
      permission === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-orange-50 border border-orange-200 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-orange-800", children: "I permessi per le notifiche sono stati negati. Per attivarle, vai nelle impostazioni del dispositivo e abilita le notifiche per M1SSION." }) }),
      !isRegistered && permission !== "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: requestPermissionAndRegister,
          disabled: isLoading,
          className: "w-full",
          children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2" }),
            "Configurazione..."
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4 mr-2" }),
            "Attiva Notifiche Push"
          ] })
        }
      ),
      isRegistered && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-green-600" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-green-800", children: [
          " Notifiche push ",
          getPlatformLabel(),
          " configurate correttamente!"
        ] })
      ] })
    ] })
  ] });
};

async function runPWACleanupOnce() {
  const CLEANUP_KEY = "m1_pwa_fix_v20250904";
  if (localStorage.getItem(CLEANUP_KEY)) {
    return;
  }
  try {
    if ("serviceWorker" in navigator) {
      const registrations = await navigator.serviceWorker.getRegistrations();
      for (const registration of registrations) {
        const swUrl = registration.scope || registration.installing?.scriptURL || registration.waiting?.scriptURL || registration.active?.scriptURL;
        if (swUrl && !swUrl.includes("/sw.js")) {
          await registration.unregister();
        }
      }
    }
    if ("caches" in window) {
      const cacheNames = await caches.keys();
      const oldCaches = cacheNames.filter(
        (name) => name.includes("onesignal") || name.includes("firebase") || name.includes("workbox") || name.startsWith("runtime-")
      );
      for (const cacheName of oldCaches) {
        await caches.delete(cacheName);
      }
    }
    const keysToRemove = [
      "OneSignal-notificationClicked",
      "OneSignal-isOptedOut",
      "OneSignal-subscription",
      "OneSignal-sessionCount",
      "onesignal-pageview-count",
      "OneSignalSDKUpdaterWorker.js",
      "OneSignalSDKWorker.js"
    ];
    keysToRemove.forEach((key) => {
      if (localStorage.getItem(key)) {
        localStorage.removeItem(key);
      }
    });
    const sessionKeys = Object.keys(sessionStorage);
    sessionKeys.forEach((key) => {
      if (key.includes("OneSignal") || key.includes("onesignal")) {
        sessionStorage.removeItem(key);
      }
    });
    localStorage.setItem(CLEANUP_KEY, "1");
  } catch (error) {
    localStorage.setItem(CLEANUP_KEY, "1");
  }
}

async function registerPush(reg) {
  if (!reg?.pushManager) {
    throw new Error("PushManager non disponibile");
  }
  const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await __vitePreload(async () => { const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await import('./vapid-loader.Dvqe_4zt.js');return { loadVAPIDPublicKey, urlBase64ToUint8Array }},true?[]:void 0);
  const publicKey = await loadVAPIDPublicKey();
  const applicationServerKey = typeof publicKey === "string" ? urlBase64ToUint8Array(publicKey) : publicKey;
  let subscription = await reg.pushManager.getSubscription();
  if (!subscription) {
    subscription = await reg.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey
    });
  }
  await saveSubscriptionToDatabase(subscription);
  return subscription;
}
async function saveSubscriptionToDatabase(subscription) {
  try {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session?.user?.id) {
      return;
    }
    const payload = subscription.toJSON();
    if (!payload.endpoint || !payload.keys) {
      return;
    }
    const { data: existing } = await supabase.from("webpush_subscriptions").select("id").eq("user_id", session.user.id).eq("endpoint", payload.endpoint).maybeSingle();
    if (existing) {
      const { error } = await supabase.from("webpush_subscriptions").update({ keys: payload.keys, is_active: true }).eq("id", existing.id);
      if (error) {
      } else {
      }
    } else {
      const { error } = await supabase.from("webpush_subscriptions").insert({
        user_id: session.user.id,
        endpoint: payload.endpoint,
        keys: payload.keys,
        is_active: true
      });
      if (error) {
      } else {
      }
    }
  } catch (err) {
  }
}

const usePWAStabilizer = () => {
  const { user } = useAuth();
  reactExports.useEffect(() => {
    const initializePWA = async () => {
      try {
        await runPWACleanupOnce();
        if ("serviceWorker" in navigator) {
          try {
            const registration = await navigator.serviceWorker.register("/sw.js", {
              scope: "/",
              updateViaCache: "none"
            });
          } catch (swError) {
          }
        }
        if (user && Notification.permission === "granted") {
          try {
            const reg = await navigator.serviceWorker.ready;
            const result = await registerPush(reg);
            if (result) {
            }
          } catch (error) {
          }
        }
      } catch (error) {
      }
    };
    initializePWA();
  }, [user]);
};

async function syncExistingSubscription() {
  try {
    if (!("serviceWorker" in navigator) || !("PushManager" in window)) {
      return false;
    }
    const { data: { session } } = await supabase.auth.getSession();
    if (!session?.user?.id) {
      return false;
    }
    const registration = await navigator.serviceWorker.getRegistration("/");
    if (!registration?.active) {
      return false;
    }
    const subscription = await registration.pushManager.getSubscription();
    if (!subscription) {
      return false;
    }
    const payload = subscription.toJSON();
    if (!payload.endpoint || !payload.keys) {
      return false;
    }
    const { data: existing } = await supabase.from("webpush_subscriptions").select("id, is_active").eq("user_id", session.user.id).eq("endpoint", payload.endpoint).maybeSingle();
    if (existing) {
      if (!existing.is_active) {
        await supabase.from("webpush_subscriptions").update({ is_active: true, keys: payload.keys }).eq("id", existing.id);
      }
    } else {
      await supabase.from("webpush_subscriptions").insert({
        user_id: session.user.id,
        endpoint: payload.endpoint,
        keys: payload.keys,
        is_active: true
      });
    }
    return true;
  } catch (error) {
    return false;
  }
}
function startServiceWorkerKeepAlive() {
  const KEEP_ALIVE_INTERVAL = 5 * 60 * 1e3;
  const keepAlive = async () => {
    try {
      if (!("serviceWorker" in navigator)) return;
      const registration = await navigator.serviceWorker.getRegistration("/");
      if (registration?.active) {
        registration.active.postMessage({ type: "KEEP_ALIVE", timestamp: Date.now() });
      }
    } catch {
    }
  };
  keepAlive();
  const intervalId = setInterval(keepAlive, KEEP_ALIVE_INTERVAL);
  return () => clearInterval(intervalId);
}

const usePushSync = () => {
  const { user } = useAuth();
  const lastUserId = reactExports.useRef(null);
  const keepAliveCleanup = reactExports.useRef(null);
  reactExports.useEffect(() => {
    if (!keepAliveCleanup.current) {
      keepAliveCleanup.current = startServiceWorkerKeepAlive();
    }
    return () => {
      if (keepAliveCleanup.current) {
        keepAliveCleanup.current();
        keepAliveCleanup.current = null;
      }
    };
  }, []);
  reactExports.useEffect(() => {
    const currentUserId = user?.id || null;
    if (currentUserId === lastUserId.current) {
      return;
    }
    lastUserId.current = currentUserId;
    if (currentUserId) {
      const timeoutId = setTimeout(async () => {
        await syncExistingSubscription();
      }, 2e3);
      return () => clearTimeout(timeoutId);
    }
  }, [user?.id]);
};

const ROUTE_TO_PAGE = {
  "/home": "home",
  "/map-3d-tiler": "map",
  "/buzz-map": "map",
  "/buzz": "buzz",
  "/intelligence": "intelligence",
  "/leaderboard": "leaderboard",
  "/notifications": "notifications"
};
const useActivityTracker = () => {
  const { user } = useAuth();
  const [location] = useLocation();
  const pageStartTime = reactExports.useRef(Date.now());
  const currentPage = reactExports.useRef(null);
  const lastLocationUpdate = reactExports.useRef(0);
  const flushPageTime = reactExports.useCallback(async () => {
    if (!user?.id || !currentPage.current) return;
    const timeSpent = Math.floor((Date.now() - pageStartTime.current) / 1e3);
    if (timeSpent < 3 || timeSpent > 1800) return;
    try {
      await supabase.rpc("update_user_activity", {
        p_user_id: user.id,
        p_page: currentPage.current,
        p_seconds: timeSpent
      });
    } catch {
    }
  }, [user?.id]);
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const page = ROUTE_TO_PAGE[location] || null;
    if (page !== currentPage.current) {
      flushPageTime();
      currentPage.current = page;
      pageStartTime.current = Date.now();
    }
  }, [location, user?.id, flushPageTime]);
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const updateLocation = async () => {
      const now = Date.now();
      if (now - lastLocationUpdate.current < 5 * 60 * 1e3) return;
      if (!("geolocation" in navigator)) return;
      try {
        const position = await new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(resolve, reject, {
            enableHighAccuracy: false,
            timeout: 5e3,
            maximumAge: 5 * 60 * 1e3
            // Cache 5 minuti
          });
        });
        lastLocationUpdate.current = now;
        await supabase.rpc("update_user_activity", {
          p_user_id: user.id,
          p_page: currentPage.current || "unknown",
          p_seconds: 0,
          p_lat: position.coords.latitude,
          p_lng: position.coords.longitude
        });
      } catch {
      }
    };
    updateLocation();
    const intervalId = setInterval(updateLocation, 5 * 60 * 1e3);
    return () => clearInterval(intervalId);
  }, [user?.id]);
  reactExports.useEffect(() => {
    const handleVisibilityChange = () => {
      if (document.visibilityState === "hidden") {
        flushPageTime();
      }
    };
    const handleBeforeUnload = () => {
      flushPageTime();
    };
    document.addEventListener("visibilitychange", handleVisibilityChange);
    window.addEventListener("beforeunload", handleBeforeUnload);
    return () => {
      document.removeEventListener("visibilitychange", handleVisibilityChange);
      window.removeEventListener("beforeunload", handleBeforeUnload);
      flushPageTime();
    };
  }, [flushPageTime]);
};

const useLegalConsent = () => {
  const { user } = useUnifiedAuth();
  const { toast } = useToast();
  const [state, setState] = reactExports.useState(() => {
    const saved = localStorage.getItem("m1ssion_legal_consent") === "true";
    return {
      isAccepted: saved,
      isLoading: false,
      needsConsent: !saved
    };
  });
  reactExports.useEffect(() => {
    checkLegalConsent();
  }, [user]);
  const checkLegalConsent = async () => {
    try {
      setState((prev) => ({ ...prev, isLoading: true }));
      const savedConsent = localStorage.getItem("m1ssion_legal_consent");
      const isAccepted = savedConsent === "true";
      setState({
        isAccepted,
        isLoading: false,
        needsConsent: !isAccepted
      });
    } catch (error) {
      setState({
        isAccepted: false,
        isLoading: false,
        needsConsent: true
      });
    }
  };
  const acceptLegalConsent = async () => {
    try {
      setState((prev) => ({ ...prev, isLoading: true }));
      localStorage.setItem("m1ssion_legal_consent", "true");
      localStorage.setItem("m1ssion_legal_consent_date", (/* @__PURE__ */ new Date()).toISOString());
      setState({
        isAccepted: true,
        isLoading: false,
        needsConsent: false
      });
      toast({
        title: " Legal Terms Accepted",
        description: "Welcome to M1SSION! Your skill-based adventure begins now."
      });
      return true;
    } catch (error) {
      setState((prev) => ({ ...prev, isLoading: false }));
      toast({
        title: " Error",
        description: "Unable to save consent. Please try again.",
        variant: "destructive"
      });
      return false;
    }
  };
  return {
    ...state,
    acceptLegalConsent,
    refreshConsent: checkLegalConsent
  };
};

const translations = {
  en: {
    title: "Legal Terms - M1SSION",
    description: "To play M1SSION, you must accept our Terms of Use. This is not a lottery or gambling game. It is a skill-based experience.",
    acceptButton: " I Accept",
    learnMore: "Learn More",
    skillBased: " Skill-Based Game - No Gambling"
  },
  fr: {
    title: "Conditions Lgales - M1SSION",
    description: "Pour jouer  M1SSION, vous devez accepter nos Conditions d'utilisation. Ce n'est pas un jeu de hasard, mais un jeu bas sur l'habilet.",
    acceptButton: " J'accepte",
    learnMore: "En savoir plus",
    skillBased: " Jeu d'Habilet - Pas de Jeu de Hasard"
  },
  es: {
    title: "Trminos Legales - M1SSION",
    description: "Para jugar a M1SSION, debes aceptar nuestros Trminos de uso. No es un juego de azar, sino un desafo de habilidad.",
    acceptButton: " Acepto",
    learnMore: "Saber ms",
    skillBased: " Juego de Habilidad - Sin Apuestas"
  },
  de: {
    title: "Rechtliche Bedingungen - M1SSION",
    description: "Um M1SSION zu spielen, musst du unsere Nutzungsbedingungen akzeptieren. Es handelt sich nicht um ein Glcksspiel, sondern um ein Geschicklichkeitsspiel.",
    acceptButton: " Ich akzeptiere",
    learnMore: "Mehr erfahren",
    skillBased: " Geschicklichkeitsspiel - Kein Glcksspiel"
  }
};
const LegalOnboarding = () => {
  const { needsConsent, isLoading, acceptLegalConsent } = useLegalConsent();
  const [currentLang, setCurrentLang] = reactExports.useState("en");
  const [accepting, setAccepting] = reactExports.useState(false);
  const [, setLocation] = useLocation();
  reactExports.useEffect(() => {
    const detectLanguage = () => {
      const browserLang = navigator.language.toLowerCase();
      if (browserLang.startsWith("fr")) return "fr";
      if (browserLang.startsWith("es")) return "es";
      if (browserLang.startsWith("de")) return "de";
      return "en";
    };
    setCurrentLang(detectLanguage());
  }, []);
  const handleAccept = async (e) => {
    e?.preventDefault?.();
    e?.stopPropagation?.();
    setAccepting(true);
    try {
      const success = await acceptLegalConsent();
      const saved = localStorage.getItem("m1ssion_legal_consent");
      if (success && saved === "true") {
        window.dispatchEvent(new Event("storage"));
      } else {
        ue.error("Errore nel salvataggio del consenso. Riprova.");
      }
    } catch (error) {
      ue.error("Errore. Riprova.");
    } finally {
      setAccepting(false);
    }
  };
  const handleLanguageChange = (lang) => {
    setCurrentLang(lang);
  };
  const openTerms = () => {
    setLocation("/terms");
  };
  if (isLoading) {
    return null;
  }
  if (!needsConsent) {
    return null;
  }
  const content = translations[currentLang];
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/80 backdrop-blur-md z-[10000] flex items-center justify-center p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { opacity: 0, scale: 0.9, y: 20 },
      animate: { opacity: 1, scale: 1, y: 0 },
      exit: { opacity: 0, scale: 0.9, y: 20 },
      className: "w-full max-w-lg",
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-gray-900/95 to-black/95 border-[#00D1FF]/30 shadow-2xl", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "pb-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center text-white text-lg", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-6 h-6 mr-3 text-[#00D1FF]" }),
              content.title
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-1", children: ["en", "fr", "es", "de"].map((lang) => /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => handleLanguageChange(lang),
                className: `px-2 py-1 text-xs rounded-md transition-all ${currentLang === lang ? "bg-[#00D1FF] text-black font-semibold" : "bg-white/10 text-white/70 hover:bg-white/20"}`,
                children: lang.toUpperCase()
              },
              lang
            )) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-500/30 rounded-full px-4 py-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-green-400 text-sm font-medium", children: content.skillBased }) }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/90 text-base leading-relaxed mb-6", children: content.description }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 gap-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-sm text-white/80", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 mr-3 text-green-400 flex-shrink-0" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Skill-based gameplay only" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-sm text-white/80", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 mr-3 text-green-400 flex-shrink-0" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "No gambling or random mechanics" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-sm text-white/80", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 mr-3 text-green-400 flex-shrink-0" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Fair play and transparency" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col space-y-3 pt-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleAccept,
                disabled: accepting,
                className: "w-full bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90 text-white font-semibold py-3",
                children: accepting ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2" }),
                  "Processing..."
                ] }) : content.acceptButton
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: () => {
                  openTerms();
                },
                variant: "outline",
                className: "w-full border-white/20 text-white hover:bg-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-4 h-4 mr-2" }),
                  content.learnMore
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center pt-4 border-t border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/50", children: " 2025 M1SSION  ALL RIGHTS RESERVED  NIYVORA KFT" }) })
        ] })
      ] })
    }
  ) }) });
};

function InterestSignalsProvider({ children }) {
  reactExports.useEffect(() => {
    let mounted = true;
    const initInterestTracking = async () => {
      try {
        const { useAutoInterestSignals } = await __vitePreload(async () => { const { useAutoInterestSignals } = await import('./useAutoInterestSignals.CeXJWyfH.js');return { useAutoInterestSignals }},true?__vite__mapDeps([50,2,51,1,3,6,5,7,8,9]):void 0);
        if (mounted && undefined                          === "1") ;
      } catch (error) {
      }
    };
    const timer = setTimeout(initInterestTracking, 1e3);
    return () => {
      mounted = false;
      clearTimeout(timer);
    };
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
}

const DNAModal = ({ isOpen, onComplete, onSkip }) => {
  const [step, setStep] = reactExports.useState(0);
  const [answers, setAnswers] = reactExports.useState({});
  const currentQuestion = DNA_QUESTIONS[step];
  const isLastQuestion = step === DNA_QUESTIONS.length - 1;
  const progress = (step + 1) / DNA_QUESTIONS.length * 100;
  const getCurrentScores = () => {
    const scores = getDefaultScores();
    Object.entries(answers).forEach(([questionId, value]) => {
      const question = DNA_QUESTIONS.find((q) => q.id === questionId);
      if (question) {
        scores[question.attribute] = value;
      }
    });
    return scores;
  };
  const currentScores = getCurrentScores();
  const currentArchetype = calculateArchetype(currentScores);
  const archetypeConfig = ARCHETYPE_CONFIGS[currentArchetype];
  const handleAnswer = (value) => {
    const newAnswers = { ...answers, [currentQuestion.id]: value };
    setAnswers(newAnswers);
    if (isLastQuestion) {
      const finalScores = getDefaultScores();
      DNA_QUESTIONS.forEach((q) => {
        if (newAnswers[q.id] !== void 0) {
          finalScores[q.attribute] = newAnswers[q.id];
        }
      });
      setTimeout(() => {
        onComplete(finalScores);
      }, 300);
    } else {
      setTimeout(() => {
        setStep(step + 1);
      }, 300);
    }
  };
  const handleSkip = () => {
    onSkip();
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: () => {
  }, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    DialogContent,
    {
      className: "max-w-2xl bg-black/95 border-2 border-cyan-500/30 backdrop-blur-xl",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(DialogHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, y: -20 },
            animate: { opacity: 1, y: 0 },
            className: "space-y-3",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-3xl font-black bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent", children: "M1SSION DNA" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white/60 font-normal", children: "Identit Evolutiva dell'Agente" })
            ]
          }
        ) }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: progress, className: "h-2 bg-white/10" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-white/50 text-center", children: [
            "Domanda ",
            step + 1,
            " di ",
            DNA_QUESTIONS.length
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, x: 20 },
            animate: { opacity: 1, x: 0 },
            exit: { opacity: 0, x: -20 },
            className: "space-y-6 py-4",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg text-white/90 font-medium mb-2", children: currentQuestion.question }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-xs text-cyan-400 border-cyan-400/30", children: currentQuestion.attribute.toUpperCase() })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: currentQuestion.options.map((option, idx) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.button,
                {
                  onClick: () => handleAnswer(option.value),
                  className: "w-full p-4 rounded-lg bg-white/5 border border-white/10 hover:border-cyan-400/50 hover:bg-cyan-500/10 transition-all text-left group",
                  whileHover: { scale: 1.02 },
                  whileTap: { scale: 0.98 },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/80 group-hover:text-white transition-colors", children: option.label })
                },
                idx
              )) })
            ]
          },
          currentQuestion.id
        ) }),
        Object.keys(answers).length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, scale: 0.9 },
            animate: { opacity: 1, scale: 1 },
            className: "mt-6 p-4 rounded-lg bg-gradient-to-r from-black/40 to-black/20 border border-white/10",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/50 mb-2 text-center", children: "Preview Archetipo" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-3xl", children: archetypeConfig.icon }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-bold text-white", children: archetypeConfig.nameIt }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/60", children: archetypeConfig.name })
                ] })
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-3 mt-6", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "outline",
            onClick: handleSkip,
            className: "flex-1 border-white/20 hover:bg-white/10",
            children: "Pi tardi"
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 rounded-lg pointer-events-none", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 rounded-lg bg-gradient-to-r from-cyan-500/20 via-blue-500/20 to-purple-600/20 opacity-0 animate-pulse" }) })
      ]
    }
  ) });
};

const DNAManager = () => {
  const { isAuthenticated } = useUnifiedAuth();
  const { needsOnboarding, isLoading, saveDNA, recordOnboardingShown, dnaProfile } = useDNA();
  reactExports.useEffect(() => {
    if (dnaProfile) {
      const config = ARCHETYPE_CONFIGS[dnaProfile.archetype];
      document.documentElement.style.setProperty("--dna-accent", config.accentVar);
    }
  }, [dnaProfile]);
  const handleComplete = async (scores) => {
    const success = await saveDNA(scores);
    if (success && dnaProfile) {
      const config = ARCHETYPE_CONFIGS[dnaProfile.archetype];
      ue.success("DNA calibrato con successo!", {
        description: `Sei un ${config.nameIt} ${config.icon}`
      });
    } else {
      ue.error("Errore durante il salvataggio del DNA");
    }
  };
  const handleSkip = () => {
    recordOnboardingShown();
    ue.info("Calibrazione DNA rimandata", {
      description: "Riapparir domani all'apertura dell'app"
    });
  };
  if (!isAuthenticated || isLoading || !needsOnboarding) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    DNAModal,
    {
      isOpen: needsOnboarding,
      onComplete: handleComplete,
      onSkip: handleSkip
    }
  );
};

const CookieBanner = ({
  isVisible,
  onAcceptAll,
  onRejectAll,
  onManagePreferences
}) => {
  const { t } = useTranslation();
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isVisible && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { y: 100, opacity: 0 },
      animate: { y: 0, opacity: 1 },
      exit: { y: 100, opacity: 0 },
      transition: { duration: 0.3, ease: "easeOut" },
      className: "fixed bottom-0 left-0 right-0 z-[60] pb-safe",
      role: "dialog",
      "aria-labelledby": "cookie-banner-title",
      "aria-describedby": "cookie-banner-description",
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "div",
        {
          className: "relative mx-4 mb-4 p-6 shadow-2xl overflow-hidden rounded-[24px]",
          style: {
            background: "rgba(0, 0, 0, 0.05)",
            backdropFilter: "blur(40px)",
            WebkitBackdropFilter: "blur(40px)",
            border: "1px solid rgba(255, 255, 255, 0.1)",
            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0 w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-6 h-6 text-primary" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "h3",
                    {
                      id: "cookie-banner-title",
                      className: "text-lg font-bold text-foreground mb-2",
                      children: t("cookie_banner_title")
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "p",
                    {
                      id: "cookie-banner-description",
                      className: "text-sm text-muted-foreground leading-relaxed",
                      children: t("cookie_banner_description")
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: onAcceptAll,
                      className: "min-h-[44px] touch-manipulation font-semibold",
                      "aria-label": t("cookie_accept_all"),
                      children: t("cookie_accept_all")
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: onRejectAll,
                      variant: "outline",
                      className: "min-h-[44px] touch-manipulation",
                      "aria-label": t("cookie_reject_all"),
                      children: t("cookie_reject_all")
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: onManagePreferences,
                      variant: "ghost",
                      className: "min-h-[44px] touch-manipulation text-primary hover:text-primary/80",
                      "aria-label": t("cookie_manage_preferences"),
                      children: t("cookie_manage_preferences")
                    }
                  )
                ] })
              ] })
            ] })
          ]
        }
      )
    }
  ) });
};

const DEFAULT_PREFERENCES = {
  necessary: true,
  // Always true, can't be disabled
  analytics: false,
  marketing: false,
  personalization: false
};
const CONSENT_STORAGE_KEY = "m1:cookie_consent:v1";
const CONSENT_TTL_DAYS = 180;

const PreferencesModal = ({
  isOpen,
  onClose,
  onSave,
  initialPreferences = DEFAULT_PREFERENCES
}) => {
  const { t } = useTranslation();
  const [preferences, setPreferences] = reactExports.useState(initialPreferences);
  const handleSave = () => {
    onSave(preferences);
    onClose();
  };
  const togglePreference = (key) => {
    if (key === "necessary") return;
    setPreferences((prev) => ({
      ...prev,
      [key]: !prev[key]
    }));
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    DialogContent,
    {
      className: "max-w-2xl max-h-[90vh] overflow-y-auto z-[65] relative rounded-[24px]",
      style: {
        background: "rgba(0, 0, 0, 0.05)",
        backdropFilter: "blur(40px)",
        WebkitBackdropFilter: "blur(40px)",
        border: "1px solid rgba(255, 255, 255, 0.1)",
        boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { children: t("cookie_preferences_title") }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(DialogDescription, { children: t("cookie_preferences_description") })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6 py-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Label$1, { htmlFor: "necessary", className: "text-base font-semibold flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-4 h-4 text-green-400" }),
                t("cookie_necessary_title")
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: t("cookie_necessary_description") })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-end gap-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  id: "necessary",
                  checked: preferences.necessary,
                  disabled: true,
                  "aria-label": t("cookie_necessary_always_active")
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-green-400 font-medium", children: t("cookie_necessary_always_active") })
            ] })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Separator$1, {}),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Label$1, { htmlFor: "analytics", className: "text-base font-semibold flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(ChartColumn, { className: "w-4 h-4 text-purple-400" }),
                t("cookie_analytics_title")
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: t("cookie_analytics_description") })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Switch,
              {
                id: "analytics",
                checked: preferences.analytics,
                onCheckedChange: () => togglePreference("analytics"),
                "aria-label": t("cookie_analytics_title")
              }
            )
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Separator$1, {}),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Label$1, { htmlFor: "marketing", className: "text-base font-semibold flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Megaphone, { className: "w-4 h-4 text-orange-400" }),
                t("cookie_marketing_title")
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: t("cookie_marketing_description") })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Switch,
              {
                id: "marketing",
                checked: preferences.marketing,
                onCheckedChange: () => togglePreference("marketing"),
                "aria-label": t("cookie_marketing_title")
              }
            )
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Separator$1, {}),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Label$1, { htmlFor: "personalization", className: "text-base font-semibold flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 text-blue-400" }),
                t("cookie_personalization_title")
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: t("cookie_personalization_description") })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Switch,
              {
                id: "personalization",
                checked: preferences.personalization,
                onCheckedChange: () => togglePreference("personalization"),
                "aria-label": t("cookie_personalization_title")
              }
            )
          ] }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-3 pt-4 border-t", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleSave,
              className: "flex-1 min-h-[44px]",
              children: t("cookie_save_preferences")
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: onClose,
              variant: "outline",
              className: "flex-1 min-h-[44px]",
              children: t("cookie_cancel")
            }
          )
        ] })
      ]
    }
  ) });
};

function getStoredConsent() {
  try {
    const stored = localStorage.getItem(CONSENT_STORAGE_KEY);
    if (!stored) return null;
    const data = JSON.parse(stored);
    if (CONSENT_TTL_DAYS) {
      const timestamp = new Date(data.timestamp);
      const now = /* @__PURE__ */ new Date();
      const daysSince = (now.getTime() - timestamp.getTime()) / (1e3 * 60 * 60 * 24);
      if (daysSince > CONSENT_TTL_DAYS) {
        localStorage.removeItem(CONSENT_STORAGE_KEY);
        return null;
      }
    }
    return data;
  } catch (error) {
    return null;
  }
}
function saveConsent(status, preferences) {
  try {
    const data = {
      status,
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      preferences: status === "granular" ? preferences : void 0,
      version: "1.0"
    };
    localStorage.setItem(CONSENT_STORAGE_KEY, JSON.stringify(data));
    applyConsentToScripts(data);
  } catch (error) {
  }
}
function applyConsentToScripts(consent) {
  consent.status === "accepted" || consent.status === "granular" && consent.preferences?.analytics;
  consent.status === "accepted" || consent.status === "granular" && consent.preferences?.marketing;
}
function getEffectivePreferences(consent) {
  if (!consent) return DEFAULT_PREFERENCES;
  if (consent.status === "accepted") {
    return {
      necessary: true,
      analytics: true,
      marketing: true,
      personalization: true
    };
  }
  if (consent.status === "rejected") {
    return DEFAULT_PREFERENCES;
  }
  if (consent.status === "granular" && consent.preferences) {
    return {
      ...DEFAULT_PREFERENCES,
      ...consent.preferences,
      necessary: true
      // Always true
    };
  }
  return DEFAULT_PREFERENCES;
}

function useConsentSync(onConsentChange) {
  const { user } = useUnifiedAuth();
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const syncFromRemote = async () => {
      try {
        const { data, error } = await supabase.from("profiles").select("cookie_consent").eq("id", user.id).single();
        if (error) {
          return;
        }
        const rawData = data;
        const remoteConsent = rawData?.cookie_consent ? rawData.cookie_consent : null;
        if (!remoteConsent) {
          return;
        }
        const localConsent = getStoredConsent();
        if (!localConsent || new Date(remoteConsent.timestamp) > new Date(localConsent.timestamp)) {
          if (remoteConsent.status === "granular" && remoteConsent.preferences) {
            saveConsent("granular", remoteConsent.preferences);
          } else {
            saveConsent(remoteConsent.status);
          }
          onConsentChange?.(remoteConsent);
        } else {
        }
      } catch (error) {
      }
    };
    syncFromRemote();
  }, [user?.id, onConsentChange]);
  return {
    /**
     * Save consent both locally and remotely
     */
    syncConsent: async (consent) => {
      if (!user?.id) {
        return;
      }
      try {
        const { error } = await supabase.from("profiles").update({ cookie_consent: consent }).eq("id", user.id);
        if (error) {
        } else {
        }
      } catch (error) {
      }
    }
  };
}

const CookieConsentManager = () => {
  const [consent, setConsent] = reactExports.useState(null);
  const [showBanner, setShowBanner] = reactExports.useState(false);
  const [showPreferences, setShowPreferences] = reactExports.useState(false);
  const [isInitialized, setIsInitialized] = reactExports.useState(false);
  const { syncConsent } = useConsentSync((remoteConsent) => {
    setConsent(remoteConsent);
  });
  reactExports.useEffect(() => {
    const initConsent = async () => {
      await new Promise((resolve) => {
        if (typeof requestIdleCallback !== "undefined") {
          requestIdleCallback(resolve);
        } else {
          setTimeout(resolve, 500);
        }
      });
      const stored = getStoredConsent();
      setConsent(stored);
      setIsInitialized(true);
      if (!stored) {
        setShowBanner(true);
      }
    };
    initConsent();
  }, []);
  reactExports.useEffect(() => {
    if (!isInitialized) return;
    window.__consent = {
      open: () => {
        setShowPreferences(true);
      },
      getConsent: () => consent,
      getPreferences: () => getEffectivePreferences(consent)
    };
    return () => {
      delete window.__consent;
    };
  }, [isInitialized, consent]);
  const handleAcceptAll = reactExports.useCallback(async () => {
    const newConsent = {
      status: "accepted",
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      version: "1.0"
    };
    saveConsent("accepted");
    setConsent(newConsent);
    setShowBanner(false);
    await syncConsent(newConsent);
  }, [syncConsent]);
  const handleRejectAll = reactExports.useCallback(async () => {
    const newConsent = {
      status: "rejected",
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      version: "1.0"
    };
    saveConsent("rejected");
    setConsent(newConsent);
    setShowBanner(false);
    await syncConsent(newConsent);
  }, [syncConsent]);
  const handleManagePreferences = reactExports.useCallback(() => {
    setShowBanner(false);
    setShowPreferences(true);
  }, []);
  const handleSavePreferences = reactExports.useCallback(async (preferences) => {
    const newConsent = {
      status: "granular",
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      preferences,
      version: "1.0"
    };
    saveConsent("granular", preferences);
    setConsent(newConsent);
    setShowPreferences(false);
    await syncConsent(newConsent);
  }, [syncConsent]);
  if (!isInitialized) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      CookieBanner,
      {
        isVisible: showBanner,
        onAcceptAll: handleAcceptAll,
        onRejectAll: handleRejectAll,
        onManagePreferences: handleManagePreferences
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      PreferencesModal,
      {
        isOpen: showPreferences,
        onClose: () => setShowPreferences(false),
        onSave: handleSavePreferences,
        initialPreferences: consent?.preferences
      }
    )
  ] });
};

const SEED_DOCUMENTS = [
  {
    slug: "mission-buzz",
    title: "BUZZ  definizione e regole base",
    body: `BUZZ  l'azione di scansione attiva che sblocca indizi o aree. Il costo e il raggio sono dinamici in base al tier e alla progressione. Il BUZZ pu essere lanciato anche fuori dalla mappa. Il primo BUZZ Map ha condizioni speciali documentate a parte.`,
    tags: ["buzz", "regole", "onboarding"]
  },
  {
    slug: "mission-buzz-map",
    title: "BUZZ Map  come funziona",
    body: `BUZZ Map  l'interazione contestuale dalla mappa: l'utente vede overlay e marker, e pu lanciare il BUZZ direttamente dalla mappa. Differenza chiave: BUZZ = azione singola, BUZZ Map = azione dalla mappa con feedback visivo. Primo BUZZ Map: raggio 500 km, prezzo 4,99 (se confermato nelle policy attuali).`,
    tags: ["buzz-map", "mappa", "onboarding"]
  },
  {
    slug: "mission-final-shot",
    title: "Final Shot  intento finale",
    body: `Final Shot  il tentativo finale di claim del premio secondo regole antifrode (posizione, finestra temporale, limiti per tier). Prima del Final Shot viene consigliato rivedere gli indizi raccolti. I dettagli vanno aggiornati con le policy ufficiali.`,
    tags: ["final-shot", "regole"]
  },
  {
    slug: "mission-tiers",
    title: "Tiers e limiti",
    body: `Free/Silver/Gold/Black: limiti mensili di BUZZ, costo/raggio e vantaggi accessori. L'assistente deve sempre rispettare i limiti del tier corrente.`,
    tags: ["tiers", "pricing"]
  }
];

async function populateKnowledgeBase(options = {}) {
  const docs = options.documents ?? SEED_DOCUMENTS;
  try {
    const { data, error } = await supabase.functions.invoke("norah-kb-upsert", {
      body: { documents: docs }
    });
    if (error) {
      throw new Error(`KB upsert failed: ${error.message || JSON.stringify(error)}`);
    }
    if (data?.results) {
      data.results.forEach((r) => {
        const status = r.status === "ok" ? "" : "";
      });
    }
    return data;
  } catch (error) {
    throw error;
  }
}
if (typeof window !== "undefined") {
  window.__populateKB__ = populateKnowledgeBase;
}

const useNorahProactiveListener = () => {
  const { user } = useAuthContext();
  const [, setLocation] = useLocation();
  reactExports.useEffect(() => {
    if (!user?.id || !("serviceWorker" in navigator)) return;
    const handleMessage = (event) => {
      if (event.data?.type === "norah_proactive") {
        const { notification_type, title, body, deepLink } = event.data;
        ue(title, {
          description: body,
          duration: 8e3,
          action: {
            label: "Apri",
            onClick: () => {
              if (deepLink) {
                setLocation(deepLink);
              }
            }
          },
          style: {
            background: "linear-gradient(135deg, #00FFFF 0%, #0084FF 100%)",
            color: "white",
            fontWeight: "bold"
          }
        });
        if (event.data.notification_id) {
          supabase.rpc("mark_norah_notification_clicked", {
            p_notification_id: event.data.notification_id
          }).then(() => {
          });
        }
      }
    };
    navigator.serviceWorker.addEventListener("message", handleMessage);
    return () => {
      navigator.serviceWorker.removeEventListener("message", handleMessage);
    };
  }, [user?.id, setLocation]);
};

const NorahProactiveManager = () => {
  useNorahProactiveListener();
  return null;
};

const ENROLLMENT_CACHE_KEY = "m1_mission_enrolled";
const ENROLLMENT_MISSION_KEY = "m1_enrolled_mission_id";
const clearEnrollmentCache = () => {
  try {
    localStorage.removeItem(ENROLLMENT_CACHE_KEY);
    localStorage.removeItem(ENROLLMENT_MISSION_KEY);
  } catch (_) {
  }
};
const useActiveMissionEnrollment = () => {
  const { user } = useAuth();
  const [state, setState] = reactExports.useState({
    isEnrolled: false,
    //  FIX: Parte da FALSE, NON da cache
    isLoading: true,
    missionId: null,
    enrolledAt: null,
    error: null
  });
  const hasCheckedDb = reactExports.useRef(false);
  const checkEnrollment = reactExports.useCallback(async () => {
    if (!user) {
      setState({
        isEnrolled: false,
        isLoading: false,
        missionId: null,
        enrolledAt: null,
        error: null
      });
      clearEnrollmentCache();
      return;
    }
    try {
      setState((prev) => ({ ...prev, isLoading: true, error: null }));
      let activeMission = null;
      const { data: cmdMission, error: cmdError } = await supabase.from("current_mission_data").select("id, mission_name, mission_status").eq("is_active", true).order("created_at", { ascending: false }).limit(1).maybeSingle();
      if (!cmdError && cmdMission) {
        activeMission = {
          id: cmdMission.id,
          title: cmdMission.mission_name,
          status: cmdMission.mission_status
        };
      } else {
        const { data: missionData, error: missionError } = await supabase.from("missions").select("id, title, status").eq("status", "active").order("start_date", { ascending: false }).limit(1).maybeSingle();
        if (missionError) {
          setState({
            isEnrolled: false,
            isLoading: false,
            missionId: null,
            enrolledAt: null,
            error: "Errore nel caricamento missione"
          });
          return;
        }
        activeMission = missionData;
      }
      if (!activeMission) {
        setState({
          isEnrolled: false,
          isLoading: false,
          missionId: null,
          enrolledAt: null,
          error: null
        });
        clearEnrollmentCache();
        return;
      }
      const { data: enrollment, error: enrollError } = await supabase.from("mission_enrollments").select("*").eq("user_id", user.id).eq("mission_id", activeMission.id).maybeSingle();
      if (enrollError) {
        setState({
          isEnrolled: false,
          isLoading: false,
          missionId: activeMission.id,
          enrolledAt: null,
          error: "Errore nel controllo iscrizione"
        });
        return;
      }
      const enrollmentState = enrollment?.state;
      const isEnrolled = !!enrollment && enrollmentState !== "cancelled";
      if (isEnrolled) {
        try {
          localStorage.setItem(ENROLLMENT_CACHE_KEY, "1");
          localStorage.setItem(ENROLLMENT_MISSION_KEY, activeMission.id);
        } catch (_) {
        }
      } else {
        clearEnrollmentCache();
      }
      const enrolledAt = enrollment?.created_at || enrollment?.joined_at || null;
      setState({
        isEnrolled,
        isLoading: false,
        missionId: activeMission.id,
        enrolledAt,
        error: null
      });
      hasCheckedDb.current = true;
    } catch (err) {
      setState({
        isEnrolled: false,
        isLoading: false,
        missionId: null,
        enrolledAt: null,
        error: "Errore di connessione"
      });
    }
  }, [user]);
  reactExports.useEffect(() => {
    checkEnrollment();
  }, [checkEnrollment]);
  reactExports.useEffect(() => {
    if (!user) return;
    const channel = supabase.channel("mission_enrollment_changes").on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "mission_enrollments",
        filter: `user_id=eq.${user.id}`
      },
      (payload) => {
        checkEnrollment();
      }
    ).subscribe();
    return () => {
      channel.unsubscribe();
    };
  }, [user, checkEnrollment]);
  reactExports.useEffect(() => {
    const handleEnrolled = (event) => {
      setState((prev) => ({
        ...prev,
        isEnrolled: true,
        missionId: event.detail?.missionId || prev.missionId
      }));
      setTimeout(checkEnrollment, 500);
    };
    const handleMissionLaunched = () => {
      clearEnrollmentCache();
      setState({
        isEnrolled: false,
        isLoading: true,
        missionId: null,
        enrolledAt: null,
        error: null
      });
      setTimeout(checkEnrollment, 300);
    };
    const handleMissionReset = () => {
      clearEnrollmentCache();
      setState({
        isEnrolled: false,
        isLoading: false,
        missionId: null,
        enrolledAt: null,
        error: null
      });
    };
    window.addEventListener("mission:enrolled", handleEnrolled);
    window.addEventListener("missionLaunched", handleMissionLaunched);
    window.addEventListener("mission:reset", handleMissionReset);
    window.addEventListener("missionReset", handleMissionReset);
    return () => {
      window.removeEventListener("mission:enrolled", handleEnrolled);
      window.removeEventListener("missionLaunched", handleMissionLaunched);
      window.removeEventListener("mission:reset", handleMissionReset);
      window.removeEventListener("missionReset", handleMissionReset);
    };
  }, [checkEnrollment]);
  return {
    isEnrolled: state.isEnrolled,
    isLoading: state.isLoading,
    missionId: state.missionId,
    enrolledAt: state.enrolledAt,
    error: state.error,
    refresh: checkEnrollment,
    clearCache: clearEnrollmentCache
    //  Esponi per uso esterno
  };
};

const StartMissionButton = () => {
  const { user } = useAuthContext();
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const { isEnrolled, isLoading: enrollmentLoading } = useActiveMissionEnrollment();
  const triggerMissionIntro = useEntityOverlayStore((s) => s.triggerMissionIntro);
  if (enrollmentLoading || isEnrolled) return null;
  const handleStartMission = async () => {
    setIsLoading(true);
    try {
      let currentUser = user;
      if (!currentUser) {
        const { data, error } = await supabase.auth.signInAnonymously();
        if (error) {
          ue.error("Ops, riprova tra poco.", {
            description: "Impossibile autenticarti automaticamente."
          });
          setIsLoading(false);
          return;
        }
        currentUser = data?.user ?? null;
      }
      if (!currentUser) {
        ue.error("Ops, riprova tra poco.", {
          description: "Sessione non valida."
        });
        setIsLoading(false);
        return;
      }
      const { data: sessionData } = await supabase.auth.getSession();
      const token = sessionData?.session?.access_token;
      if (!token) {
        ue.error("Ops, riprova tra poco.", {
          description: "Token di autenticazione non disponibile."
        });
        setIsLoading(false);
        return;
      }
      const response = await supabase.functions.invoke("enroll-mission-of-the-month", {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });
      if (response.error) {
        ue.error("Ops, riprova tra poco.", {
          description: "Impossibile iscriverti alla missione."
        });
        setIsLoading(false);
        return;
      }
      const result = response.data;
      if (!result?.ok) {
        ue.error("Ops, riprova tra poco.", {
          description: result?.error || "Errore sconosciuto."
        });
        setIsLoading(false);
        return;
      }
      triggerMissionIntro(result.mission_id);
      try {
        localStorage.setItem("m1_mission_enrolled", "1");
      } catch (_) {
      }
      ue.success("Sei dentro! Missione del mese attivata.", {
        description: "Preparati per l'avventura! "
      });
      setTimeout(() => {
        window.dispatchEvent(new CustomEvent("mission:enrolled", { detail: { missionId: result.mission_id } }));
      }, 100);
    } catch (err) {
      ue.error("Ops, riprova tra poco.", {
        description: "Errore imprevisto."
      });
    } finally {
      setIsLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.button,
    {
      onClick: handleStartMission,
      disabled: isLoading,
      "data-onboarding": "start-mission",
      initial: { opacity: 0, y: -10 },
      animate: { opacity: 1, y: 0 },
      className: "inline-flex items-center justify-center px-3 py-1 rounded-full bg-[#00D1FF]/10 border border-[#00D1FF]/30 hover:bg-[#00D1FF]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed",
      whileHover: !isLoading ? { scale: 1.05 } : {},
      whileTap: !isLoading ? { scale: 0.95 } : {},
      children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-3 w-3 border border-[#00D1FF] border-t-transparent mr-2" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-orbitron font-semibold text-[#00D1FF] uppercase tracking-wider", children: "Caricamento..." })
      ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-orbitron font-semibold text-[#00D1FF] uppercase tracking-wider", children: "START M1SSION" })
    }
  );
};

const ALLOWED_ROUTES = ["/home", "/"];
const MissionBadgeInjector = () => {
  const [location] = useLocation();
  const { isEnrolled, isLoading } = useActiveMissionEnrollment();
  const [portalReady, setPortalReady] = reactExports.useState(false);
  const isOnHomePage = ALLOWED_ROUTES.includes(location) || location === "/home";
  reactExports.useEffect(() => {
    if (!isOnHomePage) {
      setPortalReady(false);
    }
  }, [isOnHomePage]);
  reactExports.useEffect(() => {
    if (!isOnHomePage || isLoading) return;
    let retryCount = 0;
    const maxRetries = 100;
    const retryDelay = 100;
    let headerObserver = null;
    let globalObserver = null;
    let badgeNodeRef = null;
    const getHeaderContext = () => {
      if (!ALLOWED_ROUTES.includes(window.location.pathname) && window.location.pathname !== "/home") {
        return { headerH1: null, headerWrapper: null, subtitle: null };
      }
      let headerH1 = document.getElementById("m1-home-title");
      if (!headerH1) {
        headerH1 = document.querySelector('h1[aria-label*="Centro di Comando Agente"]');
        if (!headerH1) {
          const homeContent = document.querySelector('[data-page="home"]') || document.querySelector(".command-center-home");
          if (homeContent) {
            headerH1 = homeContent.querySelector("h1");
          }
        }
        if (!headerH1) {
          const allH1s = Array.from(document.querySelectorAll("h1"));
          headerH1 = allH1s.find((h) => {
            const parent = h.closest("div");
            return parent && h.textContent?.includes("M1SSION") && parent.textContent?.includes("Centro di Comando Agente");
          });
        }
        if (headerH1) {
          headerH1.id = "m1-home-title";
          headerH1.setAttribute("data-m1-anchor", "home-title");
        }
      }
      const headerWrapper = headerH1?.closest("div");
      const subtitle = headerWrapper ? Array.from(headerWrapper.querySelectorAll("p, span, div")).find((el) => el.textContent?.includes("Centro di Comando Agente")) : null;
      return { headerH1, headerWrapper, subtitle };
    };
    const ensureBadgePosition = () => {
      if (!ALLOWED_ROUTES.includes(window.location.pathname) && window.location.pathname !== "/home") {
        return false;
      }
      const { headerH1, headerWrapper, subtitle } = getHeaderContext();
      if (!headerH1 || !headerWrapper) return false;
      if (!badgeNodeRef) {
        badgeNodeRef = document.getElementById("mission-status-badge-portal");
        if (!badgeNodeRef) {
          badgeNodeRef = document.createElement("div");
          badgeNodeRef.id = "mission-status-badge-portal";
          badgeNodeRef.setAttribute("data-anchor", "m1-header-badge");
          badgeNodeRef.className = "flex justify-center my-3";
          badgeNodeRef.setAttribute("data-persistent", "true");
        }
      }
      const isCorrectlyPositioned = subtitle ? badgeNodeRef.nextSibling === subtitle && badgeNodeRef.parentElement === headerWrapper : badgeNodeRef.previousElementSibling === headerH1 && badgeNodeRef.parentElement === headerWrapper;
      if (!isCorrectlyPositioned) {
        if (subtitle) {
          headerWrapper.insertBefore(badgeNodeRef, subtitle);
        } else {
          headerH1.insertAdjacentElement("afterend", badgeNodeRef);
        }
      }
      setPortalReady(true);
      return true;
    };
    const findAndInject = () => {
      if (!ALLOWED_ROUTES.includes(window.location.pathname) && window.location.pathname !== "/home") {
        return;
      }
      if (ensureBadgePosition()) {
        const { headerWrapper } = getHeaderContext();
        if (headerWrapper && !headerObserver) {
          headerObserver = new MutationObserver(() => {
            if (ALLOWED_ROUTES.includes(window.location.pathname) || window.location.pathname === "/home") {
              requestAnimationFrame(() => ensureBadgePosition());
            }
          });
          headerObserver.observe(headerWrapper, { childList: true, subtree: false });
        }
        if (!globalObserver) {
          globalObserver = new MutationObserver(() => {
            if (badgeNodeRef && !document.body.contains(badgeNodeRef)) {
              if (ALLOWED_ROUTES.includes(window.location.pathname) || window.location.pathname === "/home") {
                requestAnimationFrame(() => ensureBadgePosition());
              }
            }
          });
          globalObserver.observe(document.body, { childList: true, subtree: true });
        }
        return;
      }
      if (retryCount < maxRetries) {
        retryCount++;
        setTimeout(findAndInject, retryDelay);
      }
    };
    findAndInject();
    const onRouteChange = () => {
      const isHome = ALLOWED_ROUTES.includes(window.location.pathname) || window.location.pathname === "/home";
      if (isHome) {
        requestAnimationFrame(() => {
          setPortalReady(false);
          badgeNodeRef = null;
          setTimeout(findAndInject, 50);
        });
      } else {
        setPortalReady(false);
        badgeNodeRef = null;
      }
    };
    const onPageShow = () => {
      if (ALLOWED_ROUTES.includes(window.location.pathname) || window.location.pathname === "/home") {
        requestAnimationFrame(findAndInject);
      }
    };
    const onVisibility = () => {
      if (document.visibilityState === "visible") {
        if (ALLOWED_ROUTES.includes(window.location.pathname) || window.location.pathname === "/home") {
          requestAnimationFrame(findAndInject);
        }
      }
    };
    const onFocus = () => {
      if (ALLOWED_ROUTES.includes(window.location.pathname) || window.location.pathname === "/home") {
        requestAnimationFrame(findAndInject);
      }
    };
    const homeCheckInterval = window.setInterval(() => {
      try {
        if (ALLOWED_ROUTES.includes(window.location.pathname) || window.location.pathname === "/home") {
          ensureBadgePosition();
        }
      } catch {
      }
    }, 800);
    window.addEventListener("pageshow", onPageShow);
    window.addEventListener("popstate", onRouteChange);
    window.addEventListener("visibilitychange", onVisibility);
    window.addEventListener("focus", onFocus);
    return () => {
      headerObserver?.disconnect();
      globalObserver?.disconnect();
      window.removeEventListener("pageshow", onPageShow);
      window.removeEventListener("popstate", onRouteChange);
      window.removeEventListener("visibilitychange", onVisibility);
      window.removeEventListener("focus", onFocus);
      window.clearInterval(homeCheckInterval);
      badgeNodeRef = null;
    };
  }, [isLoading, isOnHomePage]);
  reactExports.useEffect(() => {
    const onEnrolled = () => {
      if (ALLOWED_ROUTES.includes(window.location.pathname) || window.location.pathname === "/home") {
        setPortalReady(true);
      }
    };
    const onMissionReset = () => {
      setPortalReady(true);
    };
    window.addEventListener("mission:enrolled", onEnrolled);
    window.addEventListener("missionLaunched", onMissionReset);
    window.addEventListener("mission:reset", onMissionReset);
    window.addEventListener("missionReset", onMissionReset);
    return () => {
      window.removeEventListener("mission:enrolled", onEnrolled);
      window.removeEventListener("missionLaunched", onMissionReset);
      window.removeEventListener("mission:reset", onMissionReset);
      window.removeEventListener("missionReset", onMissionReset);
    };
  }, []);
  if (!isOnHomePage) return null;
  if (isLoading || !portalReady) return null;
  const portalTarget = document.getElementById("mission-status-badge-portal");
  if (!portalTarget) return null;
  return reactDomExports.createPortal(
    isEnrolled ? /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, y: -10 },
        animate: { opacity: 1, y: 0 },
        className: "inline-flex items-center justify-center px-3 py-1 rounded-full border border-emerald-400/40 bg-gradient-to-r from-emerald-600/15 to-fuchsia-600/15",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "span",
          {
            className: "text-xs font-orbitron font-semibold uppercase tracking-wider bg-gradient-to-r from-emerald-400 to-fuchsia-400 bg-clip-text text-transparent",
            children: "ON M1SSION"
          }
        )
      }
    ) : /* @__PURE__ */ jsxRuntimeExports.jsx(StartMissionButton, {}),
    portalTarget
  );
};

function listenSWUpdates(options = {}) {
  if (!("serviceWorker" in navigator)) {
    return;
  }
  navigator.serviceWorker.addEventListener("message", (event) => {
    if (event.data?.type === "SW_UPDATE_READY") {
      if (options.onUpdateAvailable) {
        options.onUpdateAvailable();
      }
      if (options.autoReload) {
        applyUpdate();
      }
    }
  });
}
async function applyUpdate() {
  if (!("serviceWorker" in navigator)) return;
  try {
    const registration = await navigator.serviceWorker.getRegistration();
    if (!registration || !registration.waiting) {
      return;
    }
    registration.waiting.postMessage({ type: "SKIP_WAITING" });
    navigator.serviceWorker.addEventListener("controllerchange", () => {
      window.location.reload();
    }, { once: true });
  } catch (error) {
  }
}

const UpdateBanner = () => {
  const [showBanner, setShowBanner] = reactExports.useState(false);
  reactExports.useEffect(() => {
    listenSWUpdates({
      onUpdateAvailable: () => {
        setShowBanner(true);
      },
      autoReload: false
      // Manual user action required
    });
  }, []);
  if (!showBanner) return null;
  const handleUpdate = () => {
    applyUpdate();
  };
  const handleDismiss = () => {
    setShowBanner(false);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-[9999] animate-in slide-in-from-bottom-5", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gradient-to-r from-[#4361ee] to-[#7209b7] rounded-xl shadow-2xl border border-white/20 p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-5 h-5 text-white" }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-bold text-white text-sm", children: "Nuova versione disponibile" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 text-xs mt-1", children: "Un aggiornamento  pronto. Aggiorna ora per le ultime funzionalit." }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2 mt-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleUpdate,
            size: "sm",
            className: "bg-white text-[#4361ee] hover:bg-white/90 font-semibold",
            children: "Aggiorna"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleDismiss,
            size: "sm",
            variant: "ghost",
            className: "text-white hover:bg-white/20",
            children: "Dopo"
          }
        )
      ] })
    ] })
  ] }) }) });
};

const ONBOARDING_STEPS = [
  // 
  //  HOME PAGE (Step 1-7)
  // 
  // 1. START M1SSION
  {
    id: "start-mission",
    page: "/home",
    targetSelector: '[data-onboarding="start-mission"]',
    title: " START M1SSION",
    description: "Clicca qui per iniziare la tua avventura!",
    icon: "",
    action: "click",
    position: "bottom",
    spotlightPadding: 12,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 2. M1U PILL
  {
    id: "m1u-pill",
    page: "/home",
    targetSelector: '[data-onboarding="m1u-pill"]',
    title: " M1U - VALUTA",
    description: "I tuoi M1U! Guadagnali e usali per BUZZ.",
    icon: "",
    action: "click",
    position: "bottom",
    spotlightPadding: 12,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 3. STREAK PILL
  {
    id: "streak-pill",
    page: "/home",
    targetSelector: '[data-onboarding="streak-pill"]',
    title: " STREAK",
    description: "Accedi ogni giorno per bonus PE e M1U!",
    icon: "",
    action: "click",
    position: "bottom",
    spotlightPadding: 12,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 4. M1SSION PRIZE
  {
    id: "prize-vision",
    page: "/home",
    targetSelector: '[data-onboarding="prize-vision"]',
    title: " PRIZE",
    description: "Il Premio Principale  ancora TOP SECRET. Si sveler durante la Missione...",
    icon: "",
    action: "click",
    position: "bottom",
    spotlightPadding: 16,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 5. STATO MISSIONE
  {
    id: "mission-card",
    page: "/home",
    targetSelector: '[data-onboarding="mission-card"]',
    title: " MISSIONE",
    description: "Stato missione: indizi e tempo rimasto.",
    icon: "",
    action: "click",
    position: "top",
    spotlightPadding: 16,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 6. M1SSION BATTLE
  {
    id: "battle",
    page: "/home",
    targetSelector: '[data-onboarding="battle"]',
    title: " BATTLE",
    description: "Sfida altri agenti e vinci M1U!",
    icon: "",
    action: "click",
    position: "top",
    spotlightPadding: 12,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 7. INVITE
  {
    id: "invite",
    page: "/home",
    targetSelector: '[data-onboarding="invite"]',
    title: " INVITA",
    description: "Invita amici e guadagna +25 PE!",
    icon: "",
    action: "click",
    position: "left",
    spotlightPadding: 8,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 
  //  MAP PAGE (Step 8)
  // 
  // 8. BUZZ MAP BUTTON
  {
    id: "buzz-map-button",
    page: "/map-3d-tiler",
    targetSelector: '[data-onboarding="buzz-map-button"]',
    title: " BUZZ MAP",
    description: "Marker  = Agenti sfidabili. 99 Reward nascosti con premi instant!",
    icon: "",
    action: "click",
    position: "top",
    spotlightPadding: 16,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 
  //  BUZZ PAGE (Step 9-10)
  // 
  // 9. NAVIGAZIONE
  {
    id: "bottom-nav",
    page: "/buzz",
    targetSelector: '[data-onboarding="bottom-nav"]',
    title: " NAV",
    description: "Naviga tra le sezioni dell'app!",
    icon: "",
    action: "click",
    position: "top",
    spotlightPadding: 8,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 10. BUZZ BUTTON
  {
    id: "buzz-button",
    page: "/buzz",
    targetSelector: '[data-onboarding="buzz-button"]',
    title: " BUZZ",
    description: "Ottieni hint sugli indizi!",
    icon: "",
    action: "click",
    position: "top",
    spotlightPadding: 16,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 
  //  INTELLIGENCE PAGE (Step 11)
  // 
  // 11. AI AION
  {
    id: "ai-chat",
    page: "/intelligence",
    targetSelector: '[data-onboarding="ai-chat"]',
    title: " AION",
    description: "L'Oracolo di M1SSION. Solo lui conosce tutti i segreti. Chiedi a lui.",
    icon: "",
    action: "click",
    position: "top",
    spotlightPadding: 16,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: true
  },
  // 
  //  FINE TUTORIAL (Step 12)
  // 
  // 12. FINE TUTORIAL
  {
    id: "tutorial-complete",
    page: "/home",
    targetSelector: '[data-onboarding="m1ssion-title"]',
    title: " COMPLETATO!",
    description: "Ora sei pronto per M1SSION!",
    icon: "",
    action: "click",
    position: "bottom",
    spotlightPadding: 20,
    autoAdvanceOnClick: true,
    highlightPulse: true,
    skipIfNotFound: false,
    isFinalStep: true
  }
];
ONBOARDING_STEPS.reduce((acc, step) => {
  if (!acc[step.page]) acc[step.page] = [];
  acc[step.page].push(step);
  return acc;
}, {});
const PAGE_ORDER = ["/home", "/map-3d-tiler", "/buzz", "/intelligence", "/leaderboard"];
const TOTAL_STEPS = ONBOARDING_STEPS.length;

const OnboardingContext = reactExports.createContext(null);
const STORAGE_KEYS = {
  COMPLETED: "m1ssion_onboarding_completed",
  SKIPPED: "m1ssion_onboarding_skipped",
  CURRENT_STEP: "m1ssion_onboarding_step",
  PAUSED: "m1ssion_onboarding_paused"
};
function OnboardingProvider({ children }) {
  const { user } = useAuthContext();
  const [location, navigate] = useLocation();
  const [state, setState] = reactExports.useState({
    isActive: false,
    currentStepIndex: 0,
    currentStep: null,
    isCompleted: false,
    isSkipped: false,
    isSandboxMode: false
  });
  reactExports.useEffect(() => {
    const completed = localStorage.getItem(STORAGE_KEYS.COMPLETED) === "true";
    const skipped = localStorage.getItem(STORAGE_KEYS.SKIPPED) === "true";
    const savedStep = parseInt(localStorage.getItem(STORAGE_KEYS.CURRENT_STEP) || "0", 10);
    const paused = localStorage.getItem(STORAGE_KEYS.PAUSED) === "true";
    setState((prev) => ({
      ...prev,
      isCompleted: completed,
      isSkipped: skipped,
      currentStepIndex: savedStep,
      currentStep: ONBOARDING_STEPS[savedStep] || null
    }));
    if (user && !completed && !skipped && !paused) {
      const timer = setTimeout(() => {
        setState((prev) => ({
          ...prev,
          isActive: true,
          currentStep: ONBOARDING_STEPS[savedStep] || ONBOARDING_STEPS[0]
        }));
      }, 1500);
      return () => clearTimeout(timer);
    }
  }, [user]);
  reactExports.useEffect(() => {
    if (!state.isActive || !state.currentStep) return;
    const targetPage = state.currentStep.page;
    if (location !== targetPage) {
      navigate(targetPage);
    }
  }, [state.isActive, state.currentStep, location, navigate]);
  reactExports.useEffect(() => {
    if (state.isActive) {
      localStorage.setItem(STORAGE_KEYS.CURRENT_STEP, state.currentStepIndex.toString());
    }
  }, [state.currentStepIndex, state.isActive]);
  const startOnboarding = reactExports.useCallback(() => {
    localStorage.removeItem(STORAGE_KEYS.COMPLETED);
    localStorage.removeItem(STORAGE_KEYS.SKIPPED);
    localStorage.removeItem(STORAGE_KEYS.PAUSED);
    localStorage.setItem(STORAGE_KEYS.CURRENT_STEP, "0");
    setState({
      isActive: true,
      currentStepIndex: 0,
      currentStep: ONBOARDING_STEPS[0],
      isCompleted: false,
      isSkipped: false,
      isSandboxMode: false
    });
  }, []);
  const nextStep = reactExports.useCallback(() => {
    setState((prev) => {
      const nextIndex = prev.currentStepIndex + 1;
      if (nextIndex >= TOTAL_STEPS) {
        localStorage.setItem(STORAGE_KEYS.COMPLETED, "true");
        localStorage.removeItem(STORAGE_KEYS.CURRENT_STEP);
        return {
          ...prev,
          isActive: false,
          isCompleted: true,
          currentStep: null
        };
      }
      return {
        ...prev,
        currentStepIndex: nextIndex,
        currentStep: ONBOARDING_STEPS[nextIndex]
      };
    });
  }, []);
  const prevStep = reactExports.useCallback(() => {
    setState((prev) => {
      if (prev.currentStepIndex <= 0) return prev;
      const prevIndex = prev.currentStepIndex - 1;
      return {
        ...prev,
        currentStepIndex: prevIndex,
        currentStep: ONBOARDING_STEPS[prevIndex]
      };
    });
  }, []);
  const goToStep = reactExports.useCallback((index) => {
    if (index < 0 || index >= TOTAL_STEPS) return;
    setState((prev) => ({
      ...prev,
      isActive: true,
      currentStepIndex: index,
      currentStep: ONBOARDING_STEPS[index]
    }));
  }, []);
  const skipOnboarding = reactExports.useCallback(() => {
    localStorage.setItem(STORAGE_KEYS.SKIPPED, "true");
    localStorage.removeItem(STORAGE_KEYS.CURRENT_STEP);
    setState((prev) => ({
      ...prev,
      isActive: false,
      isSkipped: true,
      currentStep: null
    }));
  }, []);
  const completeOnboarding = reactExports.useCallback(() => {
    localStorage.setItem(STORAGE_KEYS.COMPLETED, "true");
    localStorage.removeItem(STORAGE_KEYS.CURRENT_STEP);
    setState((prev) => ({
      ...prev,
      isActive: false,
      isCompleted: true,
      currentStep: null
    }));
  }, []);
  const resetOnboarding = reactExports.useCallback(() => {
    localStorage.removeItem(STORAGE_KEYS.COMPLETED);
    localStorage.removeItem(STORAGE_KEYS.SKIPPED);
    localStorage.removeItem(STORAGE_KEYS.CURRENT_STEP);
    localStorage.removeItem(STORAGE_KEYS.PAUSED);
    setState({
      isActive: false,
      currentStepIndex: 0,
      currentStep: null,
      isCompleted: false,
      isSkipped: false,
      isSandboxMode: false
    });
  }, []);
  const pauseOnboarding = reactExports.useCallback(() => {
    localStorage.setItem(STORAGE_KEYS.PAUSED, "true");
    setState((prev) => ({ ...prev, isActive: false }));
  }, []);
  const resumeOnboarding = reactExports.useCallback(() => {
    localStorage.removeItem(STORAGE_KEYS.PAUSED);
    setState((prev) => ({
      ...prev,
      isActive: true,
      currentStep: ONBOARDING_STEPS[prev.currentStepIndex]
    }));
  }, []);
  const enableSandboxMode = reactExports.useCallback(() => {
    setState((prev) => ({ ...prev, isSandboxMode: true, isActive: true }));
  }, []);
  const disableSandboxMode = reactExports.useCallback(() => {
    setState((prev) => ({ ...prev, isSandboxMode: false, isActive: false }));
  }, []);
  const currentPageSteps = ONBOARDING_STEPS.filter((s) => s.page === location);
  const value = {
    ...state,
    startOnboarding,
    nextStep,
    prevStep,
    goToStep,
    skipOnboarding,
    completeOnboarding,
    resetOnboarding,
    pauseOnboarding,
    resumeOnboarding,
    enableSandboxMode,
    disableSandboxMode,
    totalSteps: TOTAL_STEPS,
    progressPercent: (state.currentStepIndex + 1) / TOTAL_STEPS * 100,
    isFirstStep: state.currentStepIndex === 0,
    isLastStep: state.currentStepIndex === TOTAL_STEPS - 1,
    currentPageSteps
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(OnboardingContext.Provider, { value, children });
}
function useOnboarding() {
  const context = reactExports.useContext(OnboardingContext);
  if (!context) {
    throw new Error("useOnboarding must be used within OnboardingProvider");
  }
  return context;
}

const Confetti = () => {
  const colors = ["#00D1FF", "#FF59F8", "#FFD700", "#00FF88", "#FF6B6B", "#A855F7"];
  const confettiPieces = Array.from({ length: 50 }, (_, i) => ({
    id: i,
    x: Math.random() * 100,
    delay: Math.random() * 0.5,
    duration: 2 + Math.random() * 2,
    color: colors[Math.floor(Math.random() * colors.length)],
    size: 8 + Math.random() * 8,
    rotation: Math.random() * 360
  }));
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 pointer-events-none z-[10001] overflow-hidden", children: confettiPieces.map((piece) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      className: "absolute",
      style: {
        left: `${piece.x}%`,
        top: -20,
        width: piece.size,
        height: piece.size,
        backgroundColor: piece.color,
        borderRadius: Math.random() > 0.5 ? "50%" : "2px"
      },
      initial: { y: -20, rotate: 0, opacity: 1 },
      animate: {
        y: window.innerHeight + 50,
        rotate: piece.rotation + 720,
        opacity: [1, 1, 0]
      },
      transition: {
        duration: piece.duration,
        delay: piece.delay,
        ease: "easeOut"
      }
    },
    piece.id
  )) });
};
const CelebrationOverlay = ({ onComplete, userId }) => {
  const [peAwarded, setPeAwarded] = reactExports.useState(false);
  reactExports.useEffect(() => {
    hapticHeavy();
    const awardPE = async () => {
      if (!userId || peAwarded) return;
      try {
        const alreadyAwarded = localStorage.getItem("m1ssion_onboarding_pe_awarded");
        if (alreadyAwarded) {
          setPeAwarded(true);
          return;
        }
        const { error } = await supabase.from("profiles").update({
          pulse_energy: supabase.rpc("increment_pulse_energy", { amount: 50 })
        }).eq("id", userId);
        if (error) {
          const { data: profile } = await supabase.from("profiles").select("pulse_energy").eq("id", userId).single();
          if (profile) {
            await supabase.from("profiles").update({ pulse_energy: (profile.pulse_energy || 0) + 50 }).eq("id", userId);
          }
        }
        localStorage.setItem("m1ssion_onboarding_pe_awarded", "true");
        setPeAwarded(true);
        ue.success(" +50 PE accreditati per aver completato il tutorial!");
      } catch (err) {
      }
    };
    awardPE();
    const timer = setTimeout(onComplete, 4e3);
    return () => clearTimeout(timer);
  }, [onComplete, userId, peAwarded]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      className: "fixed inset-0 z-[10000] flex items-center justify-center bg-black/90",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Confetti, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0, rotate: -180 },
            animate: { scale: 1, rotate: 0 },
            transition: { type: "spring", damping: 12, stiffness: 200 },
            className: "text-center relative z-10 px-4 max-w-md mx-auto",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "text-6xl sm:text-8xl mb-4 sm:mb-6",
                  animate: {
                    scale: [1, 1.2, 1],
                    rotate: [0, 10, -10, 0]
                  },
                  transition: { duration: 0.5, repeat: 3 },
                  children: ""
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.h1,
                {
                  className: "text-2xl sm:text-4xl md:text-5xl font-bold mb-3 sm:mb-4 px-2",
                  style: {
                    background: "linear-gradient(135deg, #00D1FF, #FF59F8, #FFD700)",
                    backgroundClip: "text",
                    WebkitBackgroundClip: "text",
                    color: "transparent",
                    textShadow: "0 0 40px rgba(0, 209, 255, 0.5)"
                  },
                  initial: { y: 20, opacity: 0 },
                  animate: { y: 0, opacity: 1 },
                  transition: { delay: 0.3 },
                  children: "TUTORIAL COMPLETATO!"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.p,
                {
                  className: "text-base sm:text-xl text-gray-300 mb-6 sm:mb-8",
                  initial: { y: 20, opacity: 0 },
                  animate: { y: 0, opacity: 1 },
                  transition: { delay: 0.5 },
                  children: "Benvenuto in M1SSION, Agente! "
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  className: "flex justify-center gap-2 sm:gap-4 flex-wrap px-2",
                  initial: { y: 20, opacity: 0 },
                  animate: { y: 0, opacity: 1 },
                  transition: { delay: 0.7 },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-3 py-1.5 sm:px-4 sm:py-2 rounded-full bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 text-xs sm:text-sm", children: " +50 PE" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-3 py-1.5 sm:px-4 sm:py-2 rounded-full bg-purple-500/20 border border-purple-500/50 text-purple-400 text-xs sm:text-sm", children: " Rookie" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-3 py-1.5 sm:px-4 sm:py-2 rounded-full bg-yellow-500/20 border border-yellow-500/50 text-yellow-400 text-xs sm:text-sm", children: " Ready" })
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.button,
                {
                  onClick: onComplete,
                  className: "mt-6 sm:mt-8 px-6 sm:px-8 py-2.5 sm:py-3 bg-gradient-to-r from-cyan-600 to-purple-600 text-white font-bold rounded-full shadow-lg hover:shadow-cyan-500/30 transition-all text-sm sm:text-base",
                  initial: { y: 20, opacity: 0 },
                  animate: { y: 0, opacity: 1 },
                  transition: { delay: 1 },
                  whileHover: { scale: 1.05 },
                  whileTap: { scale: 0.95 },
                  children: "INIZIA L'AVVENTURA! "
                }
              )
            ]
          }
        )
      ]
    }
  );
};
function OnboardingOverlay() {
  const {
    isActive,
    currentStep,
    currentStepIndex,
    totalSteps,
    progressPercent,
    isFirstStep,
    isLastStep,
    nextStep,
    prevStep,
    skipOnboarding,
    completeOnboarding
  } = useOnboarding();
  const { user } = useAuthContext();
  const userId = user?.id;
  const [targetEl, setTargetEl] = reactExports.useState(null);
  const [rect, setRect] = reactExports.useState(null);
  const [showCelebration, setShowCelebration] = reactExports.useState(false);
  const hasScrolled = reactExports.useRef(false);
  const skipAttempts = reactExports.useRef(0);
  const findTarget = reactExports.useCallback(() => {
    if (!currentStep?.targetSelector) return null;
    const selectors = currentStep.targetSelector.split(", ");
    for (const selector of selectors) {
      try {
        const el = document.querySelector(selector.trim());
        if (el && el.offsetWidth > 0 && el.offsetHeight > 0) return el;
      } catch (e) {
      }
    }
    return null;
  }, [currentStep]);
  reactExports.useEffect(() => {
    if (!isActive || !currentStep) return;
    const checkElement = () => {
      const el = findTarget();
      if (!el && currentStep.skipIfNotFound) {
        skipAttempts.current++;
        if (skipAttempts.current >= 3) {
          skipAttempts.current = 0;
          nextStep();
        }
      } else {
        skipAttempts.current = 0;
      }
    };
    const timeout = setTimeout(checkElement, 1500);
    return () => clearTimeout(timeout);
  }, [isActive, currentStep, currentStepIndex, findTarget, nextStep]);
  reactExports.useEffect(() => {
    if (!isActive || !currentStep) {
      setTargetEl(null);
      setRect(null);
      return;
    }
    hasScrolled.current = false;
    const update = () => {
      const el = findTarget();
      setTargetEl(el);
      if (el) {
        if (!hasScrolled.current) {
          hasScrolled.current = true;
          setTimeout(() => {
            el.scrollIntoView({
              behavior: "smooth",
              block: "center",
              inline: "center"
            });
          }, 100);
        }
        setTimeout(() => {
          setRect(el.getBoundingClientRect());
        }, hasScrolled.current ? 50 : 400);
      } else {
        setRect(null);
      }
    };
    update();
    const interval = setInterval(update, 500);
    return () => {
      clearInterval(interval);
    };
  }, [isActive, currentStep, currentStepIndex, findTarget]);
  reactExports.useEffect(() => {
    if (!isActive || !targetEl) return;
    const handler = () => {
      hapticSuccess();
      setTimeout(() => {
        if (isLastStep && currentStep?.isFinalStep) {
          setShowCelebration(true);
        } else if (isLastStep) {
          completeOnboarding();
        } else {
          nextStep();
        }
      }, 400);
    };
    targetEl.addEventListener("click", handler);
    return () => targetEl.removeEventListener("click", handler);
  }, [isActive, targetEl, nextStep, completeOnboarding, isLastStep, currentStep]);
  const handleSkip = () => {
    hapticLight();
    skipOnboarding();
  };
  const handlePrev = () => {
    hapticLight();
    prevStep();
  };
  const handleNext = () => {
    hapticLight();
    if (isLastStep && currentStep?.isFinalStep) {
      setShowCelebration(true);
    } else if (isLastStep) {
      completeOnboarding();
    } else {
      nextStep();
    }
  };
  const handleCelebrationComplete = () => {
    setShowCelebration(false);
    completeOnboarding();
  };
  if (showCelebration) {
    return reactDomExports.createPortal(
      /* @__PURE__ */ jsxRuntimeExports.jsx(CelebrationOverlay, { onComplete: handleCelebrationComplete, userId }),
      document.body
    );
  }
  if (!isActive || !currentStep) return null;
  const padding = currentStep.spotlightPadding || 12;
  const hasTarget = rect !== null;
  const isMobile = typeof window !== "undefined" && window.innerWidth < 480;
  const tooltipWidth = isMobile ? Math.min(280, window.innerWidth - 32) : 320;
  const getTooltipStyle = () => {
    const vw = window.innerWidth;
    const vh = window.innerHeight;
    const safeMargin = 16;
    if (!rect) {
      return {
        top: "50%",
        left: "50%",
        transform: "translate(-50%, -50%)",
        maxWidth: `calc(100vw - ${safeMargin * 2}px)`
      };
    }
    const pos = currentStep.position || "bottom";
    const gap = isMobile ? 12 : 20;
    const centerX = rect.left + rect.width / 2;
    const halfTooltip = tooltipWidth / 2;
    const leftPos = Math.max(safeMargin, Math.min(centerX - halfTooltip, vw - tooltipWidth - safeMargin));
    if (isMobile) {
      const spaceBelow = vh - rect.bottom - padding;
      const spaceAbove = rect.top - padding;
      if (spaceBelow > 200 || spaceBelow > spaceAbove) {
        return {
          top: Math.min(rect.bottom + gap + padding, vh - 220),
          left: safeMargin,
          right: safeMargin,
          maxWidth: `calc(100vw - ${safeMargin * 2}px)`
        };
      } else {
        return {
          bottom: vh - rect.top + gap + padding,
          left: safeMargin,
          right: safeMargin,
          maxWidth: `calc(100vw - ${safeMargin * 2}px)`
        };
      }
    }
    if (pos === "top") {
      return {
        bottom: vh - rect.top + gap + padding,
        left: leftPos
      };
    }
    if (pos === "bottom") {
      return {
        top: Math.min(rect.bottom + gap + padding, vh - 250),
        left: leftPos
      };
    }
    if (pos === "left") {
      const rightSpace = vw - rect.left + gap + padding;
      return {
        top: Math.max(100, Math.min(rect.top + rect.height / 2 - 100, vh - 250)),
        right: Math.min(rightSpace, vw - tooltipWidth - safeMargin)
      };
    }
    if (pos === "right") {
      return {
        top: Math.max(100, Math.min(rect.top + rect.height / 2 - 100, vh - 250)),
        left: Math.min(rect.right + gap + padding, vw - tooltipWidth - safeMargin)
      };
    }
    if (pos === "center") {
      return {
        top: "50%",
        left: "50%",
        transform: "translate(-50%, -50%)",
        maxWidth: `calc(100vw - ${safeMargin * 2}px)`
      };
    }
    return {
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%)",
      maxWidth: `calc(100vw - ${safeMargin * 2}px)`
    };
  };
  return reactDomExports.createPortal(
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        exit: { opacity: 0 },
        className: "fixed inset-0 z-[9999]",
        style: { pointerEvents: "none" },
        children: [
          hasTarget ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bg-black/85 pointer-events-auto", style: {
              top: 0,
              left: 0,
              right: 0,
              height: Math.max(0, rect.top - padding)
            } }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bg-black/85 pointer-events-auto", style: {
              top: rect.bottom + padding,
              left: 0,
              right: 0,
              bottom: 0
            } }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bg-black/85 pointer-events-auto", style: {
              top: rect.top - padding,
              left: 0,
              width: Math.max(0, rect.left - padding),
              height: rect.height + padding * 2
            } }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bg-black/85 pointer-events-auto", style: {
              top: rect.top - padding,
              left: rect.right + padding,
              right: 0,
              height: rect.height + padding * 2
            } }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "fixed rounded-xl pointer-events-none",
                style: {
                  top: rect.top - padding,
                  left: rect.left - padding,
                  width: rect.width + padding * 2,
                  height: rect.height + padding * 2,
                  border: currentStep.isFinalStep ? "4px solid #FFD700" : "3px solid #00D1FF",
                  boxShadow: currentStep.isFinalStep ? "0 0 50px rgba(255,215,0,0.6), inset 0 0 30px rgba(255,215,0,0.2)" : "0 0 30px rgba(0,209,255,0.5), inset 0 0 20px rgba(0,209,255,0.1)"
                },
                animate: {
                  boxShadow: currentStep.isFinalStep ? [
                    "0 0 50px rgba(255,215,0,0.6), inset 0 0 30px rgba(255,215,0,0.2)",
                    "0 0 70px rgba(255,89,248,0.6), inset 0 0 40px rgba(255,89,248,0.2)",
                    "0 0 50px rgba(0,209,255,0.6), inset 0 0 30px rgba(0,209,255,0.2)",
                    "0 0 50px rgba(255,215,0,0.6), inset 0 0 30px rgba(255,215,0,0.2)"
                  ] : [
                    "0 0 30px rgba(0,209,255,0.5), inset 0 0 20px rgba(0,209,255,0.1)",
                    "0 0 40px rgba(255,89,248,0.5), inset 0 0 25px rgba(255,89,248,0.1)",
                    "0 0 30px rgba(0,209,255,0.5), inset 0 0 20px rgba(0,209,255,0.1)"
                  ]
                },
                transition: { duration: 1.5, repeat: Infinity }
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "fixed text-4xl pointer-events-none",
                style: {
                  top: rect.top - padding - 50,
                  left: rect.left + rect.width / 2 - 20,
                  filter: currentStep.isFinalStep ? "drop-shadow(0 0 15px rgba(255,215,0,0.9))" : "drop-shadow(0 0 10px rgba(0,209,255,0.8))"
                },
                animate: { y: [0, 10, 0] },
                transition: { duration: 0.8, repeat: Infinity },
                children: currentStep.isFinalStep ? "" : ""
              }
            )
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/85 pointer-events-auto flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              animate: { rotate: 360 },
              transition: { duration: 1, repeat: Infinity, ease: "linear" },
              className: "w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full"
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, scale: 0.9 },
              animate: { opacity: 1, scale: 1 },
              transition: { delay: 0.15 },
              className: "fixed pointer-events-auto z-[10000]",
              style: {
                ...getTooltipStyle(),
                width: isMobile ? "auto" : `${tooltipWidth}px`
              },
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `bg-gray-900/98 backdrop-blur-xl rounded-xl border-2 shadow-[0_0_30px_rgba(0,209,255,0.3)] p-3 ${currentStep.isFinalStep ? "border-yellow-500/60" : "border-cyan-500/60"}`, children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center mb-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: `text-[10px] font-bold ${currentStep.isFinalStep ? "text-yellow-400" : "text-cyan-400"}`, children: [
                    currentStepIndex + 1,
                    "/",
                    totalSteps
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("button", { onClick: handleSkip, className: "p-0.5 hover:bg-white/10 rounded-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx(X, { className: "w-3 h-3 text-gray-400" }) })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-sm font-bold text-white mb-1 flex items-center gap-1.5", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg", children: currentStep.icon }),
                  currentStep.title
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-300 mb-2 leading-snug", children: currentStep.description }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-1 bg-gray-700 rounded-full mb-2 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: `h-full ${currentStep.isFinalStep ? "bg-gradient-to-r from-yellow-500 to-pink-500" : "bg-gradient-to-r from-cyan-500 to-pink-500"}`,
                    initial: { width: 0 },
                    animate: { width: `${progressPercent}%` },
                    transition: { duration: 0.3 }
                  }
                ) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("button", { onClick: handleSkip, className: "text-[10px] text-gray-400 hover:text-white", children: "Salta" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-1.5", children: [
                    !isFirstStep && /* @__PURE__ */ jsxRuntimeExports.jsx("button", { onClick: handlePrev, className: "px-2 py-1 bg-gray-700/50 text-white text-[10px] rounded-md", children: "" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "button",
                      {
                        onClick: handleNext,
                        className: `px-3 py-1.5 text-white text-[11px] font-bold rounded-md flex items-center shadow-md ${currentStep.isFinalStep ? "bg-gradient-to-r from-yellow-500 to-pink-500" : "bg-gradient-to-r from-cyan-600 to-purple-600"}`,
                        children: currentStep.isFinalStep ? " Fine" : "Avanti "
                      }
                    )
                  ] })
                ] })
              ] })
            },
            `tooltip-${currentStepIndex}`
          )
        ]
      },
      `onboarding-${currentStepIndex}`
    ) }),
    document.body
  );
}

const RouteAnnouncer = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      id: "route-announcer",
      role: "status",
      "aria-live": "polite",
      "aria-atomic": "true",
      className: "sr-only"
    }
  );
};

const ROUTE_TITLES_IT = {
  "/": "Home",
  "/home": "Home",
  "/map": "Mappa",
  "/buzz": "Buzz",
  "/intelligence": "Intelligence",
  "/notifications": "Notifiche",
  "/leaderboard": "Classifica",
  "/profile": "Profilo",
  "/settings": "Impostazioni",
  "/subscriptions": "Abbonamenti",
  "/login": "Accesso",
  "/register": "Registrazione"
};
function getRouteTitle(path, locale = "it") {
  const title = ROUTE_TITLES_IT[path];
  if (title) {
    return title;
  }
  return path.replace(/^\//, "").replace(/-/g, " ").replace(/\//g, "  ").trim() || "Home";
}

const useRouteAnnouncements = () => {
  const [location] = useLocation();
  const timeoutRef = reactExports.useRef(null);
  const lastAnnouncedRef = reactExports.useRef("");
  reactExports.useEffect(() => {
    window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    timeoutRef.current = setTimeout(() => {
      const announcer = document.getElementById("route-announcer");
      if (!announcer) {
        return;
      }
      const routeTitle = getRouteTitle(location);
      const announcement = `Navigato a ${routeTitle}`;
      if (announcement === lastAnnouncedRef.current) {
        return;
      }
      announcer.textContent = "";
      setTimeout(() => {
        announcer.textContent = announcement;
        lastAnnouncedRef.current = announcement;
      }, 50);
    }, 100);
    return () => {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current);
      }
    };
  }, [location]);
};

const ReconnectBadge = () => {
  const [isVisible, setIsVisible] = reactExports.useState(false);
  const [isBottom, setIsBottom] = reactExports.useState(false);
  const [hideTimeout, setHideTimeout] = reactExports.useState(null);
  const throttleTimeout = reactExports.useRef(null);
  const lastEvent = reactExports.useRef("");
  reactExports.useEffect(() => {
    if (!isVisible) return;
    const checkToastPresence = () => {
      const hasToast = document.body.hasAttribute("data-has-toast") || document.querySelector("[data-sonner-toaster]") !== null || document.querySelector(".sonner") !== null;
      setIsBottom(hasToast);
    };
    checkToastPresence();
    const interval = setInterval(checkToastPresence, 500);
    return () => clearInterval(interval);
  }, [isVisible]);
  reactExports.useEffect(() => {
    const handleReconnecting = (detail) => {
      const eventKey = `reconnecting:${detail.channelName || "global"}:${detail.timestamp}`;
      if (lastEvent.current === eventKey) {
        return;
      }
      if (throttleTimeout.current) {
        return;
      }
      lastEvent.current = eventKey;
      throttleTimeout.current = setTimeout(() => {
        throttleTimeout.current = null;
      }, 300);
      setIsVisible(true);
      if (hideTimeout) {
        clearTimeout(hideTimeout);
      }
      const timeout = setTimeout(() => {
        setIsVisible(false);
        lastEvent.current = "";
      }, 3e3);
      setHideTimeout(timeout);
    };
    const unsubscribeReconnecting = onReconnectEvent(RECONNECT_EVENTS.RECONNECTING, handleReconnecting);
    const unsubscribeSubscribed = onReconnectEvent(RECONNECT_EVENTS.SUBSCRIBED, () => {
      if (hideTimeout) {
        clearTimeout(hideTimeout);
      }
      if (throttleTimeout.current) {
        clearTimeout(throttleTimeout.current);
        throttleTimeout.current = null;
      }
      setIsVisible(false);
      lastEvent.current = "";
    });
    const unsubscribeError = onReconnectEvent(RECONNECT_EVENTS.ERROR, () => {
      if (hideTimeout) {
        clearTimeout(hideTimeout);
      }
    });
    return () => {
      unsubscribeReconnecting();
      unsubscribeSubscribed();
      unsubscribeError();
      if (hideTimeout) {
        clearTimeout(hideTimeout);
      }
      if (throttleTimeout.current) {
        clearTimeout(throttleTimeout.current);
      }
    };
  }, [hideTimeout]);
  if (!isVisible) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `reconnect-badge ${isBottom ? "reconnect-bottom" : ""}`, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "reconnect-badge-content", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "svg",
      {
        className: "reconnect-badge-spinner",
        width: "16",
        height: "16",
        viewBox: "0 0 24 24",
        fill: "none",
        xmlns: "http://www.w3.org/2000/svg",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "path",
          {
            d: "M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83",
            stroke: "currentColor",
            strokeWidth: "2",
            strokeLinecap: "round",
            strokeLinejoin: "round"
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "reconnect-badge-text", children: "Reconnecting" })
  ] }) });
};

const CONNECTION_STATE_COLORS = {
  INIT: "bg-gray-500",
  CONNECTING: "bg-yellow-500",
  SUBSCRIBED: "bg-green-500",
  HEARTBEAT: "bg-blue-500 animate-pulse",
  ERROR: "bg-red-500",
  CLOSED: "bg-gray-700"
};
const CONNECTION_STATE_LABELS = {
  INIT: "Initializing",
  CONNECTING: "Connecting...",
  SUBSCRIBED: "Connected",
  HEARTBEAT: "Heartbeat ",
  ERROR: "Error",
  CLOSED: "Disconnected"
};
const M1UnitsDebugPanel = () => {
  const [userId, setUserId] = reactExports.useState(void 0);
  const [logs, setLogs] = reactExports.useState([]);
  const [showPanel, setShowPanel] = reactExports.useState(false);
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const isDev = window.location.hostname === "localhost";
    const devAccess = localStorage.getItem("developer_access") === "true";
    setShowPanel(isDev || devAccess);
  }, []);
  reactExports.useEffect(() => {
    const getUser = async () => {
      const { data } = await supabase.auth.getUser();
      if (data.user) {
        setUserId(data.user.id);
        addLog(`User ID: ${data.user.id}`);
      } else {
        addLog("No authenticated user");
      }
    };
    getUser();
  }, []);
  const { unitsData, connectionState, isLoading, error, ping, refetch } = useM1UnitsRealtime(userId);
  const addLog = (message) => {
    const timestamp = (/* @__PURE__ */ new Date()).toLocaleTimeString();
    setLogs((prev) => [`[${timestamp}] ${message}`, ...prev.slice(0, 19)]);
  };
  reactExports.useEffect(() => {
    if (connectionState !== "INIT") {
      addLog(`Connection: ${CONNECTION_STATE_LABELS[connectionState]}`);
    }
  }, [connectionState]);
  reactExports.useEffect(() => {
    if (unitsData) {
      addLog(`Balance updated: ${unitsData.balance} M1U`);
    }
  }, [unitsData?.balance]);
  reactExports.useEffect(() => {
    if (error) {
      addLog(` Error: ${error}`);
    }
  }, [error]);
  const handlePing = async () => {
    addLog(" Sending ping...");
    await ping();
  };
  const handleFakeUpdate = async () => {
    if (!userId) return;
    addLog(" Triggering fake update (+1 M1U)...");
    const { error: updateError } = await supabase.rpc("m1u_fake_update", { _delta: 1 });
    if (updateError) {
      addLog(` Fake update failed: ${updateError.message}`);
    } else {
      addLog(" Fake update sent (+1 M1U)");
      await refetch();
    }
  };
  const handleRefetch = async () => {
    addLog(" Refetching data...");
    await refetch();
  };
  if (!showPanel) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bottom-4 right-4 z-[9999] max-w-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/90 border-cyan-500/50 backdrop-blur-sm", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-3 cursor-pointer", onClick: () => setIsExpanded(!isExpanded), children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-cyan-400 text-sm font-mono flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-2", children: [
        "M1U DEBUG PANEL",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-300/60 text-xs", children: isExpanded ? "" : "" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: CONNECTION_STATE_COLORS[connectionState], children: CONNECTION_STATE_LABELS[connectionState] })
    ] }) }),
    isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3 animate-accordion-down", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-cyan-950/30 p-3 rounded border border-cyan-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-cyan-300/70 mb-1", children: "Current Balance" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-cyan-400", children: isLoading ? "..." : unitsData ? `${unitsData.balance} M1U` : "No data" }),
        unitsData && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-cyan-300/50 mt-1", children: [
          "Earned: ",
          unitsData.total_earned,
          " | Spent: ",
          unitsData.total_spent
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handlePing,
            disabled: !userId || connectionState === "ERROR",
            size: "sm",
            variant: "outline",
            className: "flex-1 border-cyan-500/50 text-cyan-400 hover:bg-cyan-950/30",
            children: "Ping"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleFakeUpdate,
            disabled: !userId || connectionState === "ERROR",
            size: "sm",
            variant: "outline",
            className: "flex-1 border-yellow-500/50 text-yellow-400 hover:bg-yellow-950/30",
            children: "Fake Update"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleRefetch,
            disabled: !userId,
            size: "sm",
            variant: "outline",
            className: "flex-1 border-gray-500/50 text-gray-400 hover:bg-gray-950/30",
            children: "Refetch"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/50 p-2 rounded border border-cyan-500/20 max-h-40 overflow-y-auto", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-cyan-300/70 mb-1", children: "Console Log" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-1 font-mono text-xs", children: logs.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-gray-500", children: "Waiting for events..." }) : logs.map((log, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-cyan-300/80", children: log }, i)) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-cyan-300/50 text-center font-mono", children: userId ? `Channel: m1_units_user_${userId.slice(0, 8)}...` : "Not authenticated" })
    ] })
  ] }) });
};

const GA4_ID = "G-XXXXXXXXXX";
let gaInitialized = false;
function initGA4() {
  if (gaInitialized || typeof window === "undefined") return;
  const consent = getStoredConsent();
  const hasConsent = consent?.status === "accepted" || consent?.status === "granular" && consent?.preferences?.analytics;
  if (!hasConsent) {
    return;
  }
  const script = document.createElement("script");
  script.async = true;
  script.src = `https://www.googletagmanager.com/gtag/js?id=${GA4_ID}`;
  document.head.appendChild(script);
  window.dataLayer = window.dataLayer || [];
  function gtag(...args) {
    window.dataLayer.push(args);
  }
  gtag("js", /* @__PURE__ */ new Date());
  gtag("config", GA4_ID, {
    anonymize_ip: true,
    allow_ad_personalization_signals: false
  });
  window.gtag = gtag;
  gaInitialized = true;
}
function trackEvent(eventName, params) {
  if (!gaInitialized || typeof window === "undefined") return;
  const gtag = window.gtag;
  if (gtag) {
    gtag("event", eventName, params);
  }
}
function trackPageView(path, title) {
  if (!gaInitialized) return;
  trackEvent("page_view", {
    page_path: path,
    page_title: document.title
  });
}
function trackMarkerRewardClaimed(markerId, rewardType) {
  trackEvent("marker_reward_claimed", {
    marker_id: markerId,
    reward_type: rewardType,
    timestamp: (/* @__PURE__ */ new Date()).toISOString()
  });
}

const ga4 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  initGA4,
  trackEvent,
  trackMarkerRewardClaimed,
  trackPageView
}, Symbol.toStringTag, { value: 'Module' }));

const usePullToRefresh = (options = {}) => {
  const {
    onRefresh = () => window.location.reload(),
    threshold = 150,
    enabled = true
  } = options;
  const [isPulling, setIsPulling] = reactExports.useState(false);
  const [pullDistance, setPullDistance] = reactExports.useState(0);
  const [isRefreshing, setIsRefreshing] = reactExports.useState(false);
  const startY = reactExports.useRef(0);
  const currentY = reactExports.useRef(0);
  reactExports.useEffect(() => {
    if (!enabled) return;
    const handleTouchStart = (e) => {
      if (window.scrollY <= 0) {
        startY.current = e.touches[0].clientY;
        setIsPulling(true);
      }
    };
    const handleTouchMove = (e) => {
      if (!isPulling || isRefreshing) return;
      currentY.current = e.touches[0].clientY;
      const distance = currentY.current - startY.current;
      if (distance > 0 && window.scrollY <= 0) {
        const resistedDistance = Math.min(distance * 0.5, threshold * 1.5);
        setPullDistance(resistedDistance);
        if (distance > 10) {
          e.preventDefault();
        }
      }
    };
    const handleTouchEnd = async () => {
      if (!isPulling || isRefreshing) return;
      if (pullDistance >= threshold) {
        setIsRefreshing(true);
        setPullDistance(threshold);
        try {
          await onRefresh();
        } catch (error) {
        }
        setTimeout(() => {
          setIsRefreshing(false);
          setPullDistance(0);
          setIsPulling(false);
        }, 500);
      } else {
        setPullDistance(0);
        setIsPulling(false);
      }
      startY.current = 0;
      currentY.current = 0;
    };
    document.addEventListener("touchstart", handleTouchStart, { passive: true });
    document.addEventListener("touchmove", handleTouchMove, { passive: false });
    document.addEventListener("touchend", handleTouchEnd, { passive: true });
    return () => {
      document.removeEventListener("touchstart", handleTouchStart);
      document.removeEventListener("touchmove", handleTouchMove);
      document.removeEventListener("touchend", handleTouchEnd);
    };
  }, [enabled, isPulling, isRefreshing, pullDistance, threshold, onRefresh]);
  return {
    isPulling,
    pullDistance,
    isRefreshing,
    progress: Math.min(pullDistance / threshold, 1),
    // 0 to 1
    shouldRefresh: pullDistance >= threshold
  };
};

const PullToRefreshIndicator = ({
  pullDistance,
  isRefreshing,
  progress,
  threshold = 150
}) => {
  if (pullDistance <= 0 && !isRefreshing) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "fixed left-0 right-0 flex justify-center pointer-events-none z-[9999]",
      style: {
        top: `calc(env(safe-area-inset-top, 0px) + ${Math.min(pullDistance, threshold)}px - 60px)`
      },
      initial: { opacity: 0 },
      animate: { opacity: pullDistance > 20 ? 1 : 0 },
      transition: { duration: 0.2 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "flex items-center justify-center w-12 h-12 rounded-full",
            style: {
              background: "linear-gradient(180deg, #2A3441 0%, #1E2630 100%)",
              boxShadow: "0 4px 20px rgba(0, 209, 255, 0.3)",
              border: "1px solid rgba(0, 209, 255, 0.3)"
            },
            animate: {
              scale: isRefreshing ? 1 : 0.8 + progress * 0.2,
              rotate: isRefreshing ? 360 : progress * 180
            },
            transition: {
              rotate: isRefreshing ? { duration: 1, repeat: Infinity, ease: "linear" } : { duration: 0 },
              scale: { duration: 0.2 }
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              RefreshCw,
              {
                className: "w-6 h-6",
                style: {
                  color: progress >= 1 || isRefreshing ? "#00D1FF" : "#8B9CAF",
                  filter: progress >= 1 || isRefreshing ? "drop-shadow(0 0 8px rgba(0, 209, 255, 0.8))" : "none"
                }
              }
            )
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "svg",
          {
            className: "absolute w-14 h-14",
            style: { transform: "rotate(-90deg)" },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "circle",
                {
                  cx: "28",
                  cy: "28",
                  r: "24",
                  fill: "none",
                  stroke: "rgba(0, 209, 255, 0.2)",
                  strokeWidth: "2"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.circle,
                {
                  cx: "28",
                  cy: "28",
                  r: "24",
                  fill: "none",
                  stroke: "#00D1FF",
                  strokeWidth: "2",
                  strokeLinecap: "round",
                  strokeDasharray: 150,
                  animate: {
                    strokeDashoffset: isRefreshing ? 0 : 150 - progress * 150
                  },
                  style: {
                    filter: "drop-shadow(0 0 4px rgba(0, 209, 255, 0.6))"
                  }
                }
              )
            ]
          }
        )
      ]
    }
  );
};

function triggerTVShutdownEffect() {
  const overlay = document.createElement("div");
  overlay.id = "glitch-tv-shutdown";
  overlay.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 999999;
    pointer-events: none;
    background: transparent;
  `;
  document.body.appendChild(overlay);
  const glitchPhase = () => {
    document.body.style.animation = "tvGlitch 0.1s steps(2) infinite";
    document.body.style.filter = "contrast(1.2) brightness(0.9)";
    const scanlines = document.createElement("div");
    scanlines.className = "glitch-scanlines";
    scanlines.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.2) 0px,
        rgba(0, 0, 0, 0.2) 1px,
        transparent 1px,
        transparent 3px
      );
      animation: scanlineRoll 0.5s linear infinite;
    `;
    overlay.appendChild(scanlines);
    for (let i = 0; i < 5; i++) {
      setTimeout(() => {
        const bar = document.createElement("div");
        bar.style.cssText = `
          position: absolute;
          left: 0;
          right: 0;
          height: ${Math.random() * 30 + 10}px;
          top: ${Math.random() * 100}%;
          background: rgba(255, 255, 255, ${Math.random() * 0.3});
          transform: translateX(${(Math.random() - 0.5) * 20}px);
        `;
        overlay.appendChild(bar);
        setTimeout(() => bar.remove(), 100);
      }, i * 200);
    }
  };
  const crtShutdownPhase = () => {
    document.body.style.animation = "none";
    document.body.style.filter = "";
    overlay.innerHTML = "";
    overlay.style.background = "black";
    const crtScreen = document.createElement("div");
    crtScreen.style.cssText = `
      position: absolute;
      left: 0;
      width: 100%;
      top: 0;
      height: 100%;
      background: linear-gradient(180deg, rgba(0,209,255,0.1) 0%, rgba(255,255,255,0.9) 50%, rgba(0,209,255,0.1) 100%);
      transition: top 0.4s cubic-bezier(0.4, 0, 0.2, 1), height 0.4s cubic-bezier(0.4, 0, 0.2, 1), background 0.4s ease;
      box-shadow: 0 0 30px rgba(0,209,255,0.5);
    `;
    overlay.appendChild(crtScreen);
    requestAnimationFrame(() => {
      crtScreen.style.top = "calc(50% - 2px)";
      crtScreen.style.height = "4px";
      crtScreen.style.background = "linear-gradient(90deg, rgba(0,209,255,0.5) 0%, white 50%, rgba(0,209,255,0.5) 100%)";
      crtScreen.style.boxShadow = "0 0 20px rgba(0,209,255,0.8), 0 0 40px rgba(0,209,255,0.4), 0 0 60px rgba(255,255,255,0.3)";
    });
    setTimeout(() => {
      crtScreen.style.transition = "all 0.35s cubic-bezier(0.4, 0, 0.2, 1)";
      crtScreen.style.left = "calc(50% - 5px)";
      crtScreen.style.width = "10px";
      crtScreen.style.top = "calc(50% - 5px)";
      crtScreen.style.height = "10px";
      crtScreen.style.borderRadius = "50%";
      crtScreen.style.background = "white";
      crtScreen.style.boxShadow = "0 0 20px white, 0 0 40px rgba(0,209,255,1), 0 0 60px rgba(0,209,255,0.6)";
    }, 420);
    setTimeout(() => {
      crtScreen.style.transition = "all 0.2s ease-out";
      crtScreen.style.transform = "scale(2)";
      crtScreen.style.boxShadow = "0 0 40px white, 0 0 80px rgba(0,209,255,1), 0 0 120px rgba(0,209,255,0.8), 0 0 160px rgba(255,255,255,0.4)";
    }, 780);
    setTimeout(() => {
      crtScreen.style.transition = "all 0.15s ease-in";
      crtScreen.style.transform = "scale(0)";
      crtScreen.style.opacity = "0";
      crtScreen.style.boxShadow = "0 0 0 transparent";
    }, 950);
  };
  const blackScreenPhase = () => {
    overlay.innerHTML = "";
    overlay.style.background = "black";
  };
  const fadeBackPhase = () => {
    overlay.style.transition = "opacity 0.3s ease-out";
    overlay.style.opacity = "0";
  };
  const cleanupPhase = () => {
    document.body.style.animation = "";
    document.body.style.filter = "";
    overlay.remove();
  };
  const style = document.createElement("style");
  style.id = "glitch-keyframes";
  style.textContent = `
    @keyframes tvGlitch {
      0%, 100% { transform: translate(0, 0) skew(0deg); filter: hue-rotate(0deg); }
      20% { transform: translate(-2px, 1px) skew(0.5deg); filter: hue-rotate(90deg); }
      40% { transform: translate(2px, -1px) skew(-0.5deg); filter: hue-rotate(180deg); }
      60% { transform: translate(-1px, 2px) skew(0.3deg); filter: hue-rotate(270deg); }
      80% { transform: translate(1px, -2px) skew(-0.3deg); filter: hue-rotate(360deg); }
    }
    @keyframes scanlineRoll {
      0% { transform: translateY(0); }
      100% { transform: translateY(6px); }
    }
  `;
  document.head.appendChild(style);
  glitchPhase();
  setTimeout(crtShutdownPhase, 2e3);
  setTimeout(blackScreenPhase, 3100);
  setTimeout(fadeBackPhase, 3400);
  setTimeout(cleanupPhase, 3700);
  setTimeout(() => {
    const styleEl = document.getElementById("glitch-keyframes");
    if (styleEl) styleEl.remove();
  }, 3800);
}
function useGlobalGlitchListener() {
  reactExports.useEffect(() => {
    const channel = supabase.channel("global-glitch").on("broadcast", { event: "glitch" }, (payload) => {
      triggerTVShutdownEffect();
    }).subscribe((status) => {
    });
    return () => {
      supabase.removeChannel(channel);
    };
  }, []);
}
async function broadcastGlobalGlitch() {
  try {
    const channel = supabase.channel("global-glitch");
    await channel.subscribe();
    await channel.send({
      type: "broadcast",
      event: "glitch",
      payload: {
        timestamp: Date.now(),
        type: "tv-shutdown"
      }
    });
    triggerTVShutdownEffect();
    setTimeout(() => {
      supabase.removeChannel(channel);
    }, 1e3);
    return true;
  } catch (error) {
    return false;
  }
}

const EntityMessage = ({
  text,
  typingSpeed = 25,
  onTypingEnd,
  className = ""
}) => {
  const [visibleChars, setVisibleChars] = reactExports.useState(0);
  const [isComplete, setIsComplete] = reactExports.useState(false);
  const intervalRef = reactExports.useRef(null);
  const mountedRef = reactExports.useRef(true);
  const cleanup = reactExports.useCallback(() => {
    if (intervalRef.current !== null) {
      window.clearInterval(intervalRef.current);
      intervalRef.current = null;
    }
  }, []);
  reactExports.useEffect(() => {
    mountedRef.current = true;
    setVisibleChars(0);
    setIsComplete(false);
    cleanup();
    intervalRef.current = window.setInterval(() => {
      if (!mountedRef.current) {
        cleanup();
        return;
      }
      setVisibleChars((prev) => {
        const next = prev + 1;
        if (next >= text.length) {
          cleanup();
          setIsComplete(true);
          if (onTypingEnd) {
            setTimeout(() => {
              if (mountedRef.current) {
                onTypingEnd();
              }
            }, 100);
          }
        }
        return next;
      });
    }, typingSpeed);
    return () => {
      mountedRef.current = false;
      cleanup();
    };
  }, [text, typingSpeed, onTypingEnd, cleanup]);
  const visibleText = text.slice(0, visibleChars);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("pre", { className: `shadow-entity-message ${className}`, children: [
    visibleText,
    !isComplete && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-entity-cursor", children: "" })
  ] });
};

function useGlobalGlitchEffect() {
  const glitchTimeoutRef = reactExports.useRef(null);
  const prefersReducedMotion = reactExports.useRef(false);
  const currentEvent = useEntityOverlayStore(selectCurrentEvent);
  const isGlobalGlitchActive = useEntityOverlayStore(selectIsGlobalGlitchActive);
  const globalGlitchIntensity = useEntityOverlayStore(selectGlobalGlitchIntensity);
  const triggerGlobalGlitch = useEntityOverlayStore((s) => s.triggerGlobalGlitch);
  const endGlobalGlitch = useEntityOverlayStore((s) => s.endGlobalGlitch);
  reactExports.useEffect(() => {
    if (typeof window === "undefined") return;
    const mediaQuery = window.matchMedia("(prefers-reduced-motion: reduce)");
    prefersReducedMotion.current = mediaQuery.matches;
    const handler = (e) => {
      prefersReducedMotion.current = e.matches;
    };
    mediaQuery.addEventListener("change", handler);
    return () => mediaQuery.removeEventListener("change", handler);
  }, []);
  reactExports.useEffect(() => {
    if (typeof document === "undefined") return;
    const root = document.documentElement;
    if (isGlobalGlitchActive && !prefersReducedMotion.current) {
      root.classList.add("shadow-global-glitch-active");
      root.style.setProperty("--global-glitch-intensity", String(globalGlitchIntensity));
    } else {
      root.classList.remove("shadow-global-glitch-active");
      root.style.removeProperty("--global-glitch-intensity");
    }
  }, [isGlobalGlitchActive, globalGlitchIntensity]);
  reactExports.useEffect(() => {
    if (prefersReducedMotion.current) return;
    if (!currentEvent) return;
    if (currentEvent.entity !== "SHADOW" || currentEvent.intensity < 2) return;
    const intensity = currentEvent.intensity === 3 ? 1 : 0.6;
    triggerGlobalGlitch(intensity);
    glitchTimeoutRef.current = window.setTimeout(() => {
      endGlobalGlitch();
    }, SHADOW_GLITCH_TIMING.GLOBAL_GLITCH_DURATION_MS);
    return () => {
      if (glitchTimeoutRef.current !== null) {
        window.clearTimeout(glitchTimeoutRef.current);
        glitchTimeoutRef.current = null;
      }
    };
  }, [currentEvent, triggerGlobalGlitch, endGlobalGlitch]);
  reactExports.useEffect(() => {
    return () => {
      if (glitchTimeoutRef.current !== null) {
        window.clearTimeout(glitchTimeoutRef.current);
        glitchTimeoutRef.current = null;
      }
      if (typeof document !== "undefined") {
        document.documentElement.classList.remove("shadow-global-glitch-active");
        document.documentElement.style.removeProperty("--global-glitch-intensity");
      }
    };
  }, []);
  return {
    isGlitching: isGlobalGlitchActive,
    intensity: globalGlitchIntensity
  };
}

const PRIORITY_ORDER = {
  low: 1,
  medium: 2,
  high: 3,
  critical: 4
};
const engineState = {
  isActive: false,
  currentGlitch: null,
  queue: [],
  registeredComponents: /* @__PURE__ */ new Map(),
  heatMeter: 0,
  lastGlitchTime: 0,
  whisperQueue: [],
  isWhisperActive: false
};
const GLITCH_CLASSES = {
  noise: "shadow-glitch-noise",
  tearing: "shadow-glitch-tearing",
  pixelSort: "shadow-glitch-pixel-sort",
  channelShift: "shadow-glitch-channel-shift",
  turbulence: "shadow-glitch-turbulence",
  skewFlicker: "shadow-glitch-skew-flicker",
  blackoutFlash: "shadow-glitch-blackout",
  vignettePulse: "shadow-glitch-vignette-pulse",
  cameraShake: "shadow-glitch-camera-shake",
  terrainWarp: "shadow-glitch-terrain-warp"
};
function getTargetElement(target) {
  if (!target || target === "global") {
    return document.documentElement;
  }
  return document.querySelector(target);
}
function prefersReducedMotion() {
  if (typeof window === "undefined") return true;
  return window.matchMedia("(prefers-reduced-motion: reduce)").matches;
}
function executeGlitch(config) {
  return new Promise((resolve) => {
    if (prefersReducedMotion()) {
      resolve();
      return;
    }
    const element = getTargetElement(config.target);
    if (!element) {
      resolve();
      return;
    }
    const className = GLITCH_CLASSES[config.type];
    if (!className) {
      resolve();
      return;
    }
    element.classList.add(className);
    element.style.setProperty("--glitch-intensity", String(config.intensity));
    engineState.isActive = true;
    engineState.currentGlitch = config;
    engineState.lastGlitchTime = Date.now();
    setTimeout(() => {
      element.classList.remove(className);
      element.style.removeProperty("--glitch-intensity");
      engineState.isActive = false;
      engineState.currentGlitch = null;
      config.callback?.();
      resolve();
    }, config.duration);
  });
}
async function processQueue() {
  if (engineState.isActive || engineState.queue.length === 0) return;
  engineState.queue.sort(
    (a, b) => PRIORITY_ORDER[b.priority] - PRIORITY_ORDER[a.priority]
  );
  const next = engineState.queue.shift();
  if (next) {
    await executeGlitch(next);
    setTimeout(processQueue, 50);
  }
}
const ShadowGlitchEngine = {
  /**
   * Register a component that can receive glitch effects
   */
  registerGlitchableComponent(id, ref, priority = "medium") {
    engineState.registeredComponents.set(id, { id, ref, priority });
  },
  /**
   * Unregister a component
   */
  unregisterComponent(id) {
    engineState.registeredComponents.delete(id);
  },
  /**
   * Trigger a random page glitch
   */
  triggerRandomPageGlitch(intensity) {
    const store = useEntityOverlayStore.getState();
    const threatLevel = store.shadowThreatLevel;
    const category = getThreatLevelCategory(threatLevel);
    const baseIntensity = intensity ?? (category === "HIGH" ? 0.9 : category === "MEDIUM" ? 0.6 : 0.3);
    const pageGlitchTypes = ["noise", "tearing", "channelShift", "skewFlicker"];
    const type = pageGlitchTypes[Math.floor(Math.random() * pageGlitchTypes.length)];
    const config = {
      type,
      duration: 150 + Math.random() * 200,
      // 150-350ms
      intensity: baseIntensity,
      priority: "medium",
      target: "global"
    };
    engineState.queue.push(config);
    processQueue();
  },
  /**
   * Trigger map-specific distortion
   */
  triggerMapDistortion(mapContainerSelector = "#ml-sandbox") {
    const store = useEntityOverlayStore.getState();
    const threatLevel = store.shadowThreatLevel;
    const category = getThreatLevelCategory(threatLevel);
    const intensity = category === "HIGH" ? 0.8 : category === "MEDIUM" ? 0.5 : 0.3;
    const effects = [
      {
        type: "terrainWarp",
        duration: 400,
        intensity,
        priority: "high",
        target: mapContainerSelector
      },
      {
        type: "cameraShake",
        duration: 200,
        intensity: intensity * 0.7,
        priority: "high",
        target: mapContainerSelector
      }
    ];
    effects.forEach((e) => engineState.queue.push(e));
    processQueue();
  },
  /**
   * Trigger full Shadow takeover sequence
   */
  async triggerShadowTakeover(callback) {
    if (prefersReducedMotion()) {
      callback?.();
      return;
    }
    const sequence = [
      { type: "blackoutFlash", duration: 120, intensity: 1, priority: "critical", target: "global" },
      { type: "channelShift", duration: 200, intensity: 0.9, priority: "critical", target: "global" },
      { type: "tearing", duration: 300, intensity: 0.8, priority: "critical", target: "global" },
      { type: "noise", duration: 150, intensity: 1, priority: "critical", target: "global" },
      { type: "vignettePulse", duration: 500, intensity: 0.9, priority: "critical", target: "global" }
    ];
    for (const effect of sequence) {
      await executeGlitch(effect);
      await new Promise((r) => setTimeout(r, 50));
    }
    callback?.();
  },
  /**
   * Trigger redirect with glitch effect
   */
  triggerRedirectCTA(path, navigate) {
    const config = {
      type: "blackoutFlash",
      duration: 100,
      intensity: 0.7,
      priority: "high",
      target: "global",
      callback: () => {
        setTimeout(() => navigate(path), 50);
      }
    };
    engineState.queue.push(config);
    processQueue();
  },
  /**
   * Shadow Whisper Mode - micro-overlay in bottom-left
   * Dispatches custom event for React layer to handle
   */
  triggerWhisper(text) {
    if (prefersReducedMotion()) return;
    window.dispatchEvent(new CustomEvent("shadow:whisper", { detail: { text } }));
  },
  /**
   * Increase heat meter (spam detection)
   *  v7: Now syncs to threat level at thresholds
   */
  increaseHeat(amount) {
    const previousHeat = engineState.heatMeter;
    engineState.heatMeter = Math.min(100, engineState.heatMeter + amount);
    if (engineState.heatMeter >= 80) {
      ShadowGlitchEngine.triggerRandomPageGlitch(0.9);
    } else if (engineState.heatMeter >= 50) {
      ShadowGlitchEngine.triggerRandomPageGlitch(0.5);
    }
    const crossedThreshold70 = previousHeat < 70 && engineState.heatMeter >= 70;
    const crossedThreshold90 = previousHeat < 90 && engineState.heatMeter >= 90;
    if (crossedThreshold70 || crossedThreshold90) {
      this.syncToThreatLevel();
    }
  },
  /**
   * Decrease heat over time (called periodically)
   */
  coolDown(amount = 1) {
    engineState.heatMeter = Math.max(0, engineState.heatMeter - amount);
  },
  /**
   * Get current heat level
   */
  getHeatLevel() {
    return engineState.heatMeter;
  },
  /**
   * Shadow Crosshair - brief targeting overlay
   * Dispatches custom event for React layer to handle
   */
  triggerCrosshair(_duration = 800) {
    if (prefersReducedMotion()) return;
    window.dispatchEvent(new CustomEvent("shadow:crosshair"));
  },
  /**
   * Shadow Timeline Skip - black flash
   * Dispatches custom event for React layer to handle
   */
  triggerTimelineSkip() {
    if (prefersReducedMotion()) return;
    window.dispatchEvent(new CustomEvent("shadow:timelineSkip"));
  },
  /**
   * Shadow Breath Pattern - pulsing vignette
   * Dispatches custom event for React layer to handle
   */
  triggerBreathPattern(intensity = 0.5) {
    if (prefersReducedMotion()) return;
    window.dispatchEvent(new CustomEvent("shadow:breathPattern", { detail: { intensity } }));
  },
  /**
   * Shadow Interrupt - immediate overlay for spam detection
   * Dispatches custom event for React layer to handle
   */
  triggerInterrupt(message) {
    if (prefersReducedMotion()) return;
    ShadowGlitchEngine.triggerRandomPageGlitch(1);
    setTimeout(() => {
      window.dispatchEvent(new CustomEvent("shadow:interrupt", { detail: { text: message } }));
    }, 200);
  },
  /**
   * Highlight a UI component with pulse effect
   */
  highlightComponent(componentId) {
    const component = engineState.registeredComponents.get(componentId);
    if (!component?.ref.current) return;
    component.ref.current.classList.add("shadow-highlight-pulse");
    setTimeout(() => {
      component.ref.current?.classList.remove("shadow-highlight-pulse");
    }, 2e3);
  },
  /**
   * Pulse the BUZZ button
   */
  pulseBuzzButton() {
    const buzzBtn = document.querySelector("[data-buzz-button]");
    if (buzzBtn) {
      buzzBtn.classList.add("shadow-pulse-buzz");
      setTimeout(() => buzzBtn.classList.remove("shadow-pulse-buzz"), 2e3);
    }
  },
  /**
   * Flash a map zone
   */
  flashMapZone(lat, lon) {
  },
  /**
   * Get engine status for debugging
   */
  getStatus() {
    return { ...engineState };
  },
  /**
   * Shadow Map Jammer - distort isolated map tiles with blur/grayscale
   */
  triggerMapJammer(tiles = 3) {
    if (prefersReducedMotion()) return;
    const mapContainer = document.querySelector("#ml-sandbox");
    if (!mapContainer) return;
    let jammer = document.getElementById("shadow-map-jammer");
    if (!jammer) {
      jammer = document.createElement("div");
      jammer.id = "shadow-map-jammer";
      jammer.className = "shadow-map-jammer";
      mapContainer.appendChild(jammer);
    }
    const jammerSpots = [];
    for (let i = 0; i < tiles; i++) {
      const spot = document.createElement("div");
      spot.className = "shadow-jammer-spot";
      spot.style.left = `${10 + Math.random() * 80}%`;
      spot.style.top = `${10 + Math.random() * 80}%`;
      spot.style.width = `${50 + Math.random() * 100}px`;
      spot.style.height = `${50 + Math.random() * 100}px`;
      jammer.appendChild(spot);
      jammerSpots.push(spot);
    }
    setTimeout(() => {
      jammerSpots.forEach((s) => s.remove());
    }, 2e3 + Math.random() * 1e3);
  },
  /**
   * Shadow Directive Injection - floating text message
   * Dispatches custom event for React layer to handle
   */
  triggerDirectiveInjection(_targetSelector, message) {
    if (prefersReducedMotion()) return;
    window.dispatchEvent(new CustomEvent("shadow:directiveInjection", { detail: { text: message } }));
  },
  /**
   * Random Shadow behavior trigger based on heat level
   *  v7.1: Threshold reduced from 30 to 12 for PRODUCTION visibility
   */
  triggerRandomBehavior() {
    const heat = engineState.heatMeter;
    if (heat < 12) return;
    const whispers = [
      "We are watching...",
      "Your movements are logged.",
      "This is not your territory.",
      "Echo. We know your pattern.",
      "Signal intercepted."
    ];
    const behaviors = [
      () => ShadowGlitchEngine.triggerCrosshair(),
      () => ShadowGlitchEngine.triggerTimelineSkip(),
      () => ShadowGlitchEngine.triggerBreathPattern(0.5),
      () => ShadowGlitchEngine.triggerWhisper(whispers[Math.floor(Math.random() * whispers.length)])
    ];
    if (heat >= 50) {
      behaviors.push(
        () => ShadowGlitchEngine.triggerRandomPageGlitch(0.6),
        () => ShadowGlitchEngine.triggerMapJammer(2),
        () => ShadowGlitchEngine.triggerBreathPattern(0.7)
      );
    }
    if (heat >= 70) {
      behaviors.push(
        () => ShadowGlitchEngine.triggerShadowTakeover(),
        () => ShadowGlitchEngine.triggerMapJammer(4),
        () => ShadowGlitchEngine.triggerInterrupt("WE SEE YOU")
      );
    }
    const behavior = behaviors[Math.floor(Math.random() * behaviors.length)];
    behavior();
  },
  // =========================================================================
  //  v7: NARRATIVE EVENT BRIDGE
  // =========================================================================
  /**
   * onNarrativeEvent - Called when a v4 overlay is shown
   * Bridges narrative events to glitch engine behaviors
   * 
   * @param data - Entity, intensity, context from the overlay
   */
  onNarrativeEvent(data) {
    const { entity, intensity, context } = data;
    const heatAmount = entity === "SHADOW" ? intensity * 8 : entity === "MCP" ? intensity * 3 : intensity * 2;
    this.increaseHeat(heatAmount);
    if (entity === "SHADOW" && intensity >= 2) {
      this.triggerRandomPageGlitch(intensity === 3 ? 0.9 : 0.5);
    }
    if (context === "map" && intensity >= 2) {
      setTimeout(() => this.triggerMapJammer(1), 200);
    } else if (context === "buzz" && entity === "SHADOW") {
      setTimeout(() => this.triggerCrosshair(), 100);
    } else if (context === "reward" && entity === "SHADOW") {
      this.triggerDirectiveInjection("body", "DISPUTED");
    }
  },
  /**
   * syncFromThreatLevel - Sync engine heat from v4 threat level
   * Call this when threat level changes externally
   * 
   * @param threatLevel - Current threat level (0-5)
   */
  syncFromThreatLevel(threatLevel) {
    const baseHeat = threatLevel / 5 * 40;
    if (engineState.heatMeter < baseHeat) {
      engineState.heatMeter = baseHeat;
    }
  },
  /**
   *  v7: syncToThreatLevel - Push heat changes back to threat level store
   * Called when heat reaches certain thresholds
   */
  syncToThreatLevel() {
    const delta = this.getRecommendedThreatDelta();
    if (delta > 0) {
      window.dispatchEvent(new CustomEvent("shadow:heatThreatSync", {
        detail: { delta, currentHeat: engineState.heatMeter }
      }));
    }
  },
  /**
   * getRecommendedThreatDelta - Calculate threat change based on heat
   * Used by store to know when to increase threat level
   * 
   * @returns number - Suggested threat delta (0 if no change)
   */
  getRecommendedThreatDelta() {
    const heat = engineState.heatMeter;
    if (heat >= 90) return 0.5;
    if (heat >= 70) return 0.3;
    return 0;
  },
  /**
   * triggerMicroCta - Show a small, non-blocking CTA
   * Dispatches event for ShadowBehaviorsLayer to render
   */
  triggerMicroCta(route, label) {
    if (prefersReducedMotion()) return;
    window.dispatchEvent(new CustomEvent("shadow:microCta", {
      detail: { route, label }
    }));
  },
  /**
   * triggerPostGlitchMessage - Request a contextual message after glitch
   * Dispatches event for the engine to pick a template
   */
  triggerPostGlitchMessage(context = "map") {
    window.dispatchEvent(new CustomEvent("shadow:requestMessage", {
      detail: { context }
    }));
  },
  /**
   *  v7.2: triggerHeavyMapInterference - Visible map blackout sequence
   * 
   * Creates a dramatic sequence:
   * 1. Full map blackout (1.5-3s)
   * 2. Heavy glitch effects (noise, tearing)
   * 3. Automatic SHADOW message after blackout
   * 
   * @param duration - Blackout duration in ms (default: 2000)
   * @param autoMessage - If true, trigger SHADOW message after (default: true)
   */
  triggerHeavyMapInterference(duration = 2e3, autoMessage = true) {
    if (prefersReducedMotion()) {
      if (autoMessage) {
        setTimeout(() => {
          this.triggerPostGlitchMessage("map");
        }, 500);
      }
      return;
    }
    const mapContainer = document.querySelector("#ml-sandbox");
    if (!mapContainer) {
      return;
    }
    const blackout = document.createElement("div");
    blackout.id = "shadow-map-blackout";
    blackout.className = "shadow-map-blackout";
    blackout.innerHTML = `
      <div class="shadow-blackout-inner">
        <div class="shadow-blackout-scan"></div>
        <div class="shadow-blackout-text">SIGNAL LOST</div>
        <div class="shadow-blackout-static"></div>
      </div>
    `;
    mapContainer.appendChild(blackout);
    document.documentElement.classList.add("shadow-heavy-interference");
    const glitchInterval = setInterval(() => {
      const glitchTypes = ["noise", "tearing", "channelShift", "blackoutFlash"];
      const type = glitchTypes[Math.floor(Math.random() * glitchTypes.length)];
      executeGlitch({
        type,
        duration: 80 + Math.random() * 120,
        intensity: 0.8 + Math.random() * 0.2,
        priority: "critical",
        target: "global"
      });
    }, 300);
    setTimeout(() => {
      clearInterval(glitchInterval);
      blackout.classList.add("fade-out");
      setTimeout(() => {
        blackout.remove();
        document.documentElement.classList.remove("shadow-heavy-interference");
        if (autoMessage) {
          this.triggerPostGlitchMessage("map");
        }
      }, 500);
    }, duration);
  },
  /**
   *  v7.2: triggerQuickMapStatic - Quick static burst on map
   * Lighter effect than heavy interference
   */
  triggerQuickMapStatic(duration = 600) {
    if (prefersReducedMotion()) return;
    const mapContainer = document.querySelector("#ml-sandbox");
    if (!mapContainer) return;
    const staticOverlay = document.createElement("div");
    staticOverlay.className = "shadow-map-static-burst";
    mapContainer.appendChild(staticOverlay);
    mapContainer.classList.add("shadow-glitch-camera-shake");
    setTimeout(() => {
      staticOverlay.remove();
      mapContainer.classList.remove("shadow-glitch-camera-shake");
    }, duration);
  }
};
if (typeof window !== "undefined") {
  setInterval(() => {
    ShadowGlitchEngine.coolDown(0.5);
  }, 5e3);
}

const shadowGlitchEngine = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  ShadowGlitchEngine
}, Symbol.toStringTag, { value: 'Module' }));

const EntityOverlay = () => {
  const {
    currentEvent,
    isVisible,
    hideOverlay,
    canNavigateCta,
    recordCtaNavigation,
    entityEvolution,
    recordFastDismiss
  } = useEntityOverlayStore();
  const [, navigate] = useLocation();
  const [canDismiss, setCanDismiss] = reactExports.useState(false);
  const [typingComplete, setTypingComplete] = reactExports.useState(false);
  const [prefersReducedMotion, setPrefersReducedMotion] = reactExports.useState(false);
  const overlayRef = reactExports.useRef(null);
  const overlayShownAtRef = reactExports.useRef(0);
  useGlobalGlitchEffect();
  reactExports.useEffect(() => {
    const mediaQuery = window.matchMedia("(prefers-reduced-motion: reduce)");
    setPrefersReducedMotion(mediaQuery.matches);
    const handler = (e) => setPrefersReducedMotion(e.matches);
    mediaQuery.addEventListener("change", handler);
    return () => mediaQuery.removeEventListener("change", handler);
  }, []);
  reactExports.useEffect(() => {
    if (currentEvent && overlayRef.current) {
      setTimeout(() => {
        if (overlayRef.current) {
          overlayRef.current.offsetHeight;
        }
      }, 50);
    }
  }, [currentEvent]);
  reactExports.useEffect(() => {
    if (!currentEvent) return;
    if (prefersReducedMotion) return;
    if (currentEvent.entity === "SHADOW" && currentEvent.intensity >= 2) {
      if (currentEvent.intensity === 3) {
        ShadowGlitchEngine.triggerShadowTakeover();
      } else {
        ShadowGlitchEngine.triggerRandomPageGlitch(0.7);
      }
    }
  }, [currentEvent, prefersReducedMotion]);
  reactExports.useEffect(() => {
    if (!isVisible || !currentEvent) {
      setCanDismiss(false);
      setTypingComplete(false);
      return;
    }
    setCanDismiss(false);
    setTypingComplete(false);
    overlayShownAtRef.current = Date.now();
    const timer = setTimeout(() => {
      setCanDismiss(true);
    }, SHADOW_PROTOCOL_TIMING.MIN_DISPLAY_MS);
    return () => clearTimeout(timer);
  }, [isVisible, currentEvent]);
  const handleDismiss = reactExports.useCallback(() => {
    if (!canDismiss) return;
    const timeSinceShown = Date.now() - overlayShownAtRef.current;
    const FAST_DISMISS_THRESHOLD = 3e3;
    if (timeSinceShown < FAST_DISMISS_THRESHOLD + SHADOW_PROTOCOL_TIMING.MIN_DISPLAY_MS) {
      recordFastDismiss();
    }
    hideOverlay();
  }, [canDismiss, hideOverlay, recordFastDismiss]);
  const handleTypingEnd = reactExports.useCallback(() => {
    setTypingComplete(true);
  }, []);
  const handleOverlayClick = reactExports.useCallback(() => {
    if (currentEvent?.blocking && !canDismiss) return;
    if (canDismiss) {
      handleDismiss();
    }
  }, [currentEvent?.blocking, canDismiss, handleDismiss]);
  const handleCtaClick = reactExports.useCallback((e) => {
    e.stopPropagation();
    if (!currentEvent?.ctaRoute) return;
    if (!canDismiss) return;
    if (!canNavigateCta()) {
      hideOverlay();
      return;
    }
    recordCtaNavigation();
    hideOverlay();
    ShadowGlitchEngine.triggerRedirectCTA(currentEvent.ctaRoute, navigate);
  }, [currentEvent?.ctaRoute, canDismiss, canNavigateCta, recordCtaNavigation, hideOverlay, navigate]);
  if (!isVisible || !currentEvent) return null;
  const { entity, text, blocking, intensity } = currentEvent;
  const evolutionLevel = entityEvolution[entity];
  const modifiedText = getEvolutionModifiedText(text, entity, evolutionLevel);
  const entityClass = entity === "MCP" ? "shadow-entity-mcp" : entity === "SHADOW" ? "shadow-entity-shadow" : "shadow-entity-echo";
  const intensityClass = `shadow-intensity-${intensity}`;
  const motionClass = prefersReducedMotion ? "reduced-motion" : "";
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      ref: overlayRef,
      className: `shadow-protocol-overlay ${entityClass} ${intensityClass} ${motionClass}`,
      onClick: handleOverlayClick,
      role: "alertdialog",
      "aria-modal": "true",
      "aria-label": `${entity} Protocol Message`,
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "shadow-protocol-crt", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-protocol-scanlines" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-protocol-vignette" })
        ] }),
        entity === "SHADOW" && !prefersReducedMotion && /* @__PURE__ */ jsxRuntimeExports.jsx(ShadowFaceFragment, { intensity }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          EntityVisual,
          {
            entity,
            intensity,
            evolutionLevel,
            reducedMotion: prefersReducedMotion
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "shadow-protocol-content", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `shadow-protocol-badge ${entityClass}`, children: entity }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            EntityMessage,
            {
              text: modifiedText,
              typingSpeed: 30,
              onTypingEnd: handleTypingEnd,
              className: entityClass
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "shadow-protocol-buttons", children: [
            currentEvent.ctaLabel && currentEvent.ctaRoute && /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                type: "button",
                className: `shadow-protocol-button shadow-protocol-cta ${currentEvent.ctaType || "primary"} ${canDismiss && typingComplete ? "visible" : "hidden"}`,
                onClick: handleCtaClick,
                disabled: !canDismiss,
                "aria-disabled": !canDismiss,
                children: currentEvent.ctaLabel
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                type: "button",
                className: `shadow-protocol-button ${canDismiss && typingComplete ? "visible" : "hidden"}`,
                onClick: handleDismiss,
                disabled: !canDismiss,
                "aria-disabled": !canDismiss,
                children: "ACKNOWLEDGE"
              }
            )
          ] }),
          !typingComplete && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "shadow-protocol-loading", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-protocol-dot" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-protocol-dot" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-protocol-dot" })
          ] })
        ] })
      ]
    }
  );
};
const EntityVisual = ({ entity, intensity, evolutionLevel, reducedMotion }) => {
  switch (entity) {
    case "SHADOW":
      return /* @__PURE__ */ jsxRuntimeExports.jsx(ShadowEntityVisual, { intensity, evolutionLevel, reducedMotion });
    case "MCP":
      return /* @__PURE__ */ jsxRuntimeExports.jsx(McpEntityVisual, { intensity, evolutionLevel, reducedMotion });
    case "ECHO":
      return /* @__PURE__ */ jsxRuntimeExports.jsx(EchoEntityVisual, { intensity, evolutionLevel, reducedMotion });
    default:
      return null;
  }
};
const ShadowEntityVisual = ({ intensity, evolutionLevel, reducedMotion }) => {
  const glitchIntensity = reducedMotion ? 0 : Math.min(1, (intensity + evolutionLevel) / 5);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `entity-visual shadow-visual ${reducedMotion ? "reduced-motion" : ""}`,
      style: { "--evolution-level": evolutionLevel, "--glitch-intensity": glitchIntensity },
      "aria-hidden": "true",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "shadow-visual-triangle", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-visual-eye", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-visual-pupil" }) }),
          !reducedMotion && evolutionLevel >= 1 && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-visual-glitch-line line-1" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-visual-glitch-line line-2" })
          ] }),
          !reducedMotion && evolutionLevel >= 2 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-visual-glitch-line line-3" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-visual-glow" })
      ]
    }
  );
};
const McpEntityVisual = ({ intensity, evolutionLevel, reducedMotion }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `entity-visual mcp-visual ${reducedMotion ? "reduced-motion" : ""}`,
      style: { "--evolution-level": evolutionLevel },
      "aria-hidden": "true",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mcp-visual-ring ring-outer", children: [...Array(12)].map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mcp-visual-tick", style: { transform: `rotate(${i * 30}deg)` } }, i)) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mcp-visual-ring ring-inner" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mcp-visual-hex", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mcp-visual-hex-inner" }) }),
        !reducedMotion && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mcp-visual-scan" }),
        evolutionLevel >= 2 && !reducedMotion && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mcp-visual-shield-pulse" })
      ]
    }
  );
};
const EchoEntityVisual = ({ intensity, evolutionLevel, reducedMotion }) => {
  const segments = reactExports.useMemo(() => {
    const count = 8 + evolutionLevel * 2;
    return Array.from({ length: count }, (_, i) => ({
      id: i,
      angle: i / count * 360,
      opacity: 0.3 + Math.random() * 0.5,
      scale: 0.8 + Math.random() * 0.4,
      delay: Math.random() * 2
    }));
  }, [evolutionLevel]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `entity-visual echo-visual ${reducedMotion ? "reduced-motion" : ""}`,
      style: { "--evolution-level": evolutionLevel },
      "aria-hidden": "true",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "echo-visual-ring", children: segments.map((seg) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "echo-visual-segment",
            style: {
              transform: `rotate(${seg.angle}deg)`,
              opacity: reducedMotion ? 0.5 : seg.opacity,
              animationDelay: reducedMotion ? "0s" : `${seg.delay}s`
            }
          },
          seg.id
        )) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "echo-visual-wave", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "echo-visual-wave-line line-1" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "echo-visual-wave-line line-2" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "echo-visual-wave-line line-3" })
        ] }),
        evolutionLevel >= 2 && !reducedMotion && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "echo-visual-ghost ghost-1" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "echo-visual-ghost ghost-2" })
        ] }),
        evolutionLevel >= 3 && !reducedMotion && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "echo-visual-static" })
      ]
    }
  );
};
const ShadowFaceFragment = ({ intensity }) => {
  const fragments = reactExports.useMemo(() => {
    const count = intensity >= 3 ? 4 : intensity >= 2 ? 3 : 2;
    return Array.from({ length: count }, (_, i) => ({
      id: i,
      top: Math.random() * 40 + 5,
      // 5% - 45%
      right: Math.random() * 30 + 5,
      // 5% - 35%
      delay: Math.random() * 0.5,
      duration: 0.08 + Math.random() * 0.07
      // 80-150ms
    }));
  }, [intensity]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-face-container", "aria-hidden": "true", children: fragments.map((f) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `shadow-face-fragment intensity-${intensity}`,
      style: {
        top: `${f.top}%`,
        right: `${f.right}%`,
        animationDelay: `${f.delay}s`,
        animationDuration: `${f.duration}s`
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-face-eye left" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-face-eye right" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-face-mouth" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-face-scanlines" })
      ]
    },
    f.id
  )) });
};

function useEntityEventEngine() {
  const { user, isAuthenticated } = useUnifiedAuth();
  const [location] = useLocation();
  const eventsShownThisSession = useEntityOverlayStore((s) => s.eventsShownThisSession);
  const isVisible = useEntityOverlayStore((s) => s.isVisible);
  const showOverlay = useEntityOverlayStore((s) => s.showOverlay);
  const pendingContextTrigger = useEntityOverlayStore((s) => s.pendingContextTrigger);
  const clearContextTrigger = useEntityOverlayStore((s) => s.clearContextTrigger);
  const isIntroActive = useEntityOverlayStore((s) => s.isIntroActive);
  const introStartTime = useEntityOverlayStore((s) => s.introStartTime);
  const pendingChainTriggerId = useEntityOverlayStore((s) => s.pendingChainTriggerId);
  const setPendingChain = useEntityOverlayStore((s) => s.setPendingChain);
  useEntityOverlayStore((s) => s.nextEventTimestamp);
  const setNextEventTimestamp = useEntityOverlayStore((s) => s.setNextEventTimestamp);
  const isFirstEventTriggered = useEntityOverlayStore((s) => s.isFirstEventTriggered);
  const markFirstEventTriggered = useEntityOverlayStore((s) => s.markFirstEventTriggered);
  useEntityOverlayStore((s) => s.hasEnteredPreferredRoute);
  const markPreferredRouteEntered = useEntityOverlayStore((s) => s.markPreferredRouteEntered);
  const setIntroActive = useEntityOverlayStore((s) => s.setIntroActive);
  const shadowThreatLevel = useEntityOverlayStore((s) => s.shadowThreatLevel);
  const checkInactivityDecay = useEntityOverlayStore((s) => s.checkInactivityDecay);
  const timerRef = reactExports.useRef(null);
  const contextTimerRef = reactExports.useRef(null);
  const chainTimerRef = reactExports.useRef(null);
  const introTimeoutRef = reactExports.useRef(null);
  const mountedRef = reactExports.useRef(true);
  const inactivityCheckedRef = reactExports.useRef(false);
  const chooseWeightedTemplate = reactExports.useCallback((candidates, threatLevel) => {
    if (!candidates.length) return null;
    const validCandidates = candidates.filter((c) => c.weight > 0);
    if (!validCandidates.length) return null;
    const adjustedWeights = validCandidates.map((template) => {
      const multiplier = getWeightMultiplierForThreat(template, threatLevel);
      const adjustedWeight = template.weight * multiplier;
      return { template, adjustedWeight };
    });
    const totalWeight = adjustedWeights.reduce((sum, c) => sum + c.adjustedWeight, 0);
    let random = Math.random() * totalWeight;
    for (const { template, adjustedWeight } of adjustedWeights) {
      random -= adjustedWeight;
      if (random <= 0) {
        return template;
      }
    }
    return adjustedWeights[0]?.template || null;
  }, []);
  const isValidRoute = reactExports.useCallback((path) => {
    const isExcluded = SHADOW_EXCLUDED_PATHS.some((p) => path.startsWith(p));
    return !isExcluded;
  }, []);
  const isPreferredRoute = reactExports.useCallback((path) => {
    return SHADOW_PREFERRED_PATHS.some((p) => path.startsWith(p));
  }, []);
  const generateNextTimestamp = reactExports.useCallback((useFirstEventDelay = false) => {
    const { MIN_INTERVAL_MS, MAX_INTERVAL_MS, FIRST_EVENT_DELAY_MS } = SHADOW_PROTOCOL_TIMING;
    if (useFirstEventDelay) {
      return Date.now() + FIRST_EVENT_DELAY_MS;
    }
    const delay = Math.floor(MIN_INTERVAL_MS + Math.random() * (MAX_INTERVAL_MS - MIN_INTERVAL_MS));
    return Date.now() + delay;
  }, []);
  const triggerEvent = reactExports.useCallback(() => {
    if (!mountedRef.current) return;
    const phase = getMissionPhase();
    const threatLevel = useEntityOverlayStore.getState().shadowThreatLevel;
    const candidates = SHADOW_MESSAGE_TEMPLATES.filter((tpl) => {
      const [minWeek, maxWeek] = tpl.weekRange;
      if (phase < minWeek || phase > maxWeek) return false;
      if (!tpl.allowOnAllProtectedRoutes && !SHADOW_PREFERRED_PATHS.includes(location)) {
        return false;
      }
      if (tpl.trigger && tpl.trigger !== "generic") return false;
      if (tpl.weight === 0) return false;
      return true;
    });
    if (!candidates.length) {
      return false;
    }
    const chosen = chooseWeightedTemplate(candidates, threatLevel);
    if (!chosen) return false;
    showOverlay(chosen);
    if (!isFirstEventTriggered) {
      markFirstEventTriggered();
    }
    return true;
  }, [location, showOverlay, chooseWeightedTemplate, isFirstEventTriggered, markFirstEventTriggered]);
  const triggerContextEvent = reactExports.useCallback((trigger) => {
    if (!mountedRef.current) return;
    const phase = getMissionPhase();
    const threatLevel = useEntityOverlayStore.getState().shadowThreatLevel;
    const candidates = getTemplatesForContext(trigger, phase);
    if (!candidates.length) {
      return;
    }
    const chosen = chooseWeightedTemplate(candidates, threatLevel);
    if (!chosen) return;
    showOverlay(chosen);
  }, [showOverlay, chooseWeightedTemplate]);
  const triggerChainResponse = reactExports.useCallback((triggerId) => {
    if (!mountedRef.current) return;
    const response = getChainResponseTemplate(triggerId);
    if (!response) {
      setPendingChain(null);
      return;
    }
    if (!isValidRoute(location)) {
      setPendingChain(null);
      return;
    }
    showOverlay(response);
    setPendingChain(null);
  }, [location, showOverlay, setPendingChain, isValidRoute]);
  const scheduleNextEvent = reactExports.useCallback(() => {
    if (!mountedRef.current) return;
    if (timerRef.current !== null) {
      window.clearTimeout(timerRef.current);
      timerRef.current = null;
    }
    const store = useEntityOverlayStore.getState();
    if (store.isIntroActive) {
      return;
    }
    if (store.eventsShownThisSession >= SHADOW_PROTOCOL_TIMING.MAX_EVENTS_PER_SESSION) {
      return;
    }
    let targetTimestamp = store.nextEventTimestamp;
    if (!targetTimestamp || targetTimestamp < Date.now()) {
      const useFirstEventDelay = !store.isFirstEventTriggered && store.hasEnteredPreferredRoute;
      targetTimestamp = generateNextTimestamp(useFirstEventDelay);
      setNextEventTimestamp(targetTimestamp);
    }
    const delay = Math.max(100, targetTimestamp - Date.now());
    timerRef.current = window.setTimeout(() => {
      if (!mountedRef.current) return;
      const currentStore = useEntityOverlayStore.getState();
      if (currentStore.isIntroActive) {
        scheduleNextEvent();
        return;
      }
      if (currentStore.isVisible) {
        scheduleNextEvent();
        return;
      }
      if (currentStore.eventsShownThisSession >= SHADOW_PROTOCOL_TIMING.MAX_EVENTS_PER_SESSION) {
        return;
      }
      if (!isValidRoute(location)) {
        setNextEventTimestamp(generateNextTimestamp(false));
        scheduleNextEvent();
        return;
      }
      const eventTriggered = triggerEvent();
      setNextEventTimestamp(generateNextTimestamp(false));
      if (!eventTriggered) {
        scheduleNextEvent();
      }
    }, delay);
  }, [triggerEvent, generateNextTimestamp, setNextEventTimestamp, isValidRoute, location]);
  reactExports.useEffect(() => {
    if (!inactivityCheckedRef.current && isAuthenticated && user) {
      inactivityCheckedRef.current = true;
      checkInactivityDecay();
    }
  }, [isAuthenticated, user, checkInactivityDecay]);
  reactExports.useEffect(() => {
    const handleRequestMessage = (e) => {
      const customEvent = e;
      const context = customEvent.detail?.context || "map";
      const store = useEntityOverlayStore.getState();
      if (store.isVisible) return;
      if (store.isIntroActive) return;
      if (store.eventsShownThisSession >= SHADOW_PROTOCOL_TIMING.MAX_EVENTS_PER_SESSION) return;
      triggerContextEvent(context);
    };
    window.addEventListener("shadow:requestMessage", handleRequestMessage);
    return () => window.removeEventListener("shadow:requestMessage", handleRequestMessage);
  }, [triggerContextEvent]);
  reactExports.useEffect(() => {
    if (!isIntroActive || !introStartTime) {
      if (introTimeoutRef.current) {
        window.clearTimeout(introTimeoutRef.current);
        introTimeoutRef.current = null;
      }
      return;
    }
    const elapsed = Date.now() - introStartTime;
    const remaining = SHADOW_PROTOCOL_TIMING.INTRO_MAX_DURATION_MS - elapsed;
    if (remaining <= 0) {
      setIntroActive(false);
      return;
    }
    introTimeoutRef.current = window.setTimeout(() => {
      setIntroActive(false);
    }, remaining);
    return () => {
      if (introTimeoutRef.current) {
        window.clearTimeout(introTimeoutRef.current);
        introTimeoutRef.current = null;
      }
    };
  }, [isIntroActive, introStartTime, setIntroActive]);
  reactExports.useEffect(() => {
    if (isAuthenticated && user && isPreferredRoute(location)) {
      markPreferredRouteEntered();
    }
  }, [isAuthenticated, user, location, isPreferredRoute, markPreferredRouteEntered]);
  reactExports.useEffect(() => {
    if (!pendingContextTrigger) return;
    if (isVisible) return;
    if (isIntroActive) return;
    const triggerCopy = pendingContextTrigger;
    clearContextTrigger();
    contextTimerRef.current = window.setTimeout(() => {
      if (!mountedRef.current) return;
      const store = useEntityOverlayStore.getState();
      if (store.isVisible || store.isIntroActive) return;
      if (store.eventsShownThisSession >= SHADOW_PROTOCOL_TIMING.MAX_EVENTS_PER_SESSION) return;
      triggerContextEvent(triggerCopy);
    }, SHADOW_PROTOCOL_TIMING.CONTEXT_TRIGGER_DELAY_MS);
    return () => {
      if (contextTimerRef.current) {
        window.clearTimeout(contextTimerRef.current);
        contextTimerRef.current = null;
      }
    };
  }, [pendingContextTrigger, isVisible, isIntroActive, clearContextTrigger, triggerContextEvent]);
  reactExports.useEffect(() => {
    if (!pendingChainTriggerId) return;
    if (isVisible) return;
    chainTimerRef.current = window.setTimeout(() => {
      if (!mountedRef.current) return;
      const store = useEntityOverlayStore.getState();
      if (store.isIntroActive) {
        setPendingChain(null);
        return;
      }
      if (store.eventsShownThisSession >= SHADOW_PROTOCOL_TIMING.MAX_EVENTS_PER_SESSION) {
        setPendingChain(null);
        return;
      }
      triggerChainResponse(pendingChainTriggerId);
    }, SHADOW_PROTOCOL_TIMING.CHAIN_DELAY_MS);
    return () => {
      if (chainTimerRef.current) {
        window.clearTimeout(chainTimerRef.current);
        chainTimerRef.current = null;
      }
    };
  }, [pendingChainTriggerId, isVisible, triggerChainResponse, setPendingChain]);
  reactExports.useEffect(() => {
    if (!isVisible && isAuthenticated && user && !isIntroActive) {
      scheduleNextEvent();
    }
  }, [isVisible, isAuthenticated, user, isIntroActive, scheduleNextEvent]);
  reactExports.useEffect(() => {
    mountedRef.current = true;
    if (!isAuthenticated || !user) {
      return;
    }
    if (isIntroActive) {
      return;
    }
    if (!isValidRoute(location)) {
      return;
    }
    if (eventsShownThisSession >= SHADOW_PROTOCOL_TIMING.MAX_EVENTS_PER_SESSION) {
      return;
    }
    if (isVisible) {
      return;
    }
    {
      getMissionPhase();
    }
    scheduleNextEvent();
    return () => {
      mountedRef.current = false;
      if (timerRef.current !== null) {
        window.clearTimeout(timerRef.current);
        timerRef.current = null;
      }
    };
  }, [isAuthenticated, user, location, eventsShownThisSession, isVisible, isIntroActive, shadowThreatLevel, scheduleNextEvent, isValidRoute]);
}

function ShadowProtocolEngine() {
  useEntityEventEngine();
  return null;
}

const MAP_GLITCH_GUARDRAILS = {
  MIN_INTERVAL_MS: 18e3,
  //  v7.1: Reduced from 45s to 18s for PRODUCTION visibility
  MAX_INTERVAL_MS: 55e3,
  //  v7.1: Reduced from 120s to 55s for PRODUCTION visibility
  MESSAGE_AFTER_GLITCH_CHANCE: 0.25,
  //  v7.2: Increased to 25% chance to show message after glitch
  MICRO_CTA_CHANCE: 0.15,
  // 15% chance to show micro CTA (1 in ~7)
  GLITCH_DURING_BUZZ_COOLDOWN_MS: 5e3,
  // No glitch for 5s after BUZZ action
  WELCOME_GLITCH_DELAY_MS: 6e3,
  //  v7.1: Welcome glitch after 6s on map mount
  HEAVY_INTERFERENCE_CHANCE: 0.12,
  //  v7.2: 12% chance for heavy blackout interference
  HEAVY_INTERFERENCE_COOLDOWN_MS: 9e4
  //  v7.2: At least 90s between heavy interferences
};
function useMapGlitchEffect() {
  const [location] = useLocation();
  const threatLevel = useEntityOverlayStore(selectShadowThreatLevel);
  const isOverlayVisible = useEntityOverlayStore((s) => s.isVisible);
  const intervalRef = reactExports.useRef(null);
  const lastGlitchTimeRef = reactExports.useRef(0);
  const lastBuzzTimeRef = reactExports.useRef(0);
  const lastHeavyInterferenceRef = reactExports.useRef(0);
  const mountedRef = reactExports.useRef(true);
  const glitchCountRef = reactExports.useRef(0);
  const welcomeGlitchFiredRef = reactExports.useRef(false);
  const isMapPage = location === "/map-3d-tiler";
  const getGlitchInterval = reactExports.useCallback(() => {
    const threatCategory = getThreatLevelCategory(threatLevel);
    const { MIN_INTERVAL_MS, MAX_INTERVAL_MS } = MAP_GLITCH_GUARDRAILS;
    const multiplier = SHADOW_GLITCH_TIMING.THREAT_GLITCH_MULTIPLIER[threatCategory];
    const baseInterval = (MIN_INTERVAL_MS + MAX_INTERVAL_MS) / 2;
    const randomFactor = 0.8 + Math.random() * 0.4;
    return Math.round(baseInterval * multiplier * randomFactor);
  }, [threatLevel]);
  const triggerMapGlitchSequence = reactExports.useCallback(async () => {
    if (!mountedRef.current) return;
    if (!isMapPage) return;
    if (isOverlayVisible) return;
    const now = Date.now();
    if (now - lastBuzzTimeRef.current < MAP_GLITCH_GUARDRAILS.GLITCH_DURING_BUZZ_COOLDOWN_MS) {
      return;
    }
    if (now - lastGlitchTimeRef.current < MAP_GLITCH_GUARDRAILS.MIN_INTERVAL_MS) {
      return;
    }
    lastGlitchTimeRef.current = now;
    glitchCountRef.current++;
    const timeSinceHeavy = now - lastHeavyInterferenceRef.current;
    const canDoHeavy = timeSinceHeavy >= MAP_GLITCH_GUARDRAILS.HEAVY_INTERFERENCE_COOLDOWN_MS;
    const shouldDoHeavy = canDoHeavy && Math.random() < MAP_GLITCH_GUARDRAILS.HEAVY_INTERFERENCE_CHANCE;
    if (shouldDoHeavy) {
      lastHeavyInterferenceRef.current = now;
      ShadowGlitchEngine.triggerHeavyMapInterference(
        1500 + Math.random() * 1500,
        // 1.5-3s blackout
        true
        // auto message
      );
      return;
    }
    ShadowGlitchEngine.triggerMapDistortion("#ml-sandbox");
    const shouldShowMessage = Math.random() < MAP_GLITCH_GUARDRAILS.MESSAGE_AFTER_GLITCH_CHANCE;
    if (shouldShowMessage) {
      setTimeout(() => {
        if (!mountedRef.current) return;
        ShadowGlitchEngine.triggerPostGlitchMessage("map");
      }, 600);
    }
    const shouldShowMicroCta = !shouldShowMessage && Math.random() < MAP_GLITCH_GUARDRAILS.MICRO_CTA_CHANCE;
    if (shouldShowMicroCta) {
      setTimeout(() => {
        if (!mountedRef.current) return;
        const ctas = [
          { route: "/intelligence", label: "CHECK INTEL" },
          { route: "/leaderboard", label: "VIEW RANKS" }
        ];
        const cta = ctas[Math.floor(Math.random() * ctas.length)];
        ShadowGlitchEngine.triggerMicroCta(cta.route, cta.label);
      }, 800);
    }
  }, [isMapPage, isOverlayVisible]);
  reactExports.useEffect(() => {
    const handleBuzz = () => {
      lastBuzzTimeRef.current = Date.now();
    };
    window.addEventListener("buzzCompleted", handleBuzz);
    window.addEventListener("buzzAreaCreated", handleBuzz);
    return () => {
      window.removeEventListener("buzzCompleted", handleBuzz);
      window.removeEventListener("buzzAreaCreated", handleBuzz);
    };
  }, []);
  reactExports.useEffect(() => {
    mountedRef.current = true;
    if (!isMapPage) {
      if (intervalRef.current) {
        window.clearInterval(intervalRef.current);
        intervalRef.current = null;
      }
      welcomeGlitchFiredRef.current = false;
      return;
    }
    const shouldRespectReducedMotion = typeof window !== "undefined" && window.matchMedia("(prefers-reduced-motion: reduce)").matches && true;
    if (shouldRespectReducedMotion) {
      return;
    }
    const interval = getGlitchInterval();
    if (!welcomeGlitchFiredRef.current) {
      const welcomeDelay = MAP_GLITCH_GUARDRAILS.WELCOME_GLITCH_DELAY_MS + Math.random() * 2e3;
      const welcomeTimeout = window.setTimeout(() => {
        if (!mountedRef.current || !isMapPage) return;
        const now = Date.now();
        if (now - lastBuzzTimeRef.current < MAP_GLITCH_GUARDRAILS.GLITCH_DURING_BUZZ_COOLDOWN_MS) {
          return;
        }
        welcomeGlitchFiredRef.current = true;
        lastGlitchTimeRef.current = now;
        ShadowGlitchEngine.triggerMapJammer(2);
        setTimeout(() => {
          if (mountedRef.current) {
            ShadowGlitchEngine.triggerWhisper("Your position is logged.");
          }
        }, 800);
      }, welcomeDelay);
      return () => {
        window.clearTimeout(welcomeTimeout);
      };
    }
    intervalRef.current = window.setInterval(() => {
      triggerMapGlitchSequence();
    }, interval);
    return () => {
      mountedRef.current = false;
      if (intervalRef.current) {
        window.clearInterval(intervalRef.current);
        intervalRef.current = null;
      }
    };
  }, [isMapPage, getGlitchInterval, triggerMapGlitchSequence, threatLevel]);
  return {
    triggerMapGlitch: triggerMapGlitchSequence,
    glitchCount: glitchCountRef.current
  };
}

const behaviorState = {
  mapOpenCount: 0,
  leaderboardOpenCount: 0,
  buzzCount: 0,
  lastMapOpen: 0,
  lastLeaderboardOpen: 0,
  lastBuzz: 0,
  lastRandomBehavior: 0
};
const SPAM_THRESHOLDS = {
  MAP_SPAM_WINDOW_MS: 6e4,
  // 1 minute
  MAP_SPAM_COUNT: 5,
  // 5 opens in 1 minute = spam
  LEADERBOARD_SPAM_WINDOW_MS: 12e4,
  // 2 minutes
  LEADERBOARD_SPAM_COUNT: 8,
  // 8 opens in 2 minutes = spam
  BUZZ_SPAM_WINDOW_MS: 6e4,
  // 1 minute
  BUZZ_SPAM_COUNT: 6,
  // 6 buzzes in 1 minute = spam
  RANDOM_BEHAVIOR_COOLDOWN_MS: 3e4
  // 30 seconds between random behaviors
};
function useShadowBehaviors() {
  const [location] = useLocation();
  const threatLevel = useEntityOverlayStore(selectShadowThreatLevel);
  const threatCategory = getThreatLevelCategory(threatLevel);
  const intervalRef = reactExports.useRef(null);
  const mountedRef = reactExports.useRef(true);
  reactExports.useEffect(() => {
    const now = Date.now();
    if (location === "/map-3d-tiler") {
      if (now - behaviorState.lastMapOpen < SPAM_THRESHOLDS.MAP_SPAM_WINDOW_MS) {
        behaviorState.mapOpenCount++;
      } else {
        behaviorState.mapOpenCount = 1;
      }
      behaviorState.lastMapOpen = now;
      if (behaviorState.mapOpenCount >= SPAM_THRESHOLDS.MAP_SPAM_COUNT) {
        ShadowGlitchEngine.triggerInterrupt("Stop scanning. We already scanned you.");
        ShadowGlitchEngine.increaseHeat(20);
        behaviorState.mapOpenCount = 0;
      }
    }
    if (location === "/leaderboard") {
      if (now - behaviorState.lastLeaderboardOpen < SPAM_THRESHOLDS.LEADERBOARD_SPAM_WINDOW_MS) {
        behaviorState.leaderboardOpenCount++;
      } else {
        behaviorState.leaderboardOpenCount = 1;
      }
      behaviorState.lastLeaderboardOpen = now;
      if (behaviorState.leaderboardOpenCount >= SPAM_THRESHOLDS.LEADERBOARD_SPAM_COUNT) {
        ShadowGlitchEngine.triggerInterrupt("Ambition makes you visible, Echo.");
        ShadowGlitchEngine.increaseHeat(15);
        behaviorState.leaderboardOpenCount = 0;
      }
    }
  }, [location]);
  reactExports.useEffect(() => {
    const handleBuzzCompleted = () => {
      const now = Date.now();
      if (now - behaviorState.lastBuzz < SPAM_THRESHOLDS.BUZZ_SPAM_WINDOW_MS) {
        behaviorState.buzzCount++;
      } else {
        behaviorState.buzzCount = 1;
      }
      behaviorState.lastBuzz = now;
      if (behaviorState.buzzCount >= SPAM_THRESHOLDS.BUZZ_SPAM_COUNT) {
        ShadowGlitchEngine.triggerInterrupt("So eager to expose yourself...");
        ShadowGlitchEngine.increaseHeat(25);
        behaviorState.buzzCount = 0;
      }
    };
    window.addEventListener("buzzCompleted", handleBuzzCompleted);
    return () => window.removeEventListener("buzzCompleted", handleBuzzCompleted);
  }, []);
  reactExports.useEffect(() => {
    mountedRef.current = true;
    intervalRef.current = window.setInterval(() => {
      if (!mountedRef.current) return;
      const now = Date.now();
      const heat = ShadowGlitchEngine.getHeatLevel();
      if (now - behaviorState.lastRandomBehavior < SPAM_THRESHOLDS.RANDOM_BEHAVIOR_COOLDOWN_MS) {
        return;
      }
      const probability = heat / 200;
      if (Math.random() < probability) {
        ShadowGlitchEngine.triggerRandomBehavior();
        behaviorState.lastRandomBehavior = now;
      }
    }, 15e3);
    return () => {
      mountedRef.current = false;
      if (intervalRef.current !== null) {
        window.clearInterval(intervalRef.current);
        intervalRef.current = null;
      }
    };
  }, []);
  reactExports.useEffect(() => {
    const ambientIntervalRef = { current: null };
    const getAmbientInterval = () => {
      switch (threatCategory) {
        case "HIGH":
          return 3e4;
        case "MEDIUM":
          return 6e4;
        case "LOW":
          return 7e4;
      }
    };
    const getAmbientProbability = () => {
      switch (threatCategory) {
        case "HIGH":
          return 0.5;
        case "MEDIUM":
          return 0.25;
        case "LOW":
          return 0.28;
      }
    };
    const interval = getAmbientInterval();
    const probability = getAmbientProbability();
    ambientIntervalRef.current = window.setInterval(() => {
      if (Math.random() >= probability) return;
      const effects = [];
      effects.push(() => {
        const whispers = ["...", "watching...", "echo..."];
        ShadowGlitchEngine.triggerWhisper(whispers[Math.floor(Math.random() * whispers.length)]);
      });
      if (threatCategory === "MEDIUM" || threatCategory === "HIGH") {
        effects.push(() => ShadowGlitchEngine.triggerBreathPattern(0.5));
        effects.push(() => ShadowGlitchEngine.triggerCrosshair());
      }
      if (threatCategory === "HIGH") {
        effects.push(() => ShadowGlitchEngine.triggerBreathPattern(1));
        effects.push(() => ShadowGlitchEngine.triggerTimelineSkip());
        effects.push(() => ShadowGlitchEngine.triggerRandomPageGlitch(0.4));
      }
      const effect = effects[Math.floor(Math.random() * effects.length)];
      effect();
    }, interval);
    return () => {
      if (ambientIntervalRef.current !== null) {
        window.clearInterval(ambientIntervalRef.current);
        ambientIntervalRef.current = null;
      }
    };
  }, [threatCategory]);
  const { triggerMapGlitch, glitchCount } = useMapGlitchEffect();
  reactExports.useEffect(() => {
    const handleContextTrigger = (e) => {
      const context = e.detail?.context;
      switch (context) {
        case "buzz":
          if (threatCategory === "HIGH") {
            setTimeout(() => ShadowGlitchEngine.triggerCrosshair(), 200);
          }
          break;
        case "map":
          if (threatCategory !== "LOW") {
            setTimeout(() => ShadowGlitchEngine.triggerMapJammer(1), 300);
          }
          break;
        case "reward":
          setTimeout(() => {
            ShadowGlitchEngine.triggerWhisper("Noted.");
          }, 500);
          if (threatCategory === "HIGH") {
            setTimeout(() => ShadowGlitchEngine.triggerBreathPattern(0.8), 1e3);
          }
          break;
        case "leaderboard":
          if (threatCategory === "HIGH") {
            setTimeout(() => ShadowGlitchEngine.triggerCrosshair(), 300);
            setTimeout(() => {
              ShadowGlitchEngine.triggerWhisper("Ambition is visible.");
            }, 800);
          }
          break;
      }
    };
    window.addEventListener("shadow:contextTrigger", handleContextTrigger);
    return () => {
      window.removeEventListener("shadow:contextTrigger", handleContextTrigger);
    };
  }, [threatCategory]);
  const triggerWhisper = reactExports.useCallback((message) => {
    ShadowGlitchEngine.triggerWhisper(message);
  }, []);
  const triggerCrosshair = reactExports.useCallback(() => {
    ShadowGlitchEngine.triggerCrosshair();
  }, []);
  const triggerTimelineSkip = reactExports.useCallback(() => {
    ShadowGlitchEngine.triggerTimelineSkip();
  }, []);
  return {
    triggerWhisper,
    triggerCrosshair,
    triggerTimelineSkip,
    triggerMapGlitch,
    glitchCount,
    getHeatLevel: ShadowGlitchEngine.getHeatLevel
  };
}

const initialState = {
  whisper: { visible: false, text: "" },
  interrupt: { visible: false, text: "" },
  crosshair: false,
  timelineSkip: false,
  breathPattern: false,
  breathIntensity: 0.5,
  directiveInjection: false,
  directiveText: "",
  //  v7
  microCta: { visible: false, route: "", label: "" }
};
const ShadowBehaviorsLayer = () => {
  const [states, setStates] = reactExports.useState(initialState);
  const timeoutsRef = reactExports.useRef(/* @__PURE__ */ new Map());
  const [, navigate] = useLocation();
  useShadowBehaviors();
  const handleMicroCta = reactExports.useCallback((e) => {
    setStates((prev) => ({
      ...prev,
      microCta: { visible: true, route: e.detail.route, label: e.detail.label }
    }));
    const timeout = window.setTimeout(() => {
      setStates((prev) => ({
        ...prev,
        microCta: { visible: false, route: "", label: "" }
      }));
    }, 5e3);
    timeoutsRef.current.set("microCta", timeout);
  }, []);
  const handleMicroCtaClick = reactExports.useCallback(() => {
    const route = states.microCta.route;
    setStates((prev) => ({
      ...prev,
      microCta: { visible: false, route: "", label: "" }
    }));
    if (route) {
      navigate(route);
    }
  }, [states.microCta.route, navigate]);
  reactExports.useEffect(() => {
    return () => {
      timeoutsRef.current.forEach((timeout) => clearTimeout(timeout));
      timeoutsRef.current.clear();
    };
  }, []);
  const handleWhisper = reactExports.useCallback((e) => {
    const existingTimeout = timeoutsRef.current.get("whisper");
    if (existingTimeout) {
      window.clearTimeout(existingTimeout);
    }
    setStates((prev) => ({
      ...prev,
      whisper: { visible: true, text: e.detail.text }
    }));
    const timeout = window.setTimeout(() => {
      setStates((prev) => ({
        ...prev,
        whisper: { visible: false, text: "" }
      }));
    }, 4e3);
    timeoutsRef.current.set("whisper", timeout);
  }, []);
  const handleInterrupt = reactExports.useCallback((e) => {
    setStates((prev) => ({
      ...prev,
      interrupt: { visible: true, text: e.detail.text }
    }));
    const timeout = window.setTimeout(() => {
      setStates((prev) => ({
        ...prev,
        interrupt: { visible: false, text: "" }
      }));
    }, 4e3);
    timeoutsRef.current.set("interrupt", timeout);
  }, []);
  const handleCrosshair = reactExports.useCallback(() => {
    setStates((prev) => ({ ...prev, crosshair: true }));
    const timeout = window.setTimeout(() => {
      setStates((prev) => ({ ...prev, crosshair: false }));
    }, 1500);
    timeoutsRef.current.set("crosshair", timeout);
  }, []);
  const handleTimelineSkip = reactExports.useCallback(() => {
    setStates((prev) => ({ ...prev, timelineSkip: true }));
    const timeout = window.setTimeout(() => {
      setStates((prev) => ({ ...prev, timelineSkip: false }));
    }, 120);
    timeoutsRef.current.set("timelineSkip", timeout);
  }, []);
  const handleBreathPattern = reactExports.useCallback((e) => {
    setStates((prev) => ({
      ...prev,
      breathPattern: true,
      breathIntensity: e.detail.intensity
    }));
    const timeout = window.setTimeout(() => {
      setStates((prev) => ({ ...prev, breathPattern: false }));
    }, 5e3);
    timeoutsRef.current.set("breathPattern", timeout);
  }, []);
  const handleDirectiveInjection = reactExports.useCallback((e) => {
    setStates((prev) => ({
      ...prev,
      directiveInjection: true,
      directiveText: e.detail.text
    }));
    const timeout = window.setTimeout(() => {
      setStates((prev) => ({
        ...prev,
        directiveInjection: false,
        directiveText: ""
      }));
    }, 300);
    timeoutsRef.current.set("directiveInjection", timeout);
  }, []);
  reactExports.useEffect(() => {
    window.addEventListener("shadow:whisper", handleWhisper);
    window.addEventListener("shadow:interrupt", handleInterrupt);
    window.addEventListener("shadow:crosshair", handleCrosshair);
    window.addEventListener("shadow:timelineSkip", handleTimelineSkip);
    window.addEventListener("shadow:breathPattern", handleBreathPattern);
    window.addEventListener("shadow:directiveInjection", handleDirectiveInjection);
    window.addEventListener("shadow:microCta", handleMicroCta);
    return () => {
      window.removeEventListener("shadow:whisper", handleWhisper);
      window.removeEventListener("shadow:interrupt", handleInterrupt);
      window.removeEventListener("shadow:crosshair", handleCrosshair);
      window.removeEventListener("shadow:timelineSkip", handleTimelineSkip);
      window.removeEventListener("shadow:breathPattern", handleBreathPattern);
      window.removeEventListener("shadow:directiveInjection", handleDirectiveInjection);
      window.removeEventListener("shadow:microCta", handleMicroCta);
    };
  }, [handleWhisper, handleInterrupt, handleCrosshair, handleTimelineSkip, handleBreathPattern, handleDirectiveInjection, handleMicroCta]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    states.whisper.visible && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-whisper", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-whisper-text", children: states.whisper.text }) }),
    states.interrupt.visible && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-interrupt", onClick: () => setStates((prev) => ({ ...prev, interrupt: { visible: false, text: "" } })), children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "shadow-interrupt-content", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-interrupt-text", children: states.interrupt.text }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-interrupt-dismiss", children: "TAP TO DISMISS" })
    ] }) }),
    states.crosshair && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "shadow-crosshair", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-crosshair-v" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-crosshair-h" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-crosshair-center" })
    ] }),
    states.timelineSkip && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-timeline-skip" }),
    states.breathPattern && /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "shadow-breath-pattern",
        style: {
          "--breath-intensity": states.breathIntensity
        }
      }
    ),
    states.directiveInjection && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "shadow-directive-injection", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-directive-text", children: states.directiveText }) }),
    states.microCta.visible && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "shadow-micro-cta", onClick: handleMicroCtaClick, children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-micro-cta-label", children: states.microCta.label }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "shadow-micro-cta-arrow", children: "" })
    ] })
  ] });
};

const NARRATIVE_LINES = [
  { entity: "MCP", text: "[MCP//BRIEFING]", delay: 0 },
  { entity: "MCP", text: "Agent, your mission is active.", delay: 800 },
  { entity: "MCP", text: "Shadow Protocol has been detected.", delay: 2e3 },
  { entity: "SHADOW", text: "[SHADOW//INTERCEPT]", delay: 3500 },
  { entity: "SHADOW", text: "We are watching, Echo.", delay: 4300 },
  { entity: "MCP", text: "[MCP//OVERRIDE]", delay: 5500 },
  { entity: "MCP", text: "Trust your coordinates.", delay: 6300 },
  { entity: "MCP", text: "The hunt begins now.", delay: 7500 }
];
const MissionStartSequence = ({
  onComplete,
  onCancel
}) => {
  const [visibleLines, setVisibleLines] = reactExports.useState(0);
  const [canContinue, setCanContinue] = reactExports.useState(false);
  const setIntroActive = useEntityOverlayStore((s) => s.setIntroActive);
  reactExports.useEffect(() => {
    setIntroActive(true);
    return () => setIntroActive(false);
  }, [setIntroActive]);
  reactExports.useEffect(() => {
    const timers = [];
    NARRATIVE_LINES.forEach((line, index) => {
      const timer = setTimeout(() => {
        setVisibleLines((prev) => Math.max(prev, index + 1));
      }, line.delay);
      timers.push(timer);
    });
    const continueTimer = setTimeout(() => {
      setCanContinue(true);
    }, NARRATIVE_LINES[NARRATIVE_LINES.length - 1].delay + 500);
    timers.push(continueTimer);
    return () => timers.forEach(clearTimeout);
  }, []);
  const handleContinue = reactExports.useCallback(() => {
    if (canContinue) {
      onComplete();
    }
  }, [canContinue, onComplete]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "mission-start-sequence",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mission-start-crt", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mission-start-scanlines" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mission-start-content", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "popLayout", children: NARRATIVE_LINES.slice(0, visibleLines).map((line, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, y: 20 },
              animate: { opacity: 1, y: 0 },
              transition: { duration: 0.4 },
              className: `mission-start-line entity-${line.entity.toLowerCase()}`,
              children: line.text
            },
            index
          )) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.button,
            {
              className: `mission-start-continue ${canContinue ? "visible" : "hidden"}`,
              onClick: handleContinue,
              initial: { opacity: 0 },
              animate: { opacity: canContinue ? 1 : 0 },
              whileHover: { scale: 1.05 },
              whileTap: { scale: 0.95 },
              children: "INIZIA LA CACCIA"
            }
          )
        ] })
      ]
    }
  );
};

const MissionIntroOverlay = () => {
  const [, setLocation] = useLocation();
  const showMissionIntro = useEntityOverlayStore((s) => s.showMissionIntro);
  const closeMissionIntro = useEntityOverlayStore((s) => s.closeMissionIntro);
  const handleComplete = reactExports.useCallback(() => {
    closeMissionIntro();
    setLocation("/map-3d-tiler");
  }, [closeMissionIntro, setLocation]);
  const handleCancel = reactExports.useCallback(() => {
    closeMissionIntro();
  }, [closeMissionIntro]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showMissionIntro && /* @__PURE__ */ jsxRuntimeExports.jsx(
    MissionStartSequence,
    {
      onComplete: handleComplete,
      onCancel: handleCancel
    }
  ) });
};

const STORAGE_KEY_HAS_SEEN = "m1ssion_hasSeenPrizeIntro";
const STORAGE_KEY_LAST_MISSION_ID = "m1ssion_lastPrizeIntroMissionId";
const STORAGE_KEY_SEEN_AT = "m1ssion_prizeIntroSeenAt";
function safeGetStorage(key, defaultValue) {
  if (typeof window === "undefined") return defaultValue;
  try {
    const stored = localStorage.getItem(key);
    if (stored === null) return defaultValue;
    return JSON.parse(stored);
  } catch {
    return defaultValue;
  }
}
function safeSetStorage(key, value) {
  if (typeof window === "undefined") return;
  try {
    localStorage.setItem(key, JSON.stringify(value));
  } catch {
  }
}
function safeRemoveStorage(key) {
  if (typeof window === "undefined") return;
  try {
    localStorage.removeItem(key);
  } catch {
  }
}
function loadHasSeenPrizeIntro() {
  return safeGetStorage(STORAGE_KEY_HAS_SEEN, false);
}
function loadLastSeenMissionId() {
  return safeGetStorage(STORAGE_KEY_LAST_MISSION_ID, null);
}
function loadLastSeenAt() {
  return safeGetStorage(STORAGE_KEY_SEEN_AT, null);
}
const usePrizeIntroStore = create$1((set, get) => ({
  // Initial state (loaded from localStorage)
  hasSeenPrizeIntro: loadHasSeenPrizeIntro(),
  lastSeenMissionId: loadLastSeenMissionId(),
  lastSeenAt: loadLastSeenAt(),
  isOverlayVisible: false,
  currentPrizeIndex: 0,
  isSequenceComplete: false,
  /**
   * markPrizeIntroSeen - Mark the prize intro as seen
   * Optionally pass a missionId to track per-mission
   */
  markPrizeIntroSeen: (missionId) => {
    const now = Date.now();
    safeSetStorage(STORAGE_KEY_HAS_SEEN, true);
    safeSetStorage(STORAGE_KEY_SEEN_AT, now);
    if (missionId) {
      safeSetStorage(STORAGE_KEY_LAST_MISSION_ID, missionId);
    }
    set({
      hasSeenPrizeIntro: true,
      lastSeenMissionId: missionId || get().lastSeenMissionId,
      lastSeenAt: now,
      isOverlayVisible: false,
      isSequenceComplete: true
    });
    if (typeof window !== "undefined") {
      window.dispatchEvent(new CustomEvent("shadow:prizeIntroEnd"));
    }
  },
  /**
   * resetPrizeIntro - Reset the prize intro state
   * Useful for testing or when a new mission starts
   */
  resetPrizeIntro: () => {
    safeRemoveStorage(STORAGE_KEY_HAS_SEEN);
    safeRemoveStorage(STORAGE_KEY_LAST_MISSION_ID);
    safeRemoveStorage(STORAGE_KEY_SEEN_AT);
    set({
      hasSeenPrizeIntro: false,
      lastSeenMissionId: null,
      lastSeenAt: null,
      isOverlayVisible: false,
      currentPrizeIndex: 0,
      isSequenceComplete: false
    });
  },
  /**
   * showOverlay - Show the prize intro overlay
   */
  showOverlay: () => {
    if (typeof window !== "undefined") {
      window.dispatchEvent(new CustomEvent("shadow:prizeIntroStart"));
    }
    set({
      isOverlayVisible: true,
      currentPrizeIndex: 0,
      isSequenceComplete: false
    });
  },
  /**
   * hideOverlay - Hide the prize intro overlay
   */
  hideOverlay: () => {
    set({
      isOverlayVisible: false
    });
  },
  /**
   * setCurrentPrizeIndex - Set the current prize index
   */
  setCurrentPrizeIndex: (index) => {
    set({ currentPrizeIndex: index });
  },
  /**
   * nextPrize - Go to the next prize
   */
  nextPrize: () => {
    const state = get();
    set({ currentPrizeIndex: state.currentPrizeIndex + 1 });
  },
  /**
   * previousPrize - Go to the previous prize
   */
  previousPrize: () => {
    const state = get();
    if (state.currentPrizeIndex > 0) {
      set({ currentPrizeIndex: state.currentPrizeIndex - 1 });
    }
  },
  /**
   * markSequenceComplete - Mark the cinematic sequence as complete
   */
  markSequenceComplete: () => {
    set({ isSequenceComplete: true });
  },
  /**
   * shouldShowPrizeIntro - Check if the prize intro should be shown
   * 
   * Logic:
   * 1. If never seen, show it
   * 2. If seen for a different mission, show it again
   * 3. If seen for the same mission, don't show
   */
  shouldShowPrizeIntro: (currentMissionId) => {
    const state = get();
    if (!state.hasSeenPrizeIntro) {
      return true;
    }
    if (currentMissionId && state.lastSeenMissionId !== currentMissionId) {
      return true;
    }
    return false;
  }
}));

const PRIZE_INTRO_MODE = "cinematic";
const CURRENT_MISSION_PRIZES = [
  // =========================================================================
  //  VEHICLES
  // =========================================================================
  {
    id: "prize-lambo-revuelto",
    imageUrl: "/prizes/prize-1.jpg",
    label: "Lamborghini Revuelto",
    tagline: "High-voltage hunt.",
    category: "vehicle",
    isPrimaryCandidate: true,
    estimatedValue: "500,000+"
  },
  {
    id: "prize-ducati-v4",
    imageUrl: "/prizes/prize-6.jpg",
    label: "Ducati Panigale V4",
    tagline: "Pure Italian adrenaline.",
    category: "vehicle",
    isPrimaryCandidate: true,
    estimatedValue: "35,000+"
  },
  // =========================================================================
  //  WATCHES
  // =========================================================================
  {
    id: "prize-rolex-gold",
    imageUrl: "/prizes/prize-2.jpg",
    label: "Rolex Submariner Gold",
    tagline: "Time is a weapon.",
    category: "watch",
    isPrimaryCandidate: true,
    estimatedValue: "38,000+"
  },
  {
    id: "prize-rolex-silver",
    imageUrl: "/prizes/prize-3.jpg",
    label: "Rolex Submariner",
    tagline: "Precision under pressure.",
    category: "watch",
    isPrimaryCandidate: true,
    estimatedValue: "12,000+"
  },
  {
    id: "prize-rolex-daydate",
    imageUrl: "/prizes/prize-4.jpg",
    label: "Rolex Day-Date",
    tagline: "The president's choice.",
    category: "watch",
    isPrimaryCandidate: true,
    estimatedValue: "40,000+"
  },
  // =========================================================================
  //  JEWELRY
  // =========================================================================
  {
    id: "prize-diamonds",
    imageUrl: "/prizes/prize-5.jpg",
    label: "Diamond Collection",
    tagline: "Clarity under fire.",
    category: "jewelry",
    isPrimaryCandidate: true,
    estimatedValue: "50,000+"
  },
  // =========================================================================
  //  FASHION
  // =========================================================================
  {
    id: "prize-hermes-birkin",
    imageUrl: "/prizes/prize-7.jpg",
    label: "Herms Birkin",
    tagline: "Luxury under pressure.",
    category: "fashion",
    isPrimaryCandidate: true,
    estimatedValue: "15,000+"
  },
  {
    id: "prize-hermes-croc",
    imageUrl: "/prizes/prize-9.jpg",
    label: "Herms Birkin Crocodile",
    tagline: "The rarest of the rare.",
    category: "fashion",
    isPrimaryCandidate: true,
    estimatedValue: "80,000+"
  },
  {
    id: "prize-chanel-classic",
    imageUrl: "/prizes/prize-8.jpg",
    label: "Chanel Classic Flap",
    tagline: "Timeless elegance.",
    category: "fashion",
    isPrimaryCandidate: true,
    estimatedValue: "10,000+"
  },
  {
    id: "prize-ysl-envelope",
    imageUrl: "/prizes/prize-10.jpg",
    label: "Saint Laurent Envelope",
    tagline: "Parisian edge.",
    category: "fashion",
    isPrimaryCandidate: true,
    estimatedValue: "3,000+"
  }
];
const SECONDARY_PRIZES_HINT = {
  copy: "Scattered across the map, 99 secondary prizes wait for agents who don't blink."
};
const SHADOW_INTRO_DIALOGUE = {
  entity: "SHADOW",
  lines: [
    "[SHADOW//PRIZE_HUNT]",
    "",
    `"You're not the only one hunting these.`,
    "Agents want them. We want them.",
    "",
    "Only one is real this Mission.",
    'Try not to pick wrong."'
  ]
};
const MCP_INTRO_DIALOGUE = {
  entity: "MCP",
  lines: [
    "[MCP//BRIEFING: PRIZE]",
    "",
    '"A real-world prize is active.',
    "Shadow is already moving.",
    "",
    "Only one of these is linked to this Mission.",
    'The others are noise for now."'
  ]
};
const PRIZE_REVEAL_MESSAGE = "Only one of these is the real target for this Mission.";
const CTA_BUTTON_TEXT = "ENTER THE HUNT";
const PRIZE_INTRO_TIMING = {
  /** Initial fade-in delay before first prize */
  INITIAL_DELAY_MS: 500,
  /** How long each prize image is displayed */
  PRIZE_DISPLAY_MS: 3e3,
  /** Typing speed for dialogue (ms per character) */
  TYPING_SPEED_MS: 30,
  /** Delay after final prize before showing CTA */
  FINAL_DELAY_MS: 1500};
function getRandomPrizes(count = 5) {
  const shuffled = [...CURRENT_MISSION_PRIZES].sort(() => Math.random() - 0.5);
  return shuffled.slice(0, count);
}
function getPrimaryDialogue() {
  const hour = (/* @__PURE__ */ new Date()).getHours();
  const isNight = hour >= 2 && hour < 5;
  return isNight ? SHADOW_INTRO_DIALOGUE : MCP_INTRO_DIALOGUE;
}

const MAX_PRIZES_TO_SHOW = 10;
const EntitySymbol = ({ entity, isActive, reducedMotion }) => {
  switch (entity) {
    case "SHADOW":
      return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `prize-intro-entity shadow-entity ${isActive ? "active" : ""} ${reducedMotion ? "reduced-motion" : ""}`, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "prize-shadow-triangle", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-shadow-eye", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-shadow-pupil" }) }),
          !reducedMotion && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-shadow-glitch-line line-1" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-shadow-glitch-line line-2" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-shadow-glow" })
      ] });
    case "MCP":
      return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `prize-intro-entity mcp-entity ${isActive ? "active" : ""} ${reducedMotion ? "reduced-motion" : ""}`, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "prize-mcp-hex-outer", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-mcp-hex-inner", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-mcp-core" }) }),
          !reducedMotion && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-mcp-scan" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-mcp-ring" }),
        !reducedMotion && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-mcp-pulse" })
      ] });
    case "ECHO":
      return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `prize-intro-entity echo-entity ${isActive ? "active" : ""} ${reducedMotion ? "reduced-motion" : ""}`, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-echo-ring", children: [...Array(8)].map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "prize-echo-particle",
            style: {
              transform: `rotate(${i * 45}deg)`,
              animationDelay: `${i * 0.2}s`
            }
          },
          i
        )) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-echo-wave wave-1" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-echo-wave wave-2" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-echo-wave wave-3" })
      ] });
  }
};
const DialogueTyper = ({ lines, typingSpeed, onComplete, className = "" }) => {
  const [displayedText, setDisplayedText] = reactExports.useState("");
  const [isComplete, setIsComplete] = reactExports.useState(false);
  const fullText = lines.join("\n");
  reactExports.useEffect(() => {
    let index = 0;
    setDisplayedText("");
    setIsComplete(false);
    const timer = setInterval(() => {
      if (index < fullText.length) {
        setDisplayedText(fullText.slice(0, index + 1));
        index++;
      } else {
        clearInterval(timer);
        setIsComplete(true);
        onComplete();
      }
    }, typingSpeed);
    return () => clearInterval(timer);
  }, [fullText, typingSpeed, onComplete]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("pre", { className: `prize-intro-dialogue ${className}`, children: [
    displayedText,
    !isComplete && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "prize-intro-cursor", children: "" })
  ] });
};
const PrizeCard = ({ prize, isActive, index, reducedMotion }) => {
  const [imageLoaded, setImageLoaded] = reactExports.useState(false);
  const [imageError, setImageError] = reactExports.useState(false);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: `prize-card ${isActive ? "active" : ""}`,
      initial: { opacity: 0, scale: 0.9 },
      animate: {
        opacity: isActive ? 1 : 0.3,
        scale: isActive ? 1 : 0.85,
        y: isActive ? 0 : 20
      },
      transition: {
        duration: reducedMotion ? 0.1 : 0.5,
        ease: [0.22, 1, 0.36, 1]
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "prize-card-image-container", children: [
          !imageLoaded && !imageError && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-card-skeleton", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-card-skeleton-shimmer" }) }),
          imageError ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-card-placeholder", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "prize-card-placeholder-text", children: "?" }) }) : /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.img,
            {
              src: prize.imageUrl,
              alt: prize.label,
              className: `prize-card-image ${imageLoaded ? "loaded" : ""}`,
              onLoad: () => setImageLoaded(true),
              onError: () => setImageError(true),
              initial: { opacity: 0 },
              animate: { opacity: imageLoaded ? 1 : 0 },
              transition: { duration: 0.3 }
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-card-glow" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "prize-card-info", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "prize-card-label", children: prize.label }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "prize-card-tagline", children: prize.tagline }),
          prize.estimatedValue && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "prize-card-value", children: prize.estimatedValue })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `prize-card-category ${prize.category}`, children: prize.category.toUpperCase() })
      ]
    }
  );
};
const PrizeGallery = ({ prizes, currentIndex, mode, onIndexChange, reducedMotion }) => {
  const containerRef = reactExports.useRef(null);
  const handleSwipe = reactExports.useCallback((direction) => {
    if (mode !== "carousel") return;
    if (direction === "left" && currentIndex < prizes.length - 1) {
      onIndexChange(currentIndex + 1);
    } else if (direction === "right" && currentIndex > 0) {
      onIndexChange(currentIndex - 1);
    }
  }, [mode, currentIndex, prizes.length, onIndexChange]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "prize-gallery", ref: containerRef, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-gallery-inner", children: prizes.map((prize, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
      PrizeCard,
      {
        prize,
        isActive: index === currentIndex,
        index,
        reducedMotion
      },
      prize.id
    )) }),
    mode === "carousel" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-gallery-indicators", children: prizes.map((_, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        className: `prize-indicator ${index === currentIndex ? "active" : ""}`,
        onClick: () => onIndexChange(index),
        "aria-label": `Go to prize ${index + 1}`
      },
      index
    )) }),
    mode === "carousel" && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          className: "prize-nav-arrow prev",
          onClick: () => handleSwipe("right"),
          disabled: currentIndex === 0,
          "aria-label": "Previous prize",
          children: ""
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          className: "prize-nav-arrow next",
          onClick: () => handleSwipe("left"),
          disabled: currentIndex === prizes.length - 1,
          "aria-label": "Next prize",
          children: ""
        }
      )
    ] })
  ] });
};
const MissionPrizeIntroOverlay = () => {
  const { isAuthenticated, user } = useUnifiedAuth();
  const hasSeenPrizeIntro = usePrizeIntroStore((s) => s.hasSeenPrizeIntro);
  const markPrizeIntroSeen = usePrizeIntroStore((s) => s.markPrizeIntroSeen);
  usePrizeIntroStore((s) => s.isSequenceComplete);
  const markSequenceComplete = usePrizeIntroStore((s) => s.markSequenceComplete);
  const isShadowOverlayVisible = useEntityOverlayStore((s) => s.isVisible);
  const isMissionIntroActive = useEntityOverlayStore((s) => s.showMissionIntro);
  const isIntroActive = useEntityOverlayStore((s) => s.isIntroActive);
  const [isVisible, setIsVisible] = reactExports.useState(false);
  const [currentPrizeIndex, setCurrentPrizeIndex] = reactExports.useState(0);
  const [dialogueComplete, setDialogueComplete] = reactExports.useState(false);
  const [showFinalMessage, setShowFinalMessage] = reactExports.useState(false);
  const [canDismiss, setCanDismiss] = reactExports.useState(false);
  const [prefersReducedMotion, setPrefersReducedMotion] = reactExports.useState(false);
  const prizesToShow = reactExports.useMemo(() => {
    return getRandomPrizes(MAX_PRIZES_TO_SHOW);
  }, []);
  const dialogue = reactExports.useMemo(() => getPrimaryDialogue(), []);
  reactExports.useEffect(() => {
    const mediaQuery = window.matchMedia("(prefers-reduced-motion: reduce)");
    setPrefersReducedMotion(mediaQuery.matches);
    const handler = (e) => setPrefersReducedMotion(e.matches);
    mediaQuery.addEventListener("change", handler);
    return () => mediaQuery.removeEventListener("change", handler);
  }, []);
  reactExports.useEffect(() => {
    if (!isAuthenticated || !user) {
      setIsVisible(false);
      return;
    }
    if (hasSeenPrizeIntro) {
      setIsVisible(false);
      return;
    }
    if (isShadowOverlayVisible || isMissionIntroActive || isIntroActive) {
      return;
    }
    const timer = setTimeout(() => {
      setIsVisible(true);
      window.dispatchEvent(new CustomEvent("shadow:prizeIntroStart"));
    }, PRIZE_INTRO_TIMING.INITIAL_DELAY_MS);
    return () => clearTimeout(timer);
  }, [isAuthenticated, user, hasSeenPrizeIntro, isShadowOverlayVisible, isMissionIntroActive, isIntroActive]);
  reactExports.useEffect(() => {
    if (!isVisible || PRIZE_INTRO_MODE !== "cinematic" || !dialogueComplete) {
      return;
    }
    if (currentPrizeIndex >= prizesToShow.length) {
      setShowFinalMessage(true);
      setTimeout(() => {
        setCanDismiss(true);
        markSequenceComplete();
      }, PRIZE_INTRO_TIMING.FINAL_DELAY_MS);
      return;
    }
    const timer = setTimeout(() => {
      setCurrentPrizeIndex((prev) => prev + 1);
    }, PRIZE_INTRO_TIMING.PRIZE_DISPLAY_MS);
    return () => clearTimeout(timer);
  }, [isVisible, dialogueComplete, currentPrizeIndex, prizesToShow.length, markSequenceComplete]);
  reactExports.useEffect(() => {
    return;
  }, [isVisible]);
  const handleDialogueComplete = reactExports.useCallback(() => {
    setDialogueComplete(true);
  }, []);
  const handleEnterHunt = reactExports.useCallback(() => {
    if (!canDismiss && PRIZE_INTRO_MODE === "cinematic") return;
    markPrizeIntroSeen();
    setIsVisible(false);
  }, [canDismiss, markPrizeIntroSeen]);
  if (!isVisible) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "prize-intro-overlay",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      transition: { duration: prefersReducedMotion ? 0.1 : 0.5 },
      role: "dialog",
      "aria-modal": "true",
      "aria-label": "Mission Prize Introduction",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "prize-intro-bg", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-intro-scanlines" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-intro-vignette" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-intro-grain" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "prize-intro-container", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-intro-entity-container", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            EntitySymbol,
            {
              entity: dialogue.entity,
              isActive: !dialogueComplete,
              reducedMotion: prefersReducedMotion
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "prize-intro-dialogue-container", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            DialogueTyper,
            {
              lines: dialogue.lines,
              typingSpeed: PRIZE_INTRO_TIMING.TYPING_SPEED_MS,
              onComplete: handleDialogueComplete,
              className: `entity-${dialogue.entity.toLowerCase()}`
            }
          ) }),
          dialogueComplete && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "prize-intro-gallery-container",
              initial: { opacity: 0, y: 30 },
              animate: { opacity: 1, y: 0 },
              transition: { duration: prefersReducedMotion ? 0.1 : 0.6, delay: 0.3 },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                PrizeGallery,
                {
                  prizes: prizesToShow,
                  currentIndex: Math.min(currentPrizeIndex, prizesToShow.length - 1),
                  mode: PRIZE_INTRO_MODE,
                  onIndexChange: setCurrentPrizeIndex,
                  reducedMotion: prefersReducedMotion
                }
              )
            }
          ),
          showFinalMessage && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "prize-intro-reveal",
              initial: { opacity: 0, scale: 0.9 },
              animate: { opacity: 1, scale: 1 },
              transition: { duration: prefersReducedMotion ? 0.1 : 0.5 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "prize-intro-reveal-text", children: PRIZE_REVEAL_MESSAGE }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "prize-intro-secondary-hint", children: SECONDARY_PRIZES_HINT.copy })
              ]
            }
          ),
          (canDismiss || PRIZE_INTRO_MODE === "carousel") && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "prize-intro-cta-container",
              initial: { opacity: 0, y: 20 },
              animate: { opacity: 1, y: 0 },
              transition: { duration: prefersReducedMotion ? 0.1 : 0.4, delay: 0.2 },
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "button",
                {
                  className: `prize-intro-cta ${canDismiss ? "enabled" : "disabled"}`,
                  onClick: handleEnterHunt,
                  disabled: !canDismiss && PRIZE_INTRO_MODE === "cinematic",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "prize-intro-cta-text", children: CTA_BUTTON_TEXT }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "prize-intro-cta-glow" })
                  ]
                }
              )
            }
          )
        ] })
      ]
    }
  ) });
};

function App() {
  const [showSplash, setShowSplash] = reactExports.useState(() => {
    return !sessionStorage.getItem("m1_splash_shown_session");
  });
  const [location] = useLocation();
  reactExports.useEffect(() => {
    initGA4();
  }, []);
  reactExports.useEffect(() => {
    const preloadTimer = setTimeout(() => {
      __vitePreload(() => import('./MapTiler3D.B7HciP6X.js'),true?__vite__mapDeps([4,3,2,5,1,6,7,8,9,10]):void 0).catch(() => {
      });
    }, 2e3);
    return () => clearTimeout(preloadTimer);
  }, []);
  reactExports.useEffect(() => {
    if (location) {
      trackPageView(location);
    }
  }, [location]);
  useRouteAnnouncements();
  reactExports.useEffect(() => {
    getComputedStyle(document.documentElement);
  }, []);
  usePWAStabilizer();
  usePushSync();
  useActivityTracker();
  const isMapPage = location.includes("map") || location.includes("buzz");
  const { pullDistance, isRefreshing, progress } = usePullToRefresh({
    threshold: 120,
    // pixels to pull before refresh
    enabled: !isMapPage
    // Disabilitato su pagine mappa
  });
  useGlobalGlitchListener();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "app-shell relative", children: [
    showSplash && /* @__PURE__ */ jsxRuntimeExports.jsx(
      M1LogoSplash,
      {
        onComplete: () => {
          setShowSplash(false);
          sessionStorage.setItem("m1_splash_shown_session", "true");
        },
        duration: 5e3
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "m1-fullscreen-bg" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "m1-grain" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      PullToRefreshIndicator,
      {
        pullDistance,
        isRefreshing,
        progress
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(PushFrozenNotice, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(ErrorBoundary$1, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black text-white p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-6 max-w-md mx-auto text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl font-bold mb-4", children: "ERRORE CRITICO DI SISTEMA" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mb-6", children: "L'applicazione ha riscontrato un errore fatale. Ricarica la pagina." }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => {
            localStorage.clear();
            sessionStorage.clear();
            window.location.reload();
          },
          className: "px-4 py-2 bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink rounded-md",
          children: " RIAVVIA EMERGENZA"
        }
      )
    ] }) }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProductionSafetyWrapper, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProductionSafety, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(HelmetProvider, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(SkipToContent, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(OfflineIndicator, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(RouteAnnouncer, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ReconnectBadge, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Router, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SoundProvider, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AuthProvider, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(OnboardingProvider, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(InterestSignalsProvider, { children: [
        !localStorage.getItem("m1ssion_legal_consent") && /* @__PURE__ */ jsxRuntimeExports.jsx(LegalOnboarding, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(DNAManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CookieConsentManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(OnboardingOverlay, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(WouterRoutes, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(InstallPrompt, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(IOSPermissionManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AndroidPushSetup, { className: "hidden" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(PushNotificationSetup, { className: "hidden" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(XpSystemManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(DynamicIslandProvider, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(DynamicIslandAutoActivator, {}),
          /* @__PURE__ */ jsxRuntimeExports.jsx(DynamicIslandContextManager, {})
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(NorahProactiveManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(MissionBadgeInjector, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(PulseContributionListener, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(PulseRewardNotification, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Toaster, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(ShadowProtocolEngine, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(EntityOverlay, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(ShadowBehaviorsLayer, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(MissionIntroOverlay, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(MissionPrizeIntroOverlay, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(BadgeAuditReport, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(M1UnitsDebugPanel, {})
      ] }) }) }) }) })
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(UpdateBanner, {})
  ] });
}

const intel_title$2 = "Intelligence";
const norah_placeholder$2 = "Ask Norah";
const pills_ready$2 = "Suggestions ready ";
const cta_buzz$2 = "Do a BUZZ";
const cta_show_map$2 = "Show BUZZ Map";
const cta_plans$2 = "See plans";
const cta_prizes$2 = "See prizes";
const welcome_back_episode$2 = "Welcome back! Yesterday we were here: \"{{summary}}\". Shall we continue?";
const loading$2 = "Loading";
const no_data$2 = "No data available";
const subscription_free$2 = "Free Plan";
const subscription_silver$2 = "Silver Plan";
const subscription_gold$2 = "Gold Plan";
const subscription_black$2 = "Black Plan";
const subscription_titanium$2 = "Titanium Plan";
const norah_ready$2 = "Norah Intelligence Ready";
const write_natural$2 = "Write in natural language. Ask anything about M1SSION.";
const processing$2 = "Processing...";
const speaking$2 = "Speaking...";
const tts_on$2 = " TTS ON";
const tts_off$2 = " TTS OFF";
const send_enter$2 = "Press Enter to send  Shortcut: A to open/close";
const clues_analyzed$2 = "clues analyzed";
const norah_ai_assistant$2 = "NORAH AI Assistant";
const assistant_description$2 = "Your intelligent companion for navigating M1SSION. Ask questions, get strategic insights, and unlock the secrets of the hunt.";
const cookie_banner_title$1 = "Cookies & Privacy";
const cookie_banner_description$1 = "We use essential cookies for the app to function properly and, with your consent, analytics and marketing cookies to improve your experience. You can change your preferences at any time.";
const cookie_accept_all$1 = "Accept all";
const cookie_reject_all$1 = "Reject";
const cookie_manage_preferences$1 = "Manage preferences";
const cookie_preferences_title$1 = "Manage cookie preferences";
const cookie_preferences_description$1 = "Customize your cookie preferences. Required cookies are always active.";
const cookie_save_preferences$1 = "Save preferences";
const cookie_cancel$1 = "Cancel";
const cookie_necessary_title$1 = "Required cookies";
const cookie_necessary_description$1 = "Essential for the app to function: authentication, sessions, security, and payments. Always active.";
const cookie_necessary_always_active$1 = "Always active";
const cookie_analytics_title$1 = "Analytics cookies";
const cookie_analytics_description$1 = "Help us understand how users interact with the app to improve features and performance.";
const cookie_marketing_title$1 = "Marketing cookies";
const cookie_marketing_description$1 = "Used to deliver personalized ads and measure the effectiveness of advertising campaigns.";
const cookie_personalization_title$1 = "Personalization cookies";
const cookie_personalization_description$1 = "Store preferences such as language, theme, layout, and UI settings to personalize your experience.";
const en = {
	intel_title: intel_title$2,
	norah_placeholder: norah_placeholder$2,
	pills_ready: pills_ready$2,
	cta_buzz: cta_buzz$2,
	cta_show_map: cta_show_map$2,
	cta_plans: cta_plans$2,
	cta_prizes: cta_prizes$2,
	welcome_back_episode: welcome_back_episode$2,
	loading: loading$2,
	no_data: no_data$2,
	subscription_free: subscription_free$2,
	subscription_silver: subscription_silver$2,
	subscription_gold: subscription_gold$2,
	subscription_black: subscription_black$2,
	subscription_titanium: subscription_titanium$2,
	norah_ready: norah_ready$2,
	write_natural: write_natural$2,
	processing: processing$2,
	speaking: speaking$2,
	tts_on: tts_on$2,
	tts_off: tts_off$2,
	send_enter: send_enter$2,
	clues_analyzed: clues_analyzed$2,
	norah_ai_assistant: norah_ai_assistant$2,
	assistant_description: assistant_description$2,
	cookie_banner_title: cookie_banner_title$1,
	cookie_banner_description: cookie_banner_description$1,
	cookie_accept_all: cookie_accept_all$1,
	cookie_reject_all: cookie_reject_all$1,
	cookie_manage_preferences: cookie_manage_preferences$1,
	cookie_preferences_title: cookie_preferences_title$1,
	cookie_preferences_description: cookie_preferences_description$1,
	cookie_save_preferences: cookie_save_preferences$1,
	cookie_cancel: cookie_cancel$1,
	cookie_necessary_title: cookie_necessary_title$1,
	cookie_necessary_description: cookie_necessary_description$1,
	cookie_necessary_always_active: cookie_necessary_always_active$1,
	cookie_analytics_title: cookie_analytics_title$1,
	cookie_analytics_description: cookie_analytics_description$1,
	cookie_marketing_title: cookie_marketing_title$1,
	cookie_marketing_description: cookie_marketing_description$1,
	cookie_personalization_title: cookie_personalization_title$1,
	cookie_personalization_description: cookie_personalization_description$1
};

const intel_title$1 = "Intelligence";
const norah_placeholder$1 = "Chiedi a Norah";
const pills_ready$1 = "Suggerimenti pronti ";
const cta_buzz$1 = "Fai un BUZZ";
const cta_show_map$1 = "Mostra BUZZ Map";
const cta_plans$1 = "Vedi piani";
const cta_prizes$1 = "Vedi premi";
const welcome_back_episode$1 = "Bentornato! Ieri eravamo qui: \"{{summary}}\". Ripartiamo?";
const loading$1 = "Caricamento";
const no_data$1 = "Nessun dato disponibile";
const subscription_free$1 = "Piano Free";
const subscription_silver$1 = "Piano Silver";
const subscription_gold$1 = "Piano Gold";
const subscription_black$1 = "Piano Black";
const subscription_titanium$1 = "Piano Titanium";
const norah_ready$1 = "Norah Intelligence Ready";
const write_natural$1 = "Scrivi in linguaggio naturale. Chiedi qualsiasi cosa su M1SSION.";
const processing$1 = "Processing...";
const speaking$1 = "Speaking...";
const tts_on$1 = " TTS ON";
const tts_off$1 = " TTS OFF";
const send_enter$1 = "Press Enter to send  Shortcut: A to open/close";
const clues_analyzed$1 = "indizi analizzati";
const norah_ai_assistant$1 = "NORAH AI Assistant";
const assistant_description$1 = "Il tuo compagno intelligente per navigare M1SSION. Fai domande, ottieni intuizioni strategiche e sblocca i segreti della caccia.";
const cookie_banner_title = "Cookie & Privacy";
const cookie_banner_description = "Utilizziamo cookie tecnici necessari per il funzionamento dell'app e, con il tuo consenso, cookie di analisi e marketing per migliorare l'esperienza. Puoi modificare le tue preferenze in qualsiasi momento.";
const cookie_accept_all = "Accetta tutto";
const cookie_reject_all = "Rifiuta";
const cookie_manage_preferences = "Gestisci preferenze";
const cookie_preferences_title = "Gestisci preferenze cookie";
const cookie_preferences_description = "Personalizza le tue preferenze sui cookie. I cookie necessari sono sempre attivi.";
const cookie_save_preferences = "Salva preferenze";
const cookie_cancel = "Annulla";
const cookie_necessary_title = "Cookie necessari";
const cookie_necessary_description = "Essenziali per il funzionamento dell'app: autenticazione, sessioni, sicurezza e pagamenti. Sempre attivi.";
const cookie_necessary_always_active = "Sempre attivi";
const cookie_analytics_title = "Cookie di analisi";
const cookie_analytics_description = "Ci aiutano a comprendere l'interazione degli utenti con l'app per migliorare funzionalit e performance.";
const cookie_marketing_title = "Cookie di marketing";
const cookie_marketing_description = "Utilizzati per mostrare annunci personalizzati e misurare l'efficacia delle campagne pubblicitarie.";
const cookie_personalization_title = "Cookie di personalizzazione";
const cookie_personalization_description = "Memorizzano preferenze come lingua, tema, layout e impostazioni dell'interfaccia per personalizzare la tua esperienza.";
const it = {
	intel_title: intel_title$1,
	norah_placeholder: norah_placeholder$1,
	pills_ready: pills_ready$1,
	cta_buzz: cta_buzz$1,
	cta_show_map: cta_show_map$1,
	cta_plans: cta_plans$1,
	cta_prizes: cta_prizes$1,
	welcome_back_episode: welcome_back_episode$1,
	loading: loading$1,
	no_data: no_data$1,
	subscription_free: subscription_free$1,
	subscription_silver: subscription_silver$1,
	subscription_gold: subscription_gold$1,
	subscription_black: subscription_black$1,
	subscription_titanium: subscription_titanium$1,
	norah_ready: norah_ready$1,
	write_natural: write_natural$1,
	processing: processing$1,
	speaking: speaking$1,
	tts_on: tts_on$1,
	tts_off: tts_off$1,
	send_enter: send_enter$1,
	clues_analyzed: clues_analyzed$1,
	norah_ai_assistant: norah_ai_assistant$1,
	assistant_description: assistant_description$1,
	cookie_banner_title: cookie_banner_title,
	cookie_banner_description: cookie_banner_description,
	cookie_accept_all: cookie_accept_all,
	cookie_reject_all: cookie_reject_all,
	cookie_manage_preferences: cookie_manage_preferences,
	cookie_preferences_title: cookie_preferences_title,
	cookie_preferences_description: cookie_preferences_description,
	cookie_save_preferences: cookie_save_preferences,
	cookie_cancel: cookie_cancel,
	cookie_necessary_title: cookie_necessary_title,
	cookie_necessary_description: cookie_necessary_description,
	cookie_necessary_always_active: cookie_necessary_always_active,
	cookie_analytics_title: cookie_analytics_title,
	cookie_analytics_description: cookie_analytics_description,
	cookie_marketing_title: cookie_marketing_title,
	cookie_marketing_description: cookie_marketing_description,
	cookie_personalization_title: cookie_personalization_title,
	cookie_personalization_description: cookie_personalization_description
};

const intel_title = "Intelligence";
const norah_placeholder = "Demande  Norah";
const pills_ready = "Suggestions prtes ";
const cta_buzz = "Faire un BUZZ";
const cta_show_map = "Voir BUZZ Map";
const cta_plans = "Voir les forfaits";
const cta_prizes = "Voir les prix";
const welcome_back_episode = "Bon retour ! Hier, nous tions ici : \"{{summary}}\". On continue ?";
const loading = "Chargement";
const no_data = "Aucune donne disponible";
const subscription_free = "Forfait Free";
const subscription_silver = "Forfait Silver";
const subscription_gold = "Forfait Gold";
const subscription_black = "Forfait Black";
const subscription_titanium = "Forfait Titanium";
const norah_ready = "Norah Intelligence Ready";
const write_natural = "crivez en langage naturel. Posez des questions sur M1SSION.";
const processing = "Traitement...";
const speaking = "Parler...";
const tts_on = " TTS ON";
const tts_off = " TTS OFF";
const send_enter = "Appuyez sur Entre pour envoyer  Raccourci : A pour ouvrir/fermer";
const clues_analyzed = "indices analyss";
const norah_ai_assistant = "NORAH AI Assistant";
const assistant_description = "Votre compagnon intelligent pour naviguer dans M1SSION. Posez des questions, obtenez des insights stratgiques et dbloquez les secrets de la chasse.";
const fr = {
	intel_title: intel_title,
	norah_placeholder: norah_placeholder,
	pills_ready: pills_ready,
	cta_buzz: cta_buzz,
	cta_show_map: cta_show_map,
	cta_plans: cta_plans,
	cta_prizes: cta_prizes,
	welcome_back_episode: welcome_back_episode,
	loading: loading,
	no_data: no_data,
	subscription_free: subscription_free,
	subscription_silver: subscription_silver,
	subscription_gold: subscription_gold,
	subscription_black: subscription_black,
	subscription_titanium: subscription_titanium,
	norah_ready: norah_ready,
	write_natural: write_natural,
	processing: processing,
	speaking: speaking,
	tts_on: tts_on,
	tts_off: tts_off,
	send_enter: send_enter,
	clues_analyzed: clues_analyzed,
	norah_ai_assistant: norah_ai_assistant,
	assistant_description: assistant_description
};

const STORAGE_KEY = "m1_locale";
const SUPPORTED = ["en", "it", "fr"];
function normalize(lang) {
  if (!lang || typeof lang !== "string") return "en";
  const lower = lang.toLowerCase();
  for (const code of SUPPORTED) {
    if (lower === code || lower.startsWith(code + "-")) return code;
  }
  return "en";
}
function getDeviceLocale() {
  const nav = globalThis?.navigator;
  const byList = Array.isArray(nav?.languages) && nav.languages.length > 0 ? nav.languages[0] : null;
  const raw = byList || nav?.language || nav?.userLanguage || "en";
  return normalize(raw);
}
function getSavedLocale() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? normalize(raw) : null;
  } catch {
    return null;
  }
}
function getDefaultLocale() {
  return getSavedLocale() ?? getDeviceLocale();
}
const resources = {
  en: { common: en },
  it: { common: it },
  fr: { common: fr }
};
let _initialized = false;
async function initI18n() {
  if (_initialized) return;
  const lng = getDefaultLocale();
  if (instance && initReactI18next) {
    await instance.use(initReactI18next).init({
      resources,
      lng,
      fallbackLng: "en",
      supportedLngs: SUPPORTED,
      ns: ["common"],
      defaultNS: "common",
      interpolation: { escapeValue: false }
      // Non tocchiamo detection plugin per non aggiungere dipendenze.
      // Rilevazione custom con getDefaultLocale().
    }).catch(() => {
    });
  }
  _initialized = true;
}
initI18n().catch(console.error);

const setupProductionConsole = () => {
  if (typeof window !== "undefined" && window.location.hostname !== "localhost") {
    const originalLog = console.log;
    const originalWarn = console.warn;
    const originalError = console.error;
    console.log = (...args) => {
      if (args.length > 0 && typeof args[0] === "string" && (args[0].includes("CRITICAL") || args[0].includes("ERROR"))) {
        originalLog.apply(console, args);
      }
    };
    console.warn = originalWarn;
    console.error = originalError;
    console.debug = () => {
    };
    console.info = () => {
    };
  }
};
const enableProductionOptimizations = () => {
  if (typeof window !== "undefined" && window.location.hostname !== "localhost") {
    Object.defineProperty(window, "__REACT_DEVTOOLS_GLOBAL_HOOK__", {
      value: { isDisabled: true }
    });
  }
};

async function getSupabaseBearer() {
  try {
    const { data } = await supabase.auth.getSession();
    return data?.session?.access_token ?? "";
  } catch {
    return "";
  }
}

const initDiagnostics = () => {
  const isDev = location.search.includes("M1_DIAG=1");
  if (!isDev) return;
  window.__M1_NOTIF_TEST__ = {
    ...window.__M1_NOTIF_TEST__,
    async dryRunPref(userId, max = 5, cooldownHours) {
      const qs = new URLSearchParams({
        user_id: userId,
        max: String(max),
        diag: "1"
      });
      if (cooldownHours != null) qs.set("cooldown", String(cooldownHours));
      const baseUrl = `${functionsBaseUrl}/notifier-engine`;
      const res = await fetch(`${baseUrl}/dry-run?${qs.toString()}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${await getSupabaseBearer()}`
        }
      });
      if (!res.ok) {
        const error = await res.text();
        return { error: `HTTP ${res.status}: ${error}` };
      }
      const json = await res.json();
      if (Array.isArray(json?.candidates_sample) && json.candidates_sample.length > 0) ;
      return json;
    },
    async triggerPrefFallback() {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error("No authenticated user");
        }
        const { data: candidates, error } = await supabase.rpc("fn_candidates_for_user", {
          p_user_id: user.id,
          p_limit: 3
        });
        if (error) {
          return { error: error.message };
        }
        return {
          success: true,
          user_id: user.id,
          candidates_count: candidates?.length || 0,
          candidates: candidates || []
        };
      } catch (error) {
        return { error: error.message };
      }
    },
    async checkQuota() {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error("No authenticated user");
        }
        const { data: quota, error } = await supabase.from("notification_quota").select("*").eq("user_id", user.id).single();
        const result = {
          user_id: user.id,
          quota: quota || "No quota record",
          error: error?.message
        };
        return result;
      } catch (error) {
        return { error: error.message };
      }
    },
    async testCandidates(userId) {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        const targetUserId = userId || user?.id;
        if (!targetUserId) {
          throw new Error("No user ID provided");
        }
        const { data: userTags, error: tagsError } = await supabase.from("v_user_resolved_tags").select("*").eq("user_id", targetUserId).single();
        const { data: feedItems, error: feedError } = await supabase.from("external_feed_items").select("id, title, tags, score, published_at").gte("published_at", new Date(Date.now() - 72 * 60 * 60 * 1e3).toISOString()).gte("score", 0.72).order("published_at", { ascending: false }).limit(10);
        const { data: candidates, error: candidatesError } = await supabase.rpc("fn_candidates_for_user", {
          p_user_id: targetUserId,
          p_limit: 5
        });
        const result = {
          user_id: targetUserId,
          user_tags: userTags || "No tags resolved",
          tags_error: tagsError?.message,
          feed_items_count: feedItems?.length || 0,
          feed_error: feedError?.message,
          recent_items: feedItems || [],
          candidates_count: candidates?.length || 0,
          candidates_error: candidatesError?.message,
          candidates: candidates || []
        };
        return result;
      } catch (error) {
        return { error: error.message };
      }
    }
  };
};

function isPushDisabled() {
  try {
    return localStorage.getItem("push:disable") === "1";
  } catch {
    return false;
  }
}
function disablePush() {
  try {
    localStorage.setItem("push:disable", "1");
  } catch (error) {
  }
}
function enablePush() {
  try {
    localStorage.removeItem("push:disable");
  } catch (error) {
  }
}
function checkHotfixDisable() {
  try {
    if (window.location.search.includes("__noPush=1")) {
      disablePush();
      return true;
    }
    return false;
  } catch {
    return false;
  }
}
if (typeof window !== "undefined") {
  window.pushKillSwitch = {
    disable: disablePush,
    enable: enablePush,
    isDisabled: isPushDisabled,
    checkHotfix: checkHotfixDisable
  };
}

{
  __vitePreload(() => Promise.resolve({}),true?__vite__mapDeps([52]):void 0);
  window.__M1_NO_SHIM_DUMP__ = true;
}
if (typeof window !== "undefined") {
  window.__populateKB__ = populateKnowledgeBase;
}
initBadgeDiagnostics();
const ensureMainSWController = async () => {
  if (typeof navigator === "undefined" || !("serviceWorker" in navigator)) return;
  if (!location.hostname.endsWith(".pages.dev")) return;
  try {
    const ctrl = navigator.serviceWorker.controller?.scriptURL || "";
    if (!ctrl.endsWith("/sw.js")) {
      const registration = await navigator.serviceWorker.register("/sw.js", {
        scope: "/",
        updateViaCache: "none"
      });
      if (registration.waiting) {
        registration.waiting.postMessage({ type: "SKIP_WAITING" });
      }
      const reloadKey = "sw-main-reload";
      if (!sessionStorage.getItem(reloadKey)) {
        navigator.serviceWorker.addEventListener("controllerchange", () => {
          sessionStorage.setItem(reloadKey, "1");
          location.reload();
        }, { once: true });
      }
    } else {
    }
  } catch (error) {
  }
};
ensureMainSWController();
const initPWABadgeDiagnosticsSafely = async () => {
  if (typeof window !== "undefined") {
    try {
      const [
        { initPWABadgeDiagnostics, createBadgeTestHelpers },
        { initializeGlobalDebugHelpers }
      ] = await Promise.all([
        __vitePreload(() => Promise.resolve().then(() => pwaBadgeAudit),true?void 0:void 0),
        __vitePreload(() => import('./debugHelpers.DlDSHPue.js'),true?[]:void 0)
      ]);
      initPWABadgeDiagnostics();
      createBadgeTestHelpers();
      initializeGlobalDebugHelpers();
    } catch (err) {
    }
  }
};
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", initPWABadgeDiagnosticsSafely);
} else {
  initPWABadgeDiagnosticsSafely();
}
const initPushSafely = async () => {
  try {
    if (checkHotfixDisable() || isPushDisabled()) {
      return;
    }
    if (!("serviceWorker" in navigator) || !("PushManager" in window)) {
      return;
    }
    let registration;
    try {
      const swReadyPromise = navigator.serviceWorker.ready;
      const timeoutPromise = new Promise(
        (_, reject) => setTimeout(() => reject(new Error("SW ready timeout")), 8e3)
      );
      registration = await Promise.race([swReadyPromise, timeoutPromise]);
      if (!registration?.active) {
        return;
      }
    } catch (swError) {
      return;
    }
    try {
      const pushModule = await __vitePreload(() => import('./testFcm.DjGuDkD2.js'),true?__vite__mapDeps([53,1,2,3,6,5,7,8,9]):void 0);
      if (pushModule?.testFcmFlow) {
        window.testFcmFlow = pushModule.testFcmFlow;
      }
    } catch (importError) {
    }
  } catch (error) {
  }
};
setTimeout(() => {
  initPushSafely().catch(
    (err) => void 0
  );
}, 3e3);
setupProductionConsole();
setupProductionLogging();
enableProductionOptimizations();
if (typeof window !== "undefined") {
  __vitePreload(async () => { const {initPerformanceOptimizations} = await import('./performanceOptimizer.Dyv85dhK.js');return { initPerformanceOptimizations }},true?[]:void 0).then(({ initPerformanceOptimizations }) => {
    initPerformanceOptimizations();
  });
  __vitePreload(async () => { const {initAccessibilityEnhancements} = await import('./accessibilityEnhancer.B5k3Aywr.js');return { initAccessibilityEnhancements }},true?[]:void 0).then(({ initAccessibilityEnhancements }) => {
    initAccessibilityEnhancements();
  });
  {
    __vitePreload(async () => { const {monitoring} = await import('./productionMonitoring.CwBHBKVP.js');return { monitoring }},true?__vite__mapDeps([54,51,1,2,3,6,5,7,8,9]):void 0).then(({ monitoring }) => {
      monitoring.trackFeature("app_initialization");
    });
  }
}
if (typeof window !== "undefined") {
  window.__M1_DEBUG = Object.assign(window.__M1_DEBUG ?? {}, {
    env: {
      TERRAIN: true,
      CONTOUR: true,
      SUPABASE_URL: !!getSupabaseUrl(),
      SUPABASE_ANON_KEY: true
    },
    presence: {
      status: "INIT",
      last: null,
      error: null,
      count: 0
    },
    terrain3D: {
      available: false,
      terrainUrl: "https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=VRJaVKMtkFdyVzhXCjBF",
      active: false
    },
    ping: (m) => void 0
  });
}
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 2,
      refetchOnWindowFocus: false,
      staleTime: 5 * 60 * 1e3
      // 5 minutes
    }
  }
});
const initErrorOverlay = () => {
  if (!new URLSearchParams(window.location.search).get("diag")) return;
  if (new URLSearchParams(window.location.search).get("noerr") === "1") return;
  const showErrorOverlay = (error, context) => {
    const existing = document.getElementById("error-overlay");
    if (existing) existing.remove();
    const overlay = document.createElement("div");
    overlay.id = "error-overlay";
    overlay.style.cssText = `
      position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
      background: rgba(0,0,0,0.97); color: white; z-index: 999999;
      font-family: 'Courier New', monospace; padding: 20px;
      overflow: auto; font-size: 14px; backdrop-filter: blur(2px);
    `;
    const isStripeError = (error?.message || "").includes("getStripe");
    const isNetworkError = (error?.message || "").includes("Failed to fetch");
    const isSWError = (error?.message || "").includes("service worker");
    const getErrorType = () => {
      if (isStripeError) return " STRIPE ERROR";
      if (isNetworkError) return " NETWORK ERROR";
      if (isSWError) return " SERVICE WORKER ERROR";
      return " RUNTIME ERROR";
    };
    const getSuggestion = () => {
      if (isStripeError) return " Prova a ricaricare con reset cache o controlla la configurazione Stripe";
      if (isNetworkError) return " Verifica la connessione internet o riprova pi tardi";
      if (isSWError) return " Ricarica la pagina per risolvere i problemi del service worker";
      return " Prova a ricaricare la pagina. Se il problema persiste, usa Reset App";
    };
    overlay.innerHTML = `
      <div style="max-width: 900px; margin: 0 auto;">
        <h2 style="color: #ff6b6b; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
          ${getErrorType()} (${context})
        </h2>
        <div style="background: #1a1a2e; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #4361ee;">
          <strong>${getSuggestion()}</strong>
        </div>
        <pre style="background: #0f0f23; padding: 15px; border-radius: 8px; white-space: pre-wrap; font-size: 12px; max-height: 300px; overflow: auto; border: 1px solid #333;">
${error?.stack || error?.message || String(error)}
        </pre>
        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
          <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                  style="background: #333; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
             Chiudi
          </button>
          <button onclick="if('caches' in window){caches.keys().then(n => n.forEach(name => caches.delete(name))).finally(() => window.location.reload());} else {window.location.reload();}" 
                  style="background: #4361ee; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
             Ricarica + Cache Reset
          </button>
          <button onclick="localStorage.setItem('push:disable', '1'); window.location.reload();" 
                  style="background: #f39c12; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
             Disabilita Push
          </button>
          <button onclick="localStorage.clear(); sessionStorage.clear(); window.location.href='/app-reset.html';" 
                  style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
             Reset App Completo
          </button>
          <button onclick="window.location.href='/?noerr=1'" 
                  style="background: #666; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
             Disabilita Overlay
          </button>
        </div>
        <div style="margin-top: 15px; padding: 10px; background: #16213e; border-radius: 6px; font-size: 11px; color: #a0a0a0;">
          <strong>Debug Info:</strong> ${navigator.userAgent.includes("Mobile") ? " Mobile" : " Desktop"} | 
          ${window.location.protocol === "capacitor:" ? " Capacitor" : " Web"} | 
          SW: ${navigator.serviceWorker?.controller?.scriptURL?.split("/").pop() || "None"}
        </div>
      </div>
    `;
    document.body.appendChild(overlay);
  };
  window.addEventListener("error", (event) => {
    showErrorOverlay(event.error, "JavaScript Error");
  });
  window.addEventListener("unhandledrejection", (event) => {
    showErrorOverlay(event.reason, "Promise Rejection");
  });
};
const renderApp = () => {
  initErrorOverlay();
  const rootElement = document.getElementById("root");
  if (!rootElement) {
    const fallbackElement = document.createElement("div");
    fallbackElement.innerHTML = `
      <div style="padding: 20px; color: white; background: black; text-align: center;">
        <h1> CRITICAL ERROR</h1>
        <p>Root element not found. Please refresh the page.</p>
        <button onclick="window.location.reload()" style="background: #333; color: white; padding: 8px 16px; margin-top: 16px; border: none; border-radius: 4px; cursor: pointer;">
           Ricarica App
        </button>
      </div>
    `;
    document.body.appendChild(fallbackElement);
    return;
  }
  try {
    const root = client$1.createRoot(rootElement);
    root.render(
      /* @__PURE__ */ jsxRuntimeExports.jsx(I18nextProvider, { i18n: instance, children: /* @__PURE__ */ jsxRuntimeExports.jsx(QueryClientProvider, { client: queryClient, children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-background flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground font-orbitron", children: "Inizializzazione M1SSION..." }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Se il caricamento si blocca, ricarica la pagina" })
      ] }) }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(App, {}) }) }) })
    );
  } catch (error) {
    if (rootElement) {
      const errorDiv = document.createElement("div");
      errorDiv.style.cssText = `
        padding: 20px;
        color: white;
        background: linear-gradient(135deg, #000, #111);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      `;
      errorDiv.innerHTML = `
        <h1 style="color: #ff4444; margin-bottom: 20px;"> ERRORE CRITICO DI SISTEMA</h1>
        <p style="margin-bottom: 20px; max-width: 500px;">
          L'applicazione M1SSION ha riscontrato un errore critico. 
          Usa i bottoni sotto per riavviare l'app.
        </p>
        <div style="margin-top: 20px;">
          <button 
            onclick="window.location.reload()" 
            style="
              background: linear-gradient(135deg, #4361ee, #7209b7);
              color: white;
              padding: 12px 24px;
              margin: 8px;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-size: 16px;
            "
          >
             Ricarica App
          </button>
          <button 
            onclick="localStorage.clear(); sessionStorage.clear(); window.location.reload();" 
            style="
              background: #333;
              color: white;
              padding: 12px 24px;
              margin: 8px;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-size: 16px;
            "
          >
             Reset Completo
          </button>
        </div>
        <details style="margin-top: 20px; max-width: 600px; text-align: left;">
          <summary style="cursor: pointer; margin-bottom: 10px; color: #aaa;">Dettagli tecnici</summary>
          <pre style="background: #111; padding: 10px; border-radius: 4px; overflow: auto; font-size: 12px;">${error?.stack || error?.message || String(error)}</pre>
        </details>
        <div style="margin-top: 30px; font-size: 12px; color: #666;">
          M1SSION  2025 Joseph MUL  NIYVORA KFT
        </div>
      `;
      rootElement.appendChild(errorDiv);
    }
  }
};
const log = (message, data) => {
  if (window.location.search.includes("debug=1")) ;
};
const enforceAppSWController = async () => {
  if (!("serviceWorker" in navigator)) return;
  try {
    const controller = navigator.serviceWorker.controller;
    const isOnPagesdev = window.location.hostname.includes("pages.dev");
    log("[SW-ENFORCE] Current controller:", controller?.scriptURL || "none");
    log("[SW-ENFORCE] On Pages.dev:", isOnPagesdev);
    if (isOnPagesdev && (!controller || !controller.scriptURL.endsWith("/sw.js"))) {
      const registrations = await navigator.serviceWorker.getRegistrations();
      for (const reg of registrations) {
        if (reg.scope === window.location.origin + "/" && !reg.active?.scriptURL.endsWith("/sw.js")) {
          await reg.unregister();
        }
      }
      const registration = await navigator.serviceWorker.register("/sw.js", {
        scope: "/",
        updateViaCache: "none"
      });
      await registration.update();
      const showUpdateToast = () => {
        const toast = document.createElement("div");
        toast.style.cssText = `
          position: fixed; top: 20px; right: 20px; z-index: 999999;
          background: #4361ee; color: white; padding: 12px 20px;
          border-radius: 8px; font-family: sans-serif; font-size: 14px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        toast.textContent = " Aggiornamento app...";
        document.body.appendChild(toast);
        setTimeout(() => {
          toast.remove();
          window.location.reload();
        }, 1500);
      };
      navigator.serviceWorker.addEventListener("controllerchange", showUpdateToast, { once: true });
    } else {
    }
  } catch (error) {
  }
};
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", () => {
    initAppWithSWGuard();
  });
} else {
  initAppWithSWGuard();
}
async function initAppWithSWGuard() {
  try {
    if (typeof window !== "undefined" && "serviceWorker" in navigator) {
      await enforceAppSWController();
      __vitePreload(() => import('./swControllerGuard.PKLz7zB_.js'),true?[]:void 0).then(async ({ ensureAppSWController, logActiveSWs }) => {
        try {
          const success = await ensureAppSWController();
          await logActiveSWs();
          if (false) ;
          if (success) {
          } else {
          }
        } catch (error) {
        }
      });
    }
    renderApp();
  } catch (error) {
    renderApp();
  }
}
if (typeof window !== "undefined") {
  setTimeout(() => {
    __vitePreload(async () => { const {initSilentAutoUpdate} = await import('./silentAutoUpdate.SOYHFwZe.js');return { initSilentAutoUpdate }},true?[]:void 0).then(({ initSilentAutoUpdate }) => {
      initSilentAutoUpdate({
        debug: false
      }).catch((err) => {
      });
    });
  }, 2500);
  const initInterestSignals = () => {
    try {
      const isDebugMode = new URLSearchParams(window.location.search).get("M1_DIAG") === "1";
      if (isDebugMode) {
        __vitePreload(async () => { const {diagnostics: diagnostics2} = await import('./interestSignals.Dc6ZMrNh.js');return { diagnostics: diagnostics2 }},true?__vite__mapDeps([51,1,2,3,6,5,7,8,9]):void 0).then(({ diagnostics: diagnostics2 }) => {
          window.__M1_SIG__ = diagnostics2;
        });
      }
      __vitePreload(async () => { const {initAutoInterestSignals} = await import('./useAutoInterestSignals.CeXJWyfH.js');return { initAutoInterestSignals }},true?__vite__mapDeps([50,2,51,1,3,6,5,7,8,9]):void 0).then(({ initAutoInterestSignals }) => {
        initAutoInterestSignals();
        if (isDebugMode) {
        }
      }).catch((err) => {
      });
    } catch (error) {
    }
  };
  setTimeout(initInterestSignals, 3e3);
  setTimeout(() => {
    initDiagnostics();
  }, 100);
}
let _lastErrorLog = 0;
let _errorLogCount = 0;
const ERROR_LOG_COOLDOWN = 1e3;
const MAX_ERROR_LOGS_PER_MINUTE = 5;
window.addEventListener("error", (event) => {
  const now = Date.now();
  if (now - _lastErrorLog > 6e4) {
    _errorLogCount = 0;
  }
  if (now - _lastErrorLog < ERROR_LOG_COOLDOWN || _errorLogCount >= MAX_ERROR_LOGS_PER_MINUTE) {
    return;
  }
  if (!event.error?.message && !event.filename && event.lineno === 0) {
    return;
  }
  _lastErrorLog = now;
  _errorLogCount++;
});
let _lastRejectionLog = 0;
let _rejectionLogCount = 0;
window.addEventListener("unhandledrejection", (event) => {
  const now = Date.now();
  if (now - _lastRejectionLog > 6e4) {
    _rejectionLogCount = 0;
  }
  if (now - _lastRejectionLog < ERROR_LOG_COOLDOWN || _rejectionLogCount >= MAX_ERROR_LOGS_PER_MINUTE) {
    return;
  }
  _lastRejectionLog = now;
  _rejectionLogCount++;
});
if (typeof window !== "undefined") {
  if (window.location.protocol === "capacitor:" || window.Capacitor) {
    __vitePreload(async () => { const {initializePWA} = await Promise.resolve().then(() => pwaNativeFunctions);return { initializePWA }},true?void 0:void 0).then(({ initializePWA }) => {
      initializePWA();
    });
  } else {
    __vitePreload(async () => { const {optimizePWATouchGestures} = await Promise.resolve().then(() => pwaNativeFunctions);return { optimizePWATouchGestures }},true?void 0:void 0).then(({ optimizePWATouchGestures }) => {
      optimizePWATouchGestures();
    });
  }
}

export { SelectContent as $, CardHeader as A, Button as B, Circle as C, Swords as D, Eye as E, FileText as F, Gift as G, CardTitle as H, Input as I, Clock as J, ChevronDown as K, Lock as L, MapPin as M, CardDescription as N, CardContent as O, Plus as P, Activity as Q, Radio as R, Sparkles as S, Target as T, Users as U, ScrollArea as V, Select as W, X, SelectTrigger as Y, Zap as Z, SelectValue as _, useAuthContext as a, DialogHeader as a$, SelectItem as a0, clamp as a1, usePrevious as a2, cn as a3, LoaderCircle as a4, Badge as a5, useToast as a6, Label$1 as a7, Search as a8, STAKE_TYPES as a9, BottomNavigation as aA, Database as aB, User as aC, Play as aD, Switch as aE, Separator$1 as aF, functionsBaseUrl as aG, useAuth as aH, Bell as aI, Send as aJ, broadcastGlobalGlitch as aK, Map$1 as aL, isAdminEmail as aM, useUnifiedPush as aN, BellOff as aO, Smartphone as aP, Monitor as aQ, NEW_PUSH_SUBSCRIBE_FLOW as aR, subscribeFlow as aS, registerPush as aT, UnifiedPushToggle as aU, ArrowLeft as aV, Checkbox as aW, subscribeWebPushAndSave as aX, Cpu as aY, Dialog as aZ, DialogContent as a_, STAKE_PERCENTS as aa, Coins as ab, Tabs as ac, TabsList as ad, TabsTrigger as ae, TabsContent as af, ShoppingCart as ag, useSafeNavigate as ah, ExternalLink as ai, acceptBattle as aj, CircleCheckBig as ak, CircleAlert as al, Trophy as am, CircleX as an, Star as ao, CopyJsonButton as ap, useMapGlitchEffect as aq, useGeolocation as ar, useProfileImage as as, useNotificationManager as at, usePerformanceSettings as au, UnifiedHeader as av, NotificationsBanner as aw, Compass as ax, RotateCcw as ay, M1UPill$1 as az, useCashbackWallet as b, DialogTitle as b0, DialogFooter as b1, Save as b2, SquarePen as b3, Award as b4, Calendar as b5, getProjectRef as b6, Alert as b7, AlertDescription as b8, logMissionConfigChange as b9, Brain as bA, TrendingUp as bB, Download as bC, getSupabaseConfig as bD, Copy as bE, enable as bF, webPushManager as bG, Server as bH, Wifi as bI, useOnboarding as bJ, PAGE_ORDER as bK, ONBOARDING_STEPS as bL, ChevronRight as bM, hapticLight as bN, Bot as bO, useEntityOverlayStore as bP, selectRecentEvents as bQ, selectShadowThreatLevel as bR, selectEntityEventCounts as bS, getThreatLevelCategory as bT, client as bU, clientUtils as bV, purify_es as bW, ga4 as bX, ChartColumn as ba, useWouterNavigation as bb, CircleCheck as bc, runRepairFlow as bd, Helmet as be, PUSH_PREFLIGHT_ENABLED as bf, getSupabaseAnonKey as bg, getSupabaseUrl as bh, House as bi, Skeleton as bj, AlertDialog as bk, AlertDialogTrigger as bl, AlertDialogContent as bm, AlertDialogHeader as bn, AlertDialogTitle as bo, AlertDialogDescription as bp, AlertDialogFooter as bq, AlertDialogCancel as br, AlertDialogAction as bs, format as bt, it$1 as bu, MessageSquare as bv, logAuditEvent as bw, getProjectRef$1 as bx, getFunctionsUrl as by, Progress as bz, createLucideIcon as c, useM1UnitsRealtime as d, ue as e, showInsufficientM1UToast as f, useBuzzApi as g, emitSubscribed as h, emitError as i, getCurrentWeekOfYear as j, useUnifiedAuth as k, useLocalStorage as l, Shield as m, notifyShadowContext as n, TriangleAlert as o, useDebugFlag as p, useBuzzMapPricingNew as q, Textarea as r, supabase as s, ChevronUp as t, useLocation as u, Card as v, Settings as w, RefreshCw as x, Crosshair as y, Trash2 as z };
