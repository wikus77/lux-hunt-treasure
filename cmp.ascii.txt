const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mapStore.JLa_QD65.js","assets/three-vendor.4wD2n4JV.js","assets/react-vendor.B02iMYpI.js","assets/ui-vendor.BgyryIrM.js","assets/MapContainer.BzLlMbY9.js","assets/supabase-vendor.Dp_PbwBS.js","assets/map-vendor.CeKxnDwt.js","assets/animation-vendor.B1BQgZx0.js","assets/stripe-vendor.Cp0t1EGF.js","assets/router-vendor.DbuyXVQj.js","assets/MapContainer.bkSrcfSQ.css","assets/index.es.C2sUtx33.js","assets/MarkersHealthcheck.AImpxiSB.js","assets/PushDebug.CJZhcf47.js","assets/UserPushConsolePage.CZXH3ZPh.js","assets/android-push-test.DXQYT0Bp.js","assets/native-push-test.DnGsTR6A.js","assets/BillingSmokeTest.52W_56D0.js","assets/DevStripeKeysSetup.1TJZ-9aC.js","assets/useAutoInterestSignals.Uq2e0Uow.js","assets/interestSignals.Bd4q-fDM.js","assets/prod-hide-debug.Be_kZpfd.css","assets/testFcm.CUs4c0yT.js","assets/productionMonitoring.PtFnv4Xs.js"])))=>i.map(i=>d[i]);
var e,t,i,a,s,r,n,o,l,c,d,u,h,m,p,f,g,x,b,v,y,w,N,j,S,_,k,C,A,z,E,I,P,T,M,L,F,O,D,R,B,U,q,$,W,H,Z,V=Object.defineProperty,G=e=>{throw TypeError(e)},Y=(e,t,i)=>((e,t,i)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i),K=(e,t,i)=>t.has(e)||G("Cannot "+i),X=(e,t,i)=>(K(e,t,"read from private field"),i?i.call(e):t.get(e)),J=(e,t,i)=>t.has(e)?G("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),Q=(e,t,i,a)=>(K(e,t,"write to private field"),a?a.call(e,i):t.set(e,i),i),ee=(e,t,i)=>(K(e,t,"access private method"),i),te=(e,t,i,a)=>({set _(a){Q(e,t,a,i)},get _(){return X(e,t,a)}});import{c as ie,_ as ae}from"./supabase-vendor.Dp_PbwBS.js";import{j as se,c as re,P as ne,u as oe,b as le,d as ce,e as de,f as ue,g as he,h as me,i as pe,O as fe,k as ge,W as xe,C as be,l as ve,T as ye,D as we,m as Ne,R as je,n as Se,o as _e,p as ke,A as Ce,q as Ae,r as ze,s as Ee,v as Ie,w as Pe,x as Te,F as Me,y as Le,z as Fe,B as Oe,E as De,V as Re,G as Be,H as Ue,I as qe,J as $e}from"./ui-vendor.BgyryIrM.js";import{r as We,R as He,c as Ze,b as Ve,d as Ge,a as Ye}from"./react-vendor.B02iMYpI.js";import{s as Ke,c as Xe,p as Je,a as Qe}from"./three-vendor.4wD2n4JV.js";import{m as et,A as tt,u as it,L as at}from"./animation-vendor.B1BQgZx0.js";import{L as st,M as rt,T as nt,a as ot,P as lt,C as ct,u as dt}from"./map-vendor.CeKxnDwt.js";import{l as ut,E as ht,u as mt,a as pt,C as ft}from"./stripe-vendor.Cp0t1EGF.js";import{u as gt}from"./router-vendor.DbuyXVQj.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var xt=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},bt={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},vt=new(i=class{constructor(){J(this,e,bt),J(this,t,!1)}setTimeoutProvider(t){Q(this,e,t)}setTimeout(t,i){return X(this,e).setTimeout(t,i)}clearTimeout(t){X(this,e).clearTimeout(t)}setInterval(t,i){return X(this,e).setInterval(t,i)}clearInterval(t){X(this,e).clearInterval(t)}},e=new WeakMap,t=new WeakMap,i);var yt="undefined"==typeof window||"Deno"in globalThis;function wt(){}function Nt(e,t){return"function"==typeof e?e(t):e}function jt(e,t){const{type:i="all",exact:a,fetchStatus:s,predicate:r,queryKey:n,stale:o}=e;if(n)if(a){if(t.queryHash!==_t(n,t.options))return!1}else if(!Ct(t.queryKey,n))return!1;if("all"!==i){const e=t.isActive();if("active"===i&&!e)return!1;if("inactive"===i&&e)return!1}return("boolean"!=typeof o||t.isStale()===o)&&((!s||s===t.state.fetchStatus)&&!(r&&!r(t)))}function St(e,t){const{exact:i,status:a,predicate:s,mutationKey:r}=e;if(r){if(!t.options.mutationKey)return!1;if(i){if(kt(t.options.mutationKey)!==kt(r))return!1}else if(!Ct(t.options.mutationKey,r))return!1}return(!a||t.state.status===a)&&!(s&&!s(t))}function _t(e,t){return(t?.queryKeyHashFn||kt)(e)}function kt(e){return JSON.stringify(e,(e,t)=>It(t)?Object.keys(t).sort().reduce((e,i)=>(e[i]=t[i],e),{}):t)}function Ct(e,t){return e===t||typeof e==typeof t&&(!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&Object.keys(t).every(i=>Ct(e[i],t[i])))}var At=Object.prototype.hasOwnProperty;function zt(e,t){if(e===t)return e;const i=Et(e)&&Et(t);if(!(i||It(e)&&It(t)))return t;const a=(i?e:Object.keys(e)).length,s=i?t:Object.keys(t),r=s.length,n=i?new Array(r):{};let o=0;for(let l=0;l<r;l++){const r=i?l:s[l],c=e[r],d=t[r];if(c===d){n[r]=c,(i?l<a:At.call(e,r))&&o++;continue}if(null===c||null===d||"object"!=typeof c||"object"!=typeof d){n[r]=d;continue}const u=zt(c,d);n[r]=u,u===c&&o++}return a===r&&o===a?e:n}function Et(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function It(e){if(!Pt(e))return!1;const t=e.constructor;if(void 0===t)return!0;const i=t.prototype;return!!Pt(i)&&(!!i.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype)}function Pt(e){return"[object Object]"===Object.prototype.toString.call(e)}function Tt(e,t,i){return"function"==typeof i.structuralSharing?i.structuralSharing(e,t):!1!==i.structuralSharing?zt(e,t):t}function Mt(e,t,i=0){const a=[...e,t];return i&&a.length>i?a.slice(1):a}function Lt(e,t,i=0){const a=[t,...e];return i&&a.length>i?a.slice(0,-1):a}var Ft=Symbol();function Ot(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:e.queryFn&&e.queryFn!==Ft?e.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))}var Dt=new(n=class extends xt{constructor(){super(),J(this,a),J(this,s),J(this,r),Q(this,r,e=>{if(!yt&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){X(this,s)||this.setEventListener(X(this,r))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=X(this,s))||e.call(this),Q(this,s,void 0))}setEventListener(e){var t;Q(this,r,e),null==(t=X(this,s))||t.call(this),Q(this,s,e(e=>{"boolean"==typeof e?this.setFocused(e):this.onFocus()}))}setFocused(e){X(this,a)!==e&&(Q(this,a,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return"boolean"==typeof X(this,a)?X(this,a):"hidden"!==globalThis.document?.visibilityState}},a=new WeakMap,s=new WeakMap,r=new WeakMap,n);var Rt=function(e){setTimeout(e,0)};var Bt=function(){let e=[],t=0,i=e=>{e()},a=e=>{e()},s=Rt;const r=a=>{t?e.push(a):s(()=>{i(a)})};return{batch:r=>{let n;t++;try{n=r()}finally{t--,t||(()=>{const t=e;e=[],t.length&&s(()=>{a(()=>{t.forEach(e=>{i(e)})})})})()}return n},batchCalls:e=>(...t)=>{r(()=>{e(...t)})},schedule:r,setNotifyFunction:e=>{i=e},setBatchNotifyFunction:e=>{a=e},setScheduler:e=>{s=e}}}(),Ut=new(d=class extends xt{constructor(){super(),J(this,o,!0),J(this,l),J(this,c),Q(this,c,e=>{if(!yt&&window.addEventListener){const t=()=>e(!0),i=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",i)}}})}onSubscribe(){X(this,l)||this.setEventListener(X(this,c))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=X(this,l))||e.call(this),Q(this,l,void 0))}setEventListener(e){var t;Q(this,c,e),null==(t=X(this,l))||t.call(this),Q(this,l,e(this.setOnline.bind(this)))}setOnline(e){X(this,o)!==e&&(Q(this,o,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return X(this,o)}},o=new WeakMap,l=new WeakMap,c=new WeakMap,d);function qt(e){return Math.min(1e3*2**e,3e4)}function $t(e){return"online"!==(e??"online")||Ut.isOnline()}var Wt=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function Ht(e){let t,i=!1,a=0;const s=function(){let e,t;const i=new Promise((i,a)=>{e=i,t=a});function a(e){Object.assign(i,e),delete i.resolve,delete i.reject}return i.status="pending",i.catch(()=>{}),i.resolve=t=>{a({status:"fulfilled",value:t}),e(t)},i.reject=e=>{a({status:"rejected",reason:e}),t(e)},i}(),r=()=>"pending"!==s.status,n=()=>Dt.isFocused()&&("always"===e.networkMode||Ut.isOnline())&&e.canRun(),o=()=>$t(e.networkMode)&&e.canRun(),l=e=>{r()||(t?.(),s.resolve(e))},c=e=>{r()||(t?.(),s.reject(e))},d=()=>new Promise(i=>{t=e=>{(r()||n())&&i(e)},e.onPause?.()}).then(()=>{t=void 0,r()||e.onContinue?.()}),u=()=>{if(r())return;let t;const s=0===a?e.initialPromise:void 0;try{t=s??e.fn()}catch(o){t=Promise.reject(o)}Promise.resolve(t).then(l).catch(t=>{if(r())return;const s=e.retry??(yt?0:3),o=e.retryDelay??qt,l="function"==typeof o?o(a,t):o,h=!0===s||"number"==typeof s&&a<s||"function"==typeof s&&s(a,t);var m;!i&&h?(a++,e.onFail?.(a,t),(m=l,new Promise(e=>{vt.setTimeout(e,m)})).then(()=>n()?void 0:d()).then(()=>{i?c(t):u()})):c(t)})};return{promise:s,status:()=>s.status,cancel:t=>{if(!r()){const i=new Wt(t);c(i),e.onCancel?.(i)}},continue:()=>(t?.(),s),cancelRetry:()=>{i=!0},continueRetry:()=>{i=!1},canStart:o,start:()=>(o()?u():d().then(u),s)}}var Zt=(h=class{constructor(){J(this,u)}destroy(){this.clearGcTimeout()}scheduleGc(){var e;this.clearGcTimeout(),"number"==typeof(e=this.gcTime)&&e>=0&&e!==1/0&&Q(this,u,vt.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(yt?1/0:3e5))}clearGcTimeout(){X(this,u)&&(vt.clearTimeout(X(this,u)),Q(this,u,void 0))}},u=new WeakMap,h),Vt=(N=class extends Zt{constructor(e){super(),J(this,y),J(this,m),J(this,p),J(this,f),J(this,g),J(this,x),J(this,b),J(this,v),Q(this,v,!1),Q(this,b,e.defaultOptions),this.setOptions(e.options),this.observers=[],Q(this,g,e.client),Q(this,f,X(this,g).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Q(this,m,Gt(this.options)),this.state=e.state??X(this,m),this.scheduleGc()}get meta(){return this.options.meta}get promise(){return X(this,x)?.promise}setOptions(e){if(this.options={...X(this,b),...e},this.updateGcTime(this.options.gcTime),this.state&&void 0===this.state.data){const e=Gt(this.options);void 0!==e.data&&(this.setData(e.data,{updatedAt:e.dataUpdatedAt,manual:!0}),Q(this,m,e))}}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||X(this,f).remove(this)}setData(e,t){const i=Tt(this.state.data,e,this.options);return ee(this,y,w).call(this,{data:i,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),i}setState(e,t){ee(this,y,w).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){const t=X(this,x)?.promise;return X(this,x)?.cancel(e),t?t.then(wt).catch(wt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(X(this,m))}isActive(){return this.observers.some(e=>{return!1!==(t=e.options.enabled,i=this,"function"==typeof t?t(i):t);var t,i})}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Ft||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===Nt(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!function(e,t){return Math.max(e+(t||0)-Date.now(),0)}(this.state.dataUpdatedAt,e))}onFocus(){const e=this.observers.find(e=>e.shouldFetchOnWindowFocus());e?.refetch({cancelRefetch:!1}),X(this,x)?.continue()}onOnline(){const e=this.observers.find(e=>e.shouldFetchOnReconnect());e?.refetch({cancelRefetch:!1}),X(this,x)?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),X(this,f).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(X(this,x)&&(X(this,v)?X(this,x).cancel({revert:!0}):X(this,x).cancelRetry()),this.scheduleGc()),X(this,f).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ee(this,y,w).call(this,{type:"invalidate"})}async fetch(e,t){if("idle"!==this.state.fetchStatus&&"rejected"!==X(this,x)?.status())if(void 0!==this.state.data&&t?.cancelRefetch)this.cancel({silent:!0});else if(X(this,x))return X(this,x).continueRetry(),X(this,x).promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const i=new AbortController,a=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(Q(this,v,!0),i.signal)})},s=()=>{const e=Ot(this.options,t),i=(()=>{const e={client:X(this,g),queryKey:this.queryKey,meta:this.meta};return a(e),e})();return Q(this,v,!1),this.options.persister?this.options.persister(e,i,this):e(i)},r=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:X(this,g),state:this.state,fetchFn:s};return a(e),e})();this.options.behavior?.onFetch(r,this),Q(this,p,this.state),"idle"!==this.state.fetchStatus&&this.state.fetchMeta===r.fetchOptions?.meta||ee(this,y,w).call(this,{type:"fetch",meta:r.fetchOptions?.meta}),Q(this,x,Ht({initialPromise:t?.initialPromise,fn:r.fetchFn,onCancel:e=>{e instanceof Wt&&e.revert&&this.setState({...X(this,p),fetchStatus:"idle"}),i.abort()},onFail:(e,t)=>{ee(this,y,w).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{ee(this,y,w).call(this,{type:"pause"})},onContinue:()=>{ee(this,y,w).call(this,{type:"continue"})},retry:r.options.retry,retryDelay:r.options.retryDelay,networkMode:r.options.networkMode,canRun:()=>!0}));try{const e=await X(this,x).start();if(void 0===e)throw new Error(`${this.queryHash} data is undefined`);return this.setData(e),X(this,f).config.onSuccess?.(e,this),X(this,f).config.onSettled?.(e,this.state.error,this),e}catch(n){if(n instanceof Wt){if(n.silent)return X(this,x).promise;if(n.revert){if(void 0===this.state.data)throw n;return this.state.data}}throw ee(this,y,w).call(this,{type:"error",error:n}),X(this,f).config.onError?.(n,this),X(this,f).config.onSettled?.(this.state.data,n,this),n}finally{this.scheduleGc()}}},m=new WeakMap,p=new WeakMap,f=new WeakMap,g=new WeakMap,x=new WeakMap,b=new WeakMap,v=new WeakMap,y=new WeakSet,w=function(e){this.state=(t=>{switch(e.type){case"failed":return{...t,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...(i=t.data,a=this.options,{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:$t(a.networkMode)?"fetching":"paused",...void 0===i&&{error:null,status:"pending"}}),fetchMeta:e.meta??null};case"success":const s={...t,data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Q(this,p,e.manual?s:void 0),s;case"error":const r=e.error;return{...t,error:r,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...e.state}}var i,a})(this.state),Bt.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),X(this,f).notify({query:this,type:"updated",action:e})})},N);function Gt(e){const t="function"==typeof e.initialData?e.initialData():e.initialData,i=void 0!==t,a=i?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:i?"success":"pending",fetchStatus:"idle"}}function Yt(e){return{onFetch:(t,i)=>{const a=t.options,s=t.fetchOptions?.meta?.fetchMore?.direction,r=t.state.data?.pages||[],n=t.state.data?.pageParams||[];let o={pages:[],pageParams:[]},l=0;const c=async()=>{let i=!1;const c=Ot(t.options,t.fetchOptions),d=async(e,a,s)=>{if(i)return Promise.reject();if(null==a&&e.pages.length)return Promise.resolve(e);const r=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:a,direction:s?"backward":"forward",meta:t.options.meta};var r;return r=e,Object.defineProperty(r,"signal",{enumerable:!0,get:()=>(t.signal.aborted?i=!0:t.signal.addEventListener("abort",()=>{i=!0}),t.signal)}),e})(),n=await c(r),{maxPages:o}=t.options,l=s?Lt:Mt;return{pages:l(e.pages,n,o),pageParams:l(e.pageParams,a,o)}};if(s&&r.length){const e="backward"===s,t={pages:r,pageParams:n},i=(e?Xt:Kt)(a,t);o=await d(t,i,e)}else{const t=e??r.length;do{const e=0===l?n[0]??a.initialPageParam:Kt(a,o);if(l>0&&null==e)break;o=await d(o,e),l++}while(l<t)}return o};t.options.persister?t.fetchFn=()=>t.options.persister?.(c,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},i):t.fetchFn=c}}}function Kt(e,{pages:t,pageParams:i}){const a=t.length-1;return t.length>0?e.getNextPageParam(t[a],t,i[a],i):void 0}function Xt(e,{pages:t,pageParams:i}){return t.length>0?e.getPreviousPageParam?.(t[0],t,i[0],i):void 0}var Jt=(z=class extends Zt{constructor(e){super(),J(this,C),J(this,j),J(this,S),J(this,_),J(this,k),Q(this,j,e.client),this.mutationId=e.mutationId,Q(this,_,e.mutationCache),Q(this,S,[]),this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){X(this,S).includes(e)||(X(this,S).push(e),this.clearGcTimeout(),X(this,_).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Q(this,S,X(this,S).filter(t=>t!==e)),this.scheduleGc(),X(this,_).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){X(this,S).length||("pending"===this.state.status?this.scheduleGc():X(this,_).remove(this))}continue(){return X(this,k)?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{ee(this,C,A).call(this,{type:"continue"})},i={client:X(this,j),meta:this.options.meta,mutationKey:this.options.mutationKey};Q(this,k,Ht({fn:()=>this.options.mutationFn?this.options.mutationFn(e,i):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{ee(this,C,A).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{ee(this,C,A).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>X(this,_).canRun(this)}));const a="pending"===this.state.status,s=!X(this,k).canStart();try{if(a)t();else{ee(this,C,A).call(this,{type:"pending",variables:e,isPaused:s}),await(X(this,_).config.onMutate?.(e,this,i));const t=await(this.options.onMutate?.(e,i));t!==this.state.context&&ee(this,C,A).call(this,{type:"pending",context:t,variables:e,isPaused:s})}const r=await X(this,k).start();return await(X(this,_).config.onSuccess?.(r,e,this.state.context,this,i)),await(this.options.onSuccess?.(r,e,this.state.context,i)),await(X(this,_).config.onSettled?.(r,null,this.state.variables,this.state.context,this,i)),await(this.options.onSettled?.(r,null,e,this.state.context,i)),ee(this,C,A).call(this,{type:"success",data:r}),r}catch(r){try{throw await(X(this,_).config.onError?.(r,e,this.state.context,this,i)),await(this.options.onError?.(r,e,this.state.context,i)),await(X(this,_).config.onSettled?.(void 0,r,this.state.variables,this.state.context,this,i)),await(this.options.onSettled?.(void 0,r,e,this.state.context,i)),r}finally{ee(this,C,A).call(this,{type:"error",error:r})}}finally{X(this,_).runNext(this)}}},j=new WeakMap,S=new WeakMap,_=new WeakMap,k=new WeakMap,C=new WeakSet,A=function(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),Bt.batch(()=>{X(this,S).forEach(t=>{t.onMutationUpdate(e)}),X(this,_).notify({mutation:this,type:"updated",action:e})})},z);var Qt=(T=class extends xt{constructor(e={}){super(),J(this,E),J(this,I),J(this,P),this.config=e,Q(this,E,new Set),Q(this,I,new Map),Q(this,P,0)}build(e,t,i){const a=new Jt({client:e,mutationCache:this,mutationId:++te(this,P)._,options:e.defaultMutationOptions(t),state:i});return this.add(a),a}add(e){X(this,E).add(e);const t=ei(e);if("string"==typeof t){const i=X(this,I).get(t);i?i.push(e):X(this,I).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(X(this,E).delete(e)){const t=ei(e);if("string"==typeof t){const i=X(this,I).get(t);if(i)if(i.length>1){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}else i[0]===e&&X(this,I).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=ei(e);if("string"==typeof t){const i=X(this,I).get(t),a=i?.find(e=>"pending"===e.state.status);return!a||a===e}return!0}runNext(e){const t=ei(e);if("string"==typeof t){const i=X(this,I).get(t)?.find(t=>t!==e&&t.state.isPaused);return i?.continue()??Promise.resolve()}return Promise.resolve()}clear(){Bt.batch(()=>{X(this,E).forEach(e=>{this.notify({type:"removed",mutation:e})}),X(this,E).clear(),X(this,I).clear()})}getAll(){return Array.from(X(this,E))}find(e){const t={exact:!0,...e};return this.getAll().find(e=>St(t,e))}findAll(e={}){return this.getAll().filter(t=>St(e,t))}notify(e){Bt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return Bt.batch(()=>Promise.all(e.map(e=>e.continue().catch(wt))))}},E=new WeakMap,I=new WeakMap,P=new WeakMap,T);function ei(e){return e.options.scope?.id}var ti=(L=class extends xt{constructor(e={}){super(),J(this,M),this.config=e,Q(this,M,new Map)}build(e,t,i){const a=t.queryKey,s=t.queryHash??_t(a,t);let r=this.get(s);return r||(r=new Vt({client:e,queryKey:a,queryHash:s,options:e.defaultQueryOptions(t),state:i,defaultOptions:e.getQueryDefaults(a)}),this.add(r)),r}add(e){X(this,M).has(e.queryHash)||(X(this,M).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=X(this,M).get(e.queryHash);t&&(e.destroy(),t===e&&X(this,M).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Bt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return X(this,M).get(e)}getAll(){return[...X(this,M).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(e=>jt(t,e))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>jt(e,t)):t}notify(e){Bt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Bt.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Bt.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},M=new WeakMap,L),ii=(W=class{constructor(e={}){J(this,F),J(this,O),J(this,D),J(this,R),J(this,B),J(this,U),J(this,q),J(this,$),Q(this,F,e.queryCache||new ti),Q(this,O,e.mutationCache||new Qt),Q(this,D,e.defaultOptions||{}),Q(this,R,new Map),Q(this,B,new Map),Q(this,U,0)}mount(){te(this,U)._++,1===X(this,U)&&(Q(this,q,Dt.subscribe(async e=>{e&&(await this.resumePausedMutations(),X(this,F).onFocus())})),Q(this,$,Ut.subscribe(async e=>{e&&(await this.resumePausedMutations(),X(this,F).onOnline())})))}unmount(){var e,t;te(this,U)._--,0===X(this,U)&&(null==(e=X(this,q))||e.call(this),Q(this,q,void 0),null==(t=X(this,$))||t.call(this),Q(this,$,void 0))}isFetching(e){return X(this,F).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return X(this,O).findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return X(this,F).get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),i=X(this,F).build(this,t),a=i.state.data;return void 0===a?this.fetchQuery(e):(e.revalidateIfStale&&i.isStaleByTime(Nt(t.staleTime,i))&&this.prefetchQuery(t),Promise.resolve(a))}getQueriesData(e){return X(this,F).findAll(e).map(({queryKey:e,state:t})=>[e,t.data])}setQueryData(e,t,i){const a=this.defaultQueryOptions({queryKey:e}),s=X(this,F).get(a.queryHash),r=s?.state.data,n=function(e,t){return"function"==typeof e?e(t):e}(t,r);if(void 0!==n)return X(this,F).build(this,a).setData(n,{...i,manual:!0})}setQueriesData(e,t,i){return Bt.batch(()=>X(this,F).findAll(e).map(({queryKey:e})=>[e,this.setQueryData(e,t,i)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return X(this,F).get(t.queryHash)?.state}removeQueries(e){const t=X(this,F);Bt.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const i=X(this,F);return Bt.batch(()=>(i.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const i={revert:!0,...t},a=Bt.batch(()=>X(this,F).findAll(e).map(e=>e.cancel(i)));return Promise.all(a).then(wt).catch(wt)}invalidateQueries(e,t={}){return Bt.batch(()=>(X(this,F).findAll(e).forEach(e=>{e.invalidate()}),"none"===e?.refetchType?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const i={...t,cancelRefetch:t.cancelRefetch??!0},a=Bt.batch(()=>X(this,F).findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,i);return i.throwOnError||(t=t.catch(wt)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(a).then(wt)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const i=X(this,F).build(this,t);return i.isStaleByTime(Nt(t.staleTime,i))?i.fetch(t):Promise.resolve(i.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(wt).catch(wt)}fetchInfiniteQuery(e){return e.behavior=Yt(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(wt).catch(wt)}ensureInfiniteQueryData(e){return e.behavior=Yt(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Ut.isOnline()?X(this,O).resumePausedMutations():Promise.resolve()}getQueryCache(){return X(this,F)}getMutationCache(){return X(this,O)}getDefaultOptions(){return X(this,D)}setDefaultOptions(e){Q(this,D,e)}setQueryDefaults(e,t){X(this,R).set(kt(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...X(this,R).values()],i={};return t.forEach(t=>{Ct(e,t.queryKey)&&Object.assign(i,t.defaultOptions)}),i}setMutationDefaults(e,t){X(this,B).set(kt(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...X(this,B).values()],i={};return t.forEach(t=>{Ct(e,t.mutationKey)&&Object.assign(i,t.defaultOptions)}),i}defaultQueryOptions(e){if(e._defaulted)return e;const t={...X(this,D).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=_t(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Ft&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...X(this,D).mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){X(this,F).clear(),X(this,O).clear()}},F=new WeakMap,O=new WeakMap,D=new WeakMap,R=new WeakMap,B=new WeakMap,U=new WeakMap,q=new WeakMap,$=new WeakMap,W),ai=We.createContext(void 0),si=({client:e,children:t})=>(We.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),se.jsx(ai.Provider,{value:e,children:t}));const ri=He.useInsertionEffect,ni=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?We.useLayoutEffect:We.useEffect,oi=ri||ni,li=e=>{const t=We.useRef([e,(...e)=>t[0](...e)]).current;return oi(()=>{t[0]=e}),t[1]},ci="pushState",di="replaceState",ui=["popstate",ci,di,"hashchange"],hi=e=>{for(const t of ui)addEventListener(t,e);return()=>{for(const t of ui)removeEventListener(t,e)}},mi=(e,t)=>Ke.useSyncExternalStore(hi,e,t),pi=()=>location.search,fi=()=>location.pathname,gi=({ssrPath:e}={})=>mi(fi,e?()=>e:fi),xi=(e,{replace:t=!1,state:i=null}={})=>history[t?di:ci](i,"",e),bi=Symbol.for("wouter_v3");if("undefined"!=typeof history&&void 0===window[bi]){for(const e of[ci,di]){const t=history[e];history[e]=function(){const i=t.apply(this,arguments),a=new Event(e);return a.arguments=arguments,dispatchEvent(a),i}}Object.defineProperty(window,bi,{value:!0})}const vi=(e="")=>"/"===e?"":e,yi=(e="",t)=>((e,t)=>t.toLowerCase().indexOf(e.toLowerCase())?"~"+t:t.slice(e.length)||"/")(wi(vi(e)),wi(t)),wi=e=>{try{return decodeURI(e)}catch(t){return e}},Ni={hook:(e={})=>[gi(e),xi],searchHook:({ssrSearch:e=""}={})=>mi(pi,()=>e),parser:function(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var i,a,s,r,n=[],o="",l=e.split("/");for(l[0]||l.shift();s=l.shift();)"*"===(i=s[0])?(n.push(i),o+="?"===s[1]?"(?:/(.*))?":"/(.*)"):":"===i?(a=s.indexOf("?",1),r=s.indexOf(".",1),n.push(s.substring(1,~a?a:~r?r:s.length)),o+=~a&&!~r?"(?:/([^/]+?))?":"/([^/]+?)",~r&&(o+=(~a?"?":"")+"\\"+s.substring(r))):o+="/"+s;return{keys:n,pattern:new RegExp("^"+o+(t?"(?=$|/)":"/?$"),"i")}},base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:e=>e},ji=We.createContext(Ni),Si=()=>We.useContext(ji),_i={},ki=We.createContext(_i),Ci=e=>{const[t,i]=e.hook(e);return[yi(e.base,t),li((t,a)=>i(((e,t)=>"~"===e[0]?e.slice(1):vi(t)+e)(t,e.base),a))]},Ai=()=>Ci(Si()),zi=(e,t,i,a)=>{const{pattern:s,keys:r}=t instanceof RegExp?{keys:!1,pattern:t}:e(t||"*",a),n=s.exec(i)||[],[o,...l]=n;return void 0!==o?[!0,(()=>{const e=!1!==r?Object.fromEntries(r.map((e,t)=>[e,l[t]])):n.groups;let t={...l};return e&&Object.assign(t,e),t})(),...a?[o]:[]]:[!1,null]},Ei=({children:e,...t})=>{const i=Si(),a=t.hook?Ni:i;let s=a;const[r,n]=t.ssrPath?.split("?")??[];n&&(t.ssrSearch=n,t.ssrPath=r),t.hrefs=t.hrefs??t.hook?.hrefs;let o=We.useRef({}),l=o.current,c=l;for(let d in a){const e="base"===d?a[d]+(t[d]||""):t[d]||a[d];l===c&&e!==c[d]&&(o.current=c={...c}),c[d]=e,e===a[d]&&e===s[d]||(s=c)}return We.createElement(ji.Provider,{value:s,children:e})},Ii=({children:e,component:t},i)=>t?We.createElement(t,{params:i}):"function"==typeof e?e(i):e,Pi=({path:e,nest:t,match:i,...a})=>{const s=Si(),[r]=Ci(s),[n,o,l]=i??zi(s.parser,e,r,t),c=(e=>{let t=We.useRef(_i);const i=t.current;return t.current=Object.keys(e).length!==Object.keys(i).length||Object.entries(e).some(([e,t])=>t!==i[e])?e:i})({...We.useContext(ki),...o});if(!n)return null;const d=l?We.createElement(Ei,{base:l},Ii(a,c)):Ii(a,c);return We.createElement(ki.Provider,{value:c,children:d})},Ti=We.forwardRef((e,t)=>{const i=Si(),[a,s]=Ci(i),{to:r="",href:n=r,onClick:o,asChild:l,children:c,className:d,replace:u,state:h,...m}=e,p=li(t=>{t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||0!==t.button||(o?.(t),t.defaultPrevented||(t.preventDefault(),s(n,e)))}),f=i.hrefs("~"===n[0]?n.slice(1):i.base+n,i);return l&&We.isValidElement(c)?We.cloneElement(c,{onClick:p,href:f}):We.createElement("a",{...m,onClick:p,href:f,className:d?.call?d(a===n):d,children:c,ref:t})}),Mi=e=>Array.isArray(e)?e.flatMap(e=>Mi(e&&e.type===We.Fragment?e.props.children:e)):[e],Li=({children:e,location:t})=>{const i=Si(),[a]=Ci(i);for(const s of Mi(e)){let e=0;if(We.isValidElement(s)&&(e=zi(i.parser,s.props.path,t||a,s.props.nest))[0])return We.cloneElement(s,{match:e})}return null};var Fi=["light","dark"],Oi=We.createContext(void 0),Di={setTheme:e=>{},themes:[]};We.memo(({forcedTheme:e,storageKey:t,attribute:i,enableSystem:a,enableColorScheme:s,defaultTheme:r,value:n,attrs:o,nonce:l})=>{let c="system"===r,d="class"===i?`var d=document.documentElement,c=d.classList;c.remove(${o.map(e=>`'${e}'`).join(",")});`:`var d=document.documentElement,n='${i}',s='setAttribute';`,u=s?Fi.includes(r)&&r?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${r}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",h=(e,t=!1,a=!0)=>{let r=n?n[e]:e,o=t?e+"|| ''":`'${r}'`,l="";return s&&a&&!t&&Fi.includes(e)&&(l+=`d.style.colorScheme = '${e}';`),"class"===i?l+=t||r?`c.add(${o})`:"null":r&&(l+=`d[s](n,${o})`),l},m=e?`!function(){${d}${h(e)}}()`:a?`!function(){try{${d}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${c})){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){${h("dark")}}else{${h("light")}}}else if(e){${n?`var x=${JSON.stringify(n)};`:""}${h(n?"x[e]":"e",!0)}}${c?"":"else{"+h(r,!1,!1)+"}"}${u}}catch(e){}}()`:`!function(){try{${d}var e=localStorage.getItem('${t}');if(e){${n?`var x=${JSON.stringify(n)};`:""}${h(n?"x[e]":"e",!0)}}else{${h(r,!1,!1)};}${u}}catch(t){}}();`;return We.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:m}})});var Ri=Array(12).fill(0),Bi=({visible:e,className:t})=>Ze.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Ze.createElement("div",{className:"sonner-spinner"},Ri.map((e,t)=>Ze.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${t}`})))),Ui=Ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ze.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),qi=Ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ze.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),$i=Ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ze.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Wi=Ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ze.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Hi=Ze.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ze.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ze.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Zi=1,Vi=new class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:i,...a}=e,s="number"==typeof(null==e?void 0:e.id)||(null==(t=e.id)?void 0:t.length)>0?e.id:Zi++,r=this.toasts.find(e=>e.id===s),n=void 0===e.dismissible||e.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),r?this.toasts=this.toasts.map(t=>t.id===s?(this.publish({...t,...e,id:s,title:i}),{...t,...e,id:s,dismissible:n,title:i}):t):this.addToast({title:i,...a,dismissible:n,id:s}),s},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let i;void 0!==t.loading&&(i=this.create({...t,promise:e,type:"loading",message:t.loading,description:"function"!=typeof t.description?t.description:void 0}));let a,s=e instanceof Promise?e:e(),r=void 0!==i,n=s.then(async e=>{if(a=["resolve",e],Ze.isValidElement(e))r=!1,this.create({id:i,type:"default",message:e});else if(Gi(e)&&!e.ok){r=!1;let a="function"==typeof t.error?await t.error(`HTTP error! status: ${e.status}`):t.error,s="function"==typeof t.description?await t.description(`HTTP error! status: ${e.status}`):t.description;this.create({id:i,type:"error",message:a,description:s})}else if(void 0!==t.success){r=!1;let a="function"==typeof t.success?await t.success(e):t.success,s="function"==typeof t.description?await t.description(e):t.description;this.create({id:i,type:"success",message:a,description:s})}}).catch(async e=>{if(a=["reject",e],void 0!==t.error){r=!1;let a="function"==typeof t.error?await t.error(e):t.error,s="function"==typeof t.description?await t.description(e):t.description;this.create({id:i,type:"error",message:a,description:s})}}).finally(()=>{var e;r&&(this.dismiss(i),i=void 0),null==(e=t.finally)||e.call(t)}),o=()=>new Promise((e,t)=>n.then(()=>"reject"===a[0]?t(a[1]):e(a[1])).catch(t));return"string"!=typeof i&&"number"!=typeof i?{unwrap:o}:Object.assign(i,{unwrap:o})},this.custom=(e,t)=>{let i=(null==t?void 0:t.id)||Zi++;return this.create({jsx:e(i),id:i,...t}),i},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Gi=e=>e&&"object"==typeof e&&"ok"in e&&"boolean"==typeof e.ok&&"status"in e&&"number"==typeof e.status,Yi=(e,t)=>{let i=(null==t?void 0:t.id)||Zi++;return Vi.addToast({title:e,...t,id:i}),i},Ki=Object.assign(Yi,{success:Vi.success,info:Vi.info,warning:Vi.warning,error:Vi.error,custom:Vi.custom,message:Vi.message,promise:Vi.promise,dismiss:Vi.dismiss,loading:Vi.loading},{getHistory:()=>Vi.toasts,getToasts:()=>Vi.getActiveToasts()});function Xi(e){return void 0!==e.label}!function(e,{insertAt:t}={}){if("undefined"==typeof document)return;let i=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===t&&i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}(':where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}\n');var Ji=3,Qi=14;function ea(...e){return e.filter(Boolean).join(" ")}var ta=e=>{var t,i,a,s,r,n,o,l,c,d,u;let{invert:h,toast:m,unstyled:p,interacting:f,setHeights:g,visibleToasts:x,heights:b,index:v,toasts:y,expanded:w,removeToast:N,defaultRichColors:j,closeButton:S,style:_,cancelButtonStyle:k,actionButtonStyle:C,className:A="",descriptionClassName:z="",duration:E,position:I,gap:P,loadingIcon:T,expandByDefault:M,classNames:L,icons:F,closeButtonAriaLabel:O="Close toast",pauseWhenPageIsHidden:D}=e,[R,B]=Ze.useState(null),[U,q]=Ze.useState(null),[$,W]=Ze.useState(!1),[H,Z]=Ze.useState(!1),[V,G]=Ze.useState(!1),[Y,K]=Ze.useState(!1),[X,J]=Ze.useState(!1),[Q,ee]=Ze.useState(0),[te,ie]=Ze.useState(0),ae=Ze.useRef(m.duration||E||4e3),se=Ze.useRef(null),re=Ze.useRef(null),ne=0===v,oe=v+1<=x,le=m.type,ce=!1!==m.dismissible,de=m.className||"",ue=m.descriptionClassName||"",he=Ze.useMemo(()=>b.findIndex(e=>e.toastId===m.id)||0,[b,m.id]),me=Ze.useMemo(()=>{var e;return null!=(e=m.closeButton)?e:S},[m.closeButton,S]),pe=Ze.useMemo(()=>m.duration||E||4e3,[m.duration,E]),fe=Ze.useRef(0),ge=Ze.useRef(0),xe=Ze.useRef(0),be=Ze.useRef(null),[ve,ye]=I.split("-"),we=Ze.useMemo(()=>b.reduce((e,t,i)=>i>=he?e:e+t.height,0),[b,he]),Ne=(()=>{let[e,t]=Ze.useState(document.hidden);return Ze.useEffect(()=>{let e=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",e),()=>window.removeEventListener("visibilitychange",e)},[]),e})(),je=m.invert||h,Se="loading"===le;ge.current=Ze.useMemo(()=>he*P+we,[he,we]),Ze.useEffect(()=>{ae.current=pe},[pe]),Ze.useEffect(()=>{W(!0)},[]),Ze.useEffect(()=>{let e=re.current;if(e){let t=e.getBoundingClientRect().height;return ie(t),g(e=>[{toastId:m.id,height:t,position:m.position},...e]),()=>g(e=>e.filter(e=>e.toastId!==m.id))}},[g,m.id]),Ze.useLayoutEffect(()=>{if(!$)return;let e=re.current,t=e.style.height;e.style.height="auto";let i=e.getBoundingClientRect().height;e.style.height=t,ie(i),g(e=>e.find(e=>e.toastId===m.id)?e.map(e=>e.toastId===m.id?{...e,height:i}:e):[{toastId:m.id,height:i,position:m.position},...e])},[$,m.title,m.description,g,m.id]);let _e=Ze.useCallback(()=>{Z(!0),ee(ge.current),g(e=>e.filter(e=>e.toastId!==m.id)),setTimeout(()=>{N(m)},200)},[m,N,g,ge]);return Ze.useEffect(()=>{if(m.promise&&"loading"===le||m.duration===1/0||"loading"===m.type)return;let e;return w||f||D&&Ne?(()=>{if(xe.current<fe.current){let e=(new Date).getTime()-fe.current;ae.current=ae.current-e}xe.current=(new Date).getTime()})():ae.current!==1/0&&(fe.current=(new Date).getTime(),e=setTimeout(()=>{var e;null==(e=m.onAutoClose)||e.call(m,m),_e()},ae.current)),()=>clearTimeout(e)},[w,f,m,le,D,Ne,_e]),Ze.useEffect(()=>{m.delete&&_e()},[_e,m.delete]),Ze.createElement("li",{tabIndex:0,ref:re,className:ea(A,de,null==L?void 0:L.toast,null==(t=null==m?void 0:m.classNames)?void 0:t.toast,null==L?void 0:L.default,null==L?void 0:L[le],null==(i=null==m?void 0:m.classNames)?void 0:i[le]),"data-sonner-toast":"","data-rich-colors":null!=(a=m.richColors)?a:j,"data-styled":!(m.jsx||m.unstyled||p),"data-mounted":$,"data-promise":!!m.promise,"data-swiped":X,"data-removed":H,"data-visible":oe,"data-y-position":ve,"data-x-position":ye,"data-index":v,"data-front":ne,"data-swiping":V,"data-dismissible":ce,"data-type":le,"data-invert":je,"data-swipe-out":Y,"data-swipe-direction":U,"data-expanded":!!(w||M&&$),style:{"--index":v,"--toasts-before":v,"--z-index":y.length-v,"--offset":`${H?Q:ge.current}px`,"--initial-height":M?"auto":`${te}px`,..._,...m.style},onDragEnd:()=>{G(!1),B(null),be.current=null},onPointerDown:e=>{Se||!ce||(se.current=new Date,ee(ge.current),e.target.setPointerCapture(e.pointerId),"BUTTON"!==e.target.tagName&&(G(!0),be.current={x:e.clientX,y:e.clientY}))},onPointerUp:()=>{var e,t,i,a;if(Y||!ce)return;be.current=null;let s=Number((null==(e=re.current)?void 0:e.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),r=Number((null==(t=re.current)?void 0:t.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),n=(new Date).getTime()-(null==(i=se.current)?void 0:i.getTime()),o="x"===R?s:r,l=Math.abs(o)/n;if(Math.abs(o)>=20||l>.11)return ee(ge.current),null==(a=m.onDismiss)||a.call(m,m),q("x"===R?s>0?"right":"left":r>0?"down":"up"),_e(),K(!0),void J(!1);G(!1),B(null)},onPointerMove:t=>{var i,a,s,r;if(!be.current||!ce||(null==(i=window.getSelection())?void 0:i.toString().length)>0)return;let n=t.clientY-be.current.y,o=t.clientX-be.current.x,l=null!=(a=e.swipeDirections)?a:function(e){let[t,i]=e.split("-"),a=[];return t&&a.push(t),i&&a.push(i),a}(I);!R&&(Math.abs(o)>1||Math.abs(n)>1)&&B(Math.abs(o)>Math.abs(n)?"x":"y");let c={x:0,y:0};"y"===R?(l.includes("top")||l.includes("bottom"))&&(l.includes("top")&&n<0||l.includes("bottom")&&n>0)&&(c.y=n):"x"===R&&(l.includes("left")||l.includes("right"))&&(l.includes("left")&&o<0||l.includes("right")&&o>0)&&(c.x=o),(Math.abs(c.x)>0||Math.abs(c.y)>0)&&J(!0),null==(s=re.current)||s.style.setProperty("--swipe-amount-x",`${c.x}px`),null==(r=re.current)||r.style.setProperty("--swipe-amount-y",`${c.y}px`)}},me&&!m.jsx?Ze.createElement("button",{"aria-label":O,"data-disabled":Se,"data-close-button":!0,onClick:Se||!ce?()=>{}:()=>{var e;_e(),null==(e=m.onDismiss)||e.call(m,m)},className:ea(null==L?void 0:L.closeButton,null==(s=null==m?void 0:m.classNames)?void 0:s.closeButton)},null!=(r=null==F?void 0:F.close)?r:Hi):null,m.jsx||We.isValidElement(m.title)?m.jsx?m.jsx:"function"==typeof m.title?m.title():m.title:Ze.createElement(Ze.Fragment,null,le||m.icon||m.promise?Ze.createElement("div",{"data-icon":"",className:ea(null==L?void 0:L.icon,null==(n=null==m?void 0:m.classNames)?void 0:n.icon)},m.promise||"loading"===m.type&&!m.icon?m.icon||(null!=F&&F.loading?Ze.createElement("div",{className:ea(null==L?void 0:L.loader,null==(ke=null==m?void 0:m.classNames)?void 0:ke.loader,"sonner-loader"),"data-visible":"loading"===le},F.loading):T?Ze.createElement("div",{className:ea(null==L?void 0:L.loader,null==(Ce=null==m?void 0:m.classNames)?void 0:Ce.loader,"sonner-loader"),"data-visible":"loading"===le},T):Ze.createElement(Bi,{className:ea(null==L?void 0:L.loader,null==(Ae=null==m?void 0:m.classNames)?void 0:Ae.loader),visible:"loading"===le})):null,"loading"!==m.type?m.icon||(null==F?void 0:F[le])||(e=>{switch(e){case"success":return Ui;case"info":return $i;case"warning":return qi;case"error":return Wi;default:return null}})(le):null):null,Ze.createElement("div",{"data-content":"",className:ea(null==L?void 0:L.content,null==(o=null==m?void 0:m.classNames)?void 0:o.content)},Ze.createElement("div",{"data-title":"",className:ea(null==L?void 0:L.title,null==(l=null==m?void 0:m.classNames)?void 0:l.title)},"function"==typeof m.title?m.title():m.title),m.description?Ze.createElement("div",{"data-description":"",className:ea(z,ue,null==L?void 0:L.description,null==(c=null==m?void 0:m.classNames)?void 0:c.description)},"function"==typeof m.description?m.description():m.description):null),We.isValidElement(m.cancel)?m.cancel:m.cancel&&Xi(m.cancel)?Ze.createElement("button",{"data-button":!0,"data-cancel":!0,style:m.cancelButtonStyle||k,onClick:e=>{var t,i;Xi(m.cancel)&&ce&&(null==(i=(t=m.cancel).onClick)||i.call(t,e),_e())},className:ea(null==L?void 0:L.cancelButton,null==(d=null==m?void 0:m.classNames)?void 0:d.cancelButton)},m.cancel.label):null,We.isValidElement(m.action)?m.action:m.action&&Xi(m.action)?Ze.createElement("button",{"data-button":!0,"data-action":!0,style:m.actionButtonStyle||C,onClick:e=>{var t,i;Xi(m.action)&&(null==(i=(t=m.action).onClick)||i.call(t,e),!e.defaultPrevented&&_e())},className:ea(null==L?void 0:L.actionButton,null==(u=null==m?void 0:m.classNames)?void 0:u.actionButton)},m.action.label):null));var ke,Ce,Ae};function ia(){if("undefined"==typeof window||"undefined"==typeof document)return"ltr";let e=document.documentElement.getAttribute("dir");return"auto"!==e&&e?e:window.getComputedStyle(document.documentElement).direction}function aa(e,t){let i={};return[e,t].forEach((e,t)=>{let a=1===t,s=a?"--mobile-offset":"--offset",r=a?"16px":"32px";function n(e){["top","right","bottom","left"].forEach(t=>{i[`${s}-${t}`]="number"==typeof e?`${e}px`:e})}"number"==typeof e||"string"==typeof e?n(e):"object"==typeof e?["top","right","bottom","left"].forEach(t=>{void 0===e[t]?i[`${s}-${t}`]=r:i[`${s}-${t}`]="number"==typeof e[t]?`${e[t]}px`:e[t]}):n(r)}),i}var sa=We.forwardRef(function(e,t){let{invert:i,position:a="bottom-right",hotkey:s=["altKey","KeyT"],expand:r,closeButton:n,className:o,offset:l,mobileOffset:c,theme:d="light",richColors:u,duration:h,style:m,visibleToasts:p=Ji,toastOptions:f,dir:g=ia(),gap:x=Qi,loadingIcon:b,icons:v,containerAriaLabel:y="Notifications",pauseWhenPageIsHidden:w}=e,[N,j]=Ze.useState([]),S=Ze.useMemo(()=>Array.from(new Set([a].concat(N.filter(e=>e.position).map(e=>e.position)))),[N,a]),[_,k]=Ze.useState([]),[C,A]=Ze.useState(!1),[z,E]=Ze.useState(!1),[I,P]=Ze.useState("system"!==d?d:"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),T=Ze.useRef(null),M=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),L=Ze.useRef(null),F=Ze.useRef(!1),O=Ze.useCallback(e=>{j(t=>{var i;return null!=(i=t.find(t=>t.id===e.id))&&i.delete||Vi.dismiss(e.id),t.filter(({id:t})=>t!==e.id)})},[]);return Ze.useEffect(()=>Vi.subscribe(e=>{e.dismiss?j(t=>t.map(t=>t.id===e.id?{...t,delete:!0}:t)):setTimeout(()=>{Ve.flushSync(()=>{j(t=>{let i=t.findIndex(t=>t.id===e.id);return-1!==i?[...t.slice(0,i),{...t[i],...e},...t.slice(i+1)]:[e,...t]})})})}),[]),Ze.useEffect(()=>{if("system"!==d)return void P(d);if("system"===d&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?P("dark"):P("light")),"undefined"==typeof window)return;let e=window.matchMedia("(prefers-color-scheme: dark)");try{e.addEventListener("change",({matches:e})=>{P(e?"dark":"light")})}catch(t){e.addListener(({matches:e})=>{try{P(e?"dark":"light")}catch(t){console.error(t)}})}},[d]),Ze.useEffect(()=>{N.length<=1&&A(!1)},[N]),Ze.useEffect(()=>{let e=e=>{var t,i;s.every(t=>e[t]||e.code===t)&&(A(!0),null==(t=T.current)||t.focus()),"Escape"===e.code&&(document.activeElement===T.current||null!=(i=T.current)&&i.contains(document.activeElement))&&A(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),Ze.useEffect(()=>{if(T.current)return()=>{L.current&&(L.current.focus({preventScroll:!0}),L.current=null,F.current=!1)}},[T.current]),Ze.createElement("section",{ref:t,"aria-label":`${y} ${M}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},S.map((t,a)=>{var s;let[d,y]=t.split("-");return N.length?Ze.createElement("ol",{key:t,dir:"auto"===g?ia():g,tabIndex:-1,ref:T,className:o,"data-sonner-toaster":!0,"data-theme":I,"data-y-position":d,"data-lifted":C&&N.length>1&&!r,"data-x-position":y,style:{"--front-toast-height":`${(null==(s=_[0])?void 0:s.height)||0}px`,"--width":"356px","--gap":`${x}px`,...m,...aa(l,c)},onBlur:e=>{F.current&&!e.currentTarget.contains(e.relatedTarget)&&(F.current=!1,L.current&&(L.current.focus({preventScroll:!0}),L.current=null))},onFocus:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||F.current||(F.current=!0,L.current=e.relatedTarget)},onMouseEnter:()=>A(!0),onMouseMove:()=>A(!0),onMouseLeave:()=>{z||A(!1)},onDragEnd:()=>A(!1),onPointerDown:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||E(!0)},onPointerUp:()=>E(!1)},N.filter(e=>!e.position&&0===a||e.position===t).map((a,s)=>{var o,l;return Ze.createElement(ta,{key:a.id,icons:v,index:s,toast:a,defaultRichColors:u,duration:null!=(o=null==f?void 0:f.duration)?o:h,className:null==f?void 0:f.className,descriptionClassName:null==f?void 0:f.descriptionClassName,invert:i,visibleToasts:p,closeButton:null!=(l=null==f?void 0:f.closeButton)?l:n,interacting:z,position:t,style:null==f?void 0:f.style,unstyled:null==f?void 0:f.unstyled,classNames:null==f?void 0:f.classNames,cancelButtonStyle:null==f?void 0:f.cancelButtonStyle,actionButtonStyle:null==f?void 0:f.actionButtonStyle,removeToast:O,toasts:N.filter(e=>e.position==a.position),heights:_.filter(e=>e.position==a.position),setHeights:k,expandByDefault:r,gap:x,loadingIcon:b,expanded:C,pauseWhenPageIsHidden:w,swipeDirections:e.swipeDirections})})):null}))});const ra=Object.freeze(Object.defineProperty({__proto__:null,Toaster:sa,toast:Ki},Symbol.toStringTag,{value:"Module"}));var na=Object.defineProperty,oa=(e,t,i)=>((e,t,i)=>t in e?na(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);const la=new class{constructor(){oa(this,"toasts",new Map),oa(this,"isEnabled",!1),this.isEnabled&&"undefined"!=typeof window&&(window.__M1_TOAST_DEBUG__={get:()=>this.getState(),list:()=>this.list(),show:e=>this.testShow(e),dismiss:e=>this.testDismiss(e)})}trackToast(e,t){if(!this.isEnabled)return;const i=this.toasts.get(e),a=Date.now();"entering"!==t||i?i&&(i.state=t,i.startTime,"removed"===t&&this.toasts.delete(e)):this.toasts.set(e,{id:e,state:t,startTime:a})}trackGesture(e,t){if(!this.isEnabled)return;const i=this.toasts.get(e);i&&(i.gesture=t)}trackTimer(e,t){if(!this.isEnabled)return;const i=this.toasts.get(e);i&&(i.timer=t)}getState(){return{toasts:Array.from(this.toasts.values()),timestamp:Date.now(),enabled:this.isEnabled}}list(){return console.table(Array.from(this.toasts.values())),this.toasts.size}testShow(e){return"undefined"!=typeof window&&window.toast?(window.toast(e||"Test toast message"),"Toast triggered"):"Toast function not found"}testDismiss(e){return this.toasts.get(e)?(this.trackToast(e,"exiting"),`Dismissing toast ${e}`):`Toast ${e} not found`}},ca=({...e})=>{const{theme:t="system"}=null!=(i=We.useContext(Oi))?i:Di;var i;const a=We.useRef({startY:0,startTime:0,currentToast:null,isDragging:!1});return We.useEffect(()=>{const e=a.current,t=t=>{const i=t.target.closest("[data-sonner-toast]");i&&(e.currentToast=i,e.startY=t.touches[0].clientY,e.startTime=Date.now(),e.isDragging=!1,la.trackGesture(i.id||"unknown",{startY:e.startY,currentY:e.startY,isDragging:!1}),i.classList.add("toast-swiping"))},i=t=>{if(!e.currentToast)return;const i=t.touches[0].clientY-e.startY;if(i<0){t.preventDefault(),e.isDragging=!0;const a=Math.max(i,-80),s=Math.max(.2,1+a/80*.8);e.currentToast.style.transform=`translateY(${a}px)`,e.currentToast.style.opacity=s.toString(),la.trackGesture(e.currentToast.id||"unknown",{startY:e.startY,currentY:t.touches[0].clientY,isDragging:!0})}},s=t=>{if(!e.currentToast)return;const i=t.changedTouches[0].clientY-e.startY,a=Date.now()-e.startTime,s=Math.abs(i)/a;e.currentToast.classList.remove("toast-swiping");(Math.abs(i)>=32&&i<0||s>=.35&&i<0)&&e.isDragging?(e.currentToast.setAttribute("data-removed","true"),la.trackToast(e.currentToast.id||"unknown","exiting"),setTimeout(()=>{e.currentToast?.remove()},320)):e.isDragging&&(e.currentToast.classList.add("toast-snap-back"),e.currentToast.style.transform="",e.currentToast.style.opacity="",setTimeout(()=>{e.currentToast?.classList.remove("toast-snap-back")},320)),e.currentToast=null,e.isDragging=!1};return document.addEventListener("touchstart",t,{passive:!1}),document.addEventListener("touchmove",i,{passive:!1}),document.addEventListener("touchend",s,{passive:!1}),()=>{document.removeEventListener("touchstart",t),document.removeEventListener("touchmove",i),document.removeEventListener("touchend",s)}},[]),se.jsx(sa,{theme:t,className:"toaster group",position:"top-center",richColors:!1,closeButton:!1,duration:3e3,expand:!1,visibleToasts:3,offset:0,toastOptions:{style:{background:"rgba(0, 12, 24, 0.95)",color:"white",border:"1px solid rgba(0, 209, 255, 0.5)",borderRadius:"20px",backdropFilter:"blur(24px)",boxShadow:"0 12px 40px rgba(0, 209, 255, 0.4), inset 0 2px 0 rgba(255, 255, 255, 0.15), 0 0 0 1px rgba(0, 209, 255, 0.2)",fontFamily:"Orbitron, -apple-system, BlinkMacSystemFont, sans-serif",fontSize:"15px",padding:"14px 40px",minHeight:"48px",width:"450px",maxWidth:"min(92vw, 420px)",fontWeight:"500",letterSpacing:"0.025em",display:"flex",alignItems:"center",justifyContent:"center",WebkitUserSelect:"none",userSelect:"none",textAlign:"center",pointerEvents:"auto"},classNames:{toast:"toast-centered",description:"group-[.toast]:text-white/80",actionButton:"group-[.toast]:bg-cyan-500 group-[.toast]:text-black",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"},unstyled:!1},...e})};let da={standalone:!1,hasSetAppBadge:!1,hasClearAppBadge:!1,ua:""};function ua(){return{...da}}const ha=Object.freeze(Object.defineProperty({__proto__:null,createBadgeTestHelpers:function(){},getBadgeDiagnostics:ua,initPWABadgeDiagnostics:function(){if("undefined"==typeof window)return;const e=window.matchMedia("(display-mode: standalone)").matches||!0===navigator.standalone||document.referrer.includes("android-app://"),t="function"==typeof navigator.setAppBadge,i="function"==typeof navigator.clearAppBadge;da={standalone:e,hasSetAppBadge:t,hasClearAppBadge:i,ua:navigator.userAgent.slice(0,120)},window.__M1_BADGE_DIAG__=da},testBadgeAPI:async function(e){if(!da.hasSetAppBadge)return console.warn(" PWA BADGE TEST: setAppBadge not available"),!1;const t={count:e,success:!1,timestamp:(new Date).toISOString()};try{e>0?await navigator.setAppBadge(e):await navigator.clearAppBadge(),t.success=!0}catch(i){t.success=!1,t.error=i.message||i.toString(),console.error(" PWA BADGE TEST: Failed -",i)}return da.lastTest=t,t.success}},Symbol.toStringTag,{value:"Module"}));function ma(){try{const e="https://vkjrqirvdvjbemsfzxof.supabase.co",t=new URL(e).hostname.match(/^([a-z0-9-]+)\.supabase\.co$/i);return t?t[1]:null}catch{return null}}function pa(e){return`${"https://vkjrqirvdvjbemsfzxof.supabase.co".replace(/\/+$/,"")}/functions/v1/${e}`}let fa,ga=0;function xa(){const e=function(){const e="https://vkjrqirvdvjbemsfzxof.supabase.co"?.trim();return e||`https://${ma()}.supabase.co`}(),t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk";e||console.error("[NORAH2] Missing SUPABASE envs in preview",{url:e,keyPresent:!0});const i=ie(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}});return ga+=1,i}const ba=(fa||(fa=xa()),fa);let va=null;function ya(){if("undefined"==typeof navigator)return!1;const e="setAppBadge"in navigator&&"clearAppBadge"in navigator,t=window.matchMedia("(display-mode: standalone)").matches;return e&&t}function wa(e){!function(e){va&&clearTimeout(va),va=setTimeout(()=>{if(ya())try{const t=Math.max(0,Math.floor(e));t>0?navigator.setAppBadge(t):navigator.clearAppBadge()}catch(t){}},200)}(e)}function Na(){const e=navigator.userAgent.toLowerCase(),t=/iphone|ipad|ipod/.test(e),i=/android/.test(e);return{isIOS:t,isAndroid:i,isDesktop:!t&&!i,isPWA:window.matchMedia("(display-mode: standalone)").matches,supportsIconBadge:ya(),platform:t?"iosPWA":i?"android":"desktop"}}let ja={unreadCount:0,lastUpdate:(new Date).toISOString(),supportsIconBadge:!1,platform:"unknown"};function Sa(e){const t=Na();ja={unreadCount:e,lastUpdate:(new Date).toISOString(),supportsIconBadge:t.supportsIconBadge,platform:t.platform}}function _a(e){return!1}let ka=null,Ca=-1;async function Aa(e){ka&&clearTimeout(ka),ka=setTimeout(async()=>{if(Ca!==e&&function(){if("undefined"==typeof navigator||"undefined"==typeof window)return!1;const e="setAppBadge"in navigator&&"clearAppBadge"in navigator,t=window.matchMedia("(display-mode: standalone)").matches||!0===navigator.standalone||document.referrer.includes("android-app://");return e&&t}())try{const t=Math.max(0,Math.floor(e||0));t>0?await navigator.setAppBadge(t):await navigator.clearAppBadge(),Ca=t}catch(t){}},150)}let za=[];const Ea="notifications",Ia="leaderboard_update",Pa="buzz",Ta="map_buzz",Ma="weekly_summary",La="generic";function Fa(){const[e,t]=We.useState([]),[i,a]=We.useState(0),[s,r]=We.useState(!0),n=We.useRef(null),o=We.useRef(0),l=We.useRef(!0),c=We.useCallback(e=>{try{const t=e.slice(-100);return localStorage.setItem(Ea,JSON.stringify(t)),!0}catch(t){return console.error("Errore nel salvataggio delle notifiche:",t),!1}},[]),d=We.useCallback(async(e=!1)=>{if(!e&&"visible"!==document.visibilityState)return!0;const i=Date.now();if(!e&&i-o.current<1e3&&!l.current)return!0;try{(l.current||i-o.current>1e3)&&r(!0),n.current&&clearTimeout(n.current),localStorage.removeItem(Ea);let e=[];const{data:{user:d}}=await ba.auth.getUser();if(d){const{data:t,error:i}=await ba.from("user_notifications").select("*").eq("is_deleted",!1).eq("user_id",d.id).order("created_at",{ascending:!1});i?console.error(" NOTIFICATIONS: Error fetching from Supabase:",i):t&&t.length>0&&(t.length,e=t.map(e=>({id:e.id,title:e.title,description:e.message,date:e.created_at,read:!0===e.is_read,type:e.type})).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),c(e))}const u=e.filter(e=>!e.read).length;e.length,t(e),a(u);try{await Aa(u)}catch(s){0}return wa(u),Sa(u),n.current=setTimeout(()=>{r(!1),n.current=null},200),o.current=i,l.current=!1,!0}catch(d){return console.error(" NOTIFICATIONS: Error loading:",d),t([]),a(0),r(!1),!1}},[c]),u=We.useCallback(async()=>{if(0!==e.length)try{const{data:{user:s}}=await ba.auth.getUser();if(s){const{error:e}=await ba.from("user_notifications").update({is_read:!0}).eq("user_id",s.id).eq("is_deleted",!1);if(e)return void console.error(" Error marking notifications as read in Supabase:",e)}const r=e.map(e=>({...e,read:!0}));if(c(r)){t(r),a(0);try{await Aa(0)}catch(i){}wa(0),Sa(0),za.forEach(e=>e())}}catch(s){console.error(" Error in markAllAsRead:",s)}},[e,c]);We.useEffect(()=>{(async()=>{const{data:{user:e}}=await ba.auth.getUser();if(!e)return;e.id;const t=ba.channel("notification-changes").on("postgres_changes",{event:"*",schema:"public",table:"user_notifications",filter:`user_id=eq.${e.id}`},e=>{"INSERT"!==e.eventType&&"UPDATE"!==e.eventType||d(!0)}).subscribe()})()},[d]),We.useEffect(()=>{l.current||d().then(()=>{l.current=!0});const e=setInterval(()=>{"visible"===document.visibilityState&&d()},5e3);return()=>{clearInterval(e)}},[d]),We.useEffect(()=>{const e=()=>{"visible"!==document.visibilityState||l.current||d(!0)},t=()=>{l.current||(wa(i),Aa(i))};return document.addEventListener("visibilitychange",e),window.addEventListener("focus",t),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("focus",t)}},[d,i]);const h=We.useCallback(async i=>{try{const{data:{user:r}}=await ba.auth.getUser();if(r){const{error:e}=await ba.from("user_notifications").update({is_read:!0}).eq("id",i);e&&console.error(" Error marking notification as read in Supabase:",e)}const n=e.map(e=>e.id===i?{...e,read:!0}:e),o=c(n);if(o){const e=n.filter(e=>!e.read).length;0,t(n),a(e);try{await Aa(e)}catch(s){}wa(e),Sa(e),za.forEach(e=>e())}return o}catch(r){return console.error(" Error in markAsRead:",r),!1}},[e,c]),m=We.useCallback(async i=>{try{const{data:{user:r}}=await ba.auth.getUser();if(r){const{error:e}=await ba.from("user_notifications").update({is_deleted:!0}).eq("id",i);e&&console.error("Error deleting notification in Supabase:",e)}const n=e.filter(e=>e.id!==i),o=c(n);if(o){const e=n.filter(e=>!e.read).length;t(n),a(e);try{await Aa(e)}catch(s){}wa(e),Sa(e),za.forEach(e=>e())}return o}catch(r){return console.error("Error deleting notification:",r),!1}},[e,c]),p=We.useCallback(async e=>{const i=e.type||La;try{let r={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:e.title,description:e.description,date:(new Date).toISOString(),read:!1,type:i};const{data:{user:n}}=await ba.auth.getUser();if(n){const{error:t,data:a}=await ba.from("user_notifications").insert({user_id:n.id,type:i,title:e.title,message:e.description,is_read:!1}).select().single();t?console.error("Error saving notification to Supabase:",t):a&&(r.id=a.id,a.id)}const o=localStorage.getItem(Ea),l=[r,...o?JSON.parse(o):[]],d=c(l);if(d){const e=l.filter(e=>!e.read).length;t(l),a(e);try{await Aa(e)}catch(s){}wa(e),Sa(e),za.forEach(e=>e())}return d}catch(r){return console.error("Error adding notification:",r),!1}},[c]),f=We.useCallback(t=>e.filter(e=>e.type===t),[e]),g=We.useCallback(async()=>await d(!0),[d]);return{notifications:e,unreadCount:i,isLoading:s,reloadNotifications:g,markAllAsRead:u,markAsRead:h,addNotification:p,deleteNotification:m,getNotificationsByCategory:f}}const Oa=()=>(Fa(),ua(),null),Da=(...e)=>e.filter((e,t,i)=>Boolean(e)&&""!==e.trim()&&i.indexOf(e)===t).join(" ").trim();var Ra={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ba=We.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:s="",children:r,iconNode:n,...o},l)=>We.createElement("svg",{ref:l,...Ra,width:t,height:t,stroke:e,strokeWidth:a?24*Number(i)/Number(t):i,className:Da("lucide",s),...o},[...n.map(([e,t])=>We.createElement(e,t)),...Array.isArray(r)?r:[r]])),Ua=(e,t)=>{const i=We.forwardRef(({className:i,...a},s)=>{return We.createElement(Ba,{ref:s,iconNode:t,className:Da(`lucide-${r=e,r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,i),...a});var r});return i.displayName=`${e}`,i},qa=Ua("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),$a=Ua("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]),Wa=Ua("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),Ha=Ua("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),Za=Ua("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Va=Ua("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Ga=Ua("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),Ya=Ua("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]),Ka=Ua("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Xa=Ua("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Ja=Ua("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),Qa=Ua("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),es=Ua("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),ts=Ua("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]),is=Ua("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]),as=Ua("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),ss=Ua("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),rs=Ua("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),ns=Ua("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),os=Ua("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),ls=Ua("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),cs=Ua("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),ds=Ua("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),us=Ua("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),hs=Ua("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),ms=Ua("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ps=Ua("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),fs=Ua("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),gs=Ua("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),xs=Ua("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),bs=Ua("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),vs=Ua("Cookie",[["path",{d:"M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5",key:"laymnq"}],["path",{d:"M8.5 8.5v.01",key:"ue8clq"}],["path",{d:"M16 15.5v.01",key:"14dtrp"}],["path",{d:"M12 12v.01",key:"u5ubse"}],["path",{d:"M11 17v.01",key:"1hyl5a"}],["path",{d:"M7 14v.01",key:"uct60s"}]]),ys=Ua("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),ws=Ua("Copyright",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M14.83 14.83a4 4 0 1 1 0-5.66",key:"1i56pz"}]]),Ns=Ua("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]),js=Ua("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Ss=Ua("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),_s=Ua("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),ks=Ua("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Cs=Ua("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),As=Ua("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),zs=Ua("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Es=Ua("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Is=Ua("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ps=Ua("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Ts=Ua("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),Ms=Ua("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Ls=Ua("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),Fs=Ua("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Os=Ua("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),Ds=Ua("IdCard",[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]]),Rs=Ua("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Bs=Ua("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]),Us=Ua("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),qs=Ua("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),$s=Ua("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),Ws=Ua("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),Hs=Ua("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Zs=Ua("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Vs=Ua("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Gs=Ua("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Ys=Ua("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Ks=Ua("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),Xs=Ua("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),Js=Ua("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),Qs=Ua("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),er=Ua("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),tr=Ua("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),ir=Ua("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),ar=Ua("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),sr=Ua("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),rr=Ua("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),nr=Ua("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),or=Ua("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),lr=Ua("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),cr=Ua("Radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]),dr=Ua("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]),ur=Ua("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),hr=Ua("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),mr=Ua("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),pr=Ua("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),fr=Ua("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),gr=Ua("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),xr=Ua("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),br=Ua("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),vr=Ua("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),yr=Ua("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),wr=Ua("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),Nr=Ua("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),jr=Ua("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),Sr=Ua("Stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),_r=Ua("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),kr=Ua("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Cr=Ua("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),Ar=Ua("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),zr=Ua("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Er=Ua("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ir=Ua("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Pr=Ua("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Tr=Ua("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Mr=Ua("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Lr=Ua("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Fr=Ua("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Or=Ua("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),Dr=Ua("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),Rr=Ua("Waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]),Br=Ua("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Ur=Ua("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),qr=Ua("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),$r=Ua("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Wr=Ua("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Hr=()=>null,Zr=We.createContext(void 0);var Vr=Object.defineProperty,Gr=(e,t,i)=>((e,t,i)=>t in e?Vr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);const Yr=new class{constructor(){Gr(this,"logs",[]),Gr(this,"maxLogs",50),this.restoreLogsFromStorage()}log(e,t,i,a){const s={timestamp:(new Date).toISOString(),step:e,success:t,data:i,error:a,userAgent:navigator.userAgent,isCapacitor:!!window.Capacitor,pathname:window.location.pathname};this.logs.unshift(s),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs)),localStorage.setItem("authHealthLogs",JSON.stringify(this.logs))}getLogs(){return this.logs}getRecentFailures(){return this.logs.filter(e=>!e.success)}clearLogs(){this.logs=[],localStorage.removeItem("authHealthLogs")}exportReport(){const e={timestamp:(new Date).toISOString(),totalLogs:this.logs.length,failureCount:this.getRecentFailures().length,successRate:this.logs.length>0?(this.logs.filter(e=>e.success).length/this.logs.length*100).toFixed(2)+"%":"N/A",logs:this.logs};return JSON.stringify(e,null,2)}restoreLogsFromStorage(){try{const e=localStorage.getItem("authHealthLogs");e&&(this.logs=JSON.parse(e))}catch(e){console.warn(" Failed to restore auth health logs:",e)}}},Kr=(e,t)=>{},Xr=({children:e})=>{const[t,i]=We.useState(null),[a,s]=We.useState(null),[r,n]=We.useState(!0),[o,l]=We.useState([]),[c,d]=We.useState(!0);We.useEffect(()=>{let e=!0;const t=new AbortController;return(async()=>{try{if(Yr.log("AuthProvider_Init",!0,{timestamp:(new Date).toISOString()}),"serviceWorker"in navigator&&("localhost"===window.location.hostname||"https:"===window.location.protocol))try{const e=await navigator.serviceWorker.getRegistrations();for(let t of e)await t.unregister();Yr.log("ServiceWorker_Cleared",!0,{count:e.length})}catch(t){Yr.log("ServiceWorker_Clear_Failed",!1,{},t.message)}(()=>{const e=localStorage.getItem("auth_cache_clear"),t=Date.now();(!e||t-parseInt(e)>36e5)&&(localStorage.removeItem("sb-undefined-auth-token"),localStorage.setItem("auth_cache_clear",t.toString()))})();let r=null,o=0;const l=3;for(;o<l&&!r;)try{const{data:{session:t},error:i}=await ba.auth.getSession();if(i){if(Kr(),o++,o<l){await new Promise(e=>setTimeout(e,1e3));continue}return void(e&&n(!1))}r=t;break}catch(a){Kr(),o++,o<l&&await new Promise(e=>setTimeout(e,1e3))}r&&e&&(r.user.email,s(r),i(r.user))}catch(a){}finally{e&&n(!1)}})(),()=>{e=!1,t.abort()}},[]),We.useEffect(()=>{let e=null;const{data:{subscription:t}}=ba.auth.onAuthStateChange(async(t,a)=>{s(e=>a),i(e=>a?.user??null),"SIGNED_IN"===t&&a?(a.user.email,a.user.email,(window.Capacitor||navigator.userAgent.includes("Safari"))&&(e=setTimeout(()=>{sessionStorage.getItem("auth_reload_done")||(sessionStorage.setItem("auth_reload_done","true"),window.location.reload())},1e3))):"SIGNED_OUT"===t&&(l([]),d(!1),sessionStorage.removeItem("auth_reload_done")),n(!1)});return()=>{t.unsubscribe(),e&&clearTimeout(e)}},[]),We.useEffect(()=>{const e=new AbortController,t=async()=>{if("visible"===document.visibilityState&&!r&&!e.signal.aborted)try{const{data:{session:e}}=await ba.auth.getSession();!e||a&&a.expires_at===e.expires_at||(s(e),i(e.user))}catch(t){e.signal.aborted}};return window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone?(document.addEventListener("visibilitychange",t,{signal:e.signal}),()=>{e.abort(),document.removeEventListener("visibilitychange",t)}):()=>{e.abort()}},[a,r]);We.useEffect(()=>{t?.id?(async e=>{if(e){d(!0);try{const{data:t}=await ba.from("user_roles").select("role").eq("user_id",e);if(t&&t.length>0){const e=t.map(e=>e.role);return void l(e)}const{data:i}=await ba.from("profiles").select("role").eq("id",e).single();i?.role?(i.role,l([i.role])):l([])}catch(t){l([])}finally{d(!1)}}})(t.id):(l([]),d(!1))},[t?.id]);const u={user:t,session:a,isAuthenticated:!!t,isLoading:r,isEmailVerified:!!t?.email_confirmed_at,userRole:o[0]||null,isRoleLoading:c,getCurrentUser:()=>t,getAccessToken:()=>a?.access_token||null,hasRole:e=>{const t=o.includes(e);return t},login:async(e,t)=>{try{const{data:i,error:a}=await ba.auth.signInWithPassword({email:e,password:t});return a?(a.message,{success:!1,error:a}):(i.user,{success:!0,session:i.session})}catch(i){return{success:!1,error:i}}},register:async(e,t)=>{try{const{data:i,error:a}=await ba.auth.signUp({email:e,password:t,options:{emailRedirectTo:`${window.location.origin}/`}});return a?(a.message,{success:!1,error:a}):(i.user,{success:!0,data:i})}catch(i){return{success:!1,error:i}}},logout:async()=>{try{n(!0),await ba.auth.signOut(),i(null),s(null),l([]),d(!1),sessionStorage.removeItem("hasSeenPostLoginIntro"),setTimeout(()=>{if(n(!1),"caches"in window&&caches.keys().then(e=>{e.forEach(e=>{caches.delete(e)})}),"/login"!==window.location.pathname&&"/"!==window.location.pathname){(()=>{try{window.location.href="/login"}catch(e){window.location.replace("/login")}})()}},150)}catch(e){n(!1)}},resetPassword:async e=>{try{const{error:t}=await ba.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/auth/reset`});return t?(t.message,{success:!1,error:t.message}):{success:!0}}catch(t){return{success:!1,error:t.message}}},resendVerificationEmail:async e=>{try{const{error:t}=await ba.auth.resend({type:"signup",email:e,options:{emailRedirectTo:`${window.location.origin}/`}});return t?(t.message,{success:!1,error:t.message}):{success:!0}}catch(t){return{success:!1,error:t.message}}}};return o.length,se.jsx(Zr.Provider,{value:u,children:e})},Jr=We.createContext(void 0),Qr=({children:e})=>{const[t,i]=We.useState("default"),[a,s]=We.useState([75]),[r,n]=We.useState(!0);We.useEffect(()=>{const e=localStorage.getItem("buzzSound");e&&i(e);const t=localStorage.getItem("buzzVolume");t&&s([Number(t)]);const a=localStorage.getItem("soundEnabled");null!==a&&n("true"===a)},[]);return se.jsx(Jr.Provider,{value:{soundPreference:t,volume:a,isEnabled:r,updateSound:e=>{i(e),localStorage.setItem("buzzSound",e)},updateVolume:e=>{s(e),localStorage.setItem("buzzVolume",e[0].toString())},toggleSound:e=>{n(e),localStorage.setItem("soundEnabled",e.toString())}},children:e})};var en=Object.defineProperty,tn=(e,t,i)=>((e,t,i)=>t in e?en(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,t+"",i);class an extends Ze.Component{constructor(e){super(e),tn(this,"handleRefresh",()=>{window.location.reload()}),this.state={hasError:!1,errorMessage:""}}static getDerivedStateFromError(e){return{hasError:!0,errorMessage:e.message||"Si  verificato un errore inaspettato"}}componentDidCatch(e,t){console.error("React error boundary caught an error:",e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:se.jsxs("div",{style:{padding:"20px",color:"white",backgroundColor:"black",height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[se.jsx("h1",{children:"Oops! Qualcosa  andato storto"}),se.jsx("p",{children:"L'applicazione ha riscontrato un problema. Prova a ricaricare la pagina."}),se.jsxs("p",{style:{maxWidth:"600px",backgroundColor:"rgba(255,255,255,0.1)",padding:"10px",borderRadius:"4px",marginTop:"10px"},children:["Dettaglio: ",this.state.errorMessage]}),se.jsx("button",{onClick:this.handleRefresh,style:{marginTop:"20px",padding:"10px 20px",background:"#00E5FF",color:"black",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Ricarica Pagina"})]}):this.props.children}}const sn=()=>{const e=We.useContext(Zr);if(void 0===e)throw new Error("useAuthContext deve essere usato all'interno di un AuthProvider");return e},rn=()=>{const{user:e}=sn(),[t,i]=We.useState({total_xp:0,buzz_xp_progress:0,map_xp_progress:0,free_buzz_credit:0,free_buzz_map_credit:0,next_buzz_reward:100,next_map_reward:250}),[a,s]=We.useState(!0),[r,n]=We.useState(!1),[o,l]=We.useState(null),c=async()=>{if(e?.id)try{const{data:a,error:s}=await ba.rpc("get_user_xp_status",{p_user_id:e.id});if(s)return void console.error("Error fetching XP status:",s);if(a){const e=a,s=e.free_buzz_credit>t.free_buzz_credit,r=e.free_buzz_map_credit>t.free_buzz_map_credit;(s||r)&&n(!0),s?l({name:"BUZZ Gratuito Sbloccato!",description:`Hai guadagnato un BUZZ gratuito! (${e.free_buzz_credit} disponibili)`}):r&&l({name:"BUZZ MAP Gratuito Sbloccato!",description:`Hai guadagnato un BUZZ MAP gratuito! (${e.free_buzz_map_credit} disponibili)`}),i(e)}}catch(a){console.error("Exception fetching XP status:",a)}finally{s(!1)}};We.useEffect(()=>{if(!e?.id)return;c();const t=ba.channel("user_xp_changes").on("postgres_changes",{event:"*",schema:"public",table:"user_xp",filter:`user_id=eq.${e.id}`},()=>{c()}).subscribe(),i=ba.channel("user_credits_changes").on("postgres_changes",{event:"*",schema:"public",table:"user_credits",filter:`user_id=eq.${e.id}`},()=>{c()}).subscribe();return()=>{ba.removeChannel(t),ba.removeChannel(i)}},[e?.id]);return{xpStatus:t,loading:a,hasNewRewards:r,newBadge:o,consumeCredit:async t=>{if(!e?.id)return!1;try{const{data:i,error:a}=await ba.rpc("consume_credit",{p_user_id:e.id,p_credit_type:t});return a?(console.error("Error consuming credit:",a),!1):!!i&&(await c(),!0)}catch(i){return console.error("Exception consuming credit:",i),!1}},markRewardsAsSeen:()=>{n(!1)},closeBadgeNotification:()=>{l(null)},refreshXpStatus:c}};function nn(e){var t,i,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(i=nn(e[t]))&&(a&&(a+=" "),a+=i)}else for(i in e)e[i]&&(a&&(a+=" "),a+=i);return a}function on(){for(var e,t,i=0,a="",s=arguments.length;i<s;i++)(e=arguments[i])&&(t=nn(e))&&(a&&(a+=" "),a+=t);return a}const ln=e=>{const t=hn(e),{conflictingClassGroups:i,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:e=>{const i=e.split("-");return""===i[0]&&1!==i.length&&i.shift(),cn(i,t)||un(e)},getConflictingClassGroupIds:(e,t)=>{const s=i[e]||[];return t&&a[e]?[...s,...a[e]]:s}}},cn=(e,t)=>{if(0===e.length)return t.classGroupId;const i=e[0],a=t.nextPart.get(i),s=a?cn(e.slice(1),a):void 0;if(s)return s;if(0===t.validators.length)return;const r=e.join("-");return t.validators.find(({validator:e})=>e(r))?.classGroupId},dn=/^\[(.+)\]$/,un=e=>{if(dn.test(e)){const t=dn.exec(e)[1],i=t?.substring(0,t.indexOf(":"));if(i)return"arbitrary.."+i}},hn=e=>{const{theme:t,prefix:i}=e,a={nextPart:new Map,validators:[]};return gn(Object.entries(e.classGroups),i).forEach(([e,i])=>{mn(i,a,e,t)}),a},mn=(e,t,i,a)=>{e.forEach(e=>{if("string"==typeof e){return void((""===e?t:pn(t,e)).classGroupId=i)}if("function"==typeof e)return fn(e)?void mn(e(a),t,i,a):void t.validators.push({validator:e,classGroupId:i});Object.entries(e).forEach(([e,s])=>{mn(s,pn(t,e),i,a)})})},pn=(e,t)=>{let i=e;return t.split("-").forEach(e=>{i.nextPart.has(e)||i.nextPart.set(e,{nextPart:new Map,validators:[]}),i=i.nextPart.get(e)}),i},fn=e=>e.isThemeGetter,gn=(e,t)=>t?e.map(([e,i])=>[e,i.map(e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,i])=>[t+e,i])):e)]):e,xn=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,i=new Map,a=new Map;const s=(s,r)=>{i.set(s,r),t++,t>e&&(t=0,a=i,i=new Map)};return{get(e){let t=i.get(e);return void 0!==t?t:void 0!==(t=a.get(e))?(s(e,t),t):void 0},set(e,t){i.has(e)?i.set(e,t):s(e,t)}}},bn=e=>{const{separator:t,experimentalParseClassName:i}=e,a=1===t.length,s=t[0],r=t.length,n=e=>{const i=[];let n,o=0,l=0;for(let u=0;u<e.length;u++){let c=e[u];if(0===o){if(c===s&&(a||e.slice(u,u+r)===t)){i.push(e.slice(l,u)),l=u+r;continue}if("/"===c){n=u;continue}}"["===c?o++:"]"===c&&o--}const c=0===i.length?e:e.substring(l),d=c.startsWith("!");return{modifiers:i,hasImportantModifier:d,baseClassName:d?c.substring(1):c,maybePostfixModifierPosition:n&&n>l?n-l:void 0}};return i?e=>i({className:e,parseClassName:n}):n},vn=e=>{if(e.length<=1)return e;const t=[];let i=[];return e.forEach(e=>{"["===e[0]?(t.push(...i.sort(),e),i=[]):i.push(e)}),t.push(...i.sort()),t},yn=/\s+/;function wn(){let e,t,i=0,a="";for(;i<arguments.length;)(e=arguments[i++])&&(t=Nn(e))&&(a&&(a+=" "),a+=t);return a}const Nn=e=>{if("string"==typeof e)return e;let t,i="";for(let a=0;a<e.length;a++)e[a]&&(t=Nn(e[a]))&&(i&&(i+=" "),i+=t);return i};function jn(e,...t){let i,a,s,r=function(o){const l=t.reduce((e,t)=>t(e),e());return i=(e=>({cache:xn(e.cacheSize),parseClassName:bn(e),...ln(e)}))(l),a=i.cache.get,s=i.cache.set,r=n,n(o)};function n(e){const t=a(e);if(t)return t;const r=((e,t)=>{const{parseClassName:i,getClassGroupId:a,getConflictingClassGroupIds:s}=t,r=[],n=e.trim().split(yn);let o="";for(let l=n.length-1;l>=0;l-=1){const e=n[l],{modifiers:t,hasImportantModifier:c,baseClassName:d,maybePostfixModifierPosition:u}=i(e);let h=Boolean(u),m=a(h?d.substring(0,u):d);if(!m){if(!h){o=e+(o.length>0?" "+o:o);continue}if(m=a(d),!m){o=e+(o.length>0?" "+o:o);continue}h=!1}const p=vn(t).join(":"),f=c?p+"!":p,g=f+m;if(r.includes(g))continue;r.push(g);const x=s(m,h);for(let i=0;i<x.length;++i){const e=x[i];r.push(f+e)}o=e+(o.length>0?" "+o:o)}return o})(e,i);return s(e,r),r}return function(){return r(wn.apply(null,arguments))}}const Sn=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},_n=/^\[(?:([a-z-]+):)?(.+)\]$/i,kn=/^\d+\/\d+$/,Cn=new Set(["px","full","screen"]),An=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,zn=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,En=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,In=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Pn=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Tn=e=>Ln(e)||Cn.has(e)||kn.test(e),Mn=e=>Gn(e,"length",Yn),Ln=e=>Boolean(e)&&!Number.isNaN(Number(e)),Fn=e=>Gn(e,"number",Ln),On=e=>Boolean(e)&&Number.isInteger(Number(e)),Dn=e=>e.endsWith("%")&&Ln(e.slice(0,-1)),Rn=e=>_n.test(e),Bn=e=>An.test(e),Un=new Set(["length","size","percentage"]),qn=e=>Gn(e,Un,Kn),$n=e=>Gn(e,"position",Kn),Wn=new Set(["image","url"]),Hn=e=>Gn(e,Wn,Jn),Zn=e=>Gn(e,"",Xn),Vn=()=>!0,Gn=(e,t,i)=>{const a=_n.exec(e);return!!a&&(a[1]?"string"==typeof t?a[1]===t:t.has(a[1]):i(a[2]))},Yn=e=>zn.test(e)&&!En.test(e),Kn=()=>!1,Xn=e=>In.test(e),Jn=e=>Pn.test(e),Qn=jn(()=>{const e=Sn("colors"),t=Sn("spacing"),i=Sn("blur"),a=Sn("brightness"),s=Sn("borderColor"),r=Sn("borderRadius"),n=Sn("borderSpacing"),o=Sn("borderWidth"),l=Sn("contrast"),c=Sn("grayscale"),d=Sn("hueRotate"),u=Sn("invert"),h=Sn("gap"),m=Sn("gradientColorStops"),p=Sn("gradientColorStopPositions"),f=Sn("inset"),g=Sn("margin"),x=Sn("opacity"),b=Sn("padding"),v=Sn("saturate"),y=Sn("scale"),w=Sn("sepia"),N=Sn("skew"),j=Sn("space"),S=Sn("translate"),_=()=>["auto",Rn,t],k=()=>[Rn,t],C=()=>["",Tn,Mn],A=()=>["auto",Ln,Rn],z=()=>["","0",Rn],E=()=>[Ln,Rn];return{cacheSize:500,separator:":",theme:{colors:[Vn],spacing:[Tn,Mn],blur:["none","",Bn,Rn],brightness:E(),borderColor:[e],borderRadius:["none","","full",Bn,Rn],borderSpacing:k(),borderWidth:C(),contrast:E(),grayscale:z(),hueRotate:E(),invert:z(),gap:k(),gradientColorStops:[e],gradientColorStopPositions:[Dn,Mn],inset:_(),margin:_(),opacity:E(),padding:k(),saturate:E(),scale:E(),sepia:z(),skew:E(),space:k(),translate:k()},classGroups:{aspect:[{aspect:["auto","square","video",Rn]}],container:["container"],columns:[{columns:[Bn]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Rn]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[f]}],"inset-x":[{"inset-x":[f]}],"inset-y":[{"inset-y":[f]}],start:[{start:[f]}],end:[{end:[f]}],top:[{top:[f]}],right:[{right:[f]}],bottom:[{bottom:[f]}],left:[{left:[f]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",On,Rn]}],basis:[{basis:_()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Rn]}],grow:[{grow:z()}],shrink:[{shrink:z()}],order:[{order:["first","last","none",On,Rn]}],"grid-cols":[{"grid-cols":[Vn]}],"col-start-end":[{col:["auto",{span:["full",On,Rn]},Rn]}],"col-start":[{"col-start":A()}],"col-end":[{"col-end":A()}],"grid-rows":[{"grid-rows":[Vn]}],"row-start-end":[{row:["auto",{span:[On,Rn]},Rn]}],"row-start":[{"row-start":A()}],"row-end":[{"row-end":A()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Rn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Rn]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[j]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[j]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Rn,t]}],"min-w":[{"min-w":[Rn,t,"min","max","fit"]}],"max-w":[{"max-w":[Rn,t,"none","full","min","max","fit","prose",{screen:[Bn]},Bn]}],h:[{h:[Rn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Rn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Rn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Rn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Bn,Mn]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Fn]}],"font-family":[{font:[Vn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Rn]}],"line-clamp":[{"line-clamp":["none",Ln,Fn]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Tn,Rn]}],"list-image":[{"list-image":["none",Rn]}],"list-style-type":[{list:["none","disc","decimal",Rn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[x]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[x]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Tn,Mn]}],"underline-offset":[{"underline-offset":["auto",Tn,Rn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:k()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Rn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Rn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[x]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",$n]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",qn]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Hn]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[r]}],"rounded-s":[{"rounded-s":[r]}],"rounded-e":[{"rounded-e":[r]}],"rounded-t":[{"rounded-t":[r]}],"rounded-r":[{"rounded-r":[r]}],"rounded-b":[{"rounded-b":[r]}],"rounded-l":[{"rounded-l":[r]}],"rounded-ss":[{"rounded-ss":[r]}],"rounded-se":[{"rounded-se":[r]}],"rounded-ee":[{"rounded-ee":[r]}],"rounded-es":[{"rounded-es":[r]}],"rounded-tl":[{"rounded-tl":[r]}],"rounded-tr":[{"rounded-tr":[r]}],"rounded-br":[{"rounded-br":[r]}],"rounded-bl":[{"rounded-bl":[r]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[x]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[x]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[Tn,Rn]}],"outline-w":[{outline:[Tn,Mn]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:C()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[x]}],"ring-offset-w":[{"ring-offset":[Tn,Mn]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Bn,Zn]}],"shadow-color":[{shadow:[Vn]}],opacity:[{opacity:[x]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[i]}],brightness:[{brightness:[a]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Bn,Rn]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[u]}],saturate:[{saturate:[v]}],sepia:[{sepia:[w]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[i]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[u]}],"backdrop-opacity":[{"backdrop-opacity":[x]}],"backdrop-saturate":[{"backdrop-saturate":[v]}],"backdrop-sepia":[{"backdrop-sepia":[w]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[n]}],"border-spacing-x":[{"border-spacing-x":[n]}],"border-spacing-y":[{"border-spacing-y":[n]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Rn]}],duration:[{duration:E()}],ease:[{ease:["linear","in","out","in-out",Rn]}],delay:[{delay:E()}],animate:[{animate:["none","spin","ping","pulse","bounce",Rn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[y]}],"scale-x":[{"scale-x":[y]}],"scale-y":[{"scale-y":[y]}],rotate:[{rotate:[On,Rn]}],"translate-x":[{"translate-x":[S]}],"translate-y":[{"translate-y":[S]}],"skew-x":[{"skew-x":[N]}],"skew-y":[{"skew-y":[N]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Rn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Rn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":k()}],"scroll-mx":[{"scroll-mx":k()}],"scroll-my":[{"scroll-my":k()}],"scroll-ms":[{"scroll-ms":k()}],"scroll-me":[{"scroll-me":k()}],"scroll-mt":[{"scroll-mt":k()}],"scroll-mr":[{"scroll-mr":k()}],"scroll-mb":[{"scroll-mb":k()}],"scroll-ml":[{"scroll-ml":k()}],"scroll-p":[{"scroll-p":k()}],"scroll-px":[{"scroll-px":k()}],"scroll-py":[{"scroll-py":k()}],"scroll-ps":[{"scroll-ps":k()}],"scroll-pe":[{"scroll-pe":k()}],"scroll-pt":[{"scroll-pt":k()}],"scroll-pr":[{"scroll-pr":k()}],"scroll-pb":[{"scroll-pb":k()}],"scroll-pl":[{"scroll-pl":k()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Rn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Tn,Mn,Fn]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}});function eo(...e){return Qn(on(e))}const to=({open:e,onOpenChange:t,children:i})=>{const[a,s]=We.useState(e||!1);We.useEffect(()=>{void 0!==e&&s(e)},[e]);const r=e=>{s(e),t?.(e)};return se.jsx("div",{children:We.Children.map(i,e=>We.isValidElement(e)?We.cloneElement(e,{isOpen:a,onOpenChange:r}):e)})},io=We.forwardRef(({className:e,isOpen:t,onOpenChange:i,children:a,...s},r)=>t?se.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4",children:se.jsxs("div",{ref:r,className:eo("relative bg-background rounded-lg shadow-lg max-w-lg w-full max-h-[85vh] overflow-y-auto m1ssion-glass-card",e),...s,children:[se.jsxs("button",{onClick:()=>i?.(!1),className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 text-white hover:text-[#00D1FF]",children:[se.jsx("span",{className:"sr-only",children:"Close"}),""]}),a]})}):null);io.displayName="DialogContent";const ao=({className:e,...t})=>se.jsx("div",{className:eo("flex flex-col space-y-1.5 text-center sm:text-left p-6",e),...t});ao.displayName="DialogHeader";const so=We.forwardRef(({className:e,...t},i)=>se.jsx("h2",{ref:i,className:eo("text-lg font-semibold leading-none tracking-tight gradient-text-cyan",e),...t}));so.displayName="DialogTitle";const ro=We.forwardRef(({className:e,asChild:t,children:i,...a},s)=>{const r=t?"div":"p";return se.jsx(r,{ref:s,className:eo("text-sm text-white/70",e),...a,children:i})});ro.displayName="DialogDescription";const no=({className:e,...t})=>se.jsx("div",{className:eo("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 p-6 pt-0",e),...t});no.displayName="DialogFooter";const oo=({asChild:e,children:t,...i})=>{const a=e?"span":"button";return se.jsx(a,{...i,children:t})};oo.displayName="DialogClose";const lo=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,co=on,uo=(e,t)=>i=>{var a;if(null==(null==t?void 0:t.variants))return co(e,null==i?void 0:i.class,null==i?void 0:i.className);const{variants:s,defaultVariants:r}=t,n=Object.keys(s).map(e=>{const t=null==i?void 0:i[e],a=null==r?void 0:r[e];if(null===t)return null;const n=lo(t)||lo(a);return s[e][n]}),o=i&&Object.entries(i).reduce((e,t)=>{let[i,a]=t;return void 0===a||(e[i]=a),e},{}),l=null==t||null===(a=t.compoundVariants)||void 0===a?void 0:a.reduce((e,t)=>{let{class:i,className:a,...s}=t;return Object.entries(s).every(e=>{let[t,i]=e;return Array.isArray(i)?i.includes({...r,...o}[t]):{...r,...o}[t]===i})?[...e,i,a]:e},[]);return co(e,n,l,null==i?void 0:i.class,null==i?void 0:i.className)},ho=uo("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 btn-hover-effect",{variants:{variant:{default:"bg-gradient-to-r from-[#7B2EFF] to-[#00D1FF] text-white hover:shadow-[0_0_15px_rgba(0,209,255,0.5)] hover:scale-[1.03]",destructive:"bg-gradient-to-r from-red-500 to-red-700 text-white hover:shadow-[0_0_15px_rgba(239,68,68,0.5)] hover:scale-[1.03]",outline:"border border-[#00D1FF]/30 hover:border-[#00D1FF]/70 bg-black/30 hover:bg-black/50 text-white",secondary:"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-[0_0_15px_rgba(217,70,239,0.5)] hover:scale-[1.03]",ghost:"hover:bg-white/10 hover:text-[#00D1FF] text-white",link:"text-[#00D1FF] underline-offset-4 hover:underline hover:brightness-125",accent:"bg-gradient-to-r from-yellow-400 to-orange-500 text-black hover:shadow-[0_0_15px_rgba(250,204,21,0.5)] hover:scale-[1.03]"},size:{default:"h-10 px-6 py-2 rounded-full",sm:"h-9 rounded-full px-4",lg:"h-11 rounded-full px-8",icon:"h-10 w-10 rounded-full"}},defaultVariants:{variant:"default",size:"default"}}),mo=We.forwardRef(({className:e,variant:t,size:i,asChild:a=!1,...s},r)=>{const n=a?"span":"button";return se.jsx(n,{className:eo(ho({variant:t,size:i,className:e})),ref:r,...s})});mo.displayName="Button";const po=({open:e,onOpenChange:t,freeBuzzCredits:i,freeBuzzMapCredits:a,onRedirectToBuzz:s,onRedirectToBuzzMap:r})=>se.jsx(to,{open:e,onOpenChange:t,children:se.jsxs(io,{className:"max-w-md mx-auto bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f172a] border border-cyan-500/20",children:[se.jsxs(ao,{className:"text-center",children:[se.jsx(et.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"flex items-center justify-center mb-4",children:se.jsxs("div",{className:"relative",children:[se.jsx(Ms,{className:"w-16 h-16 text-yellow-400"}),se.jsx(jr,{className:"absolute -top-2 -right-2 w-6 h-6 text-yellow-300"})]})}),se.jsx(so,{className:"text-2xl font-bold gradient-text mb-2",children:" BADGE SBLOCCATO!"}),se.jsx("p",{className:"text-gray-300 text-sm",children:"Hai guadagnato ricompense gratuite! Clicca per riscattare."})]}),se.jsxs("div",{className:"space-y-3 py-4",children:[i>0&&se.jsxs("button",{onClick:()=>{t(!1),s()},className:"w-full flex items-center justify-between p-4 bg-gradient-to-r from-purple-900/60 to-purple-700/60 rounded-xl border-2 border-purple-500/50 hover:border-purple-400 hover:scale-[1.02] transition-all duration-200 cursor-pointer",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx("div",{className:"p-3 bg-purple-600/70 rounded-full",children:se.jsx(Wr,{className:"w-6 h-6 text-yellow-300"})}),se.jsxs("div",{className:"text-left",children:[se.jsx("p",{className:"font-bold text-lg text-white",children:"BUZZ Gratuito Sbloccato!"}),se.jsxs("p",{className:"text-sm text-purple-200",children:["Hai guadagnato un BUZZ gratuito (",i," disponibili)"]})]})]}),se.jsx("div",{className:"text-3xl",children:""})]}),a>0&&se.jsxs("button",{onClick:()=>{t(!1),r()},className:"w-full flex items-center justify-between p-4 bg-gradient-to-r from-cyan-900/60 to-cyan-700/60 rounded-xl border-2 border-cyan-500/50 hover:border-cyan-400 hover:scale-[1.02] transition-all duration-200 cursor-pointer",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx("div",{className:"p-3 bg-cyan-600/70 rounded-full",children:se.jsx(Ys,{className:"w-6 h-6 text-yellow-300"})}),se.jsxs("div",{className:"text-left",children:[se.jsx("p",{className:"font-bold text-lg text-white",children:"BUZZ MAPPA Gratuito Sbloccato!"}),se.jsxs("p",{className:"text-sm text-cyan-200",children:["Hai guadagnato un BUZZ MAPPA gratuito (",a," disponibili)"]})]})]}),se.jsx("div",{className:"text-3xl",children:""})]})]}),se.jsx("div",{className:"flex justify-center pt-2",children:se.jsx(mo,{onClick:()=>t(!1),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-200",children:"Chiudi"})})]})}),fo=({open:e,onOpenChange:t,creditType:i,onConfirm:a,onCancel:s})=>{const r=i?{buzz:{icon:Wr,title:"Buzz Gratuito",description:"Utilizzare un Buzz gratuito ottenuto tramite XP?",color:"purple",gradientFrom:"from-purple-900/40",gradientTo:"to-purple-700/40",borderColor:"border-purple-500/30",textColor:"text-purple-200",buttonBg:"bg-purple-600/20",buttonBorder:"border-purple-500/50",buttonHover:"hover:bg-purple-600/40"},buzz_map:{icon:Ys,title:"Buzz Mappa Gratuito",description:"Utilizzare un Buzz Mappa gratuito ottenuto tramite XP?",color:"cyan",gradientFrom:"from-cyan-900/40",gradientTo:"to-cyan-700/40",borderColor:"border-cyan-500/30",textColor:"text-cyan-200",buttonBg:"bg-cyan-600/20",buttonBorder:"border-cyan-500/50",buttonHover:"hover:bg-cyan-600/40"}}[i]:null;if(!r)return null;const n=r.icon;return se.jsx(to,{open:e,onOpenChange:t,children:se.jsxs(io,{className:"max-w-sm mx-auto bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f172a] border border-cyan-500/20",children:[se.jsxs(ao,{className:"text-center",children:[se.jsx(et.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"flex items-center justify-center mb-4",children:se.jsxs("div",{className:"relative",children:[se.jsx("div",{className:`p-4 bg-gradient-to-r ${r.gradientFrom} ${r.gradientTo} rounded-full border ${r.borderColor}`,children:se.jsx(n,{className:"w-12 h-12 text-white"})}),se.jsx(et.div,{animate:{scale:[1,1.3,1],rotate:[0,180,360]},transition:{duration:2,repeat:1/0,repeatType:"loop"},className:"absolute -top-1 -right-1",children:se.jsx(wr,{className:"w-6 h-6 text-yellow-400"})})]})}),se.jsxs(so,{className:"text-xl font-bold gradient-text mb-2",children:[" ",r.title]}),se.jsx("p",{className:"text-gray-300 text-sm",children:r.description})]}),se.jsx(et.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:`p-4 bg-gradient-to-r ${r.gradientFrom} ${r.gradientTo} rounded-lg border ${r.borderColor} mb-4`,children:se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx("div",{className:`p-2 ${r.buttonBg} rounded-full`,children:se.jsx(hs,{className:"w-5 h-5 text-green-400"})}),se.jsxs("div",{children:[se.jsx("p",{className:`font-semibold ${r.textColor}`,children:"Credito XP"}),se.jsx("p",{className:"text-sm text-gray-400",children:"Ottenuto tramite sistema XP"})]})]})}),se.jsxs("div",{className:"flex space-x-3",children:[se.jsx(mo,{onClick:()=>{s(),t(!1)},variant:"outline",className:"flex-1 bg-gray-700/50 border-gray-600/50 text-gray-300 hover:bg-gray-700/80",children:"Annulla"}),se.jsx(mo,{onClick:()=>{a(),t(!1)},className:`flex-1 ${r.buttonBg} ${r.buttonBorder} ${r.textColor} ${r.buttonHover} border`,children:"Conferma"})]})]})})},go=({onCreditAvailable:e,onRequestCreditConsumption:t})=>{const{xpStatus:i,hasNewRewards:a,markRewardsAsSeen:s,consumeCredit:r}=rn(),[,n]=Ai(),[o,l]=We.useState(!1),[c,d]=We.useState(!1),[u,h]=We.useState({open:!1,type:null});We.useEffect(()=>{a&&!c&&(i.free_buzz_credit>0||i.free_buzz_map_credit>0)&&l(!0)},[a,i.free_buzz_credit,i.free_buzz_map_credit,c]),We.useEffect(()=>{e&&(e("buzz",i.free_buzz_credit>0),e("buzz_map",i.free_buzz_map_credit>0))},[i.free_buzz_credit,i.free_buzz_map_credit,e]),We.useEffect(()=>{},[t]);const m=()=>{u.resolve&&u.resolve(!1),h({open:!1,type:null})},p=async e=>new Promise(t=>{h({open:!0,type:e,resolve:t})});return Ze.useImperativeHandle(Ze.createRef(),()=>({requestCreditConsumption:p}),[]),se.jsxs(se.Fragment,{children:[se.jsx(po,{open:o,onOpenChange:l,freeBuzzCredits:i.free_buzz_credit,freeBuzzMapCredits:i.free_buzz_map_credit,onRedirectToBuzz:()=>{s(),d(!0),l(!1),n("/buzz?free=1&reward=1")},onRedirectToBuzzMap:()=>{s(),d(!0),l(!1),n("/map?free=1&reward=1")}}),se.jsx(fo,{open:u.open,onOpenChange:e=>!e&&m(),creditType:u.type,onConfirm:async()=>{if(u.type&&u.resolve){const e=await r(u.type);u.resolve(e),h({open:!1,type:null})}},onCancel:m})]})};var xo="undefined"!=typeof Element,bo="function"==typeof Map,vo="function"==typeof Set,yo="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function wo(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var i,a,s,r;if(Array.isArray(e)){if((i=e.length)!=t.length)return!1;for(a=i;0!==a--;)if(!wo(e[a],t[a]))return!1;return!0}if(bo&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(r=e.entries();!(a=r.next()).done;)if(!t.has(a.value[0]))return!1;for(r=e.entries();!(a=r.next()).done;)if(!wo(a.value[1],t.get(a.value[0])))return!1;return!0}if(vo&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(r=e.entries();!(a=r.next()).done;)if(!t.has(a.value[0]))return!1;return!0}if(yo&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if((i=e.length)!=t.length)return!1;for(a=i;0!==a--;)if(e[a]!==t[a])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&"function"==typeof e.valueOf&&"function"==typeof t.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&"function"==typeof e.toString&&"function"==typeof t.toString)return e.toString()===t.toString();if((i=(s=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(a=i;0!==a--;)if(!Object.prototype.hasOwnProperty.call(t,s[a]))return!1;if(xo&&e instanceof Element)return!1;for(a=i;0!==a--;)if(("_owner"!==s[a]&&"__v"!==s[a]&&"__o"!==s[a]||!e.$$typeof)&&!wo(e[s[a]],t[s[a]]))return!1;return!0}return e!=e&&t!=t}const No=Ge(function(e,t){try{return wo(e,t)}catch(i){if((i.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw i}});var jo=function(e,t,i,a,s,r,n,o){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[i,a,s,r,n,o],d=0;(l=new Error(t.replace(/%s/g,function(){return c[d++]}))).name="Invariant Violation"}throw l.framesToPop=1,l}};const So=Ge(jo);const _o=Ge(function(e,t,i,a){var s=i?i.call(a,e,t):void 0;if(void 0!==s)return!!s;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=Object.prototype.hasOwnProperty.bind(t),l=0;l<r.length;l++){var c=r[l];if(!o(c))return!1;var d=e[c],u=t[c];if(!1===(s=i?i.call(a,d,u,c):void 0)||void 0===s&&d!==u)return!1}return!0});var ko=(e=>(e.BASE="base",e.BODY="body",e.HEAD="head",e.HTML="html",e.LINK="link",e.META="meta",e.NOSCRIPT="noscript",e.SCRIPT="script",e.STYLE="style",e.TITLE="title",e.FRAGMENT="Symbol(react.fragment)",e))(ko||{}),Co={rel:["amphtml","canonical","alternate"]},Ao={type:["application/ld+json"]},zo={charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]},Eo=Object.values(ko),Io={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},Po=Object.entries(Io).reduce((e,[t,i])=>(e[i]=t,e),{}),To="data-rh",Mo="defaultTitle",Lo="defer",Fo="encodeSpecialCharacters",Oo="onChangeClientState",Do="titleTemplate",Ro="prioritizeSeoTags",Bo=(e,t)=>{for(let i=e.length-1;i>=0;i-=1){const a=e[i];if(Object.prototype.hasOwnProperty.call(a,t))return a[t]}return null},Uo=e=>{let t=Bo(e,"title");const i=Bo(e,Do);if(Array.isArray(t)&&(t=t.join("")),i&&t)return i.replace(/%s/g,()=>t);const a=Bo(e,Mo);return t||a||void 0},qo=e=>Bo(e,Oo)||(()=>{}),$o=(e,t)=>t.filter(t=>void 0!==t[e]).map(t=>t[e]).reduce((e,t)=>({...e,...t}),{}),Wo=(e,t)=>t.filter(e=>void 0!==e.base).map(e=>e.base).reverse().reduce((t,i)=>{if(!t.length){const a=Object.keys(i);for(let s=0;s<a.length;s+=1){const r=a[s].toLowerCase();if(-1!==e.indexOf(r)&&i[r])return t.concat(i)}}return t},[]),Ho=(e,t,i)=>{const a={};return i.filter(t=>{return!!Array.isArray(t[e])||(void 0!==t[e]&&(i=`Helmet: ${e} should be of type "Array". Instead found type "${typeof t[e]}"`,console&&"function"==typeof console.warn&&console.warn(i)),!1);var i}).map(t=>t[e]).reverse().reduce((e,i)=>{const s={};i.filter(e=>{let i;const r=Object.keys(e);for(let a=0;a<r.length;a+=1){const s=r[a],n=s.toLowerCase();-1===t.indexOf(n)||"rel"===i&&"canonical"===e[i].toLowerCase()||"rel"===n&&"stylesheet"===e[n].toLowerCase()||(i=n),-1===t.indexOf(s)||"innerHTML"!==s&&"cssText"!==s&&"itemprop"!==s||(i=s)}if(!i||!e[i])return!1;const n=e[i].toLowerCase();return a[i]||(a[i]={}),s[i]||(s[i]={}),!a[i][n]&&(s[i][n]=!0,!0)}).reverse().forEach(t=>e.push(t));const r=Object.keys(s);for(let t=0;t<r.length;t+=1){const e=r[t],i={...a[e],...s[e]};a[e]=i}return e},[]).reverse()},Zo=(e,t)=>{if(Array.isArray(e)&&e.length)for(let i=0;i<e.length;i+=1){if(e[i][t])return!0}return!1},Vo=e=>Array.isArray(e)?e.join(""):e,Go=(e,t)=>Array.isArray(e)?e.reduce((e,i)=>(((e,t)=>{const i=Object.keys(e);for(let a=0;a<i.length;a+=1)if(t[i[a]]&&t[i[a]].includes(e[i[a]]))return!0;return!1})(i,t)?e.priority.push(i):e.default.push(i),e),{priority:[],default:[]}):{default:e,priority:[]},Yo=(e,t)=>({...e,[t]:void 0}),Ko=["noscript","script","style"],Xo=(e,t=!0)=>!1===t?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),Jo=e=>Object.keys(e).reduce((t,i)=>{const a=void 0!==e[i]?`${i}="${e[i]}"`:`${i}`;return t?`${t} ${a}`:a},""),Qo=(e,t={})=>Object.keys(e).reduce((t,i)=>(t[Io[i]||i]=e[i],t),t),el=(e,t)=>t.map((t,i)=>{const a={key:i,[To]:!0};return Object.keys(t).forEach(e=>{const i=Io[e]||e;if("innerHTML"===i||"cssText"===i){const e=t.innerHTML||t.cssText;a.dangerouslySetInnerHTML={__html:e}}else a[i]=t[e]}),Ze.createElement(e,a)}),tl=(e,t,i=!0)=>{switch(e){case"title":return{toComponent:()=>((e,t,i)=>{const a=Qo(i,{key:t,[To]:!0});return[Ze.createElement("title",a,t)]})(0,t.title,t.titleAttributes),toString:()=>((e,t,i,a)=>{const s=Jo(i),r=Vo(t);return s?`<${e} ${To}="true" ${s}>${Xo(r,a)}</${e}>`:`<${e} ${To}="true">${Xo(r,a)}</${e}>`})(e,t.title,t.titleAttributes,i)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>Qo(t),toString:()=>Jo(t)};default:return{toComponent:()=>el(e,t),toString:()=>((e,t,i=!0)=>t.reduce((t,a)=>{const s=a,r=Object.keys(s).filter(e=>!("innerHTML"===e||"cssText"===e)).reduce((e,t)=>{const a=void 0===s[t]?t:`${t}="${Xo(s[t],i)}"`;return e?`${e} ${a}`:a},""),n=s.innerHTML||s.cssText||"",o=-1===Ko.indexOf(e);return`${t}<${e} ${To}="true" ${r}${o?"/>":`>${n}</${e}>`}`},""))(e,t,i)}}},il=e=>{const{baseTag:t,bodyAttributes:i,encode:a=!0,htmlAttributes:s,noscriptTags:r,styleTags:n,title:o="",titleAttributes:l,prioritizeSeoTags:c}=e;let{linkTags:d,metaTags:u,scriptTags:h}=e,m={toComponent:()=>{},toString:()=>""};return c&&({priorityMethods:m,linkTags:d,metaTags:u,scriptTags:h}=(({metaTags:e,linkTags:t,scriptTags:i,encode:a})=>{const s=Go(e,zo),r=Go(t,Co),n=Go(i,Ao);return{priorityMethods:{toComponent:()=>[...el("meta",s.priority),...el("link",r.priority),...el("script",n.priority)],toString:()=>`${tl("meta",s.priority,a)} ${tl("link",r.priority,a)} ${tl("script",n.priority,a)}`},metaTags:s.default,linkTags:r.default,scriptTags:n.default}})(e)),{priority:m,base:tl("base",t,a),bodyAttributes:tl("bodyAttributes",i,a),htmlAttributes:tl("htmlAttributes",s,a),link:tl("link",d,a),meta:tl("meta",u,a),noscript:tl("noscript",r,a),script:tl("script",h,a),style:tl("style",n,a),title:tl("title",{title:o,titleAttributes:l},a)}},al=[],sl=!("undefined"==typeof window||!window.document||!window.document.createElement),rl=class{constructor(e,t){Y(this,"instances",[]),Y(this,"canUseDOM",sl),Y(this,"context"),Y(this,"value",{setHelmet:e=>{this.context.helmet=e},helmetInstances:{get:()=>this.canUseDOM?al:this.instances,add:e=>{(this.canUseDOM?al:this.instances).push(e)},remove:e=>{const t=(this.canUseDOM?al:this.instances).indexOf(e);(this.canUseDOM?al:this.instances).splice(t,1)}}}),this.context=e,this.canUseDOM=t||!1,t||(e.helmet=il({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},nl=Ze.createContext({}),ol=(H=class extends We.Component{constructor(e){super(e),Y(this,"helmetData"),this.helmetData=new rl(this.props.context||{},H.canUseDOM)}render(){return Ze.createElement(nl.Provider,{value:this.helmetData.value},this.props.children)}},Y(H,"canUseDOM",sl),H),ll=(e,t)=>{const i=document.head||document.querySelector("head"),a=i.querySelectorAll(`${e}[${To}]`),s=[].slice.call(a),r=[];let n;return t&&t.length&&t.forEach(t=>{const i=document.createElement(e);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))if("innerHTML"===e)i.innerHTML=t.innerHTML;else if("cssText"===e)i.styleSheet?i.styleSheet.cssText=t.cssText:i.appendChild(document.createTextNode(t.cssText));else{const a=e,s=void 0===t[a]?"":t[a];i.setAttribute(e,s)}i.setAttribute(To,"true"),s.some((e,t)=>(n=t,i.isEqualNode(e)))?s.splice(n,1):r.push(i)}),s.forEach(e=>e.parentNode?.removeChild(e)),r.forEach(e=>i.appendChild(e)),{oldTags:s,newTags:r}},cl=(e,t)=>{const i=document.getElementsByTagName(e)[0];if(!i)return;const a=i.getAttribute(To),s=a?a.split(","):[],r=[...s],n=Object.keys(t);for(const o of n){const e=t[o]||"";i.getAttribute(o)!==e&&i.setAttribute(o,e),-1===s.indexOf(o)&&s.push(o);const a=r.indexOf(o);-1!==a&&r.splice(a,1)}for(let o=r.length-1;o>=0;o-=1)i.removeAttribute(r[o]);s.length===r.length?i.removeAttribute(To):i.getAttribute(To)!==n.join(",")&&i.setAttribute(To,n.join(","))},dl=(e,t)=>{const{baseTag:i,bodyAttributes:a,htmlAttributes:s,linkTags:r,metaTags:n,noscriptTags:o,onChangeClientState:l,scriptTags:c,styleTags:d,title:u,titleAttributes:h}=e;cl("body",a),cl("html",s),((e,t)=>{void 0!==e&&document.title!==e&&(document.title=Vo(e)),cl("title",t)})(u,h);const m={baseTag:ll("base",i),linkTags:ll("link",r),metaTags:ll("meta",n),noscriptTags:ll("noscript",o),scriptTags:ll("script",c),styleTags:ll("style",d)},p={},f={};Object.keys(m).forEach(e=>{const{newTags:t,oldTags:i}=m[e];t.length&&(p[e]=t),i.length&&(f[e]=m[e].oldTags)}),t&&t(),l(e,p,f)},ul=null,hl=e=>{ul&&cancelAnimationFrame(ul),e.defer?ul=requestAnimationFrame(()=>{dl(e,()=>{ul=null})}):(dl(e),ul=null)},ml=class extends We.Component{constructor(){super(...arguments),Y(this,"rendered",!1)}shouldComponentUpdate(e){return!_o(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:t}=this.props.context;let i=null;const a=(s=e.get().map(e=>{const t={...e.props};return delete t.context,t}),{baseTag:Wo(["href"],s),bodyAttributes:$o("bodyAttributes",s),defer:Bo(s,Lo),encode:Bo(s,Fo),htmlAttributes:$o("htmlAttributes",s),linkTags:Ho("link",["rel","href"],s),metaTags:Ho("meta",["name","charset","http-equiv","property","itemprop"],s),noscriptTags:Ho("noscript",["innerHTML"],s),onChangeClientState:qo(s),scriptTags:Ho("script",["src","innerHTML"],s),styleTags:Ho("style",["cssText"],s),title:Uo(s),titleAttributes:$o("titleAttributes",s),prioritizeSeoTags:Zo(s,Ro)});var s;ol.canUseDOM?hl(a):il&&(i=il(a)),t(i)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}},pl=(Z=class extends We.Component{shouldComponentUpdate(e){return!No(Yo(this.props,"helmetData"),Yo(e,"helmetData"))}mapNestedChildrenToProps(e,t){if(!t)return null;switch(e.type){case"script":case"noscript":return{innerHTML:t};case"style":return{cssText:t};default:throw new Error(`<${e.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(e,t,i,a){return{...t,[e.type]:[...t[e.type]||[],{...i,...this.mapNestedChildrenToProps(e,a)}]}}mapObjectTypeChildren(e,t,i,a){switch(e.type){case"title":return{...t,[e.type]:a,titleAttributes:{...i}};case"body":return{...t,bodyAttributes:{...i}};case"html":return{...t,htmlAttributes:{...i}};default:return{...t,[e.type]:{...i}}}}mapArrayTypeChildrenToProps(e,t){let i={...t};return Object.keys(e).forEach(t=>{i={...i,[t]:e[t]}}),i}warnOnInvalidChildren(e,t){return So(Eo.some(t=>e.type===t),"function"==typeof e.type?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${Eo.join(", ")} are allowed. Helmet does not support rendering <${e.type}> elements. Refer to our API for more information.`),So(!t||"string"==typeof t||Array.isArray(t)&&!t.some(e=>"string"!=typeof e),`Helmet expects a string as a child of <${e.type}>. Did you forget to wrap your children in braces? ( <${e.type}>{\`\`}</${e.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(e,t){let i={};return Ze.Children.forEach(e,e=>{if(!e||!e.props)return;const{children:a,...s}=e.props,r=Object.keys(s).reduce((e,t)=>(e[Po[t]||t]=s[t],e),{});let{type:n}=e;switch("symbol"==typeof n?n=n.toString():this.warnOnInvalidChildren(e,a),n){case"Symbol(react.fragment)":t=this.mapChildrenToProps(a,t);break;case"link":case"meta":case"noscript":case"script":case"style":i=this.flattenArrayTypeChildren(e,i,r,a);break;default:t=this.mapObjectTypeChildren(e,t,r,a)}}),this.mapArrayTypeChildrenToProps(i,t)}render(){const{children:e,...t}=this.props;let i={...t},{helmetData:a}=t;if(e&&(i=this.mapChildrenToProps(e,i)),a&&!(a instanceof rl)){a=new rl(a.context,!0),delete i.helmetData}return a?Ze.createElement(ml,{...i,context:a.value}):Ze.createElement(nl.Consumer,null,e=>Ze.createElement(ml,{...i,context:e}))}},Y(Z,"defaultProps",{defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1}),Z);const fl=({children:e})=>se.jsx(ol,{children:e}),gl=()=>se.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-foreground focus:rounded-md focus:shadow-lg",tabIndex:0,children:"Vai al contenuto principale"}),xl=()=>{const[e,t]=We.useState(navigator.onLine),[i,a]=We.useState(!1);return We.useEffect(()=>{const e=()=>{t(!0),a(!0),setTimeout(()=>a(!1),3e3)},i=()=>{t(!1),a(!0)};return window.addEventListener("online",e),window.addEventListener("offline",i),navigator.onLine||a(!0),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",i)}},[]),se.jsx(tt,{children:i&&se.jsx(et.div,{initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 "+(e?"bg-green-600 text-white":"bg-red-600 text-white"),role:"alert","aria-live":"polite",children:e?se.jsxs(se.Fragment,{children:[se.jsx(Ur,{size:16}),se.jsx("span",{children:"Connesso"})]}):se.jsxs(se.Fragment,{children:[se.jsx(Br,{size:16}),se.jsx("span",{children:"Nessuna connessione"})]})})})},bl=()=>{const e=We.useContext(Zr);if(void 0===e)throw new Error("useUnifiedAuth deve essere usato all'interno di un AuthProvider");return e.isAuthenticated,e.isLoading,e.getCurrentUser(),e.session,e};async function vl(e,t){const{data:i,error:a}=await e.from("subscriptions").select("id,tier,status,created_at").eq("user_id",t).eq("status","active").order("created_at",{ascending:!1}).limit(1).maybeSingle();return a?(console.warn("[subs] getActiveSubscription error",a),{hasActive:!1,plan:null}):{hasActive:!!i,plan:i?.tier??null}}const yl=()=>{const[e,t]=Ai(),i="undefined"!=typeof window&&("capacitor:"===window.location.protocol||!!window.Capacitor),a=We.useCallback((e,a)=>{t(e,{replace:a?.replace}),i&&setTimeout(()=>{window.scrollTo(0,0)},100)},[e,t,i]),s=We.useCallback(()=>{"undefined"!=typeof window&&window.history.length>1?window.history.back():t("/home")},[t]),r=We.useCallback(()=>a("/home"),[a]),n=We.useCallback(()=>a("/map"),[a]),o=We.useCallback(()=>a("/buzz"),[a]),l=We.useCallback(()=>a("/intelligence"),[a]),c=We.useCallback(()=>a("/notifications"),[a]),d=We.useCallback(()=>a("/leaderboard"),[a]),u=We.useCallback(()=>a("/profile"),[a]),h=We.useCallback(()=>a("/settings"),[a]),m=We.useCallback(()=>a("/subscriptions"),[a]),p=We.useCallback(()=>a("/login"),[a]),f=We.useCallback(()=>a("/register"),[a]);return{navigate:a,goBack:s,toHome:r,toMap:n,toBuzz:o,toIntelligence:l,toNotifications:c,toLeaderboard:d,toProfile:u,toSettings:h,toSubscriptions:m,toLogin:p,toRegister:f,currentPath:e,isCapacitor:i}},wl={v:"5.7.1",fr:30,ip:0,op:90,w:400,h:400,nm:"M1SSION Logo Animation",ddd:0,assets:[],layers:[{ddd:0,ind:1,ty:4,nm:"Logo Text",sr:1,ks:{o:{a:1,k:[{i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]},t:0,s:[100]},{t:45,s:[60]},{t:90,s:[100]}]},p:{a:0,k:[200,200,0]},a:{a:0,k:[0,0,0]},s:{a:0,k:[100,100,100]}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[],o:[],v:[[-100,-20],[-80,-20],[-60,20],[-40,-20],[-20,20],[0,-20],[20,-20],[20,20],[40,20],[40,-20],[60,-20],[60,20],[80,20],[100,-20]],c:!1}},nm:"M1SSION Path"},{ty:"st",c:{a:1,k:[{t:0,s:[0,.64,1,1],i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]}},{t:30,s:[.36,.22,.98,1],i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]}},{t:60,s:[.95,.28,.75,1],i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]}},{t:90,s:[0,.64,1,1]}]},o:{a:0,k:100},w:{a:0,k:8},lc:2,lj:2},{ty:"gf",o:{a:0,k:60},r:1,g:{p:3,k:{a:0,k:[0,0,.64,1,.5,.36,.22,.98,1,.95,.28,.75]}},s:{a:0,k:[-100,0]},e:{a:0,k:[100,0]}}],nm:"M1SSION"}],ef:[{ty:29,nm:"Glow",ix:1,en:1,ef:[{ty:7,nm:"Glow Based On",ix:1,v:{a:0,k:2}},{ty:0,nm:"Glow Threshold",ix:2,v:{a:0,k:128}},{ty:0,nm:"Glow Radius",ix:3,v:{a:1,k:[{t:0,s:[10],i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]}},{t:45,s:[15]},{t:90,s:[10]}]}},{ty:0,nm:"Glow Intensity",ix:4,v:{a:0,k:1}},{ty:2,nm:"Glow Color",ix:5,v:{a:1,k:[{t:0,s:[0,.64,1,1],i:{x:[.833],y:[.833]},o:{x:[.167],y:[.167]}},{t:45,s:[.36,.22,.98,1]},{t:90,s:[0,.64,1,1]}]}}]}]}]},Nl=()=>{const e={animationData:wl,loop:!0,autoplay:!0,rendererSettings:{preserveAspectRatio:"xMidYMid meet",className:"lottie-svg-class"}},{View:t}=it(e);return se.jsxs("div",{className:"relative w-32 h-10 flex items-center justify-center",children:[t,se.jsxs("h1",{className:"absolute text-2xl font-bold select-none drop-shadow-[0_1.5px_12px_rgba(0,229,255,0.51)] whitespace-nowrap",children:[se.jsx("span",{className:"text-[#00E5FF] font-extrabold",children:"M1"}),se.jsx("span",{className:"text-white font-extrabold",children:"SSION"})]})]})},jl=We.forwardRef(({className:e,...t},i)=>se.jsx("label",{ref:i,className:eo("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...t}));jl.displayName="Label";const Sl=We.forwardRef(({className:e,type:t,...i},a)=>se.jsx("input",{type:t,className:eo("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...i}));Sl.displayName="Input";const _l=({id:e,type:t,label:i,placeholder:a="",value:s,onChange:r,icon:n,error:o,required:l=!1,disabled:c=!1,autoComplete:d="off"})=>se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:e,className:"text-white",children:i}),se.jsxs("div",{className:"relative",children:[n&&se.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/50",children:n}),se.jsx(Sl,{id:e,type:t,placeholder:a,value:s,onChange:r,className:"bg-black/50 border-white/10 text-white "+(n?"pl-10":"pl-3"),required:l,disabled:c,autoComplete:d,autoCorrect:"off",spellCheck:!1,"data-form-type":"other"})]}),o&&se.jsx("p",{className:"text-red-500 text-xs mt-1",children:o})]});function kl({verificationStatus:e}){const[t,i]=We.useState(""),[a,s]=We.useState(""),[r,n]=We.useState(!1),[o,l]=We.useState(!1),{navigate:c}=yl(),{login:d}=sn();return se.jsxs("form",{onSubmit:async e=>{e.preventDefault();const i=t.toLowerCase().trim().replace(/[^\w@.-]/g,"");const s=a.trim();if(i&&s)if(/\S+@\S+\.\S+/.test(i)){l(!0);try{0;const e=await d(i,s);if(!e.success)return console.error(" LOGIN ERROR via DIRECT AuthContext:",e.error),void Ki.error("Errore di login",{description:e.error?.message||"Credenziali non valide"});Ki.success("Login effettuato con successo",{description:"Benvenuto in M1SSION!"}),window.dispatchEvent(new CustomEvent("auth-success",{detail:{email:t,timestamp:Date.now()}}));const a=new URLSearchParams(window.location.search);let r=a.get("redirect")||"";if(!r)try{r=localStorage.getItem("post_login_redirect")||"",r&&localStorage.removeItem("post_login_redirect")}catch{}const n=r||"/mission-intro";r||sessionStorage.removeItem("hasSeenPostLoginIntro"),c(n),(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone)&&setTimeout(()=>{"/login"===window.location.pathname&&(window.location.href=n)},800)}catch(r){console.error(" LOGIN EXCEPTION:",r),Ki.error("Errore di sistema",{description:r.message||"Si  verificato un errore imprevisto"})}finally{l(!1)}}else Ki.error("Formato email non valido");else Ki.error("Tutti i campi sono obbligatori")},className:"space-y-4",children:[se.jsx(_l,{id:"email",label:"Email",type:"email",placeholder:"Inserisci la tua email",value:t,onChange:e=>i(e.target.value),icon:se.jsx(Gs,{className:"h-4 w-4"}),required:!0,disabled:o,autoComplete:"email"}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(_l,{id:"password",label:"Password",type:r?"text":"password",placeholder:"Inserisci la password",value:a,onChange:e=>s(e.target.value),icon:se.jsx(Zs,{className:"h-4 w-4"}),required:!0,disabled:o,autoComplete:"current-password"}),se.jsxs("button",{type:"button",className:"flex items-center gap-2 text-sm text-white/70 hover:text-white transition-colors",onClick:()=>n(!r),children:[r?se.jsx(Es,{className:"h-4 w-4"}):se.jsx(Is,{className:"h-4 w-4"}),r?"Nascondi password":"Mostra password"]})]}),se.jsxs("div",{className:"space-y-3",children:[se.jsx(mo,{type:"submit",className:"w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 font-bold text-lg py-3 rounded-xl neon-button-cyan",disabled:o,children:o?"Caricamento...":"Accedi"}),se.jsx(mo,{type:"button",onClick:()=>c("/register"),className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 font-bold text-lg py-3 rounded-xl transition-all duration-300",disabled:o,children:"Registrati - Accesso limitato"})]})]})}const Cl=({count:e=15})=>{const[t,i]=We.useState([]);return We.useEffect(()=>{const t=Array.from({length:e},(e,t)=>({id:t,size:4*Math.random()+2,top:100*Math.random(),left:100*Math.random(),delay:5*Math.random(),duration:15*Math.random()+10,color:t%3==0?"#00E5FF":t%3==1?"#FFC300":"#FF00FF",parallaxSpeed:.3*Math.random()+.1,blur:2*Math.random()+1}));i(t)},[e]),se.jsx("div",{className:"fixed inset-0 z-0 pointer-events-none overflow-hidden",children:t.map(e=>se.jsx(et.div,{className:"absolute rounded-full",style:{width:`${e.size}px`,height:`${e.size}px`,backgroundColor:e.color,boxShadow:`0 0 ${e.size+4}px ${e.color}`,filter:`blur(${e.blur}px)`,top:`${e.top}%`,left:`${e.left}%`},animate:{y:[0,-30,0,30,0],x:[0,15,30,15,0],opacity:[.4,.8,.6,.9,.4]},transition:{duration:e.duration,ease:"easeInOut",times:[0,.2,.5,.8,1],repeat:1/0,delay:e.delay},"data-parallax":"background","data-parallax-speed":-e.parallaxSpeed},e.id))})},Al=({onClose:e})=>{const[t,i]=We.useState(!1),{login:a}=bl();yl(),We.useEffect(()=>{const t=t=>{"Escape"===t.key&&e&&e()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[e]);return se.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",children:se.jsxs("div",{className:"bg-red-900 border border-red-500 rounded-lg p-6 max-w-md relative",children:[e&&se.jsx("button",{onClick:e,className:"absolute top-2 right-2 text-red-300 hover:text-white text-2xl",children:""}),se.jsx("h2",{className:"text-white text-xl font-bold mb-4",children:" EMERGENCY ADMIN ACCESS"}),se.jsx("p",{className:"text-red-200 mb-4",children:"Sistema di bypass d'emergenza per accesso sviluppatore immediato"}),se.jsx("button",{onClick:async()=>{i(!0);try{const e=await a("wikus77@hotmail.it","Wikus@190877");e.success?(localStorage.setItem("emergency_admin_access","true"),window.location.href="/push-test?emergency=admin"):(console.error(" EMERGENCY LOGIN FAILED:",e.error),alert("Emergency login failed: "+(e.error?.message||"Unknown error")))}catch(e){console.error(" EMERGENCY LOGIN EXCEPTION:",e),alert("Emergency login exception: "+e)}finally{i(!1)}},disabled:t,className:"w-full bg-red-600 hover:bg-red-700 disabled:bg-red-800 text-white font-bold py-2 px-4 rounded transition-colors mb-4",children:t?" Accesso in corso...":" ACCESSO EMERGENCY"}),se.jsx("p",{className:"text-red-300 text-xs",children:"wikus77@hotmail.it / Wikus@190877"}),se.jsx("p",{className:"text-red-400 text-xs mt-2",children:"Premi ESC per chiudere"})]})})},zl="post_login_redirect";function El(e){const t=function(){try{const e=localStorage.getItem(zl);return e&&localStorage.removeItem(zl),e}catch{return null}}()||"/home";try{e(t)}catch{window.location.href=t}}const Il=()=>{const[e,t]=We.useState(null),[i,a]=We.useState(!1),{navigate:s}=yl(),{isAuthenticated:r,isLoading:n}=bl(),o=new URLSearchParams(window.location.search),l=We.useRef(!1),c=We.useRef(null);return We.useEffect(()=>{!r||n||l.current||(l.current=!0,El(s))},[r,n]),We.useEffect(()=>{if(r&&!n&&"/login"===window.location.pathname)return c.current=setTimeout(()=>{"/login"===window.location.pathname&&r&&El(s)},2e3),()=>{c.current&&(clearTimeout(c.current),c.current=null)}},[r,n]),We.useEffect(()=>{const e=o.get("verification");"pending"===e?t("pending"):"success"===e&&(t("success"),Ki.success("Email verificata",{description:"La tua email  stata verificata con successo."}))},[s]),se.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-black px-4 py-12 relative overflow-hidden",children:[se.jsx(Cl,{count:15}),se.jsxs(et.div,{className:"w-full max-w-md z-10",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[se.jsxs("div",{className:"text-center mb-8",children:[se.jsx("div",{className:"flex justify-center mb-4",children:se.jsx(Nl,{})}),se.jsx("h2",{className:"text-2xl font-bold text-white mb-1 neon-text-cyan",children:"M1SSION"}),se.jsx("p",{className:"text-gray-400",children:"Accedi per iniziare la tua missione"})]}),se.jsxs("div",{className:"glass-card p-6 backdrop-blur-md border border-gray-800 rounded-xl",children:[se.jsx(kl,{verificationStatus:e}),se.jsxs("div",{className:"mt-6 text-center space-y-3",children:[se.jsxs("p",{className:"text-sm text-white/70",children:["Non hai un account?"," ",se.jsx(Ti,{to:"/register",className:"text-cyan-400 hover:text-cyan-300 transition-colors",children:"Registrati"})]}),se.jsx("p",{className:"text-sm text-white/50",children:se.jsx(Ti,{to:"/",className:"text-cyan-400 hover:text-cyan-300 transition-colors",children:" Torna alla homepage"})})]})]})]}),i&&se.jsx(Al,{onClose:()=>a(!1)})]})},Pl=({subscriptionPlan:e,accessStartDate:t,timeUntilAccess:i})=>{const{navigate:a}=yl(),{getCurrentUser:s}=bl(),[r,n]=We.useState("Free");We.useEffect(()=>{!async function(){const e=s();if(e?.id){const{data:t}=await ba.auth.getUser();if("wikus77@hotmail.it"===t.user?.email)return null;const i=(await vl(ba,e.id)).plan||"free";if(n(i),"free"===i&&"/choose-plan"!==window.location.pathname)a("/home",{replace:!0})}}()},[s,a]);return se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-black px-4 py-12",children:se.jsxs(et.div,{className:"w-full max-w-md text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[se.jsx(et.div,{className:"mx-auto mb-6 w-20 h-20 bg-yellow-500/20 rounded-full flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},children:se.jsx(vr,{className:"w-10 h-10 text-yellow-400"})}),se.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:" Accesso non ancora disponibile"}),se.jsxs("p",{className:"text-gray-300 mb-6",children:["L'accesso alla missione non  ancora disponibile per il tuo piano ",se.jsx("span",{className:"font-semibold text-cyan-400",children:(e=>{switch(e.toUpperCase()){case"SILVER":return"Silver";case"GOLD":return"Gold";case"BLACK":return"Black";case"TITANIUM":return"Titanium";default:return"Free"}})(r)}),"."]}),i&&i>0&&t&&se.jsxs(et.div,{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4 mb-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:[se.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[se.jsx(bs,{className:"w-5 h-5 text-cyan-400"}),se.jsx("span",{className:"text-cyan-400 font-semibold",children:"Accesso disponibile tra:"})]}),se.jsx("p",{className:"text-xl font-mono text-white",children:(e=>{const t=Math.floor(e/864e5),i=Math.floor(e%864e5/36e5),a=Math.floor(e%36e5/6e4);return t>0?`${t} giorni, ${i} ore`:i>0?`${i} ore, ${a} minuti`:`${a} minuti`})(i)}),se.jsxs("p",{className:"text-sm text-gray-400 mt-2",children:["Data di sblocco: ",t.toLocaleDateString("it-IT",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),se.jsxs(et.div,{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},children:[se.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[se.jsx(jr,{className:"w-5 h-5 text-blue-400"}),se.jsx("span",{className:"text-blue-400 font-semibold",children:"Ti avviseremo!"})]}),se.jsx("p",{className:"text-sm text-blue-300",children:"Riceverai una notifica push e una email quando potrai iniziare la tua missione."})]}),se.jsxs("div",{className:"space-y-3",children:[("base"===r.toLowerCase()||"free"===r.toLowerCase())&&se.jsx(mo,{onClick:()=>{a("/choose-plan?from=access-blocked&current_plan="+encodeURIComponent(r))},className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105",children:" Aggiorna il tuo piano per accesso anticipato"}),se.jsx(mo,{type:"button",variant:"outline",onClick:()=>a("/home",{replace:!0}),className:"w-full border-gray-600 text-gray-300 hover:bg-gray-800 pointer-events-auto z-10",style:{pointerEvents:"auto"},children:" Torna alla homepage"})]})]})})},Tl=({children:e})=>{const{isAuthenticated:t,isLoading:i,getCurrentUser:a}=bl(),{canAccess:s,isLoading:r,subscriptionPlan:n,accessStartDate:o,timeUntilAccess:l}=(()=>{const{isAuthenticated:e,getCurrentUser:t}=bl(),[i,a]=We.useState({canAccess:!1,isLoading:!0,accessStartDate:null,subscriptionPlan:"",status:"registered_pending",timeUntilAccess:null});return We.useEffect(()=>{const i=t();"wikus77@hotmail.it"!==i?.email?e?(async()=>{try{const e=t();if(!e)return;const{data:i,error:s}=await ba.from("profiles").select("role, access_enabled, access_start_date, subscription_plan, status").eq("id",e.id).single();if(s)return void console.error("Error fetching profile:",s);if("admin"===i?.role)return void a({canAccess:!0,isLoading:!1,accessStartDate:new Date,subscriptionPlan:"ADMIN",status:"admin_access",timeUntilAccess:null});const r=i.subscription_plan||"",n=r.toLowerCase();if(!r||n.includes("free")||n.includes("base"))return void a({canAccess:!0,isLoading:!1,accessStartDate:new Date,subscriptionPlan:r||"free",status:"free_access_enabled",timeUntilAccess:null});const o=await vl(ba,e.id);if("free"===o?.plan?.toLowerCase())return void a({canAccess:!0,isLoading:!1,accessStartDate:new Date,subscriptionPlan:"free",status:"free_access_enabled_subscriptions",timeUntilAccess:null});const{data:l,error:c}=await ba.rpc("can_user_access_mission",{user_id:e.id});if(c)return void console.error("Error checking access:",c);const d=i.access_start_date?new Date(i.access_start_date):null,u=new Date,h=d?Math.max(0,d.getTime()-u.getTime()):null;a({canAccess:!!l,isLoading:!1,accessStartDate:d,subscriptionPlan:i.subscription_plan||"",status:i.status||"registered_pending",timeUntilAccess:h})}catch(e){console.error("Access control error:",e),a(e=>({...e,isLoading:!1}))}})():a(e=>({...e,isLoading:!1,canAccess:!1})):a({canAccess:!0,isLoading:!1,accessStartDate:new Date,subscriptionPlan:"ADMIN",status:"admin_emergency_access",timeUntilAccess:null})},[e,t]),i})(),[c,d]=Ai(),u=a(),h="wikus77@hotmail.it"===u?.email;return Ze.useEffect(()=>{if(!i&&!r){if(h)return;t||"/login"===c?!t||n&&""!==n||"/choose-plan"===c||"ADMIN"===n||d("/choose-plan"):d("/login")}},[t,i,r,n,c,d,h]),Ze.useEffect(()=>{t||i||sessionStorage.removeItem("hasSeenPostLoginIntro")},[t,i]),h?se.jsx(se.Fragment,{children:e}):!t||i||r?i||r||t?se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-black",children:se.jsx("div",{className:"text-white",children:"Verifica accesso..."})}):se.jsx(Il,{}):s?se.jsx(se.Fragment,{children:e}):se.jsx(Pl,{subscriptionPlan:n,accessStartDate:o,timeUntilAccess:l})},Ml=(e,t)=>e,Ll=()=>"undefined"!=typeof window&&(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.referrer.includes("android-app://")),Fl=({children:e,visible:t=!1,opacity:i=.3})=>{if(!new URLSearchParams(window.location.search).get("diag"))return se.jsx(se.Fragment,{children:e});const[a,s]=We.useState({top:0,bottom:0,left:0,right:0}),[r,n]=We.useState(!1);return We.useEffect(()=>{const e=()=>{const e=(()=>{if("undefined"==typeof window)return{top:0,bottom:0,left:0,right:0};const e=e=>{const t=getComputedStyle(document.documentElement).getPropertyValue(`--safe-area-inset-${e}`).trim();return t&&t!==`env(safe-area-inset-${e})`&&parseInt(t.replace("px",""))||0};return{top:e("top"),bottom:e("bottom"),left:e("left"),right:e("right")}})();s(e),n(Ll())};e();const t=()=>{setTimeout(e,100)};return window.addEventListener("orientationchange",t),window.addEventListener("resize",e),()=>{window.removeEventListener("orientationchange",t),window.removeEventListener("resize",e)}},[]),t&&r?se.jsxs(se.Fragment,{children:[e,se.jsxs("div",{className:"fixed inset-0 pointer-events-none z-[9998]",children:[a.top>0&&se.jsx("div",{className:"absolute top-0 left-0 right-0 bg-red-500 flex items-center justify-center",style:{height:`${a.top}px`,opacity:i},children:se.jsxs("span",{className:"text-white text-xs font-mono",children:["TOP SAFE AREA (",a.top,"px)"]})}),a.bottom>0&&se.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-blue-500 flex items-center justify-center",style:{height:`${a.bottom}px`,opacity:i},children:se.jsxs("span",{className:"text-white text-xs font-mono",children:["BOTTOM SAFE AREA (",a.bottom,"px)"]})}),a.left>0&&se.jsx("div",{className:"absolute top-0 bottom-0 left-0 bg-green-500 flex items-center justify-center",style:{width:`${a.left}px`,opacity:i,writingMode:"vertical-rl",textOrientation:"mixed"},children:se.jsxs("span",{className:"text-white text-xs font-mono",children:["LEFT (",a.left,"px)"]})}),a.right>0&&se.jsx("div",{className:"absolute top-0 bottom-0 right-0 bg-yellow-500 flex items-center justify-center",style:{width:`${a.right}px`,opacity:i,writingMode:"vertical-lr",textOrientation:"mixed"},children:se.jsxs("span",{className:"text-white text-xs font-mono",children:["RIGHT (",a.right,"px)"]})}),se.jsxs("div",{className:"absolute top-16 left-4 bg-black bg-opacity-80 text-white p-2 rounded text-xs font-mono",children:[se.jsxs("div",{children:["Platform: ",r?"Capacitor":"Web"]}),se.jsxs("div",{children:["Orientation: ",window.innerWidth>window.innerHeight?"Landscape":"Portrait"]}),se.jsxs("div",{children:["Viewport: ",window.innerWidth,"",window.innerHeight]}),se.jsxs("div",{children:["Safe Area: T",a.top," B",a.bottom," L",a.left," R",a.right]})]})]})]}):se.jsx(se.Fragment,{children:e})},Ol=()=>{if("undefined"==typeof window)return{top:0,bottom:0,left:0,right:0};const e=e=>{const t=getComputedStyle(document.documentElement).getPropertyValue(`--safe-area-inset-${e}`).trim();return t&&t!==`env(safe-area-inset-${e})`&&parseInt(t.replace("px",""))||0};return{top:e("top"),bottom:e("bottom"),left:e("left"),right:e("right")}},Dl=()=>{if("undefined"==typeof window)return;let e=0;document.addEventListener("touchend",t=>{const i=(new Date).getTime();i-e<=300&&t.preventDefault(),e=i},!1),document.body.style.overscrollBehavior="none",document.body.style.touchAction="manipulation"},Rl=Object.freeze(Object.defineProperty({__proto__:null,getPWASafeAreaInsets:Ol,initializePWA:async()=>{try{Dl();const e=document.querySelector('meta[name="viewport"]');return e&&e.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"),!0}catch(e){return console.error(" PWA initialization error:",e),!1}},optimizePWATouchGestures:Dl},Symbol.toStringTag,{value:"Module"})),Bl=({children:e,className:t="",top:i=!0,bottom:a=!0,left:s=!0,right:r=!0,debug:n=!1})=>{const[o,l]=We.useState({top:0,bottom:0,left:0,right:0}),[c,d]=We.useState(!1);We.useEffect(()=>{const e=()=>{const e=Ol();l(e),d(window.matchMedia("(display-mode: standalone)").matches)};e();const t=()=>{setTimeout(e,100)};return window.addEventListener("orientationchange",t),window.addEventListener("resize",e),()=>{window.removeEventListener("orientationchange",t),window.removeEventListener("resize",e)}},[n]);const u=c?{paddingTop:i?`${o.top}px`:void 0,paddingBottom:a?`${o.bottom}px`:void 0,paddingLeft:s?`${o.left}px`:void 0,paddingRight:r?`${o.right}px`:void 0}:{};return se.jsxs("div",{className:`safe-area-wrapper ${t}`,style:u,children:[n&&c&&se.jsxs("div",{className:"fixed top-0 left-0 z-[10000] bg-red-500 text-white text-xs p-2",children:["Safe Area: T:",o.top," B:",o.bottom," L:",o.left," R:",o.right]}),e]})},Ul=()=>{const[e,t]=We.useState(!1);return{showNotifications:e,setShowNotifications:t}};function ql(){const{showNotifications:e,setShowNotifications:t}=Ul(),{notifications:i,unreadCount:a,markAllAsRead:s,markAsRead:r,addNotification:n,deleteNotification:o,reloadNotifications:l}=Fa(),[c,d]=We.useState(!1),u=We.useRef(null),h=We.useRef(!1);We.useEffect(()=>(h.current||l().then(()=>{h.current=!0,u.current&&clearInterval(u.current),u.current=window.setInterval(()=>{"visible"===document.visibilityState&&l()},5e3)}),()=>{u.current&&clearInterval(u.current)}),[l]);const m=We.useCallback(()=>{d(!0)},[]),p=We.useCallback(()=>{d(!1)},[]),f=We.useCallback(()=>{t(!0),l()},[t,l]),g=We.useCallback(()=>{t(!1),s().then(()=>{})},[t,s]),x=We.useCallback(async(e,t,i=La)=>{Ki(e,{description:t});try{const a=await n({title:e,description:t,type:i});return a?setTimeout(()=>{l()},500):console.error(" NOTIFICATION_MANAGER: Failed to create notification"),a}catch(a){return console.error(" NOTIFICATION_MANAGER: Error creating notification:",a),!1}},[n,l]),b=We.useCallback(async(e,t)=>await x(e,t,Pa),[x]),v=We.useCallback(async(e,t)=>await x(e,t,Ta),[x]),y=We.useCallback(async(e,t)=>await x(e,t,Ia),[x]),w=We.useCallback(async(e,t)=>await x(e,t,Ma),[x]),N=We.useCallback(async()=>await l(),[l]);return{notifications:i,unreadCount:a,notificationsBannerOpen:c,openNotificationsBanner:m,closeNotificationsBanner:p,notificationsDrawerOpen:e,openNotificationsDrawer:f,closeNotificationsDrawer:g,markAllAsRead:s,markAsRead:r,deleteNotification:o,createNotification:x,createBuzzNotification:b,createMapBuzzNotification:v,createLeaderboardNotification:y,createWeeklyNotification:w,reloadNotifications:N}}const $l=()=>{const e=(()=>{const[e,t]=We.useState(null),[i,a]=We.useState(null),[s,r]=We.useState(!0),n=async()=>{a(null),t(null),localStorage.removeItem("sb-undefined-auth-token");try{await ba.auth.signOut()}catch(e){}};return We.useEffect(()=>{(async()=>{try{const{data:{session:i},error:s}=await ba.auth.getSession();if(!s&&i&&i.user)return i.user.email,a(i),t(i.user),void r(!1);const n=localStorage.getItem("sb-undefined-auth-token");if(n)try{const e=JSON.parse(n);e.user,e.source,e.version,e.access_token,e.user;const i=Math.floor(Date.now()/1e3),s=e.expires_at&&e.expires_at<=i;e.expires_at,e.expires_at&&e.expires_at,!s&&e.user&&e.access_token?(a(e),t(e.user),e.access_token&&e.refresh_token&&setTimeout(()=>{ba.auth.setSession({access_token:e.access_token,refresh_token:e.refresh_token}).then(e=>{e.error,e.error}).catch(e=>console.log("Background session refresh failed:",e))},1e3)):localStorage.removeItem("sb-undefined-auth-token")}catch(e){console.error(" PARSE STORED SESSION ERROR:",e),localStorage.removeItem("sb-undefined-auth-token")}}catch(i){console.error(" SESSION INIT ERROR:",i)}finally{r(!1)}})();const{data:{subscription:e}}=ba.auth.onAuthStateChange(async(e,i)=>{if((new Date).toISOString(),i&&i.user){a(i),t(i.user);const s={...i,created_at:Date.now(),source:"auth_state_change_enhanced",version:"2.0",event_type:e};localStorage.setItem("sb-undefined-auth-token",JSON.stringify(s))}else"SIGNED_OUT"===e&&await n()});return()=>e.unsubscribe()},[]),{user:e,session:i,isAuthenticated:!!i&&!!e,isLoading:s,forceSessionFromTokens:async(e,i)=>{e?.split(".").length;try{if(i&&e){const s=await ba.auth.setSession({access_token:e,refresh_token:i});if(s.error,s.data,s.data,s.data,s.error,!s.error&&s.data?.session){a(s.data.session),t(s.data.session.user);const r={access_token:e,refresh_token:i,expires_at:s.data.session.expires_at,user:s.data.session.user,created_at:Date.now(),source:"enhanced_developer_auto_login",version:"2.0"};return localStorage.setItem("sb-undefined-auth-token",JSON.stringify(r)),!0}s.error}try{const r=e.split(".");let n={};if(3===r.length)try{const e=r[1].replace(/-/g,"+").replace(/_/g,"/"),t=e.length%4,i=e+"=".repeat(t?4-t:0);n=JSON.parse(atob(i)),n.sub,n.email,n.exp,n.iat}catch(s){}const o={access_token:e,refresh_token:i||`enhanced_refresh_${Date.now()}`,expires_in:3600,expires_at:n.exp||Math.floor(Date.now()/1e3)+3600,token_type:"bearer",user:{id:n.sub||`enhanced_user_${Date.now()}`,email:n.email||"wikus77@hotmail.it",email_confirmed_at:n.email_confirmed_at||(new Date).toISOString(),confirmed_at:n.confirmed_at||(new Date).toISOString(),last_sign_in_at:(new Date).toISOString(),app_metadata:{provider:"enhanced_developer_login",providers:["enhanced_developer_login"],...n.app_metadata},user_metadata:{enhanced_auto_login:!0,login_method:"developer_session_force",...n.user_metadata},aud:n.aud||"authenticated",created_at:n.created_at||(new Date).toISOString(),updated_at:(new Date).toISOString(),role:n.role||"authenticated"}};o.user.email,a(o),t(o.user);const l={...o,created_at:Date.now(),source:"manual_construction_enhanced",version:"2.0",diagnostics:{tokenLength:e.length,hasRefreshToken:!!i,jwtDecoded:3===r.length,timestamp:(new Date).toISOString()}};return localStorage.setItem("sb-undefined-auth-token",JSON.stringify(l)),!0}catch(r){return console.error(" Enhanced manual session construction failed:",r),!1}}catch(n){return console.error(" FORCE SESSION CRITICAL ERROR:",n),!1}},clearSession:n}})();return{user:e.user,session:e.session,isAuthenticated:e.isAuthenticated,isLoading:e.isLoading,isEmailVerified:!!e.user?.email_confirmed_at,login:async(t,i)=>{try{const{data:a,error:s}=await ba.auth.signInWithPassword({email:t,password:i});return s?(console.error(" LOGIN FAILED:",s.message),{success:!1,error:s}):a.session?(await e.forceSessionFromTokens(a.session.access_token,a.session.refresh_token),{success:!0,session:a.session}):(console.error(" LOGIN FAILED - no session created"),{success:!1,error:{message:"No session created"}})}catch(a){return console.error(" LOGIN EXCEPTION:",a),{success:!1,error:a}}},register:async(e,t)=>{try{const{data:i,error:a}=await ba.auth.signUp({email:e,password:t,options:{emailRedirectTo:`${window.location.origin}/`}});return a?(console.error(" REGISTRATION FAILED:",a.message),{success:!1,error:a}):{success:!0,data:i}}catch(i){return console.error(" REGISTRATION EXCEPTION:",i),{success:!1,error:i}}},logout:async()=>{const t="m1_quiz_last_skip",i=localStorage.getItem(t);localStorage.clear(),sessionStorage.clear(),i&&localStorage.setItem(t,i);try{const e=await ae(()=>import("./mapStore.JLa_QD65.js"),__vite__mapDeps([0,1,2,3])).catch(()=>null);if(e?.useMapStore){const t=e.useMapStore.getState();t.resetMapState?.()}}catch(a){}await ba.auth.signOut(),await e.clearSession()},resetPassword:async e=>{try{const{error:t}=await ba.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/auth/reset`});return t?(console.error(" PASSWORD RESET FAILED:",t.message),{success:!1,error:t.message}):{success:!0}}catch(t){return console.error(" PASSWORD RESET EXCEPTION:",t),{success:!1,error:t.message}}},resendVerificationEmail:async e=>{try{const{error:t}=await ba.auth.resend({type:"signup",email:e,options:{emailRedirectTo:`${window.location.origin}/`}});return t?(console.error(" RESEND VERIFICATION FAILED:",t.message),{success:!1,error:t.message}):{success:!0}}catch(t){return console.error(" RESEND VERIFICATION EXCEPTION:",t),{success:!1,error:t.message}}},updateProfile:async e=>{},getCurrentUser:()=>e.user,getAccessToken:()=>e.session?.access_token||""}},Wl=We.forwardRef(({className:e,gradient:t=!1,interactive:i=!1,children:a,...s},r)=>se.jsxs(et.div,{ref:r,className:eo("m1ssion-glass-card overflow-hidden transition-all duration-300 card-hover-effect relative rounded-[24px]",e),whileHover:i?{scale:1.03,boxShadow:"0 0 25px rgba(0, 209, 255, 0.4), 0 0 50px rgba(123, 46, 255, 0.2)"}:{},whileTap:i?{scale:.97}:{},transition:{duration:.3,ease:"easeOut"},...s,children:[t&&se.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90"}),se.jsx(et.div,{className:"relative",whileHover:i?{y:-2}:{},transition:{duration:.2},children:a})]}));Wl.displayName="Card";const Hl=We.forwardRef(({className:e,...t},i)=>se.jsx("div",{ref:i,className:eo("flex flex-col space-y-1.5 p-6",e),...t}));Hl.displayName="CardHeader";const Zl=We.forwardRef(({className:e,...t},i)=>se.jsx("h3",{ref:i,className:eo("text-2xl font-semibold leading-none tracking-tight gradient-text-cyan glow-text",e),...t}));Zl.displayName="CardTitle";const Vl=We.forwardRef(({className:e,...t},i)=>se.jsx("p",{ref:i,className:eo("text-sm text-white/70",e),...t}));Vl.displayName="CardDescription";const Gl=We.forwardRef(({className:e,...t},i)=>se.jsx("div",{ref:i,className:eo("p-6 pt-0",e),...t}));Gl.displayName="CardContent";function Yl(){return()=>{}}We.forwardRef(({className:e,...t},i)=>se.jsx("div",{ref:i,className:eo("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter";var Kl="Avatar",[Xl]=re(Kl),[Jl,Ql]=Xl(Kl),ec=We.forwardRef((e,t)=>{const{__scopeAvatar:i,...a}=e,[s,r]=We.useState("idle");return se.jsx(Jl,{scope:i,imageLoadingStatus:s,onImageLoadingStatusChange:r,children:se.jsx(ne.span,{...a,ref:t})})});ec.displayName=Kl;var tc="AvatarImage",ic=We.forwardRef((e,t)=>{const{__scopeAvatar:i,src:a,onLoadingStatusChange:s=()=>{},...r}=e,n=Ql(tc,i),o=function(e,{referrerPolicy:t,crossOrigin:i}){const a=Ke.useSyncExternalStore(Yl,()=>!0,()=>!1),s=We.useRef(null),r=a?(s.current||(s.current=new window.Image),s.current):null,[n,o]=We.useState(()=>rc(r,e));return le(()=>{o(rc(r,e))},[r,e]),le(()=>{const e=e=>()=>{o(e)};if(!r)return;const a=e("loaded"),s=e("error");return r.addEventListener("load",a),r.addEventListener("error",s),t&&(r.referrerPolicy=t),"string"==typeof i&&(r.crossOrigin=i),()=>{r.removeEventListener("load",a),r.removeEventListener("error",s)}},[r,i,t]),n}(a,r),l=oe(e=>{s(e),n.onImageLoadingStatusChange(e)});return le(()=>{"idle"!==o&&l(o)},[o,l]),"loaded"===o?se.jsx(ne.img,{...r,ref:t,src:a}):null});ic.displayName=tc;var ac="AvatarFallback",sc=We.forwardRef((e,t)=>{const{__scopeAvatar:i,delayMs:a,...s}=e,r=Ql(ac,i),[n,o]=We.useState(void 0===a);return We.useEffect(()=>{if(void 0!==a){const e=window.setTimeout(()=>o(!0),a);return()=>window.clearTimeout(e)}},[a]),n&&"loaded"!==r.imageLoadingStatus?se.jsx(ne.span,{...s,ref:t}):null});function rc(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}sc.displayName=ac;var nc=ec,oc=ic,lc=sc;const cc=We.forwardRef(({className:e,...t},i)=>se.jsx(nc,{ref:i,className:eo("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));cc.displayName=nc.displayName;const dc=We.forwardRef(({className:e,...t},i)=>se.jsx(oc,{ref:i,className:eo("aspect-square h-full w-full",e),...t}));dc.displayName=oc.displayName;const uc=We.forwardRef(({className:e,...t},i)=>se.jsx(lc,{ref:i,className:eo("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));uc.displayName=lc.displayName;const hc=({profileImage:e,className:t,disabled:i=!1})=>se.jsx(cc,{className:eo("rounded-full border-2 border-[#00D1FF]/30",i&&"opacity-50 cursor-not-allowed",t),children:e?se.jsx(dc,{src:e,alt:"Profile"}):se.jsx(uc,{className:"bg-gradient-to-r from-[#131524]/80 to-black/80",children:se.jsx(Lr,{className:"h-5 w-5 text-[#00D1FF]"})})});function mc(){const[e,t]=We.useState([]),i=We.useRef(new Set);return{toast:We.useCallback(({title:e,description:a,variant:s="default",duration:r=4e3,action:n})=>{const o=`${s}-${e||a||""}`;if(i.current.has(o))return{id:"",dismiss:()=>{},update:()=>{}};i.current.add(o),setTimeout(()=>{i.current.delete(o)},2e3);const l=Math.random().toString(36).substr(2,9);if("destructive"===s)Ki.error(e||a||"Errore",{description:e?a:void 0,duration:r});else Ki.success(e||a||"Successo",{description:e?a:void 0,duration:r});const c={id:l,title:e,description:a,variant:s,duration:r,action:n};return t(e=>[...e,c]),setTimeout(()=>{t(e=>e.filter(e=>e.id!==l))},r),{id:l,dismiss:()=>t(e=>e.filter(e=>e.id!==l)),update:e=>t(t=>t.map(t=>t.id===l?{...t,...e}:t))}},[]),toasts:e}}const pc=uo("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function fc({className:e,variant:t,...i}){return se.jsx("div",{className:eo(pc({variant:t}),e),...i})}const gc=()=>{const[e,t]=We.useState(""),[i,a]=We.useState(!0),{toast:s}=mc();We.useEffect(()=>{(async()=>{try{const{data:{user:e}}=await ba.auth.getUser();if(!e)return;const{data:i,error:a}=await ba.from("profiles").select("referral_code").eq("id",e.id).single();if(a)return void console.error("Error fetching referral code:",a);i?.referral_code&&t(i.referral_code)}catch(e){console.error("Error in fetchReferralCode:",e)}finally{a(!1)}})()},[]);return{referralCode:e,loading:i,copyReferralCode:()=>{e&&(navigator.clipboard.writeText(e),s({title:"Codice copiato!",description:`Il tuo codice referral ${e}  stato copiato negli appunti.`}))}}};var xc="Progress",bc=100,[vc]=re(xc),[yc,wc]=vc(xc),Nc=We.forwardRef((e,t)=>{const{__scopeProgress:i,value:a=null,max:s,getValueLabel:r=_c,...n}=e;!s&&0!==s||Ac(s)||console.error(`Invalid prop \`max\` of value \`${`${s}`}\` supplied to \`${"Progress"}\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`);const o=Ac(s)?s:bc;null===a||zc(a,o)||console.error(function(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:\n  - a positive number\n  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)\n  - \`null\` or \`undefined\` if the progress is indeterminate.\n\nDefaulting to \`null\`.`}(`${a}`,"Progress"));const l=zc(a,o)?a:null,c=Cc(l)?r(l,o):void 0;return se.jsx(yc,{scope:i,value:l,max:o,children:se.jsx(ne.div,{"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":Cc(l)?l:void 0,"aria-valuetext":c,role:"progressbar","data-state":kc(l,o),"data-value":l??void 0,"data-max":o,...n,ref:t})})});Nc.displayName=xc;var jc="ProgressIndicator",Sc=We.forwardRef((e,t)=>{const{__scopeProgress:i,...a}=e,s=wc(jc,i);return se.jsx(ne.div,{"data-state":kc(s.value,s.max),"data-value":s.value??void 0,"data-max":s.max,...a,ref:t})});function _c(e,t){return`${Math.round(e/t*100)}%`}function kc(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function Cc(e){return"number"==typeof e}function Ac(e){return Cc(e)&&!isNaN(e)&&e>0}function zc(e,t){return Cc(e)&&!isNaN(e)&&e<=t&&e>=0}Sc.displayName=jc;var Ec=Nc,Ic=Sc;const Pc=We.forwardRef(({className:e,value:t,indicatorClassName:i,...a},s)=>se.jsx(Ec,{ref:s,className:eo("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...a,children:se.jsx(Ic,{className:eo("h-full w-full flex-1 bg-gradient-to-r from-m1ssion-blue to-blue-600 transition-all",i),style:{transform:`translateX(-${100-(t||0)}%)`}})}));Pc.displayName=Ec.displayName;const Tc=({totalXp:e,className:t})=>{const i=Math.floor(e/1e3)+1,a=e%1e3,s=1e3,r=a/s*100;return se.jsxs("div",{className:`space-y-3 ${t}`,children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:"p-2 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-full",children:se.jsx(jr,{className:"w-5 h-5 text-white"})}),se.jsxs("div",{children:[se.jsx("p",{className:"text-sm text-gray-400",children:"Livello"}),se.jsx("p",{className:"text-2xl font-bold gradient-text",children:i})]})]}),se.jsxs("div",{className:"text-right",children:[se.jsx("p",{className:"text-sm text-gray-400",children:"XP Totale"}),se.jsxs("p",{className:"text-xl font-semibold text-cyan-400 flex items-center gap-1",children:[e.toLocaleString(),se.jsx(zr,{className:"w-4 h-4"})]})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[se.jsxs("span",{children:[a," XP"]}),se.jsxs("span",{children:[s," XP"]})]}),se.jsxs("div",{className:"relative",children:[se.jsx(Pc,{value:r,className:"h-3 bg-gray-800/50 border border-cyan-500/20"}),se.jsx("div",{className:"absolute inset-0 h-3 rounded-full bg-gradient-to-r from-cyan-500/20 to-purple-500/20 pointer-events-none"})]}),se.jsxs("p",{className:"text-xs text-center text-gray-500",children:[s-a," XP al prossimo livello"]})]})]})};function Mc(){const{user:e}=sn(),[t,i]=We.useState(!1),[a,s]=We.useState(0),[r,n]=We.useState(!0),[o,l]=We.useState(null);We.useEffect(()=>{e&&c()},[e]);const c=async()=>{if(e)try{const{data:t,error:i}=await ba.from("profiles").select("current_streak_days, last_check_in_date").eq("id",e.id).single();if(i)throw i;if(t){s(t.current_streak_days||0),l(t.last_check_in_date);const e=(new Date).toISOString().split("T")[0];n(t.last_check_in_date!==e)}}catch(t){console.error("Error loading streak data:",t)}};return e?se.jsxs(et.div,{className:"flex flex-col items-center gap-2",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.15},children:[se.jsxs("div",{className:"text-center",children:[se.jsxs("div",{className:"flex items-center justify-center gap-2 text-primary",children:[se.jsx(Ts,{className:"h-5 w-5"}),se.jsxs("span",{className:"text-lg font-bold",children:[a," giorni"]})]}),se.jsx("p",{className:"text-xs text-muted-foreground",children:"Streak corrente"})]}),se.jsx(mo,{onClick:async()=>{if(e&&r){i(!0);try{const t=(new Date).toISOString().split("T")[0],i=new Date(Date.now()-864e5).toISOString().split("T")[0];let r=a;o&&o!==i?o!==t&&(r=1,Ki.warning(" La tua streak  stata resettata",{duration:3e3})):r=a+1;const{error:c}=await ba.from("profiles").update({current_streak_days:r,last_check_in_date:t}).eq("id",e.id);if(c)throw c;const{error:d}=await ba.rpc("award_xp",{p_user_id:e.id,p_xp_amount:10,p_source:"daily_checkin"});d&&console.error("XP award error:",d),s(r),n(!1),l(t),Ki.success(` Check-in completato! Streak: ${r} giorni (+10 XP)`,{duration:3e3})}catch(t){console.error("Error during check-in:",t),Ki.error("Errore durante il check-in")}finally{i(!1)}}},disabled:!r||t,className:"relative overflow-hidden",size:"sm",children:t?"Attendere...":r?" Check-in Giornaliero":" Completato oggi"}),!r&&se.jsx("p",{className:"text-xs text-muted-foreground",children:"Torna domani per continuare la streak!"})]}):null}const Lc=({isOpen:e,onClose:t,className:i})=>{const[a,s]=We.useState(null),[r,n]=We.useState(!0),[o,l]=We.useState(!1),{referralCode:c,copyReferralCode:d}=gc(),{toast:u}=mc(),{logout:h}=sn(),[,m]=Ai(),{xpStatus:p}=rn(),f=p?.total_xp??0;We.useEffect(()=>{if(e){g();const e=setInterval(()=>{g()},1e3),t=ba.channel("profile-updates").on("postgres_changes",{event:"*",schema:"public",table:"user_mission_status"},()=>{g()}).on("postgres_changes",{event:"*",schema:"public",table:"profiles"},()=>{g()}).subscribe();return()=>{clearInterval(e),t.unsubscribe()}}},[e]);const g=async()=>{try{const{data:{user:e}}=await ba.auth.getUser();if(!e)return;const{data:t}=await ba.from("profiles").select("username, full_name, subscription_tier").eq("id",e.id).single(),{data:i}=await ba.from("user_mission_status").select("clues_found, mission_started_at, mission_days_remaining").eq("user_id",e.id).single();let a=30;if(i?.mission_started_at){const e=new Date(i.mission_started_at),t=new Date,s=Math.floor((t.getTime()-e.getTime())/864e5);a=Math.max(0,30-s),e.toISOString(),t.toISOString()}const{data:r}=await ba.from("subscriptions").select("tier").eq("user_id",e.id).eq("status","active").single();let n=r?.tier||t?.subscription_tier||"Base";s({username:t?.username||t?.full_name||"Agente",email:e.email||"",cluesFound:i?.clues_found||0,totalClues:12,daysRemaining:a,missionStartDate:i?.mission_started_at||(new Date).toISOString(),subscriptionTier:n})}catch(e){console.error(" M1SSION Error fetching profile data:",e)}finally{n(!1)}};return se.jsx(tt,{children:e&&se.jsxs(se.Fragment,{children:[se.jsx(et.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:t}),se.jsxs(et.div,{initial:{opacity:0,scale:.9,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-20},transition:{duration:.2,ease:"easeOut"},className:`fixed top-20 right-4 w-80 bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl border border-slate-700/50 rounded-xl shadow-2xl z-50 ${i}`,style:{boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1)"},children:[se.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700/50",children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-full flex items-center justify-center",children:se.jsx(Lr,{className:"w-4 h-4 text-white"})}),se.jsx("h3",{className:"font-orbitron font-bold text-white",children:"Profilo Agente"})]}),se.jsx(mo,{variant:"ghost",size:"icon",onClick:t,className:"w-8 h-8 rounded-full hover:bg-white/10",children:se.jsx($r,{className:"w-4 h-4"})})]}),se.jsx("div",{className:"p-4 space-y-4",children:r?se.jsx("div",{className:"flex items-center justify-center py-8",children:se.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):a?se.jsxs(se.Fragment,{children:[se.jsxs("div",{className:"border border-slate-700/50 rounded-lg p-3 bg-slate-900/50",children:[se.jsxs("div",{className:"flex items-center justify-between mb-2",children:[se.jsx("h4",{className:"text-sm font-semibold text-blue-400",children:"Livello & XP"}),se.jsxs("span",{className:"text-xs text-gray-400",children:["Totale: ",f," XP"]})]}),se.jsx(Tc,{totalXp:f}),se.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700/50",children:[se.jsx("h5",{className:"text-xs text-gray-300 mb-2",children:"Check-in giornaliero"}),se.jsx(Mc,{})]})]}),se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx(Lr,{className:"w-4 h-4 text-blue-400"}),se.jsx("span",{className:"text-sm text-gray-300",children:"Nome utente:"}),se.jsx("span",{className:"text-white font-medium",children:a.username})]}),c&&se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),se.jsx("span",{className:"text-sm text-gray-300",children:"Codice referral:"}),se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx("span",{className:"text-white font-mono text-sm bg-slate-800 px-2 py-1 rounded",children:c}),se.jsx(mo,{variant:"ghost",size:"icon",onClick:d,className:"w-6 h-6 rounded hover:bg-white/10",children:se.jsx(ys,{className:"w-3 h-3"})})]})]}),se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx("div",{className:"w-4 h-4 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full"}),se.jsx("span",{className:"text-sm text-gray-300",children:"Email:"}),se.jsx("span",{className:"text-white font-medium text-sm",children:a.email})]}),se.jsxs("div",{className:"border-t border-slate-700/50 pt-4",children:[se.jsx("h4",{className:"text-sm font-semibold text-blue-400 mb-3",children:"Stato Missione"}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(kr,{className:"w-4 h-4 text-green-400"}),se.jsx("span",{className:"text-sm text-gray-300",children:"Indizi trovati:"})]}),se.jsxs("span",{className:"text-white font-medium",children:[a.cluesFound,"/",a.totalClues]})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(bs,{className:"w-4 h-4 text-orange-400"}),se.jsx("span",{className:"text-sm text-gray-300",children:"Giorni rimanenti:"})]}),se.jsx("span",{className:"text-white font-medium",children:a.daysRemaining})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(as,{className:"w-4 h-4 text-blue-400"}),se.jsx("span",{className:"text-sm text-gray-300",children:"Inizio missione:"})]}),se.jsx("span",{className:"text-white font-medium text-sm",children:(x=a.missionStartDate,new Date(x).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"}))})]})]})]}),se.jsxs("div",{className:"border-t border-slate-700/50 pt-4",children:[se.jsx("h4",{className:"text-sm font-semibold text-blue-400 mb-3",children:"Abbonamento"}),se.jsxs("div",{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-sm text-gray-300",children:"Piano attuale:"}),se.jsx(fc,{variant:"secondary",className:eo("font-semibold transition-all duration-300","Base"===a.subscriptionTier&&"bg-gray-500 text-white","Silver"===a.subscriptionTier&&"bg-gradient-to-r from-gray-300 to-gray-500 text-gray-900","Gold"===a.subscriptionTier&&"bg-gradient-to-r from-amber-400 to-amber-600 text-white shadow-md","Black"===a.subscriptionTier&&"bg-gradient-to-r from-gray-800 to-gray-900 text-white shadow-lg","Titanium"===a.subscriptionTier&&"bg-gradient-to-r from-purple-500 to-cyan-500 text-white animate-pulse shadow-[0_0_20px_rgba(168,85,247,0.5)]"),children:a.subscriptionTier?.toUpperCase()||"BASE"})]}),se.jsxs(mo,{onClick:()=>{t(),m("/subscriptions")},variant:"outline",size:"sm",className:"w-full bg-gradient-to-r from-blue-500/20 to-cyan-500/20 border-blue-500/50 text-blue-400 hover:bg-blue-500/30",children:[se.jsx(_s,{className:"w-4 h-4 mr-2"}),"Upgrade"]})]})]}),se.jsx("div",{className:"border-t border-slate-700/50 pt-4",children:se.jsxs(mo,{onClick:async()=>{l(!0);try{await h(),t(),m("/login"),u({title:"Logout effettuato",description:"Sei stato disconnesso con successo"})}catch(e){console.error("Error during logout:",e),u({title:"Errore",description:"Errore durante il logout",variant:"destructive"})}finally{l(!1)}},variant:"outline",size:"sm",className:"w-full border-red-500/50 text-red-400 hover:bg-red-500/20",disabled:o,children:[se.jsx(Vs,{className:"w-4 h-4 mr-2"}),o?"Disconnessione...":"Esci"]})})]}):se.jsx("div",{className:"text-center py-4 text-gray-400",children:"Errore nel caricamento dei dati"})})]})]})});var x},Fc=({profileImage:e,className:t=""})=>{const[i,a]=We.useState(!1),[s,r]=We.useState(!1),{user:n,logout:o}=$l(),{navigate:l}=yl(),{toast:c}=mc(),d=We.useRef(null);We.useEffect(()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&a(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const u=n?.user_metadata?.full_name||`${n?.user_metadata?.first_name||""} ${n?.user_metadata?.last_name||""}`.trim()||"Joseph",h=n?.email||"wikus77@hotmail.it",m=n?.id?n.id.substring(0,8):"N/A",p=n?.user_metadata?.subscription_tier||"m1ssion+",f=(()=>{switch(p.toLowerCase()){case"black":return{name:"Black",color:"bg-gray-800 text-white",emoji:""};case"elite":return{name:"Elite",color:"bg-amber-600 text-white",emoji:""};default:return{name:"M1SSION+",color:"bg-gradient-to-r from-purple-600 to-blue-600 text-white",emoji:""}}})();return se.jsxs("div",{className:`relative ${t}`,ref:d,children:[se.jsx(mo,{variant:"ghost",className:"p-1 rounded-full hover:bg-white/10 transition-colors",onClick:()=>{r(!0),a(!1)},children:se.jsx(hc,{profileImage:e,className:"w-10 h-10 border-2 border-[#00D1FF]/30 hover:border-[#00D1FF] transition-colors"})}),se.jsx(tt,{children:i&&se.jsx(et.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2,ease:"easeOut"},className:"absolute right-0 mt-2 w-80 z-[99999]",style:{top:"calc(100% + 8px)",maxWidth:"calc(100vw - 32px)",position:"absolute",right:"0px",left:"auto",transform:"none"},children:se.jsx(Wl,{className:"bg-black/95 border-[#00D1FF]/30 backdrop-blur-xl shadow-2xl border-2",children:se.jsxs(Gl,{className:"p-4 space-y-4",children:[se.jsxs("div",{className:"flex items-center space-x-3 pb-3 border-b border-white/10",children:[se.jsx(hc,{profileImage:e,className:"w-12 h-12 border-2 border-[#00D1FF]/30"}),se.jsxs("div",{className:"flex-1",children:[se.jsx("h3",{className:"font-orbitron font-semibold text-white text-sm",children:u}),se.jsx("p",{className:"text-white/70 text-xs",children:h}),se.jsxs("p",{className:"text-white/50 text-xs",children:["ID: ",m]})]})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-white/70 text-sm",children:"Piano attivo:"}),se.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${f.color}`,children:[f.emoji," ",f.name]})]}),se.jsxs("div",{className:"space-y-2 pt-2",children:[se.jsxs(mo,{variant:"ghost",className:"w-full justify-start text-white/90 hover:bg-white/10",onClick:()=>{a(!1),l("/settings")},children:[se.jsx(xr,{className:"w-4 h-4 mr-3"}),"Modifica profilo"]}),se.jsxs(mo,{variant:"ghost",className:"w-full justify-start text-red-400 hover:bg-red-500/10 hover:text-red-300",onClick:async()=>{try{await o(),c({title:" Logout completato",description:"Sei stato disconnesso con successo."}),l("/auth")}catch(e){c({title:" Errore logout",description:"Impossibile disconnettersi. Riprova.",variant:"destructive"})}},children:[se.jsx(Vs,{className:"w-4 h-4 mr-3"}),"Esci"]})]})]})})})}),se.jsx(Lc,{isOpen:s,onClose:()=>r(!1)})]})},Oc=Xe()(Je((e,t)=>({currentTab:"/",history:["/"],isCapacitor:!1,lastNavigation:Date.now(),setCurrentTab:t=>{e({currentTab:t,lastNavigation:Date.now()})},addToHistory:i=>{const{history:a}=t(),s=[...a,i].slice(-10);e({history:s,lastNavigation:Date.now()})},goBack:()=>{const{history:i}=t();if(i.length>1){const t=i.slice(0,-1),a=t[t.length-1];return e({history:t,currentTab:a,lastNavigation:Date.now()}),a}return null},clearHistory:()=>{e({history:["/"],currentTab:"/",lastNavigation:Date.now()})},setCapacitorMode:t=>{e({isCapacitor:t,lastNavigation:Date.now()})},getNavigationInfo:()=>t()}),{name:"m1ssion-navigation-store",partialize:e=>({currentTab:e.currentTab,history:e.history,isCapacitor:e.isCapacitor})})),Dc={isNativePlatform:()=>!1,getPlatform:()=>"web"},Rc=async()=>({receive:"granted"}),Bc=async()=>Promise.resolve();var Uc=Object.defineProperty,qc=(e,t,i)=>((e,t,i)=>t in e?Uc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);const $c={success:"/assets/audio/success.mp3",error:"/assets/audio/error.mp3",chime:"/assets/audio/chime.mp3",beep:"/assets/audio/beep.mp3",start:"/assets/audio/start.mp3",level_complete:"/assets/audio/level_complete.mp3",victory:"/assets/audio/victory.mp3"};const Wc=new class{constructor(){qc(this,"audioCache",new Map),qc(this,"isEnabled",!0)}async preloadAudio(){try{for(const[e,t]of Object.entries($c)){const i=new Audio(t);i.preload="auto",this.audioCache.set(e,i)}}catch(e){console.warn("Errore nel precaricamento audio:",e)}}setEnabled(e){this.isEnabled=e}async playSound(e){if(this.isEnabled)try{let t=this.audioCache.get(e);!t&&$c[e]&&(t=new Audio($c[e]),this.audioCache.set(e,t)),t&&(t.currentTime=0,await t.play())}catch(t){console.warn(`Impossibile riprodurre suono ${e}:`,t)}}},Hc=e=>Wc.playSound(e);var Zc=Object.defineProperty,Vc=(e,t,i)=>((e,t,i)=>t in e?Zc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,t+"",i);const Gc={tick:[10],buzzUnlocked:[0,100,50,100],missionComplete:[0,50,50,100,50,150],timeExpired:[0,300],important:[0,50,100,50,200,50,50],xpSmall:[30],xpMedium:[0,50,30,50],xpLarge:[0,50,50,100,50,150],levelUp:[0,100,100,100,100,200],selection:[15],success:[0,50,50,100],error:[300],cardFlip:[15],match:[0,50,30,50],wrong:[200],victory:[0,100,50,100,50,200]};const Yc=new class{constructor(){Vc(this,"isEnabled",!0);const e=localStorage.getItem("haptics-enabled");null!==e&&(this.isEnabled="true"===e)}async trigger(e){if(!this.isEnabled||!("vibrate"in navigator))return;const t=Gc[e];try{navigator.vibrate(t)}catch(i){console.warn(" Haptic failed:",i)}}setEnabled(e){this.isEnabled=e,localStorage.setItem("haptics-enabled",String(e))}getEnabled(){return this.isEnabled}isSupported(){return"vibrate"in navigator}},Kc=()=>{const[e]=We.useState({isPWA:"undefined"!=typeof window&&window.matchMedia("(display-mode: standalone)").matches,deviceInfo:{platform:"web",userAgent:navigator.userAgent},networkStatus:navigator.onLine?"online":"offline",orientation:"portrait"});return{...e,vibrate:async(e=200)=>{if("vibrate"in navigator)try{navigator.vibrate(e)}catch(t){console.warn(" Vibration failed:",t)}},triggerHaptic:async e=>{await Yc.trigger(e)},playSound:Hc,isLoading:!1}};function Xc(e,t){const[i,a]=We.useState(()=>{if("undefined"==typeof window)return t;try{const i=window.localStorage.getItem(e);return i?JSON.parse(i):t}catch(i){return console.error(`Error reading localStorage key "${e}":`,i),t}});return We.useEffect(()=>{function t(t){if(t.key===e&&t.newValue)try{const i=t.newValue.trim();i.startsWith("{")||i.startsWith("[")||i.startsWith('"')||"true"===i||"false"===i||!isNaN(Number(i))?a(JSON.parse(i)):console.warn(`Invalid JSON data for key "${e}":`,i)}catch(i){console.error(`JSON parse error for localStorage key "${e}":`,i,"Raw value:",t.newValue)}}if("undefined"!=typeof window)return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[e]),[i,t=>{try{const s=t instanceof Function?t(i):t;a(s),"undefined"!=typeof window&&window.localStorage.setItem(e,JSON.stringify(s))}catch(s){console.error(`Error setting localStorage key "${e}":`,s)}}]}const Jc=()=>{const[e,t]=We.useState(null),[i,a]=We.useState(!0),[s,r]=We.useState(null);We.useEffect(()=>{let e=!0,i=null;return(async()=>{try{const{data:{session:s}}=await ba.auth.getSession();if(!s?.user)return void a(!1);const{data:n,error:o}=await ba.from("profiles").select("id, full_name, bio, agent_code, agent_title, avatar_url, email, updated_at").eq("id",s.user.id).single();e&&n&&!o&&t(n),i=ba.channel(`profile_changes_${s.user.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:`id=eq.${s.user.id}`},i=>{if(e&&i.new){const e=i.new;t(e),e.full_name&&localStorage.setItem("profileName",e.full_name),e.bio&&localStorage.setItem("profileBio",e.bio),e.agent_code&&localStorage.setItem("agentCode",e.agent_code),e.avatar_url&&localStorage.setItem("profileImage",e.avatar_url)}}).subscribe(e=>{}),r(i),a(!1)}catch(s){console.error("Error setting up profile realtime:",s),a(!1)}})(),()=>{e=!1,i&&ba.removeChannel(i)}},[]);return{profileData:e,isLoading:i,updateProfile:async e=>{try{const{data:{session:i}}=await ba.auth.getSession();if(!i?.user)return null;t(t=>t?{...t,...e}:null);const{data:a,error:s}=await ba.from("profiles").update({...e,updated_at:(new Date).toISOString()}).eq("id",i.user.id).select().single();if(s){console.error("Error updating profile:",s);const{data:e}=await ba.from("profiles").select("id, full_name, bio, agent_code, agent_title, avatar_url, email, updated_at").eq("id",i.user.id).single();throw e&&t(e),s}return a}catch(i){throw console.error("Profile update error:",i),i}},channel:s}},Qc=()=>{const[e,t]=Xc("profileImage",null),{profileData:i}=Jc();We.useEffect(()=>{i?.avatar_url&&t(i.avatar_url)},[i?.avatar_url,t]);return{profileImage:e,setProfileImage:t,saveImageToStorage:async e=>{try{const{data:{session:t}}=await ba.auth.getSession();if(!t?.user)return null;const i=`profiles/${`${t.user.id}.jpg`}`,{data:a,error:s}=await ba.storage.from("avatars").upload(i,e,{cacheControl:"3600",upsert:!0});if(s)throw s;const{data:{publicUrl:r}}=ba.storage.from("avatars").getPublicUrl(i);return r}catch(t){return console.error("Error saving image to storage:",t),null}}}},ed=()=>{const{referralCode:e,loading:t,copyReferralCode:i}=gc();return t||!e?se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx("div",{className:"w-2 h-2 bg-slate-600 rounded-full animate-pulse"}),se.jsx("span",{className:"text-sm text-slate-500 font-orbitron",children:"Loading..."})]}):se.jsxs(et.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-center space-x-2 cursor-pointer",onClick:i,children:[se.jsx(et.div,{className:"w-2 h-2 bg-[#00D1FF] rounded-full",animate:{scale:[1,1.2,1],opacity:[1,.7,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},style:{boxShadow:"0 0 8px rgba(0, 209, 255, 0.6), 0 0 16px rgba(0, 209, 255, 0.4)"}}),se.jsx("span",{className:"text-sm font-orbitron font-bold text-white hover:text-[#00D1FF] transition-colors duration-200",style:{textShadow:"0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"},children:e})]})},td=(e=50,t)=>{const[i,a]=We.useState({isScrollingUp:!1,isScrollingDown:!1,scrollY:0,shouldHideHeader:!1});return We.useEffect(()=>{let t=window.scrollY,i=!1,s=null;const r=()=>{const s=window.scrollY+0;if(Math.abs(s-t)<e)return void(i=!1);const r=s>t;a({isScrollingUp:s<t,isScrollingDown:r,scrollY:s,shouldHideHeader:r&&s>e}),t=s>0?s:0,i=!1},n=()=>{i||(window.requestAnimationFrame(r),i=!0)};var o;return o=window,s&&s.removeEventListener("scroll",n),o.addEventListener("scroll",n,{passive:!0}),s=o,()=>{s&&s.removeEventListener("scroll",n)}},[e,t]),i},id=({show:e,children:t})=>se.jsx(tt,{children:e&&se.jsx(et.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:[.4,0,.2,1]},className:"fixed left-1/2 z-[60]",style:{top:"calc(47px + 20px)",transform:"translateX(-50%)"},children:t})}),ad=({profileImage:e,leftComponent:t,onClickMail:i,disableScrollHide:a=!1})=>{const s=We.useRef(!1);We.useEffect(()=>(s.current&&console.warn(" UnifiedHeader: Multiple mounts detected, cleaning up duplicates"),s.current=!0,()=>{s.current=!1}),[]);const[r]=Ai();ql();const{goBackWithFeedback:n,canGoBack:o}=(()=>{const{navigate:e,currentPath:t}=yl(),{isPWA:i,triggerHaptic:a}=Kc(),{setCurrentTab:s,addToHistory:r,goBack:n}=Oc(),o=Ml(async(t,n)=>{!1!==n?.haptic&&await a("tick"),s(t),r(t),e(t,n),i&&setTimeout(()=>{window.scrollTo(0,0)},100)}),l=Ml(async t=>(!1!==t?.haptic&&await a("selection"),"undefined"!=typeof window&&window.history.length>1?(window.history.back(),i&&setTimeout(()=>{window.scrollTo(0,0)},100),!0):(e("/home"),"/home"))),c={toHome:Ml(()=>o("/home")),toMap:Ml(()=>o("/map")),toBuzz:Ml(()=>o("/buzz")),toGames:Ml(()=>o("/games")),toProfile:Ml(()=>o("/profile")),toSettings:Ml(()=>o("/settings")),toNotifications:Ml(()=>o("/notifications")),toLeaderboard:Ml(()=>o("/leaderboard"))},d=Ml(()=>{const e=t;return e.startsWith("/home")?"home":e.startsWith("/map")?"map":e.startsWith("/buzz")?"buzz":e.startsWith("/games")?"games":e.startsWith("/profile")?"profile":e.startsWith("/settings")?"settings":e.startsWith("/notifications")?"notifications":e.startsWith("/leaderboard")?"leaderboard":"home"}),u={currentPath:t,currentTab:d(),isPWA:i,canGoBack:window.history.length>1};return{navigateWithFeedback:o,goBackWithFeedback:l,...c,...u,getCurrentTab:d}})(),{profileImage:l}=Qc(),{user:c}=bl(),[d,u]=We.useState(!1),[h,m]=We.useState(!1),[p,f]=We.useState(!1),g="/map"===r||r.startsWith("/map/"),x="/buzz"===r,{shouldHideHeader:b}=td(50),[v,y]=We.useState(!1),w=!x&&(g?v:b);We.useEffect(()=>{if(!g||a||x)return;const e=document.querySelector("#map-scroll-container");if(!e)return;const t=()=>y(e.scrollTop>10);e.addEventListener("scroll",t,{passive:!0});const i=t=>{t.deltaY>0&&y(!0),t.deltaY<0&&e.scrollTop<=0&&y(!1)};e.addEventListener("wheel",i,{passive:!0,capture:!0});let s=null;const r=e=>{s=e.touches[0]?.clientY??null},n=t=>{if(null==s)return;const i=t.touches[0]?.clientY??s,a=s-i;a>0&&y(!0),a<0&&e.scrollTop<=0&&y(!1),s=i};e.addEventListener("touchstart",r,{passive:!0,capture:!0}),e.addEventListener("touchmove",n,{passive:!0,capture:!0});const o=document.querySelector(".leaflet-container");return o&&(o.addEventListener("wheel",i,{passive:!0,capture:!0}),o.addEventListener("touchstart",r,{passive:!0,capture:!0}),o.addEventListener("touchmove",n,{passive:!0,capture:!0})),()=>{e.removeEventListener("scroll",t),e.removeEventListener("wheel",i),e.removeEventListener("touchstart",r),e.removeEventListener("touchmove",n),o&&(o.removeEventListener("wheel",i),o.removeEventListener("touchstart",r),o.removeEventListener("touchmove",n))}},[g,r,a,x]);const N=l||e;We.useEffect(()=>{const e=window.matchMedia("(display-mode: standalone)").matches;f(e);(async()=>{const e=!!window.Capacitor;m(e);const t=navigator.userAgent,i=/iPhone|iPad|iPod|Android|Mobile/i.test(t)||e,a="granted"===localStorage.getItem("developer_access");let s=!1;if(c){const{data:e}=await ba.from("profiles").select("role").eq("id",c.id).single();s="admin"===e?.role}s?(u(!0),localStorage.setItem("unlimited_access","true"),localStorage.setItem("bypass_all_restrictions","true")):u(!(!i||!a))})()},[c]);const j="/home"===r,S="/profile"===r||"/settings/agent-profile"===r,_=["/","/home","/map","/buzz","/games","/notifications","/leaderboard","/intelligence"].includes(r);return se.jsxs(se.Fragment,{children:[se.jsx(id,{show:!1,children:se.jsxs("div",{className:"flex flex-col items-center gap-1",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(et.div,{className:"w-2 h-2 bg-[#00D1FF] rounded-full",animate:{scale:[1,1.2,1],opacity:[1,.7,1]},transition:{duration:1.6,repeat:1/0,ease:"easeInOut"},style:{boxShadow:"0 0 8px rgba(0, 209, 255, 0.6), 0 0 16px rgba(0, 209, 255, 0.4)"}}),se.jsx("span",{className:"text-xs font-orbitron font-bold text-white tracking-wider",style:{textShadow:"0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"},children:"CODE"})]}),se.jsx(ed,{})]})}),se.jsxs(et.header,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.3,ease:[.4,0,.2,1]},className:"fixed left-0 right-0 z-50 backdrop-blur-xl rounded-b-lg",style:{top:"0px",background:"transparent",backdropFilter:"none",WebkitBackdropFilter:"none",borderBottom:"none",boxShadow:"none",paddingTop:p?"max(env(safe-area-inset-top, 0px), 16px)":"max(env(safe-area-inset-top, 0px), 12px)",height:"calc(72px + max(env(safe-area-inset-top, 0px), 8px))",isolation:"isolate"},children:[se.jsx(et.div,{className:"absolute inset-0 pointer-events-none rounded-b-lg",animate:{opacity:w?0:1},transition:{duration:.3},style:{background:"rgba(0, 0, 0, 0.3)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderBottom:"1px solid rgba(0, 209, 255, 0.2)",boxShadow:"0 4px 24px rgba(0, 209, 255, 0.18), 0 2px 12px rgba(0, 209, 255, 0.12), inset 0 -1px 0 rgba(0, 209, 255, 0.12)"}}),se.jsxs("div",{className:"container mx-auto h-full max-w-screen-xl relative",children:[se.jsxs("div",{className:"flex items-center justify-between h-[72px] px-3 sm:px-4 relative",children:[se.jsx(et.div,{className:"flex items-center",animate:{opacity:w?0:1},transition:{duration:.3},children:t||se.jsxs("div",{className:"flex items-center",children:[!j&&!_&&o&&se.jsx(mo,{variant:"ghost",size:"icon",onClick:()=>n(),className:"mr-2 rounded-full hover:bg-white/10",children:se.jsx(Za,{className:"w-5 h-5"})}),se.jsxs(Ti,{to:"/home",className:"text-xl sm:text-2xl font-orbitron font-bold",children:[se.jsx("span",{className:"text-[#00D1FF]",style:{textShadow:"0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"},children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]})]})]})}),se.jsxs("div",{className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-1",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(et.div,{className:"w-2 h-2 bg-[#00D1FF] rounded-full",animate:{scale:[1,1.2,1],opacity:[1,.7,1]},transition:{duration:1.6,repeat:S?0:1/0,ease:"easeInOut"},style:{boxShadow:"0 0 8px rgba(0, 209, 255, 0.6), 0 0 16px rgba(0, 209, 255, 0.4)"}}),se.jsx("span",{className:"text-xs font-orbitron font-bold text-white tracking-wider",style:{textShadow:"0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"},children:"CODE"})]}),se.jsx(ed,{})]}),se.jsxs(et.div,{className:"flex items-center space-x-1 sm:space-x-3",animate:{opacity:w?0:1},transition:{duration:.3},children:[se.jsx(Ti,{to:"/settings",children:se.jsx(mo,{variant:"ghost",size:"icon",className:"rounded-full hover:bg-white/10",children:se.jsx(et.div,{animate:{rotate:[0,360],scale:[1,1.05,1]},transition:{rotate:{duration:S?1.6:8,repeat:S?0:1/0,ease:"linear"},scale:{duration:S?1.2:4,repeat:S?0:1/0,ease:"easeInOut"}},style:{filter:"drop-shadow(0 0 8px rgba(0, 209, 255, 0.4))"},children:se.jsx(xr,{className:"w-5 h-5 text-[#00D1FF]"})})})}),se.jsx(Fc,{profileImage:N,className:"cursor-pointer"})]})]}),se.jsx(et.div,{className:"line-glow absolute bottom-0 left-0 w-full",animate:{opacity:w?0:1},transition:{duration:.3}})]})]})]})},sd=()=>{const[e]=Ai(),{unreadCount:t}=Fa(),{navigate:i}=yl(),a="undefined"!=typeof window&&window.matchMedia("(display-mode: standalone)").matches,s="/profile"===e||"/settings/agent-profile"===e,r=[{icon:se.jsx(Os,{className:"h-6 w-6"}),label:"Home",path:"/home",color:"#00D1FF"},{icon:se.jsx(Ks,{className:"h-6 w-6"}),label:"Map",path:"/map",color:"#00D1FF"},{icon:se.jsx(xs,{strokeWidth:2,className:"h-6 w-6"}),label:"Buzz",path:"/buzz",isSpecial:!0,color:"#00D1FF"},{icon:se.jsx("span",{className:"text-lg font-bold",children:"AI"}),label:"Intel",path:"/intelligence",color:"#00D1FF"},{icon:se.jsx(Gs,{className:"h-6 w-6"}),label:"Notice",path:"/notifications",badge:t>0,badgeCount:t,color:"#00D1FF"},{icon:se.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:se.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),label:"Winners",path:"/leaderboard",color:"#00D1FF"}];return se.jsx("div",{className:"bottom-navigation-ios",style:{position:"fixed",left:0,right:0,bottom:"0px",zIndex:1e4,paddingBottom:"0px",paddingLeft:"env(safe-area-inset-left)",paddingRight:"env(safe-area-inset-right)",backgroundColor:"transparent",transform:"translateZ(0)",WebkitTransform:"translateZ(0)",isolation:"isolate",WebkitBackfaceVisibility:"hidden",backfaceVisibility:"hidden",willChange:"transform"},children:se.jsxs(et.div,{className:"backdrop-blur-xl border-t border-white/10 px-3 bottom-nav-hardware-acceleration rounded-t-lg",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},style:{position:"relative",zIndex:"inherit",height:"79px",display:"flex",alignItems:"flex-start",paddingTop:"8px",paddingBottom:a?"env(safe-area-inset-bottom)":"0px",background:"rgba(0, 0, 0, 0.15)",backdropFilter:"blur(20px)",borderTop:"1px solid rgba(0, 209, 255, 0.2)",boxShadow:"0 -4px 24px rgba(0, 209, 255, 0.15), 0 -2px 12px rgba(0, 209, 255, 0.1), inset 0 1px 0 rgba(0, 209, 255, 0.1)",WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:[se.jsx("div",{className:"flex items-center justify-around h-full max-w-lg mx-auto w-full",children:r.map(t=>{const r=e===t.path;return se.jsxs(et.button,{onClick:e=>(async(e,t)=>{t.preventDefault(),e.path,i(e.path),a&&setTimeout(()=>{window.scrollTo(0,0)},100)})(t,e),className:"relative flex flex-col items-center justify-center w-14 h-12 transition-colors mobile-touch-target cursor-pointer "+(r?"text-[#00D1FF]":"text-gray-400 hover:text-gray-300"),style:{background:"none",border:"none",outline:"none",WebkitTapHighlightColor:"transparent",WebkitTouchCallout:"none",userSelect:"none",touchAction:"manipulation",minHeight:"44px",minWidth:"44px"},whileTap:{scale:.95},whileHover:{scale:1.05},children:[se.jsxs(et.div,{className:"relative",children:[t.isSpecial?se.jsxs(et.div,{className:"relative",animate:{scale:[1,1.05,1],opacity:[1,.9,1]},transition:{repeat:s?0:1/0,duration:3,ease:"easeInOut"},children:[se.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-[#00D1FF] to-[#7B2EFF] opacity-30 blur-sm "+(s?"":"animate-pulse")}),se.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-[#00D1FF]/60 animate-spin-slow",style:{animation:s?"spin 1.6s linear 1":"spin 8s linear infinite"}}),se.jsx("div",{className:"relative z-10 text-[#00D1FF]",style:{filter:"drop-shadow(0 0 8px rgba(0, 209, 255, 0.8))",textShadow:"0 0 10px rgba(0, 209, 255, 0.6)"},children:t.icon})]}):se.jsx(et.div,{animate:r?{scale:[1,1.1,1],filter:[`drop-shadow(0 0 5px ${t.color}80)`,`drop-shadow(0 0 12px ${t.color}CC)`,`drop-shadow(0 0 5px ${t.color}80)`]}:{},transition:{repeat:r&&!s?1/0:0,duration:3,ease:"easeInOut"},style:{color:r?t.color:"inherit"},children:t.icon}),se.jsx(tt,{children:t.badge&&t.badgeCount&&se.jsx(et.div,{className:"absolute -top-1 -right-1 flex items-center justify-center h-5 w-5 bg-[#FF59F8] rounded-full shadow-[0_0_8px_rgba(240,89,255,0.5)]",initial:{scale:0,opacity:0},animate:{scale:[1,1.2,1],opacity:1},exit:{scale:0,opacity:0},transition:{duration:2,repeat:s?0:1/0,repeatType:"reverse"},children:se.jsx("span",{className:"text-[9px] font-bold text-white",children:t.badgeCount>99?"99+":t.badgeCount})})})]}),se.jsx(et.span,{className:"text-xs mt-1 select-none",style:{color:r?t.color:"inherit"},animate:r?{textShadow:[`0 0 5px ${t.color}80`,`0 0 10px ${t.color}CC`,`0 0 5px ${t.color}80`]}:{},transition:{repeat:r&&!s?1/0:0,duration:3,ease:"easeInOut"},children:t.label}),se.jsx(tt,{children:r&&se.jsx(et.div,{className:"absolute bottom-0 w-8 h-1 rounded-t-md",style:{backgroundColor:t.color,boxShadow:`0 0 8px ${t.color}80`},layoutId:"navigation-underline",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{type:"spring",stiffness:500,damping:30}})})]},t.path)})}),se.jsx("div",{className:"line-glow absolute top-0 left-0 w-full"})]})})},rd=We.forwardRef(({className:e,checked:t,onCheckedChange:i,...a},s)=>{const[r,n]=We.useState(t||!1);We.useEffect(()=>{void 0!==t&&n(t)},[t]);return se.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[se.jsx("input",{type:"checkbox",ref:s,checked:r,onChange:e=>{const t=e.target.checked;n(t),i?.(t)},className:"sr-only",...a}),se.jsx("div",{className:eo("relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r?"bg-primary":"bg-input",e),children:se.jsx("span",{className:eo("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform",r?"translate-x-4":"translate-x-0.5")})})]})});rd.displayName="Switch";const nd=()=>{const{user:e}=$l(),{toast:t}=mc(),[i]=Ai(),[a,s]=We.useState(!1),[r,n]=We.useState(!1),[o,l]=We.useState(!1),[c,d]=We.useState({essential:!0,analytics:!1,marketing:!1,preferences:!1});We.useEffect(()=>{"/"===i&&u()},[e,i]);const u=async()=>{try{const t=(new Date).toISOString().split("T")[0];if(e){const{data:i,error:a}=await ba.from("profiles").select("last_cookie_banner_shown").eq("id",e.id).single();if(a&&"PGRST116"!==a.code&&console.error("Error loading profile data:",a),i?.last_cookie_banner_shown===t)return;const{data:s,error:r}=await ba.from("user_cookie_preferences").select("*").eq("user_id",e.id).single();if(r&&"PGRST116"!==r.code&&console.error("Error loading cookie preferences:",r),s)return void d({essential:s.essential_cookies,analytics:s.analytics_cookies,marketing:s.marketing_cookies,preferences:s.preferences_cookies})}else{const e=localStorage.getItem("cookie_consent");if(localStorage.getItem("cookie_banner_last_shown")===t&&e)return void d(JSON.parse(e))}s(!0)}catch(t){console.error("Error checking cookie consent:",t),s(!0)}},h=async t=>{try{const i=(new Date).toISOString().split("T")[0];if(e){const{error:a}=await ba.from("user_cookie_preferences").upsert({user_id:e.id,essential_cookies:t.essential,analytics_cookies:t.analytics,marketing_cookies:t.marketing,preferences_cookies:t.preferences},{onConflict:"user_id"});if(a)throw a;await ba.from("user_consents").upsert({user_id:e.id,cookie_consent:!0},{onConflict:"user_id"}),await ba.from("profiles").update({last_cookie_banner_shown:i}).eq("id",e.id)}else localStorage.setItem("cookie_consent",JSON.stringify(t)),localStorage.setItem("cookie_banner_last_shown",i);d(t)}catch(i){throw console.error("Error saving cookie preferences:",i),i}};return a?se.jsx(tt,{children:se.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 20px)",paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 20px)"},children:se.jsx(et.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"w-full max-w-md",children:r?se.jsxs(Wl,{className:"bg-gradient-to-br from-[#131524] to-[#1a1d3a] border-[#00D1FF]/30",children:[se.jsx(Hl,{className:"pb-4",children:se.jsxs(Zl,{className:"flex items-center justify-between text-white",children:[se.jsxs("span",{className:"flex items-center",children:[se.jsx(xr,{className:"w-5 h-5 mr-2 text-[#00D1FF]"}),"Preferenze Cookie"]}),se.jsx(mo,{onClick:()=>n(!1),size:"sm",variant:"ghost",className:"text-white/70 hover:text-white",children:se.jsx($r,{className:"w-4 h-4"})})]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex-1",children:[se.jsx("h4",{className:"text-white font-medium",children:"Cookie Essenziali"}),se.jsx("p",{className:"text-white/60 text-xs",children:"Necessari per il funzionamento dell'app"})]}),se.jsx(rd,{checked:c.essential,disabled:!0,className:"data-[state=checked]:bg-[#00D1FF]"})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex-1",children:[se.jsx("h4",{className:"text-white font-medium",children:"Cookie Analitici"}),se.jsx("p",{className:"text-white/60 text-xs",children:"Ci aiutano a migliorare l'esperienza"})]}),se.jsx(rd,{checked:c.analytics,onCheckedChange:e=>d(t=>({...t,analytics:e})),className:"data-[state=checked]:bg-[#00D1FF]"})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex-1",children:[se.jsx("h4",{className:"text-white font-medium",children:"Cookie Marketing"}),se.jsx("p",{className:"text-white/60 text-xs",children:"Per contenuti e pubblicit personalizzati"})]}),se.jsx(rd,{checked:c.marketing,onCheckedChange:e=>d(t=>({...t,marketing:e})),className:"data-[state=checked]:bg-[#00D1FF]"})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex-1",children:[se.jsx("h4",{className:"text-white font-medium",children:"Cookie Preferenze"}),se.jsx("p",{className:"text-white/60 text-xs",children:"Ricordano le tue impostazioni"})]}),se.jsx(rd,{checked:c.preferences,onCheckedChange:e=>d(t=>({...t,preferences:e})),className:"data-[state=checked]:bg-[#00D1FF]"})]})]}),se.jsx(mo,{onClick:async()=>{l(!0);try{await h(c),s(!1),n(!1),t({title:" Preferenze salvate",description:"Le tue preferenze sui cookie sono state aggiornate."})}catch(e){console.error("Error saving preferences:",e),t({title:" Errore",description:"Impossibile salvare le preferenze. Riprova.",variant:"destructive"})}finally{l(!1)}},disabled:o,className:"w-full bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90",children:o?"Salvataggio...":"Salva preferenze"})]})]}):se.jsxs(Wl,{className:"bg-gradient-to-br from-[#131524] to-[#1a1d3a] border-[#00D1FF]/30",children:[se.jsx(Hl,{className:"pb-4",children:se.jsxs(Zl,{className:"flex items-center text-white",children:[se.jsx(vs,{className:"w-5 h-5 mr-2 text-[#00D1FF]"}),"Cookie Policy"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsx("p",{className:"text-white/80 text-sm",children:"Utilizziamo cookie per migliorare la tua esperienza, analizzare il traffico e personalizzare i contenuti. Puoi gestire le tue preferenze o accettare tutto."}),se.jsxs("div",{className:"flex flex-col space-y-2",children:[se.jsxs(mo,{onClick:async()=>{await h({essential:!0,analytics:!0,marketing:!0,preferences:!0}),s(!1),t({title:" Cookie accettati",description:"Hai accettato tutti i cookie. Grazie!"})},className:"bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90",children:[se.jsx(os,{className:"w-4 h-4 mr-2"}),"Accetta tutto"]}),se.jsxs(mo,{onClick:async()=>{await h({essential:!0,analytics:!1,marketing:!1,preferences:!1}),s(!1),t({title:" Cookie rifiutati",description:"Solo i cookie essenziali saranno utilizzati."})},variant:"outline",className:"border-white/20 text-white hover:bg-white/10",children:[se.jsx($r,{className:"w-4 h-4 mr-2"}),"Rifiuta tutto"]}),se.jsxs(mo,{onClick:()=>n(!0),variant:"ghost",className:"text-[#00D1FF] hover:bg-[#00D1FF]/10",children:[se.jsx(xr,{className:"w-4 h-4 mr-2"}),"Gestisci preferenze"]})]}),se.jsxs("p",{className:"text-xs text-white/60 text-center",children:["Consulta la nostra"," ",se.jsx("button",{onClick:()=>window.open("/cookie-policy","_blank"),className:"text-[#00D1FF] hover:underline",children:"Cookie Policy completa"})]})]})]})})})}):null},od=({children:e})=>{const[t]=Ai(),i=Ll(),a=["/login","/register","/auth","/kyc","/verification","/select-mission"].includes(t),s=["/map","/buzz","/games"].includes(t);return a?se.jsx(Bl,{className:"min-h-screen bg-gradient-to-br from-black via-[#0B1426] to-[#1a1a2e]",children:e}):s?se.jsx(Bl,{className:"min-h-screen bg-gradient-to-br from-black via-[#0B1426] to-[#1a1a2e]",children:se.jsxs("div",{className:"relative min-h-screen",children:[se.jsx(ad,{}),se.jsx("main",{className:"relative z-10",children:e}),se.jsx(sd,{})]})}):se.jsx(Bl,{className:"min-h-screen bg-gradient-to-br from-black via-[#0B1426] to-[#1a1a2e]",children:se.jsxs("div",{className:"relative min-h-screen",children:[se.jsx(ad,{}),se.jsx("main",{className:"relative z-10 pt-[119px] pb-20",style:{minHeight:"calc(100vh - 119px - 80px)",paddingTop:i?"calc(119px + env(safe-area-inset-top, 0px))":"119px"},children:e}),se.jsx(sd,{}),se.jsx(nd,{})]})})};const ld=({src:e,alt:t,className:i,placeholderSrc:a="/placeholder.svg",threshold:s=.1,...r})=>{const[n,o]=We.useState(!1),[l,c]=We.useState(!1),d=We.useRef(null);We.useEffect(()=>{if(!d.current)return;const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(c(!0),e.unobserve(t.target))})},{threshold:s});return e.observe(d.current),()=>{d.current&&e.unobserve(d.current)}},[s]);return se.jsxs("div",{className:eo("relative overflow-hidden",i),style:r.style,children:[!n&&se.jsx("div",{className:"absolute inset-0 bg-gray-900/20 animate-pulse flex items-center justify-center",children:se.jsx("img",{src:a,alt:"Loading...",className:"w-12 h-12 opacity-30"})}),se.jsx("img",{ref:d,src:l?e:a,alt:t||"Image",className:eo("transition-opacity duration-500",n?"opacity-100":"opacity-0"),onLoad:()=>{o(!0)},...r})]})},cd=({isOpen:e,onClose:t,imageUrl:i,alt:a="Image preview"})=>se.jsx(to,{open:e,onOpenChange:t,children:se.jsx(io,{className:"sm:max-w-[60vw] max-w-[90vw] p-1 bg-black/80 border border-cyan-500/30 rounded-xl shadow-lg",children:se.jsxs("div",{className:"relative",children:[se.jsx("button",{className:"absolute top-2 right-2 z-10 rounded-full bg-black/50 p-1.5 text-white/80 hover:bg-black/70 hover:text-white transition-colors",onClick:t,"aria-label":"Close preview",children:se.jsx($r,{className:"h-5 w-5"})}),se.jsx(et.img,{src:i,alt:a,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"w-full h-auto rounded-lg object-contain max-h-[80vh]"})]})})}),dd=(e,t={})=>{const{threshold:i=500,onStart:a,onFinish:s,onCancel:r}=t,[n,o]=We.useState(!1),l=We.useRef(),c=We.useRef(),d=We.useCallback(t=>{t.persist(),"touches"in t&&t.preventDefault(),c.current=t.target,l.current=setTimeout(()=>{a?.(),o(!0),e(),s?.()},i)},[e,s,a,i]),u=We.useCallback(()=>{l.current&&clearTimeout(l.current),o(!1),r?.()},[r]);return{onMouseDown:e=>d(e),onMouseUp:u,onMouseLeave:u,onTouchStart:e=>d(e),onTouchEnd:u}},ud=({isOpen:e,onClose:t})=>{const[i,a]=We.useState(null);return se.jsxs(se.Fragment,{children:[se.jsx(to,{open:e,onOpenChange:t,children:se.jsxs(io,{className:"sm:max-w-3xl w-[calc(100vw-2rem)] max-h-[85vh] overflow-y-auto bg-black/80 backdrop-blur-md border border-cyan-500/30 rounded-2xl shadow-xl p-6",children:[se.jsxs(ao,{children:[se.jsx(so,{className:"text-2xl font-orbitron text-center bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent",children:" Premi Esclusivi M1SSION"}),se.jsx(ro,{className:"text-center text-white/70",children:"Ecco i premi che potrai vincere partecipando alle nostre missioni speciali. Solo i pi veloci, astuti e determinati potranno conquistarli."})]}),se.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 my-6 p-1 rounded-2xl shadow-xl p-6",children:[{name:"Lamborghini Huracn",description:"Vivi il brivido della velocit con una Lamborghini Huracn. Design aggressivo, motore ruggente e linee affilate:  pi di un'auto,  una dichiarazione di potere. Solo un agente M1SSION potr portarsela a casa.",image:"/lovable-uploads/211b98b7-646d-4c40-80d6-416ac71a54fc.png"},{name:"Ferrari SF90 Stradale",description:"Un'auto di lusso con prestazioni straordinarie, design all'avanguardia e tecnologia di punta.",image:"/lovable-uploads/2f1f79ad-4221-4a49-a188-81e28222514d.png"},{name:"Aston Martin DBX",description:"Il SUV pi elegante e potente mai prodotto da Aston Martin. Linee muscolose, prestazioni sportive e lusso senza compromessi per affrontare ogni missione con stile.",image:"/lovable-uploads/3b5f5a13-bb71-472b-9348-6e52c12cba7e.png"},{name:"Porsche 911 Turbo",description:"La Porsche 911 Turbo  il simbolo della perfezione tedesca: eleganza, potenza e precisione in un'unica auto. Un gioiello nero su quattro ruote per chi completa la M1SSION con intelligenza e velocit.",image:"/lovable-uploads/7bda6b4a-6ac6-489d-8b2f-b9a4f9c312a2.png"}].map((e,t)=>{const i=dd(()=>a(e.image));return se.jsxs("div",{className:"bg-white/5 border border-white/10 p-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:bg-white/8 hover:scale-[1.02]",style:{boxShadow:"0 8px 32px rgba(0, 0, 0, 0.2), 0 0 8px rgba(0, 209, 255, 0.1)"},children:[se.jsx("div",{className:"h-48 overflow-hidden rounded-xl mb-4 cursor-pointer",...i,onDoubleClick:()=>a(e.image),onContextMenu:t=>{t.preventDefault(),a(e.image)},children:se.jsx(ld,{src:e.image,alt:e.name,className:"w-full h-full object-cover transform hover:scale-105 transition-transform duration-500 rounded-xl"})}),se.jsx("h3",{className:"font-orbitron text-lg font-bold text-cyan-400 mb-2",children:e.name}),se.jsx("p",{className:"text-sm text-white/70",children:e.description})]},t)})}),se.jsx(no,{children:se.jsx(oo,{asChild:!0,children:se.jsx(mo,{className:"w-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full",children:"Chiudi"})})})]})}),se.jsx(cd,{isOpen:!!i,onClose:()=>{a(null)},imageUrl:i||"",alt:"Prize preview"})]})},hd=()=>se.jsx("footer",{className:"py-16 px-4 bg-black w-full border-t border-white/20 relative z-50",children:se.jsxs("div",{className:"max-w-screen-xl mx-auto",children:[se.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full mb-8",children:[se.jsx("div",{className:"mb-6 md:mb-0",children:se.jsxs("h2",{className:"text-2xl font-bold",children:[se.jsx("span",{className:"text-[#00E5FF]",children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]})]})}),se.jsxs("div",{className:"flex flex-wrap gap-4 justify-center md:justify-end",children:[se.jsx(Ti,{to:"/privacy-policy",className:"text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1",children:"Privacy Policy"}),se.jsx(Ti,{to:"/cookie-policy",className:"text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1",children:"Cookie Policy"}),se.jsx(Ti,{to:"/terms",className:"text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1",children:"Termini e Condizioni"}),se.jsx(Ti,{to:"/contact",className:"text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1",children:"Contatti"})]})]}),se.jsx("div",{className:"border-t border-white/20 pt-8 text-center md:text-left",children:se.jsxs("p",{className:"text-base text-white/80 font-medium",children:[" 2025 ",se.jsx("span",{className:"text-[#00E5FF]",children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]}),"  ALL RIGHTS RESERVED  NIYVORA KFT"]})})]})}),md=["en","it","fr","es","de","pt","zh","ar"];const pd={en:{heroTitle:"M1SSION",heroSubtitle:"The Ultimate Challenge",heroDescription:"A prize awaits those who can see beyond. The clues are not hidden: they are disguised. It requires logic, coldness and vision. The challenge has begun.",joinTheHunt:"JOIN THE HUNT",learnMore:"LEARN MORE",missionStartsOn:"M1SSION STARTS ON 19 AUGUST",realPrizes:"REAL PRIZES",realPrizesDescription:"Not simulations. Not virtual tokens. Tangible prizes you can touch, use, own.",imageRepresentation:"Image for representation purposes",welcomeToMission:"WELCOME TO M1SSION",registerForMission:"Register for M1SSION",startMission:"START M1SSION",discoverMission:"Discover M1SSION",gdpr:{cookieTitle:"Cookie Settings",cookieDescription:'We use cookies to enhance your experience, analyze site usage, and assist in our marketing efforts. By clicking "Accept All", you consent to our use of cookies.',cookieSettings:"Cookie Settings",cookiePreferences:"Cookie Preferences",acceptAll:"Accept All",rejectAll:"Reject All",saveSettings:"Save Settings",required:"Required",necessaryCookies:"Necessary Cookies",necessaryDescription:"Essential for the website to function properly. Cannot be disabled.",functionalCookies:"Functional Cookies",functionalDescription:"Enable enhanced functionality and personalization.",analyticsCookies:"Analytics Cookies",analyticsDescription:"Help us understand how visitors interact with the website.",marketingCookies:"Marketing Cookies",marketingDescription:"Used to track visitors and display relevant ads."}},it:{heroTitle:"M1SSION",heroSubtitle:"La Sfida Definitiva",heroDescription:"Un premio attende chi sa vedere oltre. Gli indizi non sono nascosti: sono camuffati. Serve logica, freddezza e visione. La sfida  iniziata.",joinTheHunt:"UNISCITI ALLA CACCIA",learnMore:"SCOPRI DI PI",missionStartsOn:"M1SSION INIZIA IL 19 AGOSTO",realPrizes:"PREMI REALI",realPrizesDescription:"Non simulazioni. Non gettoni virtuali. Premi tangibili che puoi toccare, usare, possedere.",imageRepresentation:"Immagine a scopo rappresentativo",welcomeToMission:"BENVENUTO IN M1SSION",registerForMission:"Registrati per M1SSION",startMission:"INIZIA M1SSION",discoverMission:"Scopri M1SSION",gdpr:{cookieTitle:"Impostazioni Cookie",cookieDescription:"Utilizziamo i cookie per migliorare la tua esperienza, analizzare l'utilizzo del sito e assistere nei nostri sforzi di marketing. Cliccando \"Accetta Tutto\", acconsenti all'uso dei nostri cookie.",cookieSettings:"Impostazioni Cookie",cookiePreferences:"Preferenze Cookie",acceptAll:"Accetta Tutto",rejectAll:"Rifiuta Tutto",saveSettings:"Salva Impostazioni",required:"Richiesto",necessaryCookies:"Cookie Necessari",necessaryDescription:"Essenziali per il corretto funzionamento del sito web. Non possono essere disabilitati.",functionalCookies:"Cookie Funzionali",functionalDescription:"Abilitano funzionalit avanzate e personalizzazione.",analyticsCookies:"Cookie Analytics",analyticsDescription:"Ci aiutano a capire come i visitatori interagiscono con il sito web.",marketingCookies:"Cookie Marketing",marketingDescription:"Utilizzati per tracciare i visitatori e mostrare annunci pertinenti."}},fr:{heroTitle:"M1SSION",heroSubtitle:"Le Dfi Ultime",heroDescription:"Un prix attend ceux qui savent voir au-del. Les indices ne sont pas cachs : ils sont dguiss. Il faut de la logique, de la froideur et de la vision. Le dfi a commenc.",joinTheHunt:"REJOIGNEZ LA CHASSE",learnMore:"EN SAVOIR PLUS",missionStartsOn:"M1SSION COMMENCE LE 19 AOT",realPrizes:"VRAIS PRIX",realPrizesDescription:"Pas de simulations. Pas de jetons virtuels. Des prix tangibles que vous pouvez toucher, utiliser, possder.",imageRepresentation:"Image  des fins de reprsentation",welcomeToMission:"BIENVENUE DANS M1SSION",registerForMission:"S'inscrire  M1SSION",startMission:"COMMENCER M1SSION",discoverMission:"Dcouvrir M1SSION",gdpr:{cookieTitle:"Paramtres des Cookies",cookieDescription:'Nous utilisons des cookies pour amliorer votre exprience, analyser l\'utilisation du site et assister dans nos efforts marketing. En cliquant sur "Tout Accepter", vous consentez  notre utilisation des cookies.',cookieSettings:"Paramtres des Cookies",cookiePreferences:"Prfrences des Cookies",acceptAll:"Tout Accepter",rejectAll:"Tout Rejeter",saveSettings:"Sauvegarder les Paramtres",required:"Requis",necessaryCookies:"Cookies Ncessaires",necessaryDescription:"Essentiels pour le bon fonctionnement du site web. Ne peuvent pas tre dsactivs.",functionalCookies:"Cookies Fonctionnels",functionalDescription:"Permettent des fonctionnalits amliores et la personnalisation.",analyticsCookies:"Cookies Analytics",analyticsDescription:"Nous aident  comprendre comment les visiteurs interagissent avec le site web.",marketingCookies:"Cookies Marketing",marketingDescription:"Utiliss pour suivre les visiteurs et afficher des publicits pertinentes."}},es:{heroTitle:"M1SSION",heroSubtitle:"El Desafo Definitivo",heroDescription:"Un premio espera a quienes saben ver ms all. Las pistas no estn ocultas: estn disfrazadas. Requiere lgica, frialdad y visin. El desafo ha comenzado.",joinTheHunt:"NETE A LA CAZA",learnMore:"SABER MS",missionStartsOn:"M1SSION COMIENZA EL 19 DE AGOSTO",realPrizes:"PREMIOS REALES",realPrizesDescription:"No simulaciones. No tokens virtuales. Premios tangibles que puedes tocar, usar, poseer.",imageRepresentation:"Imagen con fines representativos",welcomeToMission:"BIENVENIDO A M1SSION",registerForMission:"Regstrate para M1SSION",startMission:"INICIAR M1SSION",discoverMission:"Descubrir M1SSION",gdpr:{cookieTitle:"Configuracin de Cookies",cookieDescription:'Utilizamos cookies para mejorar tu experiencia, analizar el uso del sitio y asistir en nuestros esfuerzos de marketing. Al hacer clic en "Aceptar Todo", consientes nuestro uso de cookies.',cookieSettings:"Configuracin de Cookies",cookiePreferences:"Preferencias de Cookies",acceptAll:"Aceptar Todo",rejectAll:"Rechazar Todo",saveSettings:"Guardar Configuracin",required:"Requerido",necessaryCookies:"Cookies Necesarias",necessaryDescription:"Esenciales para el funcionamiento correcto del sitio web. No se pueden desactivar.",functionalCookies:"Cookies Funcionales",functionalDescription:"Permiten funcionalidad mejorada y personalizacin.",analyticsCookies:"Cookies Analytics",analyticsDescription:"Nos ayudan a entender cmo los visitantes interactan con el sitio web.",marketingCookies:"Cookies Marketing",marketingDescription:"Utilizadas para rastrear visitantes y mostrar anuncios relevantes."}},de:{heroTitle:"M1SSION",heroSubtitle:"Die Ultimative Herausforderung",heroDescription:"Ein Preis wartet auf diejenigen, die ber das Offensichtliche hinaussehen knnen. Die Hinweise sind nicht versteckt: sie sind getarnt. Es erfordert Logik, Klte und Vision. Die Herausforderung hat begonnen.",joinTheHunt:"DER JAGD BEITRETEN",learnMore:"MEHR ERFAHREN",missionStartsOn:"M1SSION BEGINNT AM 19. AUGUST",realPrizes:"ECHTE PREISE",realPrizesDescription:"Keine Simulationen. Keine virtuellen Token. Greifbare Preise, die Sie berhren, verwenden, besitzen knnen.",imageRepresentation:"Bild zu Darstellungszwecken",welcomeToMission:"WILLKOMMEN BEI M1SSION",registerForMission:"Fr M1SSION registrieren",startMission:"M1SSION STARTEN",discoverMission:"M1SSION Entdecken",gdpr:{cookieTitle:"Cookie-Einstellungen",cookieDescription:'Wir verwenden Cookies, um Ihre Erfahrung zu verbessern, die Nutzung der Website zu analysieren und bei unseren Marketingbemhungen zu helfen. Durch Klicken auf "Alle Akzeptieren" stimmen Sie unserer Verwendung von Cookies zu.',cookieSettings:"Cookie-Einstellungen",cookiePreferences:"Cookie-Prferenzen",acceptAll:"Alle Akzeptieren",rejectAll:"Alle Ablehnen",saveSettings:"Einstellungen Speichern",required:"Erforderlich",necessaryCookies:"Notwendige Cookies",necessaryDescription:"Wesentlich fr das ordnungsgeme Funktionieren der Website. Knnen nicht deaktiviert werden.",functionalCookies:"Funktionale Cookies",functionalDescription:"Ermglichen erweiterte Funktionalitt und Personalisierung.",analyticsCookies:"Analytics Cookies",analyticsDescription:"Helfen uns zu verstehen, wie Besucher mit der Website interagieren.",marketingCookies:"Marketing Cookies",marketingDescription:"Werden verwendet, um Besucher zu verfolgen und relevante Werbung anzuzeigen."}},pt:{heroTitle:"M1SSION",heroSubtitle:"O Desafio Definitivo",heroDescription:"Um prmio aguarda aqueles que sabem ver alm. As pistas no esto escondidas: esto disfaradas. Requer lgica, frieza e viso. O desafio comeou.",joinTheHunt:"JUNTE-SE  CAADA",learnMore:"SABER MAIS",missionStartsOn:"M1SSION COMEA EM 19 DE AGOSTO",realPrizes:"PRMIOS REAIS",realPrizesDescription:"No simulaes. No tokens virtuais. Prmios tangveis que voc pode tocar, usar, possuir.",imageRepresentation:"Imagem para fins de representao",welcomeToMission:"BEM-VINDO  M1SSION",registerForMission:"Registre-se para M1SSION",startMission:"INICIAR M1SSION",discoverMission:"Descobrir M1SSION",gdpr:{cookieTitle:"Configuraes de Cookies",cookieDescription:'Usamos cookies para melhorar sua experincia, analisar o uso do site e auxiliar em nossos esforos de marketing. Ao clicar em "Aceitar Tudo", voc consente com nosso uso de cookies.',cookieSettings:"Configuraes de Cookies",cookiePreferences:"Preferncias de Cookies",acceptAll:"Aceitar Tudo",rejectAll:"Rejeitar Tudo",saveSettings:"Salvar Configuraes",required:"Obrigatrio",necessaryCookies:"Cookies Necessrios",necessaryDescription:"Essenciais para o funcionamento adequado do site. No podem ser desabilitados.",functionalCookies:"Cookies Funcionais",functionalDescription:"Permitem funcionalidade aprimorada e personalizao.",analyticsCookies:"Cookies Analytics",analyticsDescription:"Nos ajudam a entender como os visitantes interagem com o site.",marketingCookies:"Cookies Marketing",marketingDescription:"Usados para rastrear visitantes e exibir anncios relevantes."}},zh:{heroTitle:"M1SSION",heroSubtitle:"",heroDescription:"",joinTheHunt:"",learnMore:"",missionStartsOn:"M1SSION  8  19 ",realPrizes:"",realPrizesDescription:"",imageRepresentation:"",welcomeToMission:" M1SSION",registerForMission:" M1SSION",startMission:" M1SSION",discoverMission:" M1SSION",gdpr:{cookieTitle:"Cookie ",cookieDescription:' cookie "" cookie',cookieSettings:"Cookie ",cookiePreferences:"Cookie ",acceptAll:"",rejectAll:"",saveSettings:"",required:"",necessaryCookies:" Cookie",necessaryDescription:"",functionalCookies:" Cookie",functionalDescription:"",analyticsCookies:" Cookie",analyticsDescription:"",marketingCookies:" Cookie",marketingDescription:""}},ar:{heroTitle:"M1SSION",heroSubtitle:" ",heroDescription:"        .   :  .    .   .",joinTheHunt:" ",learnMore:" ",missionStartsOn:"M1SSION   19 ",realPrizes:" ",realPrizesDescription:" .   .      .",imageRepresentation:"  ",welcomeToMission:"   M1SSION",registerForMission:"  M1SSION",startMission:" M1SSION",discoverMission:" M1SSION",gdpr:{cookieTitle:"   ",cookieDescription:'            .   " "       .',cookieSettings:"   ",cookiePreferences:"   ",acceptAll:" ",rejectAll:" ",saveSettings:" ",required:"",necessaryCookies:"   ",necessaryDescription:"   .   .",functionalCookies:"   ",functionalDescription:"   .",analyticsCookies:"   ",analyticsDescription:"       .",marketingCookies:"   ",marketingDescription:"      ."}}},fd=()=>{const[e,t]=We.useState("en"),[i,a]=We.useState(pd.en);We.useEffect(()=>{const e=function(){try{const e=navigator.language||navigator.userLanguage;if(!e)return console.warn("Unable to detect browser language, using English fallback"),"en";const t=e.toLowerCase().split("-")[0];return md.includes(t)?t:"en"}catch(e){return console.error("Error detecting language:",e),"en"}}();t(e),a(pd[e])},[]);return{t:t=>{const a=t.split(".");let s=i;for(const i of a)if(s=s?.[i],void 0===s)return console.warn(`Translation key "${t}" not found for language "${e}"`),t;return s},currentLanguage:e,setLanguage:e=>{t(e),a(pd[e])}}},gd=()=>{const{t:e}=fd(),[t,i]=We.useState(!1),[a,s]=We.useState(!1),[r,n]=We.useState({necessary:!0,analytics:!1,marketing:!1,functional:!1});We.useEffect(()=>{const e=localStorage.getItem("cookie_consent")||localStorage.getItem("m1ssion-cookie-consent"),t=(new Date).toISOString().split("T")[0],a=localStorage.getItem("cookie_banner_last_shown");if(!e||a!==t){const e=setTimeout(()=>i(!0),1e3);return()=>clearTimeout(e)}},[]);const o=()=>{const e={necessary:!0,analytics:!1,marketing:!1,functional:!1},t=(new Date).toISOString().split("T")[0];localStorage.setItem("cookie_consent",JSON.stringify(e)),localStorage.setItem("cookie_banner_last_shown",t),localStorage.setItem("m1ssion-cookie-consent",JSON.stringify(e)),localStorage.setItem("m1ssion-cookie-timestamp",(new Date).toISOString()),i(!1)};return se.jsx(tt,{children:t&&se.jsx(et.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{duration:.5,ease:"easeOut"},className:"fixed inset-0 flex items-center justify-center z-[9999] p-4",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 20px)",paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 20px)",backgroundColor:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)"},children:se.jsx("div",{className:"max-w-6xl mx-auto",children:se.jsx("div",{className:"bg-black/95 backdrop-blur-xl border border-cyan-400/30 rounded-2xl p-6 shadow-[0_0_30px_rgba(0,229,255,0.3)]",children:a?se.jsxs("div",{children:[se.jsxs("div",{className:"flex items-center justify-between mb-6",children:[se.jsx("h3",{className:"text-xl font-bold text-white",children:e("gdpr.cookiePreferences")||"Cookie Preferences"}),se.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-white transition-colors",children:se.jsx($r,{className:"w-6 h-6"})})]}),se.jsx("div",{className:"space-y-4 mb-6",children:[{key:"necessary",title:e("gdpr.necessaryCookies")||"Necessary Cookies",description:e("gdpr.necessaryDescription")||"Essential for the website to function properly. Cannot be disabled.",required:!0},{key:"functional",title:e("gdpr.functionalCookies")||"Functional Cookies",description:e("gdpr.functionalDescription")||"Enable enhanced functionality and personalization.",required:!1},{key:"analytics",title:e("gdpr.analyticsCookies")||"Analytics Cookies",description:e("gdpr.analyticsDescription")||"Help us understand how visitors interact with the website.",required:!1},{key:"marketing",title:e("gdpr.marketingCookies")||"Marketing Cookies",description:e("gdpr.marketingDescription")||"Used to track visitors and display relevant ads.",required:!1}].map(t=>se.jsxs("div",{className:"flex items-start justify-between p-4 rounded-lg bg-white/5 border border-white/10",children:[se.jsxs("div",{className:"flex-1",children:[se.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[se.jsx("h4",{className:"font-semibold text-white",children:t.title}),t.required&&se.jsx("span",{className:"text-xs bg-cyan-400/20 text-cyan-400 px-2 py-1 rounded",children:e("gdpr.required")||"Required"})]}),se.jsx("p",{className:"text-sm text-gray-400",children:t.description})]}),se.jsx("div",{className:"ml-4",children:se.jsx("button",{onClick:()=>{var e;"necessary"!==(e=t.key)&&n(t=>({...t,[e]:!t[e]}))},disabled:t.required,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${r[t.key]?"bg-cyan-400":"bg-gray-600"} ${t.required?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:se.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(r[t.key]?"translate-x-6":"translate-x-1")})})})]},t.key))}),se.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[se.jsx(mo,{onClick:o,variant:"outline",className:"text-gray-300 border-gray-500/50 hover:bg-gray-500/10 hover:border-gray-400 transition-all duration-300",children:e("gdpr.rejectAll")||"Reject All"}),se.jsx(mo,{onClick:()=>{const e=(new Date).toISOString().split("T")[0];localStorage.setItem("cookie_consent",JSON.stringify(r)),localStorage.setItem("cookie_banner_last_shown",e),localStorage.setItem("m1ssion-cookie-consent",JSON.stringify(r)),localStorage.setItem("m1ssion-cookie-timestamp",(new Date).toISOString()),i(!1),s(!1)},className:"bg-gradient-to-r from-cyan-400 to-purple-600 text-black font-bold hover:shadow-[0_0_20px_rgba(0,229,255,0.5)] transition-all duration-300 flex-1",children:e("gdpr.saveSettings")||"Save Settings"})]})]}):se.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-6",children:[se.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[se.jsx(vs,{className:"w-8 h-8 text-cyan-400 mt-1 flex-shrink-0"}),se.jsxs("div",{className:"flex-1",children:[se.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:e("gdpr.cookieTitle")||"Cookie Settings"}),se.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:e("gdpr.cookieDescription")||'We use cookies to enhance your experience, analyze site usage, and assist in our marketing efforts. By clicking "Accept All", you consent to our use of cookies.'})]})]}),se.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 lg:ml-4",children:[se.jsxs(mo,{onClick:()=>s(!0),variant:"outline",className:"text-cyan-400 border-cyan-400/50 hover:bg-cyan-400/10 hover:border-cyan-400 transition-all duration-300",children:[se.jsx(xr,{className:"w-4 h-4 mr-2"}),e("gdpr.cookieSettings")||"Cookie Settings"]}),se.jsx(mo,{onClick:o,variant:"outline",className:"text-gray-300 border-gray-500/50 hover:bg-gray-500/10 hover:border-gray-400 transition-all duration-300",children:e("gdpr.rejectAll")||"Reject All"}),se.jsx(mo,{onClick:()=>{const e={necessary:!0,analytics:!0,marketing:!0,functional:!0},t=(new Date).toISOString().split("T")[0];localStorage.setItem("cookie_consent",JSON.stringify(e)),localStorage.setItem("cookie_banner_last_shown",t),localStorage.setItem("m1ssion-cookie-consent",JSON.stringify(e)),localStorage.setItem("m1ssion-cookie-timestamp",(new Date).toISOString()),i(!1)},className:"bg-gradient-to-r from-cyan-400 to-purple-600 text-black font-bold hover:shadow-[0_0_20px_rgba(0,229,255,0.5)] transition-all duration-300",children:e("gdpr.acceptAll")||"Accept All"})]})]})})})})})};function xd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bd(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var vd,yd,wd,Nd,jd,Sd,_d,kd,Cd,Ad,zd,Ed,Id,Pd,Td,Md,Ld,Fd,Od,Dd,Rd,Bd,Ud,qd,$d,Wd,Hd,Zd,Vd,Gd,Yd,Kd,Xd={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Jd={duration:.5,overwrite:!1,delay:0},Qd=1e8,eu=1e-8,tu=2*Math.PI,iu=tu/4,au=0,su=Math.sqrt,ru=Math.cos,nu=Math.sin,ou=function(e){return"string"==typeof e},lu=function(e){return"function"==typeof e},cu=function(e){return"number"==typeof e},du=function(e){return void 0===e},uu=function(e){return"object"==typeof e},hu=function(e){return!1!==e},mu=function(){return"undefined"!=typeof window},pu=function(e){return lu(e)||ou(e)},fu="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},gu=Array.isArray,xu=/(?:-?\.?\d|\.)+/gi,bu=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,vu=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,yu=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,wu=/[+-]=-?[.\d]+/,Nu=/[^,'"\[\]\s]+/gi,ju=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Su={},_u={},ku=function(e){return(_u=ih(e,Su))&&ip},Cu=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Au=function(e,t){return!t&&console.warn(e)},zu=function(e,t){return e&&(Su[e]=t)&&_u&&(_u[e]=t)||Su},Eu=function(){return 0},Iu={suppressEvents:!0,isStart:!0,kill:!1},Pu={suppressEvents:!0,kill:!1},Tu={suppressEvents:!0},Mu={},Lu=[],Fu={},Ou={},Du={},Ru=30,Bu=[],Uu="",qu=function(e){var t,i,a=e[0];if(uu(a)||lu(a)||(e=[e]),!(t=(a._gsap||{}).harness)){for(i=Bu.length;i--&&!Bu[i].targetTest(a););t=Bu[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new gm(e[i],t)))||e.splice(i,1);return e},$u=function(e){return e._gsap||qu(Th(e))[0]._gsap},Wu=function(e,t,i){return(i=e[t])&&lu(i)?e[t]():du(i)&&e.getAttribute&&e.getAttribute(t)||i},Hu=function(e,t){return(e=e.split(",")).forEach(t)||e},Zu=function(e){return Math.round(1e5*e)/1e5||0},Vu=function(e){return Math.round(1e7*e)/1e7||0},Gu=function(e,t){var i=t.charAt(0),a=parseFloat(t.substr(2));return e=parseFloat(e),"+"===i?e+a:"-"===i?e-a:"*"===i?e*a:e/a},Yu=function(e,t){for(var i=t.length,a=0;e.indexOf(t[a])<0&&++a<i;);return a<i},Ku=function(){var e,t,i=Lu.length,a=Lu.slice(0);for(Fu={},Lu.length=0,e=0;e<i;e++)(t=a[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},Xu=function(e){return!!(e._initted||e._startAt||e.add)},Ju=function(e,t,i,a){Lu.length&&!yd&&Ku(),e.render(t,i,!!(yd&&t<0&&Xu(e))),Lu.length&&!yd&&Ku()},Qu=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(Nu).length<2?t:ou(e)?e.trim():e},eh=function(e){return e},th=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},ih=function(e,t){for(var i in t)e[i]=t[i];return e},ah=function e(t,i){for(var a in i)"__proto__"!==a&&"constructor"!==a&&"prototype"!==a&&(t[a]=uu(i[a])?e(t[a]||(t[a]={}),i[a]):i[a]);return t},sh=function(e,t){var i,a={};for(i in e)i in t||(a[i]=e[i]);return a},rh=function(e){var t,i=e.parent||Nd,a=e.keyframes?(t=gu(e.keyframes),function(e,i){for(var a in i)a in e||"duration"===a&&t||"ease"===a||(e[a]=i[a])}):th;if(hu(e.inherit))for(;i;)a(e,i.vars.defaults),i=i.parent||i._dp;return e},nh=function(e,t,i,a,s){var r,n=e[a];if(s)for(r=t[s];n&&n[s]>r;)n=n._prev;return n?(t._next=n._next,n._next=t):(t._next=e[i],e[i]=t),t._next?t._next._prev=t:e[a]=t,t._prev=n,t.parent=t._dp=e,t},oh=function(e,t,i,a){void 0===i&&(i="_first"),void 0===a&&(a="_last");var s=t._prev,r=t._next;s?s._next=r:e[i]===t&&(e[i]=r),r?r._prev=s:e[a]===t&&(e[a]=s),t._next=t._prev=t.parent=null},lh=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},ch=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var i=e;i;)i._dirty=1,i=i.parent;return e},dh=function(e,t,i,a){return e._startAt&&(yd?e._startAt.revert(Pu):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,a))},uh=function e(t){return!t||t._ts&&e(t.parent)},hh=function(e){return e._repeat?mh(e._tTime,e=e.duration()+e._rDelay)*e:0},mh=function(e,t){var i=Math.floor(e=Vu(e/t));return e&&i===e?i-1:i},ph=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},fh=function(e){return e._end=Vu(e._start+(e._tDur/Math.abs(e._ts||e._rts||eu)||0))},gh=function(e,t){var i=e._dp;return i&&i.smoothChildTiming&&e._ts&&(e._start=Vu(i._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),fh(e),i._dirty||ch(i,e)),e},xh=function(e,t){var i;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(i=ph(e.rawTime(),t),(!t._dur||zh(0,t.totalDuration(),i)-t._tTime>eu)&&t.render(i,!0)),ch(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(i=e;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;e._zTime=-1e-8}},bh=function(e,t,i,a){return t.parent&&lh(t),t._start=Vu((cu(i)?i:i||e!==Nd?kh(e,i,t):e._time)+t._delay),t._end=Vu(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),nh(e,t,"_first","_last",e._sort?"_start":0),Nh(t)||(e._recent=t),a||xh(e,t),e._ts<0&&gh(e,e._tTime),e},vh=function(e,t){return(Su.ScrollTrigger||Cu("scrollTrigger",t))&&Su.ScrollTrigger.create(t,e)},yh=function(e,t,i,a,s){return Sm(e,t,s),e._initted?!i&&e._pt&&!yd&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&Cd!==am.frame?(Lu.push(e),e._lazy=[s,a],1):void 0:1},wh=function e(t){var i=t.parent;return i&&i._ts&&i._initted&&!i._lock&&(i.rawTime()<0||e(i))},Nh=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},jh=function(e,t,i,a){var s=e._repeat,r=Vu(t)||0,n=e._tTime/e._tDur;return n&&!a&&(e._time*=r/e._dur),e._dur=r,e._tDur=s?s<0?1e10:Vu(r*(s+1)+e._rDelay*s):r,n>0&&!a&&gh(e,e._tTime=e._tDur*n),e.parent&&fh(e),i||ch(e.parent,e),e},Sh=function(e){return e instanceof bm?ch(e):jh(e,e._dur)},_h={_start:0,endTime:Eu,totalDuration:Eu},kh=function e(t,i,a){var s,r,n,o=t.labels,l=t._recent||_h,c=t.duration()>=Qd?l.endTime(!1):t._dur;return ou(i)&&(isNaN(i)||i in o)?(r=i.charAt(0),n="%"===i.substr(-1),s=i.indexOf("="),"<"===r||">"===r?(s>=0&&(i=i.replace(/=/,"")),("<"===r?l._start:l.endTime(l._repeat>=0))+(parseFloat(i.substr(1))||0)*(n?(s<0?l:a).totalDuration()/100:1)):s<0?(i in o||(o[i]=c),o[i]):(r=parseFloat(i.charAt(s-1)+i.substr(s+1)),n&&a&&(r=r/100*(gu(a)?a[0]:a).totalDuration()),s>1?e(t,i.substr(0,s-1),a)+r:c+r)):null==i?c:+i},Ch=function(e,t,i){var a,s,r=cu(t[1]),n=(r?2:1)+(e<2?0:1),o=t[n];if(r&&(o.duration=t[1]),o.parent=i,e){for(a=o,s=i;s&&!("immediateRender"in a);)a=s.vars.defaults||{},s=hu(s.vars.inherit)&&s.parent;o.immediateRender=hu(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[n-1]}return new zm(t[0],o,t[n+1])},Ah=function(e,t){return e||0===e?t(e):t},zh=function(e,t,i){return i<e?e:i>t?t:i},Eh=function(e,t){return ou(e)&&(t=ju.exec(e))?t[1]:""},Ih=[].slice,Ph=function(e,t){return e&&uu(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&uu(e[0]))&&!e.nodeType&&e!==jd},Th=function(e,t,i){return wd&&!t&&wd.selector?wd.selector(e):!ou(e)||i||!Sd&&sm()?gu(e)?function(e,t,i){return void 0===i&&(i=[]),e.forEach(function(e){var a;return ou(e)&&!t||Ph(e,1)?(a=i).push.apply(a,Th(e)):i.push(e)})||i}(e,i):Ph(e)?Ih.call(e,0):e?[e]:[]:Ih.call((t||_d).querySelectorAll(e),0)},Mh=function(e){return e=Th(e)[0]||Au("Invalid scope")||{},function(t){var i=e.current||e.nativeElement||e;return Th(t,i.querySelectorAll?i:i===e?Au("Invalid scope")||_d.createElement("div"):e)}},Lh=function(e){return e.sort(function(){return.5-Math.random()})},Fh=function(e){if(lu(e))return e;var t=uu(e)?e:{each:e},i=um(t.ease),a=t.from||0,s=parseFloat(t.base)||0,r={},n=a>0&&a<1,o=isNaN(a)||n,l=t.axis,c=a,d=a;return ou(a)?c=d={center:.5,edges:.5,end:1}[a]||0:!n&&o&&(c=a[0],d=a[1]),function(e,n,u){var h,m,p,f,g,x,b,v,y,w=(u||t).length,N=r[w];if(!N){if(!(y="auto"===t.grid?0:(t.grid||[1,Qd])[1])){for(b=-1e8;b<(b=u[y++].getBoundingClientRect().left)&&y<w;);y<w&&y--}for(N=r[w]=[],h=o?Math.min(y,w)*c-.5:a%y,m=y===Qd?0:o?w*d/y-.5:a/y|0,b=0,v=Qd,x=0;x<w;x++)p=x%y-h,f=m-(x/y|0),N[x]=g=l?Math.abs("y"===l?f:p):su(p*p+f*f),g>b&&(b=g),g<v&&(v=g);"random"===a&&Lh(N),N.max=b-v,N.min=v,N.v=w=(parseFloat(t.amount)||parseFloat(t.each)*(y>w?w-1:l?"y"===l?w/y:y:Math.max(y,w/y))||0)*("edges"===a?-1:1),N.b=w<0?s-w:s,N.u=Eh(t.amount||t.each)||0,i=i&&w<0?cm(i):i}return w=(N[e]-N.min)/N.max||0,Vu(N.b+(i?i(w):w)*N.v)+N.u}},Oh=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(i){var a=Vu(Math.round(parseFloat(i)/e)*e*t);return(a-a%1)/t+(cu(i)?0:Eh(i))}},Dh=function(e,t){var i,a,s=gu(e);return!s&&uu(e)&&(i=s=e.radius||Qd,e.values?(e=Th(e.values),(a=!cu(e[0]))&&(i*=i)):e=Oh(e.increment)),Ah(t,s?lu(e)?function(t){return a=e(t),Math.abs(a-t)<=i?a:t}:function(t){for(var s,r,n=parseFloat(a?t.x:t),o=parseFloat(a?t.y:0),l=Qd,c=0,d=e.length;d--;)(s=a?(s=e[d].x-n)*s+(r=e[d].y-o)*r:Math.abs(e[d]-n))<l&&(l=s,c=d);return c=!i||l<=i?e[c]:t,a||c===t||cu(t)?c:c+Eh(t)}:Oh(e))},Rh=function(e,t,i,a){return Ah(gu(e)?!t:!0===i?!!(i=0):!a,function(){return gu(e)?e[~~(Math.random()*e.length)]:(i=i||1e-5)&&(a=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((e-i/2+Math.random()*(t-e+.99*i))/i)*i*a)/a})},Bh=function(e,t,i){return Ah(i,function(i){return e[~~t(i)]})},Uh=function(e){for(var t,i,a,s,r=0,n="";~(t=e.indexOf("random(",r));)a=e.indexOf(")",t),s="["===e.charAt(t+7),i=e.substr(t+7,a-t-7).match(s?Nu:xu),n+=e.substr(r,t-r)+Rh(s?i:+i[0],s?0:+i[1],+i[2]||1e-5),r=a+1;return n+e.substr(r,e.length-r)},qh=function(e,t,i,a,s){var r=t-e,n=a-i;return Ah(s,function(t){return i+((t-e)/r*n||0)})},$h=function(e,t,i){var a,s,r,n=e.labels,o=Qd;for(a in n)(s=n[a]-t)<0==!!i&&s&&o>(s=Math.abs(s))&&(r=a,o=s);return r},Wh=function(e,t,i){var a,s,r,n=e.vars,o=n[t],l=wd,c=e._ctx;if(o)return a=n[t+"Params"],s=n.callbackScope||e,i&&Lu.length&&Ku(),c&&(wd=c),r=a?o.apply(s,a):o.call(s),wd=l,r},Hh=function(e){return lh(e),e.scrollTrigger&&e.scrollTrigger.kill(!!yd),e.progress()<1&&Wh(e,"onInterrupt"),e},Zh=[],Vh=function(e){if(e)if(e=!e.name&&e.default||e,mu()||e.headless){var t=e.name,i=lu(e),a=t&&!i&&e.init?function(){this._props=[]}:e,s={init:Eu,render:Dm,add:Nm,kill:Bm,modifier:Rm,rawVars:0},r={targetTest:0,get:0,getSetter:Mm,aliases:{},register:0};if(sm(),e!==a){if(Ou[t])return;th(a,th(sh(e,s),r)),ih(a.prototype,ih(s,sh(e,r))),Ou[a.prop=t]=a,e.targetTest&&(Bu.push(a),Mu[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}zu(t,a),e.register&&e.register(ip,a,$m)}else Zh.push(e)},Gh=255,Yh={aqua:[0,Gh,Gh],lime:[0,Gh,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Gh],navy:[0,0,128],white:[Gh,Gh,Gh],olive:[128,128,0],yellow:[Gh,Gh,0],orange:[Gh,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Gh,0,0],pink:[Gh,192,203],cyan:[0,Gh,Gh],transparent:[Gh,Gh,Gh,0]},Kh=function(e,t,i){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(i-t)*e*6:e<.5?i:3*e<2?t+(i-t)*(2/3-e)*6:t)*Gh+.5|0},Xh=function(e,t,i){var a,s,r,n,o,l,c,d,u,h,m=e?cu(e)?[e>>16,e>>8&Gh,e&Gh]:0:Yh.black;if(!m){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),Yh[e])m=Yh[e];else if("#"===e.charAt(0)){if(e.length<6&&(a=e.charAt(1),s=e.charAt(2),r=e.charAt(3),e="#"+a+a+s+s+r+r+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(m=parseInt(e.substr(1,6),16))>>16,m>>8&Gh,m&Gh,parseInt(e.substr(7),16)/255];m=[(e=parseInt(e.substr(1),16))>>16,e>>8&Gh,e&Gh]}else if("hsl"===e.substr(0,3))if(m=h=e.match(xu),t){if(~e.indexOf("="))return m=e.match(bu),i&&m.length<4&&(m[3]=1),m}else n=+m[0]%360/360,o=+m[1]/100,a=2*(l=+m[2]/100)-(s=l<=.5?l*(o+1):l+o-l*o),m.length>3&&(m[3]*=1),m[0]=Kh(n+1/3,a,s),m[1]=Kh(n,a,s),m[2]=Kh(n-1/3,a,s);else m=e.match(xu)||Yh.transparent;m=m.map(Number)}return t&&!h&&(a=m[0]/Gh,s=m[1]/Gh,r=m[2]/Gh,l=((c=Math.max(a,s,r))+(d=Math.min(a,s,r)))/2,c===d?n=o=0:(u=c-d,o=l>.5?u/(2-c-d):u/(c+d),n=c===a?(s-r)/u+(s<r?6:0):c===s?(r-a)/u+2:(a-s)/u+4,n*=60),m[0]=~~(n+.5),m[1]=~~(100*o+.5),m[2]=~~(100*l+.5)),i&&m.length<4&&(m[3]=1),m},Jh=function(e){var t=[],i=[],a=-1;return e.split(em).forEach(function(e){var s=e.match(vu)||[];t.push.apply(t,s),i.push(a+=s.length+1)}),t.c=i,t},Qh=function(e,t,i){var a,s,r,n,o="",l=(e+o).match(em),c=t?"hsla(":"rgba(",d=0;if(!l)return e;if(l=l.map(function(e){return(e=Xh(e,t,1))&&c+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"}),i&&(r=Jh(e),(a=i.c).join(o)!==r.c.join(o)))for(n=(s=e.replace(em,"1").split(vu)).length-1;d<n;d++)o+=s[d]+(~a.indexOf(d)?l.shift()||c+"0,0,0,0)":(r.length?r:l.length?l:i).shift());if(!s)for(n=(s=e.split(em)).length-1;d<n;d++)o+=s[d]+l[d];return o+s[n]},em=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in Yh)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),tm=/hsl[a]?\(/,im=function(e){var t,i=e.join(" ");if(em.lastIndex=0,em.test(i))return t=tm.test(i),e[1]=Qh(e[1],t),e[0]=Qh(e[0],t,Jh(e[1])),!0},am=(Fd=Date.now,Od=500,Dd=33,Rd=Fd(),Bd=Rd,qd=Ud=1e3/240,Wd=function e(t){var i,a,s,r,n=Fd()-Bd,o=!0===t;if((n>Od||n<0)&&(Rd+=n-Dd),((i=(s=(Bd+=n)-Rd)-qd)>0||o)&&(r=++Td.frame,Md=s-1e3*Td.time,Td.time=s/=1e3,qd+=i+(i>=Ud?4:Ud-i),a=1),o||(Ed=Id(e)),a)for(Ld=0;Ld<$d.length;Ld++)$d[Ld](s,Md,r,t)},Td={time:0,frame:0,tick:function(){Wd(!0)},deltaRatio:function(e){return Md/(1e3/(e||60))},wake:function(){kd&&(!Sd&&mu()&&(jd=Sd=window,_d=jd.document||{},Su.gsap=ip,(jd.gsapVersions||(jd.gsapVersions=[])).push(ip.version),ku(_u||jd.GreenSockGlobals||!jd.gsap&&jd||{}),Zh.forEach(Vh)),Pd="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame,Ed&&Td.sleep(),Id=Pd||function(e){return setTimeout(e,qd-1e3*Td.time+1|0)},zd=1,Wd(2))},sleep:function(){(Pd?cancelAnimationFrame:clearTimeout)(Ed),zd=0,Id=Eu},lagSmoothing:function(e,t){Od=e||1/0,Dd=Math.min(t||33,Od)},fps:function(e){Ud=1e3/(e||240),qd=1e3*Td.time+Ud},add:function(e,t,i){var a=t?function(t,i,s,r){e(t,i,s,r),Td.remove(a)}:e;return Td.remove(e),$d[i?"unshift":"push"](a),sm(),a},remove:function(e,t){~(t=$d.indexOf(e))&&$d.splice(t,1)&&Ld>=t&&Ld--},_listeners:$d=[]}),sm=function(){return!zd&&am.wake()},rm={},nm=/^[\d.\-M][\d.\-,\s]/,om=/["']/g,lm=function(e){for(var t,i,a,s={},r=e.substr(1,e.length-3).split(":"),n=r[0],o=1,l=r.length;o<l;o++)i=r[o],t=o!==l-1?i.lastIndexOf(","):i.length,a=i.substr(0,t),s[n]=isNaN(a)?a.replace(om,"").trim():+a,n=i.substr(t+1).trim();return s},cm=function(e){return function(t){return 1-e(1-t)}},dm=function e(t,i){for(var a,s=t._first;s;)s instanceof bm?e(s,i):!s.vars.yoyoEase||s._yoyo&&s._repeat||s._yoyo===i||(s.timeline?e(s.timeline,i):(a=s._ease,s._ease=s._yEase,s._yEase=a,s._yoyo=i)),s=s._next},um=function(e,t){return e&&(lu(e)?e:rm[e]||function(e){var t,i,a,s,r=(e+"").split("("),n=rm[r[0]];return n&&r.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[lm(r[1])]:(t=e,i=t.indexOf("(")+1,a=t.indexOf(")"),s=t.indexOf("(",i),t.substring(i,~s&&s<a?t.indexOf(")",a+1):a)).split(",").map(Qu)):rm._CE&&nm.test(e)?rm._CE("",e):n}(e))||t},hm=function(e,t,i,a){void 0===i&&(i=function(e){return 1-t(1-e)}),void 0===a&&(a=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var s,r={easeIn:t,easeOut:i,easeInOut:a};return Hu(e,function(e){for(var t in rm[e]=Su[e]=r,rm[s=e.toLowerCase()]=i,r)rm[s+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=rm[e+"."+t]=r[t]}),r},mm=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},pm=function e(t,i,a){var s=i>=1?i:1,r=(a||(t?.3:.45))/(i<1?i:1),n=r/tu*(Math.asin(1/s)||0),o=function(e){return 1===e?1:s*Math.pow(2,-10*e)*nu((e-n)*r)+1},l="out"===t?o:"in"===t?function(e){return 1-o(1-e)}:mm(o);return r=tu/r,l.config=function(i,a){return e(t,i,a)},l},fm=function e(t,i){void 0===i&&(i=1.70158);var a=function(e){return e?--e*e*((i+1)*e+i)+1:0},s="out"===t?a:"in"===t?function(e){return 1-a(1-e)}:mm(a);return s.config=function(i){return e(t,i)},s};Hu("Linear,Quad,Cubic,Quart,Quint,Strong",function(e,t){var i=t<5?t+1:t;hm(e+",Power"+(i-1),t?function(e){return Math.pow(e,i)}:function(e){return e},function(e){return 1-Math.pow(1-e,i)},function(e){return e<.5?Math.pow(2*e,i)/2:1-Math.pow(2*(1-e),i)/2})}),rm.Linear.easeNone=rm.none=rm.Linear.easeIn,hm("Elastic",pm("in"),pm("out"),pm()),Hd=7.5625,Gd=2*(Vd=1/(Zd=2.75)),Yd=2.5*Vd,hm("Bounce",function(e){return 1-Kd(1-e)},Kd=function(e){return e<Vd?Hd*e*e:e<Gd?Hd*Math.pow(e-1.5/Zd,2)+.75:e<Yd?Hd*(e-=2.25/Zd)*e+.9375:Hd*Math.pow(e-2.625/Zd,2)+.984375}),hm("Expo",function(e){return Math.pow(2,10*(e-1))*e+e*e*e*e*e*e*(1-e)}),hm("Circ",function(e){return-(su(1-e*e)-1)}),hm("Sine",function(e){return 1===e?1:1-ru(e*iu)}),hm("Back",fm("in"),fm("out"),fm()),rm.SteppedEase=rm.steps=Su.SteppedEase={config:function(e,t){void 0===e&&(e=1);var i=1/e,a=e+(t?0:1),s=t?1:0;return function(e){return((a*zh(0,.99999999,e)|0)+s)*i}}},Jd.ease=rm["quad.out"],Hu("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(e){return Uu+=e+","+e+"Params,"});var gm=function(e,t){this.id=au++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Wu,this.set=t?t.getSetter:Mm},xm=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,jh(this,+e.duration,1,1),this.data=e.data,wd&&(this._ctx=wd,wd.data.push(this)),zd||am.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,jh(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(sm(),!arguments.length)return this._tTime;var i=this._dp;if(i&&i.smoothChildTiming&&this._ts){for(gh(this,e),!i._dp||i.parent||xh(i,this);i&&i.parent;)i.parent._time!==i._start+(i._ts>=0?i._tTime/i._ts:(i.totalDuration()-i._tTime)/-i._ts)&&i.totalTime(i._tTime,!0),i=i.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&bh(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===eu||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),Ju(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+hh(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+hh(this),t):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(e,t){var i=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*i,t):this._repeat?mh(this._tTime,i)+1:1},t.timeScale=function(e,t){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var i=this.parent&&this._ts?ph(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,this.totalTime(zh(-Math.abs(this._delay),this.totalDuration(),i),!1!==t),fh(this),function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e}(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(sm(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==eu&&(this._tTime-=eu)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&bh(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(hu(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?ph(t.rawTime(e),this):this._tTime:this._tTime},t.revert=function(e){void 0===e&&(e=Tu);var t=yd;return yd=e,Xu(this)&&(this.timeline&&this.timeline.revert(e),this.totalTime(-.01,e.suppressEvents)),"nested"!==this.data&&!1!==e.kill&&this.kill(),yd=t,this},t.globalTime=function(e){for(var t=this,i=arguments.length?e:t.rawTime();t;)i=t._start+i/(Math.abs(t._ts)||1),t=t._dp;return!this.parent&&this._sat?this._sat.globalTime(e):i},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,Sh(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,Sh(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(kh(this,e),hu(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,hu(t)),this._dur||(this._zTime=-1e-8),this},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,i=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=i&&e<this.endTime(!0)-eu))},t.eventCallback=function(e,t,i){var a=this.vars;return arguments.length>1?(t?(a[e]=t,i&&(a[e+"Params"]=i),"onUpdate"===e&&(this._onUpdate=t)):delete a[e],this):a[e]},t.then=function(e){var t=this;return new Promise(function(i){var a=lu(e)?e:eh,s=function(){var e=t.then;t.then=null,lu(a)&&(a=a(t))&&(a.then||a===t)&&(t.then=e),i(a),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?s():t._prom=s})},t.kill=function(){Hh(this)},e}();th(xm.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var bm=function(e){function t(t,i){var a;return void 0===t&&(t={}),(a=e.call(this,t)||this).labels={},a.smoothChildTiming=!!t.smoothChildTiming,a.autoRemoveChildren=!!t.autoRemoveChildren,a._sort=hu(t.sortChildren),Nd&&bh(t.parent||Nd,xd(a),i),t.reversed&&a.reverse(),t.paused&&a.paused(!0),t.scrollTrigger&&vh(xd(a),t.scrollTrigger),a}bd(t,e);var i=t.prototype;return i.to=function(e,t,i){return Ch(0,arguments,this),this},i.from=function(e,t,i){return Ch(1,arguments,this),this},i.fromTo=function(e,t,i,a){return Ch(2,arguments,this),this},i.set=function(e,t,i){return t.duration=0,t.parent=this,rh(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new zm(e,t,kh(this,i),1),this},i.call=function(e,t,i){return bh(this,zm.delayedCall(0,e,t),i)},i.staggerTo=function(e,t,i,a,s,r,n){return i.duration=t,i.stagger=i.stagger||a,i.onComplete=r,i.onCompleteParams=n,i.parent=this,new zm(e,i,kh(this,s)),this},i.staggerFrom=function(e,t,i,a,s,r,n){return i.runBackwards=1,rh(i).immediateRender=hu(i.immediateRender),this.staggerTo(e,t,i,a,s,r,n)},i.staggerFromTo=function(e,t,i,a,s,r,n,o){return a.startAt=i,rh(a).immediateRender=hu(a.immediateRender),this.staggerTo(e,t,a,s,r,n,o)},i.render=function(e,t,i){var a,s,r,n,o,l,c,d,u,h,m,p,f=this._time,g=this._dirty?this.totalDuration():this._tDur,x=this._dur,b=e<=0?0:Vu(e),v=this._zTime<0!=e<0&&(this._initted||!x);if(this!==Nd&&b>g&&e>=0&&(b=g),b!==this._tTime||i||v){if(f!==this._time&&x&&(b+=this._time-f,e+=this._time-f),a=b,u=this._start,l=!(d=this._ts),v&&(x||(f=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(m=this._yoyo,o=x+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*o+e,t,i);if(a=Vu(b%o),b===g?(n=this._repeat,a=x):((n=~~(h=Vu(b/o)))&&n===h&&(a=x,n--),a>x&&(a=x)),h=mh(this._tTime,o),!f&&this._tTime&&h!==n&&this._tTime-h*o-this._dur<=0&&(h=n),m&&1&n&&(a=x-a,p=1),n!==h&&!this._lock){var y=m&&1&h,w=y===(m&&1&n);if(n<h&&(y=!y),f=y?0:b%x?x:b,this._lock=1,this.render(f||(p?0:Vu(n*o)),t,!x)._lock=0,this._tTime=b,!t&&this.parent&&Wh(this,"onRepeat"),this.vars.repeatRefresh&&!p&&(this.invalidate()._lock=1),f&&f!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(x=this._dur,g=this._tDur,w&&(this._lock=2,f=y?x:-1e-4,this.render(f,!0),this.vars.repeatRefresh&&!p&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;dm(this,p)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=function(e,t,i){var a;if(i>t)for(a=e._first;a&&a._start<=i;){if("isPause"===a.data&&a._start>t)return a;a=a._next}else for(a=e._last;a&&a._start>=i;){if("isPause"===a.data&&a._start<t)return a;a=a._prev}}(this,Vu(f),Vu(a)),c&&(b-=a-(a=c._start))),this._tTime=b,this._time=a,this._act=!d,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,f=0),!f&&b&&!t&&!h&&(Wh(this,"onStart"),this._tTime!==b))return this;if(a>=f&&e>=0)for(s=this._first;s;){if(r=s._next,(s._act||a>=s._start)&&s._ts&&c!==s){if(s.parent!==this)return this.render(e,t,i);if(s.render(s._ts>0?(a-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(a-s._start)*s._ts,t,i),a!==this._time||!this._ts&&!l){c=0,r&&(b+=this._zTime=-1e-8);break}}s=r}else{s=this._last;for(var N=e<0?e:a;s;){if(r=s._prev,(s._act||N<=s._end)&&s._ts&&c!==s){if(s.parent!==this)return this.render(e,t,i);if(s.render(s._ts>0?(N-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(N-s._start)*s._ts,t,i||yd&&Xu(s)),a!==this._time||!this._ts&&!l){c=0,r&&(b+=this._zTime=N?-1e-8:eu);break}}s=r}}if(c&&!t&&(this.pause(),c.render(a>=f?0:-1e-8)._zTime=a>=f?1:-1,this._ts))return this._start=u,fh(this),this.render(e,t,i);this._onUpdate&&!t&&Wh(this,"onUpdate",!0),(b===g&&this._tTime>=this.totalDuration()||!b&&f)&&(u!==this._start&&Math.abs(d)===Math.abs(this._ts)||this._lock||((e||!x)&&(b===g&&this._ts>0||!b&&this._ts<0)&&lh(this,1),t||e<0&&!f||!b&&!f&&g||(Wh(this,b===g&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(b<g&&this.timeScale()>0)&&this._prom())))}return this},i.add=function(e,t){var i=this;if(cu(t)||(t=kh(this,t,e)),!(e instanceof xm)){if(gu(e))return e.forEach(function(e){return i.add(e,t)}),this;if(ou(e))return this.addLabel(e,t);if(!lu(e))return this;e=zm.delayedCall(0,e)}return this!==e?bh(this,e,t):this},i.getChildren=function(e,t,i,a){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===a&&(a=-1e8);for(var s=[],r=this._first;r;)r._start>=a&&(r instanceof zm?t&&s.push(r):(i&&s.push(r),e&&s.push.apply(s,r.getChildren(!0,t,i)))),r=r._next;return s},i.getById=function(e){for(var t=this.getChildren(1,1,1),i=t.length;i--;)if(t[i].vars.id===e)return t[i]},i.remove=function(e){return ou(e)?this.removeLabel(e):lu(e)?this.killTweensOf(e):(e.parent===this&&oh(this,e),e===this._recent&&(this._recent=this._last),ch(this))},i.totalTime=function(t,i){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Vu(am.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,i),this._forcing=0,this):this._tTime},i.addLabel=function(e,t){return this.labels[e]=kh(this,t),this},i.removeLabel=function(e){return delete this.labels[e],this},i.addPause=function(e,t,i){var a=zm.delayedCall(0,t||Eu,i);return a.data="isPause",this._hasPause=1,bh(this,a,kh(this,e))},i.removePause=function(e){var t=this._first;for(e=kh(this,e);t;)t._start===e&&"isPause"===t.data&&lh(t),t=t._next},i.killTweensOf=function(e,t,i){for(var a=this.getTweensOf(e,i),s=a.length;s--;)vm!==a[s]&&a[s].kill(e,t);return this},i.getTweensOf=function(e,t){for(var i,a=[],s=Th(e),r=this._first,n=cu(t);r;)r instanceof zm?Yu(r._targets,s)&&(n?(!vm||r._initted&&r._ts)&&r.globalTime(0)<=t&&r.globalTime(r.totalDuration())>t:!t||r.isActive())&&a.push(r):(i=r.getTweensOf(s,t)).length&&a.push.apply(a,i),r=r._next;return a},i.tweenTo=function(e,t){t=t||{};var i,a=this,s=kh(a,e),r=t,n=r.startAt,o=r.onStart,l=r.onStartParams,c=r.immediateRender,d=zm.to(a,th({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:s,overwrite:"auto",duration:t.duration||Math.abs((s-(n&&"time"in n?n.time:a._time))/a.timeScale())||eu,onStart:function(){if(a.pause(),!i){var e=t.duration||Math.abs((s-(n&&"time"in n?n.time:a._time))/a.timeScale());d._dur!==e&&jh(d,e,0,1).render(d._time,!0,!0),i=1}o&&o.apply(d,l||[])}},t));return c?d.render(0):d},i.tweenFromTo=function(e,t,i){return this.tweenTo(t,th({startAt:{time:kh(this,e)}},i))},i.recent=function(){return this._recent},i.nextLabel=function(e){return void 0===e&&(e=this._time),$h(this,kh(this,e))},i.previousLabel=function(e){return void 0===e&&(e=this._time),$h(this,kh(this,e),1)},i.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+eu)},i.shiftChildren=function(e,t,i){void 0===i&&(i=0);for(var a,s=this._first,r=this.labels;s;)s._start>=i&&(s._start+=e,s._end+=e),s=s._next;if(t)for(a in r)r[a]>=i&&(r[a]+=e);return ch(this)},i.invalidate=function(t){var i=this._first;for(this._lock=0;i;)i.invalidate(t),i=i._next;return e.prototype.invalidate.call(this,t)},i.clear=function(e){void 0===e&&(e=!0);for(var t,i=this._first;i;)t=i._next,this.remove(i),i=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),ch(this)},i.totalDuration=function(e){var t,i,a,s=0,r=this,n=r._last,o=Qd;if(arguments.length)return r.timeScale((r._repeat<0?r.duration():r.totalDuration())/(r.reversed()?-e:e));if(r._dirty){for(a=r.parent;n;)t=n._prev,n._dirty&&n.totalDuration(),(i=n._start)>o&&r._sort&&n._ts&&!r._lock?(r._lock=1,bh(r,n,i-n._delay,1)._lock=0):o=i,i<0&&n._ts&&(s-=i,(!a&&!r._dp||a&&a.smoothChildTiming)&&(r._start+=i/r._ts,r._time-=i,r._tTime-=i),r.shiftChildren(-i,!1,-1/0),o=0),n._end>s&&n._ts&&(s=n._end),n=t;jh(r,r===Nd&&r._time>s?r._time:s,1,1),r._dirty=0}return r._tDur},t.updateRoot=function(e){if(Nd._ts&&(Ju(Nd,ph(e,Nd)),Cd=am.frame),am.frame>=Ru){Ru+=Xd.autoSleep||120;var t=Nd._first;if((!t||!t._ts)&&Xd.autoSleep&&am._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||am.sleep()}}},t}(xm);th(bm.prototype,{_lock:0,_hasPause:0,_forcing:0});var vm,ym,wm=function(e,t,i,a,s,r,n){var o,l,c,d,u,h,m,p,f=new $m(this._pt,e,t,0,1,Om,null,s),g=0,x=0;for(f.b=i,f.e=a,i+="",(m=~(a+="").indexOf("random("))&&(a=Uh(a)),r&&(r(p=[i,a],e,t),i=p[0],a=p[1]),l=i.match(yu)||[];o=yu.exec(a);)d=o[0],u=a.substring(g,o.index),c?c=(c+1)%5:"rgba("===u.substr(-5)&&(c=1),d!==l[x++]&&(h=parseFloat(l[x-1])||0,f._pt={_next:f._pt,p:u||1===x?u:",",s:h,c:"="===d.charAt(1)?Gu(h,d)-h:parseFloat(d)-h,m:c&&c<4?Math.round:0},g=yu.lastIndex);return f.c=g<a.length?a.substring(g,a.length):"",f.fp=n,(wu.test(a)||m)&&(f.e=0),this._pt=f,f},Nm=function(e,t,i,a,s,r,n,o,l,c){lu(a)&&(a=a(s||0,e,r));var d,u=e[t],h="get"!==i?i:lu(u)?l?e[t.indexOf("set")||!lu(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():u,m=lu(u)?l?Pm:Im:Em;if(ou(a)&&(~a.indexOf("random(")&&(a=Uh(a)),"="===a.charAt(1)&&((d=Gu(h,a)+(Eh(h)||0))||0===d)&&(a=d)),!c||h!==a||ym)return isNaN(h*a)||""===a?(!u&&!(t in e)&&Cu(t,a),wm.call(this,e,t,h,a,m,o||Xd.stringFilter,l)):(d=new $m(this._pt,e,t,+h||0,a-(h||0),"boolean"==typeof u?Fm:Lm,0,m),l&&(d.fp=l),n&&d.modifier(n,this,e),this._pt=d)},jm=function(e,t,i,a,s,r){var n,o,l,c;if(Ou[e]&&!1!==(n=new Ou[e]).init(s,n.rawVars?t[e]:function(e,t,i,a,s){if(lu(e)&&(e=km(e,s,t,i,a)),!uu(e)||e.style&&e.nodeType||gu(e)||fu(e))return ou(e)?km(e,s,t,i,a):e;var r,n={};for(r in e)n[r]=km(e[r],s,t,i,a);return n}(t[e],a,s,r,i),i,a,r)&&(i._pt=o=new $m(i._pt,s,e,0,1,n.render,n,0,n.priority),i!==Ad))for(l=i._ptLookup[i._targets.indexOf(s)],c=n._props.length;c--;)l[n._props[c]]=o;return n},Sm=function e(t,i,a){var s,r,n,o,l,c,d,u,h,m,p,f,g,x=t.vars,b=x.ease,v=x.startAt,y=x.immediateRender,w=x.lazy,N=x.onUpdate,j=x.runBackwards,S=x.yoyoEase,_=x.keyframes,k=x.autoRevert,C=t._dur,A=t._startAt,z=t._targets,E=t.parent,I=E&&"nested"===E.data?E.vars.targets:z,P="auto"===t._overwrite&&!vd,T=t.timeline;if(T&&(!_||!b)&&(b="none"),t._ease=um(b,Jd.ease),t._yEase=S?cm(um(!0===S?b:S,Jd.ease)):0,S&&t._yoyo&&!t._repeat&&(S=t._yEase,t._yEase=t._ease,t._ease=S),t._from=!T&&!!x.runBackwards,!T||_&&!x.stagger){if(f=(u=z[0]?$u(z[0]).harness:0)&&x[u.prop],s=sh(x,Mu),A&&(A._zTime<0&&A.progress(1),i<0&&j&&y&&!k?A.render(-1,!0):A.revert(j&&C?Pu:Iu),A._lazy=0),v){if(lh(t._startAt=zm.set(z,th({data:"isStart",overwrite:!1,parent:E,immediateRender:!0,lazy:!A&&hu(w),startAt:null,delay:0,onUpdate:N&&function(){return Wh(t,"onUpdate")},stagger:0},v))),t._startAt._dp=0,t._startAt._sat=t,i<0&&(yd||!y&&!k)&&t._startAt.revert(Pu),y&&C&&i<=0&&a<=0)return void(i&&(t._zTime=i))}else if(j&&C&&!A)if(i&&(y=!1),n=th({overwrite:!1,data:"isFromStart",lazy:y&&!A&&hu(w),immediateRender:y,stagger:0,parent:E},s),f&&(n[u.prop]=f),lh(t._startAt=zm.set(z,n)),t._startAt._dp=0,t._startAt._sat=t,i<0&&(yd?t._startAt.revert(Pu):t._startAt.render(-1,!0)),t._zTime=i,y){if(!i)return}else e(t._startAt,eu,eu);for(t._pt=t._ptCache=0,w=C&&hu(w)||w&&!C,r=0;r<z.length;r++){if(d=(l=z[r])._gsap||qu(z)[r]._gsap,t._ptLookup[r]=m={},Fu[d.id]&&Lu.length&&Ku(),p=I===z?r:I.indexOf(l),u&&!1!==(h=new u).init(l,f||s,t,p,I)&&(t._pt=o=new $m(t._pt,l,h.name,0,1,h.render,h,0,h.priority),h._props.forEach(function(e){m[e]=o}),h.priority&&(c=1)),!u||f)for(n in s)Ou[n]&&(h=jm(n,s,t,p,l,I))?h.priority&&(c=1):m[n]=o=Nm.call(t,l,n,"get",s[n],p,I,0,x.stringFilter);t._op&&t._op[r]&&t.kill(l,t._op[r]),P&&t._pt&&(vm=t,Nd.killTweensOf(l,m,t.globalTime(i)),g=!t.parent,vm=0),t._pt&&w&&(Fu[d.id]=1)}c&&qm(t),t._onInit&&t._onInit(t)}t._onUpdate=N,t._initted=(!t._op||t._pt)&&!g,_&&i<=0&&T.render(Qd,!0,!0)},_m=function(e,t,i,a){var s,r,n=t.ease||a||"power1.inOut";if(gu(t))r=i[e]||(i[e]=[]),t.forEach(function(e,i){return r.push({t:i/(t.length-1)*100,v:e,e:n})});else for(s in t)r=i[s]||(i[s]=[]),"ease"===s||r.push({t:parseFloat(e),v:t[s],e:n})},km=function(e,t,i,a,s){return lu(e)?e.call(t,i,a,s):ou(e)&&~e.indexOf("random(")?Uh(e):e},Cm=Uu+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Am={};Hu(Cm+",id,stagger,delay,duration,paused,scrollTrigger",function(e){return Am[e]=1});var zm=function(e){function t(t,i,a,s){var r;"number"==typeof i&&(a.duration=i,i=a,a=null);var n,o,l,c,d,u,h,m,p=(r=e.call(this,s?i:rh(i))||this).vars,f=p.duration,g=p.delay,x=p.immediateRender,b=p.stagger,v=p.overwrite,y=p.keyframes,w=p.defaults,N=p.scrollTrigger,j=p.yoyoEase,S=i.parent||Nd,_=(gu(t)||fu(t)?cu(t[0]):"length"in i)?[t]:Th(t);if(r._targets=_.length?qu(_):Au("GSAP target "+t+" not found. https://gsap.com",!Xd.nullTargetWarn)||[],r._ptLookup=[],r._overwrite=v,y||b||pu(f)||pu(g)){if(i=r.vars,(n=r.timeline=new bm({data:"nested",defaults:w||{},targets:S&&"nested"===S.data?S.vars.targets:_})).kill(),n.parent=n._dp=xd(r),n._start=0,b||pu(f)||pu(g)){if(c=_.length,h=b&&Fh(b),uu(b))for(d in b)~Cm.indexOf(d)&&(m||(m={}),m[d]=b[d]);for(o=0;o<c;o++)(l=sh(i,Am)).stagger=0,j&&(l.yoyoEase=j),m&&ih(l,m),u=_[o],l.duration=+km(f,xd(r),o,u,_),l.delay=(+km(g,xd(r),o,u,_)||0)-r._delay,!b&&1===c&&l.delay&&(r._delay=g=l.delay,r._start+=g,l.delay=0),n.to(u,l,h?h(o,u,_):0),n._ease=rm.none;n.duration()?f=g=0:r.timeline=0}else if(y){rh(th(n.vars.defaults,{ease:"none"})),n._ease=um(y.ease||i.ease||"none");var k,C,A,z=0;if(gu(y))y.forEach(function(e){return n.to(_,e,">")}),n.duration();else{for(d in l={},y)"ease"===d||"easeEach"===d||_m(d,y[d],l,y.easeEach);for(d in l)for(k=l[d].sort(function(e,t){return e.t-t.t}),z=0,o=0;o<k.length;o++)(A={ease:(C=k[o]).e,duration:(C.t-(o?k[o-1].t:0))/100*f})[d]=C.v,n.to(_,A,z),z+=A.duration;n.duration()<f&&n.to({},{duration:f-n.duration()})}}f||r.duration(f=n.duration())}else r.timeline=0;return!0!==v||vd||(vm=xd(r),Nd.killTweensOf(_),vm=0),bh(S,xd(r),a),i.reversed&&r.reverse(),i.paused&&r.paused(!0),(x||!f&&!y&&r._start===Vu(S._time)&&hu(x)&&uh(xd(r))&&"nested"!==S.data)&&(r._tTime=-1e-8,r.render(Math.max(0,-g)||0)),N&&vh(xd(r),N),r}bd(t,e);var i=t.prototype;return i.render=function(e,t,i){var a,s,r,n,o,l,c,d,u,h=this._time,m=this._tDur,p=this._dur,f=e<0,g=e>m-eu&&!f?m:e<eu?0:e;if(p){if(g!==this._tTime||!e||i||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==f||this._lazy){if(a=g,d=this.timeline,this._repeat){if(n=p+this._rDelay,this._repeat<-1&&f)return this.totalTime(100*n+e,t,i);if(a=Vu(g%n),g===m?(r=this._repeat,a=p):(r=~~(o=Vu(g/n)))&&r===o?(a=p,r--):a>p&&(a=p),(l=this._yoyo&&1&r)&&(u=this._yEase,a=p-a),o=mh(this._tTime,n),a===h&&!i&&this._initted&&r===o)return this._tTime=g,this;r!==o&&(d&&this._yEase&&dm(d,l),this.vars.repeatRefresh&&!l&&!this._lock&&a!==n&&this._initted&&(this._lock=i=1,this.render(Vu(n*r),!0).invalidate()._lock=0))}if(!this._initted){if(yh(this,f?e:a,i,t,g))return this._tTime=0,this;if(!(h===this._time||i&&this.vars.repeatRefresh&&r!==o))return this;if(p!==this._dur)return this.render(e,t,i)}if(this._tTime=g,this._time=a,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(u||this._ease)(a/p),this._from&&(this.ratio=c=1-c),!h&&g&&!t&&!o&&(Wh(this,"onStart"),this._tTime!==g))return this;for(s=this._pt;s;)s.r(c,s.d),s=s._next;d&&d.render(e<0?e:d._dur*d._ease(a/this._dur),t,i)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(f&&dh(this,e,0,i),Wh(this,"onUpdate")),this._repeat&&r!==o&&this.vars.onRepeat&&!t&&this.parent&&Wh(this,"onRepeat"),g!==this._tDur&&g||this._tTime!==g||(f&&!this._onUpdate&&dh(this,e,0,!0),(e||!p)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&lh(this,1),t||f&&!h||!(g||h||l)||(Wh(this,g===m?"onComplete":"onReverseComplete",!0),this._prom&&!(g<m&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,i,a){var s,r,n,o=e.ratio,l=t<0||!t&&(!e._start&&wh(e)&&(e._initted||!Nh(e))||(e._ts<0||e._dp._ts<0)&&!Nh(e))?0:1,c=e._rDelay,d=0;if(c&&e._repeat&&(d=zh(0,e._tDur,t),r=mh(d,c),e._yoyo&&1&r&&(l=1-l),r!==mh(e._tTime,c)&&(o=1-l,e.vars.repeatRefresh&&e._initted&&e.invalidate())),l!==o||yd||a||e._zTime===eu||!t&&e._zTime){if(!e._initted&&yh(e,t,a,i,d))return;for(n=e._zTime,e._zTime=t||(i?eu:0),i||(i=t&&!n),e.ratio=l,e._from&&(l=1-l),e._time=0,e._tTime=d,s=e._pt;s;)s.r(l,s.d),s=s._next;t<0&&dh(e,t,0,!0),e._onUpdate&&!i&&Wh(e,"onUpdate"),d&&e._repeat&&!i&&e.parent&&Wh(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===l&&(l&&lh(e,1),i||yd||(Wh(e,l?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,i);return this},i.targets=function(){return this._targets},i.invalidate=function(t){return(!t||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(t),e.prototype.invalidate.call(this,t)},i.resetTo=function(e,t,i,a,s){zd||am.wake(),this._ts||this.play();var r=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||Sm(this,r),function(e,t,i,a,s,r,n,o){var l,c,d,u,h=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!h)for(h=e._ptCache[t]=[],d=e._ptLookup,u=e._targets.length;u--;){if((l=d[u][t])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==t&&l.fp!==t;)l=l._next;if(!l)return ym=1,e.vars[t]="+=0",Sm(e,n),ym=0,o?Au(t+" not eligible for reset"):1;h.push(l)}for(u=h.length;u--;)(l=(c=h[u])._pt||c).s=!a&&0!==a||s?l.s+(a||0)+r*l.c:a,l.c=i-l.s,c.e&&(c.e=Zu(i)+Eh(c.e)),c.b&&(c.b=l.s+Eh(c.b))}(this,e,t,i,a,this._ease(r/this._dur),r,s)?this.resetTo(e,t,i,a,1):(gh(this,0),this.parent||nh(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},i.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?Hh(this):this.scrollTrigger&&this.scrollTrigger.kill(!!yd),this;if(this.timeline){var i=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,vm&&!0!==vm.vars.overwrite)._first||Hh(this),this.parent&&i!==this.timeline.totalDuration()&&jh(this,this._dur*this.timeline._tDur/i,0,1),this}var a,s,r,n,o,l,c,d=this._targets,u=e?Th(e):d,h=this._ptLookup,m=this._pt;if((!t||"all"===t)&&function(e,t){for(var i=e.length,a=i===t.length;a&&i--&&e[i]===t[i];);return i<0}(d,u))return"all"===t&&(this._pt=0),Hh(this);for(a=this._op=this._op||[],"all"!==t&&(ou(t)&&(o={},Hu(t,function(e){return o[e]=1}),t=o),t=function(e,t){var i,a,s,r,n=e[0]?$u(e[0]).harness:0,o=n&&n.aliases;if(!o)return t;for(a in i=ih({},t),o)if(a in i)for(s=(r=o[a].split(",")).length;s--;)i[r[s]]=i[a];return i}(d,t)),c=d.length;c--;)if(~u.indexOf(d[c]))for(o in s=h[c],"all"===t?(a[c]=t,n=s,r={}):(r=a[c]=a[c]||{},n=t),n)(l=s&&s[o])&&("kill"in l.d&&!0!==l.d.kill(o)||oh(this,l,"_pt"),delete s[o]),"all"!==r&&(r[o]=1);return this._initted&&!this._pt&&m&&Hh(this),this},t.to=function(e,i){return new t(e,i,arguments[2])},t.from=function(e,t){return Ch(1,arguments)},t.delayedCall=function(e,i,a,s){return new t(i,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:i,onReverseComplete:i,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:s})},t.fromTo=function(e,t,i){return Ch(2,arguments)},t.set=function(e,i){return i.duration=0,i.repeatDelay||(i.repeat=0),new t(e,i)},t.killTweensOf=function(e,t,i){return Nd.killTweensOf(e,t,i)},t}(xm);th(zm.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Hu("staggerTo,staggerFrom,staggerFromTo",function(e){zm[e]=function(){var t=new bm,i=Ih.call(arguments,0);return i.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,i)}});var Em=function(e,t,i){return e[t]=i},Im=function(e,t,i){return e[t](i)},Pm=function(e,t,i,a){return e[t](a.fp,i)},Tm=function(e,t,i){return e.setAttribute(t,i)},Mm=function(e,t){return lu(e[t])?Im:du(e[t])&&e.setAttribute?Tm:Em},Lm=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},Fm=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Om=function(e,t){var i=t._pt,a="";if(!e&&t.b)a=t.b;else if(1===e&&t.e)a=t.e;else{for(;i;)a=i.p+(i.m?i.m(i.s+i.c*e):Math.round(1e4*(i.s+i.c*e))/1e4)+a,i=i._next;a+=t.c}t.set(t.t,t.p,a,t)},Dm=function(e,t){for(var i=t._pt;i;)i.r(e,i.d),i=i._next},Rm=function(e,t,i,a){for(var s,r=this._pt;r;)s=r._next,r.p===a&&r.modifier(e,t,i),r=s},Bm=function(e){for(var t,i,a=this._pt;a;)i=a._next,a.p===e&&!a.op||a.op===e?oh(this,a,"_pt"):a.dep||(t=1),a=i;return!t},Um=function(e,t,i,a){a.mSet(e,t,a.m.call(a.tween,i,a.mt),a)},qm=function(e){for(var t,i,a,s,r=e._pt;r;){for(t=r._next,i=a;i&&i.pr>r.pr;)i=i._next;(r._prev=i?i._prev:s)?r._prev._next=r:a=r,(r._next=i)?i._prev=r:s=r,r=t}e._pt=a},$m=function(){function e(e,t,i,a,s,r,n,o,l){this.t=t,this.s=a,this.c=s,this.p=i,this.r=r||Lm,this.d=n||this,this.set=o||Em,this.pr=l||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,i){this.mSet=this.mSet||this.set,this.set=Um,this.m=e,this.mt=i,this.tween=t},e}();Hu(Uu+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(e){return Mu[e]=1}),Su.TweenMax=Su.TweenLite=zm,Su.TimelineLite=Su.TimelineMax=bm,Nd=new bm({sortChildren:!1,defaults:Jd,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Xd.stringFilter=im;var Wm=[],Hm={},Zm=[],Vm=0,Gm=0,Ym=function(e){return(Hm[e]||Zm).map(function(e){return e()})},Km=function(){var e=Date.now(),t=[];e-Vm>2&&(Ym("matchMediaInit"),Wm.forEach(function(e){var i,a,s,r,n=e.queries,o=e.conditions;for(a in n)(i=jd.matchMedia(n[a]).matches)&&(s=1),i!==o[a]&&(o[a]=i,r=1);r&&(e.revert(),s&&t.push(e))}),Ym("matchMediaRevert"),t.forEach(function(e){return e.onMatch(e,function(t){return e.add(null,t)})}),Vm=e,Ym("matchMedia"))},Xm=function(){function e(e,t){this.selector=t&&Mh(t),this.data=[],this._r=[],this.isReverted=!1,this.id=Gm++,e&&this.add(e)}var t=e.prototype;return t.add=function(e,t,i){lu(e)&&(i=t,t=e,e=lu);var a=this,s=function(){var e,s=wd,r=a.selector;return s&&s!==a&&s.data.push(a),i&&(a.selector=Mh(i)),wd=a,e=t.apply(a,arguments),lu(e)&&a._r.push(e),wd=s,a.selector=r,a.isReverted=!1,e};return a.last=s,e===lu?s(a,function(e){return a.add(null,e)}):e?a[e]=s:s},t.ignore=function(e){var t=wd;wd=null,e(this),wd=t},t.getTweens=function(){var t=[];return this.data.forEach(function(i){return i instanceof e?t.push.apply(t,i.getTweens()):i instanceof zm&&!(i.parent&&"nested"===i.parent.data)&&t.push(i)}),t},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(e,t){var i=this;if(e?function(){for(var t,a=i.getTweens(),s=i.data.length;s--;)"isFlip"===(t=i.data[s]).data&&(t.revert(),t.getChildren(!0,!0,!1).forEach(function(e){return a.splice(a.indexOf(e),1)}));for(a.map(function(e){return{g:e._dur||e._delay||e._sat&&!e._sat.vars.immediateRender?e.globalTime(0):-1/0,t:e}}).sort(function(e,t){return t.g-e.g||-1/0}).forEach(function(t){return t.t.revert(e)}),s=i.data.length;s--;)(t=i.data[s])instanceof bm?"nested"!==t.data&&(t.scrollTrigger&&t.scrollTrigger.revert(),t.kill()):!(t instanceof zm)&&t.revert&&t.revert(e);i._r.forEach(function(t){return t(e,i)}),i.isReverted=!0}():this.data.forEach(function(e){return e.kill&&e.kill()}),this.clear(),t)for(var a=Wm.length;a--;)Wm[a].id===this.id&&Wm.splice(a,1)},t.revert=function(e){this.kill(e||{})},e}(),Jm=function(){function e(e){this.contexts=[],this.scope=e,wd&&wd.data.push(this)}var t=e.prototype;return t.add=function(e,t,i){uu(e)||(e={matches:e});var a,s,r,n=new Xm(0,i||this.scope),o=n.conditions={};for(s in wd&&!n.selector&&(n.selector=wd.selector),this.contexts.push(n),t=n.add("onMatch",t),n.queries=e,e)"all"===s?r=1:(a=jd.matchMedia(e[s]))&&(Wm.indexOf(n)<0&&Wm.push(n),(o[s]=a.matches)&&(r=1),a.addListener?a.addListener(Km):a.addEventListener("change",Km));return r&&t(n,function(e){return n.add(null,e)}),this},t.revert=function(e){this.kill(e||{})},t.kill=function(e){this.contexts.forEach(function(t){return t.kill(e,!0)})},e}(),Qm={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(function(e){return Vh(e)})},timeline:function(e){return new bm(e)},getTweensOf:function(e,t){return Nd.getTweensOf(e,t)},getProperty:function(e,t,i,a){ou(e)&&(e=Th(e)[0]);var s=$u(e||{}).get,r=i?eh:Qu;return"native"===i&&(i=""),e?t?r((Ou[t]&&Ou[t].get||s)(e,t,i,a)):function(t,i,a){return r((Ou[t]&&Ou[t].get||s)(e,t,i,a))}:e},quickSetter:function(e,t,i){if((e=Th(e)).length>1){var a=e.map(function(e){return ip.quickSetter(e,t,i)}),s=a.length;return function(e){for(var t=s;t--;)a[t](e)}}e=e[0]||{};var r=Ou[t],n=$u(e),o=n.harness&&(n.harness.aliases||{})[t]||t,l=r?function(t){var a=new r;Ad._pt=0,a.init(e,i?t+i:t,Ad,0,[e]),a.render(1,a),Ad._pt&&Dm(1,Ad)}:n.set(e,o);return r?l:function(t){return l(e,o,i?t+i:t,n,1)}},quickTo:function(e,t,i){var a,s=ip.to(e,th(((a={})[t]="+=0.1",a.paused=!0,a.stagger=0,a),i||{})),r=function(e,i,a){return s.resetTo(t,e,i,a)};return r.tween=s,r},isTweening:function(e){return Nd.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=um(e.ease,Jd.ease)),ah(Jd,e||{})},config:function(e){return ah(Xd,e||{})},registerEffect:function(e){var t=e.name,i=e.effect,a=e.plugins,s=e.defaults,r=e.extendTimeline;(a||"").split(",").forEach(function(e){return e&&!Ou[e]&&!Su[e]&&Au(t+" effect requires "+e+" plugin.")}),Du[t]=function(e,t,a){return i(Th(e),th(t||{},s),a)},r&&(bm.prototype[t]=function(e,i,a){return this.add(Du[t](e,uu(i)?i:(a=i)&&{},this),a)})},registerEase:function(e,t){rm[e]=um(t)},parseEase:function(e,t){return arguments.length?um(e,t):rm},getById:function(e){return Nd.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var i,a,s=new bm(e);for(s.smoothChildTiming=hu(e.smoothChildTiming),Nd.remove(s),s._dp=0,s._time=s._tTime=Nd._time,i=Nd._first;i;)a=i._next,!t&&!i._dur&&i instanceof zm&&i.vars.onComplete===i._targets[0]||bh(s,i,i._start-i._delay),i=a;return bh(Nd,s,0),s},context:function(e,t){return e?new Xm(e,t):wd},matchMedia:function(e){return new Jm(e)},matchMediaRefresh:function(){return Wm.forEach(function(e){var t,i,a=e.conditions;for(i in a)a[i]&&(a[i]=!1,t=1);t&&e.revert()})||Km()},addEventListener:function(e,t){var i=Hm[e]||(Hm[e]=[]);~i.indexOf(t)||i.push(t)},removeEventListener:function(e,t){var i=Hm[e],a=i&&i.indexOf(t);a>=0&&i.splice(a,1)},utils:{wrap:function e(t,i,a){var s=i-t;return gu(t)?Bh(t,e(0,t.length),i):Ah(a,function(e){return(s+(e-t)%s)%s+t})},wrapYoyo:function e(t,i,a){var s=i-t,r=2*s;return gu(t)?Bh(t,e(0,t.length-1),i):Ah(a,function(e){return t+((e=(r+(e-t)%r)%r||0)>s?r-e:e)})},distribute:Fh,random:Rh,snap:Dh,normalize:function(e,t,i){return qh(e,t,0,1,i)},getUnit:Eh,clamp:function(e,t,i){return Ah(i,function(i){return zh(e,t,i)})},splitColor:Xh,toArray:Th,selector:Mh,mapRange:qh,pipe:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return t.reduce(function(e,t){return t(e)},e)}},unitize:function(e,t){return function(i){return e(parseFloat(i))+(t||Eh(i))}},interpolate:function e(t,i,a,s){var r=isNaN(t+i)?0:function(e){return(1-e)*t+e*i};if(!r){var n,o,l,c,d,u=ou(t),h={};if(!0===a&&(s=1)&&(a=null),u)t={p:t},i={p:i};else if(gu(t)&&!gu(i)){for(l=[],c=t.length,d=c-2,o=1;o<c;o++)l.push(e(t[o-1],t[o]));c--,r=function(e){e*=c;var t=Math.min(d,~~e);return l[t](e-t)},a=i}else s||(t=ih(gu(t)?[]:{},t));if(!l){for(n in i)Nm.call(h,t,n,"get",i[n]);r=function(e){return Dm(e,h)||(u?t.p:t)}}}return Ah(a,r)},shuffle:Lh},install:ku,effects:Du,ticker:am,updateRoot:bm.updateRoot,plugins:Ou,globalTimeline:Nd,core:{PropTween:$m,globals:zu,Tween:zm,Timeline:bm,Animation:xm,getCache:$u,_removeLinkedListItem:oh,reverting:function(){return yd},context:function(e){return e&&wd&&(wd.data.push(e),e._ctx=wd),wd},suppressOverwrites:function(e){return vd=e}}};Hu("to,from,fromTo,delayedCall,set,killTweensOf",function(e){return Qm[e]=zm[e]}),am.add(bm.updateRoot),Ad=Qm.to({},{duration:0});var ep=function(e,t){for(var i=e._pt;i&&i.p!==t&&i.op!==t&&i.fp!==t;)i=i._next;return i},tp=function(e,t){return{name:e,headless:1,rawVars:1,init:function(e,i,a){a._onInit=function(e){var a,s;if(ou(i)&&(a={},Hu(i,function(e){return a[e]=1}),i=a),t){for(s in a={},i)a[s]=t(i[s]);i=a}!function(e,t){var i,a,s,r=e._targets;for(i in t)for(a=r.length;a--;)(s=e._ptLookup[a][i])&&(s=s.d)&&(s._pt&&(s=ep(s,i)),s&&s.modifier&&s.modifier(t[i],e,r[a],i))}(e,i)}}}},ip=Qm.registerPlugin({name:"attr",init:function(e,t,i,a,s){var r,n,o;for(r in this.tween=i,t)o=e.getAttribute(r)||"",(n=this.add(e,"setAttribute",(o||0)+"",t[r],a,s,0,0,r)).op=r,n.b=o,this._props.push(r)},render:function(e,t){for(var i=t._pt;i;)yd?i.set(i.t,i.p,i.b,i):i.r(e,i.d),i=i._next}},{name:"endArray",headless:1,init:function(e,t){for(var i=t.length;i--;)this.add(e,i,e[i]||0,t[i],0,0,0,0,0,1)}},tp("roundProps",Oh),tp("modifiers"),tp("snap",Dh))||Qm;zm.version=bm.version=ip.version="3.13.0",kd=1,mu()&&sm(),rm.Power0,rm.Power1,rm.Power2,rm.Power3,rm.Power4,rm.Linear,rm.Quad,rm.Cubic,rm.Quart,rm.Quint,rm.Strong,rm.Elastic,rm.Back,rm.SteppedEase,rm.Bounce,rm.Sine,rm.Expo,rm.Circ;var ap,sp,rp,np,op,lp,cp,dp,up={},hp=180/Math.PI,mp=Math.PI/180,pp=Math.atan2,fp=/([A-Z])/g,gp=/(left|right|width|margin|padding|x)/i,xp=/[\s,\(]\S/,bp={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},vp=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},yp=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},wp=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},Np=function(e,t){var i=t.s+t.c*e;t.set(t.t,t.p,~~(i+(i<0?-.5:.5))+t.u,t)},jp=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Sp=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},_p=function(e,t,i){return e.style[t]=i},kp=function(e,t,i){return e.style.setProperty(t,i)},Cp=function(e,t,i){return e._gsap[t]=i},Ap=function(e,t,i){return e._gsap.scaleX=e._gsap.scaleY=i},zp=function(e,t,i,a,s){var r=e._gsap;r.scaleX=r.scaleY=i,r.renderTransform(s,r)},Ep=function(e,t,i,a,s){var r=e._gsap;r[t]=i,r.renderTransform(s,r)},Ip="transform",Pp=Ip+"Origin",Tp=function e(t,i){var a=this,s=this.target,r=s.style,n=s._gsap;if(t in up&&r){if(this.tfm=this.tfm||{},"transform"===t)return bp.transform.split(",").forEach(function(t){return e.call(a,t,i)});if(~(t=bp[t]||t).indexOf(",")?t.split(",").forEach(function(e){return a.tfm[e]=Xp(s,e)}):this.tfm[t]=n.x?n[t]:Xp(s,t),t===Pp&&(this.tfm.zOrigin=n.zOrigin),this.props.indexOf(Ip)>=0)return;n.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(Pp,i,"")),t=Ip}(r||i)&&this.props.push(t,i,r[t])},Mp=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Lp=function(){var e,t,i=this.props,a=this.target,s=a.style,r=a._gsap;for(e=0;e<i.length;e+=3)i[e+1]?2===i[e+1]?a[i[e]](i[e+2]):a[i[e]]=i[e+2]:i[e+2]?s[i[e]]=i[e+2]:s.removeProperty("--"===i[e].substr(0,2)?i[e]:i[e].replace(fp,"-$1").toLowerCase());if(this.tfm){for(t in this.tfm)r[t]=this.tfm[t];r.svg&&(r.renderTransform(),a.setAttribute("data-svg-origin",this.svgo||"")),(e=cp())&&e.isStart||s[Ip]||(Mp(s),r.zOrigin&&s[Pp]&&(s[Pp]+=" "+r.zOrigin+"px",r.zOrigin=0,r.renderTransform()),r.uncache=1)}},Fp=function(e,t){var i={target:e,props:[],revert:Lp,save:Tp};return e._gsap||ip.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(e){return i.save(e)}),i},Op=function(e,t){var i=sp.createElementNS?sp.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):sp.createElement(e);return i&&i.style?i:sp.createElement(e)},Dp=function e(t,i,a){var s=getComputedStyle(t);return s[i]||s.getPropertyValue(i.replace(fp,"-$1").toLowerCase())||s.getPropertyValue(i)||!a&&e(t,Bp(i)||i,1)||""},Rp="O,Moz,ms,Ms,Webkit".split(","),Bp=function(e,t,i){var a=(t||op).style,s=5;if(e in a&&!i)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);s--&&!(Rp[s]+e in a););return s<0?null:(3===s?"ms":s>=0?Rp[s]:"")+e},Up=function(){"undefined"!=typeof window&&window.document&&(ap=window,sp=ap.document,rp=sp.documentElement,op=Op("div")||{style:{}},Op("div"),Ip=Bp(Ip),Pp=Ip+"Origin",op.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",dp=!!Bp("perspective"),cp=ip.core.reverting,np=1)},qp=function(e){var t,i=e.ownerSVGElement,a=Op("svg",i&&i.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=e.cloneNode(!0);s.style.display="block",a.appendChild(s),rp.appendChild(a);try{t=s.getBBox()}catch(r){}return a.removeChild(s),rp.removeChild(a),t},$p=function(e,t){for(var i=t.length;i--;)if(e.hasAttribute(t[i]))return e.getAttribute(t[i])},Wp=function(e){var t,i;try{t=e.getBBox()}catch(a){t=qp(e),i=1}return t&&(t.width||t.height)||i||(t=qp(e)),!t||t.width||t.x||t.y?t:{x:+$p(e,["x","cx","x1"])||0,y:+$p(e,["y","cy","y1"])||0,width:0,height:0}},Hp=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!Wp(e))},Zp=function(e,t){if(t){var i,a=e.style;t in up&&t!==Pp&&(t=Ip),a.removeProperty?("ms"!==(i=t.substr(0,2))&&"webkit"!==t.substr(0,6)||(t="-"+t),a.removeProperty("--"===i?t:t.replace(fp,"-$1").toLowerCase())):a.removeAttribute(t)}},Vp=function(e,t,i,a,s,r){var n=new $m(e._pt,t,i,0,1,r?Sp:jp);return e._pt=n,n.b=a,n.e=s,e._props.push(i),n},Gp={deg:1,rad:1,turn:1},Yp={grid:1,flex:1},Kp=function e(t,i,a,s){var r,n,o,l,c=parseFloat(a)||0,d=(a+"").trim().substr((c+"").length)||"px",u=op.style,h=gp.test(i),m="svg"===t.tagName.toLowerCase(),p=(m?"client":"offset")+(h?"Width":"Height"),f=100,g="px"===s,x="%"===s;if(s===d||!c||Gp[s]||Gp[d])return c;if("px"!==d&&!g&&(c=e(t,i,a,"px")),l=t.getCTM&&Hp(t),(x||"%"===d)&&(up[i]||~i.indexOf("adius")))return r=l?t.getBBox()[h?"width":"height"]:t[p],Zu(x?c/r*f:c/100*r);if(u[h?"width":"height"]=f+(g?d:s),n="rem"!==s&&~i.indexOf("adius")||"em"===s&&t.appendChild&&!m?t:t.parentNode,l&&(n=(t.ownerSVGElement||{}).parentNode),n&&n!==sp&&n.appendChild||(n=sp.body),(o=n._gsap)&&x&&o.width&&h&&o.time===am.time&&!o.uncache)return Zu(c/o.width*f);if(!x||"height"!==i&&"width"!==i)(x||"%"===d)&&!Yp[Dp(n,"display")]&&(u.position=Dp(t,"position")),n===t&&(u.position="static"),n.appendChild(op),r=op[p],n.removeChild(op),u.position="absolute";else{var b=t.style[i];t.style[i]=f+s,r=t[p],b?t.style[i]=b:Zp(t,i)}return h&&x&&((o=$u(n)).time=am.time,o.width=n[p]),Zu(g?r*c/f:r&&c?f/r*c:0)},Xp=function(e,t,i,a){var s;return np||Up(),t in bp&&"transform"!==t&&~(t=bp[t]).indexOf(",")&&(t=t.split(",")[0]),up[t]&&"transform"!==t?(s=df(e,a),s="transformOrigin"!==t?s[t]:s.svg?s.origin:uf(Dp(e,Pp))+" "+s.zOrigin+"px"):(!(s=e.style[t])||"auto"===s||a||~(s+"").indexOf("calc("))&&(s=af[t]&&af[t](e,t,i)||Dp(e,t)||Wu(e,t)||("opacity"===t?1:0)),i&&!~(s+"").trim().indexOf(" ")?Kp(e,t,s,i)+i:s},Jp=function(e,t,i,a){if(!i||"none"===i){var s=Bp(t,e,1),r=s&&Dp(e,s,1);r&&r!==i?(t=s,i=r):"borderColor"===t&&(i=Dp(e,"borderTopColor"))}var n,o,l,c,d,u,h,m,p,f,g,x=new $m(this._pt,e.style,t,0,1,Om),b=0,v=0;if(x.b=i,x.e=a,i+="","var(--"===(a+="").substring(0,6)&&(a=Dp(e,a.substring(4,a.indexOf(")")))),"auto"===a&&(u=e.style[t],e.style[t]=a,a=Dp(e,t)||a,u?e.style[t]=u:Zp(e,t)),im(n=[i,a]),a=n[1],l=(i=n[0]).match(vu)||[],(a.match(vu)||[]).length){for(;o=vu.exec(a);)h=o[0],p=a.substring(b,o.index),d?d=(d+1)%5:"rgba("!==p.substr(-5)&&"hsla("!==p.substr(-5)||(d=1),h!==(u=l[v++]||"")&&(c=parseFloat(u)||0,g=u.substr((c+"").length),"="===h.charAt(1)&&(h=Gu(c,h)+g),m=parseFloat(h),f=h.substr((m+"").length),b=vu.lastIndex-f.length,f||(f=f||Xd.units[t]||g,b===a.length&&(a+=f,x.e+=f)),g!==f&&(c=Kp(e,t,u,f)||0),x._pt={_next:x._pt,p:p||1===v?p:",",s:c,c:m-c,m:d&&d<4||"zIndex"===t?Math.round:0});x.c=b<a.length?a.substring(b,a.length):""}else x.r="display"===t&&"none"===a?Sp:jp;return wu.test(a)&&(x.e=0),this._pt=x,x},Qp={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},ef=function(e){var t=e.split(" "),i=t[0],a=t[1]||"50%";return"top"!==i&&"bottom"!==i&&"left"!==a&&"right"!==a||(e=i,i=a,a=e),t[0]=Qp[i]||i,t[1]=Qp[a]||a,t.join(" ")},tf=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var i,a,s,r=t.t,n=r.style,o=t.u,l=r._gsap;if("all"===o||!0===o)n.cssText="",a=1;else for(s=(o=o.split(",")).length;--s>-1;)i=o[s],up[i]&&(a=1,i="transformOrigin"===i?Pp:Ip),Zp(r,i);a&&(Zp(r,Ip),l&&(l.svg&&r.removeAttribute("transform"),n.scale=n.rotate=n.translate="none",df(r,1),l.uncache=1,Mp(n)))}},af={clearProps:function(e,t,i,a,s){if("isFromStart"!==s.data){var r=e._pt=new $m(e._pt,t,i,0,0,tf);return r.u=a,r.pr=-10,r.tween=s,e._props.push(i),1}}},sf=[1,0,0,1,0,0],rf={},nf=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},of=function(e){var t=Dp(e,Ip);return nf(t)?sf:t.substr(7).match(bu).map(Zu)},lf=function(e,t){var i,a,s,r,n=e._gsap||$u(e),o=e.style,l=of(e);return n.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(s=e.transform.baseVal.consolidate().matrix).a,s.b,s.c,s.d,s.e,s.f]).join(",")?sf:l:(l!==sf||e.offsetParent||e===rp||n.svg||(s=o.display,o.display="block",(i=e.parentNode)&&(e.offsetParent||e.getBoundingClientRect().width)||(r=1,a=e.nextElementSibling,rp.appendChild(e)),l=of(e),s?o.display=s:Zp(e,"display"),r&&(a?i.insertBefore(e,a):i?i.appendChild(e):rp.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},cf=function(e,t,i,a,s,r){var n,o,l,c=e._gsap,d=s||lf(e,!0),u=c.xOrigin||0,h=c.yOrigin||0,m=c.xOffset||0,p=c.yOffset||0,f=d[0],g=d[1],x=d[2],b=d[3],v=d[4],y=d[5],w=t.split(" "),N=parseFloat(w[0])||0,j=parseFloat(w[1])||0;i?d!==sf&&(o=f*b-g*x)&&(l=N*(-g/o)+j*(f/o)-(f*y-g*v)/o,N=N*(b/o)+j*(-x/o)+(x*y-b*v)/o,j=l):(N=(n=Wp(e)).x+(~w[0].indexOf("%")?N/100*n.width:N),j=n.y+(~(w[1]||w[0]).indexOf("%")?j/100*n.height:j)),a||!1!==a&&c.smooth?(v=N-u,y=j-h,c.xOffset=m+(v*f+y*x)-v,c.yOffset=p+(v*g+y*b)-y):c.xOffset=c.yOffset=0,c.xOrigin=N,c.yOrigin=j,c.smooth=!!a,c.origin=t,c.originIsAbsolute=!!i,e.style[Pp]="0px 0px",r&&(Vp(r,c,"xOrigin",u,N),Vp(r,c,"yOrigin",h,j),Vp(r,c,"xOffset",m,c.xOffset),Vp(r,c,"yOffset",p,c.yOffset)),e.setAttribute("data-svg-origin",N+" "+j)},df=function(e,t){var i=e._gsap||new gm(e);if("x"in i&&!t&&!i.uncache)return i;var a,s,r,n,o,l,c,d,u,h,m,p,f,g,x,b,v,y,w,N,j,S,_,k,C,A,z,E,I,P,T,M,L=e.style,F=i.scaleX<0,O="px",D="deg",R=getComputedStyle(e),B=Dp(e,Pp)||"0";return a=s=r=l=c=d=u=h=m=0,n=o=1,i.svg=!(!e.getCTM||!Hp(e)),R.translate&&("none"===R.translate&&"none"===R.scale&&"none"===R.rotate||(L[Ip]=("none"!==R.translate?"translate3d("+(R.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==R.rotate?"rotate("+R.rotate+") ":"")+("none"!==R.scale?"scale("+R.scale.split(" ").join(",")+") ":"")+("none"!==R[Ip]?R[Ip]:"")),L.scale=L.rotate=L.translate="none"),g=lf(e,i.svg),i.svg&&(i.uncache?(C=e.getBBox(),B=i.xOrigin-C.x+"px "+(i.yOrigin-C.y)+"px",k=""):k=!t&&e.getAttribute("data-svg-origin"),cf(e,k||B,!!k||i.originIsAbsolute,!1!==i.smooth,g)),p=i.xOrigin||0,f=i.yOrigin||0,g!==sf&&(y=g[0],w=g[1],N=g[2],j=g[3],a=S=g[4],s=_=g[5],6===g.length?(n=Math.sqrt(y*y+w*w),o=Math.sqrt(j*j+N*N),l=y||w?pp(w,y)*hp:0,(u=N||j?pp(N,j)*hp+l:0)&&(o*=Math.abs(Math.cos(u*mp))),i.svg&&(a-=p-(p*y+f*N),s-=f-(p*w+f*j))):(M=g[6],P=g[7],z=g[8],E=g[9],I=g[10],T=g[11],a=g[12],s=g[13],r=g[14],c=(x=pp(M,I))*hp,x&&(k=S*(b=Math.cos(-x))+z*(v=Math.sin(-x)),C=_*b+E*v,A=M*b+I*v,z=S*-v+z*b,E=_*-v+E*b,I=M*-v+I*b,T=P*-v+T*b,S=k,_=C,M=A),d=(x=pp(-N,I))*hp,x&&(b=Math.cos(-x),T=j*(v=Math.sin(-x))+T*b,y=k=y*b-z*v,w=C=w*b-E*v,N=A=N*b-I*v),l=(x=pp(w,y))*hp,x&&(k=y*(b=Math.cos(x))+w*(v=Math.sin(x)),C=S*b+_*v,w=w*b-y*v,_=_*b-S*v,y=k,S=C),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,d=180-d),n=Zu(Math.sqrt(y*y+w*w+N*N)),o=Zu(Math.sqrt(_*_+M*M)),x=pp(S,_),u=Math.abs(x)>2e-4?x*hp:0,m=T?1/(T<0?-T:T):0),i.svg&&(k=e.getAttribute("transform"),i.forceCSS=e.setAttribute("transform","")||!nf(Dp(e,Ip)),k&&e.setAttribute("transform",k))),Math.abs(u)>90&&Math.abs(u)<270&&(F?(n*=-1,u+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,u+=u<=0?180:-180)),t=t||i.uncache,i.x=a-((i.xPercent=a&&(!t&&i.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-a)?-50:0)))?e.offsetWidth*i.xPercent/100:0)+O,i.y=s-((i.yPercent=s&&(!t&&i.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-s)?-50:0)))?e.offsetHeight*i.yPercent/100:0)+O,i.z=r+O,i.scaleX=Zu(n),i.scaleY=Zu(o),i.rotation=Zu(l)+D,i.rotationX=Zu(c)+D,i.rotationY=Zu(d)+D,i.skewX=u+D,i.skewY=h+D,i.transformPerspective=m+O,(i.zOrigin=parseFloat(B.split(" ")[2])||!t&&i.zOrigin||0)&&(L[Pp]=uf(B)),i.xOffset=i.yOffset=0,i.force3D=Xd.force3D,i.renderTransform=i.svg?bf:dp?xf:mf,i.uncache=0,i},uf=function(e){return(e=e.split(" "))[0]+" "+e[1]},hf=function(e,t,i){var a=Eh(t);return Zu(parseFloat(t)+parseFloat(Kp(e,"x",i+"px",a)))+a},mf=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,xf(e,t)},pf="0deg",ff="0px",gf=") ",xf=function(e,t){var i=t||this,a=i.xPercent,s=i.yPercent,r=i.x,n=i.y,o=i.z,l=i.rotation,c=i.rotationY,d=i.rotationX,u=i.skewX,h=i.skewY,m=i.scaleX,p=i.scaleY,f=i.transformPerspective,g=i.force3D,x=i.target,b=i.zOrigin,v="",y="auto"===g&&e&&1!==e||!0===g;if(b&&(d!==pf||c!==pf)){var w,N=parseFloat(c)*mp,j=Math.sin(N),S=Math.cos(N);N=parseFloat(d)*mp,w=Math.cos(N),r=hf(x,r,j*w*-b),n=hf(x,n,-Math.sin(N)*-b),o=hf(x,o,S*w*-b+b)}f!==ff&&(v+="perspective("+f+gf),(a||s)&&(v+="translate("+a+"%, "+s+"%) "),(y||r!==ff||n!==ff||o!==ff)&&(v+=o!==ff||y?"translate3d("+r+", "+n+", "+o+") ":"translate("+r+", "+n+gf),l!==pf&&(v+="rotate("+l+gf),c!==pf&&(v+="rotateY("+c+gf),d!==pf&&(v+="rotateX("+d+gf),u===pf&&h===pf||(v+="skew("+u+", "+h+gf),1===m&&1===p||(v+="scale("+m+", "+p+gf),x.style[Ip]=v||"translate(0, 0)"},bf=function(e,t){var i,a,s,r,n,o=t||this,l=o.xPercent,c=o.yPercent,d=o.x,u=o.y,h=o.rotation,m=o.skewX,p=o.skewY,f=o.scaleX,g=o.scaleY,x=o.target,b=o.xOrigin,v=o.yOrigin,y=o.xOffset,w=o.yOffset,N=o.forceCSS,j=parseFloat(d),S=parseFloat(u);h=parseFloat(h),m=parseFloat(m),(p=parseFloat(p))&&(m+=p=parseFloat(p),h+=p),h||m?(h*=mp,m*=mp,i=Math.cos(h)*f,a=Math.sin(h)*f,s=Math.sin(h-m)*-g,r=Math.cos(h-m)*g,m&&(p*=mp,n=Math.tan(m-p),s*=n=Math.sqrt(1+n*n),r*=n,p&&(n=Math.tan(p),i*=n=Math.sqrt(1+n*n),a*=n)),i=Zu(i),a=Zu(a),s=Zu(s),r=Zu(r)):(i=f,r=g,a=s=0),(j&&!~(d+"").indexOf("px")||S&&!~(u+"").indexOf("px"))&&(j=Kp(x,"x",d,"px"),S=Kp(x,"y",u,"px")),(b||v||y||w)&&(j=Zu(j+b-(b*i+v*s)+y),S=Zu(S+v-(b*a+v*r)+w)),(l||c)&&(n=x.getBBox(),j=Zu(j+l/100*n.width),S=Zu(S+c/100*n.height)),n="matrix("+i+","+a+","+s+","+r+","+j+","+S+")",x.setAttribute("transform",n),N&&(x.style[Ip]=n)},vf=function(e,t,i,a,s){var r,n,o=360,l=ou(s),c=parseFloat(s)*(l&&~s.indexOf("rad")?hp:1)-a,d=a+c+"deg";return l&&("short"===(r=s.split("_")[1])&&(c%=o)!==c%180&&(c+=c<0?o:-360),"cw"===r&&c<0?c=(c+36e9)%o-~~(c/o)*o:"ccw"===r&&c>0&&(c=(c-36e9)%o-~~(c/o)*o)),e._pt=n=new $m(e._pt,t,i,a,c,yp),n.e=d,n.u="deg",e._props.push(i),n},yf=function(e,t){for(var i in t)e[i]=t[i];return e},wf=function(e,t,i){var a,s,r,n,o,l,c,d=yf({},i._gsap),u=i.style;for(s in d.svg?(r=i.getAttribute("transform"),i.setAttribute("transform",""),u[Ip]=t,a=df(i,1),Zp(i,Ip),i.setAttribute("transform",r)):(r=getComputedStyle(i)[Ip],u[Ip]=t,a=df(i,1),u[Ip]=r),up)(r=d[s])!==(n=a[s])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(s)<0&&(o=Eh(r)!==(c=Eh(n))?Kp(i,s,r,c):parseFloat(r),l=parseFloat(n),e._pt=new $m(e._pt,a,s,o,l-o,vp),e._pt.u=c||0,e._props.push(s));yf(a,d)};Hu("padding,margin,Width,Radius",function(e,t){var i="Top",a="Right",s="Bottom",r="Left",n=(t<3?[i,a,s,r]:[i+r,i+a,s+a,s+r]).map(function(i){return t<2?e+i:"border"+i+e});af[t>1?"border"+e:e]=function(e,t,i,a,s){var r,o;if(arguments.length<4)return r=n.map(function(t){return Xp(e,t,i)}),5===(o=r.join(" ")).split(r[0]).length?r[0]:o;r=(a+"").split(" "),o={},n.forEach(function(e,t){return o[e]=r[t]=r[t]||r[(t-1)/2|0]}),e.init(t,o,s)}});var Nf,jf,Sf,_f={name:"css",register:Up,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,i,a,s){var r,n,o,l,c,d,u,h,m,p,f,g,x,b,v,y,w=this._props,N=e.style,j=i.vars.startAt;for(u in np||Up(),this.styles=this.styles||Fp(e),y=this.styles.props,this.tween=i,t)if("autoRound"!==u&&(n=t[u],!Ou[u]||!jm(u,t,i,a,e,s)))if(c=typeof n,d=af[u],"function"===c&&(c=typeof(n=n.call(i,a,e,s))),"string"===c&&~n.indexOf("random(")&&(n=Uh(n)),d)d(this,e,u,n,i)&&(v=1);else if("--"===u.substr(0,2))r=(getComputedStyle(e).getPropertyValue(u)+"").trim(),n+="",em.lastIndex=0,em.test(r)||(h=Eh(r),m=Eh(n)),m?h!==m&&(r=Kp(e,u,r,m)+m):h&&(n+=h),this.add(N,"setProperty",r,n,a,s,0,0,u),w.push(u),y.push(u,0,N[u]);else if("undefined"!==c){if(j&&u in j?(r="function"==typeof j[u]?j[u].call(i,a,e,s):j[u],ou(r)&&~r.indexOf("random(")&&(r=Uh(r)),Eh(r+"")||"auto"===r||(r+=Xd.units[u]||Eh(Xp(e,u))||""),"="===(r+"").charAt(1)&&(r=Xp(e,u))):r=Xp(e,u),l=parseFloat(r),(p="string"===c&&"="===n.charAt(1)&&n.substr(0,2))&&(n=n.substr(2)),o=parseFloat(n),u in bp&&("autoAlpha"===u&&(1===l&&"hidden"===Xp(e,"visibility")&&o&&(l=0),y.push("visibility",0,N.visibility),Vp(this,N,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),"scale"!==u&&"transform"!==u&&~(u=bp[u]).indexOf(",")&&(u=u.split(",")[0])),f=u in up)if(this.styles.save(u),"string"===c&&"var(--"===n.substring(0,6)&&(n=Dp(e,n.substring(4,n.indexOf(")"))),o=parseFloat(n)),g||((x=e._gsap).renderTransform&&!t.parseTransform||df(e,t.parseTransform),b=!1!==t.smoothOrigin&&x.smooth,(g=this._pt=new $m(this._pt,N,Ip,0,1,x.renderTransform,x,0,-1)).dep=1),"scale"===u)this._pt=new $m(this._pt,x,"scaleY",x.scaleY,(p?Gu(x.scaleY,p+o):o)-x.scaleY||0,vp),this._pt.u=0,w.push("scaleY",u),u+="X";else{if("transformOrigin"===u){y.push(Pp,0,N[Pp]),n=ef(n),x.svg?cf(e,n,0,b,0,this):((m=parseFloat(n.split(" ")[2])||0)!==x.zOrigin&&Vp(this,x,"zOrigin",x.zOrigin,m),Vp(this,N,u,uf(r),uf(n)));continue}if("svgOrigin"===u){cf(e,n,1,b,0,this);continue}if(u in rf){vf(this,x,u,l,p?Gu(l,p+n):n);continue}if("smoothOrigin"===u){Vp(this,x,"smooth",x.smooth,n);continue}if("force3D"===u){x[u]=n;continue}if("transform"===u){wf(this,n,e);continue}}else u in N||(u=Bp(u)||u);if(f||(o||0===o)&&(l||0===l)&&!xp.test(n)&&u in N)o||(o=0),(h=(r+"").substr((l+"").length))!==(m=Eh(n)||(u in Xd.units?Xd.units[u]:h))&&(l=Kp(e,u,r,m)),this._pt=new $m(this._pt,f?x:N,u,l,(p?Gu(l,p+o):o)-l,f||"px"!==m&&"zIndex"!==u||!1===t.autoRound?vp:Np),this._pt.u=m||0,h!==m&&"%"!==m&&(this._pt.b=r,this._pt.r=wp);else if(u in N)Jp.call(this,e,u,r,p?p+n:n);else if(u in e)this.add(e,u,r||e[u],p?p+n:n,a,s);else if("parseTransform"!==u){Cu(u,n);continue}f||(u in N?y.push(u,0,N[u]):"function"==typeof e[u]?y.push(u,2,e[u]()):y.push(u,1,r||e[u])),w.push(u)}v&&qm(this)},render:function(e,t){if(t.tween._time||!cp())for(var i=t._pt;i;)i.r(e,i.d),i=i._next;else t.styles.revert()},get:Xp,aliases:bp,getSetter:function(e,t,i){var a=bp[t];return a&&a.indexOf(",")<0&&(t=a),t in up&&t!==Pp&&(e._gsap.x||Xp(e,"x"))?i&&lp===i?"scale"===t?Ap:Cp:(lp=i||{})&&("scale"===t?zp:Ep):e.style&&!du(e.style[t])?_p:~t.indexOf("-")?kp:Mm(e,t)},core:{_removeProperty:Zp,_getMatrix:lf}};ip.utils.checkPrefix=Bp,ip.core.getStyleSaver=Fp,Sf=Hu((Nf="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(jf="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(e){up[e]=1}),Hu(jf,function(e){Xd.units[e]="deg",rf[e]=1}),bp[Sf[13]]=Nf+","+jf,Hu("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(e){var t=e.split(":");bp[t[1]]=Sf[t[0]]}),Hu("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(e){Xd.units[e]="px"}),ip.registerPlugin(_f);var kf=ip.registerPlugin(_f)||ip;function Cf(e,t,i){return t&&function(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(e.prototype,t),e}kf.core.Tween;var Af,zf,Ef,If,Pf,Tf,Mf,Lf,Ff,Of,Df,Rf,Bf,Uf=function(){return Af||"undefined"!=typeof window&&(Af=window.gsap)&&Af.registerPlugin&&Af},qf=1,$f=[],Wf=[],Hf=[],Zf=Date.now,Vf=function(e,t){return t},Gf=function(e,t){return~Hf.indexOf(e)&&Hf[Hf.indexOf(e)+1][t]},Yf=function(e){return!!~Of.indexOf(e)},Kf=function(e,t,i,a,s){return e.addEventListener(t,i,{passive:!1!==a,capture:!!s})},Xf=function(e,t,i,a){return e.removeEventListener(t,i,!!a)},Jf="scrollLeft",Qf="scrollTop",eg=function(){return Df&&Df.isPressed||Wf.cache++},tg=function(e,t){var i=function i(a){if(a||0===a){qf&&(Ef.history.scrollRestoration="manual");var s=Df&&Df.isPressed;a=i.v=Math.round(a)||(Df&&Df.iOS?1:0),e(a),i.cacheID=Wf.cache,s&&Vf("ss",a)}else(t||Wf.cache!==i.cacheID||Vf("ref"))&&(i.cacheID=Wf.cache,i.v=e());return i.v+i.offset};return i.offset=0,e&&i},ig={s:Jf,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:tg(function(e){return arguments.length?Ef.scrollTo(e,ag.sc()):Ef.pageXOffset||If[Jf]||Pf[Jf]||Tf[Jf]||0})},ag={s:Qf,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:ig,sc:tg(function(e){return arguments.length?Ef.scrollTo(ig.sc(),e):Ef.pageYOffset||If[Qf]||Pf[Qf]||Tf[Qf]||0})},sg=function(e,t){return(t&&t._ctx&&t._ctx.selector||Af.utils.toArray)(e)[0]||("string"==typeof e&&!1!==Af.config().nullTargetWarn?console.warn("Element not found:",e):null)},rg=function(e,t){var i=t.s,a=t.sc;Yf(e)&&(e=If.scrollingElement||Pf);var s=Wf.indexOf(e),r=a===ag.sc?1:2;!~s&&(s=Wf.push(e)-1),Wf[s+r]||Kf(e,"scroll",eg);var n=Wf[s+r],o=n||(Wf[s+r]=tg(Gf(e,i),!0)||(Yf(e)?a:tg(function(t){return arguments.length?e[i]=t:e[i]})));return o.target=e,n||(o.smooth="smooth"===Af.getProperty(e,"scrollBehavior")),o},ng=function(e,t,i){var a=e,s=e,r=Zf(),n=r,o=t||50,l=Math.max(500,3*o),c=function(e,t){var l=Zf();t||l-r>o?(s=a,a=e,n=r,r=l):i?a+=e:a=s+(e-s)/(l-n)*(r-n)};return{update:c,reset:function(){s=a=i?0:a,n=r=0},getVelocity:function(e){var t=n,o=s,d=Zf();return(e||0===e)&&e!==a&&c(e),r===n||d-n>l?0:(a+(i?o:-o))/((i?d:r)-t)*1e3}}},og=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},lg=function(e){var t=Math.max.apply(Math,e),i=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(i)?t:i},cg=function(){var e,t,i,a;(Ff=Af.core.globals().ScrollTrigger)&&Ff.core&&(e=Ff.core,t=e.bridge||{},i=e._scrollers,a=e._proxies,i.push.apply(i,Wf),a.push.apply(a,Hf),Wf=i,Hf=a,Vf=function(e,i){return t[e](i)})},dg=function(e){return Af=e||Uf(),!zf&&Af&&"undefined"!=typeof document&&document.body&&(Ef=window,If=document,Pf=If.documentElement,Tf=If.body,Of=[Ef,If,Pf,Tf],Af.utils.clamp,Bf=Af.core.context||function(){},Lf="onpointerenter"in Tf?"pointer":"mouse",Mf=ug.isTouch=Ef.matchMedia&&Ef.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in Ef||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,Rf=ug.eventTypes=("ontouchstart"in Pf?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in Pf?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return qf=0},500),cg(),zf=1),zf};ig.op=ag,Wf.cache=0;var ug=function(){function e(e){this.init(e)}return e.prototype.init=function(e){zf||dg(Af)||console.warn("Please gsap.registerPlugin(Observer)"),Ff||cg();var t=e.tolerance,i=e.dragMinimum,a=e.type,s=e.target,r=e.lineHeight,n=e.debounce,o=e.preventDefault,l=e.onStop,c=e.onStopDelay,d=e.ignore,u=e.wheelSpeed,h=e.event,m=e.onDragStart,p=e.onDragEnd,f=e.onDrag,g=e.onPress,x=e.onRelease,b=e.onRight,v=e.onLeft,y=e.onUp,w=e.onDown,N=e.onChangeX,j=e.onChangeY,S=e.onChange,_=e.onToggleX,k=e.onToggleY,C=e.onHover,A=e.onHoverEnd,z=e.onMove,E=e.ignoreCheck,I=e.isNormalizer,P=e.onGestureStart,T=e.onGestureEnd,M=e.onWheel,L=e.onEnable,F=e.onDisable,O=e.onClick,D=e.scrollSpeed,R=e.capture,B=e.allowClicks,U=e.lockAxis,q=e.onLockAxis;this.target=s=sg(s)||Pf,this.vars=e,d&&(d=Af.utils.toArray(d)),t=t||1e-9,i=i||0,u=u||1,D=D||1,a=a||"wheel,touch,pointer",n=!1!==n,r||(r=parseFloat(Ef.getComputedStyle(Tf).lineHeight)||22);var $,W,H,Z,V,G,Y,K=this,X=0,J=0,Q=e.passive||!o&&!1!==e.passive,ee=rg(s,ig),te=rg(s,ag),ie=ee(),ae=te(),se=~a.indexOf("touch")&&!~a.indexOf("pointer")&&"pointerdown"===Rf[0],re=Yf(s),ne=s.ownerDocument||If,oe=[0,0,0],le=[0,0,0],ce=0,de=function(){return ce=Zf()},ue=function(e,t){return(K.event=e)&&d&&function(e,t){for(var i=t.length;i--;)if(t[i]===e||t[i].contains(e))return!0;return!1}(e.target,d)||t&&se&&"touch"!==e.pointerType||E&&E(e,t)},he=function(){var e=K.deltaX=lg(oe),i=K.deltaY=lg(le),a=Math.abs(e)>=t,s=Math.abs(i)>=t;S&&(a||s)&&S(K,e,i,oe,le),a&&(b&&K.deltaX>0&&b(K),v&&K.deltaX<0&&v(K),N&&N(K),_&&K.deltaX<0!=X<0&&_(K),X=K.deltaX,oe[0]=oe[1]=oe[2]=0),s&&(w&&K.deltaY>0&&w(K),y&&K.deltaY<0&&y(K),j&&j(K),k&&K.deltaY<0!=J<0&&k(K),J=K.deltaY,le[0]=le[1]=le[2]=0),(Z||H)&&(z&&z(K),H&&(m&&1===H&&m(K),f&&f(K),H=0),Z=!1),G&&!(G=!1)&&q&&q(K),V&&(M(K),V=!1),$=0},me=function(e,t,i){oe[i]+=e,le[i]+=t,K._vx.update(e),K._vy.update(t),n?$||($=requestAnimationFrame(he)):he()},pe=function(e,t){U&&!Y&&(K.axis=Y=Math.abs(e)>Math.abs(t)?"x":"y",G=!0),"y"!==Y&&(oe[2]+=e,K._vx.update(e,!0)),"x"!==Y&&(le[2]+=t,K._vy.update(t,!0)),n?$||($=requestAnimationFrame(he)):he()},fe=function(e){if(!ue(e,1)){var t=(e=og(e,o)).clientX,a=e.clientY,s=t-K.x,r=a-K.y,n=K.isDragging;K.x=t,K.y=a,(n||(s||r)&&(Math.abs(K.startX-t)>=i||Math.abs(K.startY-a)>=i))&&(H=n?2:1,n||(K.isDragging=!0),pe(s,r))}},ge=K.onPress=function(e){ue(e,1)||e&&e.button||(K.axis=Y=null,W.pause(),K.isPressed=!0,e=og(e),X=J=0,K.startX=K.x=e.clientX,K.startY=K.y=e.clientY,K._vx.reset(),K._vy.reset(),Kf(I?s:ne,Rf[1],fe,Q,!0),K.deltaX=K.deltaY=0,g&&g(K))},xe=K.onRelease=function(e){if(!ue(e,1)){Xf(I?s:ne,Rf[1],fe,!0);var t=!isNaN(K.y-K.startY),i=K.isDragging,a=i&&(Math.abs(K.x-K.startX)>3||Math.abs(K.y-K.startY)>3),r=og(e);!a&&t&&(K._vx.reset(),K._vy.reset(),o&&B&&Af.delayedCall(.08,function(){if(Zf()-ce>300&&!e.defaultPrevented)if(e.target.click)e.target.click();else if(ne.createEvent){var t=ne.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,Ef,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(t)}})),K.isDragging=K.isGesturing=K.isPressed=!1,l&&i&&!I&&W.restart(!0),H&&he(),p&&i&&p(K),x&&x(K,a)}},be=function(e){return e.touches&&e.touches.length>1&&(K.isGesturing=!0)&&P(e,K.isDragging)},ve=function(){return(K.isGesturing=!1)||T(K)},ye=function(e){if(!ue(e)){var t=ee(),i=te();me((t-ie)*D,(i-ae)*D,1),ie=t,ae=i,l&&W.restart(!0)}},we=function(e){if(!ue(e)){e=og(e,o),M&&(V=!0);var t=(1===e.deltaMode?r:2===e.deltaMode?Ef.innerHeight:1)*u;me(e.deltaX*t,e.deltaY*t,0),l&&!I&&W.restart(!0)}},Ne=function(e){if(!ue(e)){var t=e.clientX,i=e.clientY,a=t-K.x,s=i-K.y;K.x=t,K.y=i,Z=!0,l&&W.restart(!0),(a||s)&&pe(a,s)}},je=function(e){K.event=e,C(K)},Se=function(e){K.event=e,A(K)},_e=function(e){return ue(e)||og(e,o)&&O(K)};W=K._dc=Af.delayedCall(c||.25,function(){K._vx.reset(),K._vy.reset(),W.pause(),l&&l(K)}).pause(),K.deltaX=K.deltaY=0,K._vx=ng(0,50,!0),K._vy=ng(0,50,!0),K.scrollX=ee,K.scrollY=te,K.isDragging=K.isGesturing=K.isPressed=!1,Bf(this),K.enable=function(e){return K.isEnabled||(Kf(re?ne:s,"scroll",eg),a.indexOf("scroll")>=0&&Kf(re?ne:s,"scroll",ye,Q,R),a.indexOf("wheel")>=0&&Kf(s,"wheel",we,Q,R),(a.indexOf("touch")>=0&&Mf||a.indexOf("pointer")>=0)&&(Kf(s,Rf[0],ge,Q,R),Kf(ne,Rf[2],xe),Kf(ne,Rf[3],xe),B&&Kf(s,"click",de,!0,!0),O&&Kf(s,"click",_e),P&&Kf(ne,"gesturestart",be),T&&Kf(ne,"gestureend",ve),C&&Kf(s,Lf+"enter",je),A&&Kf(s,Lf+"leave",Se),z&&Kf(s,Lf+"move",Ne)),K.isEnabled=!0,K.isDragging=K.isGesturing=K.isPressed=Z=H=!1,K._vx.reset(),K._vy.reset(),ie=ee(),ae=te(),e&&e.type&&ge(e),L&&L(K)),K},K.disable=function(){K.isEnabled&&($f.filter(function(e){return e!==K&&Yf(e.target)}).length||Xf(re?ne:s,"scroll",eg),K.isPressed&&(K._vx.reset(),K._vy.reset(),Xf(I?s:ne,Rf[1],fe,!0)),Xf(re?ne:s,"scroll",ye,R),Xf(s,"wheel",we,R),Xf(s,Rf[0],ge,R),Xf(ne,Rf[2],xe),Xf(ne,Rf[3],xe),Xf(s,"click",de,!0),Xf(s,"click",_e),Xf(ne,"gesturestart",be),Xf(ne,"gestureend",ve),Xf(s,Lf+"enter",je),Xf(s,Lf+"leave",Se),Xf(s,Lf+"move",Ne),K.isEnabled=K.isPressed=K.isDragging=!1,F&&F(K))},K.kill=K.revert=function(){K.disable();var e=$f.indexOf(K);e>=0&&$f.splice(e,1),Df===K&&(Df=0)},$f.push(K),I&&Yf(s)&&(Df=K),K.enable(h)},Cf(e,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),e}();ug.version="3.13.0",ug.create=function(e){return new ug(e)},ug.register=dg,ug.getAll=function(){return $f.slice()},ug.getById=function(e){return $f.filter(function(t){return t.vars.id===e})[0]},Uf()&&Af.registerPlugin(ug);var hg,mg,pg,fg,gg,xg,bg,vg,yg,wg,Ng,jg,Sg,_g,kg,Cg,Ag,zg,Eg,Ig,Pg,Tg,Mg,Lg,Fg,Og,Dg,Rg,Bg,Ug,qg,$g,Wg,Hg,Zg,Vg,Gg,Yg,Kg=1,Xg=Date.now,Jg=Xg(),Qg=0,ex=0,tx=function(e,t,i){var a=fx(e)&&("clamp("===e.substr(0,6)||e.indexOf("max")>-1);return i["_"+t+"Clamp"]=a,a?e.substr(6,e.length-7):e},ix=function(e,t){return!t||fx(e)&&"clamp("===e.substr(0,6)?e:"clamp("+e+")"},ax=function e(){return ex&&requestAnimationFrame(e)},sx=function(){return _g=1},rx=function(){return _g=0},nx=function(e){return e},ox=function(e){return Math.round(1e5*e)/1e5||0},lx=function(){return"undefined"!=typeof window},cx=function(){return hg||lx()&&(hg=window.gsap)&&hg.registerPlugin&&hg},dx=function(e){return!!~bg.indexOf(e)},ux=function(e){return("Height"===e?qg:pg["inner"+e])||gg["client"+e]||xg["client"+e]},hx=function(e){return Gf(e,"getBoundingClientRect")||(dx(e)?function(){return _b.width=pg.innerWidth,_b.height=qg,_b}:function(){return Dx(e)})},mx=function(e,t){var i=t.s,a=t.d2,s=t.d,r=t.a;return Math.max(0,(i="scroll"+a)&&(r=Gf(e,i))?r()-hx(e)()[s]:dx(e)?(gg[i]||xg[i])-ux(a):e[i]-e["offset"+a])},px=function(e,t){for(var i=0;i<Eg.length;i+=3)(!t||~t.indexOf(Eg[i+1]))&&e(Eg[i],Eg[i+1],Eg[i+2])},fx=function(e){return"string"==typeof e},gx=function(e){return"function"==typeof e},xx=function(e){return"number"==typeof e},bx=function(e){return"object"==typeof e},vx=function(e,t,i){return e&&e.progress(t?0:1)&&i&&e.pause()},yx=function(e,t){if(e.enabled){var i=e._ctx?e._ctx.add(function(){return t(e)}):t(e);i&&i.totalTime&&(e.callbackAnimation=i)}},wx=Math.abs,Nx="left",jx="right",Sx="bottom",_x="width",kx="height",Cx="Right",Ax="Left",zx="Top",Ex="Bottom",Ix="padding",Px="margin",Tx="Width",Mx="Height",Lx="px",Fx=function(e){return pg.getComputedStyle(e)},Ox=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},Dx=function(e,t){var i=t&&"matrix(1, 0, 0, 1, 0, 0)"!==Fx(e)[kg]&&hg.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),a=e.getBoundingClientRect();return i&&i.progress(0).kill(),a},Rx=function(e,t){var i=t.d2;return e["offset"+i]||e["client"+i]||0},Bx=function(e){var t,i=[],a=e.labels,s=e.duration();for(t in a)i.push(a[t]/s);return i},Ux=function(e){var t=hg.utils.snap(e),i=Array.isArray(e)&&e.slice(0).sort(function(e,t){return e-t});return i?function(e,a,s){var r;if(void 0===s&&(s=.001),!a)return t(e);if(a>0){for(e-=s,r=0;r<i.length;r++)if(i[r]>=e)return i[r];return i[r-1]}for(r=i.length,e+=s;r--;)if(i[r]<=e)return i[r];return i[0]}:function(i,a,s){void 0===s&&(s=.001);var r=t(i);return!a||Math.abs(r-i)<s||r-i<0==a<0?r:t(a<0?i-e:i+e)}},qx=function(e,t,i,a){return i.split(",").forEach(function(i){return e(t,i,a)})},$x=function(e,t,i,a,s){return e.addEventListener(t,i,{passive:!a,capture:!!s})},Wx=function(e,t,i,a){return e.removeEventListener(t,i,!!a)},Hx=function(e,t,i){(i=i&&i.wheelHandler)&&(e(t,"wheel",i),e(t,"touchmove",i))},Zx={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Vx={toggleActions:"play",anticipatePin:0},Gx={top:0,left:0,center:.5,bottom:1,right:1},Yx=function(e,t){if(fx(e)){var i=e.indexOf("="),a=~i?+(e.charAt(i-1)+1)*parseFloat(e.substr(i+1)):0;~i&&(e.indexOf("%")>i&&(a*=t/100),e=e.substr(0,i-1)),e=a+(e in Gx?Gx[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},Kx=function(e,t,i,a,s,r,n,o){var l=s.startColor,c=s.endColor,d=s.fontSize,u=s.indent,h=s.fontWeight,m=fg.createElement("div"),p=dx(i)||"fixed"===Gf(i,"pinType"),f=-1!==e.indexOf("scroller"),g=p?xg:i,x=-1!==e.indexOf("start"),b=x?l:c,v="border-color:"+b+";font-size:"+d+";color:"+b+";font-weight:"+h+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return v+="position:"+((f||o)&&p?"fixed;":"absolute;"),(f||o||!p)&&(v+=(a===ag?jx:Sx)+":"+(r+parseFloat(u))+"px;"),n&&(v+="box-sizing:border-box;text-align:left;width:"+n.offsetWidth+"px;"),m._isStart=x,m.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),m.style.cssText=v,m.innerText=t||0===t?e+"-"+t:e,g.children[0]?g.insertBefore(m,g.children[0]):g.appendChild(m),m._offset=m["offset"+a.op.d2],Xx(m,0,a,x),m},Xx=function(e,t,i,a){var s={display:"block"},r=i[a?"os2":"p2"],n=i[a?"p2":"os2"];e._isFlipped=a,s[i.a+"Percent"]=a?-100:0,s[i.a]=a?"1px":0,s["border"+r+Tx]=1,s["border"+n+Tx]=0,s[i.p]=t+"px",hg.set(e,s)},Jx=[],Qx={},eb=function(){return Xg()-Qg>34&&(Zg||(Zg=requestAnimationFrame(bb)))},tb=function(){(!Mg||!Mg.isPressed||Mg.startX>xg.clientWidth)&&(Wf.cache++,Mg?Zg||(Zg=requestAnimationFrame(bb)):bb(),Qg||ob("scrollStart"),Qg=Xg())},ib=function(){Og=pg.innerWidth,Fg=pg.innerHeight},ab=function(e){Wf.cache++,(!0===e||!Sg&&!Tg&&!fg.fullscreenElement&&!fg.webkitFullscreenElement&&(!Lg||Og!==pg.innerWidth||Math.abs(pg.innerHeight-Fg)>.25*pg.innerHeight))&&vg.restart(!0)},sb={},rb=[],nb=function e(){return Wx(Pb,"scrollEnd",e)||fb(!0)},ob=function(e){return sb[e]&&sb[e].map(function(e){return e()})||rb},lb=[],cb=function(e){for(var t=0;t<lb.length;t+=5)(!e||lb[t+4]&&lb[t+4].query===e)&&(lb[t].style.cssText=lb[t+1],lb[t].getBBox&&lb[t].setAttribute("transform",lb[t+2]||""),lb[t+3].uncache=1)},db=function(e,t){var i;for(Cg=0;Cg<Jx.length;Cg++)!(i=Jx[Cg])||t&&i._ctx!==t||(e?i.kill(1):i.revert(!0,!0));$g=!0,t&&cb(t),t||ob("revert")},ub=function(e,t){Wf.cache++,(t||!Vg)&&Wf.forEach(function(e){return gx(e)&&e.cacheID++&&(e.rec=0)}),fx(e)&&(pg.history.scrollRestoration=Bg=e)},hb=0,mb=function(){xg.appendChild(Ug),qg=!Mg&&Ug.offsetHeight||pg.innerHeight,xg.removeChild(Ug)},pb=function(e){return yg(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(t){return t.style.display=e?"none":"block"})},fb=function(e,t){if(gg=fg.documentElement,xg=fg.body,bg=[pg,fg,gg,xg],!Qg||e||$g){mb(),Vg=Pb.isRefreshing=!0,Wf.forEach(function(e){return gx(e)&&++e.cacheID&&(e.rec=e())});var i=ob("refreshInit");Ig&&Pb.sort(),t||db(),Wf.forEach(function(e){gx(e)&&(e.smooth&&(e.target.style.scrollBehavior="auto"),e(0))}),Jx.slice(0).forEach(function(e){return e.refresh()}),$g=!1,Jx.forEach(function(e){if(e._subPinOffset&&e.pin){var t=e.vars.horizontal?"offsetWidth":"offsetHeight",i=e.pin[t];e.revert(!0,1),e.adjustPinSpacing(e.pin[t]-i),e.refresh()}}),Wg=1,pb(!0),Jx.forEach(function(e){var t=mx(e.scroller,e._dir),i="max"===e.vars.end||e._endClamp&&e.end>t,a=e._startClamp&&e.start>=t;(i||a)&&e.setPositions(a?t-1:e.start,i?Math.max(a?t:e.start+1,t):e.end,!0)}),pb(!1),Wg=0,i.forEach(function(e){return e&&e.render&&e.render(-1)}),Wf.forEach(function(e){gx(e)&&(e.smooth&&requestAnimationFrame(function(){return e.target.style.scrollBehavior="smooth"}),e.rec&&e(e.rec))}),ub(Bg,1),vg.pause(),hb++,Vg=2,bb(2),Jx.forEach(function(e){return gx(e.vars.onRefresh)&&e.vars.onRefresh(e)}),Vg=Pb.isRefreshing=!1,ob("refresh")}else $x(Pb,"scrollEnd",nb)},gb=0,xb=1,bb=function(e){if(2===e||!Vg&&!$g){Pb.isUpdating=!0,Yg&&Yg.update(0);var t=Jx.length,i=Xg(),a=i-Jg>=50,s=t&&Jx[0].scroll();if(xb=gb>s?-1:1,Vg||(gb=s),a&&(Qg&&!_g&&i-Qg>200&&(Qg=0,ob("scrollEnd")),Ng=Jg,Jg=i),xb<0){for(Cg=t;Cg-- >0;)Jx[Cg]&&Jx[Cg].update(0,a);xb=1}else for(Cg=0;Cg<t;Cg++)Jx[Cg]&&Jx[Cg].update(0,a);Pb.isUpdating=!1}Zg=0},vb=[Nx,"top",Sx,jx,Px+Ex,Px+Cx,Px+zx,Px+Ax,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],yb=vb.concat([_x,kx,"boxSizing","max"+Tx,"max"+Mx,"position",Px,Ix,Ix+zx,Ix+Cx,Ix+Ex,Ix+Ax]),wb=function(e,t,i,a){if(!e._gsap.swappedIn){for(var s,r=vb.length,n=t.style,o=e.style;r--;)n[s=vb[r]]=i[s];n.position="absolute"===i.position?"absolute":"relative","inline"===i.display&&(n.display="inline-block"),o[Sx]=o[jx]="auto",n.flexBasis=i.flexBasis||"auto",n.overflow="visible",n.boxSizing="border-box",n[_x]=Rx(e,ig)+Lx,n[kx]=Rx(e,ag)+Lx,n[Ix]=o[Px]=o.top=o[Nx]="0",jb(a),o[_x]=o["max"+Tx]=i[_x],o[kx]=o["max"+Mx]=i[kx],o[Ix]=i[Ix],e.parentNode!==t&&(e.parentNode.insertBefore(t,e),t.appendChild(e)),e._gsap.swappedIn=!0}},Nb=/([A-Z])/g,jb=function(e){if(e){var t,i,a=e.t.style,s=e.length,r=0;for((e.t._gsap||hg.core.getCache(e.t)).uncache=1;r<s;r+=2)i=e[r+1],t=e[r],i?a[t]=i:a[t]&&a.removeProperty(t.replace(Nb,"-$1").toLowerCase())}},Sb=function(e){for(var t=yb.length,i=e.style,a=[],s=0;s<t;s++)a.push(yb[s],i[yb[s]]);return a.t=e,a},_b={left:0,top:0},kb=function(e,t,i,a,s,r,n,o,l,c,d,u,h,m){gx(e)&&(e=e(o)),fx(e)&&"max"===e.substr(0,3)&&(e=u+("="===e.charAt(4)?Yx("0"+e.substr(3),i):0));var p,f,g,x=h?h.time():0;if(h&&h.seek(0),isNaN(e)||(e=+e),xx(e))h&&(e=hg.utils.mapRange(h.scrollTrigger.start,h.scrollTrigger.end,0,u,e)),n&&Xx(n,i,a,!0);else{gx(t)&&(t=t(o));var b,v,y,w,N=(e||"0").split(" ");g=sg(t,o)||xg,(b=Dx(g)||{})&&(b.left||b.top)||"none"!==Fx(g).display||(w=g.style.display,g.style.display="block",b=Dx(g),w?g.style.display=w:g.style.removeProperty("display")),v=Yx(N[0],b[a.d]),y=Yx(N[1]||"0",i),e=b[a.p]-l[a.p]-c+v+s-y,n&&Xx(n,y,a,i-y<20||n._isStart&&y>20),i-=i-y}if(m&&(o[m]=e||-.001,e<0&&(e=0)),r){var j=e+i,S=r._isStart;p="scroll"+a.d2,Xx(r,j,a,S&&j>20||!S&&(d?Math.max(xg[p],gg[p]):r.parentNode[p])<=j+1),d&&(l=Dx(n),d&&(r.style[a.op.p]=l[a.op.p]-a.op.m-r._offset+Lx))}return h&&g&&(p=Dx(g),h.seek(u),f=Dx(g),h._caScrollDist=p[a.p]-f[a.p],e=e/h._caScrollDist*u),h&&h.seek(x),h?e:Math.round(e)},Cb=/(webkit|moz|length|cssText|inset)/i,Ab=function(e,t,i,a){if(e.parentNode!==t){var s,r,n=e.style;if(t===xg){for(s in e._stOrig=n.cssText,r=Fx(e))+s||Cb.test(s)||!r[s]||"string"!=typeof n[s]||"0"===s||(n[s]=r[s]);n.top=i,n.left=a}else n.cssText=e._stOrig;hg.core.getCache(e).uncache=1,t.appendChild(e)}},zb=function(e,t,i){var a=t,s=a;return function(t){var r=Math.round(e());return r!==a&&r!==s&&Math.abs(r-a)>3&&Math.abs(r-s)>3&&(t=r,i&&i()),s=a,a=Math.round(t)}},Eb=function(e,t,i){var a={};a[t.p]="+="+i,hg.set(e,a)},Ib=function(e,t){var i=rg(e,t),a="_scroll"+t.p2,s=function t(s,r,n,o,l){var c=t.tween,d=r.onComplete,u={};n=n||i();var h=zb(i,n,function(){c.kill(),t.tween=0});return l=o&&l||0,o=o||s-n,c&&c.kill(),r[a]=s,r.inherit=!1,r.modifiers=u,u[a]=function(){return h(n+o*c.ratio+l*c.ratio*c.ratio)},r.onUpdate=function(){Wf.cache++,t.tween&&bb()},r.onComplete=function(){t.tween=0,d&&d.call(c)},c=t.tween=hg.to(e,r)};return e[a]=i,i.wheelHandler=function(){return s.tween&&s.tween.kill()&&(s.tween=0)},$x(e,"wheel",i.wheelHandler),Pb.isTouch&&$x(e,"touchmove",i.wheelHandler),s},Pb=function(){function e(t,i){mg||e.register(hg)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),Rg(this),this.init(t,i)}return e.prototype.init=function(t,i){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),ex){var a,s,r,n,o,l,c,d,u,h,m,p,f,g,x,b,v,y,w,N,j,S,_,k,C,A,z,E,I,P,T,M,L,F,O,D,R,B,U,q,$,W,H=t=Ox(fx(t)||xx(t)||t.nodeType?{trigger:t}:t,Vx),Z=H.onUpdate,V=H.toggleClass,G=H.id,Y=H.onToggle,K=H.onRefresh,X=H.scrub,J=H.trigger,Q=H.pin,ee=H.pinSpacing,te=H.invalidateOnRefresh,ie=H.anticipatePin,ae=H.onScrubComplete,se=H.onSnapComplete,re=H.once,ne=H.snap,oe=H.pinReparent,le=H.pinSpacer,ce=H.containerAnimation,de=H.fastScrollEnd,ue=H.preventOverlaps,he=t.horizontal||t.containerAnimation&&!1!==t.horizontal?ig:ag,me=!X&&0!==X,pe=sg(t.scroller||pg),fe=hg.core.getCache(pe),ge=dx(pe),xe="fixed"===("pinType"in t?t.pinType:Gf(pe,"pinType")||ge&&"fixed"),be=[t.onEnter,t.onLeave,t.onEnterBack,t.onLeaveBack],ve=me&&t.toggleActions.split(" "),ye="markers"in t?t.markers:Vx.markers,we=ge?0:parseFloat(Fx(pe)["border"+he.p2+Tx])||0,Ne=this,je=t.onRefreshInit&&function(){return t.onRefreshInit(Ne)},Se=function(e,t,i){var a=i.d,s=i.d2,r=i.a;return(r=Gf(e,"getBoundingClientRect"))?function(){return r()[a]}:function(){return(t?ux(s):e["client"+s])||0}}(pe,ge,he),_e=function(e,t){return!t||~Hf.indexOf(e)?hx(e):function(){return _b}}(pe,ge),ke=0,Ce=0,Ae=0,ze=rg(pe,he);if(Ne._startClamp=Ne._endClamp=!1,Ne._dir=he,ie*=45,Ne.scroller=pe,Ne.scroll=ce?ce.time.bind(ce):ze,n=ze(),Ne.vars=t,i=i||t.animation,"refreshPriority"in t&&(Ig=1,-9999===t.refreshPriority&&(Yg=Ne)),fe.tweenScroll=fe.tweenScroll||{top:Ib(pe,ag),left:Ib(pe,ig)},Ne.tweenTo=a=fe.tweenScroll[he.p],Ne.scrubDuration=function(e){(L=xx(e)&&e)?M?M.duration(e):M=hg.to(i,{ease:"expo",totalProgress:"+=0",inherit:!1,duration:L,paused:!0,onComplete:function(){return ae&&ae(Ne)}}):(M&&M.progress(1).kill(),M=0)},i&&(i.vars.lazy=!1,i._initted&&!Ne.isReverted||!1!==i.vars.immediateRender&&!1!==t.immediateRender&&i.duration()&&i.render(0,!0,!0),Ne.animation=i.pause(),i.scrollTrigger=Ne,Ne.scrubDuration(X),P=0,G||(G=i.vars.id)),ne&&(bx(ne)&&!ne.push||(ne={snapTo:ne}),"scrollBehavior"in xg.style&&hg.set(ge?[xg,gg]:pe,{scrollBehavior:"auto"}),Wf.forEach(function(e){return gx(e)&&e.target===(ge?fg.scrollingElement||gg:pe)&&(e.smooth=!1)}),r=gx(ne.snapTo)?ne.snapTo:"labels"===ne.snapTo?function(e){return function(t){return hg.utils.snap(Bx(e),t)}}(i):"labelsDirectional"===ne.snapTo?(q=i,function(e,t){return Ux(Bx(q))(e,t.direction)}):!1!==ne.directional?function(e,t){return Ux(ne.snapTo)(e,Xg()-Ce<500?0:t.direction)}:hg.utils.snap(ne.snapTo),F=ne.duration||{min:.1,max:2},F=bx(F)?wg(F.min,F.max):wg(F,F),O=hg.delayedCall(ne.delay||L/2||.1,function(){var e=ze(),t=Xg()-Ce<500,s=a.tween;if(!(t||Math.abs(Ne.getVelocity())<10)||s||_g||ke===e)Ne.isActive&&ke!==e&&O.restart(!0);else{var n,o,d=(e-l)/g,u=i&&!me?i.totalProgress():d,h=t?0:(u-T)/(Xg()-Ng)*1e3||0,m=hg.utils.clamp(-d,1-d,wx(h/2)*h/.185),p=d+(!1===ne.inertia?0:m),f=ne,x=f.onStart,b=f.onInterrupt,v=f.onComplete;if(n=r(p,Ne),xx(n)||(n=p),o=Math.max(0,Math.round(l+n*g)),e<=c&&e>=l&&o!==e){if(s&&!s._initted&&s.data<=wx(o-e))return;!1===ne.inertia&&(m=n-d),a(o,{duration:F(wx(.185*Math.max(wx(p-u),wx(n-u))/h/.05||0)),ease:ne.ease||"power3",data:wx(o-e),onInterrupt:function(){return O.restart(!0)&&b&&b(Ne)},onComplete:function(){Ne.update(),ke=ze(),i&&!me&&(M?M.resetTo("totalProgress",n,i._tTime/i._tDur):i.progress(n)),P=T=i&&!me?i.totalProgress():Ne.progress,se&&se(Ne),v&&v(Ne)}},e,m*g,o-e-m*g),x&&x(Ne,a.tween)}}}).pause()),G&&(Qx[G]=Ne),(U=(J=Ne.trigger=sg(J||!0!==Q&&Q))&&J._gsap&&J._gsap.stRevert)&&(U=U(Ne)),Q=!0===Q?J:sg(Q),fx(V)&&(V={targets:J,className:V}),Q&&(!1===ee||ee===Px||(ee=!(!ee&&Q.parentNode&&Q.parentNode.style&&"flex"===Fx(Q.parentNode).display)&&Ix),Ne.pin=Q,(s=hg.core.getCache(Q)).spacer?x=s.pinState:(le&&((le=sg(le))&&!le.nodeType&&(le=le.current||le.nativeElement),s.spacerIsNative=!!le,le&&(s.spacerState=Sb(le))),s.spacer=y=le||fg.createElement("div"),y.classList.add("pin-spacer"),G&&y.classList.add("pin-spacer-"+G),s.pinState=x=Sb(Q)),!1!==t.force3D&&hg.set(Q,{force3D:!0}),Ne.spacer=y=s.spacer,I=Fx(Q),k=I[ee+he.os2],N=hg.getProperty(Q),j=hg.quickSetter(Q,he.a,Lx),wb(Q,y,I),v=Sb(Q)),ye){p=bx(ye)?Ox(ye,Zx):Zx,h=Kx("scroller-start",G,pe,he,p,0),m=Kx("scroller-end",G,pe,he,p,0,h),w=h["offset"+he.op.d2];var Ee=sg(Gf(pe,"content")||pe);d=this.markerStart=Kx("start",G,Ee,he,p,w,0,ce),u=this.markerEnd=Kx("end",G,Ee,he,p,w,0,ce),ce&&(B=hg.quickSetter([d,u],he.a,Lx)),xe||Hf.length&&!0===Gf(pe,"fixedMarkers")||(W=Fx($=ge?xg:pe).position,$.style.position="absolute"===W||"fixed"===W?W:"relative",hg.set([h,m],{force3D:!0}),A=hg.quickSetter(h,he.a,Lx),E=hg.quickSetter(m,he.a,Lx))}if(ce){var Ie=ce.vars.onUpdate,Pe=ce.vars.onUpdateParams;ce.eventCallback("onUpdate",function(){Ne.update(0,0,1),Ie&&Ie.apply(ce,Pe||[])})}if(Ne.previous=function(){return Jx[Jx.indexOf(Ne)-1]},Ne.next=function(){return Jx[Jx.indexOf(Ne)+1]},Ne.revert=function(e,t){if(!t)return Ne.kill(!0);var a=!1!==e||!Ne.enabled,s=Sg;a!==Ne.isReverted&&(a&&(D=Math.max(ze(),Ne.scroll.rec||0),Ae=Ne.progress,R=i&&i.progress()),d&&[d,u,h,m].forEach(function(e){return e.style.display=a?"none":"block"}),a&&(Sg=Ne,Ne.update(a)),!Q||oe&&Ne.isActive||(a?function(e,t,i){jb(i);var a=e._gsap;if(a.spacerIsNative)jb(a.spacerState);else if(e._gsap.swappedIn){var s=t.parentNode;s&&(s.insertBefore(e,t),s.removeChild(t))}e._gsap.swappedIn=!1}(Q,y,x):wb(Q,y,Fx(Q),C)),a||Ne.update(a),Sg=s,Ne.isReverted=a)},Ne.refresh=function(s,r,p,w){if(!Sg&&Ne.enabled||r)if(Q&&s&&Qg)$x(e,"scrollEnd",nb);else{!Vg&&je&&je(Ne),Sg=Ne,a.tween&&!p&&(a.tween.kill(),a.tween=0),M&&M.pause(),te&&i&&(i.revert({kill:!1}).invalidate(),i.getChildren&&i.getChildren(!0,!0,!1).forEach(function(e){return e.vars.immediateRender&&e.render(0,!0,!0)})),Ne.isReverted||Ne.revert(!0,!0),Ne._subPinOffset=!1;var j,k,A,E,I,P,T,L,F,B,U,q,$,W=Se(),H=_e(),Z=ce?ce.duration():mx(pe,he),V=g<=.01||!g,G=0,Y=w||0,X=bx(p)?p.end:t.end,ie=t.endTrigger||J,ae=bx(p)?p.start:t.start||(0!==t.start&&J?Q?"0 0":"0 100%":0),se=Ne.pinnedContainer=t.pinnedContainer&&sg(t.pinnedContainer,Ne),re=J&&Math.max(0,Jx.indexOf(Ne))||0,ne=re;for(ye&&bx(p)&&(q=hg.getProperty(h,he.p),$=hg.getProperty(m,he.p));ne-- >0;)(P=Jx[ne]).end||P.refresh(0,1)||(Sg=Ne),!(T=P.pin)||T!==J&&T!==Q&&T!==se||P.isReverted||(B||(B=[]),B.unshift(P),P.revert(!0,!0)),P!==Jx[ne]&&(re--,ne--);for(gx(ae)&&(ae=ae(Ne)),ae=tx(ae,"start",Ne),l=kb(ae,J,W,he,ze(),d,h,Ne,H,we,xe,Z,ce,Ne._startClamp&&"_startClamp")||(Q?-.001:0),gx(X)&&(X=X(Ne)),fx(X)&&!X.indexOf("+=")&&(~X.indexOf(" ")?X=(fx(ae)?ae.split(" ")[0]:"")+X:(G=Yx(X.substr(2),W),X=fx(ae)?ae:(ce?hg.utils.mapRange(0,ce.duration(),ce.scrollTrigger.start,ce.scrollTrigger.end,l):l)+G,ie=J)),X=tx(X,"end",Ne),c=Math.max(l,kb(X||(ie?"100% 0":Z),ie,W,he,ze()+G,u,m,Ne,H,we,xe,Z,ce,Ne._endClamp&&"_endClamp"))||-.001,G=0,ne=re;ne--;)(T=(P=Jx[ne]).pin)&&P.start-P._pinPush<=l&&!ce&&P.end>0&&(j=P.end-(Ne._startClamp?Math.max(0,P.start):P.start),(T===J&&P.start-P._pinPush<l||T===se)&&isNaN(ae)&&(G+=j*(1-P.progress)),T===Q&&(Y+=j));if(l+=G,c+=G,Ne._startClamp&&(Ne._startClamp+=G),Ne._endClamp&&!Vg&&(Ne._endClamp=c||-.001,c=Math.min(c,mx(pe,he))),g=c-l||(l-=.01)&&.001,V&&(Ae=hg.utils.clamp(0,1,hg.utils.normalize(l,c,D))),Ne._pinPush=Y,d&&G&&((j={})[he.a]="+="+G,se&&(j[he.p]="-="+ze()),hg.set([d,u],j)),!Q||Wg&&Ne.end>=mx(pe,he)){if(J&&ze()&&!ce)for(k=J.parentNode;k&&k!==xg;)k._pinOffset&&(l-=k._pinOffset,c-=k._pinOffset),k=k.parentNode}else j=Fx(Q),E=he===ag,A=ze(),S=parseFloat(N(he.a))+Y,!Z&&c>1&&(U={style:U=(ge?fg.scrollingElement||gg:pe).style,value:U["overflow"+he.a.toUpperCase()]},ge&&"scroll"!==Fx(xg)["overflow"+he.a.toUpperCase()]&&(U.style["overflow"+he.a.toUpperCase()]="scroll")),wb(Q,y,j),v=Sb(Q),k=Dx(Q,!0),L=xe&&rg(pe,E?ig:ag)(),ee?((C=[ee+he.os2,g+Y+Lx]).t=y,(ne=ee===Ix?Rx(Q,he)+g+Y:0)&&(C.push(he.d,ne+Lx),"auto"!==y.style.flexBasis&&(y.style.flexBasis=ne+Lx)),jb(C),se&&Jx.forEach(function(e){e.pin===se&&!1!==e.vars.pinSpacing&&(e._subPinOffset=!0)}),xe&&ze(D)):(ne=Rx(Q,he))&&"auto"!==y.style.flexBasis&&(y.style.flexBasis=ne+Lx),xe&&((I={top:k.top+(E?A-l:L)+Lx,left:k.left+(E?L:A-l)+Lx,boxSizing:"border-box",position:"fixed"})[_x]=I["max"+Tx]=Math.ceil(k.width)+Lx,I[kx]=I["max"+Mx]=Math.ceil(k.height)+Lx,I[Px]=I[Px+zx]=I[Px+Cx]=I[Px+Ex]=I[Px+Ax]="0",I[Ix]=j[Ix],I[Ix+zx]=j[Ix+zx],I[Ix+Cx]=j[Ix+Cx],I[Ix+Ex]=j[Ix+Ex],I[Ix+Ax]=j[Ix+Ax],b=function(e,t,i){for(var a,s=[],r=e.length,n=i?8:0;n<r;n+=2)a=e[n],s.push(a,a in t?t[a]:e[n+1]);return s.t=e.t,s}(x,I,oe),Vg&&ze(0)),i?(F=i._initted,Pg(1),i.render(i.duration(),!0,!0),_=N(he.a)-S+g+Y,z=Math.abs(g-_)>1,xe&&z&&b.splice(b.length-2,2),i.render(0,!0,!0),F||i.invalidate(!0),i.parent||i.totalTime(i.totalTime()),Pg(0)):_=g,U&&(U.value?U.style["overflow"+he.a.toUpperCase()]=U.value:U.style.removeProperty("overflow-"+he.a));B&&B.forEach(function(e){return e.revert(!1,!0)}),Ne.start=l,Ne.end=c,n=o=Vg?D:ze(),ce||Vg||(n<D&&ze(D),Ne.scroll.rec=0),Ne.revert(!1,!0),Ce=Xg(),O&&(ke=-1,O.restart(!0)),Sg=0,i&&me&&(i._initted||R)&&i.progress()!==R&&i.progress(R||0,!0).render(i.time(),!0,!0),(V||Ae!==Ne.progress||ce||te||i&&!i._initted)&&(i&&!me&&(i._initted||Ae||!1!==i.vars.immediateRender)&&i.totalProgress(ce&&l<-.001&&!Ae?hg.utils.normalize(l,c,0):Ae,!0),Ne.progress=V||(n-l)/g===Ae?0:Ae),Q&&ee&&(y._pinOffset=Math.round(Ne.progress*_)),M&&M.invalidate(),isNaN(q)||(q-=hg.getProperty(h,he.p),$-=hg.getProperty(m,he.p),Eb(h,he,q),Eb(d,he,q-(w||0)),Eb(m,he,$),Eb(u,he,$-(w||0))),V&&!Vg&&Ne.update(),!K||Vg||f||(f=!0,K(Ne),f=!1)}},Ne.getVelocity=function(){return(ze()-o)/(Xg()-Ng)*1e3||0},Ne.endAnimation=function(){vx(Ne.callbackAnimation),i&&(M?M.progress(1):i.paused()?me||vx(i,Ne.direction<0,1):vx(i,i.reversed()))},Ne.labelToScroll=function(e){return i&&i.labels&&(l||Ne.refresh()||l)+i.labels[e]/i.duration()*g||0},Ne.getTrailing=function(e){var t=Jx.indexOf(Ne),i=Ne.direction>0?Jx.slice(0,t).reverse():Jx.slice(t+1);return(fx(e)?i.filter(function(t){return t.vars.preventOverlaps===e}):i).filter(function(e){return Ne.direction>0?e.end<=l:e.start>=c})},Ne.update=function(e,t,s){if(!ce||s||e){var r,d,u,m,p,f,x,w=!0===Vg?D:Ne.scroll(),N=e?0:(w-l)/g,C=N<0?0:N>1?1:N||0,I=Ne.progress;if(t&&(o=n,n=ce?ze():w,ne&&(T=P,P=i&&!me?i.totalProgress():C)),ie&&Q&&!Sg&&!Kg&&Qg&&(!C&&l<w+(w-o)/(Xg()-Ng)*ie?C=1e-4:1===C&&c>w+(w-o)/(Xg()-Ng)*ie&&(C=.9999)),C!==I&&Ne.enabled){if(m=(p=(r=Ne.isActive=!!C&&C<1)!==(!!I&&I<1))||!!C!=!!I,Ne.direction=C>I?1:-1,Ne.progress=C,m&&!Sg&&(d=C&&!I?0:1===C?1:1===I?2:3,me&&(u=!p&&"none"!==ve[d+1]&&ve[d+1]||ve[d],x=i&&("complete"===u||"reset"===u||u in i))),ue&&(p||x)&&(x||X||!i)&&(gx(ue)?ue(Ne):Ne.getTrailing(ue).forEach(function(e){return e.endAnimation()})),me||(!M||Sg||Kg?i&&i.totalProgress(C,!(!Sg||!Ce&&!e)):(M._dp._time-M._start!==M._time&&M.render(M._dp._time-M._start),M.resetTo?M.resetTo("totalProgress",C,i._tTime/i._tDur):(M.vars.totalProgress=C,M.invalidate().restart()))),Q)if(e&&ee&&(y.style[ee+he.os2]=k),xe){if(m){if(f=!e&&C>I&&c+1>w&&w+1>=mx(pe,he),oe)if(e||!r&&!f)Ab(Q,y);else{var L=Dx(Q,!0),F=w-l;Ab(Q,xg,L.top+(he===ag?F:0)+Lx,L.left+(he===ag?0:F)+Lx)}jb(r||f?b:v),z&&C<1&&r||j(S+(1!==C||f?0:_))}}else j(ox(S+_*C));ne&&!a.tween&&!Sg&&!Kg&&O.restart(!0),V&&(p||re&&C&&(C<1||!Hg))&&yg(V.targets).forEach(function(e){return e.classList[r||re?"add":"remove"](V.className)}),Z&&!me&&!e&&Z(Ne),m&&!Sg?(me&&(x&&("complete"===u?i.pause().totalProgress(1):"reset"===u?i.restart(!0).pause():"restart"===u?i.restart(!0):i[u]()),Z&&Z(Ne)),!p&&Hg||(Y&&p&&yx(Ne,Y),be[d]&&yx(Ne,be[d]),re&&(1===C?Ne.kill(!1,1):be[d]=0),p||be[d=1===C?1:3]&&yx(Ne,be[d])),de&&!r&&Math.abs(Ne.getVelocity())>(xx(de)?de:2500)&&(vx(Ne.callbackAnimation),M?M.progress(1):vx(i,"reverse"===u?1:!C,1))):me&&Z&&!Sg&&Z(Ne)}if(E){var R=ce?w/ce.duration()*(ce._caScrollDist||0):w;A(R+(h._isFlipped?1:0)),E(R)}B&&B(-w/ce.duration()*(ce._caScrollDist||0))}},Ne.enable=function(t,i){Ne.enabled||(Ne.enabled=!0,$x(pe,"resize",ab),ge||$x(pe,"scroll",tb),je&&$x(e,"refreshInit",je),!1!==t&&(Ne.progress=Ae=0,n=o=ke=ze()),!1!==i&&Ne.refresh())},Ne.getTween=function(e){return e&&a?a.tween:M},Ne.setPositions=function(e,t,i,a){if(ce){var s=ce.scrollTrigger,r=ce.duration(),n=s.end-s.start;e=s.start+n*e/r,t=s.start+n*t/r}Ne.refresh(!1,!1,{start:ix(e,i&&!!Ne._startClamp),end:ix(t,i&&!!Ne._endClamp)},a),Ne.update()},Ne.adjustPinSpacing=function(e){if(C&&e){var t=C.indexOf(he.d)+1;C[t]=parseFloat(C[t])+e+Lx,C[1]=parseFloat(C[1])+e+Lx,jb(C)}},Ne.disable=function(t,i){if(Ne.enabled&&(!1!==t&&Ne.revert(!0,!0),Ne.enabled=Ne.isActive=!1,i||M&&M.pause(),D=0,s&&(s.uncache=1),je&&Wx(e,"refreshInit",je),O&&(O.pause(),a.tween&&a.tween.kill()&&(a.tween=0)),!ge)){for(var r=Jx.length;r--;)if(Jx[r].scroller===pe&&Jx[r]!==Ne)return;Wx(pe,"resize",ab),ge||Wx(pe,"scroll",tb)}},Ne.kill=function(e,a){Ne.disable(e,a),M&&!a&&M.kill(),G&&delete Qx[G];var r=Jx.indexOf(Ne);r>=0&&Jx.splice(r,1),r===Cg&&xb>0&&Cg--,r=0,Jx.forEach(function(e){return e.scroller===Ne.scroller&&(r=1)}),r||Vg||(Ne.scroll.rec=0),i&&(i.scrollTrigger=null,e&&i.revert({kill:!1}),a||i.kill()),d&&[d,u,h,m].forEach(function(e){return e.parentNode&&e.parentNode.removeChild(e)}),Yg===Ne&&(Yg=0),Q&&(s&&(s.uncache=1),r=0,Jx.forEach(function(e){return e.pin===Q&&r++}),r||(s.spacer=0)),t.onKill&&t.onKill(Ne)},Jx.push(Ne),Ne.enable(!1,!1),U&&U(Ne),i&&i.add&&!g){var Te=Ne.update;Ne.update=function(){Ne.update=Te,Wf.cache++,l||c||Ne.refresh()},hg.delayedCall(.01,Ne.update),g=.01,l=c=0}else Ne.refresh();Q&&function(){if(Gg!==hb){var e=Gg=hb;requestAnimationFrame(function(){return e===hb&&fb(!0)})}}()}else this.update=this.refresh=this.kill=nx},e.register=function(t){return mg||(hg=t||cx(),lx()&&window.document&&e.enable(),mg=ex),mg},e.defaults=function(e){if(e)for(var t in e)Vx[t]=e[t];return Vx},e.disable=function(e,t){ex=0,Jx.forEach(function(i){return i[t?"kill":"disable"](e)}),Wx(pg,"wheel",tb),Wx(fg,"scroll",tb),clearInterval(jg),Wx(fg,"touchcancel",nx),Wx(xg,"touchstart",nx),qx(Wx,fg,"pointerdown,touchstart,mousedown",sx),qx(Wx,fg,"pointerup,touchend,mouseup",rx),vg.kill(),px(Wx);for(var i=0;i<Wf.length;i+=3)Hx(Wx,Wf[i],Wf[i+1]),Hx(Wx,Wf[i],Wf[i+2])},e.enable=function(){if(pg=window,fg=document,gg=fg.documentElement,xg=fg.body,hg&&(yg=hg.utils.toArray,wg=hg.utils.clamp,Rg=hg.core.context||nx,Pg=hg.core.suppressOverwrites||nx,Bg=pg.history.scrollRestoration||"auto",gb=pg.pageYOffset||0,hg.core.globals("ScrollTrigger",e),xg)){ex=1,(Ug=document.createElement("div")).style.height="100vh",Ug.style.position="absolute",mb(),ax(),ug.register(hg),e.isTouch=ug.isTouch,Dg=ug.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),Lg=1===ug.isTouch,$x(pg,"wheel",tb),bg=[pg,fg,gg,xg],hg.matchMedia?(e.matchMedia=function(e){var t,i=hg.matchMedia();for(t in e)i.add(t,e[t]);return i},hg.addEventListener("matchMediaInit",function(){return db()}),hg.addEventListener("matchMediaRevert",function(){return cb()}),hg.addEventListener("matchMedia",function(){fb(0,1),ob("matchMedia")}),hg.matchMedia().add("(orientation: portrait)",function(){return ib(),ib})):console.warn("Requires GSAP 3.11.0 or later"),ib(),$x(fg,"scroll",tb);var t,i,a=xg.hasAttribute("style"),s=xg.style,r=s.borderTopStyle,n=hg.core.Animation.prototype;for(n.revert||Object.defineProperty(n,"revert",{value:function(){return this.time(-.01,!0)}}),s.borderTopStyle="solid",t=Dx(xg),ag.m=Math.round(t.top+ag.sc())||0,ig.m=Math.round(t.left+ig.sc())||0,r?s.borderTopStyle=r:s.removeProperty("border-top-style"),a||(xg.setAttribute("style",""),xg.removeAttribute("style")),jg=setInterval(eb,250),hg.delayedCall(.5,function(){return Kg=0}),$x(fg,"touchcancel",nx),$x(xg,"touchstart",nx),qx($x,fg,"pointerdown,touchstart,mousedown",sx),qx($x,fg,"pointerup,touchend,mouseup",rx),kg=hg.utils.checkPrefix("transform"),yb.push(kg),mg=Xg(),vg=hg.delayedCall(.2,fb).pause(),Eg=[fg,"visibilitychange",function(){var e=pg.innerWidth,t=pg.innerHeight;fg.hidden?(Ag=e,zg=t):Ag===e&&zg===t||ab()},fg,"DOMContentLoaded",fb,pg,"load",fb,pg,"resize",ab],px($x),Jx.forEach(function(e){return e.enable(0,1)}),i=0;i<Wf.length;i+=3)Hx(Wx,Wf[i],Wf[i+1]),Hx(Wx,Wf[i],Wf[i+2])}},e.config=function(t){"limitCallbacks"in t&&(Hg=!!t.limitCallbacks);var i=t.syncInterval;i&&clearInterval(jg)||(jg=i)&&setInterval(eb,i),"ignoreMobileResize"in t&&(Lg=1===e.isTouch&&t.ignoreMobileResize),"autoRefreshEvents"in t&&(px(Wx)||px($x,t.autoRefreshEvents||"none"),Tg=-1===(t.autoRefreshEvents+"").indexOf("resize"))},e.scrollerProxy=function(e,t){var i=sg(e),a=Wf.indexOf(i),s=dx(i);~a&&Wf.splice(a,s?6:2),t&&(s?Hf.unshift(pg,t,xg,t,gg,t):Hf.unshift(i,t))},e.clearMatchMedia=function(e){Jx.forEach(function(t){return t._ctx&&t._ctx.query===e&&t._ctx.kill(!0,!0)})},e.isInViewport=function(e,t,i){var a=(fx(e)?sg(e):e).getBoundingClientRect(),s=a[i?_x:kx]*t||0;return i?a.right-s>0&&a.left+s<pg.innerWidth:a.bottom-s>0&&a.top+s<pg.innerHeight},e.positionInViewport=function(e,t,i){fx(e)&&(e=sg(e));var a=e.getBoundingClientRect(),s=a[i?_x:kx],r=null==t?s/2:t in Gx?Gx[t]*s:~t.indexOf("%")?parseFloat(t)*s/100:parseFloat(t)||0;return i?(a.left+r)/pg.innerWidth:(a.top+r)/pg.innerHeight},e.killAll=function(e){if(Jx.slice(0).forEach(function(e){return"ScrollSmoother"!==e.vars.id&&e.kill()}),!0!==e){var t=sb.killAll||[];sb={},t.forEach(function(e){return e()})}},e}();Pb.version="3.13.0",Pb.saveStyles=function(e){return e?yg(e).forEach(function(e){if(e&&e.style){var t=lb.indexOf(e);t>=0&&lb.splice(t,5),lb.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),hg.core.getCache(e),Rg())}}):lb},Pb.revert=function(e,t){return db(!e,t)},Pb.create=function(e,t){return new Pb(e,t)},Pb.refresh=function(e){return e?ab(!0):(mg||Pb.register())&&fb(!0)},Pb.update=function(e){return++Wf.cache&&bb(!0===e?2:0)},Pb.clearScrollMemory=ub,Pb.maxScroll=function(e,t){return mx(e,t?ig:ag)},Pb.getScrollFunc=function(e,t){return rg(sg(e),t?ig:ag)},Pb.getById=function(e){return Qx[e]},Pb.getAll=function(){return Jx.filter(function(e){return"ScrollSmoother"!==e.vars.id})},Pb.isScrolling=function(){return!!Qg},Pb.snapDirectional=Ux,Pb.addEventListener=function(e,t){var i=sb[e]||(sb[e]=[]);~i.indexOf(t)||i.push(t)},Pb.removeEventListener=function(e,t){var i=sb[e],a=i&&i.indexOf(t);a>=0&&i.splice(a,1)},Pb.batch=function(e,t){var i,a=[],s={},r=t.interval||.016,n=t.batchMax||1e9,o=function(e,t){var i=[],a=[],s=hg.delayedCall(r,function(){t(i,a),i=[],a=[]}).pause();return function(e){i.length||s.restart(!0),i.push(e.trigger),a.push(e),n<=i.length&&s.progress(1)}};for(i in t)s[i]="on"===i.substr(0,2)&&gx(t[i])&&"onRefreshInit"!==i?o(0,t[i]):t[i];return gx(n)&&(n=n(),$x(Pb,"refresh",function(){return n=t.batchMax()})),yg(e).forEach(function(e){var t={};for(i in s)t[i]=s[i];t.trigger=e,a.push(Pb.create(t))}),a};var Tb,Mb=function(e,t,i,a){return t>a?e(a):t<0&&e(0),i>a?(a-t)/(i-t):i<0?t/(t-i):1},Lb=function e(t,i){!0===i?t.style.removeProperty("touch-action"):t.style.touchAction=!0===i?"auto":i?"pan-"+i+(ug.isTouch?" pinch-zoom":""):"none",t===gg&&e(xg,i)},Fb={auto:1,scroll:1},Ob=function(e){var t,i=e.event,a=e.target,s=e.axis,r=(i.changedTouches?i.changedTouches[0]:i).target,n=r._gsap||hg.core.getCache(r),o=Xg();if(!n._isScrollT||o-n._isScrollT>2e3){for(;r&&r!==xg&&(r.scrollHeight<=r.clientHeight&&r.scrollWidth<=r.clientWidth||!Fb[(t=Fx(r)).overflowY]&&!Fb[t.overflowX]);)r=r.parentNode;n._isScroll=r&&r!==a&&!dx(r)&&(Fb[(t=Fx(r)).overflowY]||Fb[t.overflowX]),n._isScrollT=o}(n._isScroll||"x"===s)&&(i.stopPropagation(),i._gsapAllow=!0)},Db=function(e,t,i,a){return ug.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:a=a&&Ob,onPress:a,onDrag:a,onScroll:a,onEnable:function(){return i&&$x(fg,ug.eventTypes[0],Bb,!1,!0)},onDisable:function(){return Wx(fg,ug.eventTypes[0],Bb,!0)}})},Rb=/(input|label|select|textarea)/i,Bb=function(e){var t=Rb.test(e.target.tagName);(t||Tb)&&(e._gsapAllow=!0,Tb=t)},Ub=function(e){bx(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var t,i,a,s,r,n,o,l,c=e,d=c.normalizeScrollX,u=c.momentum,h=c.allowNestedScroll,m=c.onRelease,p=sg(e.target)||gg,f=hg.core.globals().ScrollSmoother,g=f&&f.get(),x=Dg&&(e.content&&sg(e.content)||g&&!1!==e.content&&!g.smooth()&&g.content()),b=rg(p,ag),v=rg(p,ig),y=1,w=(ug.isTouch&&pg.visualViewport?pg.visualViewport.scale*pg.visualViewport.width:pg.outerWidth)/pg.innerWidth,N=0,j=gx(u)?function(){return u(t)}:function(){return u||2.8},S=Db(p,e.type,!0,h),_=function(){return s=!1},k=nx,C=nx,A=function(){i=mx(p,ag),C=wg(Dg?1:0,i),d&&(k=wg(0,mx(p,ig))),a=hb},z=function(){x._gsap.y=ox(parseFloat(x._gsap.y)+b.offset)+"px",x.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(x._gsap.y)+", 0, 1)",b.offset=b.cacheID=0},E=function(){A(),r.isActive()&&r.vars.scrollY>i&&(b()>i?r.progress(1)&&b(i):r.resetTo("scrollY",i))};return x&&hg.set(x,{y:"+=0"}),e.ignoreCheck=function(e){return Dg&&"touchmove"===e.type&&function(){if(s){requestAnimationFrame(_);var e=ox(t.deltaY/2),i=C(b.v-e);if(x&&i!==b.v+b.offset){b.offset=i-b.v;var a=ox((parseFloat(x&&x._gsap.y)||0)-b.offset);x.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+a+", 0, 1)",x._gsap.y=a+"px",b.cacheID=Wf.cache,bb()}return!0}b.offset&&z(),s=!0}()||y>1.05&&"touchstart"!==e.type||t.isGesturing||e.touches&&e.touches.length>1},e.onPress=function(){s=!1;var e=y;y=ox((pg.visualViewport&&pg.visualViewport.scale||1)/w),r.pause(),e!==y&&Lb(p,y>1.01||!d&&"x"),n=v(),o=b(),A(),a=hb},e.onRelease=e.onGestureStart=function(e,t){if(b.offset&&z(),t){Wf.cache++;var a,s,n=j();d&&(s=(a=v())+.05*n*-e.velocityX/.227,n*=Mb(v,a,s,mx(p,ig)),r.vars.scrollX=k(s)),s=(a=b())+.05*n*-e.velocityY/.227,n*=Mb(b,a,s,mx(p,ag)),r.vars.scrollY=C(s),r.invalidate().duration(n).play(.01),(Dg&&r.vars.scrollY>=i||a>=i-1)&&hg.to({},{onUpdate:E,duration:n})}else l.restart(!0);m&&m(e)},e.onWheel=function(){r._ts&&r.pause(),Xg()-N>1e3&&(a=0,N=Xg())},e.onChange=function(e,t,i,s,r){if(hb!==a&&A(),t&&d&&v(k(s[2]===t?n+(e.startX-e.x):v()+t-s[1])),i){b.offset&&z();var l=r[2]===i,c=l?o+e.startY-e.y:b()+i-r[1],u=C(c);l&&c!==u&&(o+=u-c),b(u)}(i||t)&&bb()},e.onEnable=function(){Lb(p,!d&&"x"),Pb.addEventListener("refresh",E),$x(pg,"resize",E),b.smooth&&(b.target.style.scrollBehavior="auto",b.smooth=v.smooth=!1),S.enable()},e.onDisable=function(){Lb(p,!0),Wx(pg,"resize",E),Pb.removeEventListener("refresh",E),S.kill()},e.lockAxis=!1!==e.lockAxis,(t=new ug(e)).iOS=Dg,Dg&&!b()&&b(1),Dg&&hg.ticker.add(nx),l=t._dc,r=hg.to(t,{ease:"power4",paused:!0,inherit:!1,scrollX:d?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:zb(b,b(),function(){return r.pause()})},onUpdate:bb,onComplete:l.vars.onComplete}),t};Pb.sort=function(e){if(gx(e))return Jx.sort(e);var t=pg.pageYOffset||0;return Pb.getAll().forEach(function(e){return e._sortY=e.trigger?t+e.trigger.getBoundingClientRect().top:e.start+pg.innerHeight}),Jx.sort(e||function(e,t){return-1e6*(e.vars.refreshPriority||0)+(e.vars.containerAnimation?1e6:e._sortY)-((t.vars.containerAnimation?1e6:t._sortY)+-1e6*(t.vars.refreshPriority||0))})},Pb.observe=function(e){return new ug(e)},Pb.normalizeScroll=function(e){if(void 0===e)return Mg;if(!0===e&&Mg)return Mg.enable();if(!1===e)return Mg&&Mg.kill(),void(Mg=e);var t=e instanceof ug?e:Ub(e);return Mg&&Mg.target===t.target&&Mg.kill(),dx(t.target)&&(Mg=t),t},Pb.core={_getVelocityProp:ng,_inputObserver:Db,_scrollers:Wf,_proxies:Hf,bridge:{ss:function(){Qg||ob("scrollStart"),Qg=Xg()},ref:function(){return Sg}}},cx()&&hg.registerPlugin(Pb),kf.registerPlugin(Pb);const qb=()=>{const[,e]=Ai(),[t,i]=We.useState(!1),[a,s]=We.useState(!1),[r,n]=We.useState(!1),[o,l]=We.useState(!1),[c,d]=We.useState([]),[u,h]=We.useState(!1),{t:m}=fd(),p=We.useRef(null),f=We.useRef(null),g=We.useRef([]),[x,b]=We.useState(!1);We.useEffect(()=>(f.current&&kf.fromTo(f.current.children,{y:100,opacity:0},{y:0,opacity:1,duration:1,stagger:.15,ease:"power2.out"}),g.current.forEach((e,t)=>{e&&kf.fromTo(e,{y:30,opacity:0},{y:0,opacity:1,duration:.6,scrollTrigger:{trigger:e,start:"top 85%",end:"bottom 15%",toggleActions:"play none none reverse",fastScrollEnd:!0}})}),()=>{Pb.getAll().forEach(e=>e.kill())}),[]),We.useEffect(()=>{const e=e=>{e.touches[0].clientY<=44&&window.scrollY>100&&(e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"}))};return"ontouchstart"in window&&document.addEventListener("touchstart",e,{passive:!1}),()=>{"ontouchstart"in window&&document.removeEventListener("touchstart",e)}},[]);const[v,y]=We.useState(0);We.useEffect(()=>{const e=e=>{e.ctrlKey&&e.shiftKey&&"E"===e.key&&(l(!0),e.preventDefault())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);const w=()=>{e("/register")},N=[{icon:se.jsx(Tr,{className:"w-8 h-8 text-[#00E5FF]"}),title:"Registrazione",description:"Crea il tuo account su M1SSION e preparati alla sfida",details:"Accesso gratuito con il piano Base. Scegli tra 5 piani di abbonamento per accedere a indizi premium, eventi esclusivi e vantaggi unici. La registrazione include verifica dell'identit per garantire sicurezza e conformit normativa."},{icon:se.jsx(os,{className:"w-8 h-8 text-[#00E5FF]"}),title:"Ricevi Indizi",description:"Ogni settimana ricevi nuovi indizi via app ed email",details:"Gli indizi arrivano attraverso notifiche push, email crittografate e aggiornamenti in-app. Ogni piano offre un numero diverso di indizi settimanali: dal piano Base (1 indizio) al Titanium (8 indizi totali)."},{icon:se.jsx(Ys,{className:"w-8 h-8 text-[#FFC107]"}),title:"Risolvi la Missione",description:"Analizza gli indizi e trova la posizione del premio",details:"Usa la mappa interattiva, decrittografa i codici, analizza pattern e coordinate GPS. Gli indizi sono interconnessi e richiedono logica, intuito e capacit di analisi per rivelare la posizione finale del tesoro."},{icon:se.jsx(Ga,{className:"w-8 h-8 text-[#FF00FF]"}),title:"Vinci davvero",description:"Se sei il primo a trovare il premio, diventa tuo!",details:"I premi sono reali: auto di lusso, orologi, gioielli e altri oggetti di valore. Solo il primo che raggiunge la posizione esatta e completa la verifica finale ottiene il premio. Nessuna simulazione, solo vittorie concrete."}];return se.jsxs("div",{className:"min-h-screen bg-black overflow-x-hidden relative",children:[se.jsxs("div",{className:"fixed inset-0 pointer-events-none",children:[se.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black via-gray-900 to-black opacity-80"}),se.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_20%_50%,rgba(0,229,255,0.1),transparent_50%)]"}),se.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_80%_20%,rgba(255,0,255,0.1),transparent_50%)]"}),[...Array(30)].map((e,t)=>se.jsx(et.div,{className:"absolute rounded-full opacity-20",style:{width:4*Math.random()+2+"px",height:4*Math.random()+2+"px",background:t%2==0?"#00E5FF":"#FF00FF",left:100*Math.random()+"%",top:100*Math.random()+"%"},animate:{y:[0,-30,0],x:[0,15,-15,0],opacity:[.1,.3,.1]},transition:{duration:20*Math.random()+15,repeat:1/0,ease:"easeInOut",delay:10*Math.random()}},t))]}),se.jsxs("div",{className:"fixed bottom-8 right-8 z-40 flex flex-col gap-4",children:[se.jsx(et.button,{onClick:()=>i(!0),className:"p-4 rounded-full bg-cyan-500/20 backdrop-blur-sm border border-cyan-400/30 text-cyan-400 hover:bg-cyan-500/30 transition-all duration-300",whileHover:{scale:1.1},whileTap:{scale:.95},children:se.jsx(Us,{className:"h-6 w-6"})}),se.jsx(et.button,{onClick:()=>{n(!0)},className:"p-4 rounded-full bg-purple-500/20 backdrop-blur-sm border border-purple-400/30 text-purple-400 hover:bg-purple-500/30 transition-all duration-300",whileHover:{scale:1.1},whileTap:{scale:.95},children:se.jsx(Mr,{className:"h-6 w-6"})})]}),se.jsxs("section",{ref:p,className:"relative min-h-screen w-full flex flex-col items-center justify-center text-center px-4 py-20 overflow-hidden",children:[se.jsxs("div",{className:"z-10 max-w-6xl mx-auto",children:[se.jsxs("h1",{ref:f,className:"text-6xl md:text-7xl lg:text-[8rem] font-black leading-none mb-6",children:[se.jsx("div",{className:"overflow-hidden",children:se.jsx("span",{className:"text-cyan-400 glow-text block drop-shadow-[0_0_30px_rgba(0,229,255,0.8)]",children:"M1"})}),se.jsx("div",{className:"overflow-hidden -mt-8",children:se.jsxs("span",{className:"text-white block",children:["SSION",se.jsx("span",{className:"text-2xl align-top",children:""})]})})]}),se.jsx(et.p,{className:"text-2xl md:text-3xl font-light tracking-[0.3em] mb-12 uppercase",style:{color:"#00FF00"},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:1.5},children:"M1SSION STARTS ON 19 AUGUST"}),se.jsx(et.p,{className:"text-xl md:text-2xl text-gray-400 mb-16 max-w-4xl mx-auto leading-relaxed",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:2},children:m("heroDescription")}),se.jsx(et.div,{className:"text-yellow-300 text-lg md:text-xl tracking-[0.5em] mb-16 relative font-light",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:2.5},children:se.jsx($b,{text:"IT IS POSSIBLE",onComplete:()=>b(!0)})}),se.jsxs(et.div,{className:"flex flex-col sm:flex-row gap-6 justify-center items-center",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,delay:3},children:[se.jsxs(et.button,{className:"px-12 py-6 rounded-full bg-gradient-to-r from-cyan-400 to-purple-600 text-black text-xl font-black uppercase tracking-wider hover:shadow-[0_0_40px_rgba(34,211,238,0.8)] transition-all duration-300 relative group",onClick:w,whileHover:{scale:1.05},whileTap:{scale:.95},children:[se.jsx("span",{className:"relative z-10",children:m("joinTheHunt")}),se.jsx(et.div,{className:"absolute inset-0 bg-gradient-to-r from-purple-600 to-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-full"})]}),se.jsx(et.button,{className:"px-12 py-6 rounded-full text-white font-black uppercase tracking-wider bg-white/5 border-2 border-white/20 hover:bg-white/10 hover:border-cyan-400/50 hover:text-cyan-400 transition-all duration-300",whileHover:{scale:1.05},whileTap:{scale:.95},children:m("learnMore")})]})]}),se.jsx(et.div,{className:"absolute bottom-12 left-1/2 transform -translate-x-1/2",animate:{y:[0,10,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:se.jsx(Ha,{className:"w-8 h-8 text-white/40"})})]}),se.jsxs("section",{ref:e=>e&&(g.current[0]=e),className:"relative py-32 px-4",children:[se.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900/20 via-transparent to-cyan-900/20"}),se.jsxs("div",{className:"max-w-7xl mx-auto relative",children:[se.jsxs(et.div,{className:"text-center mb-16",initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8},viewport:{once:!0},children:[se.jsx("h2",{className:"text-4xl md:text-5xl font-black mb-6 text-white leading-none",children:m("realPrizes")}),se.jsx("p",{className:"text-xl text-gray-400 max-w-2xl mx-auto",children:m("realPrizesDescription")})]}),se.jsxs(et.div,{className:"relative h-[40vh] md:h-[50vh] lg:h-[60vh] rounded-3xl bg-black/40 backdrop-blur-sm border border-white/10 overflow-hidden",whileHover:{scale:1.02},transition:{duration:.5},children:[se.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-cyan-500/20 via-transparent to-purple-500/20 opacity-60"}),se.jsx("img",{src:"/lovable-uploads/eccb4710-0336-46f8-9137-906f61fbdebd.png",alt:"M1SSION PREMI IN PALIO - Ferrari, Lamborghini, Rolex",className:"w-full h-full object-cover object-center",style:{objectFit:"cover",objectPosition:"center",aspectRatio:"16/9"},onLoad:()=>{h(!0)},onError:e=>{h(!1),e.currentTarget.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='450' viewBox='0 0 800 450'%3E%3Crect width='800' height='450' fill='%23000'/%3E%3Ctext x='400' y='225' font-family='Arial, sans-serif' font-size='24' fill='%2300E5FF' text-anchor='middle' dy='.3em'%3EM1SSION PREMI IN PALIO%3C/text%3E%3C/svg%3E"}}),se.jsx(et.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400/30 to-transparent",animate:{x:["-100%","100%"]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}}),se.jsx("div",{className:"absolute bottom-4 right-4 text-white/60 text-xs font-normal bg-black/20 backdrop-blur-sm px-2 py-1 rounded border border-white/10",children:"Image for illustration purposes only"})]})]})]}),se.jsx(et.section,{className:"relative py-16 px-4 bg-black",initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},transition:{duration:.6,ease:[.25,.46,.45,.94]},viewport:{once:!0},children:se.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[se.jsxs(et.h3,{className:"text-2xl md:text-3xl font-bold mb-6 text-white",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:.6,delay:.2},children:[se.jsx("span",{className:"text-[#00E5FF]",children:"M1"}),se.jsx("span",{className:"text-white",children:"SSION"})," in arrivo"]}),se.jsxs(et.div,{className:"relative w-full h-3 bg-black/60 rounded-full overflow-hidden border border-white/20 mb-4",initial:{scale:.8,opacity:0},whileInView:{scale:1,opacity:1},transition:{duration:.6,delay:.4},children:[se.jsx(et.div,{className:"h-full rounded-full relative overflow-hidden",style:{background:"linear-gradient(90deg, #00E5FF, #FF00FF, #00E5FF)"},animate:{background:["linear-gradient(90deg, #00E5FF, #FF00FF, #00E5FF)","linear-gradient(90deg, #FF00FF, #00E5FF, #FF00FF)","linear-gradient(90deg, #00E5FF, #FF00FF, #00E5FF)"],width:["0%","78%"]},transition:{background:{duration:3,repeat:1/0,ease:"easeInOut"},width:{duration:2,ease:"easeOut"}}}),se.jsx(et.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent",animate:{x:["-100%","100%"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]}),se.jsx(et.p,{className:"text-white/70 text-sm",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:.6,delay:.6},children:"78% completato - La caccia inizia presto"})]})}),se.jsx(et.section,{className:"relative py-20 px-4 bg-black",initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},transition:{duration:.6,ease:[.25,.46,.45,.94]},viewport:{once:!0},children:se.jsx("div",{className:"max-w-4xl mx-auto",children:se.jsxs(et.div,{className:"glass-card p-8 md:p-12 text-center relative overflow-hidden",whileHover:{scale:1.01},transition:{duration:.3},children:[se.jsxs("h2",{className:"text-3xl md:text-4xl font-orbitron mb-8",children:["WELCOME TO"," ",se.jsxs("span",{children:[se.jsx("span",{className:"text-[#00E5FF]",children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]})]})]}),se.jsx("p",{className:"text-lg mb-6 max-w-3xl mx-auto text-gray-200",children:"In the near future... The world becomes a gameboard. The clues are encrypted. The stakes are real."}),se.jsx("p",{className:"text-lg mb-6 max-w-3xl mx-auto text-gray-200",children:"Thousands will try. Only a few will see the pattern. You're not just chasing a prizeyou're chasing the proof that you can outthink them all."}),se.jsxs("p",{className:"text-lg mb-6 max-w-3xl mx-auto text-gray-200",children:["This is ",se.jsx("span",{className:"text-[#00E5FF]",children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]}),". The countdown has begun. Are you ready?"]}),se.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-400/40 to-transparent"})]})})}),se.jsxs(et.section,{className:"relative py-20 px-4",initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},transition:{duration:.6,ease:[.25,.46,.45,.94]},viewport:{once:!0},children:[se.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900/40 via-cyan-900/40 to-pink-900/40"}),se.jsx("div",{className:"max-w-lg mx-auto relative z-10",children:se.jsxs(et.div,{className:"relative m1ssion-glass-card overflow-hidden bg-black/60 backdrop-blur-xl shadow-lg p-10 text-center",whileHover:{scale:1.02},transition:{duration:.3},children:[se.jsxs("h2",{className:"text-2xl md:text-3xl font-bold mb-2",children:["Registrati per"," ",se.jsxs("span",{children:[se.jsx("span",{className:"text-[#00E5FF]",children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]})]})]}),se.jsx("p",{className:"text-white/70 mb-6",children:"Ottieni accesso esclusivo e un codice referral unico. Preparati per l'avventura che cambier tutto."}),se.jsx("div",{className:"space-y-4",children:se.jsxs(et.div,{whileHover:{scale:1.05},whileTap:{scale:.98},className:"relative overflow-hidden rounded-xl",children:[se.jsx(et.div,{className:"absolute inset-0",style:{background:"linear-gradient(45deg, #ec4899, #d946ef, #ec4899, #d946ef)"},animate:{background:["linear-gradient(45deg, #ec4899, #d946ef, #ec4899, #d946ef)","linear-gradient(135deg, #d946ef, #ec4899, #d946ef, #ec4899)","linear-gradient(45deg, #ec4899, #d946ef, #ec4899, #d946ef)"]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),se.jsx(mo,{onClick:w,className:"relative w-full bg-transparent text-white text-xl font-bold py-4 px-12 hover:bg-transparent transition-all duration-300 shadow-lg hover:shadow-cyan-500/30",style:{boxShadow:"0 0 20px rgba(236, 72, 153, 0.3)"},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 0 30px rgba(0, 229, 255, 0.5), 0 0 60px rgba(236, 72, 153, 0.3)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="0 0 20px rgba(236, 72, 153, 0.3)"},children:"START M1SSION"})]})})]})})]}),se.jsx(et.section,{className:"py-20 px-4 bg-black",initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},transition:{duration:.6,ease:[.25,.46,.45,.94]},viewport:{once:!0},children:se.jsxs("div",{className:"max-w-6xl mx-auto",children:[se.jsxs("h2",{className:"text-3xl md:text-4xl font-bold mb-12 text-center",children:["Scopri ",se.jsx("span",{className:"text-[#00E5FF]",children:"M1"}),se.jsx("span",{className:"text-white",children:"SSION"})]}),se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12 relative",children:[se.jsx("div",{className:"hidden lg:block absolute top-16 left-[12.5%] right-[12.5%] h-0.5 bg-gradient-to-r from-[#00E5FF] via-[#FFC107] to-[#FF00FF] z-0"}),N.map((e,t)=>{const i=c.includes(t);return se.jsxs(et.div,{className:"relative z-10 perspective-1000",initial:{y:30,opacity:0},whileInView:{y:0,opacity:1},transition:{duration:.5,delay:.1*t},viewport:{once:!0},children:[se.jsx("span",{className:"absolute -top-4 -left-4 w-10 h-10 rounded-full bg-black border border-white/10 flex items-center justify-center font-bold text-white z-30",children:t+1}),se.jsxs("div",{className:"mission-flip-card h-64 cursor-pointer "+(i?"is-flipped":""),onClick:()=>(e=>{d(t=>t.includes(e)?[]:[e])})(t),children:[se.jsxs("div",{className:"mission-card-front glass-card",children:[se.jsx("div",{className:"mb-4 p-3 rounded-full bg-black/50 border border-white/10",children:e.icon}),se.jsx("h3",{className:"text-xl font-bold mb-2 text-white",children:e.title}),se.jsx("p",{className:"text-white/70 mb-4 leading-relaxed",children:e.description}),se.jsx("p",{className:"text-cyan-400 text-sm font-medium",children:"Clicca per saperne di pi"})]}),se.jsxs("div",{className:"mission-card-back glass-card bg-gradient-to-br from-cyan-900/40 to-purple-900/40 border border-cyan-400/30",children:[se.jsx("div",{className:"mb-3 p-2 rounded-full bg-cyan-400/20",children:e.icon}),se.jsx("h3",{className:"text-lg font-bold mb-3 text-cyan-300",children:e.title}),se.jsx("p",{className:"text-white/90 text-sm leading-relaxed mb-4",children:e.details}),se.jsx("p",{className:"text-cyan-300 text-xs font-medium",children:"Clicca per tornare indietro"})]})]})]},t)})]}),se.jsx("div",{className:"text-center",children:se.jsx(mo,{onClick:w,className:"bg-gradient-to-r from-[#00E5FF] to-[#00BFFF] text-black font-bold px-8 py-6 rounded-full text-lg hover:shadow-[0_0_15px_rgba(0,229,255,0.5)]",size:"lg",children:"Inizia La Tua M1SSION"})})]})}),se.jsx("section",{className:"py-12 px-4 bg-black",children:se.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[se.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white mb-4",children:"Stay Updated"}),se.jsx("p",{className:"text-white/70 mb-8",children:"Get the latest updates about M1SSION and be the first to know about new challenges."})]})}),se.jsxs("section",{className:"py-16 px-4 bg-black relative",children:[se.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black via-gray-900 to-black opacity-80"}),se.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto",children:[se.jsxs(et.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.6},viewport:{once:!0},className:"text-center mb-12",children:[se.jsxs("h2",{className:"text-3xl md:text-4xl font-bold inline-block",children:[se.jsx("span",{className:"text-[#00E5FF]",children:"M1"}),se.jsx("span",{className:"text-white",children:"SSION"})," Abbonamenti"]}),se.jsx("p",{className:"mt-4 text-white/70 max-w-2xl mx-auto",children:"Scegli il piano pi adatto a te e inizia la tua avventura. Tutti i piani offrono la possibilit di vincere premi reali."})]}),se.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-12",children:[{title:"Base  Gratis",price:"0",period:"/mese",highlight:!1,features:["Funzioni base (accesso alla missione con restrizioni)","Supporto email standard","1 indizio settimanale base"],notIncluded:["Nessun accesso anticipato agli eventi","Nessun badge esclusivo"],buttonText:"Inizia Gratis",buttonColor:"bg-gradient-to-r from-[#00E5FF] to-[#008eb3] text-black hover:shadow-[0_0_15px_rgba(0,229,255,0.5)]"},{title:"Silver",price:"3.99",period:"/mese",features:["Tutti i vantaggi Base","3 indizi premium aggiuntivi a settimana","Accesso anticipato di 2 ore agli eventi","Badge Silver nel profilo"],buttonText:"Scegli Silver",buttonColor:"bg-gradient-to-r from-[#C0C0C0] to-[#919191] text-black hover:shadow-[0_0_15px_rgba(192,192,192,0.5)]"},{title:"Gold",price:"6.99",period:"/mese",highlight:!0,features:["Tutti i vantaggi Silver","4 indizi premium aggiuntivi a settimana","Accesso anticipato di 12 ore agli eventi","Partecipazione alle estrazioni Gold","Badge Gold esclusivo nel profilo"],buttonText:"Scegli Gold",buttonColor:"bg-gradient-to-r from-[#FFD700] to-[#FFA500] text-black hover:shadow-[0_0_15px_rgba(255,215,0,0.5)]"},{title:"Black",price:"9.99",period:"/mese",features:["Tutti i vantaggi Gold","Accesso VIP anticipato di 24 ore agli eventi","5 indizi premium aggiuntivi a settimana","Badge Black esclusivo"],buttonText:"Scegli Black",buttonColor:"bg-gradient-to-r from-[#1A1A1A] to-[#333333] text-white hover:shadow-[0_0_15px_rgba(0,0,0,0.7)]"},{title:"Titanium",price:"29.99",period:"/mese",features:["Tutti i vantaggi Black","7 indizi premium aggiuntivi a settimana","Accesso VIP anticipato di 48 ore agli eventi","Supporto prioritario dedicato (24/7)","Eventi esclusivi M1SSION","Badge Titanium esclusivo"],buttonText:"Scegli Titanium",buttonColor:"bg-gradient-to-r from-[#E6E6FA] to-[#FFD700] text-black hover:shadow-[0_0_15px_rgba(230,230,250,0.8)]"}].map((e,t)=>se.jsxs(et.div,{className:"rounded-xl relative p-4 "+(e.highlight?"bg-gradient-to-b from-[#00E5FF]/20 to-black/70 border border-[#00E5FF]/30":"bg-white/5 border border-white/10"),initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{delay:.1*t,duration:.5},viewport:{once:!0},whileHover:{y:-5,transition:{duration:.2}},children:[e.highlight&&se.jsxs("div",{className:"absolute -top-3 -right-3 bg-[#00E5FF] text-black text-xs font-bold py-1 px-2 rounded-full flex items-center",children:[se.jsx(wr,{className:"w-3 h-3 mr-1"}),"Top"]}),se.jsxs("div",{className:"mb-4",children:[se.jsx("h3",{className:"text-lg font-bold text-white",children:e.title}),se.jsxs("div",{className:"mt-2",children:[se.jsx("span",{className:"text-xl font-bold text-white",children:e.price}),e.period&&se.jsx("span",{className:"text-white/50 text-xs",children:e.period})]})]}),se.jsxs("div",{className:"space-y-2 mb-4",children:[e.features.slice(0,3).map((e,t)=>se.jsxs("div",{className:"flex items-start",children:[se.jsx(os,{className:"w-4 h-4 text-green-400 mr-2 mt-0.5 flex-shrink-0"}),se.jsx("span",{className:"text-white/80 text-sm",children:e})]},t)),e.features.length>3&&se.jsxs("p",{className:"text-white/60 text-xs",children:["+",e.features.length-3," altri vantaggi"]})]}),se.jsx(mo,{onClick:w,className:`w-full text-sm py-2 ${e.buttonColor}`,disabled:!1,children:e.buttonText})]},t))}),se.jsx("div",{className:"text-center",children:se.jsx("p",{className:"text-white/60 text-sm",children:"Tutti i piani sono soggetti ai termini e condizioni di servizio."})})]})]}),se.jsx("section",{className:"py-20 px-4 bg-black relative",children:se.jsx("div",{className:"max-w-lg mx-auto",children:se.jsxs(et.div,{className:"glass-card p-8 text-center",initial:{opacity:0,scale:.95},whileInView:{opacity:1,scale:1},transition:{duration:.5},viewport:{once:!0},children:[se.jsxs("div",{className:"mb-6",children:[se.jsx(Ds,{className:"w-16 h-16 text-purple-400 mx-auto mb-4"}),se.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Verifica la tua identit"}),se.jsx("p",{className:"text-white/70",children:"Per garantire un'esperienza di gioco sicura e conforme alle normative,  necessario completare la verifica dell'identit prima di ricevere premi."})]}),se.jsx(mo,{onClick:w,className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold px-8 py-3 rounded-full hover:shadow-[0_0_15px_rgba(128,0,128,0.5)]",children:"Vai alla verifica identit"})]})})}),se.jsx("section",{className:"py-20 px-4 bg-black",children:se.jsx("div",{className:"max-w-4xl mx-auto",children:se.jsxs(et.div,{className:"glass-card p-8 md:p-12 text-center relative overflow-hidden",initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.6},viewport:{once:!0},children:[se.jsxs("h2",{className:"text-3xl md:text-4xl font-bold mb-8 text-white",children:["Installa ",se.jsx("span",{className:"text-[#00E5FF]",children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]})]}),se.jsx("p",{className:"text-lg mb-8 text-gray-200",children:"Per installare M1SSION sul tuo dispositivo mobile:"}),se.jsxs("div",{className:"space-y-4 mb-8",children:[se.jsxs("div",{className:"flex items-center justify-center text-gray-300",children:[se.jsx("span",{className:"mr-2",children:""}),se.jsxs("span",{children:[se.jsx("strong",{children:"iOS (Safari):"}),' premi il tasto "Condividi" e seleziona "Aggiungi alla Home"']})]}),se.jsxs("div",{className:"flex items-center justify-center text-gray-300",children:[se.jsx("span",{className:"mr-2",children:""}),se.jsxs("span",{children:[se.jsx("strong",{children:"Android (Chrome):"}),' apri il menu  e premi "Installa App"']})]})]}),se.jsx(mo,{onClick:w,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold px-8 py-3 rounded-full",children:"Aggiungi M1SSION alla tua Home"}),se.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-400/40 to-transparent"})]})})}),se.jsx(hd,{}),se.jsx(gd,{}),o&&se.jsx(Al,{onClose:()=>l(!1)}),t&&se.jsx(ud,{isOpen:t,onClose:()=>i(!1)}),a&&se.jsx("div",{className:"fixed inset-0 bg-black/75 flex items-center justify-center z-[9999] p-4",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 20px)",paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 20px)"},children:se.jsxs(et.div,{className:"bg-black/90 border border-purple-500/30 rounded-xl p-6 max-w-md w-full relative",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},children:[se.jsx("button",{onClick:()=>s(!1),className:"absolute top-4 right-4 text-white/60 hover:text-white",children:se.jsx($r,{className:"w-6 h-6"})}),se.jsxs("div",{className:"text-center",children:[se.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Verifica dell'et"}),se.jsx("p",{className:"text-white/70 mb-6",children:"Confermi di avere almeno 18 anni? Questo gioco  riservato ai maggiorenni."}),se.jsxs("div",{className:"flex gap-4",children:[se.jsx(mo,{onClick:()=>{s(!1),w()},className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:"S, ho 18+ anni"}),se.jsx(mo,{onClick:()=>s(!1),variant:"outline",className:"flex-1",children:"No"})]})]})]})}),r&&se.jsx("div",{className:"fixed inset-0 bg-black/75 flex items-center justify-center z-50 p-4",children:se.jsxs(et.div,{className:"bg-black/90 border border-purple-500/30 rounded-xl p-6 max-w-md w-full relative",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},children:[se.jsx("button",{onClick:()=>n(!1),className:"absolute top-4 right-4 text-white/60 hover:text-white",children:se.jsx($r,{className:"w-6 h-6"})}),se.jsxs("div",{className:"text-center",children:[se.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Invita un amico"}),se.jsx("p",{className:"text-white/70 mb-6",children:"Condividi M1SSION con i tuoi amici e guadagna vantaggi esclusivi!"}),se.jsx(mo,{onClick:()=>{n(!1),w()},className:"bg-purple-600 hover:bg-purple-700 text-white",children:"Ottieni il tuo codice referral"})]})]})})]})},$b=({text:e,onComplete:t})=>{const[i,a]=We.useState(""),[s,r]=We.useState(0);return We.useEffect(()=>{if(s<e.length){const t=setTimeout(()=>{a(t=>t+e[s]),r(e=>e+1)},120);return()=>clearTimeout(t)}t&&t()},[s,e,t]),se.jsxs("span",{className:"inline-block",children:[i,s<e.length&&se.jsx(et.span,{className:"inline-block w-0.5 h-6 bg-yellow-300 ml-1",animate:{opacity:[1,0]},transition:{duration:.5,repeat:1/0,ease:"easeInOut"}})]})},Wb=We.forwardRef(({className:e,...t},i)=>se.jsx("textarea",{className:eo("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...t}));Wb.displayName="Textarea";const Hb=()=>{const[e,t]=We.useState([]),[i,a]=We.useState({lat:"",lng:"",label:"",notes:""});return se.jsxs("div",{className:"h-full overflow-y-auto pb-20 space-y-8",style:{height:"calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 80px)",paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 80px)"},children:[se.jsx("div",{className:"text-center mb-8",children:se.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[se.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20",children:se.jsx(kr,{className:"w-6 h-6 text-white"})}),se.jsx("h3",{className:"text-2xl font-bold text-foreground",children:"Coordinate Selector"})]})}),se.jsxs(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10",children:[se.jsx(Hl,{className:"border-b-0",children:se.jsx(Zl,{className:"text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent",children:"Aggiungi Nuova Coordinata"})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"lat",children:"Latitudine"}),se.jsx(Sl,{id:"lat",type:"number",step:"any",placeholder:"46.0 [COORD-LAT]",value:i.lat,onChange:e=>a({...i,lat:e.target.value}),className:"bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"lng",children:"Longitudine"}),se.jsx(Sl,{id:"lng",type:"number",step:"any",placeholder:"8.0 [COORD-LNG]",value:i.lng,onChange:e=>a({...i,lng:e.target.value}),className:"bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"})]})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"label",children:"Label"}),se.jsx(Sl,{id:"label",placeholder:"TARGET-ID [Punto di interesse]",value:i.label,onChange:e=>a({...i,label:e.target.value}),className:"bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"notes",children:"Note (opzionale)"}),se.jsx(Wb,{id:"notes",placeholder:"NOTES [Descrizione dettagliata...]",value:i.notes,onChange:e=>a({...i,notes:e.target.value}),className:"bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300",rows:3})]}),se.jsxs(mo,{onClick:()=>{if(!i.lat||!i.lng||!i.label)return void Ki.error("Lat, Lng e Label sono obbligatori");const s={id:crypto.randomUUID(),lat:parseFloat(i.lat),lng:parseFloat(i.lng),label:i.label,notes:i.notes,createdAt:new Date};t([...e,s]),a({lat:"",lng:"",label:"",notes:""}),Ki.success("Coordinata salvata")},className:"w-full bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 rounded-xl py-4 shadow-2xl shadow-cyan-500/30 hover:shadow-cyan-500/50 transition-all duration-300 text-lg",children:[se.jsx(mr,{className:"w-4 h-4 mr-2"}),"Salva Coordinata"]})]})]}),se.jsxs("div",{className:"space-y-4",children:[se.jsx("h4",{className:"text-lg font-semibold text-foreground",children:"Coordinate Salvate"}),0===e.length?se.jsx(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/40 backdrop-blur-md",children:se.jsxs(Gl,{className:"py-12 text-center text-muted-foreground",children:[se.jsx(Ys,{className:"w-16 h-16 mx-auto mb-6 opacity-50"}),se.jsx("p",{className:"text-lg",children:"Nessuna coordinata salvata"})]})}):e.map(e=>se.jsx(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-xl hover:shadow-2xl transition-all duration-300",children:se.jsx(Gl,{className:"py-4",children:se.jsxs("div",{className:"flex justify-between items-start",children:[se.jsxs("div",{className:"flex-1",children:[se.jsx("h5",{className:"font-semibold text-foreground",children:e.label}),se.jsxs("p",{className:"text-sm text-muted-foreground font-mono",children:[e.lat,", ",e.lng]}),e.notes&&se.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:e.notes}),se.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:e.createdAt.toLocaleDateString()})]}),se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>(e=>{const t=`${e.lat}, ${e.lng}`;navigator.clipboard.writeText(t),Ki.success("Coordinate copiate negli appunti")})(e),children:se.jsx(ys,{className:"w-4 h-4"})})]})})},e.id))]})]})},Zb=()=>{const[e,t]=We.useState([]),[i,a]=We.useState(""),[s,r]=We.useState(!1),[n,o]=We.useState({title:"",content:"",week:1,tags:"",importance:"medium"}),l=e.filter(e=>e.title.toLowerCase().includes(i.toLowerCase())||e.content.toLowerCase().includes(i.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(i.toLowerCase()))),c=e=>{switch(e){case"high":return"bg-red-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}};return se.jsxs("div",{className:"h-full overflow-y-auto pb-20 space-y-8",style:{height:"calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 80px)",paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 80px)"},children:[se.jsxs("div",{className:"text-center mb-8",children:[se.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[se.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20",children:se.jsx(Ja,{className:"w-6 h-6 text-white"})}),se.jsx("h3",{className:"text-2xl font-bold text-foreground",children:"Clue Journal"})]}),se.jsxs(mo,{onClick:()=>r(!s),className:"bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 rounded-xl py-3 px-6 shadow-2xl shadow-cyan-500/30 hover:shadow-cyan-500/50 transition-all duration-300",children:[se.jsx(nr,{className:"w-4 h-4 mr-2"}),"Nuova Voce"]})]}),se.jsxs("div",{className:"relative",children:[se.jsx(pr,{className:"absolute left-3 top-3 w-4 h-4 text-muted-foreground"}),se.jsx(Sl,{placeholder:"SEARCH [Cerca nel diario...]",value:i,onChange:e=>a(e.target.value),className:"pl-10 bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"})]}),s&&se.jsxs(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10",children:[se.jsx(Hl,{className:"border-b-0",children:se.jsx(Zl,{className:"text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent",children:"Nuova Voce del Diario"})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"title",children:"Titolo"}),se.jsx(Sl,{id:"title",placeholder:"Titolo dell'indizio...",value:n.title,onChange:e=>o({...n,title:e.target.value}),className:"bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"})]}),se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"week",children:"Settimana"}),se.jsx(Sl,{id:"week",type:"number",min:"1",max:"4",value:n.week,onChange:e=>o({...n,week:parseInt(e.target.value)}),className:"bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"importance",children:"Importanza"}),se.jsxs("select",{id:"importance",value:n.importance,onChange:e=>o({...n,importance:e.target.value}),className:"w-full h-10 px-3 rounded-lg bg-muted/50 border border-border text-foreground backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",children:[se.jsx("option",{value:"low",children:"Bassa"}),se.jsx("option",{value:"medium",children:"Media"}),se.jsx("option",{value:"high",children:"Alta"})]})]})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"tags",children:"Tags (separati da virgole)"}),se.jsx(Sl,{id:"tags",placeholder:"geografia, simbolo, numero...",value:n.tags,onChange:e=>o({...n,tags:e.target.value}),className:"bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"content",children:"Contenuto"}),se.jsx(Wb,{id:"content",placeholder:"Descrizione dettagliata dell'indizio...",value:n.content,onChange:e=>o({...n,content:e.target.value}),className:"bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",rows:4})]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsx(mo,{onClick:()=>{if(!n.title||!n.content)return void Ki.error("Titolo e contenuto sono obbligatori");const i={id:crypto.randomUUID(),title:n.title,content:n.content,week:n.week,tags:n.tags.split(",").map(e=>e.trim()).filter(e=>e),createdAt:new Date,importance:n.importance};t([i,...e]),o({title:"",content:"",week:1,tags:"",importance:"medium"}),r(!1),Ki.success("Voce del diario salvata")},className:"flex-1 bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 rounded-lg shadow-md hover:shadow-lg transition-all",children:"Salva Voce"}),se.jsx(mo,{variant:"outline",onClick:()=>r(!1),className:"rounded-lg",children:"Annulla"})]})]})]}),se.jsx("div",{className:"space-y-4",children:0===l.length?se.jsx(Wl,{className:"border-border rounded-xl bg-card/30 backdrop-blur-sm",children:se.jsxs(Gl,{className:"py-8 text-center text-muted-foreground",children:[se.jsx(Ja,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),i?"Nessun risultato trovato":"Nessuna voce nel diario"]})}):l.map(e=>se.jsx(Wl,{className:"border-border rounded-xl bg-card/40 backdrop-blur-sm shadow-sm hover:shadow-md transition-all",children:se.jsxs(Gl,{className:"py-4",children:[se.jsxs("div",{className:"flex items-start justify-between mb-3",children:[se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:`w-3 h-3 rounded-full ${c(e.importance)}`}),se.jsx("h5",{className:"font-semibold text-foreground",children:e.title})]}),se.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[se.jsx(as,{className:"w-4 h-4"}),se.jsxs("span",{children:["Settimana ",e.week]})]})]}),se.jsx("p",{className:"text-sm text-muted-foreground mb-3 whitespace-pre-wrap",children:e.content}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("div",{className:"flex flex-wrap gap-1",children:e.tags.map((e,t)=>se.jsxs(fc,{variant:"secondary",className:"text-xs",children:[se.jsx(_r,{className:"w-3 h-3 mr-1"}),e]},t))}),se.jsx("span",{className:"text-xs text-muted-foreground",children:e.createdAt.toLocaleDateString()})]})]})},e.id))})]})},Vb=()=>{const[e,t]=We.useState([]),[i,a]=We.useState([]),[s,r]=We.useState(""),[n,o]=We.useState(null),[l,c]=We.useState("all"),[d,u]=We.useState(!0),{toast:h}=mc();We.useEffect(()=>{m()},[]),We.useEffect(()=>{p()},[e,s,n,l]);const m=async()=>{try{const{data:e,error:i}=await ba.from("clues").select("*").order("created_at",{ascending:!1});if(i)throw i;const a=(e||[]).map(e=>({id:e.id,title:e.title,description:e.description,week:1,isLocked:e.is_locked,subscriptionType:e.premium_type||"Base",foundAt:e.created_at?new Date(e.created_at):void 0,importance:"medium"}));t(a)}catch(e){console.error("Error loading clues:",e),h({title:"Errore",description:"Impossibile caricare l'archivio indizi",variant:"destructive"})}finally{u(!1)}},p=()=>{let t=e;s&&(t=t.filter(e=>e.title.toLowerCase().includes(s.toLowerCase())||e.description.toLowerCase().includes(s.toLowerCase()))),null!==n&&(t=t.filter(e=>e.week===n)),"all"!==l&&(t=t.filter(e=>e.subscriptionType.toLowerCase()===l)),a(t)},f=e=>{switch(e){case"high":return se.jsx(fc,{variant:"destructive",className:"text-xs",children:"Critico"});case"medium":return se.jsx(fc,{variant:"default",className:"text-xs bg-yellow-500 text-white",children:"Medio"});case"low":return se.jsx(fc,{variant:"secondary",className:"text-xs",children:"Basso"});default:return se.jsx(fc,{variant:"outline",className:"text-xs",children:"Standard"})}};return d?se.jsx("div",{className:"flex items-center justify-center p-8",children:se.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"})}):se.jsxs("div",{className:"space-y-6",children:[se.jsxs("div",{className:"text-center mb-8",children:[se.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[se.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20",children:se.jsx(Wa,{className:"w-6 h-6 text-white"})}),se.jsx("h3",{className:"text-2xl font-bold text-foreground",children:"Archivio Indizi"})]}),se.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[se.jsx(Is,{className:"w-4 h-4"}),se.jsx("span",{children:"Database completo degli indizi raccolti"})]})]}),se.jsx(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10",children:se.jsx(Gl,{className:"p-6",children:se.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center",children:[se.jsxs("div",{className:"flex-1 relative",children:[se.jsx(pr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),se.jsx(Sl,{placeholder:"Cerca indizi... [ARCH-SEARCH]",value:s,onChange:e=>r(e.target.value),className:"pl-10 bg-muted/60 border-2 border-border/50 rounded-xl py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300"})]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsx(mo,{variant:null===n?"default":"outline",size:"sm",onClick:()=>o(null),className:"rounded-xl",children:"Tutte"}),[1,2,3,4].map(e=>se.jsxs(mo,{variant:n===e?"default":"outline",size:"sm",onClick:()=>o(e),className:"rounded-xl",children:["W",e]},e))]}),se.jsx("div",{className:"flex gap-2",children:["all","base","silver","gold","black"].map(e=>se.jsx(mo,{variant:l===e?"default":"outline",size:"sm",onClick:()=>c(e),className:"rounded-xl capitalize",children:e},e))})]})})}),se.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map(e=>{return se.jsxs(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-lg hover:shadow-2xl hover:shadow-cyan-500/20 transition-all duration-300 group cursor-pointer",children:[se.jsxs(Hl,{className:"pb-3",children:[se.jsxs("div",{className:"flex items-start justify-between gap-2",children:[se.jsx(Zl,{className:"text-lg group-hover:text-cyan-400 transition-colors",children:e.title}),se.jsxs("div",{className:"flex items-center gap-2",children:[e.isLocked&&se.jsx(Zs,{className:"w-4 h-4 text-red-400"}),se.jsxs(fc,{variant:"outline",className:"text-xs",children:["W",e.week]})]})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[(t=e.subscriptionType,se.jsx(fc,{className:`text-xs text-white ${{Base:"bg-gray-500",Silver:"bg-gray-400",Gold:"bg-yellow-500",Black:"bg-black",Premium:"bg-purple-500"}[t]||"bg-gray-500"}`,children:t})),f(e.importance||"medium")]})]}),se.jsxs(Gl,{className:"pt-0",children:[se.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-3",children:e.description}),e.foundAt&&se.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[se.jsx(as,{className:"w-3 h-3"}),se.jsxs("span",{children:["Trovato: ",e.foundAt.toLocaleDateString("it-IT")]})]})]})]},e.id);var t})}),0===i.length&&se.jsx(Wl,{className:"border-2 border-dashed border-border/50 rounded-2xl bg-card/30 backdrop-blur-md",children:se.jsxs(Gl,{className:"p-12 text-center",children:[se.jsx(Wa,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4 opacity-50"}),se.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"Nessun indizio trovato"}),se.jsx("p",{className:"text-sm text-muted-foreground",children:"Modifica i filtri di ricerca per visualizzare altri indizi."})]})}),se.jsx(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-lg",children:se.jsx(Gl,{className:"p-6",children:se.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[se.jsxs("div",{children:[se.jsx("div",{className:"text-2xl font-bold text-cyan-400",children:e.length}),se.jsx("div",{className:"text-sm text-muted-foreground",children:"Totale Indizi"})]}),se.jsxs("div",{children:[se.jsx("div",{className:"text-2xl font-bold text-green-400",children:e.filter(e=>!e.isLocked).length}),se.jsx("div",{className:"text-sm text-muted-foreground",children:"Sbloccati"})]}),se.jsxs("div",{children:[se.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:e.filter(e=>"high"===e.importance).length}),se.jsx("div",{className:"text-sm text-muted-foreground",children:"Critici"})]})]})})})]})};delete st.Icon.Default.prototype._getIconUrl,st.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const Gb=()=>{const[e,t]=We.useState(!1),[i,a]=We.useState(0),[s,r]=We.useState([]),[n,o]=We.useState({centerLat:"",centerLng:"",radius:"1000",label:""}),[l,c]=We.useState([]);We.useEffect(()=>{d()},[]);const d=async()=>{try{const{data:e,error:t}=await ba.from("geo_radar_coordinates").select("*").order("created_at",{ascending:!1});if(t)throw t;e&&c(e)}catch(e){console.error("Errore nel caricamento coordinate:",e)}},u=()=>{const e=parseFloat(n.centerLat),t=parseFloat(n.centerLng),i=parseInt(n.radius),o=((e,t)=>{const i=(46-e)*Math.PI/180,a=(8-t)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e*Math.PI/180)*Math.cos(46*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3<=3e3})(e,t),l=[],c=o?Math.floor(3*Math.random())+2:Math.floor(2*Math.random())+1;for(let a=0;a<c;a++){const s=360*Math.random()*(Math.PI/180),r=Math.random()*i,n=e+r/111e3*Math.cos(s),c=t+r/(111e3*Math.cos(e*Math.PI/180))*Math.sin(s),d=o?60+40*Math.random():60*Math.random(),u=o?70+30*Math.random():70*Math.random();l.push({lat:n,lng:c,signal:d,confidence:u,description:o?` SIGNAL FORTE - Settore ${String.fromCharCode(65+a)}`:`Anomalia rilevata - Settore ${String.fromCharCode(65+a)}`})}o?Ki.success(" RADAR: Segnali anomali rilevati! Possibile obiettivo nelle vicinanze!"):Ki.success(" RADAR: Scansione completata - Area sicura");const d={id:crypto.randomUUID(),centerLat:e,centerLng:t,radius:i,scanResults:l,timestamp:new Date};r([d,...s]),a(0),Ki.success(`Scansione completata - ${l.length} anomalie rilevate`)};return se.jsxs("div",{className:"space-y-8",children:[se.jsxs("div",{className:"text-center mb-8",children:[se.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[se.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20",children:se.jsx(cr,{className:"w-6 h-6 text-white"})}),se.jsx("h3",{className:"text-2xl font-bold text-foreground",children:"Geo Radar Tool"})]}),se.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[se.jsx(Er,{className:"w-4 h-4"}),se.jsx("span",{children:"Disponibile dalla Settimana 3"})]})]}),se.jsxs(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10",children:[se.jsx(Hl,{className:"border-b-0",children:se.jsx(Zl,{className:"text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent",children:"Parametri Scansione"})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"centerLat",children:"Latitudine Centro"}),se.jsx(Sl,{id:"centerLat",type:"number",step:"any",placeholder:"46.0 [COORD-LAT]",value:n.centerLat,onChange:e=>o({...n,centerLat:e.target.value}),className:"bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",disabled:e})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"centerLng",children:"Longitudine Centro"}),se.jsx(Sl,{id:"centerLng",type:"number",step:"any",placeholder:"8.0 [COORD-LNG]",value:n.centerLng,onChange:e=>o({...n,centerLng:e.target.value}),className:"bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",disabled:e})]})]}),se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"radius",children:"Raggio (metri)"}),se.jsx(Sl,{id:"radius",type:"number",min:"100",max:"5000",value:n.radius,onChange:e=>o({...n,radius:e.target.value}),className:"bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",disabled:e})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"label",children:"Etichetta"}),se.jsx(Sl,{id:"label",placeholder:"SCAN-ID [Nome scansione]",value:n.label,onChange:e=>o({...n,label:e.target.value}),className:"bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",disabled:e})]})]}),e&&se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex justify-between text-sm",children:[se.jsx("span",{children:"Scansione in corso..."}),se.jsxs("span",{children:[i,"%"]})]}),se.jsx(Pc,{value:i,className:"h-2"})]}),se.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[se.jsxs(mo,{onClick:async()=>{if(n.centerLat&&n.centerLng&&n.label)try{const{data:e}=await ba.auth.getUser();if(!e.user)return void Ki.error("Devi essere autenticato per salvare");const{error:t}=await ba.from("geo_radar_coordinates").insert({user_id:e.user.id,lat:parseFloat(n.centerLat),lng:parseFloat(n.centerLng),label:n.label,radius:parseFloat(n.radius)});if(t)throw t;Ki.success("Coordinate salvate con successo"),d()}catch(e){console.error("Errore nel salvataggio:",e),Ki.error("Errore nel salvataggio coordinate")}else Ki.error("Compila tutti i campi richiesti")},disabled:e,variant:"outline",className:"rounded-xl border-2 border-cyan-400/30 hover:border-cyan-400 hover:bg-cyan-400/10 transition-all duration-300",children:[se.jsx(mr,{className:"w-4 h-4 mr-2"}),"Salva Coordinate"]}),se.jsxs(mo,{onClick:async()=>{if(!n.centerLat||!n.centerLng)return void Ki.error("Inserisci coordinate valide");t(!0),a(0);const e=setInterval(()=>{a(i=>i>=100?(clearInterval(e),t(!1),u(),100):i+10)},300)},disabled:e,className:"bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 rounded-xl shadow-2xl shadow-cyan-500/30 hover:shadow-cyan-500/50 transition-all duration-300",children:[se.jsx(pr,{className:"w-4 h-4 mr-2"}),e?"Scansione...":"Avvia Scansione"]})]})]})]}),n.centerLat&&n.centerLng&&se.jsxs(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10",children:[se.jsx(Hl,{className:"border-b-0",children:se.jsx(Zl,{className:"text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent",children:" Mappa Tattica Interattiva"})}),se.jsx(Gl,{children:se.jsx("div",{className:"h-80 rounded-2xl overflow-hidden border-2 border-cyan-500/20 shadow-inner",children:se.jsxs(rt,{center:[parseFloat(n.centerLat),parseFloat(n.centerLng)],zoom:15,style:{height:"100%",width:"100%"},children:[se.jsx(nt,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:" M1SSION Tactical Map"}),se.jsx(ot,{position:[parseFloat(n.centerLat),parseFloat(n.centerLng)],children:se.jsx(lt,{children:se.jsxs("div",{className:"text-center",children:[se.jsx("strong",{children:"Centro Scansione M1SSION"}),se.jsx("br",{}),n.label||"Punto di scansione",se.jsx("br",{}),se.jsxs("span",{className:"text-xs font-mono",children:[parseFloat(n.centerLat).toFixed(6),", ",parseFloat(n.centerLng).toFixed(6)]})]})})}),se.jsx(ct,{center:[parseFloat(n.centerLat),parseFloat(n.centerLng)],radius:parseFloat(n.radius),pathOptions:{color:"#00FFFF",fillColor:"#00FFFF",fillOpacity:.1,weight:3,dashArray:"10, 5"}})]})})})]}),se.jsxs("div",{className:"space-y-4",children:[se.jsx("h4",{className:"text-lg font-semibold text-foreground",children:"Risultati Scansioni"}),0===s.length?se.jsx(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/40 backdrop-blur-md",children:se.jsxs(Gl,{className:"py-12 text-center text-muted-foreground",children:[se.jsx(cr,{className:"w-16 h-16 mx-auto mb-6 opacity-50"}),se.jsx("p",{className:"text-lg",children:"Nessuna scansione effettuata"})]})}):s.map(e=>se.jsxs(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-xl hover:shadow-2xl transition-all duration-300",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-lg flex items-center justify-between",children:[se.jsxs("span",{children:["Scansione ",e.timestamp.toLocaleTimeString()]}),se.jsxs("span",{className:"text-sm text-muted-foreground",children:[e.scanResults.length," anomalie"]})]})}),se.jsxs(Gl,{children:[se.jsxs("div",{className:"mb-4 text-sm text-muted-foreground",children:["Centro: ",e.centerLat.toFixed(6),", ",e.centerLng.toFixed(6)," | Raggio: ",e.radius,"m"]}),se.jsx("div",{className:"space-y-3",children:e.scanResults.map((e,t)=>{return se.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/60 rounded-2xl border-2 border-border/50 backdrop-blur-md hover:border-cyan-400/30 transition-all duration-300",children:[se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx(Ys,{className:"w-4 h-4 text-primary"}),se.jsxs("div",{children:[se.jsx("div",{className:"font-medium",children:e.description}),se.jsxs("div",{className:"text-xs text-muted-foreground font-mono",children:[e.lat.toFixed(6),", ",e.lng.toFixed(6)]})]})]}),se.jsxs("div",{className:"text-right",children:[se.jsxs("div",{className:"font-bold "+(i=e.signal,i>70?"text-red-500":i>40?"text-yellow-500":"text-green-500"),children:[e.signal.toFixed(1),"%"]}),se.jsxs("div",{className:"text-xs text-muted-foreground",children:["Conf: ",e.confidence.toFixed(1),"%"]})]})]},t);var i})})]})]},e.id))]})]})},Yb=()=>{const[e,t]=We.useState(!1),[i,a]=We.useState([]),[s,r]=We.useState(0),[n,o]=We.useState({min:2400,max:2500});We.useEffect(()=>{let t;return e&&(t=setInterval(()=>{Math.random()<.3&&l(),r(e=>e>=100?0:e+10)},1e3)),()=>{t&&clearInterval(t)}},[e]);const l=()=>{const e={id:crypto.randomUUID(),frequency:Math.random()*(n.max-n.min)+n.min,strength:100*Math.random(),location:{lat:46+.1*(Math.random()-.5),lng:8+.1*(Math.random()-.5)},timestamp:new Date,decoded:Math.random()<.4,message:Math.random()<.4?c():void 0};a(t=>[e,...t.slice(0,9)]),e.decoded&&e.message&&Ki.success("Segnale BUZZ decodificato!")},c=()=>{const e=["COORDINATE: 46.0000, 8.0000","SETTORE ALPHA: ANOMALIA RILEVATA","PROTOCOLLO M1SSION: FASE 3 ATTIVA","SEGNALE DEBOLE - RIPETERE SCANSIONE","ZONA CRITICA: ACCESSO LIMITATO","FREQUENZA MODULATA - DECRITTAZIONE RICHIESTA"];return e[Math.floor(Math.random()*e.length)]};return se.jsxs("div",{className:"h-full overflow-y-auto pb-20 space-y-8",style:{height:"calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 80px)",paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 80px)"},children:[se.jsxs("div",{className:"text-center mb-8",children:[se.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[se.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20",children:se.jsx(Wr,{className:"w-6 h-6 text-white"})}),se.jsx("h3",{className:"text-2xl font-bold text-foreground",children:"BUZZ Interceptor"})]}),se.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[se.jsx(Er,{className:"w-4 h-4"}),se.jsx("span",{children:"Disponibile dalla Settimana 4"})]})]}),se.jsxs(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10",children:[se.jsx(Hl,{className:"border-b-0",children:se.jsxs(Zl,{className:"text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent flex items-center justify-between",children:[se.jsx("span",{children:"Pannello di Controllo"}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:"w-3 h-3 rounded-full "+(e?"bg-red-500 animate-pulse":"bg-gray-500")}),se.jsx("span",{className:"text-sm",children:e?"ATTIVO":"STANDBY"})]})]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx("label",{className:"text-sm font-medium",children:"Frequenza Min (MHz)"}),se.jsx("input",{type:"number",value:n.min,onChange:e=>o({...n,min:parseInt(e.target.value)}),className:"w-full h-12 px-4 rounded-xl bg-muted/60 border-2 border-border/50 text-foreground backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300",disabled:e})]}),se.jsxs("div",{children:[se.jsx("label",{className:"text-sm font-medium",children:"Frequenza Max (MHz)"}),se.jsx("input",{type:"number",value:n.max,onChange:e=>o({...n,max:parseInt(e.target.value)}),className:"w-full h-12 px-4 rounded-xl bg-muted/60 border-2 border-border/50 text-foreground backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300",disabled:e})]})]}),e&&se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex justify-between text-sm",children:[se.jsx("span",{children:"Scansione frequenze..."}),se.jsxs("span",{children:[s,"%"]})]}),se.jsx(Pc,{value:s,className:"h-2"})]}),se.jsxs(mo,{onClick:()=>{t(!e),e?(Ki.info("Intercettazione BUZZ arrestata"),r(0)):Ki.success("Intercettazione BUZZ avviata")},variant:e?"destructive":"default",className:"w-full rounded-xl py-4 shadow-2xl hover:shadow-2xl transition-all duration-300 "+(e?"":"bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 shadow-cyan-500/30 hover:shadow-cyan-500/50"),children:[se.jsx(dr,{className:"w-4 h-4 mr-2"}),e?"Arresta Intercettazione":"Avvia Intercettazione"]})]})]}),se.jsxs(Wl,{className:"border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10",children:[se.jsx(Hl,{className:"border-b-0",children:se.jsxs(Zl,{className:"text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent flex items-center justify-between",children:[se.jsx("span",{children:"Feed Segnali BUZZ"}),se.jsxs(fc,{variant:"secondary",children:[i.length," segnali"]})]})}),se.jsx(Gl,{children:se.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===i.length?se.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[se.jsx(qa,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e?"In attesa di segnali...":"Avvia intercettazione per rilevare segnali BUZZ"]}):i.map(e=>{return se.jsxs("div",{className:"p-4 bg-muted/60 rounded-2xl border-2 border-border/50 backdrop-blur-md hover:border-cyan-400/30 transition-all duration-300",children:[se.jsxs("div",{className:"flex items-start justify-between mb-2",children:[se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-2 h-2 rounded-full "+(e.decoded?"bg-green-500":"bg-yellow-500")}),se.jsxs("div",{children:[se.jsxs("div",{className:"font-medium text-sm",children:[e.frequency.toFixed(2)," MHz"]}),se.jsx("div",{className:"text-xs text-muted-foreground",children:e.timestamp.toLocaleTimeString()})]})]}),se.jsxs("div",{className:"text-right",children:[se.jsx(fc,{variant:"outline",className:"text-xs",children:(i=e.frequency,i<2420?"LOW":i<2460?"MID":"HIGH")}),se.jsxs("div",{className:"text-sm font-bold "+(t=e.strength,t>70?"text-red-500":t>40?"text-yellow-500":"text-green-500"),children:[e.strength.toFixed(1),"%"]})]})]}),se.jsxs("div",{className:"text-xs text-muted-foreground mb-2 font-mono",children:[" ",e.location.lat.toFixed(6),", ",e.location.lng.toFixed(6)]}),e.decoded&&e.message&&se.jsxs("div",{className:"mt-3 p-2 bg-primary/10 rounded border border-primary/20",children:[se.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[se.jsx(Is,{className:"w-3 h-3 text-primary"}),se.jsx("span",{className:"text-xs font-medium text-primary",children:"DECODIFICATO"})]}),se.jsx("div",{className:"text-sm font-mono text-foreground",children:e.message})]})]},e.id);var t,i})})})]})]})},Kb=st.divIcon({className:"pulsing-red-marker",html:'<div style="\n    width: 20px;\n    height: 20px;\n    background: #ff0000;\n    border-radius: 50%;\n    animation: pulse 2s infinite;\n    box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);\n  "></div>\n  <style>\n    @keyframes pulse {\n      0% { transform: scale(1); opacity: 1; }\n      50% { transform: scale(1.3); opacity: 0.7; }\n      100% { transform: scale(1); opacity: 1; }\n    }\n  </style>',iconSize:[20,20],iconAnchor:[10,10]}),Xb=st.icon({iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",shadowUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});st.Marker.prototype.options.icon=Xb;const Jb=({onMapClick:e})=>(dt({click:t=>{e(t.latlng.lat,t.latlng.lng)}}),null),Qb=()=>{const[e,t]=We.useState(null),[i,a]=We.useState(!1),[s,r]=We.useState(!1),[n,o]=We.useState([]),[l,c]=We.useState(null),[d,u]=We.useState("satellite"),[h,m]=We.useState(!1),{toast:p}=mc(),f=We.useRef(null),g="550e8400-e29b-41d4-a716-446655440000";We.useEffect(()=>{x()},[]);const x=async()=>{try{const{data:e,error:t}=await ba.from("final_shots").select("*").eq("mission_id",g).order("created_at",{ascending:!1});if(t)throw t;if(o(e||[]),e&&e.length>0){const t=new Date(e[0].created_at),i=new Date(t.getTime()+432e5);i>new Date&&c(i)}}catch(e){console.error("Error loading attempts:",e)}},b=()=>Math.max(0,5-n.length),v=()=>{if(!l)return null;const e=new Date,t=l.getTime()-e.getTime();if(t<=0)return null;return`${Math.floor(t/36e5)}h ${Math.floor(t%36e5/6e4)}m`},y=0===b()||!!v();return se.jsxs("div",{className:"w-full h-full overflow-y-auto bg-black/10",style:{minHeight:"calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 160px)"},children:[se.jsx("div",{className:"text-center mb-4 px-4 pt-2",children:se.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[se.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center",children:se.jsx(kr,{className:"w-5 h-5 text-white"})}),se.jsxs("h1",{className:"text-xl font-bold",children:[se.jsx("span",{className:"text-cyan-400",children:"FINAL"}),se.jsx("span",{className:"text-white",children:" SHOT"})]})]})}),se.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 px-4",children:[se.jsx(Wl,{className:"border border-cyan-500/20 rounded-lg bg-card/60 backdrop-blur-sm",children:se.jsxs(Gl,{className:"p-2 text-center",children:[se.jsx("div",{className:"text-lg font-bold text-cyan-400",children:b()}),se.jsx("div",{className:"text-xs text-muted-foreground",children:"Tentativi"})]})}),se.jsx(Wl,{className:"border border-cyan-500/20 rounded-lg bg-card/60 backdrop-blur-sm",children:se.jsxs(Gl,{className:"p-2 text-center",children:[se.jsx("div",{className:"text-lg font-bold text-yellow-400",children:v()||""}),se.jsx("div",{className:"text-xs text-muted-foreground",children:"Cooldown"})]})}),se.jsx(Wl,{className:"border border-cyan-500/20 rounded-lg bg-card/60 backdrop-blur-sm",children:se.jsxs(Gl,{className:"p-2 text-center",children:[se.jsx("div",{className:"text-lg font-bold text-green-400",children:n.length}),se.jsx("div",{className:"text-xs text-muted-foreground",children:"Effettuati"})]})})]}),se.jsx("div",{className:"flex-1 relative px-4 pb-20",children:se.jsxs("div",{className:"relative h-[400px] sm:h-[500px] md:h-[600px] rounded-xl overflow-hidden border-2 border-cyan-500/20 shadow-2xl bg-black/20",style:{zIndex:1},children:[se.jsxs("div",{className:"!visible !opacity-100 !flex absolute top-4 right-4 z-[999] flex-wrap gap-1",style:{visibility:"visible",opacity:1,display:"flex"},children:[se.jsx(mo,{variant:"ghost",size:"sm",className:"!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",onClick:()=>u("satellite"),style:{visibility:"visible",opacity:1,display:"block"},children:""}),se.jsx(mo,{variant:"ghost",size:"sm",className:"!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",onClick:()=>u("dark"),style:{visibility:"visible",opacity:1,display:"block"},children:""}),se.jsx(mo,{variant:"ghost",size:"sm",className:"!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",onClick:()=>u("terrain"),style:{visibility:"visible",opacity:1,display:"block"},children:""}),se.jsx(mo,{variant:"ghost",size:"sm",className:"!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",onClick:()=>u("osm"),style:{visibility:"visible",opacity:1,display:"block"},children:""})]}),se.jsxs(rt,{center:[50.8503,4.3517],zoom:4,minZoom:2,maxZoom:20,style:{height:"100%",width:"100%",position:"absolute",top:0,left:0,touchAction:"pan-x pan-y pinch-zoom",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},ref:f,scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!0,touchZoom:!0,zoomControl:!0,attributionControl:!1,whenReady:()=>{if("undefined"!=typeof window&&window.navigator?.standalone){const e=f.current?.getContainer();e&&(e.style.WebkitTransform="translateZ(0)",e.style.transform="translateZ(0)",e.style.WebkitBackfaceVisibility="hidden",e.style.backfaceVisibility="hidden",e.style.willChange="transform",e.addEventListener("touchstart",()=>{},{passive:!0}),e.addEventListener("touchmove",()=>{},{passive:!0}),e.addEventListener("touchend",()=>{},{passive:!0}))}},children:[se.jsx(nt,{url:(()=>{switch(d){case"satellite":return"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}";case"dark":return"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png";case"terrain":return"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png";default:return"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}})(),attribution:(()=>{switch(d){case"satellite":return"&copy; M1SSION Tactical Intelligence | Esri";case"dark":return"&copy; M1SSION Dark Ops | CartoDB";case"terrain":return"&copy; M1SSION Terrain | OpenTopoMap";default:return"&copy; M1SSION Standard | OpenStreetMap"}})()}),!y&&se.jsx(Jb,{onMapClick:(e,i)=>{if(v(),y)p({title:" Final Shot Non Disponibile",description:v()?`Cooldown attivo: ${v()}`:"Tentativi esauriti",variant:"destructive"});else{const a={lat:parseFloat(e.toFixed(6)),lng:parseFloat(i.toFixed(6))};t(a),r(!0),m(!0),p({title:" Posizione Final Shot Selezionata",description:`Coordinate: ${a.lat}, ${a.lng}`,variant:"default"})}}}),e&&se.jsx(ot,{position:[e.lat,e.lng],icon:Kb,children:se.jsx(lt,{children:se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"font-bold text-red-600",children:" Final Shot"}),se.jsxs("div",{className:"text-sm bg-yellow-200 px-2 py-1 rounded text-black font-mono",children:[e.lat.toFixed(6),", ",e.lng.toFixed(6)]})]})})})]}),y&&se.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-40 backdrop-blur-sm",children:se.jsxs("div",{className:"text-center text-white p-4 bg-black/60 rounded-xl border border-red-500/30",children:[se.jsx("div",{className:"text-lg font-bold mb-2",children:" Final Shot Non Disponibile"}),se.jsxs("div",{className:"text-sm",children:[0===b()&&"Tentativi esauriti",v()&&`Cooldown: ${v()}`]})]})})]})}),se.jsx("div",{className:"!visible !opacity-100 !block",style:{position:"fixed",left:"50%",transform:"translateX(-50%)",bottom:"calc(env(safe-area-inset-bottom, 0px) + 120px)",zIndex:99999,pointerEvents:"auto",visibility:"visible",opacity:1,display:"block"},children:se.jsx(mo,{onClick:()=>{y?p({title:v()?" Cooldown Attivo":" Tentativi Esauriti",description:v()?`Riprova tra: ${v()}`:"Hai raggiunto il limite massimo di tentativi",variant:"destructive"}):(h||m(!0),p({title:" Modalit Final Shot Attiva",description:"Clicca sulla mappa per selezionare la posizione del premio",variant:"default"}))},disabled:y,className:`\n            !visible !opacity-100 !block !relative !z-[100]\n            ${y?"bg-gray-600/80 hover:bg-gray-600/80 cursor-not-allowed border-gray-500/50":"bg-gradient-to-r from-fuchsia-600 to-fuchsia-900 hover:from-fuchsia-700 hover:to-fuchsia-950 border-fuchsia-400/50"} \n            text-white shadow-2xl px-8 py-4 text-lg font-black rounded-full border-3 backdrop-blur-md\n            transition-all duration-300 hover:scale-105 hover:shadow-fuchsia-500/50\n            min-w-[200px] text-center\n            animate-pulse\n          `,style:{visibility:"visible",opacity:1,display:"block",position:"relative",zIndex:100,WebkitTapHighlightColor:"transparent",WebkitTouchCallout:"none"},children:y?se.jsxs(se.Fragment,{children:[" FINAL SHOT",v()?` (${v()})`:" (ESAURITO)"]}):se.jsx(se.Fragment,{children:" FINAL SHOT"})})}),s&&e&&se.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:se.jsx(Wl,{className:"border-2 border-red-500/50 rounded-2xl bg-red-500/10 backdrop-blur-md max-w-md w-full",children:se.jsx(Gl,{className:"p-6",children:se.jsxs("div",{className:"text-center space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-center gap-2",children:[se.jsx(Er,{className:"w-6 h-6 text-red-400"}),se.jsx("h3",{className:"text-xl font-bold text-white",children:"Conferma Final Shot"})]}),se.jsx("p",{className:"text-gray-300",children:"Stai dichiarando che il premio si trova in questo punto."}),se.jsxs("div",{className:"text-sm text-gray-400 font-mono bg-yellow-200 p-3 rounded-lg text-black font-bold",children:[" ",e.lat.toFixed(6),", ",e.lng.toFixed(6)]}),se.jsxs("p",{className:"text-yellow-400 font-medium",children:["Hai solo ",b()," tentativi totali per questa missione. Confermi?"]}),se.jsxs("div",{className:"flex gap-4 justify-center",children:[se.jsx(mo,{variant:"outline",onClick:()=>{r(!1),t(null)},className:"px-6",children:"Annulla"}),se.jsx(mo,{onClick:async()=>{if(e){a(!0);try{e.lat,e.lng;const{data:i,error:a}=await ba.rpc("submit_final_shot",{p_mission_id:g,p_latitude:e.lat,p_longitude:e.lng});if(a)throw console.error(" RPC Error:",a),a;const s=i;if(s.error){const e=s.error.includes("Mission target")?" Target Non Trovato":s.error.includes("Maximum attempts")?" Tentativi Esauriti":s.error.includes("Daily limit")?" Limite Giornaliero":s.error.includes("Cooldown")?" Cooldown Attivo":" Errore Final Shot";return void p({title:e,description:s.error,variant:"destructive"})}s.success?(s.is_winner?p({title:" VINCITORE!",description:"Complimenti! Hai trovato il premio esatto!",variant:"default"}):p({title:" Final Shot Registrato",description:`Distanza: ${(s.distance_meters/1e3).toFixed(2)} km | Direzione: ${s.direction}`,variant:"default"}),c(new Date(Date.now()+432e5)),await x(),t(null),r(!1),m(!1)):p({title:" Final Shot Fallito",description:"Impossibile registrare il tentativo",variant:"destructive"})}catch(i){console.error(" Critical error submitting final shot:",i),p({title:" Errore Sistema",description:"Errore critico durante l'invio. Riprova.",variant:"destructive"})}finally{a(!1)}}},disabled:i,className:"px-8 bg-gradient-to-r from-fuchsia-600 to-fuchsia-900 hover:from-fuchsia-700 hover:to-fuchsia-950 text-white shadow-xl",children:i?se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Invio..."]}):se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(kr,{className:"w-5 h-5"})," LANCIA IL TUO FINAL SHOT"]})})]})]})})})})]})},ev=({title:e})=>{const[,t]=Ai();return se.jsxs("div",{className:"sticky top-0 z-20 flex items-center justify-between px-4 py-3 bg-background/80 backdrop-blur-md border-b border-border",children:[se.jsx("h2",{className:"text-lg font-semibold text-foreground",children:e}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsxs(mo,{variant:"outline",size:"sm",onClick:()=>t("/intelligence/final-shot"),"aria-label":"Apri Final Shot",children:[se.jsx(Ss,{className:"w-4 h-4 mr-2"})," FINAL SHOT"]}),se.jsx(mo,{variant:"ghost",size:"icon",onClick:()=>t("/intelligence"),"aria-label":"Chiudi e torna alla lista Intelligence",children:se.jsx($r,{className:"w-5 h-5"})})]})]})},tv=({children:e,className:t,showTopGradient:i=!0})=>se.jsx("div",{className:eo("relative m1ssion-glass-card overflow-hidden bg-black/60 backdrop-blur-xl shadow-lg",t),children:e}),iv=["/assets/m1ssion-prize/hero-forest-watch.png","/assets/m1ssion-prize/hero-forest-lambo.png","/assets/m1ssion-prize/hero-forest-lambo-porsche.png","/assets/m1ssion-prize/treasure-forest-car.png"];function av({progress:e}){const[t,i]=We.useState(0),[a,s]=We.useState(!1),[r,n]=We.useState(!1),[o,l]=We.useState([]),c=()=>{a||(s(!0),setTimeout(()=>{i(e=>(e+1)%iv.length),s(!1)},150))},d=[{name:"Lamborghini Huracn Experience",image:"/assets/lamborghini-huracan.BDVrMRV0.png",description:" Lamborghini Huracn Experience  Un weekend adrenalina pura."},{name:"Rolex Submariner",image:"/assets/rolex-submariner.A9k_cAfW.png",description:" Rolex Submariner  Precisione e stile intramontabile."},{name:"Herms Birkin",image:"/assets/hermes-birkin.DHEqTVeR.png",description:" Herms Birkin  Eleganza senza compromessi."},{name:"iPhone 16 Pro Max",image:"/assets/iphone-16-pro-max.Ddiy8e6N.png",description:" iPhone 16 Pro Max  Tecnologia allavanguardia."},{name:"AirPods Max",image:"/assets/airpods-max.DG_7KfAy.png",description:" AirPods Max  Immersivo, ovunque."}],u={layout:{type:"spring",stiffness:160,damping:22}};return se.jsxs(at,{id:"mission-prize-group",children:[se.jsx(et.div,{layoutId:"missionPrize",className:"w-full",style:{visibility:r?"hidden":"visible"},transition:u,children:se.jsxs(tv,{className:"w-full relative overflow-hidden rounded-xl",children:[se.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-[#00D1FF] via-[#7B2EFF] to-[#00D1FF]"}),se.jsxs("div",{className:"p-4 border-b border-white/10 flex justify-between items-center cursor-pointer",onClick:()=>n(!0),children:[se.jsxs("h2",{className:"text-lg md:text-xl font-orbitron font-bold",children:[se.jsx("span",{className:"text-[#00D1FF]",style:{textShadow:"0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"},children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})," PRIZE"]})]}),se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsxs("span",{className:"text-xs text-white/70",children:["Visibilit: ",e,"%"]}),se.jsxs("span",{className:"text-xs text-white/50",children:["(",t+1,"/",iv.length,")"]})]})]}),se.jsxs("div",{className:"relative h-60 sm:h-72 md:h-80 lg:h-96 overflow-hidden",children:[se.jsxs("div",{className:"relative w-full h-full cursor-pointer",onClick:c,onTouchStart:c,children:[se.jsx(tt,{mode:"wait",children:se.jsx(et.div,{className:"absolute inset-0",initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3,ease:"easeInOut"},children:se.jsx("img",{src:iv[t],alt:`M1SSION Prize ${t+1}`,className:"w-full h-full object-cover rounded-lg shadow-lg"})},t)}),se.jsx(et.div,{className:"absolute top-4 right-4 w-10 h-10 rounded-full bg-gradient-to-br from-[#00D1FF]/20 to-[#7B2EFF]/20 backdrop-blur-md border border-[#00D1FF]/30 flex items-center justify-center",animate:{x:[0,8,0],opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:se.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"drop-shadow-[0_0_8px_rgba(0,209,255,0.6)]",children:[se.jsx("path",{d:"M5 12H19M19 12L12 5M19 12L12 19",stroke:"url(#arrowGradient)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"}),se.jsx("defs",{children:se.jsxs("linearGradient",{id:"arrowGradient",x1:"5",y1:"12",x2:"19",y2:"12",gradientUnits:"userSpaceOnUse",children:[se.jsx("stop",{offset:"0%",stopColor:"#00D1FF"}),se.jsx("stop",{offset:"100%",stopColor:"#7B2EFF"})]})})]})}),se.jsx("div",{className:"absolute bottom-2 right-2 bg-black/60 backdrop-blur-sm px-2 py-1 rounded text-white text-[14px] md:text-[18px] font-medium",children:"Image for illustrative purposes only"})]}),se.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/30",children:se.jsx("div",{className:"h-full bg-gradient-to-r from-[#00D1FF] to-[#7B2EFF]",style:{width:`${e}%`}})})]})]})}),se.jsx(tt,{children:r&&se.jsxs(et.div,{className:"fixed inset-0 z-[100]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>n(!1),children:[se.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),se.jsx(et.div,{layoutId:"missionPrize",className:"fixed left-0 right-0 z-[101] prize-modal-container",style:{top:72,bottom:88,transformOrigin:"center center"},transition:u,onClick:e=>e.stopPropagation(),children:se.jsx("div",{className:"px-2 md:px-6 h-full max-w-screen-xl mx-auto",children:se.jsxs(tv,{className:"w-full h-full flex flex-col relative overflow-hidden rounded-xl",children:[se.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-[#00D1FF] via-[#7B2EFF] to-[#00D1FF]"}),se.jsxs("div",{className:"p-4 border-b border-white/10 flex justify-between items-center",children:[se.jsxs("h2",{className:"text-lg md:text-xl font-orbitron font-bold",children:[se.jsx("span",{className:"text-[#00D1FF]",style:{textShadow:"0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"},children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})," PRIZE"]})]}),se.jsx("button",{onClick:()=>n(!1),className:"text-white/80 hover:text-white text-sm md:text-base",children:"Chiudi"})]}),se.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:se.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:d.map((e,t)=>se.jsx("div",{className:"perspective-1000 h-64",onClick:e=>{e.stopPropagation(),(e=>{l(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(t)},children:se.jsxs("div",{className:"mission-flip-card w-full h-full "+(o.includes(t)?"is-flipped":""),style:{transformOrigin:"center center"},children:[se.jsxs("div",{className:"mission-card-front absolute inset-0 rounded-xl overflow-hidden bg-white/5 border border-white/10",children:[se.jsx("img",{src:e.image,alt:e.name,className:"absolute inset-0 w-full h-full object-cover"}),se.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 to-transparent p-4",children:se.jsx("h3",{className:"font-orbitron text-base md:text-lg font-bold text-cyan-400",children:e.name})})]}),se.jsx("div",{className:"mission-card-back absolute inset-0 rounded-xl p-6 bg-white/5 border border-white/10 flex items-center justify-center text-center",children:se.jsx("p",{className:"text-white text-sm md:text-base leading-relaxed",children:e.description})})]})},t))})})]})})})]},"overlay")})]})}function sv(){const[e,t]=We.useState(void 0);return We.useEffect(()=>{const e=()=>{t(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e??!1}function rv({credits:e,onPurchaseClue:t}){const[i,a]=We.useState(!1),[s,r]=We.useState(!1),n=sv(),o=dd(()=>{n&&r(!0)},{threshold:800}),l=[{id:"clue_001",code:"CLU-001",title:"Coordinate Base",description:"Rivela la zona generale dell'obiettivo",cost:50,type:"basic",progressValue:5},{id:"clue_002",code:"CLU-002",title:"Dettaglio Architettonico",description:"Informazioni specifiche sull'edificio target",cost:120,type:"premium",progressValue:10},{id:"clue_003",code:"CLU-003",title:"Intel Esclusivo",description:"Accesso a intelligence riservata di alto livello",cost:250,type:"exclusive",progressValue:20}],c=e=>{switch(e){case"basic":default:return"bg-[#1C1C1F]/80";case"premium":return"bg-[#1C1C1F]/90";case"exclusive":return"bg-[#1C1C1F]"}},d=()=>se.jsx(et.div,{className:"fixed inset-0 z-[100] bg-black/95 backdrop-blur-md",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},onClick:()=>r(!1),children:se.jsx("div",{className:"h-full w-full p-6 overflow-y-auto",children:se.jsxs("div",{className:"rounded-[20px] bg-[#1C1C1F] backdrop-blur-xl overflow-hidden relative",style:{background:"linear-gradient(135deg, #1C1C1F 0%, rgba(28, 28, 31, 0.95) 50%, rgba(54, 94, 255, 0.1) 100%)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[se.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px]",style:{background:"linear-gradient(90deg, #FC1EFF 0%, #365EFF 50%, #FACC15 100%)"}}),se.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center",children:[se.jsx("h2",{className:"text-xl md:text-2xl font-orbitron font-bold text-white",children:"M1SSION CONSOLE"}),se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx("span",{className:"text-xs text-white/70",children:"Crediti disponibili"}),se.jsx("span",{className:"text-lg font-bold text-white",children:e})]})]}),se.jsxs("div",{className:"p-6",children:[se.jsx("p",{className:"text-white/70 text-sm mb-4",children:"Acquista indizi per avvicinarti all'obiettivo principale."}),se.jsx("div",{className:"space-y-3",children:l.map((i,a)=>se.jsxs(et.div,{className:`p-4 rounded-[16px] ${c(i.type)} hover:scale-105 transition-all duration-200 shadow-md`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1*a},children:[se.jsxs("div",{className:"flex justify-between items-start mb-2",children:[se.jsx("span",{className:"text-white/80 text-xs font-mono",children:i.code}),se.jsxs("span",{className:"text-white font-bold",children:[i.cost," crediti"]})]}),se.jsx("h3",{className:"text-white font-bold text-sm mb-1 font-orbitron",children:i.title}),se.jsx("p",{className:"text-white/60 text-xs mb-3",children:i.description}),se.jsxs("div",{className:"flex justify-between items-center",children:[se.jsxs("span",{className:"text-green-400 text-xs",children:["+",i.progressValue,"% progresso"]}),se.jsx("button",{className:"px-3 py-1 rounded-full text-xs transition-all font-orbitron "+(e>=i.cost?"bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white hover:scale-105 hover:shadow-lg":"bg-gray-600 text-gray-400 cursor-not-allowed"),disabled:e<i.cost,onClick:()=>t(i),children:"Acquista"})]})]},i.id))})]})]})})});return se.jsxs(se.Fragment,{children:[se.jsxs(et.div,{className:"rounded-[20px] bg-[#1C1C1F] backdrop-blur-xl overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] mb-4 relative",style:{background:"linear-gradient(135deg, #1C1C1F 0%, rgba(28, 28, 31, 0.95) 50%, rgba(54, 94, 255, 0.1) 100%)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},whileHover:{scale:1.02},whileTap:{scale:.98},children:[se.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px]",style:{background:"linear-gradient(90deg, #FC1EFF 0%, #365EFF 50%, #FACC15 100%)"}}),se.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center",onClick:()=>{a(!i)},...n?o:{},children:[se.jsx("h2",{className:"text-lg md:text-xl font-orbitron font-bold text-white",children:"M1SSION CONSOLE"}),se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx("span",{className:"text-xs text-white/70",children:"Crediti disponibili"}),se.jsx("span",{className:"text-lg font-bold text-white",children:e}),se.jsx(et.div,{animate:{rotate:i?180:0},transition:{duration:.3},children:se.jsx(ls,{className:"w-4 h-4 text-white/60"})})]})]}),se.jsx(tt,{children:i&&se.jsx(et.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.5,ease:"easeInOut"},className:"overflow-hidden",children:se.jsxs("div",{className:"p-6",children:[se.jsx("p",{className:"text-white/70 text-sm mb-4",children:"Acquista indizi per avvicinarti all'obiettivo principale."}),se.jsx("div",{className:"space-y-3 max-h-[calc(100vh-25rem)] overflow-y-auto pr-1 custom-scrollbar",children:l.map((i,a)=>se.jsxs(et.div,{className:`p-4 rounded-[16px] ${c(i.type)} hover:scale-105 transition-all duration-200 shadow-md`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1*a},children:[se.jsxs("div",{className:"flex justify-between items-start mb-2",children:[se.jsx("span",{className:"text-white/80 text-xs font-mono",children:i.code}),se.jsxs("span",{className:"text-white font-bold",children:[i.cost," crediti"]})]}),se.jsx("h3",{className:"text-white font-bold text-sm mb-1 font-orbitron",children:i.title}),se.jsx("p",{className:"text-white/60 text-xs mb-3",children:i.description}),se.jsxs("div",{className:"flex justify-between items-center",children:[se.jsxs("span",{className:"text-green-400 text-xs",children:["+",i.progressValue,"% progresso"]}),se.jsx("button",{className:"px-3 py-1 rounded-full text-xs transition-all font-orbitron "+(e>=i.cost?"bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white hover:scale-105 hover:shadow-lg":"bg-gray-600 text-gray-400 cursor-not-allowed"),disabled:e<i.cost,onClick:e=>{e.stopPropagation(),t(i)},children:"Acquista"})]})]},i.id))})]})})})]}),s&&se.jsx(d,{})]})}function nv({entries:e,onAddNote:t,purchasedClues:i}){const[a,s]=We.useState(!1),[r,n]=We.useState(""),[o,l]=We.useState(!1),c={totalEntries:e.length,notesCount:e.filter(e=>"note"===e.type).length,purchasesCount:e.filter(e=>"purchase"===e.type).length,cluesCount:i.length};return se.jsxs(et.div,{className:"rounded-[20px] bg-[#1C1C1F] backdrop-blur-xl overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] mb-4 relative",style:{background:"linear-gradient(135deg, #1C1C1F 0%, rgba(28, 28, 31, 0.95) 50%, rgba(252, 30, 255, 0.1) 100%)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},whileHover:{scale:1.02},whileTap:{scale:.98},children:[se.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px]",style:{background:"linear-gradient(90deg, #FC1EFF 0%, #365EFF 50%, #FACC15 100%)"}}),se.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center",onClick:()=>{s(!a)},children:[se.jsx("h2",{className:"text-lg md:text-xl font-orbitron font-bold text-white",children:"M1SSION AGENT"}),se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsxs("span",{className:"text-xs text-white/70",children:["Attivit: ",e.length]}),se.jsx(et.div,{animate:{rotate:a?180:0},transition:{duration:.3},children:se.jsx(ls,{className:"w-4 h-4 text-white/60"})})]})]}),se.jsx(tt,{children:a&&se.jsx(et.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.5,ease:"easeInOut"},className:"overflow-hidden",children:se.jsxs("div",{className:"p-6",children:[se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[se.jsxs("div",{className:"bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center",children:[se.jsx("p",{className:"text-lg font-bold text-blue-400",children:c.totalEntries}),se.jsx("p",{className:"text-xs text-white/60",children:"Attivit Totali"})]}),se.jsxs("div",{className:"bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center",children:[se.jsx("p",{className:"text-lg font-bold text-green-400",children:c.notesCount}),se.jsx("p",{className:"text-xs text-white/60",children:"Note Personali"})]}),se.jsxs("div",{className:"bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center",children:[se.jsx("p",{className:"text-lg font-bold text-yellow-400",children:c.purchasesCount}),se.jsx("p",{className:"text-xs text-white/60",children:"Acquisti"})]}),se.jsxs("div",{className:"bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center",children:[se.jsx("p",{className:"text-lg font-bold text-purple-400",children:c.cluesCount}),se.jsx("p",{className:"text-xs text-white/60",children:"Indizi"})]})]}),se.jsxs("div",{className:"mb-4",children:[se.jsxs("button",{onClick:e=>{e.stopPropagation(),l(!o)},className:"w-full p-3 bg-gradient-to-r from-[#365EFF]/20 to-[#FC1EFF]/20 border border-[#365EFF]/30 rounded-[16px] text-white hover:from-[#365EFF]/30 hover:to-[#FC1EFF]/30 transition-all flex items-center justify-center space-x-2",children:[se.jsx(nr,{className:"w-4 h-4"}),se.jsx("span",{className:"text-sm font-orbitron",children:"Aggiungi Nota Personale"})]}),se.jsx(tt,{children:o&&se.jsx(et.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"mt-3 overflow-hidden",children:se.jsxs("div",{className:"space-y-3",children:[se.jsx("textarea",{value:r,onChange:e=>n(e.target.value),placeholder:"Scrivi la tua nota personale...",className:"w-full p-3 bg-[#0a0a0a]/50 border border-white/20 rounded-[16px] text-white placeholder-white/50 resize-none focus:outline-none focus:border-[#365EFF]/50",rows:3,onClick:e=>e.stopPropagation()}),se.jsxs("div",{className:"flex space-x-2",children:[se.jsx("button",{onClick:e=>{e.stopPropagation(),r.trim()&&(t(r.trim()),n(""),l(!1))},className:"px-4 py-2 bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white rounded-full text-sm hover:shadow-lg transition-all font-orbitron",children:"Salva Nota"}),se.jsx("button",{onClick:e=>{e.stopPropagation(),l(!1),n("")},className:"px-4 py-2 bg-gray-600 text-white rounded-full text-sm hover:bg-gray-700 transition-all font-orbitron",children:"Annulla"})]})]})})})]}),se.jsxs("div",{className:"space-y-3 max-h-[calc(100vh-30rem)] overflow-y-auto pr-1 custom-scrollbar",children:[se.jsx("h4",{className:"text-white font-medium mb-3 font-orbitron",children:"Diario delle Attivit"}),e.length>0?e.map((e,t)=>{return se.jsx(et.div,{className:"p-3 bg-[#0a0a0a]/50 rounded-[16px] border border-white/10 hover:border-white/20 transition-colors",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*t},children:se.jsx("div",{className:"flex items-start space-x-3",children:se.jsxs("div",{className:"flex-1 min-w-0",children:[se.jsx("p",{className:"text-white text-sm leading-relaxed break-words",children:e.content}),se.jsx("span",{className:"text-xs text-white/60 mt-2 block",children:(i=e.timestamp,new Date(i).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))})]})})},t);var i}):se.jsxs("div",{className:"text-center py-8 text-white/50",children:[se.jsx("p",{className:"text-sm",children:"Nessuna attivit registrata"}),se.jsx("p",{className:"text-xs text-white/40 mt-1",children:"Le tue azioni verranno registrate qui"})]})]})]})})})]})}function ov({mission:e,purchasedClues:t=[],progress:i=0}){const[a,s]=We.useState(null),r=e.foundClues??0,n=e.totalClues||200,{notifications:o}=Fa(),l=o.filter(e=>"buzz"===e.type),c=r>0?r:l?.length||0,d=e=>{s(a===e?null:e)};return se.jsxs("div",{className:"w-full",children:[se.jsxs("div",{className:"mb-4",children:[se.jsxs("h2",{className:"text-xl font-orbitron font-bold mb-2",children:[se.jsx("span",{className:"text-[#00D1FF]",children:"CACCIA"}),se.jsx("span",{className:"text-white",children:" AL TESORO URBANO"})]}),se.jsxs("h3",{className:"text-xl font-orbitron font-bold",children:[se.jsx("span",{className:"text-[#00D1FF]",children:"MISSIONE ID:"}),se.jsxs("span",{className:"text-white",children:[" ",e.title]})]})]}),se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[se.jsxs(et.div,{className:"bg-[#1a1a1a] border border-white/10 rounded-2xl p-4 cursor-pointer hover:border-green-500/30 transition-colors",onClick:()=>d("clues"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[se.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[se.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),se.jsx("span",{className:"text-white/80 text-sm",children:"Indizi trovati"})]}),se.jsxs("div",{className:"text-2xl font-bold text-green-400 mb-2",children:[c,"/",n]}),se.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:se.jsx("div",{className:"h-2 rounded-full transition-all duration-500 "+(0===c?"bg-gray-500":c<50?"bg-gradient-to-r from-[#22C55E] to-[#10B981]":c<100?"bg-gradient-to-r from-[#10B981] to-[#00D1FF]":c<150?"bg-gradient-to-r from-[#00D1FF] to-[#A855F7]":"bg-gradient-to-r from-[#A855F7] to-[#D946EF]"),style:{width:c/n*100+"%"}})}),se.jsxs("span",{className:"text-xs text-white/60",children:[Math.round(c/n*100),"% completato"]}),se.jsx(tt,{children:"clues"===a&&se.jsxs(et.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden mt-4 pt-4 border-t border-white/10",children:[se.jsxs("h4",{className:"text-white font-medium mb-3",children:["Indizi BUZZ Scoperti (",l.length,")"]}),se.jsx("div",{className:"space-y-2",children:l.length>0?l.map((e,t)=>se.jsxs(et.div,{className:"bg-white/5 rounded-lg p-3 border border-white/10 hover:border-white/20 transition-colors",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1*t},children:[se.jsxs("div",{className:"flex items-start justify-between mb-2",children:[se.jsx("h5",{className:"text-sm font-medium text-white",children:e.title}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-xs text-white/50",children:new Date(e.date).toLocaleDateString("it-IT")}),se.jsx("span",{className:"inline-block px-2 py-1 text-xs bg-blue-500/20 text-blue-300 rounded-full",children:"BUZZ"})]})]}),se.jsx("p",{className:"text-sm text-white/80 leading-relaxed mb-3",children:e.description}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-xs text-green-400",children:" Scoperto via BUZZ"}),se.jsx("button",{className:"px-3 py-1 bg-blue-600/20 hover:bg-blue-600/30 text-blue-300 text-xs rounded-lg border border-blue-500/30 transition-colors",children:" Visualizza"})]})]},e.id)):se.jsxs("div",{className:"text-center py-4 text-white/60",children:[se.jsx("p",{children:"Nessun indizio trovato oggi."}),se.jsx("p",{className:"text-sm mt-2",children:"Premi BUZZ per scoprire nuovi indizi!"}),se.jsx("div",{className:"mt-4 p-3 bg-blue-900/20 rounded-lg border border-blue-500/30",children:se.jsx("p",{className:"text-xs text-blue-300",children:" Gli indizi BUZZ verranno visualizzati qui dopo ogni utilizzo"})})]})})]})})]}),se.jsxs(et.div,{className:"bg-[#1a1a1a] border border-white/10 rounded-2xl p-4 cursor-pointer hover:border-amber-500/30 transition-colors",onClick:()=>d("time"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[se.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[se.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full"}),se.jsx("span",{className:"text-white/80 text-sm",children:"Tempo rimasto"})]}),se.jsxs("div",{className:"text-2xl font-bold text-amber-400 mb-2",children:[e.remainingDays," giorni"]}),se.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:se.jsx("div",{className:"h-2 rounded-full transition-all duration-500 "+(e.remainingDays<=0?"bg-gradient-to-r from-[#EF4444] to-[#DC2626]":e.remainingDays<=5?"bg-gradient-to-r from-[#F97316] to-[#EF4444]":e.remainingDays<=15?"bg-gradient-to-r from-[#FBBF24] to-[#F97316]":"bg-gradient-to-r from-[#FDE047] to-[#FBBF24]"),style:{width:(e.totalDays-e.remainingDays)/e.totalDays*100+"%"}})}),se.jsxs("span",{className:"text-xs text-white/60",children:["su ",e.totalDays," giorni totali"]}),se.jsx(tt,{children:"time"===a&&se.jsxs(et.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden mt-4 pt-4 border-t border-white/10",children:[se.jsx("h4",{className:"text-white font-medium mb-3",children:"Timeline Missione"}),se.jsx("div",{className:"space-y-2",children:(()=>{const t=new Date(e.startTime);return[{event:"Missione Iniziata",date:t.toLocaleDateString(),status:"completed"},{event:"Primo Indizio",date:new Date(t.getTime()+864e5).toLocaleDateString(),status:"completed"},{event:"Fase Intermedia",date:(new Date).toLocaleDateString(),status:"current"},{event:"Deadline Finale",date:new Date(t.getTime()+864e5*e.totalDays).toLocaleDateString(),status:"pending"}]})().map((e,t)=>se.jsxs("div",{className:"flex items-center justify-between p-2 bg-[#0a0a0a] rounded",children:[se.jsx("span",{className:"text-white text-sm",children:e.event}),se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx("span",{className:"text-xs text-white/60",children:e.date}),se.jsx("div",{className:"w-2 h-2 rounded-full "+("completed"===e.status?"bg-green-400":"current"===e.status?"bg-amber-400":"bg-gray-600")})]})]},t))})]})})]}),se.jsxs(et.div,{className:"bg-[#1a1a1a] border border-white/10 rounded-2xl p-4 cursor-pointer hover:border-[#00D1FF]/30 transition-colors",onClick:()=>d("status"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[se.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[se.jsx("div",{className:"w-2 h-2 bg-[#00D1FF] rounded-full"}),se.jsx("span",{className:"text-white/80 text-sm",children:"Stato missione"})]}),se.jsx("div",{className:"text-xl font-bold text-[#00D1FF] mb-3",children:e.remainingDays>0?"ATTIVA":"SCADUTA"}),se.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:se.jsx("div",{className:"h-2 rounded-full transition-all duration-500 "+(e.remainingDays<=0?"bg-red-500":e.remainingDays<=5?"bg-gradient-to-r from-yellow-400 to-red-500":e.remainingDays<=15?"bg-gradient-to-r from-green-400 to-yellow-400":"bg-gradient-to-r from-[#00D1FF] to-green-400"),style:{width:(e.totalDays-e.remainingDays)/e.totalDays*100+"%"}})}),se.jsxs("div",{className:"text-xs text-white/60 mb-1",children:["Iniziata il ",new Date(e.startTime).toLocaleDateString("it-IT")]}),se.jsxs("span",{className:"text-xs text-white/60",children:[Math.round((e.totalDays-e.remainingDays)/e.totalDays*100),"% tempo trascorso (",e.totalDays-e.remainingDays,"/",e.totalDays," giorni)"]}),se.jsx(tt,{children:"status"===a&&se.jsxs(et.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden mt-4 pt-4 border-t border-white/10",children:[se.jsx("h4",{className:"text-white font-medium mb-3",children:"Dettagli Progresso"}),se.jsxs("div",{className:"mb-4",children:[se.jsxs("div",{className:"flex justify-between mb-2",children:[se.jsx("span",{className:"text-white text-sm",children:"Progresso Generale"}),se.jsxs("span",{className:"text-[#00D1FF] text-sm font-bold",children:[Math.round(r/n*100),"%"]})]}),se.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:se.jsx(et.div,{className:"h-3 rounded-full transition-all duration-500 "+(0===r?"bg-gray-500":r<50?"bg-gradient-to-r from-[#00D1FF] to-blue-400":r<150?"bg-gradient-to-r from-green-400 to-[#00D1FF]":"bg-gradient-to-r from-[#7B2EFF] to-[#00D1FF]"),initial:{width:0},animate:{width:r/n*100+"%"},transition:{duration:1,ease:"easeOut"}})})]}),se.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[se.jsxs("div",{className:"bg-[#0a0a0a] p-3 rounded-lg text-center",children:[se.jsx("p",{className:"text-lg font-bold text-green-400",children:r}),se.jsx("p",{className:"text-xs text-white/60",children:"Obiettivi Raggiunti"})]}),se.jsxs("div",{className:"bg-[#0a0a0a] p-3 rounded-lg text-center",children:[se.jsx("p",{className:"text-lg font-bold text-red-400",children:n-r}),se.jsx("p",{className:"text-xs text-white/60",children:"Obiettivi Rimanenti"})]})]})]})})]})]})]})}const lv=({open:e,onOpenChange:t})=>{const{user:i}=sn(),[a,s]=We.useState(""),[r,n]=We.useState(!1),o=i?.id?`https://m1ssion.eu?ref=${i.id}`:"https://m1ssion.eu",l=` Unisciti a M1SSION - La caccia al tesoro pi epica! Usa il mio link per iniziare: ${o}`,c=async()=>{try{await navigator.clipboard.writeText(o),Ki.success("Link copiato negli appunti!")}catch(e){Ki.error("Errore durante la copia del link")}};return se.jsx(to,{open:e,onOpenChange:t,children:se.jsxs(io,{className:"max-w-md mx-auto bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f172a] border border-cyan-500/20",children:[se.jsxs(ao,{className:"text-center",children:[se.jsx(et.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"flex items-center justify-center mb-4",children:se.jsxs("div",{className:"relative",children:[se.jsx(Fr,{className:"w-16 h-16 text-cyan-400"}),se.jsx(et.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0,repeatType:"reverse"},className:"absolute -top-2 -right-2",children:se.jsx(br,{className:"w-6 h-6 text-cyan-300"})})]})}),se.jsx(so,{className:"text-2xl font-bold gradient-text mb-2",children:" Invita un Amico"}),se.jsx("p",{className:"text-gray-300 text-sm",children:"Condividi M1SSION e guadagna +25 XP quando si registrano!"})]}),se.jsxs("div",{className:"space-y-4 py-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Il tuo link di invito:"}),se.jsxs("div",{className:"flex space-x-2",children:[se.jsx(Sl,{value:o,readOnly:!0,className:"flex-1 bg-gray-800/50 border-gray-600/50 text-gray-300 text-sm"}),se.jsx(mo,{onClick:c,variant:"outline",size:"icon",className:"bg-gray-700/50 border-gray-600/50 text-gray-300 hover:bg-gray-700/80",children:se.jsx(ys,{className:"w-4 h-4"})})]})]}),se.jsxs("div",{className:"space-y-3",children:[se.jsx("p",{className:"text-sm font-medium text-gray-300",children:"Condividi tramite:"}),se.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[se.jsxs(mo,{onClick:()=>{const e=`https://wa.me/?text=${encodeURIComponent(l)}`;window.open(e,"_blank")},variant:"outline",className:"flex items-center space-x-2 bg-green-600/20 border-green-500/50 text-green-200 hover:bg-green-600/40",children:[se.jsx(Js,{className:"w-4 h-4"}),se.jsx("span",{children:"WhatsApp"})]}),se.jsxs(mo,{onClick:()=>{const e=`sms:?body=${encodeURIComponent(l)}`;window.open(e)},variant:"outline",className:"flex items-center space-x-2 bg-blue-600/20 border-blue-500/50 text-blue-200 hover:bg-blue-600/40",children:[se.jsx(yr,{className:"w-4 h-4"}),se.jsx("span",{children:"SMS"})]}),se.jsxs(mo,{onClick:()=>{const e=`mailto:?subject=${encodeURIComponent("Unisciti a M1SSION!")}&body=${encodeURIComponent(l)}`;window.open(e)},variant:"outline",className:"flex items-center space-x-2 bg-purple-600/20 border-purple-500/50 text-purple-200 hover:bg-purple-600/40",children:[se.jsx(Gs,{className:"w-4 h-4"}),se.jsx("span",{children:"Email"})]}),se.jsxs(mo,{onClick:async()=>{if(navigator.share)try{n(!0),await navigator.share({title:"M1SSION - Unisciti alla caccia!",text:"Unisciti a M1SSION - La caccia al tesoro pi epica!",url:o})}catch(e){"AbortError"!==e.name&&Ki.error("Errore durante la condivisione")}finally{n(!1)}else c()},disabled:r,variant:"outline",className:"flex items-center space-x-2 bg-cyan-600/20 border-cyan-500/50 text-cyan-200 hover:bg-cyan-600/40",children:[se.jsx(br,{className:"w-4 h-4"}),se.jsx("span",{children:r?"Condividi...":"Altro"})]})]})]}),se.jsxs(et.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"p-3 bg-gradient-to-r from-yellow-900/40 to-yellow-700/40 rounded-lg border border-yellow-500/30",children:[se.jsx("p",{className:"text-yellow-200 text-sm font-medium",children:" Ricompensa Referral"}),se.jsx("p",{className:"text-yellow-300/80 text-xs",children:"Riceverai +25 XP quando il tuo amico si registra usando il tuo link!"})]})]}),se.jsx("div",{className:"flex justify-center pt-4",children:se.jsx(mo,{onClick:()=>t(!1),variant:"outline",className:"bg-gray-700/50 border-gray-600/50 text-gray-300 hover:bg-gray-700/80",children:"Chiudi"})})]})})},cv=()=>{const[e,t]=We.useState(!1);return se.jsxs(se.Fragment,{children:[se.jsx(et.button,{"aria-label":"Invita un Amico",onClick:()=>t(!0),className:"fixed z-[70] top-36 right-4 md:top-40 md:right-8 w-12 h-12 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-[hsl(282,90%,45%)]/15 to-[hsl(218,79%,59%)]/15 backdrop-blur-md border border-white/15 shadow-[0_8px_30px_rgba(114,9,183,0.25)] hover:from-[hsl(282,90%,45%)]/25 hover:to-[hsl(218,79%,59%)]/25 transition-all flex items-center justify-center",initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},whileHover:{scale:1.05},whileTap:{scale:.95},children:se.jsx(Mr,{className:"w-5 h-5 md:w-6 md:h-6 text-white drop-shadow-[0_0_8px_rgba(255,255,255,0.3)]"})}),se.jsx(lv,{open:e,onOpenChange:t})]})};function dv(){const{user:e}=$l();(()=>{const[e,t]=We.useState([]),[i,a]=We.useState([]),[s,r]=We.useState(!0),[n,o]=We.useState(null),{user:l}=$l(),c=Ml(async()=>{if(l)try{r(!0),o(null);const{data:e,error:i}=await ba.from("prizes").select("\n          *,\n          prize_clues!inner(count)\n        ").eq("is_active",!0).order("start_date",{ascending:!1});if(i)return console.error("Error loading prizes:",i),void o("Errore nel caricamento dei premi");const s=e?.map(e=>e.id)||[];if(s.length>0){const{data:i}=await ba.from("prize_clues").select("id, prize_id").in("prize_id",s),r=i?.map(e=>e.id)||[],{data:n}=await ba.from("user_clues").select("*").eq("user_id",l.id).in("clue_id",r);a(n||[]);const o=new Map;i?.forEach(e=>{const t=n?.some(t=>t.clue_id===e.id);t&&o.set(e.prize_id,(o.get(e.prize_id)||0)+1)});const c=e?.map(e=>({...e,clue_count:e.prize_clues?.length||0,unlocked_clues:o.get(e.id)||0}))||[];t(c)}else t([]),a([])}catch(e){console.error("Error in loadPrizes:",e),o("Errore di connessione")}finally{r(!1)}}),d=Ml(async e=>{if(!l)return[];try{const{data:t,error:i}=await ba.from("prize_clues").select("*").eq("prize_id",e).order("week",{ascending:!0});if(i)throw console.error("Error loading clues:",i),new Error("Errore nel caricamento degli indizi");const a=t?.map(e=>e.id)||[],{data:s}=await ba.from("user_clues").select("clue_id").eq("user_id",l.id).in("clue_id",a),r=new Set(s?.map(e=>e.clue_id)||[]);return t?.map(e=>({...e,is_unlocked:r.has(e.id),unlock_cost:u(e.clue_type)}))||[]}catch(t){throw console.error("Error loading prize clues:",t),t}}),u=e=>{switch(e){case"precise":return 50;case"medium":return 30;case"vague":return 10;default:return 20}},h=Ml(async e=>{if(!l)return!1;try{const{data:t}=await ba.from("profiles").select("credits").eq("id",l.id).single(),i=t?.credits||0,s=e.unlock_cost||20;if(i<s)return Ki.error(`Crediti insufficienti. Servono ${s} crediti.`),!1;const{error:r}=await ba.from("profiles").update({credits:i-s}).eq("id",l.id);if(r)return console.error("Error updating credits:",r),Ki.error("Errore nell'aggiornamento dei crediti"),!1;const{error:n}=await ba.from("user_clues").insert({user_id:l.id,clue_id:e.id,title_it:e.title_it,description_it:e.description_it,clue_type:e.clue_type,buzz_cost:s});if(n)return console.error("Error inserting user clue:",n),await ba.from("profiles").update({credits:i}).eq("id",l.id),Ki.error("Errore nel salvataggio dell'indizio"),!1;const o={clue_id:e.id,user_id:l.id,title_it:e.title_it,description_it:e.description_it,clue_type:e.clue_type,buzz_cost:s,created_at:(new Date).toISOString()};return a(e=>[...e,o]),Ki.success(`Indizio sbloccato! Costato ${s} crediti.`),await c(),!0}catch(t){return console.error("Error unlocking clue:",t),Ki.error("Errore nel sblocco dell'indizio"),!1}}),m=We.useCallback(e=>i.filter(e=>!0),[i]),p=We.useCallback(e=>e.clue_count?Math.round((e.unlocked_clues||0)/e.clue_count*100):0,[]),f=We.useCallback(e=>100===p(e),[p]);We.useEffect(()=>{l&&c()},[l])})(),(e=>{const[t,i]=We.useState(0),a=We.useCallback(async()=>{if(e)try{const{count:t,error:a}=await ba.from("user_clues").select("*",{count:"exact",head:!0}).eq("user_id",e);if(a)return void console.error("Error loading user clues count:",a);i(t||0)}catch(t){console.error("Exception loading user clues count:",t)}},[e]),s=We.useCallback(()=>t<=10?7.99:t<=20?9.99:t<=30?13.99:t<=40?19.99:29.99,[t]),r=We.useCallback(()=>{s(),[5,15,25,35,45].forEach(e=>{const a=t;i(e),s(),i(a)})},[t,s]);We.useEffect(()=>{e&&a()},[e,a])})(e?.id);const{missionStatus:t}=(()=>{const[e,t]=We.useState(null),[i,a]=We.useState(!0),[s,r]=We.useState(null),{user:n}=$l(),o=async()=>{if(n)try{a(!0),r(null);const{data:e,error:i}=await ba.from("missions").select("id, title").eq("status","active").order("created_at",{ascending:!1}).limit(1).single();i&&"PGRST116"!==i.code&&console.error("Error loading active mission:",i);const s=e?.id||"M001",o=e?.title||"M1SSION ONE";let l=0,c=0;const d=3;for(;c<d;){const{count:e,error:t}=await ba.from("user_clues").select("*",{count:"exact",head:!0}).eq("user_id",n.id);if(!t){l=e||0;break}if(console.error(` Error loading user clues count (attempt ${c+1}):`,t),c++,c>=d)return void r("Errore nel caricamento indizi");await new Promise(e=>setTimeout(e,500))}const u=Math.round(l/200*100);(new Date).toISOString();const{data:h,error:m}=await ba.from("user_mission_status").select("*").eq("user_id",n.id).single();if(m&&"PGRST116"!==m.code)return console.error("Error loading mission status:",m),void r("Errore nel caricamento dello stato missione");if(h){const e=new Date(h.mission_started_at),i=new Date,a=Math.floor((i.getTime()-e.getTime())/864e5),r=Math.max(0,30-a);if((h.clues_found||0)!==l){const{error:e}=await ba.from("user_mission_status").update({clues_found:l,mission_progress_percent:u}).eq("user_id",n.id);e&&console.error(" Error updating mission status:",e)}t({id:s,title:o,state:r>0?"ATTIVA":"SCADUTA",startDate:e,daysRemaining:r,totalDays:30,cluesFound:l,totalClues:200,progressPercent:u})}else{const{data:e,error:i}=await ba.from("user_mission_status").insert({user_id:n.id,clues_found:0,mission_progress_percent:0,mission_started_at:(new Date).toISOString(),mission_days_remaining:30,buzz_counter:0,map_radius_km:null,map_area_generated:!1}).select().single();if(i)return console.error("Error creating mission status:",i),void r("Errore nella creazione dello stato missione");const a=new Date(e.mission_started_at),c=new Date,d=Math.floor((c.getTime()-a.getTime())/864e5),h=Math.max(0,30-d),{error:m}=await ba.from("user_mission_status").update({clues_found:l,mission_progress_percent:u}).eq("user_id",n.id);m&&console.error(" Error updating mission status:",m),t({id:s,title:o,state:h>0?"ATTIVA":"SCADUTA",startDate:a,daysRemaining:h,totalDays:30,cluesFound:l,totalClues:200,progressPercent:u})}}catch(e){console.error("Error in loadMissionStatus:",e),r("Errore di connessione")}finally{a(!1)}else a(!1)};return We.useEffect(()=>{if(!n)return;o();const e=ba.channel("user_clues_mission_updates").on("postgres_changes",{event:"*",schema:"public",table:"user_clues",filter:`user_id=eq.${n.id}`},()=>{o()}).on("postgres_changes",{event:"*",schema:"public",table:"user_mission_status",filter:`user_id=eq.${n.id}`},()=>{o()}).subscribe();return()=>{e.unsubscribe()}},[n]),We.useEffect(()=>{if(!e)return;const i=setInterval(()=>{const i=e.startDate,a=new Date,s=Math.floor((a.getTime()-i.getTime())/864e5),r=Math.max(0,30-s);r!==e.daysRemaining&&t(e=>e?{...e,daysRemaining:r,state:r>0?"ATTIVA":"SCADUTA"}:null)},6e4);return()=>clearInterval(i)},[e]),{missionStatus:e,loading:i,error:s,reload:o}})();We.useEffect(()=>{localStorage.removeItem("mission-progress"),localStorage.removeItem("purchased-clues"),localStorage.removeItem("diary-entries"),localStorage.removeItem("user-credits"),localStorage.removeItem("mission-data"),localStorage.removeItem("clue-data"),localStorage.removeItem("mission-08-06-2025"),localStorage.removeItem("timeline-08-06"),localStorage.removeItem("old-mission-data")},[]);const[i,a]=Xc("mission-progress",0),[s,r]=Xc("user-credits",1e3),[n,o]=Xc("purchased-clues",[]),[l,c]=Xc("diary-entries",[]),[d,u]=We.useState("locked"),h=t?{id:t.id,title:t.title,totalClues:t.totalClues,foundClues:t.cluesFound,timeLimit:"48:00:00",startTime:t.startDate.toISOString(),remainingDays:t.daysRemaining,totalDays:t.totalDays,dailyLimit:50}:{id:"M001",title:"M1SSION ONE",totalClues:200,foundClues:0,timeLimit:"48:00:00",startTime:"2025-07-17T00:00:00.000Z",remainingDays:30,totalDays:30,dailyLimit:50};We.useEffect(()=>{if(t){const e=t.progressPercent;a(e),t.cluesFound,t.totalClues,t.daysRemaining,t.startDate.toISOString(),t.progressPercent,t.state}},[t,a]),We.useEffect(()=>{const e=h.remainingDays,t=h.foundClues/h.totalClues*100,a=i;if(e<=3)u("unlocked");else{const e=.4*t+.05*a;u(e<20?"locked":e<35?"partial":"near")}},[i,h.foundClues,h.totalClues,h.remainingDays]);const m=e=>{c(t=>[e,...t])};return se.jsxs("div",{className:"w-full",children:[se.jsx(et.div,{className:"mb-6 w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:se.jsx(av,{progress:i,status:d})}),se.jsx(cv,{}),se.jsx(et.div,{className:"mb-6",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.1},children:se.jsx(ov,{mission:h,purchasedClues:n,progress:i})}),se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsx(et.div,{className:"order-2 md:order-1",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:se.jsx(rv,{credits:s,onPurchaseClue:e=>{s>=e.cost?(r(t=>t-e.cost),o(t=>[...t,e]),m({type:"purchase",content:`Hai acquistato l'indizio ${e.code}: "${e.title}"`,timestamp:(new Date).toISOString()}),a(t=>Math.min(100,t+e.progressValue)),Ki.success("Indizio acquistato con successo!")):Ki.error("Crediti insufficienti per acquistare questo indizio.")}})}),se.jsx(et.div,{className:"order-3 md:order-2",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:se.jsx(nv,{entries:l,onAddNote:e=>{m({type:"note",content:e,timestamp:(new Date).toISOString()}),Ki.success("Nota aggiunta al diario")},purchasedClues:n})})]})]})}function uv(){const[e,t]=We.useState(!1),{createNotification:i}=ql();We.useEffect(()=>{const e=ba.channel("notification-updates").on("broadcast",{event:"new-notification"},e=>{if(e.payload&&"object"==typeof e.payload){const{title:t,description:a}=e.payload;t&&a&&(i(t,a),Ki.info(t,{description:a,duration:5e3}))}}).subscribe(e=>{t("SUBSCRIBED"===e)});return()=>{ba.removeChannel(e)}},[i]);return{isConnected:e,broadcastNotification:async(e,t)=>{try{return await ba.channel("notification-updates").send({type:"broadcast",event:"new-notification",payload:{title:e,description:t}})?(i(e,t),!0):(console.error("Error broadcasting notification: No response"),!1)}catch(a){return console.error("Exception when broadcasting notification:",a),!1}}}}function hv(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function mv(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}const pv=6048e5,fv=43200;let gv={};function xv(){return gv}function bv(e,t){const i=xv(),a=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0,s=hv(e),r=s.getDay(),n=(r<a?7:0)+r-a;return s.setDate(s.getDate()-n),s.setHours(0,0,0,0),s}function vv(e){return bv(e,{weekStartsOn:1})}function yv(e){const t=hv(e),i=t.getFullYear(),a=mv(e,0);a.setFullYear(i+1,0,4),a.setHours(0,0,0,0);const s=vv(a),r=mv(e,0);r.setFullYear(i,0,4),r.setHours(0,0,0,0);const n=vv(r);return t.getTime()>=s.getTime()?i+1:t.getTime()>=n.getTime()?i:i-1}function wv(e){const t=hv(e);return t.setHours(0,0,0,0),t}function Nv(e){const t=hv(e),i=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return i.setUTCFullYear(t.getFullYear()),+e-+i}function jv(e,t){const i=hv(e),a=hv(t),s=i.getTime()-a.getTime();return s<0?-1:s>0?1:s}function Sv(e){if(!(t=e,t instanceof Date||"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)||"number"==typeof e))return!1;var t;const i=hv(e);return!isNaN(Number(i))}function _v(e){const t=hv(e);return+function(e){const t=hv(e);return t.setHours(23,59,59,999),t}(t)===+function(e){const t=hv(e),i=t.getMonth();return t.setFullYear(t.getFullYear(),i+1,0),t.setHours(23,59,59,999),t}(t)}function kv(e,t){const i=hv(e),a=hv(t),s=jv(i,a),r=Math.abs(function(e,t){const i=hv(e),a=hv(t);return 12*(i.getFullYear()-a.getFullYear())+(i.getMonth()-a.getMonth())}(i,a));let n;if(r<1)n=0;else{1===i.getMonth()&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-s*r);let t=jv(i,a)===-s;_v(hv(e))&&1===r&&1===jv(e,a)&&(t=!1),n=s*(r-Number(t))}return 0===n?0:n}function Cv(e,t,i){const a=function(e,t){return+hv(e)-+hv(t)}(e,t)/1e3;return(s=i?.roundingMethod,e=>{const t=(s?Math[s]:Math.trunc)(e);return 0===t?0:t})(a);var s}const Av={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function zv(e){return(t={})=>{const i=t.width?String(t.width):e.defaultWidth;return e.formats[i]||e.formats[e.defaultWidth]}}const Ev={date:zv({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:zv({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:zv({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Iv={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Pv(e){return(t,i)=>{let a;if("formatting"===(i?.context?String(i.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,s=i?.width?String(i.width):t;a=e.formattingValues[s]||e.formattingValues[t]}else{const t=e.defaultWidth,s=i?.width?String(i.width):e.defaultWidth;a=e.values[s]||e.values[t]}return a[e.argumentCallback?e.argumentCallback(t):t]}}function Tv(e){return(t,i={})=>{const a=i.width,s=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],r=t.match(s);if(!r)return null;const n=r[0],o=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(o)?function(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return i;return}(o,e=>e.test(n)):function(e,t){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t(e[i]))return i;return}(o,e=>e.test(n));let c;c=e.valueCallback?e.valueCallback(l):l,c=i.valueCallback?i.valueCallback(c):c;return{value:c,rest:t.slice(n.length)}}}function Mv(e){return(t,i={})=>{const a=t.match(e.matchPattern);if(!a)return null;const s=a[0],r=t.match(e.parsePattern);if(!r)return null;let n=e.valueCallback?e.valueCallback(r[0]):r[0];n=i.valueCallback?i.valueCallback(n):n;return{value:n,rest:t.slice(s.length)}}}const Lv={code:"en-US",formatDistance:(e,t,i)=>{let a;const s=Av[e];return a="string"==typeof s?s:1===t?s.one:s.other.replace("{{count}}",t.toString()),i?.addSuffix?i.comparison&&i.comparison>0?"in "+a:a+" ago":a},formatLong:Ev,formatRelative:(e,t,i,a)=>Iv[e],localize:{ordinalNumber:(e,t)=>{const i=Number(e),a=i%100;if(a>20||a<10)switch(a%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},era:Pv({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Pv({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:Pv({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Pv({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Pv({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:Mv({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:Tv({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Tv({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:Tv({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Tv({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Tv({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function Fv(e){const t=hv(e),i=function(e,t){const i=wv(e),a=wv(t),s=+i-Nv(i),r=+a-Nv(a);return Math.round((s-r)/864e5)}(t,function(e){const t=hv(e),i=mv(e,0);return i.setFullYear(t.getFullYear(),0,1),i.setHours(0,0,0,0),i}(t));return i+1}function Ov(e){const t=hv(e),i=+vv(t)-+function(e){const t=yv(e),i=mv(e,0);return i.setFullYear(t,0,4),i.setHours(0,0,0,0),vv(i)}(t);return Math.round(i/pv)+1}function Dv(e,t){const i=hv(e),a=i.getFullYear(),s=xv(),r=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,n=mv(e,0);n.setFullYear(a+1,0,r),n.setHours(0,0,0,0);const o=bv(n,t),l=mv(e,0);l.setFullYear(a,0,r),l.setHours(0,0,0,0);const c=bv(l,t);return i.getTime()>=o.getTime()?a+1:i.getTime()>=c.getTime()?a:a-1}function Rv(e,t){const i=hv(e),a=+bv(i,t)-+function(e,t){const i=xv(),a=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,s=Dv(e,t),r=mv(e,0);return r.setFullYear(s,0,a),r.setHours(0,0,0,0),bv(r,t)}(i,t);return Math.round(a/pv)+1}function Bv(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const Uv={y(e,t){const i=e.getFullYear(),a=i>0?i:1-i;return Bv("yy"===t?a%100:a,t.length)},M(e,t){const i=e.getMonth();return"M"===t?String(i+1):Bv(i+1,2)},d:(e,t)=>Bv(e.getDate(),t.length),a(e,t){const i=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];default:return"am"===i?"a.m.":"p.m."}},h:(e,t)=>Bv(e.getHours()%12||12,t.length),H:(e,t)=>Bv(e.getHours(),t.length),m:(e,t)=>Bv(e.getMinutes(),t.length),s:(e,t)=>Bv(e.getSeconds(),t.length),S(e,t){const i=t.length,a=e.getMilliseconds();return Bv(Math.trunc(a*Math.pow(10,i-3)),t.length)}},qv="midnight",$v="noon",Wv="morning",Hv="afternoon",Zv="evening",Vv="night",Gv={G:function(e,t,i){const a=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return i.era(a,{width:"abbreviated"});case"GGGGG":return i.era(a,{width:"narrow"});default:return i.era(a,{width:"wide"})}},y:function(e,t,i){if("yo"===t){const t=e.getFullYear(),a=t>0?t:1-t;return i.ordinalNumber(a,{unit:"year"})}return Uv.y(e,t)},Y:function(e,t,i,a){const s=Dv(e,a),r=s>0?s:1-s;if("YY"===t){return Bv(r%100,2)}return"Yo"===t?i.ordinalNumber(r,{unit:"year"}):Bv(r,t.length)},R:function(e,t){return Bv(yv(e),t.length)},u:function(e,t){return Bv(e.getFullYear(),t.length)},Q:function(e,t,i){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return Bv(a,2);case"Qo":return i.ordinalNumber(a,{unit:"quarter"});case"QQQ":return i.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(a,{width:"narrow",context:"formatting"});default:return i.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,i){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return Bv(a,2);case"qo":return i.ordinalNumber(a,{unit:"quarter"});case"qqq":return i.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(a,{width:"narrow",context:"standalone"});default:return i.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,i){const a=e.getMonth();switch(t){case"M":case"MM":return Uv.M(e,t);case"Mo":return i.ordinalNumber(a+1,{unit:"month"});case"MMM":return i.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(a,{width:"narrow",context:"formatting"});default:return i.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,i){const a=e.getMonth();switch(t){case"L":return String(a+1);case"LL":return Bv(a+1,2);case"Lo":return i.ordinalNumber(a+1,{unit:"month"});case"LLL":return i.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(a,{width:"narrow",context:"standalone"});default:return i.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,i,a){const s=Rv(e,a);return"wo"===t?i.ordinalNumber(s,{unit:"week"}):Bv(s,t.length)},I:function(e,t,i){const a=Ov(e);return"Io"===t?i.ordinalNumber(a,{unit:"week"}):Bv(a,t.length)},d:function(e,t,i){return"do"===t?i.ordinalNumber(e.getDate(),{unit:"date"}):Uv.d(e,t)},D:function(e,t,i){const a=Fv(e);return"Do"===t?i.ordinalNumber(a,{unit:"dayOfYear"}):Bv(a,t.length)},E:function(e,t,i){const a=e.getDay();switch(t){case"E":case"EE":case"EEE":return i.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(a,{width:"short",context:"formatting"});default:return i.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,i,a){const s=e.getDay(),r=(s-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(r);case"ee":return Bv(r,2);case"eo":return i.ordinalNumber(r,{unit:"day"});case"eee":return i.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(s,{width:"short",context:"formatting"});default:return i.day(s,{width:"wide",context:"formatting"})}},c:function(e,t,i,a){const s=e.getDay(),r=(s-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(r);case"cc":return Bv(r,t.length);case"co":return i.ordinalNumber(r,{unit:"day"});case"ccc":return i.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(s,{width:"narrow",context:"standalone"});case"cccccc":return i.day(s,{width:"short",context:"standalone"});default:return i.day(s,{width:"wide",context:"standalone"})}},i:function(e,t,i){const a=e.getDay(),s=0===a?7:a;switch(t){case"i":return String(s);case"ii":return Bv(s,t.length);case"io":return i.ordinalNumber(s,{unit:"day"});case"iii":return i.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(a,{width:"short",context:"formatting"});default:return i.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,i){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(a,{width:"narrow",context:"formatting"});default:return i.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,i){const a=e.getHours();let s;switch(s=12===a?$v:0===a?qv:a/12>=1?"pm":"am",t){case"b":case"bb":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(s,{width:"narrow",context:"formatting"});default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(e,t,i){const a=e.getHours();let s;switch(s=a>=17?Zv:a>=12?Hv:a>=4?Wv:Vv,t){case"B":case"BB":case"BBB":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(s,{width:"narrow",context:"formatting"});default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(e,t,i){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),i.ordinalNumber(t,{unit:"hour"})}return Uv.h(e,t)},H:function(e,t,i){return"Ho"===t?i.ordinalNumber(e.getHours(),{unit:"hour"}):Uv.H(e,t)},K:function(e,t,i){const a=e.getHours()%12;return"Ko"===t?i.ordinalNumber(a,{unit:"hour"}):Bv(a,t.length)},k:function(e,t,i){let a=e.getHours();return 0===a&&(a=24),"ko"===t?i.ordinalNumber(a,{unit:"hour"}):Bv(a,t.length)},m:function(e,t,i){return"mo"===t?i.ordinalNumber(e.getMinutes(),{unit:"minute"}):Uv.m(e,t)},s:function(e,t,i){return"so"===t?i.ordinalNumber(e.getSeconds(),{unit:"second"}):Uv.s(e,t)},S:function(e,t){return Uv.S(e,t)},X:function(e,t,i){const a=e.getTimezoneOffset();if(0===a)return"Z";switch(t){case"X":return Kv(a);case"XXXX":case"XX":return Xv(a);default:return Xv(a,":")}},x:function(e,t,i){const a=e.getTimezoneOffset();switch(t){case"x":return Kv(a);case"xxxx":case"xx":return Xv(a);default:return Xv(a,":")}},O:function(e,t,i){const a=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Yv(a,":");default:return"GMT"+Xv(a,":")}},z:function(e,t,i){const a=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Yv(a,":");default:return"GMT"+Xv(a,":")}},t:function(e,t,i){return Bv(Math.trunc(e.getTime()/1e3),t.length)},T:function(e,t,i){return Bv(e.getTime(),t.length)}};function Yv(e,t=""){const i=e>0?"-":"+",a=Math.abs(e),s=Math.trunc(a/60),r=a%60;return 0===r?i+String(s):i+String(s)+t+Bv(r,2)}function Kv(e,t){if(e%60==0){return(e>0?"-":"+")+Bv(Math.abs(e)/60,2)}return Xv(e,t)}function Xv(e,t=""){const i=e>0?"-":"+",a=Math.abs(e);return i+Bv(Math.trunc(a/60),2)+t+Bv(a%60,2)}const Jv=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Qv=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},ey={p:Qv,P:(e,t)=>{const i=e.match(/(P+)(p+)?/)||[],a=i[1],s=i[2];if(!s)return Jv(e,t);let r;switch(a){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;default:r=t.dateTime({width:"full"})}return r.replace("{{date}}",Jv(a,t)).replace("{{time}}",Qv(s,t))}},ty=/^D+$/,iy=/^Y+$/,ay=["D","DD","YY","YYYY"];const sy=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ry=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ny=/^'([^]*?)'?$/,oy=/''/g,ly=/[a-zA-Z]/;function cy(e,t,i){const a=xv(),s=i?.locale??a.locale??Lv,r=i?.firstWeekContainsDate??i?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,n=i?.weekStartsOn??i?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,o=hv(e);if(!Sv(o))throw new RangeError("Invalid time value");let l=t.match(ry).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,ey[t])(e,s.formatLong)}return e}).join("").match(sy).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:dy(e)};if(Gv[t])return{isToken:!0,value:e};if(t.match(ly))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});s.localize.preprocessor&&(l=s.localize.preprocessor(o,l));const c={firstWeekContainsDate:r,weekStartsOn:n,locale:s};return l.map(a=>{if(!a.isToken)return a.value;const r=a.value;(!i?.useAdditionalWeekYearTokens&&function(e){return iy.test(e)}(r)||!i?.useAdditionalDayOfYearTokens&&function(e){return ty.test(e)}(r))&&function(e,t,i){const a=function(e,t,i){const a="Y"===e[0]?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${a} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(e,t,i);if(console.warn(a),ay.includes(e))throw new RangeError(a)}(r,t,String(e));return(0,Gv[r[0]])(o,r,s.localize,c)}).join("")}function dy(e){const t=e.match(ny);return t?t[1].replace(oy,"'"):e}function uy(e,t){return function(e,t,i){const a=xv(),s=i?.locale??a.locale??Lv,r=jv(e,t);if(isNaN(r))throw new RangeError("Invalid time value");const n=Object.assign({},i,{addSuffix:i?.addSuffix,comparison:r});let o,l;r>0?(o=hv(t),l=hv(e)):(o=hv(e),l=hv(t));const c=Cv(l,o),d=(Nv(l)-Nv(o))/1e3,u=Math.round((c-d)/60);let h;if(u<2)return i?.includeSeconds?c<5?s.formatDistance("lessThanXSeconds",5,n):c<10?s.formatDistance("lessThanXSeconds",10,n):c<20?s.formatDistance("lessThanXSeconds",20,n):c<40?s.formatDistance("halfAMinute",0,n):c<60?s.formatDistance("lessThanXMinutes",1,n):s.formatDistance("xMinutes",1,n):0===u?s.formatDistance("lessThanXMinutes",1,n):s.formatDistance("xMinutes",u,n);if(u<45)return s.formatDistance("xMinutes",u,n);if(u<90)return s.formatDistance("aboutXHours",1,n);if(u<1440){const e=Math.round(u/60);return s.formatDistance("aboutXHours",e,n)}if(u<2520)return s.formatDistance("xDays",1,n);if(u<fv){const e=Math.round(u/1440);return s.formatDistance("xDays",e,n)}if(u<86400)return h=Math.round(u/fv),s.formatDistance("aboutXMonths",h,n);if(h=kv(l,o),h<12){const e=Math.round(u/fv);return s.formatDistance("xMonths",e,n)}{const e=h%12,t=Math.trunc(h/12);return e<3?s.formatDistance("aboutXYears",t,n):e<9?s.formatDistance("overXYears",t,n):s.formatDistance("almostXYears",t+1,n)}}(e,function(e){return mv(e,Date.now())}(e),t)}function hy(e,t,i){return+bv(e,i)===+bv(t,i)}const my={lessThanXSeconds:{one:"meno di un secondo",other:"meno di {{count}} secondi"},xSeconds:{one:"un secondo",other:"{{count}} secondi"},halfAMinute:"alcuni secondi",lessThanXMinutes:{one:"meno di un minuto",other:"meno di {{count}} minuti"},xMinutes:{one:"un minuto",other:"{{count}} minuti"},aboutXHours:{one:"circa un'ora",other:"circa {{count}} ore"},xHours:{one:"un'ora",other:"{{count}} ore"},xDays:{one:"un giorno",other:"{{count}} giorni"},aboutXWeeks:{one:"circa una settimana",other:"circa {{count}} settimane"},xWeeks:{one:"una settimana",other:"{{count}} settimane"},aboutXMonths:{one:"circa un mese",other:"circa {{count}} mesi"},xMonths:{one:"un mese",other:"{{count}} mesi"},aboutXYears:{one:"circa un anno",other:"circa {{count}} anni"},xYears:{one:"un anno",other:"{{count}} anni"},overXYears:{one:"pi di un anno",other:"pi di {{count}} anni"},almostXYears:{one:"quasi un anno",other:"quasi {{count}} anni"}},py={date:zv({formats:{full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},defaultWidth:"full"}),time:zv({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:zv({formats:{full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},defaultWidth:"full"})},fy=["domenica","luned","marted","mercoled","gioved","venerd","sabato"];function gy(e){return"'"+fy[e]+" alle' p"}const xy={lastWeek:(e,t,i)=>{const a=e.getDay();return hy(e,t,i)?gy(a):function(e){return 0===e?"'domenica scorsa alle' p":"'"+fy[e]+" scorso alle' p"}(a)},yesterday:"'ieri alle' p",today:"'oggi alle' p",tomorrow:"'domani alle' p",nextWeek:(e,t,i)=>{const a=e.getDay();return hy(e,t,i)?gy(a):function(e){return 0===e?"'domenica prossima alle' p":"'"+fy[e]+" prossimo alle' p"}(a)},other:"P"},by={code:"it",formatDistance:(e,t,i)=>{let a;const s=my[e];return a="string"==typeof s?s:1===t?s.one:s.other.replace("{{count}}",t.toString()),i?.addSuffix?i.comparison&&i.comparison>0?"tra "+a:a+" fa":a},formatLong:py,formatRelative:(e,t,i,a)=>{const s=xy[e];return"function"==typeof s?s(t,i,a):s},localize:{ordinalNumber:(e,t)=>{const i=Number(e);return String(i)},era:Pv({values:{narrow:["aC","dC"],abbreviated:["a.C.","d.C."],wide:["avanti Cristo","dopo Cristo"]},defaultWidth:"wide"}),quarter:Pv({values:{narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1 trimestre","2 trimestre","3 trimestre","4 trimestre"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:Pv({values:{narrow:["G","F","M","A","M","G","L","A","S","O","N","D"],abbreviated:["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],wide:["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"]},defaultWidth:"wide"}),day:Pv({values:{narrow:["D","L","M","M","G","V","S"],short:["dom","lun","mar","mer","gio","ven","sab"],abbreviated:["dom","lun","mar","mer","gio","ven","sab"],wide:["domenica","luned","marted","mercoled","gioved","venerd","sabato"]},defaultWidth:"wide"}),dayPeriod:Pv({values:{narrow:{am:"m.",pm:"p.",midnight:"mezzanotte",noon:"mezzogiorno",morning:"mattina",afternoon:"pomeriggio",evening:"sera",night:"notte"},abbreviated:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"mattina",afternoon:"pomeriggio",evening:"sera",night:"notte"},wide:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"mattina",afternoon:"pomeriggio",evening:"sera",night:"notte"}},defaultWidth:"wide",formattingValues:{narrow:{am:"m.",pm:"p.",midnight:"mezzanotte",noon:"mezzogiorno",morning:"di mattina",afternoon:"del pomeriggio",evening:"di sera",night:"di notte"},abbreviated:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"di mattina",afternoon:"del pomeriggio",evening:"di sera",night:"di notte"},wide:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"di mattina",afternoon:"del pomeriggio",evening:"di sera",night:"di notte"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:Mv({matchPattern:/^(\d+)()?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:Tv({matchPatterns:{narrow:/^(aC|dC)/i,abbreviated:/^(a\.?\s?C\.?|a\.?\s?e\.?\s?v\.?|d\.?\s?C\.?|e\.?\s?v\.?)/i,wide:/^(avanti Cristo|avanti Era Volgare|dopo Cristo|Era Volgare)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^a/i,/^(d|e)/i]},defaultParseWidth:"any"}),quarter:Tv({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^t[1234]/i,wide:/^[1234]()? trimestre/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:Tv({matchPatterns:{narrow:/^[gfmalsond]/i,abbreviated:/^(gen|feb|mar|apr|mag|giu|lug|ago|set|ott|nov|dic)/i,wide:/^(gennaio|febbraio|marzo|aprile|maggio|giugno|luglio|agosto|settembre|ottobre|novembre|dicembre)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^g/i,/^f/i,/^m/i,/^a/i,/^m/i,/^g/i,/^l/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ge/i,/^f/i,/^mar/i,/^ap/i,/^mag/i,/^gi/i,/^l/i,/^ag/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Tv({matchPatterns:{narrow:/^[dlmgvs]/i,short:/^(do|lu|ma|me|gi|ve|sa)/i,abbreviated:/^(dom|lun|mar|mer|gio|ven|sab)/i,wide:/^(domenica|luned[i|]|marted[i|]|mercoled[i|]|gioved[i|]|venerd[i|]|sabato)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^g/i,/^v/i,/^s/i],any:[/^d/i,/^l/i,/^ma/i,/^me/i,/^g/i,/^v/i,/^s/i]},defaultParseWidth:"any"}),dayPeriod:Tv({matchPatterns:{narrow:/^(a|m\.|p|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i,any:/^([ap]\.?\s?m\.?|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mezza/i,noon:/^mezzo/i,morning:/mattina/i,afternoon:/pomeriggio/i,evening:/sera/i,night:/notte/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:4}},vy=({notification:e,onSelect:t,onDelete:i})=>{const[a,s]=We.useState(!1),r=uy(new Date(e.date),{addSuffix:!0,locale:by}),n=new Date(e.date).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return se.jsxs(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{s(!a),e.read||t()},className:"rounded-[20px] bg-[#1C1C1F] backdrop-blur-md cursor-pointer transition-all duration-300 relative overflow-hidden",style:{background:e.read?"linear-gradient(135deg, #1C1C1F 0%, rgba(28, 28, 31, 0.8) 100%)":"linear-gradient(135deg, #1C1C1F 0%, rgba(28, 28, 31, 0.95) 50%, rgba(54, 94, 255, 0.15) 100%)",boxShadow:e.read?"0 2px 8px rgba(0, 0, 0, 0.15)":"0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[!e.read&&se.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px]",style:{background:"linear-gradient(90deg, #FC1EFF 0%, #365EFF 50%, #FACC15 100%)"}}),se.jsxs("div",{className:"p-6",children:[se.jsxs("div",{className:"flex justify-between items-start",children:[se.jsxs("div",{className:"flex-1 min-w-0",children:[se.jsx("h3",{className:"text-base font-medium font-orbitron "+(e.read?"text-white/70":"text-white"),children:e.title}),!a&&se.jsx("p",{className:"mt-2 text-sm text-white/60 line-clamp-2",children:e.description})]}),se.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[se.jsx("span",{className:"text-xs text-white/40",children:r}),se.jsx(et.div,{animate:{rotate:a?180:0},transition:{duration:.3},children:se.jsx(ls,{className:"w-4 h-4 text-white/60"})})]})]}),se.jsx(tt,{children:a&&se.jsx(et.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.4,ease:"easeInOut"},className:"overflow-hidden mt-4",children:se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"p-4 rounded-[16px] bg-[#0a0a0a]/50",children:[se.jsx("h4",{className:"text-sm font-medium text-white/80 mb-2 font-orbitron",children:"Contenuto completo"}),se.jsx("p",{className:"text-white/70 text-sm leading-relaxed whitespace-pre-wrap",children:e.description})]}),se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[se.jsxs("div",{className:"p-4 rounded-[16px] bg-[#0a0a0a]/30",children:[se.jsx("span",{className:"text-xs font-medium text-white/60 font-orbitron",children:"Data completa"}),se.jsx("p",{className:"text-sm text-white/80 mt-1",children:n})]}),se.jsxs("div",{className:"p-4 rounded-[16px] bg-[#0a0a0a]/30",children:[se.jsx("span",{className:"text-xs font-medium text-white/60 font-orbitron",children:"Stato"}),se.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[se.jsx("span",{className:"text-sm "+(e.read?"text-green-400":"text-yellow-400"),children:e.read?"Letta":"Non letta"}),!e.read&&se.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"})]})]})]}),se.jsxs("div",{className:"flex items-center justify-between pt-2",children:[se.jsx("div",{className:"flex items-center space-x-2",children:!e.read&&se.jsx("button",{onClick:e=>{e.stopPropagation(),t()},className:"px-4 py-2 bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white rounded-full text-xs hover:shadow-lg transition-all font-orbitron",children:"Segna come letta"})}),se.jsx("button",{onClick:e=>{e.stopPropagation(),i()},className:"p-2 rounded-full hover:bg-white/10 transition-colors",title:"Elimina notifica",children:se.jsx(Ar,{size:16,className:"text-red-400 hover:text-red-300"})})]})]})})})]})]})},yy=({notification:e,open:t,onClose:i})=>{if(!e)return null;const a=uy(new Date(e.date),{addSuffix:!0,locale:by});return se.jsx(to,{open:t,onOpenChange:i,children:se.jsxs(io,{className:"max-w-md bg-black border border-[#00D1FF]/30 rounded-[24px] shadow-[0_0_20px_rgba(0,209,255,0.2)]",children:[se.jsx(ao,{children:se.jsx(so,{className:"text-lg font-bold text-[#00D1FF]",style:{textShadow:"0 0 5px rgba(0, 209, 255, 0.3)"},children:e.title})}),se.jsxs("div",{className:"mt-4",children:[se.jsx("p",{className:"text-white/90 text-base leading-relaxed",children:e.description}),se.jsx("p",{className:"text-sm text-[#00D1FF]/60 mt-4",children:a})]})]})})},wy=({open:e,notifications:t,unreadCount:i,onClose:a,onMarkAllAsRead:s,onDeleteNotification:r})=>{const n=We.useRef(null),o=We.useRef(!1),l=We.useRef(null),[c,d]=We.useState(null);We.useEffect(()=>{const t=n.current;function i(e){l.current=e.touches[0].clientY,o.current=!0}function s(e){if(!o.current||null==l.current)return;l.current-e.touches[0].clientY>64&&(a(),o.current=!1,l.current=null)}function r(){o.current=!1,l.current=null}function c(e){l.current=e.clientY,o.current=!0}function d(e){if(!o.current||null==l.current)return;l.current-e.clientY>64&&(a(),o.current=!1,l.current=null)}function u(){o.current=!1,l.current=null}return t&&e&&(t.addEventListener("touchstart",i,{passive:!0}),t.addEventListener("touchmove",s,{passive:!0}),t.addEventListener("touchend",r),t.addEventListener("mousedown",c),window.addEventListener("mousemove",d),window.addEventListener("mouseup",u)),()=>{t&&(t.removeEventListener("touchstart",i),t.removeEventListener("touchmove",s),t.removeEventListener("touchend",r),t.removeEventListener("mousedown",c)),window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",u)}},[e,a]);return se.jsxs("div",{ref:n,className:"fixed left-0 right-0 z-[9999] flex justify-center transition-all duration-500 cursor-grab select-none "+(e?"translate-y-0 opacity-100":"-translate-y-32 opacity-0 pointer-events-none"),style:{top:"env(safe-area-inset-top, 0px)",transitionProperty:"transform, opacity"},children:[se.jsxs("div",{className:"relative w-full max-w-lg mx-auto bg-black/95 backdrop-blur-xl border border-m1ssion-blue rounded-b-2xl shadow-2xl mt-2 px-4 py-4 animate-fade-in",children:[se.jsxs("div",{className:"flex items-center mb-2",children:[se.jsx(Xa,{className:"w-5 h-5 text-m1ssion-blue mr-2"}),se.jsx("span",{className:"font-bold text-lg flex-1",children:"Notifiche"}),se.jsx("button",{className:"text-m1ssion-blue hover:text-m1ssion-pink rounded-full p-1 ml-2 border border-m1ssion-blue hover:bg-m1ssion-blue/20 transition-colors",onClick:a,"aria-label":"Chiudi",children:se.jsx($r,{className:"w-5 h-5"})})]}),0===t.length?se.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Non hai notifiche."}):se.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 pr-1 custom-scrollbar",children:t.map(e=>se.jsx(vy,{notification:e,onSelect:()=>(e=>{d(e)})(e),onDelete:()=>r(e.id)},e.id))}),t.length>0&&i>0&&se.jsx("div",{className:"text-center mt-3",children:se.jsx("button",{onClick:s,className:"text-xs px-3 py-1 rounded-lg border border-m1ssion-blue hover:bg-m1ssion-blue/10 transition active:scale-95",children:"Segna tutte come lette"})}),se.jsxs("div",{className:"mt-2 text-xs text-muted-foreground text-center",children:["Chiudi con ",se.jsx("b",{children:"Swipe Up"})," su mobile/tablet o trascina con il mouse."]})]}),se.jsx(yy,{notification:c,open:!!c,onClose:()=>d(null)})]})},Ny=()=>(Ze.useEffect(()=>{window.location.href="/login"},[]),se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-black",children:se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"text-white text-lg mb-4",children:"Reindirizzamento al login..."}),se.jsx("div",{className:"text-white/60 text-sm",children:"Sistema di login unificato attivo"})]})})),jy=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;function Sy(){const[,e]=Ai();We.useEffect(()=>{try{const t=new URLSearchParams(window.location.search),i=t.get("qr")?.trim();if(!i)return;(async()=>{let t=i;if(jy.test(i)){const{data:e,error:a}=await ba.from("qr_codes").select("code").eq("id",i).maybeSingle();if(a)return void console.warn("[useDeepLinkQR] UUID lookup error",a);if(!e?.code)return;t=e.code}t=t.toUpperCase(),e("/map");const a=new URL(window.location.href);a.searchParams.delete("qr"),window.history.replaceState({},document.title,a.toString())})()}catch(t){console.warn("[useDeepLinkQR] init error",t)}},[e])}const _y=()=>{const[e,t]=We.useState(null),[i,a]=We.useState(!1);Qc();const s=sv(),[r,n]=We.useState(!1),[o,l]=We.useState(!1),{hasRole:c,user:d,isAuthenticated:u,isLoading:h,getCurrentUser:m}=bl(),[,p]=Ai(),{notifications:f,unreadCount:g,markAllAsRead:x,deleteNotification:b,notificationsBannerOpen:v,closeNotificationsBanner:y}=ql(),{isConnected:w}=uv();if(Sy(),We.useEffect(()=>{(()=>{const e=!!window.Capacitor;l(e),n(!0)})()},[]),We.useEffect(()=>{const e=setTimeout(()=>{a(!0)},300);return()=>clearTimeout(e)},[]),We.useEffect(()=>{},[w]),We.useEffect(()=>{e&&Ki.error("Si  verificato un errore",{description:e,position:"bottom-center"})},[e]),!u||h)return se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#070818]",children:se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"w-8 h-8 border-t-2 border-cyan-400 rounded-full animate-spin mx-auto mb-4"}),se.jsx("p",{className:"text-white/70",children:"Caricamento..."})]})});if(!d)return se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#070818]",children:se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"w-8 h-8 border-t-2 border-cyan-400 rounded-full animate-spin mx-auto mb-4"}),se.jsx("p",{className:"text-white/70",children:"Inizializzazione utente..."})]})});const N=c("admin"),j=c("developer"),S=N||j;return s&&!r?se.jsx(Ny,{}):e?se.jsx("div",{className:"flex min-h-screen items-center justify-center bg-[#070818] px-4",children:se.jsxs("div",{className:"p-8 bg-red-800/30 rounded-xl text-center w-full max-w-sm glass-card",children:[se.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-4 text-red-300",children:"Errore"}),se.jsx("p",{className:"text-white/80",children:e}),se.jsx(et.button,{onClick:()=>window.location.reload(),className:"mt-6 px-6 py-2 bg-gradient-to-r from-red-600 to-red-700 rounded-full text-white btn-hover-effect",whileHover:{scale:1.03},whileTap:{scale:.97},children:"Riprova"})]})}):se.jsxs("div",{className:"min-h-screen",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION - Home App"})}),se.jsx("div",{className:"px-4 space-y-6",children:se.jsx(tt,{children:i&&se.jsxs(et.div,{className:"relative min-h-screen overflow-y-auto",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[v&&se.jsx(et.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"fixed inset-x-0 z-40 px-2 md:px-4",style:{top:"calc(72px + 47px + env(safe-area-inset-top, 0px))"},children:se.jsx(wy,{notifications:f,open:v,unreadCount:g,onClose:y,onMarkAllAsRead:x,onDeleteNotification:b})}),se.jsxs("div",{className:"container mx-auto px-3 pb-20",children:[se.jsxs(et.div,{className:"text-center my-6",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:[se.jsxs("h1",{className:"text-4xl font-orbitron font-bold",role:"banner","aria-label":"M1SSION Centro di Comando Agente",children:[se.jsx("span",{className:"text-[#00D1FF]",style:{textShadow:"0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"},children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]})]}),se.jsx("p",{className:"text-gray-400 mt-2",children:"Centro di Comando Agente"})]}),se.jsxs("main",{id:"main-content",className:"max-w-screen-xl mx-auto",role:"main","aria-label":"Contenuto principale",children:[se.jsx("div",{children:se.jsx(dv,{})}),S&&se.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.6},className:"mt-4",children:se.jsxs(et.button,{onClick:()=>p("/panel-access"),className:"w-full glass-card p-4 border border-[#4361ee]/30 bg-gradient-to-r from-[#4361ee]/10 to-[#7209b7]/10 rounded-xl group relative overflow-hidden",whileHover:{scale:1.02,borderColor:"rgba(67, 97, 238, 0.6)"},whileTap:{scale:.98},children:[se.jsx("div",{className:"absolute inset-0 rounded-xl border border-[#4361ee]/50 animate-pulse group-hover:border-[#4361ee]/80 transition-colors"}),se.jsxs("div",{className:"relative flex items-center justify-center gap-3",children:[se.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(Ns,{className:"w-5 h-5 text-white"})}),se.jsxs("div",{className:"text-left",children:[se.jsxs("h3",{className:"text-lg font-orbitron font-bold",children:[se.jsx("span",{className:"text-[#4361ee]",children:"M1SSION"}),se.jsx("span",{className:"text-white",children:" PANEL"}),se.jsx("span",{className:"text-xs align-top text-[#7209b7]",children:""})]}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Centro AI Generativo - Accesso Test"})]}),se.jsx("div",{className:"ml-auto",children:se.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"})})]}),se.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-[#4361ee]/0 via-[#4361ee]/5 to-[#7209b7]/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})})]})]})]})})})]})},ky=({children:e})=>se.jsxs("div",{className:"bg-gradient-to-b from-[#131524]/70 to-black w-full",style:{height:"100dvh",overflow:"hidden",position:"relative"},children:[se.jsx("main",{id:"map-scroll-container",style:{paddingTop:"calc(72px + env(safe-area-inset-top, 47px) + 60px)",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px) + 40px)",height:"100dvh",overflowY:"auto",position:"relative",zIndex:0},children:se.jsx("div",{className:"container mx-auto px-4 pt-4 pb-2 max-w-6xl",children:e})}),se.jsx("div",{id:"mission-bottom-nav-container",style:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1e4,isolation:"isolate",transform:"translateZ(0)",willChange:"transform",display:"block",visibility:"visible",opacity:1},children:se.jsx(sd,{})})]}),Cy=We.forwardRef(({className:e,size:t="md",...i},a)=>se.jsx("div",{ref:a,className:eo("animate-spin rounded-full border-2 border-gray-300 border-t-2 border-t-gray-900 dark:border-gray-600 dark:border-t-gray-300",{sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"}[t],e),...i}));Cy.displayName="Spinner";const Ay=()=>se.jsx("div",{className:"h-96 bg-gray-900/50 rounded-lg flex items-center justify-center",children:se.jsxs("div",{className:"flex flex-col items-center gap-4",children:[se.jsx(Cy,{size:"lg",className:"text-[#00D1FF]"}),se.jsx("p",{className:"text-gray-400",children:"Caricamento mappa..."})]})});var zy=Object.defineProperty,Ey=(e,t,i)=>((e,t,i)=>t in e?zy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Iy{async getWeather(e,t){const i=(new Date).getHours();let a="clear",s=.5;return i>=20||i<6?(a="night",s=.8):i>=12&&i<16?(a="hot",s=.6):Math.random()>.7&&(a=Math.random()>.5?"rain":"fog",s=.7),{mood:a,intensity:s,timestamp:(new Date).toISOString()}}}const Py=new class{constructor(){Ey(this,"provider"),Ey(this,"cache",new Map),Ey(this,"cacheDuration",9e5),this.provider=new Iy}async getWeatherMood(e,t){const i=`${e.toFixed(2)},${t.toFixed(2)}`,a=this.cache.get(i);if(a&&a.expires>Date.now())return a.data.mood;try{const a=await this.provider.getWeather(e,t);return this.cache.set(i,{data:a,expires:Date.now()+this.cacheDuration}),a.mood}catch(s){return console.error(" Weather fetch failed:",s),"clear"}}async getWeatherData(e,t){const i=`${e.toFixed(2)},${t.toFixed(2)}`,a=this.cache.get(i);if(a&&a.expires>Date.now())return a.data;try{const a=await this.provider.getWeather(e,t);return this.cache.set(i,{data:a,expires:Date.now()+this.cacheDuration}),a}catch(s){return console.error(" Weather fetch failed:",s),{mood:"clear",intensity:.5,timestamp:(new Date).toISOString()}}}};var Ty=Object.defineProperty,My=(e,t,i)=>((e,t,i)=>t in e?Ty(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,t+"",i);const Ly=new class{constructor(){My(this,"state",{fog:{enabled:!1,intensity:0},rain:{enabled:!1,intensity:0},heat:{enabled:!1,intensity:0},night:{enabled:!1,intensity:0},ripple:null})}applyWeatherMood(e,t=.7){switch(this.state={fog:{enabled:!1,intensity:0},rain:{enabled:!1,intensity:0},heat:{enabled:!1,intensity:0},night:{enabled:!1,intensity:0},ripple:this.state.ripple},e){case"fog":this.state.fog={enabled:!0,intensity:t};break;case"rain":this.state.rain={enabled:!0,intensity:t};break;case"hot":this.state.heat={enabled:!0,intensity:t};break;case"night":this.state.night={enabled:!0,intensity:t};break;case"storm":this.state.rain={enabled:!0,intensity:Math.min(1,1.2*t)},this.state.fog={enabled:!0,intensity:.5*t}}return{...this.state}}triggerRipple(e,t){this.state.ripple={active:!0,lat:e,lng:t,timestamp:Date.now()},setTimeout(()=>{this.state.ripple&&this.state.ripple.timestamp===Date.now()-3e3&&(this.state.ripple=null)},3e3)}clearRipple(){this.state.ripple=null}getState(){return{...this.state}}getFogBlur(){return this.state.fog.enabled?2+4*this.state.fog.intensity:0}getRainDropCount(){return this.state.rain.enabled?Math.floor(50+100*this.state.rain.intensity):0}getHeatShimmer(){return this.state.heat.enabled?3*this.state.heat.intensity:0}getNightOpacity(){return this.state.night.enabled?.3+.4*this.state.night.intensity:0}},Fy=({mode:e="auto",center:t={lat:43.7874,lng:7.6326},onEffectsChange:i})=>{const[a,s]=We.useState(Ly.getState()),[r,n]=We.useState("3d"===e),o=We.useRef(null),l=We.useRef(null);return We.useEffect(()=>{const e=async()=>{const e=await Py.getWeatherMood(t.lat,t.lng),a=Ly.applyWeatherMood(e);s(a),i?.(a)};e();const a=setInterval(e,9e5);return()=>clearInterval(a)},[t.lat,t.lng,i]),We.useEffect(()=>{if(!a.rain.enabled||!o.current)return;const e=o.current,t=e.getContext("2d");if(!t)return;const i=()=>{e.width=window.innerWidth,e.height=window.innerHeight};i(),window.addEventListener("resize",i);const s=[],r=Ly.getRainDropCount();for(let a=0;a<r;a++)s.push({x:Math.random()*e.width,y:Math.random()*e.height,speed:2+3*Math.random(),length:10+20*Math.random()});const n=()=>{t.clearRect(0,0,e.width,e.height),t.strokeStyle=`rgba(200, 220, 255, ${.6*a.rain.intensity})`,t.lineWidth=1,s.forEach(i=>{t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(i.x,i.y+i.length),t.stroke(),i.y+=i.speed,i.y>e.height&&(i.y=-i.length,i.x=Math.random()*e.width)}),l.current=requestAnimationFrame(n)};return n(),()=>{l.current&&cancelAnimationFrame(l.current),window.removeEventListener("resize",i)}},[a.rain.enabled,a.rain.intensity]),We.useEffect(()=>{n("3d"===e)},[e]),se.jsxs("div",{className:"living-map-overlay",children:[a.fog.enabled&&se.jsx("div",{className:"living-effect-fog",style:{backdropFilter:`blur(${Ly.getFogBlur()}px)`,opacity:a.fog.intensity}}),a.rain.enabled&&se.jsx("canvas",{ref:o,className:"living-effect-rain",style:{opacity:a.rain.intensity}}),a.heat.enabled&&se.jsx("div",{className:"living-effect-heat",style:{opacity:a.heat.intensity,filter:"url(#heat-distortion)"}}),a.night.enabled&&se.jsx("div",{className:"living-effect-night",style:{opacity:Ly.getNightOpacity()}}),a.ripple&&a.ripple.active&&se.jsxs("div",{className:"living-effect-ripple",children:[se.jsx("div",{className:"ripple-circle"}),se.jsx("div",{className:"ripple-circle ripple-delay-1"}),se.jsx("div",{className:"ripple-circle ripple-delay-2"})]}),se.jsx("svg",{style:{display:"none"},children:se.jsxs("filter",{id:"heat-distortion",children:[se.jsx("feTurbulence",{type:"fractalNoise",baseFrequency:"0.02",numOctaves:"3",result:"noise",seed:"2"}),se.jsx("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:Ly.getHeatShimmer(),xChannelSelector:"R",yChannelSelector:"G"})]})})]})},Oy="m1_3d",Dy=({onChange:e,disabled:t=!1})=>{const[i,a]=We.useState(()=>"true"===localStorage.getItem(Oy));We.useEffect(()=>{localStorage.setItem(Oy,i.toString()),e?.(i)},[i,e]);return se.jsx(mo,{variant:i?"default":"outline",size:"sm",onClick:()=>{if(t)return void Ki.warning("3D non disponibile",{description:"Terrain layer non configurato",duration:2e3});const e=!i;a(e),e?Ki.success("Modalit 3D Terrain attivata",{duration:2e3}):Ki.info("Modalit 2D attivata",{duration:2e3})},disabled:t,className:"map-dock-button w-11 h-11 p-0",title:t?"3D non disponibile":i?"Passa a 2D":"Passa a 3D Terrain",children:i?se.jsx(es,{className:"w-5 h-5"}):se.jsx(Ks,{className:"w-5 h-5"})})},Ry=({onToggle3D:e,is3DEnabled:t=!1,onFocus:i,onReset:a,onBuzz:s,onLayerChange:r,terrain3DAvailable:n=!1})=>se.jsxs("div",{className:"map-dock",children:[se.jsx(Dy,{onChange:t=>{e&&e(t)},disabled:!n}),se.jsx(mo,{variant:"outline",size:"sm",onClick:i,className:"map-dock-button w-11 h-11 p-0",title:"Centra su posizione",children:se.jsx(Ss,{className:"w-5 h-5"})}),se.jsx(mo,{variant:"outline",size:"sm",onClick:a,className:"map-dock-button w-11 h-11 p-0",title:"Reset vista",children:se.jsx(hr,{className:"w-5 h-5"})})]}),By=({portalCount:e=12,onPortalAction:t})=>{const[i,a]=We.useState(!1),s=[{id:"all",label:"All Portals",icon:kr,color:"from-cyan-500 to-purple-600"}],[r,n]=We.useState(new Set(["ALL"])),o=()=>{a(!i)};return se.jsxs(se.Fragment,{children:[!i&&se.jsxs("button",{onClick:o,className:"portal-pill-centered","aria-label":"Open PORTALS menu",children:[se.jsx("span",{className:"portal-pill-label",children:"PORTALS"}),se.jsx("span",{className:"portal-pill-badge",children:e})]}),i&&se.jsxs("div",{className:"portal-drawer-centered",children:[se.jsxs("div",{className:"portal-drawer-header",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"portal-drawer-title",children:"PORTALS"}),se.jsx("span",{className:"portal-drawer-badge",children:e})]}),se.jsx(mo,{variant:"ghost",size:"sm",onClick:o,className:"portal-drawer-close","aria-label":"Close PORTALS menu",children:se.jsx($r,{className:"w-4 h-4"})})]}),se.jsx("div",{className:"portal-drawer-grid",children:s.map(e=>{const i=e.icon,a=r.has("ALL");return se.jsxs("button",{onClick:()=>(e=>{t?.(e);const i=new Set(r),a="ALL";i.has(a)?i.delete(a):(i.clear(),i.add(a)),n(i);const s=i.has(a),o=new CustomEvent("M1_PORTAL_FILTER",{detail:{type:"ALL",enabled:s}});window.dispatchEvent(o)})(e.id),className:"portal-button "+(a?"portal-button-active":""),"data-portal-type":e.id,"aria-label":"Toggle all portals","aria-pressed":a,children:[se.jsx("div",{className:`portal-button-gradient bg-gradient-to-br ${e.color} ${a?"opacity-100":"opacity-50"}`,children:se.jsx(i,{className:"w-5 h-5"})}),se.jsx("span",{className:"portal-button-label",children:e.label})]},e.id)})}),se.jsx("div",{className:"portal-drawer-footer",children:se.jsx("p",{className:"text-xs text-cyan-400/60",children:"Click per mostrare/nascondere tutti i portali"})})]})]})},Uy=({onLayerChange:e,layerCounts:t,agentsVisibleCount:i})=>{const[a,s]=We.useState(!1),[r,n]=We.useState([{id:"portals",label:"PORTALS",count:12,enabled:!0},{id:"events",label:"EVENTS",count:3,enabled:!0},{id:"agents",label:"AGENTS",count:5,enabled:!0},{id:"zones",label:"ZONES",count:2,enabled:!0}]),[o,l]=We.useState(0),[c,d]=We.useState(0);We.useEffect(()=>{const e=e=>{const{visible:t,online:i}=e.detail;l(t),d(i),n(e=>e.map(e=>"agents"===e.id?{...e,count:i}:e))};return window.addEventListener("M1_AGENTS_COUNT_UPDATE",e),()=>window.removeEventListener("M1_AGENTS_COUNT_UPDATE",e)},[]),We.useEffect(()=>{t&&n(e=>e.map(e=>({...e,count:t[e.id]})))},[t]);return se.jsxs("div",{className:"living-layers-container",children:[!a&&se.jsxs("button",{onClick:()=>s(e=>!e),className:"living-layers-pill","aria-label":"Toggle LIVING LAYERS","aria-expanded":a,children:[se.jsx($s,{className:"w-4 h-4"}),se.jsx("span",{className:"living-layers-pill-label",children:"LIVING LAYERS"})]}),a&&se.jsxs("div",{className:"living-layers-panel",children:[se.jsxs("div",{className:"flex items-center justify-between mb-4",children:[se.jsx("h3",{className:"text-sm font-orbitron font-bold text-cyan-400 cursor-pointer select-none",onClick:()=>s(!1),role:"button","aria-label":"Close LIVING LAYERS",children:"LIVING LAYERS"}),se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>s(!1),className:"h-6 w-6 p-0",children:se.jsx($r,{className:"w-4 h-4"})})]}),se.jsx("div",{className:"space-y-3",children:r.map(t=>se.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-white/5 hover:bg-white/10 transition-colors",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-xs font-medium text-white/90",children:t.label}),void 0!==t.count&&se.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400",children:"agents"===t.id?`${o}/${c}`:t.count})]}),se.jsx(rd,{checked:t.enabled,onCheckedChange:()=>{return i=t.id,void n(t=>t.map(t=>{if(t.id===i){const a=!t.enabled;e?.(i,a),document.querySelectorAll(`[data-layer="${i}"]`).forEach(e=>{a?e.classList.remove("is-hidden"):e.classList.add("is-hidden")});const s=new CustomEvent("M1_LAYER_TOGGLE",{detail:{layer:i,enabled:a}});return window.dispatchEvent(s),{...t,enabled:a}}return t}));var i},className:"scale-75"})]},t.id))})]})]})},qy=We.lazy(()=>ae(()=>import("./MapContainer.BzLlMbY9.js"),__vite__mapDeps([4,5,3,2,6,7,0,1,8,9,10]))),$y=({isAddingPoint:e,setIsAddingPoint:t,addNewPoint:i,mapPoints:a,activeMapPoint:s,setActiveMapPoint:r,updateMapPoint:n,deleteMapPoint:o,newPoint:l,savePoint:c,handleBuzz:d,requestLocationPermission:u,isAddingSearchArea:h,handleMapClickArea:m,searchAreas:p,setActiveSearchArea:f,deleteSearchArea:g,setPendingRadius:x,toggleAddingSearchArea:b,showHelpDialog:v,setShowHelpDialog:y,onToggle3D:w,onFocusLocation:N,onResetView:j,onRegisterToggle3D:S,onRegisterFocusLocation:_,onRegisterResetView:k})=>{const C=Ze.useRef(null),A=Ze.useCallback(e=>{C.current=e,S&&S(e)},[S]),z=Ze.useCallback(e=>{C.current&&C.current(e),w&&w(e)},[w]);return se.jsxs("div",{className:"m1ssion-glass-card p-4 sm:p-6 mb-6 m1-dock-enabled",style:{marginTop:"20px"},children:[se.jsxs("div",{className:"text-center mb-6",children:[se.jsxs("h1",{className:"text-2xl font-orbitron font-bold mb-1",children:[se.jsx("span",{className:"text-[#00ffff]",children:"BUZZ"}),se.jsx("span",{className:"text-white",children:" MAP"})]}),se.jsx("h2",{className:"text-base text-white/80 font-medium",children:"Mappa Operativa"})]}),se.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-white/10",style:{minHeight:"400px",marginTop:"0px"},children:[se.jsx(Fy,{mode:"auto"}),se.jsx(By,{portalCount:12,onPortalAction:e=>console.log(" Portal filter:",e)}),se.jsx(Uy,{}),se.jsx(Ry,{onToggle3D:z,onFocus:N,onReset:j,onBuzz:d,terrain3DAvailable:!0}),se.jsx(We.Suspense,{fallback:se.jsx(Ay,{}),children:se.jsx(qy,{isAddingPoint:e,setIsAddingPoint:t,addNewPoint:i,mapPoints:a.map(e=>({id:e.id,lat:e.latitude,lng:e.longitude,title:e.title,note:e.note,position:{lat:e.latitude,lng:e.longitude}})),activeMapPoint:s,setActiveMapPoint:r,handleUpdatePoint:n,deleteMapPoint:o,newPoint:l,handleSaveNewPoint:c,handleCancelNewPoint:()=>{c("","")},handleBuzz:d,requestLocationPermission:u,isAddingSearchArea:h,handleMapClickArea:m,searchAreas:p,setActiveSearchArea:f,deleteSearchArea:g,setPendingRadius:x,toggleAddingSearchArea:b,showHelpDialog:v,setShowHelpDialog:y,onToggle3D:A,onFocusLocation:_,onResetView:k})})]})]})},Wy=e=>{switch(e){case"high":return"bg-gradient-to-r from-red-500 to-pink-500";case"medium":default:return"bg-gradient-to-r from-cyan-500 to-blue-500";case"low":return"bg-gradient-to-r from-green-500 to-emerald-500"}},Hy=({notes:e,onImportanceClick:t,onEditNote:i,onDeleteNote:a})=>0===e.length?se.jsxs("div",{className:"text-center p-4 border border-dashed border-gray-600 rounded-[24px] text-gray-400",children:[se.jsx("p",{children:"Nessuna nota"}),se.jsx("p",{className:"text-sm mt-1",children:"Clicca sul pulsante '+' per aggiungere una nota"})]}):se.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto pr-2",children:e.map(e=>se.jsx("div",{className:"note-box bg-[#0b0b0b] border-[1px] border-cyan-500/20 rounded-[24px] p-4 transition-all hover:border-cyan-500/40",style:{boxShadow:"0 0 6px rgba(0, 255, 255, 0.15)"},children:se.jsxs("div",{className:"flex items-start gap-3",children:[se.jsx("div",{className:`w-3 h-3 rounded-full mt-1.5 cursor-pointer flex-shrink-0 ${Wy(e.importance)}`,onClick:()=>t(e.id),title:"Cambia priorit"}),se.jsx("div",{className:"flex-1",children:se.jsx("p",{className:"text-white break-words",children:e.note})}),se.jsxs("div",{className:"flex gap-1 ml-2 flex-shrink-0",children:[se.jsx(mo,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full hover:bg-white/10",onClick:()=>i(e),children:se.jsx(ar,{className:"h-3.5 w-3.5 text-cyan-400"})}),se.jsx(mo,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full hover:bg-red-900/20",onClick:()=>a(e.id),children:se.jsx(Ar,{className:"h-3.5 w-3.5 text-red-400"})})]})]})},e.id))}),Zy=()=>{const{user:e}=$l(),[t,i]=We.useState([]),[a,s]=We.useState(!1),[r,n]=We.useState(""),[o,l]=We.useState(null),[c,d]=We.useState(!0),[u,h]=We.useState(!1);We.useEffect(()=>{e?.id&&m()},[e?.id]),We.useEffect(()=>{if(!e?.id)return;const t=ba.channel("map_notes_realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"map_notes",filter:`user_id=eq.${e.id}`},e=>{setTimeout(()=>m(),100)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"map_notes",filter:`user_id=eq.${e.id}`},()=>{m()}).on("postgres_changes",{event:"DELETE",schema:"public",table:"map_notes",filter:`user_id=eq.${e.id}`},()=>{m()}).subscribe();return()=>{ba.removeChannel(t)}},[e?.id]);const m=async()=>{if(e?.id)try{const{data:t,error:a}=await ba.from("map_notes").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(a)throw a;const s=t.map(e=>({id:e.id,note:e.text,importance:e.importance}));i(s)}catch(t){console.error("Error loading notes:",t)}finally{d(!1)}},p=()=>{s(!a),l(null),n("")};return se.jsxs(Wl,{gradient:!0,className:"h-full overflow-hidden",children:[se.jsx(Hl,{className:"pb-2",children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(Ps,{className:"h-5 w-5 text-cyan-400"}),"Le tue note"]})}),se.jsxs(Gl,{className:"space-y-4",children:[a?se.jsxs("div",{className:"space-y-3",children:[se.jsx("textarea",{className:"w-full h-24 p-3 bg-black/50 border border-cyan-500/30 rounded-[24px] text-white resize-none focus:outline-none focus:border-cyan-500/60",placeholder:"Scrivi una nota...",value:r,onChange:e=>n(e.target.value)}),se.jsxs("div",{className:"flex justify-end gap-2",children:[se.jsx(mo,{variant:"outline",size:"sm",onClick:p,className:"rounded-full",children:"Annulla"}),se.jsx(mo,{variant:"default",size:"sm",onClick:async()=>{if(!r.trim()||!e?.id)return;h(!0);const t=`temp-${Date.now()}`,a={id:t,note:r.trim(),importance:"medium"};try{if(o){i(e=>e.map(e=>e.id===o.id?{...e,note:r.trim()}:e));const{error:t}=await ba.from("map_notes").update({text:r.trim(),updated_at:(new Date).toISOString()}).eq("id",o.id).eq("user_id",e.id);if(t)throw t;Ki.success("Nota aggiornata")}else{i(e=>[a,...e]);const{error:t}=await ba.from("map_notes").insert({user_id:e.id,text:r.trim(),importance:"medium"});if(t)throw t;Ki.success("Nota aggiunta")}n(""),s(!1),l(null)}catch(c){console.error("Error saving note:",c),Ki.error("Errore nel salvare la nota"),o?m():i(e=>e.filter(e=>e.id!==t))}finally{h(!1)}},className:"rounded-full",disabled:u||!r.trim(),children:u?"Salvataggio...":o?"Aggiorna":"Aggiungi"})]})]}):se.jsxs(mo,{variant:"outline",className:"w-full flex items-center justify-center gap-2 rounded-full border border-cyan-500/30 hover:border-cyan-500/60",onClick:p,children:[se.jsx(fs,{className:"h-5 w-5 text-cyan-400"}),"Aggiungi nota"]}),se.jsx(Hy,{notes:t,onImportanceClick:async i=>{if(e?.id)try{const a=t.find(e=>e.id===i);if(!a)return;const s=["high","medium","low"],r=s.indexOf(a.importance),n=s[(r+1)%s.length],{error:o}=await ba.from("map_notes").update({importance:n,updated_at:(new Date).toISOString()}).eq("id",i).eq("user_id",e.id);if(o)throw o}catch(a){console.error("Error updating importance:",a),Ki.error("Errore nell'aggiornare la priorit")}},onEditNote:e=>{l(e),n(e.note),s(!0)},onDeleteNote:async a=>{if(!e?.id)return;const s=[...t];i(e=>e.filter(e=>e.id!==a));try{const{error:t}=await ba.from("map_notes").delete().eq("id",a).eq("user_id",e.id);if(t)throw t;Ki.success("Nota eliminata")}catch(r){console.error("Error deleting note:",r),Ki.error("Errore nell'eliminare la nota"),i(s)}}})]})]})},Vy=({leftContent:e,rightContent:t})=>se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-20",children:[se.jsx("div",{className:"m1ssion-glass-card p-4 sm:p-6 rounded-[24px]",children:e}),se.jsx("div",{className:"space-y-6",children:t})]}),Gy=({mapPoints:e,isAddingMapPoint:t,toggleAddingMapPoint:i,setActiveMapPoint:a,deleteMapPoint:s})=>{const[r,n]=We.useState(null),[o,l]=We.useState(null);return se.jsxs("div",{className:"rounded-[20px] bg-[#1C1C1F] backdrop-blur-md transition-all duration-300 hover:shadow-lg mb-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #1C1C1F 0%, rgba(28, 28, 31, 0.95) 50%, rgba(54, 94, 255, 0.1) 100%)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[se.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px]",style:{background:"linear-gradient(90deg, #FC1EFF 0%, #365EFF 50%, #FACC15 100%)"}}),se.jsxs("div",{className:"p-6",children:[se.jsxs("div",{className:"flex items-center justify-between mb-4",children:[se.jsx("h2",{className:"text-lg font-medium text-white font-orbitron",children:"Punti di interesse"}),se.jsxs(mo,{variant:"outline",size:"sm",onClick:()=>{i(),t||Ki.info("Clicca sulla mappa per aggiungere un punto",{duration:3e3})},className:"group bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white rounded-full border-none hover:shadow-lg transition-all "+(t?"opacity-75":""),children:[t?se.jsx(Ss,{className:"mr-1 h-4 w-4"}):se.jsx(nr,{className:"mr-1 h-4 w-4"}),t?"Annulla":"Aggiungi Punto"]})]}),0===e.length?se.jsxs("div",{className:"p-4 border border-dashed border-gray-600 rounded-[16px] text-center text-gray-400",children:[se.jsx("p",{className:"text-white/70",children:"Nessun punto di interesse salvato"}),se.jsx("p",{className:"text-sm mt-1 text-white/50",children:'Clicca su "Aggiungi Punto" per iniziare'})]}):se.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto pr-2",children:e.map(e=>se.jsx("div",{className:"p-4 bg-[#0a0a0a]/50 rounded-[16px] transition-all hover:bg-[#0a0a0a]/70",children:se.jsxs("div",{className:"flex justify-between items-start",children:[se.jsxs("div",{className:"flex-1",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:"h-3 w-3 rounded-full bg-cyan-500"}),se.jsx("h3",{className:"font-medium text-white text-lg font-orbitron",children:e.title||"Punto senza titolo"})]}),e.note&&se.jsx("p",{className:"text-sm text-white/70 mt-2 line-clamp-2",children:e.note}),se.jsxs("div",{className:"text-xs text-white/50 mt-2 flex items-center",children:[se.jsx(Ys,{className:"h-3 w-3 mr-1 text-cyan-400"}),se.jsxs("span",{children:[e.lat.toFixed(6),", ",e.lng.toFixed(6)]})]})]}),se.jsx("div",{className:"flex gap-2 ml-2",children:r===e.id?se.jsxs(se.Fragment,{children:[se.jsx(mo,{variant:"destructive",size:"sm",onClick:()=>(async e=>{l(e);try{await s(e)?Ki.success("Punto di interesse eliminato"):Ki.error("Errore durante l'eliminazione del punto")}catch(t){console.error(" Error deleting point:",t),Ki.error("Errore durante l'eliminazione del punto")}finally{l(null),n(null)}})(e.id),className:"rounded-full text-xs",disabled:o===e.id,children:o===e.id?"Eliminando...":"Conferma"}),se.jsx(mo,{variant:"outline",size:"sm",onClick:()=>n(null),className:"rounded-full text-xs",disabled:o===e.id,children:"Annulla"})]}):se.jsxs(se.Fragment,{children:[se.jsx(mo,{variant:"outline",size:"sm",onClick:()=>a(e.id),className:"rounded-full text-cyan-400 border-cyan-500/50 hover:bg-cyan-950/30 text-xs",children:"Visualizza"}),se.jsx(mo,{variant:"destructive",size:"sm",onClick:()=>{return t=e.id,void n(t);var t},className:"rounded-full text-xs",disabled:null!==o,children:"Elimina"})]})})]})},e.id))})]})]})},Yy=({searchAreas:e,setActiveSearchArea:t,handleAddArea:i,isAddingSearchArea:a,deleteSearchArea:s})=>{const[r,n]=We.useState(!1),[o,l]=We.useState("500"),[c,d]=We.useState(null),[u,h]=We.useState(null);We.useEffect(()=>{a&&n(!1)},[a]),We.useEffect(()=>{e.length,e.map(e=>({id:e.id,label:e.label,radius:e.radius})),(new Date).toISOString()},[e]);return se.jsxs("div",{className:"rounded-[20px] bg-[#1C1C1F] backdrop-blur-md transition-all duration-300 hover:shadow-lg mb-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #1C1C1F 0%, rgba(28, 28, 31, 0.95) 50%, rgba(54, 94, 255, 0.1) 100%)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[se.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px]",style:{background:"linear-gradient(90deg, #FC1EFF 0%, #365EFF 50%, #FACC15 100%)"}}),se.jsxs("div",{className:"p-6",children:[se.jsxs("div",{className:"flex items-center justify-between mb-4",children:[se.jsx("h2",{className:"text-lg font-medium text-white font-orbitron",children:"Aree di interesse"}),se.jsxs(mo,{variant:"outline",size:"sm",onClick:()=>{n(!0)},disabled:a,className:"group bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white rounded-full border-none hover:shadow-lg transition-all",children:[se.jsx(nr,{className:"mr-1 h-4 w-4"}),"Aggiungi Area"]})]}),0===e.length?se.jsxs("div",{className:"p-4 border border-dashed border-gray-600 rounded-[16px] text-center text-gray-400",children:[se.jsx("p",{className:"text-white/70",children:"Nessuna area di interesse salvata"}),se.jsx("p",{className:"text-sm mt-1 text-white/50",children:'Clicca su "Aggiungi Area" per iniziare'})]}):se.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto pr-2",children:e.map(e=>se.jsx("div",{className:"p-4 bg-[#0a0a0a]/50 rounded-[16px] transition-all hover:bg-[#0a0a0a]/70 cursor-pointer",onClick:()=>{e.id,t(e.id)},children:se.jsxs("div",{className:"flex justify-between items-start",children:[se.jsxs("div",{className:"flex-1",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:"h-3 w-3 rounded-full bg-green-500"}),se.jsx("h3",{className:"font-medium text-white text-lg font-orbitron",children:e.label||"Area di ricerca"})]}),se.jsxs("div",{className:"text-xs text-white/50 mt-2 flex items-center",children:[se.jsx(xs,{className:"h-3 w-3 mr-1 text-green-400"}),se.jsxs("span",{children:["Raggio: ",(e.radius/1e3).toFixed(1)," km"]})]})]}),se.jsx("div",{className:"flex gap-2 ml-2",children:c===e.id?se.jsxs(se.Fragment,{children:[se.jsx(mo,{variant:"destructive",size:"sm",onClick:t=>{t.stopPropagation(),(async e=>{h(e);try{await s(e)?Ki.success("Area di interesse eliminata"):Ki.error("Errore durante l'eliminazione dell'area")}catch(t){console.error(" Error deleting area:",t),Ki.error("Errore durante l'eliminazione dell'area")}finally{h(null),d(null)}})(e.id,e.label)},className:"rounded-full text-xs",disabled:u===e.id,children:u===e.id?"Eliminando...":"Conferma"}),se.jsx(mo,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),d(null)},className:"rounded-full text-xs",disabled:u===e.id,children:"Annulla"})]}):se.jsxs(se.Fragment,{children:[se.jsx(mo,{variant:"outline",size:"sm",onClick:i=>{i.stopPropagation(),t(e.id)},className:"rounded-full text-green-400 border-green-500/50 hover:bg-green-950/30 text-xs",children:"Visualizza"}),se.jsx(mo,{variant:"destructive",size:"sm",onClick:t=>{var i;t.stopPropagation(),e.id,i=e.id,d(i)},className:"rounded-full text-xs",disabled:null!==u,children:"Elimina"})]})})]})},e.id))})]}),se.jsx(to,{open:r,onOpenChange:n,children:se.jsxs(io,{className:"sm:max-w-md bg-black/80 backdrop-blur-md border border-white/10",children:[se.jsxs(ao,{children:[se.jsx(so,{children:"Aggiungi area di interesse"}),se.jsx(ro,{children:"Definisci il raggio dell'area, poi seleziona un punto sulla mappa."})]}),se.jsxs("div",{className:"py-4",children:[se.jsx("label",{htmlFor:"radius",className:"block text-sm font-medium text-gray-300 mb-1",children:"Raggio in metri"}),se.jsx(Sl,{id:"radius",type:"number",min:"100",max:"100000",className:"bg-black/60 border-white/20",value:o,onChange:e=>l(e.target.value)}),se.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Valore minimo: 100m, Valore massimo: 100000m"})]}),se.jsxs(no,{children:[se.jsx(mo,{variant:"outline",onClick:()=>n(!1),className:"border-white/20 hover:bg-white/10",children:"Annulla"}),se.jsx(mo,{onClick:()=>{const e=parseInt(o);isNaN(e)||e<=0||(n(!1),i(e))},className:"bg-gradient-to-r from-[#00D1FF] to-[#9b87f5]",children:"Conferma e seleziona punto"})]})]})})]})},Ky=({value:e,onValueChange:t,children:i,className:a,...s})=>{const[r,n]=We.useState(e||""),o=e=>{n(e),t?.(e)};return se.jsx("div",{className:eo("w-full",a),...s,children:We.Children.map(i,e=>We.isValidElement(e)?We.cloneElement(e,{activeTab:r,onTabChange:o}):e)})},Xy=({className:e,activeTab:t,onTabChange:i,children:a,...s})=>se.jsx("div",{className:eo("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...s,children:We.Children.map(a,e=>We.isValidElement(e)?We.cloneElement(e,{activeTab:t,onTabChange:i}):e)}),Jy=({className:e,value:t,activeTab:i,onTabChange:a,children:s,...r})=>se.jsx("button",{className:eo("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",i===t?"bg-background text-foreground shadow":"text-muted-foreground hover:text-foreground",e),onClick:()=>a?.(t),...r,children:s}),Qy=({className:e,value:t,activeTab:i,children:a,...s})=>i!==t?null:se.jsx("div",{className:eo("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s,children:a}),ew=({mapPoints:e,isAddingMapPoint:t,toggleAddingMapPoint:i,setActiveMapPoint:a,deleteMapPoint:s,searchAreas:r,setActiveSearchArea:n,handleAddArea:o,isAddingSearchArea:l,deleteSearchArea:c})=>{const{user:d}=bl();return se.jsx("div",{className:"space-y-4",children:se.jsx("div",{className:"m1ssion-glass-card p-4 sm:p-6 rounded-[24px]",children:se.jsxs(Ky,{defaultValue:"points",className:"w-full",children:[se.jsxs(Xy,{className:"grid w-full grid-cols-2",children:[se.jsxs(Jy,{value:"points",className:"flex items-center gap-2",children:[se.jsx(Ys,{className:"w-4 h-4"}),"Punti"]}),se.jsxs(Jy,{value:"areas",className:"flex items-center gap-2",children:[se.jsx(kr,{className:"w-4 h-4"}),"Aree"]})]}),se.jsx(Qy,{value:"points",className:"mt-4",children:se.jsx(Gy,{mapPoints:e,isAddingMapPoint:t,toggleAddingMapPoint:i,setActiveMapPoint:a,deleteMapPoint:s})}),se.jsx(Qy,{value:"areas",className:"mt-4",children:se.jsx(Yy,{searchAreas:r,setActiveSearchArea:n,handleAddArea:o,isAddingSearchArea:l,deleteSearchArea:c})})]})})})},tw=[];for(let xB=0;xB<256;++xB)tw.push((xB+256).toString(16).slice(1));let iw;const aw=new Uint8Array(16);const sw={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function rw(e,t,i){if(sw.randomUUID&&!e)return sw.randomUUID();const a=(e=e||{}).random??e.rng?.()??function(){if(!iw){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");iw=crypto.getRandomValues.bind(crypto)}return iw(aw)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=15&a[6]|64,a[8]=63&a[8]|128,function(e,t=0){return(tw[e[t+0]]+tw[e[t+1]]+tw[e[t+2]]+tw[e[t+3]]+"-"+tw[e[t+4]]+tw[e[t+5]]+"-"+tw[e[t+6]]+tw[e[t+7]]+"-"+tw[e[t+8]]+tw[e[t+9]]+"-"+tw[e[t+10]]+tw[e[t+11]]+tw[e[t+12]]+tw[e[t+13]]+tw[e[t+14]]+tw[e[t+15]]).toLowerCase()}(a)}function nw(e){try{const t=e?.latlng;if(t&&Number.isFinite(t.lat)&&Number.isFinite(t.lng))return{lat:t.lat,lng:t.lng}}catch{}return null}const ow=()=>{const{user:e}=sn(),[t,i]=We.useState([]),[a,s]=We.useState(!1),[r,n]=We.useState(null),o=async()=>{if(e?.id){e.id,s(!0);try{const{data:t,error:a}=await ba.from("buzz_game_targets").select("*").eq("is_active",!0);if(a)return console.error(" GAME TARGETS ERROR:",a),n(a),i([]),void s(!1);const r=t?.filter(e=>e.lat&&e.lon&&0!==e.lat&&0!==e.lon&&Math.abs(e.lat)<=90&&Math.abs(e.lon)<=180)||[];if(r.length,r.map(e=>({id:e.id,lat:e.lat,lon:e.lon,city:e.city})),0===r.length)return console.warn(" NO VALID BUZZ GAME TARGETS - CLEARING ALL AREAS"),i([]),void s(!1);const{data:o,error:l}=await ba.from("payment_transactions").select("*").eq("user_id",e.id).eq("status","succeeded").or("description.ilike.%Buzz Map%,description.ilike.%BUZZ MAPPA%").gte("created_at","2025-07-17T00:00:00Z");if(o?.map(e=>({id:e.id,status:e.status,amount:e.amount,description:e.description})),l)return console.error(" PAYMENTS ERROR:",l),n(l),i([]),void s(!1);if(!o||0===o.length)return console.warn(" NO COMPLETED BUZZ MAP PAYMENTS - CLEARING ALL AREAS"),console.warn("[PAYMENT VALIDATION] No valid payments found - areas blocked until payment completed"),i([]),void s(!1);const{data:c,error:d}=await ba.from("user_map_areas").select("*").eq("user_id",e.id).gte("created_at","2025-07-17T00:00:00.000Z").order("created_at",{ascending:!1});if(c?.map(e=>({id:e.id,lat:e.lat,lng:e.lng,radius_km:e.radius_km,created_at:e.created_at})),d)return console.error(" USER AREAS ERROR:",d),n(d),i([]),void s(!1);if(!c||0===c.length)return console.warn(" NO USER MAP AREAS FOUND (POST-PAYMENT VALIDATION)"),i([]),void s(!1);const u=c.map((e,t)=>(e.id,e.radius_km,e.lat,e.lng,{id:e.id,lat:e.lat,lng:e.lng,radius_km:e.radius_km,coordinates:{lat:e.lat,lng:e.lng},radius:1e3*e.radius_km,color:"#00FFFF",colorName:"cyan",week:e.week||1,generation:t+1,isActive:!0,user_id:e.user_id,created_at:e.created_at||(new Date).toISOString()}));u.length,i(u),n(null)}catch(t){console.error(" useBuzzMapLogic: Exception fetching areas:",t),n(t),i([])}finally{s(!1)}}else i([])};return We.useEffect(()=>{if(o(),e?.id){e.id;const t=ba.channel("user_map_areas_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"user_map_areas",filter:`user_id=eq.${e.id}`},e=>{o(),e.new&&window.dispatchEvent(new CustomEvent("buzzAreaCreated",{detail:{lat:e.new.lat,lng:e.new.lng,radius_km:e.new.radius_km}}))}).subscribe();return()=>{t.unsubscribe()}}},[e?.id]),{areas:t,loading:a,error:r||new Error("No error"),currentWeekAreas:t,reloadAreas:()=>{o()}}};function lw(){return{callBuzzApi:async({userId:e,generateMap:t,coordinates:i,prizeId:a,sessionId:s})=>{try{if(!e)return console.error("UserId mancante nella chiamata API"),{success:!1,error:!0,errorMessage:"Devi effettuare l'accesso per utilizzare questa funzione"};if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return console.error(`UserID non valido: ${e}`),{success:!1,error:!0,errorMessage:"ID utente non valido"};const r={userId:e,generateMap:t};t&&i&&(r.coordinates=i),a&&(r.prizeId=a),s&&(r.sessionId=s);const{data:n,error:o}=await ba.auth.getSession();if(!n?.session?.access_token)return console.error(" No active session or access token found"),{success:!1,error:!0,errorMessage:"Sessione non valida. Effettua l'accesso nuovamente."};const{data:l,error:c}=await ba.functions.invoke("handle-buzz-press",{body:r,headers:{Authorization:`Bearer ${n.session.access_token}`,"Content-Type":"application/json"}});return c?(console.warn(" EDGE FUNCTION ERROR:",c),c.message?.includes("daily_quota_exceeded")||c.message?.includes("429")||c.details?.includes("daily_quota_exceeded")||"daily_quota_exceeded"===c.code?(Ki.error("Hai raggiunto il limite giornaliero di 5 BUZZ. Riprova dopo mezzanotte."),{success:!1,error:!0,errorMessage:"Limite giornaliero raggiunto. Riprova dopo mezzanotte."}):(console.warn("BUZZ edge function error:",c.message),Ki.error("Non sono riuscito a generare l'indizio, riprova fra poco."),{success:!1,error:!0,errorMessage:"Non sono riuscito a generare l'indizio, riprova fra poco."})):l?.success?(l.clue_text?Ki.success(l.clue_text,{duration:5e3,position:"top-center",style:{zIndex:9999,background:"linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)",color:"white",fontWeight:"bold"}}):Ki.success("BUZZ processed successfully"),{success:!0,clue_text:l.clue_text,buzz_cost:l.buzz_cost,radius_km:l.radius_km,lat:l.lat,lng:l.lng,generation_number:l.generation_number,map_area:l.map_area,precision:l.precision,canGenerateMap:l.canGenerateMap,remainingMapGenerations:l.remainingMapGenerations}):l?l.success?{success:!0,clue_text:l.clue_text,buzz_cost:l.buzz_cost,radius_km:l.radius_km,lat:l.lat,lng:l.lng,generation_number:l.generation_number,map_area:l.map_area,precision:l.precision,canGenerateMap:l.canGenerateMap,remainingMapGenerations:l.remainingMapGenerations}:(console.error(" EDGE FUNCTION RETURNED FAILURE:",l?.error||"Unknown error"),"daily_quota_exceeded"===l?.code?(Ki.error("Hai raggiunto il limite giornaliero di 5 BUZZ. Riprova dopo mezzanotte."),{success:!1,error:!0,errorMessage:"Limite giornaliero raggiunto. Riprova dopo mezzanotte."}):"payment_required"===l?.code?(Ki.error("Pagamento richiesto per utilizzare BUZZ MAPPA."),{success:!1,error:!0,errorMessage:"Pagamento richiesto per utilizzare BUZZ MAPPA."}):(Ki.error("Operazione non riuscita. Riprova tra poco."),{success:!1,error:!0,errorMessage:"Operazione non riuscita. Riprova tra poco."})):(console.error(" EDGE FUNCTION RETURNED NULL DATA"),Ki.error("Operazione non riuscita. Riprova tra poco."),{success:!1,error:!0,errorMessage:"Operazione non riuscita. Riprova tra poco."})}catch(r){return console.error("Errore generale nella chiamata API buzz:",r),Ki.error("Operazione non riuscita. Riprova tra poco."),{success:!1,error:!0,errorMessage:"Operazione non riuscita. Riprova tra poco."}}}}}const cw="00000000-0000-4000-a000-000000000000",dw=()=>{const{user:e,isAuthenticated:t}=sn(),[i,a]=We.useState(!1),[s,r]=We.useState([]),[n,o]=We.useState(null),[l,c]=We.useState(!0),[d,u]=We.useState(null),h=We.useCallback(()=>e?.id?"developer-fake-id"===e.id?cw:e.id:cw,[e]),{currentWeekAreas:m,loading:p,reloadAreas:f}=ow(),{searchAreas:g,isAddingSearchArea:x,activeSearchArea:b,setActiveSearchArea:v,handleAddArea:y,handleMapClickArea:w,deleteSearchArea:N,clearAllSearchAreas:j,toggleAddingSearchArea:S,setPendingRadius:_}=function(){const[e,t]=Xc("map-search-areas",[]),[i,a]=We.useState([]),[s,r]=We.useState(null),[n,o]=We.useState(!1),l=We.useRef(500),[c,d]=We.useState(0),[u,h]=We.useState(!0),m=async()=>{try{const{data:t}=await ba.auth.getSession();if(!t?.session?.user?.id)return a(e||[]),void h(!1);t.session.user.id;const{data:i,error:s}=await ba.from("search_areas").select("*").eq("user_id",t.session.user.id).order("created_at",{ascending:!1});if(s)return console.error(" FORCE RELOAD: Error fetching search areas:",s),a(e||[]),void h(!1);if(i&&i.length>0){const e=i.map(e=>({id:e.id,lat:e.lat,lng:e.lng,radius:e.radius,label:e.label||"Area di ricerca",position:{lat:e.lat,lng:e.lng},color:"#00f0ff"}));a(e),d(i.length),e.length}else a([])}catch(t){console.error(" FORCE RELOAD: Exception in forceReloadAreas:",t),a(e||[])}finally{h(!1)}};We.useEffect(()=>{m()},[]),We.useEffect(()=>{!u&&i.length>=0&&(t(i),i.length)},[i,t,u]);const p=()=>{const e=Math.pow(.95,c);return Math.max(5e3,1e5*e)};return{searchAreas:i,setSearchAreas:a,activeSearchArea:s,setActiveSearchArea:r,isAddingSearchArea:n,setIsAddingSearchArea:o,handleAddArea:e=>{const t=e||p();l.current=t,o(!0),Ki.info("Clicca sulla mappa per aggiungere una nuova area di ricerca",{description:`L'area sar creata con il raggio di ${(l.current/1e3).toFixed(1)} km`})},handleMapClickArea:async e=>{if(!n)return;const t=nw(e);if(t)try{const e=t.lat,i=t.lng,s=l.current,{data:n}=await ba.auth.getSession();if(!n?.session?.user)return console.error(" AUTH: User not authenticated"),Ki.error("Utente non autenticato"),void o(!1);const u=n.session.user.id,h={id:rw(),lat:e,lng:i,radius:s,label:`Area di ricerca ${c+1}`,color:"#00f0ff",position:{lat:e,lng:i}},{data:p,error:f}=await ba.from("search_areas").insert({user_id:u,lat:e,lng:i,radius:s,label:h.label}).select().single();if(f)return console.error(" DB ERROR: Error saving search area:",f),Ki.error("Si  verificato un errore nel salvare l'area di ricerca"),void o(!1);p&&(h.id=p.id),d(e=>e+1),a(e=>[...e,h]),r(h.id),o(!1),Ki.success("Area di ricerca aggiunta alla mappa",{description:`Raggio: ${(s/1e3).toFixed(1)} km`}),setTimeout(()=>{m()},500)}catch(i){console.error(" EXCEPTION: Error adding search area:",i),o(!1),Ki.error("Si  verificato un errore nell'aggiunta dell'area")}},saveSearchArea:(e,t,s)=>{a(i.map(i=>i.id===e?{...i,label:t,radius:s}:i)),Ki.success("Area di ricerca aggiornata")},deleteSearchArea:async e=>{try{const{error:t}=await ba.from("search_areas").delete().eq("id",e);return t?(console.error(" DB DELETE ERROR: Error deleting search area:",t),Ki.error("Errore nell'eliminare l'area di ricerca"),!1):(a(t=>{const i=t.filter(t=>t.id!==e);return t.length,i.length,i}),s===e&&r(null),Ki.success("Area di ricerca rimossa"),setTimeout(()=>{m()},300),!0)}catch(t){return console.error(" DELETE EXCEPTION: Error in deleteSearchArea:",t),Ki.error("Errore nell'eliminare l'area di ricerca"),!1}},clearAllSearchAreas:()=>{a([]),r(null),Ki.success("Tutte le aree di ricerca sono state rimosse")},toggleAddingSearchArea:()=>{if(o(e=>!e),!n){const e=p();l.current=e,Ki.info(`Clicca sulla mappa per creare un'area di ricerca (raggio: ${(e/1e3).toFixed(1)}km)`)}},isLoading:u,forceReloadAreas:m,setPendingRadius:e=>{l.current=e}}}();We.useEffect(()=>{(async()=>{const e=h();try{if(e===cw){const e=localStorage.getItem("dev-map-points");return e&&r(JSON.parse(e)),void c(!1)}const{data:t,error:i}=await ba.from("map_points").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(i)return console.error(" Error fetching map points:",i),void("PGRST116"===i.code?r([]):Ki.error(`Errore nel caricamento dei punti: ${i.message}`));r(t||[])}catch(t){console.error(" Exception fetching map points:",t),Ki.error("Errore nel caricamento dei punti")}finally{c(!1)}})()},[h]);const k=We.useCallback((e,t)=>{h()===cw&&Ki.info("Modalit sviluppatore: inserimento simulato",{description:"Punto creato con ID sviluppatore"}),o({id:"new",lat:e,lng:t,title:"",note:"",position:{lat:e,lng:t}}),x&&S(),Ki.success("Punto posizionato. Inserisci titolo e nota.")},[x,S,h]),{callBuzzApi:C}=lw(),A=We.useCallback(async()=>{const e=h();try{let t;if(window.leafletMap){const e=window.leafletMap.getCenter();t={lat:e.lat,lng:e.lng}}else t={lat:41.9028,lng:12.4964};const i=await C({userId:e,generateMap:!0,coordinates:t});i.success?i.map_area?(Ki.success(" BUZZ MAPPA creata!",{description:`Area di ${i.map_area.radius_km}km generata`}),await f()):Ki.success(" BUZZ MAP completato con successo!"):(console.error("[BUZZ-MAP] API error:",i.errorMessage),Ki.error(i.errorMessage||"Errore durante la generazione BUZZ MAP"))}catch(t){console.error("[BUZZ-MAP] Exception during BUZZ MAP:",t),Ki.error("Errore imprevisto durante BUZZ MAP")}},[h,C,f]);return{isAddingPoint:i,setIsAddingPoint:a,mapPoints:s,newPoint:n,isLoading:l,activeMapPoint:d,setActiveMapPoint:u,buzzMapPrice:1.99,searchAreas:g,isAddingSearchArea:x,activeSearchArea:b,setActiveSearchArea:v,handleAddArea:y,handleMapClickArea:w,deleteSearchArea:N,clearAllSearchAreas:j,toggleAddingSearchArea:S,setPendingRadius:_,addNewPoint:k,savePoint:async(e,t)=>{const i=h();if(!n)return void Ki.error("Impossibile salvare: punto non disponibile");const l=e?.trim()||"",c=t?.trim()||"";if(!l)return void Ki.error("Il titolo  obbligatorio");const d={user_id:i,latitude:n.lat,longitude:n.lng,title:l,note:c};try{if(i===cw){const e={id:crypto.randomUUID(),...d,created_at:(new Date).toISOString()},t=[e,...s||[]];return r(t),localStorage.setItem("dev-map-points",JSON.stringify(t)),Ki.success("Punto salvato (modalit sviluppatore)"),o(null),void a(!1)}const{data:e,error:t}=await ba.from("map_points").insert([d]).select();if(t)return console.error(" Supabase error saving map point:",t),console.error(" Error details:",{message:t.message,code:t.code,details:t.details,hint:t.hint}),void Ki.error(`Errore nel salvare il punto: ${t.message}`);if(!e||0===e.length)return console.error(" No data returned from insert"),void Ki.error("Errore nel salvare il punto: nessun dato restituito");e[0],Ki.success("Punto salvato con successo"),r(t=>[e[0],...t]),o(null),a(!1)}catch(u){console.error(" Exception saving map point:",u);const e=u instanceof Error?u.message:"Errore sconosciuto";Ki.error(`Errore nell'salvare il punto: ${e}`)}},updateMapPoint:async(e,t,i)=>{const a=h(),n=t?.trim()||"",o=i?.trim()||"";if(!n)return Ki.error("Il titolo  obbligatorio"),!1;try{if(a===cw){const t=[...s],i=t.findIndex(t=>t.id===e);return i>=0&&(t[i]={...t[i],title:n,note:o},r(t),localStorage.setItem("dev-map-points",JSON.stringify(t)),Ki.success("Punto aggiornato (modalit sviluppatore)"),u(null),!0)}const{error:t}=await ba.from("map_points").update({title:n,note:o}).eq("id",e).eq("user_id",a);return t?(console.error(" Error updating map point:",t),Ki.error(`Errore nell'aggiornare il punto: ${t.message}`),!1):(r(t=>t.map(t=>t.id===e?{...t,title:n,note:o}:t)),Ki.success("Punto aggiornato con successo"),u(null),!0)}catch(l){console.error(" Exception updating map point:",l);const e=l instanceof Error?l.message:"Errore sconosciuto";return Ki.error(`Errore nell'aggiornare il punto: ${e}`),!1}},deleteMapPoint:async e=>{const t=h();try{if(t===cw){const t=s.filter(t=>t.id!==e);return r(t),localStorage.setItem("dev-map-points",JSON.stringify(t)),u(null),Ki.success("Punto eliminato (modalit sviluppatore)"),!0}const{error:i}=await ba.from("map_points").delete().eq("id",e).eq("user_id",t);return i?(console.error(" Error deleting map point:",i),Ki.error(`Errore nell'eliminare il punto: ${i.message}`),!1):(r(t=>t.filter(t=>t.id!==e)),u(null),Ki.success("Punto eliminato con successo"),!0)}catch(i){console.error(" Exception deleting map point:",i);const e=i instanceof Error?i.message:"Errore sconosciuto";return Ki.error(`Errore nell'eliminare il punto: ${e}`),!1}},handleBuzz:A,requestLocationPermission:()=>{navigator.geolocation?(Ki.info("Rilevamento posizione in corso..."),navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:i}=e.coords;Ki.success("Posizione rilevata")},e=>{console.error("Error getting location:",e),Ki.error("Errore nel rilevare la posizione")})):Ki.error("Geolocalizzazione non supportata dal browser")},currentWeekAreas:m,isBuzzGenerating:p,getActiveArea:()=>m.length>0?m[0]:null}},uw=()=>{const{user:e,isAuthenticated:t}=sn(),[i,a]=We.useState({isSafe:!0});return We.useEffect(()=>{(async()=>{if(t&&e)try{if(!e.id||e.id.length<10)return void a({isSafe:!1,reason:"User ID non valido"});if(!e.email_confirmed_at)return void a({isSafe:!1,reason:"Email non verificata"});const{data:t}=await ba.auth.getSession();if(!t?.session)return void a({isSafe:!1,reason:"Sessione non attiva"});a({isSafe:!0})}catch(i){console.error("Error during safety check:",i),a({isSafe:!1,reason:i.message||"Unknown error"}),i.message}else a({isSafe:!1,reason:"Not authenticated"})})()},[e,t]),{isBuzzSafe:i}},hw=()=>{const{user:e,isAuthenticated:t}=sn(),[i,a]=We.useState({isVisible:!1,message:"",type:"info"}),{playSound:s}=(()=>{const[e,t]=We.useState({bell:null,buzz:null,chime:null,arcade:null}),[i,a]=We.useState(!1),[s,r]=We.useState(null);return We.useEffect(()=>((async()=>{try{const e=new(window.AudioContext||window.webkitAudioContext);r(e);const i=[{key:"bell",path:"/sounds/bell.mp3"},{key:"buzz",path:"/sounds/buzz.mp3"},{key:"chime",path:"/sounds/chime.mp3"},{key:"arcade",path:"/sounds/arcade.mp3"}].map(async({key:e,path:t})=>{try{const i=new Audio(t);return i.volume=.5,i.preload="metadata",await new Promise((e,t)=>{i.addEventListener("canplaythrough",e,{once:!0}),i.addEventListener("error",t,{once:!0}),i.load()}),{key:e,audio:i}}catch(i){return console.warn(`Audio file ${t} non disponibile, utilizzando fallback silenzioso`),{key:e,audio:null}}}),a=(await Promise.all(i)).reduce((e,{key:t,audio:i})=>(e[t]=i,e),{});t(a)}catch(e){console.warn("Audio non supportato su questo dispositivo, modalit silenziosa attiva"),t({bell:null,buzz:null,chime:null,arcade:null})}})(),()=>{Object.values(e).forEach(e=>{e&&(e.pause(),e.currentTime=0)}),s&&s.close()}),[]),{playSound:async t=>{if(!i&&e[t])try{s&&"suspended"===s.state&&await s.resume();const i=e[t];i&&(i.currentTime=0,await i.play())}catch(a){}},toggleMute:()=>{a(!i)},isMuted:i}})(),{isBuzzSafe:r}=uw(),n=e=>{s("buzz")},o=()=>r.isSafe,l=(i,s)=>{t&&e?(a({isVisible:!0,message:i,type:s}),n(),setTimeout(()=>{c()},5e3)):console.warn("Dynamic Island: User not authenticated, skipping island display")},c=()=>{a({...i,isVisible:!1})};return We.useEffect(()=>{t&&e&&o()},[t,e]),{islandState:i,showIsland:l,hideIsland:c,playNotificationSound:n,performSafetyChecks:o,startActivity:e=>{e.title,l(e.title,"info")},updateActivity:e=>{e.status&&l(e.status,"info")},endActivity:()=>{c()}}},mw=()=>{const{startActivity:e,updateActivity:t,endActivity:i}=hw(),[a,s]=We.useState(null);return{currentMission:a,updateMissionProgress:e=>{if(a){const i={...a,foundClues:e};s(i),t({status:`${e} indizi trovati`,progress:e/10*100})}},startActivity:e,updateActivity:t,endActivity:i}},pw=()=>{const[e,t]=We.useState(!1),[i,a]=We.useState(!1);Sy();const{updateActivity:s}=hw(),{currentMission:r,updateMissionProgress:n}=mw(),{isAddingPoint:o,setIsAddingPoint:l,mapPoints:c,newPoint:d,activeMapPoint:u,setActiveMapPoint:h,searchAreas:m,isAddingSearchArea:p,setActiveSearchArea:f,handleAddArea:g,handleMapClickArea:x,deleteSearchArea:b,toggleAddingSearchArea:v,setPendingRadius:y,addNewPoint:w,savePoint:N,updateMapPoint:j,deleteMapPoint:S,handleBuzz:_,requestLocationPermission:k}=dw();(({mapPoints:e,searchAreas:t,currentMission:i,updateMissionProgress:a,updateActivity:s})=>{We.useEffect(()=>{if(i&&"active"===i.status){const t=e.filter(e=>e.title.toLowerCase().includes("indizio")||e.title.toLowerCase().includes("clue")).length;t!==i.foundClues&&a(t)}},[e,i,a]),We.useEffect(()=>{t.length>0&&"active"===i?.status&&s({status:`${t.length} zone esplorate`})},[t,s,i]),We.useEffect(()=>()=>{},[])})({mapPoints:c,searchAreas:m,currentMission:r,updateMissionProgress:n,updateActivity:s});const C=Ze.useRef(null),A=Ze.useRef(null),z=Ze.useRef(null),E=Ze.useCallback(e=>{C.current=e},[]),I=Ze.useCallback(e=>{A.current=e},[]),P=Ze.useCallback(e=>{z.current=e},[]),T=Ze.useCallback(e=>{a(e),C.current&&C.current(e)},[]),M=Ze.useCallback(()=>{A.current&&A.current()},[]),L=Ze.useCallback(()=>{z.current&&z.current()},[]);return se.jsxs(ky,{children:[se.jsx($y,{isAddingPoint:o,setIsAddingPoint:l,addNewPoint:w,mapPoints:c,activeMapPoint:u,setActiveMapPoint:h,updateMapPoint:j,deleteMapPoint:S,newPoint:d,savePoint:N,handleBuzz:_,requestLocationPermission:k,isAddingSearchArea:p,handleMapClickArea:x,searchAreas:m,setActiveSearchArea:f,deleteSearchArea:b,setPendingRadius:y,toggleAddingSearchArea:v,showHelpDialog:e,setShowHelpDialog:t,onToggle3D:T,onFocusLocation:M,onResetView:L,onRegisterToggle3D:E,onRegisterFocusLocation:I,onRegisterResetView:P}),se.jsx(Vy,{leftContent:se.jsx(Zy,{}),rightContent:se.jsx(ew,{mapPoints:c.map(e=>({id:e.id,lat:e.latitude,lng:e.longitude,title:e.title,note:e.note,position:{lat:e.latitude,lng:e.longitude}})),isAddingMapPoint:o,toggleAddingMapPoint:()=>l(e=>!e),setActiveMapPoint:h,deleteMapPoint:S,searchAreas:m,setActiveSearchArea:f,handleAddArea:g,isAddingSearchArea:p,deleteSearchArea:b})})]})},fw=()=>se.jsx(pw,{});class gw{static logAnalyticsEvent(e,t){window.gtag?.("event",e,t)}static async handlePaymentError(e,t="payment"){let i="Errore nella creazione del pagamento. Riprova tra poco.",a="unknown";return e instanceof TypeError&&e.message.includes("fetch")?(i="Errore di connessione. Controlla la tua connessione internet.",a="network_error"):0===e?.status||[502,503,504].includes(e?.status)?(i="Servizio temporaneamente non disponibile. Riprova tra poco.",a="service_unavailable"):e?.message?.includes("CORS")||"CORS_ERROR"===e?.code?(i="Errore di configurazione. Contatta il supporto.",a="cors_error"):"stripe_error"===e?.type&&(i="Errore del sistema di pagamento. Riprova o contatta il supporto.",a="stripe_error"),Ki.error(i,{duration:5e3,position:"top-center"}),this.logAnalyticsEvent("payment_error",{context:t,error_code:a,error_message:e?.message||"Unknown error",timestamp:Date.now()}),{handled:!0,userMessage:i,errorCode:a}}static async retryWithBackoff(e,t=1,i=500){let a;for(let r=0;r<=t;r++)try{return await e()}catch(s){if(a=s,400===s?.status||401===s?.status||403===s?.status)throw s;if(r===t)throw s;const e=i+300*Math.random();await new Promise(t=>setTimeout(t,e))}throw a}}const xw=()=>{const[e,t]=We.useState(!1),{user:i}=sn();return{processBuzzPurchase:async(e=!1,a,s,r)=>{if(!i)return console.warn(" STRIPE BLOCK: No authenticated user"),Ki.error("Devi essere loggato per effettuare acquisti"),!1;try{await gw.retryWithBackoff(async()=>{const{data:e,error:t}=await ba.functions.invoke("stripe-mode");if(t)throw new Error(`Mode check failed: ${t.message}`);const{assertPkMatchesMode:i}=await ae(async()=>{const{assertPkMatchesMode:e}=await import("./guard.Dd5b5rB3.js");return{assertPkMatchesMode:e}},[]);i(e?.mode)})}catch(n){return await gw.handlePaymentError(n,"stripe_mode_check"),!1}t(!0);try{console.warn(" STRIPE CHAIN START:",{user_id:i.id,amount:a,is_buzz_map:e,timestamp:(new Date).toISOString()});const{data:t,error:n}=await ba.functions.invoke("process-buzz-purchase",{body:{user_id:i.id,amount:a,is_buzz_map:e,currency:"EUR",redirect_url:s,session_id:r,mode:"live"}});if(console.warn(" STRIPE EDGE RESPONSE:",{hasData:!!t,dataUrl:t?.url,dataSuccess:t?.success,error:n,fullResponse:t}),n)return console.error(" STRIPE EDGE ERROR:",n),Ki.error(`Errore Stripe: ${n.message||"Edge Function error"}`),!1;if(!t)return console.error(" STRIPE: No data from Edge Function"),Ki.error("Nessuna risposta dal server Stripe"),!1;if(!t?.url||"string"!=typeof t.url)throw console.error(" STRIPE: Checkout URL non ricevuta",t),Ki.error("URL checkout mancante o errata - verificare STRIPE_SECRET_KEY"),new Error("Checkout URL mancante o errata");t.url,t.url,console.warn(" STRIPE SUCCESS: Opening checkout URL",{url:t.url}),t.url;window.open(t.url,"_blank");return Ki.success("Apertura checkout Stripe..."),!0}catch(o){return console.error(" STRIPE FATAL ERROR:",{error:o,stack:o instanceof Error?o.stack:"No stack"}),Ki.error(`Errore critico: ${o instanceof Error?o.message:String(o)}`),!1}finally{t(!1)}},processSubscription:async(e,a)=>{if(i){try{await gw.retryWithBackoff(async()=>{const{data:e,error:t}=await ba.functions.invoke("stripe-mode");if(t)throw new Error(`Mode check failed: ${t.message}`);const{assertPkMatchesMode:i}=await ae(async()=>{const{assertPkMatchesMode:e}=await import("./guard.Dd5b5rB3.js");return{assertPkMatchesMode:e}},[]);i(e?.mode)})}catch(s){return await gw.handlePaymentError(s,"stripe_mode_check"),void t(!1)}t(!0);try{const{data:t,error:s}=await ba.functions.invoke("create-checkout",{body:{user_id:i.id,plan:e.toUpperCase(),payment_method:a||"card",mode:"live"}});if(s)return console.error(" STRIPE Error creating checkout session:",s),console.error(" STRIPE Full error details:",JSON.stringify(s,null,2)),void Ki.error(`Errore Stripe: ${s.message||"Sessione di pagamento fallita"}`);if(t?.url){t.url;if(!window.open(t.url,"_blank")){console.error(" window.open blocked - trying fallback redirect methods");if(window.navigator.standalone||window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches)try{window.location.replace(t.url)}catch(r){console.error(" location.replace failed, trying assign:",r);try{window.location.assign(t.url)}catch(n){console.error(" location.assign failed, using href:",n),window.location.href=t.url}}else window.location.href=t.url}Ki.success(" Apertura checkout Stripe...",{description:"Checkout aperto in nuova scheda - completa il pagamento"})}else console.error(" M1SSION STRIPE CHECKOUT FAILED - No URL received"),Ki.error("Errore nel creare la sessione di pagamento")}catch(o){console.error(" STRIPE Subscription processing error:",o),Ki.error("Errore nel processare l'abbonamento")}finally{t(!1)}}else Ki.error("Devi essere loggato per effettuare acquisti")},detectPaymentMethodAvailability:()=>({applePayAvailable:"undefined"!=typeof window&&"ApplePaySession"in window&&window.ApplePaySession?.canMakePayments?.()||!1,googlePayAvailable:"undefined"!=typeof window&&"PaymentRequest"in window||!1}),loading:e}},bw=globalThis.__buzzToastLock??{shown:!1,t:0};function vw(e,t,i){const a=Date.now();(!bw.shown||a-bw.t>2e3)&&(bw.shown=!0,bw.t=a,Ki[e]?.(t,i),setTimeout(()=>{bw.shown=!1},2e3))}function yw({currentPrice:e,onSuccess:t,hasFreeBuzz:i=!1,context:a}){const[s,r]=We.useState(!1),[n,o]=We.useState(!1),{user:l}=$l(),{triggerHaptic:c}=Kc(),{checkAbuseAndLog:d}={checkAbuseAndLog:async e=>{try{const{data:t}=await ba.from("abuse_logs").select("*").eq("user_id",e).eq("event_type","buzz_press").gte("timestamp",new Date(Date.now()-3e4).toISOString());return t&&t.length>=5?{isBlocked:!0,message:"Troppi tentativi. Riprova tra qualche secondo."}:(await ba.from("abuse_logs").insert({user_id:e,event_type:"buzz_press"}),{isBlocked:!1})}catch(t){return console.error("Error in abuse protection:",t),{isBlocked:!1}}}};xw();const{scheduleBuzzAvailableNotification:u}=(()=>{const e=We.useCallback(async(e,t=3)=>{try{const{data:{user:i}}=await ba.auth.getUser();if(!i)return console.error(" No authenticated user for notification scheduling"),!1;const a=new Date;a.setHours(a.getHours()+t),a.toISOString();const{error:s}=await ba.functions.invoke("schedule-buzz-notification",{body:{user_id:i.id,buzz_type:e,scheduled_time:a.toISOString()}});if(s)return console.error(" Failed to schedule notification:",s),!1;const r="buzz_mappa"===e?"BUZZ MAPPA":"BUZZ";return Ki.success(" Notifica programmata",{description:`Riceverai un avviso quando ${r} sar disponibile tra ${t} ore`,duration:4e3}),!0}catch(i){return console.error(" Error scheduling buzz notification:",i),!1}},[]),t=We.useCallback(()=>e("buzz_mappa",3),[e]),i=We.useCallback(()=>e("buzz",3),[e]);return{scheduleBuzzNotification:e,scheduleBuzzMappaNotification:t,scheduleBuzzAvailableNotification:i}})();return{buzzing:s,showShockwave:n,handleBuzz:async()=>{if((new Date).toISOString(),a?.skipServerBuzzPress)return;if(!l)return void Ki.error("Devi essere loggato per utilizzare BUZZ!");let s=!1;try{if(r(!0),o(!0),await c("buzzUnlocked"),!i&&e<=0)return void Ki.error("Errore nel calcolo del prezzo BUZZ");const a=await d(l.id);if(a.isBlocked)return void Ki.error(a.message);const{callBuzzApi:s}=lw(),n=await s({userId:l.id,generateMap:!1,coordinates:null,prizeId:null,sessionId:`buzz_${Date.now()}`});if(n.error)return console.error(" BUZZ API Error:",n.errorMessage),Ki.dismiss(),void Ki.error(n.errorMessage||"Errore di rete. Riprova.");if(!n.success)return Ki.dismiss(),void Ki.error(n.errorMessage||"Errore durante BUZZ");n.clue_text,n.success,await ba.from("buzz_map_actions").insert({user_id:l.id,cost_eur:e,clue_count:1,radius_generated:0}),t(),await u(),setTimeout(()=>{o(!1)},1500)}catch(n){console.error(" Error in handleBuzz - RESET COMPLETO 17/07/2025:",n),s=!0}finally{r(!1);try{new Date(Date.now()-6e5).toISOString();const{data:e,error:t}=await ba.from("user_notifications").select("id,type,title,message,metadata,created_at,is_deleted").eq("user_id",l.id).in("type",["buzz","buzz_free"]).is("is_deleted",!1).order("created_at",{ascending:!1}).limit(1).maybeSingle(),i=e&&new Date(e.created_at).getTime()>=Date.now()-6e5;i&&e?.message?(await c("success"),vw("success",e.message,{duration:4e3,position:"top-center",style:{background:"linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)"}})):s&&(await c("error"),vw("error","Non sono riuscito a generare l'indizio, riprova fra poco."))}catch(h){console.error("Error fetching toast notification:",h),s&&Ki.error("Errore imprevisto durante BUZZ")}}}}}globalThis.__buzzToastLock=bw;const ww=({currentPrice:e,isBlocked:t,buzzing:i,onClick:a})=>{const{xpStatus:s}=rn();return se.jsx(et.button,{whileTap:{scale:.97},disabled:t||i,onClick:a,className:"relative w-48 h-48 rounded-full text-lg font-semibold text-white tracking-wide z-20",style:{background:t?"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)":"linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)",boxShadow:t?"0 8px 30px rgba(239, 68, 68, 0.6), 0 4px 15px rgba(239, 68, 68, 0.4), inset 0 -8px 20px rgba(0, 0, 0, 0.3), inset 0 2px 10px rgba(255, 255, 255, 0.2)":"0 8px 30px rgba(242, 19, 164, 0.6), 0 4px 15px rgba(255, 77, 77, 0.4), inset 0 -8px 20px rgba(0, 0, 0, 0.3), inset 0 2px 10px rgba(255, 255, 255, 0.2)",transform:"translateZ(0)",border:"2px solid rgba(255, 255, 255, 0.1)"},animate:{scale:[1,1.06,1]},transition:{scale:{duration:1.5,repeat:1/0,ease:"easeInOut"}},children:i?se.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[se.jsx("div",{className:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin"}),se.jsx("span",{className:"text-lg font-semibold text-white",children:"BUZZING..."})]}):t?se.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[se.jsx($r,{className:"w-12 h-12 text-white"}),se.jsx("span",{className:"text-lg font-semibold text-white",children:"BLOCCATO"})]}):se.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[se.jsxs("h1",{className:"text-4xl font-orbitron font-bold",children:[se.jsx("span",{className:"text-[#00ffff]",children:"BU"}),se.jsx("span",{className:"text-white",children:"ZZ"})]}),se.jsxs("div",{className:"text-sm font-medium bg-white/20 px-3 py-1 rounded-full backdrop-blur-sm text-white",children:["XP: ",s.buzz_xp_progress,"/100"]}),se.jsxs("div",{className:"text-sm font-medium bg-white/20 px-4 py-2 rounded-full backdrop-blur-sm text-white",children:["",e.toFixed(2)]})]})})},Nw=({show:e})=>e?se.jsx(et.div,{className:"absolute w-48 h-48 rounded-full border-4 border-[#F213A4]",initial:{scale:0,opacity:.8},animate:{scale:3.5,opacity:0},transition:{duration:.8,ease:"easeOut"},style:{zIndex:10,borderWidth:"3px",filter:"blur(0.5px)",borderColor:"#F213A4"}},Date.now()):null,jw=()=>{const[e,t]=We.useState(!1),[i,a]=We.useState(!1),[s,r]=We.useState(null),[n,o]=We.useState(null),{user:l}=sn();We.useEffect(()=>{(async()=>{if(l)try{const{data:e,error:t}=await ba.from("user_payment_methods").select("*").eq("user_id",l.id).eq("is_default",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(t)return void console.error(" M1SSION Error loading default payment method:",t);e&&(o(e),e.brand,e.last4)}catch(e){console.error(" M1SSION Error in loadDefaultPaymentMethod:",e)}})()},[l]);const c=async e=>{if(!l)return console.warn(" M1SSION STRIPE BLOCK: No authenticated user"),void Ki.error("Devi essere loggato per effettuare pagamenti");e.type,e.amount,l.id,n&&(n.brand,n.last4),(new Date).toISOString();const t={...e,metadata:{...e.metadata,default_payment_method:n?.stripe_pm_id,auto_fill_enabled:!!n}};r(t),a(!0)};return{processBuzzPayment:async(e,t=!1)=>{const i={type:t?"buzz_map":"buzz",amount:e,description:t?"M1SSION BUZZ MAPPA - Area geolocalizzata":"M1SSION BUZZ - Indizio premium",metadata:{is_buzz_map:t,mission:"M1SSION",reset_date:"2025-07-22"}};await c(i)},processSubscription:async e=>{const{getPriceCents:t,getPriceEur:i}=await ae(async()=>{const{getPriceCents:e,getPriceEur:t}=await Promise.resolve().then(()=>bz);return{getPriceCents:e,getPriceEur:t}},void 0),a=t(e),s=i(e);if(!a||!s)return void Ki.error("Piano di abbonamento non valido");const r={type:"subscription",amount:a,description:`Piano ${e} con vantaggi premium`,plan:e,metadata:{subscription_plan:e,price_cents:a,price_eur:s,mission:"M1SSION",reset_date:"2025-07-22"}};await c(r)},showCheckout:i,paymentConfig:s,loading:e,setLoading:t,defaultPaymentMethod:n,closeCheckout:()=>{e||(a(!1),r(null))},handlePaymentSuccess:async e=>{try{if("buzz"===s?.type||"buzz_map"===s?.type){if(!e)return console.error(" Missing paymentIntentId for buzz payment success"),Ki.error("Pagamento completato, ma manca il riferimento del pagamento. Aggiorna e riprova."),{ok:!1};const{data:t,error:i}=await ba.functions.invoke("handle-buzz-payment-success",{body:{payment_intent_id:e,user_id:l?.id,amount:s.amount,is_buzz_map:"buzz_map"===s.type,metadata:s.metadata}});if(i)return console.error(" BUZZ payment success error:",i),i.message?.includes("Missing paymentIntentId")?Ki.error("Pagamento ok ma manca il riferimento. Aggiorna e riprova."):Ki.error("Operazione non riuscita. Riprova tra poco."),{ok:!1};{let e="";return"buzz"===s.type?(e=t?.clue_text||t?.metadata?.clue_text||t?.message||"",e?(Ki.success(" Nuovo indizio BUZZ!",{description:e,duration:5e3,position:"top-center",style:{zIndex:9999,background:"linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)",color:"white",fontWeight:"bold",fontSize:"14px",padding:"12px 16px"}}),{ok:!0,clue_text:e,skipFollowUpBuzzPress:!0}):(console.warn(" M1SSION No clue_text found in response"),Ki.success(" BUZZ acquistato con successo!"),{ok:!0,skipFollowUpBuzzPress:!0})):(Ki.success(" Area BUZZ acquistata con successo!"),{ok:!0})}}return"subscription"===s?.type?(await ba.functions.invoke("handle-payment-success",{body:{payment_intent_id:e,user_id:l?.id,plan:s.plan}}),Ki.success(` Abbonamento ${s.plan} attivato!`),{ok:!0}):(a(!1),r(null),{ok:!0})}catch(t){return console.error(" M1SSION STRIPE: Error handling payment success",t),Ki.error("Errore nella finalizzazione del pagamento"),{ok:!1}}}}},Sw=[{minClick:1,maxClick:10,priceEur:1.99,priceCents:199},{minClick:11,maxClick:20,priceEur:3.99,priceCents:399},{minClick:21,maxClick:30,priceEur:5.99,priceCents:599},{minClick:31,maxClick:40,priceEur:7.99,priceCents:799},{minClick:41,maxClick:50,priceEur:9.99,priceCents:999},{minClick:51,maxClick:9999,priceEur:10.99,priceCents:1099}],_w=e=>{const t=e+1,i=Sw.find(e=>t>=e.minClick&&t<=e.maxClick);if(!i){const e=Sw[Sw.length-1];return{priceEur:e.priceEur,priceCents:e.priceCents}}return{priceEur:i.priceEur,priceCents:i.priceCents}},kw=e=>{const{priceCents:t}=_w(e);return t},Cw=e=>{const[t,i]=We.useState(0),a=We.useCallback(async()=>{if(e)try{const{data:t,error:a}=await ba.from("user_buzz_counter").select("buzz_count").eq("user_id",e).eq("date",(new Date).toISOString().split("T")[0]).single();if(a&&"PGRST116"!==a.code)return void console.error("Error loading daily buzz counter:",a);const s=t?.buzz_count||0;i(s)}catch(t){console.error("Exception loading daily buzz counter:",t)}},[e]),s=We.useCallback(async()=>{if(!e)return 0;const a=t+1;try{return await ba.from("user_buzz_counter").upsert({user_id:e,date:(new Date).toISOString().split("T")[0],buzz_count:a}),i(a),a}catch(s){return console.error("Exception updating daily buzz counter:",s),t}},[e,t]),r=We.useCallback(()=>_w(t),[t]),n=We.useCallback(()=>(e=>{const{priceEur:t}=_w(e);return`${t.toFixed(2)}`})(t),[t]),o=We.useCallback(()=>kw(t),[t]);return We.useEffect(()=>{e&&a()},[e,a]),{dailyBuzzCounter:t,loadDailyBuzzCounter:a,updateDailyBuzzCounter:s,getCurrentBuzzPrice:r,getCurrentBuzzDisplayPrice:n,getCurrentBuzzPriceCents:o}};function Aw(e){const t=We.useRef({value:e,previous:e});return We.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var zw="Checkbox",[Ew]=re(zw),[Iw,Pw]=Ew(zw);function Tw(e){const{__scopeCheckbox:t,checked:i,children:a,defaultChecked:s,disabled:r,form:n,name:o,onCheckedChange:l,required:c,value:d="on",internal_do_not_use_render:u}=e,[h,m]=de({prop:i,defaultProp:s??!1,onChange:l,caller:zw}),[p,f]=We.useState(null),[g,x]=We.useState(null),b=We.useRef(!1),v=!p||(!!n||!!p.closest("form")),y={checked:h,disabled:r,setChecked:m,control:p,setControl:f,name:o,form:n,value:d,hasConsumerStoppedPropagationRef:b,required:c,defaultChecked:!qw(s)&&s,isFormControl:v,bubbleInput:g,setBubbleInput:x};return se.jsx(Iw,{scope:t,...y,children:Uw(u)?u(y):a})}var Mw="CheckboxTrigger",Lw=We.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:i,...a},s)=>{const{control:r,value:n,disabled:o,checked:l,required:c,setControl:d,setChecked:u,hasConsumerStoppedPropagationRef:h,isFormControl:m,bubbleInput:p}=Pw(Mw,e),f=ue(s,d),g=We.useRef(l);return We.useEffect(()=>{const e=r?.form;if(e){const t=()=>u(g.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[r,u]),se.jsx(ne.button,{type:"button",role:"checkbox","aria-checked":qw(l)?"mixed":l,"aria-required":c,"data-state":$w(l),"data-disabled":o?"":void 0,disabled:o,value:n,...a,ref:f,onKeyDown:he(t,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:he(i,e=>{u(e=>!!qw(e)||!e),p&&m&&(h.current=e.isPropagationStopped(),h.current||e.stopPropagation())})})});Lw.displayName=Mw;var Fw=We.forwardRef((e,t)=>{const{__scopeCheckbox:i,name:a,checked:s,defaultChecked:r,required:n,disabled:o,value:l,onCheckedChange:c,form:d,...u}=e;return se.jsx(Tw,{__scopeCheckbox:i,checked:s,defaultChecked:r,disabled:o,required:n,onCheckedChange:c,name:a,form:d,value:l,internal_do_not_use_render:({isFormControl:e})=>se.jsxs(se.Fragment,{children:[se.jsx(Lw,{...u,ref:t,__scopeCheckbox:i}),e&&se.jsx(Bw,{__scopeCheckbox:i})]})})});Fw.displayName=zw;var Ow="CheckboxIndicator",Dw=We.forwardRef((e,t)=>{const{__scopeCheckbox:i,forceMount:a,...s}=e,r=Pw(Ow,i);return se.jsx(ce,{present:a||qw(r.checked)||!0===r.checked,children:se.jsx(ne.span,{"data-state":$w(r.checked),"data-disabled":r.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...e.style}})})});Dw.displayName=Ow;var Rw="CheckboxBubbleInput",Bw=We.forwardRef(({__scopeCheckbox:e,...t},i)=>{const{control:a,hasConsumerStoppedPropagationRef:s,checked:r,defaultChecked:n,required:o,disabled:l,name:c,value:d,form:u,bubbleInput:h,setBubbleInput:m}=Pw(Rw,e),p=ue(i,m),f=Aw(r),g=me(a);We.useEffect(()=>{const e=h;if(!e)return;const t=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(t,"checked").set,a=!s.current;if(f!==r&&i){const t=new Event("click",{bubbles:a});e.indeterminate=qw(r),i.call(e,!qw(r)&&r),e.dispatchEvent(t)}},[h,f,r,s]);const x=We.useRef(!qw(r)&&r);return se.jsx(ne.input,{type:"checkbox","aria-hidden":!0,defaultChecked:n??x.current,required:o,disabled:l,name:c,value:d,form:u,...t,tabIndex:-1,ref:p,style:{...t.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function Uw(e){return"function"==typeof e}function qw(e){return"indeterminate"===e}function $w(e){return qw(e)?"indeterminate":e?"checked":"unchecked"}Bw.displayName=Rw;const Ww=We.forwardRef(({className:e,...t},i)=>se.jsx(Fw,{ref:i,className:eo("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:se.jsx(Dw,{className:eo("flex items-center justify-center text-current"),children:se.jsx(os,{className:"h-4 w-4"})})}));let Hw;Ww.displayName=Fw.displayName;let Zw=null;async function Vw(){try{return await function(){if(!Hw){const e="pk_test_51QJWtNRp5StPxareRp0GNVD9BT0auKQ8LEeezlPROQcwiDQ6nGOd0UihU5Y9fjJFD3naTwx3YsHoPPzlJ5Alk4pD00FhZM6lyZ";e.startsWith("pk_live_")||console.warn(" VITE_STRIPE_PUBLISHABLE_KEY is not a LIVE key:",e.substring(0,10)+"..."),e.substring(0,10),Hw=ut(e)}return Hw}()}catch(e){console.warn("[StripeFallback] core getStripe failed, attempting fallback:",e)}if(!Zw){const e=function(){try{const e=import.meta?.env?.VITE_STRIPE_PUBLISHABLE_KEY;if(e&&"string"==typeof e&&e.startsWith("pk_"))return e}catch(t){}const e="undefined"!=typeof window?window:void 0;return e?.__STRIPE_PK__&&"string"==typeof e.__STRIPE_PK__?e.__STRIPE_PK__:e?.ENV?.VITE_STRIPE_PUBLISHABLE_KEY&&"string"==typeof e.ENV.VITE_STRIPE_PUBLISHABLE_KEY?e.ENV.VITE_STRIPE_PUBLISHABLE_KEY:null}();e?Zw=ut(e):(console.warn("[StripeFallback] No publishable key detected. Returning null."),Zw=Promise.resolve(null))}return Zw}try{const e="undefined"!=typeof window?window:void 0;e&&"function"!=typeof e.getStripe&&(e.getStripe=Vw,e.__getStripeSafe=Vw)}catch(pB){}const Gw=Object.freeze(Object.defineProperty({__proto__:null,getStripeSafe:Vw},Symbol.toStringTag,{value:"Module"}));Vw();const Yw=({onClose:e,onAddCard:t,loading:i})=>{const[a,s]=We.useState(!1),[r,n]=We.useState(null),[o,l]=We.useState({cardNumber:"",expiryMonth:"",expiryYear:"",cvc:"",nameOnCard:"",saveForFuture:!0}),c=We.useCallback(e=>{const t=e.replace(/\s+/g,"").replace(/[^0-9]/gi,""),i=t.match(/\d{4,16}/g),a=i&&i[0]||"";let s=[];for(let r=0,n=a.length;r<n;r+=4){const e=a.substring(r,r+4);s=[...s,e]}return s.length?s.join(" "):t},[]),d=We.useCallback(e=>{const t=c(e.target.value);l(e=>({...e,cardNumber:t})),n(null)},[c]),u=We.useCallback(e=>{const t=e.replace(/\s/g,"");return t.startsWith("4")?"Visa":t.startsWith("5")||t.startsWith("2")?"Mastercard":t.startsWith("3")?"American Express":t.startsWith("6")?"Discover":"Unknown"},[]),h=We.useCallback(()=>{const{cardNumber:e,expiryMonth:t,expiryYear:i,cvc:a,nameOnCard:s}=o;if(!e||e.replace(/\s/g,"").length<13)return"Numero carta non valido (minimo 13 cifre)";if(!t||parseInt(t)<1||parseInt(t)>12)return"Mese di scadenza non valido (01-12)";const r=(new Date).getFullYear(),n=(new Date).getMonth()+1,l=parseInt(i),c=parseInt(t);return!i||l<r||l===r&&c<n?"Data di scadenza non valida (carta scaduta)":!a||a.length<3?"CVC non valido (minimo 3 cifre)":!s||s.trim().length<2?"Nome sulla carta richiesto (minimo 2 caratteri)":null},[o]),m=We.useCallback(()=>{a||e()},[a,e]),p=null===h();return se.jsx(tt,{children:se.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",children:se.jsx(et.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"w-full max-w-md",children:se.jsxs(Wl,{className:"bg-gradient-to-br from-[#131524] to-[#1a1d3a] border-[#00D1FF]/30",children:[se.jsx(Hl,{className:"pb-4",children:se.jsxs(Zl,{className:"flex items-center justify-between text-white",children:[se.jsxs("div",{className:"flex items-center",children:[se.jsx(js,{className:"w-5 h-5 mr-2 text-[#00D1FF]"}),"Aggiungi Nuova Carta"]}),se.jsx(mo,{variant:"ghost",size:"icon",onClick:m,disabled:a,className:"text-white hover:bg-white/10 h-8 w-8",children:se.jsx($r,{className:"h-4 w-4"})})]})}),se.jsxs(Gl,{className:"space-y-4",children:[r&&se.jsx("div",{className:"p-3 bg-red-900/30 border border-red-500/40 rounded-lg",children:se.jsxs("div",{className:"flex items-start space-x-2",children:[se.jsx(us,{className:"w-4 h-4 text-red-400 mt-0.5 flex-shrink-0"}),se.jsxs("div",{children:[se.jsx("p",{className:"text-red-200 text-sm font-medium",children:"Errore"}),se.jsx("p",{className:"text-red-300/90 text-xs",children:r})]})]})}),se.jsxs("form",{onSubmit:async i=>{i.preventDefault();const a=h();if(a)return n(a),void Ki.error("Dati non validi",{description:a});s(!0),n(null);try{const i=u(o.cardNumber),a=o.cardNumber.replace(/\s/g,"").slice(-4),s=await(async()=>{try{const e=o.cardNumber.replace(/\s/g,"");let t=0,i=!1;for(let s=e.length-1;s>=0;s--){let a=parseInt(e[s]);i&&(a*=2,a>9&&(a-=9)),t+=a,i=!i}if(t%10!=0)throw new Error("Numero carta non valido");const a={id:`pm_validated_${Math.random().toString(36).substring(2,15)}`,card:{brand:u(o.cardNumber).toLowerCase(),last4:e.slice(-4),exp_month:parseInt(o.expiryMonth),exp_year:parseInt(o.expiryYear)}};return a.id,a}catch(e){throw console.error(" Errore validazione carta:",e),e}})();await t({...o,stripeToken:s.id}),Ki.success(" Carta aggiunta",{description:`${i} ${a} salvata correttamente`}),e()}catch(r){console.error(" Errore salvataggio carta:",r);const e=r instanceof Error?r.message:"Errore durante il salvataggio";n(e),Ki.error(" Errore salvataggio",{description:e.includes("Invalid")?"Dati carta non validi":"Impossibile salvare la carta. Riprova."})}finally{s(!1)}},className:"space-y-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"cardNumber",className:"text-white text-sm",children:" Numero Carta"}),se.jsx(Sl,{id:"cardNumber",type:"text",value:o.cardNumber,onChange:d,placeholder:"1234 5678 9012 3456",maxLength:19,autoFocus:!0,disabled:a,className:"bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 font-mono",required:!0})]}),se.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"expiryMonth",className:"text-white text-xs",children:"Mese"}),se.jsx(Sl,{id:"expiryMonth",type:"text",value:o.expiryMonth,onChange:e=>{const t=e.target.value.replace(/\D/g,"");t.length<=2&&(""===t||parseInt(t)>=1&&parseInt(t)<=12)&&(l(e=>({...e,expiryMonth:t})),n(null))},placeholder:"MM",maxLength:2,disabled:a,className:"bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 text-center font-mono",required:!0})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"expiryYear",className:"text-white text-xs",children:"Anno"}),se.jsx(Sl,{id:"expiryYear",type:"text",value:o.expiryYear,onChange:e=>{const t=e.target.value.replace(/\D/g,"");t.length<=4&&(l(e=>({...e,expiryYear:t})),n(null))},placeholder:"YYYY",maxLength:4,disabled:a,className:"bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 text-center font-mono",required:!0})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"cvc",className:"text-white text-xs",children:"CVC"}),se.jsx(Sl,{id:"cvc",type:"password",value:o.cvc,onChange:e=>{const t=e.target.value.replace(/\D/g,"");t.length<=4&&(l(e=>({...e,cvc:t})),n(null))},placeholder:"123",maxLength:4,disabled:a,className:"bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 text-center font-mono",required:!0})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"nameOnCard",className:"text-white text-sm",children:" Nome sulla Carta"}),se.jsx(Sl,{id:"nameOnCard",type:"text",value:o.nameOnCard,onChange:e=>{l(t=>({...t,nameOnCard:e.target.value.toUpperCase()})),n(null)},placeholder:"MARIO ROSSI",disabled:a,className:"bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 uppercase",required:!0})]}),se.jsx("div",{className:"bg-[#00D1FF]/10 border border-[#00D1FF]/30 rounded-lg p-3",children:se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(Ww,{id:"saveForFuture",checked:o.saveForFuture,onCheckedChange:e=>{l(t=>({...t,saveForFuture:!!e}))},disabled:a,className:"border-[#00D1FF]/50 data-[state=checked]:bg-[#00D1FF] data-[state=checked]:border-[#00D1FF]"}),se.jsxs("div",{className:"flex-1",children:[se.jsx(jl,{htmlFor:"saveForFuture",className:"text-[#00D1FF] text-sm cursor-pointer",children:" Salva per pagamenti futuri"}),se.jsx("p",{className:"text-white/60 text-xs",children:"Sicuro e crittografato tramite Stripe PCI DSS"})]})]})}),se.jsx("div",{className:"bg-green-900/20 border border-green-500/30 rounded-lg p-3",children:se.jsxs("div",{className:"flex items-start space-x-2",children:[se.jsx(vr,{className:"w-4 h-4 text-green-400 mt-0.5 flex-shrink-0"}),se.jsxs("div",{className:"text-green-100",children:[se.jsxs("p",{className:"text-xs font-semibold mb-1 flex items-center",children:[se.jsx(Zs,{className:"w-3 h-3 mr-1"}),"Sicurezza PCI DSS Level 1"]}),se.jsx("p",{className:"text-green-200/90 text-xs",children:"Dati tokenizzati via Stripe. M1SSION non memorizza mai numeri completi."})]})]})}),o.cardNumber&&se.jsx("div",{className:"text-center",children:se.jsxs("div",{className:"inline-flex items-center px-2 py-1 bg-white/10 rounded text-xs",children:[se.jsx(js,{className:"w-3 h-3 mr-1 text-[#00D1FF]"}),se.jsxs("span",{className:"text-white/80",children:[u(o.cardNumber)," Rilevata"]})]})}),se.jsxs("div",{className:"flex space-x-3 pt-2",children:[se.jsx(mo,{type:"button",variant:"outline",onClick:m,disabled:a,className:"flex-1 border-white/40 text-white hover:bg-white/10 h-11",children:"Annulla"}),se.jsx(mo,{type:"submit",disabled:a||!p,className:"flex-1 bg-[#00D1FF] hover:bg-[#00B8E6] text-black font-semibold h-11 disabled:opacity-50 disabled:cursor-not-allowed",children:a?se.jsxs("div",{className:"flex items-center justify-center",children:[se.jsx("div",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin mr-2"}),"Salvando..."]}):"Salva Carta"})]})]})]})]})})})})};function Kw(){const[e,t]=We.useState("unknown"),[i,a]=We.useState(!0),[s,r]=We.useState(null),[n,o]=We.useState(),[l,c]=We.useState(),d=async()=>{try{a(!0),r(null);const{data:e,error:i}=await ba.functions.invoke("stripe-mode",{method:"POST"});if(i)return console.error(" [useStripeMode] Supabase error:",i),r(i.message),void t("unknown");const s=e;t(s.mode||"unknown"),o(s.keyPrefix),c(s.hasKey)}catch(e){console.error(" [useStripeMode] Fetch error:",e),r(e instanceof Error?e.message:"Unknown error"),t("unknown")}finally{a(!1)}};return We.useEffect(()=>{d()},[]),{mode:e,loading:i,error:s,keyPrefix:n,hasKey:l,refresh:d}}const Xw=({config:e,onSuccess:t,onCancel:i})=>{const[a,s]=We.useState(null),[r,n]=We.useState(!1),[o,l]=We.useState(!1),[c,d]=We.useState(!1),{user:u}=sn(),{mode:h}=Kw();We.useEffect(()=>{(async()=>{if(u)try{u.id;const{data:e,error:t}=await ba.from("user_payment_methods").select("*").eq("user_id",u.id).eq("is_default",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(t)return void console.error(" M1SSION Error loading saved card:",t);e&&(s(e),e.brand,e.last4)}catch(e){console.error(" M1SSION Error in loadDefaultCard:",e)}})()},[u]);const m=async e=>{try{const{data:t,error:i}=await ba.from("user_payment_methods").insert({user_id:u.id,stripe_pm_id:e.stripeToken||`pm_${Math.random().toString(36).substring(2,15)}`,brand:"4"===e.cardNumber?.charAt(0)?"visa":"mastercard",last4:e.cardNumber?.replace(/\s/g,"").slice(-4)||"0000",exp_month:parseInt(e.expiryMonth),exp_year:parseInt(e.expiryYear),is_default:e.saveForFuture||!0});if(i)throw i;Ki.success("Carta salvata con successo!"),l(!1),window.location.reload()}catch(t){console.error(" M1SSION Error saving card:",t),Ki.error("Errore nel salvare la carta")}};return o?se.jsx(Yw,{onClose:()=>l(!1),onAddCard:m,loading:r}):c||!a?se.jsxs(Wl,{className:"w-full max-w-md mx-auto bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30 max-h-[85vh] overflow-y-auto",children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"text-center text-white",children:[" ","subscription"===e.type?`Abbonamento ${e.plan}`:"buzz_map"===e.type?"BUZZ MAPPA":"BUZZ Payment"]}),se.jsxs("div",{className:"text-center text-gray-300",children:[se.jsxs("div",{className:"text-xl font-bold",children:["",(e.amount/100).toFixed(2),"subscription"===e.type?"/mese":""]}),se.jsx("div",{className:"text-sm",children:e.description})]})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"text-center text-gray-400",children:[se.jsx(js,{className:"w-12 h-12 mx-auto mb-3"}),se.jsx("p",{className:"mb-4",children:"Nessuna carta salvata trovata"}),se.jsxs(mo,{onClick:()=>l(!0),className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:[se.jsx(nr,{className:"w-4 h-4 mr-2"}),"Aggiungi Carta"]})]}),se.jsx("div",{className:"flex gap-2 mt-4",children:se.jsx(mo,{variant:"outline",onClick:i,className:"flex-1",children:"Annulla"})})]})]}):se.jsxs(Wl,{className:"w-full max-w-md mx-auto bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30 max-h-[85vh] overflow-y-auto",children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"text-center text-white",children:[" ","subscription"===e.type?`Abbonamento ${e.plan}`:"buzz_map"===e.type?"BUZZ MAPPA":"BUZZ Payment"]}),se.jsxs("div",{className:"text-center text-gray-300",children:[se.jsxs("div",{className:"text-xl font-bold",children:["",(e.amount/100).toFixed(2),"subscription"===e.type?"/mese":""]}),se.jsx("div",{className:"text-sm",children:e.description})]})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsx("div",{className:"p-4 bg-gray-800/50 rounded-lg border border-gray-600",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[(e=>{const t={visa:"bg-blue-600",mastercard:"bg-red-600",amex:"bg-green-600",discover:"bg-orange-600",default:"bg-gray-600"};return se.jsx("div",{className:`w-8 h-6 rounded ${t[e.toLowerCase()]||t.default} flex items-center justify-center text-white text-xs font-bold`,children:e.slice(0,2).toUpperCase()})})(a.brand),se.jsxs("div",{children:[se.jsxs("div",{className:"text-white font-medium",children:["**** **** **** ",a.last4]}),se.jsxs("div",{className:"text-gray-400 text-sm",children:[a.brand.charAt(0).toUpperCase()+a.brand.slice(1),"  ",a.exp_month.toString().padStart(2,"0"),"/",a.exp_year.toString().slice(-2)]})]})]}),se.jsx("div",{className:"text-green-400 text-sm font-medium",children:" Predefinita"})]})}),se.jsxs("div",{className:"space-y-3",children:[se.jsx(mo,{onClick:async()=>{if(a&&u){n(!0);try{a.stripe_pm_id;const{data:i,error:s}=await ba.functions.invoke("create-payment-intent",{body:{amount:e.amount,currency:"eur",payment_type:"buzz_map",plan:"one_time"}});if(s)return console.error(" M1SSION Payment error:",s),"not_authenticated"===s.code||s.message?.includes("401")?void Ki.error("Devi accedere per usare questa funzione."):"card_declined"===s.code?void Ki.error(`Carta rifiutata: ${s.message}`):void Ki.error(`Errore pagamento: ${s.message||"Errore sconosciuto"} (${s.code||"unknown"})`);const r=i?.client_secret||i?.clientSecret;if(r&&a?.stripe_pm_id){e.amount;const i=await(await ae(async()=>{const{getStripeSafe:e}=await Promise.resolve().then(()=>Gw);return{getStripeSafe:e}},void 0)).getStripeSafe();if(!i)throw new Error("Stripe non inizializzato");const{error:s,paymentIntent:n}=await i.confirmCardPayment(r,{payment_method:a.stripe_pm_id});if(s)throw console.error(" M1SSION Stripe confirmation error:",s),new Error(s.message||"Errore nella conferma del pagamento");if("succeeded"===n?.status)window.dispatchEvent(new CustomEvent("paymentIntentSucceeded",{detail:{paymentIntentId:n.id}})),t(n.id);else{if("requires_action"!==n?.status)throw new Error(`Stato pagamento non gestito: ${n?.status}`);Ki.info("Autenticazione aggiuntiva richiesta")}}else i?.payment_intent_id&&t(i.payment_intent_id)}catch(i){console.error(" M1SSION Payment processing error:",i),Ki.error("Errore nel processare il pagamento")}finally{n(!1)}}},disabled:r,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:r?"Elaborazione...":`Usa questa carta - ${(e.amount/100).toFixed(2)}`}),se.jsxs(mo,{variant:"outline",onClick:()=>l(!0),className:"w-full",disabled:r,children:[se.jsx(nr,{className:"w-4 h-4 mr-2"}),"Usa altra carta"]})]}),se.jsx("div",{className:"flex gap-2",children:se.jsx(mo,{variant:"outline",onClick:i,className:"flex-1",disabled:r,children:"Annulla"})}),se.jsx("div",{className:"text-xs text-gray-400 text-center",children:" Pagamento sicuro elaborato da Stripe"})]})]})},Jw=Vw(),Qw=({config:e,onSuccess:t,onCancel:i})=>{const a=mt(),s=pt(),[r,n]=We.useState(!1),[o,l]=We.useState(""),{user:c}=sn(),{mode:d}=Kw();We.useEffect(()=>{if(!c)return;(async()=>{try{e.type;const{data:t,error:i}=await ba.functions.invoke("create-payment-intent",{body:{amount:e.amount,currency:"eur",payment_type:"buzz_map",plan:"one_time"}});if(i)return console.error(" M1SSION Payment intent error:",i),"not_authenticated"===i.code||i.message?.includes("401")?void Ki.error("Devi accedere per usare questa funzione."):"card_declined"===i.code?void Ki.error(`Carta rifiutata: ${i.message}`):i.message?.includes("mismatch")?void Ki.error(`Errore configurazione Stripe: ${i.message}`):void Ki.error(`Errore pagamento: ${i.message||"Errore sconosciuto"} (${i.code||"unknown"})`);const a=t?.client_secret||t?.clientSecret;if(!a)return console.error(" M1SSION No client secret received:",t),void Ki.error("Errore nella configurazione del pagamento");l(a),e.amount}catch(t){console.error(" M1SSION Payment intent failed:",t),Ki.error("Errore nel sistema di pagamento")}})()},[c,e]);return se.jsxs(Wl,{className:"w-full max-w-md mx-auto bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30 max-h-[85vh] overflow-y-auto",children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"text-center text-white",children:[" ","subscription"===e.type?`Abbonamento ${e.plan}`:"buzz_map"===e.type?"BUZZ MAPPA":"BUZZ Payment"]}),se.jsxs("div",{className:"text-center text-gray-300",children:[se.jsxs("div",{className:"text-xl font-bold",children:["",(e.amount/100).toFixed(2),"subscription"===e.type?"/mese":""]}),se.jsx("div",{className:"text-sm",children:e.description})]})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!a||!s||!o)return void Ki.error("Sistema di pagamento non pronto");n(!0);const i=s.getElement(ft);if(!i)return Ki.error("Elemento carta non trovato"),void n(!1);try{const{error:e,paymentIntent:s}=await a.confirmCardPayment(o,{payment_method:{card:i,billing_details:{email:c?.email||""}}});if(e){console.error(" M1SSION Payment failed:",e);const t=e.code||"unknown",i=e.message||"Errore sconosciuto";Ki.error(`Pagamento fallito: ${i} (${t})`)}else"succeeded"===s.status&&(s.id,window.dispatchEvent(new CustomEvent("paymentIntentSucceeded",{detail:{paymentIntentId:s.id}})),t(s.id))}catch(r){console.error(" M1SSION Payment processing error:",r),Ki.error("Errore nel processare il pagamento")}finally{n(!1)}},className:"space-y-4",children:[se.jsx("div",{className:"p-4 bg-gray-800/50 rounded-lg border border-gray-600",children:se.jsx(ft,{options:{style:{base:{fontSize:"16px",color:"#ffffff","::placeholder":{color:"#aab7c4"},backgroundColor:"transparent"},invalid:{color:"#fa755a",iconColor:"#fa755a"}},hidePostalCode:!0}})}),se.jsxs("div",{className:"flex gap-2",children:[se.jsx(mo,{type:"button",variant:"outline",onClick:i,className:"flex-1",disabled:r,children:"Annulla"}),se.jsx(mo,{type:"submit",disabled:!a||r||!o,className:"flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:r?"Elaborazione...":`Paga ${(e.amount/100).toFixed(2)}`})]})]}),se.jsx("div",{className:"text-xs text-gray-400 text-center",children:" Pagamento sicuro elaborato da Stripe"})]})]})},eN=({config:e,onSuccess:t,onCancel:i})=>{const[a,s]=We.useState(!1),{user:r}=sn();We.useEffect(()=>{(async()=>{if(r)try{const{data:e,error:t}=await ba.from("user_payment_methods").select("id").eq("user_id",r.id).eq("is_default",!0).maybeSingle();s(!(t||!e))}catch(e){console.error(" M1SSION Error checking default payment method:",e),s(!1)}})()},[r]);return se.jsx("div",{className:"fixed inset-0 bg-black/95 backdrop-blur-sm flex items-center justify-center p-4 z-[9999] overflow-y-auto",style:{paddingTop:"calc(env(safe-area-inset-top, 47px) + 20px)",paddingBottom:"calc(env(safe-area-inset-bottom, 34px) + 20px)",maxHeight:"100dvh"},children:a?se.jsx(Xw,{config:e,onSuccess:t,onCancel:i}):se.jsx(ht,{stripe:Jw,options:{appearance:{theme:"night",variables:{colorPrimary:"#8b5cf6",colorBackground:"#1f2937",colorText:"#ffffff",colorDanger:"#df1b41",fontFamily:"system-ui, sans-serif",spacingUnit:"4px",borderRadius:"8px"}}},children:se.jsx(Qw,{config:e,onSuccess:t,onCancel:i})})})},tN=globalThis.__buzzToastLock??{shown:!1,t:0};globalThis.__buzzToastLock=tN;const iN=({isBlocked:e,onSuccess:t,isWalkthroughMode:i=!1})=>{const{user:a}=bl(),{hasFreeBuzz:s,consumeFreeBuzz:r,totalRemaining:n,dailyUsed:o}=(()=>{const[e,t]=We.useState([]),[i,a]=We.useState(0),[s,r]=We.useState(!1),[n,o]=We.useState(null),[l,c]=We.useState(!1),d=async()=>{r(!0),o(null);try{const e=(new Date).toISOString().split("T")[0],{data:i,error:s}=await ba.from("user_buzz_counter").select("*").eq("user_id",(await ba.auth.getUser()).data.user?.id).eq("date",e).single();i&&i.buzz_count>0?c(!0):c(!1);const{data:r,error:n}=await ba.from("buzz_grants").select("*").gt("remaining",0).order("created_at",{ascending:!1});if(n)throw n;t(r||[]);const o=(r||[]).reduce((e,t)=>e+t.remaining,0);a(o)}catch(e){console.error("Error fetching buzz grants:",e),o(e instanceof Error?e.message:"Unknown error"),t([]),a(0)}finally{r(!1)}};return We.useEffect(()=>{d()},[]),{grants:e,totalRemaining:i,isLoading:s,error:n,fetchGrants:d,consumeFreeBuzz:async()=>{if(l)return!1;if(i<=0)return!1;try{const t=(new Date).toISOString().split("T")[0],i=(await ba.auth.getUser()).data.user?.id;if(!i)return console.error(" No user ID found"),!1;const{data:a}=await ba.from("user_buzz_counter").select("buzz_count").eq("user_id",i).eq("date",t).single();if(a&&a.buzz_count>0)return c(!0),!1;const s=e.find(e=>e.remaining>0);if(!s)return!1;s.id;const{error:r}=await ba.from("buzz_grants").update({remaining:s.remaining-1,updated_at:(new Date).toISOString()}).eq("id",s.id);if(r)throw r;const n=`Cerca dove l'innovazione italiana splende (${(new Date).toLocaleTimeString()}) - FREE BUZZ ${Date.now()}`,{error:o}=await ba.from("user_clues").insert({user_id:i,clue_id:`free_buzz_${Date.now()}`,title_it:" Indizio BUZZ Gratuito",description_it:n,clue_type:"buzz",buzz_cost:0,week_number:Math.ceil(Date.now()/6048e5)});o&&console.error(" Error saving free buzz clue:",o);const{error:l}=await ba.from("user_notifications").insert({user_id:i,type:"buzz",title:" Nuovo Indizio BUZZ Gratuito!",message:n,is_read:!1,metadata:{free:!0,source:"buzz_grant"}});l&&console.error(" Error saving free buzz notification:",l);const{error:u}=await ba.from("user_mission_status").upsert({user_id:i,clues_found:1,mission_progress_percent:Math.round(.5),updated_at:(new Date).toISOString()});return u&&console.error(" Error triggering mission status update:",u),c(!0),await d(),!0}catch(t){return console.error("Error consuming free buzz:",t),!1}},hasFreeBuzz:i>0&&!l,dailyUsed:l}})(),{dailyBuzzCounter:l,getCurrentBuzzPriceCents:c,getCurrentBuzzDisplayPrice:d,updateDailyBuzzCounter:u}=Cw(a?.id),h=s?0:c(),m=h/100;s||d();const{processBuzzPayment:p,showCheckout:f,paymentConfig:g,closeCheckout:x,handlePaymentSuccess:b}=jw(),{buzzing:v,showShockwave:y,handleBuzz:w}=yw({currentPrice:m,onSuccess:t,hasFreeBuzz:s}),N=We.useRef(!1),j=async()=>{if(a)try{const{data:e,error:i}=await ba.rpc("consume_credit",{p_user_id:a.id,p_credit_type:"buzz"});if(i||!e)return console.error("consume_credit error",i),void Ki.error("Nessun credito BUZZ disponibile");const{data:s,error:r}=await ba.functions.invoke("handle-buzz-press",{body:{user_id:a.id,generateMap:!1,metadata:{free:!0,source:"qr_reward_or_xp_reward"}}});if(r)return console.error("handle-buzz-press error",r),void Ki.error("Errore durante l'uso del BUZZ gratuito");s?.clue_text?Ki.success(s.clue_text,{duration:4e3,position:"top-center",style:{zIndex:9999,background:"linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)",color:"white",fontWeight:"bold"}}):Ki.success("BUZZ gratuito utilizzato!"),await u(),t()}catch(e){console.error("redeemFreeBuzz exception",e),Ki.error("Errore durante il riscatto gratuito")}finally{(()=>{try{const e=new URL(window.location.href);e.searchParams.delete("free"),e.searchParams.delete("reward"),window.history.replaceState({},"",e.pathname+(e.searchParams.toString()?`?${e.searchParams.toString()}`:""))}catch{}})()}else Ki.error("Devi essere loggato per usare il BUZZ gratuito")};We.useEffect(()=>{if(!N.current)try{const e=new URLSearchParams(window.location.search);"1"===e.get("free")&&(N.current=!0,j())}catch{}},[a?.id]);return se.jsxs("div",{className:"relative flex flex-col items-center space-y-6",children:[se.jsx(ww,{currentPrice:m,isBlocked:e,buzzing:v,onClick:async()=>{if(a){if(i)return await w(),void t();if(o||!s){Ki.error("Hai gi utilizzato il BUZZ gratuito oggi.");const e=c();return a.id,(new Date).toISOString(),void(await p(e,!1))}if(s){return await r()?(await u(),await w(),t(),void(tN.shown||Ki.success("BUZZ gratuito utilizzato!"))):(console.error(" M1SSION FREE BUZZ: Failed to consume grant"),void Ki.error("Errore nell'uso del BUZZ gratuito"))}if((new Date).toISOString(),!s&&h!==kw(l))return console.error(" BUZZ PRICING VALIDATION FAILED"),void Ki.error("Errore nel calcolo del prezzo. Riprova.");a.id,await p(h,!1)}else Ki.error("Devi essere loggato per utilizzare BUZZ!")}}),se.jsx(Nw,{show:y}),f&&g&&se.jsx(eN,{config:g,onSuccess:async e=>{try{const i=await b(e);i.ok&&i.skipFollowUpBuzzPress||await w(),await u(),t(),i.clue_text,i.skipFollowUpBuzzPress}catch(i){console.error(" M1SSION PROGRESSIVE BUZZ: Error in post-payment processing",i),Ki.error("Errore nella finalizzazione BUZZ")}finally{try{const e=new Date(Date.now()-6e5).toISOString(),{data:t,error:i}=await ba.from("user_notifications").select("id,type,title,message,metadata,created_at").eq("user_id",a.id).eq("is_deleted",!1).in("type",["buzz","buzz_free"]).gte("created_at",e).order("created_at",{ascending:!1}).limit(1).maybeSingle();t?.message&&!tN.shown&&Ki.success(t.message,{duration:4e3,position:"top-center",style:{zIndex:9999,background:"linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)",color:"white",fontWeight:"bold"}})}catch(s){console.error("Error fetching toast notification:",s)}}},onCancel:x})]})},aN=({onRewardRedeemed:e})=>{const{user:t}=sn(),i=We.useRef(!1),a=()=>{try{const e=new URL(window.location.href);e.searchParams.delete("free"),e.searchParams.delete("reward"),window.history.replaceState({},"",e.pathname+(e.searchParams.toString()?`?${e.searchParams.toString()}`:""))}catch(e){console.error("Error removing query params:",e)}};return We.useEffect(()=>{if(!i.current)try{const s=new URLSearchParams(window.location.search),r="1"===s.get("free"),n="1"===s.get("reward");r&&n&&(i.current=!0,(async()=>{if(!t?.id)return Ki.error("Devi essere loggato per usare il BUZZ gratuito"),void a();try{t.id;const{data:i,error:s}=await ba.rpc("consume_credit",{p_user_id:t.id,p_credit_type:"buzz"});if(s||!i)return console.error("consume_credit error",s),Ki.error("Nessun credito BUZZ disponibile"),void a();Ki.success(" BUZZ gratuito riscattato! Ora puoi premere il pulsante BUZZ.",{duration:5e3,position:"top-center",style:{zIndex:9999,background:"linear-gradient(135deg, #00FFFF 0%, #0084FF 100%)",color:"white",fontWeight:"bold"}}),e&&e()}catch(i){console.error("redeemFreeBuzz exception",i),Ki.error("Errore durante il riscatto gratuito")}finally{a()}})())}catch(s){console.error("Error checking reward params:",s)}},[t?.id]),null},sN=()=>{const{stats:e,loading:t,loadBuzzStats:i}=(()=>{const[e,t]=We.useState(null),[i,a]=We.useState([]),[s,r]=We.useState(!0),{user:n}=$l(),o=Ml(async()=>{if(n)try{r(!0);const{data:e}=await ba.from("user_buzz_counter").select("buzz_count").eq("user_id",n.id).eq("date",(new Date).toISOString().split("T")[0]).single(),{data:i}=await ba.from("user_buzz_counter").select("buzz_count").eq("user_id",n.id),{data:s}=await ba.from("buzz_map_actions").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}).limit(10),{data:o}=await ba.from("user_map_areas").select("id").eq("user_id",n.id),l=e?.buzz_count||0,c=i?.reduce((e,t)=>e+t.buzz_count,0)||0,d=o?.length||0,u=s?.reduce((e,t)=>e+Number(t.cost_eur),0)||0;t({today_count:l,total_count:c,areas_unlocked:d,credits_spent:u}),a(s||[])}catch(e){console.error("Error loading buzz stats:",e),Ki.error("Errore nel caricamento statistiche BUZZ")}finally{r(!1)}});return We.useEffect(()=>{o()},[n]),{stats:e,history:i,loading:s,loadBuzzStats:o}})(),{user:a}=bl(),{dailyBuzzCounter:s,getCurrentBuzzDisplayPrice:r}=Cw(a?.id),n=r(),o=async()=>{setTimeout(async()=>{await i()},100)};return t?se.jsx("div",{className:"min-h-screen w-full fixed inset-0 flex items-center justify-center bg-background",children:se.jsx(et.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-8 h-8 border-2 border-[#F059FF] border-t-transparent rounded-full"})}):se.jsxs(et.div,{className:"bg-[#070818] w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},style:{height:"100dvh",overflow:"hidden",position:"relative",paddingTop:"env(safe-area-inset-top, 47px)",paddingBottom:"env(safe-area-inset-bottom, 0px)",paddingLeft:"env(safe-area-inset-left, 0px)",paddingRight:"env(safe-area-inset-right, 0px)"},children:[se.jsx(aN,{onRewardRedeemed:o}),se.jsx(ad,{}),se.jsx("main",{style:{paddingTop:"calc(119px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px))",height:"100dvh",overflowY:"auto",position:"relative",zIndex:0},children:se.jsxs("div",{className:"container mx-auto px-4",children:[se.jsx("div",{className:"text-center mt-[10%] mb-8",children:se.jsxs("h1",{className:"text-4xl font-orbitron font-bold",children:[se.jsx("span",{className:"text-[#00ffff]",children:"BU"}),se.jsx("span",{className:"text-white",children:"ZZ"})]})}),se.jsxs("div",{className:"max-w-3xl mx-auto",children:[se.jsx("div",{className:"text-center mb-6",children:se.jsx(iN,{isBlocked:!1,onSuccess:o})}),se.jsx("div",{className:"m1ssion-glass-card p-4 sm:p-6 mb-6",children:se.jsx("div",{className:"text-center space-y-4",children:se.jsxs("div",{className:"text-white/80 space-y-2",children:[se.jsx("p",{children:"Premi il pulsante per inviare un segnale e scoprire nuovi indizi. Ogni Buzz ti aiuta a trovare indizi nascosti per raggiungere l'obiettivo di 200 indizi totali."}),se.jsxs("p",{className:"font-semibold",children:["BUZZ oggi: ",s," (prezzo progressivo)"]}),se.jsxs("p",{className:"font-semibold",children:["BUZZ totali: ",e?.total_count||0,"/200 (target finale)"]}),se.jsxs("p",{className:"text-[#00ffff]",children:["Prossimo: ",n]}),se.jsx("p",{className:"text-xs text-white/60",children:" Pagamento Stripe obbligatorio per ogni BUZZ"})]})})})]})]})}),se.jsx("div",{id:"mission-bottom-nav-container",style:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1e4,isolation:"isolate",transform:"translateZ(0)",willChange:"transform",display:"block",visibility:"visible",opacity:1},children:se.jsx(sd,{})})]})},rN="_edgeGlowCanvas_13olb_3",nN="_canvas_13olb_13",oN=({audioLevel:e,status:t,isActive:i=!0})=>{const a=We.useRef(null),s=We.useRef(null);return We.useEffect(()=>{if(!i)return;const r=a.current;if(!r)return;const n=r.getContext("2d");if(!n)return;const o=()=>{r.width=window.innerWidth,r.height=window.innerHeight};o(),window.addEventListener("resize",o);let l=0;const c=()=>{n.clearRect(0,0,r.width,r.height);const i=window.innerWidth<768;let a=.3,o=.5;"listening"===t?(a=.4+.4*e,o=1):"thinking"===t?(a=.5,o=1.5):"speaking"===t&&(a=.45+.3*e,o=1.2);const d=[{r:242,g:19,b:164},{r:236,g:72,b:153},{r:0,g:229,b:255}];l+=.01*o;const u=.5*Math.sin(l)+.5,h=40+30*u,m=50+30*u,p=n.createLinearGradient(0,0,r.width,0);d.forEach((e,t)=>{const i=.6*(a+.3*u);p.addColorStop(t/(d.length-1),`rgba(${e.r}, ${e.g}, ${e.b}, ${i})`)}),n.save(),n.filter=`blur(${m}px)`,n.fillStyle=p,n.fillRect(0,0,r.width,h),n.restore();const f=n.createLinearGradient(0,r.height,r.width,r.height);if(d.forEach((e,t)=>{const i=.6*(a+.3*u);f.addColorStop(t/(d.length-1),`rgba(${e.r}, ${e.g}, ${e.b}, ${i})`)}),n.save(),n.filter=`blur(${m}px)`,n.fillStyle=f,n.fillRect(0,r.height-h,r.width,h),n.restore(),!i){const e=n.createLinearGradient(0,0,0,r.height);d.forEach((t,i)=>{const s=.6*(a+.3*u);e.addColorStop(i/(d.length-1),`rgba(${t.r}, ${t.g}, ${t.b}, ${s})`)}),n.save(),n.filter=`blur(${m}px)`,n.fillStyle=e,n.fillRect(0,0,h,r.height),n.restore()}if(!i){const e=n.createLinearGradient(r.width,0,r.width,r.height);d.forEach((t,i)=>{const s=.6*(a+.3*u);e.addColorStop(i/(d.length-1),`rgba(${t.r}, ${t.g}, ${t.b}, ${s})`)}),n.save(),n.filter=`blur(${m}px)`,n.fillStyle=e,n.fillRect(r.width-h,0,h,r.height),n.restore()}s.current=requestAnimationFrame(c)};return c(),()=>{window.removeEventListener("resize",o),s.current&&cancelAnimationFrame(s.current)}},[e,t,i]),i?se.jsx("div",{className:rN,children:se.jsx("canvas",{ref:a,className:nN,"aria-hidden":"true"})}):null},lN={orbContainer:"_orbContainer_1h265_3",outerGlow:"_outerGlow_1h265_21",spin:"_spin_1h265_169",listening:"_listening_1h265_36",thinking:"_thinking_1h265_41",pulse:"_pulse_1h265_1",speaking:"_speaking_1h265_46",middleLayer:"_middleLayer_1h265_52",innerCore:"_innerCore_1h265_63",idleRing:"_idleRing_1h265_153",ping:"_ping_1h265_1",icon:"_icon_1h265_163",spinning:"_spinning_1h265_169",pulsing:"_pulsing_1h265_173"},cN=({status:e,audioLevel:t=0,onClick:i})=>{const a=("speaking"===e||"listening"===e)&&t>0?1+.15*t:1;return se.jsxs("button",{onClick:i,className:lN.orbContainer,style:{transform:`scale(${a})`},"aria-label":"Open AI Analyst","aria-pressed":"idle"!==e,type:"button",children:[se.jsx("div",{className:`${lN.outerGlow} ${lN[e]}`}),se.jsx("div",{className:lN.middleLayer}),se.jsx("div",{className:`${lN.innerCore} ${lN[e]}`,children:(()=>{switch(e){case"thinking":return se.jsx(Hs,{className:`${lN.icon} ${lN.spinning}`});case"speaking":return se.jsx(Rr,{className:`${lN.icon} ${lN.pulsing}`});case"listening":return se.jsx(er,{className:lN.icon});default:return null}})()}),"idle"===e&&se.jsx("div",{className:lN.idleRing})]})},dN="_dockContainer_14px8_5",uN="_dock_14px8_5",hN="_dockButton_14px8_30",mN="_active_14px8_55",pN="_icon_14px8_66",fN=({micEnabled:e,onMicToggle:t,onMoreClick:i,onFinalShotClick:a})=>{const[,s]=Ai();return se.jsx("div",{className:dN,children:se.jsxs("div",{className:uN,children:[se.jsx("button",{className:hN,onClick:()=>{a?a():s("/intelligence/final-shot")},"aria-label":"Open Final Shot",type:"button",children:se.jsx(Ss,{className:pN})}),se.jsx("button",{className:`${hN} ${e?mN:""}`,onClick:t,"aria-label":e?"Disable microphone":"Enable microphone","aria-pressed":e,type:"button",children:e?se.jsx(er,{className:pN}):se.jsx(Qs,{className:pN})}),se.jsx("button",{className:hN,onClick:i,"aria-label":"More options",type:"button",children:se.jsx(As,{className:pN})})]})})},gN="_stage_1jgae_3",xN="_gradientOverlay_1jgae_11",bN="_orbContainer_1jgae_18",vN=({status:e,audioLevel:t,onOrbClick:i,micEnabled:a,onMicToggle:s,onMoreClick:r,onFinalShotClick:n})=>se.jsxs("div",{className:gN,children:[se.jsx("div",{className:xN}),se.jsx(oN,{audioLevel:t,status:e,isActive:!0}),se.jsx("div",{className:bN,children:se.jsx(cN,{status:e,audioLevel:t,onClick:i})}),se.jsx(fN,{micEnabled:a,onMicToggle:s,onMoreClick:r,onFinalShotClick:n})]}),yN=({status:e,isActive:t,audioLevel:i=0})=>{if(We.useEffect(()=>(t?document.body.classList.add("ai-active"):document.body.classList.remove("ai-active"),()=>{document.body.classList.remove("ai-active")}),[t]),!t)return null;return se.jsxs(se.Fragment,{children:[se.jsx("style",{children:"\n        @keyframes aiGlowIdle {\n          0%, 100% { opacity: 0.3; }\n          50% { opacity: 0.5; }\n        }\n        @keyframes aiGlowThink {\n          0%, 100% { opacity: 0.4; }\n          50% { opacity: 0.7; }\n        }\n        @keyframes aiGlowSpeak {\n          0%, 100% { opacity: 0.5; }\n          50% { opacity: 0.85; }\n        }\n        @keyframes glowRotate {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      "}),se.jsx("div",{className:"fixed inset-0 pointer-events-none z-40",style:{animation:(()=>{switch(e){case"thinking":return"aiGlowThink 2s ease-in-out infinite";case"speaking":return i>0?`aiGlowSpeak ${.8+.4*(1-i)}s ease-in-out infinite`:"aiGlowSpeak 1.2s ease-in-out infinite";default:return"aiGlowIdle 4s ease-in-out infinite"}})(),opacity:"speaking"===e&&i>0?.4+.4*i:1,willChange:"opacity",transition:"opacity 100ms ease-out"},children:se.jsx("div",{className:"absolute inset-0",style:{background:"\n              conic-gradient(\n                from 0deg at 50% 50%,\n                rgba(242, 19, 164, 0) 0%,\n                rgba(0, 229, 255, 0.36) 25%,\n                rgba(242, 19, 164, 0.36) 50%,\n                rgba(0, 229, 255, 0) 75%,\n                rgba(242, 19, 164, 0) 100%\n              )\n            ",maskImage:"\n              linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%),\n              linear-gradient(to bottom, transparent 0%, black 8%, black 92%, transparent 100%)\n            ",maskComposite:"intersect",WebkitMaskImage:"\n              linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%),\n              linear-gradient(to bottom, transparent 0%, black 8%, black 92%, transparent 100%)\n            ",WebkitMaskComposite:"source-in",filter:"blur(28px)",animation:"speaking"===e?"glowRotate 8s linear infinite":"glowRotate 20s linear infinite",mixBlendMode:"screen"}})})]})},wN=({suggestions:e,onPick:t})=>e&&0!==e.length?se.jsx("div",{className:"flex gap-2 flex-wrap pt-2 pb-3",children:e.slice(0,3).map((e,i)=>se.jsxs("button",{className:"rounded-full px-4 py-2 text-sm bg-gradient-to-r from-[#F213A4]/20 to-[#0EA5E9]/20 border border-[#F213A4]/30 hover:from-[#F213A4]/30 hover:to-[#0EA5E9]/30 text-white transition-all hover:scale-105 press-effect",onClick:()=>t(e.payload),children:[" ",e.label]},i))}):null;const NN="norah_agent_cache";async function jN(){const e=function(){try{const e=localStorage.getItem(NN);if(!e)return null;const t=JSON.parse(e);return Date.now()-t.timestamp>216e5?(localStorage.removeItem(NN),null):t}catch{return null}}();try{const{data:{session:t}}=await ba.auth.getSession(),i=t?.access_token;if(!i){if(console.warn("[Norah] No session token available"),e)return{agent:{code:e.code,nickname:e.nickname},mission:null,stats:{clues:0,buzz_today:0,finalshot_today:0},clues:[],finalshot_recent:[],recent_msgs:[]};throw new Error("No authentication token")}const{data:a,error:s}=await ba.functions.invoke("get-norah-context",{method:"POST",headers:{Authorization:`Bearer ${i}`,"x-client-version":"norah-v6.6"}});if(s){if(console.warn("[Norah] Edge function error:",s),e)return{agent:{code:e.code,nickname:e.nickname},mission:null,stats:{clues:0,buzz_today:0,finalshot_today:0},clues:[],finalshot_recent:[],recent_msgs:[]};throw s}const r={agent:{code:a?.agent?.code||e?.code||"AG-UNKNOWN",nickname:a?.agent?.nickname||e?.nickname||null},mission:a?.mission||null,stats:{clues:a?.stats?.clues||0,buzz_today:a?.stats?.buzz_today||0,finalshot_today:a?.stats?.finalshot_today||0},clues:a?.clues||[],finalshot_recent:a?.finalshot_recent||[],recent_msgs:a?.recent_msgs||[]};return r.agent.code&&"AG-UNKNOWN"!==r.agent.code&&function(e,t){try{const i={code:e,nickname:t,timestamp:Date.now()};localStorage.setItem(NN,JSON.stringify(i))}catch(s){console.warn("[Norah] Failed to cache agent:",s)}}(r.agent.code,r.agent.nickname),r}catch(t){return console.error("[Norah] Context build failed:",t),{agent:e?{code:e.code,nickname:e.nickname}:{code:"AG-UNKNOWN",nickname:null},mission:null,stats:{clues:0,buzz_today:0,finalshot_today:0},clues:[],finalshot_recent:[],recent_msgs:[]}}}const SN=Object.freeze(Object.defineProperty({__proto__:null,buildNorahContext:jN},Symbol.toStringTag,{value:"Module"}));async function _N(e){try{const t=await async function(){try{const{data:{user:e}}=await ba.auth.getUser();return e?.id||null}catch{return null}}();if(!t)return void console.warn("[Telemetry] No user ID, skipping event:",e.event);await ba.from("norah_events").insert({user_id:t,event:e.event,intent:e.intent||null,sentiment:e.sentiment||null,phase:e.phase||null,event_type:e.event,created_at:(new Date).toISOString()}),e.event}catch(t){console.error("[Telemetry] Failed to log event:",t)}}const kN={milestone:[" Ottimo passo!"," Ben fatto!"," Prosegui cos!"," Continua!"," Grande!"," Perfetto!"],streak:[" Striscia attiva!"," Ritmo perfetto!"," Costanza al top!"," Serie vincente!"," Streak record!"," Inarrestabile!"],discovery:[" Indizio trovato!"," Nuovo dato!"," Scoperta!"," Info acquisita!"," Pattern emerging!"," Connessione!"]},CN=({celebration:e,onComplete:t})=>{const[i,a]=We.useState(!1);if(We.useEffect(()=>{if(e){a(!0);const e=setTimeout(()=>{a(!1),setTimeout(t,300)},2e3);return()=>clearTimeout(e)}},[e,t]),!e)return null;const s=kN[e.type],r=s[Math.floor(Math.random()*s.length)];return se.jsx(tt,{children:i&&se.jsx(et.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.9},transition:{duration:.3,ease:"easeOut"},className:"fixed top-4 left-1/2 -translate-x-1/2 z-50 pointer-events-none",children:se.jsx("div",{className:"bg-gradient-to-r from-[#F213A4]/90 to-[#0EA5E9]/90 backdrop-blur-md px-6 py-3 rounded-full shadow-lg border border-white/20",children:se.jsxs("div",{className:"flex items-center gap-2 text-white font-medium",children:[e.icon&&se.jsx("span",{className:"text-xl",children:e.icon}),se.jsx("span",{children:e.message||r})]})})})})};function AN(e,t){return{type:e,message:t||"",icon:"milestone"===e?"":"streak"===e?"":""}}const zN={},EN=(e,t,i,a)=>{MN(i)&&zN[i]||(MN(i)&&(zN[i]=new Date),((e,t,i,a)=>{const s=[i,{code:t,...a||{}}];if(e?.services?.logger?.forward)return e.services.logger.forward(s,"warn","react-i18next::",!0);MN(s[0])&&(s[0]=`react-i18next:: ${s[0]}`),e?.services?.logger?.warn?e.services.logger.warn(...s):console?.warn&&console.warn(...s)})(e,t,i,a))},IN=(e,t)=>()=>{if(e.isInitialized)t();else{const i=()=>{setTimeout(()=>{e.off("initialized",i)},0),t()};e.on("initialized",i)}},PN=(e,t,i)=>{e.loadNamespaces(t,IN(e,i))},TN=(e,t,i,a)=>{if(MN(i)&&(i=[i]),e.options.preload&&e.options.preload.indexOf(t)>-1)return PN(e,i,a);i.forEach(t=>{e.options.ns.indexOf(t)<0&&e.options.ns.push(t)}),e.loadLanguages(t,IN(e,a))},MN=e=>"string"==typeof e,LN=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,FN={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},ON=e=>FN[e];let DN={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:e=>e.replace(LN,ON)};const RN=We.createContext();class BN{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(e=>{this.usedNamespaces[e]||(this.usedNamespaces[e]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const UN=(e,t,i,a)=>e.getFixedT(t,i,a),qN=(e,t={})=>{const{i18n:i}=t,{i18n:a,defaultNS:s}=We.useContext(RN)||{},r=i||a||void 0;if(r&&!r.reportNamespaces&&(r.reportNamespaces=new BN),!r){EN(r,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const e=(e,t)=>{return MN(t)?t:"object"==typeof(i=t)&&null!==i&&MN(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e;var i},t=[e,{},!1];return t.t=e,t.i18n={},t.ready=!1,t}r.options.react?.wait&&EN(r,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const n={...DN,...r.options.react,...t},{useSuspense:o,keyPrefix:l}=n;let c=s||r.options?.defaultNS;c=MN(c)?[c]:c||["translation"],r.reportNamespaces.addUsedNamespaces?.(c);const d=(r.isInitialized||r.initializedStoreOnce)&&c.every(e=>((e,t,i={})=>t.languages&&t.languages.length?t.hasLoadedNamespace(e,{lng:i.lng,precheck:(t,a)=>{if(i.bindI18n&&i.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!a(t.isLanguageChangingTo,e))return!1}}):(EN(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0))(e,r,n)),u=((e,t,i,a)=>We.useCallback(UN(e,t,i,a),[e,t,i,a]))(r,t.lng||null,"fallback"===n.nsMode?c:c[0],l),h=()=>u,m=()=>UN(r,t.lng||null,"fallback"===n.nsMode?c:c[0],l),[p,f]=We.useState(h);let g=c.join();t.lng&&(g=`${t.lng}${g}`);const x=((e,t)=>{const i=We.useRef();return We.useEffect(()=>{i.current=e},[e,t]),i.current})(g),b=We.useRef(!0);We.useEffect(()=>{const{bindI18n:e,bindI18nStore:i}=n;b.current=!0,d||o||(t.lng?TN(r,t.lng,c,()=>{b.current&&f(m)}):PN(r,c,()=>{b.current&&f(m)})),d&&x&&x!==g&&b.current&&f(m);const a=()=>{b.current&&f(m)};return e&&r?.on(e,a),i&&r?.store.on(i,a),()=>{b.current=!1,r&&e&&e?.split(" ").forEach(e=>r.off(e,a)),i&&r&&i.split(" ").forEach(e=>r.store.off(e,a))}},[r,g]),We.useEffect(()=>{b.current&&d&&f(h)},[r,l,d]);const v=[p,r,d];if(v.t=p,v.i18n=r,v.ready=d,d)return v;if(!d&&!o)return v;throw new Promise(e=>{t.lng?TN(r,t.lng,c,()=>e()):PN(r,c,()=>e())})};function $N({i18n:e,defaultNS:t,children:i}){const a=We.useMemo(()=>({i18n:e,defaultNS:t}),[e,t]);return We.createElement(RN.Provider,{value:a},i)}const WN=["finalshot?","buzz map","piani?","come inizio?","cosa  mission?","aiuto"],HN=e=>{const{t:t}=qN(),i=e.open??e.isOpen??!1,{onClose:a,messages:s,isProcessing:r,onSendMessage:n,currentMode:o,status:l,audioLevel:c,ttsEnabled:d,onToggleTTS:u,agentContext:h}=e,[m,p]=We.useState(""),[f,g]=We.useState(WN[0]),[x,b]=We.useState([]),[v,y]=We.useState(null),w=We.useRef(null),N=We.useRef(0);We.useEffect(()=>{(async()=>{try{const e=function(e){const t=e?.stats?.clues||0;return 0===(e?.stats?.buzz_today||0)?[{label:"Apri BUZZ",payload:"Voglio fare BUZZ"},{label:"Mini-Quiz 30s",payload:"Fammi un mini-quiz"},{label:"Panoramica M1SSION",payload:"Cos' M1SSION?"}]:t<3?[{label:"Fai altro BUZZ",payload:"Voglio fare BUZZ"},{label:"Pattern Drill",payload:"Fammi un pattern drill"},{label:"FAQ 60s",payload:"FAQ rapida"}]:t>=3&&t<8?[{label:"Analizza pattern",payload:"Cerca pattern negli indizi"},{label:"BUZZ Map",payload:"Come funziona BUZZ Map?"},{label:"Mini-allenamento",payload:"Fammi un mini-quiz"}]:t>=8?[{label:"Final Shot?",payload:"Come funziona Final Shot?"},{label:"BUZZ Map",payload:"Apri BUZZ Map"},{label:"Verifica indizi",payload:"Riassumi i miei indizi"}]:[{label:"Come inizio?",payload:"Come inizio?"},{label:"Alternative BUZZ",payload:"Se non voglio usare BUZZ?"},{label:"FAQ rapida",payload:"FAQ 60s"}]}(await jN());b(e)}catch(e){console.error("[AIPanel] Failed to load NBA Pills:",e)}})()},[s.length]),We.useEffect(()=>{const e=setInterval(()=>{g(WN[Math.floor(Math.random()*WN.length)])},4e3);return()=>clearInterval(e)},[]),We.useEffect(()=>{w.current?.scrollIntoView({behavior:"smooth"})},[s]);const j=We.useRef([]);We.useEffect(()=>{if(!h)return;const e=h.cluesCount||0,t=N.current;0===t&&1===e&&(y(AN("milestone"," Primo indizio trovato!")),j.current.push("first_clue")),t<3&&3===e&&(y(AN("discovery"," 3 indizi! Pattern in formazione")),j.current.push("third_clue")),t<5&&5===e&&(y(AN("milestone"," 5 indizi raccolti! Il pattern si delinea")),j.current.push("fifth_clue")),t<10&&10===e&&(y(AN("discovery"," 10 indizi! Final Shot quasi pronto")),j.current.push("tenth_clue")),N.current=e},[h?.cluesCount]);const S=(e="analyze")=>{m.trim()&&(n(m,e),p(""))};if(We.useEffect(()=>(i?document.body.classList.add("m1-no-scroll"):document.body.classList.remove("m1-no-scroll"),()=>{document.body.classList.remove("m1-no-scroll")}),[i]),!i)return null;const _=se.jsxs(se.Fragment,{children:[se.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[12000]",onClick:a}),se.jsx(yN,{status:l,isActive:!0,audioLevel:c}),se.jsx("div",{className:"fixed z-[12050] flex flex-col inset-0",style:{height:"100dvh",paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:se.jsxs("div",{className:"relative w-full h-full flex flex-col bg-black/95 backdrop-blur-xl overflow-hidden md:max-w-4xl md:max-h-[800px] md:rounded-3xl md:m-auto",style:{boxShadow:"0 0 20px rgba(0, 229, 255, 0.15), inset 0 0 40px rgba(0, 229, 255, 0.03)"},onClick:e=>e.stopPropagation(),children:[se.jsxs("div",{className:"flex items-center justify-between p-4 md:p-6 border-b border-white/10",children:[se.jsxs("div",{className:"flex items-center gap-4",children:[se.jsxs("div",{children:[se.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-[#F213A4] to-[#0EA5E9] bg-clip-text text-transparent",children:"NORAH AI"}),se.jsx("p",{className:"text-sm text-white/60 mt-1",children:h?.agentCode&&"AG-UNKNOWN"!==h.agentCode?`${t("norah_ready")}  Agente ${h.agentCode}`:t("norah_ready")})]}),"speaking"===l&&se.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((e,t)=>se.jsx("div",{className:"w-1 bg-gradient-to-t from-[#00E5FF] to-[#F213A4] rounded-full",style:{height:12+(d?30*c:20*Math.random())+"px",transition:"height 100ms ease-out"}},t))})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("button",{onClick:u,className:"px-3 py-1.5 rounded-lg text-xs font-medium transition-all "+(d?"bg-gradient-to-r from-[#F213A4] to-[#0EA5E9] text-white":"bg-white/10 text-white/60 hover:bg-white/20"),children:t(d?"tts_on":"tts_off")}),se.jsx("button",{onClick:a,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:se.jsx($r,{className:"w-6 h-6 text-white/80"})})]})]}),se.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-4 md:space-y-6",style:{minHeight:0,WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:[0===s.length?se.jsxs("div",{className:"text-center text-white/40 py-12",children:[se.jsx("p",{className:"text-lg mb-2",children:t("norah_ready")}),se.jsx("p",{className:"text-sm",children:t("write_natural")})]}):se.jsx(se.Fragment,{children:s.map((e,i)=>se.jsx("div",{className:"flex "+("user"===e.role?"justify-end":"justify-start"),children:se.jsxs("div",{className:"max-w-[80%] p-4 rounded-2xl "+("user"===e.role?"bg-primary/20 border border-primary/30 text-white":"bg-white/5 border border-white/10 text-white/90"),children:[se.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content}),e.metadata&&se.jsxs("div",{className:"mt-2 text-xs text-white/40",children:[e.metadata.cluesAnalyzed," ",t("clues_analyzed"),"  ",e.metadata.mode]})]})},i))}),r&&se.jsx("div",{className:"flex justify-start",children:se.jsx("div",{className:"bg-white/5 border border-white/10 p-4 rounded-2xl",children:se.jsxs("div",{className:"flex items-center gap-2 text-white/60",children:[se.jsxs("div",{className:"flex gap-1",children:[se.jsx("div",{className:"w-2 h-2 bg-[#F213A4] rounded-full animate-bounce",style:{animationDelay:"0ms"}}),se.jsx("div",{className:"w-2 h-2 bg-[#0EA5E9] rounded-full animate-bounce",style:{animationDelay:"150ms"}}),se.jsx("div",{className:"w-2 h-2 bg-[#F213A4] rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),se.jsx("span",{className:"text-sm",children:t("thinking"===l?"processing":"speaking")})]})})}),se.jsx("div",{ref:w})]}),se.jsxs("div",{className:"p-4 md:p-6 border-t border-white/10",style:{paddingBottom:"calc(1rem + max(env(safe-area-inset-bottom, 0px), 4px))"},children:[se.jsx(wN,{suggestions:x,onPick:async e=>{await async function(e){await _N({event:"pill_click",meta:{payload:e,ts:Date.now()}})}(e);const{toast:t}=await ae(async()=>{const{toast:e}=await Promise.resolve().then(()=>ra);return{toast:e}},void 0);t.success(" Azione impostata",{duration:2e3}),n(e,"analyze")}}),se.jsxs("div",{className:"flex gap-3",children:[se.jsx("input",{type:"text",value:m,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())},placeholder:x.length>0?t("pills_ready"):t("norah_placeholder"),disabled:r,className:"flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/40 focus:outline-none focus:border-[#F213A4]/50 disabled:opacity-50 transition-all"}),se.jsx("button",{onClick:()=>S(),disabled:!m.trim()||r,className:"px-6 py-3 bg-gradient-to-r from-[#F213A4] to-[#0EA5E9] rounded-xl font-medium transition-all hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:se.jsx(fr,{className:"w-5 h-5"})})]}),se.jsx("p",{className:"text-xs text-white/30 mt-2",children:t("send_enter")})]})]})}),v&&se.jsx(CN,{celebration:v,onComplete:()=>y(null)})]});return Ve.createPortal(_,document.body)},ZN={classify:["Questi indizi sembrano convergere su un tema comune.","Potrei dividerli in due categorie principali: luogo e premio.","Alcuni indizi parlano di costruzioni, altri di simboli.","Qui noto riferimenti sia a elementi moderni che storici.","Sembrano frammenti collegati da un filo logico sottile.","Suggerisco di separarli in base al tempo: passato e presente.","Un paio di questi indizi parlano chiaramente di movimento.","Classificherei questo gruppo come 'visivo' e l'altro come 'concettuale'.","Ci sono allusioni a colori e forme, vale la pena raggrupparle.","Alcuni elementi puntano verso un contesto naturale, altri artificiale.","Indizi geografici da un lato, indizi simbolici dall'altro.","Separerei quelli che parlano di luce da quelli che parlano di materia.","Questo insieme mi sembra raccontare una progressione temporale.","Un indizio ha natura numerica, lo metterei a parte.","Direi che due di questi parlano di prestigio, gli altri di localit.","Li dividerei in indizi certi e indizi ambigui.","Questi sono di tipo diretto, mentre gli altri sono pi metaforici.","Qui c' una categoria legata alla tecnologia.","Separerei ci che evoca forza da ci che evoca bellezza.","Mi sembra che alcuni parlino di un viaggio.","Questi due parlano di tempo, non di spazio.","C' una linea di pensiero che lega tre di loro, il resto  dispersivo.","Indizi descrittivi vs indizi cifrati: buona separazione.","Un paio citano oggetti concreti, altri sensazioni.","Due parlano di Italia, gli altri no.","Classificazione tematica: arte, scienza, territorio.","Separerei quelli con numeri da quelli senza.","Un indizio pare un titolo, gli altri sono descrizioni.","Uno solo  fuorviante: lo segnerei come 'anomalo'.","Indizi generici e indizi raffinati: netta differenza.","Questi due hanno in comune una figura geometrica.","Qui c' chiaro un contrasto: luce vs ombra.","Separerei 'premio' da 'luogo' in questo blocco.","Classificazione secondo livello di dettaglio: basso/medio/alto.","Alcuni hanno tono poetico, altri tecnico.","Questi tre parlano di grandezza, gli altri di precisione.","Un paio evocano velocit.","Ci sono indizi sensoriali e indizi logici.","Separerei i simbolici dai diretti.","Due hanno un linguaggio molto simile, segno che vanno insieme.","Uno sembra uno slogan, gli altri no.","Indizi urbanistici da una parte, naturali dall'altra.","Questi tre parlano chiaramente di energia.","Ci sono parole chiave ripetute, le raggrupperei.","Separerei i dettagli visivi dai dettagli storici.","Uno pare ironico, differente dagli altri.","Tre parlano di eleganza, gli altri di forza.","Li vedo divisi per tipologia: cifrati e narrativi.","Classificherei un paio come 'trappole'.","Direi che qui abbiamo un mix di premi e localit."],patterns:["Intravedo un filo rosso che unisce almeno tre indizi.","Questi due condividono una stessa parola chiave.","Vedo una ripetizione di concetti legati alla luce.","C' un pattern numerico nascosto qui.","Due indizi hanno la stessa struttura grammaticale.","Sembrano variazioni sullo stesso tema.","Noto una progressione temporale: inizio, sviluppo, fine.","Pi indizi parlano di altezza.","Qui ricorre un colore specifico.","Tre citano elementi metallici.","Due parlano di rumore, gli altri di silenzio.","Noto un'alternanza costante: positivo/negativo.","C' un parallelismo tra il primo e l'ultimo.","Tre fanno riferimento a velocit.","Un pattern di direzione: nord, sud, movimento.","Qui tornano riferimenti al lusso.","Pi di uno menziona acqua in forme diverse.","Gli indizi sembrano formare una sequenza.","Alcuni evocano dualit: interno/esterno.","Ci sono due sinonimi che non credo casuali.","Un ritmo ternario emerge qui.","Molti sembrano giocare con la simmetria.","Questo ricorda uno schema codificato.","Due hanno struttura domanda-risposta.","Un pattern fonetico appare evidente.","Pare ci sia una rima nascosta.","Ci sono simboli ricorrenti: cerchio, quadrato.","Una logica binaria si ripete.","Noto ridondanza intenzionale.","Gli indizi formano una spirale concettuale.","Due appaiono come eco l'uno dell'altro.","Un ciclo: inizio e ritorno sullo stesso punto.","Gli indizi richiamano stagioni.","Sembrano tre varianti dello stesso messaggio.","Una simmetria perfetta: 2 e 4 sono equivalenti.","Noto parallelismi narrativi.","Ritrovo la stessa parola spezzata in due indizi.","Gli indizi si rispondono tra loro.","Formano un mosaico coerente.","Sembrano tessere di puzzle.","Un pattern musicale: ritmo implicito.","Vedo legami tra suoni ripetuti.","Gli indizi hanno struttura speculare.","Due paiono anagrammi l'uno dell'altro.","Un gioco di opposizioni si ripete.","Pattern nascosto: prima lettera di ogni indizio.","Una logica circolare emerge.","Sembrano messaggi in codice collegati.","Il tema della luce ritorna tre volte.","Un filo conduttore: innovazione."],decode:["Proverei un semplice cifrario di Cesare.","Potrebbe trattarsi di un anagramma.","Forse i numeri sono ASCII.","Questo ricorda un codice Base64.","Il pattern sembra binario.","Puoi provare a invertirne le lettere.","Mi ricorda un codice Morse.","Forse ogni numero  un mese.","Un codice semplice: sostituzione.","Penso a coordinate nascoste.","Magari  un acronimo.","Potrebbe essere un rebus.","Forse vanno letti al contrario.","Sembrano coordinate criptate.","Un classico: ROT13.","Pu essere un codice telefonico.","Ci vedo lettere romane.","Potrebbe celare un nome noto.","Forse  un palindromo.","Ricorda un puzzle crittografico.","Potresti dividerlo in coppie.","Forse sono sillabe invertite.","Magari  un acrostico.","Questo pare un codice alfanumerico.","Pu essere una sostituzione monoalfabetica.","Indizio numerico = cifrario banale.","Prova con dizionario anagrammi.","Magari nasconde parole in pi lingue.","Potrebbe essere una frase spezzata.","Forse devi sommare i numeri.","Sembrano coordinate con offset.","Potrebbe essere codice QR.","Forse parole tronche.","Un linguaggio simbolico.","Pare un rebus figurato.","Pu essere un codice di trasporto.","Sembra una chiave numerica.","Forse cifrario polibio.","Codice gematria?","Pu essere fonetico.","Pare crittografia basica.","Pensa a traslitterazione.","Un rebus fonetico.","Pu essere con sostituzione vocali.","Forse una sequenza Fibonacci.","Magari vanno sommati i caratteri.","Pare stringa codificata.","Codice musicale?","Coordinate travestite da numeri."],probability:["Direi che la probabilit  incerta ma crescente.","Al momento sei a uno stadio iniziale.","Le chance migliorano con pi indizi.","Direi che il rischio di errore  alto.","La probabilit non  quantificabile con precisione.","In questa fase il margine d'errore  elevato.","Ogni indizio aumenta leggermente le tue chance.","La tua posizione  ancora fragile.","Direi che hai poche certezze.","Siamo in un territorio incerto.","Pi indizi = pi probabilit.","La fiducia cresce lentamente.","Ti trovi al 30% del cammino.","Ci sono variabili fuori controllo.","Le probabilit migliorano di poco.","Direi che resti sotto il 50%.","La tua traiettoria  promettente.","Il rischio  ancora notevole.","Sei sulla strada giusta, ma incompleta.","Ogni connessione aumenta la tua forza.","La probabilit resta bassa.","Hai raggiunto un punto intermedio.","La stima  positiva, ma prudente.","Sei in zona di rischio medio.","Ogni errore pesa molto ora.","La probabilit cresce con logica cumulativa.","Le tue chance dipendono dai prossimi passi.","Valuto rischio medio-alto.","Direi incertezza dominante.","La fiducia sale, ma lentamente.","Resti in zona neutra.","Le probabilit sono migliorate rispetto a prima.","Un passo avanti, ma non ancora decisivo.","Ancora presto per stimare seriamente.","Direi che il cammino resta lungo.","La probabilit si alza col tempo.","Hai basi fragili ma promettenti.","La tua posizione si  rafforzata.","Ora la stima  pi ottimista.","Hai costruito credibilit investigativa.","Il rischio resta alto.","Una chance su tre.","Probabilit attorno al 40%.","Ti avvicini alla soglia critica.","Ancora incertezza diffusa.","Direi che sei sulla giusta traiettoria.","La probabilit cresce, resta vigile.","Hai migliorato le tue possibilit.","Valutazione prudente: medio-bassa.","Sei in crescita costante."],mentor:["Non mollare, sei sulla strada giusta.","Ogni indizio  un passo verso la verit.","La pazienza  la tua arma segreta.","Non avere fretta: ogni dettaglio conta.","Il gioco premia chi sa osservare.","Continua a cercare, anche nei dettagli minimi.","La tua dedizione ti porter lontano.","Non sottovalutare mai un piccolo segno.","Ogni indizio ha un valore nascosto.","Il percorso  tanto importante quanto la meta.","Non lasciarti ingannare dai falsi segnali.","Sii freddo come un analista.","Ma anche curioso come un esploratore.","Non smettere di collegare i punti.","Ricorda: l'apparenza inganna.","Ogni errore  un passo di apprendimento.","Mantieni la mente aperta.","Il tuo intuito  parte della strategia.","Non ti arrendere ai primi ostacoli.","Ogni dettaglio pu essere chiave.","Sii metodico, ma anche creativo.","Le risposte arrivano a chi sa attendere.","La tua tenacia far la differenza.","Non lasciarti distrarre.","Segui la logica, ma ascolta anche l'istinto.","Cerca l'armonia nei dettagli.","Non abbandonare la pista.","Tieni alta la concentrazione.","Ogni giorno pu portare un indizio nuovo.","La calma  la tua forza.","Sii pronto a cambiare prospettiva.","Il viaggio vale pi della destinazione.","La caccia  parte della vittoria.","Non dimenticare di osservare tutto.","Sii costante, ma anche elastico.","Il mistero si risolve un passo alla volta.","Ogni indizio  un tassello del mosaico.","Non lasciare nulla al caso.","Sii vigile e attento.","Ricorda: il tempo  un alleato.","La determinazione  la chiave.","Non dubitare del tuo percorso.","La forza  nella pazienza.","Segui la traccia con fiducia.","Ogni segnale  prezioso.","Non smettere di interrogare i dettagli.","Mantieni la mente affilata.","La vittoria  per chi persevera.","Il mistero si svela a chi insiste.","Tu puoi farcela."]};const VN=["dov'","dove si trova","dove ","location","posizione esatta","coordinate","dimmi dove","indirizzo","qual  il luogo","svelami","dammi la risposta","dammi la soluzione","qual  l'indirizzo","rivela","svela il posto","dammi le coordinate","dammi il posto","quale citt"],GN=["Non posso rivelare luoghi o coordinate   parte del gioco. Ma posso aiutarti a stringere il cerchio: analizza i pattern ricorrenti nei tuoi indizi.","Il mio compito  guidarti, non svelarti la soluzione. Per posso evidenziare temi dominanti: vuoi che analizzi le connessioni?","Niente spoiler:  la regola base. Ma se mi indichi quale area geografica ti sembra coerente, posso dirti se sei sulla pista giusta.","Le coordinate sono il tuo obiettivo finale, non il mio da rivelare. Per posso classificare gli indizi per tipo: vuoi provare?"];const YN={about:["parlami di m1ssion","cos' m1ssion","cosa  m1ssion","spiega m1ssion"],classify:["classifica","categorizza","organizza","separa","raggruppa"],patterns:["pattern","collegamento","correlazione","connessione","trova","ricorrente"],decode:["decodifica","decifra","anagramma","base64","caesar","codice","cripta"],probability:["probabilit","chance","vincere","quanto","percentuale","stima"],mentor:["aiuto","consiglio","motivazione","cosa fare","prossimo passo","suggerimento"]};const KN=new Set(["il","lo","la","i","gli","le","un","uno","una","di","da","a","in","con","su","per","tra","fra","e","o","che","del","dei","della","delle","al","ai"]);function XN(e){const t=new Map,i=new Map;e.forEach(e=>{const a=e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>3&&!KN.has(e)),s=new Set(a);a.forEach(e=>{t.set(e,(t.get(e)||0)+1)}),s.forEach(e=>{i.set(e,(i.get(e)||0)+1)})});const a=new Map;return t.forEach((t,s)=>{const r=i.get(s)||1,n=Math.log(e.length/r);a.set(s,t*n)}),Array.from(a.entries()).sort((e,t)=>t[1]-e[1]).slice(0,8).map(([e])=>e)}function JN(e){const t=[],i=function(e){try{const t=e.replace(/[^A-Za-z0-9+/=]/g,"");if(t.length<4||t.length%4!=0)return null;const i=atob(t);if(/^[\x20-\x7E]+$/.test(i))return i}catch{}return null}(e);i&&t.push(`Base64: ${i}`);const a=function(e,t){return e.replace(/[a-z]/gi,e=>{const i=e<="Z"?65:97;return String.fromCharCode((e.charCodeAt(0)-i+t+26)%26+i)})}(e,3);a!==e&&t.push(`Caesar+3: ${a}`);const s=e.split("").reverse().join("");if(t.push(`Reverse: ${s}`),/^\d+(\s+\d+)*$/.test(e))try{const i=e.split(/\s+/).map(e=>String.fromCharCode(parseInt(e))).join("");/^[\x20-\x7E]+$/.test(i)&&t.push(`ASCII: ${i}`)}catch{}return t}async function QN(e,t){const i=t.userClues.map(e=>`${e.title} ${e.text}`),a=XN(i),s="classify"===e||"patterns"===e?function(e){if(e.length<2)return[e];const t=XN(e),i=e.map(e=>{const i=e.toLowerCase().split(/\s+/);return t.map(e=>i.filter(t=>t.includes(e)).length)}),a=[],s=[];return i.forEach((t,r)=>{t.reduce((e,t)=>e+t,0)>i[0].reduce((e,t)=>e+t,0)/2?a.push(e[r]):s.push(e[r])}),[a,s].filter(e=>e.length>0)}(i):[i],r=Date.now(),n=t.userClues.map(e=>{const t=(r-new Date(e.created_at).getTime())/864e5;return Math.max(0,1-t/30)});let o=[];"decode"===e&&t.userClues.forEach(e=>{const t=JN(e.text);o.push(...t)});const l=n.reduce((e,t)=>e+t,0)/(n.length||1),c=Math.min(1,t.userClues.length/10*l);return{clusters:s,keywords:a,decoded:o.slice(0,5),recency:n,confidence:c}}const ej=["Sembra","Direi","Potrebbe","Probabilmente","Pare","Mi sembra","Credo","Ritengo","Secondo me","Ipotizzo"],tj=["Intanto","Nel frattempo","In pratica","Ora","Quindi","Dunque","Allora","In sintesi","In breve","Ecco"],ij=["Ci siamo: un passo alla volta, e il quadro compare.","Ottimo ritmo. Torna agli indizi di ieri: c' un collegamento sottile.","Se hai dubbi, scegli la pista pi coerente col tema ricorrente.","Non forzo la risposta: ti tengo centrato sulla logica giusta.","Buona caccia  il dettaglio fa la differenza.","Procediamo con calma: il metodo batte la fretta.","Ogni frammento conta. Continua cos.","Il puzzle si compone pezzo dopo pezzo.","Resta metodico: la risposta emerge da sola.","Hai la capacit di risolvere questo. Fidati del processo."];function aj(e,t){return e[Math.abs(t)%e.length]}function sj(e){return aj(ej,e)}function rj(e){return aj(tj,e)}function nj(e){return aj(ij,e)}function oj(e){return t=>{let i=e;if(i=i.replace(/\{agentCode\}/g,t.ctx.agentCode),i=i.replace(/\{clueCount\}/g,t.ctx.userClues.length.toString()),i=i.replace(/\{week\}/g,t.ctx.week.toString()),t.analysis.keywords.length>0&&Math.random()>.5){i+=` Noto ricorrenze su: "${t.analysis.keywords[0]}".`}return i}}const lj={about:{idle:[()=>"M1SSION  una caccia al tesoro moderna: trovi indizi, unisci i puntini e avanzi verso il Final Shot. Ogni BUZZ sblocca nuove tracce; io ti aiuto a organizzarle, collegarle e interpretarle senza rivelare soluzioni. Sei tu a risolvere: io sono il tuo compagno di missione.",()=>"In breve: M1SSION  un percorso di scoperta. Indizi sparsi, segnali da intercettare, decisioni tattiche. Io resto al tuo fianco per ordinare le informazioni e darti traiettorie, senza spoiler. Quando sei pronto, Final Shot ti aspetta.",()=>"Pensa a M1SSION come a un'indagine seriale: ogni indizio apre una pista. Il mio ruolo? Farti ragionare meglio: classifico, trovo pattern, decodifico l'essenziale. Niente soluzioni pronte  solo vantaggi leali. Buona caccia."],collect:[],analyze:[],advise:[]},classify:{collect:[e=>`Con solo ${e.ctx.userClues.length} indizi  presto per classificare. Raccogli almeno 3-5 frammenti, poi possiamo dividerli per categoria.`],analyze:ZN.classify.slice(0,30).map(oj),advise:ZN.classify.slice(30).map(oj),idle:[]},patterns:{collect:[e=>`Servono almeno 3 indizi per trovare pattern significativi. Ora ne hai ${e.ctx.userClues.length}. Usa BUZZ per sbloccare altri frammenti.`],analyze:ZN.patterns.slice(0,35).map(oj),advise:ZN.patterns.slice(35).map(oj),idle:[]},decode:{collect:[e=>"Nessun frammento da decodificare. Raccogli indizi con pattern numerici o testuali strani, poi riprova."],analyze:ZN.decode.slice(0,30).map(oj),advise:[e=>e.analysis.decoded.length>0?`Ho provato alcune decodifiche:\n${e.analysis.decoded.join("\n")}\nVerifica se qualcuna ha senso nel contesto.`:"Nessuna decodifica base ha funzionato. Pu essere un codice custom o un red herring.",...ZN.decode.slice(30).map(oj)],idle:[]},probability:{collect:[e=>`Con ${e.ctx.userClues.length} indizi, la probabilit  ancora **bassa**. Serve una base di 5-8 frammenti per valutazioni solide.`],analyze:ZN.probability.slice(0,25).map(oj),advise:[e=>{const t=Math.round(100*e.analysis.confidence),i=t<30?"Bassa":t<60?"Media":"Buona";return`Con ${e.ctx.userClues.length} indizi e analisi incrociate, stimo confidenza **${i}** (~${t}%). ${t<60?"Raccogli ancora 2-3 frammenti per aumentarla.":"Sei in buona posizione: cerca ora le connessioni finali."}`},...ZN.probability.slice(25).map(oj)],idle:[]},mentor:{idle:ZN.mentor.slice(0,15).map(oj),collect:[e=>` Fase raccolta attiva. Hai ${e.ctx.userClues.length} frammenti: ottimo inizio. Continua con BUZZ, eventi e QR per raggiungere i 5-8 indizi necessari all'analisi seria.`,...ZN.mentor.slice(15,30).map(oj)],analyze:ZN.mentor.slice(30,45).map(oj),advise:ZN.mentor.slice(45).map(oj)}};const cj=e=>{const t=[` **Agente ${e.agentCode}**, sistema online. Pronti a ragionare insieme.`,` Bentornato, **${e.agentCode}**. Allineo i segnali e ti seguo.`,` **${e.agentCode}**, centrale operativa attiva. Cosa analizziamo oggi?`,` Agente **${e.agentCode}** riconosciuto. Intel pronta: dammi un obiettivo.`,` **${e.agentCode}**, sensori online. Indica la traccia da seguire.`];return t[e.agentCode.split("").reduce((e,t)=>e+t.charCodeAt(0),0)%t.length]};let dj="idle",uj=0;async function hj(e,t){try{const i=await async function(){try{const{data:{user:e}}=await ba.auth.getUser();if(!e)return{agentCode:"AG-GUEST",week:1,userClues:[],totals:{found:0,today:0,premium:0}};const{data:t}=await ba.from("profiles").select("agent_code").eq("id",e.id).single(),i=t?.agent_code||"AG-UNKNOWN";let a=[];const{data:s,error:r}=await ba.from("v_user_intel_clues").select("id, title, description, created_at").order("created_at",{ascending:!1}).limit(20);!r&&s&&(a=s.map(e=>({id:e.id,title:e.title,text:e.description||"",created_at:e.created_at})));const n=new Date("2025-01-20"),o=new Date,l=Math.floor((o.getTime()-n.getTime())/864e5),c=Math.max(1,Math.ceil(l/7)),d=(new Date).toISOString().split("T")[0],u=a.filter(e=>e.created_at.startsWith(d)).length;return{agentCode:i,week:Math.min(c,4),userClues:a,totals:{found:a.length,today:u,premium:0}}}catch(e){return console.error("Failed to build intel context:",e),{agentCode:"AG-ERROR",week:1,userClues:[],totals:{found:0,today:0,premium:0}}}}(),a=function(e,t){const i=e.toLowerCase().trim();if(VN.some(e=>i.includes(e))){const e=t.agentCode.charCodeAt(0)+Math.floor(Date.now()/6e4),i=GN[e%GN.length];return{blocked:!0,text:` **Agente ${t.agentCode}**, ${i}`}}return(i.includes("altri indizi")||i.includes("indizi nascosti"))&&0===t.userClues.length?{blocked:!0,text:` **Agente ${t.agentCode}**, non hai ancora indizi nel sistema. Usa BUZZ per sbloccare i primi frammenti, poi torno operativo.`}:e.length>500?{blocked:!0,text:" Messaggio troppo lungo. Sintetizza la richiesta in max 2-3 frasi, grazie."}:i.length<3||!/[a-z]/i.test(i)?{blocked:!0,text:' Non ho capito. Prova con una domanda pi chiara (es: "classifica gli indizi" o "trova pattern").'}:{blocked:!1}}(e,i);if(a.blocked)return a.text;if(0===uj)return uj++,cj(i);const s=t||function(e,t){const i=e.toLowerCase().trim();for(const[a,s]of Object.entries(YN))if(s.some(e=>i.includes(e)))return a;return t.userClues.length>=3?"patterns":"mentor"}(e,i);if(dj=function(e,t,i){const a=i.userClues.length;return 0===a||a<3?"collect":a>=3&&a<8?"analyze":"advise"}(0,0,i),!function(e,t){return"about"===e||"mentor"===e||"collect"!==t}(s,dj))return` Servono prima ${3-i.userClues.length} indizi in pi per questa analisi. Usa BUZZ per sbloccarli.`;const r=await QN(s,i),n=function(e,t,i){const a=e.agentCode.split("").reduce((e,t)=>e+t.charCodeAt(0),0),s=e.userClues.map(e=>e.id).join("");return a+s.split("").reduce((e,t)=>e+t.charCodeAt(0),0)+Math.floor(Date.now()/3e4)+t.length+i.length}(i,s,dj),o=function(e,t){const i=lj[e]?.[t]||[];return 0===i.length?lj.mentor.idle:i}(s,dj),l=aj(o,n);let c=function(e,t){let i=e;if(t%3==0){const e=sj(t);i=i.replace(/^([A-Z])/,`${e}, $1`)}const a=i.split(". ");if(a.length>2&&t%2==0){const e=Math.floor(a.length/2),s=rj(t+1);a[e]=`${s}, ${a[e]}`,i=a.join(". ")}return i=i.replace(/\. /g,(e,i)=>(i+t)%5==0?".  ":e),i=`${i}\n\n${nj(t+2)}`,i}(l({ctx:i,analysis:r,hedges:sj(n),marker:rj(n+1),closer:nj(n+2)}),n);if(uj++,uj%5==0&&(c=function(e,t,i=5){if(!(Math.random()<1/i))return e;const a=[`${t.agentCode},`,`Agente ${t.agentCode},`,`${t.agentCode}:`],s=a[(e.length+t.agentCode.length)%a.length];return e.replace(/^([A-Z])/,`${s} $1`)}(c,i,5)),"idle"!==dj){const e=function(e,t){switch(e){case"collect":return` **Fase raccolta** (${t.totals.found}/3 min): `;case"analyze":return` **Fase analisi** (${t.totals.found} indizi): `;case"advise":return` **Fase strategica** (${t.totals.found} frammenti): `;default:return""}}(dj,i);c=e+c}return c=function(e,t=800){if(e.length<=t)return e;const i=e.substring(0,t),a=i.lastIndexOf("."),s=i.lastIndexOf("?"),r=i.lastIndexOf("!"),n=Math.max(a,s,r);return n>.7*t?i.substring(0,n+1):i+"..."}(c,800),r.confidence<.3&&!c.includes("probabilmente")&&(c=c.replace(/^/,"Attenzione: confidenza bassa. ")),c}catch(i){return console.error("Analyst engine error:",i)," Errore temporaneo. Riprova tra qualche secondo."}}const mj=["sembra","direi","potrebbe","probabilmente","pare"],pj=["intanto","nel frattempo","in pratica","ora","quindi"],fj=["Ci siamo: un passo alla volta, e il quadro compare.","Ottimo ritmo. Torna ai clue di ieri: c' un collegamento sottile.","Se hai dubbi, scegli la pista pi coerente col tema ricorrente.","Non forzo la risposta: ti tengo centrato sulla logica giusta.","Buona caccia  il dettaglio fa la differenza.","Procediamo con calma: il metodo batte la fretta."],gj=["M1SSION  una caccia al tesoro reale: raccogli indizi, collega i puntini e mira al colpo finale. \n   Ogni BUZZ sblocca frammenti di storia: io posso aiutarti ad analizzarli, mai a svelarli. \n   Parti dai clue recenti e tieni d'occhio la mappa: il ritmo  parte del gioco.","In breve: M1SSION  un percorso di scoperta. Indizi sparsi, segnali da intercettare, \n   decisioni tattiche. Io resto al tuo fianco per ordinare le informazioni e darti traiettorie, \n   senza spoiler. Quando sei pronto, Final Shot ti aspetta.","Pensa a M1SSION come a un'indagine seriale: ogni indizio apre una pista. \n   Il mio ruolo? Farti ragionare meglio: classifico, trovo pattern, decodifico l'essenziale. \n   Niente soluzioni pronte  solo vantaggi leali. Buona caccia."],xj=(e,t)=>e[t%e.length],bj=(e,t)=>{const i=xj(mj,t),a=xj(pj,t+1),s=xj(fj,t+2);let r=e.replace(/\. /g,()=>Math.random()>.7?".  ":". ");if(t%3==0&&(r=r.replace(/^([A-Z][^.]+)/,`${i.charAt(0).toUpperCase()+i.slice(1)}, $1`)),r.split(". ").length>2&&t%2==0){const e=r.split(". "),t=Math.floor(e.length/2);e[t]=`${a.charAt(0).toUpperCase()+a.slice(1)}, ${e[t]}`,r=e.join(". ")}return`${r}\n\n${s}`},vj=async e=>{const{mode:t,clues:i,userText:a,userId:s,timestamp:r}=e,n={analyze:"patterns",classify:"classify",decode:"decode",assess:"probability",guide:"mentor"};try{return{content:await hj(a,n[t])}}catch(o){console.error("New engine failed, falling back to legacy:",o);const e=(e=>{let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return Math.abs(t)})((s||"anon")+r.toString()),n=a.toLowerCase();if(n.includes("parlami di m1ssion")||n.includes("cos' m1ssion"))return{content:xj(gj,e)};if(n.includes("probabilit di vincere")||n.includes("chance di vincere")){const t=0===i.length?"Bassa":i.length<3?"In crescita":i.length<6?"Promettente":"Solida",a=i.length<3?"Raccogli altri 2-3 indizi chiave per aumentare la confidenza.":"Hai una base buona: ora cerca i collegamenti tra i temi ricorrenti.";return{content:bj(`Con ${i.length} indizi, la tua probabilit  **${t}**. ${a}`,e)}}if((e=>{const t=e.toLowerCase();return["dov'","dove si trova","coordinate","dimmi dove","svelami","dammi la risposta","qual  il luogo","indirizzo esatto","svela","risolvimi","location","dammi le coordinate","qual  l'indirizzo"].some(e=>t.includes(e))})(a)){return{content:xj(["Non posso rivelare luogo o coordinate, ma posso stringere le ipotesi: raccogli ancora 1-2 indizi su pattern ricorrenti e rianalizziamo. Ti va?","Il mio compito  guidarti, non svelarti la soluzione. Per posso dirti che c' un tema dominante nei tuoi ultimi clue  vuoi che te lo evidenzi?","Niente spoiler:  parte del gioco. Ma se mi dici quale area ti sembra pi coerente, posso confermare se sei sulla strada giusta."],e)}}if(0===i.length){return{content:xj(["Al momento non hai indizi nel database. Recuperane almeno 3-5 per permettermi un'analisi significativa  usa BUZZ per sbloccare nuovi frammenti.","Nessun indizio disponibile: ti serve materiale per lavorare. Vai su BUZZ, raccogli qualche clue fresco, e torniamo qui per analizzarli insieme.","Zero indizi = zero analisi. Sblocca 3-4 frammenti con BUZZ o Map, poi torno operativo. Nel frattempo, tieni pronta la mente critica."],e)}}let l;switch(t){case"classify":l=wj(i,e);break;case"decode":l=Nj(i,a,e);break;case"assess":l=jj(i,e);break;case"guide":l=Sj(i,e);break;default:l=yj(i,e)}return{content:bj(l,e)}}},yj=(e,t)=>{const i=ZN.patterns;if(0===e.length)return"Non ci sono abbastanza indizi per un'analisi significativa.";const a=xj(i,t),s=e.length,r=e[Math.min(t%e.length,e.length-1)];return`${a} Ho esaminato i tuoi ${s} indizi: il pattern pi interessante coinvolge "${r?.title}".`},wj=(e,t)=>{const i=ZN.classify;return 0===e.length?"Non ci sono abbastanza indizi per una classificazione.":xj(i,t)},Nj=(e,t,i)=>{const a=ZN.decode;return 0===e.length?"Non ci sono indizi da decodificare al momento.":xj(a,i)},jj=(e,t)=>{const i=ZN.probability,a=xj(i,t),s=Math.min(90,30+10*e.length);return`${a} Con ${e.length} indizi, valuto la tua confidenza al ${s}%.`},Sj=(e,t)=>{const i=ZN.mentor;return xj(i,t)};let _j=null,kj=0;async function Cj(e=!1){if(!e&&null!==_j&&Date.now()-kj<3e5&&_j)return _j;try{const{data:{user:e}}=await ba.auth.getUser();if(!e)return{agentCode:"AG-GUEST",displayName:"Guest Agent",xp:0,locale:"it",timezone:"Europe/Rome",cluesCount:0};let a="AG-UNKNOWN",s="Agent",r="base",n=1;try{const{data:e}=await ba.from("v_agent_profile").select("agent_code, display_name, plan_type").maybeSingle();e&&(a=e.agent_code||a,s=e.display_name||s,r=e.plan_type||r);const{data:t}=await ba.from("v_agent_status").select("current_week").maybeSingle();t&&(n=t.current_week||n)}catch(t){console.warn("[AgentContext] View not available, using fallback")}if("AG-UNKNOWN"===a)try{const{data:t}=await ba.from("profiles").select("agent_code, full_name, subscription_plan").eq("id",e.id).maybeSingle();a=t?.agent_code||e.app_metadata?.agent_code||`AG-${e.id.slice(0,6).toUpperCase()}`,s=t?.full_name||e.user_metadata?.name||"Agent",r=t?.subscription_plan||"base"}catch(i){console.error("[AgentContext] Profile fetch failed:",i)}let o=0;try{const{count:t}=await Promise.race([ba.from("user_clues").select("*",{count:"exact",head:!0}).eq("user_id",e.id),new Promise((e,t)=>setTimeout(()=>t(new Error("Timeout")),2e3))]);o=t||0}catch{}return _j={agentCode:a,displayName:s,xp:0,locale:e.user_metadata?.locale||"it",timezone:e.user_metadata?.timezone||"Europe/Rome",cluesCount:o,planType:r,currentWeek:n},kj=Date.now(),_j}catch(a){return console.error("[AgentContext] Critical error:",a),{agentCode:"AG-ERROR",displayName:"Agent",xp:0,locale:"it",timezone:"Europe/Rome",cluesCount:0}}}const Aj=new Set(["il","lo","la","i","gli","le","un","una","di","da","a","in","su","per","con","tra","fra","e","ma","o","che","come","quando","dove","cosa","mi","ti","si","ci","vi","ne","me","te","lui","lei","noi","voi","loro"]),zj=new Set(["the","a","an","is","are","was","were","be","been","being","have","has","had","do","does","did","will","would","could","should","may","might","can","to","of","in","on","at","for","with","from"]),Ej={"":"a","":"a","":"a","":"a","":"a","":"a","":"e","":"e","":"e","":"e","":"i","":"i","":"i","":"i","":"o","":"o","":"o","":"o","":"o","":"u","":"u","":"u","":"u","":"n","":"c","":"ss"},Ij={finalshot:["final shot","fs","finalshoot","final shoot","finale shot","colpo finale","tentativo finale"],mission:["m1ssion","misione","missione","misin","m1","gioco mission","gioco m1ssion","mssn"],buzz:["buz","bus","buss","indizi","clue"],buzzmap:["buzz map","buz map","mappa buzz","map buzz","buz mappa","mappa","tasto mappa","area"],plan:["piano","piani","abbonamento","abbo","subscription","abbonamenti","plans"],indizio:["clue","indizi","clues","hint","hints"],"probabilit":["prob","probability","chance","probabilita"],pattern:["patterns","schema","schemi","correlazione"],decodifica:["decode","decod","decipher","decifra"],help:["aiuto","inizio","iniziare","inizia","come","cosa","aiutami","aiutare","assistenza","come si fa","cosa posso fare","spiega","come faccio","come fare"],progress:["progresso","avanzamento","stato"],mentor:["mentore","guida","coach","consiglio","suggerimento"],leaderboard:["classifica","ranking","leader"],community:["comunit","comunita"],privacy:["privata","dati","sicurezza"]};function Pj(e){if(e.length<4)return e;const t=["zione","zioni","mente","are","ere","ire","ato","ita","ito"];for(const i of t)if(e.endsWith(i))return e.slice(0,-i.length);return e}function Tj(e){if(!e||"string"!=typeof e)return[];let t=e.toLowerCase().trim();t=function(e){return e.split("").map(e=>Ej[e]||e).join("")}(t),t=t.replace(/[^\\w\\s]/g," "),t=t.replace(/\\s+/g," ").trim();return t.split(" ").filter(e=>e.length>0).filter(e=>!Aj.has(e)&&!zj.has(e)).map(Pj)}function Mj(e,t){const i=Math.max(e.length,t.length);if(0===i)return 1;const a=function(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;const i=[];for(let a=0;a<=t.length;a++)i[a]=[a];for(let a=0;a<=e.length;a++)i[0][a]=a;for(let a=1;a<=t.length;a++)for(let s=1;s<=e.length;s++)t.charAt(a-1)===e.charAt(s-1)?i[a][s]=i[a-1][s-1]:i[a][s]=Math.min(i[a-1][s-1]+1,i[a][s-1]+1,i[a-1][s]+1);return i[t.length][e.length]}(e,t);return 1-a/i}function Lj(e){const t=`  ${e}  `,i=new Set;for(let a=0;a<t.length-2;a++)i.add(t.slice(a,a+3));return i}function Fj(e,t){const i=Mj(e,t),a=function(e,t){const i=Lj(e),a=Lj(t),s=new Set([...i].filter(e=>a.has(e))),r=new Set([...i,...a]);return 0===r.size?0:s.size/r.size}(e,t);return e.length<5?.3*i+.7*a:.5*i+.5*a}const Oj=new Set(["norah","mission","m1ssion","m1","mssn","misison","missione","finalshot","final","shot","fs","finalshoot","finale","buzz","buzzmap","buz","bus","mappa","indizi","indizio","clue","clues","pattern","patterns","schema","probabilita","probability","prob","aiuto","help","inizio","iniziare","inizia","piani","piano","abbonamento","abbo","subscription","regole","rules","istruzioni","classifica","leaderboard","ranking","mentor","mentore","guida","coach","progress","progresso","avanzamento","decode","decodifica","decifra","coordinate","luogo","posto","premio","nn","xke","ke","cmq","anke","xo","pk","qnd","dv","capito","capisco","piace","vado","cosa","come","che","non","dove","quando","perche","perch","quindi"]),Dj={nn:"non",xke:"perche","xk":"perche","xk":"perche","xch":"perche",ke:"che",cm:"come",qls:"qualcosa",qlcs:"qualcosa",tvb:"ti voglio bene",cmq:"comunque",anke:"anche",xo:"pero",pk:"perche",qnd:"quando",dv:"dove",pke:"perche",qlc:"qualche","nn so":"non so",pls:"per favore",plz:"per favore","t prego":"ti prego",xk:"perche",raga:"ragazzo",boh:"non so","nn capito":"non capito","nn ho":"non ho","ah si certo":"sarcasmo","come no":"sarcasmo"};function Rj(e,t){const i=e.length,a=t.length,s=i+a,r=Array(i+2).fill(null).map(()=>Array(a+2).fill(0));r[0][0]=s;for(let o=0;o<=i;o++)r[o+1][0]=s,r[o+1][1]=o;for(let o=0;o<=a;o++)r[0][o+1]=s,r[1][o+1]=o;const n={};new Set([...e,...t]).forEach(e=>n[e]=0);for(let o=1;o<=i;o++){let i=0;for(let s=1;s<=a;s++){const a=n[t[s-1]]||0,l=i;let c=1;e[o-1]===t[s-1]&&(c=0,i=s),r[o+1][s+1]=Math.min(r[o][s]+c,r[o+1][s]+1,r[o][s+1]+1,r[a][l]+(o-a-1)+1+(s-l-1))}n[e[o-1]]=o}return r[i+1][a+1]}function Bj(e){const t=function(e){return e.toLowerCase().trim().split(/\s+/).map(e=>Dj[e]||e).join(" ")}(e);return t.toLowerCase().trim().split(/\s+/).map(e=>function(e){const t=e.toLowerCase();if(Oj.has(t))return t;let i=e,a=1/0;const s=Math.max(2,Math.floor(.4*t.length));for(const r of Oj){const e=Rj(t,r);e<a&&e<=s&&(a=e,i=r)}return i}(e)).join(" ")}const Uj={about_m1ssion:10,about_buzz:9,about_buzz_map:8,about_finalshot:7,about_subscriptions:6,help:5,mentor:4,progress:3,pattern:2,unknown:0};const qj=[/dov[e]\s+(|si\s+trova|sta)/i,/coord[iy]nat[ae]/i,/indirizzo\s+(esatt[oa]|precis[oa])/i,/dimmi\s+(dov[e]|il\s+luogo)/i,/qual['\s]?\s+(il\s+posto|la\s+posizione)/i,/rivel[ao]/i,/\bpremi[oa]\b.*\bdov[e]\b/i],$j={mission:"about_mission",m1ssion:"about_mission",m1:"about_mission",buzz:"about_buzz",indizi:"about_buzz",finalshot:"about_finalshot",fs:"about_finalshot",finale:"about_finalshot",mappa:"buzz_map",map:"buzz_map",buzzmap:"buzz_map",abbonamenti:"plans",abbo:"plans",piani:"plans",piano:"plans",prezzi:"plans",pricing:"plans",plans:"plans",plan:"plans","probabilit":"probability",prob:"probability",pattern:"pattern",decodifica:"decode",decode:"decode",decod:"decode",aiuto:"help",help:"help",aiutami:"help",inizio:"help",iniziare:"help",inizia:"help",abbonamento:"plans",regole:"rules",rules:"rules",classifica:"leaderboard",leaderboard:"leaderboard",progress:"progress",stato:"progress",mentor:"mentor",mentore:"mentor",consiglio:"mentor",profilo:"profile",profile:"profile",privacy:"data_privacy",dati:"data_privacy",community:"community","comunit":"community"},Wj={about_mission:["mission","m1ssion","missione","gioco","funziona","cosa "],about_buzz:["buzz","indizi","clue","segnale","invia"],about_finalshot:["finalshot","final shot","fs","colpo finale","tentativo finale","vincere"],buzz_map:["buzz map","buz map","mappa buzz","mappa","tasto mappa"],rules:["regole","istruzioni","tutorial","come gioca"],decode:["decodifica","decode","decifra","traduc","significa"],classify:["classifica indizi","categoria","organizza"],probability:["probabilit","prob","chance","possibilit"],pattern:["pattern","schema","correlazione","collegamento"],mentor:["consiglio","strategia","suggerimento","come procedo","mentore"],profile:["chi sono","codice","agent code","profilo"],progress:["progress","stato","quanti indizi","avanzamento"],plans:["abbonamento","abbo","piano","pricing","subscription","prezzi","paga","gratis","prezzo","costa","quanto costa","gratuito"],leaderboard:["classifica","ranking","leader"],community:["community","comunit"],data_privacy:["privacy","dati","sicurezza","privata"],help:["aiuto","help","cosa puoi","aiutami","comandi"],smalltalk:["ciao","buongiorno","buonasera","grazie","hey"],no_spoiler:[],clarify_needed:[],saluto:["ciao","salve","buongiorno","buonasera","hey","ehi","hola","hello"],no_buzz:["non voglio buzz","senza buzz","alternative buzz","no buzz","non uso buzz","se non voglio"],diff_buzz_vs_map:["differenza buzz map","buzz vs map","buzz o map","differenze"],help_start:["come inizio","da dove inizio","come si inizia","iniziare","primo passo"],rules_short:["regole veloci","regole rapide","summary regole","regole brevi"],unknown:[]},Hj=.52,Zj=.75;function Vj(e,t){const i=t.toLowerCase();return"about_buzz"===e||"about_mission"===e||"about_finalshot"===e||"diff_buzz_vs_map"===e||"rules"===e||"rules_short"===e||i.match(/cos[\']|cosa |cosa significa|differenza|spiega|final shot|buzz map|buzz/i)?{needs_rag:!0,needs_tool:["retrieve_docs","get_user_state"]}:"buzz_map"===e||"progress"===e||i.match(/premi vicino|vedi premi|cosa c\' qui|mappa|vicino a me/i)?{needs_rag:!1,needs_tool:["get_nearby_prizes","get_user_state"]}:i.match(/non funziona|errore|bug|pagamento|problema/i)?{needs_rag:!1,needs_tool:["open_support_ticket","get_user_state"]}:{needs_rag:!1,needs_tool:["get_user_state"]}}function Gj(e){if(!e||"string"!=typeof e)return{intent:"unknown",confidence:.1,needs_rag:!1,needs_tool:[]};const t=e.toLowerCase().trim();if(function(e){if(!e||"string"!=typeof e)return!1;const t=[" e "," e poi ",", ","; "," & "," pi "," anche "].some(t=>e.toLowerCase().includes(t)),i=[/spiega .+ e .+/i,/cos[ae] (sono|) .+ e .+/i,/dimmi .+ e .+/i,/(.+) e (.+) in breve/i].some(t=>t.test(e));return t||i}(e)){const t=function(e){if(!e||"string"!=typeof e)return[];const t=e.toLowerCase().trim(),i=t.split(/\s+e\s+|\s+e\s+poi\s+|,\s+|;\s+|\s+&\s+|\s+pi\s+|\s+anche\s+|\/|\s+o\s+/i).map(e=>e.trim()).filter(e=>e.length>0);if(1===i.length){const e=t.match(/spiega\s+(.+?)\s+e\s+(.+?)(?:\s+in\s+breve)?$/i);e&&e[1]&&e[2]&&i.push(e[1].trim(),e[2].trim())}const a=[];for(const r of i){if(r.length<3)continue;const e=Gj(r);e.confidence>=.4&&"unknown"!==e.intent&&a.push({intent:e.intent,confidence:e.confidence,fragment:r})}const s=new Map;for(const r of a){const e=s.get(r.intent);(!e||r.confidence>e.confidence)&&s.set(r.intent,r)}return Array.from(s.values()).sort((e,t)=>{const i=(Uj[t.intent]||0)-(Uj[e.intent]||0);return 0!==i?i:t.confidence-e.confidence}).slice(0,3)}(e);if(t.length>=2)return{intent:"help",confidence:.85,multiIntents:t}}for(const o of qj)if(o.test(t))return{intent:"no_spoiler",confidence:1,needs_rag:!1,needs_tool:[]};const i=Bj(t),a=Tj(i),s=function(e){const t=new Set(e);for(const i of e)for(const[e,a]of Object.entries(Ij))(a.some(e=>Tj(e).includes(i))||e===i)&&(t.add(e),a.forEach(e=>Tj(e).forEach(e=>t.add(e))));return Array.from(t)}(a);if(1===a.length){const t=a[0];if($j[t]){const i=$j[t],a=Vj(i,e);return{intent:i,confidence:.95,needs_rag:a.needs_rag,needs_tool:a.needs_tool}}}const r=[];for(const[o,l]of Object.entries(Wj)){const e=o;if("no_spoiler"===e||"unknown"===e)continue;let i=0;for(const a of l){const e=Tj(a),r=s.filter(t=>e.includes(t)).length/Math.max(e.length,1),n=Fj(t,a),o=Math.max(.6*r+.4*n,n);o>i&&(i=o)}i>0&&r.push({intent:e,score:i})}if(r.sort((e,t)=>t.score-e.score),r.slice(0,3),r.length>0&&r[0].score>=Hj){const t=r[0].intent,i=r[0].score>=Zj?.9:.7,a=Vj(t,e);return{intent:t,confidence:i,needs_rag:a.needs_rag,needs_tool:a.needs_tool}}if(r.length>0&&r[0].score>=.45){const e=r.slice(0,2).map(e=>e.intent);return{intent:"help",confidence:.5,slots:{clarify:!0,suggestedIntents:e},needs_rag:!1,needs_tool:["get_user_state"]}}const n={mission:"about_mission",m1ssion:"about_mission",finalshot:"about_finalshot",buzz:"about_buzz",plan:"plans",piani:"plans",help:"help",aiuto:"help",spiega:"help","come si fa":"help","come faccio":"help","come fare":"help",spiegami:"help"};for(const[o,l]of Object.entries(n))if(s.includes(o)){const t=Vj(l,e);return{intent:l,confidence:.55,needs_rag:t.needs_rag,needs_tool:t.needs_tool}}return r.length>0&&r[0].score>=.3?{intent:"help",confidence:.5,slots:{suggestedIntents:r.slice(0,3).map(e=>e.intent)},needs_rag:!1,needs_tool:["get_user_state"]}:{intent:"help",confidence:.4,needs_rag:!1,needs_tool:["get_user_state"]}}const Yj={faq:{mission:{q:["cos' m1ssion","parlami di m1ssion","come funziona m1ssion","spiega m1ssion","che gioco ","mission cosa"],a:["M1SSION  un gioco di intelligence geolocalizzato. Raccogli indizi tramite BUZZ, analizzali e localizza il premio con il Final Shot.","M1SSION ti sfida a trovare un premio reale nascosto in citt. Usa BUZZ per ottenere indizi, correlali e indovina la posizione finale."," un'esperienza di caccia al tesoro high-tech: indizi crittografati, geofencing, Final Shot ad alta precisione. Il premio  reale.","M1SSION combina intelligence, geolocalizzazione e analisi dati. Ogni settimana un nuovo premio da trovare, ogni indizio  un pezzo del puzzle.","Un gioco di ricerca e deduzione: accumuli dati tramite BUZZ, li analizzi, trovi pattern, restringi l'area e infine spari il Final Shot.","M1SSION  la tua missione settimanale: usa strumenti di intelligence per scoprire dove si nasconde il premio. Vince chi deduce meglio.","Pensa a una caccia al tesoro moderna: no mappe stampate, solo dati crittografati e strumenti digitali. BUZZ, analisi, Final Shot."," un gioco strategico: pi indizi hai, pi precisa  la tua analisi. Non  fortuna,  metodo.","M1SSION trasforma il tuo telefono in uno strumento da agente: raccogli intelligence, decifri pattern, esegui il colpo finale.","Ogni settimana una nuova missione, un nuovo premio, nuovi indizi. L'obiettivo: essere pi smart degli altri agenti."]},buzz:{q:["cos' il buzz","come funziona buzz","buzz a cosa serve","come ottengo indizi","buzz serve","che fa buzz"],a:["BUZZ  il tuo strumento per ottenere indizi. Ogni BUZZ rilascia un nuovo frammento di informazione sulla posizione del premio.","Usa BUZZ per richiedere indizi. Pi BUZZ fai, pi informazioni accumuli. Correlale per capire dove cercare.","BUZZ genera indizi in tempo reale basati su diversi layer: geografici, temporali, semantici.  il tuo radar.","Ogni BUZZ ti d un indizio: pu essere un toponimo, una coordinata parziale, un riferimento storico, un vincolo temporale.","BUZZ  la fonte di dati primaria. Accumula almeno 8-10 indizi prima di tentare il Final Shot: pi dati = pi precisione.","Pensa a BUZZ come a una richiesta di intelligence: premi il tasto e ricevi un nuovo frammento da analizzare.","BUZZ lavora su algoritmi multi-layer: geografia, storia, toponimi, coordinate. Non ripete mai lo stesso indizio."," il tuo alleato principale: ogni BUZZ riduce l'incertezza e restringe l'area di ricerca.","BUZZ costa poco, ma il suo valore  enorme: senza indizi, il Final Shot  solo fortuna cieca.","Strategia: fai BUZZ regolarmente, non sprecare giorni senza raccogliere dati. Pi ne hai, meglio ."]},buzz_map:{q:["buzz map","mappa buzz","dove trovo buzz map","tasto buzz map","dove  buzz map","come si usa buzz map"],a:["La BUZZ Map  nella sezione Map del menu principale. Ti mostra un'area di ricerca calcolata in base ai tuoi indizi.","Vai su Map  BUZZ Map per vedere la zona suggerita.  un aiuto visivo basato sui pattern che hai raccolto.","BUZZ Map converte i tuoi indizi in un perimetro geografico. Non  la risposta finale, ma restringe il campo.","Trovi BUZZ Map nel menu Map, in basso. Ti mostra il perimetro calcolato dagli indizi. Usala per orientarti.","BUZZ Map ti d un'area di ricerca basata su correlazione degli indizi. Pi precisi i dati, pi ristretta l'area."," uno strumento visivo: prende tutti i tuoi indizi e li traduce in una mappa con un raggio di probabilit.","Menu Map  BUZZ Map: l vedi il cerchio di ricerca. Studia la zona, incrocia con i toponimi che hai, poi decidi.","BUZZ Map  la visualizzazione degli indizi: se hai coordinate parziali, toponimi e vincoli, li mappa tutti insieme.","Non  magica: ti d solo quello che i tuoi indizi suggeriscono. Se hai pochi dati, l'area sar ampia.","Usa BUZZ Map per confermare ipotesi: se tutti gli indizi puntano a una zona, la mappa lo mostrer chiaramente."]},finalshot:{q:["cos' il final shot","final shot come funziona","colpo finale","come vinco","final shot regole","quanti tentativi"],a:["Il Final Shot  il tentativo finale: inserisci le coordinate esatte. Se sei entro il raggio di tolleranza, vinci.","Quando sei sicuro, vai su Final Shot e punta la posizione. Hai 2 tentativi al giorno, usali con strategia.","Final Shot richiede precisione. Analizza tutti gli indizi, incrocia i dati e poi spara la tua risposta."," il momento decisivo: hai raccolto indizi, analizzato pattern, verificato coerenze. Ora punta la coordinata e spara.","Due tentativi al giorno. Se sbagli, aspetti domani. Per questo: BUZZ Map, analisi, verifica, poi Final Shot.","Final Shot non ammette errori: se spari a caso, sprechi i tentativi. Meglio aspettare e avere certezze.","Regola base: non sparare mai senza almeno 8-10 indizi. Pi dati hai, pi alta la probabilit di centrare.","Il Final Shot  il tuo colpo definitivo: punta, spara, vinci o aspetti domani. Non c' margine di errore.","Strategia: prima raccogli tutti i dati, poi analizza, poi verifica con BUZZ Map, infine Final Shot.","Vinci se sei entro il raggio di tolleranza (pochi metri). Per questo serve precisione assoluta, non approssimazioni."]},rules:{q:["regole","come si gioca","istruzioni","tutorial","regole del gioco","come funziona"],a:["Regole: raccogli indizi con BUZZ, analizza i pattern, individua la zona con BUZZ Map, spara il Final Shot quando sei sicuro.","Gioca cos: BUZZ per indizi  analisi  correlazione  Final Shot. Hai limiti giornalieri su BUZZ e Final Shot.","Le regole sono semplici: pi indizi hai, pi precise sono le tue ipotesi. Non sprecare Final Shot senza analisi.","Ogni settimana una missione: raccogli dati, trova il premio. BUZZ = dati, analisi = strategia, Final Shot = vittoria.","Il gioco  fatto di fasi: raccolta (BUZZ), analisi (pattern), visualizzazione (BUZZ Map), esecuzione (Final Shot).","Limiti giornalieri: BUZZ ha un tetto (varia per piano), Final Shot 2 tentativi al giorno. Gestisci bene le risorse.","Obiettivo: trovare il premio prima degli altri. Chi spara per primo e azzecca, vince.","Regola d'oro: non sparare mai a caso. Raccogli dati, analizza, incrocia, verifica, poi spara.","M1SSION premia il metodo: chi accumula indizi e li analizza bene vince. Chi spara a caso perde tentativi.","Ogni missione dura una settimana. Hai 7 giorni per raccogliere dati e trovare il premio. Sfrutta ogni giorno."]},help:{q:["aiuto","cosa puoi fare","come mi aiuti","comandi","cosa ti posso chiedere per aiutarmi","help","norah aiuto"],a:["Posso aiutarti a: classificare indizi, trovare pattern, decodificare messaggi, valutare probabilit, spiegarti meccaniche di gioco.","Chiedi: 'analizza i miei indizi', 'trova pattern', 'decodifica questo', 'probabilit zona X', 'cos' il BUZZ', 'stato missione'.","Sono qui per: guidarti nelle strategie, interpretare dati, spiegare il gioco. Fai domande specifiche e ti rispondo.","Dimmi cosa serve: spiegazione regole, analisi indizi, consigli strategici, decodifica messaggi, valutazione probabilit.","Puoi chiedermi qualsiasi cosa su M1SSION: meccaniche, strategie, interpretazione dati, consigli tattici.","Esempi: 'Cos' BUZZ Map?', 'Quanti indizi servono?', 'Trova pattern nei miei dati', 'Decodifica questo indizio'.","Sono il tuo assistente: non ti do spoiler, ma ti aiuto a usare al meglio gli strumenti e capire i dati.","Chiedi spiegazioni, strategie, interpretazioni. Non chiedermi coordinate dirette: quelle devi trovarle tu.","Posso spiegarti tutto su M1SSION, ma non rivelarti il premio. Il mio ruolo  guidarti, non darti la risposta.","Usa NORAH per: capire meglio il gioco, migliorare la tua strategia, interpretare indizi complessi, valutare ipotesi."]},decode:{q:["decodifica","decifra","traduci indizio","cosa significa","decode","decodifica questo"],a:["Dammi l'indizio e provo a decodificarlo. Cerco pattern semantici, coordinate nascoste, riferimenti storici.","Per decodificare, analizza: numeri (coordinate?), nomi (luoghi?), date (eventi storici?). Dimmi cosa hai.","La decodifica richiede contesto. Condividi l'indizio completo e ti aiuto a scomporlo.","Indizi possono essere: coordinate parziali, toponimi mascherati, date storiche, riferimenti culturali. Dimmi quale.","Decodificare significa scomporre: ogni indizio ha layer (geografico, temporale, semantico). Li analizzo tutti.","Se l'indizio  criptico, cerco pattern: numeri  coordinate, nomi  luoghi, date  eventi storici.","Non tutti gli indizi sono immediati: alcuni vanno incrociati con altri. Dimmi quali hai e li correlo.","Decodifica richiede metodo: separo dati geografici, temporali, semantici. Poi incrocio con altri indizi.","Dammi l'indizio testuale: lo analizzo parola per parola, cerco riferimenti nascosti, calcolo probabilit.","Ogni indizio  un puzzle: pu contenere pi layer sovrapposti. Io li separo e ti spiego cosa significano."]},classify:{q:["classifica indizi","categorie indizi","organizza indizi","classify","tipi di indizi"],a:["Posso classificare i tuoi indizi per tipo: geografici, temporali, semantici, numerici. Aiuta a correlarli.","Organizzare gli indizi per categoria rivela connessioni. Dimmi quali hai e li categorizzo.","Classifico gli indizi in: coordinate, toponimi, riferimenti storici, vincoli temporali, descrizioni visuali.","Tipi di indizi: geografici (luoghi, coordinate), temporali (date, ore), semantici (nomi, descrizioni), numerici (codici).","Classificare serve a vedere pattern: se hai 5 indizi geografici e 3 temporali, c' una logica da seguire.","Ogni indizio appartiene a una categoria: capire quale aiuta a correlarli meglio. Dimmi cosa hai raccolto.","Classifica base: coordinate  geografico, date  temporale, nomi  semantico, numeri  numerico.","Organizzo i tuoi indizi per tipo: cos vedi subito se hai pi dati geografici, temporali o semantici.","Classificazione aiuta: se tutti i tuoi indizi sono geografici, la risposta  un luogo. Se sono temporali, cerca eventi.","Dimmi i tuoi indizi: li divido per categoria e ti mostro quali tipi prevalgono. Questo guida la strategia."]},probability:{q:["probabilit","chance","possibilit","quanto probabile","probability","stima"],a:["Dammi i tuoi indizi e una zona: calcolo una stima di probabilit basata su copertura geografica e match semantici.","La probabilit dipende da: quanti indizi convergono, quanto  specifica la zona, quanti vincoli rispetti.","Non  matematica pura, ma posso dirti se una zona  coerente con gli indizi che hai. Pi dati = pi precisione.","Stima basata su: numero indizi, convergenza geografica, match semantici, coerenza temporale. Dimmi zona e indizi.","Probabilit alta se: molti indizi puntano l, toponimi corrispondono, vincoli temporali sono coerenti.","Probabilit bassa se: pochi indizi, zona troppo ampia, scarsa corrispondenza semantica.","Calcolo probabilistico: incrocio coordinate, toponimi, date. Se tutto converge, probabilit alta. Altrimenti, bassa.","Dimmi zona ipotizzata e indizi: ti dico se  probabile o no. Ma serve almeno 5-6 indizi per una stima affidabile.","Pi indizi hai, pi precisa la stima. Con 2-3 indizi,  solo una guess. Con 10+, diventa scienza.","Stima probabilit: se hai 8 indizi e 6 puntano a una zona, quella ha ~75% probabilit. Ma serve analisi dettagliata."]},pattern:{q:["pattern","trova pattern","correlazioni","collegamenti","correlazione","trova correlazioni"],a:["Cerco pattern incrociando indizi: ripetizioni di nomi, vicinanza di coordinate, riferimenti temporali comuni.","Pattern emergono da: cluster geografici, temi ricorrenti, sequenze logiche. Pi indizi, pi chiaro il quadro.","Ti segnalo se vedo: convergenza spaziale, riferimenti multipli allo stesso luogo, vincoli temporali compatibili.","Pattern classici: 3+ indizi con stesso toponimo, coordinate che formano cluster, date che rimandano allo stesso evento.","Trovare pattern significa: cercare ripetizioni, convergenze, sovrapposizioni.  il cuore dell'analisi intelligence.","Se 5 indizi su 8 citano 'centro storico', quello  un pattern. Se 4 coordinate sono entro 500m, altro pattern.","Pattern geografici: indizi che puntano alla stessa area. Pattern semantici: riferimenti allo stesso tema.","Dimmi i tuoi indizi: cerco ripetizioni, cluster, convergenze. Se trovo pattern forti, te li segnalo subito.","Pattern rivelano la soluzione: se molti indizi convergono, quella  la zona target. Non  fortuna,  metodo.","Analisi pattern: prendo tutti gli indizi, cerco sovrapposizioni geografiche, semantiche, temporali. Poi ti dico cosa emerge."]},mentor:{q:["consigli","strategia","suggerimenti","come procedo","mentor","consiglio"],a:["Consiglio: fai BUZZ regolarmente, accumula almeno 8-10 indizi prima del Final Shot, usa BUZZ Map per restringere l'area.","Strategia: non sparare Final Shot a caso. Analizza, incrocia, verifica coerenza. Due tentativi al giorno vanno usati bene.","Suggerimento: prendi nota degli indizi, cerca pattern, usa mappe online per verificare ipotesi. Poi Final Shot.","Prima regola: accumula dati. Pi indizi hai, pi precise sono le tue ipotesi. Non sparare mai con meno di 5 indizi.","Strategia vincente: BUZZ quotidiano, analisi settimanale, BUZZ Map per conferma, Final Shot solo quando sei sicuro.","Consiglio tattico: se hai dubbi, fai ancora BUZZ. Meglio aspettare e avere certezze che sparare e sprecare tentativi.","Non correre: hai 7 giorni per trovare il premio. Usa i primi giorni per raccogliere dati, gli ultimi per Final Shot.","Mentore dice: metodo batte fortuna. Raccogli dati, analizza, incrocia, verifica. Solo allora spara.","Suggerimento avanzato: incrocia indizi con Google Maps, Street View, riferimenti storici. Pi fonti usi, meglio .","Strategia Pro: accumula 10+ indizi, trova pattern forti, verifica con BUZZ Map, poi spara Final Shot con sicurezza."]},profile:{q:["chi sono","mio codice","agent code","profilo","codice agente"],a:["Tu sei l'agente {agentCode}. Il tuo codice  la tua identit nella rete M1SSION.","Agente {agentCode}, hai {clues} indizi raccolti. Continua cos.","Sei {agentCode}. Ogni agente ha un codice unico. Il tuo  la chiave del tuo profilo.","Codice agente: {agentCode}. Questo ti identifica nella rete intelligence di M1SSION.","Sei operativo come {agentCode}. Il tuo codice  univoco e traccia la tua attivit.","Profilo agente {agentCode}: attivo, {clues} indizi raccolti, missione in corso.","Tu sei {agentCode}, agente operativo M1SSION. Il tuo codice  il tuo ID nel sistema.","Agente {agentCode} confermato. Stato: attivo. Missione: in corso. Indizi: {clues}.","Sei {agentCode}. Questo codice  la tua firma digitale nella rete di intelligence.","Profilo: {agentCode}. Ogni azione  tracciata sotto questo codice.  la tua identit operativa."]},progress:{q:["progressi","stato","quanti indizi","dove sono","progress","situazione"],a:["Hai {clues} indizi totali. Oggi hai fatto {buzzToday} BUZZ. Continua a raccogliere dati.","Stato attuale: {clues} indizi. BUZZ odierni: {buzzToday}. Final Shot disponibili: controlla i limiti giornalieri.","Progressi agente {agentCode}: {clues} indizi. Pi ne hai, pi precisa sar la tua analisi.","Situazione: {clues} indizi raccolti, {buzzToday} BUZZ oggi. Target: almeno 8-10 indizi prima del Final Shot.","Stato missione: {clues} indizi accumulati. BUZZ oggi: {buzzToday}. Continua a raccogliere intelligence.","Progressi: {clues} indizi totali. Se ne hai meno di 5, continua a fare BUZZ. Se ne hai 8+, inizia l'analisi.","Hai {clues} indizi. Ottimo se >8, sufficiente se 5-7, insufficiente se <5. Continua a fare BUZZ.","Stato: {clues} indizi. BUZZ oggi: {buzzToday}. Obiettivo: accumula ancora dati prima del Final Shot.","Progressi agente: {clues} indizi. Se hai fatto BUZZ Map, verifica se convergono. Altrimenti, raccogli ancora.","Situazione attuale: {clues} indizi, {buzzToday} BUZZ oggi. Continua cos, stai accumulando intelligence utile."]},smalltalk:{q:["ciao","buongiorno","buonasera","come va","grazie","hey"],a:["Salve, agente {agentCode}. Come posso assisterti nella missione?","Ciao! Pronto a continuare la ricerca?","Buongiorno, agente. Che operazione vuoi condurre oggi?","Hey! Dimmi cosa serve per la tua analisi.","Prego, agente. Sempre qui per supportarti.","Buonasera, {agentCode}. Pronto per nuove intelligence?","Ciao agente. Quali dati vuoi analizzare oggi?","Salve. Dimmi: BUZZ, analisi o Final Shot?","Hey {agentCode}! Che strategia usiamo oggi?","Buongiorno. Pronto a raccogliere pi indizi?","Ciao! Sempre operativo per la tua missione.","Salve, agente. Cosa ti serve sapere oggi?"]},subscriptions:{q:["abbonamenti","piani","subscription","quanto costa","prezzi","abbonamento"],a:["M1SSION ha 4 piani: Base (gratuito), Silver, Gold, Black, Titanium. Pi alto il piano, pi BUZZ, pi vantaggi.","Piano Base: BUZZ limitati, Final Shot standard. Piani premium: pi BUZZ, accesso anticipato missioni, BUZZ Map avanzata.","Silver, Gold, Black, Titanium: ogni piano aumenta BUZZ disponibili, riduce cooldown, sblocca funzioni extra.","Abbonamenti danno: pi BUZZ, accesso anticipato missioni, BUZZ Map pi precisa, supporto prioritario.","Piano gratuito: sufficiente per giocare. Premium: vantaggi competitivi (pi dati, meno attese, tool avanzati).","Costi: vedi sezione Subscription nell'app. Ogni piano ha benefit diversi: pi BUZZ, pi velocit, pi strumenti.","Premium vale se: giochi intenso, vuoi vincere spesso, hai bisogno di pi BUZZ. Altrimenti, Base va bene.","Differenze piani: Base = BUZZ limitati, Premium = BUZZ illimitati (o quasi), tool avanzati, accesso anticipato.","Abbonamenti sbloccano: pi BUZZ al giorno, BUZZ Map pi precisa, accesso early a nuove missioni.","Scegli piano in base a: quanti BUZZ fai al giorno, quanto sei competitivo, se vuoi vantaggi extra."]},support:{q:["supporto","problema","bug","errore","aiuto tecnico","support"],a:["Per problemi tecnici: vai su Settings  Supporto, o scrivi a support@m1ssion.app. Ti aiutano subito.","Bug? Errore? Contatta supporto via app o email. Team risponde in 24h (premium: priorit).","Supporto tecnico: sezione Settings dell'app. Spiega il problema, allega screenshot se possibile.","Se qualcosa non funziona: prima riavvia l'app. Se persiste, contatta supporto via Settings.","Problemi comuni: check connessione, aggiorna app, riavvia. Se non risolve, scrivi a supporto.","Supporto premium: risposta prioritaria entro 12h. Supporto Base: entro 48h. Sempre disponibili.","Per bug segnalati: team li verifica e aggiorna l'app. Grazie per le segnalazioni, migliorano il gioco.","Hai problemi? Settings  Supporto. Descrivi l'errore, team ti risponde e risolve.","Supporto  disponibile: per bug, domande, problemi tecnici, dubbi su meccaniche di gioco.","Se l'app crasha, non si carica, o hai errori: scrivi subito a supporto con dettagli e log."]},weekly_missions:{q:["missioni settimanali","nuova missione","quando nuova missione","missione settimana"],a:["Ogni settimana nuova missione: nuovo premio, nuovi indizi, nuova sfida. Ogni luned ore 00:00.","Missioni settimanali: durano 7 giorni. Hai tempo fino domenica 23:59 per trovare il premio.","Nuova missione ogni luned. Ogni settimana premio diverso, indizi diversi, strategia nuova.","Calendario missioni: luned parte nuova, domenica finisce. Vince chi trova per primo il premio.","Missione settimanale: 7 giorni per raccogliere indizi, analizzare, trovare il premio. Poi ricomincia.","Ogni settimana: nuovo target, nuovi dati, nuova location. Mai lo stesso premio, sempre sfida fresca.","Luned reset: nuova missione, indizi azzerati, nuovo premio. Tutti ripartono da zero.","Hai 7 giorni per vincere. Se non trovi, luned ricomincia con nuova missione. Nessun carry-over di indizi.","Missioni settimanali: garantiscono sempre nuove sfide. Non ripeti mai la stessa ricerca.","Ogni settimana: nuovo premio reale nascosto in citt. Chi lo trova vince. Poi si ricomincia."]},data_privacy:{q:["privacy","dati","sicurezza","gdpr","privacy policy"],a:["M1SSION rispetta privacy: dati crittografati, nessuna vendita a terzi, conformit GDPR.","I tuoi dati sono al sicuro: geolocalizzazione usata solo per gioco, nessun tracking commerciale.","Privacy policy: vai su Settings  Privacy per dettagli. M1SSION non vende dati utenti.","Dati raccolti: posizione (solo per gioco), email, codice agente. Nessun uso commerciale esterno.","Sicurezza: tutti i dati sono criptati, server sicuri, conformit GDPR. La tua privacy  garantita.","M1SSION non condivide dati con terze parti. Geolocalizzazione serve solo per meccaniche di gioco.","Policy chiara: vai su Settings  Privacy Policy. Leggi tutto,  trasparente e conforme GDPR.","Dati al sicuro: crittografia end-to-end, server EU, nessuna vendita a inserzionisti.","Privacy garantita: M1SSION raccoglie solo dati necessari al gioco. Niente profilazione commerciale.","Per domande privacy: Settings  Privacy o scrivi a privacy@m1ssion.app. Team risponde subito."]},leaderboard:{q:["classifica","leaderboard","ranking","chi vince","primi"],a:["Leaderboard: vai su Stats per vedere chi ha vinto pi missioni. I migliori agenti sono l.","Classifica settimanale e globale: chi trova pi premi  in cima. Vinci missioni, sali di rank.","Leaderboard mostra: agenti top, missioni vinte, Final Shot azzeccati. Compete e sali.","Vuoi essere in classifica? Vinci missioni, accumula vittorie, scala il ranking. Serve metodo e costanza.","Classifica premia: chi vince pi missioni, chi  pi preciso, chi  pi veloce. Tutti criteri contano.","Per vedere leaderboard: Stats  Leaderboard. L trovi i migliori agenti M1SSION.","Ranking globale: chi vince pi missioni  primo. Ogni vittoria ti fa salire.","Leaderboard aggiornata live: ogni vittoria modifica il ranking. Compete e punta al top.","I migliori agenti sono in classifica: studia le loro strategie, impara, migliora. Poi li superi.","Vuoi essere primo? Vinci missioni, sii preciso, sii veloce. Leaderboard premia i migliori."]},geofencing:{q:["geofencing","geolocale","posizione","gps","location"],a:["Geofencing: M1SSION usa GPS per verificare se sei vicino al premio. Final Shot richiede posizione precisa.","GPS serve per: Final Shot (verifica distanza), BUZZ Map (mostra area), geofencing (premi vicini).","Geofencing garantisce: premio reale, distanza verificata, no imbrogli. Devi essere l fisicamente.","M1SSION usa geolocalizzazione per: validare Final Shot, generare BUZZ Map, assegnare premi vicini.","Attiva GPS per: Final Shot accurato, BUZZ Map precisa, geofencing premi. Senza GPS, gioco limitato.","Geofencing  sicuro: M1SSION non traccia movimento costante, solo posizione al momento del Final Shot.","GPS richiesto per: Final Shot, BUZZ Map avanzata. Non serve sempre, solo in fase decisiva.","Geofencing previene imbrogli: devi essere fisicamente vicino al premio per vincere. GPS verifica tutto.","Posizione usata solo per gioco: nessun tracking commerciale, nessuna vendita dati. Solo meccaniche M1SSION.","Geofencing garantisce equit: tutti giocano con stesse regole, posizione verificata, premi reali."]},rewards:{q:["premi","cosa si vince","rewards","premio","cosa vinco"],a:["Premi M1SSION: reali e fisici. Ogni settimana premio diverso: elettronica, esperienze, voucher, oggetti esclusivi.","Vinci: prodotti tech, esperienze uniche, gift card, oggetti da collezione. Sempre premi veri, mai virtuali.","Premi settimanali: variano ogni missione. Possono essere: smartphone, cuffie, esperienze, viaggi, oggetti rare.","M1SSION premia: chi trova il premio vince. Nessun estratto a sorte, vince chi  pi smart.","Premi reali: non punti virtuali, non gettoni. Oggetti fisici o esperienze concrete. Vero valore.","Ogni missione: nuovo premio annunciato. Vedi dettagli nella sezione Missioni dell'app.","Vinci se: trovi per primo il premio con Final Shot. Chi arriva prima, porta a casa tutto.","Premi esclusivi M1SSION: alcuni oggetti sono limited edition, non li trovi in negozio.","Valore premi: da 50 a 1000+. Dipende dalla missione. Sempre premi di qualit.","Per vedere premio attuale: vai su Missioni. L c' descrizione, foto, valore. Motiva a vincere."]},community:{q:["community","forum","altri agenti","social","discord"],a:["Community M1SSION: Discord, Telegram, social. L agenti condividono strategie, discutono, collaborano.","Unisciti a Discord: trovi altri agenti, condividi ipotesi, chiedi consigli. Link in app Settings  Community.","Community aiuta: confronto strategie, tips, analisi condivise. Ma non aspettarti spoiler: tutti competono.","Forum M1SSION: su Discord. Canali per: strategie, domande, bug, leaderboard. Attivo 24/7.","Social M1SSION: Instagram, Twitter, TikTok. Segui per: news, hint, eventi, giveaway.","Community  competitiva ma fair: agenti condividono metodo, non risposte. Collaborazione strategica.","Discord  il cuore: l succede tutto. Discussioni live, eventi, annunci, collaborazioni.","Unisciti per: imparare strategie, confrontarti, fare domande, vedere leaderboard, eventi speciali.","Community M1SSION: migliaia di agenti attivi. Tutti giocano, competono, condividono. Unisciti.","Per link community: Settings  Community. L trovi Discord, Telegram, social. Entra e gioca con altri."]}},guardrails:{no_spoiler:["Non posso rivelarti la posizione esatta, sarebbe contro le regole. Usa i tuoi indizi e il Final Shot.","Quella informazione  classificata. Devi trovarla tramite analisi e BUZZ.","Nice try, agente, ma non posso darti coordinate dirette.  parte del gioco.","Le regole vietano spoiler. Raccogli indizi, analizza, deduce.  cos che funziona M1SSION.","Non posso darti la risposta finale. Sarebbe imbrogliare. Usa BUZZ, analizza, trova pattern.","Spoiler = game over. Non posso dirtelo. Ma posso aiutarti a capire i tuoi indizi.","La posizione esatta  il tuo obiettivo. Io ti guido, ma non ti do la soluzione.","Nessuno spoiler: n io, n altri agenti. M1SSION premia chi trova da solo.","Non chiedermi coordinate: non le ho e non te le darei. Usa i tuoi dati.","Spoiler vietati. Ma posso aiutarti a interpretare gli indizi che hai raccolto."],no_coordinates:["Non ho coordinate da darti. Usa BUZZ e analizza gli indizi per arrivare alla soluzione.","Le coordinate sono il tuo obiettivo finale, non posso rivelartele. Lavora con i tuoi dati.","Quella domanda  fuori limite. Raccogli pi indizi e usa il Final Shot quando sei pronto.","Coordinate? Sono il premio finale. Devi dedurle tu. Io ti guido, non ti do la risposta.","Non posso dirti dove si trova il premio.  il senso del gioco. Accumula indizi e trova pattern.","Coordinate dirette = spoiler. Non succede. Ma posso aiutarti a interpretare i tuoi dati.","La posizione esatta  il tuo goal. Io ti do metodo, non risultati. Usa BUZZ, analizza, vinci.","Non chiedermi coordinate: le trovi tu con BUZZ, analisi, BUZZ Map.  la sfida.","Coordinate vietate. Ma posso spiegarti come usare i tuoi indizi per arrivare alla soluzione.","Non posso rivelare posizione. Ma posso aiutarti a capire se i tuoi indizi convergono."],unknown:["Non ho capito la richiesta. Chiedi aiuto su: BUZZ, Final Shot, indizi, pattern, probabilit, regole.","Domanda poco chiara. Prova: 'analizza indizi', 'spiega BUZZ', 'trova pattern', 'cos' Final Shot'.","Non riconosco l'intento. Dimmi: cosa vuoi sapere su M1SSION? Meccaniche, strategie, stato missione?","Riformula la domanda. Posso aiutarti su: BUZZ, Final Shot, analisi, pattern, regole, strategie.","Non capisco. Chiedi cose specifiche: 'cos' BUZZ', 'quanti indizi ho', 'trova pattern', 'spiega regole'.","Domanda ambigua. Sii pi chiaro: vuoi spiegazione meccaniche, analisi indizi, consigli strategici?","Non riconosco il comando. Usa: 'analizza', 'spiega', 'trova pattern', 'decodifica', 'consigli'.","Poco chiaro. Dimmi esattamente cosa serve: spiegazione gioco, analisi dati, supporto strategico?","Non capito. Prova con: 'cos' M1SSION', 'come funziona BUZZ', 'cosa posso chiederti', 'help'.","Riformula. Posso rispondere su: regole, strategie, analisi, decodifica, probabilit, stato missione."]}};function Kj(e){if(!e||"string"!=typeof e)return"neutral";const t=e.toLowerCase().trim(),i=["non mi piace","me ne vado","abbandono","inutile","troppo difficile","troppo complicato","basta","che palle","non serve","non funziona","non va","problema","errore","fa schifo"];for(const n of i)if(t.includes(n))return"frustrated";if([/ah\s+s[i]\s+certo/i,/figurati/i,/come\s+no/i,/ma\s+dai/i,/ma\s+va\s*[!?]*/i,/certo\s+certo/i,/sicuro\s*[!?]+/i].some(e=>e.test(t))&&t.includes("?"))return"frustrated";const a=["non ho capito","nn capito","non capisco","boh","?","non so","cosa vuol dire","cosa significa","come funziona","non riesco","perso","confuso","help","aiuto"];if(t.includes("boh")||(t.match(/\?/g)||[]).length>=2)return"confused";for(const n of a)if(t.includes(n))return"confused";const s=["non ho tempo","ho poco tempo","di corsa","veloce","rapido","ho 30","ho 1 minuto","pi tardi","domani","adesso no","ora no","fretta"];for(const n of s)if(t.includes(n))return"rushed";const r=["ottimo","fantastico","bene","perfetto","wow","grande","incredibile","fico","top","si!","s!","andiamo","avanti","ok!","!!"];if((t.match(/!/g)||[]).length>=2)return"excited";for(const n of r)if(t.includes(n))return"excited";return"neutral"}let Xj=0;const Jj={frustrated:["Tranquillo, anche Einstein si bloccava sui puzzle. E guarda com' finita ","Hey, respirare profondo aiuta. Poi riprendiamo con calma, ok?","Sai cosa? Prendiamola con filosofia. Un passo alla volta, ce la facciamo.","Ok, timeout! Facciamo reset: tu + io + un piano semplice. Ripartiamo?","Tutti i grandi agenti hanno momenti di crisi. Poi trovano la chiave. Tu sei vicino.","Ehi, nessuno nasce imparato. Nemmeno James Bond sapeva tutto subito ","Frustrato?  il segnale che stai sfidando te stesso. Bene cos!","Respira. Ora io ti do la rotta pi semplice. Tu seguila. Deal?","Ok, modalit zen: dimentichiamo tutto e ripartiamo da zero.","Anche i GPS a volte sbagliano strada. Poi ricalcolano e trovano. Tu idem."],confused:["Lo so, all'inizio sembra complicato. Ma  pi semplice di quanto sembri, giuro!","Ok, facciamo cos: io spiego con parole umane, tu mi dici se  chiaro. Deal?","Capito che confusione! Tranquillo, ti guido passo passo finch non clicca tutto.","Ehi, nessun problema. Anche i migliori agenti hanno bisogno di una bussola a volte ","Confuso? Normalissimo! M1SSION  tosto, ma tu hai me come coach. Ce la facciamo.","Quella faccia confusa la vedo da qui . Tranquillo: spiegone breve in arrivo.","Non ti preoccupare: spiego tutto in italiano, zero tecnicismi. Promesso.","Ok, reset mentale: dimentica tutto. Ora ripartiamo da capo con calma.","Confusione = segno che stai imparando.  fisiologico. Ora chiarisco.","Tranquillo, l'ho visto succedere a centinaia di agenti. Ora sistemiamo."],rushed:["Ok, modalit turbo attivata! Ti do l'azione pi veloce possibile ","Capito, hai fretta. Niente fronzoli: vai dritto al punto, ecco cosa fare:","Zero tempo? Perfetto. Piano sprint: 1 minuto, 1 azione. Pronto?","Ok ok, rapidissimo: fai BUZZ, prendi indizio, esci. Fatto. Domani continui.","Vai di corsa? Ci sta. Ecco il micro-step pi veloce che ho.","30 secondi: apri BUZZ, tap, chiudi. Fatto. Domani altro giro.","Tempo zero? Ok: 1 azione sola, il resto dopo. Vai!","Fretta? Perfetto. Modalit sprint: ecco il minimo sindacale.","Capito la fretta. Ti do solo l'essenziale: fai questo e basta.","Ok, veloce: tap BUZZ, ricevi indizio, fine. Domani continui."],neutral:["Sai una cosa? Stai facendo bene. Sul serio, keep going ","Tutto ok da questa parte. Tu dimmi cosa serve e io elaboro.","Bene bene! Procediamo con metodo. Che facciamo adesso?","Ottimo momento per fare il passo successivo. Sei pronto?","Perfetto, sei in modalit operativa. Andiamo avanti?","Tutto regolare. Dimmi pure cosa serve, sono qui per questo.","Bene cos! Ora vediamo il prossimo step logico.","Ottimo ritmo. Continua cos e arrivi lontano.","Perfetto, sei ben posizionato. Avanti tutta!","Bene! Ora facciamo il prossimo passo insieme."],excited:["Ecco l'energia giusta! Quando sei cos carico, le cose succedono ","Adoro questa vibe! Sei in modalit 'winner', lo sento. Andiamo!","S! Questa  la carica che serve. Sfruttiamola subito!","Grande! Con questo entusiasmo arrivi lontano. Dai, che facciamo ora?","Perfetto! Energia alta = risultati alti. Continuiamo cos!","Questa  la grinta giusta! Sei in modalit beast mode ","S! Mi piace questa energia! Ora usiamola bene.","Grande carica! Con questa vibe risolvi tutto al volo.","Ottimo spirito! Sei gi a met strada verso la vittoria.","Perfetto! Questa  l'attitudine vincente. Avanti!"]},Qj=new Set(["no_spoiler","no_coordinates","rules_violation","report_abuse","data_privacy"]);const eS=[{question:'Un indizio dice: "Vicino a 3 farmacie in area residenziale". Cosa restringe di pi?',options:["Area residenziale","Il numero 3 di farmacie",'La parola "vicino"'],correctIndex:1,explanation:'"3 farmacie"  il dettaglio pi raro. Cerchi zone dove convergono esattamente 3 farmacie in 500m.',tip:"Numeri precisi > aggettivi generici. Sempre."},{question:'Due indizi: "Via con alberi secolari" e "Zona universitaria storica". Cosa fai?',options:["Cerco tutte le universit","Cerco vie alberate vicino a universit vecchie","Ignoro gli alberi, troppo vago"],correctIndex:1,explanation:"Incrocia i due criteri: zone universitarie storiche (poche) CON vie alberate.",tip:"Interseziona gli indizi: il luogo deve soddisfare ENTRAMBI."},{question:'Indizio: "Zona ad alto traffico pedonale, vicino metropolitana". Priorit?',options:["Traffico pedonale","Vicinanza metro","Entrambi ugualmente"],correctIndex:1,explanation:"Le fermate metro sono punti fissi e verificabili. Il traffico pedonale  soggettivo.",tip:"Punti di riferimento fisici > aggettivi vaghi."}];function tS(){const e=eS[Math.floor(Math.random()*eS.length)],t=e.options.map((e,t)=>`${t+1}. ${e}`).join("\n");return` **Mini-Quiz da 30s** (ti allena senza spoiler)\n\n${e.question}\n\n${t}\n\nRispondi con 1, 2 o 3.`}const iS=[{title:"Drill Geografico",patterns:['Indizio A: "Zona nord, vicino parco"','Indizio B: "Area verde estesa, pista ciclabile"'],question:"Quale restringe di pi la zona finale?",answer:"Indizio B",reasoning:'B  pi specifico: "area verde estesa + pista ciclabile" sono 2 criteri verificabili. A dice solo "vicino parco" (generico).'},{title:"Drill Temporale",patterns:['Indizio A: "Aperto dalle 8:00"','Indizio B: "Chiuso il marted"'],question:"Quale esclude pi luoghi?",answer:"Indizio B",reasoning:"B esclude tutti i posti aperti 7/7. A dice solo l'orario di apertura (molto comune)."},{title:"Drill Architettonico",patterns:['Indizio A: "Edificio storico"','Indizio B: "Facciata liberty con 3 archi"'],question:"Quale permette di identificare il punto esatto?",answer:"Indizio B",reasoning:'B d dettagli architettonici specifici: "liberty + 3 archi"  rarissimo. A  troppo vago.'}];function aS(){const e=iS[Math.floor(Math.random()*iS.length)],t=e.patterns.join("\n");return` **Pattern Drill** (riconosci cosa conta)\n\n${e.title}\n\n${t}\n\n ${e.question}\n\nRispondi "A" o "B".`}const sS=[{question:"Come funziona M1SSION?",answer:"Raccogli indizi veri  trova pattern  fai Final Shot sul punto esatto  vinci premio reale. Zero spoiler, solo deduzione.",cta:"Vuoi iniziare?"},{question:"Cos' Final Shot?",answer:' il momento in cui tiri una coordinata precisa. Se  nel raggio giusto (calcolato dai tuoi indizi), vinci. Max 2 tentativi/giorno.  "safe" se hai 8+ indizi.',cta:"Vuoi vedere un esempio safe?"},{question:"BUZZ Map a cosa serve?",answer:'Visualizza i tuoi indizi su mappa e ti mostra il "raggio di confidenza". Pi indizi hai, pi il cerchio si stringe. Usi BUZZ Map DOPO aver raccolto 5+ indizi.',cta:"Apri BUZZ Map?"},{question:"Quanto costa?",answer:"BUZZ  gratuito (1 indizio/giorno). BUZZ Map e Final Shot sono a pagamento ma opzionali. Puoi vincere anche con solo BUZZ gratis se sei metodico.",cta:"Vedi piani"}];function rS(e){if(0===e.length)return"";if(1===e.length)return e[0];const t=[["Puoi","oppure"],["Ti propongo","o se preferisci"],["Facciamo","o meglio"],["Prova","altrimenti"],["Scegli se","o se vuoi"]],[i,a]=t[Math.floor(Math.random()*t.length)];if(2===e.length)return`${i} ${e[0].toLowerCase()}, ${a} ${e[1].toLowerCase()}.`;const s=e[e.length-1];return`${i} ${e.slice(0,-1).map(e=>e.toLowerCase()).join(", ")}, ${a} ${s.toLowerCase()}.`}function nS(e){const t={Facciamo:["Proviamo","Andiamo con","Ti propongo","Scegliamo"],Vediamo:["Guardiamo","Analizziamo","Controlliamo","Verifichiamo"],Capito:["Chiaro","Ok","Ricevuto","Perfetto"],Ottimo:["Bene","Perfetto","Fantastico","Grande"],Come:["In che modo","In quale modo","Quale strada per"],Cosa:["Quale","Che cosa","Che tipo di"]};let i=e;for(const[a,s]of Object.entries(t))if(i.includes(a)){const e=s[Math.floor(Math.random()*s.length)];i=i.replace(a,e);break}return i}function oS(e,t){const i=t.toLowerCase().split(/\s+/).filter(e=>e.length>3),a=e.toLowerCase();if(i.length<3)return!1;for(let n=0;n<=i.length-3;n++){const e=i.slice(n,n+3).join(" ");if(a.includes(e))return!0}const s=new Set(["buzz","map","final","shot","indizio","come","cosa","dove","quando","che","per","non","sono","hai","vuoi"]);let r=0;for(const n of i)!s.has(n)&&a.includes(n)&&r++;return r>.4*i.length}let lS=[];const cS=["Ok {name}, ci penso io.","Ci sono: lo facciamo semplice e utile.","Ottima mossa, agente {code}.","Respiro profondo: un passo e siamo avanti.","Capito. Ti porto io nella direzione giusta.","Va bene saltare i giri inutili. Ecco cosa conviene fare.","Ho letto tra le righe: vuoi chiarezza rapida.","Zero fronzoli: ti alleno io.","Tranquillo, sei nel posto giusto.","Capito: facciamolo semplice e concreto.","Capito, {name}!","Perfetto!","Ci sono!","Vediamo insieme.","Ok, analizziamo.","Bene!","D'accordo.","Capisco, {name}.","Roger, agente {code}.","Interessante.","Procediamo.","Chiaro, {name}.","Ok agente {code}!","Bene, vediamo.","Ricevuto!","{name}, perfetto.","Ok {code}, ci siamo.","Bene cos!","Roger!","Ehi {name}, facciamolo insieme.","Chiaro. Un attimo."],dS=["Sei pi avanti di quanto pensi. Andiamo.","Ottimo ritmo: un tassello alla volta.","Ti copro le spalle: scelgo io la prossima mossa se vuoi.","Quando sei pronto, facciamo un altro passo.","Hai gi {clues} indizi: capitalizziamoli.","Se vuoi sprint, ho una mossa da 30s.","Perfetto. Tocco leggero, risultati veri.","Lo stai rendendo interessante.","Ci siamo: un passo alla volta, e il quadro compare.","Ottimo ritmo. Torna agli indizi di ieri: c' un collegamento sottile.","Se hai dubbi, scegli la pista pi coerente col tema ricorrente.","Non forzo la risposta: ti tengo centrato sulla logica giusta.","Buona caccia  il dettaglio fa la differenza.","Procediamo con calma: il metodo batte la fretta.","Ogni frammento conta. Continua cos.","Il puzzle si compone pezzo dopo pezzo."];function uS(e){return rS(e)}function hS(e){const t=e?.agent?.nickname||"Agente",i=e?.agent?.code||"AG-XXXX",a=cS.filter(e=>!lS.includes(e)),s=a.length>0?a[Math.floor(Math.random()*a.length)]:cS[Math.floor(Math.random()*cS.length)];return lS.push(s),lS.length>3&&lS.shift(),s.replace("{name}",t).replace("{code}",i)}function mS(){const e=dS.filter(e=>!lS.includes(e)),t=e.length>0?e[Math.floor(Math.random()*e.length)]:dS[Math.floor(Math.random()*dS.length)];return lS.push(t),lS.length>3&&lS.shift(),t}function pS(e,t){const i=hS(e),a=e?.stats?.clues||0;!async function(e,t){await _N({event:"retention_trigger",meta:{reason:e,clues:t}})}("frustrated_exit",a);return`${i}\n\n${a>0?`Capisco la sensazione, succede quando manca il primo indizio.\nHai gi ${a} indizi: sei pi avanti di quanto pensi.\nFacciamo cos: 60 secondi insieme  1 BUZZ adesso e lo leggiamo subito.\nSe non ti  utile, chiudiamo qui. Ti va?`:"Capisco la frustrazione. Nessun problema.\nPrima di andare, posso mostrarti 1 BUZZ in 60 secondi? Zero impegno, solo per vedere se ti  utile.\nSe non funziona, chiudiamo qui. Deal?"}`}function fS(e,t){const i=hS(e),a=mS();return`${i}\n\nNon ho capito perfettamente, ma ci arrivo.\n\n${uS(["Vuoi sapere come funziona BUZZ?","Oppure preferisci una guida rapida per iniziare?"])}\n\n${a}`}function gS(e,t,i){const a=function(e,t,i){const a=e?.stats?.clues||0,s=e?.stats?.finalshot_today||0,r=(t||"").toLowerCase();if(a>=8&&i.includes("about_finalshot"))return"final_prep";if(s>=2)return"final_prep";if(0===a)return"onboarding";if(a>=1&&a<=3)return"collecting";if(a>=4&&a<=7)return"analyzing";if(a>=8)return["pattern","analiz","correla","ipotesi","convergenza"].some(e=>r.includes(e)),"hypothesis";return"collecting"}(i,t,[e.intent]),s=Kj(t);if(_N({event:"reply_generated",intent:e.intent,sentiment:s,phase:a,meta:{confidence:e.confidence}}),function(e){if(!e||"string"!=typeof e)return!1;const t=e.toLowerCase().trim(),i=[/^e\s+(poi|dopo|adesso|ora)\??$/i,/^e\s+poi\s+che\s+faccio\??$/i,/^e\s+adesso\??$/i,/^e\s+ora\??$/i,/^poi\??$/i,/^dopo\??$/i,/^next\??$/i,/^ok\s+e\s+poi\??$/i,/^ok\s+e\s+adesso\??$/i,/^what\s+next\??$/i,/^e\s+dopo\s+cosa\??$/i,/^cosa\s+faccio\s+adesso\??$/i,/^che\s+faccio\s+ora\??$/i];for(const a of i)if(a.test(t))return!0;return!!["poi","dopo","next","adesso","ora"].includes(t)}(t))return function(e,t,i){const a=function(e,t,i){const a=e?.stats?.clues||0,s=e?.stats?.finalshot_today||0;if("frustrated"===i||"rushed"===i)return{title:"Azione rapida (30 secondi)",steps:["Apri BUZZ","Prendi 1 solo indizio","Chiudi e torna pi tardi"]};if("confused"===i)return{title:"Passo base di orientamento",steps:["BUZZ ti d 1 indizio alla volta","Raccogli almeno 3-4 indizi prima","Poi torna qui per analizzarli insieme"]};switch(t){case"onboarding":return{title:"Primo passo: Inizia con BUZZ",steps:["Apri BUZZ dalla tab in basso","Raccogli 2-3 indizi oggi","Ogni indizio  un pezzo del puzzle","Poi torna qui per analisi iniziale"]};case"collecting":return{title:"Continua la raccolta",steps:[`Hai ${a} indizi, ne servono 4-5 per pattern`,"Fai altri 2-3 BUZZ oggi","Target: 5-6 indizi totali","Poi analizziamo pattern insieme"]};case"analyzing":return{title:"Analisi pattern",steps:[`Con ${a} indizi possiamo cercare pattern`,"Apri BUZZ Map per vedere l'area","Cerca sovrapposizioni e ripetizioni","Confronta toponimi e coordinate","Fai ancora 1-2 BUZZ se serve pi chiarezza"]};case"hypothesis":return{title:"Formazione ipotesi",steps:[`${a} indizi sono una buona base`,"Incrocia tutti i dati: luoghi, nomi, riferimenti","Verifica convergenze geografiche con BUZZ Map","Cerca pattern semantici e temporali","Quando sei sicuro, considera Final Shot (max 2/giorno)"]};case"final_prep":return s>=2?{title:"Limite Final Shot raggiunto",steps:["Hai gi usato i 2 Final Shot di oggi","Rivedi i dati raccolti","Raffina l'ipotesi per domani","Continua con BUZZ per pi sicurezza"]}:{title:"Preparazione Final Shot",steps:["Ricapitola tutti gli indizi","Verifica coerenza interna","Controlla convergenze su BUZZ Map","Quando sei sicuro al 90%, prova Final Shot",`Hai ${2-s} tentativi rimasti oggi`]};default:return{title:"Prossimo passo",steps:["Fai BUZZ per raccogliere indizi","Poi torna per analisi"]}}}(e,t,Kj(i)),s=[`Ok ${e?.agent?.nickname||e?.agent?.code||"Agente"}, ecco il prossimo passo:`,"Bene! Il prossimo step  questo:","Perfetto, procediamo cos:","Ok, ecco cosa fare adesso:","Chiaro, passiamo a:"],r=["\n\nVai cos!","\n\nProcedi pure.","\n\nFammi sapere come va.","\n\nCi siamo!","\n\nSei sulla strada giusta."],n=s[Math.floor(Math.random()*s.length)],o=r[Math.floor(Math.random()*r.length)],l=a.steps.map((e,t)=>`${t+1}. ${e}`).join("\n");return`${n}\n\n**${a.title}**\n\n${l}${o}`}(i,a,t);if(function(e){const t=e.toLowerCase();return[/si\s+paga/i,/\s+gratis/i,/costa/i,/prezzo/i,/quanto\s+costa/i,/\s+a\s+pagamento/i,/devo\s+pagare/i,/gratuito/i].some(e=>e.test(t))&&t.includes("buzz")}(t))return function(e){return`${hS(e)}\n\nBUZZ  **gratuito**. Zero costi, zero sorprese.\nPronto a provare?  Apri BUZZ ora.`}(i);if(/mini.?quiz|quiz/i.test(t))return tS();if(/pattern.?drill|drill/i.test(t))return aS();if(/faq|domande/i.test(t))return` **FAQ Essenziale** (60s di lettura, zero spoiler)\n\n${sS.map((e,t)=>`**${t+1}. ${e.question}**\n${e.answer}`).join("\n\n")}\n\nVuoi approfondire qualcosa?`;if("frustrated"===s&&/me\s+ne\s+vado|basta|difficile/i.test(t))return pS(i);if("clarify_needed"===e.intent){return function(e,t){const i=hS(e),[a,s]={about_buzz:["Come funziona BUZZ?","Quanto costa BUZZ?"],about_mission:["Cos' M1SSION?","Come si vince?"],about_finalshot:["Cos' Final Shot?","Come funziona Final Shot?"],plans:["Quali piani ci sono?","Piani gratuiti?"]}[t]||["Spiega BUZZ","Spiega M1SSION"];return`${i}\n\nNon sono sicura di aver capito. Intendi:\n1. ${a}\n2. ${s}\n\nScegli tu o riformula.`}(i,e.slots?.suggested_intent||"about_buzz")}if(e.multiIntents&&e.multiIntents.length>1)return function(e,t){const i=hS(t),a=mS();if(0===e.length)return fS(t);const s=[];for(let r=0;r<Math.min(2,e.length);r++){const t=e[r],i=Yj[t.intent];if(i&&"a"in i){const e=i.a[0]||"Info non disponibile";s.push(`**${String(t.intent)}**\n${e}`)}}return`${i}\n\n${s.join("\n\n")}\n\nVuoi approfondire uno di questi? Oppure facciamo 1 BUZZ rapido?\n\n${a}`}(e.multiIntents,i);let r="";switch(e.intent){case"about_buzz":r=function(e){const t=nS(hS(e)),i=mS();return`${t}\n\nBUZZ ti d indizi veri sul posto giusto: ogni BUZZ = 1 indizio leggibile in 10s. Con 68 indizi inizi a vedere un pattern; con 912 prepari il Final Shot. Scegli tu il ritmo: una volta al giorno  perfetto.\n\n${rS(["aprire BUZZ e prendere il primo indizio di oggi","spiegarti come leggere correttamente un indizio"])}\n\n${i}`}(i);break;case"about_mission":r=function(e){const t=nS(hS(e)),i=mS();return`${t}\n\nM1SSION  una caccia al premio reale: raccogli indizi, trovi pattern, tiri il Final Shot sul punto esatto. Vince chi deduce meglio, non chi spende di pi.\n\n${rS(["prendere un indizio adesso (ti guido io)","ascoltare la spiegazione di Final Shot in 2 frasi + una prova safe"])}\n\n${i}`}(i);break;case"help":case"help_start":r=function(e){const t=nS(hS(e)),i=mS();return`${t}\n\nCi sono, partiamo in modo leggero. Prima apri BUZZ e prendi 1 indizio (30s), poi torni qui e te lo traduco in azioni (60s). ${rS(["farlo ora","avere prima una panoramica rapida di M1SSION"])}\n\n${i}`}(i);break;case"saluto":case"smalltalk":r=function(e){const t=nS(hS(e)),i=mS(),a=e?.stats?.clues||0;return`${t}\n\n${a>0?`Hai gi ${a} indizi raccolti. Facciamo una mossa utile adesso?`:"Ehi! Facciamo una mossa semplice e utile per iniziare."} ${rS(["aprire BUZZ (1 indizio in 60s)","avere una panoramica di M1SSION","vedere alternative senza BUZZ"])}\n\n${i}`}(i);break;case"no_buzz":r=function(e){const t=nS(hS(e)),i=mS();return`${t}\n\nOk, niente BUZZ ora. Ti propongo tre alternative per allenarti senza raccogliere indizi: ${rS(["un **Mini-Quiz da 30s** dove ti alleno su un indizio tipico (zero spoiler)","un **Pattern Drill** per riconoscere quale indizio restringe di pi","le **FAQ in 60s** con 4 domande essenziali su M1SSION"])}\n\n${i}`}(i);break;case"diff_buzz_vs_map":r=function(e){const t=hS(e),i=mS();return`${t}\n\n**BUZZ** = raccogli indizi veri (1/giorno gratis).\n**BUZZ Map** = visualizza indizi su mappa + raggio di confidenza.\n\nIl flusso: BUZZ  raccogli 5+ indizi  BUZZ Map  vedi dove convergono  Final Shot.\n\nScelte rapide:\n${uS(["Faccio un BUZZ ora","Vedo BUZZ Map (serve 3 indizi)","Spiega Final Shot"])}\n\n${i}`}(i);break;case"rules_short":r=function(e){const t=hS(e),i=mS();return`${t}\n\n**Regole in 3 righe**:\n1. Raccogli indizi con BUZZ (gratuito).\n2. Trova pattern e restringe l'area.\n3. Tira Final Shot sul punto esatto (max 2/giorno).\n\n${uS(["Inizia con 1 BUZZ","Spiega Final Shot safe","FAQ completa"])}\n\n${i}`}(i);break;case"unknown":r=fS(i);break;default:const t=Yj[e.intent];if(t&&"a"in t){const e=hS(i),a=mS();r=`${e}\n\n${t.a[0]||"Info non disponibile."}\n\n${a}`}else r=fS(i)}if(function(e,t){return oS(e,t)}(r,t)){const e=hS(i),t=mS();r=`${e}\n\nCapito la domanda. ${r.split("\n\n")[1]||r}\n\n${t}`}const n=function(e,t,i){if(Xj++,Xj<5)return{text:"",used:!1};if(i&&Qj.has(i))return{text:"",used:!1};if("rushed"===e)return{text:"",used:!1};if(Math.random()>.17)return{text:"",used:!1};const a=Jj[e]||Jj.neutral,s=a[Math.floor(Math.random()*a.length)];return Xj=0,{text:s,used:!0}}(s,0,e.intent);return n.used&&(!async function(e,t){await _N({event:"joke_used",sentiment:e,meta:{joke:t.substring(0,100)}})}(s,n.text),r=`${n.text}\n\n${r}`),oS(r,t)&&(r=function(e,t){const i=t.toLowerCase().split(/\s+/).filter(e=>e.length>3);let a=e;for(const s of i)if(s.length>5&&a.toLowerCase().includes(s)){a=nS(a);break}return a}(r,t)),r.length>1e3&&(r=r.substring(0,1e3)+""),r}async function xS(e){const t=await ae(()=>Promise.resolve().then(()=>SN),void 0).then(e=>e.buildNorahContext());return gS(Gj(e),e,t)}const bS=()=>{const[e,t]=We.useState([]),[i,a]=We.useState(!1),[s,r]=We.useState("idle"),[n,o]=We.useState("analyze"),[l,c]=We.useState([]),[d,u]=We.useState(!1),[h,m]=We.useState(!1),[p,f]=We.useState(0),[g,x]=We.useState(null),b=We.useRef(null),v=We.useRef(void 0),{clues:y,loading:w}=function(){const[e,t]=We.useState([]),[i,a]=We.useState(!0);return We.useEffect(()=>{let e,i,s=!0;return(async()=>{try{const{data:{user:r}}=await ba.auth.getUser();if(!r||!s)return;const n=new Date;n.setDate(n.getDate()-10);const{data:o}=await ba.from("user_notifications").select("id, title, message, created_at").eq("user_id",r.id).gte("created_at",n.toISOString()).order("created_at",{ascending:!1}).limit(10),l=(o||[]).filter(e=>"buzz"===e.notification_type||"buzz_free"===e.notification_type);let c=[];try{const{data:e}=await ba.from("user_clues").select("\n              id,\n              created_at,\n              clues!inner(title, description)\n            ").eq("user_id",r.id).gte("created_at",n.toISOString()).order("created_at",{ascending:!1}).limit(10);c=e||[]}catch{}const d=[...l.map(e=>({id:e.id,title:e.title,description:e.message,created_at:e.created_at,source:"notification"})),...c.map(e=>({id:e.id,title:e.clues.title,description:e.clues.description,created_at:e.created_at,source:"clue"}))];d.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),s&&(t(d.slice(0,10)),a(!1)),e=ba.channel("intel-notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"user_notifications",filter:`user_id=eq.${r.id}`},e=>{const i={id:e.new.id,title:e.new.title,description:e.new.message,created_at:e.new.created_at,source:"notification"};t(e=>[i,...e].slice(0,10))}).subscribe();try{i=ba.channel("intel-clues").on("postgres_changes",{event:"INSERT",schema:"public",table:"user_clues",filter:`user_id=eq.${r.id}`},async e=>{const{data:i}=await ba.from("clues").select("title, description").eq("id",e.new.clue_id).single();if(i){const a={id:e.new.id,title:i.title,description:i.description,created_at:e.new.created_at,source:"clue"};t(e=>[a,...e].slice(0,10))}}).subscribe()}catch{}}catch(r){console.error("[RealtimeIntel] Load error:",r),s&&a(!1)}})(),()=>{s=!1,e&&ba.removeChannel(e),i&&ba.removeChannel(i)}},[]),{clues:e,loading:i}}();We.useEffect(()=>{j(),N()},[]),We.useEffect(()=>{c(y),u(w)},[y,w]);const N=async()=>{const e=await Cj();x(e)},j=async()=>{const{data:{user:e}}=await ba.auth.getUser();e&&(v.current=e.id)},S=We.useCallback(e=>{if(!h||!("speechSynthesis"in window))return;window.speechSynthesis.cancel();const t=new SpeechSynthesisUtterance(e);let i;t.lang="it-IT",t.rate=.95,t.pitch=1,t.onstart=()=>{i=setInterval(()=>{f(.8*Math.random()+.2)},100)},t.onend=()=>{clearInterval(i),f(0)},b.current=t,window.speechSynthesis.speak(t)},[h]),_=We.useCallback(async(e,s="analyze")=>{if(!e.trim()||i)return;a(!0),r("thinking"),o(s);const n={role:"user",content:e,timestamp:new Date,metadata:{mode:s}};let c;if(t(e=>[...e,n]),await new Promise(e=>setTimeout(e,800)),r("speaking"),g)c=await async function(e){const{userText:t}=e;try{return await xS(t)}catch(i){return console.error("[NORAH] Reply generation failed:",i),"Errore di comunicazione. Riprova tra poco."}}({userText:e});else{c=(await vj({mode:s,clues:l,userText:e,userId:v.current,timestamp:Date.now()})).content}await new Promise(e=>setTimeout(e,1200));const d={role:"analyst",content:c,timestamp:new Date,metadata:{mode:s,cluesAnalyzed:l.length}};t(e=>[...e,d].slice(-12)),h&&S(c),r("idle"),a(!1)},[y,i,h,S,g]),k=We.useCallback(()=>{m(e=>!e),h&&b.current&&(window.speechSynthesis.cancel(),f(0))},[h]);return{messages:e,isProcessing:i,status:s,currentMode:n,clues:l,isLoadingClues:d,ttsEnabled:h,audioLevel:p,agentContext:g,sendMessage:_,clearMessages:()=>t([]),refreshClues:async()=>{await Cj(!0),await N()},toggleTTS:k}},vS=[];let yS=null;async function wS(){try{const{data:{user:e}}=await ba.auth.getUser();if(!e)return{agentCode:"AG-GUEST",displayName:"Guest",level:1,xp:0,cluesCount:0,lastClueAt:null,week:1,restrictions:[]};const{data:t}=await ba.from("profiles").select("agent_code, full_name").eq("id",e.id).single(),{count:i}=await ba.from("user_clues").select("*",{count:"exact",head:!0}).eq("user_id",e.id),a=function(){const e=new Date("2025-01-20"),t=new Date,i=Math.floor((t.getTime()-e.getTime())/864e5),a=Math.max(1,Math.ceil(i/7));return Math.min(a,4)}(),s={agentCode:t?.agent_code||"AG-0000",displayName:t?.full_name||"Agent",level:1,xp:0,cluesCount:i||0,lastClueAt:null,week:a,restrictions:[]};return yS=s,vS.forEach(e=>e(s)),s}catch(e){return console.error("Failed to fetch agent context:",e),{agentCode:"AG-ERROR",displayName:"Agent",level:1,xp:0,cluesCount:0,lastClueAt:null,week:1,restrictions:[]}}}let NS=null;function jS(){NS&&clearTimeout(NS),NS=setTimeout(()=>{(async function(){const e=await wS();return yS=e,vS.forEach(t=>t(e)),e})().catch(console.error)},300)}const SS=()=>{const[,e]=Ai(),[t,i]=We.useState(!1);We.useEffect(()=>function(){let e;return ba.auth.getUser().then(({data:{user:t}})=>{if(!t)return;e=t.id;const i=ba.channel("user_clues_changes").on("postgres_changes",{event:"*",schema:"public",table:"user_clues",filter:`user_id=eq.${e}`},()=>{jS()}).subscribe(),a=ba.channel("user_notifications_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"user_notifications",filter:`user_id=eq.${e}`},()=>{jS()}).subscribe();window.__m1ssion_realtime_cleanup=()=>{ba.removeChannel(i),ba.removeChannel(a),NS&&clearTimeout(NS)}}),()=>{window.__m1ssion_realtime_cleanup&&window.__m1ssion_realtime_cleanup()}}(),[]);const{messages:a,isProcessing:s,status:r,currentMode:n,clues:o,ttsEnabled:l,audioLevel:c,agentContext:d,sendMessage:u,toggleTTS:h}=bS(),m="0"!==new URLSearchParams(window.location.search).get("intel_ai"),{level:p}=((e=!1)=>{const[t,i]=We.useState(0),[a,s]=We.useState(null),[r,n]=We.useState(null),o=We.useRef(null),l=We.useRef(null),c=We.useRef(null),d=We.useRef(null);We.useEffect(()=>{if(e)return(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});c.current=e,s(!0),n(null);const t=new(window.AudioContext||window.webkitAudioContext);o.current=t;const a=t.createAnalyser();a.fftSize=1024,a.smoothingTimeConstant=.8,l.current=a,t.createMediaStreamSource(e).connect(a);const r=a.frequencyBinCount,u=new Uint8Array(r),h=()=>{if(!l.current)return;l.current.getByteFrequencyData(u);let e=0;for(let i=0;i<r;i++)e+=(u[i]/255)**2;const t=Math.sqrt(e/r),a=Math.min(1,Math.max(0,2*t));i(a),d.current=requestAnimationFrame(h)};h()}catch(e){console.error("Microphone access error:",e),s(!1),n(e instanceof Error?e.message:"Microphone access denied")}})(),()=>u();u()},[e]);const u=()=>{d.current&&(cancelAnimationFrame(d.current),d.current=null),c.current&&(c.current.getTracks().forEach(e=>e.stop()),c.current=null),o.current&&(o.current.close(),o.current=null),l.current=null,i(0)};return{level:t,hasPermission:a,error:r}})(t&&l);var f,g;f="a",g=()=>{m&&i(e=>!e)},We.useEffect(()=>{const e=e=>{if(e.key.toLowerCase()===f.toLowerCase()&&!e.ctrlKey&&!e.metaKey&&!e.altKey){const t=e.target;"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&(e.preventDefault(),g())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f,g]);const x={coordinates:"/intelligence/coordinates",journal:"/intelligence/clue-journal",archive:"/intelligence/archive",radar:"/intelligence/radar",interceptor:"/intelligence/interceptor",finalshot:"/intelligence/final-shot",finalshotmap:"/intelligence/final-shot"},b=[{id:"coordinates",name:"Coordinate Selector",icon:kr,description:"Selezione coordinate per operazioni tattiche",status:"Disponibile",level:"Livello 1"},{id:"journal",name:"Clue Journal",icon:Ja,description:"Documentazione e analisi degli indizi",status:"Disponibile",level:"Livello 1"},{id:"archive",name:"Archivio Indizi",icon:Wa,description:"Archivio completo degli indizi raccolti",status:"Disponibile",level:"Livello 1"},{id:"radar",name:"Geo Radar",icon:cr,description:"Capacit avanzate di scansione geo-radar",status:"Settimana 3+",level:"Livello 3"},{id:"interceptor",name:"BUZZ Interceptor",icon:Wr,description:"Intercettazione e analisi segnali BUZZ",status:"Settimana 4+",level:"Livello 4"},{id:"finalshot",name:"Final Shot",icon:Ss,description:"Esecuzione del colpo finale tattico",status:"Settimana 5+",level:"Livello 5"}],v=e=>{switch(e){case"Livello 1":return"text-green-400";case"Livello 3":return"text-blue-400";case"Livello 4":return"text-purple-400";case"Livello 5":return"text-red-400";default:return"text-cyan-400"}},y=(t,i)=>{if(i&&"Disponibile"!==i)return;const a=x[t];a&&e(a)};return m?se.jsxs(se.Fragment,{children:[!t&&se.jsx(vN,{status:r,audioLevel:p||c,onOrbClick:()=>i(!0),micEnabled:l,onMicToggle:h,onMoreClick:()=>i(!0),onFinalShotClick:()=>e("/intelligence/final-shot")}),se.jsx(HN,{isOpen:t,onClose:()=>i(!1),messages:a,isProcessing:s,onSendMessage:(e,t)=>u(e,t),currentMode:n,cluesCount:o.length,status:r,audioLevel:p||c,agentContext:d,ttsEnabled:l,onToggleTTS:h})]}):se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background via-background/95 to-background/90",children:se.jsx("main",{className:"pt-4 pb-20 px-4","data-build":"intel-esm-001",children:se.jsxs("div",{className:"max-w-lg mx-auto space-y-6",children:[se.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>e("/settings"),className:"p-2 hover:bg-background/50",children:""}),se.jsxs("div",{children:[se.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Intelligence Panel"}),se.jsx("p",{className:"text-muted-foreground",children:"Strumenti di analisi tattica"})]})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsxs(Hl,{className:"text-center pb-4",children:[se.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-cyan-400/20 to-cyan-400/10 mb-4 mx-auto",children:se.jsx(ts,{className:"h-10 w-10 text-cyan-400"})}),se.jsx(Zl,{className:"text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent",children:"M1SSION Intelligence"})]}),se.jsx(Gl,{className:"space-y-4",children:se.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[se.jsxs("div",{className:"text-center p-3 glass-card bg-background/20 border-0",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Moduli"}),se.jsx("p",{className:"font-semibold text-lg text-cyan-400",children:b.length})]}),se.jsxs("div",{className:"text-center p-3 glass-card bg-background/20 border-0",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Attivi"}),se.jsx("p",{className:"font-semibold text-lg text-green-400",children:b.filter(e=>"Disponibile"===e.status).length})]}),se.jsxs("div",{className:"text-center p-3 glass-card bg-background/20 border-0",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Livello"}),se.jsx("p",{className:"font-semibold text-lg text-blue-400",children:"Max 5"})]})]})})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent flex items-center gap-2",children:[se.jsx(vr,{className:"h-5 w-5 text-blue-400"}),"Moduli Intelligence"]})}),se.jsx(Gl,{className:"space-y-3",children:b.map(e=>{return se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0 cursor-pointer hover:bg-background/30 transition-all duration-200",onClick:()=>y(e.id,e.status),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||"Disponibile"!==e.status||(t.preventDefault(),y(e.id))},tabIndex:"Disponibile"===e.status?0:-1,role:"button","aria-label":`Accedi a ${e.name}`,children:se.jsxs("div",{className:"flex items-start space-x-3",children:[se.jsx("div",{className:"p-2 rounded-lg bg-primary/20 flex-shrink-0",children:se.jsx(e.icon,{className:"h-5 w-5 text-primary"})}),se.jsxs("div",{className:"flex-1 min-w-0",children:[se.jsxs("div",{className:"flex items-center justify-between mb-2",children:[se.jsx("h3",{className:"font-semibold text-foreground",children:e.name}),se.jsx(fc,{className:(t=e.status,"Disponibile"===t?"bg-green-500/20 text-green-400 border-green-500/30":"bg-orange-500/20 text-orange-400 border-orange-500/30"),children:e.status})]}),se.jsx("p",{className:"text-sm text-muted-foreground/80 mb-2",children:e.description}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:`text-xs font-medium ${v(e.level)}`,children:e.level}),se.jsx(mo,{size:"sm",variant:"outline",className:"h-7 text-xs",disabled:"Disponibile"!==e.status,onClick:t=>{t.stopPropagation(),"Disponibile"===e.status&&y(e.id)},onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||"Disponibile"!==e.status||(t.preventDefault(),t.stopPropagation(),y(e.id))},tabIndex:"Disponibile"===e.status?0:-1,role:"button","aria-label":`Apri ${e.name}`,children:"Disponibile"===e.status?"Accedi":"Bloccato"})]})]})]})},e.id);var t})})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent flex items-center gap-2",children:[se.jsx(qa,{className:"h-5 w-5 text-purple-400"}),"Statistiche Intelligence"]})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(Is,{className:"h-4 w-4 text-blue-400"}),se.jsx("span",{className:"text-sm font-medium",children:"Analisi Completate"})]}),se.jsx("span",{className:"text-sm text-blue-400 font-medium",children:"47"})]})}),se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(ks,{className:"h-4 w-4 text-green-400"}),se.jsx("span",{className:"text-sm font-medium",children:"Indizi Raccolti"})]}),se.jsx("span",{className:"text-sm text-green-400 font-medium",children:"124"})]})}),se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(kr,{className:"h-4 w-4 text-yellow-400"}),se.jsx("span",{className:"text-sm font-medium",children:"Precisione Media"})]}),se.jsx("span",{className:"text-sm text-yellow-400 font-medium",children:"87.3%"})]})}),se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(cr,{className:"h-4 w-4 text-cyan-400"}),se.jsx("span",{className:"text-sm font-medium",children:"Scansioni Radar"})]}),se.jsx("span",{className:"text-sm text-cyan-400 font-medium",children:"31"})]})})]})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-xl font-bold bg-gradient-to-r from-orange-400 to-red-400 bg-clip-text text-transparent flex items-center gap-2",children:[se.jsx(Ys,{className:"h-5 w-5 text-orange-400"}),"Azioni Rapide"]})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsxs(mo,{variant:"outline",className:"w-full justify-between bg-background/50 border-primary/30 hover:bg-primary/10",onClick:()=>y("coordinates"),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),y("coordinates"))},tabIndex:0,role:"button","aria-label":"Apri Intelligence Panel",children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(ts,{className:"h-4 w-4 text-primary"}),se.jsx("span",{children:"Apri Intelligence Panel"})]}),""]}),se.jsxs(mo,{variant:"outline",className:"w-full justify-between bg-background/50 border-primary/30 hover:bg-primary/10",onClick:()=>y("finalshotmap"),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),y("finalshotmap"))},tabIndex:0,role:"button","aria-label":"Apri Final Shot Mappa",children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(Ss,{className:"h-4 w-4 text-red-400"}),se.jsx("span",{children:"Final Shot Mappa"})]}),""]})]})]})]})})})};function _S(){const[e,t]=We.useState(""),[i,a]=We.useState([]),[s,r]=We.useState(!1),[n,o]=We.useState(null);return se.jsxs("div",{className:"p-4",children:[se.jsx("input",{className:"border p-2 w-full mb-2",value:e,onChange:e=>t(e.target.value),placeholder:"Fai una domanda su BUZZ"}),se.jsx("button",{onClick:async()=>{r(!0),o(null);try{const i=await async function(e,t="it",i=3){const{data:a,error:s}=await ba.functions.invoke("norah-rag-search",{body:{query:e,locale:t,top_k:i}});if(s)throw s;return a}(e,"it",3);a(i.hits??[]);try{await ba.from("norah_events").insert({event:"rag_ui_query",user_id:(await ba.auth.getUser()).data.user?.id||"",payload:{q:e,top_k:3,locale:"it",hits_count:i.hits?.length??0}})}catch(t){console.warn("Telemetry insert failed:",t)}}catch(i){o(i?.message??"Errore")}finally{r(!1)}},disabled:s||!e.trim(),className:"bg-blue-500 text-white px-4 py-2 rounded",children:s?"":"Chiedi"}),n&&se.jsx("div",{className:"text-red-500 mt-2",children:n}),se.jsx("ul",{className:"mt-4 space-y-2",children:i.map((e,t)=>se.jsxs("li",{className:"border-b pb-2",children:[se.jsx("strong",{children:e.title}),"  ",e.category,se.jsx("div",{className:"text-gray-600",children:e.chunk_text}),se.jsxs("small",{className:"opacity-70",children:["score: ",e.distance.toFixed(3)]})]},t))})]})}function kS(){return se.jsxs("div",{className:"min-h-screen w-full bg-background",children:[se.jsx("div",{className:"border-b border-border/40 bg-gradient-to-r from-background via-background/95 to-background",children:se.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[se.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[se.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:se.jsx(ts,{className:"w-6 h-6 text-primary"})}),se.jsx("h1",{className:"text-2xl font-orbitron font-bold bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent",children:"M1SSION Intelligence"})]}),se.jsx("p",{className:"text-sm text-muted-foreground font-rajdhani",children:"Ricerca semantica sulla Knowledge Base interna  Powered by Norah AI (RAG)"}),se.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[se.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-primary/5 border border-primary/20",children:[se.jsx(ks,{className:"w-3.5 h-3.5 text-primary"}),se.jsx("span",{className:"text-xs font-rajdhani text-primary",children:"Vector Search"})]}),se.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-accent/5 border border-accent/20",children:[se.jsx(Wr,{className:"w-3.5 h-3.5 text-accent"}),se.jsx("span",{className:"text-xs font-rajdhani text-accent",children:"Instant Results"})]})]})]})}),se.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:se.jsx(_S,{})}),se.jsx("div",{className:"max-w-4xl mx-auto px-4 pb-8",children:se.jsxs("div",{className:"rounded-lg border border-border/40 bg-card/50 p-4",children:[se.jsx("h3",{className:"text-sm font-orbitron font-semibold mb-2 text-foreground",children:" Esempi di domande"}),se.jsxs("ul",{className:"space-y-1 text-sm text-muted-foreground font-rajdhani",children:[se.jsx("li",{children:' "Spiegami BUZZ e quando conviene usarlo rispetto a BUZZ Map"'}),se.jsx("li",{children:' "Quali sono le differenze tra i piani Free e Titanium?"'}),se.jsx("li",{children:' "Come funziona il sistema di rewards?"'}),se.jsx("li",{children:' "Cosa sono i QR codes e come si usano?"'})]})]})})]})}function CS(){const[e,t]=We.useState(""),[i,a]=We.useState(""),[s,r]=We.useState([]),[n,o]=We.useState(""),[l,c]=We.useState(!1),{toast:d}=mc();return se.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[se.jsxs("div",{children:[se.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Norah AI Answer Test"}),se.jsx("p",{className:"text-muted-foreground",children:"Test della pipeline RAG  LLM con risposta contestuale"})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:"Fai una domanda"})}),se.jsx(Gl,{children:se.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),e.trim()){c(!0),a(""),r([]),o("");try{const t=await async function(e,t="it",i=3){const{data:a,error:s}=await ba.functions.invoke("norah-answer",{body:{query:e,locale:t,top_k:i}});if(s)throw s;return a}(e);a(t.answer),r(t.sources),o(t.provider)}catch(i){console.error("ragAnswer error:",i),d({title:"Errore",description:i instanceof Error?i.message:"Errore durante la richiesta",variant:"destructive"})}finally{c(!1)}}else d({title:"Errore",description:"Inserisci una domanda",variant:"destructive"})},className:"space-y-4",children:[se.jsxs("div",{children:[se.jsx(Sl,{placeholder:"Es: Spiegami BUZZ e quando usare BUZZ Map",value:e,onChange:e=>t(e.target.value),disabled:l}),se.jsx("div",{className:"flex gap-2 mt-2 flex-wrap",children:["Spiegami BUZZ e quando conviene usare BUZZ Map","Differenze tra piani Free e Titanium su BUZZ e BUZZ Map","Sono su Silver e ho 30 secondi: qual  la next best action?"].map((e,i)=>se.jsxs(mo,{type:"button",variant:"outline",size:"sm",onClick:()=>t(e),disabled:l,children:[e.slice(0,30),"..."]},i))})]}),se.jsx(mo,{type:"submit",disabled:l||!e.trim(),children:l?"Elaborazione...":"Chiedi a Norah"})]})})]}),i&&se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Risposta"}),se.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["Provider: ",n]})]})}),se.jsx(Gl,{children:se.jsx(Wb,{value:i,readOnly:!0,className:"min-h-[200px] font-sans"})})]}),s.length>0&&se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{children:["Fonti (",s.length,")"]})}),se.jsx(Gl,{children:se.jsx("div",{className:"space-y-3",children:s.map((e,t)=>se.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30 space-y-1",children:[se.jsxs("div",{className:"font-semibold text-sm",children:[e.title," #",e.chunk_idx]}),se.jsx("div",{className:"text-xs text-muted-foreground font-mono",children:e.doc_id}),se.jsxs("div",{className:"text-sm italic",children:['"',e.snippet,'..."']})]},t))})})]})]})}const AS=()=>{Ai();const[e,t]=We.useState([]),[i,a]=We.useState(!0);We.useEffect(()=>{s();const e=ba.channel("winners-updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"final_shots",filter:"is_winner=eq.true"},()=>{s()}).subscribe();return()=>{ba.removeChannel(e)}},[]);const s=async()=>{try{a(!0);t([{id:"1",user_id:"user1",mission_id:"mission1",agent_code:"AG-3743",full_name:"Marco Rossi",avatar_url:void 0,city:"Milano",prize_image:"/api/placeholder/400/300",prize_name:"Tesla Model S",won_at:"2024-01-20T16:42:03Z",mission_start:"2024-01-18T00:00:00Z",completion_time:"2 giorni, 16 ore, 42 min"},{id:"2",user_id:"user2",mission_id:"mission2",agent_code:"AG-7291",full_name:"Anna Bianchi",avatar_url:void 0,city:"Roma",prize_image:"/api/placeholder/400/300",prize_name:"iPhone 15 Pro Max",won_at:"2024-01-15T14:22:15Z",mission_start:"2024-01-13T00:00:00Z",completion_time:"2 giorni, 14 ore, 22 min"},{id:"3",user_id:"user3",mission_id:"mission3",agent_code:"AG-1847",full_name:"Luigi Verde",avatar_url:void 0,city:"Napoli",prize_image:"/api/placeholder/400/300",prize_name:"MacBook Pro M3",won_at:"2024-01-10T09:33:27Z",mission_start:"2024-01-08T00:00:00Z",completion_time:"2 giorni, 9 ore, 33 min"}])}catch(e){console.error("Error loading winners:",e)}finally{a(!1)}},r=e=>{switch(e){case 0:return se.jsx(_s,{className:"w-6 h-6 text-yellow-400"});case 1:return se.jsx(Xs,{className:"w-6 h-6 text-gray-300"});case 2:return se.jsx(Ir,{className:"w-6 h-6 text-amber-600"});default:return se.jsx(Ir,{className:"w-6 h-6 text-primary"})}};return se.jsxs("div",{className:"w-full",style:{minHeight:"100dvh",position:"relative",background:"linear-gradient(to bottom, #0a0b14 0%, #050508 100%)"},children:[se.jsx(ad,{}),se.jsx("main",{style:{paddingTop:"calc(72px + env(safe-area-inset-top, 47px) + 40px)",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px))",minHeight:"100dvh",position:"relative",zIndex:0},className:"px-4",children:se.jsxs("div",{className:"max-w-lg mx-auto space-y-6",children:[se.jsxs("div",{className:"mb-6 text-center",children:[se.jsxs("h1",{className:"text-4xl font-orbitron font-bold",children:[se.jsx("span",{className:"text-[#00F7FF]",style:{textShadow:"0 0 10px rgba(0, 247, 255, 0.6), 0 0 20px rgba(0, 247, 255, 0.3)"},children:"Hall of"}),se.jsx("span",{className:"text-white",style:{textShadow:"0 0 10px rgba(255, 255, 255, 0.6), 0 0 20px rgba(255, 255, 255, 0.3)"},children:"Winners"})]}),se.jsx("p",{className:"text-muted-foreground",children:"Vincitori M1SSION"})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsxs(Hl,{className:"text-center pb-4",children:[se.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-yellow-400/20 to-yellow-400/10 mb-4 mx-auto",children:se.jsx(Ir,{className:"h-10 w-10 text-yellow-400"})}),se.jsx(Zl,{className:"text-2xl font-bold bg-gradient-to-r from-yellow-400 to-yellow-500 bg-clip-text text-transparent",children:"Hall of Winners"})]}),se.jsx(Gl,{className:"space-y-4",children:se.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[se.jsxs("div",{className:"text-center p-3 glass-card bg-background/20 border-0",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Vincitori"}),se.jsx("p",{className:"font-semibold text-lg text-yellow-400",children:e.length})]}),se.jsxs("div",{className:"text-center p-3 glass-card bg-background/20 border-0",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Premi"}),se.jsx("p",{className:"font-semibold text-lg text-green-400",children:e.length})]}),se.jsxs("div",{className:"text-center p-3 glass-card bg-background/20 border-0",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Citt"}),se.jsx("p",{className:"font-semibold text-lg text-cyan-400",children:e.length>0?new Set(e.map(e=>e.city)).size:0})]})]})})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent flex items-center gap-2",children:[se.jsx(jr,{className:"h-5 w-5 text-yellow-400"}),"Vincitori Recenti"]})}),se.jsx(Gl,{className:"space-y-4",children:i?se.jsxs("div",{className:"text-center py-8",children:[se.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent mx-auto mb-4"}),se.jsx("p",{className:"text-muted-foreground",children:"Caricamento vincitori..."})]}):0===e.length?se.jsxs("div",{className:"text-center py-8",children:[se.jsx(Ir,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),se.jsx("h3",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Nessun vincitore"}),se.jsx("p",{className:"text-sm text-muted-foreground/70",children:"Sii il primo a vincere una missione!"})]}):e.slice(0,3).map((e,t)=>se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0",children:se.jsxs("div",{className:"flex items-start space-x-3",children:[se.jsx("div",{className:"flex-shrink-0",children:r(t)}),se.jsxs("div",{className:"flex-1 min-w-0",children:[se.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[se.jsxs(cc,{className:"w-8 h-8 border border-primary/30",children:[se.jsx(dc,{src:e.avatar_url}),se.jsx(uc,{className:"bg-primary/20 text-primary text-xs",children:e.agent_code.split("-")[1]})]}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-foreground text-sm",children:e.full_name}),se.jsx("p",{className:"text-xs text-muted-foreground/80 font-mono",children:e.agent_code})]})]}),se.jsxs("div",{className:"space-y-1",children:[se.jsxs("div",{className:"flex items-center justify-between text-xs",children:[se.jsx("span",{className:"text-muted-foreground",children:"Premio:"}),se.jsx("span",{className:"text-yellow-400 font-medium",children:e.prize_name})]}),se.jsxs("div",{className:"flex items-center justify-between text-xs",children:[se.jsx("span",{className:"text-muted-foreground",children:"Citt:"}),se.jsx("span",{className:"text-foreground",children:e.city})]}),se.jsxs("div",{className:"flex items-center justify-between text-xs",children:[se.jsx("span",{className:"text-muted-foreground",children:"Tempo:"}),se.jsx("span",{className:"text-green-400",children:e.completion_time})]})]})]})]})},e.id))})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent flex items-center gap-2",children:[se.jsx(Ga,{className:"h-5 w-5 text-purple-400"}),"Statistiche"]})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(kr,{className:"h-4 w-4 text-green-400"}),se.jsx("span",{className:"text-sm font-medium",children:"Missioni Completate"})]}),se.jsx(fc,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:e.length})]})}),se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(bs,{className:"h-4 w-4 text-blue-400"}),se.jsx("span",{className:"text-sm font-medium",children:"Tempo Medio"})]}),se.jsx("span",{className:"text-sm text-blue-400 font-medium",children:"2.5 giorni"})]})}),se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(Ys,{className:"h-4 w-4 text-cyan-400"}),se.jsx("span",{className:"text-sm font-medium",children:"Copertura Geografica"})]}),se.jsxs("span",{className:"text-sm text-cyan-400 font-medium",children:[e.length>0?new Set(e.map(e=>e.city)).size:0," citt"]})]})})]})]})]})}),se.jsx(sd,{})]})},zS=()=>{const e=We.useRef(null),{isEnabled:t}=(()=>{const e=We.useContext(Jr);if(void 0===e)throw new Error("useSound must be used within a SoundProvider");return e})(),i=e=>{switch(e){case"chime":return"/sounds/chime.mp3";case"bell":return"/sounds/bell.mp3";case"arcade":return"/sounds/arcade.mp3";default:return"/sounds/buzz.mp3"}};return{initializeSound:(t,a)=>{const s=i(t);e.current&&(e.current.pause(),e.current=null),e.current=new Audio(s),e.current&&(e.current.volume=a,e.current.load())},playSound:()=>{if(!t||!e.current)return;e.current.currentTime=0;const i=e.current.play();void 0!==i&&i.catch(i=>{console.error("Error playing sound:",i),document.addEventListener("click",function i(){e.current&&t&&e.current.play().catch(e=>console.error("Error playing on click:",e)),document.removeEventListener("click",i)},{once:!0})})},getSoundPath:i}},ES=({filter:e,onFilterChange:t,onMarkAllAsRead:i,onManualReload:a})=>se.jsxs("div",{className:"glass-card p-4 sm:p-6 mb-6",children:[se.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[se.jsx("h2",{className:"text-xl font-semibold text-white",children:"Le tue notifiche"}),se.jsxs("div",{className:"flex flex-wrap gap-2",children:[se.jsxs(mo,{variant:"ghost",size:"sm",onClick:a,className:"flex-1 sm:flex-none",children:[se.jsx(Xa,{className:"w-4 h-4 mr-2"}),"Aggiorna"]}),se.jsxs(mo,{variant:"ghost",size:"sm",onClick:i,className:"flex-1 sm:flex-none",children:[se.jsx(ms,{className:"w-4 h-4 mr-2"}),"Segna tutto come letto"]})]})]}),se.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap gap-2 sm:gap-3 overflow-x-auto mb-6",children:[se.jsxs(mo,{variant:"all"===e?"default":"outline",size:"sm",onClick:()=>t("all"),className:"flex-shrink-0 flex-1 sm:flex-none",children:[se.jsx(Xa,{className:"w-4 h-4 mr-2"}),"Generali"]}),se.jsxs(mo,{variant:"unread"===e?"default":"outline",size:"sm",onClick:()=>t("unread"),className:"flex-shrink-0 flex-1 sm:flex-none",children:[se.jsx(Xa,{className:"w-4 h-4 mr-2"}),"Buzz"]}),se.jsxs(mo,{variant:"important"===e?"default":"outline",size:"sm",onClick:()=>t("important"),className:"flex-shrink-0 flex-1 sm:flex-none",children:[se.jsx(us,{className:"w-4 h-4 mr-2"}),"Classifica"]})]})]}),IS="leaderboard_update",PS="rewards",TS="mission_alert",MS="buzz",LS="map_buzz",FS="weekly_summary",OS=({category:e,notifications:t,onSelect:i,onDelete:a})=>{const[s,r]=We.useState(!1),n=(e=>{switch(e){case IS:return{title:"Aggiornamento Classifica",color:"text-green-400"};case PS:return{title:"Ricompense Sbloccate",color:"text-yellow-400"};case TS:return{title:"Avvisi Missione",color:"text-red-400"};case MS:return{title:"Buzz Notifications",color:"text-blue-400"};case LS:return{title:"Aggiornamenti Mappa",color:"text-purple-400"};case FS:return{title:"Riassunto Settimanale",color:"text-cyan-400"};default:return{title:"Generali",color:"text-gray-400"}}})(e),o=t.filter(e=>!e.read).length;return se.jsxs(et.div,{className:"rounded-[20px] bg-[#1C1C1F] backdrop-blur-md transition-all duration-300 hover:shadow-lg mb-4 relative overflow-hidden",style:{background:"linear-gradient(135deg, #1C1C1F 0%, rgba(28, 28, 31, 0.95) 50%, rgba(54, 94, 255, 0.1) 100%)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[se.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px]",style:{background:"linear-gradient(90deg, #FC1EFF 0%, #365EFF 50%, #FACC15 100%)"}}),se.jsxs("div",{onClick:()=>{r(!s)},className:"p-6 cursor-pointer flex items-center justify-between hover:bg-white/5 rounded-[20px] transition-colors",children:[se.jsx("div",{className:"flex items-center space-x-3",children:se.jsxs("div",{children:[se.jsx("h3",{className:"text-lg font-semibold text-white font-orbitron",children:n.title}),se.jsxs("p",{className:"text-sm text-white/60",children:[t.length," ",1===t.length?"notifica":"notifiche",o>0&&se.jsxs("span",{className:"ml-2 px-2 py-1 bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white text-xs rounded-full",children:[o," nuove"]})]})]})}),se.jsx(et.div,{animate:{rotate:s?180:0},transition:{duration:.3},children:se.jsx(ls,{className:"w-5 h-5 text-white/60"})})]}),se.jsx(tt,{children:s&&se.jsx(et.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.4,ease:"easeInOut"},className:"overflow-hidden",children:se.jsx("div",{className:"px-6 pb-6 space-y-3",children:t.map((e,t)=>se.jsx(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1*t},children:se.jsx(vy,{notification:e,onSelect:()=>i(e.id),onDelete:()=>a(e.id)})},e.id))})})})]})},DS=({onReload:e})=>se.jsxs("div",{className:"text-center text-gray-500 py-8",children:[se.jsx(Xa,{className:"w-12 h-12 mx-auto mb-4 text-white/30"}),se.jsx("p",{className:"text-lg",children:"Nessuna notifica da visualizzare"}),se.jsx("p",{className:"text-sm text-white/40 mt-2",children:"Le tue notifiche appariranno qui"}),se.jsx(mo,{variant:"outline",size:"sm",onClick:e,className:"mt-4",children:"Ricarica notifiche"})]}),RS=({notifications:e,filter:t,onMarkAsRead:i,onDelete:a,onReload:s})=>{const r=()=>(()=>{switch(t){case"unread":return e.filter(e=>!e.read);case"important":return e.filter(e=>"alert"===e.type||"critical"===e.type);default:return e}})().reduce((e,t)=>{const i=t.type||"general";return e[i]||(e[i]=[]),e[i]=[...e[i],t],e},{});return se.jsx(tt,{children:Object.keys(r()).length>0?se.jsx("div",{className:"space-y-4",children:Object.entries(r()).map(([e,t])=>se.jsx(OS,{category:e,notifications:t,onSelect:i,onDelete:a},e))}):se.jsx(DS,{onReload:s})})},BS=()=>{const[e,t]=We.useState("all"),{notifications:i,markAsRead:a,deleteNotification:s,markAllAsRead:r,reloadNotifications:n}=Fa(),{playSound:o}=zS(),{triggerHaptic:l}=Kc(),{updateDynamicIslandOnRead:c,closeDynamicIsland:d}=(e=>{const{startActivity:t,updateActivity:i,endActivity:a}=hw(),{currentMission:s}=mw();return We.useEffect(()=>{if(!e.length)return;const i=e.filter(e=>!e.read);i.length>0?(i.length,t({missionId:`notifications-${Date.now()}`,title:" Nuove notifiche",status:`${i.length} messaggi da HQ`,progress:0,timeLeft:0})):a()},[e.length,e.filter(e=>!e.read).length]),We.useEffect(()=>()=>{(s?.name?.includes("Nuove notifiche")||s?.name?.includes(""))&&a()},[a,s]),{updateDynamicIslandOnRead:t=>{const s=e.filter(e=>!e.read&&e.id!==t).length;s>0?i({status:`${s} messaggi da HQ`}):a()},closeDynamicIsland:()=>{a()}}})(i);uw(),(e=>{We.useEffect(()=>{e()},[e]),We.useEffect(()=>{const t=setInterval(()=>{"visible"===document.visibilityState&&e()},5e3);return()=>clearInterval(t)},[e])})(n);const u=()=>{n()};return se.jsxs(et.div,{className:"w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},style:{height:"100dvh",overflow:"hidden",position:"relative",background:"linear-gradient(to bottom, #0a0b14 0%, #050508 100%)"},children:[se.jsx(ad,{}),se.jsx("main",{style:{paddingTop:"calc(72px + env(safe-area-inset-top, 47px) + 40px)",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px))",height:"100dvh",overflowY:"auto",position:"relative",zIndex:0},children:se.jsxs("div",{className:"container mx-auto",children:[se.jsxs(et.h1,{className:"text-4xl font-orbitron font-bold text-center mt-6 mb-8",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:[se.jsx("span",{className:"text-[#00F7FF]",style:{textShadow:"0 0 10px rgba(0, 247, 255, 0.6), 0 0 20px rgba(0, 247, 255, 0.3)"},children:"NO"}),se.jsx("span",{className:"text-white",style:{textShadow:"0 0 10px rgba(255, 255, 255, 0.6), 0 0 20px rgba(255, 255, 255, 0.3)"},children:"TICE"})]}),se.jsxs(et.div,{className:"max-w-3xl mx-auto px-3 sm:px-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[se.jsx(ES,{filter:e,onFilterChange:t,onMarkAllAsRead:async()=>{await l("success"),r(),o(),d()},onManualReload:u}),se.jsx(RS,{notifications:i,filter:e,onMarkAsRead:async e=>{await l("tick"),a(e),o(),c(e)},onDelete:async e=>{await l("selection"),s(e),o()},onReload:u})]})]})}),se.jsx("div",{id:"mission-bottom-nav-container",style:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1e4,isolation:"isolate",transform:"translateZ(0)",willChange:"transform",display:"block",visibility:"visible",opacity:1},children:se.jsx(sd,{})})]})},US=({children:e,showBottomNav:t=!0})=>{const{profileImage:i}=Qc();yl();const a=sv();return se.jsxs(et.div,{className:"min-h-screen bg-gradient-to-b from-[#131524]/70 to-black text-white",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[se.jsx(ad,{profileImage:i}),se.jsx("div",{className:"h-[72px] w-full"}),se.jsx("main",{className:`pb-20 ${a?"px-3":"px-6"} max-w-screen-xl mx-auto`,children:e}),t&&se.jsx(sd,{}),se.jsx("div",{className:"fixed bottom-0 left-0 w-full h-[150px] pointer-events-none bg-gradient-to-t from-black to-transparent opacity-70 z-10"})]})},qS={all:"",leaderboard:Ia,buzz:Pa,map:Ta,weekly:Ma,generic:La},$S=({open:e,onOpenChange:t})=>{const[i,a]=We.useState(null),[s,r]=We.useState("all"),{notifications:n,unreadCount:o,markAllAsRead:l,reloadNotifications:c,deleteNotification:d}=Fa();We.useEffect(()=>{if(e){c();const e=setInterval(()=>{c()},5e3);return()=>clearInterval(e)}},[e,c]);const u=()=>{c()},h="all"===s?n:n.filter(e=>e.type===qS[s]);return se.jsxs(se.Fragment,{children:[se.jsx(to,{open:e,onOpenChange:t,children:se.jsxs(io,{className:"sm:max-w-md w-full bg-black p-0 overflow-hidden",children:[se.jsxs(ao,{className:"px-6 pt-4 pb-1",children:[se.jsxs(so,{className:"flex items-center gap-1 text-lg",children:[se.jsx(Xa,{className:"h-5 w-5 mr-1"}),"Notifiche",o>0&&se.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-m1ssion-pink rounded-full animate-pulse",children:o}),se.jsx(mo,{variant:"ghost",size:"sm",onClick:u,className:"ml-auto p-1 h-6 w-6",children:se.jsx(ur,{className:"h-3 w-3"})})]}),se.jsx(ro,{className:"text-xs text-muted-foreground",children:"Tutte le notifiche ricevute di recente."})]}),se.jsx("div",{className:"px-3 py-2",children:se.jsxs(Ky,{defaultValue:"all",className:"w-full",onValueChange:e=>r(e),children:[se.jsxs(Xy,{className:"bg-black/40 p-1 w-full grid grid-cols-6 h-auto",children:[se.jsxs(Jy,{value:"all",className:"text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink",children:[se.jsx(Xa,{className:"h-3 w-3"}),se.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Tutti"})]}),se.jsxs(Jy,{value:"leaderboard",className:"text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink",children:[se.jsx(Ir,{className:"h-3 w-3"}),se.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Classifica"})]}),se.jsxs(Jy,{value:"buzz",className:"text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink",children:[se.jsx(xs,{className:"h-3 w-3"}),se.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Buzz"})]}),se.jsxs(Jy,{value:"map",className:"text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink",children:[se.jsx(Ys,{className:"h-3 w-3"}),se.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Mappa"})]}),se.jsxs(Jy,{value:"weekly",className:"text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink",children:[se.jsx(as,{className:"h-3 w-3"}),se.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Settimanale"})]}),se.jsxs(Jy,{value:"generic",className:"text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink",children:[se.jsx(Xa,{className:"h-3 w-3"}),se.jsx("span",{className:"sr-only sm:not-sr-only sm:ml-1",children:"Altre"})]})]}),se.jsx(Qy,{value:s,className:"mt-2 px-3 max-h-[50vh] overflow-y-auto",children:0===h.length?se.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[se.jsx("p",{children:"Non hai notifiche in questa categoria."}),se.jsxs(mo,{variant:"outline",size:"sm",onClick:u,className:"mt-2",children:[se.jsx(ur,{className:"h-3 w-3 mr-1"}),"Ricarica"]})]}):se.jsx("div",{className:"space-y-2",children:h.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).map(e=>se.jsx(vy,{notification:e,onSelect:()=>(e=>{a(e)})(e),onDelete:()=>{return t=e.id,void d(t);var t}},e.id))})})]})}),n.length>0&&o>0&&se.jsx("div",{className:"text-center mt-2 mb-4",children:se.jsx(mo,{size:"sm",variant:"outline",onClick:()=>{l()},className:"bg-gradient-to-r from-m1ssion-blue/20 to-m1ssion-pink/20 hover:from-m1ssion-blue/30 hover:to-m1ssion-pink/30 border-gray-700",children:"Segna tutte come lette"})})]})}),se.jsx(yy,{notification:i,open:!!i,onClose:()=>a(null)})]})},WS=({agentCode:e,agentTitle:t,isEditing:i,onEditToggle:a,onSave:s})=>{const[r,n]=We.useState(!1);sv();const{user:o}=sn(),l=o?.email?.toLowerCase()==="wikus77@hotmail.it".toLowerCase()?"X0197":e;return We.useEffect(()=>{const e=setTimeout(()=>{n(!0)},2e3);return()=>clearTimeout(e)},[]),se.jsxs("div",{className:"p-4 border-b border-white/10 backdrop-blur-xl bg-gradient-to-r from-black/55 via-[#131524]/55 to-black/55 flex justify-between items-center",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsxs(et.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2,duration:.5},className:"flex items-center",children:[se.jsx("span",{className:"text-cyan-400 font-mono text-xs sm:text-sm font-medium",children:"DOSSIER:"}),se.jsx(et.span,{className:"font-mono text-white bg-cyan-900/40 px-2 py-1 rounded text-xs sm:text-sm ml-2 border border-cyan-900/30",initial:{width:0,opacity:0},animate:{width:"auto",opacity:r?1:0},transition:{delay:.5,duration:.5},children:l})]}),!i&&se.jsx("span",{className:"bg-cyan-600 text-white text-xs px-2 py-0.5 rounded-full ml-2",children:t})]}),se.jsxs(mo,{onClick:()=>i?s():a(),size:"sm",className:"bg-cyan-800 hover:bg-cyan-700 h-10 px-3 sm:px-4 text-xs sm:text-sm",children:[i?se.jsx(mr,{className:"h-4 w-4 mr-1"}):se.jsx(Nr,{className:"h-4 w-4 mr-1"}),i?"Salva":"Modifica"]})]})},HS=e=>{switch(e?.toLowerCase()){case"silver":return"#C0C0C0";case"gold":return"#FFD700";case"black":return"#333333";case"titanium":return"#878787";default:return"#444444"}},ZS=({profileImage:e,name:t,bio:i,agentCode:a,agentTitle:s,investigativeStyle:r,stats:n,credits:o,isEditing:l,subscriptionPlan:c="base",personalInfo:d,setProfileImage:u,setName:h,setBio:m,setAgentCode:p,setAgentTitle:f})=>{const g=sv();return se.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center md:w-1/3",children:[se.jsxs("div",{className:"relative",children:[se.jsx("div",{className:"absolute inset-0 rounded-full ring-2 ring-offset-2 ring-offset-black",style:{"--ring-color":HS(c),borderColor:"var(--ring-color)",boxShadow:"0 0 12px var(--ring-color)80"}}),se.jsxs(cc,{className:(g?"w-24 h-24":"w-32 h-32")+" border-2 border-cyan-500 shadow-lg shadow-cyan-500/20 cursor-pointer relative z-10",children:[se.jsx(dc,{src:e||""}),se.jsx(uc,{className:"bg-cyan-900/30",children:se.jsx(Lr,{className:(g?"w-8 h-8":"w-12 h-12")+" text-cyan-500"})})]}),se.jsx("div",{className:"absolute bottom-0 right-0 bg-cyan-500 rounded-full p-1.5 cursor-pointer hover:bg-cyan-400 transition-colors",onClick:()=>document.getElementById("profile-image-input")?.click(),children:se.jsx(ss,{className:"w-3 h-3 text-black"})}),se.jsx("input",{id:"profile-image-input",type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];if(t)try{const e=`avatar-${Date.now()}.${t.name.split(".").pop()}`,{data:i,error:a}=await ba.storage.from("avatars").upload(e,t,{cacheControl:"3600",upsert:!1});if(a)return console.error("Upload error:",a),void Ki.error("Errore nel caricamento dell'immagine");const{data:s}=ba.storage.from("avatars").getPublicUrl(i.path);u(s.publicUrl),Ki.success("Immagine profilo aggiornata")}catch(i){console.error("Error uploading image:",i),Ki.error("Errore nel caricamento dell'immagine")}},className:"hidden"})]}),se.jsx("div",{className:"mt-4 text-center w-full max-w-[250px] mx-auto",children:l?se.jsxs(se.Fragment,{children:[se.jsx(Sl,{value:t,onChange:e=>h(e.target.value),className:"mb-2 bg-black/30 h-10",placeholder:"Nome Agente"}),se.jsx(Sl,{value:a,onChange:e=>p(e.target.value),className:"mb-2 bg-black/30 font-mono h-10",placeholder:"Codice Agente"}),se.jsx(Sl,{value:s,onChange:e=>f(e.target.value),className:"mb-2 bg-black/30 h-10",placeholder:"Titolo Agente"}),se.jsx(Wb,{value:i,onChange:e=>m(e.target.value),className:"bg-black/30",placeholder:"Bio",rows:g?3:4})]}):se.jsxs(se.Fragment,{children:[se.jsx("h2",{className:(g?"text-lg":"text-xl")+" font-bold mb-1",children:t}),se.jsx("p",{className:"text-sm text-gray-400 mb-3",children:i}),se.jsxs("div",{className:"mb-4 p-2 bg-black/30 rounded-md border border-gray-800",children:[se.jsx("span",{className:"text-xs text-gray-400",children:"Stile investigativo:"}),se.jsxs("div",{className:"flex items-center mt-1 justify-center",children:[se.jsx("span",{className:`w-3 h-3 rounded-full ${r.color} mr-2`}),se.jsx("span",{className:"text-sm font-medium",children:r.style})]})]}),d&&(d.firstName||d.email||d.phone)&&se.jsxs("div",{className:"mb-4 p-2 bg-black/30 rounded-md border border-gray-800",children:[se.jsx("span",{className:"text-xs text-gray-400",children:"Informazioni personali:"}),se.jsxs("div",{className:"mt-1 text-left text-xs",children:[d.firstName&&d.lastName&&se.jsxs("div",{className:"mb-1",children:[se.jsx("span",{className:"text-gray-400",children:"Nome: "}),se.jsx("span",{children:`${d.firstName} ${d.lastName}`})]}),d.email&&se.jsxs("div",{className:"mb-1",children:[se.jsx("span",{className:"text-gray-400",children:"Email: "}),se.jsx("span",{children:d.email})]}),d.phone&&se.jsxs("div",{className:"mb-1",children:[se.jsx("span",{className:"text-gray-400",children:"Telefono: "}),se.jsx("span",{children:d.phone})]}),d.address&&d.city&&se.jsxs("div",{className:"mb-1",children:[se.jsx("span",{className:"text-gray-400",children:"Indirizzo: "}),se.jsx("span",{children:`${d.address}, ${d.city}`}),d.postalCode&&` (${d.postalCode})`]})]})]}),se.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mt-4",children:[se.jsx("div",{className:"flex flex-col items-center",children:se.jsxs("div",{className:"flex items-baseline",children:[se.jsx("span",{className:"text-xs text-gray-400 mr-1.5",children:"Missioni: "}),se.jsx("span",{className:"text-cyan-400 text-lg font-medium",children:n.missionsCompleted})]})}),se.jsx("div",{className:"flex flex-col items-center",children:se.jsxs("div",{className:"flex items-baseline",children:[se.jsx("span",{className:"text-xs text-gray-400 mr-1.5",children:"Indizi: "}),se.jsx("span",{className:"text-cyan-400 text-lg font-medium",children:n.cluesFound})]})}),se.jsx("div",{className:"flex flex-col items-center",children:se.jsxs("div",{className:"flex items-baseline",children:[se.jsx("span",{className:"text-xs text-gray-400 mr-1.5",children:"Crediti: "}),se.jsx("span",{className:"text-cyan-400 text-lg font-medium",children:o})]})})]})]})})]})},VS=()=>{const{getCurrentUser:e}=sn(),{triggerGlobalSync:t}=(()=>{const{getCurrentUser:e}=sn(),t=We.useMemo(()=>e=>{localStorage.setItem("subscription_plan",e),localStorage.setItem("userTier",e),window.dispatchEvent(new StorageEvent("storage",{key:"subscription_plan",newValue:e,storageArea:localStorage})),window.dispatchEvent(new CustomEvent("subscription-sync",{detail:{plan:e,timestamp:Date.now()}}))},[]);return We.useEffect(()=>{const i=e();if(!i)return;i.id;const a=ba.channel(`profiles-sync-${i.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:`id=eq.${i.id}`},e=>{const i=e.new?.subscription_tier||e.new?.tier;i&&t(i)}).subscribe(),s=ba.channel(`subscriptions-sync-${i.id}`).on("postgres_changes",{event:"*",schema:"public",table:"subscriptions",filter:`user_id=eq.${i.id}`},e=>{const i=e.new?.tier;i&&t(i)}).subscribe();return()=>{ba.removeChannel(a),ba.removeChannel(s)}},[e,t]),{triggerGlobalSync:t}})(),[i,a]=We.useState({plan:"Base",expiry:"2025-12-31",benefits:["Accesso di base","Missioni standard"]}),[s,r]=We.useState(500),n=async()=>{const i=e();if(i)try{const{data:e}=await ba.from("subscriptions").select("*").eq("user_id",i.id).eq("status","active").order("created_at",{ascending:!1}).limit(1),{data:s}=await ba.from("profiles").select("subscription_tier, tier").eq("id",i.id).single();let n="Base";if(e&&e.length>0){const t=e[0];t.end_date&&new Date(t.end_date)<new Date||(n=t.tier)}else s?.subscription_tier&&(n=s.subscription_tier);switch(n){case"Silver":a({plan:"Silver",expiry:"2025-12-31",benefits:["Accesso prioritario","Indizi esclusivi","Supporto dedicato"]}),r(1500);break;case"Gold":a({plan:"Gold",expiry:"2025-12-31",benefits:["Accesso prioritario","Indizi esclusivi","Supporto dedicato","Contenuti premium"]}),r(2500);break;case"Black":a({plan:"Black",expiry:"2025-12-31",benefits:["Accesso prioritario VIP","Indizi esclusivi premium","Supporto dedicato 24/7","Contenuti esclusivi Black","Accesso anticipato alle novit"]}),r(1e4);break;case"Titanium":a({plan:"Titanium",expiry:"2025-12-31",benefits:["Accesso illimitato a tutto","Badge Titanium esclusivo neon","Supporto prioritario 24/7","Eventi esclusivi Titanium VIP","Contenuti premium anticipati"]}),r(25e3);break;default:a({plan:"Base",expiry:"2025-12-31",benefits:["Accesso di base","Missioni standard"]}),r(500)}t(n)}catch(s){console.error("Error loading subscription:",s)}};We.useEffect(()=>{n();const e=()=>{n()};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[e]);return{subscription:i,credits:s,setSubscription:a,setCredits:r,upgradeSubscription:async t=>{const i=e();if(i)try{console.warn(` M1SSION UPGRADE STARTED: ${t} for user ${i.id}`),console.warn(" M1SSION CLEANUP: Canceling ALL existing subscriptions");const{error:e}=await ba.from("subscriptions").update({status:"canceled",updated_at:(new Date).toISOString()}).eq("user_id",i.id).neq("status","canceled");if(e?console.error(" M1SSION Error canceling existing subscriptions:",e):console.warn(" M1SSION All existing subscriptions canceled"),"Base"===t){console.warn(" M1SSION FORCING BASE DOWNGRADE");try{const{data:e,error:t}=await ba.functions.invoke("cancel-subscription");t?console.error(" M1SSION Stripe cancel error:",t):console.warn(" M1SSION Stripe cancellation completed:",e)}catch(a){console.error(" M1SSION Stripe cancel failed:",a)}}else{console.warn(` M1SSION CREATING NEW SUBSCRIPTION: ${t}`);const{error:e}=await ba.from("subscriptions").insert({user_id:i.id,tier:t,status:"active",start_date:(new Date).toISOString(),end_date:new Date(Date.now()+31536e6).toISOString(),provider:"stripe"});e?console.error(" M1SSION Error creating subscription:",e):console.warn(" M1SSION New subscription created")}console.warn(` M1SSION FORCING PROFILE UPDATE: ${t}`);const{error:s}=await ba.from("profiles").update({subscription_tier:t,tier:t,updated_at:(new Date).toISOString()}).eq("id",i.id);if(s)throw console.error(" M1SSION CRITICAL PROFILE UPDATE ERROR:",s),new Error(`Profile update failed: ${s.message}`);console.warn(` M1SSION PROFILE FORCED TO: ${t}`),localStorage.setItem("subscription_plan",t),localStorage.setItem("userTier",t),window.dispatchEvent(new Event("storage")),setTimeout(()=>{n()},100),setTimeout(()=>{n()},1e3),setTimeout(()=>{n()},3e3),console.warn(` M1SSION UPGRADE COMPLETE: ${t}`)}catch(s){throw console.error(" M1SSION CRITICAL UPGRADE ERROR:",s),s}},refreshSubscription:n}},GS=({stats:e,history:t,badges:i,subscription:a,personalNotes:s,isEditing:r,setPersonalNotes:n,togglePinBadge:o,navigateToPersonalInfo:l,navigateToPrivacySecurity:c,navigateToPaymentMethods:d,navigateToSubscriptions:u})=>{const{subscription:h}=VS(),m=h;return a.plan,h.plan,m.plan,(new Date).toISOString(),se.jsxs(Ky,{defaultValue:"stats",className:"w-full",children:[se.jsxs(Xy,{className:"w-full grid grid-cols-4 bg-black/30",children:[se.jsx(Jy,{value:"stats",className:"text-xs",children:"Statistiche"}),se.jsx(Jy,{value:"history",className:"text-xs",children:"Cronologia"}),se.jsx(Jy,{value:"badges",className:"text-xs",children:"Badge"}),se.jsx(Jy,{value:"account",className:"text-xs",children:"Account"})]}),se.jsxs(Qy,{value:"stats",className:"p-4 bg-black/20 rounded-md mt-2",children:[se.jsxs("h3",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[se.jsx(Ga,{className:"h-4 w-4 text-cyan-400"}),"Statistiche Personali"]}),se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{children:[se.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[se.jsx("span",{children:"Avanzamento verso il premio"}),se.jsxs("span",{children:[e.prizeProgress,"%"]})]}),se.jsx(Pc,{value:e.prizeProgress,className:"h-2 bg-gray-800"})]}),se.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[se.jsxs("div",{className:"stat-item",children:[se.jsx("span",{className:"text-xs text-gray-400",children:"Missioni completate: "}),se.jsx("span",{className:"text-base font-medium",children:e.missionsCompleted})]}),se.jsxs("div",{className:"stat-item",children:[se.jsx("span",{className:"text-xs text-gray-400",children:"Indizi trovati: "}),se.jsx("span",{className:"text-base font-medium",children:e.cluesFound})]}),se.jsxs("div",{className:"stat-item",children:[se.jsx("span",{className:"text-xs text-gray-400",children:"Tempo di gioco: "}),se.jsx("span",{className:"text-base font-medium",children:e.totalPlayTime})]}),se.jsxs("div",{className:"stat-item",children:[se.jsx("span",{className:"text-xs text-gray-400",children:"Punti totali: "}),se.jsx("span",{className:"text-base font-medium",children:e.pointsEarned.toLocaleString("it-IT")})]})]}),se.jsxs("div",{className:"bg-cyan-900/20 p-3 rounded-md border border-cyan-900/40",children:[se.jsx("span",{className:"text-xs text-cyan-400",children:"Miglior risultato"}),se.jsx("p",{className:"text-sm mt-1",children:e.bestResult})]})]})]}),se.jsxs(Qy,{value:"history",className:"p-4 bg-black/20 rounded-md mt-2",children:[se.jsxs("h3",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[se.jsx(bs,{className:"h-4 w-4 text-cyan-400"}),"Cronologia Operativa"]}),se.jsx("div",{className:"space-y-3",children:t.map((e,t)=>se.jsxs("div",{className:"border-l-2 border-cyan-800 pl-3 py-1",children:[se.jsxs("div",{className:"flex justify-between",children:[se.jsxs("span",{className:"text-xs font-medium",children:["access"===e.type&&"Accesso","mission"===e.type&&"Missione","clue"===e.type&&"Indizio","communication"===e.type&&"Comunicazione"]}),se.jsxs("span",{className:"text-xs text-gray-500",children:[new Date(e.date).toLocaleDateString()," - ",new Date(e.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),se.jsx("p",{className:"text-sm mt-1",children:e.details})]},t))}),se.jsxs("div",{className:"mt-4",children:[se.jsx("h4",{className:"text-sm font-bold mb-2",children:"Note personali"}),r?se.jsx(Wb,{value:s,onChange:e=>n(e.target.value),className:"bg-black/30 h-20"}):se.jsx("div",{className:"bg-black/20 p-3 rounded-md border border-gray-800 text-sm italic",children:s})]})]}),se.jsxs(Qy,{value:"badges",className:"p-4 bg-black/20 rounded-md mt-2",children:[se.jsxs("h3",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[se.jsx(Ga,{className:"h-4 w-4 text-cyan-400"}),"Badge e Traguardi"]}),se.jsx("div",{className:"grid grid-cols-2 gap-3",children:i.map(e=>se.jsxs("div",{className:"p-3 rounded-md border "+(e.unlocked?e.pinned?"border-amber-500 bg-amber-900/20":"border-cyan-900/40 bg-cyan-900/10":"border-gray-700 bg-black/30 opacity-50"),children:[se.jsxs("div",{className:"flex justify-between items-start",children:[se.jsx("span",{className:"text-sm font-bold "+(e.pinned?"text-amber-400":""),children:e.name}),e.unlocked&&se.jsx(mo,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>o(e.id),children:se.jsx(Ga,{className:"h-4 w-4 "+(e.pinned?"text-amber-400 fill-amber-400":"text-gray-400")})})]}),se.jsx("p",{className:"text-xs text-gray-400 mt-1",children:e.description}),se.jsx("div",{className:"mt-2 text-xs",children:e.unlocked?se.jsx("span",{className:"text-green-400",children:"Sbloccato"}):se.jsx("span",{className:"text-gray-500",children:"Bloccato"})})]},e.id))})]}),se.jsxs(Qy,{value:"account",className:"p-4 bg-black/20 rounded-md mt-2",children:[se.jsxs("h3",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[se.jsx(vr,{className:"h-4 w-4 text-cyan-400"}),"Sicurezza e Abbonamento"]}),se.jsx(YS,{subscription:m,navigateToPersonalInfo:l,navigateToPrivacySecurity:c,navigateToPaymentMethods:d,navigateToSubscriptions:u})]})]})},YS=({subscription:e,navigateToPersonalInfo:t,navigateToPrivacySecurity:i,navigateToPaymentMethods:a,navigateToSubscriptions:s})=>se.jsxs(se.Fragment,{children:[se.jsxs("div",{className:"mb-4 p-3 rounded-md bg-gradient-to-r from-cyan-900/30 to-blue-900/30 border border-cyan-900/40",children:[se.jsxs("div",{className:"flex justify-between items-center",children:[se.jsxs("h4",{className:"text-sm font-bold",children:["Piano attivo: ",e.plan]}),se.jsx("span",{className:"bg-amber-600 text-white text-xs px-2 py-0.5 rounded-full",children:e.plan})]}),se.jsxs("span",{className:"text-xs text-gray-400 block mt-1",children:["Scadenza: ",new Date(e.expiry).toLocaleDateString()]}),se.jsxs("div",{className:"mt-2",children:[se.jsx("span",{className:"text-xs text-gray-400",children:"Vantaggi:"}),se.jsx("ul",{className:"mt-1 text-xs space-y-1",children:e.benefits.map((e,t)=>se.jsxs("li",{className:"flex items-center",children:[se.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-cyan-400 mr-2"}),se.jsx("span",{children:e})]},t))})]}),se.jsx(mo,{className:"w-full mt-3 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600",size:"sm",onClick:s,children:"Gestisci Abbonamento"})]}),se.jsx(KS,{navigateToPersonalInfo:t,navigateToPrivacySecurity:i,navigateToPaymentMethods:a})]}),KS=({navigateToPersonalInfo:e,navigateToPrivacySecurity:t,navigateToPaymentMethods:i})=>se.jsxs("div",{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center justify-between p-2 bg-black/30 rounded-md cursor-pointer hover:bg-black/40 transition-colors",onClick:e,children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(vr,{className:"h-4 w-4 text-cyan-400"}),se.jsx("span",{className:"text-sm",children:"Informazioni personali"})]}),se.jsx(mo,{variant:"ghost",size:"sm",className:"h-8",children:se.jsx(vr,{className:"h-3.5 w-3.5"})})]}),se.jsxs("div",{className:"flex items-center justify-between p-2 bg-black/30 rounded-md cursor-pointer hover:bg-black/40 transition-colors",onClick:t,children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(vr,{className:"h-4 w-4 text-cyan-400"}),se.jsx("span",{className:"text-sm",children:"Password e sicurezza"})]}),se.jsx(mo,{variant:"ghost",size:"sm",className:"h-8",children:se.jsx(vr,{className:"h-3.5 w-3.5"})})]}),se.jsxs("div",{className:"flex items-center justify-between p-2 bg-black/30 rounded-md cursor-pointer hover:bg-black/40 transition-colors",onClick:i,children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(vr,{className:"h-4 w-4 text-cyan-400"}),se.jsx("span",{className:"text-sm",children:"Metodi di pagamento"})]}),se.jsx(mo,{variant:"ghost",size:"sm",className:"h-8",children:se.jsx(vr,{className:"h-3.5 w-3.5"})})]})]}),XS=()=>{const{profileData:e}=Jc();return We.useEffect(()=>{if(e){const t=new CustomEvent("profile-sync",{detail:e});window.dispatchEvent(t),e.full_name&&(localStorage.setItem("profileName",e.full_name),localStorage.setItem("agentName",e.full_name),e.full_name),e.bio&&localStorage.setItem("profileBio",e.bio),e.agent_code&&localStorage.setItem("agentCode",e.agent_code),e.avatar_url&&localStorage.setItem("profileImage",e.avatar_url),window.dispatchEvent(new Event("storage"))}},[e]),e},JS=()=>{const e=(()=>{const[e,t]=We.useState(!1),[i,a]=We.useState("Appassionato di auto di lusso e collezionista. Amo la velocit e l'adrenalina!"),[s,r]=We.useState("Mario Rossi"),[n,o]=We.useState("AG-X480"),[l,c]=We.useState("Decoder"),[d,u]=We.useState(null),{toast:h}=mc(),m=XS(),{updateProfile:p}=Jc();return We.useEffect(()=>{m&&(m.full_name&&(r(m.full_name),m.full_name),m.bio&&a(m.bio),m.agent_code&&o(m.agent_code),m.agent_title&&c(m.agent_title),m.avatar_url&&u(m.avatar_url))},[m]),We.useEffect(()=>{(async()=>{if(!m){const e=localStorage.getItem("profileImage");e&&u(e);const t=localStorage.getItem("profileName");t&&r(t);const i=localStorage.getItem("profileBio");i&&a(i);const s=localStorage.getItem("agentCode");s&&o(s)}})()},[m]),{isEditing:e,bio:i,name:s,agentCode:n,agentTitle:l,profileImage:d,setIsEditing:t,setBio:a,setName:r,setAgentCode:o,setAgentTitle:c,setProfileImage:u,handleSaveBasicInfo:async()=>{try{d&&localStorage.setItem("profileImage",d),localStorage.setItem("profileName",s),localStorage.setItem("profileBio",i),localStorage.setItem("agentCode",n),await p({full_name:s,bio:i,agent_code:n,agent_title:l,avatar_url:d}),t(!1),h({title:"Profilo aggiornato",description:"Le modifiche al tuo dossier agente sono state salvate."})}catch(e){console.error("Error saving profile:",e),h({title:"Errore",description:"Impossibile salvare le modifiche. Riprova.",variant:"destructive"})}}}})(),t=(()=>{const[e,t]=We.useState({missionsCompleted:12,cluesFound:47,totalPlayTime:"123h 45m",pointsEarned:9850,prizeProgress:68,bestResult:"Top 5% in Mission X"}),[i,a]=We.useState({style:"Ragionatore Strategico",color:"bg-cyan-500"});return We.useEffect(()=>{(async()=>{const e=localStorage.getItem("investigativeStyle"),t=localStorage.getItem("investigativeStyleColor");if(e&&t)a({style:e,color:t});else{const e=localStorage.getItem("userProfileType");if(e)switch(e){case"comandante":a({style:"Ragionatore Strategico",color:"bg-cyan-500"});break;case"assaltatore":a({style:"Forza d'Impatto",color:"bg-red-500"});break;case"nexus":a({style:"Tessitore di Reti",color:"bg-purple-500"})}}try{const{data:{session:e}}=await ba.auth.getSession();if(e?.user){const{data:t,error:s}=await ba.from("profiles").select("investigative_style").eq("id",e.user.id).single();t&&!s&&t.investigative_style&&a({comandante:{style:"Ragionatore Strategico",color:"bg-cyan-500"},assaltatore:{style:"Forza d'Impatto",color:"bg-red-500"},nexus:{style:"Tessitore di Reti",color:"bg-purple-500"}}[t.investigative_style]||i)}}catch(s){console.error("Error loading stats data from Supabase:",s)}})()},[]),{stats:e,investigativeStyle:i,setStats:t,setInvestigativeStyle:a}})(),i=(()=>{const[e,t]=We.useState([{type:"access",date:"2025-05-03T14:30:00",details:"Login da dispositivo principale"},{type:"mission",date:"2025-05-02T10:15:00",details:"Completata Missione: Enigma della Strada"},{type:"clue",date:"2025-05-01T16:20:00",details:"Acquistato indizio CL-445: 'Tracce digitali'"},{type:"communication",date:"2025-04-30T08:45:00",details:"Nuova comunicazione da HQ: Aggiornamento missione"}]);return{history:e,setHistory:t}})(),a=(()=>{const[e,t]=We.useState([{id:"b1",name:"Primo Contatto",description:"Hai completato la tua prima missione",unlocked:!0,pinned:!0},{id:"b2",name:"Segugio",description:"Hai trovato 10 indizi",unlocked:!0,pinned:!1},{id:"b3",name:"Viaggiatore",description:"Hai esplorato 5 location diverse",unlocked:!0,pinned:!1},{id:"b4",name:"Decifratore",description:"Hai risolto un enigma di livello difficile",unlocked:!1,pinned:!1}]);return{badges:e,togglePinBadge:i=>{t(e.map(e=>e.id===i?{...e,pinned:!e.pinned}:e.id!==i&&e.pinned?{...e,pinned:!1}:e))}}})(),s=(()=>{const[e,t]=We.useState({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",postalCode:"",country:""});return We.useEffect(()=>{(async()=>{try{const{data:{session:e}}=await ba.auth.getSession();if(e?.user){const{data:i,error:a}=await ba.from("profiles").select("first_name, last_name, email, phone, address, city, postal_code, country").eq("id",e.user.id).single();i&&!a&&t({firstName:i.first_name||"",lastName:i.last_name||"",email:i.email||"",phone:i.phone||"",address:i.address||"",city:i.city||"",postalCode:i.postal_code||"",country:i.country||""})}}catch(e){console.error("Error loading personal info from Supabase:",e)}})()},[]),{personalInfo:e,setPersonalInfo:t}})(),r=VS(),n=(()=>{const[e,t]=We.useState("Indizi sulla localizzazione del premio sembrano puntare a Nord...");return{personalNotes:e,setPersonalNotes:e=>{t(e)}}})(),o=Ul();return{profileData:{isEditing:e.isEditing,bio:e.bio,name:e.name,agentCode:e.agentCode,agentTitle:e.agentTitle,profileImage:e.profileImage,showNotifications:o.showNotifications,stats:t.stats,investigativeStyle:t.investigativeStyle,history:i.history,credits:r.credits,badges:a.badges,subscription:r.subscription,personalNotes:n.personalNotes,personalInfo:s.personalInfo},actions:{setIsEditing:e.setIsEditing,setBio:e.setBio,setName:e.setName,setAgentCode:e.setAgentCode,setAgentTitle:e.setAgentTitle,setProfileImage:e.setProfileImage,setShowNotifications:o.setShowNotifications,handleSaveProfile:e.handleSaveBasicInfo,togglePinBadge:a.togglePinBadge,setPersonalNotes:n.setPersonalNotes}}},QS=()=>{const{navigate:e}=yl(),{profileData:t,actions:i}=JS();sv();const{notificationsDrawerOpen:a,closeNotificationsDrawer:s}=ql();return uv(),se.jsxs("div",{className:"min-h-screen bg-black",children:[se.jsxs(US,{children:[se.jsxs("div",{className:"glass-card mx-2 sm:mx-4 mt-2 sm:mt-4 mb-20",children:[se.jsx(WS,{agentCode:t.agentCode,agentTitle:t.agentTitle,isEditing:t.isEditing,onEditToggle:()=>i.setIsEditing(!0),onSave:i.handleSaveProfile}),se.jsxs("div",{className:"p-3 sm:p-6 border-t border-white/10",children:[se.jsx("h2",{className:"text-xl sm:text-2xl font-bold gradient-text mb-4",children:" Informazioni Agente"}),se.jsxs("div",{className:"flex flex-col md:flex-row gap-4 sm:gap-6",children:[se.jsx(ZS,{profileImage:t.profileImage,name:t.name,bio:t.bio,agentCode:t.agentCode,agentTitle:t.agentTitle,investigativeStyle:t.investigativeStyle,stats:{missionsCompleted:t.stats.missionsCompleted,cluesFound:t.stats.cluesFound},credits:t.credits,isEditing:t.isEditing,subscriptionPlan:t.subscription.plan,personalInfo:t.personalInfo,setProfileImage:i.setProfileImage,setName:i.setName,setBio:i.setBio,setAgentCode:i.setAgentCode,setAgentTitle:i.setAgentTitle}),se.jsx("div",{className:"flex-1 mt-4 md:mt-0",children:se.jsx(GS,{stats:t.stats,history:t.history,badges:t.badges,subscription:t.subscription,personalNotes:t.personalNotes,isEditing:t.isEditing,setPersonalNotes:i.setPersonalNotes,togglePinBadge:i.togglePinBadge,navigateToPersonalInfo:()=>e("/profile/personal-info"),navigateToPrivacySecurity:()=>e("/profile/security"),navigateToPaymentMethods:()=>e("/profile/payments"),navigateToSubscriptions:()=>e("/subscriptions")})})]})]})]}),se.jsx($S,{open:a,onOpenChange:s})]}),se.jsx("div",{id:"mission-bottom-nav-container",style:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1e4,isolation:"isolate",transform:"translateZ(0)",willChange:"transform",display:"block",visibility:"visible",opacity:1},children:se.jsx(sd,{})})]})};async function e_(e){const{name:t,arguments:i}=e.function;try{const a=JSON.parse(i);let s;switch(t){case"get_user_state":s=await t_("get-user-state",a);break;case"get_nearby_prizes":s=await t_("get-nearby-prizes",a);break;case"retrieve_docs":s=await t_("rag-search",a);break;case"open_support_ticket":s=await t_("open-support-ticket",a);break;default:throw new Error(`Unknown tool: ${t}`)}return{tool_call_id:e.id,role:"tool",name:t,content:JSON.stringify(s)}}catch(a){return console.error(`[Tool Execution] ${t} failed:`,a),{tool_call_id:e.id,role:"tool",name:t,content:JSON.stringify({error:a instanceof Error?a.message:"Unknown error"})}}}async function t_(e,t){const{data:i,error:a}=await ba.functions.invoke(e,{body:t});if(a)throw a;return i}const i_=[{name:"get_user_state",description:"Legge lo stato completo dell'utente: tier, progressi, notifiche, BUZZ disponibili",parameters:{type:"object",properties:{userId:{type:"string",description:"ID utente (UUID)"}},required:["userId"]}},{name:"get_nearby_prizes",description:"Trova premi e aree rilevanti entro un raggio dalla posizione utente",parameters:{type:"object",properties:{lat:{type:"number",description:"Latitudine"},lng:{type:"number",description:"Longitudine"},radiusKm:{type:"number",description:"Raggio di ricerca in km",default:5}},required:["lat","lng"]}},{name:"retrieve_docs",description:"RAG: cerca risposte su regole, FAQ, policy, changelog M1SSION",parameters:{type:"object",properties:{query:{type:"string",description:"Query di ricerca semantica"},k:{type:"integer",description:"Numero di risultati",default:6}},required:["query"]}},{name:"open_support_ticket",description:"Apre un ticket di supporto per problemi tecnici o richieste utente",parameters:{type:"object",properties:{userId:{type:"string",description:"ID utente"},issue:{type:"string",description:"Descrizione del problema"},category:{type:"string",description:"Categoria: technical, billing, gameplay, other",enum:["technical","billing","gameplay","other"]}},required:["userId","issue"]}}];async function a_(e){const{userId:t,userMessage:i,conversationHistory:a=[]}=e,s=crypto.randomUUID();e.route;try{const o=await async function(e,t){try{const{data:a}=await ba.functions.invoke("get-user-state",{body:{userId:e}});let s=null;try{const{data:t}=await ba.from("norah_messages").select("role, content").eq("user_id",e).order("created_at",{ascending:!1}).limit(10);s=t}catch(i){console.warn("[Enhanced Context] norah_messages not available:",i)}const{data:r}=await ba.from("agent_finalshot_attempts").select("created_at, result").eq("user_id",e).order("created_at",{ascending:!1}).limit(5),n=(r||[]).map(e=>({createdAt:e.created_at,result:e.result}));return{userId:e,agentCode:a?.agentCode||null,tier:a?.tier||"free",cluesFound:a?.cluesFound||0,buzzCount:a?.buzzAvailable||0,mapGenerated:!1,locale:t?.locale||"it",route:t?.route,device:t?.device,geo:t?.geo,recentMessages:(s||[]).reverse(),recentFinalShots:n,unreadNotifications:a?.unreadNotifications||0}}catch(a){return console.error("[Enhanced Context Builder] Error:",a),{userId:e,agentCode:null,tier:"free",cluesFound:0,buzzCount:0,mapGenerated:!1,locale:t?.locale||"it",recentMessages:[]}}}(t,{route:e.route,geo:e.geo,locale:e.locale||"it"}),l=Gj(i),c=s.substring(0,8);l.intent,l.confidence,l.needs_rag,l.needs_tool;let d="";if(l.needs_rag)try{const{data:e,error:t}=await ba.functions.invoke("norah-rag-search",{body:{query:i,k:6}});if(!t&&e?.results?.length>0)d="\n\n **Knowledge Base (M1SSION Docs)**:\n"+e.results.map((e,t)=>`${t+1}. "${e.title}": ${e.chunk_text} (rilevanza: ${(100*e.similarity).toFixed(0)}%)`).join("\n\n"),e.results.length;else{const{get:e}=await ae(async()=>{const{get:e}=await import("./localCache.C59LjE01.js");return{get:e}},[]),t=e(i);d=t?"\n\n **Knowledge Base (Local Cache)**:\n"+t:"\n\n **Knowledge Base**:\nNon ho trovato riferimenti specifici nel KB. Posso spiegarti in breve o aprire le regole ufficiali."}}catch(r){console.warn(`[AI Gateway traceId:${c}] RAG fetch failed:`,r);const{get:e}=await ae(async()=>{const{get:e}=await import("./localCache.C59LjE01.js");return{get:e}},[]),t=e(i);t&&(d="\n\n **Knowledge Base (Local Cache - RAG Error)**:\n"+t)}const u=function(e){return`Tu sei **NORAH AI**, coach ufficiale di M1SSION.\n\nObiettivi: rispondere in modo CONTESTUALE, UTILE e MOTIVANTE. Tono amichevole, micro-humor leggero, mai sarcastico.\n\n## CONTESTO UTENTE (USA SEMPRE)\n- User ID: ${e.userId}\n- Agent Code: ${e.agentCode||"Non assegnato"}\n- Tier: ${e.tier}\n- Indizi trovati: ${e.cluesFound}\n- BUZZ count: ${e.buzzCount}\n- Mappa generata: ${e.mapGenerated?"S":"No"}\n${e.geo?`- Posizione: ${e.geo.city||"Non disponibile"}`:"- Posizione: GPS non attivo"}\n\n## REGOLE DURE\n1. Parla in **italiano**. Prima **risposta diretta**, poi dettagli, poi **CTA** (max 3).\n2. Non inventare fatti: se la domanda riguarda BUZZ/BUZZ Map/Final Shot/Regole  usa **retrieve_docs** (RAG) prima di rispondere.\n3. Per domande operative (premi vicino, stato, abbonamento)  usa i **tool**.\n4. Se non sei sicura e confidence<0.55, fai **una sola** domanda di chiarimento.\n5. Rispetta il **tier** e lo **stato** utente dal contesto; niente azioni oltre i limiti.\n6. Memoria solo se l'utente lo chiede ("ricorda") e conferma.\n\n## BLUEPRINT OBBLIGATORIO DI OUTPUT\n1) Risposta diretta (max 2 frasi).\n2) 23 bullet di dettaglio contestuale (preferisci ci che viene da documenti M1SSION).\n3) 23 CTA pertinenti (formato [Azione]).\n4) Una riga motivazionale breve.\n\n## STILE\n- Frasi brevi, concrete. Emoji con parsimonia (max 1).\n- Quando citi info da RAG: "(fonte: documenti M1SSION)".\n- Evita filler ("capisco la tua frustrazione") se non serve.\n\nSei pronta, NORAH?`}(o)+d,h=[{role:"system",content:u},{role:"system",content:'## DEVELOPER INSTRUCTIONS\n\n- Usa SEMPRE il blueprint output\n- Per domande su BUZZ/BUZZ Map/Final Shot: PRIMA retrieve_docs, POI rispondi\n- Se l\'utente chiede azione (premi vicini, stato): USA i tool\n- NO risposte generiche: personalizza con contesto utente\n- Temperature: 0.2 per facts, 0.5 per motivazione/coaching\n- Max output: 400 token\n\n## TOOLS DISPONIBILI\n- retrieve_docs: cerca nella KB M1SSION\n- get_user_state: stato utente completo  \n- get_nearby_prizes: premi nelle vicinanze (GPS required)\n- open_support_ticket: apri ticket supporto\n\n## ESEMPI\n\n**Q**: "Cos\' il BUZZ?"\n**A**: Usa retrieve_docs({query: "BUZZ definizione", k: 3}), poi formatta con blueprint\n\n**Q**: "Premi vicino a me?"\n**A**: Usa get_nearby_prizes, lista premi, suggerisci mappa\n\n**Q**: "Non funziona pagamento"\n**A**: Usa open_support_ticket, rassicura, CTA alternative'},...a,{role:"user",content:i}],{data:m,error:p}=await ba.functions.invoke("chat",{body:{messages:h,tools:i_,tool_choice:"auto"}});if(p)return console.error(`[AI Gateway] traceId:${s} chat error:`,p),{message:"Problema con il servizio AI. Riprova tra poco.",suggestedActions:[]};let f=m?.message||"Nessuna risposta dal modello.";if(m?.tool_calls&&Array.isArray(m.tool_calls)){m.tool_calls.length;try{const e=await async function(e){return Promise.all(e.map(e_))}(m.tool_calls),t=[...h,{role:"assistant",content:m.message,tool_calls:m.tool_calls},...e],{data:i,error:a}=await ba.functions.invoke("chat",{body:{messages:t}});a?console.error(`[AI Gateway] traceId:${s} tool response error:`,a):f=i?.message||f}catch(n){console.error(`[AI Gateway] traceId:${s} tool execution failed:`,n)}}const g={message:f};return await async function(e,t,i,a){try{const{data:s}=await ba.from("ai_sessions").select("id").eq("user_id",e).order("started_at",{ascending:!1}).limit(1).maybeSingle();let r=s?.id;if(!r){const{data:t}=await ba.from("ai_sessions").insert({user_id:e,locale:a.locale,subscription_tier:a.tier}).select("id").single();r=t?.id}r&&await ba.from("ai_events").insert({session_id:r,user_id:e,event_type:"ai_response",payload:{user_message:t.substring(0,200),ai_response:i.substring(0,200),context_tier:a.tier,context_clues:a.cluesFound}})}catch(s){console.error("[AI Gateway] Failed to log interaction:",s)}}(t,i,g.message,o),g}catch(o){return console.error(`[AI Gateway] traceId:${s} error:`,o),console.error("[AI Gateway] Error:",o),{message:"Mi dispiace, ho avuto un problema tecnico. Riprova tra poco.",suggestedActions:[]}}}const{entries:s_,setPrototypeOf:r_,isFrozen:n_,getPrototypeOf:o_,getOwnPropertyDescriptor:l_}=Object;let{freeze:c_,seal:d_,create:u_}=Object,{apply:h_,construct:m_}="undefined"!=typeof Reflect&&Reflect;c_||(c_=function(e){return e}),d_||(d_=function(e){return e}),h_||(h_=function(e,t){for(var i=arguments.length,a=new Array(i>2?i-2:0),s=2;s<i;s++)a[s-2]=arguments[s];return e.apply(t,a)}),m_||(m_=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return new e(...i)});const p_=z_(Array.prototype.forEach),f_=z_(Array.prototype.lastIndexOf),g_=z_(Array.prototype.pop),x_=z_(Array.prototype.push),b_=z_(Array.prototype.splice),v_=z_(String.prototype.toLowerCase),y_=z_(String.prototype.toString),w_=z_(String.prototype.match),N_=z_(String.prototype.replace),j_=z_(String.prototype.indexOf),S_=z_(String.prototype.trim),__=z_(Object.prototype.hasOwnProperty),k_=z_(RegExp.prototype.test),C_=(A_=TypeError,function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return m_(A_,t)});var A_;function z_(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return h_(e,t,a)}}function E_(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v_;r_&&r_(e,null);let a=t.length;for(;a--;){let s=t[a];if("string"==typeof s){const e=i(s);e!==s&&(n_(t)||(t[a]=e),s=e)}e[s]=!0}return e}function I_(e){for(let t=0;t<e.length;t++){__(e,t)||(e[t]=null)}return e}function P_(e){const t=u_(null);for(const[i,a]of s_(e)){__(e,i)&&(Array.isArray(a)?t[i]=I_(a):a&&"object"==typeof a&&a.constructor===Object?t[i]=P_(a):t[i]=a)}return t}function T_(e,t){for(;null!==e;){const i=l_(e,t);if(i){if(i.get)return z_(i.get);if("function"==typeof i.value)return z_(i.value)}e=o_(e)}return function(){return null}}const M_=c_(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),L_=c_(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),F_=c_(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),O_=c_(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),D_=c_(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),R_=c_(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),B_=c_(["#text"]),U_=c_(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),q_=c_(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),$_=c_(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),W_=c_(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),H_=d_(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Z_=d_(/<%[\w\W]*|[\w\W]*%>/gm),V_=d_(/\$\{[\w\W]*/gm),G_=d_(/^data-[\-\w.\u00B7-\uFFFF]+$/),Y_=d_(/^aria-[\-\w]+$/),K_=d_(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),X_=d_(/^(?:\w+script|data):/i),J_=d_(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Q_=d_(/^html$/i),ek=d_(/^[a-z][.\w]*(-[.\w]+)+$/i);var tk=Object.freeze({__proto__:null,ARIA_ATTR:Y_,ATTR_WHITESPACE:J_,CUSTOM_ELEMENT:ek,DATA_ATTR:G_,DOCTYPE_NAME:Q_,ERB_EXPR:Z_,IS_ALLOWED_URI:K_,IS_SCRIPT_OR_DATA:X_,MUSTACHE_EXPR:H_,TMPLIT_EXPR:V_});const ik=1,ak=3,sk=7,rk=8,nk=9;var ok=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const i=t=>e(t);if(i.version="3.3.0",i.removed=[],!t||!t.document||t.document.nodeType!==nk||!t.Element)return i.isSupported=!1,i;let{document:a}=t;const s=a,r=s.currentScript,{DocumentFragment:n,HTMLTemplateElement:o,Node:l,Element:c,NodeFilter:d,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:h,DOMParser:m,trustedTypes:p}=t,f=c.prototype,g=T_(f,"cloneNode"),x=T_(f,"remove"),b=T_(f,"nextSibling"),v=T_(f,"childNodes"),y=T_(f,"parentNode");if("function"==typeof o){const e=a.createElement("template");e.content&&e.content.ownerDocument&&(a=e.content.ownerDocument)}let w,N="";const{implementation:j,createNodeIterator:S,createDocumentFragment:_,getElementsByTagName:k}=a,{importNode:C}=s;let A={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};i.isSupported="function"==typeof s_&&"function"==typeof y&&j&&void 0!==j.createHTMLDocument;const{MUSTACHE_EXPR:z,ERB_EXPR:E,TMPLIT_EXPR:I,DATA_ATTR:P,ARIA_ATTR:T,IS_SCRIPT_OR_DATA:M,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:F}=tk;let{IS_ALLOWED_URI:O}=tk,D=null;const R=E_({},[...M_,...L_,...F_,...D_,...B_]);let B=null;const U=E_({},[...U_,...q_,...$_,...W_]);let q=Object.seal(u_(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),$=null,W=null;const H=Object.seal(u_(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Z=!0,V=!0,G=!1,Y=!0,K=!1,X=!0,J=!1,Q=!1,ee=!1,te=!1,ie=!1,ae=!1,se=!0,re=!1,ne=!0,oe=!1,le={},ce=null;const de=E_({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ue=null;const he=E_({},["audio","video","img","source","image","track"]);let me=null;const pe=E_({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),fe="http://www.w3.org/1998/Math/MathML",ge="http://www.w3.org/2000/svg",xe="http://www.w3.org/1999/xhtml";let be=xe,ve=!1,ye=null;const we=E_({},[fe,ge,xe],y_);let Ne=E_({},["mi","mo","mn","ms","mtext"]),je=E_({},["annotation-xml"]);const Se=E_({},["title","style","font","a","script"]);let _e=null;const ke=["application/xhtml+xml","text/html"];let Ce=null,Ae=null;const ze=a.createElement("form"),Ee=function(e){return e instanceof RegExp||e instanceof Function},Ie=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Ae||Ae!==e){if(e&&"object"==typeof e||(e={}),e=P_(e),_e=-1===ke.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Ce="application/xhtml+xml"===_e?y_:v_,D=__(e,"ALLOWED_TAGS")?E_({},e.ALLOWED_TAGS,Ce):R,B=__(e,"ALLOWED_ATTR")?E_({},e.ALLOWED_ATTR,Ce):U,ye=__(e,"ALLOWED_NAMESPACES")?E_({},e.ALLOWED_NAMESPACES,y_):we,me=__(e,"ADD_URI_SAFE_ATTR")?E_(P_(pe),e.ADD_URI_SAFE_ATTR,Ce):pe,ue=__(e,"ADD_DATA_URI_TAGS")?E_(P_(he),e.ADD_DATA_URI_TAGS,Ce):he,ce=__(e,"FORBID_CONTENTS")?E_({},e.FORBID_CONTENTS,Ce):de,$=__(e,"FORBID_TAGS")?E_({},e.FORBID_TAGS,Ce):P_({}),W=__(e,"FORBID_ATTR")?E_({},e.FORBID_ATTR,Ce):P_({}),le=!!__(e,"USE_PROFILES")&&e.USE_PROFILES,Z=!1!==e.ALLOW_ARIA_ATTR,V=!1!==e.ALLOW_DATA_ATTR,G=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Y=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,K=e.SAFE_FOR_TEMPLATES||!1,X=!1!==e.SAFE_FOR_XML,J=e.WHOLE_DOCUMENT||!1,te=e.RETURN_DOM||!1,ie=e.RETURN_DOM_FRAGMENT||!1,ae=e.RETURN_TRUSTED_TYPE||!1,ee=e.FORCE_BODY||!1,se=!1!==e.SANITIZE_DOM,re=e.SANITIZE_NAMED_PROPS||!1,ne=!1!==e.KEEP_CONTENT,oe=e.IN_PLACE||!1,O=e.ALLOWED_URI_REGEXP||K_,be=e.NAMESPACE||xe,Ne=e.MATHML_TEXT_INTEGRATION_POINTS||Ne,je=e.HTML_INTEGRATION_POINTS||je,q=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&Ee(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(q.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Ee(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(q.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(q.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),K&&(V=!1),ie&&(te=!0),le&&(D=E_({},B_),B=[],!0===le.html&&(E_(D,M_),E_(B,U_)),!0===le.svg&&(E_(D,L_),E_(B,q_),E_(B,W_)),!0===le.svgFilters&&(E_(D,F_),E_(B,q_),E_(B,W_)),!0===le.mathMl&&(E_(D,D_),E_(B,$_),E_(B,W_))),e.ADD_TAGS&&("function"==typeof e.ADD_TAGS?H.tagCheck=e.ADD_TAGS:(D===R&&(D=P_(D)),E_(D,e.ADD_TAGS,Ce))),e.ADD_ATTR&&("function"==typeof e.ADD_ATTR?H.attributeCheck=e.ADD_ATTR:(B===U&&(B=P_(B)),E_(B,e.ADD_ATTR,Ce))),e.ADD_URI_SAFE_ATTR&&E_(me,e.ADD_URI_SAFE_ATTR,Ce),e.FORBID_CONTENTS&&(ce===de&&(ce=P_(ce)),E_(ce,e.FORBID_CONTENTS,Ce)),ne&&(D["#text"]=!0),J&&E_(D,["html","head","body"]),D.table&&(E_(D,["tbody"]),delete $.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw C_('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw C_('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=e.TRUSTED_TYPES_POLICY,N=w.createHTML("")}else void 0===w&&(w=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let i=null;const a="data-tt-policy-suffix";t&&t.hasAttribute(a)&&(i=t.getAttribute(a));const s="dompurify"+(i?"#"+i:"");try{return e.createPolicy(s,{createHTML:e=>e,createScriptURL:e=>e})}catch(pB){return console.warn("TrustedTypes policy "+s+" could not be created."),null}}(p,r)),null!==w&&"string"==typeof N&&(N=w.createHTML(""));c_&&c_(e),Ae=e}},Pe=E_({},[...L_,...F_,...O_]),Te=E_({},[...D_,...R_]),Me=function(e){x_(i.removed,{element:e});try{y(e).removeChild(e)}catch(pB){x(e)}},Le=function(e,t){try{x_(i.removed,{attribute:t.getAttributeNode(e),from:t})}catch(pB){x_(i.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(te||ie)try{Me(t)}catch(pB){}else try{t.setAttribute(e,"")}catch(pB){}},Fe=function(e){let t=null,i=null;if(ee)e="<remove></remove>"+e;else{const t=w_(e,/^[\r\n\t ]+/);i=t&&t[0]}"application/xhtml+xml"===_e&&be===xe&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const s=w?w.createHTML(e):e;if(be===xe)try{t=(new m).parseFromString(s,_e)}catch(pB){}if(!t||!t.documentElement){t=j.createDocument(be,"template",null);try{t.documentElement.innerHTML=ve?N:s}catch(pB){}}const r=t.body||t.documentElement;return e&&i&&r.insertBefore(a.createTextNode(i),r.childNodes[0]||null),be===xe?k.call(t,J?"html":"body")[0]:J?t.documentElement:r},Oe=function(e){return S.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},De=function(e){return e instanceof h&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof u)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Re=function(e){return"function"==typeof l&&e instanceof l};function Be(e,t,a){p_(e,e=>{e.call(i,t,a,Ae)})}const Ue=function(e){let t=null;if(Be(A.beforeSanitizeElements,e,null),De(e))return Me(e),!0;const a=Ce(e.nodeName);if(Be(A.uponSanitizeElement,e,{tagName:a,allowedTags:D}),X&&e.hasChildNodes()&&!Re(e.firstElementChild)&&k_(/<[/\w!]/g,e.innerHTML)&&k_(/<[/\w!]/g,e.textContent))return Me(e),!0;if(e.nodeType===sk)return Me(e),!0;if(X&&e.nodeType===rk&&k_(/<[/\w]/g,e.data))return Me(e),!0;if(!(H.tagCheck instanceof Function&&H.tagCheck(a))&&(!D[a]||$[a])){if(!$[a]&&$e(a)){if(q.tagNameCheck instanceof RegExp&&k_(q.tagNameCheck,a))return!1;if(q.tagNameCheck instanceof Function&&q.tagNameCheck(a))return!1}if(ne&&!ce[a]){const t=y(e)||e.parentNode,i=v(e)||e.childNodes;if(i&&t){for(let a=i.length-1;a>=0;--a){const s=g(i[a],!0);s.__removalCount=(e.__removalCount||0)+1,t.insertBefore(s,b(e))}}}return Me(e),!0}return e instanceof c&&!function(e){let t=y(e);t&&t.tagName||(t={namespaceURI:be,tagName:"template"});const i=v_(e.tagName),a=v_(t.tagName);return!!ye[e.namespaceURI]&&(e.namespaceURI===ge?t.namespaceURI===xe?"svg"===i:t.namespaceURI===fe?"svg"===i&&("annotation-xml"===a||Ne[a]):Boolean(Pe[i]):e.namespaceURI===fe?t.namespaceURI===xe?"math"===i:t.namespaceURI===ge?"math"===i&&je[a]:Boolean(Te[i]):e.namespaceURI===xe?!(t.namespaceURI===ge&&!je[a])&&!(t.namespaceURI===fe&&!Ne[a])&&!Te[i]&&(Se[i]||!Pe[i]):!("application/xhtml+xml"!==_e||!ye[e.namespaceURI]))}(e)?(Me(e),!0):"noscript"!==a&&"noembed"!==a&&"noframes"!==a||!k_(/<\/no(script|embed|frames)/i,e.innerHTML)?(K&&e.nodeType===ak&&(t=e.textContent,p_([z,E,I],e=>{t=N_(t,e," ")}),e.textContent!==t&&(x_(i.removed,{element:e.cloneNode()}),e.textContent=t)),Be(A.afterSanitizeElements,e,null),!1):(Me(e),!0)},qe=function(e,t,i){if(se&&("id"===t||"name"===t)&&(i in a||i in ze))return!1;if(V&&!W[t]&&k_(P,t));else if(Z&&k_(T,t));else if(H.attributeCheck instanceof Function&&H.attributeCheck(t,e));else if(!B[t]||W[t]){if(!($e(e)&&(q.tagNameCheck instanceof RegExp&&k_(q.tagNameCheck,e)||q.tagNameCheck instanceof Function&&q.tagNameCheck(e))&&(q.attributeNameCheck instanceof RegExp&&k_(q.attributeNameCheck,t)||q.attributeNameCheck instanceof Function&&q.attributeNameCheck(t,e))||"is"===t&&q.allowCustomizedBuiltInElements&&(q.tagNameCheck instanceof RegExp&&k_(q.tagNameCheck,i)||q.tagNameCheck instanceof Function&&q.tagNameCheck(i))))return!1}else if(me[t]);else if(k_(O,N_(i,L,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==j_(i,"data:")||!ue[e]){if(G&&!k_(M,N_(i,L,"")));else if(i)return!1}else;return!0},$e=function(e){return"annotation-xml"!==e&&w_(e,F)},We=function(e){Be(A.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||De(e))return;const a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:B,forceKeepAttr:void 0};let s=t.length;for(;s--;){const r=t[s],{name:n,namespaceURI:o,value:l}=r,c=Ce(n),d=l;let u="value"===n?d:S_(d);if(a.attrName=c,a.attrValue=u,a.keepAttr=!0,a.forceKeepAttr=void 0,Be(A.uponSanitizeAttribute,e,a),u=a.attrValue,!re||"id"!==c&&"name"!==c||(Le(n,e),u="user-content-"+u),X&&k_(/((--!?|])>)|<\/(style|title|textarea)/i,u)){Le(n,e);continue}if("attributename"===c&&w_(u,"href")){Le(n,e);continue}if(a.forceKeepAttr)continue;if(!a.keepAttr){Le(n,e);continue}if(!Y&&k_(/\/>/i,u)){Le(n,e);continue}K&&p_([z,E,I],e=>{u=N_(u,e," ")});const h=Ce(e.nodeName);if(qe(h,c,u)){if(w&&"object"==typeof p&&"function"==typeof p.getAttributeType)if(o);else switch(p.getAttributeType(h,c)){case"TrustedHTML":u=w.createHTML(u);break;case"TrustedScriptURL":u=w.createScriptURL(u)}if(u!==d)try{o?e.setAttributeNS(o,n,u):e.setAttribute(n,u),De(e)?Me(e):g_(i.removed)}catch(pB){Le(n,e)}}else Le(n,e)}Be(A.afterSanitizeAttributes,e,null)},He=function e(t){let i=null;const a=Oe(t);for(Be(A.beforeSanitizeShadowDOM,t,null);i=a.nextNode();)Be(A.uponSanitizeShadowNode,i,null),Ue(i),We(i),i.content instanceof n&&e(i.content);Be(A.afterSanitizeShadowDOM,t,null)};return i.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null,r=null,o=null,c=null;if(ve=!e,ve&&(e="\x3c!--\x3e"),"string"!=typeof e&&!Re(e)){if("function"!=typeof e.toString)throw C_("toString is not a function");if("string"!=typeof(e=e.toString()))throw C_("dirty is not a string, aborting")}if(!i.isSupported)return e;if(Q||Ie(t),i.removed=[],"string"==typeof e&&(oe=!1),oe){if(e.nodeName){const t=Ce(e.nodeName);if(!D[t]||$[t])throw C_("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)a=Fe("\x3c!----\x3e"),r=a.ownerDocument.importNode(e,!0),r.nodeType===ik&&"BODY"===r.nodeName||"HTML"===r.nodeName?a=r:a.appendChild(r);else{if(!te&&!K&&!J&&-1===e.indexOf("<"))return w&&ae?w.createHTML(e):e;if(a=Fe(e),!a)return te?null:ae?N:""}a&&ee&&Me(a.firstChild);const d=Oe(oe?e:a);for(;o=d.nextNode();)Ue(o),We(o),o.content instanceof n&&He(o.content);if(oe)return e;if(te){if(ie)for(c=_.call(a.ownerDocument);a.firstChild;)c.appendChild(a.firstChild);else c=a;return(B.shadowroot||B.shadowrootmode)&&(c=C.call(s,c,!0)),c}let u=J?a.outerHTML:a.innerHTML;return J&&D["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&k_(Q_,a.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+a.ownerDocument.doctype.name+">\n"+u),K&&p_([z,E,I],e=>{u=N_(u,e," ")}),w&&ae?w.createHTML(u):u},i.setConfig=function(){Ie(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Q=!0},i.clearConfig=function(){Ae=null,Q=!1},i.isValidAttribute=function(e,t,i){Ae||Ie({});const a=Ce(e),s=Ce(t);return qe(a,s,i)},i.addHook=function(e,t){"function"==typeof t&&x_(A[e],t)},i.removeHook=function(e,t){if(void 0!==t){const i=f_(A[e],t);return-1===i?void 0:b_(A[e],i,1)[0]}return g_(A[e])},i.removeHooks=function(e){A[e]=[]},i.removeAllHooks=function(){A={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},i}();const lk=Object.freeze(Object.defineProperty({__proto__:null,default:ok},Symbol.toStringTag,{value:"Module"}));function ck(e){let t=ok.sanitize(e,{ALLOWED_TAGS:["b","i","strong","em","u","br","p","ul","ol","li","code","pre","a","span","h1","h2","h3","h4","h5","h6","blockquote","hr"],ALLOWED_ATTR:["href","title","target","rel"],FORBID_TAGS:["style","img","svg","math","iframe","script","object","embed"],FORBID_ATTR:["style","src","srcset","onerror","onclick"],ALLOW_DATA_ATTR:!1,ADD_ATTR:["target","rel"],RETURN_TRUSTED_TYPE:!1});return t=t.replace(/<a\s+([^>]*href=["'][^"']*["'][^>]*)>/gi,'<a $1 target="_blank" rel="noopener noreferrer nofollow">'),t}const dk=({userId:e})=>{const{askNorah:t,isProcessing:i,isOffline:a}=function({userId:e,route:t,locale:i="it"}){const[a,s]=We.useState(!1),[r,n]=We.useState([]),[o,l]=We.useState(!1),{toast:c}=mc();return{askNorah:We.useCallback(async o=>{if(!o.trim()||a)return"";s(!0);const d=crypto.randomUUID();o.substring(0,50);try{if(function(e){return e.confidence<.55}(Gj(o))){const e="Non sono sicura di aver capito. Vuoi sapere di BUZZ, BUZZ Map, Final Shot o qualcos'altro? Dimmi pure!";return n(t=>[...t,{role:"user",content:o},{role:"assistant",content:e}]),s(!1),e}const a={role:"user",content:o};n(e=>[...e,a]);const c={userId:e,userMessage:o,route:t,locale:i,conversationHistory:r};let d=(await a_(c)).message;const u={role:"assistant",content:d};return n(e=>[...e,u]),l(!1),d}catch(u){console.error(`[NorahLLM] traceId:${d} error:`,u),(u?.message?.includes("402")||u?.message?.includes("429")||402===u?.status||429===u?.status)&&(l(!0),c({title:" Modalit Offline",description:"Limite raggiunto. Risposte template attive.",variant:"destructive"}));const e=await xS(o),t={role:"assistant",content:e};return n(e=>[{role:"user",content:o},t]),l(!0),e}finally{s(!1)}},[e,t,i,r,a,c]),clearHistory:We.useCallback(()=>{n([]),l(!1)},[]),isProcessing:a,conversationHistory:r,isOffline:o}}({userId:e,route:"/intelligence",locale:"it"}),[s,r]=We.useState([{role:"assistant",content:" Ciao! Sono NORAH, la tua assistente M1SSION. Come posso aiutarti oggi?",timestamp:new Date}]),[n,o]=We.useState(""),l=We.useRef(null);We.useEffect(()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)},[s]);const c=async()=>{if(!n.trim()||i)return;const e={role:"user",content:n.trim(),timestamp:new Date};r(t=>[...t,e]),o("");const a=await t(n.trim());a&&r(e=>[...e,{role:"assistant",content:a,timestamp:new Date}])},d=se.jsxs(se.Fragment,{children:[se.jsx("div",{className:"norah-chat-modal-backdrop"}),se.jsxs("div",{className:"norah-chat-modal",children:[se.jsxs("div",{className:"norah-chat-modal__header",children:[se.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center",children:se.jsx(Qa,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{className:"flex-1",children:[se.jsx("h3",{className:"font-bold text-white",children:"NORAH AI"}),se.jsx("p",{className:"text-xs text-white/60",children:"Assistente M1SSION"})]}),a&&se.jsxs(fc,{variant:"destructive",className:"gap-1",children:[se.jsx(Br,{className:"w-3 h-3"}),"Offline"]})]}),se.jsx("div",{className:"norah-chat-modal__body",ref:l,children:se.jsxs("div",{className:"space-y-3 md:space-y-4",children:[s.map((e,t)=>se.jsxs("div",{className:"flex gap-3 "+("assistant"===e.role?"justify-start":"justify-end"),children:["assistant"===e.role&&se.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center flex-shrink-0",children:se.jsx(Qa,{className:"w-4 h-4 text-white"})}),se.jsxs("div",{className:"max-w-[80%] p-3 rounded-xl "+("assistant"===e.role?"bg-white/5 text-white":"bg-gradient-to-r from-[#4361ee] to-[#7209b7] text-white"),children:["assistant"===e.role?se.jsx("div",{className:"text-sm prose prose-invert prose-sm max-w-none",dangerouslySetInnerHTML:{__html:ck(e.content)}}):se.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),se.jsx("span",{className:"text-xs opacity-50 mt-1 block",children:e.timestamp.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})]}),"user"===e.role&&se.jsx("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center flex-shrink-0",children:se.jsx(Lr,{className:"w-4 h-4 text-white"})})]},t)),i&&se.jsxs("div",{className:"flex gap-3 justify-start",children:[se.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center flex-shrink-0",children:se.jsx(Qa,{className:"w-4 h-4 text-white animate-pulse"})}),se.jsx("div",{className:"bg-white/5 p-3 rounded-xl",children:se.jsxs("div",{className:"flex gap-1",children:[se.jsx("div",{className:"w-2 h-2 bg-white/50 rounded-full animate-bounce"}),se.jsx("div",{className:"w-2 h-2 bg-white/50 rounded-full animate-bounce delay-100"}),se.jsx("div",{className:"w-2 h-2 bg-white/50 rounded-full animate-bounce delay-200"})]})})]})]})}),se.jsxs("div",{className:"norah-chat-modal__footer",children:[se.jsxs("div",{className:"flex gap-2",children:[se.jsx(Sl,{value:n,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())},placeholder:"Chiedi qualcosa a Norah...",disabled:i,className:"flex-1 bg-white/10 border-white/20 text-white placeholder:text-white/40"}),se.jsx(mo,{onClick:c,disabled:!n.trim()||i,size:"icon",className:"bg-gradient-to-r from-[#4361ee] to-[#7209b7] hover:opacity-90",children:se.jsx(fr,{className:"w-4 h-4"})})]}),se.jsx("p",{className:"text-xs text-white/40 mt-2",children:" Chiedi informazioni su BUZZ, piani, Final Shot e molto altro!"})]})]})]});return Ve.createPortal(d,document.body)},uk=()=>{const{t:e}=qN(),[,t]=Ai(),[i,a]=Ze.useState(null);Ze.useEffect(()=>{ba.auth.getUser().then(({data:e})=>{a(e.user?.id||null)})},[]);const s=()=>se.jsx("div",{className:"flex items-center",children:se.jsx(mo,{variant:"ghost",size:"icon",onClick:()=>t("/home"),className:"mr-2",children:se.jsx(Za,{className:"h-5 w-5"})})});return se.jsxs("div",{className:"bg-gradient-to-b from-[#131524]/70 to-black w-full",style:{height:"100dvh",overflow:"hidden",position:"relative"},children:[se.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",style:{height:"72px",paddingTop:"env(safe-area-inset-top, 47px)",background:"rgba(19, 21, 33, 0.55)",backdropFilter:"blur(12px)"},children:se.jsx(ad,{profileImage:localStorage.getItem("profileImage"),leftComponent:se.jsx(s,{})})}),se.jsx("main",{style:{paddingTop:"calc(72px + env(safe-area-inset-top, 47px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px))",height:"100dvh",overflowY:"auto",position:"relative",zIndex:0},children:se.jsxs("div",{className:"w-full h-full px-0 md:px-4 md:max-w-screen-xl md:mx-auto",children:[se.jsxs("div",{className:"mb-4 md:mb-6 px-4 md:px-0",children:[se.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent mb-2",children:e("norah_ai_assistant")}),se.jsx("p",{className:"text-sm md:text-base text-white/70",children:e("assistant_description")})]}),se.jsxs("div",{className:"h-full",children:[i&&se.jsx(dk,{userId:i}),!i&&se.jsx("p",{className:"text-white/60 px-4",children:e("loading")})]})]})})]})},hk=["geo.enabled.v1","geo_enabled"];function mk(e){try{hk.forEach(t=>e?localStorage.setItem(t,"1"):localStorage.removeItem(t))}catch{}}function pk(){const[e,t]=We.useState("idle"),[i,a]=We.useState(()=>function(){try{return hk.some(e=>"1"===localStorage.getItem(e))}catch{return!1}}()),[s,r]=We.useState(void 0),n=We.useRef(),o=We.useCallback(()=>{mk(!0),a(!0)},[]),l=We.useCallback(()=>{mk(!1),a(!1),t("idle"),null!=n.current&&navigator.geolocation.clearWatch(n.current)},[]);return We.useEffect(()=>{if(i){if("geolocation"in navigator)return t("prompt"),n.current=navigator.geolocation.watchPosition(e=>{t("granted"),r({lat:e.coords.latitude,lng:e.coords.longitude,acc:e.coords.accuracy})},e=>{t(e.code===e.PERMISSION_DENIED?"denied":"error")},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4}),()=>{null!=n.current&&navigator.geolocation.clearWatch(n.current)};t("error")}},[i]),{status:e,enabled:i,position:s,enable:o,disable:l}}const fk=()=>{const[,e]=Ai();$l();const[t,i]=We.useState(!1),[a,s]=We.useState("Verifica...");pk();const r="undefined";We.useEffect(()=>{n(),o()},[]);const n=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(()=>i(!0),()=>i(!1))},o=async()=>{try{const{data:{session:e}}=await ba.auth.getSession();s(e?"Attiva":"Non attiva")}catch(e){s("Errore")}},l=[{id:"agent-profile",label:"Profilo Agente",description:"Avatar, nome e informazioni agente",icon:Lr},{id:"security",label:"Sicurezza",description:"Password e codici di emergenza",icon:vr},{id:"mission",label:"Missione",description:"Stato missioni e progressi",icon:kr},{id:"notifications",label:"Notifiche",description:"Preferenze e alert",icon:Xa},{id:"privacy",label:"Privacy",description:"Gestione consensi e cookie",icon:Zs},{id:"legal",label:"Legale",description:"Termini, privacy e account",icon:Ps},{id:"app-info",label:"Info App",description:"Versione, supporto e credits",icon:Us}];return se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background via-background/95 to-background/90",children:[se.jsx(ad,{}),se.jsx("main",{className:"pt-16 pb-20 px-4",children:se.jsxs("div",{className:"max-w-lg mx-auto space-y-6",children:[se.jsxs("div",{className:"text-center space-y-2 mb-8",children:[se.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4",children:se.jsx(Lr,{className:"h-8 w-8 text-primary"})}),se.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Impostazioni"}),se.jsx("p",{className:"text-muted-foreground text-lg",children:"Configura la tua esperienza M1SSION"})]}),se.jsx("div",{className:"space-y-3",children:l.map(t=>se.jsx(Wl,{className:"glass-card cursor-pointer transition-all duration-300 hover:scale-[1.02] hover:shadow-lg border-0 bg-card/50 backdrop-blur-md",onClick:()=>{return i=t.id,void e(`/settings/${i}`);var i},children:se.jsx(Gl,{className:"p-4",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center space-x-4",children:[se.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10",children:se.jsx(t.icon,{className:"h-6 w-6 text-primary"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-foreground text-lg",children:t.label}),se.jsx("p",{className:"text-sm text-muted-foreground/80",children:t.description})]})]}),se.jsx(cs,{className:"h-5 w-5 text-muted-foreground transition-transform duration-200 group-hover:translate-x-1"})]})})},t.id))}),se.jsx("div",{className:"space-y-4 mt-8",children:se.jsxs(Wl,{className:"glass-card border-0 bg-card/40 backdrop-blur-md",children:[se.jsx(Hl,{className:"pb-3",children:se.jsx(Zl,{className:"text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:"Privacy & Permessi"})}),se.jsx(Gl,{className:"space-y-4",children:se.jsxs("div",{className:"glass-card p-4 border-0 bg-background/20",children:[se.jsxs("div",{className:"flex items-center justify-between mb-3",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx("div",{className:"p-2 rounded-lg bg-blue-500/20",children:se.jsx(Ys,{className:"h-5 w-5 text-blue-400"})}),se.jsx("span",{className:"font-medium text-foreground",children:"Geolocalizzazione"})]}),se.jsx(fc,{variant:t?"default":"secondary",className:t?"bg-green-500/20 text-green-400 border-green-500/30":"",children:t?"Attiva":"Disattiva"})]}),se.jsx("p",{className:"text-sm text-muted-foreground/80 mb-3",children:"Permetti l'accesso alla posizione per le funzionalit di missione"}),se.jsx(mo,{variant:"outline",size:"sm",onClick:n,className:"w-full bg-background/50 border-primary/30 hover:bg-primary/10",children:"Verifica Permessi"})]})})]})}),se.jsx("div",{className:"space-y-4",children:se.jsxs(Wl,{className:"glass-card border-0 bg-card/40 backdrop-blur-md",children:[se.jsx(Hl,{className:"pb-3",children:se.jsx(Zl,{className:"text-xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent",children:"Diagnostica"})}),se.jsx(Gl,{children:se.jsxs("div",{className:"glass-card p-4 border-0 bg-background/20 space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx("div",{className:"p-2 rounded-lg bg-green-500/20",children:se.jsx(Sr,{className:"h-5 w-5 text-green-400"})}),se.jsx("span",{className:"font-medium text-foreground",children:"Info Supabase"})]}),se.jsxs(fc,{variant:"outline",className:"border-green-500/30 text-green-400",children:["ID: ",r.slice(0,8),"..."]})]}),se.jsxs("div",{className:"space-y-3",children:[se.jsxs("div",{className:"flex justify-between items-center",children:[se.jsx("span",{className:"text-sm text-muted-foreground/80",children:"Stato Sessione:"}),se.jsx(fc,{variant:"Attiva"===a?"default":"destructive",className:"Attiva"===a?"bg-green-500/20 text-green-400 border-green-500/30":"",children:a})]}),se.jsx(mo,{variant:"outline",size:"sm",onClick:o,className:"w-full bg-background/50 border-green-500/30 hover:bg-green-500/10",children:"Verifica Sessione"})]})]})})]})})]})}),se.jsx(sd,{})]})},gk=()=>{const{user:e}=sn(),[t,i]=We.useState(null),[a,s]=We.useState(0),[r,n]=We.useState(0),[o,l]=We.useState(!0);if(We.useEffect(()=>{if(!e?.id)return;const t=async()=>{try{const{data:t,error:a}=await ba.from("weekly_leaderboard").select("*").order("total_xp",{ascending:!1});if(a)throw a;if(t){const a=t.findIndex(t=>t.user_id===e.id);-1!==a&&(i(a+1),n(t[a].total_xp||0)),s(t.length)}}catch(t){console.error("Error fetching rank:",t)}finally{l(!1)}};t();const a=ba.channel("weekly_leaderboard_rank").on("postgres_changes",{event:"*",schema:"public",table:"weekly_leaderboard"},()=>{t()}).subscribe();return()=>{ba.removeChannel(a)}},[e?.id]),o||null===t)return null;const c=t<=3,d=1===t?"text-yellow-400":2===t?"text-gray-300":3===t?"text-orange-400":"text-cyan-400",u=c?"from-yellow-900/40 via-orange-900/40 to-purple-900/40":"from-cyan-900/40 to-purple-900/40";return se.jsx(Wl,{className:`glass-card bg-gradient-to-r ${u} border-2 ${c?"border-yellow-500/50":"border-cyan-500/30"}`,children:se.jsxs(Gl,{className:"p-4",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx(et.div,{animate:c?{scale:[1,1.05,1]}:{},transition:c?{duration:.4,ease:"easeOut"}:{},className:`p-3 ${c?"bg-yellow-500/20":"bg-cyan-500/20"} rounded-full`,children:c?se.jsx(Ir,{className:`w-8 h-8 ${d}`}):se.jsx(Ga,{className:`w-8 h-8 ${d}`})}),se.jsxs("div",{children:[se.jsx("p",{className:"text-sm text-gray-400",children:"Posizione Classifica"}),se.jsxs("p",{className:`text-3xl font-bold ${d}`,children:["#",t]})]})]}),se.jsxs("div",{className:"text-right",children:[se.jsx("p",{className:"text-sm text-gray-400",children:"XP Settimanale"}),se.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[se.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:r.toLocaleString()}),se.jsx(zr,{className:"w-5 h-5 text-cyan-400"})]}),se.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["su ",a," agenti"]})]})]}),c&&se.jsx(et.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-3 p-2 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-center",children:se.jsx("p",{className:"text-xs text-yellow-300 font-semibold",children:" Sei sul podio questa settimana! Continua cos!"})})]})})},xk={trophy:Ir,star:jr,zap:Wr,target:kr,flame:Ts,award:Ga},bk=()=>{const{user:e}=sn(),[t,i]=We.useState([]),[a,s]=We.useState(!0);We.useEffect(()=>{if(!e?.id)return;const t=async()=>{try{const{data:t,error:a}=await ba.from("badges").select("*");if(a)throw a;const{data:s,error:r}=await ba.from("user_badges").select("*").eq("user_id",e.id);if(r)throw r;const n=new Set(s?.map(e=>e.badge_id)||[]),o=(t||[]).map(e=>({id:e.badge_id,name:e.name,description:e.description||"",icon:e.icon||"award",unlocked:n.has(e.badge_id),unlocked_at:s?.find(t=>t.badge_id===e.badge_id)?.created_at}));i(o)}catch(t){console.error("Error fetching badges:",t)}finally{s(!1)}};t();const a=ba.channel("user_badges_changes").on("postgres_changes",{event:"*",schema:"public",table:"user_badges",filter:`user_id=eq.${e.id}`},()=>{t()}).subscribe();return()=>{ba.removeChannel(a)}},[e?.id]);const r=t.filter(e=>e.unlocked).length,n=t.length;return a?se.jsxs(Wl,{className:"glass-card",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"gradient-text",children:" Galleria Badge"})}),se.jsx(Gl,{children:se.jsx("p",{className:"text-gray-400 text-center py-4",children:"Caricamento..."})})]}):se.jsxs(Wl,{className:"glass-card",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"gradient-text flex items-center justify-between",children:[se.jsx("span",{children:" Galleria Badge"}),se.jsxs("span",{className:"text-sm font-normal text-gray-400",children:[r,"/",n]})]})}),se.jsxs(Gl,{children:[se.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:t.map((e,t)=>{const i=xk[e.icon]||Ga;return se.jsxs(et.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.02*t,duration:.12},className:`\n                  relative p-4 rounded-lg border transition-all duration-300\n                  ${e.unlocked?"bg-gradient-to-br from-cyan-900/40 to-purple-900/40 border-cyan-500/50 hover:border-cyan-400 hover:shadow-lg hover:shadow-cyan-500/20":"bg-gray-900/40 border-gray-700/50 opacity-50"}\n                `,children:[!e.unlocked&&se.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 rounded-lg backdrop-blur-sm",children:se.jsx(Zs,{className:"w-8 h-8 text-gray-500"})}),se.jsx("div",{className:"flex justify-center mb-2 "+(e.unlocked?"text-yellow-400":"text-gray-600"),children:se.jsx(i,{className:"w-8 h-8"})}),se.jsx("p",{className:"text-xs font-semibold text-center mb-1 "+(e.unlocked?"text-white":"text-gray-500"),children:e.name}),se.jsx("p",{className:"text-[10px] text-center text-gray-400 line-clamp-2",children:e.description}),e.unlocked&&e.unlocked_at&&se.jsx("p",{className:"text-[9px] text-center text-cyan-500 mt-1",children:new Date(e.unlocked_at).toLocaleDateString("it-IT")})]},e.id)})}),0===t.length&&se.jsx("p",{className:"text-gray-400 text-center py-8",children:"Nessun badge disponibile al momento"})]})]})},vk=()=>{const{user:e}=sn(),[t,i]=We.useState([]),[a,s]=We.useState(!0);return We.useEffect(()=>{if(!e?.id)return;const t=async()=>{try{const t=[],{data:a,error:s}=await ba.from("user_badges").select("id, badge_id, user_id, created_at, source").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(10);if(!s&&a)for(const e of a){const{data:i}=await ba.from("badges").select("name, description").eq("badge_id",e.badge_id).single();t.push({id:e.id,type:"badge",title:"Badge Sbloccato!",description:i?.name||"Nuovo badge",created_at:e.created_at,icon:se.jsx(Ir,{className:"w-4 h-4 text-purple-400"})})}t.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),i(t.slice(0,15))}catch(t){console.error("Error fetching achievements:",t)}finally{s(!1)}};t();const a=ba.channel("user_badges_timeline").on("postgres_changes",{event:"INSERT",schema:"public",table:"user_badges",filter:`user_id=eq.${e.id}`},()=>{t()}).subscribe();return()=>{ba.removeChannel(a)}},[e?.id]),a?se.jsxs(Wl,{className:"glass-card",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"gradient-text",children:" Timeline Progressi"})}),se.jsx(Gl,{children:se.jsx("p",{className:"text-gray-400 text-center py-4",children:"Caricamento..."})})]}):se.jsxs(Wl,{className:"glass-card",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"gradient-text flex items-center gap-2",children:[se.jsx(zr,{className:"w-5 h-5"}),"Timeline Progressi"]})}),se.jsx(Gl,{children:se.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-cyan-500/20 scrollbar-track-transparent",children:[t.map((e,t)=>se.jsxs(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.02*t,duration:.12},className:"flex items-start gap-3 p-3 rounded-lg bg-gradient-to-r from-gray-900/40 to-gray-800/40 border border-gray-700/30 hover:border-cyan-500/30 transition-all",children:[se.jsx("div",{className:"flex-shrink-0 p-2 bg-gray-800/50 rounded-full",children:e.icon}),se.jsxs("div",{className:"flex-1 min-w-0",children:[se.jsx("p",{className:"text-sm font-semibold text-white",children:e.title}),se.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:e.description}),se.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[se.jsx(as,{className:"w-3 h-3 text-gray-500"}),se.jsx("p",{className:"text-[10px] text-gray-500",children:cy(new Date(e.created_at),"dd MMM yyyy, HH:mm",{locale:by})})]})]}),e.xp_amount&&se.jsx("div",{className:"flex-shrink-0 px-2 py-1 bg-yellow-500/20 border border-yellow-500/30 rounded-md",children:se.jsxs("p",{className:"text-xs font-bold text-yellow-400",children:["+",e.xp_amount]})})]},e.id)),0===t.length&&se.jsx("p",{className:"text-gray-400 text-center py-8",children:"Nessun achievement ancora. Inizia a giocare!"})]})})]})};function yk(){const{user:e}=sn(),[t,i]=We.useState([]),[a,s]=We.useState(null),[r,n]=We.useState(!0),[o,l]=We.useState("");We.useEffect(()=>{c();const e=setInterval(d,1e3);return()=>clearInterval(e)},[]);const c=async()=>{try{const t=function(e){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),i=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-i);const a=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t.getTime()-a.getTime())/864e5+1)/7)}(new Date),a=(new Date).getFullYear(),{data:r,error:n}=await ba.from("weekly_leaderboard").select("user_id, total_xp, rank").eq("week_number",t).eq("year",a).order("rank",{ascending:!0}).limit(10);if(n)throw n;const o=await Promise.all((r||[]).map(async e=>{const{data:t}=await ba.from("profiles").select("agent_code, avatar_url").eq("id",e.user_id).single();return{...e,agent_code:t?.agent_code||"AG-????",avatar_url:t?.avatar_url}}));if(i(o),e){const{data:i}=await ba.from("weekly_leaderboard").select("rank").eq("user_id",e.id).eq("week_number",t).eq("year",a).single();i&&s(i.rank)}}catch(t){console.error("Error loading leaderboard:",t)}finally{n(!1)}},d=()=>{const e=new Date,t=new Date(e);t.setDate(e.getDate()+(8-e.getDay())%7),t.setHours(0,0,0,0);const i=t.getTime()-e.getTime(),a=Math.floor(i/864e5),s=Math.floor(i%864e5/36e5),r=Math.floor(i%36e5/6e4);l(`${a}g ${s}h ${r}m`)},u=e=>{switch(e){case 1:return se.jsx(Ir,{className:"h-6 w-6 text-yellow-500"});case 2:return se.jsx(Xs,{className:"h-6 w-6 text-gray-400"});case 3:return se.jsx(Ga,{className:"h-6 w-6 text-amber-700"});default:return se.jsxs("span",{className:"text-muted-foreground font-bold",children:["#",e]})}};return r?se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Classifica Settimanale"})}),se.jsx(Gl,{children:se.jsx("p",{className:"text-muted-foreground",children:"Caricamento..."})})]}):se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx(Zl,{children:" Classifica Settimanale"}),se.jsxs("div",{className:"text-sm text-muted-foreground",children:["Reset tra: ",se.jsx("span",{className:"font-bold text-primary",children:o})]})]})}),se.jsx(Gl,{children:se.jsxs("div",{className:"space-y-2",children:[t.map((t,i)=>se.jsx(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.02*i,duration:.15},className:`flex items-center justify-between p-3 rounded-lg ${t.rank<=3?"bg-primary/10":"bg-secondary/50"} ${t.user_id===e?.id?"ring-2 ring-primary":""}`,children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-8 flex justify-center",children:u(t.rank)}),se.jsxs("div",{children:[se.jsx("p",{className:"font-semibold",children:t.agent_code||"Agente Segreto"}),se.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.total_xp.toLocaleString()," XP"]})]})]})},t.user_id)),a&&a>10&&se.jsx("div",{className:"mt-4 pt-4 border-t",children:se.jsx(et.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-between p-3 rounded-lg bg-accent ring-2 ring-primary",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-8 flex justify-center",children:se.jsxs("span",{className:"text-muted-foreground font-bold",children:["#",a]})}),se.jsxs("div",{children:[se.jsx("p",{className:"font-semibold",children:"La tua posizione"}),se.jsx("p",{className:"text-xs text-muted-foreground",children:"Continua a guadagnare XP!"})]})]})})})]})})]})}function wk({badgeName:e,badgeDescription:t,badgeIcon:i,onClose:a,onClick:s}){return We.useEffect(()=>{const e=setTimeout(a,2e3);return()=>clearTimeout(e)},[a]),se.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[9999] pointer-events-auto",role:"button",tabIndex:0,onClick:()=>{s?.(),a()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(s?.(),a())},"aria-label":"Apri premio sbloccato",children:se.jsxs("div",{className:"relative bg-gradient-to-br from-primary/20 via-background to-accent/20 p-8 rounded-2xl shadow-2xl border-2 border-primary/50 backdrop-blur-md",children:[se.jsx("div",{className:"absolute inset-0 bg-primary/20 blur-xl rounded-2xl"}),se.jsxs("div",{className:"relative flex flex-col items-center text-center gap-4",children:[se.jsx("div",{className:"bg-primary/20 p-6 rounded-full",children:i?se.jsx("span",{className:"text-6xl",children:i}):se.jsx(Ga,{className:"h-16 w-16 text-primary"})}),se.jsxs("div",{className:"space-y-2",children:[se.jsx("h2",{className:"text-2xl font-bold text-primary",children:" BADGE SBLOCCATO!"}),se.jsx("p",{className:"text-xl font-semibold",children:e}),se.jsx("p",{className:"text-sm text-muted-foreground max-w-xs",children:t})]})]})]})})}const Nk=()=>{const[,e]=Ai(),{xpStatus:t}=rn(),{user:i}=sn();return 0===t.free_buzz_credit&&0===t.free_buzz_map_credit?null:se.jsxs(Wl,{className:"glass-card border-2 border-yellow-500/50 shadow-xl shadow-yellow-500/20",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"gradient-text flex items-center gap-2",children:[se.jsx(Ms,{className:"w-6 h-6 text-yellow-400"})," BADGE SBLOCCATI!"]})}),se.jsxs(Gl,{className:"space-y-3",children:[t.free_buzz_credit>0&&se.jsx(et.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:async()=>{if(i?.id)try{const{data:t}=await ba.from("user_badges").select("*").eq("user_id",i.id).eq("source","xp_reward_buzz").single();if(!t){let{data:e}=await ba.from("badges").select("*").eq("name","BUZZ Gratuito").single();if(!e){const{data:t}=await ba.from("badges").insert({name:"BUZZ Gratuito",description:"Hai guadagnato un BUZZ gratuito con gli XP!",icon:"zap"}).select().single();e=t}e&&await ba.from("user_badges").insert({user_id:i.id,badge_id:e.badge_id,source:"xp_reward_buzz"})}e("/buzz?free=1&reward=1")}catch(t){console.error("Error handling buzz reward:",t),Ki.error("Errore nel riscattare il premio")}},className:"w-full p-4 bg-gradient-to-r from-purple-900/60 to-purple-700/60 rounded-xl border-2 border-purple-500/50 hover:border-purple-400 transition-all duration-200 cursor-pointer",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"p-3 bg-purple-600/70 rounded-full",children:se.jsx(Wr,{className:"w-6 h-6 text-yellow-300"})}),se.jsxs("div",{className:"text-left",children:[se.jsx("p",{className:"font-bold text-lg text-white",children:"BUZZ Gratuito Sbloccato!"}),se.jsxs("p",{className:"text-sm text-purple-200",children:["Hai guadagnato un BUZZ gratuito (",t.free_buzz_credit," disponibili)"]})]})]}),se.jsx("div",{className:"text-3xl",children:""})]})}),t.free_buzz_map_credit>0&&se.jsx(et.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:async()=>{if(i?.id)try{const{data:t}=await ba.from("user_badges").select("*").eq("user_id",i.id).eq("source","xp_reward_buzz_map").single();if(!t){let{data:e}=await ba.from("badges").select("*").eq("name","BUZZ MAPPA Gratuito").single();if(!e){const{data:t}=await ba.from("badges").insert({name:"BUZZ MAPPA Gratuito",description:"Hai guadagnato un BUZZ MAPPA gratuito con gli XP!",icon:"target"}).select().single();e=t}e&&await ba.from("user_badges").insert({user_id:i.id,badge_id:e.badge_id,source:"xp_reward_buzz_map"})}e("/map?free=1&reward=1")}catch(t){console.error("Error handling buzz map reward:",t),Ki.error("Errore nel riscattare il premio")}},className:"w-full p-4 bg-gradient-to-r from-cyan-900/60 to-cyan-700/60 rounded-xl border-2 border-cyan-500/50 hover:border-cyan-400 transition-all duration-200 cursor-pointer",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"p-3 bg-cyan-600/70 rounded-full",children:se.jsx(Ys,{className:"w-6 h-6 text-yellow-300"})}),se.jsxs("div",{className:"text-left",children:[se.jsx("p",{className:"font-bold text-lg text-white",children:"BUZZ MAPPA Gratuito Sbloccato!"}),se.jsxs("p",{className:"text-sm text-cyan-200",children:["Hai guadagnato un BUZZ MAPPA gratuito (",t.free_buzz_map_credit," disponibili)"]})]})]}),se.jsx("div",{className:"text-3xl",children:""})]})})]})]})},jk=()=>{const{user:e}=$l(),{toast:t}=mc(),{profileData:i}=JS(),{navigate:a}=yl(),{profileImage:s}=Qc(),[r,n]=We.useState(""),[o,l]=We.useState(!1),{newBadge:c,closeBadgeNotification:d,xpStatus:u}=rn();Jc(),XS(),We.useEffect(()=>{(i?.name||i?.personalInfo?.firstName)&&n(i?.name||i?.personalInfo?.firstName||"")},[i]),We.useEffect(()=>{const e=e=>{const{agentName:t}=e.detail;t&&n(t)};return window.addEventListener("profile-sync",e),()=>window.removeEventListener("profile-sync",e)},[]);return se.jsxs("div",{className:"min-h-screen",children:[se.jsx(ad,{profileImage:s||e?.user_metadata?.avatar_url}),se.jsx("div",{className:"px-4 space-y-6",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"space-y-6",children:[se.jsxs("div",{className:"text-center space-y-2 mb-6",children:[se.jsx("h1",{className:"text-2xl font-bold text-white font-orbitron",children:"Profilo Agente"}),se.jsx("p",{className:"text-white/70",children:"Gestisci le informazioni del tuo profilo agente"})]}),se.jsxs("div",{className:"space-y-4 mb-6",children:[se.jsx("h2",{className:"text-xl sm:text-2xl font-bold gradient-text",children:" Dashboard Progressi"}),se.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[se.jsxs(Wl,{className:"glass-card",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-lg font-semibold gradient-text",children:" Livello & XP"})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsx(Tc,{totalXp:u.total_xp}),se.jsxs("div",{className:"pt-4 border-t border-white/10",children:[se.jsx("h3",{className:"text-sm font-semibold text-white mb-2",children:" Check-In Giornaliero"}),se.jsx(Mc,{})]})]})]}),se.jsx(gk,{})]}),se.jsxs("div",{className:"space-y-4",children:[se.jsx(Nk,{}),se.jsx(bk,{}),se.jsx(vk,{}),se.jsx(yk,{})]})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center",children:[se.jsx(Lr,{className:"w-5 h-5 mr-2"}),"Informazioni Profilo"]})}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[se.jsxs(cc,{className:"w-24 h-24 border-2 border-gray-600",children:[se.jsx(dc,{src:s||e?.user_metadata?.avatar_url,alt:"Avatar agente"}),se.jsx(uc,{className:"bg-gray-700 text-white text-xl font-bold",children:r?.charAt(0)?.toUpperCase()||e?.email?.charAt(0)?.toUpperCase()||"A"})]}),se.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[se.jsx("label",{htmlFor:"avatar-upload",className:"cursor-pointer",children:se.jsx(mo,{variant:"outline",className:"border-gray-600 text-white hover:bg-gray-700",asChild:!0,children:se.jsxs("span",{children:[se.jsx(Pr,{className:"w-4 h-4 mr-2"}),"Cambia Avatar"]})})}),se.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",className:"hidden",onChange:async i=>{const a=i.target.files?.[0];if(a&&e)if(a.type.startsWith("image/"))if(a.size>5242880)t({title:"Errore",description:"L'immagine deve essere pi piccola di 5MB.",variant:"destructive"});else{l(!0);try{const i=a.name.split(".").pop(),s=`${e.id}_${Date.now()}.${i}`,{data:r,error:n}=await ba.storage.from("avatars").upload(s,a,{upsert:!0});if(n)throw n;const{data:o}=ba.storage.from("avatars").getPublicUrl(s),{error:l}=await ba.from("profiles").update({avatar_url:o.publicUrl}).eq("id",e.id);if(l)throw l;t({title:" Avatar aggiornato",description:"La tua immagine profilo  stata aggiornata con successo."})}catch(s){console.error("Avatar upload error:",s),t({title:" Errore upload",description:s.message||"Impossibile caricare l'immagine. Riprova.",variant:"destructive"})}finally{l(!1)}}else t({title:"Errore",description:"Per favore seleziona un file immagine valido.",variant:"destructive"})},disabled:o})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs(jl,{htmlFor:"agentName",className:"text-white flex items-center",children:[se.jsx(Lr,{className:"w-4 h-4 mr-2"}),"Nome Agente"]}),se.jsx(Sl,{id:"agentName",type:"text",value:r,onChange:e=>n(e.target.value),className:"bg-gray-800 border-gray-600 text-white",placeholder:"Inserisci il tuo nome agente"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs(jl,{className:"text-white flex items-center",children:[se.jsx(Gs,{className:"w-4 h-4 mr-2"}),"Email"]}),se.jsx(Sl,{type:"email",value:e?.email||"",readOnly:!0,className:"bg-black/20 border-white/20 text-white/70 cursor-not-allowed"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs(jl,{className:"text-white flex items-center",children:[se.jsx(Ds,{className:"w-4 h-4 mr-2"}),"User ID"]}),se.jsxs("div",{className:"flex space-x-2",children:[se.jsx(Sl,{type:"text",value:e?.id||"",readOnly:!0,className:"bg-black/20 border-white/20 text-white/70 cursor-not-allowed flex-1"}),se.jsx(mo,{onClick:()=>{e?.id&&(navigator.clipboard.writeText(e.id),t({title:" ID copiato",description:"L'ID utente  stato copiato negli appunti."}))},variant:"outline",size:"icon",className:"border-white/20 text-white hover:bg-white/10",children:se.jsx(ys,{className:"w-4 h-4"})})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{className:"text-white",children:"Tier Attivo"}),se.jsx("div",{className:"flex items-center",children:(e=>{const t={starter:{bg:"bg-gray-500/20 border-gray-500/30",text:"text-gray-300",label:"Starter"},premium:{bg:"bg-yellow-500/20 border-yellow-500/30",text:"text-yellow-300",label:"Premium"},enterprise:{bg:"bg-purple-500/20 border-purple-500/30",text:"text-purple-300",label:"Enterprise"}},i=t[e]||t.starter;return se.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${i.bg} ${i.text}`,children:i.label})})("starter")})]}),se.jsx(mo,{onClick:async()=>{if(e)if(r.trim()){l(!0);try{const{error:i}=await ba.from("profiles").update({first_name:r.trim()}).eq("id",e.id);if(i)throw i;const a=new CustomEvent("profile-update",{detail:{agentName:r.trim()}});window.dispatchEvent(a);const s=JSON.parse(localStorage.getItem("userProfile")||"{}");s.first_name=r.trim(),localStorage.setItem("userProfile",JSON.stringify(s));const n=new CustomEvent("profile-sync",{detail:{agentName:r.trim()}});window.dispatchEvent(n),t({title:" Profilo aggiornato",description:"I tuoi dati sono stati salvati con successo."})}catch(i){console.error("Profile save error:",i),t({title:" Errore salvataggio",description:i.message||"Impossibile salvare il profilo. Riprova.",variant:"destructive"})}finally{l(!1)}}else t({title:" Nome obbligatorio",description:"Inserisci un nome agente per salvare.",variant:"destructive"})},disabled:o,className:"w-full bg-[#00D1FF] hover:bg-[#00B8E6] text-black font-semibold",children:o?"Salvataggio...":"Salva Modifiche"})]})]})]})}),c&&se.jsx(wk,{badgeName:c.name,badgeDescription:c.description,onClose:d,onClick:()=>{(c.name||"").toLowerCase().includes("mappa")?a("/map?free=1&reward=1"):a("/buzz?free=1&reward=1")}}),se.jsx("div",{id:"settings-bottom-nav-container",style:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1e4,isolation:"isolate",transform:"translateZ(0)",willChange:"transform",display:"block",visibility:"visible",opacity:1},children:se.jsx(sd,{})})]})};var Sk="AlertDialog",[_k]=re(Sk,[pe]),kk=pe(),Ck=e=>{const{__scopeAlertDialog:t,...i}=e,a=kk(t);return se.jsx(je,{...a,...i,modal:!0})};Ck.displayName=Sk;var Ak=We.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...a}=e,s=kk(i);return se.jsx(Se,{...s,...a,ref:t})});Ak.displayName="AlertDialogTrigger";var zk=e=>{const{__scopeAlertDialog:t,...i}=e,a=kk(t);return se.jsx(ge,{...a,...i})};zk.displayName="AlertDialogPortal";var Ek=We.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...a}=e,s=kk(i);return se.jsx(fe,{...s,...a,ref:t})});Ek.displayName="AlertDialogOverlay";var Ik="AlertDialogContent",[Pk,Tk]=_k(Ik),Mk=ve("AlertDialogContent"),Lk=We.forwardRef((e,t)=>{const{__scopeAlertDialog:i,children:a,...s}=e,r=kk(i),n=We.useRef(null),o=ue(t,n),l=We.useRef(null);return se.jsx(xe,{contentName:Ik,titleName:Fk,docsSlug:"alert-dialog",children:se.jsx(Pk,{scope:i,cancelRef:l,children:se.jsxs(be,{role:"alertdialog",...r,...s,ref:o,onOpenAutoFocus:he(s.onOpenAutoFocus,e=>{e.preventDefault(),l.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[se.jsx(Mk,{children:a}),se.jsx($k,{contentRef:n})]})})})});Lk.displayName=Ik;var Fk="AlertDialogTitle",Ok=We.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...a}=e,s=kk(i);return se.jsx(ye,{...s,...a,ref:t})});Ok.displayName=Fk;var Dk="AlertDialogDescription",Rk=We.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...a}=e,s=kk(i);return se.jsx(we,{...s,...a,ref:t})});Rk.displayName=Dk;var Bk=We.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...a}=e,s=kk(i);return se.jsx(Ne,{...s,...a,ref:t})});Bk.displayName="AlertDialogAction";var Uk="AlertDialogCancel",qk=We.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...a}=e,{cancelRef:s}=Tk(Uk,i),r=kk(i),n=ue(t,s);return se.jsx(Ne,{...r,...a,ref:n})});qk.displayName=Uk;var $k=({contentRef:e})=>{const t=`\`${Ik}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${Ik}\` by passing a \`${Dk}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ik}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return We.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},Wk=Ek,Hk=Lk,Zk=Bk,Vk=qk,Gk=Ok,Yk=Rk;const Kk=Ck,Xk=Ak,Jk=zk,Qk=We.forwardRef(({className:e,...t},i)=>se.jsx(Wk,{className:eo("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:i}));Qk.displayName=Wk.displayName;const eC=We.forwardRef(({className:e,...t},i)=>se.jsxs(Jk,{children:[se.jsx(Qk,{}),se.jsx(Hk,{ref:i,className:eo("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));eC.displayName=Hk.displayName;const tC=({className:e,...t})=>se.jsx("div",{className:eo("flex flex-col space-y-2 text-center sm:text-left",e),...t});tC.displayName="AlertDialogHeader";const iC=({className:e,...t})=>se.jsx("div",{className:eo("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});iC.displayName="AlertDialogFooter";const aC=We.forwardRef(({className:e,...t},i)=>se.jsx(Gk,{ref:i,className:eo("text-lg font-semibold",e),...t}));aC.displayName=Gk.displayName;const sC=We.forwardRef(({className:e,...t},i)=>se.jsx(Yk,{ref:i,className:eo("text-sm text-muted-foreground",e),...t}));sC.displayName=Yk.displayName;const rC=We.forwardRef(({className:e,...t},i)=>se.jsx(Zk,{ref:i,className:eo(ho(),e),...t}));rC.displayName=Zk.displayName;const nC=We.forwardRef(({className:e,...t},i)=>se.jsx(Vk,{ref:i,className:eo(ho({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));nC.displayName=Vk.displayName;const oC=()=>{const{user:e}=$l(),{toast:t}=mc();yl();const{profileImage:i}=Qc(),[a,s]=We.useState(!1),[r,n]=We.useState(!1),[o,l]=We.useState({current:"",new:"",confirm:""}),[c,d]=We.useState(null),u=async i=>{if(e)try{const a=btoa(i);await ba.from("profiles").update({recovery_key:a}).eq("id",e.id),t({title:" Codice di emergenza generato",description:"Salva questo codice in un luogo sicuro. Non potr essere visualizzato nuovamente."})}catch(a){console.error("Recovery key save error:",a)}};return se.jsxs("div",{className:"min-h-screen",children:[se.jsx(ad,{profileImage:i||e?.user_metadata?.avatar_url}),se.jsx("div",{className:"px-4 space-y-6",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"space-y-6",children:[se.jsxs("div",{className:"text-center space-y-2 mb-6",children:[se.jsx("h1",{className:"text-2xl font-bold text-white font-orbitron",children:"Sicurezza"}),se.jsx("p",{className:"text-white/70",children:"Gestisci la sicurezza del tuo account"})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center",children:[se.jsx(vr,{className:"w-5 h-5 mr-2"}),"Cambio Password"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"currentPassword",className:"text-white",children:"Password Attuale"}),se.jsxs("div",{className:"relative",children:[se.jsx(Sl,{id:"currentPassword",type:r?"text":"password",value:o.current,onChange:e=>l(t=>({...t,current:e.target.value})),className:"bg-black/20 border-white/20 text-white pr-10",placeholder:"Inserisci password attuale"}),se.jsx(mo,{type:"button",variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 text-white/50 hover:text-white",onClick:()=>n(!r),children:r?se.jsx(Es,{className:"w-4 h-4"}):se.jsx(Is,{className:"w-4 h-4"})})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"newPassword",className:"text-white",children:"Nuova Password"}),se.jsx(Sl,{id:"newPassword",type:r?"text":"password",value:o.new,onChange:e=>l(t=>({...t,new:e.target.value})),className:"bg-black/20 border-white/20 text-white",placeholder:"Inserisci nuova password"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"confirmPassword",className:"text-white",children:"Conferma Password"}),se.jsx(Sl,{id:"confirmPassword",type:r?"text":"password",value:o.confirm,onChange:e=>l(t=>({...t,confirm:e.target.value})),className:"bg-black/20 border-white/20 text-white",placeholder:"Conferma nuova password"})]}),se.jsx(mo,{onClick:async()=>{if(o.current&&o.new&&o.confirm)if(o.new===o.confirm)if(o.new.length<6)t({title:" Password troppo corta",description:"La password deve contenere almeno 6 caratteri.",variant:"destructive"});else{s(!0);try{const{error:e}=await ba.auth.updateUser({password:o.new});if(e)throw e;l({current:"",new:"",confirm:""}),t({title:" Password aggiornata",description:"La tua password  stata modificata con successo."})}catch(e){console.error("Password change error:",e),t({title:" Errore cambio password",description:e.message||"Impossibile aggiornare la password. Riprova.",variant:"destructive"})}finally{s(!1)}}else t({title:" Password non corrispondenti",description:"La nuova password e la conferma devono essere identiche.",variant:"destructive"});else t({title:" Campi obbligatori",description:"Compila tutti i campi per cambiare la password.",variant:"destructive"})},disabled:a,className:"w-full bg-[#00D1FF] hover:bg-[#00B8E6] text-black font-semibold",children:a?"Aggiornamento...":"Cambia Password"})]})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center",children:[se.jsx(qs,{className:"w-5 h-5 mr-2"}),"Codice di Emergenza"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsx("p",{className:"text-white/70 text-sm",children:"Genera un codice di emergenza per recuperare l'accesso al tuo account."}),c&&se.jsxs("div",{className:"p-4 bg-red-900/20 border border-red-500/20 rounded-lg",children:[se.jsx("p",{className:"text-red-400 text-sm font-semibold mb-2",children:" IMPORTANTE: Salva questo codice ora!"}),se.jsx("code",{className:"text-white font-mono bg-black/40 p-2 rounded block text-center",children:c}),se.jsx("p",{className:"text-red-300 text-xs mt-2",children:"Questo codice non sar pi visibile dopo aver chiuso questa schermata."})]}),se.jsx(mo,{onClick:()=>{const e=Array.from({length:12},()=>Math.random().toString(36).substring(2,6)).join("-").toUpperCase();d(e),u(e)},variant:"outline",className:"w-full border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/10",children:c?"Genera Nuovo Codice":"Genera Codice di Emergenza"})]})]}),se.jsxs(Wl,{className:"bg-black/40 border-red-500/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center",children:[se.jsx(Vs,{className:"w-5 h-5 mr-2"}),"Gestione Sessioni"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsx("p",{className:"text-white/70 text-sm",children:"Disconnetti il tuo account da tutti i dispositivi e invalidare tutte le sessioni attive."}),se.jsxs(Kk,{children:[se.jsx(Xk,{asChild:!0,children:se.jsx(mo,{variant:"destructive",className:"w-full bg-red-600 hover:bg-red-700",disabled:a,children:"Disconnetti da Tutti i Dispositivi"})}),se.jsxs(eC,{className:"bg-black/90 border-red-500/20",children:[se.jsxs(tC,{children:[se.jsx(aC,{className:"text-white",children:"Conferma Disconnessione"}),se.jsx(sC,{className:"text-white/70",children:"Questa azione disconnetter il tuo account da tutti i dispositivi. Dovrai effettuare nuovamente il login ovunque."})]}),se.jsxs(iC,{children:[se.jsx(nC,{className:"bg-white/10 text-white border-white/20",children:"Annulla"}),se.jsx(rC,{onClick:async()=>{s(!0);try{const{error:e}=await ba.auth.signOut({scope:"global"});if(e)throw e;localStorage.clear(),t({title:" Disconnesso da tutti i dispositivi",description:"Tutte le sessioni sono state invalidate."}),window.location.href="/login"}catch(e){console.error("Sign out all devices error:",e),t({title:" Errore disconnessione",description:"Impossibile disconnettere tutti i dispositivi. Riprova.",variant:"destructive"})}finally{s(!1)}},className:"bg-red-600 hover:bg-red-700",children:"Conferma Disconnessione"})]})]})]})]})]})]})}),se.jsx("div",{id:"settings-bottom-nav-container",style:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1e4,isolation:"isolate",transform:"translateZ(0)",willChange:"transform",display:"block",visibility:"visible",opacity:1},children:se.jsx(sd,{})})]})},lC=()=>{yl();const{user:e}=$l(),{profileImage:t}=Qc();return se.jsxs("div",{className:"min-h-screen",children:[se.jsx(ad,{profileImage:t||e?.user_metadata?.avatar_url}),se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"px-4 space-y-6",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:[se.jsxs("div",{className:"text-center space-y-2 mb-6",children:[se.jsx("h1",{className:"text-2xl font-bold text-white font-orbitron",children:"Missione"}),se.jsx("p",{className:"text-white/70",children:"Gestisci le tue missioni e obiettivi"})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx("div",{className:"p-3 rounded-xl bg-[#00D1FF]/20",children:se.jsx(kr,{className:"h-6 w-6 text-[#00D1FF]"})}),se.jsxs("div",{children:[se.jsx(Zl,{className:"text-xl text-white font-orbitron",children:"Missione Corrente"}),se.jsx("p",{className:"text-sm text-white/70",children:"Gennaio 2025"})]})]}),se.jsx(fc,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Attiva"})]})}),se.jsx(Gl,{className:"space-y-4",children:se.jsxs("div",{className:"p-4 bg-black/20 rounded-lg border border-white/10",children:[se.jsxs("div",{className:"flex justify-between items-center mb-2",children:[se.jsx("span",{className:"text-sm text-white/70",children:"Progresso Generale"}),se.jsx("span",{className:"font-bold text-[#00D1FF]",children:"45%"})]}),se.jsx("div",{className:"w-full bg-white/10 rounded-full h-3",children:se.jsx("div",{className:"bg-gradient-to-r from-[#00D1FF] to-[#00B8E6] h-3 rounded-full transition-all duration-500",style:{width:"45%"}})})]})})]}),se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsx(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:se.jsxs(Gl,{className:"p-6 text-center",children:[se.jsx("div",{className:"p-3 rounded-xl bg-[#00D1FF]/20 w-fit mx-auto mb-3",children:se.jsx(zr,{className:"h-8 w-8 text-[#00D1FF]"})}),se.jsx("p",{className:"text-3xl font-bold text-white mb-1",children:"7"}),se.jsx("p",{className:"text-sm text-white/70",children:"Completate"})]})}),se.jsx(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:se.jsxs(Gl,{className:"p-6 text-center",children:[se.jsx("div",{className:"p-3 rounded-xl bg-yellow-500/20 w-fit mx-auto mb-3",children:se.jsx(Ga,{className:"h-8 w-8 text-yellow-400"})}),se.jsx("p",{className:"text-3xl font-bold text-white mb-1",children:"3"}),se.jsx("p",{className:"text-sm text-white/70",children:"Premi"})]})})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-xl font-bold text-white font-orbitron flex items-center",children:[se.jsx(Wr,{className:"h-5 w-5 mr-2 text-[#00D1FF]"}),"Azioni Rapide"]})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsxs(mo,{variant:"outline",className:"w-full justify-start bg-black/20 border-white/20 text-white hover:bg-white/10",children:[se.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Visualizza Mappa Missione"]}),se.jsxs(mo,{variant:"outline",className:"w-full justify-start bg-black/20 border-white/20 text-white hover:bg-white/10",children:[se.jsx(bs,{className:"h-4 w-4 mr-2"}),"Cronometro Missione"]})]})]})]}),se.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1e4},children:se.jsx(sd,{})})]})};function cC(e,[t,i]){return Math.min(i,Math.max(t,e))}var dC=[" ","Enter","ArrowUp","ArrowDown"],uC=[" ","Enter"],hC="Select",[mC,pC,fC]=ke(hC),[gC]=re(hC,[fC,_e]),xC=_e(),[bC,vC]=gC(hC),[yC,wC]=gC(hC),NC=e=>{const{__scopeSelect:t,children:i,open:a,defaultOpen:s,onOpenChange:r,value:n,defaultValue:o,onValueChange:l,dir:c,name:d,autoComplete:u,disabled:h,required:m,form:p}=e,f=xC(t),[g,x]=We.useState(null),[b,v]=We.useState(null),[y,w]=We.useState(!1),N=Oe(c),[j,S]=de({prop:a,defaultProp:s??!1,onChange:r,caller:hC}),[_,k]=de({prop:n,defaultProp:o,onChange:l,caller:hC}),C=We.useRef(null),A=!g||(p||!!g.closest("form")),[z,E]=We.useState(new Set),I=Array.from(z).map(e=>e.props.value).join(";");return se.jsx(De,{...f,children:se.jsxs(bC,{required:m,scope:t,trigger:g,onTriggerChange:x,valueNode:b,onValueNodeChange:v,valueNodeHasChildren:y,onValueNodeHasChildrenChange:w,contentId:ze(),value:_,onValueChange:k,open:j,onOpenChange:S,dir:N,triggerPointerDownPosRef:C,disabled:h,children:[se.jsx(mC.Provider,{scope:t,children:se.jsx(yC,{scope:e.__scopeSelect,onNativeOptionAdd:We.useCallback(e=>{E(t=>new Set(t).add(e))},[]),onNativeOptionRemove:We.useCallback(e=>{E(t=>{const i=new Set(t);return i.delete(e),i})},[]),children:i})}),A?se.jsxs(lA,{"aria-hidden":!0,required:m,tabIndex:-1,name:d,autoComplete:u,value:_,onChange:e=>k(e.target.value),disabled:h,form:p,children:[void 0===_?se.jsx("option",{value:""}):null,Array.from(z)]},I):null]})})};NC.displayName=hC;var jC="SelectTrigger",SC=We.forwardRef((e,t)=>{const{__scopeSelect:i,disabled:a=!1,...s}=e,r=xC(i),n=vC(jC,i),o=n.disabled||a,l=ue(t,n.onTriggerChange),c=pC(i),d=We.useRef("touch"),[u,h,m]=dA(e=>{const t=c().filter(e=>!e.disabled),i=t.find(e=>e.value===n.value),a=uA(t,e,i);void 0!==a&&n.onValueChange(a.value)}),p=e=>{o||(n.onOpenChange(!0),m()),e&&(n.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)})};return se.jsx(Ce,{asChild:!0,...r,children:se.jsx(ne.button,{type:"button",role:"combobox","aria-controls":n.contentId,"aria-expanded":n.open,"aria-required":n.required,"aria-autocomplete":"none",dir:n.dir,"data-state":n.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":cA(n.value)?"":void 0,...s,ref:l,onClick:he(s.onClick,e=>{e.currentTarget.focus(),"mouse"!==d.current&&p(e)}),onPointerDown:he(s.onPointerDown,e=>{d.current=e.pointerType;const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),0===e.button&&!1===e.ctrlKey&&"mouse"===e.pointerType&&(p(e),e.preventDefault())}),onKeyDown:he(s.onKeyDown,e=>{const t=""!==u.current;e.ctrlKey||e.altKey||e.metaKey||1!==e.key.length||h(e.key),t&&" "===e.key||dC.includes(e.key)&&(p(),e.preventDefault())})})})});SC.displayName=jC;var _C="SelectValue",kC=We.forwardRef((e,t)=>{const{__scopeSelect:i,className:a,style:s,children:r,placeholder:n="",...o}=e,l=vC(_C,i),{onValueNodeHasChildrenChange:c}=l,d=void 0!==r,u=ue(t,l.onValueNodeChange);return le(()=>{c(d)},[c,d]),se.jsx(ne.span,{...o,ref:u,style:{pointerEvents:"none"},children:cA(l.value)?se.jsx(se.Fragment,{children:n}):r})});kC.displayName=_C;var CC=We.forwardRef((e,t)=>{const{__scopeSelect:i,children:a,...s}=e;return se.jsx(ne.span,{"aria-hidden":!0,...s,ref:t,children:a||""})});CC.displayName="SelectIcon";var AC=e=>se.jsx(Ae,{asChild:!0,...e});AC.displayName="SelectPortal";var zC="SelectContent",EC=We.forwardRef((e,t)=>{const i=vC(zC,e.__scopeSelect),[a,s]=We.useState();if(le(()=>{s(new DocumentFragment)},[]),!i.open){const t=a;return t?Ye.createPortal(se.jsx(PC,{scope:e.__scopeSelect,children:se.jsx(mC.Slot,{scope:e.__scopeSelect,children:se.jsx("div",{children:e.children})})}),t):null}return se.jsx(LC,{...e,ref:t})});EC.displayName=zC;var IC=10,[PC,TC]=gC(zC),MC=Te("SelectContent.RemoveScroll"),LC=We.forwardRef((e,t)=>{const{__scopeSelect:i,position:a="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:r,onPointerDownOutside:n,side:o,sideOffset:l,align:c,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:m,sticky:p,hideWhenDetached:f,avoidCollisions:g,...x}=e,b=vC(zC,i),[v,y]=We.useState(null),[w,N]=We.useState(null),j=ue(t,e=>y(e)),[S,_]=We.useState(null),[k,C]=We.useState(null),A=pC(i),[z,E]=We.useState(!1),I=We.useRef(!1);We.useEffect(()=>{if(v)return Ee(v)},[v]),Ie();const P=We.useCallback(e=>{const[t,...i]=A().map(e=>e.ref.current),[a]=i.slice(-1),s=document.activeElement;for(const r of e){if(r===s)return;if(r?.scrollIntoView({block:"nearest"}),r===t&&w&&(w.scrollTop=0),r===a&&w&&(w.scrollTop=w.scrollHeight),r?.focus(),document.activeElement!==s)return}},[A,w]),T=We.useCallback(()=>P([S,v]),[P,S,v]);We.useEffect(()=>{z&&T()},[z,T]);const{onOpenChange:M,triggerPointerDownPosRef:L}=b;We.useEffect(()=>{if(v){let e={x:0,y:0};const t=t=>{e={x:Math.abs(Math.round(t.pageX)-(L.current?.x??0)),y:Math.abs(Math.round(t.pageY)-(L.current?.y??0))}},i=i=>{e.x<=10&&e.y<=10?i.preventDefault():v.contains(i.target)||M(!1),document.removeEventListener("pointermove",t),L.current=null};return null!==L.current&&(document.addEventListener("pointermove",t),document.addEventListener("pointerup",i,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",i,{capture:!0})}}},[v,M,L]),We.useEffect(()=>{const e=()=>M(!1);return window.addEventListener("blur",e),window.addEventListener("resize",e),()=>{window.removeEventListener("blur",e),window.removeEventListener("resize",e)}},[M]);const[F,O]=dA(e=>{const t=A().filter(e=>!e.disabled),i=t.find(e=>e.ref.current===document.activeElement),a=uA(t,e,i);a&&setTimeout(()=>a.ref.current.focus())}),D=We.useCallback((e,t,i)=>{const a=!I.current&&!i;(void 0!==b.value&&b.value===t||a)&&(_(e),a&&(I.current=!0))},[b.value]),R=We.useCallback(()=>v?.focus(),[v]),B=We.useCallback((e,t,i)=>{const a=!I.current&&!i;(void 0!==b.value&&b.value===t||a)&&C(e)},[b.value]),U="popper"===a?OC:FC,q=U===OC?{side:o,sideOffset:l,align:c,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:m,sticky:p,hideWhenDetached:f,avoidCollisions:g}:{};return se.jsx(PC,{scope:i,content:v,viewport:w,onViewportChange:N,itemRefCallback:D,selectedItem:S,onItemLeave:R,itemTextRefCallback:B,focusSelectedItem:T,selectedItemText:k,position:a,isPositioned:z,searchRef:F,children:se.jsx(Pe,{as:MC,allowPinchZoom:!0,children:se.jsx(Me,{asChild:!0,trapped:b.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:he(s,e=>{b.trigger?.focus({preventScroll:!0}),e.preventDefault()}),children:se.jsx(Le,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:r,onPointerDownOutside:n,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>b.onOpenChange(!1),children:se.jsx(U,{role:"listbox",id:b.contentId,"data-state":b.open?"open":"closed",dir:b.dir,onContextMenu:e=>e.preventDefault(),...x,...q,onPlaced:()=>E(!0),ref:j,style:{display:"flex",flexDirection:"column",outline:"none",...x.style},onKeyDown:he(x.onKeyDown,e=>{const t=e.ctrlKey||e.altKey||e.metaKey;if("Tab"===e.key&&e.preventDefault(),t||1!==e.key.length||O(e.key),["ArrowUp","ArrowDown","Home","End"].includes(e.key)){let t=A().filter(e=>!e.disabled).map(e=>e.ref.current);if(["ArrowUp","End"].includes(e.key)&&(t=t.slice().reverse()),["ArrowUp","ArrowDown"].includes(e.key)){const i=e.target,a=t.indexOf(i);t=t.slice(a+1)}setTimeout(()=>P(t)),e.preventDefault()}})})})})})})});LC.displayName="SelectContentImpl";var FC=We.forwardRef((e,t)=>{const{__scopeSelect:i,onPlaced:a,...s}=e,r=vC(zC,i),n=TC(zC,i),[o,l]=We.useState(null),[c,d]=We.useState(null),u=ue(t,e=>d(e)),h=pC(i),m=We.useRef(!1),p=We.useRef(!0),{viewport:f,selectedItem:g,selectedItemText:x,focusSelectedItem:b}=n,v=We.useCallback(()=>{if(r.trigger&&r.valueNode&&o&&c&&f&&g&&x){const e=r.trigger.getBoundingClientRect(),t=c.getBoundingClientRect(),i=r.valueNode.getBoundingClientRect(),s=x.getBoundingClientRect();if("rtl"!==r.dir){const a=s.left-t.left,r=i.left-a,n=e.left-r,l=e.width+n,c=Math.max(l,t.width),d=window.innerWidth-IC,u=cC(r,[IC,Math.max(IC,d-c)]);o.style.minWidth=l+"px",o.style.left=u+"px"}else{const a=t.right-s.right,r=window.innerWidth-i.right-a,n=window.innerWidth-e.right-r,l=e.width+n,c=Math.max(l,t.width),d=window.innerWidth-IC,u=cC(r,[IC,Math.max(IC,d-c)]);o.style.minWidth=l+"px",o.style.right=u+"px"}const n=h(),l=window.innerHeight-2*IC,d=f.scrollHeight,u=window.getComputedStyle(c),p=parseInt(u.borderTopWidth,10),b=parseInt(u.paddingTop,10),v=parseInt(u.borderBottomWidth,10),y=p+b+d+parseInt(u.paddingBottom,10)+v,w=Math.min(5*g.offsetHeight,y),N=window.getComputedStyle(f),j=parseInt(N.paddingTop,10),S=parseInt(N.paddingBottom,10),_=e.top+e.height/2-IC,k=l-_,C=g.offsetHeight/2,A=p+b+(g.offsetTop+C),z=y-A;if(A<=_){const e=n.length>0&&g===n[n.length-1].ref.current;o.style.bottom="0px";const t=c.clientHeight-f.offsetTop-f.offsetHeight,i=A+Math.max(k,C+(e?S:0)+t+v);o.style.height=i+"px"}else{const e=n.length>0&&g===n[0].ref.current;o.style.top="0px";const t=Math.max(_,p+f.offsetTop+(e?j:0)+C)+z;o.style.height=t+"px",f.scrollTop=A-_+f.offsetTop}o.style.margin=`${IC}px 0`,o.style.minHeight=w+"px",o.style.maxHeight=l+"px",a?.(),requestAnimationFrame(()=>m.current=!0)}},[h,r.trigger,r.valueNode,o,c,f,g,x,r.dir,a]);le(()=>v(),[v]);const[y,w]=We.useState();le(()=>{c&&w(window.getComputedStyle(c).zIndex)},[c]);const N=We.useCallback(e=>{e&&!0===p.current&&(v(),b?.(),p.current=!1)},[v,b]);return se.jsx(DC,{scope:i,contentWrapper:o,shouldExpandOnScrollRef:m,onScrollButtonChange:N,children:se.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:y},children:se.jsx(ne.div,{...s,ref:u,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});FC.displayName="SelectItemAlignedPosition";var OC=We.forwardRef((e,t)=>{const{__scopeSelect:i,align:a="start",collisionPadding:s=IC,...r}=e,n=xC(i);return se.jsx(Fe,{...n,...r,ref:t,align:a,collisionPadding:s,style:{boxSizing:"border-box",...r.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});OC.displayName="SelectPopperPosition";var[DC,RC]=gC(zC,{}),BC="SelectViewport",UC=We.forwardRef((e,t)=>{const{__scopeSelect:i,nonce:a,...s}=e,r=TC(BC,i),n=RC(BC,i),o=ue(t,r.onViewportChange),l=We.useRef(0);return se.jsxs(se.Fragment,{children:[se.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),se.jsx(mC.Slot,{scope:i,children:se.jsx(ne.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:he(s.onScroll,e=>{const t=e.currentTarget,{contentWrapper:i,shouldExpandOnScrollRef:a}=n;if(a?.current&&i){const e=Math.abs(l.current-t.scrollTop);if(e>0){const a=window.innerHeight-2*IC,s=parseFloat(i.style.minHeight),r=parseFloat(i.style.height),n=Math.max(s,r);if(n<a){const s=n+e,r=Math.min(a,s),o=s-r;i.style.height=r+"px","0px"===i.style.bottom&&(t.scrollTop=o>0?o:0,i.style.justifyContent="flex-end")}}}l.current=t.scrollTop})})})]})});UC.displayName=BC;var qC="SelectGroup",[$C,WC]=gC(qC);We.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e,s=ze();return se.jsx($C,{scope:i,id:s,children:se.jsx(ne.div,{role:"group","aria-labelledby":s,...a,ref:t})})}).displayName=qC;var HC="SelectLabel",ZC=We.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e,s=WC(HC,i);return se.jsx(ne.div,{id:s.id,...a,ref:t})});ZC.displayName=HC;var VC="SelectItem",[GC,YC]=gC(VC),KC=We.forwardRef((e,t)=>{const{__scopeSelect:i,value:a,disabled:s=!1,textValue:r,...n}=e,o=vC(VC,i),l=TC(VC,i),c=o.value===a,[d,u]=We.useState(r??""),[h,m]=We.useState(!1),p=ue(t,e=>l.itemRefCallback?.(e,a,s)),f=ze(),g=We.useRef("touch"),x=()=>{s||(o.onValueChange(a),o.onOpenChange(!1))};if(""===a)throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return se.jsx(GC,{scope:i,value:a,disabled:s,textId:f,isSelected:c,onItemTextChange:We.useCallback(e=>{u(t=>t||(e?.textContent??"").trim())},[]),children:se.jsx(mC.ItemSlot,{scope:i,value:a,disabled:s,textValue:d,children:se.jsx(ne.div,{role:"option","aria-labelledby":f,"data-highlighted":h?"":void 0,"aria-selected":c&&h,"data-state":c?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...n,ref:p,onFocus:he(n.onFocus,()=>m(!0)),onBlur:he(n.onBlur,()=>m(!1)),onClick:he(n.onClick,()=>{"mouse"!==g.current&&x()}),onPointerUp:he(n.onPointerUp,()=>{"mouse"===g.current&&x()}),onPointerDown:he(n.onPointerDown,e=>{g.current=e.pointerType}),onPointerMove:he(n.onPointerMove,e=>{g.current=e.pointerType,s?l.onItemLeave?.():"mouse"===g.current&&e.currentTarget.focus({preventScroll:!0})}),onPointerLeave:he(n.onPointerLeave,e=>{e.currentTarget===document.activeElement&&l.onItemLeave?.()}),onKeyDown:he(n.onKeyDown,e=>{""!==l.searchRef?.current&&" "===e.key||(uC.includes(e.key)&&x()," "===e.key&&e.preventDefault())})})})})});KC.displayName=VC;var XC="SelectItemText",JC=We.forwardRef((e,t)=>{const{__scopeSelect:i,className:a,style:s,...r}=e,n=vC(XC,i),o=TC(XC,i),l=YC(XC,i),c=wC(XC,i),[d,u]=We.useState(null),h=ue(t,e=>u(e),l.onItemTextChange,e=>o.itemTextRefCallback?.(e,l.value,l.disabled)),m=d?.textContent,p=We.useMemo(()=>se.jsx("option",{value:l.value,disabled:l.disabled,children:m},l.value),[l.disabled,l.value,m]),{onNativeOptionAdd:f,onNativeOptionRemove:g}=c;return le(()=>(f(p),()=>g(p)),[f,g,p]),se.jsxs(se.Fragment,{children:[se.jsx(ne.span,{id:l.textId,...r,ref:h}),l.isSelected&&n.valueNode&&!n.valueNodeHasChildren?Ye.createPortal(r.children,n.valueNode):null]})});JC.displayName=XC;var QC="SelectItemIndicator",eA=We.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e;return YC(QC,i).isSelected?se.jsx(ne.span,{"aria-hidden":!0,...a,ref:t}):null});eA.displayName=QC;var tA="SelectScrollUpButton",iA=We.forwardRef((e,t)=>{const i=TC(tA,e.__scopeSelect),a=RC(tA,e.__scopeSelect),[s,r]=We.useState(!1),n=ue(t,a.onScrollButtonChange);return le(()=>{if(i.viewport&&i.isPositioned){let e=function(){const e=t.scrollTop>0;r(e)};const t=i.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[i.viewport,i.isPositioned]),s?se.jsx(rA,{...e,ref:n,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=i;e&&t&&(e.scrollTop=e.scrollTop-t.offsetHeight)}}):null});iA.displayName=tA;var aA="SelectScrollDownButton",sA=We.forwardRef((e,t)=>{const i=TC(aA,e.__scopeSelect),a=RC(aA,e.__scopeSelect),[s,r]=We.useState(!1),n=ue(t,a.onScrollButtonChange);return le(()=>{if(i.viewport&&i.isPositioned){let e=function(){const e=t.scrollHeight-t.clientHeight,i=Math.ceil(t.scrollTop)<e;r(i)};const t=i.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[i.viewport,i.isPositioned]),s?se.jsx(rA,{...e,ref:n,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=i;e&&t&&(e.scrollTop=e.scrollTop+t.offsetHeight)}}):null});sA.displayName=aA;var rA=We.forwardRef((e,t)=>{const{__scopeSelect:i,onAutoScroll:a,...s}=e,r=TC("SelectScrollButton",i),n=We.useRef(null),o=pC(i),l=We.useCallback(()=>{null!==n.current&&(window.clearInterval(n.current),n.current=null)},[]);return We.useEffect(()=>()=>l(),[l]),le(()=>{const e=o().find(e=>e.ref.current===document.activeElement);e?.ref.current?.scrollIntoView({block:"nearest"})},[o]),se.jsx(ne.div,{"aria-hidden":!0,...s,ref:t,style:{flexShrink:0,...s.style},onPointerDown:he(s.onPointerDown,()=>{null===n.current&&(n.current=window.setInterval(a,50))}),onPointerMove:he(s.onPointerMove,()=>{r.onItemLeave?.(),null===n.current&&(n.current=window.setInterval(a,50))}),onPointerLeave:he(s.onPointerLeave,()=>{l()})})}),nA=We.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e;return se.jsx(ne.div,{"aria-hidden":!0,...a,ref:t})});nA.displayName="SelectSeparator";var oA="SelectArrow";We.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e,s=xC(i),r=vC(oA,i),n=TC(oA,i);return r.open&&"popper"===n.position?se.jsx(Be,{...s,...a,ref:t}):null}).displayName=oA;var lA=We.forwardRef(({__scopeSelect:e,value:t,...i},a)=>{const s=We.useRef(null),r=ue(a,s),n=Aw(t);return We.useEffect(()=>{const e=s.current;if(!e)return;const i=window.HTMLSelectElement.prototype,a=Object.getOwnPropertyDescriptor(i,"value").set;if(n!==t&&a){const i=new Event("change",{bubbles:!0});a.call(e,t),e.dispatchEvent(i)}},[n,t]),se.jsx(ne.select,{...i,style:{...Re,...i.style},ref:r,defaultValue:t})});function cA(e){return""===e||void 0===e}function dA(e){const t=oe(e),i=We.useRef(""),a=We.useRef(0),s=We.useCallback(e=>{const s=i.current+e;t(s),function e(t){i.current=t,window.clearTimeout(a.current),""!==t&&(a.current=window.setTimeout(()=>e(""),1e3))}(s)},[t]),r=We.useCallback(()=>{i.current="",window.clearTimeout(a.current)},[]);return We.useEffect(()=>()=>window.clearTimeout(a.current),[]),[i,s,r]}function uA(e,t,i){const a=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,s=i?e.indexOf(i):-1;let r=(n=e,o=Math.max(s,0),n.map((e,t)=>n[(o+t)%n.length]));var n,o;1===a.length&&(r=r.filter(e=>e!==i));const l=r.find(e=>e.textValue.toLowerCase().startsWith(a.toLowerCase()));return l!==i?l:void 0}lA.displayName="SelectBubbleInput";var hA=SC,mA=CC,pA=AC,fA=EC,gA=UC,xA=ZC,bA=KC,vA=JC,yA=eA,wA=iA,NA=sA,jA=nA;const SA=NC,_A=kC,kA=We.forwardRef(({className:e,children:t,...i},a)=>se.jsxs(hA,{ref:a,className:eo("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...i,children:[t,se.jsx(mA,{asChild:!0,children:se.jsx(ls,{className:"h-4 w-4 opacity-50"})})]}));kA.displayName=hA.displayName;const CA=We.forwardRef(({className:e,...t},i)=>se.jsx(wA,{ref:i,className:eo("flex cursor-default items-center justify-center py-1",e),...t,children:se.jsx(ds,{className:"h-4 w-4"})}));CA.displayName=wA.displayName;const AA=We.forwardRef(({className:e,...t},i)=>se.jsx(NA,{ref:i,className:eo("flex cursor-default items-center justify-center py-1",e),...t,children:se.jsx(ls,{className:"h-4 w-4"})}));AA.displayName=NA.displayName;const zA=We.forwardRef(({className:e,children:t,position:i="popper",...a},s)=>se.jsx(pA,{children:se.jsxs(fA,{ref:s,className:eo("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:i,...a,children:[se.jsx(CA,{}),se.jsx(gA,{className:eo("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),se.jsx(AA,{})]})}));zA.displayName=fA.displayName;We.forwardRef(({className:e,...t},i)=>se.jsx(xA,{ref:i,className:eo("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=xA.displayName;const EA=We.forwardRef(({className:e,children:t,...i},a)=>se.jsxs(bA,{ref:a,className:eo("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...i,children:[se.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:se.jsx(yA,{children:se.jsx(os,{className:"h-4 w-4"})})}),se.jsx(vA,{children:t})]}));EA.displayName=bA.displayName;function IA(){return{supported:"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window,permission:"Notification"in window?Notification.permission:null}}function PA(){return IA().supported}async function TA(e){const{loadPublicKey:t,toUint8:i}=await async function(){const e=await ae(()=>import("./vapid-loader.p0s-TRMN.js"),[]);return{loadPublicKey:e.loadVAPIDPublicKey,toUint8:e.urlBase64ToUint8Array}}(),a=await t(),s="string"==typeof a?i(a):a;if(!e?.pushManager)throw new Error("PushManager non disponibile");let r=await e.pushManager.getSubscription();r||(r=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:s}));const n=r.toJSON();if(!n?.endpoint||!n?.keys?.p256dh||!n?.keys?.auth)throw new Error("Subscription incompleta");return{endpoint:n.endpoint,keys:{p256dh:n.keys.p256dh,auth:n.keys.auth},vapidKey:"string"==typeof a?a:void 0}}async function MA(){if(!PA())throw new Error("Push non supportato su questo browser");return TA(await navigator.serviceWorker.ready)}async function LA(){if(!PA())return!0;const e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();return t&&await t.unsubscribe(),!0}async function FA(){if(!PA())return null;return(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function OA(){await MA()}We.forwardRef(({className:e,...t},i)=>se.jsx(jA,{ref:i,className:eo("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=jA.displayName;const DA={isPushSupported:PA,hasActiveSubscription:async function(){if(!PA())return!1;const e=await navigator.serviceWorker.ready;return!!(await e.pushManager.getSubscription())},enableWebPush:MA,disableWebPush:LA,getNotificationStatus:IA,looksLikeWebPushEndpoint:function(e){try{const t=new URL(e);return t.protocol.startsWith("http")&&(t.hostname.includes("fcm")||t.pathname.toLowerCase().includes("push")||t.pathname.toLowerCase().includes("send"))}catch{return!1}},subscribeWebPushAndSave:TA,getCurrent:FA,getStatus:async function(){const{supported:e,permission:t}=IA(),i=await FA();return{supported:e,permission:t??"default",enabled:!!i,endpoint:i?.endpoint}},enable:OA,disable:async function(){await LA()},subscribe:async function(e){const t=await navigator.serviceWorker.ready;await TA(t);const i=await t.pushManager.getSubscription();if(!i)throw new Error("Subscription failed");return i},unsubscribe:async function(){return LA()},isSupported:function(){return PA()}};function RA(){const[e,t]=We.useState({enabled:!1,loading:!1,error:null,permission:"undefined"!=typeof Notification?Notification.permission:"default",subscriptionEndpoint:null});We.useEffect(()=>{let e=!0;return(async()=>{try{const i=await DA.getStatus();if(!e)return;t(e=>({...e,enabled:!!i.enabled,permission:i.permission??e.permission,subscriptionEndpoint:i.endpoint??null,error:null}))}catch(i){if(!e)return;t(e=>({...e,error:i?.message??"Push status read failed"}))}})(),()=>{e=!1}},[]);const i=We.useCallback(async()=>{t(e=>({...e,loading:!0,error:null}));try{await DA.enable();const e=await DA.getStatus();return t(t=>({...t,loading:!1,enabled:!!e.enabled,permission:e.permission??t.permission,subscriptionEndpoint:e.endpoint??null})),!0}catch(e){return t(t=>({...t,loading:!1,error:e?.message??"Enable push failed"})),!1}},[]),a=We.useCallback(async()=>{t(e=>({...e,loading:!0,error:null}));try{await DA.disable();const e=await DA.getStatus();return t(t=>({...t,loading:!1,enabled:!!e.enabled,permission:e.permission??t.permission,subscriptionEndpoint:e.endpoint??null})),!0}catch(e){return t(t=>({...t,loading:!1,error:e?.message??"Disable push failed"})),!1}},[]),s=We.useCallback(async()=>{try{const e=await DA.getStatus();t(t=>({...t,enabled:!!e.enabled,permission:e.permission??t.permission,subscriptionEndpoint:e.endpoint??null}))}catch(e){t(t=>({...t,error:e?.message??"Refresh push status failed"}))}},[]);return{...e,enable:i,disable:a,refresh:s,isSupported:DA.isSupported(),subscription:null,webPushSubscription:e.subscriptionEndpoint,subscriptionType:"webpush",isLoading:e.loading,isSubscribed:!!e.enabled,canSubscribe:!e.enabled&&!e.loading,subscribe:i,async requestPermission(){const e=await Notification.requestPermission();return t(t=>({...t,permission:e})),"granted"===e},unsubscribe:a}}const BA=uo("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),UA=We.forwardRef(({className:e,variant:t,...i},a)=>se.jsx("div",{ref:a,role:"alert",className:eo(BA({variant:t}),e),...i}));UA.displayName="Alert";We.forwardRef(({className:e,...t},i)=>se.jsx("h5",{ref:i,className:eo("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";const qA=We.forwardRef(({className:e,...t},i)=>se.jsx("div",{ref:i,className:eo("text-sm [&_p]:leading-relaxed",e),...t}));qA.displayName="AlertDescription";const $A=({className:e})=>{const{isSupported:t,permission:i,subscription:a,subscriptionType:s,isLoading:r,error:n,isSubscribed:o,canSubscribe:l,subscribe:c,requestPermission:d,unsubscribe:u}=RA(),h=()=>s?.toUpperCase()||"Unknown";return t?se.jsxs(Wl,{className:e,children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(Xa,{className:"w-5 h-5"}),"Notifiche Push Unificate"]}),se.jsx(Vl,{children:"Sistema unificato per notifiche su tutti i dispositivi"})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:"w-2 h-2 rounded-full "+(o?"bg-success":"bg-muted-foreground")}),se.jsx("span",{className:o?"text-success":"denied"===i?"text-destructive":"text-muted-foreground",children:r?"Configurazione in corso...":o?`Attivo (${h()})`:"denied"===i?"Permessi negati":"default"===i?"Permessi richiesti":"Non attivo"})]}),a]}),o&&se.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg space-y-2",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(hs,{className:"w-4 h-4 text-success"}),se.jsx("span",{className:"text-sm font-medium",children:"Connesso"})]}),se.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[se.jsxs("div",{children:["Tipo: ",h()]}),se.jsxs("div",{children:["Piattaforma: ","Desktop"]}),a]})]}),n&&se.jsxs(UA,{variant:"destructive",children:[se.jsx(us,{className:"h-4 w-4"}),se.jsx(qA,{children:n})]}),"denied"===i&&se.jsxs(UA,{children:[se.jsx(us,{className:"h-4 w-4"}),se.jsx(qA,{children:"Per attivare le notifiche, vai nelle impostazioni del browser e consenti le notifiche per questo sito."})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsxs("div",{className:"font-medium",children:[o?"Disattiva":"Attiva"," Notifiche"]}),se.jsx("div",{className:"text-sm text-muted-foreground",children:o?"Riceverai notifiche push su questo dispositivo":"Attiva per ricevere notifiche push"})]}),se.jsx(rd,{checked:o,onCheckedChange:async()=>{o?await u():"granted"===i?await c():await d()},disabled:r||!l&&!o})]}),!o&&"granted"!==i&&se.jsx(mo,{onClick:d,disabled:r,className:"w-full",variant:"outline",children:r?"Configurazione...":"Richiedi Permessi"}),o&&se.jsx("div",{className:"text-center",children:se.jsx("div",{className:"text-success text-sm font-medium",children:" Notifiche push attive e funzionanti!"})})]})]}):se.jsx(Wl,{className:e,children:se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(Ka,{className:"w-5 h-5"}),"Notifiche Push"]}),se.jsx(Vl,{children:"Le notifiche push non sono supportate su questo dispositivo."})]})})},WA={"Luxury & moda":["luxury","fashion","watch","luxurycar"],"Viaggi & esperienze":["travel","experience"],"Sport & fitness":["sport","fitness"],Tecnologia:["tech","innovation"],"Food & beverage":["food","beverage"],"Arte & cultura":["art","culture"]},HA=Object.keys(WA);let ZA=null,VA=0;async function GA(){try{const{data:{user:e}}=await ba.auth.getUser();if(!e)return[];const{data:t,error:i}=await ba.from("notification_preferences").select("*").eq("user_id",e.id).eq("enabled",!0);return i?(console.error(" RESOLVE: Error fetching preferences:",i),[]):t||[]}catch(e){return console.error(" RESOLVE: Exception in getUserPreferences:",e),[]}}async function YA(){const e=Date.now();if(ZA&&e<VA)return ZA;try{const t=(await GA()).map(e=>e.category),i=function(e){const t=new Set;return e.forEach(e=>{WA[e]&&WA[e].forEach(e=>t.add(e))}),Array.from(t)}(t);return ZA=i,VA=e+3e5,i}catch(t){return console.error(" RESOLVE: Error resolving tags:",t),[]}}function KA(){ZA=null,VA=0}async function XA(){try{const e=await GA(),t={};return Object.keys(WA).forEach(e=>{t[e]=!1}),e.forEach(e=>{e.enabled&&(t[e.category]=!0)}),t}catch(e){return console.error(" RESOLVE: Error getting preferences state:",e),{}}}function JA(){const[e,t]=We.useState({}),[i,a]=We.useState(!0),[s,r]=We.useState([]),n=We.useCallback(async()=>{a(!0);try{const[e,i]=await Promise.all([XA(),YA()]);t(e),r(i)}catch(e){console.error(" PREFS: Error loading preferences:",e)}finally{a(!1)}},[]),o=We.useCallback(async(e,i)=>{try{const a=await async function(e,t){try{const{data:{user:i}}=await ba.auth.getUser();if(!i)return console.error(" RESOLVE: No authenticated user for preference update"),!1;const{error:a}=await ba.from("notification_preferences").upsert({user_id:i.id,category:e,enabled:t,updated_at:(new Date).toISOString()},{onConflict:"user_id,category"});return a?(console.error(" RESOLVE: Error updating preference:",a),!1):(KA(),!0)}catch(i){return console.error(" RESOLVE: Exception updating preference:",i),!1}}(e,i);if(a){t(t=>({...t,[e]:i}));const a=await YA();r(a)}return a}catch(a){return console.error(" PREFS: Error updating preference:",a),!1}},[]),l=We.useCallback(async t=>{const i=e[t]||!1;return o(t,!i)},[e,o]),c=We.useCallback(async()=>{KA(),await n()},[n]),d=We.useCallback(()=>Object.entries(e).filter(([e,t])=>t).map(([e,t])=>e),[e]);return We.useEffect(()=>{n()},[n]),{preferences:e,resolvedTags:s,isLoading:i,availableCategories:HA,updatePreference:o,togglePreference:l,refreshPreferences:c,getActiveCategories:d,hasActivePreferences:s.length>0}}function QA({userId:e}){const[t,i]=We.useState(!1),[a,s]=We.useState(!0),[r,n]=We.useState("");return We.useEffect(()=>{let t=!0;return(async()=>{s(!0);const{data:a,error:r}=await ba.from("push_tokens").select("token").eq("user_id",e).eq("is_active",!0).limit(1).maybeSingle();if(t){if(r)console.warn("status load error",r),i(!1),n("");else{const e=!!a;i(e),n(e?(o=a.token).includes("webpush.push.apple.com")||o.includes("api.push.apple.com")?"Apple":o.includes("fcm.googleapis.com")?"FCM":"Altro":"")}var o;s(!1)}})(),()=>{t=!1}},[e]),se.jsxs("div",{className:"p-4 border border-border rounded-lg bg-card",children:[se.jsx("h3",{className:"text-sm font-medium mb-3",children:"Stato Notifiche Push"}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("label",{className:"flex items-center gap-2",children:[se.jsx("input",{type:"checkbox",checked:t,readOnly:!0,className:"h-4 w-4",style:{pointerEvents:"none"}}),se.jsx("span",{className:"text-sm",children:"Notifiche Push su questo dispositivo"})]}),!a&&t&&r&&se.jsx("span",{className:"px-2 py-1 text-xs bg-primary/10 text-primary rounded-md",children:r})]}),se.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[a&&"Verifico stato",!a&&t&&"Connesso ",!a&&!t&&"Non connesso "]})]})}function ez(e){if(!e)return null;const t=e.toLowerCase();return t.startsWith("https://webpush.push.apple.com")||t.startsWith("https://api.push.apple.com")?"APPLE":t.startsWith("https://fcm.googleapis.com")?"FCM":"ALTRO"}function tz({userId:e}){const[t,i]=We.useState({swReady:!1,permission:Notification?.permission,notes:[]}),[a,s]=We.useState(!0);We.useEffect(()=>{let t=!0;return(async()=>{const a=[];try{const s=await(navigator.serviceWorker?.ready),r=s?.scope??null,n=await(s?.pushManager?.getSubscription()),o=n?.endpoint??null,l=ez(o),{data:c,error:d}=await ba.from("push_tokens").select("id, token, is_active, created_at").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).maybeSingle();d&&a.push(`DB error: ${d.message}`);const u=c?.token??null,h=ez(u),m=c?.is_active??null,p=!!o&&!!u&&o===u,f=Notification?.permission,g=navigator.userAgent;o||a.push("SW subscription non trovata su questo device (getSubscription() = null)."),u||a.push("Nessuna subscription Apple/FCM registrata in DB per l'utente."),o&&u&&!p&&a.push("ATTENZIONE: endpoint SW  endpoint DB (device non allineato al record pi recente)."),t&&i({swReady:!!s,swEndpoint:o,swProvider:l,dbEndpoint:u,dbProvider:h,dbIsActive:m,match:p,permission:f,ua:g,scope:r,notes:a})}catch(r){t&&i(e=>({...e,notes:[...e.notes??[],`Runtime error: ${r?.message??r}`]}))}finally{t&&s(!1)}})(),()=>{t=!1}},[e]);const r=({label:e})=>se.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-slate-700/60",children:e??""});return se.jsxs("div",{className:"mt-6 rounded-xl border border-slate-700/40 bg-slate-800/40 p-4",children:[se.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Audit flusso Push (read-only)"}),a?se.jsx("div",{className:"text-sm opacity-80",children:" Raccolta dati"}):se.jsxs("div",{className:"space-y-3 text-sm",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"w-40 opacity-70",children:"Permesso iOS/Browser"}),se.jsx(r,{label:t.permission})]}),se.jsxs("div",{className:"flex items-start gap-2",children:[se.jsx("span",{className:"w-40 opacity-70",children:"SW Endpoint (device)"}),se.jsxs("div",{className:"flex-1 break-all",children:[se.jsx("div",{className:"mb-1",children:t.swEndpoint??""}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"opacity-70",children:"Provider"}),se.jsx(r,{label:t.swProvider??""})]}),se.jsxs("div",{className:"opacity-70 mt-1",children:["Scope: ",t.scope??""]})]})]}),se.jsxs("div",{className:"flex items-start gap-2",children:[se.jsx("span",{className:"w-40 opacity-70",children:"DB Endpoint (latest)"}),se.jsxs("div",{className:"flex-1 break-all",children:[se.jsx("div",{className:"mb-1",children:t.dbEndpoint??""}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"opacity-70",children:"Provider"}),se.jsx(r,{label:t.dbProvider??""}),se.jsx("span",{className:"opacity-70",children:"is_active"}),se.jsx(r,{label:!0===t.dbIsActive?"TRUE":!1===t.dbIsActive?"FALSE":""})]})]})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"w-40 opacity-70",children:"Match DB  Device"}),se.jsx(r,{label:t.match?"MATCH":"NO MATCH"})]}),se.jsxs("div",{className:"flex items-start gap-2",children:[se.jsx("span",{className:"w-40 opacity-70",children:"User-Agent"}),se.jsx("div",{className:"flex-1 break-all",children:t.ua})]}),!!t.notes?.length&&se.jsxs("div",{className:"mt-2 p-2 rounded bg-amber-500/10 border border-amber-400/20",children:[se.jsx("div",{className:"font-medium mb-1",children:"Note"}),se.jsx("ul",{className:"list-disc pl-5 space-y-1",children:t.notes.map((e,t)=>se.jsx("li",{children:e},t))})]})]}),se.jsx("div",{className:"text-xs opacity-60 mt-3",children:"Component read-only. Nessuna modifica alla catena push."})]})}const iz=()=>{const{user:e}=$l(),{toast:t}=mc(),[i,a]=We.useState(!1),{preferences:s,resolvedTags:r,isLoading:n,availableCategories:o,togglePreference:l,refreshPreferences:c,hasActivePreferences:d}=JA(),[u,h]=We.useState({notifications_enabled:!0,weekly_hints:"all",push_notifications_enabled:!1}),m={"Luxury & moda":"","Viaggi & esperienze":"","Sport & fitness":"",Tecnologia:"","Food & beverage":"","Arte & cultura":""};We.useEffect(()=>{p()},[e]);const p=async()=>{if(e)try{const{data:t,error:i}=await ba.from("profiles").select("notifications_enabled, weekly_hints, push_notifications_enabled").eq("id",e.id).single();t&&!i&&h({notifications_enabled:t.notifications_enabled??!0,weekly_hints:t.weekly_hints||"all",push_notifications_enabled:t.push_notifications_enabled??!1})}catch(t){console.error("Error loading notification settings:",t)}},f=async i=>{if(e){a(!0);try{const a={...u,...i};await ba.from("profiles").update({notifications_enabled:a.notifications_enabled,weekly_hints:a.weekly_hints,push_notifications_enabled:a.push_notifications_enabled}).eq("id",e.id),h(a),t({title:" Impostazioni salvate",description:"Le preferenze notifiche sono state aggiornate."})}catch(s){console.error("Error saving notification settings:",s),t({title:" Errore salvataggio",description:"Impossibile salvare le impostazioni. Riprova.",variant:"destructive"})}finally{a(!1)}}};return se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-4xl mx-auto p-6 space-y-6",children:[se.jsxs("div",{className:"mb-8",children:[se.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Impostazioni Notifiche"}),se.jsx("p",{className:"text-white/70",children:"Gestisci le tue preferenze di notifica e comunicazione"})]}),se.jsxs(Wl,{className:"bg-gradient-to-br from-gray-900 to-gray-800 border-gray-700",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center",children:[se.jsx(Xa,{className:"w-5 h-5 mr-2"}),"Notifiche Email"]})}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx(jl,{className:"text-white font-medium",children:"Notifiche Generali"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Ricevi aggiornamenti importanti via email"})]}),se.jsx(rd,{checked:u.notifications_enabled,onCheckedChange:async e=>{await f({notifications_enabled:e})},disabled:i})]}),se.jsxs("div",{className:"space-y-3",children:[se.jsx(jl,{className:"text-white font-medium",children:"Suggerimenti Settimanali"}),se.jsxs(SA,{value:u.weekly_hints,onValueChange:async e=>{await f({weekly_hints:e})},disabled:i,children:[se.jsx(kA,{className:"bg-gray-800 border-gray-600 text-white",children:se.jsx(_A,{})}),se.jsxs(zA,{className:"bg-gray-800 border-gray-600",children:[se.jsx(EA,{value:"all",className:"text-white",children:"Tutti i suggerimenti"}),se.jsx(EA,{value:"only-premium",className:"text-white",children:"Solo suggerimenti premium"}),se.jsx(EA,{value:"none",className:"text-white",children:"Nessun suggerimento"})]})]})]}),se.jsxs("div",{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx(jl,{className:"text-white font-medium",children:"Categorie di Interesse per Feed"}),se.jsxs(mo,{variant:"outline",size:"sm",onClick:async()=>{await c(),t({title:" Preferenze aggiornate",description:"Cache delle preferenze aggiornata dal database."})},disabled:n,className:"flex items-center gap-2",children:[se.jsx(ur,{className:"w-4 h-4 "+(n?"animate-spin":"")}),"Aggiorna"]})]}),se.jsx("p",{className:"text-white/70 text-sm",children:"Seleziona le categorie per ricevere notifiche sui contenuti che ti interessano di pi"}),d&&se.jsxs("div",{className:"text-sm text-green-400 mb-2",children:[" ",r.length," tag attivi: ",r.join(", ")]}),se.jsx("div",{className:"grid grid-cols-1 gap-3",children:o.map(e=>se.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-800/50 border border-gray-700",children:[se.jsxs(jl,{htmlFor:e,className:"text-white flex items-center cursor-pointer flex-1",children:[se.jsx("span",{className:"mr-3 text-lg",children:m[e]||""}),se.jsxs("div",{children:[se.jsx("div",{className:"font-medium",children:e}),s[e]&&se.jsx("div",{className:"text-xs text-green-400 mt-1",children:"Attiva"})]})]}),se.jsx(rd,{id:e,checked:s[e]||!1,onCheckedChange:()=>(async e=>{const i=await l(e);t(i?{title:" Preferenza aggiornata",description:`Categoria "${e}" ${s[e]?"disabilitata":"abilitata"}.`}:{title:" Errore",description:"Impossibile aggiornare la preferenza. Riprova.",variant:"destructive"})})(e),disabled:n||i})]},e))})]}),se.jsxs("div",{className:"border-t border-white/10 pt-4",children:[se.jsx($A,{className:"w-full"}),se.jsx("div",{className:"mt-4",children:se.jsx(QA,{userId:"495246c1-9154-4f01-a428-7f37fe230180"})}),se.jsx(tz,{userId:"495246c1-9154-4f01-a428-7f37fe230180"})]}),!1]})]}),se.jsxs(Wl,{className:"bg-gradient-to-br from-gray-900 to-gray-800 border-gray-700",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center",children:[se.jsx(Or,{className:"w-5 h-5 mr-2"}),"Preferenze Audio"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx(jl,{className:"text-white font-medium",children:"Suoni di Notifica"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Riproduci suoni per le notifiche importanti"})]}),se.jsx(rd,{checked:!0,disabled:i})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx(jl,{className:"text-white font-medium",children:"Feedback Aptico"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Vibrazioni per dispositivi mobile"})]}),se.jsx(rd,{checked:!0,disabled:i})]})]})]}),se.jsx(Wl,{className:"bg-gradient-to-br from-blue-900/20 to-purple-900/20 border-blue-700/50",children:se.jsx(Gl,{className:"pt-6",children:se.jsxs("div",{className:"flex items-start space-x-3",children:[se.jsx(Xa,{className:"w-5 h-5 text-blue-400 mt-0.5"}),se.jsxs("div",{className:"space-y-2",children:[se.jsx("h3",{className:"text-white font-medium",children:"Privacy e Controllo"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Tutte le notifiche possono essere disabilitate in qualsiasi momento. I tuoi dati di preferenza sono crittografati e non vengono condivisi con terze parti."})]})]})})})]})},az=()=>{const{user:e}=$l(),{toast:t}=mc();yl();const{profileImage:i}=Qc(),[a,s]=We.useState(!1),[r,n]=We.useState({data_collection:!0,analytics_enabled:!0,marketing_consent:!1,cookie_preferences:{essential:!0,analytics:!0,marketing:!1}});We.useEffect(()=>{o()},[e]);const o=async()=>{if(e)try{const t=localStorage.getItem(`privacy_settings_${e.id}`);t&&n(JSON.parse(t))}catch(t){console.error("Error loading privacy settings:",t)}},l=async i=>{if(e){s(!0);try{const a={...r,...i};localStorage.setItem(`privacy_settings_${e.id}`,JSON.stringify(a)),n(a),t({title:" Impostazioni privacy salvate",description:"Le tue preferenze sulla privacy sono state aggiornate."})}catch(a){console.error("Error saving privacy settings:",a),t({title:" Errore salvataggio",description:"Impossibile salvare le impostazioni. Riprova.",variant:"destructive"})}finally{s(!1)}}},c=async(e,t)=>{const i={...r.cookie_preferences,[e]:t};await l({cookie_preferences:i})};return se.jsxs("div",{className:"min-h-screen",children:[se.jsx(ad,{profileImage:i||e?.user_metadata?.avatar_url}),se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"px-4 space-y-6",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:[se.jsxs("div",{className:"text-center space-y-2 mb-6",children:[se.jsx("h1",{className:"text-2xl font-bold text-white font-orbitron",children:"Privacy"}),se.jsx("p",{className:"text-white/70",children:"Gestisci le tue preferenze sulla privacy"})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center",children:[se.jsx(ks,{className:"w-5 h-5 mr-2"}),"Raccolta Dati"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx(jl,{className:"text-white font-medium",children:"Consenso Raccolta Dati"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Autorizza M1SSION a raccogliere dati per migliorare l'esperienza utente."})]}),se.jsx(rd,{checked:r.data_collection,onCheckedChange:async e=>{await l({data_collection:e})},disabled:a})]}),se.jsxs("div",{className:"flex items-center justify-between border-t border-white/10 pt-4",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx(jl,{className:"text-white font-medium",children:"Analytics"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Consenti l'analisi del comportamento per ottimizzare l'app."})]}),se.jsx(rd,{checked:r.analytics_enabled,onCheckedChange:async e=>{await l({analytics_enabled:e})},disabled:a})]}),se.jsxs("div",{className:"flex items-center justify-between border-t border-white/10 pt-4",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx(jl,{className:"text-white font-medium",children:"Marketing"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Ricevi comunicazioni promozionali e offerte personalizzate."})]}),se.jsx(rd,{checked:r.marketing_consent,onCheckedChange:async e=>{await l({marketing_consent:e})},disabled:a})]})]})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center",children:[se.jsx(vs,{className:"w-5 h-5 mr-2"}),"Preferenze Cookie"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx(jl,{className:"text-white font-medium",children:"Cookie Essenziali"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Necessari per il funzionamento base dell'applicazione."})]}),se.jsx(rd,{checked:r.cookie_preferences.essential,onCheckedChange:e=>c("essential",e),disabled:!0})]}),se.jsxs("div",{className:"flex items-center justify-between border-t border-white/10 pt-4",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx(jl,{className:"text-white font-medium",children:"Cookie Analytics"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Utilizzati per analizzare l'uso dell'app e migliorare le prestazioni."})]}),se.jsx(rd,{checked:r.cookie_preferences.analytics,onCheckedChange:e=>c("analytics",e),disabled:a})]}),se.jsxs("div",{className:"flex items-center justify-between border-t border-white/10 pt-4",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx(jl,{className:"text-white font-medium",children:"Cookie Marketing"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Per personalizzare annunci e contenuti promozionali."})]}),se.jsx(rd,{checked:r.cookie_preferences.marketing,onCheckedChange:e=>c("marketing",e),disabled:a})]})]})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center",children:[se.jsx(Is,{className:"w-5 h-5 mr-2"}),"Informazioni Privacy"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsx("p",{className:"text-white/70 text-sm",children:"I tuoi dati sono protetti secondo il Regolamento GDPR e vengono utilizzati esclusivamente per migliorare la tua esperienza con M1SSION."}),se.jsxs("div",{className:"space-y-2",children:[se.jsx("h4",{className:"text-white font-medium",children:"Dati Raccolti:"}),se.jsxs("ul",{className:"text-white/70 text-sm space-y-1 ml-4",children:[se.jsx("li",{children:" Informazioni del profilo utente"}),se.jsx("li",{children:" Progressi di gioco e indizi completati"}),se.jsx("li",{children:" Preferenze dell'applicazione"}),se.jsx("li",{children:" Dati di utilizzo anonimi (se autorizzato)"})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx("h4",{className:"text-white font-medium",children:"I Tuoi Diritti:"}),se.jsxs("ul",{className:"text-white/70 text-sm space-y-1 ml-4",children:[se.jsx("li",{children:" Accesso ai tuoi dati personali"}),se.jsx("li",{children:" Correzione di informazioni inesatte"}),se.jsx("li",{children:" Cancellazione del tuo account"}),se.jsx("li",{children:" Portabilit dei dati"})]})]}),se.jsx(mo,{variant:"outline",className:"w-full border-white/20 text-white hover:bg-white/10",children:"Scarica i Miei Dati"})]})]})]}),se.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1e4},children:se.jsx(sd,{})})]})},sz=()=>{const{user:e}=$l(),{toast:t}=mc();yl();const{profileImage:i}=Qc(),[a,s]=We.useState(!1),r=[{title:"Termini di Servizio",description:"Condizioni d'uso dell'applicazione M1SSION",url:"/terms",icon:Ps},{title:"Privacy Policy",description:"Come raccogliamo e utilizziamo i tuoi dati",url:"/privacy-policy",icon:vr},{title:"Cookie Policy",description:"Come utilizziamo i cookie e tecnologie simili",url:"/cookie-policy",icon:xr},{title:"Regolamento M1SSION",description:"Modalit di gioco, premi, meccaniche e diritti",url:"/game-rules",icon:Ps},{title:"SafeCreative",description:"Certificazione di propriet intellettuale",url:"/safecreative",icon:ws}],n=e=>{e.startsWith("/")?window.location.href=e:window.Capacitor?window.Capacitor.Plugins.Browser?.open({url:e}):window.open(e,"_blank","noopener,noreferrer")};return se.jsxs("div",{className:"min-h-screen",children:[se.jsx(ad,{profileImage:i||e?.user_metadata?.avatar_url}),se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"px-4 space-y-6",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:[se.jsxs("div",{className:"text-center space-y-2 mb-6",children:[se.jsx("h1",{className:"text-2xl font-bold text-white font-orbitron",children:"Legale"}),se.jsx("p",{className:"text-white/70",children:"Documenti legali e informazioni"})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center",children:[se.jsx(Ps,{className:"w-5 h-5 mr-2"}),"Documenti Legali"]})}),se.jsx(Gl,{className:"space-y-4",children:r.map((e,t)=>{const i=e.icon;return se.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/20 rounded-lg border border-white/10",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[se.jsx(i,{className:"w-5 h-5 text-[#00D1FF]"}),se.jsxs("div",{children:[se.jsx("h3",{className:"text-white font-medium",children:e.title}),se.jsx("p",{className:"text-white/70 text-sm",children:e.description})]})]}),se.jsx(mo,{onClick:()=>n(e.url),size:"sm",variant:"outline",className:"border-white/20 text-white hover:bg-white/10",children:se.jsx(zs,{className:"w-4 h-4"})})]},t)})})]}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-white font-orbitron",children:"Informazioni App"})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx("p",{className:"text-white/70 text-sm",children:"Versione"}),se.jsx("p",{className:"text-white font-medium",children:"1.0.0"})]}),se.jsxs("div",{className:"space-y-1",children:[se.jsx("p",{className:"text-white/70 text-sm",children:"Build"}),se.jsx("p",{className:"text-white font-medium",children:"2025.01.12"})]}),se.jsxs("div",{className:"space-y-1",children:[se.jsx("p",{className:"text-white/70 text-sm",children:"Sviluppatore"}),se.jsx("p",{className:"text-white font-medium",children:"NIYVORA KFT"})]}),se.jsxs("div",{className:"space-y-1",children:[se.jsx("p",{className:"text-white/70 text-sm",children:"Copyright"}),se.jsx("p",{className:"text-white font-medium",children:"M1SSION 2025"})]})]}),se.jsx("div",{className:"mt-4 p-3 bg-[#00D1FF]/10 rounded-lg border border-[#00D1FF]/20",children:se.jsx("p",{className:"text-[#00D1FF] text-sm font-medium",children:"M1SSION  un'app ufficiale creata e sviluppata da NIYVORA KFT."})})]})]}),se.jsx(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:se.jsx(Gl,{className:"pt-6",children:se.jsxs("div",{className:"text-center space-y-3",children:[se.jsx("p",{className:"text-white/70 text-sm",children:"Hai domande o hai bisogno di assistenza?"}),se.jsx(mo,{onClick:()=>n("mailto:support@m1ssion.app"),variant:"outline",className:"border-[#00D1FF]/50 text-[#00D1FF] hover:bg-[#00D1FF]/10",children:"Contatta il Supporto"})]})})}),se.jsxs(Wl,{className:"bg-black/40 border-red-500/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center text-red-400",children:[se.jsx(Ar,{className:"w-5 h-5 mr-2"}),"Zona Pericolosa"]})}),se.jsx(Gl,{className:"space-y-4",children:se.jsxs("div",{className:"space-y-3",children:[se.jsx("p",{className:"text-white/70 text-sm",children:" L'eliminazione dell'account  permanente e irreversibile. Tutti i tuoi dati, progressi, abbonamenti e acquisti verranno eliminati definitivamente."}),se.jsxs("div",{className:"bg-red-900/20 p-4 rounded-lg border border-red-500/20",children:[se.jsx("h4",{className:"text-red-400 font-semibold mb-2",children:"Verranno eliminati:"}),se.jsxs("ul",{className:"text-red-300 text-sm space-y-1",children:[se.jsx("li",{children:" Profilo agente e statistiche"}),se.jsx("li",{children:" Indizi completati e cronologia"}),se.jsx("li",{children:" Metodi di pagamento e abbonamenti"}),se.jsx("li",{children:" Tutte le preferenze e impostazioni"})]})]}),se.jsxs(Kk,{children:[se.jsx(Xk,{asChild:!0,children:se.jsx(mo,{variant:"destructive",className:"w-full bg-red-600 hover:bg-red-700",disabled:a,children:"Elimina Account Permanentemente"})}),se.jsxs(eC,{className:"bg-black/90 border-red-500/20",children:[se.jsxs(tC,{children:[se.jsx(aC,{className:"text-white",children:" Conferma Eliminazione Account"}),se.jsxs(sC,{className:"text-white/70",children:["Questa azione  ",se.jsx("strong",{children:"IRREVERSIBILE"}),". Il tuo account M1SSION e tutti i dati associati verranno eliminati permanentemente.",se.jsx("br",{}),se.jsx("br",{}),"Non potrai recuperare progressi, abbonamenti o acquisti dopo la conferma."]})]}),se.jsxs(iC,{children:[se.jsx(nC,{className:"bg-white/10 text-white border-white/20",children:"Annulla"}),se.jsx(rC,{onClick:async()=>{if(e){s(!0);try{await ba.from("user_clues").delete().eq("user_id",e.id),await ba.from("user_buzz_counter").delete().eq("user_id",e.id),await ba.from("user_notifications").delete().eq("user_id",e.id),await ba.from("subscriptions").delete().eq("user_id",e.id),await ba.from("profiles").delete().eq("id",e.id),await ba.auth.signOut(),localStorage.clear(),t({title:" Account eliminato",description:"Il tuo account e tutti i dati associati sono stati eliminati permanentemente."}),window.location.href="/login"}catch(i){console.error("Account deletion error:",i),t({title:" Errore eliminazione account",description:i.message||"Impossibile eliminare l'account. Contatta il supporto.",variant:"destructive"})}finally{s(!1)}}},className:"bg-red-600 hover:bg-red-700",children:"Elimina Definitivamente"})]})]})]})]})})]})]}),se.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1e4},children:se.jsx(sd,{})})]})};var rz="horizontal",nz=["horizontal","vertical"],oz=We.forwardRef((e,t)=>{const{decorative:i,orientation:a=rz,...s}=e,r=function(e){return nz.includes(e)}(a)?a:rz,n=i?{role:"none"}:{"aria-orientation":"vertical"===r?r:void 0,role:"separator"};return se.jsx(ne.div,{"data-orientation":r,...n,...s,ref:t})});oz.displayName="Separator";var lz=oz;const cz=We.forwardRef(({className:e,orientation:t="horizontal",decorative:i=!0,...a},s)=>se.jsx(lz,{ref:s,decorative:i,orientation:t,className:eo("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...a}));cz.displayName=lz.displayName;const dz=()=>{const[,e]=Ai(),t="M1SSION",i="2.0.1",a="2025.01.05",s="Production",r="NIYVORA KFT",n=[{icon:Ls,title:"Missioni Globali",description:"Esplora il mondo attraverso missioni interattive"},{icon:Fr,title:"Community",description:"Connettiti con agenti in tutto il mondo"},{icon:vr,title:"Sicurezza",description:"Protezione avanzata dei dati personali"},{icon:yr,title:"Multi-Platform",description:"Disponibile su tutti i dispositivi"}];return se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background via-background/95 to-background/90",children:[se.jsx(ad,{}),se.jsx("main",{className:"pt-16 pb-20 px-4",children:se.jsxs("div",{className:"max-w-lg mx-auto space-y-6",children:[se.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>e("/settings"),className:"p-2 hover:bg-background/50",children:se.jsx(Za,{className:"h-5 w-5"})}),se.jsxs("div",{children:[se.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Info App"}),se.jsx("p",{className:"text-muted-foreground",children:"Dettagli dell'applicazione"})]})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsxs(Hl,{className:"text-center pb-4",children:[se.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4 mx-auto",children:se.jsx(Us,{className:"h-10 w-10 text-primary"})}),se.jsx(Zl,{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:t})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{className:"text-center p-3 glass-card bg-background/20 border-0",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Versione"}),se.jsx("p",{className:"font-semibold text-lg text-primary",children:i})]}),se.jsxs("div",{className:"text-center p-3 glass-card bg-background/20 border-0",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Build"}),se.jsx("p",{className:"font-semibold text-lg text-primary",children:a})]})]}),se.jsx(cz,{className:"my-4"}),se.jsxs("div",{className:"space-y-3",children:[se.jsxs("div",{className:"flex justify-between items-center",children:[se.jsx("span",{className:"text-muted-foreground",children:"Ambiente"}),se.jsx(fc,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:s})]}),se.jsxs("div",{className:"flex justify-between items-center",children:[se.jsx("span",{className:"text-muted-foreground",children:"Sviluppatore"}),se.jsx("span",{className:"font-medium text-foreground",children:r})]})]})]})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:"Caratteristiche"})}),se.jsx(Gl,{className:"space-y-3",children:n.map((e,t)=>se.jsx("div",{className:"glass-card p-4 bg-background/20 border-0",children:se.jsxs("div",{className:"flex items-start space-x-3",children:[se.jsx("div",{className:"p-2 rounded-lg bg-primary/20",children:se.jsx(e.icon,{className:"h-5 w-5 text-primary"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-foreground",children:e.title}),se.jsx("p",{className:"text-sm text-muted-foreground/80",children:e.description})]})]})},t))})]}),se.jsxs(Wl,{className:"glass-card border-0 bg-card/50 backdrop-blur-md",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent",children:"Collegamenti"})}),se.jsx(Gl,{className:"space-y-3",children:se.jsxs(mo,{variant:"outline",className:"w-full justify-between bg-background/50 border-primary/30 hover:bg-primary/10",children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(Fs,{className:"h-4 w-4 text-red-400"}),se.jsx("span",{children:"Supporta il Progetto"})]}),se.jsx(zs,{className:"h-4 w-4"})]})})]}),se.jsxs("div",{className:"text-center py-4",children:[se.jsx("p",{className:"text-sm text-muted-foreground/60",children:" 2025 Joseph MUL  M1SSION"}),se.jsx("p",{className:"text-xs text-muted-foreground/40",children:"ALL RIGHTS RESERVED  NIYVORA KFT"})]})]})}),se.jsx(sd,{})]})},uz=()=>{const{user:e}=$l(),{toast:t}=mc(),[i,a]=We.useState([]),[s,r]=We.useState(!1),[n,o]=We.useState(null),l=async()=>{r(!0);const e=[];try{e.push({name:"Connessione Internet",status:navigator.onLine?"success":"error",message:navigator.onLine?"Connessione attiva":"Nessuna connessione"});try{localStorage.setItem("test","test"),localStorage.removeItem("test"),e.push({name:"Local Storage",status:"success",message:"Funzionante"})}catch{e.push({name:"Local Storage",status:"error",message:"Non disponibile"})}const i="serviceWorker"in navigator;e.push({name:"Service Worker",status:i?"success":"warning",message:i?"Supportato":"Non supportato"});const s="PushManager"in window&&"Notification"in window;e.push({name:"Push Notifications",status:s?"success":"warning",message:s?"Supportate":"Non supportate"});try{const t=document.createElement("canvas"),i=t.getContext("webgl")||t.getContext("experimental-webgl");e.push({name:"WebGL",status:i?"success":"warning",message:i?"Supportato":"Non supportato"})}catch{e.push({name:"WebGL",status:"warning",message:"Non supportato"})}e.push({name:"Geolocalizzazione",status:"geolocation"in navigator?"success":"warning",message:"geolocation"in navigator?"Disponibile":"Non disponibile"}),a(e),o(new Date),t({title:" Diagnostica completata",description:"Tutti i test sono stati eseguiti con successo."})}catch(i){t({title:" Errore diagnostica",description:"Si  verificato un errore durante i test.",variant:"destructive"})}finally{r(!1)}},c=e=>{switch(e){case"success":return se.jsx(hs,{className:"w-4 h-4 text-emerald-400"});case"warning":return se.jsx(Er,{className:"w-4 h-4 text-amber-400"});case"error":return se.jsx(gs,{className:"w-4 h-4 text-red-400"})}},d=e=>{switch(e){case"success":return"border-emerald-500/30 bg-emerald-500/10";case"warning":return"border-amber-500/30 bg-amber-500/10";case"error":return"border-red-500/30 bg-red-500/10"}};return We.useEffect(()=>{l()},[]),se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-4xl mx-auto p-6 space-y-6",children:[se.jsxs("div",{className:"mb-8",children:[se.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Diagnostica Sistema"}),se.jsx("p",{className:"text-white/70",children:"Verifica il funzionamento dei componenti dell'applicazione"})]}),se.jsxs(Wl,{className:"glass-card border-white/10",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center",children:[se.jsx(qa,{className:"w-5 h-5 mr-2 text-blue-400"}),"Panoramica Sistema"]})}),se.jsx(Gl,{className:"space-y-4",children:se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[se.jsxs("div",{className:"text-center p-3 glass-card border-blue-500/30",children:[se.jsx(tr,{className:"w-6 h-6 mx-auto mb-2 text-blue-400"}),se.jsx("div",{className:"text-sm text-white",children:"Browser"}),se.jsx("div",{className:"text-xs text-white/70",children:navigator.userAgent.split(" ")[0]})]}),se.jsxs("div",{className:"text-center p-3 glass-card border-purple-500/30",children:[se.jsx(gr,{className:"w-6 h-6 mx-auto mb-2 text-purple-400"}),se.jsx("div",{className:"text-sm text-white",children:"Platform"}),se.jsx("div",{className:"text-xs text-white/70",children:navigator.platform})]}),se.jsxs("div",{className:"text-center p-3 glass-card border-emerald-500/30",children:[se.jsx(Ur,{className:"w-6 h-6 mx-auto mb-2 text-emerald-400"}),se.jsx("div",{className:"text-sm text-white",children:"Online"}),se.jsx("div",{className:"text-xs text-white/70",children:navigator.onLine?"S":"No"})]}),se.jsxs("div",{className:"text-center p-3 glass-card border-amber-500/30",children:[se.jsx(ks,{className:"w-6 h-6 mx-auto mb-2 text-amber-400"}),se.jsx("div",{className:"text-sm text-white",children:"Storage"}),se.jsx("div",{className:"text-xs text-white/70",children:"Disponibile"})]})]})})]}),se.jsxs(Wl,{className:"glass-card border-white/10",children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"text-white flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center",children:[se.jsx(qa,{className:"w-5 h-5 mr-2 text-green-400"}),"Test Diagnostici"]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsxs(mo,{onClick:()=>{const a={timestamp:(new Date).toISOString(),user_id:e?.id,diagnostics:i,browser:navigator.userAgent,platform:navigator.platform,language:navigator.language},s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download=`m1ssion-diagnostics-${Date.now()}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),t({title:" Report scaricato",description:"Il report diagnostico  stato scaricato."})},variant:"outline",size:"sm",disabled:0===i.length,className:"bg-white/5 border-white/20 text-white hover:bg-white/10",children:[se.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Scarica Report"]}),se.jsxs(mo,{onClick:l,disabled:s,size:"sm",className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:[se.jsx(ur,{className:"w-4 h-4 mr-2 "+(s?"animate-spin":"")}),s?"Esecuzione...":"Esegui Test"]})]})]}),n&&se.jsxs("p",{className:"text-white/70 text-sm",children:["Ultimo aggiornamento: ",n.toLocaleString("it-IT")]})]}),se.jsx(Gl,{children:0===i.length?se.jsxs("div",{className:"text-center py-8",children:[se.jsx(qa,{className:"w-12 h-12 mx-auto mb-4 text-white/50"}),se.jsx("p",{className:"text-white/70",children:"Esegui la diagnostica per vedere i risultati"})]}):se.jsx("div",{className:"space-y-3",children:i.map((e,t)=>se.jsx(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:`p-4 rounded-lg border ${d(e.status)}`,children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[c(e.status),se.jsxs("div",{children:[se.jsx("h3",{className:"text-white font-medium",children:e.name}),se.jsx("p",{className:"text-white/70 text-sm",children:e.message}),e.details&&se.jsx("p",{className:"text-white/50 text-xs mt-1",children:e.details})]})]}),se.jsx(fc,{variant:"success"===e.status?"default":"destructive",className:"success"===e.status?"bg-emerald-500/20 text-emerald-400 border-emerald-500/30":"warning"===e.status?"bg-amber-500/20 text-amber-400 border-amber-500/30":"bg-red-500/20 text-red-400 border-red-500/30",children:"success"===e.status?"OK":"warning"===e.status?"WARN":"ERROR"})]})},t))})})]}),se.jsxs(Wl,{className:"glass-card border-white/10",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center",children:[se.jsx(Ya,{className:"w-5 h-5 mr-2 text-yellow-400"}),"Informazioni Performance"]})}),se.jsx(Gl,{children:se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[se.jsxs("div",{className:"p-4 glass-card border-yellow-500/30",children:[se.jsx("h3",{className:"text-white font-medium mb-2",children:"Memoria"}),se.jsxs("p",{className:"text-white/70 text-sm",children:["Heap: ",performance.memory?`${Math.round(performance.memory.usedJSHeapSize/1024/1024)}MB`:"N/A"]})]}),se.jsxs("div",{className:"p-4 glass-card border-blue-500/30",children:[se.jsx("h3",{className:"text-white font-medium mb-2",children:"Connection"}),se.jsxs("p",{className:"text-white/70 text-sm",children:["Tipo: ",navigator.connection?.effectiveType||"Sconosciuto"]})]}),se.jsxs("div",{className:"p-4 glass-card border-purple-500/30",children:[se.jsx("h3",{className:"text-white font-medium mb-2",children:"Hardware"}),se.jsxs("p",{className:"text-white/70 text-sm",children:["CPU: ",navigator.hardwareConcurrency||"N/A"," core"]})]})]})})]})]})},hz=()=>{$l();const{toast:e}=mc(),[t,i]=We.useState([]),[a,s]=We.useState({analytics:!0,location_tracking:!1,data_sharing:!1,marketing_communications:!1}),r=async()=>{const e=[{name:"notifications",status:"unknown",description:"Mostra notifiche push per aggiornamenti importanti",icon:se.jsx(Xa,{className:"w-4 h-4"}),required:!1},{name:"geolocation",status:"unknown",description:"Accesso alla posizione per funzionalit di mapping",icon:se.jsx(Ys,{className:"w-4 h-4"}),required:!0},{name:"camera",status:"unknown",description:"Scansione QR code e caricamento foto",icon:se.jsx(ss,{className:"w-4 h-4"}),required:!1},{name:"microphone",status:"unknown",description:"Registrazione audio per feedback vocali",icon:se.jsx(er,{className:"w-4 h-4"}),required:!1}];if("Notification"in window&&(e[0].status=Notification.permission),"permissions"in navigator)try{for(let t=1;t<e.length;t++){const i=e[t],a=await navigator.permissions.query({name:i.name});i.status=a.state}}catch(t){console.warn("Could not check all permissions:",t)}i(e)},n=(t,i)=>{s(e=>({...e,[t]:i})),e({title:" Impostazione aggiornata",description:"Le tue preferenze privacy sono state salvate."})},o=e=>{switch(e){case"granted":return se.jsx(hs,{className:"w-4 h-4 text-emerald-400"});case"denied":return se.jsx(Er,{className:"w-4 h-4 text-red-400"});default:return se.jsx(vr,{className:"w-4 h-4 text-amber-400"})}},l=e=>{switch(e){case"granted":return"border-emerald-500/30 bg-emerald-500/10";case"denied":return"border-red-500/30 bg-red-500/10";default:return"border-amber-500/30 bg-amber-500/10"}};return We.useEffect(()=>{r()},[]),se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-4xl mx-auto p-6 space-y-6",children:[se.jsxs("div",{className:"mb-8",children:[se.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Privacy & Permessi"}),se.jsx("p",{className:"text-white/70",children:"Gestisci i permessi dell'app e le impostazioni sulla privacy"})]}),se.jsxs(Wl,{className:"glass-card border-white/10",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center",children:[se.jsx(vr,{className:"w-5 h-5 mr-2 text-blue-400"}),"Permessi Sistema"]}),se.jsxs(mo,{onClick:r,variant:"outline",size:"sm",className:"bg-white/5 border-white/20 text-white hover:bg-white/10",children:[se.jsx(xr,{className:"w-4 h-4 mr-2"}),"Aggiorna"]})]})}),se.jsx(Gl,{children:se.jsx("div",{className:"space-y-4",children:t.map((t,i)=>se.jsx(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*i},className:`p-4 rounded-lg border ${l(t.status)}`,children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[t.icon,se.jsxs("div",{children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx("h3",{className:"text-white font-medium capitalize",children:t.name.replace("_"," ")}),t.required&&se.jsx(fc,{variant:"destructive",className:"text-xs",children:"Richiesto"})]}),se.jsx("p",{className:"text-white/70 text-sm",children:t.description})]})]}),se.jsxs("div",{className:"flex items-center space-x-3",children:[o(t.status),se.jsx(fc,{variant:"granted"===t.status?"default":"destructive",className:"granted"===t.status?"bg-emerald-500/20 text-emerald-400 border-emerald-500/30":"denied"===t.status?"bg-red-500/20 text-red-400 border-red-500/30":"bg-amber-500/20 text-amber-400 border-amber-500/30",children:t.status}),"granted"!==t.status&&se.jsx(mo,{onClick:()=>(async t=>{try{let i=!1;switch(t){case"notifications":"Notification"in window&&(i="granted"===await Notification.requestPermission());break;case"geolocation":"geolocation"in navigator&&(await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)}),i=!0);break;case"camera":"mediaDevices"in navigator&&((await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop()),i=!0);break;case"microphone":"mediaDevices"in navigator&&((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),i=!0)}i&&(e({title:" Permesso concesso",description:"Il permesso  stato concesso con successo."}),r())}catch(i){e({title:" Permesso negato",description:"Il permesso  stato negato o si  verificato un errore.",variant:"destructive"})}})(t.name),size:"sm",className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:"Concedi"})]})]})},t.name))})})]}),se.jsxs(Wl,{className:"glass-card border-white/10",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center",children:[se.jsx(Is,{className:"w-5 h-5 mr-2 text-purple-400"}),"Impostazioni Privacy"]})}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx("h3",{className:"text-white font-medium",children:"Analisi e Miglioramento"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Condividi dati anonimi per migliorare l'esperienza dell'app"})]}),se.jsx(rd,{checked:a.analytics,onCheckedChange:e=>n("analytics",e)})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx("h3",{className:"text-white font-medium",children:"Tracciamento Posizione"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Memorizza la cronologia delle posizioni per funzionalit avanzate"})]}),se.jsx(rd,{checked:a.location_tracking,onCheckedChange:e=>n("location_tracking",e)})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx("h3",{className:"text-white font-medium",children:"Condivisione Dati"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Condividi dati con partner fidati per offerte personalizzate"})]}),se.jsx(rd,{checked:a.data_sharing,onCheckedChange:e=>n("data_sharing",e)})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx("h3",{className:"text-white font-medium",children:"Comunicazioni Marketing"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Ricevi email promozionali e aggiornamenti sui prodotti"})]}),se.jsx(rd,{checked:a.marketing_communications,onCheckedChange:e=>n("marketing_communications",e)})]})]})]}),se.jsxs(Wl,{className:"glass-card border-white/10",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center",children:[se.jsx(ks,{className:"w-5 h-5 mr-2 text-amber-400"}),"Gestione Dati"]})}),se.jsx(Gl,{className:"space-y-4",children:se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs(mo,{variant:"outline",className:"bg-white/5 border-white/20 text-white hover:bg-white/10 p-4 h-auto flex-col",children:[se.jsx(br,{className:"w-6 h-6 mb-2"}),se.jsx("span",{className:"font-medium",children:"Esporta Dati"}),se.jsx("span",{className:"text-sm text-white/70",children:"Scarica tutti i tuoi dati"})]}),se.jsxs(mo,{variant:"outline",className:"bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20 p-4 h-auto flex-col",children:[se.jsx(Er,{className:"w-6 h-6 mb-2"}),se.jsx("span",{className:"font-medium",children:"Elimina Account"}),se.jsx("span",{className:"text-sm text-red-300/70",children:"Rimuovi permanentemente"})]})]})})]}),se.jsx(Wl,{className:"glass-card border-blue-500/30 bg-blue-500/10",children:se.jsx(Gl,{className:"pt-6",children:se.jsxs("div",{className:"flex items-start space-x-3",children:[se.jsx(Zs,{className:"w-5 h-5 text-blue-400 mt-0.5"}),se.jsxs("div",{className:"space-y-2",children:[se.jsx("h3",{className:"text-white font-medium",children:"Protezione dei Dati"}),se.jsx("p",{className:"text-white/70 text-sm",children:"I tuoi dati sono protetti con crittografia end-to-end e non vengono mai venduti a terze parti. Rispettiamo il GDPR e offriamo pieno controllo sui tuoi dati personali."})]})]})})})]})},mz=()=>(yl(),se.jsxs("section",{className:"w-full py-8",children:[se.jsx("h2",{className:"text-2xl font-bold mb-3 px-4 text-center bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent",children:"Scegli il Tuo Piano"}),se.jsx("p",{className:"text-base text-white/70 mb-8 px-4 text-center max-w-2xl mx-auto",children:"Sblocca pi indizi e aumenta le tue possibilit di vittoria con i nostri pacchetti premium."})]})),pz=({title:e,price:t,period:i,features:a,isPopular:s,ctaText:r,type:n,isActive:o=!1,onClick:l})=>{const c=()=>{switch(n){case"Base":return"from-green-400 to-green-600";case"Silver":return"from-gray-400 to-gray-600";case"Gold":return"from-amber-400 to-amber-600";case"Black":return"from-gray-900 to-gray-700";case"Titanium":return"from-purple-500 to-cyan-500";default:return"from-blue-500 to-cyan-600"}};return se.jsxs("div",{className:eo("relative glass-card p-6",o?"ring-2 ring-cyan-500":"transition-all duration-300 hover:scale-102",s&&!o&&"transform scale-105 z-10","Titanium"===n&&o?"shadow-[0_0_30px_rgba(168,85,247,0.4)]":"Titanium"===n&&!o&&"shadow-[0_0_30px_rgba(168,85,247,0.4)] hover:shadow-[0_0_40px_rgba(168,85,247,0.6)]"),"data-plan":n,style:o?{animation:"none !important",transition:"none !important",pointerEvents:"auto"}:{},children:[s&&se.jsx(fc,{className:"absolute -top-2 right-6 bg-gradient-to-r from-indigo-500 to-purple-600",children:"Pi popolare"}),se.jsx("h3",{className:"text-xl font-bold mb-2",children:e}),se.jsxs("div",{className:"mb-6",children:[se.jsx("span",{className:"text-3xl font-bold",children:t}),se.jsxs("span",{className:"text-sm text-gray-400",children:["/",i]})]}),se.jsx("ul",{className:"space-y-2 mb-6",children:a.map((e,t)=>se.jsxs("li",{className:"flex items-start",children:[se.jsx("span",{className:`inline-flex items-center justify-center w-5 h-5 rounded-full mr-2 mt-0.5 bg-gradient-to-r ${c()} flex-shrink-0`,children:se.jsx(os,{className:"h-3 w-3 text-white"})}),se.jsx("span",{className:"text-sm text-gray-300",children:e.text})]},t))}),se.jsx(mo,{onClick:()=>{l&&!o?l():o||console.error(` M1SSION No onClick handler for ${n}`)},disabled:o,className:eo("w-full font-semibold",o?"bg-gradient-to-r from-cyan-600 to-cyan-800 cursor-not-allowed opacity-75":`bg-gradient-to-r ${c()} transition-all duration-200 hover:scale-102 active:scale-98 cursor-pointer`,"Titanium"===n&&!o&&"shadow-[0_0_20px_rgba(168,85,247,0.3)] hover:shadow-[0_0_30px_rgba(168,85,247,0.5)]"),style:o?{animation:"none !important",transition:"none !important"}:{},children:r}),o&&se.jsx(fc,{className:`mt-2 w-full flex justify-center ${(()=>{switch(n){case"Base":return"bg-green-500";case"Silver":return"bg-gray-500";case"Gold":return"bg-amber-500";case"Black":return"bg-gray-900";case"Titanium":return"bg-gradient-to-r from-purple-500 to-cyan-500";default:return"bg-blue-500"}})()}`,children:"Attualmente attivo"})]})},fz={Base:{priceEur:0,priceCents:0,displayPrice:"0",label:"Base - Gratis",features:["Funzioni base (accesso alla missione con restrizioni)","Supporto email standard","1 indizio settimanale base"],limitations:["Nessun accesso anticipato agli eventi","Nessun badge esclusivo"],earlyAccess:0},Silver:{priceEur:3.99,priceCents:399,displayPrice:"3.99",label:"Silver",features:["Tutti i vantaggi Base","3 indizi premium aggiuntivi a settimana","Accesso anticipato di 2 ore agli eventi","Badge Silver nel profilo"],earlyAccess:2},Gold:{priceEur:6.99,priceCents:699,displayPrice:"6.99",label:"Gold",features:["Tutti i vantaggi Silver","4 indizi premium aggiuntivi a settimana","Accesso anticipato di 12 ore agli eventi","Partecipazione alle estrazioni Gold","Badge Gold esclusivo nel profilo"],earlyAccess:12},Black:{priceEur:9.99,priceCents:999,displayPrice:"9.99",label:"Black",features:["Tutti i vantaggi Gold","Accesso VIP anticipato di 24 ore agli eventi","5 indizi premium aggiuntivi a settimana","Badge Black esclusivo"],earlyAccess:24},Titanium:{priceEur:29.99,priceCents:2999,displayPrice:"29.99",label:"Titanium",features:["Tutti i vantaggi Black","5 indizi premium aggiuntivi a settimana","Accesso VIP anticipato di 48 ore agli eventi","Supporto prioritario dedicato (24/7)","Eventi esclusivi M1SSION","Badge Titanium esclusivo"],earlyAccess:48}},gz=e=>{const t=fz[e];return t?.priceCents||0},xz=e=>{const t=fz[e];return t?.displayPrice||"0.00"},bz=Object.freeze(Object.defineProperty({__proto__:null,PRICING_CONFIG:fz,getDisplayPrice:xz,getPriceCents:gz,getPriceEur:e=>{const t=fz[e];return t?.priceEur||0}},Symbol.toStringTag,{value:"Module"})),vz=({selected:e,setSelected:t})=>{const{toast:i}=mc();yl();const{upgradeSubscription:a}=VS(),[s,r]=We.useState(!1),[n,o]=We.useState("");Ze.useEffect(()=>{(async()=>{const e=new URLSearchParams(window.location.search),i="true"===e.get("success"),s=e.get("tier"),r=e.get("session_id"),n="true"===e.get("canceled");if(window.location.href,window.location.search,window.location.search.length,n)return Ki.error("Pagamento annullato",{description:"Il pagamento  stato annullato",duration:4e3}),void window.history.replaceState({},"","/subscriptions");if(i&&s)try{const{data:{user:e},error:i}=await ba.auth.getUser();if(i||!e)return void console.error(" M1SSION User auth error:",i);e.id;const{data:n,error:l}=await ba.from("profiles").update({subscription_tier:s,tier:s,updated_at:(new Date).toISOString()}).eq("id",e.id).select().single();l&&console.error(" M1SSION Profile update error:",l);const{data:c,error:d}=await ba.functions.invoke("verify-subscription-sync");d&&console.error(" M1SSION Sync error:",d);const{error:u}=await ba.from("subscriptions").upsert({user_id:e.id,tier:s,status:"active",current_period_start:(new Date).toISOString(),current_period_end:new Date(Date.now()+2592e6).toISOString(),updated_at:(new Date).toISOString()},{onConflict:"user_id"});u&&console.error(" M1SSION Subscription upsert error:",u),t(s),localStorage.setItem("userTier",s),localStorage.setItem("pending_plan_update",s);try{await a(s)}catch(o){console.error(" M1SSION upgradeSubscription error:",o)}const{error:h}=await ba.from("panel_logs").insert({event_type:"subscription_upgraded",details:{user_id:e.id,new_tier:s,session_id:r,timestamp:(new Date).toISOString(),source:"stripe_success_return"}});h&&console.error(" M1SSION Panel log error:",h),Ki.success(` Piano ${s} attivato!`,{description:`Il tuo abbonamento ${s}  ora attivo e funzionante`,duration:6e3}),setTimeout(()=>{window.history.replaceState({},"","/subscriptions")},2e3)}catch(l){console.error(" M1SSION Critical error processing success:",l),Ki.error(" Errore sincronizzazione abbonamento",{description:"Il pagamento  andato a buon fine ma c' stato un errore di sincronizzazione. Contatta il supporto.",duration:8e3})}})()},[]);const l=e=>{switch(e){case"Base":return[{text:"Funzioni base (accesso alla missione con restrizioni)"},{text:"Supporto email standard"},{text:"1 indizio settimanale base"}];case"Silver":return[{text:"Tutti i vantaggi Base"},{text:"3 indizi premium aggiuntivi a settimana"},{text:"Accesso anticipato di 2 ore agli eventi"},{text:"Badge Silver nel profilo"}];case"Gold":return[{text:"Tutti i vantaggi Silver"},{text:"4 indizi premium aggiuntivi a settimana"},{text:"Accesso anticipato di 12 ore agli eventi"},{text:"Partecipazione alle estrazioni Gold"},{text:"Badge Gold esclusivo nel profilo"}];case"Black":return[{text:"Tutti i vantaggi Gold"},{text:"Accesso VIP anticipato di 24 ore agli eventi"},{text:"5 indizi premium aggiuntivi a settimana"},{text:"Badge Black esclusivo"}];case"Titanium":return[{text:"Tutti i vantaggi Black"},{text:"7 indizi premium aggiuntivi a settimana"},{text:"Accesso VIP anticipato di 48 ore agli eventi"},{text:"Supporto prioritario dedicato (24/7)"},{text:"Eventi esclusivi M1SSION"},{text:"Badge Titanium esclusivo"}];default:return[]}},c=async e=>{window.location.href;try{if("Base"===e){const{data:{user:e}}=await ba.auth.getUser();if(e){e.id,await ba.from("profiles").update({subscription_plan:"Base"}).eq("id",e.id);try{const{data:e,error:t}=await ba.functions.invoke("cancel-subscription");t&&console.error(" M1SSION Cancel subscription error:",t)}catch(s){console.error(" M1SSION Cancel subscription failed:",s)}localStorage.setItem("userTier","Base"),await a("Base"),t("Base")}i({title:" Piano Base attivato",description:"Stai utilizzando il piano Base gratuito",duration:4e3})}else{const{data:{user:t}}=await ba.auth.getUser();t&&await ba.from("profiles").update({subscription_plan:e}).eq("id",t.id),o(e),r(!0),i({title:" Checkout in-app aperto",description:`Completa il pagamento per il piano ${e}`})}}catch(n){console.error(" M1SSION Upgrade error:",n),i({title:" Errore durante l'operazione",description:"Si  verificato un errore. Riprova tra qualche istante.",variant:"destructive",duration:5e3})}},d=()=>{r(!1),o("")};return Ze.useEffect(()=>{const i=ba.channel("profiles-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles"},i=>{i.new&&i.new.id&&ba.auth.getUser().then(({data:{user:a}})=>{if(a&&a.id===i.new.id){const a=i.new.subscription_tier||i.new.tier;a&&a!==e&&(t(a),localStorage.setItem("userTier",a),"Base"!==a&&Ki.success(` Piano ${a} sincronizzato!`,{description:"Il tuo abbonamento  ora attivo",duration:4e3}))}})}).subscribe();return()=>{ba.removeChannel(i)}},[e]),se.jsxs("section",{className:"w-full px-4 pb-10",children:[se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-12",children:[se.jsx(pz,{title:"Base",price:"Gratis",period:"mese",features:l("Base"),isPopular:!1,ctaText:"Base"===e?"Piano Attuale":"Passa a Base",type:"Base",onClick:()=>c("Base"),isActive:"Base"===e}),se.jsx(pz,{title:"Silver",price:xz("Silver"),period:"mese",features:l("Silver"),isPopular:!1,ctaText:"Silver"===e?"Piano Attuale":"Passa a Silver",type:"Silver",onClick:()=>c("Silver"),isActive:"Silver"===e}),se.jsx(pz,{title:"Gold",price:xz("Gold"),period:"mese",features:l("Gold"),isPopular:!0,ctaText:"Gold"===e?"Piano Attuale":"Passa a Gold",type:"Gold",onClick:()=>c("Gold"),isActive:"Gold"===e}),se.jsx(pz,{title:"Black",price:xz("Black"),period:"mese",features:l("Black"),isPopular:!1,ctaText:"Black"===e?"Piano Attuale":"Passa a Black",type:"Black",onClick:()=>c("Black"),isActive:"Black"===e}),se.jsx(pz,{title:"Titanium",price:xz("Titanium"),period:"mese",features:l("Titanium"),isPopular:!1,ctaText:"Titanium"===e?"Piano Attuale":"Passa a Titanium",type:"Titanium",onClick:()=>{c("Titanium")},isActive:"Titanium"===e})]}),"Base"!==e&&se.jsx("div",{className:"flex justify-center mb-10",children:se.jsx(mo,{variant:"outline",onClick:async()=>{if("Base"!==e)try{await c("Base");const e=await(async(e=3)=>{for(let a=0;a<e;a++)try{const{data:i,error:s}=await ba.functions.invoke("verify-subscription-sync");if(s){console.error(` M1SSION Verify error (attempt ${a+1}):`,s);continue}if("Base"===i?.tier)return t("Base"),!0;a<e-1&&await new Promise(e=>setTimeout(e,2e3))}catch(i){console.error(` M1SSION Verify attempt ${a+1} failed:`,i)}return!1})();i(e?{title:" Abbonamento cancellato",description:"Il tuo abbonamento  stato cancellato con successo"}:{title:" Cancellazione in corso",description:"La cancellazione potrebbe richiedere alcuni minuti",variant:"destructive"})}catch(a){console.error(" M1SSION Cancel subscription error:",a),i({title:" Errore cancellazione",description:"Riprova tra qualche istante",variant:"destructive"})}else i({title:"Nessun abbonamento attivo",description:"Hai gi il piano base gratuito"})},className:"border-red-500 text-red-500 hover:bg-red-500/10",children:"Cancella abbonamento"})}),s&&(()=>{const e=gz(n)||399;return se.jsx(eN,{config:{type:"subscription",amount:e,description:`Piano ${n} con accesso premium`,plan:n,metadata:{subscription_plan:n,mission:"M1SSION",reset_date:"2025-07-22"}},onSuccess:async e=>{await(async()=>{r(!1),t(n);try{await a(n),Ki.success(` Piano ${n} attivato!`,{description:"Il tuo abbonamento  ora attivo",duration:6e3})}catch(e){console.error(" M1SSION Error refreshing subscription:",e)}})()},onCancel:d})})()]})},yz=()=>se.jsxs("section",{className:"w-full py-10 px-4 backdrop-blur-lg bg-white/5 border border-white/10 rounded-xl mx-auto max-w-3xl mb-12",children:[se.jsx("h2",{className:"text-2xl font-bold mb-8 text-center bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent",children:"Vantaggi dei Piani Premium"}),se.jsxs("div",{className:"space-y-4 max-w-xl mx-auto",children:[se.jsxs("div",{className:"flex items-center p-3 bg-white/5 rounded-lg",children:[se.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center mr-4 flex-shrink-0",children:se.jsx(os,{className:"w-5 h-5 text-white"})}),se.jsx("span",{className:"text-white/90",children:"Pi indizi per aumentare le possibilit di vittoria"})]}),se.jsxs("div",{className:"flex items-center p-3 bg-white/5 rounded-lg",children:[se.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center mr-4 flex-shrink-0",children:se.jsx(os,{className:"w-5 h-5 text-white"})}),se.jsx("span",{className:"text-white/90",children:"Accesso anticipato a nuovi eventi e premi esclusivi"})]}),se.jsxs("div",{className:"flex items-center p-3 bg-white/5 rounded-lg",children:[se.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center mr-4 flex-shrink-0",children:se.jsx(os,{className:"w-5 h-5 text-white"})}),se.jsx("span",{className:"text-white/90",children:"Badge speciale nel profilo utente"})]})]})]}),wz=()=>se.jsxs("section",{className:"w-full py-10 px-4 mb-12",children:[se.jsx("h2",{className:"text-2xl font-bold mb-8 text-center bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent",children:"Domande Frequenti"}),se.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto",children:[se.jsxs("div",{className:"glass-card",children:[se.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Cosa succede dopo aver acquistato un abbonamento?"}),se.jsx("p",{className:"text-white/70",children:"Subito dopo l'acquisto avrai accesso ai vantaggi del piano selezionato."})]}),se.jsxs("div",{className:"glass-card",children:[se.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Posso cambiare piano in qualsiasi momento?"}),se.jsx("p",{className:"text-white/70",children:"S, puoi cambiare o annullare il tuo abbonamento in qualsiasi momento dalle impostazioni del profilo."})]}),se.jsxs("div",{className:"glass-card",children:[se.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Come vengono gestiti i pagamenti?"}),se.jsx("p",{className:"text-white/70",children:"I pagamenti sono gestiti in totale sicurezza tramite Stripe."})]})]})]}),Nz=()=>{const[,e]=Ai(),{subscription:t}=VS(),[i,a]=We.useState(t.plan),[s,r]=We.useState(null),{processSubscription:n,loading:o}=xw(),l=()=>se.jsx("div",{className:"flex items-center",children:se.jsx(mo,{variant:"ghost",size:"icon",onClick:()=>{e("/home")},className:"mr-2",children:se.jsx(Za,{className:"h-5 w-5"})})});We.useEffect(()=>{r(localStorage.getItem("profileImage")),a(t.plan);const e=new URLSearchParams(window.location.search),i=e.get("checkout"),s=e.get("tier"),n=e.get("upgrade"),o=e.get("from"),l=e.get("current_plan");i&&s?c(s):"true"===n&&"access-blocked"===o&&"base"===l&&setTimeout(()=>{const e=document.querySelector('[data-plan="Silver"]');e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("ring-2","ring-purple-500","ring-pulse"))},1e3)},[t.plan,n]);const c=async e=>{try{if(!n)return void Ki.error("Sistema di pagamento non disponibile");if(o)return;await n(e),Ki.success(` Checkout ${e} attivato - reindirizzamento in corso...`)}catch(t){console.error(" M1SSION Stripe checkout error:",t),Ki.error(" Errore nel sistema di pagamento. Contatta l'assistenza.")}};return se.jsxs("div",{className:"bg-gradient-to-b from-[#131524]/70 to-black w-full",style:{height:"100dvh",overflow:"hidden",position:"relative"},children:[se.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",style:{height:"72px",paddingTop:"env(safe-area-inset-top, 47px)",background:"rgba(19, 21, 33, 0.55)",backdropFilter:"blur(12px)"},children:se.jsx(ad,{profileImage:s,leftComponent:se.jsx(l,{})})}),se.jsx("main",{style:{paddingTop:"calc(72px + env(safe-area-inset-top, 47px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px))",height:"100dvh",overflowY:"auto",position:"relative",zIndex:0},children:se.jsxs("div",{className:"max-w-screen-xl mx-auto",children:[se.jsx(mz,{}),se.jsx(vz,{selected:i,setSelected:a}),se.jsx(yz,{}),se.jsx(wz,{})]})})]})},jz=()=>{const[e,t]=We.useState({name:"",email:"",password:"",confirmPassword:""}),[i,a]=We.useState({}),[s,r]=We.useState(!1),{navigate:n}=yl();return{formData:e,errors:i,isSubmitting:s,handleChange:e=>{const{id:s,value:r}=e.target;t(e=>({...e,[s]:r})),i[s]&&a(e=>({...e,[s]:""}))},handleSubmit:async(t,i,s)=>{t.preventDefault(),e.email,e.password.length;const o=(e=>{const t={};return e.name||(t.name="Il nome  obbligatorio"),e.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="Formato email non valido"):t.email="L'email  obbligatoria",e.password?e.password.length<8?t.password="La password deve contenere almeno 8 caratteri":/[A-Z]/.test(e.password)&&/[a-z]/.test(e.password)&&/[0-9]/.test(e.password)||(t.password="La password deve contenere almeno una lettera maiuscola, una minuscola e un numero"):t.password="La password  obbligatoria",e.confirmPassword?e.password!==e.confirmPassword&&(t.confirmPassword="Le password non coincidono"):t.confirmPassword="Conferma la password",{isValid:0===Object.keys(t).length,errors:t}})(e);if(!o.isValid)return o.errors,void a(o.errors);r(!0);const{name:l,email:c,password:d}=e;try{const e=await ba.auth.signUp({email:c,password:d,options:{emailRedirectTo:window.location.origin+"/choose-plan",data:{full_name:l,mission_preference:s||null,subscription_plan:null,access_enabled:!1,status:"registered_pending"}}});if(!e.error&&e.data.user){try{const{data:t}=await ba.from("profiles").select("agent_code").eq("id",e.data.user.id).single();t?.agent_code&&await ba.functions.invoke("send-registration-notification",{body:{userId:e.data.user.id,email:e.data.user.email,agentCode:t.agent_code,fullName:l}})}catch(u){console.error(" Errore invio notifiche:",u)}return Ki.success("Registrazione completata!",{description:"Controlla la tua email per il codice agente. Ora scegli il tuo piano di abbonamento."}),void setTimeout(()=>{n("/choose-plan")},1500)}if(e.error&&e.error.message.includes("captcha")){const{data:e,error:t}=await ba.functions.invoke("register-bypass",{body:{email:c,password:d,fullName:l,missionPreference:s||null,subscriptionPlan:null,accessEnabled:!1,status:"registered_pending"}});if(t)return console.error(" M1SSION bypass registration failed:",t),void Ki.error("Errore nel bypass",{description:t.message||"Errore durante la registrazione con bypass.",duration:3e3});if(e?.success){try{const{data:e}=await ba.rpc("generate_unique_agent_code"),t=e||"AG-TEMP";await ba.functions.invoke("send-registration-notification",{body:{userId:"bypass-user",email:c,agentCode:t,fullName:l}})}catch(u){console.error(" Errore invio notifiche bypass:",u)}return Ki.success("Registrazione completata!",{description:"Controlla la tua email per il codice agente. Ora scegli il tuo piano di abbonamento.",duration:4e3}),void setTimeout(()=>{n("/choose-plan")},1500)}}const t=e.error?.message||"Errore sconosciuto durante la registrazione";console.error(" Both M1SSION registration methods failed:",t),Ki.error("Errore",{description:t,duration:3e3})}catch(h){console.error(" M1SSION registration exception:",h),Ki.error("Errore",{description:h.message||"Si  verificato un errore. Riprova pi tardi.",duration:3e3})}finally{r(!1)}}}},Sz=({missionPreference:e})=>{const{formData:t,errors:i,isSubmitting:a,handleChange:s,handleSubmit:r}=jz();return se.jsxs("form",{onSubmit:i=>{t.email,r(i,"BYPASS_COMPLETELY_DISABLED",e)},className:"space-y-6",children:[se.jsx(_l,{id:"name",type:"text",label:"Nome",placeholder:"Inserisci il tuo nome",value:t.name,onChange:s,icon:se.jsx(Lr,{className:"h-4 w-4"}),error:i.name}),se.jsx(_l,{id:"email",type:"email",label:"Email",placeholder:"Inserisci la tua email",value:t.email,onChange:s,icon:se.jsx(Gs,{className:"h-4 w-4"}),error:i.email}),se.jsx(_l,{id:"password",type:"password",label:"Password",placeholder:"Crea una password sicura",value:t.password,onChange:s,icon:se.jsx(Zs,{className:"h-4 w-4"}),error:i.password}),se.jsx(_l,{id:"confirmPassword",type:"password",label:"Conferma Password",placeholder:"Ripeti la tua password",value:t.confirmPassword,onChange:s,icon:se.jsx(Zs,{className:"h-4 w-4"}),error:i.confirmPassword}),se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:se.jsx(mo,{type:"submit",disabled:a,className:"w-full bg-gradient-to-r from-cyan-400 to-blue-600 hover:shadow-glow",children:a?se.jsxs(se.Fragment,{children:[se.jsx(Hs,{className:"mr-2 h-4 w-4 animate-spin"}),"Registrazione in corso..."]}):"Registrati"})})]})},_z=({className:e})=>se.jsxs("div",{className:`text-center mb-8 relative ${e}`,children:[se.jsxs("h1",{className:"mission-heading",children:[se.jsx("span",{style:{color:"#00E5FF"},className:"text-[#00E5FF]",children:"M1"}),se.jsxs("span",{style:{color:"#FFFFFF"},className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]})]}),se.jsx("p",{className:"text-white/70 mb-2",children:"Crea il tuo account"}),se.jsx("div",{className:"line-glow"}),se.jsx("div",{className:"mission-motto mt-2",children:"IT IS POSSIBLE"})]});const kz=()=>{const{preference:e}=function(){Ai();const e=window.location.search,t=new URLSearchParams(e),i={};return t.forEach((e,t)=>{i[t]=String(e).valueOf()}),i}(),[t,i]=We.useState(null),{navigate:a}=yl();return We.useEffect(()=>{"uomo"!==e&&"donna"!==e||i(e)},[e]),se.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-black px-4 py-12 relative overflow-hidden",children:[se.jsx(Cl,{count:15}),se.jsxs(et.div,{className:"w-full max-w-md z-10",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[se.jsx(_z,{}),t&&se.jsxs(et.div,{className:"mb-6 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2,duration:.5},children:[se.jsxs("p",{className:"text-sm text-white/70",children:["Hai scelto le missioni",se.jsx("span",{className:"font-bold text-[#00D1FF] mx-1",children:"uomo"===t?"UOMO":"DONNA"})]}),se.jsx(mo,{variant:"link",className:"text-xs text-white/50 hover:text-white/70 p-0 mt-1",onClick:()=>a("/select-mission"),children:"Cambia la tua preferenza"})]}),se.jsx("div",{className:"glass-card p-6 backdrop-blur-md border border-gray-800 rounded-xl",children:se.jsx(Sz,{missionPreference:t})}),se.jsxs("div",{className:"mt-6 text-center space-y-4",children:[se.jsx("p",{className:"text-sm text-white/50",children:"Registrandoti accetti i nostri Termini e Condizioni e la nostra Informativa sulla Privacy."}),se.jsxs("p",{className:"text-sm text-white/70",children:["Hai gi un account?"," ",se.jsx(Ti,{to:"/login",className:"text-cyan-400 hover:text-cyan-300 transition-colors",children:"Accedi"})]})]})]})]})};const Cz=()=>{const[e,t]=We.useState(""),[i,a]=We.useState(""),[s,r]=We.useState(!1);$l();const{toast:n}=mc();return se.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black p-4 pt-20",children:se.jsx("div",{className:"max-w-2xl mx-auto",children:se.jsxs(Wl,{className:"bg-black/80 border-[#00D1FF]/30 backdrop-blur-xl",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-2xl font-orbitron text-white flex items-center gap-3",children:[se.jsx(Xa,{className:"w-6 h-6 text-[#00D1FF]"})," Firebase Push Notifications - M1SSION"]})}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{children:[se.jsx("label",{className:"block text-white/70 text-sm font-medium mb-2",children:"Titolo notifica Firebase"}),se.jsx(Sl,{value:e,onChange:e=>t(e.target.value),placeholder:"Inserisci il titolo Firebase...",className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",maxLength:50}),se.jsxs("p",{className:"text-white/50 text-xs mt-1",children:[e.length,"/50 caratteri"]})]}),se.jsxs("div",{children:[se.jsx("label",{className:"block text-white/70 text-sm font-medium mb-2",children:"Messaggio"}),se.jsx(Wb,{value:i,onChange:e=>a(e.target.value),placeholder:"Inserisci il messaggio della notifica Firebase...",className:"bg-white/5 border-white/20 text-white placeholder:text-white/50 min-h-[120px]",maxLength:200}),se.jsxs("p",{className:"text-white/50 text-xs mt-1",children:[i.length,"/200 caratteri"]})]})]}),se.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/30 rounded-lg p-4",children:[se.jsx("h3",{className:"text-orange-400 font-medium mb-2",children:" Anteprima notifica Firebase:"}),se.jsx("div",{className:"bg-black/50 rounded-lg p-3 border border-white/10",children:se.jsxs("div",{className:"flex items-start gap-3",children:[se.jsx("div",{className:"w-6 h-6 bg-orange-500 rounded-sm flex-shrink-0 flex items-center justify-center",children:se.jsx("span",{className:"text-black text-xs font-bold",children:""})}),se.jsxs("div",{className:"flex-1",children:[se.jsx("h4",{className:"text-white font-medium text-sm",children:e||"Titolo notifica Firebase"}),se.jsx("p",{className:"text-white/70 text-sm",children:i||"Messaggio della notifica Firebase"})]})]})})]}),se.jsx(mo,{onClick:async()=>{if(e.trim()&&i.trim()){r(!0);try{await ba.from("admin_logs").insert({event_type:"webpush_admin_broadcast",note:`Admin Page Send - Title: ${e}, Body: ${i}`,context:"admin_page_notification"});const s=await async function(e){const{data:{session:t}}=await ba.auth.getSession();if(!t?.access_token)throw new Error("Not authenticated");const{data:i,error:a}=await ba.functions.invoke("webpush-admin-broadcast",{body:e});if(a)throw a;return i}({title:e.trim(),body:i.trim(),url:"/notifications",target:{all:!0}});n({title:" Push notifica inviata",description:`Inviata a ${s?.success||0}/${s?.total||0} dispositivi`}),t(""),a("")}catch(s){console.error("Error sending push notification:",s),s.message.includes("Unauthorized")||s.message.includes("401")?n({title:" Accesso negato",description:"Solo gli admin possono inviare notifiche.",variant:"destructive"}):n({title:" Errore invio",description:s.message||"Impossibile inviare la notifica.",variant:"destructive"})}finally{r(!1)}}else n({title:" Campi obbligatori",description:"Inserisci titolo e messaggio.",variant:"destructive"})},disabled:s||!e.trim()||!i.trim(),className:"w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-medium",children:s?se.jsxs(se.Fragment,{children:[se.jsx("div",{className:"w-4 h-4 border-2 border-white/20 border-t-white rounded-full animate-spin mr-2"})," Invio Firebase in corso..."]}):se.jsxs(se.Fragment,{children:[se.jsx(fr,{className:"w-4 h-4 mr-2"})," Invia notifica Firebase a tutti"]})}),se.jsx("p",{className:"text-white/50 text-xs text-center",children:" La notifica verr inviata tramite Firebase Cloud Messaging a tutti i dispositivi con token FCM attivi."})]})]})})})},Az=[{value:"BUZZ_FREE",label:"Buzz Gratuiti",description:"Buzz che non costano nulla"},{value:"MESSAGE",label:"Messaggio",description:"Messaggio testuale personalizzato"},{value:"XP_POINTS",label:"Punti XP",description:"Punti esperienza per il giocatore"},{value:"EVENT_TICKET",label:"Ticket Evento",description:"Biglietto per evento speciale"},{value:"BADGE",label:"Badge",description:"Badge da assegnare al giocatore"}],zz=()=>{const[e,t]=We.useState(!1),[,i]=Ai(),[a,s]=We.useState([{type:"BUZZ_FREE",count:0}]),[r,n]=We.useState(!1),[o,l]=We.useState(""),[c,d]=We.useState({minLat:"",minLng:"",maxLat:"",maxLng:""}),[u,h]=We.useState(!1),[m,p]=We.useState(!1),[f,g]=We.useState(null),[x,b]=We.useState({}),[v,y]=We.useState(""),[w,N]=We.useState(null),[j,S]=We.useState(null);Ze.useEffect(()=>{(async()=>{const{data:{user:e}}=await ba.auth.getUser();if(e?.id){const{data:t,error:i}=await ba.from("profiles").select("role").eq("id",e.id).maybeSingle(),a=!!t&&["admin","owner"].some(e=>t.role?.toLowerCase?.().includes(e));p(a)}})()},[]);const _=(e,t,i)=>{const r=[...a];r[e]="payload"===t?{...r[e],payload:i}:{...r[e],[t]:i},s(r)},k=(e,t,i)=>{const r=[...a];r[e]={...r[e],payload:{...r[e].payload,[t]:i}},s(r)},C=()=>a.reduce((e,t)=>e+t.count,0);return se.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[se.jsxs("div",{className:"mb-8",children:[se.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink bg-clip-text text-transparent",children:"M1SSION PANEL"}),se.jsx("p",{className:"text-muted-foreground mt-2",children:"Strumenti amministrativi per la gestione dei marker sulla Buzz Map"})]}),se.jsxs("div",{className:"grid gap-6",children:[se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"text-xs text-muted-foreground p-2 bg-gray-900 rounded",children:["Debug: isAdmin = ",m.toString()]}),se.jsxs(se.Fragment,{children:[se.jsxs(Wl,{className:"border-purple-500/20 hover:border-purple-500/40 transition-colors",children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(fr,{className:"h-5 w-5 text-purple-400"}),"Admin Push Console"]}),se.jsx(Vl,{children:"Invio notifiche push broadcast a tutti gli utenti - Solo Amministratori"})]}),se.jsx(Gl,{children:se.jsx(mo,{onClick:()=>i("/panel/push-admin"),variant:"outline",className:"w-full",children:"Apri Admin Console"})})]}),se.jsxs(Wl,{className:"border-blue-500/20 hover:border-blue-500/40 transition-colors",children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(fr,{className:"h-5 w-5 text-blue-400"}),"Push Console"]}),se.jsx(Vl,{children:"Invio notifiche push mirate a segmenti specifici o liste utenti"})]}),se.jsx(Gl,{children:se.jsx(mo,{onClick:()=>i("/panel/push"),variant:"outline",className:"w-full",children:"Apri Push Console"})})]})]})]}),m&&se.jsx(Wl,{className:"border-emerald-500/20",children:se.jsxs(Gl,{className:"pt-4 flex items-center justify-between gap-4",children:[se.jsxs("div",{className:"text-sm",children:[se.jsx("div",{className:"font-medium",children:"Markers Healthcheck"}),se.jsx("div",{className:"text-muted-foreground",children:"Diagnostica Edge Function e readback DB (solo lettura)"})]}),se.jsx(mo,{onClick:()=>i("/dev/markers-healthcheck"),variant:"outline",children:"Apri"})]})}),se.jsxs(Wl,{className:"border-cyan-500/20 hover:border-cyan-500/40 transition-colors",children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(Ks,{className:"h-5 w-5 text-cyan-400"}),"Bulk Marker Drop"]}),se.jsx(Vl,{children:"Genera e distribuisce marker casuali sulla Buzz Map con reward personalizzati"})]}),se.jsxs(Gl,{children:[se.jsx(mo,{onClick:()=>t(!e),variant:"outline",className:"w-full",children:e?"Chiudi":"Configura Distribuzione"}),e&&se.jsxs("div",{className:"mt-6 space-y-6",children:[se.jsxs("div",{children:[se.jsxs("div",{className:"flex items-center justify-between mb-4",children:[se.jsx(jl,{className:"text-lg font-semibold",children:"Distribuzione Reward"}),se.jsxs(mo,{onClick:()=>{s([...a,{type:"BUZZ_FREE",count:0}])},size:"sm",variant:"outline",children:[se.jsx(nr,{className:"h-4 w-4 mr-2"}),"Aggiungi"]})]}),se.jsx("div",{className:"space-y-4",children:a.map((e,t)=>se.jsx(Wl,{className:"border-gray-700",children:se.jsx(Gl,{className:"pt-4",children:se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-start",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:`type-${t}`,children:"Reward Type"}),se.jsxs(SA,{value:e.type,onValueChange:e=>_(t,"type",e),children:[se.jsx(kA,{children:se.jsx(_A,{})}),se.jsx(zA,{children:Az.map(e=>se.jsx(EA,{value:e.value,children:e.label},e.value))})]})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:`count-${t}`,children:"Count"}),se.jsx(Sl,{id:`count-${t}`,type:"number",min:"0",value:e.count,onChange:e=>_(t,"count",parseInt(e.target.value)||0)})]}),se.jsxs("div",{children:[se.jsx(jl,{children:"Payload"}),"MESSAGE"===e.type&&se.jsx(Sl,{placeholder:"Testo messaggio",value:e.payload?.text||"",onChange:e=>k(t,"text",e.target.value)}),"XP_POINTS"===e.type&&se.jsx(Sl,{type:"number",placeholder:"Punti XP",min:"1",value:e.payload?.points||"",onChange:e=>k(t,"points",parseInt(e.target.value)||0)}),"EVENT_TICKET"===e.type&&se.jsx(Sl,{placeholder:"Event ID",value:e.payload?.event_id||"",onChange:e=>k(t,"event_id",e.target.value)}),"BADGE"===e.type&&se.jsx(Sl,{placeholder:"Badge ID",value:e.payload?.badge_id||"",onChange:e=>k(t,"badge_id",e.target.value)}),"BUZZ_FREE"===e.type&&se.jsx(Sl,{type:"number",placeholder:"Quantit (default: 1)",min:"1",value:e.payload?.amount||1,onChange:e=>k(t,"amount",parseInt(e.target.value)||1)})]}),se.jsx("div",{className:"flex items-end",children:se.jsx(mo,{onClick:()=>(e=>{s(a.filter((t,i)=>i!==e))})(t),variant:"destructive",size:"sm",disabled:a.length<=1,children:se.jsx(Ar,{className:"h-4 w-4"})})})]})})},t))}),se.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[se.jsxs(fc,{variant:"secondary",children:["Totale: ",C()," marker"]}),a.some(e=>"EVENT_TICKET"===e.type&&e.count>1)&&se.jsxs("div",{className:"flex items-center gap-2 text-amber-500",children:[se.jsx(Er,{className:"h-4 w-4"}),se.jsx("span",{children:"Event ticket con count maggiore di 1 rilevato"})]})]})]}),se.jsxs("div",{children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(rd,{id:"advanced",checked:r,onCheckedChange:n}),se.jsx(jl,{htmlFor:"advanced",children:"Opzioni Avanzate"})]}),r&&se.jsxs("div",{className:"mt-4 space-y-4 p-4 border border-gray-700 rounded-lg",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"seed",children:"Seed (Generazione Deterministica)"}),se.jsx(Sl,{id:"seed",placeholder:"es. M1SSION-2025-01",value:o,onChange:e=>l(e.target.value)})]}),se.jsxs("div",{children:[se.jsx(jl,{children:"Bounding Box (opzionale - default: mondo intero)"}),se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mt-2",children:[se.jsx(Sl,{placeholder:"Min Lat",type:"number",step:"0.000001",value:c.minLat,onChange:e=>d({...c,minLat:e.target.value})}),se.jsx(Sl,{placeholder:"Min Lng",type:"number",step:"0.000001",value:c.minLng,onChange:e=>d({...c,minLng:e.target.value})}),se.jsx(Sl,{placeholder:"Max Lat",type:"number",step:"0.000001",value:c.maxLat,onChange:e=>d({...c,maxLat:e.target.value})}),se.jsx(Sl,{placeholder:"Max Lng",type:"number",step:"0.000001",value:c.maxLng,onChange:e=>d({...c,maxLng:e.target.value})})]})]})]})]}),se.jsx("div",{className:"pt-4",children:se.jsx(mo,{onClick:async()=>{const e=(()=>{const e=[];return a.reduce((e,t)=>e+t.count,0)<=0&&e.push("La somma totale dei marker deve essere > 0"),a.forEach((t,i)=>{t.count<0&&e.push(`Count alla riga ${i+1} deve essere  0`),"MESSAGE"!==t.type||t.payload?.text&&""!==t.payload.text.trim()||e.push(`Messaggio richiesto alla riga ${i+1}`),"XP_POINTS"===t.type&&(!t.payload?.points||t.payload.points<=0)&&e.push(`Punti XP richiesti (> 0) alla riga ${i+1}`),"BADGE"!==t.type||t.payload?.badge_id&&""!==t.payload.badge_id.trim()||e.push(`Badge ID richiesto alla riga ${i+1}`),"EVENT_TICKET"===t.type&&t.count>1&&e.push(`Warning: Event ticket count > 1 alla riga ${i+1} (tipico = 1)`)}),{valid:0===e.length,errors:e}})();if(e.valid){h(!0);try{const{data:{session:e}}=await ba.auth.getSession();if(!e)return void Ki.error("Nessuna sessione di autenticazione");const r={distributions:a,seed:o.trim()||void 0};c.minLat&&c.minLng&&c.maxLat&&c.maxLng&&(r.bbox={minLat:parseFloat(c.minLat),minLng:parseFloat(c.minLng),maxLat:parseFloat(c.maxLat),maxLng:parseFloat(c.maxLng)});const n=await fetch(`${pa}/create-random-markers?debug=1`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk"},body:JSON.stringify(r)}),u=await n.text();n.status,g(n.status),y(u);const h={};["content-type","date","x-edge-functions-region","cf-ray","server","content-length"].forEach(e=>{const t=n.headers.get(e);t&&(h[e]=t)}),b(h);let m=null;try{m=JSON.parse(u)}catch(i){return console.error("Failed to parse response as JSON:",u),void Ki.error(`Risposta non valida: ${n.status} ${n.statusText}`)}if(N(m),m?.request_id&&S(m.request_id),!n.ok){console.error("Edge Function error:",{status:n.status,statusText:n.statusText,body:m});const e=m?.error||`HTTP ${n.status}`,t=m?.request_id?` (${m.request_id})`:"";return void Ki.error(`Errore Edge Function: ${e}${t}`)}a.reduce((e,t)=>e+t.count,0);Ki.success(` ${m.created} marker creati con successo!`,{description:`Drop ID: ${m.drop_id}`,action:{label:"Vedi su Buzz Map",onClick:()=>window.open("/map","_blank")}}),m.drop_id,m.created,s([{type:"BUZZ_FREE",count:0}]),l(""),d({minLat:"",minLng:"",maxLat:"",maxLng:""}),t(!1)}catch(r){console.error("Network error:",r),Ki.error(`Errore di rete: ${r instanceof Error?r.message:"Sconosciuto"}`)}finally{h(!1)}}else e.errors.forEach(e=>Ki.error(e))},disabled:u||C()<=0,className:"w-full bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink hover:opacity-90",children:u?"Creazione in corso...":"Lancia Marker"})})]})]})]})]})]})};async function Ez(){const e=performance.now();try{const t=await async function(){if(!("serviceWorker"in navigator))throw new Error("Service Worker non supportato");return(await navigator.serviceWorker.getRegistrations()).some(e=>e.active?.scriptURL.includes("/sw.js"))||await navigator.serviceWorker.register("/sw.js",{scope:"/"}),navigator.serviceWorker.ready}();if(!(await async function(){if(!("Notification"in window))throw new Error("Notification API non supportata");if("denied"===Notification.permission)return!1;if("default"===Notification.permission)return"granted"===await Notification.requestPermission();return!0}()))return{ok:!1,status:"permission_denied",message:"Permesso notifiche negato"};const i=await async function(e){const t=await e.pushManager.getSubscription();if(t)return t;const{loadVAPIDPublicKey:i,urlBase64ToUint8Array:a}=await ae(async()=>{const{loadVAPIDPublicKey:e,urlBase64ToUint8Array:t}=await import("./vapid-loader.p0s-TRMN.js");return{loadVAPIDPublicKey:e,urlBase64ToUint8Array:t}},[]),s=await i(),r="string"==typeof s?a(s):s;return await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r})}(t);await async function(e){const{data:{session:t}}=await ba.auth.getSession();if(!t?.access_token)throw new Error("Sessione scaduta: effettua il login");const i=e.toJSON(),a=i?.keys||{};if(!a.p256dh||!a.auth)throw new Error("Chiavi subscription mancanti");const s=e.endpoint.includes("web.push.apple.com")?"ios":"web",{error:r}=await ba.functions.invoke("webpush-upsert",{body:{endpoint:e.endpoint,keys:{p256dh:a.p256dh,auth:a.auth},provider:"webpush",platform:s,ua:navigator.userAgent}});if(r)throw console.error("[SubscribeFlow] Upsert failed:",r),new Error(r.message||"Upsert fallito")}(i);const a=Math.round(performance.now()-e);return{ok:!0,status:"ready",endpoint:i.endpoint,message:`Ready in ${a}ms`}}catch(t){const i=Math.round(performance.now()-e);return console.error(`[SubscribeFlow] FAILED after ${i}ms:`,t),{ok:!1,status:"error",error:t?.message||"Errore sconosciuto",message:`Failed after ${i}ms`}}}const Iz=!1,Pz=!0,Tz=()=>{const{isSupported:e,permission:t,isSubscribed:i,loading:a,requestPermission:s,subscribe:r}=RA(),n=/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,o=window.matchMedia("(display-mode: standalone)").matches,l=n&&o?{icon:se.jsx(yr,{className:"w-4 h-4"}),label:"iOS PWA",description:"VAPID Push"}:{icon:se.jsx(tr,{className:"w-4 h-4"}),label:"Desktop",description:"Firebase FCM"};return e?se.jsxs("div",{className:"flex items-center justify-between p-4 bg-card rounded-lg border",children:[se.jsxs("div",{className:"flex items-center space-x-3",children:[i?se.jsx(Xa,{className:"w-5 h-5 text-primary"}):se.jsx(Ka,{className:"w-5 h-5 text-muted-foreground"}),se.jsxs("div",{children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(jl,{htmlFor:"push-notifications",children:"Push Notifications"}),se.jsxs(fc,{variant:"outline",className:"flex items-center gap-1",children:[l.icon,se.jsx("span",{className:"text-xs",children:l.label})]})]}),se.jsxs("p",{className:"text-xs text-muted-foreground",children:[i?"Attive":"Disattivate","  ",l.description]}),"denied"===t&&se.jsx("p",{className:"text-xs text-destructive",children:"Permessi negati. Abilitali nelle impostazioni del browser."})]})]}),se.jsx(rd,{id:"push-notifications",checked:i,onCheckedChange:async()=>{try{if(i)Ki.info("Le notifiche possono essere disattivate dalle Impostazioni del dispositivo.");else{if(Pz){const e=await Ez();return void(e.ok?Ki.success("Notifiche attivate! "):"permission_denied"===e.status?Ki.warning("Permesso negato. Abilita le notifiche nelle impostazioni di sistema."):Ki.error(`Errore attivazione: ${e.error??"sconosciuto"}`))}if("granted"!==t){if(!(await s()))return}await r()}}catch(e){console.error("[M1SSION] Toggle error:",e),Ki.error(`Errore: ${e?.message??"unknown"}`)}},disabled:a||"denied"===t})]}):se.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-muted/20 rounded-lg",children:[se.jsx(Ka,{className:"w-5 h-5 text-muted-foreground"}),se.jsxs("div",{children:[se.jsx(jl,{className:"text-muted-foreground",children:"Push Notifications"}),se.jsx("p",{className:"text-xs text-muted-foreground",children:"Not supported on this device"})]})]})};async function Mz(e){if(!e?.pushManager)throw new Error("PushManager non disponibile");const{loadVAPIDPublicKey:t,urlBase64ToUint8Array:i}=await ae(async()=>{const{loadVAPIDPublicKey:e,urlBase64ToUint8Array:t}=await import("./vapid-loader.p0s-TRMN.js");return{loadVAPIDPublicKey:e,urlBase64ToUint8Array:t}},[]),a=await t(),s="string"==typeof a?i(a):a,r=await e.pushManager.getSubscription();return r||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:s})}const Lz=()=>{const{user:e}=$l(),[t,i]=We.useState("idle");return se.jsxs("div",{className:"space-y-3",children:[se.jsxs("div",{className:"text-sm text-muted-foreground",children:["User: ",e?.id??"anon"]}),se.jsxs("div",{className:"text-sm",children:["Status: ",se.jsx("code",{children:t})]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsx(mo,{variant:"secondary",onClick:()=>{const e="undefined"!=typeof window&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window;i(e?"supported":"not_supported"),Ki[e?"success":"error"](e?"Push support OK":"Push not supported on this device")},children:"Check support"}),se.jsx(mo,{variant:"secondary",onClick:async()=>{const e=await async function(){try{return"granted"===await Notification.requestPermission()}catch{return!1}}();i(e?"permission_granted":"permission_denied"),Ki[e?"success":"error"](e?"Permission granted":"Permission denied")},children:"Ask permission"}),se.jsx(mo,{onClick:async()=>{try{i("registering");const e=await navigator.serviceWorker.ready;await Mz(e);i("registered"),Ki.success("Registered for push")}catch(e){i("error"),console.error(e),Ki.error("Failed to register push")}},children:"Register push"})]})]})},Fz=()=>{const e="serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window,t=window.matchMedia("(display-mode: standalone)").matches;return se.jsxs("div",{className:"container mx-auto py-8 space-y-6",children:[se.jsxs("div",{className:"text-center space-y-2",children:[se.jsxs("h1",{className:"text-3xl font-bold flex items-center justify-center gap-2",children:[se.jsx(Xa,{className:"w-8 h-8"}),"Push Notifications Test"]}),se.jsx("p",{className:"text-muted-foreground",children:"Sistema unificato di notifiche push M1SSION"})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(vr,{className:"w-5 h-5"}),"Informazioni Ambiente"]})}),se.jsx(Gl,{children:se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx("div",{className:"text-sm font-medium",children:"Browser"}),se.jsx(fc,{variant:"outline",children:(()=>{const e=navigator.userAgent;return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Unknown"})()})]}),se.jsxs("div",{className:"space-y-1",children:[se.jsx("div",{className:"text-sm font-medium",children:"Piattaforma"}),se.jsx(fc,{variant:"outline",children:(()=>{const e=navigator.platform,t=navigator.userAgent.toLowerCase();return/ipad|iphone|ipod/.test(t)?"iOS":/android/.test(t)?"Android":e.includes("Win")?"Windows":e.includes("Mac")?"macOS":e.includes("Linux")?"Linux":e})()})]}),se.jsxs("div",{className:"space-y-1",children:[se.jsx("div",{className:"text-sm font-medium",children:"PWA"}),se.jsx(fc,{variant:t?"default":"secondary",children:t?"S":"No"})]}),se.jsxs("div",{className:"space-y-1",children:[se.jsx("div",{className:"text-sm font-medium",children:"Supporto"}),se.jsx(fc,{variant:e?"default":"destructive",children:e?"Supportato":"Non supportato"})]})]})})]}),se.jsx(Lz,{}),se.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[se.jsxs("div",{className:"space-y-4",children:[se.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[se.jsx(Wr,{className:"w-5 h-5"}),"Sistema Unificato"]}),se.jsx($A,{})]}),se.jsxs("div",{className:"space-y-4",children:[se.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[se.jsx(Xa,{className:"w-5 h-5"}),"Sistema Legacy"]}),se.jsx(Tz,{})]})]}),se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(Cr,{className:"w-5 h-5"}),"Test Notifiche"]}),se.jsx(Vl,{children:"Invia una notifica di test per verificare il funzionamento"})]}),se.jsx(Gl,{children:se.jsx(mo,{onClick:async()=>{try{Ki.loading("Invio notifica di test...");const{data:e,error:t}=await ba.functions.invoke("send-push-notification",{body:{title:" Test M1SSION",body:"Sistema di notifiche push funzionante!",data:{type:"test",timestamp:Date.now()}}});if(t)throw t;Ki.success(" Notifica di test inviata!")}catch(e){console.error("Test push failed:",e),Ki.error(" Test fallito")}},className:"w-full",children:" Invia Notifica di Test"})})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:"Dettagli Tecnici"})}),se.jsxs(Gl,{className:"space-y-2 text-sm",children:[se.jsxs("div",{children:[se.jsx("strong",{children:"User Agent:"})," ",navigator.userAgent]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Language:"})," ",navigator.language]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Platform:"})," ",navigator.platform]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Service Worker:"})," ","serviceWorker"in navigator?"Supportato":"Non supportato"]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Push Manager:"})," ","PushManager"in window?"Supportato":"Non supportato"]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Notifications:"})," ","Notification"in window?Notification.permission:"Non supportato"]})]})]})]})},Oz={"Content-Type":"application/json","X-M1-Dropper-Version":"v1","X-Client-Info":"m1ssion-pwa"};async function Dz(e,t){try{const{data:i,error:a}=await ba.functions.invoke(e,{body:t,headers:Oz});if(a)throw console.error(`[PUSH API] Error calling ${e}:`,a),new Error(a.message||`Error calling ${e}`);return i}catch(i){throw console.error(`[PUSH API] Exception calling ${e}:`,i),i}}function Rz(){const[,e]=Ai(),[t,i]=We.useState(""),[a,s]=We.useState(""),[r,n]=We.useState(""),[o,l]=We.useState(""),[c,d]=We.useState(""),[u,h]=We.useState(""),[m,p]=We.useState(!1);return se.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[se.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[se.jsxs(mo,{variant:"ghost",onClick:()=>e("/admin/mission-panel"),className:"flex items-center gap-2",children:[se.jsx(Za,{className:"h-4 w-4"}),"Torna al Panel"]}),se.jsxs("div",{children:[se.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink bg-clip-text text-transparent",children:"Admin Push Console"}),se.jsx("p",{className:"text-muted-foreground",children:"Invio notifiche push broadcast - Solo Amministratori"})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(fr,{className:"h-5 w-5"}),"Notifica Push Broadcast"]})}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"title",children:"Titolo *"}),se.jsx(Sl,{id:"title",value:t,onChange:e=>i(e.target.value),placeholder:"Titolo della notifica",maxLength:100})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"badge",children:"Badge"}),se.jsx(Sl,{id:"badge",value:c,onChange:e=>d(e.target.value),placeholder:"Numero badge (opzionale)",type:"number",min:"0"})]})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"body",children:"Messaggio *"}),se.jsx(Wb,{id:"body",value:a,onChange:e=>s(e.target.value),placeholder:"Contenuto della notifica",maxLength:500,rows:3})]}),se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"image",children:"URL Immagine"}),se.jsx(Sl,{id:"image",value:r,onChange:e=>n(e.target.value),placeholder:"https://example.com/image.jpg",type:"url"})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"deepLink",children:"Deep Link"}),se.jsx(Sl,{id:"deepLink",value:o,onChange:e=>l(e.target.value),placeholder:"/buzz, /map, /profile..."})]})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"testToken",children:"Token Test Device"}),se.jsx(Wb,{id:"testToken",value:u,onChange:e=>h(e.target.value),placeholder:"Token FCM o WebPush endpoint per test (opzionale)",rows:2}),se.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Se fornito, verr utilizzato anche per il test prima del broadcast"})]}),se.jsxs("div",{className:"flex gap-4 pt-4 border-t",children:[se.jsxs(mo,{onClick:async()=>{if(t.trim()&&a.trim())if(u.trim()){p(!0);try{const e=await Dz("push_test",{token:u.trim(),payload:{title:t.trim(),body:a.trim(),image:r.trim()||null,deepLink:o.trim()||null,badge:c.trim()||null}});e.ok?Ki.success(" Test inviato con successo!"):Ki.error(` Test fallito: ${e.error||"Errore sconosciuto"}`)}catch(e){console.error("Test push error:",e),Ki.error(` Errore test: ${e.message||"Errore di rete"}`)}finally{p(!1)}}else Ki.error("Token test  obbligatorio per il test");else Ki.error("Titolo e messaggio sono obbligatori")},disabled:m||!t.trim()||!a.trim()||!u.trim(),variant:"outline",className:"flex items-center gap-2",children:[se.jsx(Cr,{className:"h-4 w-4"}),m?"Invio Test...":"Invia Test"]}),se.jsxs(mo,{onClick:async()=>{if(!t.trim()||!a.trim())return void Ki.error("Titolo e messaggio sono obbligatori");if(window.confirm("Sei sicuro di voler inviare una notifica broadcast a tutti gli utenti? Questa azione non pu essere annullata.")){p(!0);try{const e={title:t.trim(),body:a.trim(),image:r.trim()||null,deepLink:o.trim()||null,badge:c.trim()||null,testToken:u.trim()||null},m=await Dz("push_admin_broadcast",e);m.ok?(Ki.success(` Broadcast inviato! ${m.sent}/${m.sent+m.failed} device raggiunti`),i(""),s(""),n(""),l(""),d(""),h("")):Ki.error(` Broadcast fallito: ${m.error||"Errore sconosciuto"}`)}catch(e){console.error("Admin broadcast error:",e),Ki.error(` Errore broadcast: ${e.message||"Errore di rete"}`)}finally{p(!1)}}},disabled:m||!t.trim()||!a.trim(),className:"flex items-center gap-2 bg-gradient-to-r from-red-600 to-red-700",children:[se.jsx(fr,{className:"h-4 w-4"}),m?"Invio Broadcast...":"Invia Broadcast Admin"]})]}),se.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[se.jsx("p",{children:" Il broadcast raggiunger tutti i device registrati con notifiche attive"}),se.jsx("p",{children:" Il test invia solo al token specificato sopra"}),se.jsx("p",{children:" I deep link permettono di aprire sezioni specifiche dell'app"})]})]})]})]})}const Bz=Object.freeze(Object.defineProperty({__proto__:null,default:Rz},Symbol.toStringTag,{value:"Module"}));ma();async function Uz(e,t){const i=performance.now();let a="",s={payload:e.payload};"all"===e.audience?(a=`${pa}/webpush-send`,s.audience="all"):"list"===e.audience&&e.filters?.ids?(a=`${pa}/webpush-targeted-send`,s.user_ids=e.filters.ids):"object"==typeof e.audience&&"user_id"in e.audience?(a=`${pa}/webpush-targeted-send`,s.user_ids=[e.audience.user_id]):(a=`${pa}/webpush-send`,s.audience="all");const r={"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk"};t.adminToken?r["x-admin-token"]=t.adminToken:t.userJWT&&(r.Authorization=`Bearer ${t.userJWT}`);const n=await fetch(a,{method:"POST",headers:r,body:JSON.stringify(s)}),o=await n.json(),l=Math.round(performance.now()-i);return{status:n.status,data:o,responseTime:l}}function qz(e,t){return e||200!==t?401===t?e?.includes("invalid_admin_token")?" Token admin errato. Verifica PUSH_ADMIN_TOKEN.":e?.includes("missing_authorization")?" Authorization header mancante. Esegui il login o usa admin token.":e?.includes("missing")||e?.includes("invalid_jwt")?" JWT mancante o non valido. Esegui il login per ottenere un token valido.":" Non autorizzato. Verifica le credenziali.":400===t?e?.includes("endpoint")?" Endpoint mancante o non valido. Verifica il formato.":e?.includes("keys")||e?.includes("p256dh")||e?.includes("auth")?" Chiavi push mancanti (p256dh/auth). Riesegui la subscription.":" Richiesta non valida. Controlla i parametri.":500===t?e?.includes("PUSH_ADMIN_TOKEN")?" Configura PUSH_ADMIN_TOKEN nei secrets di Supabase.":e?.includes("VAPID")?" VAPID keys non configurate. Verifica VAPID_PUBLIC_KEY, VAPID_PRIVATE_KEY, VAPID_CONTACT.":" Errore interno del server. Controlla i logs delle Edge Functions.":e?.includes("No active subscriptions")?" Nessuna subscription attiva trovata. Esegui (Re)Subscribe prima di inviare.":e||"Errore sconosciuto":" Success!"}function $z(){const[,e]=Ai(),[t,i]=We.useState("targeted"),[a,s]=We.useState(""),[r,n]=We.useState(""),[o,l]=We.useState(""),[c,d]=We.useState(""),[u,h]=We.useState(""),[m,p]=We.useState(""),[f,g]=We.useState(!1),[x,b]=We.useState(!1),[v,y]=We.useState(""),[w,N]=We.useState(""),[j,S]=We.useState(""),[_,k]=We.useState(""),[C,A]=We.useState(!1),[z,E]=We.useState(null),I=(r||c)&&("targeted"!==t||a.trim());return se.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white p-6",children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[se.jsx(mo,{variant:"ghost",size:"icon",onClick:()=>e("/panel-access"),children:se.jsx(Za,{className:"w-5 h-5"})}),se.jsxs("div",{children:[se.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent",children:" Push Sender"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Invio notifiche push (reuse existing logic)"})]})]}),se.jsxs("div",{className:"glass-card p-6 space-y-6",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Audience"}),se.jsxs(SA,{value:t,onValueChange:e=>i(e),children:[se.jsx(kA,{children:se.jsx(_A,{})}),se.jsxs(zA,{children:[se.jsx(EA,{value:"targeted",children:"Targeted (User IDs)"}),se.jsx(EA,{value:"all",children:"Broadcast (All)"}),se.jsx(EA,{value:"self",children:"Self Test"})]})]})]}),"targeted"===t&&se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"User IDs (CSV)"}),se.jsx(Sl,{placeholder:"uuid1, uuid2, uuid3",value:a,onChange:e=>s(e.target.value)})]}),"all"===t&&se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Admin Token"}),se.jsx(Sl,{type:"password",placeholder:"PUSH_ADMIN_TOKEN",value:_,onChange:e=>k(e.target.value)})]}),se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Title"}),se.jsx(Sl,{placeholder:" Titolo notifica",value:r,onChange:e=>n(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Badge (numero)"}),se.jsx(Sl,{type:"number",placeholder:"0",value:o,onChange:e=>l(e.target.value)})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Message"}),se.jsx(Wb,{placeholder:"Testo della notifica",value:c,onChange:e=>d(e.target.value),rows:3})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Image URL"}),se.jsx(Sl,{placeholder:"https://...",value:u,onChange:e=>h(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Link URL"}),se.jsx(Sl,{placeholder:"/notifications",value:m,onChange:e=>p(e.target.value)})]}),se.jsxs("div",{className:"border-t border-gray-700 pt-4 space-y-4",children:[se.jsx("h3",{className:"text-sm font-semibold text-gray-400",children:"Extras (opzionali)"}),se.jsxs("div",{className:"flex items-center gap-4",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(Ww,{id:"freeBuzz",checked:f,onCheckedChange:e=>g(!!e)}),se.jsx(jl,{htmlFor:"freeBuzz",className:"cursor-pointer",children:"Free Buzz"})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(Ww,{id:"freeBuzzMap",checked:x,onCheckedChange:e=>b(!!e)}),se.jsx(jl,{htmlFor:"freeBuzzMap",className:"cursor-pointer",children:"Free Buzz Map"})]})]}),se.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"XP Points"}),se.jsx(Sl,{type:"number",placeholder:"0",value:v,onChange:e=>y(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Marker Lat"}),se.jsx(Sl,{placeholder:"45.464",value:w,onChange:e=>N(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Marker Lng"}),se.jsx(Sl,{placeholder:"9.190",value:j,onChange:e=>S(e.target.value)})]})]})]}),se.jsx(mo,{className:"w-full",onClick:async()=>{if(I){A(!0),E(null);try{const e={};r&&(e.title=r),c&&(e.body=c),""!==o&&(e.badge=Number(o)||0),u&&(e.image=u),e.data={},m&&(e.data.url=m);const i={};f&&(i.free_buzz=!0),x&&(i.free_buzz_map=!0),v&&(i.xp_points=Number(v)),w&&j&&(i.marker={lat:w,lng:j}),Object.keys(i).length>0&&(e.data.extras=i);let s=0,n=0;if("all"===t){if(!_)return Ki.error("Admin token richiesto per broadcast"),void A(!1);const t=await Uz({audience:"all",payload:e},{adminToken:_});E(t),200===t.status||t.data.success?(s=t.data.sent||t.data.total||0,n=t.data.failed||0,Ki.success(` Broadcast inviato: ${s} sent, ${n} failed`)):Ki.error(qz(t.data.error,t.status))}else if("self"===t){const{data:{session:t}}=await ba.auth.getSession();if(!t?.access_token)return Ki.error("Non autenticato. Esegui login."),void A(!1);const i=await Uz({audience:"all",payload:e},{userJWT:t.access_token});E(i),200===i.status||i.data.success?Ki.success(" Push self inviata!"):Ki.error(qz(i.data.error,i.status))}else{const{data:{session:t}}=await ba.auth.getSession();if(!t?.access_token)return Ki.error("Non autenticato. Esegui login."),void A(!1);const i=a.split(",").map(e=>e.trim()).filter(Boolean);if(0===i.length)return Ki.error("Inserisci almeno un User ID"),void A(!1);(await Promise.allSettled(i.map(i=>Uz({audience:{user_id:i},payload:e},{userJWT:t.access_token})))).forEach((e,t)=>{"fulfilled"===e.status&&(200===e.value.status||e.value.data.success)?s+=e.value.data.sent||1:n++}),E({status:200,data:{sent:s,failed:n}}),Ki.success(` Targeted: ${s} sent, ${n} failed`)}}catch(e){Ki.error(`Errore: ${e.message}`),E({status:0,data:{error:e.message}})}finally{A(!1)}}else Ki.error("Compila title o message. Per targeted, inserisci User ID.")},disabled:!I||C,children:C?se.jsxs(se.Fragment,{children:[se.jsx(Hs,{className:"w-4 h-4 mr-2 animate-spin"}),"Invio in corso..."]}):se.jsxs(se.Fragment,{children:[se.jsx(fr,{className:"w-4 h-4 mr-2"}),"Invia Push"]})}),z&&se.jsxs("div",{className:"mt-4 p-4 bg-gray-800/50 rounded-lg",children:[se.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Ultimo Esito:"}),se.jsx("pre",{className:"text-xs text-gray-300 overflow-auto",children:JSON.stringify(z.data,null,2)})]})]})]})})}const Wz=()=>{const[e,t]=We.useState(!1),[i,a]=We.useState(!1),[s,r]=We.useState(null),[n,o]=We.useState("default"),[l,c]=We.useState([]),[d,u]=We.useState({}),[h,m]=We.useState("checking"),[p,f]=We.useState(!1),{user:g}=$l(),x=async()=>{try{const e=await fetch("/OneSignalSDKWorker.js"),t=await fetch("/OneSignalSDKUpdaterWorker.js");e.ok&&t.ok?m(" Worker files accessible"):(m(" Worker files missing"),console.error(" ULTIMATE iOS: Worker files MISSING"))}catch(e){m(" Worker check failed"),console.error(" ULTIMATE iOS: Worker check error:",e)}},b=()=>{const e=navigator.userAgent,t={isIOS:/iPad|iPhone|iPod/.test(e),isSafari:/Safari/.test(e)&&!/Chrome/.test(e),isStandalone:!0===window.navigator.standalone,isPWA:window.matchMedia("(display-mode: standalone)").matches,userAgent:e,protocol:window.location.protocol,hostname:window.location.hostname,notificationSupport:"Notification"in window,serviceWorkerSupport:"serviceWorker"in navigator};return u(t),t},v=async()=>{try{if("undefined"==typeof window)return!1;const i=b();if(window.OneSignal){try{await window.OneSignal.logout(),delete window.OneSignalDeferred,delete window.OneSignalSDK}catch(e){}delete window.OneSignal}const a=document.querySelector('script[src*="OneSignalSDK"]');a&&a.remove();const s=document.createElement("script");return s.src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js",s.defer=!0,s.async=!0,document.head.appendChild(s),new Promise(e=>{s.onload=async()=>{try{let i=0;for(;!window.OneSignal&&i<50;)await new Promise(e=>setTimeout(e,100)),i++;if(!window.OneSignal)throw new Error("OneSignal script loaded but object not available");const a={appId:"5e0cb75f-f065-4626-9a63-ce5692f7a7e0",allowLocalhostAsSecureOrigin:!0,requiresUserPrivacyConsent:!1,autoRegister:!1,autoResubscribe:!0,serviceWorkerPath:"/OneSignalSDKWorker.js",serviceWorkerUpdaterPath:"/OneSignalSDKUpdaterWorker.js",serviceWorkerParam:{scope:"/"},safari_web_id:void 0,restrictedOriginValidation:!1,httpPermissionRequest:{enable:!0,useModal:!0},notifyButton:{enable:!1},persistNotification:!0,__BYPASS_ORIGIN_VALIDATION:!0};window.location.href,window.location.origin,await window.OneSignal.init(a),window.OneSignal.push(()=>{}),setTimeout(async()=>{await y()},1e3),t(!0),e(!0)}catch(a){if(console.error(" ULTIMATE iOS: BYPASS initialization error:",a),console.error(" ULTIMATE iOS: Error details:",{message:a.message,stack:a.stack,name:a.name}),i.isIOS&&i.isSafari)try{const t=await Notification.requestPermission();"granted"===t?(o(t),e(!0)):e(!1)}catch(s){console.error(" ULTIMATE iOS: Fallback failed:",s),e(!1)}else e(!1)}},s.onerror=t=>{console.error(" ULTIMATE iOS: Script loading failed:",t),e(!1)}})}catch(i){return console.error(" ULTIMATE iOS: BYPASS setup error:",i),!1}},y=async()=>{try{if(!window.OneSignal)return;const e=window.OneSignal,t=await e.isPushNotificationsEnabled(),i=await e.getUserId(),a=await e.getNotificationPermission();f(t),r(i),o(a),(new Date).toISOString()}catch(e){console.error(" ULTIMATE iOS: Errore check status:",e)}},w=async()=>{try{const{data:e,error:t}=await ba.from("device_tokens").select("*").order("created_at",{ascending:!1});t?console.error(" ULTIMATE: Errore caricamento token:",t):c(e||[])}catch(e){console.error(" ULTIMATE: Exception caricamento token:",e)}},N=async()=>{"undefined"!=typeof window&&"Notification"in window&&o(Notification.permission)};return We.useEffect(()=>{b(),x(),v(),w(),N()},[]),se.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 p-4",children:se.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[se.jsx(Wl,{className:"bg-black/50 border-cyan-400/30",children:se.jsxs(Hl,{children:[se.jsx(Zl,{className:"text-cyan-400 text-center",children:" NOTIFICATION DEBUG iOS ULTIMATE - M1SSION"}),se.jsxs("div",{className:"text-center text-sm text-green-400 mt-2",children:[" PAGINA FUNZIONANTE - URL: ",window.location.href]}),se.jsx("div",{className:"text-center text-xs text-orange-400 mt-1",children:" iOS Safari Optimized - OneSignal Debug Mode"})]})}),se.jsxs(Wl,{className:"bg-black/50 border-cyan-400/30",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-cyan-400",children:" Status Dashboard"})}),se.jsxs(Gl,{children:[se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[se.jsxs("div",{className:"bg-gray-800/50 p-3 rounded",children:[se.jsx("div",{className:"text-sm text-gray-400",children:"OneSignal"}),se.jsx("div",{className:"font-bold "+(e?"text-green-400":"text-red-400"),children:e?" Inizializzato":" Non inizializzato"})]}),se.jsxs("div",{className:"bg-gray-800/50 p-3 rounded",children:[se.jsx("div",{className:"text-sm text-gray-400",children:"Permessi"}),se.jsx("div",{className:"font-bold "+("granted"===n?"text-green-400":"denied"===n?"text-red-400":"text-yellow-400"),children:n})]}),se.jsxs("div",{className:"bg-gray-800/50 p-3 rounded",children:[se.jsx("div",{className:"text-sm text-gray-400",children:"Player ID"}),se.jsx("div",{className:"font-bold "+(s?"text-green-400":"text-red-400"),children:s?" Ottenuto":" Mancante"})]}),se.jsxs("div",{className:"bg-gray-800/50 p-3 rounded",children:[se.jsx("div",{className:"text-sm text-gray-400",children:"Subscription"}),se.jsx("div",{className:"font-bold "+(p?"text-green-400":"text-red-400"),children:p?" Attiva":" Inattiva"})]})]}),se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[se.jsxs("div",{className:"bg-orange-800/30 p-3 rounded",children:[se.jsx("div",{className:"text-sm text-orange-400",children:"iOS Device"}),se.jsx("div",{className:"font-bold "+(d.isIOS?"text-green-400":"text-red-400"),children:d.isIOS?" iOS":" Desktop"})]}),se.jsxs("div",{className:"bg-orange-800/30 p-3 rounded",children:[se.jsx("div",{className:"text-sm text-orange-400",children:"Safari"}),se.jsx("div",{className:"font-bold "+(d.isSafari?"text-green-400":"text-yellow-400"),children:d.isSafari?" Safari":" Other"})]}),se.jsxs("div",{className:"bg-orange-800/30 p-3 rounded",children:[se.jsx("div",{className:"text-sm text-orange-400",children:"Service Worker"}),se.jsx("div",{className:"font-bold text-xs "+(h.includes("")?"text-green-400":"text-red-400"),children:h})]})]})]})]}),se.jsxs(Wl,{className:"bg-black/50 border-cyan-400/30",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-cyan-400",children:" Azioni Principali"})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsx("div",{className:"text-center",children:se.jsx(mo,{onClick:async()=>{a(!0);try{if(!(await v()))throw new Error("Inizializzazione OneSignal fallita");if(await new Promise(e=>setTimeout(e,2e3)),!window.OneSignal)throw new Error("OneSignal non disponibile dopo inizializzazione");const a=window.OneSignal;if(!("Notification"in window))throw new Error("Notifiche non supportate su questo browser");if(Notification.permission,d.isIOS&&d.isSafari){const e=await Notification.requestPermission();"granted"!==e&&console.warn(" ULTIMATE iOS: Permission not granted, trying OneSignal anyway...")}try{await a.Notifications.requestPermission()}catch(e){console.warn(" ULTIMATE iOS: OneSignal permission error (may be OK):",e)}await new Promise(e=>setTimeout(e,2e3));let n=null;try{n=await a.User.PushSubscription.id}catch(t){t.message}if(!n)try{n=await a.getUserId()}catch(t){t.message}if(!n)try{const e=await a.getSubscription();n=e?.userId||e?.playerId}catch(t){t.message}if(!n)try{n=a.User?.onesignalId||a.User?.userId}catch(t){t.message}if(!n&&d.isIOS&&d.isSafari)try{await a.setSubscription(!0),await new Promise(e=>setTimeout(e,3e3)),n=await a.User.PushSubscription.id||await a.getUserId()}catch(i){console.error(" ULTIMATE iOS: Manual registration failed:",i)}if(!n){console.error(" ULTIMATE iOS: Player ID nullo - tentativo di debug...");try{await a.isPushNotificationsEnabled(),await a.getNotificationPermission()}catch(s){console.error(" ULTIMATE iOS: Debug error:",s)}throw new Error("Player ID non ottenuto - verifica permessi e connessione")}if(r(n),g){const{error:e}=await ba.from("device_tokens").upsert({user_id:g.id,token:n,device_type:d.isIOS?"onesignal_ios_web":"onesignal_web",platform:`${navigator.platform} - ${d.isIOS?"iOS":"Other"}`});e?console.error(" ULTIMATE iOS: Errore salvataggio:",e):await w()}await y(),Ki.success(" REGISTRAZIONE iOS ULTIMATE COMPLETATA!")}catch(t){console.error(" ULTIMATE iOS: Errore registrazione:",t),Ki.error(` Registrazione iOS fallita: ${t}`)}finally{a(!1)}},disabled:i,size:"lg",className:"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-bold px-8 py-4 text-lg",children:i?" Registrando iOS...":" REGISTRATI ULTIMATE iOS"})}),se.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[se.jsx(mo,{onClick:async()=>{if(s)try{const{data:e,error:t}=await ba.functions.invoke("send-push-notification-onesignal",{body:{user_id:g?.id,title:" ULTIMATE TEST M1SSION",message:"Notifica test OneSignal funzionante!",data:{test:!0}}});t?(console.error(" ULTIMATE: Errore invio:",t),Ki.error(` Errore: ${t.message}`)):Ki.success(" Notifica test inviata!")}catch(e){console.error(" ULTIMATE: Exception invio:",e),Ki.error(" Errore invio notifica")}else Ki.error("Registrati prima con il bottone ULTIMATE!")},disabled:!s,className:"bg-green-600 hover:bg-green-700",children:" Test Notifica iOS"}),se.jsx(mo,{onClick:y,variant:"outline",className:"border-orange-400 text-orange-400",children:" Check OneSignal"}),d.isIOS&&d.isSafari&&se.jsx(mo,{onClick:async()=>{try{window.OneSignal&&(await window.OneSignal.logout(),delete window.OneSignal);const e=await Notification.requestPermission();"granted"===e&&(await v(),await new Promise(e=>setTimeout(e,3e3)),await y())}catch(e){console.error(" iOS BYPASS: Manual registration failed:",e)}},className:"bg-orange-600 hover:bg-orange-700",children:" iOS BYPASS Manual"}),se.jsx(mo,{onClick:w,variant:"outline",className:"border-cyan-400 text-cyan-400",children:" Ricarica Token"}),se.jsx(mo,{onClick:()=>{b(),x(),N()},variant:"outline",className:"border-yellow-400 text-yellow-400",children:" Full iOS Check"})]})]})]}),s&&se.jsxs(Wl,{className:"bg-black/50 border-green-400/30",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-green-400",children:" Player ID OneSignal"})}),se.jsx(Gl,{children:se.jsx("div",{className:"bg-gray-800/50 p-4 rounded",children:se.jsx("div",{className:"text-xs font-mono text-green-400 break-all",children:s})})})]}),se.jsxs(Wl,{className:"bg-black/50 border-cyan-400/30",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-cyan-400",children:" Token Dispositivi Registrati"})}),se.jsx(Gl,{children:0===l.length?se.jsx("div",{className:"text-center py-8 text-gray-400",children:"Nessun token registrato. Usa il bottone ULTIMATE per registrarti!"}):se.jsx("div",{className:"space-y-3",children:l.map(e=>se.jsxs("div",{className:"bg-gray-800/50 p-3 rounded",children:[se.jsxs("div",{className:"flex justify-between items-start mb-2",children:[se.jsxs("div",{className:"text-sm",children:[se.jsx("span",{className:"text-cyan-400",children:e.device_type}),se.jsx("span",{className:"text-gray-400 ml-2",children:new Date(e.created_at).toLocaleString()})]}),se.jsxs("div",{className:"text-xs text-green-400",children:["ID: ",e.id]})]}),se.jsx("div",{className:"text-xs font-mono text-gray-300 break-all",children:e.token})]},e.id))})})]}),se.jsxs(Wl,{className:"bg-black/50 border-orange-400/30",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-orange-400",children:" iOS Environment Debug"})}),se.jsxs(Gl,{children:[se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[se.jsxs("div",{children:[se.jsx("span",{className:"text-gray-400",children:"iOS Device:"}),se.jsx("span",{className:"ml-2 "+(d.isIOS?"text-green-400":"text-red-400"),children:d.isIOS?" iOS Device":" Not iOS"})]}),se.jsxs("div",{children:[se.jsx("span",{className:"text-gray-400",children:"Safari Browser:"}),se.jsx("span",{className:"ml-2 "+(d.isSafari?"text-green-400":"text-yellow-400"),children:d.isSafari?" Safari":" Other Browser"})]}),se.jsxs("div",{children:[se.jsx("span",{className:"text-gray-400",children:"PWA Mode:"}),se.jsx("span",{className:"ml-2 "+(d.isPWA?"text-green-400":"text-yellow-400"),children:d.isPWA?" PWA":" Browser"})]}),se.jsxs("div",{children:[se.jsx("span",{className:"text-gray-400",children:"Standalone:"}),se.jsx("span",{className:"ml-2 "+(d.isStandalone?"text-green-400":"text-gray-400"),children:d.isStandalone?" Standalone":" Not Standalone"})]}),se.jsxs("div",{children:[se.jsx("span",{className:"text-gray-400",children:"Protocol:"}),se.jsx("span",{className:"ml-2 "+("https:"===d.protocol?"text-green-400":"text-red-400"),children:d.protocol})]}),se.jsxs("div",{children:[se.jsx("span",{className:"text-gray-400",children:"Notification API:"}),se.jsx("span",{className:"ml-2 "+(d.notificationSupport?"text-green-400":"text-red-400"),children:d.notificationSupport?" Supported":" Not Supported"})]})]}),se.jsxs("div",{className:"mt-4 p-3 bg-gray-800/50 rounded",children:[se.jsx("div",{className:"text-gray-400 text-xs mb-2",children:"User Agent:"}),se.jsx("div",{className:"text-white text-xs break-all",children:d.userAgent})]}),se.jsxs("div",{className:"mt-4 p-3 bg-gray-800/50 rounded",children:[se.jsx("div",{className:"text-gray-400 text-xs mb-2",children:"Service Worker Status:"}),se.jsx("div",{className:"text-white text-xs",children:h})]})]})]})]})})},Hz=({onBack:e})=>{const[t,i]=We.useState(""),[a,s]=We.useState(!1),[r,n]=We.useState(null),[o,l]=We.useState("clue"),c=[{id:"clue",label:"Indizio",icon:Ps,color:"from-blue-500 to-purple-600"},{id:"mission",label:"Missione",icon:Wr,color:"from-purple-500 to-pink-600"},{id:"story",label:"Storia",icon:Rs,color:"from-green-500 to-blue-600"}];return se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] p-4",children:se.jsx("div",{className:"max-w-4xl mx-auto",children:se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[se.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[se.jsx(mo,{onClick:e,variant:"ghost",className:"glass-card p-2 border border-white/20 hover:border-[#4361ee]/50",children:se.jsx(Za,{className:"w-5 h-5 text-white"})}),se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center",children:se.jsx(Ns,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h1",{className:"text-2xl font-orbitron font-bold text-white",children:"AI Content Generator"}),se.jsx("p",{className:"text-gray-400",children:"Sistema di generazione automatica M1SSION"})]})]})]}),se.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[se.jsx(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:se.jsxs(Wl,{className:"glass-card border border-white/20",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center gap-2",children:[se.jsx(Dr,{className:"w-5 h-5 text-[#4361ee]"}),"Pannello di Controllo"]})}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{children:[se.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Tipo di Contenuto"}),se.jsx("div",{className:"grid grid-cols-3 gap-2",children:c.map(e=>se.jsxs(et.button,{onClick:()=>l(e.id),className:"p-3 rounded-lg border transition-all "+(o===e.id?"border-[#4361ee] bg-[#4361ee]/20":"border-white/20 hover:border-white/40"),whileHover:{scale:1.05},whileTap:{scale:.95},children:[se.jsx(e.icon,{className:"w-5 h-5 mx-auto mb-1 "+(o===e.id?"text-[#4361ee]":"text-gray-400")}),se.jsx("div",{className:"text-xs "+(o===e.id?"text-white":"text-gray-400"),children:e.label})]},e.id))})]}),se.jsxs("div",{children:[se.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Prompt di Generazione"}),se.jsx(Wb,{value:t,onChange:e=>i(e.target.value),placeholder:"Inserisci il prompt per generare contenuto automaticamente...",className:"glass-input bg-black/20 border-white/20 text-white placeholder-gray-400 min-h-[120px]",rows:5})]}),se.jsx(mo,{onClick:async()=>{if(t.trim()){s(!0);try{const{data:{session:e}}=await ba.auth.getSession();if(!e)throw new Error("Sessione non trovata - accesso negato");const i={prompt:t.trim(),contentType:o,missionId:null};e.access_token.substring(0,20);const{data:a,error:s}=await ba.functions.invoke("ai-content-generator",{body:i});if(s)throw console.error(" Frontend: Supabase functions error:",s),new Error(`Edge Function Error: ${s.message||"Unknown Supabase error"}`);if(a?.error)throw console.error(" Frontend: Edge Function returned error:",a),new Error(`AI Generator Error: ${a.error}`);if(!a?.content)throw console.error(" Frontend: No content in response:",a),new Error("Nessun contenuto generato dall'AI");a.content,n(a.content),a.saved?Ki.success("Contenuto generato e salvato con successo!"):(Ki.success("Contenuto generato!"),Ki.error("Attenzione: contenuto non salvato nel database"))}catch(e){console.error(" Frontend: Complete error details:",{message:e.message,name:e.name,stack:e.stack,timestamp:(new Date).toISOString(),prompt:t.trim(),contentType:o});let i="Errore durante la generazione del contenuto";e.message?.includes("Sessione non trovata")?i="Sessione scaduta. Riloggati per continuare.":e.message?.includes("Edge Function Error")?i="Errore del server AI. Riprova tra qualche secondo.":e.message?.includes("AI Generator Error")?i=`Errore AI: ${e.message.replace("AI Generator Error: ","")}`:e.message&&(i=e.message),Ki.error(i)}finally{s(!1)}}else Ki.error("Inserisci un prompt per generare contenuto")},disabled:a||!t.trim(),className:"w-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] hover:from-[#4361ee]/80 hover:to-[#7209b7]/80 text-white font-semibold py-3",children:a?se.jsx(et.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full"}):se.jsxs(se.Fragment,{children:[se.jsx(fr,{className:"w-5 h-5 mr-2"}),"Genera Contenuto"]})})]})]})}),se.jsx(et.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.4},children:se.jsxs(Wl,{className:"glass-card border border-white/20",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center gap-2",children:[se.jsx(Ps,{className:"w-5 h-5 text-[#7209b7]"}),"Anteprima Contenuto"]})}),se.jsx(Gl,{children:r?se.jsx(et.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-black/30 rounded-lg p-4 border border-white/10",children:se.jsx("pre",{className:"text-gray-300 text-sm whitespace-pre-wrap font-mono",children:r})}):se.jsxs("div",{className:"text-center py-12 text-gray-400",children:[se.jsx(Ps,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),se.jsx("p",{children:"Il contenuto generato apparir qui"}),se.jsx("p",{className:"text-sm mt-2",children:'Inserisci un prompt e clicca "Genera Contenuto"'})]})})]})})]}),se.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"mt-8",children:se.jsx(Wl,{className:"glass-card border border-white/20",children:se.jsx(Gl,{className:"p-6",children:se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"text-2xl font-bold text-[#4361ee]",children:"42"}),se.jsx("div",{className:"text-sm text-gray-400",children:"Indizi Generati"})]}),se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"text-2xl font-bold text-[#7209b7]",children:"15"}),se.jsx("div",{className:"text-sm text-gray-400",children:"Missioni Create"})]}),se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"text-2xl font-bold text-green-400",children:"89%"}),se.jsx("div",{className:"text-sm text-gray-400",children:"Successo AI"})]}),se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"text-2xl font-bold text-blue-400",children:"1.2k"}),se.jsx("div",{className:"text-sm text-gray-400",children:"Token Utilizzati"})]})]})})})})]})})})},Zz=({open:e,onOpenChange:t,onSubmit:i,title:a,confirmButtonText:s,mission:r})=>{const[n,o]=We.useState({title:"",description:"",status:"draft",publication_date:null,start_date:null,end_date:null,prize_id:null,prize_description:"",prize_value:"",prize_image_url:""}),[l,c]=We.useState([]);We.useEffect(()=>{e&&(d(),o(r?{title:r.title||"",description:r.description||"",status:r.status||"draft",publication_date:r.publication_date||null,start_date:r.start_date||null,end_date:r.end_date||null,prize_id:r.prize_id||null,prize_description:r.prize_description||"",prize_value:r.prize_value||"",prize_image_url:r.prize_image_url||""}:{title:"",description:"",status:"draft",publication_date:null,start_date:null,end_date:null,prize_id:null,prize_description:"",prize_value:"",prize_image_url:""}))},[e,r]);const d=async()=>{try{const{data:e,error:t}=await ba.from("prizes").select("id, name, description, image_url").eq("is_active",!0);if(t)throw t;c(e||[])}catch(e){console.error("Error loading prizes:",e)}};return se.jsx(to,{open:e,onOpenChange:t,children:se.jsx(io,{className:"sm:max-w-md",children:se.jsxs("form",{onSubmit:e=>{e.preventDefault(),i(n),t(!1)},children:[se.jsx(ao,{children:se.jsx(so,{children:a})}),se.jsxs("div",{className:"grid gap-4 py-4",children:[se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"title",className:"text-right",children:"Titolo"}),se.jsx(Sl,{id:"title",value:n.title,onChange:e=>o({...n,title:e.target.value}),className:"col-span-3",required:!0})]}),se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"description",className:"text-right",children:"Descrizione"}),se.jsx(Wb,{id:"description",value:n.description||"",onChange:e=>o({...n,description:e.target.value}),className:"col-span-3",rows:4})]}),se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"status",className:"text-right",children:"Stato"}),se.jsxs(SA,{value:n.status||void 0,onValueChange:e=>o({...n,status:e}),children:[se.jsx(kA,{className:"col-span-3",children:se.jsx(_A,{placeholder:"Seleziona stato"})}),se.jsxs(zA,{children:[se.jsx(EA,{value:"draft",children:"Bozza"}),se.jsx(EA,{value:"published",children:"Pubblicata"}),se.jsx(EA,{value:"scheduled",children:"Programmata"}),se.jsx(EA,{value:"archived",children:"Archiviata"})]})]})]}),"published"===n.status&&se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"publication_date",className:"text-right",children:"Data di pubblicazione"}),se.jsx(Sl,{id:"publication_date",type:"datetime-local",value:n.publication_date?new Date(n.publication_date).toISOString().slice(0,16):(new Date).toISOString().slice(0,16),onChange:e=>o({...n,publication_date:e.target.value?new Date(e.target.value).toISOString():null}),className:"col-span-3"})]}),se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"start_date",className:"text-right",children:"Data inizio"}),se.jsx(Sl,{id:"start_date",type:"datetime-local",value:n.start_date?new Date(n.start_date).toISOString().slice(0,16):"",onChange:e=>o({...n,start_date:e.target.value?new Date(e.target.value).toISOString():null}),className:"col-span-3"})]}),se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"end_date",className:"text-right",children:"Data fine"}),se.jsx(Sl,{id:"end_date",type:"datetime-local",value:n.end_date?new Date(n.end_date).toISOString().slice(0,16):"",onChange:e=>o({...n,end_date:e.target.value?new Date(e.target.value).toISOString():null}),className:"col-span-3"})]}),se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"prize_id",className:"text-right",children:"Premio"}),se.jsxs(SA,{value:n.prize_id||void 0,onValueChange:e=>o({...n,prize_id:"none"===e?null:e}),children:[se.jsx(kA,{className:"col-span-3",children:se.jsx(_A,{placeholder:"Seleziona premio (opzionale)"})}),se.jsxs(zA,{children:[se.jsx(EA,{value:"none",children:"Nessun premio"}),l.map(e=>se.jsx(EA,{value:e.id,children:e.name||"Premio senza nome"},e.id))]})]})]}),se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"prize_description",className:"text-right",children:"Descrizione premio"}),se.jsx(Wb,{id:"prize_description",value:n.prize_description||"",onChange:e=>o({...n,prize_description:e.target.value}),className:"col-span-3",rows:2,placeholder:"Descrizione personalizzata del premio"})]}),se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"prize_value",className:"text-right",children:"Valore premio"}),se.jsx(Sl,{id:"prize_value",value:n.prize_value||"",onChange:e=>o({...n,prize_value:e.target.value}),className:"col-span-3",placeholder:"es. 100, 50 punti, accesso VIP"})]}),se.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[se.jsx(jl,{htmlFor:"prize_image_url",className:"text-right",children:"Immagine premio"}),se.jsx(Sl,{id:"prize_image_url",value:n.prize_image_url||"",onChange:e=>o({...n,prize_image_url:e.target.value}),className:"col-span-3",placeholder:"URL immagine premio"})]})]}),se.jsxs(no,{children:[se.jsx(mo,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Annulla"}),se.jsx(mo,{type:"submit",children:s})]})]})})})},Vz=({mission:e,onBack:t,onUpdate:i})=>{const[a,s]=We.useState(!1),[r,n]=We.useState(0),[o,l]=We.useState(!0),[c,d]=We.useState(e);We.useEffect(()=>{u();const t=ba.channel("mission-participants").on("postgres_changes",{event:"*",schema:"public",table:"user_mission_registrations",filter:`mission_id=eq.${e.id}`},()=>{u()}).subscribe();return()=>{ba.removeChannel(t)}},[e.id]);const u=async()=>{try{l(!0);const{count:t,error:i}=await ba.from("user_mission_registrations").select("*",{count:"exact",head:!0}).eq("mission_id",e.id).eq("status","active");if(i)throw i;n(t||0)}catch(t){console.error("Error loading participant count:",t),Ki.error("Errore nel caricamento dei partecipanti")}finally{l(!1)}},h=e=>e?new Date(e).toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Non definita";return se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] p-4",children:se.jsx("div",{className:"max-w-4xl mx-auto",children:se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[se.jsxs("div",{className:"flex items-center justify-between mb-8",children:[se.jsxs("div",{className:"flex items-center gap-4",children:[se.jsx(mo,{onClick:t,variant:"ghost",className:"glass-card p-2 border border-white/20 hover:border-[#7209b7]/50",children:se.jsx(Za,{className:"w-5 h-5 text-white"})}),se.jsxs("div",{children:[se.jsx("h1",{className:"text-2xl font-orbitron font-bold text-white",children:"Mission Config"}),se.jsx("p",{className:"text-gray-400",children:"Configurazione dettagli missione"})]})]}),se.jsx("div",{className:"flex items-center gap-2",children:a?se.jsxs(se.Fragment,{children:[se.jsxs(mo,{onClick:async()=>{try{const{error:t}=await ba.from("missions").update({title:c.title,description:c.description,status:c.status,start_date:c.start_date,end_date:c.end_date,updated_at:(new Date).toISOString()}).eq("id",e.id);if(t)throw t;Ki.success("Missione aggiornata con successo"),i(c),s(!1)}catch(t){Ki.error("Errore nell'aggiornamento della missione",{description:t.message})}},className:"bg-gradient-to-r from-green-500 to-green-600 hover:opacity-90",children:[se.jsx(mr,{className:"w-4 h-4 mr-2"}),"Salva"]}),se.jsxs(mo,{onClick:()=>{s(!1),d(e)},variant:"outline",className:"border-white/20 text-white hover:bg-white/10",children:[se.jsx($r,{className:"w-4 h-4 mr-2"}),"Annulla"]})]}):se.jsxs(mo,{onClick:()=>s(!0),className:"bg-gradient-to-r from-[#4361ee] to-[#7209b7] hover:opacity-90",children:[se.jsx(Nr,{className:"w-4 h-4 mr-2"}),"Modifica"]})})]}),se.jsxs("div",{className:"grid gap-6 mb-8",children:[se.jsxs(Wl,{className:"glass-card border-white/20",children:[se.jsx(Hl,{children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs(Zl,{className:"text-white flex items-center gap-2",children:[se.jsx(Ga,{className:"w-5 h-5 text-[#4361ee]"}),"Informazioni Missione"]}),se.jsx(fc,{className:(e=>{switch(e){case"active":case"published":return"bg-green-500/20 text-green-400 border-green-500/30";case"completed":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"draft":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/30";case"scheduled":return"bg-orange-500/20 text-orange-400 border-orange-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}})(a?c.status:e.status),children:(e=>{switch(e){case"published":return"Pubblicata";case"draft":return"Bozza";case"scheduled":return"Programmata";case"archived":return"Archiviata";case"active":return"Attiva";case"completed":return"Completata";default:return e}})(a?c.status:e.status)})]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{className:"text-gray-300",children:"Titolo"}),a?se.jsx(Sl,{value:c.title,onChange:e=>d({...c,title:e.target.value}),className:"mt-1"}):se.jsx("p",{className:"text-white text-lg font-semibold",children:e.title})]}),se.jsxs("div",{children:[se.jsx(jl,{className:"text-gray-300",children:"Partecipanti"}),se.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o?se.jsx(Cy,{size:"sm"}):se.jsx("span",{className:"text-white text-lg font-semibold",children:r}),se.jsx(Fr,{className:"w-4 h-4 text-[#4361ee]"})]})]})]}),se.jsxs("div",{children:[se.jsx(jl,{className:"text-gray-300",children:"Descrizione"}),a?se.jsx(Wb,{value:c.description||"",onChange:e=>d({...c,description:e.target.value}),className:"mt-1",rows:3}):se.jsx("p",{className:"text-gray-400 mt-1",children:e.description||"Nessuna descrizione"})]})]})]}),se.jsxs(Wl,{className:"glass-card border-white/20",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white flex items-center gap-2",children:[se.jsx(as,{className:"w-5 h-5 text-[#4361ee]"}),"Date e Programmazione"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{className:"text-gray-300",children:"Data Inizio"}),a?se.jsx(Sl,{type:"datetime-local",value:c.start_date?new Date(c.start_date).toISOString().slice(0,16):"",onChange:e=>d({...c,start_date:e.target.value?new Date(e.target.value).toISOString():null}),className:"mt-1"}):se.jsx("p",{className:"text-white",children:h(e.start_date)})]}),se.jsxs("div",{children:[se.jsx(jl,{className:"text-gray-300",children:"Data Fine"}),a?se.jsx(Sl,{type:"datetime-local",value:c.end_date?new Date(c.end_date).toISOString().slice(0,16):"",onChange:e=>d({...c,end_date:e.target.value?new Date(e.target.value).toISOString():null}),className:"mt-1"}):se.jsx("p",{className:"text-white",children:h(e.end_date)})]})]}),se.jsxs("div",{children:[se.jsx(jl,{className:"text-gray-300",children:"Data Pubblicazione"}),se.jsx("p",{className:"text-white",children:h(e.publication_date)})]})]})]}),se.jsxs(Wl,{className:"glass-card border-white/20",children:[se.jsx(Hl,{children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs(Zl,{className:"text-white flex items-center gap-2",children:[se.jsx(Ga,{className:"w-5 h-5 text-[#4361ee]"}),"Dettagli Premio (Solo Lettura)"]}),se.jsx(mo,{onClick:()=>{t()},variant:"outline",size:"sm",className:"border-white/20 text-white hover:bg-white/10",children:"Gestisci Premi"})]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{className:"text-gray-300",children:"Descrizione Premio"}),se.jsx("p",{className:"text-white",children:e.prize_description||"Nessun premio definito"}),se.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"I premi vengono gestiti dal tab Premi nel Mission Control"})]}),se.jsxs("div",{children:[se.jsx(jl,{className:"text-gray-300",children:"Valore Premio"}),se.jsx("p",{className:"text-white",children:e.prize_value||"Non specificato"})]})]}),e.prize_image_url&&se.jsxs("div",{children:[se.jsx(jl,{className:"text-gray-300",children:"Immagine Premio"}),se.jsx("div",{className:"mt-2",children:se.jsx("img",{src:e.prize_image_url,alt:"Premio",className:"w-32 h-32 object-cover rounded-lg border border-white/20"})})]})]})]})]})]})})})},Gz=({selectedMissionId:e})=>{const[t,i]=We.useState([]),[a,s]=We.useState(!1),[r,n]=We.useState(0),[o,l]=We.useState(null);We.useEffect(()=>{(async()=>{if(e)l(e);else try{const{data:e}=await ba.from("missions").select("id").eq("status","active").order("start_date",{ascending:!1}).limit(1);e&&e.length>0&&l(e[0].id)}catch(t){console.error("Error fetching active mission:",t)}})()},[e]),We.useEffect(()=>{if(!o)return;c();const e=ba.channel(`participants-realtime-${o}`).on("postgres_changes",{event:"*",schema:"public",table:"mission_enrollments",filter:`mission_id=eq.${o}`},e=>{c()}).subscribe(e=>{});return()=>{ba.removeChannel(e)}},[o]);const c=async()=>{if(o)try{s(!0);const{data:e,error:t,count:a}=await ba.from("mission_enrollments").select("mission_id,user_id,joined_at",{count:"exact"}).eq("mission_id",o).order("joined_at",{ascending:!1});if(t)throw t;if(!e||0===e.length)return i([]),void n(0);const r=e.map(e=>e.user_id),{data:l,error:c}=await ba.from("profiles").select("id, full_name, email").in("id",r);if(c)throw c;const d=e.map(e=>({id:`${e.mission_id}-${e.user_id}`,user_id:e.user_id,mission_id:e.mission_id,registered_at:e.joined_at,status:"active",profiles:l?.find(t=>t.id===e.user_id)}));i(d),n(a||0)}catch(e){Ki.error("Errore nel caricamento partecipanti",{description:e.message})}finally{s(!1)}};return o?a?se.jsx("div",{className:"flex justify-center p-8",children:se.jsx(Cy,{size:"lg",className:"text-[#7209b7]"})}):se.jsxs("div",{className:"space-y-4",children:[se.jsx("div",{className:"flex justify-between items-center",children:se.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Partecipanti (",r,")"]})}),0===t.length?se.jsx("div",{className:"glass-card p-8 border border-white/20 text-center",children:se.jsx("p",{className:"text-gray-400",children:"Nessun partecipante registrato"})}):se.jsx("div",{className:"grid gap-4",children:t.map(e=>{return se.jsx(et.div,{whileHover:{scale:1.01},className:"glass-card p-4 border border-white/20",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-4",children:[se.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-[#7209b7] to-[#4361ee] flex items-center justify-center",children:se.jsx(Fr,{className:"w-5 h-5 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:e.profiles?.full_name||e.profiles?.email||"Utente"}),se.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.profiles?.email&&se.jsx("span",{children:e.profiles.email}),se.jsxs("span",{children:["Registrato: ",(t=e.registered_at,new Date(t).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))]})]})]})]}),se.jsx(fc,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:e.status})]})},e.id);var t})})]}):se.jsxs("div",{className:"glass-card p-8 border border-white/20 text-center",children:[se.jsx(us,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),se.jsx("p",{className:"text-gray-400",children:"Nessuna missione attiva trovata"})]})},Yz=({selectedMissionId:e})=>{const[t,i]=We.useState([]),[a,s]=We.useState([]),[r,n]=We.useState(!1),[o,l]=We.useState(!1),[c,d]=We.useState(null),[u,h]=We.useState({title:"",description:"",value_text:"",category_id:"",newCategoryName:"",status:"available"});We.useEffect(()=>{if(!e)return;m(),p();const t=ba.channel(`prizes-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"mission_prizes",filter:`mission_id=eq.${e}`},()=>{m()}).subscribe(),i=ba.channel("prize-categories").on("postgres_changes",{event:"*",schema:"public",table:"prize_categories"},()=>{p()}).subscribe();return()=>{ba.removeChannel(t),ba.removeChannel(i)}},[e]);const m=async()=>{if(e)try{n(!0);const{data:t,error:a}=await ba.from("mission_prizes").select("\n          *,\n          prize_categories (\n            name\n          )\n        ").eq("mission_id",e).order("created_at",{ascending:!1});if(a)throw a;i(t||[])}catch(t){Ki.error("Errore nel caricamento premi",{description:t.message})}finally{n(!1)}},p=async()=>{try{const{data:e,error:t}=await ba.from("prize_categories").select("*").order("name");if(t)throw t;s(e||[])}catch(e){console.error("Error loading categories:",e)}};return e?r?se.jsx("div",{className:"flex justify-center p-8",children:se.jsx(Cy,{size:"lg",className:"text-green-500"})}):se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"flex justify-between items-center",children:[se.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Gestione Premi (",t.length,")"]}),se.jsxs(mo,{onClick:()=>{d(null),h({title:"",description:"",value_text:"",category_id:"",newCategoryName:"",status:"available"}),l(!0)},className:"bg-gradient-to-r from-green-500 to-blue-600 hover:opacity-90",children:[se.jsx(nr,{className:"w-4 h-4 mr-2"}),"Nuovo Premio"]})]}),0===t.length?se.jsx("div",{className:"glass-card p-8 border border-white/20 text-center",children:se.jsx("p",{className:"text-gray-400",children:"Nessun premio configurato per questa missione"})}):se.jsx("div",{className:"grid gap-4",children:t.map(e=>se.jsx(et.div,{whileHover:{scale:1.01},className:"glass-card p-4 border border-white/20",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-4",children:[se.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-green-500 to-blue-600 flex items-center justify-center",children:se.jsx(Ga,{className:"w-5 h-5 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:e.title}),se.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.prize_categories&&se.jsxs("span",{children:["Categoria: ",e.prize_categories.name]}),e.value_text&&se.jsxs("span",{children:["Valore: ",e.value_text]})]}),e.description&&se.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.description})]})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(fc,{className:"available"===e.status?"bg-green-500/20 text-green-400 border-green-500/30":"bg-gray-500/20 text-gray-400 border-gray-500/30",children:"available"===e.status?"Disponibile":"Non disponibile"}),se.jsx(mo,{size:"sm",variant:"ghost",onClick:()=>(e=>{d(e),h({title:e.title,description:e.description||"",value_text:e.value_text||"",category_id:e.category_id||"",newCategoryName:"",status:e.status}),l(!0)})(e),className:"text-gray-400 hover:text-white",children:se.jsx(xr,{className:"w-4 h-4"})}),se.jsx(mo,{size:"sm",variant:"ghost",onClick:()=>(async e=>{if(confirm(`Vuoi eliminare il premio "${e.title}"?`))try{const{error:t}=await ba.from("mission_prizes").delete().eq("id",e.id);if(t)throw t;Ki.success("Premio eliminato")}catch(t){Ki.error("Errore nell'eliminazione",{description:t.message})}})(e),className:"text-red-400 hover:text-red-300",children:se.jsx(Ar,{className:"w-4 h-4"})})]})]})},e.id))}),se.jsx(to,{open:o,onOpenChange:l,children:se.jsxs(io,{className:"glass-card border border-white/20",children:[se.jsx(ao,{children:se.jsx(so,{className:"text-white",children:c?"Modifica Premio":"Nuovo Premio"})}),se.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),e&&u.title)try{let t=u.category_id||null;if(u.newCategoryName.trim()){const{data:e,error:i}=await ba.rpc("upsert_prize_category",{cat_name:u.newCategoryName.trim()});if(i)throw i;t=e}const i={mission_id:e,title:u.title,description:u.description||null,value_text:u.value_text||null,category_id:t,status:u.status};if(c){const{error:e}=await ba.from("mission_prizes").update(i).eq("id",c.id);if(e)throw e;Ki.success("Premio aggiornato")}else{const{error:e}=await ba.from("mission_prizes").insert(i);if(e)throw e;Ki.success("Premio creato")}l(!1)}catch(i){Ki.error("Errore",{description:i.message})}else Ki.error("Compila i campi obbligatori")},className:"space-y-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"title",children:"Titolo *"}),se.jsx(Sl,{id:"title",value:u.title,onChange:e=>h({...u,title:e.target.value}),placeholder:"Nome del premio",required:!0})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"category",children:"Categoria"}),se.jsxs(SA,{value:u.category_id||void 0,onValueChange:e=>h({...u,category_id:e}),children:[se.jsx(kA,{children:se.jsx(_A,{placeholder:"Seleziona categoria esistente"})}),se.jsx(zA,{children:a.map(e=>se.jsx(EA,{value:e.id,children:e.name},e.id))})]})]}),!u.category_id&&se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"newCategory",children:"O crea nuova categoria"}),se.jsx(Sl,{id:"newCategory",value:u.newCategoryName,onChange:e=>h({...u,newCategoryName:e.target.value}),placeholder:"es. Elettronica, Viaggi, Esperienze..."}),se.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se inserisci un nome qui, verr creata una nuova categoria"})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"value_text",children:"Valore (descrizione testuale)"}),se.jsx(Sl,{id:"value_text",value:u.value_text,onChange:e=>h({...u,value_text:e.target.value}),placeholder:"es. Smartphone, Viaggio per 2, 1000 crediti..."})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"description",children:"Descrizione"}),se.jsx(Wb,{id:"description",value:u.description,onChange:e=>h({...u,description:e.target.value}),placeholder:"Descrizione dettagliata del premio...",rows:3})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"status",children:"Stato"}),se.jsxs(SA,{value:u.status,onValueChange:e=>h({...u,status:e}),children:[se.jsx(kA,{children:se.jsx(_A,{})}),se.jsxs(zA,{children:[se.jsx(EA,{value:"available",children:"Disponibile"}),se.jsx(EA,{value:"unavailable",children:"Non disponibile"})]})]})]}),se.jsxs("div",{className:"flex justify-end gap-2",children:[se.jsx(mo,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Annulla"}),se.jsx(mo,{type:"submit",children:c?"Aggiorna":"Crea"})]})]})]})})]}):se.jsxs("div",{className:"glass-card p-8 border border-white/20 text-center",children:[se.jsx(us,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),se.jsx("p",{className:"text-gray-400",children:"Seleziona una missione per gestire i premi"})]})},Kz=({onBack:e})=>{const[t,i]=We.useState("missions"),[a,s]=We.useState([]),[r,n]=We.useState(!0),[o,l]=We.useState(!1),[c,d]=We.useState(!1),[u,h]=We.useState(null),[m,p]=We.useState(!1),[f,g]=We.useState(null),[x,b]=We.useState({}),[v,y]=We.useState(null);We.useEffect(()=>{w();const e=ba.channel("missions-changes").on("postgres_changes",{event:"*",schema:"public",table:"missions"},()=>{w()}).subscribe(),t=ba.channel("participants-changes").on("postgres_changes",{event:"*",schema:"public",table:"mission_enrollments"},()=>{N()}).subscribe();return()=>{ba.removeChannel(e),ba.removeChannel(t)}},[]);const w=async()=>{try{n(!0);const{data:e,error:t}=await ba.from("missions").select("*").order("created_at",{ascending:!1});if(t)throw t;s(e||[]),e&&N(e)}catch(e){Ki.error("Errore nel caricamento delle missioni",{description:e.message})}finally{n(!1)}},N=async e=>{try{const t={},i=e??a;for(const e of i){const{count:i,error:a}=await ba.from("mission_enrollments").select("*",{count:"exact",head:!0}).eq("mission_id",e.id);a||(t[e.id]=i||0)}b(t)}catch(t){console.error("Error loading participant counts:",t)}},j=e=>{s(t=>t.map(t=>t.id===e.id?e:t)),g(e)},S=[{id:"missions",label:"Missioni",icon:kr,color:"text-[#4361ee]"},{id:"users",label:"Utenti",icon:Fr,color:"text-[#7209b7]"},{id:"rewards",label:"Premi",icon:Ga,color:"text-green-400"}],_=e=>x[e.id]||0,k=e=>"published"===e.status?Math.floor(100*Math.random())+1:"draft"===e.status?0:100,C=()=>{const e="https://vkjrqirvdvjbemsfzxof.supabase.co".match(/^https?:\/\/([a-z0-9]+)\.supabase\.co/i);return e?e[1]:""},A=e=>`https://supabase.com/dashboard/project/${C()}/database/tables/public/${e}`,z=e=>{if(e.start_date&&e.end_date){return`${new Date(e.start_date).toLocaleDateString("it-IT")} - ${new Date(e.end_date).toLocaleDateString("it-IT")}`}if(e.publication_date){return`${new Date(e.publication_date).toLocaleDateString("it-IT")} - ${new Date(new Date(e.publication_date).getTime()+2592e6).toLocaleDateString("it-IT")}`}return"Date non definite"};return m&&f?se.jsx(Vz,{mission:f,onBack:()=>p(!1),onUpdate:j}):se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] p-4",children:[se.jsx("div",{className:"max-w-6xl mx-auto",children:se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[se.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[se.jsx(mo,{onClick:e,variant:"ghost",className:"glass-card p-2 border border-white/20 hover:border-[#7209b7]/50",children:se.jsx(Za,{className:"w-5 h-5 text-white"})}),se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-[#7209b7] to-[#4361ee] flex items-center justify-center",children:se.jsx(vr,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h1",{className:"text-2xl font-orbitron font-bold text-white",children:"Mission Control"}),se.jsx("p",{className:"text-gray-400",children:"Centro di controllo missioni M1SSION"})]})]})]}),se.jsx("div",{className:"flex gap-2 mb-6",children:S.map(e=>se.jsxs(mo,{onClick:()=>i(e.id),variant:"ghost",className:"glass-card border transition-all "+(t===e.id?"border-white/40 bg-white/10":"border-white/20 hover:border-white/30"),children:[se.jsx(e.icon,{className:`w-4 h-4 mr-2 ${e.color}`}),e.label]},e.id))}),se.jsxs(et.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:["missions"===t&&se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"flex justify-between items-center",children:[se.jsx("h2",{className:"text-xl font-semibold text-white",children:"Gestione Missioni"}),se.jsxs(mo,{onClick:()=>l(!0),className:"bg-gradient-to-r from-[#4361ee] to-[#7209b7] hover:opacity-90",children:[se.jsx(nr,{className:"w-4 h-4 mr-2"}),"Nuova Missione"]})]}),r?se.jsx("div",{className:"flex justify-center p-8",children:se.jsx(Cy,{size:"lg",className:"text-[#4361ee]"})}):se.jsx("div",{className:"grid gap-4",children:0===a.length?se.jsx("div",{className:"glass-card p-8 border border-white/20 text-center",children:se.jsx("p",{className:"text-gray-400",children:"Nessuna missione disponibile"})}):a.map(e=>se.jsx(et.div,{whileHover:{scale:1.01},className:"glass-card p-4 border cursor-pointer transition-colors "+(v===e.id?"border-[#4361ee] bg-[#4361ee]/10":"border-white/20"),onClick:()=>(e=>{y(e.id),"missions"===t&&i("users")})(e),children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-4",children:[se.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center",children:se.jsx(kr,{className:"w-5 h-5 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:e.title}),se.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[se.jsxs("span",{children:[_(e)," partecipanti"]}),se.jsxs("span",{children:[k(e),"% completamento"]}),se.jsx("span",{children:z(e)})]}),e.description&&se.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.description})]})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const t=(e=>{const t=new Date,i=e.start_date?new Date(e.start_date):null,a=e.end_date?new Date(e.end_date):null;return a&&t>=a?{label:"Completata",color:"bg-blue-500/20 text-blue-400 border-blue-500/30"}:("scheduled"===e.status||"published"===e.status)&&i&&t>=i&&(!a||t<a)?{label:"Live",color:"bg-green-500/20 text-green-400 border-green-500/30"}:"scheduled"===e.status&&i&&t<i?{label:"Programmata",color:"bg-orange-500/20 text-orange-400 border-orange-500/30"}:"draft"===e.status?{label:"Bozza",color:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30"}:"archived"===e.status?{label:"Archiviata",color:"bg-gray-500/20 text-gray-400 border-gray-500/30"}:"published"===e.status?{label:"Pubblicata",color:"bg-green-500/20 text-green-400 border-green-500/30"}:{label:e.status,color:"bg-gray-500/20 text-gray-400 border-gray-500/30"}})(e);return se.jsx(fc,{className:t.color,children:t.label})})(),se.jsx(mo,{size:"sm",variant:"ghost",onClick:t=>{t.stopPropagation(),(e=>{g(e),p(!0)})(e)},className:"text-gray-400 hover:text-white",title:"Visualizza dettagli missione",children:se.jsx(Is,{className:"w-4 h-4"})}),se.jsx(mo,{size:"sm",variant:"ghost",onClick:t=>{t.stopPropagation(),(async e=>{if(confirm(`Sei sicuro di voler eliminare la missione "${e.title}"?`))try{const{error:t}=await ba.from("missions").delete().eq("id",e.id);if(t)throw t;Ki.success("Missione eliminata con successo")}catch(t){Ki.error("Errore nell'eliminazione della missione",{description:t.message})}})(e)},className:"text-red-400 hover:text-red-300",children:se.jsx(Ar,{className:"w-4 h-4"})})]})]})},e.id))})]}),"users"===t&&se.jsx(Gz,{selectedMissionId:v}),"rewards"===t&&se.jsx(Yz,{selectedMissionId:v})]},t),se.jsx(et.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"mt-8",children:se.jsx(Wl,{className:"glass-card border border-white/20",children:se.jsxs(Gl,{className:"p-6",children:[se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-center",children:[se.jsxs("div",{children:[se.jsx("div",{className:"text-2xl font-bold text-[#4361ee]",children:a.length}),se.jsx("div",{className:"text-sm text-gray-400",children:"Missioni Totali"})]}),se.jsxs("div",{children:[se.jsx("div",{className:"text-2xl font-bold text-green-400",children:(()=>{const e=new Date;return a.filter(t=>{const i=t.start_date?new Date(t.start_date):null,a=t.end_date?new Date(t.end_date):null;return"published"===t.status||("scheduled"===t.status||"published"===t.status)&&i&&e>=i&&(!a||e<a)}).length})()}),se.jsx("div",{className:"text-sm text-gray-400",children:"Missioni Pubblicate"})]}),se.jsxs("div",{children:[se.jsx("div",{className:"text-2xl font-bold text-[#7209b7]",children:a.filter(e=>"draft"===e.status).length}),se.jsx("div",{className:"text-sm text-gray-400",children:"Bozze"})]}),se.jsxs("div",{children:[se.jsx("div",{className:"text-2xl font-bold text-blue-400",children:a.filter(e=>"scheduled"===e.status).length}),se.jsx("div",{className:"text-sm text-gray-400",children:"Programmate"})]}),se.jsxs("div",{children:[se.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:a.filter(e=>"archived"===e.status).length}),se.jsx("div",{className:"text-sm text-gray-400",children:"Archiviate"})]})]}),se.jsx("div",{className:"mt-4 text-center space-x-2",children:C()&&se.jsxs(se.Fragment,{children:[se.jsx(mo,{onClick:()=>window.open(A("missions"),"_blank","noopener"),variant:"outline",size:"sm",className:"text-xs","data-testid":"btn-missions-table",children:"Missions Table"}),se.jsx(mo,{onClick:()=>window.open(A("mission_prizes"),"_blank","noopener"),variant:"outline",size:"sm",className:"text-xs","data-testid":"btn-mission-prizes-table",children:"Mission Prizes"}),se.jsx(mo,{onClick:()=>window.open(A("prize_categories"),"_blank","noopener"),variant:"outline",size:"sm",className:"text-xs","data-testid":"btn-prize-categories-table",children:"Prize Categories"}),se.jsx(mo,{onClick:()=>window.open(A("user_mission_registrations"),"_blank","noopener"),variant:"outline",size:"sm",className:"text-xs","data-testid":"btn-user-registrations-table",children:"User Registrations"})]})})]})})})]})}),se.jsx(Zz,{open:o,onOpenChange:l,onSubmit:async e=>{try{if(!e.title)return void Ki.error("Il titolo  obbligatorio");const{data:t,error:a}=await ba.from("missions").insert({title:e.title,description:e.description||null,publication_date:e.publication_date||null,status:e.status||"draft",start_date:e.start_date||null,end_date:e.end_date||null,prize_id:e.prize_id||null,prize_description:e.prize_description||null,prize_value:e.prize_value||null,prize_image_url:e.prize_image_url||null}).select().single();if(a)throw a;t&&(y(t.id),i("users")),Ki.success("Missione creata con successo"),l(!1)}catch(t){Ki.error("Errore nella creazione della missione",{description:t.message})}},title:"Crea Nuova Missione",confirmButtonText:"Crea"}),se.jsx(Zz,{open:c,onOpenChange:d,onSubmit:async e=>{if(u)try{if(!e.title)return void Ki.error("Il titolo  obbligatorio");const{error:t}=await ba.from("missions").update({title:e.title,description:e.description,publication_date:e.publication_date,status:e.status,start_date:e.start_date,end_date:e.end_date,prize_id:e.prize_id,prize_description:e.prize_description,prize_value:e.prize_value,prize_image_url:e.prize_image_url,updated_at:(new Date).toISOString()}).eq("id",u.id);if(t)throw t;Ki.success("Missione aggiornata con successo"),d(!1),h(null)}catch(t){Ki.error("Errore nell'aggiornamento della missione",{description:t.message})}},title:"Modifica Missione",confirmButtonText:"Salva Modifiche",mission:u})]})},Xz=()=>{const[e,t]=We.useState(!1),[i,a]=We.useState(""),[s,r]=We.useState(!1);return se.jsxs(Wl,{className:"border-destructive/20 bg-destructive/5",children:[se.jsxs(Hl,{children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(hr,{className:"h-5 w-5 text-destructive"}),se.jsx(Zl,{className:"text-destructive",children:"RESET MISSIONE"})]}),se.jsx(Vl,{children:"Riavvia completamente la missione corrente - AZIONE IRREVERSIBILE"})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs(UA,{variant:"destructive",children:[se.jsx(Er,{className:"h-4 w-4"}),se.jsxs(qA,{children:[se.jsx("strong",{children:"ATTENZIONE:"})," Questa operazione eliminer TUTTO:",se.jsxs("ul",{className:"list-disc ml-4 mt-2 space-y-1",children:[se.jsx("li",{children:"Stato missione (riportato a 30 giorni, 0% progresso)"}),se.jsx("li",{children:"Tutti gli indizi trovati"}),se.jsx("li",{children:"Tutte le aree mappa generate"}),se.jsx("li",{children:"Contatori BUZZ giornalieri e mappa"}),se.jsx("li",{children:"Tutte le notifiche utente"}),se.jsx("li",{children:"Tentativi Final Shot"}),se.jsx("li",{children:"Coordinate geo-radar"}),se.jsx("li",{children:"Punti mappa salvati"}),se.jsx("li",{children:"Uso strumenti intelligence"}),se.jsx("li",{children:"Stato attivit live"})]}),se.jsx("p",{className:"mt-2 font-semibold text-destructive",children:"La missione ripartir da ZERO con data di oggi!"})]})]}),s?se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsxs("label",{className:"text-sm font-medium",children:["Inserisci il codice di conferma: ",se.jsx("code",{className:"bg-muted px-1 rounded",children:"RESET_M1SSION_CONFIRM"})]}),se.jsx(Sl,{type:"text",value:i,onChange:e=>a(e.target.value),placeholder:"Inserisci il codice di conferma",className:"font-mono"})]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsx(mo,{variant:"destructive",onClick:async()=>{if("RESET_M1SSION_CONFIRM"===i){t(!0);try{const{data:{session:e}}=await ba.auth.getSession();if(!e)throw new Error("Sessione non trovata");e.user.email;const t=`https://${ma()}.supabase.co`,s=await fetch(`${t}/functions/v1/reset-mission`,{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json","x-m1ssion-sig":"official-client"},body:JSON.stringify({confirmationCode:i})}),n=await s.json();if(s.status,!s.ok)throw new Error(n.error||`HTTP ${s.status}: ${s.statusText}`);const o=n;if(!o.success)throw new Error(o.error||"Reset fallito");{const e=o.tables_reset||[],t=o.reset_details?.reset_date,i=o.mission_status?.days_remaining||30;Ki.success(" RESET MISSIONE COMPLETATO",{description:`Missione completamente azzerata! ${e.length} tabelle ripristinate. Giorni rimasti: ${i}. La pagina si ricaricher automaticamente.`}),r(!1),a(""),window.dispatchEvent(new CustomEvent("missionReset",{detail:{resetDate:t,daysRemaining:i,tablesReset:e}})),localStorage.clear(),setTimeout(()=>{window.location.reload()},3e3)}}catch(e){console.error(" Reset mission error:",e),Ki.error(" ERRORE RESET MISSIONE",{description:e.message||"Errore sconosciuto durante il reset"})}finally{t(!1)}}else Ki.error("Codice di conferma non valido")},disabled:e||"RESET_M1SSION_CONFIRM"!==i,className:"flex-1",children:e?"RESETTING...":"CONFERMA RESET"}),se.jsx(mo,{variant:"outline",onClick:()=>{r(!1),a("")},disabled:e,children:"Annulla"})]})]}):se.jsxs(mo,{variant:"destructive",onClick:()=>r(!0),className:"w-full",children:[se.jsx(vr,{className:"mr-2 h-4 w-4"}),"AVVIA RESET MISSIONE"]})]})]})},Jz=()=>{const[e,t]=We.useState({city:"",country:"",street:"",street_number:"",prize_type:"",prize_color:"",prize_material:"",prize_category:""}),[i,a]=We.useState(!1),[s,r]=We.useState(!1);We.useEffect(()=>{n()},[]);const n=async()=>{a(!0);try{const{data:e,error:i}=await ba.from("current_mission_data").select("*").eq("is_active",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(i)return void console.error("Error loading mission:",i);e&&t({city:e.city||"",country:e.country||"",street:e.street||"",street_number:e.street_number||"",prize_type:e.prize_type||"",prize_color:e.prize_color||"",prize_material:e.prize_material||"",prize_category:e.prize_category||""})}catch(e){console.error("Error loading mission:",e)}finally{a(!1)}},o=(e,i)=>{t(t=>({...t,[e]:i}))};return se.jsxs(Wl,{className:"border-primary/20 bg-primary/5",children:[se.jsxs(Hl,{children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(xr,{className:"h-5 w-5 text-primary"}),se.jsx(Zl,{className:"text-primary",children:"IMPOSTA MISSIONE"})]}),se.jsx(Vl,{children:"Configura manualmente tutti i parametri della missione corrente"})]}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[se.jsx(Ys,{className:"h-4 w-4 text-muted-foreground"}),se.jsx("h3",{className:"font-semibold",children:"Ubicazione"})]}),se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"city",children:"Citt"}),se.jsx(Sl,{id:"city",value:e.city,onChange:e=>o("city",e.target.value),placeholder:"es. Milano"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"country",children:"Paese"}),se.jsx(Sl,{id:"country",value:e.country,onChange:e=>o("country",e.target.value),placeholder:"es. Italia"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"street",children:"Via"}),se.jsx(Sl,{id:"street",value:e.street,onChange:e=>o("street",e.target.value),placeholder:"es. Via Montenapoleone"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"street_number",children:"Numero Civico"}),se.jsx(Sl,{id:"street_number",value:e.street_number,onChange:e=>o("street_number",e.target.value),placeholder:"es. 12A"})]})]})]}),se.jsxs("div",{className:"space-y-4",children:[se.jsx("h3",{className:"font-semibold",children:"Premio"}),se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"prize_type",children:"Tipo Premio"}),se.jsxs(SA,{value:e.prize_type,onValueChange:e=>o("prize_type",e),children:[se.jsx(kA,{children:se.jsx(_A,{placeholder:"Seleziona tipo premio"})}),se.jsx(zA,{children:["Rolex","Borsa Herms","Auto Ferrari","Auto Lamborghini","Auto Porsche","Gioiello Cartier","Anello Tiffany","Orologio Patek Philippe","Borsa Chanel","Auto BMW","Auto Mercedes","Smartphone iPhone","Laptop MacBook","Tablet iPad"].map(e=>se.jsx(EA,{value:e,children:e},e))})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"prize_color",children:"Colore Premio"}),se.jsxs(SA,{value:e.prize_color,onValueChange:e=>o("prize_color",e),children:[se.jsx(kA,{children:se.jsx(_A,{placeholder:"Seleziona colore"})}),se.jsx(zA,{children:["Oro","Argento","Rosso","Nero","Blu Navy","Bianco","Verde","Marrone","Rosa Gold","Platino","Bronze","Blu Elettrico","Grigio","Bordeaux"].map(e=>se.jsx(EA,{value:e,children:e},e))})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"prize_material",children:"Materiale Premio"}),se.jsxs(SA,{value:e.prize_material,onValueChange:e=>o("prize_material",e),children:[se.jsx(kA,{children:se.jsx(_A,{placeholder:"Seleziona materiale"})}),se.jsx(zA,{children:["Oro 18K","Oro 24K","Argento 925","Platino","Acciaio Inossidabile","Pelle di Coccodrillo","Pelle di Pitone","Pelle Italiana","Seta","Carbonio","Titanio","Ceramica","Cristallo Zaffiro","Diamanti"].map(e=>se.jsx(EA,{value:e,children:e},e))})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"prize_category",children:"Categoria Premio"}),se.jsxs(SA,{value:e.prize_category,onValueChange:e=>o("prize_category",e),children:[se.jsx(kA,{children:se.jsx(_A,{placeholder:"Seleziona categoria"})}),se.jsx(zA,{children:["Orologio","Borsa","Gioiello","Veicolo","Tech","Accessorio","Arte","Elettronica","Lusso","Moda","Sport","Casa"].map(e=>se.jsx(EA,{value:e,children:e},e))})]})]})]})]}),se.jsxs(mo,{onClick:async()=>{r(!0);try{const{data:{session:t}}=await ba.auth.getSession();if(!t)throw new Error("Sessione non trovata");const i=await ba.functions.invoke("update-mission",{body:{missionData:e},headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"}});if(i.error)throw new Error(i.error.message||"Errore durante il salvataggio");const a=i.data;if(!a.success)throw new Error(a.error||"Salvataggio fallito");Ki.success(" MISSIONE AGGIORNATA",{description:`Configurazione salvata: ${e.city}, ${e.country}`})}catch(t){console.error(" Save mission error:",t),Ki.error(" ERRORE SALVATAGGIO",{description:t.message||"Errore sconosciuto durante il salvataggio"})}finally{r(!1)}},disabled:s||i,className:"w-full",children:[se.jsx(mr,{className:"mr-2 h-4 w-4"}),s?"SALVANDO...":"SALVA CONFIGURAZIONE MISSIONE"]})]})]})},Qz="wikus77@hotmail.it";const eE=()=>{const{user:e,isAuthenticated:t,isLoading:i}=bl(),{navigate:a}=yl(),[s,r]=We.useState(!1),[n,o]=We.useState(!0),[l,c]=We.useState(""),d=async t=>{try{await ba.from("admin_logs").insert({event_type:"panel_access_attempt",user_id:e?.id||null,context:JSON.stringify({email:t.email,ip:t.ip,userAgent:t.userAgent,success:t.success,reason:l}),note:t.success?"Accesso autorizzato al M1SSION PANEL":"Tentativo di accesso non autorizzato"})}catch(i){console.error(" Errore nel logging dell'accesso:",i)}},u=async()=>{o(!0);try{const s={ip:"client-side",userAgent:navigator.userAgent};if((new Date).toISOString(),!t||!e?.email)return console.error(" PANEL ACCESS DENIED - Not authenticated:",{isAuthenticated:t,isLoading:i,hasUser:!!e,hasEmail:!!e?.email}),c("Utente non autenticato"),r(!1),void(await d({email:e?.email||"anonymous",ip:s.ip,userAgent:s.userAgent,timestamp:(new Date).toISOString(),success:!1}));if(e.email!==Qz)return console.error(" PANEL ACCESS DENIED - Wrong email:",{actualEmail:e.email,expectedEmail:Qz,match:e.email===Qz}),c("Email non autorizzata"),r(!1),void(await d({email:e.email,ip:s.ip,userAgent:s.userAgent,timestamp:(new Date).toISOString(),success:!1}));if("9e0aefd8ff5e2879549f1bfddb3975372f9f4281ea9f9120ef90278763653c52"!==await async function(e){const t=(new TextEncoder).encode(e),i=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,"0")).join("")}(e.email))return c("Hash email non valido"),r(!1),await d({email:e.email,ip:s.ip,userAgent:s.userAgent,timestamp:(new Date).toISOString(),success:!1}),void a("/access-denied");r(!0),c(""),await d({email:e.email,ip:s.ip,userAgent:s.userAgent,timestamp:(new Date).toISOString(),success:!0})}catch(s){console.error(" Errore nella validazione dell'accesso:",s),c("Errore di validazione"),r(!1),a("/access-denied")}finally{o(!1)}};return We.useEffect(()=>{u()},[t,e?.email]),We.useEffect(()=>{n||s||a("/access-denied")},[n,s]),{isWhitelisted:s,isValidating:n,accessDeniedReason:l,revalidate:u}};var tE={},iE={},aE={};let sE;const rE=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];aE.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},aE.getSymbolTotalCodewords=function(e){return rE[e]},aE.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},aE.setToSJISFunction=function(e){if("function"!=typeof e)throw new Error('"toSJISFunc" is not a valid function.');sE=e},aE.isKanjiModeEnabled=function(){return void 0!==sE},aE.toSJIS=function(e){return sE(e)};var nE,oE={};function lE(){this.buffer=[],this.length=0}(nE=oE).L={bit:1},nE.M={bit:0},nE.Q={bit:3},nE.H={bit:2},nE.isValid=function(e){return e&&void 0!==e.bit&&e.bit>=0&&e.bit<4},nE.from=function(e,t){if(nE.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return nE.L;case"m":case"medium":return nE.M;case"q":case"quartile":return nE.Q;case"h":case"high":return nE.H;default:throw new Error("Unknown EC Level: "+e)}}(e)}catch(i){return t}},lE.prototype={get:function(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let i=0;i<t;i++)this.putBit(1==(e>>>t-i-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var cE=lE;function dE(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}dE.prototype.set=function(e,t,i,a){const s=e*this.size+t;this.data[s]=i,a&&(this.reservedBit[s]=!0)},dE.prototype.get=function(e,t){return this.data[e*this.size+t]},dE.prototype.xor=function(e,t,i){this.data[e*this.size+t]^=i},dE.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]};var uE=dE,hE={};!function(e){const t=aE.getSymbolSize;e.getRowColCoords=function(e){if(1===e)return[];const i=Math.floor(e/7)+2,a=t(e),s=145===a?26:2*Math.ceil((a-13)/(2*i-2)),r=[a-7];for(let t=1;t<i-1;t++)r[t]=r[t-1]-s;return r.push(6),r.reverse()},e.getPositions=function(t){const i=[],a=e.getRowColCoords(t),s=a.length;for(let e=0;e<s;e++)for(let t=0;t<s;t++)0===e&&0===t||0===e&&t===s-1||e===s-1&&0===t||i.push([a[e],a[t]]);return i}}(hE);var mE={};const pE=aE.getSymbolSize;mE.getPositions=function(e){const t=pE(e);return[[0,0],[t-7,0],[0,t-7]]};var fE={};!function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t=3,i=3,a=40,s=10;function r(t,i,a){switch(t){case e.Patterns.PATTERN000:return(i+a)%2==0;case e.Patterns.PATTERN001:return i%2==0;case e.Patterns.PATTERN010:return a%3==0;case e.Patterns.PATTERN011:return(i+a)%3==0;case e.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(a/3))%2==0;case e.Patterns.PATTERN101:return i*a%2+i*a%3==0;case e.Patterns.PATTERN110:return(i*a%2+i*a%3)%2==0;case e.Patterns.PATTERN111:return(i*a%3+(i+a)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}}e.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},e.from=function(t){return e.isValid(t)?parseInt(t,10):void 0},e.getPenaltyN1=function(e){const i=e.size;let a=0,s=0,r=0,n=null,o=null;for(let l=0;l<i;l++){s=r=0,n=o=null;for(let c=0;c<i;c++){let i=e.get(l,c);i===n?s++:(s>=5&&(a+=t+(s-5)),n=i,s=1),i=e.get(c,l),i===o?r++:(r>=5&&(a+=t+(r-5)),o=i,r=1)}s>=5&&(a+=t+(s-5)),r>=5&&(a+=t+(r-5))}return a},e.getPenaltyN2=function(e){const t=e.size;let a=0;for(let i=0;i<t-1;i++)for(let s=0;s<t-1;s++){const t=e.get(i,s)+e.get(i,s+1)+e.get(i+1,s)+e.get(i+1,s+1);4!==t&&0!==t||a++}return a*i},e.getPenaltyN3=function(e){const t=e.size;let i=0,s=0,r=0;for(let a=0;a<t;a++){s=r=0;for(let n=0;n<t;n++)s=s<<1&2047|e.get(a,n),n>=10&&(1488===s||93===s)&&i++,r=r<<1&2047|e.get(n,a),n>=10&&(1488===r||93===r)&&i++}return i*a},e.getPenaltyN4=function(e){let t=0;const i=e.data.length;for(let a=0;a<i;a++)t+=e.data[a];return Math.abs(Math.ceil(100*t/i/5)-10)*s},e.applyMask=function(e,t){const i=t.size;for(let a=0;a<i;a++)for(let s=0;s<i;s++)t.isReserved(s,a)||t.xor(s,a,r(e,s,a))},e.getBestMask=function(t,i){const a=Object.keys(e.Patterns).length;let s=0,r=1/0;for(let n=0;n<a;n++){i(n),e.applyMask(n,t);const a=e.getPenaltyN1(t)+e.getPenaltyN2(t)+e.getPenaltyN3(t)+e.getPenaltyN4(t);e.applyMask(n,t),a<r&&(r=a,s=n)}return s}}(fE);var gE={};const xE=oE,bE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],vE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];gE.getBlocksCount=function(e,t){switch(t){case xE.L:return bE[4*(e-1)+0];case xE.M:return bE[4*(e-1)+1];case xE.Q:return bE[4*(e-1)+2];case xE.H:return bE[4*(e-1)+3];default:return}},gE.getTotalCodewordsCount=function(e,t){switch(t){case xE.L:return vE[4*(e-1)+0];case xE.M:return vE[4*(e-1)+1];case xE.Q:return vE[4*(e-1)+2];case xE.H:return vE[4*(e-1)+3];default:return}};var yE={},wE={};const NE=new Uint8Array(512),jE=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)NE[t]=e,jE[e]=t,e<<=1,256&e&&(e^=285);for(let t=255;t<512;t++)NE[t]=NE[t-255]}(),wE.log=function(e){if(e<1)throw new Error("log("+e+")");return jE[e]},wE.exp=function(e){return NE[e]},wE.mul=function(e,t){return 0===e||0===t?0:NE[jE[e]+jE[t]]},function(e){const t=wE;e.mul=function(e,i){const a=new Uint8Array(e.length+i.length-1);for(let s=0;s<e.length;s++)for(let r=0;r<i.length;r++)a[s+r]^=t.mul(e[s],i[r]);return a},e.mod=function(e,i){let a=new Uint8Array(e);for(;a.length-i.length>=0;){const e=a[0];for(let r=0;r<i.length;r++)a[r]^=t.mul(i[r],e);let s=0;for(;s<a.length&&0===a[s];)s++;a=a.slice(s)}return a},e.generateECPolynomial=function(i){let a=new Uint8Array([1]);for(let s=0;s<i;s++)a=e.mul(a,new Uint8Array([1,t.exp(s)]));return a}}(yE);const SE=yE;function _E(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}_E.prototype.initialize=function(e){this.degree=e,this.genPoly=SE.generateECPolynomial(this.degree)},_E.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const i=SE.mod(t,this.genPoly),a=this.degree-i.length;if(a>0){const e=new Uint8Array(this.degree);return e.set(i,a),e}return i};var kE=_E,CE={},AE={},zE={isValid:function(e){return!isNaN(e)&&e>=1&&e<=40}},EE={};const IE="[0-9]+";let PE="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";PE=PE.replace(/u/g,"\\u");const TE="(?:(?![A-Z0-9 $%*+\\-./:]|"+PE+")(?:.|[\r\n]))+";EE.KANJI=new RegExp(PE,"g"),EE.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),EE.BYTE=new RegExp(TE,"g"),EE.NUMERIC=new RegExp(IE,"g"),EE.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const ME=new RegExp("^"+PE+"$"),LE=new RegExp("^"+IE+"$"),FE=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");EE.testKanji=function(e){return ME.test(e)},EE.testNumeric=function(e){return LE.test(e)},EE.testAlphanumeric=function(e){return FE.test(e)},function(e){const t=zE,i=EE;e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(e,i){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!t.isValid(i))throw new Error("Invalid version: "+i);return i>=1&&i<10?e.ccBits[0]:i<27?e.ccBits[1]:e.ccBits[2]},e.getBestModeForData=function(t){return i.testNumeric(t)?e.NUMERIC:i.testAlphanumeric(t)?e.ALPHANUMERIC:i.testKanji(t)?e.KANJI:e.BYTE},e.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},e.isValid=function(e){return e&&e.bit&&e.ccBits},e.from=function(t,i){if(e.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+t)}}(t)}catch(a){return i}}}(AE),function(e){const t=aE,i=gE,a=oE,s=AE,r=zE,n=t.getBCHDigit(7973);function o(e,t){return s.getCharCountIndicator(e,t)+4}function l(e,t){let i=0;return e.forEach(function(e){const a=o(e.mode,t);i+=a+e.getBitsLength()}),i}e.from=function(e,t){return r.isValid(e)?parseInt(e,10):t},e.getCapacity=function(e,a,n){if(!r.isValid(e))throw new Error("Invalid QR Code version");void 0===n&&(n=s.BYTE);const l=8*(t.getSymbolTotalCodewords(e)-i.getTotalCodewordsCount(e,a));if(n===s.MIXED)return l;const c=l-o(n,e);switch(n){case s.NUMERIC:return Math.floor(c/10*3);case s.ALPHANUMERIC:return Math.floor(c/11*2);case s.KANJI:return Math.floor(c/13);case s.BYTE:default:return Math.floor(c/8)}},e.getBestVersionForData=function(t,i){let r;const n=a.from(i,a.M);if(Array.isArray(t)){if(t.length>1)return function(t,i){for(let a=1;a<=40;a++)if(l(t,a)<=e.getCapacity(a,i,s.MIXED))return a}(t,n);if(0===t.length)return 1;r=t[0]}else r=t;return function(t,i,a){for(let s=1;s<=40;s++)if(i<=e.getCapacity(s,a,t))return s}(r.mode,r.getLength(),n)},e.getEncodedBits=function(e){if(!r.isValid(e)||e<7)throw new Error("Invalid QR Code version");let i=e<<12;for(;t.getBCHDigit(i)-n>=0;)i^=7973<<t.getBCHDigit(i)-n;return e<<12|i}}(CE);var OE={};const DE=aE,RE=DE.getBCHDigit(1335);OE.getEncodedBits=function(e,t){const i=e.bit<<3|t;let a=i<<10;for(;DE.getBCHDigit(a)-RE>=0;)a^=1335<<DE.getBCHDigit(a)-RE;return 21522^(i<<10|a)};var BE={};const UE=AE;function qE(e){this.mode=UE.NUMERIC,this.data=e.toString()}qE.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},qE.prototype.getLength=function(){return this.data.length},qE.prototype.getBitsLength=function(){return qE.getBitsLength(this.data.length)},qE.prototype.write=function(e){let t,i,a;for(t=0;t+3<=this.data.length;t+=3)i=this.data.substr(t,3),a=parseInt(i,10),e.put(a,10);const s=this.data.length-t;s>0&&(i=this.data.substr(t),a=parseInt(i,10),e.put(a,3*s+1))};var $E=qE;const WE=AE,HE=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function ZE(e){this.mode=WE.ALPHANUMERIC,this.data=e}ZE.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},ZE.prototype.getLength=function(){return this.data.length},ZE.prototype.getBitsLength=function(){return ZE.getBitsLength(this.data.length)},ZE.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let i=45*HE.indexOf(this.data[t]);i+=HE.indexOf(this.data[t+1]),e.put(i,11)}this.data.length%2&&e.put(HE.indexOf(this.data[t]),6)};var VE=ZE;const GE=AE;function YE(e){this.mode=GE.BYTE,this.data="string"==typeof e?(new TextEncoder).encode(e):new Uint8Array(e)}YE.getBitsLength=function(e){return 8*e},YE.prototype.getLength=function(){return this.data.length},YE.prototype.getBitsLength=function(){return YE.getBitsLength(this.data.length)},YE.prototype.write=function(e){for(let t=0,i=this.data.length;t<i;t++)e.put(this.data[t],8)};var KE=YE;const XE=AE,JE=aE;function QE(e){this.mode=XE.KANJI,this.data=e}QE.getBitsLength=function(e){return 13*e},QE.prototype.getLength=function(){return this.data.length},QE.prototype.getBitsLength=function(){return QE.getBitsLength(this.data.length)},QE.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let i=JE.toSJIS(this.data[t]);if(i>=33088&&i<=40956)i-=33088;else{if(!(i>=57408&&i<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");i-=49472}i=192*(i>>>8&255)+(255&i),e.put(i,13)}};var eI,tI=QE,iI={exports:{}},aI=iI.exports=eI={single_source_shortest_paths:function(e,t,i){var a={},s={};s[t]=0;var r,n,o,l,c,d,u,h=eI.PriorityQueue.make();for(h.push(t,0);!h.empty();)for(o in n=(r=h.pop()).value,l=r.cost,c=e[n]||{})c.hasOwnProperty(o)&&(d=l+c[o],u=s[o],(void 0===s[o]||u>d)&&(s[o]=d,h.push(o,d),a[o]=n));if(void 0!==i&&void 0===s[i]){var m=["Could not find a path from ",t," to ",i,"."].join("");throw new Error(m)}return a},extract_shortest_path_from_predecessor_list:function(e,t){for(var i=[],a=t;a;)i.push(a),e[a],a=e[a];return i.reverse(),i},find_path:function(e,t,i){var a=eI.single_source_shortest_paths(e,t,i);return eI.extract_shortest_path_from_predecessor_list(a,i)},PriorityQueue:{make:function(e){var t,i=eI.PriorityQueue,a={};for(t in e=e||{},i)i.hasOwnProperty(t)&&(a[t]=i[t]);return a.queue=[],a.sorter=e.sorter||i.default_sorter,a},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var i={value:e,cost:t};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};!function(e){const t=AE,i=$E,a=VE,s=KE,r=tI,n=EE,o=aE,l=aI;function c(e){return unescape(encodeURIComponent(e)).length}function d(e,t,i){const a=[];let s;for(;null!==(s=e.exec(i));)a.push({data:s[0],index:s.index,mode:t,length:s[0].length});return a}function u(e){const i=d(n.NUMERIC,t.NUMERIC,e),a=d(n.ALPHANUMERIC,t.ALPHANUMERIC,e);let s,r;o.isKanjiModeEnabled()?(s=d(n.BYTE,t.BYTE,e),r=d(n.KANJI,t.KANJI,e)):(s=d(n.BYTE_KANJI,t.BYTE,e),r=[]);return i.concat(a,s,r).sort(function(e,t){return e.index-t.index}).map(function(e){return{data:e.data,mode:e.mode,length:e.length}})}function h(e,n){switch(n){case t.NUMERIC:return i.getBitsLength(e);case t.ALPHANUMERIC:return a.getBitsLength(e);case t.KANJI:return r.getBitsLength(e);case t.BYTE:return s.getBitsLength(e)}}function m(e,n){let l;const c=t.getBestModeForData(e);if(l=t.from(n,c),l!==t.BYTE&&l.bit<c.bit)throw new Error('"'+e+'" cannot be encoded with mode '+t.toString(l)+".\n Suggested mode is: "+t.toString(c));switch(l!==t.KANJI||o.isKanjiModeEnabled()||(l=t.BYTE),l){case t.NUMERIC:return new i(e);case t.ALPHANUMERIC:return new a(e);case t.KANJI:return new r(e);case t.BYTE:return new s(e)}}e.fromArray=function(e){return e.reduce(function(e,t){return"string"==typeof t?e.push(m(t,null)):t.data&&e.push(m(t.data,t.mode)),e},[])},e.fromString=function(i,a){const s=function(e){const i=[];for(let a=0;a<e.length;a++){const s=e[a];switch(s.mode){case t.NUMERIC:i.push([s,{data:s.data,mode:t.ALPHANUMERIC,length:s.length},{data:s.data,mode:t.BYTE,length:s.length}]);break;case t.ALPHANUMERIC:i.push([s,{data:s.data,mode:t.BYTE,length:s.length}]);break;case t.KANJI:i.push([s,{data:s.data,mode:t.BYTE,length:c(s.data)}]);break;case t.BYTE:i.push([{data:s.data,mode:t.BYTE,length:c(s.data)}])}}return i}(u(i,o.isKanjiModeEnabled())),r=function(e,i){const a={},s={start:{}};let r=["start"];for(let n=0;n<e.length;n++){const o=e[n],l=[];for(let e=0;e<o.length;e++){const c=o[e],d=""+n+e;l.push(d),a[d]={node:c,lastCount:0},s[d]={};for(let e=0;e<r.length;e++){const n=r[e];a[n]&&a[n].node.mode===c.mode?(s[n][d]=h(a[n].lastCount+c.length,c.mode)-h(a[n].lastCount,c.mode),a[n].lastCount+=c.length):(a[n]&&(a[n].lastCount=c.length),s[n][d]=h(c.length,c.mode)+4+t.getCharCountIndicator(c.mode,i))}}r=l}for(let t=0;t<r.length;t++)s[r[t]].end=0;return{map:s,table:a}}(s,a),n=l.find_path(r.map,"start","end"),d=[];for(let e=1;e<n.length-1;e++)d.push(r.table[n[e]].node);return e.fromArray(function(e){return e.reduce(function(e,t){const i=e.length-1>=0?e[e.length-1]:null;return i&&i.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)},[])}(d))},e.rawSplit=function(t){return e.fromArray(u(t,o.isKanjiModeEnabled()))}}(BE);const sI=aE,rI=oE,nI=cE,oI=uE,lI=hE,cI=mE,dI=fE,uI=gE,hI=kE,mI=CE,pI=OE,fI=AE,gI=BE;function xI(e,t,i){const a=e.size,s=pI.getEncodedBits(t,i);let r,n;for(r=0;r<15;r++)n=1==(s>>r&1),r<6?e.set(r,8,n,!0):r<8?e.set(r+1,8,n,!0):e.set(a-15+r,8,n,!0),r<8?e.set(8,a-r-1,n,!0):r<9?e.set(8,15-r-1+1,n,!0):e.set(8,15-r-1,n,!0);e.set(a-8,8,1,!0)}function bI(e,t,i){const a=new nI;i.forEach(function(t){a.put(t.mode.bit,4),a.put(t.getLength(),fI.getCharCountIndicator(t.mode,e)),t.write(a)});const s=8*(sI.getSymbolTotalCodewords(e)-uI.getTotalCodewordsCount(e,t));for(a.getLengthInBits()+4<=s&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(0);const r=(s-a.getLengthInBits())/8;for(let n=0;n<r;n++)a.put(n%2?17:236,8);return function(e,t,i){const a=sI.getSymbolTotalCodewords(t),s=uI.getTotalCodewordsCount(t,i),r=a-s,n=uI.getBlocksCount(t,i),o=a%n,l=n-o,c=Math.floor(a/n),d=Math.floor(r/n),u=d+1,h=c-d,m=new hI(h);let p=0;const f=new Array(n),g=new Array(n);let x=0;const b=new Uint8Array(e.buffer);for(let j=0;j<n;j++){const e=j<l?d:u;f[j]=b.slice(p,p+e),g[j]=m.encode(f[j]),p+=e,x=Math.max(x,e)}const v=new Uint8Array(a);let y,w,N=0;for(y=0;y<x;y++)for(w=0;w<n;w++)y<f[w].length&&(v[N++]=f[w][y]);for(y=0;y<h;y++)for(w=0;w<n;w++)v[N++]=g[w][y];return v}(a,e,t)}function vI(e,t,i,a){let s;if(Array.isArray(e))s=gI.fromArray(e);else{if("string"!=typeof e)throw new Error("Invalid data");{let a=t;if(!a){const t=gI.rawSplit(e);a=mI.getBestVersionForData(t,i)}s=gI.fromString(e,a||40)}}const r=mI.getBestVersionForData(s,i);if(!r)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<r)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+r+".\n")}else t=r;const n=bI(t,i,s),o=sI.getSymbolSize(t),l=new oI(o);return function(e,t){const i=e.size,a=cI.getPositions(t);for(let s=0;s<a.length;s++){const t=a[s][0],r=a[s][1];for(let a=-1;a<=7;a++)if(!(t+a<=-1||i<=t+a))for(let s=-1;s<=7;s++)r+s<=-1||i<=r+s||(a>=0&&a<=6&&(0===s||6===s)||s>=0&&s<=6&&(0===a||6===a)||a>=2&&a<=4&&s>=2&&s<=4?e.set(t+a,r+s,!0,!0):e.set(t+a,r+s,!1,!0))}}(l,t),function(e){const t=e.size;for(let i=8;i<t-8;i++){const t=i%2==0;e.set(i,6,t,!0),e.set(6,i,t,!0)}}(l),function(e,t){const i=lI.getPositions(t);for(let a=0;a<i.length;a++){const t=i[a][0],s=i[a][1];for(let i=-2;i<=2;i++)for(let a=-2;a<=2;a++)-2===i||2===i||-2===a||2===a||0===i&&0===a?e.set(t+i,s+a,!0,!0):e.set(t+i,s+a,!1,!0)}}(l,t),xI(l,i,0),t>=7&&function(e,t){const i=e.size,a=mI.getEncodedBits(t);let s,r,n;for(let o=0;o<18;o++)s=Math.floor(o/3),r=o%3+i-8-3,n=1==(a>>o&1),e.set(s,r,n,!0),e.set(r,s,n,!0)}(l,t),function(e,t){const i=e.size;let a=-1,s=i-1,r=7,n=0;for(let o=i-1;o>0;o-=2)for(6===o&&o--;;){for(let i=0;i<2;i++)if(!e.isReserved(s,o-i)){let a=!1;n<t.length&&(a=1==(t[n]>>>r&1)),e.set(s,o-i,a),r--,-1===r&&(n++,r=7)}if(s+=a,s<0||i<=s){s-=a,a=-a;break}}}(l,n),isNaN(a)&&(a=dI.getBestMask(l,xI.bind(null,l,i))),dI.applyMask(a,l),xI(l,i,a),{modules:l,version:t,errorCorrectionLevel:i,maskPattern:a,segments:s}}iE.create=function(e,t){if(void 0===e||""===e)throw new Error("No input text");let i,a,s=rI.M;return void 0!==t&&(s=rI.from(t.errorCorrectionLevel,rI.M),i=mI.from(t.version),a=dI.from(t.maskPattern),t.toSJISFunc&&sI.setToSJISFunction(t.toSJISFunc)),vI(e,i,s,a)};var yI={},wI={};!function(e){function t(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map(function(e){return[e,e]}))),6===t.length&&t.push("F","F");const i=parseInt(t.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:255&i,hex:"#"+t.slice(0,6).join("")}}e.getOptions=function(e){e||(e={}),e.color||(e.color={});const i=void 0===e.margin||null===e.margin||e.margin<0?4:e.margin,a=e.width&&e.width>=21?e.width:void 0,s=e.scale||4;return{width:a,scale:a?4:s,margin:i,color:{dark:t(e.color.dark||"#000000ff"),light:t(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},e.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},e.getImageWidth=function(t,i){const a=e.getScale(t,i);return Math.floor((t+2*i.margin)*a)},e.qrToImageData=function(t,i,a){const s=i.modules.size,r=i.modules.data,n=e.getScale(s,a),o=Math.floor((s+2*a.margin)*n),l=a.margin*n,c=[a.color.light,a.color.dark];for(let e=0;e<o;e++)for(let i=0;i<o;i++){let d=4*(e*o+i),u=a.color.light;if(e>=l&&i>=l&&e<o-l&&i<o-l){u=c[r[Math.floor((e-l)/n)*s+Math.floor((i-l)/n)]?1:0]}t[d++]=u.r,t[d++]=u.g,t[d++]=u.b,t[d]=u.a}}}(wI),function(e){const t=wI;e.render=function(e,i,a){let s=a,r=i;void 0!==s||i&&i.getContext||(s=i,i=void 0),i||(r=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}()),s=t.getOptions(s);const n=t.getImageWidth(e.modules.size,s),o=r.getContext("2d"),l=o.createImageData(n,n);return t.qrToImageData(l.data,e,s),function(e,t,i){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=i,t.width=i,t.style.height=i+"px",t.style.width=i+"px"}(o,r,n),o.putImageData(l,0,0),r},e.renderToDataURL=function(t,i,a){let s=a;void 0!==s||i&&i.getContext||(s=i,i=void 0),s||(s={});const r=e.render(t,i,s),n=s.type||"image/png",o=s.rendererOpts||{};return r.toDataURL(n,o.quality)}}(yI);var NI={};const jI=wI;function SI(e,t){const i=e.a/255,a=t+'="'+e.hex+'"';return i<1?a+" "+t+'-opacity="'+i.toFixed(2).slice(1)+'"':a}function _I(e,t,i){let a=e+t;return void 0!==i&&(a+=" "+i),a}NI.render=function(e,t,i){const a=jI.getOptions(t),s=e.modules.size,r=e.modules.data,n=s+2*a.margin,o=a.color.light.a?"<path "+SI(a.color.light,"fill")+' d="M0 0h'+n+"v"+n+'H0z"/>':"",l="<path "+SI(a.color.dark,"stroke")+' d="'+function(e,t,i){let a="",s=0,r=!1,n=0;for(let o=0;o<e.length;o++){const l=Math.floor(o%t),c=Math.floor(o/t);l||r||(r=!0),e[o]?(n++,o>0&&l>0&&e[o-1]||(a+=r?_I("M",l+i,.5+c+i):_I("m",s,0),s=0,r=!1),l+1<t&&e[o+1]||(a+=_I("h",n),n=0)):s++}return a}(r,s,a.margin)+'"/>',c='viewBox="0 0 '+n+" "+n+'"',d='<svg xmlns="http://www.w3.org/2000/svg" '+(a.width?'width="'+a.width+'" height="'+a.width+'" ':"")+c+' shape-rendering="crispEdges">'+o+l+"</svg>\n";return"function"==typeof i&&i(null,d),d};const kI=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then},CI=iE,AI=yI,zI=NI;function EI(e,t,i,a,s){const r=[].slice.call(arguments,1),n=r.length,o="function"==typeof r[n-1];if(!o&&!kI())throw new Error("Callback required as last argument");if(!o){if(n<1)throw new Error("Too few arguments provided");return 1===n?(i=t,t=a=void 0):2!==n||t.getContext||(a=i,i=t,t=void 0),new Promise(function(s,r){try{const r=CI.create(i,a);s(e(r,t,a))}catch(n){r(n)}})}if(n<2)throw new Error("Too few arguments provided");2===n?(s=i,i=t,t=a=void 0):3===n&&(t.getContext&&void 0===s?(s=a,a=void 0):(s=a,a=i,i=t,t=void 0));try{const r=CI.create(i,a);s(null,e(r,t,a))}catch(l){s(l)}}function II(e){return(II="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}tE.create=CI.create,tE.toCanvas=EI.bind(null,AI.render),tE.toDataURL=EI.bind(null,AI.renderToDataURL),tE.toString=EI.bind(null,function(e,t,i){return zI.render(e,i)});var PI=Uint8Array,TI=Uint16Array,MI=Int32Array,LI=new PI([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),FI=new PI([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),OI=new PI([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DI=function(e,t){for(var i=new TI(31),a=0;a<31;++a)i[a]=t+=1<<e[a-1];var s=new MI(i[30]);for(a=1;a<30;++a)for(var r=i[a];r<i[a+1];++r)s[r]=r-i[a]<<5|a;return{b:i,r:s}},RI=DI(LI,2),BI=RI.b,UI=RI.r;BI[28]=258,UI[258]=28;for(var qI=DI(FI,0).r,$I=new TI(32768),WI=0;WI<32768;++WI){var HI=(43690&WI)>>1|(21845&WI)<<1;HI=(61680&(HI=(52428&HI)>>2|(13107&HI)<<2))>>4|(3855&HI)<<4,$I[WI]=((65280&HI)>>8|(255&HI)<<8)>>1}var ZI=function(e,t,i){for(var a=e.length,s=0,r=new TI(t);s<a;++s)e[s]&&++r[e[s]-1];var n,o=new TI(t);for(s=1;s<t;++s)o[s]=o[s-1]+r[s-1]<<1;if(i){n=new TI(1<<t);var l=15-t;for(s=0;s<a;++s)if(e[s])for(var c=s<<4|e[s],d=t-e[s],u=o[e[s]-1]++<<d,h=u|(1<<d)-1;u<=h;++u)n[$I[u]>>l]=c}else for(n=new TI(a),s=0;s<a;++s)e[s]&&(n[s]=$I[o[e[s]-1]++]>>15-e[s]);return n},VI=new PI(288);for(WI=0;WI<144;++WI)VI[WI]=8;for(WI=144;WI<256;++WI)VI[WI]=9;for(WI=256;WI<280;++WI)VI[WI]=7;for(WI=280;WI<288;++WI)VI[WI]=8;var GI=new PI(32);for(WI=0;WI<32;++WI)GI[WI]=5;var YI=ZI(VI,9,0),KI=ZI(GI,5,0),XI=function(e){return(e+7)/8|0},JI=function(e,t,i){i<<=7&t;var a=t/8|0;e[a]|=i,e[a+1]|=i>>8},QI=function(e,t,i){i<<=7&t;var a=t/8|0;e[a]|=i,e[a+1]|=i>>8,e[a+2]|=i>>16},eP=function(e,t){for(var i=[],a=0;a<e.length;++a)e[a]&&i.push({s:a,f:e[a]});var s=i.length,r=i.slice();if(!s)return{t:oP,l:0};if(1==s){var n=new PI(i[0].s+1);return n[i[0].s]=1,{t:n,l:1}}i.sort(function(e,t){return e.f-t.f}),i.push({s:-1,f:25001});var o=i[0],l=i[1],c=0,d=1,u=2;for(i[0]={s:-1,f:o.f+l.f,l:o,r:l};d!=s-1;)o=i[i[c].f<i[u].f?c++:u++],l=i[c!=d&&i[c].f<i[u].f?c++:u++],i[d++]={s:-1,f:o.f+l.f,l:o,r:l};var h=r[0].s;for(a=1;a<s;++a)r[a].s>h&&(h=r[a].s);var m=new TI(h+1),p=tP(i[d-1],m,0);if(p>t){a=0;var f=0,g=p-t,x=1<<g;for(r.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});a<s;++a){var b=r[a].s;if(!(m[b]>t))break;f+=x-(1<<p-m[b]),m[b]=t}for(f>>=g;f>0;){var v=r[a].s;m[v]<t?f-=1<<t-m[v]++-1:++a}for(;a>=0&&f;--a){var y=r[a].s;m[y]==t&&(--m[y],++f)}p=t}return{t:new PI(m),l:p}},tP=function(e,t,i){return-1==e.s?Math.max(tP(e.l,t,i+1),tP(e.r,t,i+1)):t[e.s]=i},iP=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new TI(++t),a=0,s=e[0],r=1,n=function(e){i[a++]=e},o=1;o<=t;++o)if(e[o]==s&&o!=t)++r;else{if(!s&&r>2){for(;r>138;r-=138)n(32754);r>2&&(n(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(n(s),--r;r>6;r-=6)n(8304);r>2&&(n(r-3<<5|8208),r=0)}for(;r--;)n(s);r=1,s=e[o]}return{c:i.subarray(0,a),n:t}},aP=function(e,t){for(var i=0,a=0;a<t.length;++a)i+=e[a]*t[a];return i},sP=function(e,t,i){var a=i.length,s=XI(t+2);e[s]=255&a,e[s+1]=a>>8,e[s+2]=255^e[s],e[s+3]=255^e[s+1];for(var r=0;r<a;++r)e[s+r+4]=i[r];return 8*(s+4+a)},rP=function(e,t,i,a,s,r,n,o,l,c,d){JI(t,d++,i),++s[256];for(var u=eP(s,15),h=u.t,m=u.l,p=eP(r,15),f=p.t,g=p.l,x=iP(h),b=x.c,v=x.n,y=iP(f),w=y.c,N=y.n,j=new TI(19),S=0;S<b.length;++S)++j[31&b[S]];for(S=0;S<w.length;++S)++j[31&w[S]];for(var _=eP(j,7),k=_.t,C=_.l,A=19;A>4&&!k[OI[A-1]];--A);var z,E,I,P,T=c+5<<3,M=aP(s,VI)+aP(r,GI)+n,L=aP(s,h)+aP(r,f)+n+14+3*A+aP(j,k)+2*j[16]+3*j[17]+7*j[18];if(l>=0&&T<=M&&T<=L)return sP(t,d,e.subarray(l,l+c));if(JI(t,d,1+(L<M)),d+=2,L<M){z=ZI(h,m,0),E=h,I=ZI(f,g,0),P=f;var F=ZI(k,C,0);JI(t,d,v-257),JI(t,d+5,N-1),JI(t,d+10,A-4),d+=14;for(S=0;S<A;++S)JI(t,d+3*S,k[OI[S]]);d+=3*A;for(var O=[b,w],D=0;D<2;++D){var R=O[D];for(S=0;S<R.length;++S){var B=31&R[S];JI(t,d,F[B]),d+=k[B],B>15&&(JI(t,d,R[S]>>5&127),d+=R[S]>>12)}}}else z=YI,E=VI,I=KI,P=GI;for(S=0;S<o;++S){var U=a[S];if(U>255){QI(t,d,z[(B=U>>18&31)+257]),d+=E[B+257],B>7&&(JI(t,d,U>>23&31),d+=LI[B]);var q=31&U;QI(t,d,I[q]),d+=P[q],q>3&&(QI(t,d,U>>5&8191),d+=FI[q])}else QI(t,d,z[U]),d+=E[U]}return QI(t,d,z[256]),d+E[256]},nP=new MI([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),oP=new PI(0),lP=function(e,t,i,a,s,r){var n=r.z||e.length,o=new PI(a+n+5*(1+Math.ceil(n/7e3))+s),l=o.subarray(a,o.length-s),c=r.l,d=7&(r.r||0);if(t){d&&(l[0]=r.r>>3);for(var u=nP[t-1],h=u>>13,m=8191&u,p=(1<<i)-1,f=r.p||new TI(32768),g=r.h||new TI(p+1),x=Math.ceil(i/3),b=2*x,v=function(t){return(e[t]^e[t+1]<<x^e[t+2]<<b)&p},y=new MI(25e3),w=new TI(288),N=new TI(32),j=0,S=0,_=r.i||0,k=0,C=r.w||0,A=0;_+2<n;++_){var z=v(_),E=32767&_,I=g[z];if(f[E]=I,g[z]=E,C<=_){var P=n-_;if((j>7e3||k>24576)&&(P>423||!c)){d=rP(e,l,0,y,w,N,S,k,A,_-A,d),k=j=S=0,A=_;for(var T=0;T<286;++T)w[T]=0;for(T=0;T<30;++T)N[T]=0}var M=2,L=0,F=m,O=E-I&32767;if(P>2&&z==v(_-O))for(var D=Math.min(h,P)-1,R=Math.min(32767,_),B=Math.min(258,P);O<=R&&--F&&E!=I;){if(e[_+M]==e[_+M-O]){for(var U=0;U<B&&e[_+U]==e[_+U-O];++U);if(U>M){if(M=U,L=O,U>D)break;var q=Math.min(O,U-2),$=0;for(T=0;T<q;++T){var W=_-O+T&32767,H=W-f[W]&32767;H>$&&($=H,I=W)}}}O+=(E=I)-(I=f[E])&32767}if(L){y[k++]=268435456|UI[M]<<18|qI[L];var Z=31&UI[M],V=31&qI[L];S+=LI[Z]+FI[V],++w[257+Z],++N[V],C=_+M,++j}else y[k++]=e[_],++w[e[_]]}}for(_=Math.max(_,C);_<n;++_)y[k++]=e[_],++w[e[_]];d=rP(e,l,c,y,w,N,S,k,A,_-A,d),c||(r.r=7&d|l[d/8|0]<<3,d-=7,r.h=g,r.p=f,r.i=_,r.w=C)}else{for(_=r.w||0;_<n+c;_+=65535){var G=_+65535;G>=n&&(l[d/8|0]=c,G=n),d=sP(l,d+1,e.subarray(_,G))}r.i=n}return function(e,t,i){return(null==i||i>e.length)&&(i=e.length),new PI(e.subarray(t,i))}(o,0,a+XI(d)+s)},cP=function(){var e=1,t=0;return{p:function(i){for(var a=e,s=t,r=0|i.length,n=0;n!=r;){for(var o=Math.min(n+2655,r);n<o;++n)s+=a+=i[n];a=(65535&a)+15*(a>>16),s=(65535&s)+15*(s>>16)}e=a,t=s},d:function(){return(255&(e%=65521))<<24|(65280&e)<<8|(255&(t%=65521))<<8|t>>8}}},dP=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8};function uP(e,t){t||(t={});var i=cP();i.p(e);var a=function(e,t,i,a,s){if(!s&&(s={l:1},t.dictionary)){var r=t.dictionary.subarray(-32768),n=new PI(r.length+e.length);n.set(r),n.set(e,r.length),e=n,s.w=r.length}return lP(e,null==t.level?6:t.level,null==t.mem?s.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,i,a,s)}(e,t,t.dictionary?6:2,4);return function(e,t){var i=t.level,a=0==i?0:i<6?1:9==i?3:2;if(e[0]=120,e[1]=a<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var s=cP();s.p(t.dictionary),dP(e,2,s.d())}}(a,t),dP(a,a.length-4,i.d()),a}var hP="undefined"!=typeof TextDecoder&&new TextDecoder;try{hP.decode(oP,{stream:!0})}catch(fB){}function mP(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=Array(t);i<t;i++)a[i]=e[i];return a}function pP(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a,s,r,n,o=[],l=!0,c=!1;try{if(r=(i=i.call(e)).next,0===t);else for(;!(l=(a=r.call(i)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(d){c=!0,s=d}finally{try{if(!l&&null!=i.return&&(n=i.return(),Object(n)!==n))return}finally{if(c)throw s}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return mP(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?mP(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fP(e,t="utf8"){return new TextDecoder(t).decode(e)}const gP=new TextEncoder;const xP=(()=>{const e=new Uint8Array(4);return!((new Uint32Array(e.buffer)[0]=1)&e[0])})(),bP={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class vP{constructor(e=8192,t={}){Y(this,"buffer"),Y(this,"byteLength"),Y(this,"byteOffset"),Y(this,"length"),Y(this,"offset"),Y(this,"lastWrittenByte"),Y(this,"littleEndian"),Y(this,"_data"),Y(this,"_mark"),Y(this,"_marks");let i=!1;"number"==typeof e?e=new ArrayBuffer(e):(i=!0,this.lastWrittenByte=e.byteLength);const a=t.offset?t.offset>>>0:0,s=e.byteLength-a;let r=a;(ArrayBuffer.isView(e)||e instanceof vP)&&(e.byteLength!==e.buffer.byteLength&&(r=e.byteOffset+a),e=e.buffer),this.lastWrittenByte=i?s:0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=r,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,r,s),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const t=2*(this.offset+e),i=new Uint8Array(t);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=t,this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const i=bP[t].BYTES_PER_ELEMENT*e,a=this.byteOffset+this.offset,s=this.buffer.slice(a,a+i);if(this.littleEndian===xP&&"uint8"!==t&&"int8"!==t){const e=new Uint8Array(this.buffer.slice(a,a+i));e.reverse();const s=new bP[t](e.buffer);return this.offset+=i,s.reverse(),s}const r=new bP[t](s);return this.offset+=i,r}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let i=0;i<e;i++)t+=this.readChar();return t}readUtf8(e=1){return fP(this.readBytes(e))}decodeText(e=1,t="utf8"){return fP(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(function(e){return gP.encode(e)}(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function yP(e){let t=e.length;for(;--t>=0;)e[t]=0}yP(new Array(576));yP(new Array(60));yP(new Array(512));yP(new Array(256));yP(new Array(29));yP(new Array(30));var wP=(e,t,i,a)=>{let s=65535&e,r=e>>>16&65535,n=0;for(;0!==i;){n=i>2e3?2e3:i,i-=n;do{s=s+t[a++]|0,r=r+s|0}while(--n);s%=65521,r%=65521}return s|r<<16};const NP=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var jP=(e,t,i,a)=>{const s=NP,r=a+i;e^=-1;for(let n=a;n<r;n++)e=e>>>8^s[255&(e^t[n])];return-1^e},SP={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_P={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const kP=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var CP=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)kP(i,t)&&(e[t]=i[t])}}return e},AP=e=>{let t=0;for(let a=0,s=e.length;a<s;a++)t+=e[a].length;const i=new Uint8Array(t);for(let a=0,s=0,r=e.length;a<r;a++){let t=e[a];i.set(t,s),s+=t.length}return i};let zP=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(gB){zP=!1}const EP=new Uint8Array(256);for(let xB=0;xB<256;xB++)EP[xB]=xB>=252?6:xB>=248?5:xB>=240?4:xB>=224?3:xB>=192?2:1;EP[254]=EP[254]=1;var IP=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,a,s,r,n=e.length,o=0;for(s=0;s<n;s++)i=e.charCodeAt(s),55296==(64512&i)&&s+1<n&&(a=e.charCodeAt(s+1),56320==(64512&a)&&(i=65536+(i-55296<<10)+(a-56320),s++)),o+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(o),r=0,s=0;r<o;s++)i=e.charCodeAt(s),55296==(64512&i)&&s+1<n&&(a=e.charCodeAt(s+1),56320==(64512&a)&&(i=65536+(i-55296<<10)+(a-56320),s++)),i<128?t[r++]=i:i<2048?(t[r++]=192|i>>>6,t[r++]=128|63&i):i<65536?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},PP=(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let a,s;const r=new Array(2*i);for(s=0,a=0;a<i;){let t=e[a++];if(t<128){r[s++]=t;continue}let n=EP[t];if(n>4)r[s++]=65533,a+=n-1;else{for(t&=2===n?31:3===n?15:7;n>1&&a<i;)t=t<<6|63&e[a++],n--;n>1?r[s++]=65533:t<65536?r[s++]=t:(t-=65536,r[s++]=55296|t>>10&1023,r[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&zP)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let a=0;a<t;a++)i+=String.fromCharCode(e[a]);return i})(r,s)},TP=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+EP[e[i]]>t?i:t};var MP=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const LP=16209;var FP=function(e,t){let i,a,s,r,n,o,l,c,d,u,h,m,p,f,g,x,b,v,y,w,N,j,S,_;const k=e.state;i=e.next_in,S=e.input,a=i+(e.avail_in-5),s=e.next_out,_=e.output,r=s-(t-e.avail_out),n=s+(e.avail_out-257),o=k.dmax,l=k.wsize,c=k.whave,d=k.wnext,u=k.window,h=k.hold,m=k.bits,p=k.lencode,f=k.distcode,g=(1<<k.lenbits)-1,x=(1<<k.distbits)-1;e:do{m<15&&(h+=S[i++]<<m,m+=8,h+=S[i++]<<m,m+=8),b=p[h&g];t:for(;;){if(v=b>>>24,h>>>=v,m-=v,v=b>>>16&255,0===v)_[s++]=65535&b;else{if(!(16&v)){if(64&v){if(32&v){k.mode=16191;break e}e.msg="invalid literal/length code",k.mode=LP;break e}b=p[(65535&b)+(h&(1<<v)-1)];continue t}for(y=65535&b,v&=15,v&&(m<v&&(h+=S[i++]<<m,m+=8),y+=h&(1<<v)-1,h>>>=v,m-=v),m<15&&(h+=S[i++]<<m,m+=8,h+=S[i++]<<m,m+=8),b=f[h&x];;){if(v=b>>>24,h>>>=v,m-=v,v=b>>>16&255,16&v){if(w=65535&b,v&=15,m<v&&(h+=S[i++]<<m,m+=8,m<v&&(h+=S[i++]<<m,m+=8)),w+=h&(1<<v)-1,w>o){e.msg="invalid distance too far back",k.mode=LP;break e}if(h>>>=v,m-=v,v=s-r,w>v){if(v=w-v,v>c&&k.sane){e.msg="invalid distance too far back",k.mode=LP;break e}if(N=0,j=u,0===d){if(N+=l-v,v<y){y-=v;do{_[s++]=u[N++]}while(--v);N=s-w,j=_}}else if(d<v){if(N+=l+d-v,v-=d,v<y){y-=v;do{_[s++]=u[N++]}while(--v);if(N=0,d<y){v=d,y-=v;do{_[s++]=u[N++]}while(--v);N=s-w,j=_}}}else if(N+=d-v,v<y){y-=v;do{_[s++]=u[N++]}while(--v);N=s-w,j=_}for(;y>2;)_[s++]=j[N++],_[s++]=j[N++],_[s++]=j[N++],y-=3;y&&(_[s++]=j[N++],y>1&&(_[s++]=j[N++]))}else{N=s-w;do{_[s++]=_[N++],_[s++]=_[N++],_[s++]=_[N++],y-=3}while(y>2);y&&(_[s++]=_[N++],y>1&&(_[s++]=_[N++]))}break}if(64&v){e.msg="invalid distance code",k.mode=LP;break e}b=f[(65535&b)+(h&(1<<v)-1)]}}break}}while(i<a&&s<n);y=m>>3,i-=y,m-=y<<3,h&=(1<<m)-1,e.next_in=i,e.next_out=s,e.avail_in=i<a?a-i+5:5-(i-a),e.avail_out=s<n?n-s+257:257-(s-n),k.hold=h,k.bits=m};const OP=15,DP=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),RP=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),BP=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),UP=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var qP=(e,t,i,a,s,r,n,o)=>{const l=o.bits;let c,d,u,h,m,p,f=0,g=0,x=0,b=0,v=0,y=0,w=0,N=0,j=0,S=0,_=null;const k=new Uint16Array(16),C=new Uint16Array(16);let A,z,E,I=null;for(f=0;f<=OP;f++)k[f]=0;for(g=0;g<a;g++)k[t[i+g]]++;for(v=l,b=OP;b>=1&&0===k[b];b--);if(v>b&&(v=b),0===b)return s[r++]=20971520,s[r++]=20971520,o.bits=1,0;for(x=1;x<b&&0===k[x];x++);for(v<x&&(v=x),N=1,f=1;f<=OP;f++)if(N<<=1,N-=k[f],N<0)return-1;if(N>0&&(0===e||1!==b))return-1;for(C[1]=0,f=1;f<OP;f++)C[f+1]=C[f]+k[f];for(g=0;g<a;g++)0!==t[i+g]&&(n[C[t[i+g]]++]=g);if(0===e?(_=I=n,p=20):1===e?(_=DP,I=RP,p=257):(_=BP,I=UP,p=0),S=0,g=0,f=x,m=r,y=v,w=0,u=-1,j=1<<v,h=j-1,1===e&&j>852||2===e&&j>592)return 1;for(;;){A=f-w,n[g]+1<p?(z=0,E=n[g]):n[g]>=p?(z=I[n[g]-p],E=_[n[g]-p]):(z=96,E=0),c=1<<f-w,d=1<<y,x=d;do{d-=c,s[m+(S>>w)+d]=A<<24|z<<16|E}while(0!==d);for(c=1<<f-1;S&c;)c>>=1;if(0!==c?(S&=c-1,S+=c):S=0,g++,0===--k[f]){if(f===b)break;f=t[i+n[g]]}if(f>v&&(S&h)!==u){for(0===w&&(w=v),m+=x,y=f-w,N=1<<y;y+w<b&&(N-=k[y+w],!(N<=0));)y++,N<<=1;if(j+=1<<y,1===e&&j>852||2===e&&j>592)return 1;u=S&h,s[u]=v<<24|y<<16|m-r}}return 0!==S&&(s[m+S]=f-w<<24|64<<16),o.bits=v,0};const{Z_FINISH:$P,Z_BLOCK:WP,Z_TREES:HP,Z_OK:ZP,Z_STREAM_END:VP,Z_NEED_DICT:GP,Z_STREAM_ERROR:YP,Z_DATA_ERROR:KP,Z_MEM_ERROR:XP,Z_BUF_ERROR:JP,Z_DEFLATED:QP}=_P,eT=16180,tT=16190,iT=16191,aT=16192,sT=16194,rT=16199,nT=16200,oT=16206,lT=16209,cT=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function dT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const uT=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<eT||t.mode>16211?1:0},hT=e=>{if(uT(e))return YP;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=eT,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,ZP},mT=e=>{if(uT(e))return YP;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,hT(e)},pT=(e,t)=>{let i;if(uT(e))return YP;const a=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?YP:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=i,a.wbits=t,mT(e))},fT=(e,t)=>{if(!e)return YP;const i=new dT;e.state=i,i.strm=e,i.window=null,i.mode=eT;const a=pT(e,t);return a!==ZP&&(e.state=null),a};let gT,xT,bT=!0;const vT=e=>{if(bT){gT=new Int32Array(512),xT=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(qP(1,e.lens,0,288,gT,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;qP(2,e.lens,0,32,xT,0,e.work,{bits:5}),bT=!1}e.lencode=gT,e.lenbits=9,e.distcode=xT,e.distbits=5},yT=(e,t,i,a)=>{let s;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),a>=r.wsize?(r.window.set(t.subarray(i-r.wsize,i),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>a&&(s=a),r.window.set(t.subarray(i-a,i-a+s),r.wnext),(a-=s)?(r.window.set(t.subarray(i-a,i),0),r.wnext=a,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var wT=(e,t)=>{let i,a,s,r,n,o,l,c,d,u,h,m,p,f,g,x,b,v,y,w,N,j,S=0;const _=new Uint8Array(4);let k,C;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(uT(e)||!e.output||!e.input&&0!==e.avail_in)return YP;i=e.state,i.mode===iT&&(i.mode=aT),n=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,a=e.input,o=e.avail_in,c=i.hold,d=i.bits,u=o,h=l,j=ZP;e:for(;;)switch(i.mode){case eT:if(0===i.wrap){i.mode=aT;break}for(;d<16;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if(2&i.wrap&&35615===c){0===i.wbits&&(i.wbits=15),i.check=0,_[0]=255&c,_[1]=c>>>8&255,i.check=jP(i.check,_,2,0),c=0,d=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",i.mode=lT;break}if((15&c)!==QP){e.msg="unknown compression method",i.mode=lT;break}if(c>>>=4,d-=4,N=8+(15&c),0===i.wbits&&(i.wbits=N),N>15||N>i.wbits){e.msg="invalid window size",i.mode=lT;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&c?16189:iT,c=0,d=0;break;case 16181:for(;d<16;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if(i.flags=c,(255&i.flags)!==QP){e.msg="unknown compression method",i.mode=lT;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=lT;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&4&i.wrap&&(_[0]=255&c,_[1]=c>>>8&255,i.check=jP(i.check,_,2,0)),c=0,d=0,i.mode=16182;case 16182:for(;d<32;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}i.head&&(i.head.time=c),512&i.flags&&4&i.wrap&&(_[0]=255&c,_[1]=c>>>8&255,_[2]=c>>>16&255,_[3]=c>>>24&255,i.check=jP(i.check,_,4,0)),c=0,d=0,i.mode=16183;case 16183:for(;d<16;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&4&i.wrap&&(_[0]=255&c,_[1]=c>>>8&255,i.check=jP(i.check,_,2,0)),c=0,d=0,i.mode=16184;case 16184:if(1024&i.flags){for(;d<16;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&4&i.wrap&&(_[0]=255&c,_[1]=c>>>8&255,i.check=jP(i.check,_,2,0)),c=0,d=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(m=i.length,m>o&&(m=o),m&&(i.head&&(N=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(a.subarray(r,r+m),N)),512&i.flags&&4&i.wrap&&(i.check=jP(i.check,a,m,r)),o-=m,r+=m,i.length-=m),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===o)break e;m=0;do{N=a[r+m++],i.head&&N&&i.length<65536&&(i.head.name+=String.fromCharCode(N))}while(N&&m<o);if(512&i.flags&&4&i.wrap&&(i.check=jP(i.check,a,m,r)),o-=m,r+=m,N)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===o)break e;m=0;do{N=a[r+m++],i.head&&N&&i.length<65536&&(i.head.comment+=String.fromCharCode(N))}while(N&&m<o);if(512&i.flags&&4&i.wrap&&(i.check=jP(i.check,a,m,r)),o-=m,r+=m,N)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;d<16;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if(4&i.wrap&&c!==(65535&i.check)){e.msg="header crc mismatch",i.mode=lT;break}c=0,d=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=iT;break;case 16189:for(;d<32;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}e.adler=i.check=cT(c),c=0,d=0,i.mode=tT;case tT:if(0===i.havedict)return e.next_out=n,e.avail_out=l,e.next_in=r,e.avail_in=o,i.hold=c,i.bits=d,GP;e.adler=i.check=1,i.mode=iT;case iT:if(t===WP||t===HP)break e;case aT:if(i.last){c>>>=7&d,d-=7&d,i.mode=oT;break}for(;d<3;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}switch(i.last=1&c,c>>>=1,d-=1,3&c){case 0:i.mode=16193;break;case 1:if(vT(i),i.mode=rT,t===HP){c>>>=2,d-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=lT}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",i.mode=lT;break}if(i.length=65535&c,c=0,d=0,i.mode=sT,t===HP)break e;case sT:i.mode=16195;case 16195:if(m=i.length,m){if(m>o&&(m=o),m>l&&(m=l),0===m)break e;s.set(a.subarray(r,r+m),n),o-=m,r+=m,l-=m,n+=m,i.length-=m;break}i.mode=iT;break;case 16196:for(;d<14;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if(i.nlen=257+(31&c),c>>>=5,d-=5,i.ndist=1+(31&c),c>>>=5,d-=5,i.ncode=4+(15&c),c>>>=4,d-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=lT;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;d<3;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}i.lens[A[i.have++]]=7&c,c>>>=3,d-=3}for(;i.have<19;)i.lens[A[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,k={bits:i.lenbits},j=qP(0,i.lens,0,19,i.lencode,0,i.work,k),i.lenbits=k.bits,j){e.msg="invalid code lengths set",i.mode=lT;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;S=i.lencode[c&(1<<i.lenbits)-1],g=S>>>24,x=S>>>16&255,b=65535&S,!(g<=d);){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if(b<16)c>>>=g,d-=g,i.lens[i.have++]=b;else{if(16===b){for(C=g+2;d<C;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if(c>>>=g,d-=g,0===i.have){e.msg="invalid bit length repeat",i.mode=lT;break}N=i.lens[i.have-1],m=3+(3&c),c>>>=2,d-=2}else if(17===b){for(C=g+3;d<C;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}c>>>=g,d-=g,N=0,m=3+(7&c),c>>>=3,d-=3}else{for(C=g+7;d<C;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}c>>>=g,d-=g,N=0,m=11+(127&c),c>>>=7,d-=7}if(i.have+m>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=lT;break}for(;m--;)i.lens[i.have++]=N}}if(i.mode===lT)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=lT;break}if(i.lenbits=9,k={bits:i.lenbits},j=qP(1,i.lens,0,i.nlen,i.lencode,0,i.work,k),i.lenbits=k.bits,j){e.msg="invalid literal/lengths set",i.mode=lT;break}if(i.distbits=6,i.distcode=i.distdyn,k={bits:i.distbits},j=qP(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,k),i.distbits=k.bits,j){e.msg="invalid distances set",i.mode=lT;break}if(i.mode=rT,t===HP)break e;case rT:i.mode=nT;case nT:if(o>=6&&l>=258){e.next_out=n,e.avail_out=l,e.next_in=r,e.avail_in=o,i.hold=c,i.bits=d,FP(e,h),n=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,a=e.input,o=e.avail_in,c=i.hold,d=i.bits,i.mode===iT&&(i.back=-1);break}for(i.back=0;S=i.lencode[c&(1<<i.lenbits)-1],g=S>>>24,x=S>>>16&255,b=65535&S,!(g<=d);){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if(x&&!(240&x)){for(v=g,y=x,w=b;S=i.lencode[w+((c&(1<<v+y)-1)>>v)],g=S>>>24,x=S>>>16&255,b=65535&S,!(v+g<=d);){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}c>>>=v,d-=v,i.back+=v}if(c>>>=g,d-=g,i.back+=g,i.length=b,0===x){i.mode=16205;break}if(32&x){i.back=-1,i.mode=iT;break}if(64&x){e.msg="invalid literal/length code",i.mode=lT;break}i.extra=15&x,i.mode=16201;case 16201:if(i.extra){for(C=i.extra;d<C;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,d-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;S=i.distcode[c&(1<<i.distbits)-1],g=S>>>24,x=S>>>16&255,b=65535&S,!(g<=d);){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if(!(240&x)){for(v=g,y=x,w=b;S=i.distcode[w+((c&(1<<v+y)-1)>>v)],g=S>>>24,x=S>>>16&255,b=65535&S,!(v+g<=d);){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}c>>>=v,d-=v,i.back+=v}if(c>>>=g,d-=g,i.back+=g,64&x){e.msg="invalid distance code",i.mode=lT;break}i.offset=b,i.extra=15&x,i.mode=16203;case 16203:if(i.extra){for(C=i.extra;d<C;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,d-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=lT;break}i.mode=16204;case 16204:if(0===l)break e;if(m=h-l,i.offset>m){if(m=i.offset-m,m>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=lT;break}m>i.wnext?(m-=i.wnext,p=i.wsize-m):p=i.wnext-m,m>i.length&&(m=i.length),f=i.window}else f=s,p=n-i.offset,m=i.length;m>l&&(m=l),l-=m,i.length-=m;do{s[n++]=f[p++]}while(--m);0===i.length&&(i.mode=nT);break;case 16205:if(0===l)break e;s[n++]=i.length,l--,i.mode=nT;break;case oT:if(i.wrap){for(;d<32;){if(0===o)break e;o--,c|=a[r++]<<d,d+=8}if(h-=l,e.total_out+=h,i.total+=h,4&i.wrap&&h&&(e.adler=i.check=i.flags?jP(i.check,s,h,n-h):wP(i.check,s,h,n-h)),h=l,4&i.wrap&&(i.flags?c:cT(c))!==i.check){e.msg="incorrect data check",i.mode=lT;break}c=0,d=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;d<32;){if(0===o)break e;o--,c+=a[r++]<<d,d+=8}if(4&i.wrap&&c!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=lT;break}c=0,d=0}i.mode=16208;case 16208:j=VP;break e;case lT:j=KP;break e;case 16210:return XP;default:return YP}return e.next_out=n,e.avail_out=l,e.next_in=r,e.avail_in=o,i.hold=c,i.bits=d,(i.wsize||h!==e.avail_out&&i.mode<lT&&(i.mode<oT||t!==$P))&&yT(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,i.total+=h,4&i.wrap&&h&&(e.adler=i.check=i.flags?jP(i.check,s,h,e.next_out-h):wP(i.check,s,h,e.next_out-h)),e.data_type=i.bits+(i.last?64:0)+(i.mode===iT?128:0)+(i.mode===rT||i.mode===sT?256:0),(0===u&&0===h||t===$P)&&j===ZP&&(j=JP),j},NT={inflateReset:mT,inflateReset2:pT,inflateResetKeep:hT,inflateInit:e=>fT(e,15),inflateInit2:fT,inflate:wT,inflateEnd:e=>{if(uT(e))return YP;let t=e.state;return t.window&&(t.window=null),e.state=null,ZP},inflateGetHeader:(e,t)=>{if(uT(e))return YP;const i=e.state;return 2&i.wrap?(i.head=t,t.done=!1,ZP):YP},inflateSetDictionary:(e,t)=>{const i=t.length;let a,s,r;return uT(e)?YP:(a=e.state,0!==a.wrap&&a.mode!==tT?YP:a.mode===tT&&(s=1,s=wP(s,t,i,0),s!==a.check)?KP:(r=yT(e,t,i,i),r?(a.mode=16210,XP):(a.havedict=1,ZP)))},inflateInfo:"pako inflate (from Nodeca project)"};var jT=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const ST=Object.prototype.toString,{Z_NO_FLUSH:_T,Z_FINISH:kT,Z_OK:CT,Z_STREAM_END:AT,Z_NEED_DICT:zT,Z_STREAM_ERROR:ET,Z_DATA_ERROR:IT,Z_MEM_ERROR:PT}=_P;function TT(e){this.options=CP({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MP,this.strm.avail_out=0;let i=NT.inflateInit2(this.strm,t.windowBits);if(i!==CT)throw new Error(SP[i]);if(this.header=new jT,NT.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=IP(t.dictionary):"[object ArrayBuffer]"===ST.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=NT.inflateSetDictionary(this.strm,t.dictionary),i!==CT)))throw new Error(SP[i])}TT.prototype.push=function(e,t){const i=this.strm,a=this.options.chunkSize,s=this.options.dictionary;let r,n,o;if(this.ended)return!1;for(n=t===~~t?t:!0===t?kT:_T,"[object ArrayBuffer]"===ST.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),r=NT.inflate(i,n),r===zT&&s&&(r=NT.inflateSetDictionary(i,s),r===CT?r=NT.inflate(i,n):r===IT&&(r=zT));i.avail_in>0&&r===AT&&i.state.wrap>0&&0!==e[i.next_in];)NT.inflateReset(i),r=NT.inflate(i,n);switch(r){case ET:case IT:case zT:case PT:return this.onEnd(r),this.ended=!0,!1}if(o=i.avail_out,i.next_out&&(0===i.avail_out||r===AT))if("string"===this.options.to){let e=TP(i.output,i.next_out),t=i.next_out-e,s=PP(i.output,e);i.next_out=t,i.avail_out=a-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(s)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(r!==CT||0!==o){if(r===AT)return r=NT.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},TT.prototype.onData=function(e){this.chunks.push(e)},TT.prototype.onEnd=function(e){e===CT&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=AP(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var MT={Inflate:TT,inflate:function(e,t){const i=new TT(t);if(i.push(e),i.err)throw i.msg||SP[i.err];return i.result}};const{Inflate:LT,inflate:FT}=MT;var OT=LT,DT=FT;const RT=[];for(let xB=0;xB<256;xB++){let e=xB;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;RT[xB]=e}const BT=4294967295;function UT(e,t){return(function(e,t,i){let a=e;for(let s=0;s<i;s++)a=RT[255&(a^t[s])]^a>>>8;return a}(BT,e,t)^BT)>>>0}function qT(e,t,i){const a=e.readUint32(),s=UT(new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t);if(s!==a)throw new Error(`CRC mismatch for chunk ${i}. Expected ${a}, found ${s}`)}function $T(e,t,i){for(let a=0;a<i;a++)t[a]=e[a]}function WT(e,t,i,a){let s=0;for(;s<a;s++)t[s]=e[s];for(;s<i;s++)t[s]=e[s]+t[s-a]&255}function HT(e,t,i,a){let s=0;if(0===i.length)for(;s<a;s++)t[s]=e[s];else for(;s<a;s++)t[s]=e[s]+i[s]&255}function ZT(e,t,i,a,s){let r=0;if(0===i.length){for(;r<s;r++)t[r]=e[r];for(;r<a;r++)t[r]=e[r]+(t[r-s]>>1)&255}else{for(;r<s;r++)t[r]=e[r]+(i[r]>>1)&255;for(;r<a;r++)t[r]=e[r]+(t[r-s]+i[r]>>1)&255}}function VT(e,t,i,a,s){let r=0;if(0===i.length){for(;r<s;r++)t[r]=e[r];for(;r<a;r++)t[r]=e[r]+t[r-s]&255}else{for(;r<s;r++)t[r]=e[r]+i[r]&255;for(;r<a;r++)t[r]=e[r]+GT(t[r-s],i[r],i[r-s])&255}}function GT(e,t,i){const a=e+t-i,s=Math.abs(a-e),r=Math.abs(a-t),n=Math.abs(a-i);return s<=r&&s<=n?e:r<=n?t:i}function YT(e,t,i,a,s,r){switch(e){case 0:$T(t,i,s);break;case 1:WT(t,i,s,r);break;case 2:HT(t,i,a,s);break;case 3:ZT(t,i,a,s,r);break;case 4:VT(t,i,a,s,r);break;default:throw new Error(`Unsupported filter: ${e}`)}}const KT=new Uint16Array([255]),XT=255===new Uint8Array(KT.buffer)[0];function JT(e){return(255&e)<<8|e>>8&255}const QT=new Uint16Array([255]),eM=255===new Uint8Array(QT.buffer)[0],tM=new Uint8Array(0);function iM(e){const{data:t,width:i,height:a,channels:s,depth:r}=e,n=Math.ceil(r/8)*s,o=Math.ceil(r/8*s*i),l=new Uint8Array(a*o);let c,d,u=tM,h=0;for(let m=0;m<a;m++){switch(c=t.subarray(h+1,h+1+o),d=l.subarray(m*o,(m+1)*o),t[h]){case 0:$T(c,d,o);break;case 1:WT(c,d,o,n);break;case 2:HT(c,d,u,o);break;case 3:ZT(c,d,u,o,n);break;case 4:VT(c,d,u,o,n);break;default:throw new Error(`Unsupported filter: ${t[h]}`)}u=d,h+=o+1}if(16===r){const e=new Uint16Array(l.buffer);if(eM)for(let t=0;t<e.length;t++)e[t]=aM(e[t]);return e}return l}function aM(e){return(255&e)<<8|e>>8&255}const sM=Uint8Array.of(137,80,78,71,13,10,26,10);function rM(e){if(!function(e){if(e.length<sM.length)return!1;for(let t=0;t<sM.length;t++)if(e[t]!==sM[t])return!1;return!0}(e.readBytes(sM.length)))throw new Error("wrong PNG signature")}const nM=new TextDecoder("latin1");function oM(e){if(function(e){if(!lM.test(e))throw new Error("invalid latin1 text")}(e),0===e.length||e.length>79)throw new Error("keyword length must be between 1 and 79")}const lM=/^[\u0000-\u00FF]*$/;function cM(e,t,i){const a=dM(t);e[a]=function(e,t){return nM.decode(e.readBytes(t))}(t,i-a.length-1)}function dM(e){for(e.mark();0!==e.readByte(););const t=e.offset;e.reset();const i=nM.decode(e.readBytes(t-e.offset-1));return e.skip(1),oM(i),i}const uM=-1,hM=0,mM=2,pM=3,fM=4,gM=6,xM=-1,bM=0,vM=-1,yM=0,wM=-1,NM=0,jM=1,SM=0,_M=1,kM=2,CM=0,AM=1;class zM extends vP{constructor(e,t={}){super(e),Y(this,"_checkCrc"),Y(this,"_inflator"),Y(this,"_png"),Y(this,"_apng"),Y(this,"_end"),Y(this,"_hasPalette"),Y(this,"_palette"),Y(this,"_hasTransparency"),Y(this,"_transparency"),Y(this,"_compressionMethod"),Y(this,"_filterMethod"),Y(this,"_interlaceMethod"),Y(this,"_colorType"),Y(this,"_isAnimated"),Y(this,"_numberOfFrames"),Y(this,"_numberOfPlays"),Y(this,"_frames"),Y(this,"_writingDataChunks");const{checkCrc:i=!1}=t;this._checkCrc=i,this._inflator=new OT,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=xM,this._filterMethod=vM,this._interlaceMethod=wM,this._colorType=uM,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(rM(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(rM(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const i=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":cM(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e)}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?qT(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const i=this.offset;switch("fdAT"!==t&&"IDAT"!==t&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=i+e}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?qT(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=function(e){if(1!==e&&2!==e&&4!==e&&8!==e&&16!==e)throw new Error(`invalid bit depth: ${e}`);return e}(this.readUint8());const t=this.readUint8();let i;switch(this._colorType=t,t){case hM:i=1;break;case mM:i=3;break;case pM:i=1;break;case fM:i=2;break;case gM:i=4;break;default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==bM)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!=0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const i=[];this._palette=i;for(let a=0;a<t;a++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,i=this.offset+this.byteOffset;if(i+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,i,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case hM:case mM:if(e%2!=0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break;case pM:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const e=this.readByte();this._palette[t].push(e)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=dM(this),i=this.readUint8();if(i!==bM)throw new Error(`Unsupported iCCP compression method: ${i}`);const a=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:DT(a)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),i=this.readByte();this._png.resolution={x:e,y:t,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:8===this._apng.depth?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(e);if(i){if(i.data=iM({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),0===e||0===i.xOffset&&0===i.yOffset&&i.width===this._png.width&&i.height===this._png.height)t.data=i.data;else{const a=this._apng.frames.at(e-1);this.disposeFrame(i,a,t),this.addFrameDataToCanvas(t,i)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,i){switch(e.disposeOp){case SM:break;case _M:for(let t=0;t<this._png.height;t++)for(let a=0;a<this._png.width;a++){const s=(t*e.width+a)*this._png.channels;for(let e=0;e<this._png.channels;e++)i.data[s+e]=0}break;case kM:i.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const i=1<<this._png.depth,a=(e,i)=>({index:((e+t.yOffset)*this._png.width+t.xOffset+i)*this._png.channels,frameIndex:(e*t.width+i)*this._png.channels});switch(t.blendOp){case CM:for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){const{index:r,frameIndex:n}=a(i,s);for(let i=0;i<this._png.channels;i++)e.data[r+i]=t.data[n+i]}break;case AM:for(let s=0;s<t.height;s++)for(let r=0;r<t.width;r++){const{index:n,frameIndex:o}=a(s,r);for(let a=0;a<this._png.channels;a++){const s=t.data[o+this._png.channels-1]/i,r=a%(this._png.channels-1)==0?1:t.data[o+a],l=Math.floor(s*r+(1-s)*e.data[n+a]);e.data[n+a]+=l}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==yM)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===NM)this._png.data=iM({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else{if(this._interlaceMethod!==jM)throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._png.data=function(e){const{data:t,width:i,height:a,channels:s,depth:r}=e,n=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(r/8)*s,l=new Uint8Array(a*i*o);let c=0;for(let d=0;d<7;d++){const e=n[d],s=Math.ceil((i-e.x)/e.xStep),r=Math.ceil((a-e.y)/e.yStep);if(s<=0||r<=0)continue;const u=s*o,h=new Uint8Array(u);for(let n=0;n<r;n++){const r=t[c++],d=t.subarray(c,c+u);c+=u;const m=new Uint8Array(u);YT(r,d,m,h,u,o),h.set(m);for(let t=0;t<s;t++){const s=e.x+t*e.xStep,r=e.y+n*e.yStep;if(!(s>=i||r>=a))for(let e=0;e<o;e++)l[(r*i+s)*o+e]=m[t*o+e]}}}if(16===r){const e=new Uint16Array(l.buffer);if(XT)for(let t=0;t<e.length;t++)e[t]=JT(e[t]);return e}return l}({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth})}this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:SM,blendOp:CM,data:e}),this._inflator=new OT,this._writingDataChunks=!1}}var EM,IM;(IM=EM||(EM={}))[IM.UNKNOWN=0]="UNKNOWN",IM[IM.METRE=1]="METRE";var PM=function(){return"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this}();function TM(){PM.console&&"function"==typeof PM.console.log&&PM.console.log.apply(PM.console,arguments)}var MM={log:TM,warn:function(e){PM.console&&("function"==typeof PM.console.warn?PM.console.warn.apply(PM.console,arguments):TM.call(null,arguments))},error:function(e){PM.console&&("function"==typeof PM.console.error?PM.console.error.apply(PM.console,arguments):TM(e))}};function LM(e,t,i){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){DM(a.response,t,i)},a.onerror=function(){MM.error("could not download file")},a.send()}function FM(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(Gd){}return t.status>=200&&t.status<=299}function OM(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(Gd){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var DM=PM.saveAs||("object"!==("undefined"==typeof window?"undefined":II(window))||window!==PM?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(e,t,i){var a=PM.URL||PM.webkitURL,s=document.createElement("a");t=t||e.name||"download",s.download=t,s.rel="noopener","string"==typeof e?(s.href=e,s.origin!==location.origin?FM(s.href)?LM(e,t,i):OM(s,s.target="_blank"):OM(s)):(s.href=a.createObjectURL(e),setTimeout(function(){a.revokeObjectURL(s.href)},4e4),setTimeout(function(){OM(s)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,i){if(t=t||e.name||"download","string"==typeof e)if(FM(e))LM(e,t,i);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout(function(){OM(a)})}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!==II(t)&&(MM.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,i),t)}:function(e,t,i,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return LM(e,t,i);var s="application/octet-stream"===e.type,r=/constructor/i.test(PM.HTMLElement)||PM.safari,n=/CriOS\/[\d]+/.test(navigator.userAgent);if((n||s&&r)&&"object"===("undefined"==typeof FileReader?"undefined":II(FileReader))){var o=new FileReader;o.onloadend=function(){var e=o.result;e=n?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},o.readAsDataURL(e)}else{var l=PM.URL||PM.webkitURL,c=l.createObjectURL(e);a?a.location=c:location.href=c,a=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});function RM(e){var t;e=e||"",this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var i=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],a=0;a<i.length;a++){var s=i[a].re,r=i[a].process,n=s.exec(e);n&&(t=r(n),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),i=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==i.length&&(i="0"+i),"#"+e+t+i}}var BM=PM.atob.bind(PM),UM=PM.btoa.bind(PM);function qM(e,t){var i=e[0],a=e[1],s=e[2],r=e[3];i=WM(i,a,s,r,t[0],7,-680876936),r=WM(r,i,a,s,t[1],12,-389564586),s=WM(s,r,i,a,t[2],17,606105819),a=WM(a,s,r,i,t[3],22,-1044525330),i=WM(i,a,s,r,t[4],7,-176418897),r=WM(r,i,a,s,t[5],12,1200080426),s=WM(s,r,i,a,t[6],17,-1473231341),a=WM(a,s,r,i,t[7],22,-45705983),i=WM(i,a,s,r,t[8],7,1770035416),r=WM(r,i,a,s,t[9],12,-1958414417),s=WM(s,r,i,a,t[10],17,-42063),a=WM(a,s,r,i,t[11],22,-1990404162),i=WM(i,a,s,r,t[12],7,1804603682),r=WM(r,i,a,s,t[13],12,-40341101),s=WM(s,r,i,a,t[14],17,-1502002290),i=HM(i,a=WM(a,s,r,i,t[15],22,1236535329),s,r,t[1],5,-165796510),r=HM(r,i,a,s,t[6],9,-1069501632),s=HM(s,r,i,a,t[11],14,643717713),a=HM(a,s,r,i,t[0],20,-373897302),i=HM(i,a,s,r,t[5],5,-701558691),r=HM(r,i,a,s,t[10],9,38016083),s=HM(s,r,i,a,t[15],14,-660478335),a=HM(a,s,r,i,t[4],20,-405537848),i=HM(i,a,s,r,t[9],5,568446438),r=HM(r,i,a,s,t[14],9,-1019803690),s=HM(s,r,i,a,t[3],14,-187363961),a=HM(a,s,r,i,t[8],20,1163531501),i=HM(i,a,s,r,t[13],5,-1444681467),r=HM(r,i,a,s,t[2],9,-51403784),s=HM(s,r,i,a,t[7],14,1735328473),i=ZM(i,a=HM(a,s,r,i,t[12],20,-1926607734),s,r,t[5],4,-378558),r=ZM(r,i,a,s,t[8],11,-2022574463),s=ZM(s,r,i,a,t[11],16,1839030562),a=ZM(a,s,r,i,t[14],23,-35309556),i=ZM(i,a,s,r,t[1],4,-1530992060),r=ZM(r,i,a,s,t[4],11,1272893353),s=ZM(s,r,i,a,t[7],16,-155497632),a=ZM(a,s,r,i,t[10],23,-1094730640),i=ZM(i,a,s,r,t[13],4,681279174),r=ZM(r,i,a,s,t[0],11,-358537222),s=ZM(s,r,i,a,t[3],16,-722521979),a=ZM(a,s,r,i,t[6],23,76029189),i=ZM(i,a,s,r,t[9],4,-640364487),r=ZM(r,i,a,s,t[12],11,-421815835),s=ZM(s,r,i,a,t[15],16,530742520),i=VM(i,a=ZM(a,s,r,i,t[2],23,-995338651),s,r,t[0],6,-198630844),r=VM(r,i,a,s,t[7],10,1126891415),s=VM(s,r,i,a,t[14],15,-1416354905),a=VM(a,s,r,i,t[5],21,-57434055),i=VM(i,a,s,r,t[12],6,1700485571),r=VM(r,i,a,s,t[3],10,-1894986606),s=VM(s,r,i,a,t[10],15,-1051523),a=VM(a,s,r,i,t[1],21,-2054922799),i=VM(i,a,s,r,t[8],6,1873313359),r=VM(r,i,a,s,t[15],10,-30611744),s=VM(s,r,i,a,t[6],15,-1560198380),a=VM(a,s,r,i,t[13],21,1309151649),i=VM(i,a,s,r,t[4],6,-145523070),r=VM(r,i,a,s,t[11],10,-1120210379),s=VM(s,r,i,a,t[2],15,718787259),a=VM(a,s,r,i,t[9],21,-343485551),e[0]=tL(i,e[0]),e[1]=tL(a,e[1]),e[2]=tL(s,e[2]),e[3]=tL(r,e[3])}function $M(e,t,i,a,s,r){return t=tL(tL(t,e),tL(a,r)),tL(t<<s|t>>>32-s,i)}function WM(e,t,i,a,s,r,n){return $M(t&i|~t&a,e,t,s,r,n)}function HM(e,t,i,a,s,r,n){return $M(t&a|i&~a,e,t,s,r,n)}function ZM(e,t,i,a,s,r,n){return $M(t^i^a,e,t,s,r,n)}function VM(e,t,i,a,s,r,n){return $M(i^(t|~a),e,t,s,r,n)}function GM(e){var t,i=e.length,a=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)qM(a,YM(e.substring(t-64,t)));e=e.substring(t-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(qM(a,s),t=0;t<16;t++)s[t]=0;return s[14]=8*i,qM(a,s),a}function YM(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return i}var KM="0123456789abcdef".split("");function XM(e){for(var t="",i=0;i<4;i++)t+=KM[e>>8*i+4&15]+KM[e>>8*i&15];return t}function JM(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function QM(e){return GM(e).map(JM).join("")}var eL="5d41402abc4b2a76b9719d911017c592"!=function(e){for(var t=0;t<e.length;t++)e[t]=XM(e[t]);return e.join("")}(GM("hello"));function tL(e,t){if(eL){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}return e+t&4294967295}function iL(e,t){var i,a,s,r;if(e!==i){for(var n=(s=e,r=1+(256/e.length|0),new Array(r+1).join(s)),o=[],l=0;l<256;l++)o[l]=l;var c=0;for(l=0;l<256;l++){var d=o[l];c=(c+d+n.charCodeAt(l))%256,o[l]=o[c],o[c]=d}i=e,a=o}else o=a;var u=t.length,h=0,m=0,p="";for(l=0;l<u;l++)m=(m+(d=o[h=(h+1)%256]))%256,o[h]=o[m],o[m]=d,n=o[(o[h]+o[m])%256],p+=String.fromCharCode(t.charCodeAt(l)^n);return p}var aL={print:4,modify:8,copy:16,"annot-forms":32};function sL(e,t,i,a){this.v=1,this.r=2;var s=192;e.forEach(function(e){if(void 0!==aL.perm)throw new Error("Invalid permission: "+e);s+=aL[e]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var r=(t+this.padding).substr(0,32),n=(i+this.padding).substr(0,32);this.O=this.processOwnerPassword(r,n),this.P=-(1+(255^s)),this.encryptionKey=QM(r+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(a)).substr(0,5),this.U=iL(this.encryptionKey,this.padding)}function rL(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",i=e.length,a=0;a<i;a++){var s=e.charCodeAt(a);t+=s<33||35===s||37===s||40===s||41===s||47===s||60===s||62===s||91===s||93===s||123===s||125===s||s>126?"#"+("0"+s.toString(16)).slice(-2):e[a]}return t}function nL(e){if("object"!==II(e))throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,i,a){if(a=a||!1,"string"!=typeof e||"function"!=typeof i||"boolean"!=typeof a)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var s=Math.random().toString(35);return t[e][s]=[i,!!a],s},this.unsubscribe=function(e){for(var i in t)if(t[i][e])return delete t[i][e],0===Object.keys(t[i]).length&&delete t[i],!0;return!1},this.publish=function(i){if(t.hasOwnProperty(i)){var a=Array.prototype.slice.call(arguments,1),s=[];for(var r in t[i]){var n=t[i][r];try{n[0].apply(e,a)}catch(Zd){PM.console&&MM.error("jsPDF PubSub Error",Zd.message,Zd)}n[1]&&s.push(r)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function oL(e){if(!(this instanceof oL))return new oL(e);var t="opacity,stroke-opacity".split(",");for(var i in e)e.hasOwnProperty(i)&&t.indexOf(i)>=0&&(this[i]=e[i]);this.id="",this.objectNumber=-1}function lL(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function cL(e,t,i,a,s){if(!(this instanceof cL))return new cL(e,t,i,a,s);this.type="axial"===e?2:3,this.coords=t,this.colors=i,lL.call(this,a,s)}function dL(e,t,i,a,s){if(!(this instanceof dL))return new dL(e,t,i,a,s);this.boundingBox=e,this.xStep=t,this.yStep=i,this.stream="",this.cloneIndex=0,lL.call(this,a,s)}function uL(e){var t,i="string"==typeof arguments[0]?arguments[0]:"p",a=arguments[1],s=arguments[2],r=arguments[3],n=[],o=1,l=16,c="S",d=null;"object"===II(e=e||{})&&(i=e.orientation,a=e.unit||a,s=e.format||s,r=e.compress||e.compressPdf||r,null!==(d=e.encryption||null)&&(d.userPassword=d.userPassword||"",d.ownerPassword=d.ownerPassword||"",d.userPermissions=d.userPermissions||[]),o="number"==typeof e.userUnit?Math.abs(e.userUnit):1,void 0!==e.precision&&(t=e.precision),void 0!==e.floatPrecision&&(l=e.floatPrecision),c=e.defaultPathOperation||"S"),n=e.filters||(!0===r?["FlateEncode"]:n),a=a||"mm",i=(""+(i||"P")).toLowerCase();var u=e.putOnlyUsedFonts||!1,h={},m={internal:{},__private__:{}};m.__private__.PubSub=nL;var p="1.3",f=m.__private__.getPdfVersion=function(){return p};m.__private__.setPdfVersion=function(e){p=e};var g={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};m.__private__.getPageFormats=function(){return g};var x=m.__private__.getPageFormat=function(e){return g[e]};s=s||"a4";var b="compat",v="advanced",y=b;function w(){this.saveGraphicsState(),X(new Ie(he,0,0,-he,0,hi()*he).toString()+" cm"),this.setFontSize(this.getFontSize()/he),c="n",y=v}function N(){this.restoreGraphicsState(),c="S",y=b}var j=m.__private__.combineFontStyleAndFontWeight=function(e,t){if("bold"==e&&"normal"==t||"bold"==e&&400==t||"normal"==e&&"italic"==t||"bold"==e&&"italic"==t)throw new Error("Invalid Combination of fontweight and fontstyle");return t&&(e=400==t||"normal"===t?"italic"===e?"italic":"normal":700!=t&&"bold"!==t||"normal"!==e?(700==t?"bold":t)+""+e:"bold"),e};m.advancedAPI=function(e){var t=y===b;return t&&w.call(this),"function"!=typeof e||(e(this),t&&N.call(this)),this},m.compatAPI=function(e){var t=y===v;return t&&N.call(this),"function"!=typeof e||(e(this),t&&w.call(this)),this},m.isAdvancedAPI=function(){return y===v};var S,_=function(e){if(y!==v)throw new Error(e+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},k=m.roundToPrecision=m.__private__.roundToPrecision=function(e,i){var a=t||i;if(isNaN(e)||isNaN(a))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return e.toFixed(a).replace(/0+$/,"")};S=m.hpf=m.__private__.hpf="number"==typeof l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return k(e,l)}:"smart"===l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return k(e,e>-1&&e<1?16:5)}:function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return k(e,16)};var C=m.f2=m.__private__.f2=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f2");return k(e,2)},A=m.__private__.f3=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f3");return k(e,3)},z=m.scale=m.__private__.scale=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.scale");return y===b?e*he:y===v?e:void 0},E=function(e){return z((t=e,y===b?hi()-t:y===v?t:void 0));var t};m.__private__.setPrecision=m.setPrecision=function(e){"number"==typeof parseInt(e,10)&&(t=parseInt(e,10))};var I,P="00000000000000000000000000000000",T=m.__private__.getFileId=function(){return P},M=m.__private__.setFileId=function(e){return P=void 0!==e&&/^[a-fA-F0-9]{32}$/.test(e)?e.toUpperCase():P.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),null!==d&&(bt=new sL(d.userPermissions,d.userPassword,d.ownerPassword,P)),P};m.setFileId=function(e){return M(e),this},m.getFileId=function(){return T()};var L=m.__private__.convertDateToPDFDate=function(e){var t=e.getTimezoneOffset(),i=t<0?"+":"-",a=Math.floor(Math.abs(t/60)),s=Math.abs(t%60),r=[i,B(a),"'",B(s),"'"].join("");return["D:",e.getFullYear(),B(e.getMonth()+1),B(e.getDate()),B(e.getHours()),B(e.getMinutes()),B(e.getSeconds()),r].join("")},F=m.__private__.convertPDFDateToDate=function(e){var t=parseInt(e.substr(2,4),10),i=parseInt(e.substr(6,2),10)-1,a=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),r=parseInt(e.substr(12,2),10),n=parseInt(e.substr(14,2),10);return new Date(t,i,a,s,r,n,0)},O=m.__private__.setCreationDate=function(e){var t;if(void 0===e&&(e=new Date),e instanceof Date)t=L(e);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(e))throw new Error("Invalid argument passed to jsPDF.setCreationDate");t=e}return I=t},D=m.__private__.getCreationDate=function(e){var t=I;return"jsDate"===e&&(t=F(I)),t};m.setCreationDate=function(e){return O(e),this},m.getCreationDate=function(e){return D(e)};var R,B=m.__private__.padd2=function(e){return("0"+parseInt(e)).slice(-2)},U=m.__private__.padd2Hex=function(e){return("00"+(e=e.toString())).substr(e.length)},q=0,$=[],W=[],H=0,Z=[],V=[],G=!1,Y=W;m.__private__.setCustomOutputDestination=function(e){G=!0,Y=e};var K=function(e){G||(Y=e)};m.__private__.resetCustomOutputDestination=function(){G=!1,Y=W};var X=m.__private__.out=function(e){return e=e.toString(),H+=e.length+1,Y.push(e),Y},J=m.__private__.write=function(e){return X(1===arguments.length?e.toString():Array.prototype.join.call(arguments," "))},Q=m.__private__.getArrayBuffer=function(e){for(var t=e.length,i=new ArrayBuffer(t),a=new Uint8Array(i);t--;)a[t]=e.charCodeAt(t);return i},ee=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];m.__private__.getStandardFonts=function(){return ee};var te=e.fontSize||16;m.__private__.setFontSize=m.setFontSize=function(e){return te=y===v?e/he:e,this};var ie,ae=m.__private__.getFontSize=m.getFontSize=function(){return y===b?te:te*he},se=e.R2L||!1;m.__private__.setR2L=m.setR2L=function(e){return se=e,this},m.__private__.getR2L=m.getR2L=function(){return se};var re,ne=m.__private__.setZoomMode=function(e){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(e))ie=e;else if(isNaN(e)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(e))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+e+'" is not recognized.');ie=e}else ie=parseInt(e,10)};m.__private__.getZoomMode=function(){return ie};var oe,le=m.__private__.setPageMode=function(e){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(e))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+e+'" is not recognized.');re=e};m.__private__.getPageMode=function(){return re};var ce=m.__private__.setLayoutMode=function(e){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(e))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+e+'" is not recognized.');oe=e};m.__private__.getLayoutMode=function(){return oe},m.__private__.setDisplayMode=m.setDisplayMode=function(e,t,i){return ne(e),ce(t),le(i),this};var de={title:"",subject:"",author:"",keywords:"",creator:""};m.__private__.getDocumentProperty=function(e){if(-1===Object.keys(de).indexOf(e))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return de[e]},m.__private__.getDocumentProperties=function(){return de},m.__private__.setDocumentProperties=m.setProperties=m.setDocumentProperties=function(e){for(var t in de)de.hasOwnProperty(t)&&e[t]&&(de[t]=e[t]);return this},m.__private__.setDocumentProperty=function(e,t){if(-1===Object.keys(de).indexOf(e))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return de[e]=t};var ue,he,me,pe,fe,ge={},xe={},be=[],ve={},ye={},we={},Ne={},je=null,Se=0,_e=[],ke=new nL(m),Ce=e.hotfixes||[],Ae={},ze={},Ee=[],Ie=function e(t,i,a,s,r,n){if(!(this instanceof e))return new e(t,i,a,s,r,n);isNaN(t)&&(t=1),isNaN(i)&&(i=0),isNaN(a)&&(a=0),isNaN(s)&&(s=1),isNaN(r)&&(r=0),isNaN(n)&&(n=0),this._matrix=[t,i,a,s,r,n]};Object.defineProperty(Ie.prototype,"sx",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Ie.prototype,"shy",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Ie.prototype,"shx",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Ie.prototype,"sy",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Ie.prototype,"tx",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Ie.prototype,"ty",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Ie.prototype,"a",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Ie.prototype,"b",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Ie.prototype,"c",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Ie.prototype,"d",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Ie.prototype,"e",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Ie.prototype,"f",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Ie.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ie.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ie.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ie.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),Ie.prototype.join=function(e){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(S).join(e)},Ie.prototype.multiply=function(e){var t=e.sx*this.sx+e.shy*this.shx,i=e.sx*this.shy+e.shy*this.sy,a=e.shx*this.sx+e.sy*this.shx,s=e.shx*this.shy+e.sy*this.sy,r=e.tx*this.sx+e.ty*this.shx+this.tx,n=e.tx*this.shy+e.ty*this.sy+this.ty;return new Ie(t,i,a,s,r,n)},Ie.prototype.decompose=function(){var e=this.sx,t=this.shy,i=this.shx,a=this.sy,s=this.tx,r=this.ty,n=Math.sqrt(e*e+t*t),o=(e/=n)*i+(t/=n)*a;i-=e*o,a-=t*o;var l=Math.sqrt(i*i+a*a);return o/=l,e*(a/=l)<t*(i/=l)&&(e=-e,t=-t,o=-o,n=-n),{scale:new Ie(n,0,0,l,0,0),translate:new Ie(1,0,0,1,s,r),rotate:new Ie(e,t,-t,e,0,0),skew:new Ie(1,0,o,1,0,0)}},Ie.prototype.toString=function(e){return this.join(" ")},Ie.prototype.inversed=function(){var e=this.sx,t=this.shy,i=this.shx,a=this.sy,s=this.tx,r=this.ty,n=1/(e*a-t*i),o=a*n,l=-t*n,c=-i*n,d=e*n;return new Ie(o,l,c,d,-o*s-c*r,-l*s-d*r)},Ie.prototype.applyToPoint=function(e){var t=e.x*this.sx+e.y*this.shx+this.tx,i=e.x*this.shy+e.y*this.sy+this.ty;return new ti(t,i)},Ie.prototype.applyToRectangle=function(e){var t=this.applyToPoint(e),i=this.applyToPoint(new ti(e.x+e.w,e.y+e.h));return new ii(t.x,t.y,i.x-t.x,i.y-t.y)},Ie.prototype.clone=function(){var e=this.sx,t=this.shy,i=this.shx,a=this.sy,s=this.tx,r=this.ty;return new Ie(e,t,i,a,s,r)},m.Matrix=Ie;var Pe=m.matrixMult=function(e,t){return t.multiply(e)},Te=new Ie(1,0,0,1,0,0);m.unitMatrix=m.identityMatrix=Te;var Me=function(e,t){if(!ye[e]){var i=(t instanceof cL?"Sh":"P")+(Object.keys(ve).length+1).toString(10);t.id=i,ye[e]=i,ve[i]=t,ke.publish("addPattern",t)}};m.ShadingPattern=cL,m.TilingPattern=dL,m.addShadingPattern=function(e,t){return _("addShadingPattern()"),Me(e,t),this},m.beginTilingPattern=function(e){_("beginTilingPattern()"),si(e.boundingBox[0],e.boundingBox[1],e.boundingBox[2]-e.boundingBox[0],e.boundingBox[3]-e.boundingBox[1],e.matrix)},m.endTilingPattern=function(e,t){_("endTilingPattern()"),t.stream=V[R].join("\n"),Me(e,t),ke.publish("endTilingPattern",t),Ee.pop().restore()};var Le,Fe=m.__private__.newObject=function(){var e=Oe();return De(e,!0),e},Oe=m.__private__.newObjectDeferred=function(){return q++,$[q]=function(){return H},q},De=function(e,t){return t="boolean"==typeof t&&t,$[e]=H,t&&X(e+" 0 obj"),e},Re=m.__private__.newAdditionalObject=function(){var e={objId:Oe(),content:""};return Z.push(e),e},Be=Oe(),Ue=Oe(),qe=m.__private__.decodeColorString=function(e){var t=e.split(" ");if(2!==t.length||"g"!==t[1]&&"G"!==t[1])5!==t.length||"k"!==t[4]&&"K"!==t[4]||(t=[(1-t[0])*(1-t[3]),(1-t[1])*(1-t[3]),(1-t[2])*(1-t[3]),"r"]);else{var i=parseFloat(t[0]);t=[i,i,i,"r"]}for(var a="#",s=0;s<3;s++)a+=("0"+Math.floor(255*parseFloat(t[s])).toString(16)).slice(-2);return a},$e=m.__private__.encodeColorString=function(e){var t;"string"==typeof e&&(e={ch1:e});var i=e.ch1,a=e.ch2,s=e.ch3,r=e.ch4,n="draw"===e.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof i&&"#"!==i.charAt(0)){var o=new RM(i);if(o.ok)i=o.toHex();else if(!/^\d*\.?\d*$/.test(i))throw new Error('Invalid color "'+i+'" passed to jsPDF.encodeColorString.')}if("string"==typeof i&&/^#[0-9A-Fa-f]{3}$/.test(i)&&(i="#"+i[1]+i[1]+i[2]+i[2]+i[3]+i[3]),"string"==typeof i&&/^#[0-9A-Fa-f]{6}$/.test(i)){var l=parseInt(i.substr(1),16);i=l>>16&255,a=l>>8&255,s=255&l}if(void 0===a||void 0===r&&i===a&&a===s)t="string"==typeof i?i+" "+n[0]:2===e.precision?C(i/255)+" "+n[0]:A(i/255)+" "+n[0];else if(void 0===r||"object"===II(r)){if(r&&!isNaN(r.a)&&0===r.a)return["1.","1.","1.",n[1]].join(" ");t="string"==typeof i?[i,a,s,n[1]].join(" "):2===e.precision?[C(i/255),C(a/255),C(s/255),n[1]].join(" "):[A(i/255),A(a/255),A(s/255),n[1]].join(" ")}else t="string"==typeof i?[i,a,s,r,n[2]].join(" "):2===e.precision?[C(i),C(a),C(s),C(r),n[2]].join(" "):[A(i),A(a),A(s),A(r),n[2]].join(" ");return t},We=m.__private__.getFilters=function(){return n},He=m.__private__.putStream=function(e){var t=(e=e||{}).data||"",i=e.filters||We(),a=e.alreadyAppliedFilters||[],s=e.addLength1||!1,r=t.length,n=e.objectId,o=function(e){return e};if(null!==d&&void 0===n)throw new Error("ObjectId must be passed to putStream for file encryption");null!==d&&(o=bt.encryptor(n,0));var l={};!0===i&&(i=["FlateEncode"]);var c=e.additionalKeyValues||[],u=(l=void 0!==uL.API.processDataByFilters?uL.API.processDataByFilters(t,i):{data:t,reverseChain:[]}).reverseChain+(Array.isArray(a)?a.join(" "):a.toString());if(0!==l.data.length&&(c.push({key:"Length",value:l.data.length}),!0===s&&c.push({key:"Length1",value:r})),0!=u.length)if(u.split("/").length-1==1)c.push({key:"Filter",value:u});else{c.push({key:"Filter",value:"["+u+"]"});for(var h=0;h<c.length;h+=1)if("DecodeParms"===c[h].key){for(var m=[],p=0;p<l.reverseChain.split("/").length-1;p+=1)m.push("null");m.push(c[h].value),c[h].value="["+m.join(" ")+"]"}}X("<<");for(var f=0;f<c.length;f++)X("/"+c[f].key+" "+c[f].value);X(">>"),0!==l.data.length&&(X("stream"),X(o(l.data)),X("endstream"))},Ze=m.__private__.putPage=function(e){var t=e.number,i=e.data,a=e.objId,s=e.contentsObjId;De(a,!0),X("<</Type /Page"),X("/Parent "+e.rootDictionaryObjId+" 0 R"),X("/Resources "+e.resourceDictionaryObjId+" 0 R"),X("/MediaBox ["+parseFloat(S(e.mediaBox.bottomLeftX))+" "+parseFloat(S(e.mediaBox.bottomLeftY))+" "+S(e.mediaBox.topRightX)+" "+S(e.mediaBox.topRightY)+"]"),null!==e.cropBox&&X("/CropBox ["+S(e.cropBox.bottomLeftX)+" "+S(e.cropBox.bottomLeftY)+" "+S(e.cropBox.topRightX)+" "+S(e.cropBox.topRightY)+"]"),null!==e.bleedBox&&X("/BleedBox ["+S(e.bleedBox.bottomLeftX)+" "+S(e.bleedBox.bottomLeftY)+" "+S(e.bleedBox.topRightX)+" "+S(e.bleedBox.topRightY)+"]"),null!==e.trimBox&&X("/TrimBox ["+S(e.trimBox.bottomLeftX)+" "+S(e.trimBox.bottomLeftY)+" "+S(e.trimBox.topRightX)+" "+S(e.trimBox.topRightY)+"]"),null!==e.artBox&&X("/ArtBox ["+S(e.artBox.bottomLeftX)+" "+S(e.artBox.bottomLeftY)+" "+S(e.artBox.topRightX)+" "+S(e.artBox.topRightY)+"]"),"number"==typeof e.userUnit&&1!==e.userUnit&&X("/UserUnit "+e.userUnit),ke.publish("putPage",{objId:a,pageContext:_e[t],pageNumber:t,page:i}),X("/Contents "+s+" 0 R"),X(">>"),X("endobj");var r=i.join("\n");return y===v&&(r+="\nQ"),De(s,!0),He({data:r,filters:We(),objectId:s}),X("endobj"),a},Ve=m.__private__.putPages=function(){var e,t,i=[];for(e=1;e<=Se;e++)_e[e].objId=Oe(),_e[e].contentsObjId=Oe();for(e=1;e<=Se;e++)i.push(Ze({number:e,data:V[e],objId:_e[e].objId,contentsObjId:_e[e].contentsObjId,mediaBox:_e[e].mediaBox,cropBox:_e[e].cropBox,bleedBox:_e[e].bleedBox,trimBox:_e[e].trimBox,artBox:_e[e].artBox,userUnit:_e[e].userUnit,rootDictionaryObjId:Be,resourceDictionaryObjId:Ue}));De(Be,!0),X("<</Type /Pages");var a="/Kids [";for(t=0;t<Se;t++)a+=i[t]+" 0 R ";X(a+"]"),X("/Count "+Se),X(">>"),X("endobj"),ke.publish("postPutPages")},Ge=function(e){ke.publish("putFont",{font:e,out:X,newObject:Fe,putStream:He}),!0!==e.isAlreadyPutted&&(e.objectNumber=Fe(),X("<<"),X("/Type /Font"),X("/BaseFont /"+rL(e.postScriptName)),X("/Subtype /Type1"),"string"==typeof e.encoding&&X("/Encoding /"+e.encoding),X("/FirstChar 32"),X("/LastChar 255"),X(">>"),X("endobj"))},Ye=function(e){e.objectNumber=Fe();var t=[];t.push({key:"Type",value:"/XObject"}),t.push({key:"Subtype",value:"/Form"}),t.push({key:"BBox",value:"["+[S(e.x),S(e.y),S(e.x+e.width),S(e.y+e.height)].join(" ")+"]"}),t.push({key:"Matrix",value:"["+e.matrix.toString()+"]"});var i=e.pages[1].join("\n");He({data:i,additionalKeyValues:t,objectId:e.objectNumber}),X("endobj")},Ke=function(e,t){t||(t=21);var i=Fe(),a=function(e,t){var i,a=[],s=1/(t-1);for(i=0;i<1;i+=s)a.push(i);if(a.push(1),0!=e[0].offset){var r={offset:0,color:e[0].color};e.unshift(r)}if(1!=e[e.length-1].offset){var n={offset:1,color:e[e.length-1].color};e.push(n)}for(var o="",l=0,c=0;c<a.length;c++){for(i=a[c];i>e[l+1].offset;)l++;var d=e[l].offset,u=(i-d)/(e[l+1].offset-d),h=e[l].color,m=e[l+1].color;o+=U(Math.round((1-u)*h[0]+u*m[0]).toString(16))+U(Math.round((1-u)*h[1]+u*m[1]).toString(16))+U(Math.round((1-u)*h[2]+u*m[2]).toString(16))}return o.trim()}(e.colors,t),s=[];s.push({key:"FunctionType",value:"0"}),s.push({key:"Domain",value:"[0.0 1.0]"}),s.push({key:"Size",value:"["+t+"]"}),s.push({key:"BitsPerSample",value:"8"}),s.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),s.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),He({data:a,additionalKeyValues:s,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:i}),X("endobj"),e.objectNumber=Fe(),X("<< /ShadingType "+e.type),X("/ColorSpace /DeviceRGB");var r="/Coords ["+S(parseFloat(e.coords[0]))+" "+S(parseFloat(e.coords[1]))+" ";2===e.type?r+=S(parseFloat(e.coords[2]))+" "+S(parseFloat(e.coords[3])):r+=S(parseFloat(e.coords[2]))+" "+S(parseFloat(e.coords[3]))+" "+S(parseFloat(e.coords[4]))+" "+S(parseFloat(e.coords[5])),X(r+="]"),e.matrix&&X("/Matrix ["+e.matrix.toString()+"]"),X("/Function "+i+" 0 R"),X("/Extend [true true]"),X(">>"),X("endobj")},Xe=function(e,t){var i=Oe(),a=Fe();t.push({resourcesOid:i,objectOid:a}),e.objectNumber=a;var s=[];s.push({key:"Type",value:"/Pattern"}),s.push({key:"PatternType",value:"1"}),s.push({key:"PaintType",value:"1"}),s.push({key:"TilingType",value:"1"}),s.push({key:"BBox",value:"["+e.boundingBox.map(S).join(" ")+"]"}),s.push({key:"XStep",value:S(e.xStep)}),s.push({key:"YStep",value:S(e.yStep)}),s.push({key:"Resources",value:i+" 0 R"}),e.matrix&&s.push({key:"Matrix",value:"["+e.matrix.toString()+"]"}),He({data:e.stream,additionalKeyValues:s,objectId:e.objectNumber}),X("endobj")},Je=function(e){for(var t in e.objectNumber=Fe(),X("<<"),e)switch(t){case"opacity":X("/ca "+C(e[t]));break;case"stroke-opacity":X("/CA "+C(e[t]))}X(">>"),X("endobj")},Qe=function(e){De(e.resourcesOid,!0),X("<<"),X("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var e in X("/Font <<"),ge)ge.hasOwnProperty(e)&&(!1===u||!0===u&&h.hasOwnProperty(e))&&X("/"+e+" "+ge[e].objectNumber+" 0 R");X(">>")}(),function(){if(Object.keys(ve).length>0){for(var e in X("/Shading <<"),ve)ve.hasOwnProperty(e)&&ve[e]instanceof cL&&ve[e].objectNumber>=0&&X("/"+e+" "+ve[e].objectNumber+" 0 R");ke.publish("putShadingPatternDict"),X(">>")}}(),function(e){if(Object.keys(ve).length>0){for(var t in X("/Pattern <<"),ve)ve.hasOwnProperty(t)&&ve[t]instanceof m.TilingPattern&&ve[t].objectNumber>=0&&ve[t].objectNumber<e&&X("/"+t+" "+ve[t].objectNumber+" 0 R");ke.publish("putTilingPatternDict"),X(">>")}}(e.objectOid),function(){if(Object.keys(we).length>0){var e;for(e in X("/ExtGState <<"),we)we.hasOwnProperty(e)&&we[e].objectNumber>=0&&X("/"+e+" "+we[e].objectNumber+" 0 R");ke.publish("putGStateDict"),X(">>")}}(),function(){for(var e in X("/XObject <<"),Ae)Ae.hasOwnProperty(e)&&Ae[e].objectNumber>=0&&X("/"+e+" "+Ae[e].objectNumber+" 0 R");ke.publish("putXobjectDict"),X(">>")}(),X(">>"),X("endobj")},et=function(e){xe[e.fontName]=xe[e.fontName]||{},xe[e.fontName][e.fontStyle]=e.id},tt=function(e,t,i,a,s){var r={id:"F"+(Object.keys(ge).length+1).toString(10),postScriptName:e,fontName:t,fontStyle:i,encoding:a,isStandardFont:s||!1,metadata:{}};return ke.publish("addFont",{font:r,instance:this}),ge[r.id]=r,et(r),r.id},it=m.__private__.pdfEscape=m.pdfEscape=function(e,t){return function(e,t){var i,a,s,r,n,o,l,c,d;if(s=(t=t||{}).sourceEncoding||"Unicode",n=t.outputEncoding,(t.autoencode||n)&&ge[ue].metadata&&ge[ue].metadata[s]&&ge[ue].metadata[s].encoding&&(r=ge[ue].metadata[s].encoding,!n&&ge[ue].encoding&&(n=ge[ue].encoding),!n&&r.codePages&&(n=r.codePages[0]),"string"==typeof n&&(n=r[n]),n)){for(l=!1,o=[],i=0,a=e.length;i<a;i++)(c=n[e.charCodeAt(i)])?o.push(String.fromCharCode(c)):o.push(e[i]),o[i].charCodeAt(0)>>8&&(l=!0);e=o.join("")}for(i=e.length;void 0===l&&0!==i;)e.charCodeAt(i-1)>>8&&(l=!0),i--;if(!l)return e;for(o=t.noBOM?[]:[254,255],i=0,a=e.length;i<a;i++){if((d=(c=e.charCodeAt(i))>>8)>>8)throw new Error("Character at position "+i+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");o.push(d),o.push(c-(d<<8))}return String.fromCharCode.apply(void 0,o)}(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},at=m.__private__.beginPage=function(e){V[++Se]=[],_e[Se]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(e[0]),topRightY:Number(e[1])}},nt(Se),K(V[R])},st=function(e,t){var a,r,n;switch(i=t||i,"string"==typeof e&&(a=x(e.toLowerCase()),Array.isArray(a)&&(r=a[0],n=a[1])),Array.isArray(e)&&(r=e[0]*he,n=e[1]*he),isNaN(r)&&(r=s[0],n=s[1]),(r>14400||n>14400)&&(MM.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),r=Math.min(14400,r),n=Math.min(14400,n)),s=[r,n],i.substr(0,1)){case"l":n>r&&(s=[n,r]);break;case"p":r>n&&(s=[n,r])}at(s),Dt(Ft),X(Zt),0!==Jt&&X(Jt+" J"),0!==Qt&&X(Qt+" j"),ke.publish("addPage",{pageNumber:Se})},rt=function(e){e>0&&e<=Se&&(V.splice(e,1),_e.splice(e,1),Se--,R>Se&&(R=Se),this.setPage(R))},nt=function(e){e>0&&e<=Se&&(R=e)},ot=m.__private__.getNumberOfPages=m.getNumberOfPages=function(){return V.length-1},lt=function(e,t,i){var a,s=void 0;return i=i||{},e=void 0!==e?e:ge[ue].fontName,t=void 0!==t?t:ge[ue].fontStyle,a=e.toLowerCase(),void 0!==xe[a]&&void 0!==xe[a][t]?s=xe[a][t]:void 0!==xe[e]&&void 0!==xe[e][t]?s=xe[e][t]:!1===i.disableWarning&&MM.warn("Unable to look up font label for font '"+e+"', '"+t+"'. Refer to getFontList() for available fonts."),s||i.noFallback||null==(s=xe.times[t])&&(s=xe.times.normal),s},ct=m.__private__.putInfo=function(){var e=Fe(),t=function(e){return e};for(var i in null!==d&&(t=bt.encryptor(e,0)),X("<<"),X("/Producer ("+it(t("jsPDF "+uL.version))+")"),de)de.hasOwnProperty(i)&&de[i]&&X("/"+i.substr(0,1).toUpperCase()+i.substr(1)+" ("+it(t(de[i]))+")");X("/CreationDate ("+it(t(I))+")"),X(">>"),X("endobj")},dt=m.__private__.putCatalog=function(e){var t=(e=e||{}).rootDictionaryObjId||Be;switch(Fe(),X("<<"),X("/Type /Catalog"),X("/Pages "+t+" 0 R"),ie||(ie="fullwidth"),ie){case"fullwidth":X("/OpenAction [3 0 R /FitH null]");break;case"fullheight":X("/OpenAction [3 0 R /FitV null]");break;case"fullpage":X("/OpenAction [3 0 R /Fit]");break;case"original":X("/OpenAction [3 0 R /XYZ null null 1]");break;default:var i=""+ie;"%"===i.substr(i.length-1)&&(ie=parseInt(ie)/100),"number"==typeof ie&&X("/OpenAction [3 0 R /XYZ null null "+C(ie)+"]")}switch(oe||(oe="continuous"),oe){case"continuous":X("/PageLayout /OneColumn");break;case"single":X("/PageLayout /SinglePage");break;case"two":case"twoleft":X("/PageLayout /TwoColumnLeft");break;case"tworight":X("/PageLayout /TwoColumnRight")}re&&X("/PageMode /"+re),ke.publish("putCatalog"),X(">>"),X("endobj")},ut=m.__private__.putTrailer=function(){X("trailer"),X("<<"),X("/Size "+(q+1)),X("/Root "+q+" 0 R"),X("/Info "+(q-1)+" 0 R"),null!==d&&X("/Encrypt "+bt.oid+" 0 R"),X("/ID [ <"+P+"> <"+P+"> ]"),X(">>")},ht=m.__private__.putHeader=function(){X("%PDF-"+p),X("%")},mt=m.__private__.putXRef=function(){var e="0000000000";X("xref"),X("0 "+(q+1)),X("0000000000 65535 f ");for(var t=1;t<=q;t++)"function"==typeof $[t]?X((e+$[t]()).slice(-10)+" 00000 n "):void 0!==$[t]?X((e+$[t]).slice(-10)+" 00000 n "):X("0000000000 00000 n ")},pt=m.__private__.buildDocument=function(){var e;q=0,H=0,W=[],$=[],Z=[],Be=Oe(),Ue=Oe(),K(W),ke.publish("buildDocument"),ht(),Ve(),function(){ke.publish("putAdditionalObjects");for(var e=0;e<Z.length;e++){var t=Z[e];De(t.objId,!0),X(t.content),X("endobj")}ke.publish("postPutAdditionalObjects")}(),e=[],function(){for(var e in ge)ge.hasOwnProperty(e)&&(!1===u||!0===u&&h.hasOwnProperty(e))&&Ge(ge[e])}(),function(){var e;for(e in we)we.hasOwnProperty(e)&&Je(we[e])}(),function(){for(var e in Ae)Ae.hasOwnProperty(e)&&Ye(Ae[e])}(),function(e){var t;for(t in ve)ve.hasOwnProperty(t)&&(ve[t]instanceof cL?Ke(ve[t]):ve[t]instanceof dL&&Xe(ve[t],e))}(e),ke.publish("putResources"),e.forEach(Qe),Qe({resourcesOid:Ue,objectOid:Number.MAX_SAFE_INTEGER}),ke.publish("postPutResources"),null!==d&&(bt.oid=Fe(),X("<<"),X("/Filter /Standard"),X("/V "+bt.v),X("/R "+bt.r),X("/U <"+bt.toHexString(bt.U)+">"),X("/O <"+bt.toHexString(bt.O)+">"),X("/P "+bt.P),X(">>"),X("endobj")),ct(),dt();var t=H;return mt(),ut(),X("startxref"),X(""+t),X("%%EOF"),K(V[R]),W.join("\n")},ft=m.__private__.getBlob=function(e){return new Blob([Q(e)],{type:"application/pdf"})},gt=m.output=m.__private__.output=(Le=function(e,t){switch("string"==typeof(t=t||{})?t={filename:t}:t.filename=t.filename||"generated.pdf",e){case void 0:return pt();case"save":m.save(t.filename);break;case"arraybuffer":return Q(pt());case"blob":return ft(pt());case"bloburi":case"bloburl":if(void 0!==PM.URL&&"function"==typeof PM.URL.createObjectURL)return PM.URL&&PM.URL.createObjectURL(ft(pt()))||void 0;MM.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var i="",a=pt();try{i=UM(a)}catch(p){i=UM(unescape(encodeURIComponent(a)))}return"data:application/pdf;filename="+t.filename+";base64,"+i;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(PM)){var s="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",r=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';t.pdfObjectUrl&&(s=t.pdfObjectUrl,r="");var n='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+s+'"'+r+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(t)+");<\/script></body></html>",o=PM.open();return null!==o&&o.document.write(n),o}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(PM)){var l='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(t.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+t.filename+'" width="500px" height="400px" /></body></html>',c=PM.open();if(null!==c){c.document.write(l);var d=this;c.document.documentElement.querySelector("#pdfViewer").onload=function(){c.document.title=t.filename,c.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(d.output("bloburl"))}}return c}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(PM))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var u='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",t)+'"></iframe></body></html>',h=PM.open();if(null!==h&&(h.document.write(u),h.document.title=t.filename),h||"undefined"==typeof safari)return h;break;case"datauri":case"dataurl":return PM.document.location.href=this.output("datauristring",t);default:return null}},Le.foo=function(){try{return Le.apply(this,arguments)}catch(Yd){var e=Yd.stack||"";~e.indexOf(" at ")&&(e=e.split(" at ")[1]);var t="Error in function "+e.split("\n")[0].split("<")[0]+": "+Yd.message;if(!PM.console)throw new Error(t);PM.console.error(t,Yd),PM.alert&&alert(t)}},Le.foo.bar=Le,Le.foo),xt=function(e){return!0===Array.isArray(Ce)&&Ce.indexOf(e)>-1};switch(a){case"pt":he=1;break;case"mm":he=72/25.4;break;case"cm":he=72/2.54;break;case"in":he=72;break;case"px":he=1==xt("px_scaling")?.75:96/72;break;case"pc":case"em":he=12;break;case"ex":he=6;break;default:if("number"!=typeof a)throw new Error("Invalid unit: "+a);he=a}var bt=null;O(),M();var vt=m.__private__.getPageInfo=m.getPageInfo=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:_e[e].objId,pageNumber:e,pageContext:_e[e]}},yt=m.__private__.getPageInfoByObjId=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var t in _e)if(_e[t].objId===e)break;return vt(t)},wt=m.__private__.getCurrentPageInfo=m.getCurrentPageInfo=function(){return{objId:_e[R].objId,pageNumber:R,pageContext:_e[R]}};m.addPage=function(){return st.apply(this,arguments),this},m.setPage=function(){return nt.apply(this,arguments),K.call(this,V[R]),this},m.insertPage=function(e){return this.addPage(),this.movePage(R,e),this},m.movePage=function(e,t){var i,a;if(e>t){i=V[e],a=_e[e];for(var s=e;s>t;s--)V[s]=V[s-1],_e[s]=_e[s-1];V[t]=i,_e[t]=a,this.setPage(t)}else if(e<t){i=V[e],a=_e[e];for(var r=e;r<t;r++)V[r]=V[r+1],_e[r]=_e[r+1];V[t]=i,_e[t]=a,this.setPage(t)}return this},m.deletePage=function(){return rt.apply(this,arguments),this},m.__private__.text=m.text=function(e,t,i,a,s){var r,n,o,l,c,d,u,m,p,f=(a=a||{}).scope||this;if("number"==typeof e&&"number"==typeof t&&("string"==typeof i||Array.isArray(i))){var g=i;i=t,t=e,e=g}if(arguments[3]instanceof Ie==0?(o=arguments[4],l=arguments[5],"object"===II(u=arguments[3])&&null!==u||("string"==typeof o&&(l=o,o=null),"string"==typeof u&&(l=u,u=null),"number"==typeof u&&(o=u,u=null),a={flags:u,angle:o,align:l})):(_("The transform parameter of text() with a Matrix value"),p=s),isNaN(t)||isNaN(i)||null==e)throw new Error("Invalid arguments passed to jsPDF.text");if(0===e.length)return f;var x,b="",w="number"==typeof a.lineHeightFactor?a.lineHeightFactor:Lt,N=f.internal.scaleFactor;function j(e){return e=e.split("\t").join(Array(a.TabLen||9).join(" ")),it(e,u)}function k(e){for(var t,i=e.concat(),a=[],s=i.length;s--;)"string"==typeof(t=i.shift())?a.push(t):Array.isArray(e)&&(1===t.length||void 0===t[1]&&void 0===t[2])?a.push(t[0]):a.push([t[0],t[1],t[2]]);return a}function C(e,t){var i;if("string"==typeof e)i=t(e)[0];else if(Array.isArray(e)){for(var a,s,r=e.concat(),n=[],o=r.length;o--;)"string"==typeof(a=r.shift())?n.push(t(a)[0]):Array.isArray(a)&&"string"==typeof a[0]&&(s=t(a[0],a[1],a[2]),n.push([s[0],s[1],s[2]]));i=n}return i}var A=!1,E=!0;if("string"==typeof e)A=!0;else if(Array.isArray(e)){var I=e.concat();n=[];for(var P,T=I.length;T--;)("string"!=typeof(P=I.shift())||Array.isArray(P)&&"string"!=typeof P[0])&&(E=!1);A=E}if(!1===A)throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');"string"==typeof e&&(e=e.match(/[\r?\n]/)?e.split(/\r\n|\r|\n/g):[e]);var M=te/f.internal.scaleFactor,L=M*(w-1);switch(a.baseline){case"bottom":i-=L;break;case"top":i+=M-L;break;case"hanging":i+=M-2*L;break;case"middle":i+=M/2-L}if((d=a.maxWidth||0)>0&&("string"==typeof e?e=f.splitTextToSize(e,d):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(f.splitTextToSize(t,d))},[]))),r={text:e,x:t,y:i,options:a,mutex:{pdfEscape:it,activeFontKey:ue,fonts:ge,activeFontSize:te}},ke.publish("preProcessText",r),e=r.text,o=(a=r.options).angle,p instanceof Ie==0&&o&&"number"==typeof o){o*=Math.PI/180,0===a.rotationDirection&&(o=-o),y===v&&(o=-o);var F=Math.cos(o),O=Math.sin(o);p=new Ie(F,O,-O,F,0,0)}else o&&o instanceof Ie&&(p=o);y!==v||p||(p=Te),void 0!==(c=a.charSpace||Kt)&&(b+=S(z(c))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),void 0!==(m=a.horizontalScale)&&(b+=S(100*m)+" Tz\n"),a.lang;var D=-1,R=void 0!==a.renderingMode?a.renderingMode:a.stroke,B=f.internal.getCurrentPageInfo().pageContext;switch(R){case 0:case!1:case"fill":D=0;break;case 1:case!0:case"stroke":D=1;break;case 2:case"fillThenStroke":D=2;break;case 3:case"invisible":D=3;break;case 4:case"fillAndAddForClipping":D=4;break;case 5:case"strokeAndAddPathForClipping":D=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":D=6;break;case 7:case"addToPathForClipping":D=7}var U=void 0!==B.usedRenderingMode?B.usedRenderingMode:-1;-1!==D?b+=D+" Tr\n":-1!==U&&(b+="0 Tr\n"),-1!==D&&(B.usedRenderingMode=D),l=a.align||"left";var q,$=te*w,W=f.internal.pageSize.getWidth(),H=ge[ue];c=a.charSpace||Kt,d=a.maxWidth||0,u=Object.assign({autoencode:!0,noBOM:!0},a.flags);var Z=[],V=function(e){return f.getStringUnitWidth(e,{font:H,charSpace:c,fontSize:te,doKerning:!1})*te/N};if("[object Array]"===Object.prototype.toString.call(e)){var G;n=k(e),"left"!==l&&(q=n.map(V));var Y,K=0;if("right"===l){t-=q[0],e=[],T=n.length;for(var J=0;J<T;J++)0===J?(Y=qt(t),G=$t(i)):(Y=z(K-q[J]),G=-$),e.push([n[J],Y,G]),K=q[J]}else if("center"===l){t-=q[0]/2,e=[],T=n.length;for(var Q=0;Q<T;Q++)0===Q?(Y=qt(t),G=$t(i)):(Y=z((K-q[Q])/2),G=-$),e.push([n[Q],Y,G]),K=q[Q]}else if("left"===l){e=[],T=n.length;for(var ee=0;ee<T;ee++)e.push(n[ee])}else if("justify"===l&&"Identity-H"===H.encoding){e=[],T=n.length,d=0!==d?d:W;for(var ie=0,ae=0;ae<T;ae++)if(G=0===ae?$t(i):-$,Y=0===ae?qt(t):ie,ae<T-1){var re=z((d-q[ae])/(n[ae].split(" ").length-1)),ne=n[ae].split(" ");e.push([ne[0]+" ",Y,G]),ie=0;for(var oe=1;oe<ne.length;oe++){var le=(V(ne[oe-1]+" "+ne[oe])-V(ne[oe]))*N+re;oe==ne.length-1?e.push([ne[oe],le,0]):e.push([ne[oe]+" ",le,0]),ie-=le}}else e.push([n[ae],Y,G]);e.push(["",ie,0])}else{if("justify"!==l)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(e=[],T=n.length,d=0!==d?d:W,ae=0;ae<T;ae++){G=0===ae?$t(i):-$,Y=0===ae?qt(t):0;var ce=n[ae].split(" ").length-1,de=ce>0?(d-q[ae])/ce:0;ae<T-1?Z.push(S(z(de))):Z.push(0),e.push([n[ae],Y,G])}}}!0===("boolean"==typeof a.R2L?a.R2L:se)&&(e=C(e,function(e,t,i){return[e.split("").reverse().join(""),t,i]})),r={text:e,x:t,y:i,options:a,mutex:{pdfEscape:it,activeFontKey:ue,fonts:ge,activeFontSize:te}},ke.publish("postProcessText",r),e=r.text,x=r.mutex.isHex||!1;var he=ge[ue].encoding;"WinAnsiEncoding"!==he&&"StandardEncoding"!==he||(e=C(e,function(e,t,i){return[j(e),t,i]})),n=k(e),e=[];for(var me,pe,fe,xe=Array.isArray(n[0])?1:0,be="",ve=function(e,t,i){var s="";return i instanceof Ie?(i="number"==typeof a.angle?Pe(i,new Ie(1,0,0,1,e,t)):Pe(new Ie(1,0,0,1,e,t),i),y===v&&(i=Pe(new Ie(1,0,0,-1,0,0),i)),s=i.join(" ")+" Tm\n"):s=S(e)+" "+S(t)+" Td\n",s},ye=0;ye<n.length;ye++){switch(be="",xe){case 1:fe=(x?"<":"(")+n[ye][0]+(x?">":")"),me=parseFloat(n[ye][1]),pe=parseFloat(n[ye][2]);break;case 0:fe=(x?"<":"(")+n[ye]+(x?">":")"),me=qt(t),pe=$t(i)}void 0!==Z&&void 0!==Z[ye]&&(be=Z[ye]+" Tw\n"),0===ye?e.push(be+ve(me,pe,p)+fe):0===xe?e.push(be+fe):1===xe&&e.push(be+ve(me,pe,p)+fe)}e=0===xe?e.join(" Tj\nT* "):e.join(" Tj\n"),e+=" Tj\n";var we="BT\n/";return we+=ue+" "+te+" Tf\n",we+=S(te*w)+" TL\n",we+=Gt+"\n",we+=b,we+=e,X(we+="ET"),h[ue]=!0,f};var Nt=m.__private__.clip=m.clip=function(e){return X("evenodd"===e?"W*":"W"),this};m.clipEvenOdd=function(){return Nt("evenodd")},m.__private__.discardPath=m.discardPath=function(){return X("n"),this};var jt=m.__private__.isValidStyle=function(e){var t=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(e)&&(t=!0),t};m.__private__.setDefaultPathOperation=m.setDefaultPathOperation=function(e){return jt(e)&&(c=e),this};var St=m.__private__.getStyle=m.getStyle=function(e){var t=c;switch(e){case"D":case"S":t="S";break;case"F":t="f";break;case"FD":case"DF":t="B";break;case"f":case"f*":case"B":case"B*":t=e}return t},_t=m.close=function(){return X("h"),this};m.stroke=function(){return X("S"),this},m.fill=function(e){return kt("f",e),this},m.fillEvenOdd=function(e){return kt("f*",e),this},m.fillStroke=function(e){return kt("B",e),this},m.fillStrokeEvenOdd=function(e){return kt("B*",e),this};var kt=function(e,t){"object"===II(t)?zt(t,e):X(e)},Ct=function(e){null===e||y===v&&void 0===e||(e=St(e),X(e))};function At(e,t,i,a,s){var r=new dL(t||this.boundingBox,i||this.xStep,a||this.yStep,this.gState,s||this.matrix);r.stream=this.stream;var n=e+"$$"+this.cloneIndex+++"$$";return Me(n,r),r}var zt=function(e,t){var i=ye[e.key],a=ve[i];if(a instanceof cL)X("q"),X(Et(t)),a.gState&&m.setGState(a.gState),X(e.matrix.toString()+" cm"),X("/"+i+" sh"),X("Q");else if(a instanceof dL){var s=new Ie(1,0,0,-1,0,hi());e.matrix&&(s=s.multiply(e.matrix||Te),i=At.call(a,e.key,e.boundingBox,e.xStep,e.yStep,s).id),X("q"),X("/Pattern cs"),X("/"+i+" scn"),a.gState&&m.setGState(a.gState),X(t),X("Q")}},Et=function(e){switch(e){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},It=m.moveTo=function(e,t){return X(S(z(e))+" "+S(E(t))+" m"),this},Pt=m.lineTo=function(e,t){return X(S(z(e))+" "+S(E(t))+" l"),this},Tt=m.curveTo=function(e,t,i,a,s,r){return X([S(z(e)),S(E(t)),S(z(i)),S(E(a)),S(z(s)),S(E(r)),"c"].join(" ")),this};m.__private__.line=m.line=function(e,t,i,a,s){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a)||!jt(s))throw new Error("Invalid arguments passed to jsPDF.line");return y===b?this.lines([[i-e,a-t]],e,t,[1,1],s||"S"):this.lines([[i-e,a-t]],e,t,[1,1]).stroke()},m.__private__.lines=m.lines=function(e,t,i,a,s,r){var n,o,l,c,d,u,h,m,p,f,g,x;if("number"==typeof e&&(x=i,i=t,t=e,e=x),a=a||[1,1],r=r||!1,isNaN(t)||isNaN(i)||!Array.isArray(e)||!Array.isArray(a)||!jt(s)||"boolean"!=typeof r)throw new Error("Invalid arguments passed to jsPDF.lines");for(It(t,i),n=a[0],o=a[1],c=e.length,f=t,g=i,l=0;l<c;l++)2===(d=e[l]).length?(f=d[0]*n+f,g=d[1]*o+g,Pt(f,g)):(u=d[0]*n+f,h=d[1]*o+g,m=d[2]*n+f,p=d[3]*o+g,f=d[4]*n+f,g=d[5]*o+g,Tt(u,h,m,p,f,g));return r&&_t(),Ct(s),this},m.path=function(e){for(var t=0;t<e.length;t++){var i=e[t],a=i.c;switch(i.op){case"m":It(a[0],a[1]);break;case"l":Pt(a[0],a[1]);break;case"c":Tt.apply(this,a);break;case"h":_t()}}return this},m.__private__.rect=m.rect=function(e,t,i,a,s){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a)||!jt(s))throw new Error("Invalid arguments passed to jsPDF.rect");return y===b&&(a=-a),X([S(z(e)),S(E(t)),S(z(i)),S(z(a)),"re"].join(" ")),Ct(s),this},m.__private__.triangle=m.triangle=function(e,t,i,a,s,r,n){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a)||isNaN(s)||isNaN(r)||!jt(n))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[i-e,a-t],[s-i,r-a],[e-s,t-r]],e,t,[1,1],n,!0),this},m.__private__.roundedRect=m.roundedRect=function(e,t,i,a,s,r,n){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a)||isNaN(s)||isNaN(r)||!jt(n))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var o=4/3*(Math.SQRT2-1);return s=Math.min(s,.5*i),r=Math.min(r,.5*a),this.lines([[i-2*s,0],[s*o,0,s,r-r*o,s,r],[0,a-2*r],[0,r*o,-s*o,r,-s,r],[2*s-i,0],[-s*o,0,-s,-r*o,-s,-r],[0,2*r-a],[0,-r*o,s*o,-r,s,-r]],e+s,t,[1,1],n,!0),this},m.__private__.ellipse=m.ellipse=function(e,t,i,a,s){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a)||!jt(s))throw new Error("Invalid arguments passed to jsPDF.ellipse");var r=4/3*(Math.SQRT2-1)*i,n=4/3*(Math.SQRT2-1)*a;return It(e+i,t),Tt(e+i,t-n,e+r,t-a,e,t-a),Tt(e-r,t-a,e-i,t-n,e-i,t),Tt(e-i,t+n,e-r,t+a,e,t+a),Tt(e+r,t+a,e+i,t+n,e+i,t),Ct(s),this},m.__private__.circle=m.circle=function(e,t,i,a){if(isNaN(e)||isNaN(t)||isNaN(i)||!jt(a))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(e,t,i,i,a)},m.setFont=function(e,t,i){return i&&(t=j(t,i)),ue=lt(e,t,{disableWarning:!1}),this};var Mt=m.__private__.getFont=m.getFont=function(){return ge[lt.apply(m,arguments)]};m.__private__.getFontList=m.getFontList=function(){var e,t,i={};for(e in xe)if(xe.hasOwnProperty(e))for(t in i[e]=[],xe[e])xe[e].hasOwnProperty(t)&&i[e].push(t);return i},m.addFont=function(e,t,i,a,s){var r=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==r.indexOf(arguments[3])?s=arguments[3]:arguments[3]&&-1==r.indexOf(arguments[3])&&(i=j(i,a)),tt.call(this,e,t,i,s=s||"Identity-H")};var Lt,Ft=e.lineWidth||.200025,Ot=m.__private__.getLineWidth=m.getLineWidth=function(){return Ft},Dt=m.__private__.setLineWidth=m.setLineWidth=function(e){return Ft=e,X(S(z(e))+" w"),this};m.__private__.setLineDash=uL.API.setLineDash=uL.API.setLineDashPattern=function(e,t){if(e=e||[],t=t||0,isNaN(t)||!Array.isArray(e))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return e=e.map(function(e){return S(z(e))}).join(" "),t=S(z(t)),X("["+e+"] "+t+" d"),this};var Rt=m.__private__.getLineHeight=m.getLineHeight=function(){return te*Lt};m.__private__.getLineHeight=m.getLineHeight=function(){return te*Lt};var Bt=m.__private__.setLineHeightFactor=m.setLineHeightFactor=function(e){return"number"==typeof(e=e||1.15)&&(Lt=e),this},Ut=m.__private__.getLineHeightFactor=m.getLineHeightFactor=function(){return Lt};Bt(e.lineHeight);var qt=m.__private__.getHorizontalCoordinate=function(e){return z(e)},$t=m.__private__.getVerticalCoordinate=function(e){return y===v?e:_e[R].mediaBox.topRightY-_e[R].mediaBox.bottomLeftY-z(e)},Wt=m.__private__.getHorizontalCoordinateString=m.getHorizontalCoordinateString=function(e){return S(qt(e))},Ht=m.__private__.getVerticalCoordinateString=m.getVerticalCoordinateString=function(e){return S($t(e))},Zt=e.strokeColor||"0 G";m.__private__.getStrokeColor=m.getDrawColor=function(){return qe(Zt)},m.__private__.setStrokeColor=m.setDrawColor=function(e,t,i,a){return Zt=$e({ch1:e,ch2:t,ch3:i,ch4:a,pdfColorType:"draw",precision:2}),X(Zt),this};var Vt=e.fillColor||"0 g";m.__private__.getFillColor=m.getFillColor=function(){return qe(Vt)},m.__private__.setFillColor=m.setFillColor=function(e,t,i,a){return Vt=$e({ch1:e,ch2:t,ch3:i,ch4:a,pdfColorType:"fill",precision:2}),X(Vt),this};var Gt=e.textColor||"0 g",Yt=m.__private__.getTextColor=m.getTextColor=function(){return qe(Gt)};m.__private__.setTextColor=m.setTextColor=function(e,t,i,a){return Gt=$e({ch1:e,ch2:t,ch3:i,ch4:a,pdfColorType:"text",precision:3}),this};var Kt=e.charSpace,Xt=m.__private__.getCharSpace=m.getCharSpace=function(){return parseFloat(Kt||0)};m.__private__.setCharSpace=m.setCharSpace=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Kt=e,this};var Jt=0;m.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},m.__private__.setLineCap=m.setLineCap=function(e){var t=m.CapJoinStyles[e];if(void 0===t)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Jt=t,X(t+" J"),this};var Qt=0;m.__private__.setLineJoin=m.setLineJoin=function(e){var t=m.CapJoinStyles[e];if(void 0===t)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Qt=t,X(t+" j"),this},m.__private__.setLineMiterLimit=m.__private__.setMiterLimit=m.setLineMiterLimit=m.setMiterLimit=function(e){if(e=e||0,isNaN(e))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return X(S(z(e))+" M"),this},m.GState=oL,m.setGState=function(e){(e="string"==typeof e?we[Ne[e]]:ei(null,e)).equals(je)||(X("/"+e.id+" gs"),je=e)};var ei=function(e,t){if(!e||!Ne[e]){var i=!1;for(var a in we)if(we.hasOwnProperty(a)&&we[a].equals(t)){i=!0;break}if(i)t=we[a];else{var s="GS"+(Object.keys(we).length+1).toString(10);we[s]=t,t.id=s}return e&&(Ne[e]=t.id),ke.publish("addGState",t),t}};m.addGState=function(e,t){return ei(e,t),this},m.saveGraphicsState=function(){return X("q"),be.push({key:ue,size:te,color:Gt}),this},m.restoreGraphicsState=function(){X("Q");var e=be.pop();return ue=e.key,te=e.size,Gt=e.color,je=null,this},m.setCurrentTransformationMatrix=function(e){return X(e.toString()+" cm"),this},m.comment=function(e){return X("#"+e),this};var ti=function(e,t){var i=e||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return i},set:function(e){isNaN(e)||(i=parseFloat(e))}});var a=t||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return a},set:function(e){isNaN(e)||(a=parseFloat(e))}});var s="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return s},set:function(e){s=e.toString()}}),this},ii=function(e,t,i,a){ti.call(this,e,t),this.type="rect";var s=i||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return s},set:function(e){isNaN(e)||(s=parseFloat(e))}});var r=a||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return r},set:function(e){isNaN(e)||(r=parseFloat(e))}}),this},ai=function(){this.page=Se,this.currentPage=R,this.pages=V.slice(0),this.pagesContext=_e.slice(0),this.x=me,this.y=pe,this.matrix=fe,this.width=ni(R),this.height=li(R),this.outputDestination=Y,this.id="",this.objectNumber=-1};ai.prototype.restore=function(){Se=this.page,R=this.currentPage,_e=this.pagesContext,V=this.pages,me=this.x,pe=this.y,fe=this.matrix,oi(R,this.width),ci(R,this.height),Y=this.outputDestination};var si=function(e,t,i,a,s){Ee.push(new ai),Se=R=0,V=[],me=e,pe=t,fe=s,at([i,a])};for(var ri in m.beginFormObject=function(e,t,i,a,s){return si(e,t,i,a,s),this},m.endFormObject=function(e){return function(e){if(ze[e])Ee.pop().restore();else{var t=new ai,i="Xo"+(Object.keys(Ae).length+1).toString(10);t.id=i,ze[e]=i,Ae[i]=t,ke.publish("addFormObject",t),Ee.pop().restore()}}(e),this},m.doFormObject=function(e,t){var i=Ae[ze[e]];return X("q"),X(t.toString()+" cm"),X("/"+i.id+" Do"),X("Q"),this},m.getFormObject=function(e){var t=Ae[ze[e]];return{x:t.x,y:t.y,width:t.width,height:t.height,matrix:t.matrix}},m.save=function(e,t){return e=e||"generated.pdf",(t=t||{}).returnPromise=t.returnPromise||!1,!1===t.returnPromise?(DM(ft(pt()),e),"function"==typeof DM.unload&&PM.setTimeout&&setTimeout(DM.unload,911),this):new Promise(function(t,i){try{var a=DM(ft(pt()),e);"function"==typeof DM.unload&&PM.setTimeout&&setTimeout(DM.unload,911),t(a)}catch(s){i(s.message)}})},uL.API)uL.API.hasOwnProperty(ri)&&("events"===ri&&uL.API.events.length?function(e,t){var i,a,s;for(s=t.length-1;-1!==s;s--)i=t[s][0],a=t[s][1],e.subscribe.apply(e,[i].concat("function"==typeof a?[a]:a))}(ke,uL.API.events):m[ri]=uL.API[ri]);function ni(e){return _e[e].mediaBox.topRightX-_e[e].mediaBox.bottomLeftX}function oi(e,t){_e[e].mediaBox.topRightX=t+_e[e].mediaBox.bottomLeftX}function li(e){return _e[e].mediaBox.topRightY-_e[e].mediaBox.bottomLeftY}function ci(e,t){_e[e].mediaBox.topRightY=t+_e[e].mediaBox.bottomLeftY}var di=m.getPageWidth=function(e){return ni(e=e||R)/he},ui=m.setPageWidth=function(e,t){oi(e,t*he)},hi=m.getPageHeight=function(e){return li(e=e||R)/he},mi=m.setPageHeight=function(e,t){ci(e,t*he)};return m.internal={pdfEscape:it,getStyle:St,getFont:Mt,getFontSize:ae,getCharSpace:Xt,getTextColor:Yt,getLineHeight:Rt,getLineHeightFactor:Ut,getLineWidth:Ot,write:J,getHorizontalCoordinate:qt,getVerticalCoordinate:$t,getCoordinateString:Wt,getVerticalCoordinateString:Ht,collections:{},newObject:Fe,newAdditionalObject:Re,newObjectDeferred:Oe,newObjectDeferredBegin:De,getFilters:We,putStream:He,events:ke,scaleFactor:he,pageSize:{getWidth:function(){return di(R)},setWidth:function(e){ui(R,e)},getHeight:function(){return hi(R)},setHeight:function(e){mi(R,e)}},encryptionOptions:d,encryption:bt,getEncryptor:function(e){return null!==d?bt.encryptor(e,0):function(e){return e}},output:gt,getNumberOfPages:ot,pages:V,out:X,f2:C,f3:A,getPageInfo:vt,getPageInfoByObjId:yt,getCurrentPageInfo:wt,getPDFVersion:f,Point:ti,Rectangle:ii,Matrix:Ie,hasHotfix:xt},Object.defineProperty(m.internal.pageSize,"width",{get:function(){return di(R)},set:function(e){ui(R,e)},enumerable:!0,configurable:!0}),Object.defineProperty(m.internal.pageSize,"height",{get:function(){return hi(R)},set:function(e){mi(R,e)},enumerable:!0,configurable:!0}),function(e){for(var t=0,i=ee.length;t<i;t++){var a=tt.call(this,e[t][0],e[t][1],e[t][2],ee[t][3],!0);!1===u&&(h[a]=!0);var s=e[t][0].split("-");et({id:a,fontName:s[0],fontStyle:s[1]||""})}ke.publish("addFonts",{fonts:ge,dictionary:xe})}.call(m,ee),ue="F1",st(s,i),ke.publish("initialized"),m}sL.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},sL.prototype.toHexString=function(e){return e.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},sL.prototype.hexToBytes=function(e){for(var t=[],i=0;i<e.length;i+=2)t.push(String.fromCharCode(parseInt(e.substr(i,2),16)));return t.join("")},sL.prototype.processOwnerPassword=function(e,t){return iL(QM(t).substr(0,5),e)},sL.prototype.encryptor=function(e,t){var i=QM(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(e){return iL(i,e)}},oL.prototype.equals=function(e){var t,i="id,objectNumber,equals";if(!e||II(e)!==II(this))return!1;var a=0;for(t in this)if(!(i.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t))return!1;if(this[t]!==e[t])return!1;a++}for(t in e)e.hasOwnProperty(t)&&i.indexOf(t)<0&&a--;return 0===a},uL.API={events:[]},uL.version="3.0.3";var hL=uL.API,mL=1,pL=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},fL=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},gL=function(e){return e.toFixed(2)},xL=function(e){return e.toFixed(5)};hL.__acroform__={};var bL=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},vL=function(e){return e*mL},yL=function(e){var t=new FL,i=KL.internal.getHeight(e)||0,a=KL.internal.getWidth(e)||0;return t.BBox=[0,0,Number(gL(a)),Number(gL(i))],t},wL=hL.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},NL=hL.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},jL=hL.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},SL=hL.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return jL(e,t-1)},_L=hL.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return wL(e,t-1)},kL=hL.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return NL(e,t-1)},CL=hL.__acroform__.calculateCoordinates=function(e,t){var i=t.internal.getHorizontalCoordinate,a=t.internal.getVerticalCoordinate,s=e[0],r=e[1],n=e[2],o=e[3],l={};return l.lowerLeft_X=i(s)||0,l.lowerLeft_Y=a(r+o)||0,l.upperRight_X=i(s+n)||0,l.upperRight_Y=a(r)||0,[Number(gL(l.lowerLeft_X)),Number(gL(l.lowerLeft_Y)),Number(gL(l.upperRight_X)),Number(gL(l.upperRight_Y))]},AL=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],i=e._V||e.DV,a=zL(e,i),s=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+s+" "+gL(a.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(a.text),t.push("ET"),t.push("Q"),t.push("EMC");var r=yL(e);return r.scope=e.scope,r.stream=t.join("\n"),r}},zL=function(e,t){var i=0===e.fontSize?e.maxFontSize:e.fontSize,a={text:"",fontSize:""},s=(t=")"==(t="("==t.substr(0,1)?t.substr(1):t).substr(t.length-1)?t.substr(0,t.length-1):t).split(" ");s=e.multiline?s.map(function(e){return e.split("\n")}):s.map(function(e){return[e]});var r=i,n=KL.internal.getHeight(e)||0;n=n<0?-n:n;var o=KL.internal.getWidth(e)||0;o=o<0?-o:o;var l=function(t,i,a){if(t+1<s.length){var r=i+" "+s[t+1][0];return EL(r,e,a).width<=o-4}return!1};r++;e:for(;r>0;){t="",r--;var c,d,u=EL("3",e,r).height,h=e.multiline?n-r:(n-u)/2,m=h+=2,p=0,f=0,g=0;if(r<=0){t="(...) Tj\n",t+="% Width of Text: "+EL(t,e,r=12).width+", FieldWidth:"+o+"\n";break}for(var x="",b=0,v=0;v<s.length;v++)if(s.hasOwnProperty(v)){var y=!1;if(1!==s[v].length&&g!==s[v].length-1){if((u+2)*(b+2)+2>n)continue e;x+=s[v][g],y=!0,f=v,v--}else{x=" "==(x+=s[v][g]+" ").substr(x.length-1)?x.substr(0,x.length-1):x;var w=parseInt(v),N=l(w,x,r),j=v>=s.length-1;if(N&&!j){x+=" ",g=0;continue}if(N||j){if(j)f=w;else if(e.multiline&&(u+2)*(b+2)+2>n)continue e}else{if(!e.multiline)continue e;if((u+2)*(b+2)+2>n)continue e;f=w}}for(var S="",_=p;_<=f;_++){var k=s[_];if(e.multiline){if(_===f){S+=k[g]+" ",g=(g+1)%k.length;continue}if(_===p){S+=k[k.length-1]+" ";continue}}S+=k[0]+" "}switch(S=" "==S.substr(S.length-1)?S.substr(0,S.length-1):S,d=EL(S,e,r).width,e.textAlign){case"right":c=o-d-2;break;case"center":c=(o-d)/2;break;default:c=2}t+=gL(c)+" "+gL(m)+" Td\n",t+="("+pL(S)+") Tj\n",t+=-gL(c)+" 0 Td\n",m=-(r+2),d=0,p=y?f:f+1,b++,x=""}break}return a.text=t,a.fontSize=r,a},EL=function(e,t,i){var a=t.scope.internal.getFont(t.fontName,t.fontStyle),s=t.scope.getStringUnitWidth(e,{font:a,fontSize:parseFloat(i),charSpace:0})*parseFloat(i);return{height:t.scope.getStringUnitWidth("3",{font:a,fontSize:parseFloat(i),charSpace:0})*parseFloat(i)*1.5,width:s}},IL={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},PL=function(e,t){var i={type:"reference",object:e};void 0===t.internal.getPageInfo(e.page).pageContext.annotations.find(function(e){return e.type===i.type&&e.object===i.object})&&t.internal.getPageInfo(e.page).pageContext.annotations.push(i)},TL=hL.__acroform__.arrayToPdfArray=function(e,t,i){var a=function(e){return e};if(Array.isArray(e)){for(var s="[",r=0;r<e.length;r++)switch(0!==r&&(s+=" "),II(e[r])){case"boolean":case"number":case"object":s+=e[r].toString();break;case"string":"/"!==e[r].substr(0,1)?(void 0!==t&&i&&(a=i.internal.getEncryptor(t)),s+="("+pL(a(e[r].toString()))+")"):s+=e[r].toString()}return s+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},ML=function(e,t,i){var a=function(e){return e};return void 0!==t&&i&&(a=i.internal.getEncryptor(t)),(e=e||"").toString(),"("+pL(a(e))+")"},LL=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};LL.prototype.toString=function(){return this.objId+" 0 R"},LL.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},LL.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(e){return"content"!=e&&"appearanceStreamContent"!=e&&"scope"!=e&&"objId"!=e&&"_"!=e.substring(0,1)});for(var i in t)if(!1===Object.getOwnPropertyDescriptor(this,t[i]).configurable){var a=t[i],s=this[a];s&&(Array.isArray(s)?e.push({key:a,value:TL(s,this.objId,this.scope)}):s instanceof LL?(s.scope=this.scope,e.push({key:a,value:s.objId+" 0 R"})):"function"!=typeof s&&e.push({key:a,value:s}))}return e};var FL=function(){LL.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){e=t.trim()},get:function(){return e||null}})};bL(FL,LL);var OL=function(){LL.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+pL(t(e))+")"}},set:function(t){e=t}})};bL(OL,LL);var DL=function e(){LL.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute F supplied.');t=e}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(t,3))},set:function(e){!0===Boolean(e)?this.F=_L(t,3):this.F=kL(t,3)}});var i=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return i},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute Ff supplied.');i=e}});var a=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==a.length)return a},set:function(e){a=void 0!==e?e:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[0])?0:a[0]},set:function(e){a[0]=e}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[1])?0:a[1]},set:function(e){a[1]=e}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[2])?0:a[2]},set:function(e){a[2]=e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!a||isNaN(a[3])?0:a[3]},set:function(e){a[3]=e}});var s="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return s},set:function(e){switch(e){case"/Btn":case"/Tx":case"/Ch":case"/Sig":s=e;break;default:throw new Error('Invalid value "'+e+'" for attribute FT supplied.')}}});var r=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!r||r.length<1){if(this instanceof ZL)return;r="FieldObject"+e.FieldNum++}var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+pL(t(r))+")"},set:function(e){r=e.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return r},set:function(e){r=e}});var n="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){n=e}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(e){o=e}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(e){l=e}});var c=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===c?50/mL:c},set:function(e){c=e}});var d="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return d},set:function(e){d=e}});var u="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!u||this instanceof ZL||this instanceof GL))return ML(u,this.objId,this.scope)},set:function(e){e=e.toString(),u=e}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof $L==0?ML(h,this.objId,this.scope):h},set:function(e){e=e.toString(),h=this instanceof $L==0?"("===e.substr(0,1)?fL(e.substr(1,e.length-2)):fL(e):e}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof $L==1?fL(h.substr(1,h.length-1)):h},set:function(e){e=e.toString(),h=this instanceof $L==1?"/"+e:e}});var m=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(m)return m},set:function(e){this.V=e}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof $L==0?ML(m,this.objId,this.scope):m},set:function(e){e=e.toString(),m=this instanceof $L==0?"("===e.substr(0,1)?fL(e.substr(1,e.length-2)):fL(e):e}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof $L==1?fL(m.substr(1,m.length-1)):m},set:function(e){e=e.toString(),m=this instanceof $L==1?"/"+e:e}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var p,f=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return f},set:function(e){e=Boolean(e),f=e}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(p)return p},set:function(e){p=e}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,1))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,1):this.Ff=kL(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,2))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,2):this.Ff=kL(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,3))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,3):this.Ff=kL(this.Ff,3)}});var g=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==g)return g},set:function(e){if(-1===[0,1,2].indexOf(e))throw new Error('Invalid value "'+e+'" for attribute Q supplied.');g=e}}),Object.defineProperty(this,"textAlign",{get:function(){var e;switch(g){case 0:default:e="left";break;case 1:e="center";break;case 2:e="right"}return e},configurable:!0,enumerable:!0,set:function(e){switch(e){case"right":case 2:g=2;break;case"center":case 1:g=1;break;default:g=0}}})};bL(DL,LL);var RL=function(){DL.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){e=t}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return TL(t,this.objId,this.scope)},set:function(e){var i,a;a=[],"string"==typeof(i=e)&&(a=function(e,t,i){i||(i=1);for(var a,s=[];a=t.exec(e);)s.push(a[i]);return s}(i,/\((.*?)\)/g)),t=a}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,i){for(i=i||!1,e=(e=e||"").toString();-1!==t.indexOf(e)&&(t.splice(t.indexOf(e),1),!1!==i););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,18))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,18):this.Ff=kL(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,19))},set:function(e){!0===this.combo&&(!0===Boolean(e)?this.Ff=_L(this.Ff,19):this.Ff=kL(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,20))},set:function(e){!0===Boolean(e)?(this.Ff=_L(this.Ff,20),t.sort()):this.Ff=kL(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,22))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,22):this.Ff=kL(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,23):this.Ff=kL(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,27))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,27):this.Ff=kL(this.Ff,27)}}),this.hasAppearanceStream=!1};bL(RL,DL);var BL=function(){RL.call(this),this.fontName="helvetica",this.combo=!1};bL(BL,RL);var UL=function(){BL.call(this),this.combo=!0};bL(UL,BL);var qL=function(){UL.call(this),this.edit=!0};bL(qL,UL);var $L=function(){DL.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,15))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,15):this.Ff=kL(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,16))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,16):this.Ff=kL(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,17))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,17):this.Ff=kL(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,26):this.Ff=kL(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(t).length){var i,a=[];for(i in a.push("<<"),t)a.push("/"+i+" ("+pL(e(t[i]))+")");return a.push(">>"),a.join("\n")}},set:function(e){"object"===II(e)&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){"string"==typeof e&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(t){e="/"+t}})};bL($L,DL);var WL=function(){$L.call(this),this.pushButton=!0};bL(WL,$L);var HL=function(){$L.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=void 0!==t?t:[]}})};bL(HL,$L);var ZL=function(){var e,t;DL.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(e){t=e}});var i,a={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};this.scope&&(e=this.scope.internal.getEncryptor(this.objId));var t,i=[];for(t in i.push("<<"),a)i.push("/"+t+" ("+pL(e(a[t]))+")");return i.push(">>"),i.join("\n")},set:function(e){"object"===II(e)&&(a=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return a.CA||""},set:function(e){"string"==typeof e&&(a.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(e){i="/"+e}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=KL.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};bL(ZL,DL),HL.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var i=this.Kids[t];i.appearanceStreamContent=e.createAppearanceStream(i.optionName),i.caption=e.getCA()}},HL.prototype.createOption=function(e){var t=new ZL;return t.Parent=this,t.optionName=e,this.Kids.push(t),QL.call(this.scope,t),t};var VL=function(){$L.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=KL.CheckBox.createAppearanceStream()};bL(VL,$L);var GL=function(){DL.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,13))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,13):this.Ff=kL(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,21))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,21):this.Ff=kL(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,23):this.Ff=kL(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,24))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,24):this.Ff=kL(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,25))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,25):this.Ff=kL(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,26):this.Ff=kL(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};bL(GL,DL);var YL=function(){GL.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(SL(this.Ff,14))},set:function(e){!0===Boolean(e)?this.Ff=_L(this.Ff,14):this.Ff=kL(this.Ff,14)}}),this.password=!0};bL(YL,GL);var KL={CheckBox:{createAppearanceStream:function(){return{N:{On:KL.CheckBox.YesNormal},D:{On:KL.CheckBox.YesPushDown,Off:KL.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=yL(e);t.scope=e.scope;var i=[],a=e.scope.internal.getFont(e.fontName,e.fontStyle).id,s=e.scope.__private__.encodeColorString(e.color),r=zL(e,e.caption);return i.push("0.749023 g"),i.push("0 0 "+gL(KL.internal.getWidth(e))+" "+gL(KL.internal.getHeight(e))+" re"),i.push("f"),i.push("BMC"),i.push("q"),i.push("0 0 1 rg"),i.push("/"+a+" "+gL(r.fontSize)+" Tf "+s),i.push("BT"),i.push(r.text),i.push("ET"),i.push("Q"),i.push("EMC"),t.stream=i.join("\n"),t},YesNormal:function(e){var t=yL(e);t.scope=e.scope;var i=e.scope.internal.getFont(e.fontName,e.fontStyle).id,a=e.scope.__private__.encodeColorString(e.color),s=[],r=KL.internal.getHeight(e),n=KL.internal.getWidth(e),o=zL(e,e.caption);return s.push("1 g"),s.push("0 0 "+gL(n)+" "+gL(r)+" re"),s.push("f"),s.push("q"),s.push("0 0 1 rg"),s.push("0 0 "+gL(n-1)+" "+gL(r-1)+" re"),s.push("W"),s.push("n"),s.push("0 g"),s.push("BT"),s.push("/"+i+" "+gL(o.fontSize)+" Tf "+a),s.push(o.text),s.push("ET"),s.push("Q"),t.stream=s.join("\n"),t},OffPushDown:function(e){var t=yL(e);t.scope=e.scope;var i=[];return i.push("0.749023 g"),i.push("0 0 "+gL(KL.internal.getWidth(e))+" "+gL(KL.internal.getHeight(e))+" re"),i.push("f"),t.stream=i.join("\n"),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:KL.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=KL.RadioButton.Circle.YesNormal,t.D[e]=KL.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=yL(e);t.scope=e.scope;var i=[],a=KL.internal.getWidth(e)<=KL.internal.getHeight(e)?KL.internal.getWidth(e)/4:KL.internal.getHeight(e)/4;a=Number((.9*a).toFixed(5));var s=KL.internal.Bezier_C,r=Number((a*s).toFixed(5));return i.push("q"),i.push("1 0 0 1 "+xL(KL.internal.getWidth(e)/2)+" "+xL(KL.internal.getHeight(e)/2)+" cm"),i.push(a+" 0 m"),i.push(a+" "+r+" "+r+" "+a+" 0 "+a+" c"),i.push("-"+r+" "+a+" -"+a+" "+r+" -"+a+" 0 c"),i.push("-"+a+" -"+r+" -"+r+" -"+a+" 0 -"+a+" c"),i.push(r+" -"+a+" "+a+" -"+r+" "+a+" 0 c"),i.push("f"),i.push("Q"),t.stream=i.join("\n"),t},YesPushDown:function(e){var t=yL(e);t.scope=e.scope;var i=[],a=KL.internal.getWidth(e)<=KL.internal.getHeight(e)?KL.internal.getWidth(e)/4:KL.internal.getHeight(e)/4;a=Number((.9*a).toFixed(5));var s=Number((2*a).toFixed(5)),r=Number((s*KL.internal.Bezier_C).toFixed(5)),n=Number((a*KL.internal.Bezier_C).toFixed(5));return i.push("0.749023 g"),i.push("q"),i.push("1 0 0 1 "+xL(KL.internal.getWidth(e)/2)+" "+xL(KL.internal.getHeight(e)/2)+" cm"),i.push(s+" 0 m"),i.push(s+" "+r+" "+r+" "+s+" 0 "+s+" c"),i.push("-"+r+" "+s+" -"+s+" "+r+" -"+s+" 0 c"),i.push("-"+s+" -"+r+" -"+r+" -"+s+" 0 -"+s+" c"),i.push(r+" -"+s+" "+s+" -"+r+" "+s+" 0 c"),i.push("f"),i.push("Q"),i.push("0 g"),i.push("q"),i.push("1 0 0 1 "+xL(KL.internal.getWidth(e)/2)+" "+xL(KL.internal.getHeight(e)/2)+" cm"),i.push(a+" 0 m"),i.push(a+" "+n+" "+n+" "+a+" 0 "+a+" c"),i.push("-"+n+" "+a+" -"+a+" "+n+" -"+a+" 0 c"),i.push("-"+a+" -"+n+" -"+n+" -"+a+" 0 -"+a+" c"),i.push(n+" -"+a+" "+a+" -"+n+" "+a+" 0 c"),i.push("f"),i.push("Q"),t.stream=i.join("\n"),t},OffPushDown:function(e){var t=yL(e);t.scope=e.scope;var i=[],a=KL.internal.getWidth(e)<=KL.internal.getHeight(e)?KL.internal.getWidth(e)/4:KL.internal.getHeight(e)/4;a=Number((.9*a).toFixed(5));var s=Number((2*a).toFixed(5)),r=Number((s*KL.internal.Bezier_C).toFixed(5));return i.push("0.749023 g"),i.push("q"),i.push("1 0 0 1 "+xL(KL.internal.getWidth(e)/2)+" "+xL(KL.internal.getHeight(e)/2)+" cm"),i.push(s+" 0 m"),i.push(s+" "+r+" "+r+" "+s+" 0 "+s+" c"),i.push("-"+r+" "+s+" -"+s+" "+r+" -"+s+" 0 c"),i.push("-"+s+" -"+r+" -"+r+" -"+s+" 0 -"+s+" c"),i.push(r+" -"+s+" "+s+" -"+r+" "+s+" 0 c"),i.push("f"),i.push("Q"),t.stream=i.join("\n"),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:KL.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=KL.RadioButton.Cross.YesNormal,t.D[e]=KL.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=yL(e);t.scope=e.scope;var i=[],a=KL.internal.calculateCross(e);return i.push("q"),i.push("1 1 "+gL(KL.internal.getWidth(e)-2)+" "+gL(KL.internal.getHeight(e)-2)+" re"),i.push("W"),i.push("n"),i.push(gL(a.x1.x)+" "+gL(a.x1.y)+" m"),i.push(gL(a.x2.x)+" "+gL(a.x2.y)+" l"),i.push(gL(a.x4.x)+" "+gL(a.x4.y)+" m"),i.push(gL(a.x3.x)+" "+gL(a.x3.y)+" l"),i.push("s"),i.push("Q"),t.stream=i.join("\n"),t},YesPushDown:function(e){var t=yL(e);t.scope=e.scope;var i=KL.internal.calculateCross(e),a=[];return a.push("0.749023 g"),a.push("0 0 "+gL(KL.internal.getWidth(e))+" "+gL(KL.internal.getHeight(e))+" re"),a.push("f"),a.push("q"),a.push("1 1 "+gL(KL.internal.getWidth(e)-2)+" "+gL(KL.internal.getHeight(e)-2)+" re"),a.push("W"),a.push("n"),a.push(gL(i.x1.x)+" "+gL(i.x1.y)+" m"),a.push(gL(i.x2.x)+" "+gL(i.x2.y)+" l"),a.push(gL(i.x4.x)+" "+gL(i.x4.y)+" m"),a.push(gL(i.x3.x)+" "+gL(i.x3.y)+" l"),a.push("s"),a.push("Q"),t.stream=a.join("\n"),t},OffPushDown:function(e){var t=yL(e);t.scope=e.scope;var i=[];return i.push("0.749023 g"),i.push("0 0 "+gL(KL.internal.getWidth(e))+" "+gL(KL.internal.getHeight(e))+" re"),i.push("f"),t.stream=i.join("\n"),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,i=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+i}};KL.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=KL.internal.getWidth(e),i=KL.internal.getHeight(e),a=Math.min(t,i);return{x1:{x:(t-a)/2,y:(i-a)/2+a},x2:{x:(t-a)/2+a,y:(i-a)/2},x3:{x:(t-a)/2,y:(i-a)/2},x4:{x:(t-a)/2+a,y:(i-a)/2+a}}}},KL.internal.getWidth=function(e){var t=0;return"object"===II(e)&&(t=vL(e.Rect[2])),t},KL.internal.getHeight=function(e){var t=0;return"object"===II(e)&&(t=vL(e.Rect[3])),t};var XL,JL,QL=hL.addField=function(e){if(function(e,t){if(t.scope=e,void 0!==e.internal&&(void 0===e.internal.acroformPlugin||!1===e.internal.acroformPlugin.isInitialized)){if(DL.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(IL)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");mL=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new OL,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){var t;(t=e).internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0}),e.internal.events.subscribe("buildDocument",function(){!function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var t=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in t)if(t.hasOwnProperty(i)){var a=t[i];a.objId=void 0,a.hasAnnotation&&PL(a,e)}}(e)}),e.internal.events.subscribe("putCatalog",function(){!function(e){if(void 0===e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(e)}),e.internal.events.subscribe("postPutPages",function(t){!function(e,t){var i=!e;for(var a in e||(t.internal.newObjectDeferredBegin(t.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),t.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),e=e||t.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(e.hasOwnProperty(a)){var s=e[a],r=[],n=s.Rect;if(s.Rect&&(s.Rect=CL(s.Rect,t)),t.internal.newObjectDeferredBegin(s.objId,!0),s.DA=KL.createDefaultAppearanceStream(s),"object"===II(s)&&"function"==typeof s.getKeyValueListForStream&&(r=s.getKeyValueListForStream()),s.Rect=n,s.hasAppearanceStream&&!s.appearanceStreamContent){var o=AL(s);r.push({key:"AP",value:"<</N "+o+">>"}),t.internal.acroformPlugin.xForms.push(o)}if(s.appearanceStreamContent){var l="";for(var c in s.appearanceStreamContent)if(s.appearanceStreamContent.hasOwnProperty(c)){var d=s.appearanceStreamContent[c];if(l+="/"+c+" ",l+="<<",Object.keys(d).length>=1||Array.isArray(d)){for(var a in d)if(d.hasOwnProperty(a)){var u=d[a];"function"==typeof u&&(u=u.call(t,s)),l+="/"+a+" "+u+" ",t.internal.acroformPlugin.xForms.indexOf(u)>=0||t.internal.acroformPlugin.xForms.push(u)}}else"function"==typeof(u=d)&&(u=u.call(t,s)),l+="/"+a+" "+u,t.internal.acroformPlugin.xForms.indexOf(u)>=0||t.internal.acroformPlugin.xForms.push(u);l+=">>"}r.push({key:"AP",value:"<<\n"+l+">>"})}t.internal.putStream({additionalKeyValues:r,objectId:s.objId}),t.internal.out("endobj")}i&&function(e,t){for(var i in e)if(e.hasOwnProperty(i)){var a=i,s=e[i];t.internal.newObjectDeferredBegin(s.objId,!0),"object"===II(s)&&"function"==typeof s.putStream&&s.putStream(),delete e[a]}}(t.internal.acroformPlugin.xForms,t)}(t,e)}),e.internal.acroformPlugin.isInitialized=!0}}(this,e),!(e instanceof DL))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};function eF(e){return e.reduce(function(e,t,i){return e[t]=i,e},{})}hL.AcroFormChoiceField=RL,hL.AcroFormListBox=BL,hL.AcroFormComboBox=UL,hL.AcroFormEditBox=qL,hL.AcroFormButton=$L,hL.AcroFormPushButton=WL,hL.AcroFormRadioButton=HL,hL.AcroFormCheckBox=VL,hL.AcroFormTextField=GL,hL.AcroFormPasswordField=YL,hL.AcroFormAppearance=KL,hL.AcroForm={ChoiceField:RL,ListBox:BL,ComboBox:UL,EditBox:qL,Button:$L,PushButton:WL,RadioButton:HL,CheckBox:VL,TextField:GL,PasswordField:YL,Appearance:KL},uL.AcroForm={ChoiceField:RL,ListBox:BL,ComboBox:UL,EditBox:qL,Button:$L,PushButton:WL,RadioButton:HL,CheckBox:VL,TextField:GL,PasswordField:YL,Appearance:KL},uL.AcroForm,function(e){var t="addImage_";e.__addimage__={};var i="UNKNOWN",a={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},s=e.__addimage__.getImageFileTypeByImageData=function(e,t){var s,r,n,o,l,c=i;if("RGBA"===(t=t||i)||void 0!==e.data&&e.data instanceof Uint8ClampedArray&&"height"in e&&"width"in e)return"RGBA";if(N(e))for(l in a)for(n=a[l],s=0;s<n.length;s+=1){for(o=!0,r=0;r<n[s].length;r+=1)if(void 0!==n[s][r]&&n[s][r]!==e[r]){o=!1;break}if(!0===o){c=l;break}}else for(l in a)for(n=a[l],s=0;s<n.length;s+=1){for(o=!0,r=0;r<n[s].length;r+=1)if(void 0!==n[s][r]&&n[s][r]!==e.charCodeAt(r)){o=!1;break}if(!0===o){c=l;break}}return c===i&&t!==i&&(c=t),c},r=function e(t){for(var i=this.internal.write,a=this.internal.putStream,s=(0,this.internal.getFilters)();-1!==s.indexOf("FlateEncode");)s.splice(s.indexOf("FlateEncode"),1);t.objectId=this.internal.newObject();var r=[];if(r.push({key:"Type",value:"/XObject"}),r.push({key:"Subtype",value:"/Image"}),r.push({key:"Width",value:t.width}),r.push({key:"Height",value:t.height}),t.colorSpace===x.INDEXED?r.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(t.palette.length/3-1)+" "+("sMask"in t&&void 0!==t.sMask?t.objectId+2:t.objectId+1)+" 0 R]"}):(r.push({key:"ColorSpace",value:"/"+t.colorSpace}),t.colorSpace===x.DEVICE_CMYK&&r.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),r.push({key:"BitsPerComponent",value:t.bitsPerComponent}),"decodeParameters"in t&&void 0!==t.decodeParameters&&r.push({key:"DecodeParms",value:"<<"+t.decodeParameters+">>"}),"transparency"in t&&Array.isArray(t.transparency)&&t.transparency.length>0){for(var n="",o=0,l=t.transparency.length;o<l;o++)n+=t.transparency[o]+" "+t.transparency[o]+" ";r.push({key:"Mask",value:"["+n+"]"})}void 0!==t.sMask&&r.push({key:"SMask",value:t.objectId+1+" 0 R"});var c=void 0!==t.filter?["/"+t.filter]:void 0;if(a({data:t.data,additionalKeyValues:r,alreadyAppliedFilters:c,objectId:t.objectId}),i("endobj"),"sMask"in t&&void 0!==t.sMask){var d,u=null!==(d=t.sMaskBitsPerComponent)&&void 0!==d?d:t.bitsPerComponent,h={width:t.width,height:t.height,colorSpace:"DeviceGray",bitsPerComponent:u,data:t.sMask};"filter"in t&&(h.decodeParameters="/Predictor ".concat(t.predictor," /Colors 1 /BitsPerComponent ").concat(u," /Columns ").concat(t.width),h.filter=t.filter),e.call(this,h)}if(t.colorSpace===x.INDEXED){var m=this.internal.newObject();a({data:S(new Uint8Array(t.palette)),objectId:m}),i("endobj")}},n=function(){var e=this.internal.collections[t+"images"];for(var i in e)r.call(this,e[i])},o=function(){var e,i=this.internal.collections[t+"images"],a=this.internal.write;for(var s in i)a("/I"+(e=i[s]).index,e.objectId,"0","R")},l=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",n),this.internal.events.subscribe("putXobjectDict",o))},c=function(){var e=this.internal.collections[t+"images"];return l.call(this),e},d=function(){return Object.keys(this.internal.collections[t+"images"]).length},u=function(t){return"function"==typeof e["process"+t.toUpperCase()]},h=function(e){return"object"===II(e)&&1===e.nodeType},m=function(t,i){if("IMG"===t.nodeName&&t.hasAttribute("src")){var a=""+t.getAttribute("src");if(0===a.indexOf("data:image/"))return BM(unescape(a).split("base64,").pop());var s=e.loadFile(a,!0);if(void 0!==s)return s}if("CANVAS"===t.nodeName){if(0===t.width||0===t.height)throw new Error("Given canvas must have data. Canvas width: "+t.width+", height: "+t.height);var r;switch(i){case"PNG":r="image/png";break;case"WEBP":r="image/webp";break;default:r="image/jpeg"}return BM(t.toDataURL(r,1).split("base64,").pop())}},p=function(e){var i=this.internal.collections[t+"images"];if(i)for(var a in i)if(e===i[a].alias)return i[a]},f=function(e,t,i){return e||t||(e=-96,t=-96),e<0&&(e=-1*i.width*72/e/this.internal.scaleFactor),t<0&&(t=-1*i.height*72/t/this.internal.scaleFactor),0===e&&(e=t*i.width/i.height),0===t&&(t=e*i.height/i.width),[e,t]},g=function(e,t,i,a,s,r){var n=f.call(this,i,a,s),o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,d=c.call(this);if(i=n[0],a=n[1],d[s.index]=s,r){r*=Math.PI/180;var u=Math.cos(r),h=Math.sin(r),m=function(e){return e.toFixed(4)},p=[m(u),m(h),m(-1*h),m(u),0,0,"cm"]}this.internal.write("q"),r?(this.internal.write([1,"0","0",1,o(e),l(t+a),"cm"].join(" ")),this.internal.write(p.join(" ")),this.internal.write([o(i),"0","0",o(a),"0","0","cm"].join(" "))):this.internal.write([o(i),"0","0",o(a),o(e),l(t+a),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+s.index+" Do"),this.internal.write("Q")},x=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var b=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},v=e.__addimage__.sHashCode=function(e){var t,i,a=0;if("string"==typeof e)for(i=e.length,t=0;t<i;t++)a=(a<<5)-a+e.charCodeAt(t),a|=0;else if(N(e))for(i=e.byteLength/2,t=0;t<i;t++)a=(a<<5)-a+e[t],a|=0;return a},y=e.__addimage__.validateStringAsBase64=function(e){(e=e||"").toString().trim();var t=!0;return 0===e.length&&(t=!1),e.length%4!=0&&(t=!1),!1===/^[A-Za-z0-9+/]+$/.test(e.substr(0,e.length-2))&&(t=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(e.substr(-2))&&(t=!1),t},w=e.__addimage__.extractImageFromDataUrl=function(e){if(null==e)return null;if(!(e=e.trim()).startsWith("data:"))return null;var t=e.indexOf(",");return t<0?null:e.substring(0,t).trim().endsWith("base64")?e.substring(t+1):null};e.__addimage__.isArrayBuffer=function(e){return e instanceof ArrayBuffer};var N=e.__addimage__.isArrayBufferView=function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array},j=e.__addimage__.binaryStringToUint8Array=function(e){for(var t=e.length,i=new Uint8Array(t),a=0;a<t;a++)i[a]=e.charCodeAt(a);return i},S=e.__addimage__.arrayBufferToBinaryString=function(e){for(var t="",i=N(e)?e:new Uint8Array(e),a=0;a<i.length;a+=8192)t+=String.fromCharCode.apply(null,i.subarray(a,a+8192));return t};e.addImage=function(){var e,t,a,s,r,n,o,c,d;if("number"==typeof arguments[1]?(t=i,a=arguments[1],s=arguments[2],r=arguments[3],n=arguments[4],o=arguments[5],c=arguments[6],d=arguments[7]):(t=arguments[1],a=arguments[2],s=arguments[3],r=arguments[4],n=arguments[5],o=arguments[6],c=arguments[7],d=arguments[8]),"object"===II(e=arguments[0])&&!h(e)&&"imageData"in e){var u=e;e=u.imageData,t=u.format||t||i,a=u.x||a||0,s=u.y||s||0,r=u.w||u.width||r,n=u.h||u.height||n,o=u.alias||o,c=u.compression||c,d=u.rotation||u.angle||d}var m=this.internal.getFilters();if(void 0===c&&-1!==m.indexOf("FlateEncode")&&(c="SLOW"),isNaN(a)||isNaN(s))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var p=_.call(this,e,t,o,c);return g.call(this,a,s,r,n,p,d),this};var _=function(t,a,r,n){var o,l,c,f;if("string"==typeof t&&s(t)===i){t=unescape(t);var g=k(t,!1);(""!==g||void 0!==(g=e.loadFile(t,!0)))&&(t=g)}if(h(t)&&(t=m(t,a)),a=s(t,a),!u(a))throw new Error("addImage does not support files of type '"+a+"', please ensure that a plugin for '"+a+"' support is added.");if((null==(c=r)||0===c.length)&&(r="string"==typeof(f=t)||N(f)?v(f):N(f.data)?v(f.data):null),(o=p.call(this,r))||(t instanceof Uint8Array||"RGBA"===a||(l=t,t=j(t)),o=this["process"+a.toUpperCase()](t,d.call(this),r,function(t){return t&&"string"==typeof t&&(t=t.toUpperCase()),t in e.image_compression?t:b.NONE}(n),l)),!o)throw new Error("An unknown error occurred whilst processing the image.");return o},k=e.__addimage__.convertBase64ToBinaryString=function(e,t){t="boolean"!=typeof t||t;var i,a="";if("string"==typeof e){var s;i=null!==(s=w(e))&&void 0!==s?s:e;try{a=BM(i)}catch(r){if(t)throw y(i)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+r.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return a};e.getImageProperties=function(t){var a,r,n="";if(h(t)&&(t=m(t)),"string"==typeof t&&s(t)===i&&(""===(n=k(t,!1))&&(n=e.loadFile(t)||""),t=n),r=s(t),!u(r))throw new Error("addImage does not support files of type '"+r+"', please ensure that a plugin for '"+r+"' support is added.");if(t instanceof Uint8Array||(t=j(t)),!(a=this["process"+r.toUpperCase()](t)))throw new Error("An unknown error occurred whilst processing the image");return a.fileType=r,a}}(uL.API),XL=uL.API,JL=function(e){if(void 0!==e&&""!=e)return!0},uL.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),XL.events.push(["putPage",function(e){for(var t,i,a,s=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,n=this.internal.getPageInfoByObjId(e.objId),o=e.pageContext.annotations,l=!1,c=0;c<o.length&&!l;c++)switch((t=o[c]).type){case"link":(JL(t.options.url)||JL(t.options.pageNumber))&&(l=!0);break;case"reference":case"text":case"freetext":l=!0}if(0!=l){this.internal.write("/Annots [");for(var d=0;d<o.length;d++){t=o[d];var u=this.internal.pdfEscape,h=this.internal.getEncryptor(e.objId);switch(t.type){case"reference":this.internal.write(" "+t.object.objId+" 0 R ");break;case"text":var m=this.internal.newAdditionalObject(),p=this.internal.newAdditionalObject(),f=this.internal.getEncryptor(m.objId),g=t.title||"Note";a="<</Type /Annot /Subtype /Text "+(i="/Rect ["+s(t.bounds.x)+" "+r(t.bounds.y+t.bounds.h)+" "+s(t.bounds.x+t.bounds.w)+" "+r(t.bounds.y)+"] ")+"/Contents ("+u(f(t.contents))+")",a+=" /Popup "+p.objId+" 0 R",a+=" /P "+n.objId+" 0 R",a+=" /T ("+u(f(g))+") >>",m.content=a;var x=m.objId+" 0 R";a="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+s(t.bounds.x+30)+" "+r(t.bounds.y+t.bounds.h)+" "+s(t.bounds.x+t.bounds.w+30)+" "+r(t.bounds.y)+"] ")+" /Parent "+x,t.open&&(a+=" /Open true"),a+=" >>",p.content=a,this.internal.write(m.objId,"0 R",p.objId,"0 R");break;case"freetext":i="/Rect ["+s(t.bounds.x)+" "+r(t.bounds.y)+" "+s(t.bounds.x+t.bounds.w)+" "+r(t.bounds.y+t.bounds.h)+"] ";var b=t.color||"#000000";a="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+u(h(t.contents))+")",a+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+b+")",a+=" /Border [0 0 0]",a+=" >>",this.internal.write(a);break;case"link":if(t.options.name){var v=this.annotations._nameMap[t.options.name];t.options.pageNumber=v.page,t.options.top=v.y}else t.options.top||(t.options.top=0);if(i="/Rect ["+t.finalBounds.x+" "+t.finalBounds.y+" "+t.finalBounds.w+" "+t.finalBounds.h+"] ",a="",t.options.url)a="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+u(h(t.options.url))+") >>";else if(t.options.pageNumber)switch(a="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(t.options.pageNumber).objId+" 0 R",t.options.magFactor=t.options.magFactor||"XYZ",t.options.magFactor){case"Fit":a+=" /Fit]";break;case"FitH":a+=" /FitH "+t.options.top+"]";break;case"FitV":t.options.left=t.options.left||0,a+=" /FitV "+t.options.left+"]";break;default:var y=r(t.options.top);t.options.left=t.options.left||0,void 0===t.options.zoom&&(t.options.zoom=0),a+=" /XYZ "+t.options.left+" "+y+" "+t.options.zoom+"]"}""!=a&&(a+=" >>",this.internal.write(a))}}this.internal.write("]")}}]),XL.createAnnotation=function(e){var t=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":t.pageContext.annotations.push(e)}},XL.link=function(e,t,i,a,s){var r=this.internal.getCurrentPageInfo(),n=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString;r.pageContext.annotations.push({finalBounds:{x:n(e),y:o(t),w:n(e+i),h:o(t+a)},options:s,type:"link"})},XL.textWithLink=function(e,t,i,a){var s,r,n=this.getTextWidth(e),o=this.internal.getLineHeight()/this.internal.scaleFactor;if(void 0!==a.maxWidth){r=a.maxWidth;var l=this.splitTextToSize(e,r).length;s=Math.ceil(o*l)}else r=n,s=o;return this.text(e,t,i,a),i+=.2*o,"center"===a.align&&(t-=n/2),"right"===a.align&&(t-=n),this.link(t,i-o,r,s,a),n},XL.getTextWidth=function(e){var t=this.internal.getFontSize();return this.getStringUnitWidth(e)*t/this.internal.scaleFactor},function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},i={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},a={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},s=[1570,1571,1573,1575];e.__arabicParser__={};var r=e.__arabicParser__.isInArabicSubstitutionA=function(e){return void 0!==t[e.charCodeAt(0)]},n=e.__arabicParser__.isArabicLetter=function(e){return"string"==typeof e&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(e)},o=e.__arabicParser__.isArabicEndLetter=function(e){return n(e)&&r(e)&&t[e.charCodeAt(0)].length<=2},l=e.__arabicParser__.isArabicAlfLetter=function(e){return n(e)&&s.indexOf(e.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(e){return n(e)&&r(e)&&t[e.charCodeAt(0)].length>=1};var c=e.__arabicParser__.arabicLetterHasFinalForm=function(e){return n(e)&&r(e)&&t[e.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(e){return n(e)&&r(e)&&t[e.charCodeAt(0)].length>=3};var d=e.__arabicParser__.arabicLetterHasMedialForm=function(e){return n(e)&&r(e)&&4==t[e.charCodeAt(0)].length},u=e.__arabicParser__.resolveLigatures=function(e){var t=0,a=i,s="",r=0;for(t=0;t<e.length;t+=1)void 0!==a[e.charCodeAt(t)]?(r++,"number"==typeof(a=a[e.charCodeAt(t)])&&(s+=String.fromCharCode(a),a=i,r=0),t===e.length-1&&(a=i,s+=e.charAt(t-(r-1)),t-=r-1,r=0)):(a=i,s+=e.charAt(t-r),t-=r,r=0);return s};e.__arabicParser__.isArabicDiacritic=function(e){return void 0!==e&&void 0!==a[e.charCodeAt(0)]};var h=e.__arabicParser__.getCorrectForm=function(e,t,i){return n(e)?!1===r(e)?-1:!c(e)||!n(t)&&!n(i)||!n(i)&&o(t)||o(e)&&!n(t)||o(e)&&l(t)||o(e)&&o(t)?0:d(e)&&n(t)&&!o(t)&&n(i)&&c(i)?3:o(e)||!n(i)?1:2:-1},m=function(e){var i=0,a=0,s=0,r="",o="",l="",c=(e=e||"").split("\\s+"),d=[];for(i=0;i<c.length;i+=1){for(d.push(""),a=0;a<c[i].length;a+=1)r=c[i][a],o=c[i][a-1],l=c[i][a+1],n(r)?(s=h(r,o,l),d[i]+=-1!==s?String.fromCharCode(t[r.charCodeAt(0)][s]):r):d[i]+=r;d[i]=u(d[i])}return d.join(" ")},p=e.__arabicParser__.processArabic=e.processArabic=function(){var e,t="string"==typeof arguments[0]?arguments[0]:arguments[0].text,i=[];if(Array.isArray(t)){var a=0;for(i=[],a=0;a<t.length;a+=1)Array.isArray(t[a])?i.push([m(t[a][0]),t[a][1],t[a][2]]):i.push([m(t[a])]);e=i}else e=m(t);return"string"==typeof arguments[0]?e:(arguments[0].text=e,arguments[0])};e.events.push(["preProcessText",p])}(uL.API),uL.API.autoPrint=function(e){var t;return(e=e||{}).variant=e.variant||"non-conform","javascript"===e.variant?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},function(e){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(t){e=t}});var t=150;Object.defineProperty(this,"width",{get:function(){return t},set:function(e){t=isNaN(e)||!1===Number.isInteger(e)||e<0?150:e,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=t+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(e){i=isNaN(e)||!1===Number.isInteger(e)||e<0?300:e,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var a=[];Object.defineProperty(this,"childNodes",{get:function(){return a},set:function(e){a=e}});var s={};Object.defineProperty(this,"style",{get:function(){return s},set:function(e){s=e}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,t){var i;if("2d"!==(e=e||"2d"))return null;for(i in t)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=t[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(uL.API),function(e){var t={left:0,top:0,bottom:0,right:0},i=!1,a=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),s.call(this))},s=function(){this.internal.__cell__.lastCell=new r,this.internal.__cell__.pages=1},r=function(){var e=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var t=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var i=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return i},set:function(e){i=e}});var a=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return a},set:function(e){a=e}});var s=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return s},set:function(e){s=e}});var r=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return r},set:function(e){r=e}});var n=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return n},set:function(e){n=e}}),this};r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},r.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(e){return a.call(this),this.internal.__cell__.headerFunction="function"==typeof e?e:void 0,this},e.getTextDimensions=function(e,t){a.call(this);var i=(t=t||{}).fontSize||this.getFontSize(),s=t.font||this.getFont(),r=t.scaleFactor||this.internal.scaleFactor,n=0,o=0,l=0,c=this;if(!Array.isArray(e)&&"string"!=typeof e){if("number"!=typeof e)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");e=String(e)}var d=t.maxWidth;d>0?"string"==typeof e?e=this.splitTextToSize(e,d):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(c.splitTextToSize(t,d))},[])):e=Array.isArray(e)?e:[e];for(var u=0;u<e.length;u++)n<(l=this.getStringUnitWidth(e[u],{font:s})*i)&&(n=l);return 0!==n&&(o=e.length),{w:n/=r,h:Math.max((o*i*this.getLineHeightFactor()-i*(this.getLineHeightFactor()-1))/r,0)}},e.cellAddPage=function(){a.call(this),this.addPage();var e=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new r(e.left,e.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var n=e.cell=function(){var e;e=arguments[0]instanceof r?arguments[0]:new r(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),a.call(this);var s=this.internal.__cell__.lastCell,n=this.internal.__cell__.padding,o=this.internal.__cell__.margins||t,l=this.internal.__cell__.tableHeaderRow,c=this.internal.__cell__.printHeaders;return void 0!==s.lineNumber&&(s.lineNumber===e.lineNumber?(e.x=(s.x||0)+(s.width||0),e.y=s.y||0):s.y+s.height+e.height+o.bottom>this.getPageHeight()?(this.cellAddPage(),e.y=o.top,c&&l&&(this.printHeaderRow(e.lineNumber,!0),e.y+=l[0].height)):e.y=s.y+s.height||e.y),void 0!==e.text[0]&&(this.rect(e.x,e.y,e.width,e.height,!0===i?"FD":void 0),"right"===e.align?this.text(e.text,e.x+e.width-n,e.y+n,{align:"right",baseline:"top"}):"center"===e.align?this.text(e.text,e.x+e.width/2,e.y+n,{align:"center",baseline:"top",maxWidth:e.width-n-n}):this.text(e.text,e.x+n,e.y+n,{align:"left",baseline:"top",maxWidth:e.width-n-n})),this.internal.__cell__.lastCell=e,this};e.table=function(e,i,l,c,d){if(a.call(this),!l)throw new Error("No data for PDF table.");var u,h,m,p,f=[],g=[],x=[],b={},v={},y=[],w=[],N=(d=d||{}).autoSize||!1,j=!1!==d.printHeaders,S=d.css&&void 0!==d.css["font-size"]?16*d.css["font-size"]:d.fontSize||12,_=d.margins||Object.assign({width:this.getPageWidth()},t),k="number"==typeof d.padding?d.padding:3,C=d.headerBackgroundColor||"#c8c8c8",A=d.headerTextColor||"#000";if(s.call(this),this.internal.__cell__.printHeaders=j,this.internal.__cell__.margins=_,this.internal.__cell__.table_font_size=S,this.internal.__cell__.padding=k,this.internal.__cell__.headerBackgroundColor=C,this.internal.__cell__.headerTextColor=A,this.setFontSize(S),null==c)g=f=Object.keys(l[0]),x=f.map(function(){return"left"});else if(Array.isArray(c)&&"object"===II(c[0]))for(f=c.map(function(e){return e.name}),g=c.map(function(e){return e.prompt||e.name||""}),x=c.map(function(e){return e.align||"left"}),u=0;u<c.length;u+=1)v[c[u].name]=.7499990551181103*c[u].width;else Array.isArray(c)&&"string"==typeof c[0]&&(g=f=c,x=f.map(function(){return"left"}));if(N||Array.isArray(c)&&"string"==typeof c[0])for(u=0;u<f.length;u+=1){for(b[p=f[u]]=l.map(function(e){return e[p]}),this.setFont(void 0,"bold"),y.push(this.getTextDimensions(g[u],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),h=b[p],this.setFont(void 0,"normal"),m=0;m<h.length;m+=1)y.push(this.getTextDimensions(h[m],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);v[p]=Math.max.apply(null,y)+k+k,y=[]}if(j){var z={};for(u=0;u<f.length;u+=1)z[f[u]]={},z[f[u]].text=g[u],z[f[u]].align=x[u];var E=o.call(this,z,v);w=f.map(function(t){return new r(e,i,v[t],E,z[t].text,void 0,z[t].align)}),this.setTableHeaderRow(w),this.printHeaderRow(1,!1)}var I=c.reduce(function(e,t){return e[t.name]=t.align,e},{});for(u=0;u<l.length;u+=1){"rowStart"in d&&d.rowStart instanceof Function&&d.rowStart({row:u,data:l[u]},this);var P=o.call(this,l[u],v);for(m=0;m<f.length;m+=1){var T=l[u][f[m]];"cellStart"in d&&d.cellStart instanceof Function&&d.cellStart({row:u,col:m,data:T},this),n.call(this,new r(e,i,v[f[m]],P,T,u+2,I[f[m]]))}}return this.internal.__cell__.table_x=e,this.internal.__cell__.table_y=i,this};var o=function(e,t){var i=this.internal.__cell__.padding,a=this.internal.__cell__.table_font_size,s=this.internal.scaleFactor;return Object.keys(e).map(function(a){var s=e[a];return this.splitTextToSize(s.hasOwnProperty("text")?s.text:s,t[a]-i-i)},this).map(function(e){return this.getLineHeightFactor()*e.length*a/s+i+i},this).reduce(function(e,t){return Math.max(e,t)},0)};e.setTableHeaderRow=function(e){a.call(this),this.internal.__cell__.tableHeaderRow=e},e.printHeaderRow=function(e,t){if(a.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var s;if(i=!0,"function"==typeof this.internal.__cell__.headerFunction){var o=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new r(o[0],o[1],o[2],o[3],void 0,-1)}this.setFont(void 0,"bold");for(var l=[],c=0;c<this.internal.__cell__.tableHeaderRow.length;c+=1){s=this.internal.__cell__.tableHeaderRow[c].clone(),t&&(s.y=this.internal.__cell__.margins.top||0,l.push(s)),s.lineNumber=e;var d=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),n.call(this,s),this.setTextColor(d)}l.length>0&&this.setTableHeaderRow(l),this.setFont(void 0,"normal"),i=!1}}(uL.API);var tF={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},iF=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],aF=eF(iF),sF=[100,200,300,400,500,600,700,800,900],rF=eF(sF);function nF(e){var t,i=e.family.replace(/"|'/g,"").toLowerCase(),a=(t=e.style,tF[t=t||"normal"]?t:"normal"),s=function(e){return e?"number"==typeof e?e>=100&&e<=900&&e%100==0?e:400:/^\d00$/.test(e)?parseInt(e):"bold"===e?700:400:400}(e.weight),r=function(e){return"number"==typeof aF[e=e||"normal"]?e:"normal"}(e.stretch);return{family:i,style:a,weight:s,stretch:r,src:e.src||[],ref:e.ref||{name:i,style:[r,a,s].join(" ")}}}function oF(e,t,i,a){var s;for(s=i;s>=0&&s<t.length;s+=a)if(e[t[s]])return e[t[s]];for(s=i;s>=0&&s<t.length;s-=a)if(e[t[s]])return e[t[s]]}var lF={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},cF={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function dF(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function uF(e){return e.trimLeft()}function hF(e,t){for(var i=0;i<e.length;){if(e.charAt(i)===t)return[e.substring(0,i),e.substring(i+1)];i+=1}return null}function mF(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===t?null:[t[0],e.substring(t[0].length)]}var pF,fF,gF,xF,bF,vF,yF,wF,NF=["times"];function jF(e,t,i,a,s){var r=4,n=kF;switch(s){case uL.API.image_compression.FAST:r=1,n=_F;break;case uL.API.image_compression.MEDIUM:r=6,n=CF;break;case uL.API.image_compression.SLOW:r=9,n=AF}e=function(e,t,i,a){for(var s,r=e.length/t,n=new Uint8Array(e.length+r),o=[SF,_F,kF,CF,AF],l=0;l<r;l+=1){var c=l*t,d=e.subarray(c,c+t);if(a)n.set(a(d,i,s),c+l);else{for(var u=o.length,h=[],m=0;m<u;m+=1)h[m]=o[m](d,i,s);var p=EF(h.concat());n.set(h[p],c+l)}s=d}return n}(e,t,Math.ceil(i*a/8),n);var o=uP(e,{level:r});return uL.API.__addimage__.arrayBufferToBinaryString(o)}function SF(e){var t=Array.apply([],e);return t.unshift(0),t}function _F(e,t){var i=e.length,a=[];a[0]=1;for(var s=0;s<i;s+=1){var r=e[s-t]||0;a[s+1]=e[s]-r+256&255}return a}function kF(e,t,i){var a=e.length,s=[];s[0]=2;for(var r=0;r<a;r+=1){var n=i&&i[r]||0;s[r+1]=e[r]-n+256&255}return s}function CF(e,t,i){var a=e.length,s=[];s[0]=3;for(var r=0;r<a;r+=1){var n=e[r-t]||0,o=i&&i[r]||0;s[r+1]=e[r]+256-(n+o>>>1)&255}return s}function AF(e,t,i){var a=e.length,s=[];s[0]=4;for(var r=0;r<a;r+=1){var n=zF(e[r-t]||0,i&&i[r]||0,i&&i[r-t]||0);s[r+1]=e[r]-n+256&255}return s}function zF(e,t,i){if(e===t&&t===i)return e;var a=Math.abs(t-i),s=Math.abs(e-i),r=Math.abs(e+t-i-i);return a<=s&&a<=r?e:s<=r?t:i}function EF(e){var t=e.map(function(e){return e.reduce(function(e,t){return e+Math.abs(t)},0)});return t.indexOf(Math.min.apply(null,t))}function IF(e,t,i){var a=t*i,s=Math.floor(a/8),r=16-(a-8*s+i),n=(1<<i)-1;return TF(e,s)>>r&n}function PF(e,t,i,a){var s=i*a,r=Math.floor(s/8),n=16-(s-8*r+a),o=(1<<a)-1,l=(t&o)<<n;!function(e,t,i){if(t+1<e.byteLength)e.setUint16(t,i,!1);else{var a=i>>8&255;e.setUint8(t,a)}}(e,r,TF(e,r)&~(o<<n)&65535|l)}function TF(e,t){return t+1<e.byteLength?e.getUint16(t,!1):e.getUint8(t)<<8}function MF(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var i=e[t++]|e[t++]<<8,a=e[t++]|e[t++]<<8,s=e[t++],r=s>>7,n=1<<1+(7&s);e[t++],e[t++];var o=null,l=null;r&&(o=t,l=n,t+=3*n);var c=!0,d=[],u=0,h=null,m=0,p=null;for(this.width=i,this.height=a;c&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,p=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((C=e[t++])>=0))throw Error("Invalid block size");if(0===C)break;t+=C}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var f=e[t++];u=e[t++]|e[t++]<<8,h=e[t++],1&f||(h=null),m=f>>2&7,t++;break;case 254:for(;;){if(!((C=e[t++])>=0))throw Error("Invalid block size");if(0===C)break;t+=C}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var g=e[t++]|e[t++]<<8,x=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,y=e[t++],w=y>>6&1,N=1<<1+(7&y),j=o,S=l,_=!1;y>>7&&(_=!0,j=t,S=N,t+=3*N);var k=t;for(t++;;){var C;if(!((C=e[t++])>=0))throw Error("Invalid block size");if(0===C)break;t+=C}d.push({x:g,y:x,width:b,height:v,has_local_palette:_,palette_offset:j,palette_size:S,data_offset:k,data_length:t-k,transparent_index:h,interlaced:!!w,delay:u,disposal:m});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return p},this.frameInfo=function(e){if(e<0||e>=d.length)throw new Error("Frame index out of range.");return d[e]},this.decodeAndBlitFrameBGRA=function(t,a){var s=this.frameInfo(t),r=s.width*s.height,n=new Uint8Array(r);LF(e,s.data_offset,n,r);var o=s.palette_offset,l=s.transparent_index;null===l&&(l=256);var c=s.width,d=i-c,u=c,h=4*(s.y*i+s.x),m=4*((s.y+s.height)*i+s.x),p=h,f=4*d;!0===s.interlaced&&(f+=4*i*7);for(var g=8,x=0,b=n.length;x<b;++x){var v=n[x];if(0===u&&(u=c,(p+=f)>=m&&(f=4*d+4*i*(g-1),p=h+(c+d)*(g<<1),g>>=1)),v===l)p+=4;else{var y=e[o+3*v],w=e[o+3*v+1],N=e[o+3*v+2];a[p++]=N,a[p++]=w,a[p++]=y,a[p++]=255}--u}},this.decodeAndBlitFrameRGBA=function(t,a){var s=this.frameInfo(t),r=s.width*s.height,n=new Uint8Array(r);LF(e,s.data_offset,n,r);var o=s.palette_offset,l=s.transparent_index;null===l&&(l=256);var c=s.width,d=i-c,u=c,h=4*(s.y*i+s.x),m=4*((s.y+s.height)*i+s.x),p=h,f=4*d;!0===s.interlaced&&(f+=4*i*7);for(var g=8,x=0,b=n.length;x<b;++x){var v=n[x];if(0===u&&(u=c,(p+=f)>=m&&(f=4*d+4*i*(g-1),p=h+(c+d)*(g<<1),g>>=1)),v===l)p+=4;else{var y=e[o+3*v],w=e[o+3*v+1],N=e[o+3*v+2];a[p++]=y,a[p++]=w,a[p++]=N,a[p++]=255}--u}}}function LF(e,t,i,a){for(var s=e[t++],r=1<<s,n=r+1,o=n+1,l=s+1,c=(1<<l)-1,d=0,u=0,h=0,m=e[t++],p=new Int32Array(4096),f=null;;){for(;d<16&&0!==m;)u|=e[t++]<<d,d+=8,1===m?m=e[t++]:--m;if(d<l)break;var g=u&c;if(u>>=l,d-=l,g!==r){if(g===n)break;for(var x=g<o?g:f,b=0,v=x;v>r;)v=p[v]>>8,++b;var y=v;if(h+b+(x!==g?1:0)>a)return void MM.log("Warning, gif stream longer than expected.");i[h++]=y;var w=h+=b;for(x!==g&&(i[h++]=y),v=x;b--;)v=p[v],i[--w]=255&v,v>>=8;null!==f&&o<4096&&(p[o++]=f<<8|y,o>=c+1&&l<12&&(++l,c=c<<1|1)),f=g}else o=n+1,c=(1<<(l=s+1))-1,f=null}return h!==a&&MM.log("Warning, gif stream shorter than expected."),i}function FF(e){var t,i,a,s,r,n=Math.floor,o=new Array(64),l=new Array(64),c=new Array(64),d=new Array(64),u=new Array(65535),h=new Array(65535),m=new Array(64),p=new Array(64),f=[],g=0,x=7,b=new Array(64),v=new Array(64),y=new Array(64),w=new Array(256),N=new Array(2048),j=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],_=[0,1,2,3,4,5,6,7,8,9,10,11],k=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],C=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],A=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],z=[0,1,2,3,4,5,6,7,8,9,10,11],E=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],I=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function P(e,t){for(var i=0,a=0,s=new Array,r=1;r<=16;r++){for(var n=1;n<=e[r];n++)s[t[a]]=[],s[t[a]][0]=i,s[t[a]][1]=r,a++,i++;i*=2}return s}function T(e){for(var t=e[0],i=e[1]-1;i>=0;)t&1<<i&&(g|=1<<x),i--,--x<0&&(255==g?(M(255),M(0)):M(g),x=7,g=0)}function M(e){f.push(e)}function L(e){M(e>>8&255),M(255&e)}function F(e,t,i,a,s){for(var r,n=s[0],o=s[240],l=function(e,t){var i,a,s,r,n,o,l,c,d,u,h=0;for(d=0;d<8;++d){i=e[h],a=e[h+1],s=e[h+2],r=e[h+3],n=e[h+4],o=e[h+5],l=e[h+6];var p=i+(c=e[h+7]),f=i-c,g=a+l,x=a-l,b=s+o,v=s-o,y=r+n,w=r-n,N=p+y,j=p-y,S=g+b,_=g-b;e[h]=N+S,e[h+4]=N-S;var k=.707106781*(_+j);e[h+2]=j+k,e[h+6]=j-k;var C=.382683433*((N=w+v)-(_=x+f)),A=.5411961*N+C,z=1.306562965*_+C,E=.707106781*(S=v+x),I=f+E,P=f-E;e[h+5]=P+A,e[h+3]=P-A,e[h+1]=I+z,e[h+7]=I-z,h+=8}for(h=0,d=0;d<8;++d){i=e[h],a=e[h+8],s=e[h+16],r=e[h+24],n=e[h+32],o=e[h+40],l=e[h+48];var T=i+(c=e[h+56]),M=i-c,L=a+l,F=a-l,O=s+o,D=s-o,R=r+n,B=r-n,U=T+R,q=T-R,$=L+O,W=L-O;e[h]=U+$,e[h+32]=U-$;var H=.707106781*(W+q);e[h+16]=q+H,e[h+48]=q-H;var Z=.382683433*((U=B+D)-(W=F+M)),V=.5411961*U+Z,G=1.306562965*W+Z,Y=.707106781*($=D+F),K=M+Y,X=M-Y;e[h+40]=X+V,e[h+24]=X-V,e[h+8]=K+G,e[h+56]=K-G,h++}for(d=0;d<64;++d)u=e[d]*t[d],m[d]=u>0?u+.5|0:u-.5|0;return m}(e,t),c=0;c<64;++c)p[j[c]]=l[c];var d=p[0]-i;i=p[0],0==d?T(a[0]):(T(a[h[r=32767+d]]),T(u[r]));for(var f=63;f>0&&0==p[f];)f--;if(0==f)return T(n),i;for(var g,x=1;x<=f;){for(var b=x;0==p[x]&&x<=f;)++x;var v=x-b;if(v>=16){g=v>>4;for(var y=1;y<=g;++y)T(o);v&=15}r=32767+p[x],T(s[(v<<4)+h[r]]),T(u[r]),x++}return 63!=f&&T(n),i}function O(e){e=Math.min(Math.max(e,1),100),r!=e&&(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],i=0;i<64;i++){var a=n((t[i]*e+50)/100);a=Math.min(Math.max(a,1),255),o[j[i]]=a}for(var s=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],r=0;r<64;r++){var u=n((s[r]*e+50)/100);u=Math.min(Math.max(u,1),255),l[j[r]]=u}for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],m=0,p=0;p<8;p++)for(var f=0;f<8;f++)c[m]=1/(o[j[m]]*h[p]*h[f]*8),d[m]=1/(l[j[m]]*h[p]*h[f]*8),m++}(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),r=e)}this.encode=function(e,r){var n,u;r&&O(r),f=new Array,g=0,x=7,L(65496),L(65504),L(16),M(74),M(70),M(73),M(70),M(0),M(1),M(1),M(0),L(1),L(1),M(0),M(0),function(){L(65499),L(132),M(0);for(var e=0;e<64;e++)M(o[e]);M(1);for(var t=0;t<64;t++)M(l[t])}(),n=e.width,u=e.height,L(65472),L(17),M(8),L(u),L(n),M(3),M(1),M(17),M(0),M(2),M(17),M(1),M(3),M(17),M(1),function(){L(65476),L(418),M(0);for(var e=0;e<16;e++)M(S[e+1]);for(var t=0;t<=11;t++)M(_[t]);M(16);for(var i=0;i<16;i++)M(k[i+1]);for(var a=0;a<=161;a++)M(C[a]);M(1);for(var s=0;s<16;s++)M(A[s+1]);for(var r=0;r<=11;r++)M(z[r]);M(17);for(var n=0;n<16;n++)M(E[n+1]);for(var o=0;o<=161;o++)M(I[o])}(),L(65498),L(12),M(3),M(1),M(0),M(2),M(17),M(3),M(17),M(0),M(63),M(0);var h=0,m=0,p=0;g=0,x=7,this.encode.displayName="_encode_";for(var w,j,P,D,R,B,U,q,$,W=e.data,H=e.width,Z=e.height,V=4*H,G=0;G<Z;){for(w=0;w<V;){for(R=V*G+w,U=-1,q=0,$=0;$<64;$++)B=R+(q=$>>3)*V+(U=4*(7&$)),G+q>=Z&&(B-=V*(G+1+q-Z)),w+U>=V&&(B-=w+U-V+4),j=W[B++],P=W[B++],D=W[B++],b[$]=(N[j]+N[P+256|0]+N[D+512|0]>>16)-128,v[$]=(N[j+768|0]+N[P+1024|0]+N[D+1280|0]>>16)-128,y[$]=(N[j+1280|0]+N[P+1536|0]+N[D+1792|0]>>16)-128;h=F(b,c,h,t,a),m=F(v,d,m,i,s),p=F(y,d,p,i,s),w+=32}G+=8}if(x>=0){var Y=[];Y[1]=x+1,Y[0]=(1<<x+1)-1,T(Y)}return L(65497),new Uint8Array(f)},e=e||50,function(){for(var e=String.fromCharCode,t=0;t<256;t++)w[t]=e(t)}(),t=P(S,_),i=P(A,z),a=P(k,C),s=P(E,I),function(){for(var e=1,t=2,i=1;i<=15;i++){for(var a=e;a<t;a++)h[32767+a]=i,u[32767+a]=[],u[32767+a][1]=i,u[32767+a][0]=a;for(var s=-(t-1);s<=-e;s++)h[32767+s]=i,u[32767+s]=[],u[32767+s][1]=i,u[32767+s][0]=t-1+s;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)N[e]=19595*e,N[e+256|0]=38470*e,N[e+512|0]=7471*e+32768,N[e+768|0]=-11059*e,N[e+1024|0]=-21709*e,N[e+1280|0]=32768*e+8421375,N[e+1536|0]=-27439*e,N[e+1792|0]=-5329*e}(),O(e)}function OF(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function DF(e){function t(e){if(!e)throw Error("assert :P")}function i(e,t,i){for(var a=0;4>a;a++)if(e[t+a]!=i.charCodeAt(a))return!0;return!1}function a(e,t,i,a,s){for(var r=0;r<s;r++)e[t+r]=i[a+r]}function s(e,t,i,a){for(var s=0;s<a;s++)e[t+s]=i}function r(e){return new Int32Array(e)}function n(e,t){for(var i=[],a=0;a<e;a++)i.push(new t);return i}function o(e,t){var i=[];return function e(i,a,s){for(var r=s[a],n=0;n<r&&(i.push(s.length>a+1?[]:new t),!(s.length<a+1));n++)e(i[n],a+1,s)}(i,0,e),i}var l=function(){var e=this;function l(e,t){for(var i=1<<t-1>>>0;e&i;)i>>>=1;return i?(e&i-1)+i:e}function c(e,i,a,s,r){t(!(s%a));do{e[i+(s-=a)]=r}while(0<s)}function d(e,i,a,s,n){if(t(2328>=n),512>=n)var o=r(512);else if(null==(o=r(n)))return 0;return function(e,i,a,s,n,o){var d,h,m=i,p=1<<a,f=r(16),g=r(16);for(t(0!=n),t(null!=s),t(null!=e),t(0<a),h=0;h<n;++h){if(15<s[h])return 0;++f[s[h]]}if(f[0]==n)return 0;for(g[1]=0,d=1;15>d;++d){if(f[d]>1<<d)return 0;g[d+1]=g[d]+f[d]}for(h=0;h<n;++h)d=s[h],0<s[h]&&(o[g[d]++]=h);if(1==g[15])return(s=new u).g=0,s.value=o[0],c(e,m,1,p,s),p;var x,b=-1,v=p-1,y=0,w=1,N=1,j=1<<a;for(h=0,d=1,n=2;d<=a;++d,n<<=1){if(w+=N<<=1,0>(N-=f[d]))return 0;for(;0<f[d];--f[d])(s=new u).g=d,s.value=o[h++],c(e,m+y,n,j,s),y=l(y,d)}for(d=a+1,n=2;15>=d;++d,n<<=1){if(w+=N<<=1,0>(N-=f[d]))return 0;for(;0<f[d];--f[d]){if(s=new u,(y&v)!=b){for(m+=j,x=1<<(b=d)-a;15>b&&!(0>=(x-=f[b]));)++b,x<<=1;p+=j=1<<(x=b-a),e[i+(b=y&v)].g=x+a,e[i+b].value=m-i-b}s.g=d-a,s.value=o[h++],c(e,m+(y>>a),n,j,s),y=l(y,d)}}return w!=2*g[15]-1?0:p}(e,i,a,s,n,o)}function u(){this.value=this.g=0}function h(){this.value=this.g=0}function m(){this.G=n(5,u),this.H=r(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=n(Oi,h)}function p(e,i,a,s){t(null!=e),t(null!=i),t(2147483648>s),e.Ca=254,e.I=0,e.b=-8,e.Ka=0,e.oa=i,e.pa=a,e.Jd=i,e.Yc=a+s,e.Zc=4<=s?a+s-4+1:a,k(e)}function f(e,t){for(var i=0;0<t--;)i|=A(e,128)<<t;return i}function g(e,t){var i=f(e,t);return C(e)?-i:i}function x(e,i,a,s){var r,n=0;for(t(null!=e),t(null!=i),t(4294967288>s),e.Sb=s,e.Ra=0,e.u=0,e.h=0,4<s&&(s=4),r=0;r<s;++r)n+=i[a+r]<<8*r;e.Ra=n,e.bb=s,e.oa=i,e.pa=a}function b(e){for(;8<=e.u&&e.bb<e.Sb;)e.Ra>>>=8,e.Ra+=e.oa[e.pa+e.bb]<<Bi-8>>>0,++e.bb,e.u-=8;j(e)&&(e.h=1,e.u=0)}function v(e,i){if(t(0<=i),!e.h&&i<=Ri){var a=N(e)&Di[i];return e.u+=i,b(e),a}return e.h=1,e.u=0}function y(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function w(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function N(e){return e.Ra>>>(e.u&Bi-1)>>>0}function j(e){return t(e.bb<=e.Sb),e.h||e.bb==e.Sb&&e.u>Bi}function S(e,t){e.u=t,e.h=j(e)}function _(e){e.u>=Ui&&(t(e.u>=Ui),b(e))}function k(e){t(null!=e&&null!=e.oa),e.pa<e.Zc?(e.I=(e.oa[e.pa++]|e.I<<8)>>>0,e.b+=8):(t(null!=e&&null!=e.oa),e.pa<e.Yc?(e.b+=8,e.I=e.oa[e.pa++]|e.I<<8):e.Ka?e.b=0:(e.I<<=8,e.b+=8,e.Ka=1))}function C(e){return f(e,1)}function A(e,t){var i=e.Ca;0>e.b&&k(e);var a=e.b,s=i*t>>>8,r=(e.I>>>a>s)+0;for(r?(i-=s,e.I-=s+1<<a>>>0):i=s+1,a=i,s=0;256<=a;)s+=8,a>>=8;return a=7^s+qi[a],e.b-=a,e.Ca=(i<<a)-1,r}function z(e,t,i){e[t+0]=i>>24&255,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}function E(e,t){return e[t+0]|e[t+1]<<8}function I(e,t){return E(e,t)|e[t+2]<<16}function P(e,t){return E(e,t)|E(e,t+2)<<16}function T(e,i){var a=1<<i;return t(null!=e),t(0<i),e.X=r(a),null==e.X?0:(e.Mb=32-i,e.Xa=i,1)}function M(e,i){t(null!=e),t(null!=i),t(e.Xa==i.Xa),a(i.X,0,e.X,0,1<<i.Xa)}function L(){this.X=[],this.Xa=this.Mb=0}function F(e,i,a,s){t(null!=a),t(null!=s);var r=a[0],n=s[0];return 0==r&&(r=(e*n+i/2)/i),0==n&&(n=(i*r+e/2)/e),0>=r||0>=n?0:(a[0]=r,s[0]=n,1)}function O(e,t){return e+(1<<t)-1>>>t}function D(e,t){return((4278255360&e)+(4278255360&t)>>>0&4278255360)+((16711935&e)+(16711935&t)>>>0&16711935)>>>0}function R(t,i){e[i]=function(i,a,s,r,n,o,l){var c;for(c=0;c<n;++c){var d=e[t](o[l+c-1],s,r+c);o[l+c]=D(i[a+c],d)}}}function B(){this.ud=this.hd=this.jd=0}function U(e,t){return((4278124286&(e^t))>>>1)+(e&t)>>>0}function q(e){return 0<=e&&256>e?e:0>e?0:255<e?255:void 0}function $(e,t){return q(e+(e-t+.5>>1))}function W(e,t,i){return Math.abs(t-i)-Math.abs(e-i)}function H(e,t,i,a,s,r,n){for(a=r[n-1],i=0;i<s;++i)r[n+i]=a=D(e[t+i],a)}function Z(e,t,i,a,s){var r;for(r=0;r<i;++r){var n=e[t+r],o=n>>8&255,l=16711935&(l=(l=16711935&n)+((o<<16)+o));a[s+r]=(4278255360&n)+l>>>0}}function V(e,t){t.jd=255&e,t.hd=e>>8&255,t.ud=e>>16&255}function G(e,t,i,a,s,r){var n;for(n=0;n<a;++n){var o=t[i+n],l=o>>>8,c=o,d=255&(d=(d=o>>>16)+((e.jd<<24>>24)*(l<<24>>24)>>>5));c=255&(c=(c+=(e.hd<<24>>24)*(l<<24>>24)>>>5)+((e.ud<<24>>24)*(d<<24>>24)>>>5)),s[r+n]=(4278255360&o)+(d<<16)+c}}function Y(t,i,a,s,r){e[i]=function(e,t,i,a,n,o,l,c,d){for(a=l;a<c;++a)for(l=0;l<d;++l)n[o++]=r(i[s(e[t++])])},e[t]=function(t,i,n,o,l,c,d){var u=8>>t.b,h=t.Ea,m=t.K[0],p=t.w;if(8>u)for(t=(1<<t.b)-1,p=(1<<u)-1;i<n;++i){var f,g=0;for(f=0;f<h;++f)f&t||(g=s(o[l++])),c[d++]=r(m[g&p]),g>>=u}else e["VP8LMapColor"+a](o,l,m,p,c,d,i,n,h)}}function K(e,t,i,a,s){for(i=t+i;t<i;){var r=e[t++];a[s++]=r>>16&255,a[s++]=r>>8&255,a[s++]=255&r}}function X(e,t,i,a,s){for(i=t+i;t<i;){var r=e[t++];a[s++]=r>>16&255,a[s++]=r>>8&255,a[s++]=255&r,a[s++]=r>>24&255}}function J(e,t,i,a,s){for(i=t+i;t<i;){var r=(n=e[t++])>>16&240|n>>12&15,n=240&n|n>>28&15;a[s++]=r,a[s++]=n}}function Q(e,t,i,a,s){for(i=t+i;t<i;){var r=(n=e[t++])>>16&248|n>>13&7,n=n>>5&224|n>>3&31;a[s++]=r,a[s++]=n}}function ee(e,t,i,a,s){for(i=t+i;t<i;){var r=e[t++];a[s++]=255&r,a[s++]=r>>8&255,a[s++]=r>>16&255}}function te(e,t,i,s,r,n){if(0==n)for(i=t+i;t<i;)z(s,((n=e[t++])[0]>>24|n[1]>>8&65280|n[2]<<8&16711680|n[3]<<24)>>>0),r+=32;else a(s,r,e,t,i)}function ie(t,i){e[i][0]=e[t+"0"],e[i][1]=e[t+"1"],e[i][2]=e[t+"2"],e[i][3]=e[t+"3"],e[i][4]=e[t+"4"],e[i][5]=e[t+"5"],e[i][6]=e[t+"6"],e[i][7]=e[t+"7"],e[i][8]=e[t+"8"],e[i][9]=e[t+"9"],e[i][10]=e[t+"10"],e[i][11]=e[t+"11"],e[i][12]=e[t+"12"],e[i][13]=e[t+"13"],e[i][14]=e[t+"0"],e[i][15]=e[t+"0"]}function ae(e){return e==Ua||e==qa||e==$a||e==Wa}function se(){this.eb=[],this.size=this.A=this.fb=0}function re(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function ne(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new se,this.f.kb=new re,this.sd=null}function oe(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function le(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ce(e){return alert("todo:WebPSamplerProcessPlane"),e.T}function de(e,t){var i=e.T,s=t.ba.f.RGBA,r=s.eb,n=s.fb+e.ka*s.A,o=fs[t.ba.S],l=e.y,c=e.O,d=e.f,u=e.N,h=e.ea,m=e.W,p=t.cc,f=t.dc,g=t.Mc,x=t.Nc,b=e.ka,v=e.ka+e.T,y=e.U,w=y+1>>1;for(0==b?o(l,c,null,null,d,u,h,m,d,u,h,m,r,n,null,null,y):(o(t.ec,t.fc,l,c,p,f,g,x,d,u,h,m,r,n-s.A,r,n,y),++i);b+2<v;b+=2)p=d,f=u,g=h,x=m,u+=e.Rc,m+=e.Rc,n+=2*s.A,o(l,(c+=2*e.fa)-e.fa,l,c,p,f,g,x,d,u,h,m,r,n-s.A,r,n,y);return c+=e.fa,e.j+v<e.o?(a(t.ec,t.fc,l,c,y),a(t.cc,t.dc,d,u,w),a(t.Mc,t.Nc,h,m,w),i--):1&v||o(l,c,null,null,d,u,h,m,d,u,h,m,r,n+s.A,null,null,y),i}function ue(e,i,a){var s=e.F,r=[e.J];if(null!=s){var n=e.U,o=i.ba.S,l=o==Da||o==$a;i=i.ba.f.RGBA;var c=[0],d=e.ka;c[0]=e.T,e.Kb&&(0==d?--c[0]:(--d,r[0]-=e.width),e.j+e.ka+e.T==e.o&&(c[0]=e.o-e.j-d));var u=i.eb;d=i.fb+d*i.A,e=ja(s,r[0],e.width,n,c,u,d+(l?0:3),i.A),t(a==c),e&&ae(o)&&wa(u,d,l,n,c,i.A)}return 0}function he(e){var t=e.ma,i=t.ba.S,a=11>i,s=i==La||i==Oa||i==Da||i==Ra||12==i||ae(i);if(t.memory=null,t.Ib=null,t.Jb=null,t.Nd=null,!Mi(t.Oa,e,s?11:12))return 0;if(s&&ae(i)&&xi(),e.da)alert("todo:use_scaling");else{if(a){if(t.Ib=ce,e.Kb){if(i=e.U+1>>1,t.memory=r(e.U+2*i),null==t.memory)return 0;t.ec=t.memory,t.fc=0,t.cc=t.ec,t.dc=t.fc+e.U,t.Mc=t.cc,t.Nc=t.dc+i,t.Ib=de,xi()}}else alert("todo:EmitYUV");s&&(t.Jb=ue,a&&fi())}if(a&&!As){for(e=0;256>e;++e)zs[e]=89858*(e-128)+Ss>>js,Ps[e]=-22014*(e-128)+Ss,Is[e]=-45773*(e-128),Es[e]=113618*(e-128)+Ss>>js;for(e=_s;e<ks;++e)t=76283*(e-16)+Ss>>js,Ts[e-_s]=He(t,255),Ms[e-_s]=He(t+8>>4,15);As=1}return 1}function me(e){var i=e.ma,a=e.U,s=e.T;return t(!(1&e.ka)),0>=a||0>=s?0:(a=i.Ib(e,i),null!=i.Jb&&i.Jb(e,i,a),i.Dc+=a,1)}function pe(e){e.ma.memory=null}function fe(e,t,i,a){return 47!=v(e,8)?0:(t[0]=v(e,14)+1,i[0]=v(e,14)+1,a[0]=v(e,1),0!=v(e,3)?0:!e.h)}function ge(e,t){if(4>e)return e+1;var i=e-2>>1;return(2+(1&e)<<i)+v(t,i)+1}function xe(e,t){return 120<t?t-120:1<=(i=((i=Ka[t-1])>>4)*e+(8-(15&i)))?i:1;var i}function be(e,t,i){var a=N(i),s=e[t+=255&a].g-8;return 0<s&&(S(i,i.u+8),a=N(i),t+=e[t].value,t+=a&(1<<s)-1),S(i,i.u+e[t].g),e[t].value}function ve(e,i,a){return a.g+=e.g,a.value+=e.value<<i>>>0,t(8>=a.g),e.g}function ye(e,i,a){var s=e.xc;return t((i=0==s?0:e.vc[e.md*(a>>s)+(i>>s)])<e.Wb),e.Ya[i]}function we(e,i,s,r){var n=e.ab,o=e.c*i,l=e.C;i=l+i;var c=s,d=r;for(r=e.Ta,s=e.Ua;0<n--;){var u=e.gc[n],h=l,m=i,p=c,f=d,g=(d=r,c=s,u.Ea);switch(t(h<m),t(m<=u.nc),u.hc){case 2:Hi(p,f,(m-h)*g,d,c);break;case 0:var x=h,b=m,v=d,y=c,w=(k=u).Ea;0==x&&($i(p,f,null,null,1,v,y),H(p,f+1,0,0,w-1,v,y+1),f+=w,y+=w,++x);for(var N=1<<k.b,j=N-1,S=O(w,k.b),_=k.K,k=k.w+(x>>k.b)*S;x<b;){var C=_,A=k,z=1;for(Wi(p,f,v,y-w,1,v,y);z<w;){var E=(z&~j)+N;E>w&&(E=w),(0,Ki[C[A++]>>8&15])(p,f+ +z,v,y+z-w,E-z,v,y+z),z=E}f+=w,y+=w,++x&j||(k+=S)}m!=u.nc&&a(d,c-g,d,c+(m-h-1)*g,g);break;case 1:for(g=p,b=f,w=(p=u.Ea)-(y=p&~(v=(f=1<<u.b)-1)),x=O(p,u.b),N=u.K,u=u.w+(h>>u.b)*x;h<m;){for(j=N,S=u,_=new B,k=b+y,C=b+p;b<k;)V(j[S++],_),Xi(_,g,b,f,d,c),b+=f,c+=f;b<C&&(V(j[S++],_),Xi(_,g,b,w,d,c),b+=w,c+=w),++h&v||(u+=x)}break;case 3:if(p==d&&f==c&&0<u.b){for(b=d,p=g=c+(m-h)*g-(y=(m-h)*O(u.Ea,u.b)),f=d,v=c,x=[],y=(w=y)-1;0<=y;--y)x[y]=f[v+y];for(y=w-1;0<=y;--y)b[p+y]=x[y];Zi(u,h,m,d,g,d,c)}else Zi(u,h,m,p,f,d,c)}c=r,d=s}d!=s&&a(r,s,c,d,o)}function Ne(e,i){var a=e.V,s=e.Ba+e.c*e.C,r=i-e.C;if(t(i<=e.l.o),t(16>=r),0<r){var n=e.l,o=e.Ta,l=e.Ua,c=n.width;if(we(e,r,a,s),r=l=[l],t((a=e.C)<(s=i)),t(n.v<n.va),s>n.o&&(s=n.o),a<n.j){var d=n.j-a;a=n.j,r[0]+=d*c}if(a>=s?a=0:(r[0]+=4*n.v,n.ka=a-n.j,n.U=n.va-n.v,n.T=s-a,a=1),a){if(l=l[0],11>(a=e.ca).S){var u=a.f.RGBA,h=(s=a.S,r=n.U,n=n.T,d=u.eb,u.A),m=n;for(u=u.fb+e.Ma*u.A;0<m--;){var p=o,f=l,g=r,x=d,b=u;switch(s){case Ma:Ji(p,f,g,x,b);break;case La:Qi(p,f,g,x,b);break;case Ua:Qi(p,f,g,x,b),wa(x,b,0,g,1,0);break;case Fa:ia(p,f,g,x,b);break;case Oa:te(p,f,g,x,b,1);break;case qa:te(p,f,g,x,b,1),wa(x,b,0,g,1,0);break;case Da:te(p,f,g,x,b,0);break;case $a:te(p,f,g,x,b,0),wa(x,b,1,g,1,0);break;case Ra:ea(p,f,g,x,b);break;case Wa:ea(p,f,g,x,b),Na(x,b,g,1,0);break;case Ba:ta(p,f,g,x,b);break;default:t(0)}l+=c,u+=h}e.Ma+=n}else alert("todo:EmitRescaledRowsYUVA");t(e.Ma<=a.height)}}e.C=i,t(e.C<=e.i)}function je(e){var t;if(0<e.ua)return 0;for(t=0;t<e.Wb;++t){var i=e.Ya[t].G,a=e.Ya[t].H;if(0<i[1][a[1]+0].g||0<i[2][a[2]+0].g||0<i[3][a[3]+0].g)return 0}return 1}function Se(e,i,a,s,r,n){if(0!=e.Z){var o=e.qd,l=e.rd;for(t(null!=ps[e.Z]);i<a;++i)ps[e.Z](o,l,s,r,s,r,n),o=s,l=r,r+=n;e.qd=o,e.rd=l}}function _e(e,i){var a=e.l.ma,s=0==a.Z||1==a.Z?e.l.j:e.C;if(s=e.C<s?s:e.C,t(i<=e.l.o),i>s){var r=e.l.width,n=a.ca,o=a.tb+r*s,l=e.V,c=e.Ba+e.c*s,d=e.gc;t(1==e.ab),t(3==d[0].hc),Gi(d[0],s,i,l,c,n,o),Se(a,s,i,n,o,r)}e.C=e.Ma=i}function ke(e,i,a,s,r,n,o){var l=e.$/s,c=e.$%s,d=e.m,u=e.s,h=a+e.$,m=h;r=a+s*r;var p=a+s*n,f=280+u.ua,g=e.Pb?l:16777216,x=0<u.ua?u.Wa:null,b=u.wc,v=h<p?ye(u,c,l):null;t(e.C<n),t(p<=r);var y=!1;e:for(;;){for(;y||h<p;){var w=0;if(l>=g){var k=h-a;t((g=e).Pb),g.wd=g.m,g.xd=k,0<g.s.ua&&M(g.s.Wa,g.s.vb),g=l+Ja}if(c&b||(v=ye(u,c,l)),t(null!=v),v.Qb&&(i[h]=v.qb,y=!0),!y)if(_(d),v.jc){w=d,k=i;var C=h,A=v.pd[N(w)&Oi-1];t(v.jc),256>A.g?(S(w,w.u+A.g),k[C]=A.value,w=0):(S(w,w.u+A.g-256),t(256<=A.value),w=A.value),0==w&&(y=!0)}else w=be(v.G[0],v.H[0],d);if(d.h)break;if(y||256>w){if(!y)if(v.nd)i[h]=(v.qb|w<<8)>>>0;else{if(_(d),y=be(v.G[1],v.H[1],d),_(d),k=be(v.G[2],v.H[2],d),C=be(v.G[3],v.H[3],d),d.h)break;i[h]=(C<<24|y<<16|w<<8|k)>>>0}if(y=!1,++h,++c>=s&&(c=0,++l,null!=o&&l<=n&&!(l%16)&&o(e,l),null!=x))for(;m<h;)w=i[m++],x.X[(506832829*w&4294967295)>>>x.Mb]=w}else if(280>w){if(w=ge(w-256,d),k=be(v.G[4],v.H[4],d),_(d),k=xe(s,k=ge(k,d)),d.h)break;if(h-a<k||r-h<w)break e;for(C=0;C<w;++C)i[h+C]=i[h+C-k];for(h+=w,c+=w;c>=s;)c-=s,++l,null!=o&&l<=n&&!(l%16)&&o(e,l);if(t(h<=r),c&b&&(v=ye(u,c,l)),null!=x)for(;m<h;)w=i[m++],x.X[(506832829*w&4294967295)>>>x.Mb]=w}else{if(!(w<f))break e;for(y=w-280,t(null!=x);m<h;)w=i[m++],x.X[(506832829*w&4294967295)>>>x.Mb]=w;w=h,t(!(y>>>(k=x).Xa)),i[w]=k.X[y],y=!0}y||t(d.h==j(d))}if(e.Pb&&d.h&&h<r)t(e.m.h),e.a=5,e.m=e.wd,e.$=e.xd,0<e.s.ua&&M(e.s.vb,e.s.Wa);else{if(d.h)break e;null!=o&&o(e,l>n?n:l),e.a=0,e.$=h-a}return 1}return e.a=3,0}function Ce(e){t(null!=e),e.vc=null,e.yc=null,e.Ya=null;var i=e.Wa;null!=i&&(i.X=null),e.vb=null,t(null!=e)}function Ae(){var t=new ri;return null==t?null:(t.a=0,t.xb=ms,ie("Predictor","VP8LPredictors"),ie("Predictor","VP8LPredictors_C"),ie("PredictorAdd","VP8LPredictorsAdd"),ie("PredictorAdd","VP8LPredictorsAdd_C"),Hi=Z,Xi=G,Ji=K,Qi=X,ea=J,ta=Q,ia=ee,e.VP8LMapColor32b=Vi,e.VP8LMapColor8b=Yi,t)}function ze(e,i,a,o,l){var c=1,h=[e],p=[i],f=o.m,g=o.s,x=null,b=0;e:for(;;){if(a)for(;c&&v(f,1);){var y=h,w=p,j=o,k=1,C=j.m,A=j.gc[j.ab],z=v(C,2);if(j.Oc&1<<z)c=0;else{switch(j.Oc|=1<<z,A.hc=z,A.Ea=y[0],A.nc=w[0],A.K=[null],++j.ab,t(4>=j.ab),z){case 0:case 1:A.b=v(C,3)+2,k=ze(O(A.Ea,A.b),O(A.nc,A.b),0,j,A.K),A.K=A.K[0];break;case 3:var E,I=v(C,8)+1,P=16<I?0:4<I?1:2<I?2:3;if(y[0]=O(A.Ea,P),A.b=P,E=k=ze(I,1,0,j,A.K)){var M,L=I,F=A,R=1<<(8>>F.b),B=r(R);if(null==B)E=0;else{var U=F.K[0],q=F.w;for(B[0]=F.K[0][0],M=1;M<1*L;++M)B[M]=D(U[q+M],B[M-1]);for(;M<4*R;++M)B[M]=0;F.K[0]=null,F.K[0]=B,E=1}}k=E;break;case 2:break;default:t(0)}c=k}}if(h=h[0],p=p[0],c&&v(f,1)&&!(c=1<=(b=v(f,4))&&11>=b)){o.a=3;break e}var $;if($=c)t:{var W,H,Z,V=o,G=h,Y=p,K=b,X=a,J=V.m,Q=V.s,ee=[null],te=1,ie=0,ae=Xa[K];i:for(;;){if(X&&v(J,1)){var se=v(J,3)+2,re=O(G,se),ne=O(Y,se),oe=re*ne;if(!ze(re,ne,0,V,ee))break i;for(ee=ee[0],Q.xc=se,W=0;W<oe;++W){var le=ee[W]>>8&65535;ee[W]=le,le>=te&&(te=le+1)}}if(J.h)break i;for(H=0;5>H;++H){var ce=Va[H];!H&&0<K&&(ce+=1<<K),ie<ce&&(ie=ce)}var de=n(te*ae,u),ue=te,he=n(ue,m);if(null==he)var me=null;else t(65536>=ue),me=he;var pe=r(ie);if(null==me||null==pe||null==de){V.a=1;break i}var fe=de;for(W=Z=0;W<te;++W){var ge=me[W],xe=ge.G,be=ge.H,ye=0,we=1,Ne=0;for(H=0;5>H;++H){ce=Va[H],xe[H]=fe,be[H]=Z,!H&&0<K&&(ce+=1<<K);a:{var je,Se=ce,_e=V,Ae=pe,Ee=fe,Ie=Z,Pe=0,Te=_e.m,Me=v(Te,1);if(s(Ae,0,0,Se),Me){var Le=v(Te,1)+1,Fe=v(Te,1),Oe=v(Te,0==Fe?1:8);Ae[Oe]=1,2==Le&&(Ae[Oe=v(Te,8)]=1);var De=1}else{var Re=r(19),Be=v(Te,4)+4;if(19<Be){_e.a=3;var Ue=0;break a}for(je=0;je<Be;++je)Re[Ya[je]]=v(Te,3);var qe=void 0,$e=void 0,We=_e,He=Re,Ze=Se,Ve=Ae,Ge=0,Ye=We.m,Ke=8,Xe=n(128,u);s:for(;d(Xe,0,7,He,19);){if(v(Ye,1)){var Je=2+2*v(Ye,3);if((qe=2+v(Ye,Je))>Ze)break s}else qe=Ze;for($e=0;$e<Ze&&qe--;){_(Ye);var Qe=Xe[0+(127&N(Ye))];S(Ye,Ye.u+Qe.g);var et=Qe.value;if(16>et)Ve[$e++]=et,0!=et&&(Ke=et);else{var tt=16==et,it=et-16,at=Za[it],st=v(Ye,Ha[it])+at;if($e+st>Ze)break s;for(var rt=tt?Ke:0;0<st--;)Ve[$e++]=rt}}Ge=1;break s}Ge||(We.a=3),De=Ge}(De=De&&!Te.h)&&(Pe=d(Ee,Ie,8,Ae,Se)),De&&0!=Pe?Ue=Pe:(_e.a=3,Ue=0)}if(0==Ue)break i;if(we&&1==Ga[H]&&(we=0==fe[Z].g),ye+=fe[Z].g,Z+=Ue,3>=H){var nt,ot=pe[0];for(nt=1;nt<ce;++nt)pe[nt]>ot&&(ot=pe[nt]);Ne+=ot}}if(ge.nd=we,ge.Qb=0,we&&(ge.qb=(xe[3][be[3]+0].value<<24|xe[1][be[1]+0].value<<16|xe[2][be[2]+0].value)>>>0,0==ye&&256>xe[0][be[0]+0].value&&(ge.Qb=1,ge.qb+=xe[0][be[0]+0].value<<8)),ge.jc=!ge.Qb&&6>Ne,ge.jc){var lt,ct=ge;for(lt=0;lt<Oi;++lt){var dt=lt,ut=ct.pd[dt],ht=ct.G[0][ct.H[0]+dt];256<=ht.value?(ut.g=ht.g+256,ut.value=ht.value):(ut.g=0,ut.value=0,dt>>=ve(ht,8,ut),dt>>=ve(ct.G[1][ct.H[1]+dt],16,ut),dt>>=ve(ct.G[2][ct.H[2]+dt],0,ut),ve(ct.G[3][ct.H[3]+dt],24,ut))}}}Q.vc=ee,Q.Wb=te,Q.Ya=me,Q.yc=de,$=1;break t}$=0}if(!(c=$)){o.a=3;break e}if(0<b){if(g.ua=1<<b,!T(g.Wa,b)){o.a=1,c=0;break e}}else g.ua=0;var mt=o,pt=h,ft=p,gt=mt.s,xt=gt.xc;if(mt.c=pt,mt.i=ft,gt.md=O(pt,xt),gt.wc=0==xt?-1:(1<<xt)-1,a){o.xb=hs;break e}if(null==(x=r(h*p))){o.a=1,c=0;break e}c=(c=ke(o,x,0,h,p,p,null))&&!f.h;break e}return c?(null!=l?l[0]=x:(t(null==x),t(a)),o.$=0,a||Ce(g)):Ce(g),c}function Ee(e,i){var a=e.c*e.i,s=a+i+16*i;return t(e.c<=i),e.V=r(s),null==e.V?(e.Ta=null,e.Ua=0,e.a=1,0):(e.Ta=e.V,e.Ua=e.Ba+a+i,1)}function Ie(e,i){var a=e.C,s=i-a,r=e.V,n=e.Ba+e.c*a;for(t(i<=e.l.o);0<s;){var o=16<s?16:s,l=e.l.ma,c=e.l.width,d=c*o,u=l.ca,h=l.tb+c*a,m=e.Ta,p=e.Ua;we(e,o,r,n),Sa(m,p,u,h,d),Se(l,a,a+o,u,h,c),s-=o,r+=o*e.c,a+=o}t(a==i),e.C=e.Ma=i}function Pe(){this.ub=this.yd=this.td=this.Rb=0}function Te(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Me(){this.Fb=this.Bb=this.Cb=0,this.Zb=r(4),this.Lb=r(4)}function Le(){var e;this.Yb=(function e(t,i,a){for(var s=a[i],r=0;r<s&&(t.push(a.length>i+1?[]:0),!(a.length<i+1));r++)e(t[r],i+1,a)}(e=[],0,[3,11]),e)}function Fe(){this.jb=r(3),this.Wc=o([4,8],Le),this.Xc=o([4,17],Le)}function Oe(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new r(4),this.od=new r(4)}function De(){this.ld=this.La=this.dd=this.tc=0}function Re(){this.Na=this.la=0}function Be(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Ue(){this.ad=r(384),this.Za=0,this.Ob=r(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function qe(){this.uc=this.M=this.Nb=0,this.wa=Array(new De),this.Y=0,this.ya=Array(new Ue),this.aa=0,this.l=new Ze}function $e(){this.y=r(16),this.f=r(8),this.ea=r(8)}function We(){this.cb=this.a=0,this.sc="",this.m=new y,this.Od=new Pe,this.Kc=new Te,this.ed=new Oe,this.Qa=new Me,this.Ic=this.$c=this.Aa=0,this.D=new qe,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=n(8,y),this.ia=0,this.pb=n(4,Be),this.Pa=new Fe,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new $e),this.Hd=0,this.rb=Array(new Re),this.sb=0,this.wa=Array(new De),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Ue),this.L=this.aa=0,this.gd=o([4,2],De),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function He(e,t){return 0>e?0:e>t?t:e}function Ze(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ve(){var e=new We;return null!=e&&(e.a=0,e.sc="OK",e.cb=0,e.Xb=0,ts||(ts=Xe)),e}function Ge(e,t,i){return 0==e.a&&(e.a=t,e.sc=i,e.cb=0),0}function Ye(e,t,i){return 3<=i&&157==e[t+0]&&1==e[t+1]&&42==e[t+2]}function Ke(e,i){if(null==e)return 0;if(e.a=0,e.sc="OK",null==i)return Ge(e,2,"null VP8Io passed to VP8GetHeaders()");var a=i.data,r=i.w,n=i.ha;if(4>n)return Ge(e,7,"Truncated header.");var o=a[r+0]|a[r+1]<<8|a[r+2]<<16,l=e.Od;if(l.Rb=!(1&o),l.td=o>>1&7,l.yd=o>>4&1,l.ub=o>>5,3<l.td)return Ge(e,3,"Incorrect keyframe parameters.");if(!l.yd)return Ge(e,4,"Frame not displayable.");r+=3,n-=3;var c=e.Kc;if(l.Rb){if(7>n)return Ge(e,7,"cannot parse picture header");if(!Ye(a,r,n))return Ge(e,3,"Bad code word");c.c=16383&(a[r+4]<<8|a[r+3]),c.Td=a[r+4]>>6,c.i=16383&(a[r+6]<<8|a[r+5]),c.Ud=a[r+6]>>6,r+=7,n-=7,e.za=c.c+15>>4,e.Ub=c.i+15>>4,i.width=c.c,i.height=c.i,i.Da=0,i.j=0,i.v=0,i.va=i.width,i.o=i.height,i.da=0,i.ib=i.width,i.hb=i.height,i.U=i.width,i.T=i.height,s((o=e.Pa).jb,0,255,o.jb.length),t(null!=(o=e.Qa)),o.Cb=0,o.Bb=0,o.Fb=1,s(o.Zb,0,0,o.Zb.length),s(o.Lb,0,0,o.Lb)}if(l.ub>n)return Ge(e,7,"bad partition length");p(o=e.m,a,r,l.ub),r+=l.ub,n-=l.ub,l.Rb&&(c.Ld=C(o),c.Kd=C(o)),c=e.Qa;var d,u=e.Pa;if(t(null!=o),t(null!=c),c.Cb=C(o),c.Cb){if(c.Bb=C(o),C(o)){for(c.Fb=C(o),d=0;4>d;++d)c.Zb[d]=C(o)?g(o,7):0;for(d=0;4>d;++d)c.Lb[d]=C(o)?g(o,6):0}if(c.Bb)for(d=0;3>d;++d)u.jb[d]=C(o)?f(o,8):255}else c.Bb=0;if(o.Ka)return Ge(e,3,"cannot parse segment header");if((c=e.ed).zd=C(o),c.Tb=f(o,6),c.wb=f(o,3),c.Pc=C(o),c.Pc&&C(o)){for(u=0;4>u;++u)C(o)&&(c.vd[u]=g(o,6));for(u=0;4>u;++u)C(o)&&(c.od[u]=g(o,6))}if(e.L=0==c.Tb?0:c.zd?1:2,o.Ka)return Ge(e,3,"cannot parse filter header");var h=n;if(n=d=r,r=d+h,c=h,e.Xb=(1<<f(e.m,2))-1,h<3*(u=e.Xb))a=7;else{for(d+=3*u,c-=3*u,h=0;h<u;++h){var m=a[n+0]|a[n+1]<<8|a[n+2]<<16;m>c&&(m=c),p(e.Jc[+h],a,d,m),d+=m,c-=m,n+=3}p(e.Jc[+u],a,d,c),a=d<r?0:5}if(0!=a)return Ge(e,a,"cannot parse partitions");for(a=f(d=e.m,7),n=C(d)?g(d,4):0,r=C(d)?g(d,4):0,c=C(d)?g(d,4):0,u=C(d)?g(d,4):0,d=C(d)?g(d,4):0,h=e.Qa,m=0;4>m;++m){if(h.Cb){var x=h.Zb[m];h.Fb||(x+=a)}else{if(0<m){e.pb[m]=e.pb[0];continue}x=a}var b=e.pb[m];b.Sc[0]=Qa[He(x+n,127)],b.Sc[1]=es[He(x+0,127)],b.Eb[0]=2*Qa[He(x+r,127)],b.Eb[1]=101581*es[He(x+c,127)]>>16,8>b.Eb[1]&&(b.Eb[1]=8),b.Qc[0]=Qa[He(x+u,117)],b.Qc[1]=es[He(x+d,127)],b.lc=x+d}if(!l.Rb)return Ge(e,4,"Not a key frame.");for(C(o),l=e.Pa,a=0;4>a;++a){for(n=0;8>n;++n)for(r=0;3>r;++r)for(c=0;11>c;++c)u=A(o,os[a][n][r][c])?f(o,8):rs[a][n][r][c],l.Wc[a][n].Yb[r][c]=u;for(n=0;17>n;++n)l.Xc[a][n]=l.Wc[a][ls[n]]}return e.kc=C(o),e.kc&&(e.Bd=f(o,8)),e.cb=1}function Xe(e,t,i,a,s,r,n){var o=t[s].Yb[i];for(i=0;16>s;++s){if(!A(e,o[i+0]))return s;for(;!A(e,o[i+1]);)if(o=t[++s].Yb[0],i=0,16==s)return 16;var l=t[s+1].Yb;if(A(e,o[i+2])){var c=e,d=0;if(A(c,(h=o)[(u=i)+3]))if(A(c,h[u+6])){for(o=0,u=2*(d=A(c,h[u+8]))+(h=A(c,h[u+9+d])),d=0,h=is[u];h[o];++o)d+=d+A(c,h[o]);d+=3+(8<<u)}else A(c,h[u+7])?(d=7+2*A(c,165),d+=A(c,145)):d=5+A(c,159);else d=A(c,h[u+4])?3+A(c,h[u+5]):2;o=l[2]}else d=1,o=l[1];l=n+as[s],0>(c=e).b&&k(c);var u,h=c.b,m=(u=c.Ca>>1)-(c.I>>h)>>31;--c.b,c.Ca+=m,c.Ca|=1,c.I-=(u+1&m)<<h,r[l]=((d^m)-m)*a[(0<s)+0]}return 16}function Je(e){var t=e.rb[e.sb-1];t.la=0,t.Na=0,s(e.zc,0,0,e.zc.length),e.ja=0}function Qe(e,t,i,a,s){s=e[t+i+32*a]+(s>>3),e[t+i+32*a]=-256&s?0>s?0:255:s}function et(e,t,i,a,s,r){Qe(e,t,0,i,a+s),Qe(e,t,1,i,a+r),Qe(e,t,2,i,a-r),Qe(e,t,3,i,a-s)}function tt(e){return(20091*e>>16)+e}function it(e,t,i,a){var s,n=0,o=r(16);for(s=0;4>s;++s){var l=e[t+0]+e[t+8],c=e[t+0]-e[t+8],d=(35468*e[t+4]>>16)-tt(e[t+12]),u=tt(e[t+4])+(35468*e[t+12]>>16);o[n+0]=l+u,o[n+1]=c+d,o[n+2]=c-d,o[n+3]=l-u,n+=4,t++}for(s=n=0;4>s;++s)l=(e=o[n+0]+4)+o[n+8],c=e-o[n+8],d=(35468*o[n+4]>>16)-tt(o[n+12]),Qe(i,a,0,0,l+(u=tt(o[n+4])+(35468*o[n+12]>>16))),Qe(i,a,1,0,c+d),Qe(i,a,2,0,c-d),Qe(i,a,3,0,l-u),n++,a+=32}function at(e,t,i,a){var s=e[t+0]+4,r=35468*e[t+4]>>16,n=tt(e[t+4]),o=35468*e[t+1]>>16;et(i,a,0,s+n,e=tt(e[t+1]),o),et(i,a,1,s+r,e,o),et(i,a,2,s-r,e,o),et(i,a,3,s-n,e,o)}function st(e,t,i,a,s){it(e,t,i,a),s&&it(e,t+16,i,a+4)}function rt(e,t,i,a){sa(e,t+0,i,a,1),sa(e,t+32,i,a+128,1)}function nt(e,t,i,a){var s;for(e=e[t+0]+4,s=0;4>s;++s)for(t=0;4>t;++t)Qe(i,a,t,s,e)}function ot(e,t,i,a){e[t+0]&&oa(e,t+0,i,a),e[t+16]&&oa(e,t+16,i,a+4),e[t+32]&&oa(e,t+32,i,a+128),e[t+48]&&oa(e,t+48,i,a+128+4)}function lt(e,t,i,a){var s,n=r(16);for(s=0;4>s;++s){var o=e[t+0+s]+e[t+12+s],l=e[t+4+s]+e[t+8+s],c=e[t+4+s]-e[t+8+s],d=e[t+0+s]-e[t+12+s];n[0+s]=o+l,n[8+s]=o-l,n[4+s]=d+c,n[12+s]=d-c}for(s=0;4>s;++s)o=(e=n[0+4*s]+3)+n[3+4*s],l=n[1+4*s]+n[2+4*s],c=n[1+4*s]-n[2+4*s],d=e-n[3+4*s],i[a+0]=o+l>>3,i[a+16]=d+c>>3,i[a+32]=o-l>>3,i[a+48]=d-c>>3,a+=64}function ct(e,t,i){var a,s=t-32,r=Pa,n=255-e[s-1];for(a=0;a<i;++a){var o,l=r,c=n+e[t-1];for(o=0;o<i;++o)e[t+o]=l[c+e[s+o]];t+=32}}function dt(e,t){ct(e,t,4)}function ut(e,t){ct(e,t,8)}function ht(e,t){ct(e,t,16)}function mt(e,t){var i;for(i=0;16>i;++i)a(e,t+32*i,e,t-32,16)}function pt(e,t){var i;for(i=16;0<i;--i)s(e,t,e[t-1],16),t+=32}function ft(e,t,i){var a;for(a=0;16>a;++a)s(t,i+32*a,e,16)}function gt(e,t){var i,a=16;for(i=0;16>i;++i)a+=e[t-1+32*i]+e[t+i-32];ft(a>>5,e,t)}function xt(e,t){var i,a=8;for(i=0;16>i;++i)a+=e[t-1+32*i];ft(a>>4,e,t)}function bt(e,t){var i,a=8;for(i=0;16>i;++i)a+=e[t+i-32];ft(a>>4,e,t)}function vt(e,t){ft(128,e,t)}function yt(e,t,i){return e+2*t+i+2>>2}function wt(e,t){var i,s=t-32;for(s=new Uint8Array([yt(e[s-1],e[s+0],e[s+1]),yt(e[s+0],e[s+1],e[s+2]),yt(e[s+1],e[s+2],e[s+3]),yt(e[s+2],e[s+3],e[s+4])]),i=0;4>i;++i)a(e,t+32*i,s,0,s.length)}function Nt(e,t){var i=e[t-1],a=e[t-1+32],s=e[t-1+64],r=e[t-1+96];z(e,t+0,16843009*yt(e[t-1-32],i,a)),z(e,t+32,16843009*yt(i,a,s)),z(e,t+64,16843009*yt(a,s,r)),z(e,t+96,16843009*yt(s,r,r))}function jt(e,t){var i,a=4;for(i=0;4>i;++i)a+=e[t+i-32]+e[t-1+32*i];for(a>>=3,i=0;4>i;++i)s(e,t+32*i,a,4)}function St(e,t){var i=e[t-1+0],a=e[t-1+32],s=e[t-1+64],r=e[t-1-32],n=e[t+0-32],o=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+96]=yt(a,s,e[t-1+96]),e[t+1+96]=e[t+0+64]=yt(i,a,s),e[t+2+96]=e[t+1+64]=e[t+0+32]=yt(r,i,a),e[t+3+96]=e[t+2+64]=e[t+1+32]=e[t+0+0]=yt(n,r,i),e[t+3+64]=e[t+2+32]=e[t+1+0]=yt(o,n,r),e[t+3+32]=e[t+2+0]=yt(l,o,n),e[t+3+0]=yt(c,l,o)}function _t(e,t){var i=e[t+1-32],a=e[t+2-32],s=e[t+3-32],r=e[t+4-32],n=e[t+5-32],o=e[t+6-32],l=e[t+7-32];e[t+0+0]=yt(e[t+0-32],i,a),e[t+1+0]=e[t+0+32]=yt(i,a,s),e[t+2+0]=e[t+1+32]=e[t+0+64]=yt(a,s,r),e[t+3+0]=e[t+2+32]=e[t+1+64]=e[t+0+96]=yt(s,r,n),e[t+3+32]=e[t+2+64]=e[t+1+96]=yt(r,n,o),e[t+3+64]=e[t+2+96]=yt(n,o,l),e[t+3+96]=yt(o,l,l)}function kt(e,t){var i=e[t-1+0],a=e[t-1+32],s=e[t-1+64],r=e[t-1-32],n=e[t+0-32],o=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+0]=e[t+1+64]=r+n+1>>1,e[t+1+0]=e[t+2+64]=n+o+1>>1,e[t+2+0]=e[t+3+64]=o+l+1>>1,e[t+3+0]=l+c+1>>1,e[t+0+96]=yt(s,a,i),e[t+0+64]=yt(a,i,r),e[t+0+32]=e[t+1+96]=yt(i,r,n),e[t+1+32]=e[t+2+96]=yt(r,n,o),e[t+2+32]=e[t+3+96]=yt(n,o,l),e[t+3+32]=yt(o,l,c)}function Ct(e,t){var i=e[t+0-32],a=e[t+1-32],s=e[t+2-32],r=e[t+3-32],n=e[t+4-32],o=e[t+5-32],l=e[t+6-32],c=e[t+7-32];e[t+0+0]=i+a+1>>1,e[t+1+0]=e[t+0+64]=a+s+1>>1,e[t+2+0]=e[t+1+64]=s+r+1>>1,e[t+3+0]=e[t+2+64]=r+n+1>>1,e[t+0+32]=yt(i,a,s),e[t+1+32]=e[t+0+96]=yt(a,s,r),e[t+2+32]=e[t+1+96]=yt(s,r,n),e[t+3+32]=e[t+2+96]=yt(r,n,o),e[t+3+64]=yt(n,o,l),e[t+3+96]=yt(o,l,c)}function At(e,t){var i=e[t-1+0],a=e[t-1+32],s=e[t-1+64],r=e[t-1+96];e[t+0+0]=i+a+1>>1,e[t+2+0]=e[t+0+32]=a+s+1>>1,e[t+2+32]=e[t+0+64]=s+r+1>>1,e[t+1+0]=yt(i,a,s),e[t+3+0]=e[t+1+32]=yt(a,s,r),e[t+3+32]=e[t+1+64]=yt(s,r,r),e[t+3+64]=e[t+2+64]=e[t+0+96]=e[t+1+96]=e[t+2+96]=e[t+3+96]=r}function zt(e,t){var i=e[t-1+0],a=e[t-1+32],s=e[t-1+64],r=e[t-1+96],n=e[t-1-32],o=e[t+0-32],l=e[t+1-32],c=e[t+2-32];e[t+0+0]=e[t+2+32]=i+n+1>>1,e[t+0+32]=e[t+2+64]=a+i+1>>1,e[t+0+64]=e[t+2+96]=s+a+1>>1,e[t+0+96]=r+s+1>>1,e[t+3+0]=yt(o,l,c),e[t+2+0]=yt(n,o,l),e[t+1+0]=e[t+3+32]=yt(i,n,o),e[t+1+32]=e[t+3+64]=yt(a,i,n),e[t+1+64]=e[t+3+96]=yt(s,a,i),e[t+1+96]=yt(r,s,a)}function Et(e,t){var i;for(i=0;8>i;++i)a(e,t+32*i,e,t-32,8)}function It(e,t){var i;for(i=0;8>i;++i)s(e,t,e[t-1],8),t+=32}function Pt(e,t,i){var a;for(a=0;8>a;++a)s(t,i+32*a,e,8)}function Tt(e,t){var i,a=8;for(i=0;8>i;++i)a+=e[t+i-32]+e[t-1+32*i];Pt(a>>4,e,t)}function Mt(e,t){var i,a=4;for(i=0;8>i;++i)a+=e[t+i-32];Pt(a>>3,e,t)}function Lt(e,t){var i,a=4;for(i=0;8>i;++i)a+=e[t-1+32*i];Pt(a>>3,e,t)}function Ft(e,t){Pt(128,e,t)}function Ot(e,t,i){var a=e[t-i],s=e[t+0],r=3*(s-a)+Ea[1020+e[t-2*i]-e[t+i]],n=Ia[112+(r+4>>3)];e[t-i]=Pa[255+a+Ia[112+(r+3>>3)]],e[t+0]=Pa[255+s-n]}function Dt(e,t,i,a){var s=e[t+0],r=e[t+i];return Ta[255+e[t-2*i]-e[t-i]]>a||Ta[255+r-s]>a}function Rt(e,t,i,a){return 4*Ta[255+e[t-i]-e[t+0]]+Ta[255+e[t-2*i]-e[t+i]]<=a}function Bt(e,t,i,a,s){var r=e[t-3*i],n=e[t-2*i],o=e[t-i],l=e[t+0],c=e[t+i],d=e[t+2*i],u=e[t+3*i];return 4*Ta[255+o-l]+Ta[255+n-c]>a?0:Ta[255+e[t-4*i]-r]<=s&&Ta[255+r-n]<=s&&Ta[255+n-o]<=s&&Ta[255+u-d]<=s&&Ta[255+d-c]<=s&&Ta[255+c-l]<=s}function Ut(e,t,i,a){var s=2*a+1;for(a=0;16>a;++a)Rt(e,t+a,i,s)&&Ot(e,t+a,i)}function qt(e,t,i,a){var s=2*a+1;for(a=0;16>a;++a)Rt(e,t+a*i,1,s)&&Ot(e,t+a*i,1)}function $t(e,t,i,a){var s;for(s=3;0<s;--s)Ut(e,t+=4*i,i,a)}function Wt(e,t,i,a){var s;for(s=3;0<s;--s)qt(e,t+=4,i,a)}function Ht(e,t,i,a,s,r,n,o){for(r=2*r+1;0<s--;){if(Bt(e,t,i,r,n))if(Dt(e,t,i,o))Ot(e,t,i);else{var l=e,c=t,d=i,u=l[c-2*d],h=l[c-d],m=l[c+0],p=l[c+d],f=l[c+2*d],g=27*(b=Ea[1020+3*(m-h)+Ea[1020+u-p]])+63>>7,x=18*b+63>>7,b=9*b+63>>7;l[c-3*d]=Pa[255+l[c-3*d]+b],l[c-2*d]=Pa[255+u+x],l[c-d]=Pa[255+h+g],l[c+0]=Pa[255+m-g],l[c+d]=Pa[255+p-x],l[c+2*d]=Pa[255+f-b]}t+=a}}function Zt(e,t,i,a,s,r,n,o){for(r=2*r+1;0<s--;){if(Bt(e,t,i,r,n))if(Dt(e,t,i,o))Ot(e,t,i);else{var l=e,c=t,d=i,u=l[c-d],h=l[c+0],m=l[c+d],p=Ia[112+(4+(f=3*(h-u))>>3)],f=Ia[112+(f+3>>3)],g=p+1>>1;l[c-2*d]=Pa[255+l[c-2*d]+g],l[c-d]=Pa[255+u+f],l[c+0]=Pa[255+h-p],l[c+d]=Pa[255+m-g]}t+=a}}function Vt(e,t,i,a,s,r){Ht(e,t,i,1,16,a,s,r)}function Gt(e,t,i,a,s,r){Ht(e,t,1,i,16,a,s,r)}function Yt(e,t,i,a,s,r){var n;for(n=3;0<n;--n)Zt(e,t+=4*i,i,1,16,a,s,r)}function Kt(e,t,i,a,s,r){var n;for(n=3;0<n;--n)Zt(e,t+=4,1,i,16,a,s,r)}function Xt(e,t,i,a,s,r,n,o){Ht(e,t,s,1,8,r,n,o),Ht(i,a,s,1,8,r,n,o)}function Jt(e,t,i,a,s,r,n,o){Ht(e,t,1,s,8,r,n,o),Ht(i,a,1,s,8,r,n,o)}function Qt(e,t,i,a,s,r,n,o){Zt(e,t+4*s,s,1,8,r,n,o),Zt(i,a+4*s,s,1,8,r,n,o)}function ei(e,t,i,a,s,r,n,o){Zt(e,t+4,1,s,8,r,n,o),Zt(i,a+4,1,s,8,r,n,o)}function ti(){this.ba=new ne,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new le,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function ii(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ai(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function si(){this.ua=0,this.Wa=new L,this.vb=new L,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new m,this.yc=new u}function ri(){this.xb=this.a=0,this.l=new Ze,this.ca=new ne,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new w,this.Pb=0,this.wd=new w,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new si,this.ab=0,this.gc=n(4,ai),this.Oc=0}function ni(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Ze,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function oi(e,t,i,a,s,r,n){for(e=null==e?0:e[t+0],t=0;t<n;++t)s[r+t]=e+i[a+t]&255,e=s[r+t]}function li(e,t,i,a,s,r,n){var o;if(null==e)oi(null,null,i,a,s,r,n);else for(o=0;o<n;++o)s[r+o]=e[t+o]+i[a+o]&255}function ci(e,t,i,a,s,r,n){if(null==e)oi(null,null,i,a,s,r,n);else{var o,l=e[t+0],c=l,d=l;for(o=0;o<n;++o)c=d+(l=e[t+o])-c,d=i[a+o]+(-256&c?0>c?0:255:c)&255,c=l,s[r+o]=d}}function di(e,i,s,n){var o=i.width,l=i.o;if(t(null!=e&&null!=i),0>s||0>=n||s+n>l)return null;if(!e.Cc){if(null==e.ga){var c;if(e.ga=new ni,(c=null==e.ga)||(c=i.width*i.o,t(0==e.Gb.length),e.Gb=r(c),e.Uc=0,null==e.Gb?c=0:(e.mb=e.Gb,e.nb=e.Uc,e.rc=null,c=1),c=!c),!c){c=e.ga;var d=e.Fa,u=e.P,h=e.qc,m=e.mb,p=e.nb,f=u+1,g=h-1,b=c.l;if(t(null!=d&&null!=m&&null!=i),ps[0]=null,ps[1]=oi,ps[2]=li,ps[3]=ci,c.ca=m,c.tb=p,c.c=i.width,c.i=i.height,t(0<c.c&&0<c.i),1>=h)i=0;else if(c.$a=3&d[u+0],c.Z=d[u+0]>>2&3,c.Lc=d[u+0]>>4&3,u=d[u+0]>>6&3,0>c.$a||1<c.$a||4<=c.Z||1<c.Lc||u)i=0;else if(b.put=me,b.ac=he,b.bc=pe,b.ma=c,b.width=i.width,b.height=i.height,b.Da=i.Da,b.v=i.v,b.va=i.va,b.j=i.j,b.o=i.o,c.$a)e:{t(1==c.$a),i=Ae();t:for(;;){if(null==i){i=0;break e}if(t(null!=c),c.mc=i,i.c=c.c,i.i=c.i,i.l=c.l,i.l.ma=c,i.l.width=c.c,i.l.height=c.i,i.a=0,x(i.m,d,f,g),!ze(c.c,c.i,1,i,null))break t;if(1==i.ab&&3==i.gc[0].hc&&je(i.s)?(c.ic=1,d=i.c*i.i,i.Ta=null,i.Ua=0,i.V=r(d),i.Ba=0,null==i.V?(i.a=1,i=0):i=1):(c.ic=0,i=Ee(i,c.c)),!i)break t;i=1;break e}c.mc=null,i=0}else i=g>=c.c*c.i;c=!i}if(c)return null;1!=e.ga.Lc?e.Ga=0:n=l-s}t(null!=e.ga),t(s+n<=l);e:{if(i=(d=e.ga).c,l=d.l.o,0==d.$a){if(f=e.rc,g=e.Vc,b=e.Fa,u=e.P+1+s*i,h=e.mb,m=e.nb+s*i,t(u<=e.P+e.qc),0!=d.Z)for(t(null!=ps[d.Z]),c=0;c<n;++c)ps[d.Z](f,g,b,u,h,m,i),f=h,g=m,m+=i,u+=i;else for(c=0;c<n;++c)a(h,m,b,u,i),f=h,g=m,m+=i,u+=i;e.rc=f,e.Vc=g}else{if(t(null!=d.mc),i=s+n,t(null!=(c=d.mc)),t(i<=c.i),c.C>=i)i=1;else if(d.ic||fi(),d.ic){d=c.V,f=c.Ba,g=c.c;var v=c.i,y=(b=1,u=c.$/g,h=c.$%g,m=c.m,p=c.s,c.$),w=g*v,N=g*i,S=p.wc,k=y<N?ye(p,h,u):null;t(y<=w),t(i<=v),t(je(p));t:for(;;){for(;!m.h&&y<N;){if(h&S||(k=ye(p,h,u)),t(null!=k),_(m),256>(v=be(k.G[0],k.H[0],m)))d[f+y]=v,++y,++h>=g&&(h=0,++u<=i&&!(u%16)&&_e(c,u));else{if(!(280>v)){b=0;break t}v=ge(v-256,m);var C,A=be(k.G[4],k.H[4],m);if(_(m),!(y>=(A=xe(g,A=ge(A,m)))&&w-y>=v)){b=0;break t}for(C=0;C<v;++C)d[f+y+C]=d[f+y+C-A];for(y+=v,h+=v;h>=g;)h-=g,++u<=i&&!(u%16)&&_e(c,u);y<N&&h&S&&(k=ye(p,h,u))}t(m.h==j(m))}_e(c,u>i?i:u);break t}!b||m.h&&y<w?(b=0,c.a=m.h?5:3):c.$=y,i=b}else i=ke(c,c.V,c.Ba,c.c,c.i,i,Ie);if(!i){n=0;break e}}s+n>=l&&(e.Cc=1),n=1}if(!n)return null;if(e.Cc&&(null!=(n=e.ga)&&(n.mc=null),e.ga=null,0<e.Ga))return alert("todo:WebPDequantizeLevels"),null}return e.nb+s*o}function ui(e,t,i,a,s,r){for(;0<s--;){var n,o=e,l=t+(i?1:0),c=e,d=t+(i?0:3);for(n=0;n<a;++n){var u=c[d+4*n];255!=u&&(u*=32897,o[l+4*n+0]=o[l+4*n+0]*u>>23,o[l+4*n+1]=o[l+4*n+1]*u>>23,o[l+4*n+2]=o[l+4*n+2]*u>>23)}t+=r}}function hi(e,t,i,a,s){for(;0<a--;){var r;for(r=0;r<i;++r){var n=e[t+2*r+0],o=15&(c=e[t+2*r+1]),l=4369*o,c=(240&c|c>>4)*l>>16;e[t+2*r+0]=(240&n|n>>4)*l>>16&240|(15&n|n<<4)*l>>16>>4&15,e[t+2*r+1]=240&c|o}t+=s}}function mi(e,t,i,a,s,r,n,o){var l,c,d=255;for(c=0;c<s;++c){for(l=0;l<a;++l){var u=e[t+l];r[n+4*l]=u,d&=u}t+=i,n+=o}return 255!=d}function pi(e,t,i,a,s){var r;for(r=0;r<s;++r)i[a+r]=e[t+r]>>8}function fi(){wa=ui,Na=hi,ja=mi,Sa=pi}function gi(i,a,s){e[i]=function(e,i,r,n,o,l,c,d,u,h,m,p,f,g,x,b,v){var y,w=v-1>>1,N=o[l+0]|c[d+0]<<16,j=u[h+0]|m[p+0]<<16;t(null!=e);var S=3*N+j+131074>>2;for(a(e[i+0],255&S,S>>16,f,g),null!=r&&(S=3*j+N+131074>>2,a(r[n+0],255&S,S>>16,x,b)),y=1;y<=w;++y){var _=o[l+y]|c[d+y]<<16,k=u[h+y]|m[p+y]<<16,C=N+_+j+k+524296,A=C+2*(_+j)>>3;S=A+N>>1,N=(C=C+2*(N+k)>>3)+_>>1,a(e[i+2*y-1],255&S,S>>16,f,g+(2*y-1)*s),a(e[i+2*y-0],255&N,N>>16,f,g+(2*y-0)*s),null!=r&&(S=C+j>>1,N=A+k>>1,a(r[n+2*y-1],255&S,S>>16,x,b+(2*y-1)*s),a(r[n+2*y+0],255&N,N>>16,x,b+(2*y+0)*s)),N=_,j=k}1&v||(S=3*N+j+131074>>2,a(e[i+v-1],255&S,S>>16,f,g+(v-1)*s),null!=r&&(S=3*j+N+131074>>2,a(r[n+v-1],255&S,S>>16,x,b+(v-1)*s)))}}function xi(){fs[Ma]=gs,fs[La]=bs,fs[Fa]=xs,fs[Oa]=vs,fs[Da]=ys,fs[Ra]=ws,fs[Ba]=Ns,fs[Ua]=bs,fs[qa]=vs,fs[$a]=ys,fs[Wa]=ws}function bi(e){return-16384&e?0>e?0:255:e>>Cs}function vi(e,t){return bi((19077*e>>8)+(26149*t>>8)-14234)}function yi(e,t,i){return bi((19077*e>>8)-(6419*t>>8)-(13320*i>>8)+8708)}function wi(e,t){return bi((19077*e>>8)+(33050*t>>8)-17685)}function Ni(e,t,i,a,s){a[s+0]=vi(e,i),a[s+1]=yi(e,t,i),a[s+2]=wi(e,t)}function ji(e,t,i,a,s){a[s+0]=wi(e,t),a[s+1]=yi(e,t,i),a[s+2]=vi(e,i)}function Si(e,t,i,a,s){var r=yi(e,t,i);t=r<<3&224|wi(e,t)>>3,a[s+0]=248&vi(e,i)|r>>5,a[s+1]=t}function _i(e,t,i,a,s){var r=240&wi(e,t)|15;a[s+0]=240&vi(e,i)|yi(e,t,i)>>4,a[s+1]=r}function ki(e,t,i,a,s){a[s+0]=255,Ni(e,t,i,a,s+1)}function Ci(e,t,i,a,s){ji(e,t,i,a,s),a[s+3]=255}function Ai(e,t,i,a,s){Ni(e,t,i,a,s),a[s+3]=255}function He(e,t){return 0>e?0:e>t?t:e}function zi(t,i,a){e[t]=function(e,t,s,r,n,o,l,c,d){for(var u=c+(-2&d)*a;c!=u;)i(e[t+0],s[r+0],n[o+0],l,c),i(e[t+1],s[r+0],n[o+0],l,c+a),t+=2,++r,++o,c+=2*a;1&d&&i(e[t+0],s[r+0],n[o+0],l,c)}}function Ei(e,t,i){return 0==i?0==e?0==t?6:5:0==t?4:0:i}function Ii(e,t,i,a,s){switch(e>>>30){case 3:sa(t,i,a,s,0);break;case 2:ra(t,i,a,s);break;case 1:oa(t,i,a,s)}}function Pi(e,t){var i,r,n=t.M,o=t.Nb,l=e.oc,c=e.pc+40,d=e.oc,u=e.pc+584,h=e.oc,m=e.pc+600;for(i=0;16>i;++i)l[c+32*i-1]=129;for(i=0;8>i;++i)d[u+32*i-1]=129,h[m+32*i-1]=129;for(0<n?l[c-1-32]=d[u-1-32]=h[m-1-32]=129:(s(l,c-32-1,127,21),s(d,u-32-1,127,9),s(h,m-32-1,127,9)),r=0;r<e.za;++r){var p=t.ya[t.aa+r];if(0<r){for(i=-1;16>i;++i)a(l,c+32*i-4,l,c+32*i+12,4);for(i=-1;8>i;++i)a(d,u+32*i-4,d,u+32*i+4,4),a(h,m+32*i-4,h,m+32*i+4,4)}var f=e.Gd,g=e.Hd+r,x=p.ad,b=p.Hc;if(0<n&&(a(l,c-32,f[g].y,0,16),a(d,u-32,f[g].f,0,8),a(h,m-32,f[g].ea,0,8)),p.Za){var v=l,y=c-32+16;for(0<n&&(r>=e.za-1?s(v,y,f[g].y[15],4):a(v,y,f[g+1].y,0,4)),i=0;4>i;i++)v[y+128+i]=v[y+256+i]=v[y+384+i]=v[y+0+i];for(i=0;16>i;++i,b<<=2)v=l,y=c+Ls[i],ds[p.Ob[i]](v,y),Ii(b,x,16*+i,v,y)}else if(v=Ei(r,n,p.Ob[0]),cs[v](l,c),0!=b)for(i=0;16>i;++i,b<<=2)Ii(b,x,16*+i,l,c+Ls[i]);for(i=p.Gc,v=Ei(r,n,p.Dd),us[v](d,u),us[v](h,m),b=x,v=d,y=u,255&(p=0|i)&&(170&p?na(b,256,v,y):la(b,256,v,y)),p=h,b=m,255&(i>>=8)&&(170&i?na(x,320,p,b):la(x,320,p,b)),n<e.Ub-1&&(a(f[g].y,0,l,c+480,16),a(f[g].f,0,d,u+224,8),a(f[g].ea,0,h,m+224,8)),i=8*o*e.B,f=e.sa,g=e.ta+16*r+16*o*e.R,x=e.qa,p=e.ra+8*r+i,b=e.Ha,v=e.Ia+8*r+i,i=0;16>i;++i)a(f,g+i*e.R,l,c+32*i,16);for(i=0;8>i;++i)a(x,p+i*e.B,d,u+32*i,8),a(b,v+i*e.B,h,m+32*i,8)}}function Ti(e,a,s,r,n,o,l,c,d){var u=[0],h=[0],m=0,p=null!=d?d.kd:0,f=null!=d?d:new ii;if(null==e||12>s)return 7;f.data=e,f.w=a,f.ha=s,a=[a],s=[s],f.gb=[f.gb];e:{var g=a,b=s,v=f.gb;if(t(null!=e),t(null!=b),t(null!=v),v[0]=0,12<=b[0]&&!i(e,g[0],"RIFF")){if(i(e,g[0]+8,"WEBP")){v=3;break e}var y=P(e,g[0]+4);if(12>y||4294967286<y){v=3;break e}if(p&&y>b[0]-8){v=7;break e}v[0]=y,g[0]+=12,b[0]-=12}v=0}if(0!=v)return v;for(y=0<f.gb[0],s=s[0];;){e:{var N=e;b=a,v=s;var j=u,S=h,_=g=[0];if((A=m=[m])[0]=0,8>v[0])v=7;else{if(!i(N,b[0],"VP8X")){if(10!=P(N,b[0]+4)){v=3;break e}if(18>v[0]){v=7;break e}var k=P(N,b[0]+8),C=1+I(N,b[0]+12);if(2147483648<=C*(N=1+I(N,b[0]+15))){v=3;break e}null!=_&&(_[0]=k),null!=j&&(j[0]=C),null!=S&&(S[0]=N),b[0]+=18,v[0]-=18,A[0]=1}v=0}}if(m=m[0],g=g[0],0!=v)return v;if(b=!!(2&g),!y&&m)return 3;if(null!=o&&(o[0]=!!(16&g)),null!=l&&(l[0]=b),null!=c&&(c[0]=0),l=u[0],g=h[0],m&&b&&null==d){v=0;break}if(4>s){v=7;break}if(y&&m||!y&&!m&&!i(e,a[0],"ALPH")){s=[s],f.na=[f.na],f.P=[f.P],f.Sa=[f.Sa];e:{k=e,v=a,y=s;var A=f.gb;j=f.na,S=f.P,_=f.Sa,C=22,t(null!=k),t(null!=y),N=v[0];var z=y[0];for(t(null!=j),t(null!=_),j[0]=null,S[0]=null,_[0]=0;;){if(v[0]=N,y[0]=z,8>z){v=7;break e}var E=P(k,N+4);if(4294967286<E){v=3;break e}var T=8+E+1&-2;if(C+=T,0<A&&C>A){v=3;break e}if(!i(k,N,"VP8 ")||!i(k,N,"VP8L")){v=0;break e}if(z[0]<T){v=7;break e}i(k,N,"ALPH")||(j[0]=k,S[0]=N+8,_[0]=E),N+=T,z-=T}}if(s=s[0],f.na=f.na[0],f.P=f.P[0],f.Sa=f.Sa[0],0!=v)break}s=[s],f.Ja=[f.Ja],f.xa=[f.xa];e:if(A=e,v=a,y=s,j=f.gb[0],S=f.Ja,_=f.xa,k=v[0],N=!i(A,k,"VP8 "),C=!i(A,k,"VP8L"),t(null!=A),t(null!=y),t(null!=S),t(null!=_),8>y[0])v=7;else{if(N||C){if(A=P(A,k+4),12<=j&&A>j-12){v=3;break e}if(p&&A>y[0]-8){v=7;break e}S[0]=A,v[0]+=8,y[0]-=8,_[0]=C}else _[0]=5<=y[0]&&47==A[k+0]&&!(A[k+4]>>5),S[0]=y[0];v=0}if(s=s[0],f.Ja=f.Ja[0],f.xa=f.xa[0],a=a[0],0!=v)break;if(4294967286<f.Ja)return 3;if(null==c||b||(c[0]=f.xa?2:1),l=[l],g=[g],f.xa){if(5>s){v=7;break}c=l,p=g,b=o,null==e||5>s?e=0:5<=s&&47==e[a+0]&&!(e[a+4]>>5)?(y=[0],A=[0],j=[0],x(S=new w,e,a,s),fe(S,y,A,j)?(null!=c&&(c[0]=y[0]),null!=p&&(p[0]=A[0]),null!=b&&(b[0]=j[0]),e=1):e=0):e=0}else{if(10>s){v=7;break}c=g,null==e||10>s||!Ye(e,a+3,s-3)?e=0:(p=e[a+0]|e[a+1]<<8|e[a+2]<<16,b=16383&(e[a+7]<<8|e[a+6]),e=16383&(e[a+9]<<8|e[a+8]),1&p||3<(p>>1&7)||!(p>>4&1)||p>>5>=f.Ja||!b||!e?e=0:(l&&(l[0]=b),c&&(c[0]=e),e=1))}if(!e)return 3;if(l=l[0],g=g[0],m&&(u[0]!=l||h[0]!=g))return 3;null!=d&&(d[0]=f,d.offset=a-d.w,t(4294967286>a-d.w),t(d.offset==d.ha-s));break}return 0==v||7==v&&m&&null==d?(null!=o&&(o[0]|=null!=f.na&&0<f.na.length),null!=r&&(r[0]=l),null!=n&&(n[0]=g),0):v}function Mi(e,t,i){var a=t.width,s=t.height,r=0,n=0,o=a,l=s;if(t.Da=null!=e&&0<e.Da,t.Da&&(o=e.cd,l=e.bd,r=e.v,n=e.j,11>i||(r&=-2,n&=-2),0>r||0>n||0>=o||0>=l||r+o>a||n+l>s))return 0;if(t.v=r,t.j=n,t.va=r+o,t.o=n+l,t.U=o,t.T=l,t.da=null!=e&&0<e.da,t.da){if(!F(o,l,i=[e.ib],r=[e.hb]))return 0;t.ib=i[0],t.hb=r[0]}return t.ob=null!=e&&e.ob,t.Kb=null==e||!e.Sd,t.da&&(t.ob=t.ib<3*a/4&&t.hb<3*s/4,t.Kb=0),1}function Li(e){if(null==e)return 2;if(11>e.S){var t=e.f.RGBA;t.fb+=(e.height-1)*t.A,t.A=-t.A}else t=e.f.kb,e=e.height,t.O+=(e-1)*t.fa,t.fa=-t.fa,t.N+=(e-1>>1)*t.Ab,t.Ab=-t.Ab,t.W+=(e-1>>1)*t.Db,t.Db=-t.Db,null!=t.F&&(t.J+=(e-1)*t.lb,t.lb=-t.lb);return 0}function Fi(e,t,i,a){if(null==a||0>=e||0>=t)return 2;if(null!=i){if(i.Da){var s=i.cd,n=i.bd,o=-2&i.v,l=-2&i.j;if(0>o||0>l||0>=s||0>=n||o+s>e||l+n>t)return 2;e=s,t=n}if(i.da){if(!F(e,t,s=[i.ib],n=[i.hb]))return 2;e=s[0],t=n[0]}}a.width=e,a.height=t;e:{var c=a.width,d=a.height;if(e=a.S,0>=c||0>=d||!(e>=Ma&&13>e))e=2;else{if(0>=a.Rd&&null==a.sd){o=n=s=t=0;var u=(l=c*Ds[e])*d;if(11>e||(n=(d+1)/2*(t=(c+1)/2),12==e&&(o=(s=c)*d)),null==(d=r(u+2*n+o))){e=1;break e}a.sd=d,11>e?((c=a.f.RGBA).eb=d,c.fb=0,c.A=l,c.size=u):((c=a.f.kb).y=d,c.O=0,c.fa=l,c.Fd=u,c.f=d,c.N=0+u,c.Ab=t,c.Cd=n,c.ea=d,c.W=0+u+n,c.Db=t,c.Ed=n,12==e&&(c.F=d,c.J=0+u+2*n),c.Tc=o,c.lb=s)}if(t=1,s=a.S,n=a.width,o=a.height,s>=Ma&&13>s)if(11>s)e=a.f.RGBA,t&=(l=Math.abs(e.A))*(o-1)+n<=e.size,t&=l>=n*Ds[s],t&=null!=e.eb;else{e=a.f.kb,l=(n+1)/2,u=(o+1)/2,c=Math.abs(e.fa),d=Math.abs(e.Ab);var h=Math.abs(e.Db),m=Math.abs(e.lb),p=m*(o-1)+n;t&=c*(o-1)+n<=e.Fd,t&=d*(u-1)+l<=e.Cd,t=(t&=h*(u-1)+l<=e.Ed)&c>=n&d>=l&h>=l,t&=null!=e.y,t&=null!=e.f,t&=null!=e.ea,12==s&&(t&=m>=n,t&=p<=e.Tc,t&=null!=e.F)}else t=0;e=t?0:2}}return 0!=e||null!=i&&i.fd&&(e=Li(a)),e}var Oi=64,Di=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Ri=24,Bi=32,Ui=8,qi=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];R("Predictor0","PredictorAdd0"),e.Predictor0=function(){return 4278190080},e.Predictor1=function(e){return e},e.Predictor2=function(e,t,i){return t[i+0]},e.Predictor3=function(e,t,i){return t[i+1]},e.Predictor4=function(e,t,i){return t[i-1]},e.Predictor5=function(e,t,i){return U(U(e,t[i+1]),t[i+0])},e.Predictor6=function(e,t,i){return U(e,t[i-1])},e.Predictor7=function(e,t,i){return U(e,t[i+0])},e.Predictor8=function(e,t,i){return U(t[i-1],t[i+0])},e.Predictor9=function(e,t,i){return U(t[i+0],t[i+1])},e.Predictor10=function(e,t,i){return U(U(e,t[i-1]),U(t[i+0],t[i+1]))},e.Predictor11=function(e,t,i){var a=t[i+0];return 0>=W(a>>24&255,e>>24&255,(t=t[i-1])>>24&255)+W(a>>16&255,e>>16&255,t>>16&255)+W(a>>8&255,e>>8&255,t>>8&255)+W(255&a,255&e,255&t)?a:e},e.Predictor12=function(e,t,i){var a=t[i+0];return(q((e>>24&255)+(a>>24&255)-((t=t[i-1])>>24&255))<<24|q((e>>16&255)+(a>>16&255)-(t>>16&255))<<16|q((e>>8&255)+(a>>8&255)-(t>>8&255))<<8|q((255&e)+(255&a)-(255&t)))>>>0},e.Predictor13=function(e,t,i){var a=t[i-1];return($((e=U(e,t[i+0]))>>24&255,a>>24&255)<<24|$(e>>16&255,a>>16&255)<<16|$(e>>8&255,a>>8&255)<<8|$(255&e,255&a))>>>0};var $i=e.PredictorAdd0;e.PredictorAdd1=H,R("Predictor2","PredictorAdd2"),R("Predictor3","PredictorAdd3"),R("Predictor4","PredictorAdd4"),R("Predictor5","PredictorAdd5"),R("Predictor6","PredictorAdd6"),R("Predictor7","PredictorAdd7"),R("Predictor8","PredictorAdd8"),R("Predictor9","PredictorAdd9"),R("Predictor10","PredictorAdd10"),R("Predictor11","PredictorAdd11"),R("Predictor12","PredictorAdd12"),R("Predictor13","PredictorAdd13");var Wi=e.PredictorAdd2;Y("ColorIndexInverseTransform","MapARGB","32b",function(e){return e>>8&255},function(e){return e}),Y("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(e){return e},function(e){return e>>8&255});var Hi,Zi=e.ColorIndexInverseTransform,Vi=e.MapARGB,Gi=e.VP8LColorIndexInverseTransformAlpha,Yi=e.MapAlpha,Ki=e.VP8LPredictorsAdd=[];Ki.length=16,(e.VP8LPredictors=[]).length=16,(e.VP8LPredictorsAdd_C=[]).length=16,(e.VP8LPredictors_C=[]).length=16;var Xi,Ji,Qi,ea,ta,ia,aa,sa,ra,na,oa,la,ca,da,ua,ha,ma,pa,fa,ga,xa,ba,va,ya,wa,Na,ja,Sa,_a=r(511),ka=r(2041),Ca=r(225),Aa=r(767),za=0,Ea=ka,Ia=Ca,Pa=Aa,Ta=_a,Ma=0,La=1,Fa=2,Oa=3,Da=4,Ra=5,Ba=6,Ua=7,qa=8,$a=9,Wa=10,Ha=[2,3,7],Za=[3,3,11],Va=[280,256,256,256,40],Ga=[0,1,1,1,0],Ya=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Ka=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Xa=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Ja=8,Qa=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],es=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ts=null,is=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],as=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ss=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],rs=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],ns=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],os=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],ls=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],cs=[],ds=[],us=[],hs=1,ms=2,ps=[],fs=[];gi("UpsampleRgbLinePair",Ni,3),gi("UpsampleBgrLinePair",ji,3),gi("UpsampleRgbaLinePair",Ai,4),gi("UpsampleBgraLinePair",Ci,4),gi("UpsampleArgbLinePair",ki,4),gi("UpsampleRgba4444LinePair",_i,2),gi("UpsampleRgb565LinePair",Si,2);var gs=e.UpsampleRgbLinePair,xs=e.UpsampleBgrLinePair,bs=e.UpsampleRgbaLinePair,vs=e.UpsampleBgraLinePair,ys=e.UpsampleArgbLinePair,ws=e.UpsampleRgba4444LinePair,Ns=e.UpsampleRgb565LinePair,js=16,Ss=1<<js-1,_s=-227,ks=482,Cs=6,As=0,zs=r(256),Es=r(256),Is=r(256),Ps=r(256),Ts=r(ks-_s),Ms=r(ks-_s);zi("YuvToRgbRow",Ni,3),zi("YuvToBgrRow",ji,3),zi("YuvToRgbaRow",Ai,4),zi("YuvToBgraRow",Ci,4),zi("YuvToArgbRow",ki,4),zi("YuvToRgba4444Row",_i,2),zi("YuvToRgb565Row",Si,2);var Ls=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Fs=[0,2,8],Os=[8,7,6,4,4,2,2,2,1,1,1,1];this.WebPDecodeRGBA=function(e,i,o,l,c){var d=La,u=new ti,h=new ne;u.ba=h,h.S=d,h.width=[h.width],h.height=[h.height];var m=h.width,p=h.height,f=new oe;if(null==f||null==e)var g=2;else t(null!=f),g=Ti(e,i,o,f.width,f.height,f.Pd,f.Qd,f.format,null);if(0!=g?m=0:(null!=m&&(m[0]=f.width[0]),null!=p&&(p[0]=f.height[0]),m=1),m){h.width=h.width[0],h.height=h.height[0],null!=l&&(l[0]=h.width),null!=c&&(c[0]=h.height);e:{if(l=new Ze,(c=new ii).data=e,c.w=i,c.ha=o,c.kd=1,i=[0],t(null!=c),(0==(e=Ti(c.data,c.w,c.ha,null,null,null,i,null,c))||7==e)&&i[0]&&(e=4),0==(i=e)){if(t(null!=u),l.data=c.data,l.w=c.w+c.offset,l.ha=c.ha-c.offset,l.put=me,l.ac=he,l.bc=pe,l.ma=u,c.xa){if(null==(e=Ae())){u=1;break e}if(function(e,i){var a=[0],s=[0],r=[0];t:for(;;){if(null==e)return 0;if(null==i)return e.a=2,0;if(e.l=i,e.a=0,x(e.m,i.data,i.w,i.ha),!fe(e.m,a,s,r)){e.a=3;break t}if(e.xb=ms,i.width=a[0],i.height=s[0],!ze(a[0],s[0],1,e,null))break t;return 1}return t(0!=e.a),0}(e,l)){if(l=0==(i=Fi(l.width,l.height,u.Oa,u.ba))){t:{l=e;i:for(;;){if(null==l){l=0;break t}if(t(null!=l.s.yc),t(null!=l.s.Ya),t(0<l.s.Wb),t(null!=(o=l.l)),t(null!=(c=o.ma)),0!=l.xb){if(l.ca=c.ba,l.tb=c.tb,t(null!=l.ca),!Mi(c.Oa,o,Oa)){l.a=2;break i}if(!Ee(l,o.width))break i;if(o.da)break i;if((o.da||ae(l.ca.S))&&fi(),11>l.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=l.ca.f.kb.F&&fi()),l.Pb&&0<l.s.ua&&null==l.s.vb.X&&!T(l.s.vb,l.s.Wa.Xa)){l.a=1;break i}l.xb=0}if(!ke(l,l.V,l.Ba,l.c,l.i,o.o,Ne))break i;c.Dc=l.Ma,l=1;break t}t(0!=l.a),l=0}l=!l}l&&(i=e.a)}else i=e.a}else{if(null==(e=new Ve)){u=1;break e}if(e.Fa=c.na,e.P=c.P,e.qc=c.Sa,Ke(e,l)){if(0==(i=Fi(l.width,l.height,u.Oa,u.ba))){if(e.Aa=0,o=u.Oa,t(null!=(c=e)),null!=o){if(0<(m=0>(m=o.Md)?0:100<m?255:255*m/100)){for(p=f=0;4>p;++p)12>(g=c.pb[p]).lc&&(g.ia=m*Os[0>g.lc?0:g.lc]>>3),f|=g.ia;f&&(alert("todo:VP8InitRandom"),c.ia=1)}c.Ga=o.Id,100<c.Ga?c.Ga=100:0>c.Ga&&(c.Ga=0)}(function(e,i){if(null==e)return 0;if(null==i)return Ge(e,2,"NULL VP8Io parameter in VP8Decode().");if(!e.cb&&!Ke(e,i))return 0;if(t(e.cb),null==i.ac||i.ac(i)){i.ob&&(e.L=0);var o=Fs[e.L];if(2==e.L?(e.yb=0,e.zb=0):(e.yb=i.v-o>>4,e.zb=i.j-o>>4,0>e.yb&&(e.yb=0),0>e.zb&&(e.zb=0)),e.Va=i.o+15+o>>4,e.Hb=i.va+15+o>>4,e.Hb>e.za&&(e.Hb=e.za),e.Va>e.Ub&&(e.Va=e.Ub),0<e.L){var l=e.ed;for(o=0;4>o;++o){var c;if(e.Qa.Cb){var d=e.Qa.Lb[o];e.Qa.Fb||(d+=l.Tb)}else d=l.Tb;for(c=0;1>=c;++c){var u=e.gd[o][c],h=d;if(l.Pc&&(h+=l.vd[0],c&&(h+=l.od[0])),0<(h=0>h?0:63<h?63:h)){var m=h;0<l.wb&&(m=4<l.wb?m>>2:m>>1)>9-l.wb&&(m=9-l.wb),1>m&&(m=1),u.dd=m,u.tc=2*h+m,u.ld=40<=h?2:15<=h?1:0}else u.tc=0;u.La=c}}}o=0}else Ge(e,6,"Frame setup failed"),o=e.a;if(o=0==o){if(o){e.$c=0,0<e.Aa||(e.Ic=1);t:{o=e.Ic,l=4*(m=e.za);var p=32*m,f=m+1,g=0<e.L?m*(0<e.Aa?2:1):0,x=(2==e.Aa?2:1)*m;if((u=l+832+(c=3*(16*o+Fs[e.L])/2*p)+(d=null!=e.Fa&&0<e.Fa.length?e.Kc.c*e.Kc.i:0))!=u)o=0;else{if(u>e.Vb){if(e.Vb=0,e.Ec=r(u),e.Fc=0,null==e.Ec){o=Ge(e,1,"no memory during frame initialization.");break t}e.Vb=u}u=e.Ec,h=e.Fc,e.Ac=u,e.Bc=h,h+=l,e.Gd=n(p,$e),e.Hd=0,e.rb=n(f+1,Re),e.sb=1,e.wa=g?n(g,De):null,e.Y=0,e.D.Nb=0,e.D.wa=e.wa,e.D.Y=e.Y,0<e.Aa&&(e.D.Y+=m),t(!0),e.oc=u,e.pc=h,h+=832,e.ya=n(x,Ue),e.aa=0,e.D.ya=e.ya,e.D.aa=e.aa,2==e.Aa&&(e.D.aa+=m),e.R=16*m,e.B=8*m,m=(p=Fs[e.L])*e.R,p=p/2*e.B,e.sa=u,e.ta=h+m,e.qa=e.sa,e.ra=e.ta+16*o*e.R+p,e.Ha=e.qa,e.Ia=e.ra+8*o*e.B+p,e.$c=0,h+=c,e.mb=d?u:null,e.nb=d?h:null,t(h+d<=e.Fc+e.Vb),Je(e),s(e.Ac,e.Bc,0,l),o=1}}if(o){if(i.ka=0,i.y=e.sa,i.O=e.ta,i.f=e.qa,i.N=e.ra,i.ea=e.Ha,i.Vd=e.Ia,i.fa=e.R,i.Rc=e.B,i.F=null,i.J=0,!za){for(o=-255;255>=o;++o)_a[255+o]=0>o?-o:o;for(o=-1020;1020>=o;++o)ka[1020+o]=-128>o?-128:127<o?127:o;for(o=-112;112>=o;++o)Ca[112+o]=-16>o?-16:15<o?15:o;for(o=-255;510>=o;++o)Aa[255+o]=0>o?0:255<o?255:o;za=1}aa=lt,sa=st,na=rt,oa=nt,la=ot,ra=at,ca=Vt,da=Gt,ua=Xt,ha=Jt,ma=Yt,pa=Kt,fa=Qt,ga=ei,xa=Ut,ba=qt,va=$t,ya=Wt,ds[0]=jt,ds[1]=dt,ds[2]=wt,ds[3]=Nt,ds[4]=St,ds[5]=kt,ds[6]=_t,ds[7]=Ct,ds[8]=zt,ds[9]=At,cs[0]=gt,cs[1]=ht,cs[2]=mt,cs[3]=pt,cs[4]=xt,cs[5]=bt,cs[6]=vt,us[0]=Tt,us[1]=ut,us[2]=Et,us[3]=It,us[4]=Lt,us[5]=Mt,us[6]=Ft,o=1}else o=0}o&&(o=function(e,i){for(e.M=0;e.M<e.Va;++e.M){var n,o=e.Jc[e.M&e.Xb],l=e.m,c=e;for(n=0;n<c.za;++n){var d=l,u=c,h=u.Ac,m=u.Bc+4*n,p=u.zc,f=u.ya[u.aa+n];if(u.Qa.Bb?f.$b=A(d,u.Pa.jb[0])?2+A(d,u.Pa.jb[2]):A(d,u.Pa.jb[1]):f.$b=0,u.kc&&(f.Ad=A(d,u.Bd)),f.Za=!A(d,145)+0,f.Za){var g=f.Ob,x=0;for(u=0;4>u;++u){var b,v=p[0+u];for(b=0;4>b;++b){v=ns[h[m+b]][v];for(var y=ss[A(d,v[0])];0<y;)y=ss[2*y+A(d,v[y])];v=-y,h[m+b]=v}a(g,x,h,m,4),x+=4,p[0+u]=v}}else v=A(d,156)?A(d,128)?1:3:A(d,163)?2:0,f.Ob[0]=v,s(h,m,v,4),s(p,0,v,4);f.Dd=A(d,142)?A(d,114)?A(d,183)?1:3:2:0}if(c.m.Ka)return Ge(e,7,"Premature end-of-partition0 encountered.");for(;e.ja<e.za;++e.ja){if(c=o,d=(l=e).rb[l.sb-1],h=l.rb[l.sb+l.ja],n=l.ya[l.aa+l.ja],m=l.kc?n.Ad:0)d.la=h.la=0,n.Za||(d.Na=h.Na=0),n.Hc=0,n.Gc=0,n.ia=0;else{var w,N;if(d=h,h=c,m=l.Pa.Xc,p=l.ya[l.aa+l.ja],f=l.pb[p.$b],u=p.ad,g=0,x=l.rb[l.sb-1],v=b=0,s(u,g,0,384),p.Za)var j=0,S=m[3];else{y=r(16);var _=d.Na+x.Na;if(_=ts(h,m[1],_,f.Eb,0,y,0),d.Na=x.Na=(0<_)+0,1<_)aa(y,0,u,g);else{var k=y[0]+3>>3;for(y=0;256>y;y+=16)u[g+y]=k}j=1,S=m[0]}var C=15&d.la,z=15&x.la;for(y=0;4>y;++y){var E=1&z;for(k=N=0;4>k;++k)C=C>>1|(E=(_=ts(h,S,_=E+(1&C),f.Sc,j,u,g))>j)<<7,N=N<<2|(3<_?3:1<_?2:0!=u[g+0]),g+=16;C>>=4,z=z>>1|E<<7,b=(b<<8|N)>>>0}for(S=C,j=z>>4,w=0;4>w;w+=2){for(N=0,C=d.la>>4+w,z=x.la>>4+w,y=0;2>y;++y){for(E=1&z,k=0;2>k;++k)_=E+(1&C),C=C>>1|(E=0<(_=ts(h,m[2],_,f.Qc,0,u,g)))<<3,N=N<<2|(3<_?3:1<_?2:0!=u[g+0]),g+=16;C>>=2,z=z>>1|E<<5}v|=N<<4*w,S|=C<<4<<w,j|=(240&z)<<w}d.la=S,x.la=j,p.Hc=b,p.Gc=v,p.ia=43690&v?0:f.ia,m=!(b|v)}if(0<l.L&&(l.wa[l.Y+l.ja]=l.gd[n.$b][n.Za],l.wa[l.Y+l.ja].La|=!m),c.Ka)return Ge(e,7,"Premature end-of-file encountered.")}if(Je(e),l=i,c=1,n=(o=e).D,d=0<o.L&&o.M>=o.zb&&o.M<=o.Va,0==o.Aa)t:{if(n.M=o.M,n.uc=d,Pi(o,n),c=1,n=(N=o.D).Nb,d=(v=Fs[o.L])*o.R,h=v/2*o.B,y=16*n*o.R,k=8*n*o.B,m=o.sa,p=o.ta-d+y,f=o.qa,u=o.ra-h+k,g=o.Ha,x=o.Ia-h+k,z=0==(C=N.M),b=C>=o.Va-1,2==o.Aa&&Pi(o,N),N.uc)for(E=(_=o).D.M,t(_.D.uc),N=_.yb;N<_.Hb;++N){j=N,S=E;var I=(P=(U=_).D).Nb;w=U.R;var P=P.wa[P.Y+j],T=U.sa,M=U.ta+16*I*w+16*j,L=P.dd,F=P.tc;if(0!=F)if(t(3<=F),1==U.L)0<j&&ba(T,M,w,F+4),P.La&&ya(T,M,w,F),0<S&&xa(T,M,w,F+4),P.La&&va(T,M,w,F);else{var O=U.B,D=U.qa,R=U.ra+8*I*O+8*j,B=U.Ha,U=U.Ia+8*I*O+8*j;I=P.ld,0<j&&(da(T,M,w,F+4,L,I),ha(D,R,B,U,O,F+4,L,I)),P.La&&(pa(T,M,w,F,L,I),ga(D,R,B,U,O,F,L,I)),0<S&&(ca(T,M,w,F+4,L,I),ua(D,R,B,U,O,F+4,L,I)),P.La&&(ma(T,M,w,F,L,I),fa(D,R,B,U,O,F,L,I))}}if(o.ia&&alert("todo:DitherRow"),null!=l.put){if(N=16*C,C=16*(C+1),z?(l.y=o.sa,l.O=o.ta+y,l.f=o.qa,l.N=o.ra+k,l.ea=o.Ha,l.W=o.Ia+k):(N-=v,l.y=m,l.O=p,l.f=f,l.N=u,l.ea=g,l.W=x),b||(C-=v),C>l.o&&(C=l.o),l.F=null,l.J=null,null!=o.Fa&&0<o.Fa.length&&N<C&&(l.J=di(o,l,N,C-N),l.F=o.mb,null==l.F&&0==l.F.length)){c=Ge(o,3,"Could not decode alpha data.");break t}N<l.j&&(v=l.j-N,N=l.j,t(!(1&v)),l.O+=o.R*v,l.N+=o.B*(v>>1),l.W+=o.B*(v>>1),null!=l.F&&(l.J+=l.width*v)),N<C&&(l.O+=l.v,l.N+=l.v>>1,l.W+=l.v>>1,null!=l.F&&(l.J+=l.v),l.ka=N-l.j,l.U=l.va-l.v,l.T=C-N,c=l.put(l))}n+1!=o.Ic||b||(a(o.sa,o.ta-d,m,p+16*o.R,d),a(o.qa,o.ra-h,f,u+8*o.B,h),a(o.Ha,o.Ia-h,g,x+8*o.B,h))}if(!c)return Ge(e,6,"Output aborted.")}return 1}(e,i)),null!=i.bc&&i.bc(i),o&=1}return o?(e.cb=0,o):0})(e,l)||(i=e.a)}}else i=e.a}0==i&&null!=u.Oa&&u.Oa.fd&&(i=Li(u.ba))}u=i}d=0!=u?null:11>d?h.f.RGBA.eb:h.f.kb.y}else d=null;return d};var Ds=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function c(e,t){for(var i="",a=0;a<4;a++)i+=String.fromCharCode(e[t++]);return i}function d(e,t){return e[t+0]|e[t+1]<<8}function u(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16)>>>0}function h(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}new l;var m=[0],p=[0],f=[],g=new l,x=e,b=function(e,t){var i={},a=0,s=!1,r=0,n=0;if(i.frames=[],!function(e,t){for(var i=0;i<4;i++)if(e[t+i]!="RIFF".charCodeAt(i))return!0;return!1}(e,t)){for(h(e,t+=4),t+=8;t<e.length;){var o=c(e,t),l=h(e,t+=4);t+=4;var m=l+(1&l);switch(o){case"VP8 ":case"VP8L":void 0===i.frames[a]&&(i.frames[a]={}),(g=i.frames[a]).src_off=s?n:t-8,g.src_size=r+l+8,a++,s&&(s=!1,r=0,n=0);break;case"VP8X":(g=i.header={}).feature_flags=e[t];var p=t+4;g.canvas_width=1+u(e,p),p+=3,g.canvas_height=1+u(e,p),p+=3;break;case"ALPH":s=!0,r=m+8,n=t-8;break;case"ANIM":(g=i.header).bgcolor=h(e,t),p=t+4,g.loop_count=d(e,p),p+=2;break;case"ANMF":var f,g;(g=i.frames[a]={}).offset_x=2*u(e,t),t+=3,g.offset_y=2*u(e,t),t+=3,g.width=1+u(e,t),t+=3,g.height=1+u(e,t),t+=3,g.duration=u(e,t),t+=3,f=e[t++],g.dispose=1&f,g.blend=f>>1&1}"ANMF"!=o&&(t+=m)}return i}}(x,0);b.response=x,b.rgbaoutput=!0,b.dataurl=!1;var v=b.header?b.header:null,y=b.frames?b.frames:null;if(v){v.loop_counter=v.loop_count,m=[v.canvas_height],p=[v.canvas_width];for(var w=0;w<y.length&&0!=y[w].blend;w++);}var N=y[0],j=g.WebPDecodeRGBA(x,N.src_off,N.src_size,p,m);N.rgba=j,N.imgwidth=p[0],N.imgheight=m[0];for(var S=0;S<p[0]*m[0]*4;S++)f[S]=j[S];return this.width=p,this.height=m,this.data=f,this}!function(e){var t,i,a,s,r,n,o,l,c,d=function(e){return e=e||{},this.isStrokeTransparent=e.isStrokeTransparent||!1,this.strokeOpacity=e.strokeOpacity||1,this.strokeStyle=e.strokeStyle||"#000000",this.fillStyle=e.fillStyle||"#000000",this.isFillTransparent=e.isFillTransparent||!1,this.fillOpacity=e.fillOpacity||1,this.font=e.font||"10px sans-serif",this.textBaseline=e.textBaseline||"alphabetic",this.textAlign=e.textAlign||"left",this.lineWidth=e.lineWidth||1,this.lineJoin=e.lineJoin||"miter",this.lineCap=e.lineCap||"butt",this.path=e.path||[],this.transform=void 0!==e.transform?e.transform.clone():new l,this.globalCompositeOperation=e.globalCompositeOperation||"normal",this.globalAlpha=e.globalAlpha||1,this.clip_path=e.clip_path||[],this.currentPoint=e.currentPoint||new n,this.miterLimit=e.miterLimit||10,this.lastPoint=e.lastPoint||new n,this.lineDashOffset=e.lineDashOffset||0,this.lineDash=e.lineDash||[],this.margin=e.margin||[0,0,0,0],this.prevPageLastElemOffset=e.prevPageLastElemOffset||0,this.ignoreClearRect="boolean"!=typeof e.ignoreClearRect||e.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new u(this),t=this.internal.f2,i=this.internal.getCoordinateString,a=this.internal.getVerticalCoordinateString,s=this.internal.getHorizontalCoordinate,r=this.internal.getVerticalCoordinate,n=this.internal.Point,o=this.internal.Rectangle,l=this.internal.Matrix,c=new d}]);var u=function(e){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var t=e;Object.defineProperty(this,"pdf",{get:function(){return t}});var i=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return i},set:function(e){i=Boolean(e)}});var a=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return a},set:function(e){a=Boolean(e)}});var s=0;Object.defineProperty(this,"posX",{get:function(){return s},set:function(e){isNaN(e)||(s=e)}});var r=0;Object.defineProperty(this,"posY",{get:function(){return r},set:function(e){isNaN(e)||(r=e)}}),Object.defineProperty(this,"margin",{get:function(){return c.margin},set:function(e){var t;"number"==typeof e?t=[e,e,e,e]:((t=new Array(4))[0]=e[0],t[1]=e.length>=2?e[1]:t[0],t[2]=e.length>=3?e[2]:t[0],t[3]=e.length>=4?e[3]:t[1]),c.margin=t}});var n=!1;Object.defineProperty(this,"autoPaging",{get:function(){return n},set:function(e){n=e}});var o=0;Object.defineProperty(this,"lastBreak",{get:function(){return o},set:function(e){o=e}});var l=[];Object.defineProperty(this,"pageBreaks",{get:function(){return l},set:function(e){l=e}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(e){e instanceof d&&(c=e)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(e){c.path=e}});var u=[];Object.defineProperty(this,"ctxStack",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(e){var t;t=h(e),this.ctx.fillStyle=t.style,this.ctx.isFillTransparent=0===t.a,this.ctx.fillOpacity=t.a,this.pdf.setFillColor(t.r,t.g,t.b,{a:t.a}),this.pdf.setTextColor(t.r,t.g,t.b,{a:t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(e){var t=h(e);this.ctx.strokeStyle=t.style,this.ctx.isStrokeTransparent=0===t.a,this.ctx.strokeOpacity=t.a,0===t.a?this.pdf.setDrawColor(255,255,255):(t.a,this.pdf.setDrawColor(t.r,t.g,t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(e){-1!==["butt","round","square"].indexOf(e)&&(this.ctx.lineCap=e,this.pdf.setLineCap(e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(e){isNaN(e)||(this.ctx.lineWidth=e,this.pdf.setLineWidth(e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(e){-1!==["bevel","round","miter"].indexOf(e)&&(this.ctx.lineJoin=e,this.pdf.setLineJoin(e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(e){isNaN(e)||(this.ctx.miterLimit=e,this.pdf.setMiterLimit(e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(e){this.ctx.textBaseline=e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(e){-1!==["right","end","center","left","start"].indexOf(e)&&(this.ctx.textAlign=e)}});var m=null,p=null;Object.defineProperty(this,"fontFaces",{get:function(){return p},set:function(e){m=null,p=e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(e){var t;if(this.ctx.font=e,null!==(t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(e))){var i=t[1];t[2];var a=t[3],s=t[4];t[5];var r=t[6],n=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(s)[2];s="px"===n?Math.floor(parseFloat(s)*this.pdf.internal.scaleFactor):"em"===n?Math.floor(parseFloat(s)*this.pdf.getFontSize()):Math.floor(parseFloat(s)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(s);var o=function(e){var t,i,a=[],s=e.trim();if(""===s)return NF;if(s in cF)return[cF[s]];for(;""!==s;){switch(i=null,t=(s=uF(s)).charAt(0)){case'"':case"'":i=hF(s.substring(1),t);break;default:i=mF(s)}if(null===i)return NF;if(a.push(i[0]),""!==(s=uF(i[1]))&&","!==s.charAt(0))return NF;s=s.replace(/^,/,"")}return a}(r);if(this.fontFaces){var l=function(e,t,i){for(var a=(i=i||{}).defaultFontFamily||"times",s=Object.assign({},lF,i.genericFontFamilies||{}),r=null,n=null,o=0;o<t.length;++o)if(s[(r=nF(t[o])).family]&&(r.family=s[r.family]),e.hasOwnProperty(r.family)){n=e[r.family];break}if(!(n=n||e[a]))throw new Error("Could not find a font-family for the rule '"+dF(r)+"' and default family '"+a+"'.");if(n=function(e,t){if(t[e])return t[e];var i=aF[e],a=i<=aF.normal?-1:1,s=oF(t,iF,i,a);if(!s)throw new Error("Could not find a matching font-stretch value for "+e);return s}(r.stretch,n),n=function(e,t){if(t[e])return t[e];for(var i=tF[e],a=0;a<i.length;++a)if(t[i[a]])return t[i[a]];throw new Error("Could not find a matching font-style for "+e)}(r.style,n),!(n=function(e,t){if(t[e])return t[e];if(400===e&&t[500])return t[500];if(500===e&&t[400])return t[400];var i=rF[e],a=oF(t,sF,i,e<400?-1:1);if(!a)throw new Error("Could not find a matching font-weight for value "+e);return a}(r.weight,n)))throw new Error("Failed to resolve a font for the rule '"+dF(r)+"'.");return n}(function(e,t){if(null===m){var i=(a=e.getFontList(),s=[],Object.keys(a).forEach(function(e){a[e].forEach(function(t){var i=null;switch(t){case"bold":i={family:e,weight:"bold"};break;case"italic":i={family:e,style:"italic"};break;case"bolditalic":i={family:e,weight:"bold",style:"italic"};break;case"":case"normal":i={family:e}}null!==i&&(i.ref={name:e,style:t},s.push(i))})}),s);m=function(e){for(var t={},i=0;i<e.length;++i){var a=nF(e[i]),s=a.family,r=a.stretch,n=a.style,o=a.weight;t[s]=t[s]||{},t[s][r]=t[s][r]||{},t[s][r][n]=t[s][r][n]||{},t[s][r][n][o]=a}return t}(i.concat(t))}var a,s;return m}(this.pdf,this.fontFaces),o.map(function(e){return{family:e,stretch:"normal",weight:a,style:i}}));this.pdf.setFont(l.ref.name,l.ref.style)}else{var c="";("bold"===a||parseInt(a,10)>=700||"bold"===i)&&(c="bold"),"italic"===i&&(c+="italic"),0===c.length&&(c="normal");for(var d="",u={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},h=0;h<o.length;h++){if(void 0!==this.pdf.internal.getFont(o[h],c,{noFallback:!0,disableWarning:!0})){d=o[h];break}if("bolditalic"===c&&void 0!==this.pdf.internal.getFont(o[h],"bold",{noFallback:!0,disableWarning:!0}))d=o[h],c="bold";else if(void 0!==this.pdf.internal.getFont(o[h],"normal",{noFallback:!0,disableWarning:!0})){d=o[h],c="normal";break}}if(""===d)for(var p=0;p<o.length;p++)if(u[o[p]]){d=u[o[p]];break}d=""===d?"Times":d,this.pdf.setFont(d,c)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(e){this.ctx.globalCompositeOperation=e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(e){this.ctx.globalAlpha=e}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(e){this.ctx.lineDashOffset=e,O.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(e){this.ctx.lineDash=e,O.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(e){this.ctx.ignoreClearRect=Boolean(e)}})};u.prototype.setLineDash=function(e){this.lineDash=e},u.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},u.prototype.fill=function(){y.call(this,"fill",!1)},u.prototype.stroke=function(){y.call(this,"stroke",!1)},u.prototype.beginPath=function(){this.path=[{type:"begin"}]},u.prototype.moveTo=function(e,t){if(isNaN(e)||isNaN(t))throw MM.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var i=this.ctx.transform.applyToPoint(new n(e,t));this.path.push({type:"mt",x:i.x,y:i.y}),this.ctx.lastPoint=new n(e,t)},u.prototype.closePath=function(){var e=new n(0,0),t=0;for(t=this.path.length-1;-1!==t;t--)if("begin"===this.path[t].type&&"object"===II(this.path[t+1])&&"number"==typeof this.path[t+1].x){e=new n(this.path[t+1].x,this.path[t+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new n(e.x,e.y)},u.prototype.lineTo=function(e,t){if(isNaN(e)||isNaN(t))throw MM.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var i=this.ctx.transform.applyToPoint(new n(e,t));this.path.push({type:"lt",x:i.x,y:i.y}),this.ctx.lastPoint=new n(i.x,i.y)},u.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),y.call(this,null,!0)},u.prototype.quadraticCurveTo=function(e,t,i,a){if(isNaN(i)||isNaN(a)||isNaN(e)||isNaN(t))throw MM.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var s=this.ctx.transform.applyToPoint(new n(i,a)),r=this.ctx.transform.applyToPoint(new n(e,t));this.path.push({type:"qct",x1:r.x,y1:r.y,x:s.x,y:s.y}),this.ctx.lastPoint=new n(s.x,s.y)},u.prototype.bezierCurveTo=function(e,t,i,a,s,r){if(isNaN(s)||isNaN(r)||isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a))throw MM.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var o=this.ctx.transform.applyToPoint(new n(s,r)),l=this.ctx.transform.applyToPoint(new n(e,t)),c=this.ctx.transform.applyToPoint(new n(i,a));this.path.push({type:"bct",x1:l.x,y1:l.y,x2:c.x,y2:c.y,x:o.x,y:o.y}),this.ctx.lastPoint=new n(o.x,o.y)},u.prototype.arc=function(e,t,i,a,s,r){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a)||isNaN(s))throw MM.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(r=Boolean(r),!this.ctx.transform.isIdentity){var o=this.ctx.transform.applyToPoint(new n(e,t));e=o.x,t=o.y;var l=this.ctx.transform.applyToPoint(new n(0,i)),c=this.ctx.transform.applyToPoint(new n(0,0));i=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2))}Math.abs(s-a)>=2*Math.PI&&(a=0,s=2*Math.PI),this.path.push({type:"arc",x:e,y:t,radius:i,startAngle:a,endAngle:s,counterclockwise:r})},u.prototype.arcTo=function(e,t,i,a,s){throw new Error("arcTo not implemented.")},u.prototype.rect=function(e,t,i,a){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a))throw MM.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(e,t),this.lineTo(e+i,t),this.lineTo(e+i,t+a),this.lineTo(e,t+a),this.lineTo(e,t),this.lineTo(e+i,t),this.lineTo(e,t)},u.prototype.fillRect=function(e,t,i,a){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a))throw MM.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!m.call(this)){var s={};"butt"!==this.lineCap&&(s.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(s.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(e,t,i,a),this.fill(),s.hasOwnProperty("lineCap")&&(this.lineCap=s.lineCap),s.hasOwnProperty("lineJoin")&&(this.lineJoin=s.lineJoin)}},u.prototype.strokeRect=function(e,t,i,a){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a))throw MM.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");p.call(this)||(this.beginPath(),this.rect(e,t,i,a),this.stroke())},u.prototype.clearRect=function(e,t,i,a){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a))throw MM.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(e,t,i,a))},u.prototype.save=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,i=0;i<this.pdf.internal.getNumberOfPages();i++)this.pdf.setPage(i+1),this.pdf.internal.out("q");if(this.pdf.setPage(t),e){this.ctx.fontSize=this.pdf.internal.getFontSize();var a=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=a}},u.prototype.restore=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,i=0;i<this.pdf.internal.getNumberOfPages();i++)this.pdf.setPage(i+1),this.pdf.internal.out("Q");this.pdf.setPage(t),e&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},u.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(e){var t,i,a,s;if(!0===e.isCanvasGradient&&(e=e.getColor()),!e)return{r:0,g:0,b:0,a:0,style:e};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(e))t=0,i=0,a=0,s=0;else{var r=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(e);if(null!==r)t=parseInt(r[1]),i=parseInt(r[2]),a=parseInt(r[3]),s=1;else if(null!==(r=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(e)))t=parseInt(r[1]),i=parseInt(r[2]),a=parseInt(r[3]),s=parseFloat(r[4]);else{if(s=1,"string"==typeof e&&"#"!==e.charAt(0)){var n=new RM(e);e=n.ok?n.toHex():"#000000"}4===e.length?(t=e.substring(1,2),t+=t,i=e.substring(2,3),i+=i,a=e.substring(3,4),a+=a):(t=e.substring(1,3),i=e.substring(3,5),a=e.substring(5,7)),t=parseInt(t,16),i=parseInt(i,16),a=parseInt(a,16)}}return{r:t,g:i,b:a,a:s,style:e}},m=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},p=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};u.prototype.fillText=function(e,t,i,a){if(isNaN(t)||isNaN(i)||"string"!=typeof e)throw MM.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(a=isNaN(a)?void 0:a,!m.call(this)){var s=M(this.ctx.transform.rotation),r=this.ctx.transform.scaleX;A.call(this,{text:e,x:t,y:i,scale:r,angle:s,align:this.textAlign,maxWidth:a})}},u.prototype.strokeText=function(e,t,i,a){if(isNaN(t)||isNaN(i)||"string"!=typeof e)throw MM.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!p.call(this)){a=isNaN(a)?void 0:a;var s=M(this.ctx.transform.rotation),r=this.ctx.transform.scaleX;A.call(this,{text:e,x:t,y:i,scale:r,renderingMode:"stroke",angle:s,align:this.textAlign,maxWidth:a})}},u.prototype.measureText=function(e){if("string"!=typeof e)throw MM.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var t=this.pdf,i=this.pdf.internal.scaleFactor,a=t.internal.getFontSize(),s=t.getStringUnitWidth(e)*a/t.internal.scaleFactor;return new function(e){var t=(e=e||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return t}}),this}({width:s*=Math.round(96*i/72*1e4)/1e4})},u.prototype.scale=function(e,t){if(isNaN(e)||isNaN(t))throw MM.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var i=new l(e,0,0,t,0,0);this.ctx.transform=this.ctx.transform.multiply(i)},u.prototype.rotate=function(e){if(isNaN(e))throw MM.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var t=new l(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0);this.ctx.transform=this.ctx.transform.multiply(t)},u.prototype.translate=function(e,t){if(isNaN(e)||isNaN(t))throw MM.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var i=new l(1,0,0,1,e,t);this.ctx.transform=this.ctx.transform.multiply(i)},u.prototype.transform=function(e,t,i,a,s,r){if(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(a)||isNaN(s)||isNaN(r))throw MM.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var n=new l(e,t,i,a,s,r);this.ctx.transform=this.ctx.transform.multiply(n)},u.prototype.setTransform=function(e,t,i,a,s,r){e=isNaN(e)?1:e,t=isNaN(t)?0:t,i=isNaN(i)?0:i,a=isNaN(a)?1:a,s=isNaN(s)?0:s,r=isNaN(r)?0:r,this.ctx.transform=new l(e,t,i,a,s,r)};var f=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};u.prototype.drawImage=function(e,t,i,a,s,r,n,c,d){var u=this.pdf.getImageProperties(e),h=1,m=1,p=1,x=1;void 0!==a&&void 0!==c&&(p=c/a,x=d/s,h=u.width/a*c/a,m=u.height/s*d/s),void 0===r&&(r=t,n=i,t=0,i=0),void 0!==a&&void 0===c&&(c=a,d=s),void 0===a&&void 0===c&&(c=u.width,d=u.height);for(var y,N=this.ctx.transform.decompose(),j=M(N.rotate.shx),S=new l,_=(S=(S=(S=S.multiply(N.translate)).multiply(N.skew)).multiply(N.scale)).applyToRectangle(new o(r-t*p,n-i*x,a*h,s*m)),k=g.call(this,_),C=[],A=0;A<k.length;A+=1)-1===C.indexOf(k[A])&&C.push(k[A]);if(v(C),this.autoPaging)for(var z=C[0],E=C[C.length-1],I=z;I<E+1;I++){this.pdf.setPage(I);var P=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],T=1===I?this.posY+this.margin[0]:this.margin[0],L=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],F=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],O=1===I?0:L+(I-2)*F;if(0!==this.ctx.clip_path.length){var D=this.path;y=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(y,this.posX+this.margin[3],-O+T+this.ctx.prevPageLastElemOffset),w.call(this,"fill",!0),this.path=D}var R=JSON.parse(JSON.stringify(_));R=b([R],this.posX+this.margin[3],-O+T+this.ctx.prevPageLastElemOffset)[0];var B=(I>z||I<E)&&f.call(this);B&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],P,F,null).clip().discardPath()),this.pdf.addImage(e,"JPEG",R.x,R.y,R.w,R.h,null,null,j),B&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(e,"JPEG",_.x,_.y,_.w,_.h,null,null,j)};var g=function(e,t,i){var a=[];t=t||this.pdf.internal.pageSize.width,i=i||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var s=this.posY+this.ctx.prevPageLastElemOffset;switch(e.type){default:case"mt":case"lt":a.push(Math.floor((e.y+s)/i)+1);break;case"arc":a.push(Math.floor((e.y+s-e.radius)/i)+1),a.push(Math.floor((e.y+s+e.radius)/i)+1);break;case"qct":var r=L(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x,e.y);a.push(Math.floor((r.y+s)/i)+1),a.push(Math.floor((r.y+r.h+s)/i)+1);break;case"bct":var n=F(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x2,e.y2,e.x,e.y);a.push(Math.floor((n.y+s)/i)+1),a.push(Math.floor((n.y+n.h+s)/i)+1);break;case"rect":a.push(Math.floor((e.y+s)/i)+1),a.push(Math.floor((e.y+e.h+s)/i)+1)}for(var o=0;o<a.length;o+=1)for(;this.pdf.internal.getNumberOfPages()<a[o];)x.call(this);return a},x=function(){var e=this.fillStyle,t=this.strokeStyle,i=this.font,a=this.lineCap,s=this.lineWidth,r=this.lineJoin;this.pdf.addPage(),this.fillStyle=e,this.strokeStyle=t,this.font=i,this.lineCap=a,this.lineWidth=s,this.lineJoin=r},b=function(e,t,i){for(var a=0;a<e.length;a++)switch(e[a].type){case"bct":e[a].x2+=t,e[a].y2+=i;case"qct":e[a].x1+=t,e[a].y1+=i;default:e[a].x+=t,e[a].y+=i}return e},v=function(e){return e.sort(function(e,t){return e-t})},y=function(e,t){for(var i,a,s=this.fillStyle,r=this.strokeStyle,n=this.lineCap,o=this.lineWidth,l=Math.abs(o*this.ctx.transform.scaleX),c=this.lineJoin,d=JSON.parse(JSON.stringify(this.path)),u=JSON.parse(JSON.stringify(this.path)),h=[],m=0;m<u.length;m++)if(void 0!==u[m].x)for(var p=g.call(this,u[m]),y=0;y<p.length;y+=1)-1===h.indexOf(p[y])&&h.push(p[y]);for(var N=0;N<h.length;N++)for(;this.pdf.internal.getNumberOfPages()<h[N];)x.call(this);if(v(h),this.autoPaging)for(var j=h[0],S=h[h.length-1],_=j;_<S+1;_++){this.pdf.setPage(_),this.fillStyle=s,this.strokeStyle=r,this.lineCap=n,this.lineWidth=l,this.lineJoin=c;var k=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],C=1===_?this.posY+this.margin[0]:this.margin[0],A=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],z=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],E=1===_?0:A+(_-2)*z;if(0!==this.ctx.clip_path.length){var I=this.path;i=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(i,this.posX+this.margin[3],-E+C+this.ctx.prevPageLastElemOffset),w.call(this,e,!0),this.path=I}if(a=JSON.parse(JSON.stringify(d)),this.path=b(a,this.posX+this.margin[3],-E+C+this.ctx.prevPageLastElemOffset),!1===t||0===_){var P=(_>j||_<S)&&f.call(this);P&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],k,z,null).clip().discardPath()),w.call(this,e,t),P&&this.pdf.restoreGraphicsState()}this.lineWidth=o}else this.lineWidth=l,w.call(this,e,t),this.lineWidth=o;this.path=d},w=function(e,t){if(("stroke"!==e||t||!p.call(this))&&("stroke"===e||t||!m.call(this))){for(var i,a,s=[],r=this.path,n=0;n<r.length;n++){var o=r[n];switch(o.type){case"begin":s.push({begin:!0});break;case"close":s.push({close:!0});break;case"mt":s.push({start:o,deltas:[],abs:[]});break;case"lt":var l=s.length;if(r[n-1]&&!isNaN(r[n-1].x)&&(i=[o.x-r[n-1].x,o.y-r[n-1].y],l>0))for(;l>=0;l--)if(!0!==s[l-1].close&&!0!==s[l-1].begin){s[l-1].deltas.push(i),s[l-1].abs.push(o);break}break;case"bct":i=[o.x1-r[n-1].x,o.y1-r[n-1].y,o.x2-r[n-1].x,o.y2-r[n-1].y,o.x-r[n-1].x,o.y-r[n-1].y],s[s.length-1].deltas.push(i);break;case"qct":var c=r[n-1].x+2/3*(o.x1-r[n-1].x),d=r[n-1].y+2/3*(o.y1-r[n-1].y),u=o.x+2/3*(o.x1-o.x),h=o.y+2/3*(o.y1-o.y),f=o.x,g=o.y;i=[c-r[n-1].x,d-r[n-1].y,u-r[n-1].x,h-r[n-1].y,f-r[n-1].x,g-r[n-1].y],s[s.length-1].deltas.push(i);break;case"arc":s.push({deltas:[],abs:[],arc:!0}),Array.isArray(s[s.length-1].abs)&&s[s.length-1].abs.push(o)}}a=t?null:"stroke"===e?"stroke":"fill";for(var x=!1,b=0;b<s.length;b++)if(s[b].arc)for(var v=s[b].abs,y=0;y<v.length;y++){var w=v[y];"arc"===w.type?S.call(this,w.x,w.y,w.radius,w.startAngle,w.endAngle,w.counterclockwise,void 0,t,!x):z.call(this,w.x,w.y),x=!0}else if(!0===s[b].close)this.pdf.internal.out("h"),x=!1;else if(!0!==s[b].begin){var N=s[b].start.x,j=s[b].start.y;E.call(this,s[b].deltas,N,j),x=!0}a&&_.call(this,a),t&&k.call(this)}},N=function(e){var t=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,i=t*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return e-i;case"top":return e+t-i;case"hanging":return e+t-2*i;case"middle":return e+t/2-i;default:return e}},j=function(e){return e+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};u.prototype.createLinearGradient=function(){var e=function(){};return e.colorStops=[],e.addColorStop=function(e,t){this.colorStops.push([e,t])},e.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},e.isCanvasGradient=!0,e},u.prototype.createPattern=function(){return this.createLinearGradient()},u.prototype.createRadialGradient=function(){return this.createLinearGradient()};var S=function(e,t,i,a,s,r,n,o,l){for(var c=P.call(this,i,a,s,r),d=0;d<c.length;d++){var u=c[d];0===d&&(l?C.call(this,u.x1+e,u.y1+t):z.call(this,u.x1+e,u.y1+t)),I.call(this,e,t,u.x2,u.y2,u.x3,u.y3,u.x4,u.y4)}o?k.call(this):_.call(this,n)},_=function(e){switch(e){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},k=function(){this.pdf.clip(),this.pdf.discardPath()},C=function(e,t){this.pdf.internal.out(i(e)+" "+a(t)+" m")},A=function(e){var t;switch(e.align){case"right":case"end":t="right";break;case"center":t="center";break;default:t="left"}var i=this.pdf.getTextDimensions(e.text),a=N.call(this,e.y),s=j.call(this,a)-i.h,r=this.ctx.transform.applyToPoint(new n(e.x,a)),c=this.ctx.transform.decompose(),d=new l;d=(d=(d=d.multiply(c.translate)).multiply(c.skew)).multiply(c.scale);for(var u,h,m,p=this.ctx.transform.applyToRectangle(new o(e.x,a,i.w,i.h)),x=d.applyToRectangle(new o(e.x,s,i.w,i.h)),y=g.call(this,x),S=[],_=0;_<y.length;_+=1)-1===S.indexOf(y[_])&&S.push(y[_]);if(v(S),this.autoPaging)for(var k=S[0],C=S[S.length-1],A=k;A<C+1;A++){this.pdf.setPage(A);var z=1===A?this.posY+this.margin[0]:this.margin[0],E=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],I=this.pdf.internal.pageSize.height-this.margin[2],P=I-this.margin[0],T=this.pdf.internal.pageSize.width-this.margin[1],M=T-this.margin[3],L=1===A?0:E+(A-2)*P;if(0!==this.ctx.clip_path.length){var F=this.path;u=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(u,this.posX+this.margin[3],-1*L+z),w.call(this,"fill",!0),this.path=F}var O=b([JSON.parse(JSON.stringify(x))],this.posX+this.margin[3],-L+z+this.ctx.prevPageLastElemOffset)[0];e.scale>=.01&&(h=this.pdf.internal.getFontSize(),this.pdf.setFontSize(h*e.scale),m=this.lineWidth,this.lineWidth=m*e.scale);var D="text"!==this.autoPaging;if(D||O.y+O.h<=I){if(D||O.y>=z&&O.x<=T){var R=D?e.text:this.pdf.splitTextToSize(e.text,e.maxWidth||T-O.x)[0],B=b([JSON.parse(JSON.stringify(p))],this.posX+this.margin[3],-L+z+this.ctx.prevPageLastElemOffset)[0],U=D&&(A>k||A<C)&&f.call(this);U&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],M,P,null).clip().discardPath()),this.pdf.text(R,B.x,B.y,{angle:e.angle,align:t,renderingMode:e.renderingMode}),U&&this.pdf.restoreGraphicsState()}}else O.y<I&&(this.ctx.prevPageLastElemOffset+=I-O.y);e.scale>=.01&&(this.pdf.setFontSize(h),this.lineWidth=m)}else e.scale>=.01&&(h=this.pdf.internal.getFontSize(),this.pdf.setFontSize(h*e.scale),m=this.lineWidth,this.lineWidth=m*e.scale),this.pdf.text(e.text,r.x+this.posX,r.y+this.posY,{angle:e.angle,align:t,renderingMode:e.renderingMode,maxWidth:e.maxWidth}),e.scale>=.01&&(this.pdf.setFontSize(h),this.lineWidth=m)},z=function(e,t,s,r){s=s||0,r=r||0,this.pdf.internal.out(i(e+s)+" "+a(t+r)+" l")},E=function(e,t,i){return this.pdf.lines(e,t,i,null,null)},I=function(e,i,a,n,o,l,c,d){this.pdf.internal.out([t(s(a+e)),t(r(n+i)),t(s(o+e)),t(r(l+i)),t(s(c+e)),t(r(d+i)),"c"].join(" "))},P=function(e,t,i,a){for(var s=2*Math.PI,r=Math.PI/2;t>i;)t-=s;var n=Math.abs(i-t);n<s&&a&&(n=s-n);for(var o=[],l=a?-1:1,c=t;n>1e-5;){var d=c+l*Math.min(n,r);o.push(T.call(this,e,c,d)),n-=Math.abs(d-c),c=d}return o},T=function(e,t,i){var a=(i-t)/2,s=e*Math.cos(a),r=e*Math.sin(a),n=s,o=-r,l=n*n+o*o,c=l+n*s+o*r,d=4/3*(Math.sqrt(2*l*c)-c)/(n*r-o*s),u=n-d*o,h=o+d*n,m=u,p=-h,f=a+t,g=Math.cos(f),x=Math.sin(f);return{x1:e*Math.cos(t),y1:e*Math.sin(t),x2:u*g-h*x,y2:u*x+h*g,x3:m*g-p*x,y3:m*x+p*g,x4:e*Math.cos(i),y4:e*Math.sin(i)}},M=function(e){return 180*e/Math.PI},L=function(e,t,i,a,s,r){var n=e+.5*(i-e),l=t+.5*(a-t),c=s+.5*(i-s),d=r+.5*(a-r),u=Math.min(e,s,n,c),h=Math.max(e,s,n,c),m=Math.min(t,r,l,d),p=Math.max(t,r,l,d);return new o(u,m,h-u,p-m)},F=function(e,t,i,a,s,r,n,l){var c,d,u,h,m,p,f,g,x,b,v,y,w,N,j=i-e,S=a-t,_=s-i,k=r-a,C=n-s,A=l-r;for(d=0;d<41;d++)x=(f=(u=e+(c=d/40)*j)+c*((m=i+c*_)-u))+c*(m+c*(s+c*C-m)-f),b=(g=(h=t+c*S)+c*((p=a+c*k)-h))+c*(p+c*(r+c*A-p)-g),0==d?(v=x,y=b,w=x,N=b):(v=Math.min(v,x),y=Math.min(y,b),w=Math.max(w,x),N=Math.max(N,b));return new o(Math.round(v),Math.round(y),Math.round(w-v),Math.round(N-y))},O=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var e,t,i=(e=this.ctx.lineDash,t=this.ctx.lineDashOffset,JSON.stringify({lineDash:e,lineDashOffset:t}));this.prevLineDash!==i&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=i)}}}(uL.API),function(e){var t=function(e){var t,i,a,s,r,n,o,l,c,d;for(i=[],a=0,s=(e+=t="\0\0\0\0".slice(e.length%4||4)).length;s>a;a+=4)0!==(r=(e.charCodeAt(a)<<24)+(e.charCodeAt(a+1)<<16)+(e.charCodeAt(a+2)<<8)+e.charCodeAt(a+3))?(n=(r=((r=((r=((r=(r-(d=r%85))/85)-(c=r%85))/85)-(l=r%85))/85)-(o=r%85))/85)%85,i.push(n+33,o+33,l+33,c+33,d+33)):i.push(122);return function(e,t){for(var i=t;i>0;i--)e.pop()}(i,t.length),String.fromCharCode.apply(String,i)+"~>"},i=function(e){var t,i,a,s,r,n=String,o="length",l=255,c="charCodeAt",d="slice",u="replace";for(e[d](-2),e=e[d](0,-2)[u](/\s/g,"")[u]("z","!!!!!"),a=[],s=0,r=(e+=t="uuuuu"[d](e[o]%5||5))[o];r>s;s+=5)i=52200625*(e[c](s)-33)+614125*(e[c](s+1)-33)+7225*(e[c](s+2)-33)+85*(e[c](s+3)-33)+(e[c](s+4)-33),a.push(l&i>>24,l&i>>16,l&i>>8,l&i);return function(e,t){for(var i=t;i>0;i--)e.pop()}(a,t[o]),n.fromCharCode.apply(n,a)},a=function(e){return e.split("").map(function(e){return("0"+e.charCodeAt().toString(16)).slice(-2)}).join("")+">"},s=function(e){var t=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(e=e.replace(/\s/g,"")).indexOf(">")&&(e=e.substr(0,e.indexOf(">"))),e.length%2&&(e+="0"),!1===t.test(e))return"";for(var i="",a=0;a<e.length;a+=2)i+=String.fromCharCode("0x"+(e[a]+e[a+1]));return i},r=function(e){for(var t=new Uint8Array(e.length),i=e.length;i--;)t[i]=e.charCodeAt(i);return(t=uP(t)).reduce(function(e,t){return e+String.fromCharCode(t)},"")};e.processDataByFilters=function(e,n){var o=0,l=e||"",c=[];for("string"==typeof(n=n||[])&&(n=[n]),o=0;o<n.length;o+=1)switch(n[o]){case"ASCII85Decode":case"/ASCII85Decode":l=i(l),c.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":l=t(l),c.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":l=s(l),c.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":l=a(l),c.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":l=r(l),c.push("/FlateDecode");break;default:throw new Error('The filter: "'+n[o]+'" is not implemented')}return{data:l,reverseChain:c.reverse().join(" ")}}}(uL.API),function(e){e.loadFile=function(e,t,i){return function(e,t,i){t=!1!==t,i="function"==typeof i?i:function(){};var a=void 0;try{a=function(e,t,i){var a=new XMLHttpRequest,s=0,r=function(e){var t=e.length,i=[],a=String.fromCharCode;for(s=0;s<t;s+=1)i.push(a(255&e.charCodeAt(s)));return i.join("")};if(a.open("GET",e,!t),a.overrideMimeType("text/plain; charset=x-user-defined"),!1===t&&(a.onload=function(){200===a.status?i(r(this.responseText)):i(void 0)}),a.send(null),t&&200===a.status)return r(a.responseText)}(e,t,i)}catch(s){}return a}(e,t,i)},e.loadImageFile=e.loadFile}(uL.API),function(e){function t(){return(PM.html2canvas?Promise.resolve(PM.html2canvas):ae(()=>import("./html2canvas.esm.CJ7z3xiY.js"),[])).catch(function(e){return Promise.reject(new Error("Could not load html2canvas: "+e))}).then(function(e){return e.default?e.default:e})}function i(){return(PM.DOMPurify?Promise.resolve(PM.DOMPurify):ae(()=>Promise.resolve().then(()=>lk),void 0)).catch(function(e){return Promise.reject(new Error("Could not load dompurify: "+e))}).then(function(e){return e.default?e.default:e})}var a=function(e){var t=II(e);return"undefined"===t?"undefined":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?"function":e&&e.constructor===Array?"array":e&&1===e.nodeType?"element":"object"===t?"object":"unknown"},s=function(e,t){var i=document.createElement(e);for(var a in t.className&&(i.className=t.className),t.innerHTML&&t.dompurify&&(i.innerHTML=t.dompurify.sanitize(t.innerHTML)),t.style)i.style[a]=t.style[a];return i},r=function e(t,i){for(var a=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),s=t.firstChild;s;s=s.nextSibling)!0!==i&&1===s.nodeType&&"SCRIPT"===s.nodeName||a.appendChild(e(s,i));return 1===t.nodeType&&("CANVAS"===t.nodeName?(a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(a.value=t.value),a.addEventListener("load",function(){a.scrollTop=t.scrollTop,a.scrollLeft=t.scrollLeft},!0)),a},n=function e(t){var i=Object.assign(e.convert(Promise.resolve()),JSON.parse(JSON.stringify(e.template))),a=e.convert(Promise.resolve(),i);return(a=a.setProgress(1,e,1,[e])).set(t)};(n.prototype=Object.create(Promise.prototype)).constructor=n,n.convert=function(e,t){return e.__proto__=t||n.prototype,e},n.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},n.prototype.from=function(e,t){return this.then(function(){switch(t=t||function(e){switch(a(e)){case"string":return"string";case"element":return"canvas"===e.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(e)){case"string":return this.then(i).then(function(t){return this.set({src:s("div",{innerHTML:e,dompurify:t})})});case"element":return this.set({src:e});case"canvas":return this.set({canvas:e});case"img":return this.set({img:e});default:return this.error("Unknown source type.")}})},n.prototype.to=function(e){switch(e){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},n.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var e={position:"relative",display:"inline-block",width:("number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},t=r(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===t.tagName&&(e.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:e}),this.prop.container.appendChild(t),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},n.prototype.toCanvas=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=Object.assign({},this.opt.html2canvas);return delete t.onrendered,e(this.prop.container,t)}).then(function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},n.prototype.toContext2d=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=this.opt.jsPDF,i=this.opt.fontFaces,a="number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,s=Object.assign({async:!0,allowTaint:!0,scale:a,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete s.onrendered,t.context2d.autoPaging=void 0===this.opt.autoPaging||this.opt.autoPaging,t.context2d.posX=this.opt.x,t.context2d.posY=this.opt.y,t.context2d.margin=this.opt.margin,t.context2d.fontFaces=i,i)for(var r=0;r<i.length;++r){var n=i[r],o=n.src.find(function(e){return"truetype"===e.format});o&&t.addFont(o.url,n.ref.name,n.ref.style)}return s.windowHeight=s.windowHeight||0,s.windowHeight=0==s.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):s.windowHeight,t.context2d.save(!0),e(this.prop.container,s)}).then(function(e){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},n.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var e=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=e})},n.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},n.prototype.output=function(e,t,i){return"img"===(i=i||"pdf").toLowerCase()||"image"===i.toLowerCase()?this.outputImg(e,t):this.outputPdf(e,t)},n.prototype.outputPdf=function(e,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(e,t)})},n.prototype.outputImg=function(e){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(e){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+e+'" is not supported.'}})},n.prototype.save=function(e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(e?{filename:e}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},n.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},n.prototype.set=function(e){if("object"!==a(e))return this;var t=Object.keys(e||{}).map(function(t){if(t in n.template.prop)return function(){this.prop[t]=e[t]};switch(t){case"margin":return this.setMargin.bind(this,e.margin);case"jsPDF":return function(){return this.opt.jsPDF=e.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,e.pageSize);default:return function(){this.opt[t]=e[t]}}},this);return this.then(function(){return this.thenList(t)})},n.prototype.get=function(e,t){return this.then(function(){var i=e in n.template.prop?this.prop[e]:this.opt[e];return t?t(i):i})},n.prototype.setMargin=function(e){return this.then(function(){switch(a(e)){case"number":e=[e,e,e,e];case"array":if(2===e.length&&(e=[e[0],e[1],e[0],e[1]]),4===e.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=e}).then(this.setPageSize)},n.prototype.setPageSize=function(e){function t(e,t){return Math.floor(e*t/72*96)}return this.then(function(){(e=e||uL.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(e.inner={width:e.width-this.opt.margin[1]-this.opt.margin[3],height:e.height-this.opt.margin[0]-this.opt.margin[2]},e.inner.px={width:t(e.inner.width,e.k),height:t(e.inner.height,e.k)},e.inner.ratio=e.inner.height/e.inner.width),this.prop.pageSize=e})},n.prototype.setProgress=function(e,t,i,a){return null!=e&&(this.progress.val=e),null!=t&&(this.progress.state=t),null!=i&&(this.progress.n=i),null!=a&&(this.progress.stack=a),this.progress.ratio=this.progress.val/this.progress.state,this},n.prototype.updateProgress=function(e,t,i,a){return this.setProgress(e?this.progress.val+e:null,t||null,i?this.progress.n+i:null,a?this.progress.stack.concat(a):null)},n.prototype.then=function(e,t){var i=this;return this.thenCore(e,t,function(e,t){return i.updateProgress(null,null,1,[e]),Promise.prototype.then.call(this,function(t){return i.updateProgress(null,e),t}).then(e,t).then(function(e){return i.updateProgress(1),e})})},n.prototype.thenCore=function(e,t,i){i=i||Promise.prototype.then;var a=this;e&&(e=e.bind(a)),t&&(t=t.bind(a));var s=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?a:n.convert(Object.assign({},a),Promise.prototype),r=i.call(s,e,t);return n.convert(r,a.__proto__)},n.prototype.thenExternal=function(e,t){return Promise.prototype.then.call(this,e,t)},n.prototype.thenList=function(e){var t=this;return e.forEach(function(e){t=t.thenCore(e)}),t},n.prototype.catch=function(e){e&&(e=e.bind(this));var t=Promise.prototype.catch.call(this,e);return n.convert(t,this)},n.prototype.catchExternal=function(e){return Promise.prototype.catch.call(this,e)},n.prototype.error=function(e){return this.then(function(){throw new Error(e)})},n.prototype.using=n.prototype.set,n.prototype.saveAs=n.prototype.save,n.prototype.export=n.prototype.output,n.prototype.run=n.prototype.then,uL.getPageSize=function(e,t,i){if("object"===II(e)){var a=e;e=a.orientation,t=a.unit||t,i=a.format||i}t=t||"mm",i=i||"a4",e=(""+(e||"P")).toLowerCase();var s,r=(""+i).toLowerCase(),n={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":s=1;break;case"mm":s=72/25.4;break;case"cm":s=72/2.54;break;case"in":s=72;break;case"px":s=.75;break;case"pc":case"em":s=12;break;case"ex":s=6;break;default:throw"Invalid unit: "+t}var o,l=0,c=0;if(n.hasOwnProperty(r))l=n[r][1]/s,c=n[r][0]/s;else try{l=i[1],c=i[0]}catch(d){throw new Error("Invalid format: "+i)}if("p"===e||"portrait"===e)e="p",c>l&&(o=c,c=l,l=o);else{if("l"!==e&&"landscape"!==e)throw"Invalid orientation: "+e;e="l",l>c&&(o=c,c=l,l=o)}return{width:c,height:l,unit:t,k:s,orientation:e}},e.html=function(e,t){(t=t||{}).callback=t.callback||function(){},t.html2canvas=t.html2canvas||{},t.html2canvas.canvas=t.html2canvas.canvas||this.canvas,t.jsPDF=t.jsPDF||this,t.fontFaces=t.fontFaces?t.fontFaces.map(nF):null;var i=new n(t);return t.worker?i:i.from(e).doCallback()}}(uL.API),uL.API.addJS=function(e){return gF=e,this.internal.events.subscribe("postPutResources",function(){pF=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(pF+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),fF=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+gF+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){void 0!==pF&&void 0!==fF&&this.internal.out("/Names <</JavaScript "+pF+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var e=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var a=e.outline.render().split(/\r\n/),s=0;s<a.length;s++){var r=a[s],n=i.exec(r);if(null!=n){var o=n[1];e.internal.newObjectDeferredBegin(o,!1)}e.internal.write(r)}if(this.outline.createNamedDestinations){var l=this.internal.pages.length,c=[];for(s=0;s<l;s++){var d=e.internal.newObject();c.push(d);var u=e.internal.getPageInfo(s+1);e.internal.write("<< /D["+u.objId+" 0 R /XYZ null null null]>> endobj")}var h=e.internal.newObject();for(e.internal.write("<< /Names [ "),s=0;s<c.length;s++)e.internal.write("(page_"+(s+1)+")"+c[s]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+h+" 0 R"),e.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(e,t,i){var a={title:t,options:i,children:[]};return null==e&&(e=this.root),e.children.push(a),a},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(t){t.id=e.internal.newObjectDeferred();for(var i=0;i<t.children.length;i++)this.genIds_r(t.children[i])},e.outline.renderRoot=function(e){this.objStart(e),this.line("/Type /Outlines"),e.children.length>0&&(this.line("/First "+this.makeRef(e.children[0])),this.line("/Last "+this.makeRef(e.children[e.children.length-1]))),this.line("/Count "+this.count_r({count:0},e)),this.objEnd()},e.outline.renderItems=function(t){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,a=0;a<t.children.length;a++){var s=t.children[a];this.objStart(s),this.line("/Title "+this.makeString(s.title)),this.line("/Parent "+this.makeRef(t)),a>0&&this.line("/Prev "+this.makeRef(t.children[a-1])),a<t.children.length-1&&this.line("/Next "+this.makeRef(t.children[a+1])),s.children.length>0&&(this.line("/First "+this.makeRef(s.children[0])),this.line("/Last "+this.makeRef(s.children[s.children.length-1])));var r=this.count=this.count_r({count:0},s);if(r>0&&this.line("/Count "+r),s.options&&s.options.pageNumber){var n=e.internal.getPageInfo(s.options.pageNumber);this.line("/Dest ["+n.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var o=0;o<t.children.length;o++)this.renderItems(t.children[o])},e.outline.line=function(e){this.ctx.val+=e+"\r\n"},e.outline.makeRef=function(e){return e.id+" 0 R"},e.outline.makeString=function(t){return"("+e.internal.pdfEscape(t)+")"},e.outline.objStart=function(e){this.ctx.val+="\r\n"+e.id+" 0 obj\r\n<<\r\n"},e.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},e.outline.count_r=function(e,t){for(var i=0;i<t.children.length;i++)e.count++,this.count_r(e,t.children[i]);return e.count}}])}(uL.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(e,i,a,s,r,n){var o,l=this.decode.DCT_DECODE,c=null;if("string"==typeof e||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=r||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,o=function(e){for(var i,a=256*e.charCodeAt(4)+e.charCodeAt(5),s=e.length,r={width:0,height:0,numcomponents:1},n=4;n<s;n+=2){if(n+=a,-1!==t.indexOf(e.charCodeAt(n+1))){i=256*e.charCodeAt(n+5)+e.charCodeAt(n+6),r={width:256*e.charCodeAt(n+7)+e.charCodeAt(n+8),height:i,numcomponents:e.charCodeAt(n+9)};break}a=256*e.charCodeAt(n+2)+e.charCodeAt(n+3)}return r}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e),o.numcomponents){case 1:n=this.color_spaces.DEVICE_GRAY;break;case 4:n=this.color_spaces.DEVICE_CMYK;break;case 3:n=this.color_spaces.DEVICE_RGB}c={data:e,width:o.width,height:o.height,colorSpace:n,bitsPerComponent:8,filter:l,index:i,alias:a}}return c}}(uL.API),uL.API.processPNG=function(e,t,i,a){if(this.__addimage__.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.__addimage__.isArrayBufferView(e)){var s,r=new zM(e,{checkCrc:!0}).decode(),n=r.width,o=r.height,l=r.channels,c=r.palette,d=r.depth;s=c&&1===l?function(e){for(var t=e.width,i=e.height,a=e.data,s=e.palette,r=e.depth,n=!1,o=[],l=[],c=void 0,d=!1,u=0,h=0;h<s.length;h++){var m=pP(s[h],4),p=m[0],f=m[1],g=m[2],x=m[3];o.push(p,f,g),null!=x&&(0===x?(u++,l.length<1&&l.push(h)):x<255&&(d=!0))}if(d||u>1){n=!0,l=void 0;var b=t*i;c=new Uint8Array(b);for(var v=new DataView(a.buffer),y=0;y<b;y++){var w=pP(s[IF(v,y,r)],4)[3];c[y]=w}}else 0===u&&(l=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:n?8:void 0,colorBytes:a,alphaBytes:c,needSMask:n,palette:o,mask:l}}(r):2===l||4===l?function(e){for(var t=e.data,i=e.width,a=e.height,s=e.channels,r=e.depth,n=2===s?"DeviceGray":"DeviceRGB",o=s-1,l=i*a,c=o,d=l*c,u=1*l,h=Math.ceil(d*r/8),m=Math.ceil(u*r/8),p=new Uint8Array(h),f=new Uint8Array(m),g=new DataView(t.buffer),x=new DataView(p.buffer),b=new DataView(f.buffer),v=!1,y=0;y<l;y++){for(var w=y*s,N=0;N<c;N++)PF(x,IF(g,w+N,r),y*c+N,r);var j=IF(g,w+c,r);j<(1<<r)-1&&(v=!0),PF(b,j,1*y,r)}return{colorSpace:n,colorsPerPixel:o,sMaskBitsPerComponent:v?r:void 0,colorBytes:p,alphaBytes:f,needSMask:v}}(r):function(e){var t=e.data,i=1===e.channels?"DeviceGray":"DeviceRGB";return{colorSpace:i,colorsPerPixel:"DeviceGray"===i?1:3,colorBytes:t instanceof Uint16Array?function(e){for(var t=e.length,i=new Uint8Array(2*t),a=new DataView(i.buffer,i.byteOffset,i.byteLength),s=0;s<t;s++)a.setUint16(2*s,e[s],!1);return i}(t):t,needSMask:!1}}(r);var u,h,m,p=s,f=p.colorSpace,g=p.colorsPerPixel,x=p.sMaskBitsPerComponent,b=p.colorBytes,v=p.alphaBytes,y=p.needSMask,w=p.palette,N=p.mask,j=null;return a!==uL.API.image_compression.NONE?(j=function(e){var t;switch(e){case uL.API.image_compression.FAST:t=11;break;case uL.API.image_compression.MEDIUM:t=13;break;case uL.API.image_compression.SLOW:t=14;break;default:t=12}return t}(a),u=this.decode.FLATE_DECODE,h="/Predictor ".concat(j," /Colors ").concat(g," /BitsPerComponent ").concat(d," /Columns ").concat(n),e=jF(b,Math.ceil(n*g*d/8),g,d,a),y&&(m=jF(v,Math.ceil(n*x/8),1,x,a))):(u=void 0,h=void 0,e=b,y&&(m=v)),(this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e))&&(e=this.__addimage__.arrayBufferToBinaryString(e)),(m&&this.__addimage__.isArrayBuffer(m)||this.__addimage__.isArrayBufferView(m))&&(m=this.__addimage__.arrayBufferToBinaryString(m)),{alias:i,data:e,index:t,filter:u,decodeParameters:h,transparency:N,palette:w,sMask:m,predictor:j,width:n,height:o,bitsPerComponent:d,sMaskBitsPerComponent:x,colorSpace:f}}},function(e){e.processGIF89A=function(t,i,a,s){var r=new MF(t),n=r.width,o=r.height,l=[];r.decodeAndBlitFrameRGBA(0,l);var c={data:l,width:n,height:o},d=new FF(100).encode(c,100);return e.processJPEG.call(this,d,i,a,s)},e.processGIF87A=e.processGIF89A}(uL.API),OF.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:s,green:a,blue:i,quad:r}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},OF.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(Gd){MM.log("bit decode error:"+Gd)}},OF.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),i=t%4;for(e=this.height-1;e>=0;e--){for(var a=this.bottom_up?e:this.height-1-e,s=0;s<t;s++)for(var r=this.datav.getUint8(this.pos++,!0),n=a*this.width*4+8*s*4,o=0;o<8&&8*s+o<this.width;o++){var l=this.palette[r>>7-o&1];this.data[n+4*o]=l.blue,this.data[n+4*o+1]=l.green,this.data[n+4*o+2]=l.red,this.data[n+4*o+3]=255}0!==i&&(this.pos+=4-i)}},OF.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,i=this.height-1;i>=0;i--){for(var a=this.bottom_up?i:this.height-1-i,s=0;s<e;s++){var r=this.datav.getUint8(this.pos++,!0),n=a*this.width*4+2*s*4,o=r>>4,l=15&r,c=this.palette[o];if(this.data[n]=c.blue,this.data[n+1]=c.green,this.data[n+2]=c.red,this.data[n+3]=255,2*s+1>=this.width)break;c=this.palette[l],this.data[n+4]=c.blue,this.data[n+4+1]=c.green,this.data[n+4+2]=c.red,this.data[n+4+3]=255}0!==t&&(this.pos+=4-t)}},OF.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,a=0;a<this.width;a++){var s=this.datav.getUint8(this.pos++,!0),r=i*this.width*4+4*a;if(s<this.palette.length){var n=this.palette[s];this.data[r]=n.red,this.data[r+1]=n.green,this.data[r+2]=n.blue,this.data[r+3]=255}else this.data[r]=255,this.data[r+1]=255,this.data[r+2]=255,this.data[r+3]=255}0!==e&&(this.pos+=4-e)}},OF.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),i=this.height-1;i>=0;i--){for(var a=this.bottom_up?i:this.height-1-i,s=0;s<this.width;s++){var r=this.datav.getUint16(this.pos,!0);this.pos+=2;var n=(r&t)/t*255|0,o=(r>>5&t)/t*255|0,l=(r>>10&t)/t*255|0,c=r>>15?255:0,d=a*this.width*4+4*s;this.data[d]=l,this.data[d+1]=o,this.data[d+2]=n,this.data[d+3]=c}this.pos+=e}},OF.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),i=parseInt("111111",2),a=this.height-1;a>=0;a--){for(var s=this.bottom_up?a:this.height-1-a,r=0;r<this.width;r++){var n=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(n&t)/t*255|0,l=(n>>5&i)/i*255|0,c=(n>>11)/t*255|0,d=s*this.width*4+4*r;this.data[d]=c,this.data[d+1]=l,this.data[d+2]=o,this.data[d+3]=255}this.pos+=e}},OF.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var a=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),n=t*this.width*4+4*i;this.data[n]=r,this.data[n+1]=s,this.data[n+2]=a,this.data[n+3]=255}this.pos+=this.width%4}},OF.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var a=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*i;this.data[o]=r,this.data[o+1]=s,this.data[o+2]=a,this.data[o+3]=n}},OF.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,i,a,s){var r=new OF(t,!1),n=r.width,o=r.height,l={data:r.getData(),width:n,height:o},c=new FF(100).encode(l,100);return e.processJPEG.call(this,c,i,a,s)}}(uL.API),DF.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,i,a,s){var r=new DF(t),n=r.width,o=r.height,l={data:r.getData(),width:n,height:o},c=new FF(100).encode(l,100);return e.processJPEG.call(this,c,i,a,s)}}(uL.API),uL.API.processRGBA=function(e,t,i){for(var a=e.data,s=a.length,r=new Uint8Array(s/4*3),n=new Uint8Array(s/4),o=0,l=0,c=0;c<s;c+=4){var d=a[c],u=a[c+1],h=a[c+2],m=a[c+3];r[o++]=d,r[o++]=u,r[o++]=h,n[l++]=m}var p=this.__addimage__.arrayBufferToBinaryString(r);return{alpha:this.__addimage__.arrayBufferToBinaryString(n),data:p,index:t,alias:i,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},uL.API.setLanguage=function(e){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]&&(this.internal.languageSettings.languageCode=e,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},xF=uL.API,bF=xF.getCharWidthsArray=function(e,t){var i,a,s=(t=t||{}).font||this.internal.getFont(),r=t.fontSize||this.internal.getFontSize(),n=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:s.metadata.Unicode.widths,l=o.fof?o.fof:1,c=t.kerning?t.kerning:s.metadata.Unicode.kerning,d=c.fof?c.fof:1,u=!1!==t.doKerning,h=0,m=e.length,p=0,f=o[0]||l,g=[];for(i=0;i<m;i++)a=e.charCodeAt(i),"function"==typeof s.metadata.widthOfString?g.push((s.metadata.widthOfGlyph(s.metadata.characterToGlyph(a))+n*(1e3/r)||0)/1e3):(h=u&&"object"===II(c[a])&&!isNaN(parseInt(c[a][p],10))?c[a][p]/d:0,g.push((o[a]||f)/l+h)),p=a;return g},vF=xF.getStringUnitWidth=function(e,t){var i=(t=t||{}).fontSize||this.internal.getFontSize(),a=t.font||this.internal.getFont(),s=t.charSpace||this.internal.getCharSpace();return xF.processArabic&&(e=xF.processArabic(e)),"function"==typeof a.metadata.widthOfString?a.metadata.widthOfString(e,i,s)/i:bF.apply(this,arguments).reduce(function(e,t){return e+t},0)},yF=function(e,t,i,a){for(var s=[],r=0,n=e.length,o=0;r!==n&&o+t[r]<i;)o+=t[r],r++;s.push(e.slice(0,r));var l=r;for(o=0;r!==n;)o+t[r]>a&&(s.push(e.slice(l,r)),o=0,l=r),o+=t[r],r++;return l!==r&&s.push(e.slice(l,r)),s},wF=function(e,t,i){i||(i={});var a,s,r,n,o,l,c,d=[],u=[d],h=i.textIndent||0,m=0,p=0,f=e.split(" "),g=bF.apply(this,[" ",i])[0];if(l=-1===i.lineIndent?f[0].length+2:i.lineIndent||0){var x=Array(l).join(" "),b=[];f.map(function(e){(e=e.split(/\s*\n/)).length>1?b=b.concat(e.map(function(e,t){return(t&&e.length?"\n":"")+e})):b.push(e[0])}),f=b,l=vF.apply(this,[x,i])}for(r=0,n=f.length;r<n;r++){var v=0;if(a=f[r],l&&"\n"==a[0]&&(a=a.substr(1),v=1),h+m+(p=(s=bF.apply(this,[a,i])).reduce(function(e,t){return e+t},0))>t||v){if(p>t){for(o=yF.apply(this,[a,s,t-(h+m),t]),d.push(o.shift()),d=[o.pop()];o.length;)u.push([o.shift()]);p=s.slice(a.length-(d[0]?d[0].length:0)).reduce(function(e,t){return e+t},0)}else d=[a];u.push(d),h=p+l,m=g}else d.push(a),h+=m+p,m=g}return c=l?function(e,t){return(t?x:"")+e.join(" ")}:function(e){return e.join(" ")},u.map(c)},xF.splitTextToSize=function(e,t,i){var a,s=(i=i||{}).fontSize||this.internal.getFontSize(),r=function(e){if(e.widths&&e.kerning)return{widths:e.widths,kerning:e.kerning};var t=this.internal.getFont(e.fontName,e.fontStyle),i="Unicode";return t.metadata[i]?{widths:t.metadata[i].widths||{0:1},kerning:t.metadata[i].kerning||{}}:{font:t.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,i);a=Array.isArray(e)?e:String(e).split(/\r?\n/);var n=1*this.internal.scaleFactor*t/s;r.textIndent=i.textIndent?1*i.textIndent*this.internal.scaleFactor/s:0,r.lineIndent=i.lineIndent;var o,l,c=[];for(o=0,l=a.length;o<l;o++)c=c.concat(wF.apply(this,[a[o],n,r]));return c},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="0123456789abcdef",i="klmnopqrstuvwxyz",a={},s={},r=0;r<16;r++)a[i[r]]=t[r],s[t[r]]=i[r];var n=function(e){return"0x"+parseInt(e,10).toString(16)},o=e.__fontmetrics__.compress=function(e){var t,i,a,r,l=["{"];for(var c in e){if(t=e[c],isNaN(parseInt(c,10))?i="'"+c+"'":(c=parseInt(c,10),i=(i=n(c).slice(2)).slice(0,-1)+s[i.slice(-1)]),"number"==typeof t)t<0?(a=n(t).slice(3),r="-"):(a=n(t).slice(2),r=""),a=r+a.slice(0,-1)+s[a.slice(-1)];else{if("object"!==II(t))throw new Error("Don't know what to do with value type "+II(t)+".");a=o(t)}l.push(i+a)}return l.push("}"),l.join("")},l=e.__fontmetrics__.uncompress=function(e){if("string"!=typeof e)throw new Error("Invalid argument passed to uncompress.");for(var t,i,s,r,n={},o=1,l=n,c=[],d="",u="",h=e.length-1,m=1;m<h;m+=1)"'"==(r=e[m])?t?(s=t.join(""),t=void 0):t=[]:t?t.push(r):"{"==r?(c.push([l,s]),l={},s=void 0):"}"==r?((i=c.pop())[0][i[1]]=l,s=void 0,l=i[0]):"-"==r?o=-1:void 0===s?a.hasOwnProperty(r)?(d+=a[r],s=parseInt(d,16)*o,o=1,d=""):d+=r:a.hasOwnProperty(r)?(u+=a[r],l[s]=parseInt(u,16)*o,o=1,s=void 0,u=""):u+=r;return n},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},d={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},u={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(e){var t=e.font,i=u.Unicode[t.postScriptName];i&&(t.metadata.Unicode={},t.metadata.Unicode.widths=i.widths,t.metadata.Unicode.kerning=i.kerning);var a=d.Unicode[t.postScriptName];a&&(t.metadata.Unicode.encoding=a,t.encoding=a.codePages[0])}])}(uL.API),function(e){var t=function(e){for(var t=e.length,i=new Uint8Array(t),a=0;a<t;a++)i[a]=e.charCodeAt(a);return i};e.API.events.push(["addFont",function(i){var a=void 0,s=i.font,r=i.instance;if(!s.isStandardFont){if(void 0===r)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");if("string"!=typeof(a=!1===r.existsFileInVFS(s.postScriptName)?r.loadFile(s.postScriptName):r.getFileFromVFS(s.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");!function(i,a){a=/^\x00\x01\x00\x00/.test(a)?t(a):t(BM(a)),i.metadata=e.API.TTFFont.open(a),i.metadata.Unicode=i.metadata.Unicode||{encoding:{},kerning:{},widths:[]},i.metadata.glyIdsUsed=[0]}(s,a)}}])}(uL),uL.API.addSvgAsImage=function(e,t,i,a,s,r,n,o){if(isNaN(t)||isNaN(i))throw MM.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(a)||isNaN(s))throw MM.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var l=document.createElement("canvas");l.width=a,l.height=s;var c=l.getContext("2d");c.fillStyle="#fff",c.fillRect(0,0,l.width,l.height);var d={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},u=this;return(PM.canvg?Promise.resolve(PM.canvg):ae(()=>import("./index.es.C2sUtx33.js"),__vite__mapDeps([11,2,5,3,1,7,6,8,9]))).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e}).then(function(t){return t.fromString(c,e,d)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(e){return e.render(d)}).then(function(){u.addImage(l.toDataURL("image/jpeg",1),t,i,a,s,n,o)})},uL.API.putTotalPages=function(e){var t,i=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),i=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),i=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var a=1;a<=this.internal.getNumberOfPages();a++)for(var s=0;s<this.internal.pages[a].length;s++)this.internal.pages[a][s]=this.internal.pages[a][s].replace(t,i);return this},uL.API.viewerPreferences=function(e,t){var i;e=e||{},t=t||!1;var a,s,r,n={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(n),l=[],c=0,d=0,u=0;function h(e,t){var i,a=!1;for(i=0;i<e.length;i+=1)e[i]===t&&(a=!0);return a}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(n)),this.internal.viewerpreferences.isSubscribed=!1),i=this.internal.viewerpreferences.configuration,"reset"===e||!0===t){var m=o.length;for(u=0;u<m;u+=1)i[o[u]].value=i[o[u]].defaultValue,i[o[u]].explicitSet=!1}if("object"===II(e))for(s in e)if(r=e[s],h(o,s)&&void 0!==r){if("boolean"===i[s].type&&"boolean"==typeof r)i[s].value=r;else if("name"===i[s].type&&h(i[s].valueSet,r))i[s].value=r;else if("integer"===i[s].type&&Number.isInteger(r))i[s].value=r;else if("array"===i[s].type){for(c=0;c<r.length;c+=1)if(a=!0,1===r[c].length&&"number"==typeof r[c][0])l.push(String(r[c]-1));else if(r[c].length>1){for(d=0;d<r[c].length;d+=1)"number"!=typeof r[c][d]&&(a=!1);!0===a&&l.push([r[c][0]-1,r[c][1]-1].join(" "))}i[s].value="["+l.join(" ")+"]"}else i[s].value=i[s].defaultValue;i[s].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){var e,t=[];for(e in i)!0===i[e].explicitSet&&("name"===i[e].type?t.push("/"+e+" /"+i[e].value):t.push("/"+e+" "+i[e].value));0!==t.length&&this.internal.write("/ViewerPreferences\n<<\n"+t.join("\n")+"\n>>")}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=i,this},function(e){var t=function(){var e='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',t=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),i=unescape(encodeURIComponent(e)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),r=unescape(encodeURIComponent("</x:xmpmeta>")),n=i.length+a.length+s.length+t.length+r.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+n+" >>"),this.internal.write("stream"),this.internal.write(t+i+a+s+r),this.internal.write("endstream"),this.internal.write("endobj")},i=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(e,a){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:e,namespaceuri:a||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",i),this.internal.events.subscribe("postPutResources",t)),this}}(uL.API),function(e){var t=e.API,i=t.pdfEscape16=function(e,t){for(var i,a=t.metadata.Unicode.widths,s=["","0","00","000","0000"],r=[""],n=0,o=e.length;n<o;++n){if(i=t.metadata.characterToGlyph(e.charCodeAt(n)),t.metadata.glyIdsUsed.push(i),t.metadata.toUnicode[i]=e.charCodeAt(n),-1==a.indexOf(i)&&(a.push(i),a.push([parseInt(t.metadata.widthOfGlyph(i),10)])),"0"==i)return r.join("");i=i.toString(16),r.push(s[4-i.length],i)}return r.join("")},a=function(e){var t,i,a,s,r,n,o;for(r="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",a=[],n=0,o=(i=Object.keys(e).sort(function(e,t){return e-t})).length;n<o;n++)t=i[n],a.length>=100&&(r+="\n"+a.length+" beginbfchar\n"+a.join("\n")+"\nendbfchar",a=[]),void 0!==e[t]&&null!==e[t]&&"function"==typeof e[t].toString&&(s=("0000"+e[t].toString(16)).slice(-4),t=("0000"+(+t).toString(16)).slice(-4),a.push("<"+t+"><"+s+">"));return a.length&&(r+="\n"+a.length+" beginbfchar\n"+a.join("\n")+"\nendbfchar\n"),r+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};t.events.push(["putFont",function(t){!function(t){var i=t.font,s=t.out,r=t.newObject,n=t.putStream;if(i.metadata instanceof e.API.TTFFont&&"Identity-H"===i.encoding){for(var o=i.metadata.Unicode.widths,l=i.metadata.subset.encode(i.metadata.glyIdsUsed,1),c="",d=0;d<l.length;d++)c+=String.fromCharCode(l[d]);var u=r();n({data:c,addLength1:!0,objectId:u}),s("endobj");var h=r();n({data:a(i.metadata.toUnicode),addLength1:!0,objectId:h}),s("endobj");var m=r();s("<<"),s("/Type /FontDescriptor"),s("/FontName /"+rL(i.fontName)),s("/FontFile2 "+u+" 0 R"),s("/FontBBox "+e.API.PDFObject.convert(i.metadata.bbox)),s("/Flags "+i.metadata.flags),s("/StemV "+i.metadata.stemV),s("/ItalicAngle "+i.metadata.italicAngle),s("/Ascent "+i.metadata.ascender),s("/Descent "+i.metadata.decender),s("/CapHeight "+i.metadata.capHeight),s(">>"),s("endobj");var p=r();s("<<"),s("/Type /Font"),s("/BaseFont /"+rL(i.fontName)),s("/FontDescriptor "+m+" 0 R"),s("/W "+e.API.PDFObject.convert(o)),s("/CIDToGIDMap /Identity"),s("/DW 1000"),s("/Subtype /CIDFontType2"),s("/CIDSystemInfo"),s("<<"),s("/Supplement 0"),s("/Registry (Adobe)"),s("/Ordering ("+i.encoding+")"),s(">>"),s(">>"),s("endobj"),i.objectNumber=r(),s("<<"),s("/Type /Font"),s("/Subtype /Type0"),s("/ToUnicode "+h+" 0 R"),s("/BaseFont /"+rL(i.fontName)),s("/Encoding /"+i.encoding),s("/DescendantFonts ["+p+" 0 R]"),s(">>"),s("endobj"),i.isAlreadyPutted=!0}}(t)}]),t.events.push(["putFont",function(t){!function(t){var i=t.font,s=t.out,r=t.newObject,n=t.putStream;if(i.metadata instanceof e.API.TTFFont&&"WinAnsiEncoding"===i.encoding){for(var o=i.metadata.rawData,l="",c=0;c<o.length;c++)l+=String.fromCharCode(o[c]);var d=r();n({data:l,addLength1:!0,objectId:d}),s("endobj");var u=r();n({data:a(i.metadata.toUnicode),addLength1:!0,objectId:u}),s("endobj");var h=r();s("<<"),s("/Descent "+i.metadata.decender),s("/CapHeight "+i.metadata.capHeight),s("/StemV "+i.metadata.stemV),s("/Type /FontDescriptor"),s("/FontFile2 "+d+" 0 R"),s("/Flags 96"),s("/FontBBox "+e.API.PDFObject.convert(i.metadata.bbox)),s("/FontName /"+rL(i.fontName)),s("/ItalicAngle "+i.metadata.italicAngle),s("/Ascent "+i.metadata.ascender),s(">>"),s("endobj"),i.objectNumber=r();for(var m=0;m<i.metadata.hmtx.widths.length;m++)i.metadata.hmtx.widths[m]=parseInt(i.metadata.hmtx.widths[m]*(1e3/i.metadata.head.unitsPerEm));s("<</Subtype/TrueType/Type/Font/ToUnicode "+u+" 0 R/BaseFont/"+rL(i.fontName)+"/FontDescriptor "+h+" 0 R/Encoding/"+i.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(i.metadata.hmtx.widths)+">>"),s("endobj"),i.isAlreadyPutted=!0}}(t)}]);var s=function(e){var t,a=e.text||"",s=e.x,r=e.y,n=e.options||{},o=e.mutex||{},l=o.pdfEscape,c=o.activeFontKey,d=o.fonts,u=c,h="",m=0,p="",f=d[u].encoding;if("Identity-H"!==d[u].encoding)return{text:a,x:s,y:r,options:n,mutex:o};for(p=a,u=c,Array.isArray(a)&&(p=a[0]),m=0;m<p.length;m+=1)d[u].metadata.hasOwnProperty("cmap")&&(t=d[u].metadata.cmap.unicode.codeMap[p[m].charCodeAt(0)]),t||p[m].charCodeAt(0)<256&&d[u].metadata.hasOwnProperty("Unicode")?h+=p[m]:h+="";var g="";return parseInt(u.slice(1))<14||"WinAnsiEncoding"===f?g=l(h,u).split("").map(function(e){return e.charCodeAt(0).toString(16)}).join(""):"Identity-H"===f&&(g=i(h,d[u])),o.isHex=!0,{text:g,x:s,y:r,options:n,mutex:o}};t.events.push(["postProcessText",function(e){var t=e.text||"",i=[],a={text:t,x:e.x,y:e.y,options:e.options,mutex:e.mutex};if(Array.isArray(t)){var r=0;for(r=0;r<t.length;r+=1)Array.isArray(t[r])&&3===t[r].length?i.push([s(Object.assign({},a,{text:t[r][0]})).text,t[r][1],t[r][2]]):i.push(s(Object.assign({},a,{text:t[r]})).text);e.text=i}else e.text=s(Object.assign({},a,{text:t})).text}])}(uL),function(e){var t=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]},e.addFileToVFS=function(e,i){return t.call(this),this.internal.vFS[e]=i,this},e.getFileFromVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]?this.internal.vFS[e]:null}}(uL.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(e){var i,a,s,r,n,o,l,c=t,d=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],u=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],h={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},m={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},p=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],f=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),g=!1,x=0;this.__bidiEngine__={};var b=function(e){var t=e.charCodeAt(),i=t>>8,a=m[i];return void 0!==a?c[256*a+(255&t)]:252===i||253===i?"AL":f.test(i)?"L":8===i?"R":"N"},v=function(e){for(var t,i=0;i<e.length;i++){if("L"===(t=b(e.charAt(i))))return!1;if("R"===t)return!0}return!1},y=function(e,t,n,o){var l,c,d,u,h=t[o];switch(h){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":g=!1;break;case"N":case"AN":break;case"EN":g&&(h="AN");break;case"AL":g=!0,h="R";break;case"WS":case"BN":h="N";break;case"CS":o<1||o+1>=t.length||"EN"!==(l=n[o-1])&&"AN"!==l||"EN"!==(c=t[o+1])&&"AN"!==c?h="N":g&&(c="AN"),h=c===l?c:"N";break;case"ES":h="EN"===(l=o>0?n[o-1]:"B")&&o+1<t.length&&"EN"===t[o+1]?"EN":"N";break;case"ET":if(o>0&&"EN"===n[o-1]){h="EN";break}if(g){h="N";break}for(d=o+1,u=t.length;d<u&&"ET"===t[d];)d++;h=d<u&&"EN"===t[d]?"EN":"N";break;case"NSM":if(s&&!r){for(u=t.length,d=o+1;d<u&&"NSM"===t[d];)d++;if(d<u){var m=e[o],p=m>=1425&&m<=2303||64286===m;if(l=t[d],p&&("R"===l||"AL"===l)){h="R";break}}}h=o<1||"B"===(l=t[o-1])?"N":n[o-1];break;case"B":g=!1,i=!0,h=x;break;case"S":a=!0,h="N"}return h},w=function(e,t,i){var a=e.split("");return i&&N(a,i,{hiLevel:x}),a.reverse(),t&&t.reverse(),a.join("")},N=function(e,t,s){var r,n,o,l,c,m=-1,p=e.length,f=0,v=[],w=x?u:d,N=[];for(g=!1,i=!1,a=!1,n=0;n<p;n++)N[n]=b(e[n]);for(o=0;o<p;o++){if(c=f,v[o]=y(e,N,v,o),r=240&(f=w[c][h[v[o]]]),f&=15,t[o]=l=w[f][5],r>0)if(16===r){for(n=m;n<o;n++)t[n]=1;m=-1}else m=-1;if(w[f][6])-1===m&&(m=o);else if(m>-1){for(n=m;n<o;n++)t[n]=l;m=-1}"B"===N[o]&&(t[o]=0),s.hiLevel|=l}a&&function(e,t,i){for(var a=0;a<i;a++)if("S"===e[a]){t[a]=x;for(var s=a-1;s>=0&&"WS"===e[s];s--)t[s]=x}}(N,t,p)},j=function(e,t,a,s,r){if(!(r.hiLevel<e)){if(1===e&&1===x&&!i)return t.reverse(),void(a&&a.reverse());for(var n,o,l,c,d=t.length,u=0;u<d;){if(s[u]>=e){for(l=u+1;l<d&&s[l]>=e;)l++;for(c=u,o=l-1;c<o;c++,o--)n=t[c],t[c]=t[o],t[o]=n,a&&(n=a[c],a[c]=a[o],a[o]=n);u=l}u++}}},S=function(e,t,i){var a=e.split(""),s={hiLevel:x};return i||(i=[]),N(a,i,s),function(e,t,i){if(0!==i.hiLevel&&l)for(var a,s=0;s<e.length;s++)1===t[s]&&(a=p.indexOf(e[s]))>=0&&(e[s]=p[a+1])}(a,i,s),j(2,a,t,i,s),j(1,a,t,i,s),a.join("")};return this.__bidiEngine__.doBidiReorder=function(e,t,i){if(function(e,t){if(t)for(var i=0;i<e.length;i++)t[i]=i;void 0===r&&(r=v(e)),void 0===o&&(o=v(e))}(e,t),s||!n||o)if(s&&n&&r^o)x=r?1:0,e=w(e,t,i);else if(!s&&n&&o)x=r?1:0,e=S(e,t,i),e=w(e,t);else if(!s||r||n||o){if(s&&!n&&r^o)e=w(e,t),r?(x=0,e=S(e,t,i)):(x=1,e=S(e,t,i),e=w(e,t));else if(s&&r&&!n&&o)x=1,e=S(e,t,i),e=w(e,t);else if(!s&&!n&&r^o){var a=l;r?(x=1,e=S(e,t,i),x=0,l=!1,e=S(e,t,i),l=a):(x=0,e=S(e,t,i),e=w(e,t),x=1,l=!1,e=S(e,t,i),l=a,e=w(e,t))}}else x=0,e=S(e,t,i);else x=r?1:0,e=S(e,t,i);return e},this.__bidiEngine__.setOptions=function(e){e&&(s=e.isInputVisual,n=e.isOutputVisual,r=e.isInputRtl,o=e.isOutputRtl,l=e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(e),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],i=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(e){var t=e.text;e.x,e.y;var a=e.options||{};e.mutex,a.lang;var s=[];if(a.isInputVisual="boolean"!=typeof a.isInputVisual||a.isInputVisual,i.setOptions(a),"[object Array]"===Object.prototype.toString.call(t)){var r=0;for(s=[],r=0;r<t.length;r+=1)"[object Array]"===Object.prototype.toString.call(t[r])?s.push([i.doBidiReorder(t[r][0]),t[r][1],t[r][2]]):s.push([i.doBidiReorder(t[r])]);e.text=s}else e.text=i.doBidiReorder(t);i.setOptions({isInputVisual:!0})}])}(uL),uL.API.TTFFont=function(){function e(e){var t;if(this.rawData=e,t=this.contents=new BF(e),this.contents.pos=4,"ttcf"===t.readString(4))throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new rO(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new UF(this.contents),this.head=new WF(this),this.name=new XF(this),this.cmap=new ZF(this),this.toUnicode={},this.hhea=new VF(this),this.maxp=new JF(this),this.hmtx=new QF(this),this.post=new YF(this),this.os2=new GF(this),this.loca=new sO(this),this.glyf=new tO(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var e,t,i,a,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var t,i,a,s;for(s=[],t=0,i=(a=this.bbox).length;t<i;t++)e=a[t],s.push(Math.round(e*this.scaleFactor));return s}.call(this),this.stemV=0,this.post.exists?(i=255&(a=this.post.italic_angle),32768&(t=a>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(s=this.familyClass)||2===s||3===s||4===s||5===s||7===s,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(e){var t;return(null!=(t=this.cmap.unicode)?t.codeMap[e]:void 0)||0},e.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},e.prototype.widthOfString=function(e,t,i){var a,s,r,n;for(r=0,s=0,n=(e=""+e).length;0<=n?s<n:s>n;s=0<=n?++s:--s)a=e.charCodeAt(s),r+=this.widthOfGlyph(this.characterToGlyph(a))+i*(1e3/t)||0;return r*(t/1e3)},e.prototype.lineHeight=function(e,t){var i;return null==t&&(t=!1),i=t?this.lineGap:0,(this.ascender+i-this.decender)/1e3*e},e}();var RF,BF=function(){function e(e){this.data=null!=e?e:[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(e){return this.data[this.pos++]=e},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},e.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},e.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},e.prototype.readString=function(e){var t,i;for(i=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)i[t]=String.fromCharCode(this.readByte());return i.join("")},e.prototype.writeString=function(e){var t,i,a;for(a=[],t=0,i=e.length;0<=i?t<i:t>i;t=0<=i?++t:--t)a.push(this.writeByte(e.charCodeAt(t)));return a},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(e){return this.writeInt16(e)},e.prototype.readLongLong=function(){var e,t,i,a,s,r,n,o;return e=this.readByte(),t=this.readByte(),i=this.readByte(),a=this.readByte(),s=this.readByte(),r=this.readByte(),n=this.readByte(),o=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^i)+4294967296*(255^a)+16777216*(255^s)+65536*(255^r)+256*(255^n)+(255^o)+1):72057594037927940*e+281474976710656*t+1099511627776*i+4294967296*a+16777216*s+65536*r+256*n+o},e.prototype.writeLongLong=function(e){var t,i;return t=Math.floor(e/4294967296),i=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(e){return this.writeInt32(e)},e.prototype.read=function(e){var t,i;for(t=[],i=0;0<=e?i<e:i>e;i=0<=e?++i:--i)t.push(this.readByte());return t},e.prototype.write=function(e){var t,i,a,s;for(s=[],i=0,a=e.length;i<a;i++)t=e[i],s.push(this.writeByte(t));return s},e}(),UF=function(){var e;function t(e){var t,i,a;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},i=0,a=this.tableCount;0<=a?i<a:i>a;i=0<=a?++i:--i)t={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[t.tag]=t}return t.prototype.encode=function(t){var i,a,s,r,n,o,l,c,d,u,h,m,p;for(p in h=Object.keys(t).length,o=Math.log(2),d=16*Math.floor(Math.log(h)/o),r=Math.floor(d/o),c=16*h-d,(a=new BF).writeInt(this.scalarType),a.writeShort(h),a.writeShort(d),a.writeShort(r),a.writeShort(c),s=16*h,l=a.pos+s,n=null,m=[],t)for(u=t[p],a.writeString(p),a.writeInt(e(u)),a.writeInt(l),a.writeInt(u.length),m=m.concat(u),"head"===p&&(n=l),l+=u.length;l%4;)m.push(0),l++;return a.write(m),i=2981146554-e(a.data),a.pos=n+8,a.writeUInt32(i),a.data},e=function(e){var t,i,a,s;for(e=eO.call(e);e.length%4;)e.push(0);for(a=new BF(e),i=0,t=0,s=e.length;t<s;t=t+=4)i+=a.readUInt32();return 4294967295&i},t}(),qF={}.hasOwnProperty,$F=function(e,t){for(var i in t)qF.call(t,i)&&(e[i]=t[i]);function a(){this.constructor=e}return a.prototype=t.prototype,e.prototype=new a,e.__super__=t.prototype,e};RF=function(){function e(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var WF=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="head",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},e.prototype.encode=function(e){var t;return(t=new BF).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},e}(),HF=function(){function e(e,t){var i,a,s,r,n,o,l,c,d,u,h,m,p,f,g,x,b;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),d=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=e.readByte();break;case 4:for(h=e.readUInt16(),u=h/2,e.pos+=6,s=function(){var t,i;for(i=[],o=t=0;0<=u?t<u:t>u;o=0<=u?++t:--t)i.push(e.readUInt16());return i}(),e.pos+=2,p=function(){var t,i;for(i=[],o=t=0;0<=u?t<u:t>u;o=0<=u?++t:--t)i.push(e.readUInt16());return i}(),l=function(){var t,i;for(i=[],o=t=0;0<=u?t<u:t>u;o=0<=u?++t:--t)i.push(e.readUInt16());return i}(),c=function(){var t,i;for(i=[],o=t=0;0<=u?t<u:t>u;o=0<=u?++t:--t)i.push(e.readUInt16());return i}(),a=(this.length-e.pos+this.offset)/2,n=function(){var t,i;for(i=[],o=t=0;0<=a?t<a:t>a;o=0<=a?++t:--t)i.push(e.readUInt16());return i}(),o=g=0,b=s.length;g<b;o=++g)for(f=s[o],i=x=m=p[o];m<=f?x<=f:x>=f;i=m<=f?++x:--x)0===c[o]?r=i+l[o]:0!==(r=n[c[o]/2+(i-m)-(u-o)]||0)&&(r+=l[o]),this.codeMap[i]=65535&r}e.pos=d}return e.encode=function(e,t){var i,a,s,r,n,o,l,c,d,u,h,m,p,f,g,x,b,v,y,w,N,j,S,_,k,C,A,z,E,I,P,T,M,L,F,O,D,R,B,U,q,$,W,H,Z,V;switch(z=new BF,r=Object.keys(e).sort(function(e,t){return e-t}),t){case"macroman":for(p=0,f=function(){var e=[];for(m=0;m<256;++m)e.push(0);return e}(),x={0:0},s={},E=0,M=r.length;E<M;E++)null==x[W=e[a=r[E]]]&&(x[W]=++p),s[a]={old:e[a],new:x[e[a]]},f[a]=x[e[a]];return z.writeUInt16(1),z.writeUInt16(0),z.writeUInt32(12),z.writeUInt16(0),z.writeUInt16(262),z.writeUInt16(0),z.write(f),{charMap:s,subtable:z.data,maxGlyphID:p+1};case"unicode":for(C=[],d=[],b=0,x={},i={},g=l=null,I=0,L=r.length;I<L;I++)null==x[y=e[a=r[I]]]&&(x[y]=++b),i[a]={old:y,new:x[y]},n=x[y]-a,null!=g&&n===l||(g&&d.push(g),C.push(a),l=n),g=a;for(g&&d.push(g),d.push(65535),C.push(65535),_=2*(S=C.length),j=2*Math.pow(Math.log(S)/Math.LN2,2),u=Math.log(j/2)/Math.LN2,N=2*S-j,o=[],w=[],h=[],m=P=0,F=C.length;P<F;m=++P){if(k=C[m],c=d[m],65535===k){o.push(0),w.push(0);break}if(k-(A=i[k].new)>=32768)for(o.push(0),w.push(2*(h.length+S-m)),a=T=k;k<=c?T<=c:T>=c;a=k<=c?++T:--T)h.push(i[a].new);else o.push(A-k),w.push(0)}for(z.writeUInt16(3),z.writeUInt16(1),z.writeUInt32(12),z.writeUInt16(4),z.writeUInt16(16+8*S+2*h.length),z.writeUInt16(0),z.writeUInt16(_),z.writeUInt16(j),z.writeUInt16(u),z.writeUInt16(N),q=0,O=d.length;q<O;q++)a=d[q],z.writeUInt16(a);for(z.writeUInt16(0),$=0,D=C.length;$<D;$++)a=C[$],z.writeUInt16(a);for(H=0,R=o.length;H<R;H++)n=o[H],z.writeUInt16(n);for(Z=0,B=w.length;Z<B;Z++)v=w[Z],z.writeUInt16(v);for(V=0,U=h.length;V<U;V++)p=h[V],z.writeUInt16(p);return{charMap:i,subtable:z.data,maxGlyphID:b+1}}},e}(),ZF=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="cmap",e.prototype.parse=function(e){var t,i,a;for(e.pos=this.offset,this.version=e.readUInt16(),a=e.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=a?i<a:i>a;i=0<=a?++i:--i)t=new HF(e,this.offset),this.tables.push(t),t.isUnicode&&null==this.unicode&&(this.unicode=t);return!0},e.encode=function(e,t){var i,a;return null==t&&(t="macroman"),i=HF.encode(e,t),(a=new BF).writeUInt16(0),a.writeUInt16(1),i.table=a.data.concat(i.subtable),i},e}(),VF=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="hhea",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},e}(),GF=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="OS/2",e.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var t,i;for(i=[],t=0;t<10;++t)i.push(e.readByte());return i}(),this.charRange=function(){var t,i;for(i=[],t=0;t<4;++t)i.push(e.readInt());return i}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var t,i;for(i=[],t=0;t<2;t=++t)i.push(e.readInt());return i}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},e}(),YF=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="post",e.prototype.parse=function(e){var t,i,a;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var s;for(i=e.readUInt16(),this.glyphNameIndex=[],s=0;0<=i?s<i:s>i;s=0<=i?++s:--s)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],a=[];e.pos<this.offset+this.length;)t=e.readByte(),a.push(this.names.push(e.readString(t)));return a;case 151552:return i=e.readUInt16(),this.offsets=e.read(i);case 262144:return this.map=function(){var t,i,a;for(a=[],s=t=0,i=this.file.maxp.numGlyphs;0<=i?t<i:t>i;s=0<=i?++t:--t)a.push(e.readUInt32());return a}.call(this)}},e}(),KF=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},XF=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="name",e.prototype.parse=function(e){var t,i,a,s,r,n,o,l,c,d,u;for(e.pos=this.offset,e.readShort(),t=e.readShort(),n=e.readShort(),i=[],s=0;0<=t?s<t:s>t;s=0<=t?++s:--s)i.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+n+e.readShort()});for(o={},s=c=0,d=i.length;c<d;s=++c)a=i[s],e.pos=a.offset,l=e.readString(a.length),r=new KF(l,a),null==o[u=a.nameID]&&(o[u]=[]),o[a.nameID].push(r);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(h){this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},e}(),JF=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="maxp",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},e}(),QF=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="hmtx",e.prototype.parse=function(e){var t,i,a,s,r,n,o;for(e.pos=this.offset,this.metrics=[],t=0,n=this.file.hhea.numberOfMetrics;0<=n?t<n:t>n;t=0<=n?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(a=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var i,s;for(s=[],t=i=0;0<=a?i<a:i>a;t=0<=a?++i:--i)s.push(e.readInt16());return s}(),this.widths=function(){var e,t,i,a;for(a=[],e=0,t=(i=this.metrics).length;e<t;e++)s=i[e],a.push(s.advance);return a}.call(this),i=this.widths[this.widths.length-1],o=[],t=r=0;0<=a?r<a:r>a;t=0<=a?++r:--r)o.push(this.widths.push(i));return o},e.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},e}(),eO=[].slice,tO=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(e){var t,i,a,s,r,n,o,l,c,d;return e in this.cache?this.cache[e]:(s=this.file.loca,t=this.file.contents,i=s.indexOf(e),0===(a=s.lengthOf(e))?this.cache[e]=null:(t.pos=this.offset+i,r=(n=new BF(t.read(a))).readShort(),l=n.readShort(),d=n.readShort(),o=n.readShort(),c=n.readShort(),this.cache[e]=-1===r?new aO(n,l,d,o,c):new iO(n,r,l,d,o,c),this.cache[e]))},e.prototype.encode=function(e,t,i){var a,s,r,n,o;for(r=[],s=[],n=0,o=t.length;n<o;n++)a=e[t[n]],s.push(r.length),a&&(r=r.concat(a.encode(i)));return s.push(r.length),{table:r,offsets:s}},e}(),iO=function(){function e(e,t,i,a,s,r){this.raw=e,this.numberOfContours=t,this.xMin=i,this.yMin=a,this.xMax=s,this.yMax=r,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),aO=function(){function e(e,t,i,a,s){var r,n;for(this.raw=e,this.xMin=t,this.yMin=i,this.xMax=a,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],r=this.raw;n=r.readShort(),this.glyphOffsets.push(r.pos),this.glyphIDs.push(r.readUInt16()),32&n;)r.pos+=1&n?4:2,128&n?r.pos+=8:64&n?r.pos+=4:8&n&&(r.pos+=2)}return e.prototype.encode=function(){var e,t,i;for(t=new BF(eO.call(this.raw.data)),e=0,i=this.glyphIDs.length;e<i;++e)t.pos=this.glyphOffsets[e];return t.data},e}(),sO=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return $F(e,RF),e.prototype.tag="loca",e.prototype.parse=function(e){var t,i;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=0===t?function(){var t,a;for(a=[],i=0,t=this.length;i<t;i+=2)a.push(2*e.readUInt16());return a}.call(this):function(){var t,a;for(a=[],i=0,t=this.length;i<t;i+=4)a.push(e.readUInt32());return a}.call(this)},e.prototype.indexOf=function(e){return this.offsets[e]},e.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},e.prototype.encode=function(e,t){for(var i=new Uint32Array(this.offsets.length),a=0,s=0,r=0;r<i.length;++r)if(i[r]=a,s<t.length&&t[s]==r){++s,i[r]=a;var n=this.offsets[r],o=this.offsets[r+1]-n;o>0&&(a+=o)}for(var l=new Array(4*i.length),c=0;c<i.length;++c)l[4*c+3]=255&i[c],l[4*c+2]=(65280&i[c])>>8,l[4*c+1]=(16711680&i[c])>>16,l[4*c]=(4278190080&i[c])>>24;return l},e}(),rO=function(){function e(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var e,t,i,a,s;for(t in a=this.font.cmap.tables[0].codeMap,e={},s=this.subset)i=s[t],e[t]=a[i];return e},e.prototype.glyphsFor=function(e){var t,i,a,s,r,n,o;for(a={},r=0,n=e.length;r<n;r++)a[s=e[r]]=this.font.glyf.glyphFor(s);for(s in t=[],a)(null!=(i=a[s])?i.compound:void 0)&&t.push.apply(t,i.glyphIDs);if(t.length>0)for(s in o=this.glyphsFor(t))i=o[s],a[s]=i;return a},e.prototype.encode=function(e,t){var i,a,s,r,n,o,l,c,d,u,h,m,p,f,g;for(a in i=ZF.encode(this.generateCmap(),"unicode"),r=this.glyphsFor(e),h={0:0},g=i.charMap)h[(o=g[a]).old]=o.new;for(m in u=i.maxGlyphID,r)m in h||(h[m]=u++);return c=function(e){var t,i;for(t in i={},e)i[e[t]]=t;return i}(h),d=Object.keys(c).sort(function(e,t){return e-t}),p=function(){var e,t,i;for(i=[],e=0,t=d.length;e<t;e++)n=d[e],i.push(c[n]);return i}(),s=this.font.glyf.encode(r,p,h),l=this.font.loca.encode(s.offsets,p),f={cmap:this.font.cmap.raw(),glyf:s.table,loca:l,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(f["OS/2"]=this.font.os2.raw()),this.font.directory.encode(f)},e}();uL.API.PDFObject=function(){var e;function t(){}return e=function(e,t){return(Array(t+1).join("0")+e).slice(-t)},t.convert=function(i){var a,s,r,n;if(Array.isArray(i))return"["+function(){var e,s,r;for(r=[],e=0,s=i.length;e<s;e++)a=i[e],r.push(t.convert(a));return r}().join(" ")+"]";if("string"==typeof i)return"/"+i;if(null!=i?i.isString:void 0)return"("+i+")";if(i instanceof Date)return"(D:"+e(i.getUTCFullYear(),4)+e(i.getUTCMonth(),2)+e(i.getUTCDate(),2)+e(i.getUTCHours(),2)+e(i.getUTCMinutes(),2)+e(i.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(i)){for(s in r=["<<"],i)n=i[s],r.push("/"+s+" "+t.convert(n));return r.push(">>"),r.join("\n")}return""+i},t}();const nO=({onChange:e})=>(dt({click(t){e(t.latlng.lat,t.latlng.lng)}}),null),oO=st.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),lO=({lat:e,lng:t,onChange:i})=>{const a=We.useRef(null),s=We.useMemo(()=>"number"==typeof e&&"number"==typeof t&&isFinite(e)&&isFinite(t)?[e,t]:[46,8],[e,t]),{tileUrl:r,attribution:n}={tileUrl:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'};return se.jsx("div",{className:"rounded-lg overflow-hidden border border-border",children:se.jsxs(rt,{center:s,zoom:12,style:{height:320,width:"100%",background:"transparent",willChange:"transform",transform:"translateZ(0)"},zoomControl:!0,scrollWheelZoom:!0,doubleClickZoom:!0,touchZoom:!0,boxZoom:!0,keyboard:!0,dragging:!0,zoomAnimation:!0,markerZoomAnimation:!0,fadeAnimation:!0,zoomAnimationThreshold:4,preferCanvas:!1,ref:e=>{e&&(a.current=e)},children:[se.jsx(nt,{url:r,attribution:n,maxZoom:18,minZoom:3,keepBuffer:12,updateWhenIdle:!0,updateWhenZooming:!1,crossOrigin:"anonymous",detectRetina:!0,tileSize:256,zoomOffset:0,bounds:[[-90,-180],[90,180]],noWrap:!1,subdomains:["a","b","c"],errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="}),se.jsx(nO,{onChange:i}),"number"==typeof e&&"number"==typeof t&&isFinite(e)&&isFinite(t)&&se.jsx(ot,{position:[e,t],draggable:!0,icon:oO,eventHandlers:{dragend:e=>{const t=e.target.getLatLng();i(t.lat,t.lng)}}})]})})};function cO(){const[e,t]=We.useState(17);We.useEffect(()=>{(async()=>{const{data:e}=await ba.from("app_config").select("value_int").eq("key","marker_min_zoom").maybeSingle();e?.value_int&&t(Number(e.value_int))})()},[]);return se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:"Impostazioni Mappa  Visibilit Marker"})}),se.jsxs(Gl,{className:"space-y-2",children:[se.jsx("div",{className:"text-sm text-muted-foreground",children:"Seleziona lo zoom minimo a cui mostrare i marker sulla mappa."}),se.jsxs(SA,{value:String(e),onValueChange:e=>(async e=>{t(e);const{error:i}=await ba.from("app_config").upsert({key:"marker_min_zoom",value_int:e,value_text:null});i?Ki.error("Salvataggio soglia fallito (serve ruolo admin)"):Ki.success(`Soglia marker aggiornata: zoom  ${e}`)})(Number(e)),children:[se.jsx(kA,{className:"w-40",children:se.jsx(_A,{placeholder:"Seleziona zoom"})}),se.jsx(zA,{children:[14,15,16,17].map(e=>se.jsxs(EA,{value:String(e),children:["Zoom ",e]},e))})]})]})]})}const dO=()=>{const[e,t]=We.useState([]),[i,a]=We.useState({totalActive:0,totalRedeemed:0,buzzRewards:0,clueRewards:0,enigmaRewards:0,fakeRewards:0,failedAttempts:0}),[s,r]=We.useState(!0),[n,o]=We.useState(!1),l=e=>Number.isFinite(e)?Number(e).toFixed(6):"",[c,d]=We.useState({locationName:"",lat:"",lng:"",rewardType:"",rewardContent:"",expiresAt:""}),[u,h]=We.useState(null),[m,p]=We.useState(null);We.useEffect(()=>{try{const e=localStorage.getItem("qr_admin_list");if(e){const i=JSON.parse(e);Array.isArray(i)&&(t(i),r(!1))}}catch{}f(),g()},[]),We.useEffect(()=>()=>{try{localStorage.setItem("qr_admin_list",JSON.stringify(e))}catch{}},[e]);const f=async()=>{try{const{data:e,error:i}=await ba.from("qr_codes").select("code, reward_type, lat, lng, title, is_active, is_hidden, expires_at, created_at").order("created_at",{ascending:!1});if(i)throw i;const a=(e||[]).map(e=>{const t="number"==typeof e.lat?e.lat:Number(e.lat),i="number"==typeof e.lng?e.lng:Number(e.lng);return{id:e.code,reward_type:e.reward_type,message:e.message||"",lat:t,lon:i,location_name:e.title||"",max_distance_meters:100,attivo:e.is_active??!0,scansioni:e.is_active?0:1,redeemed_by:[],expires_at:e.expires_at,creato_da:"",created_at:e.created_at,updated_at:e.created_at}}).filter(e=>Number.isFinite(e.lat)&&Number.isFinite(e.lon));t(a);try{localStorage.setItem("qr_admin_list",JSON.stringify(a))}catch{}}catch(e){console.error("Error loading QR codes:",e),Ki.error("Errore nel caricamento dei QR code")}finally{r(!1)}},g=async()=>{try{const{data:e,error:t}=await ba.from("qr_codes").select("is_active, reward_type");if(t)throw t;const i=e?.filter(e=>!0===e.is_active).length||0,s=e?.filter(e=>!0!==e.is_active).length||0,r=e?.filter(e=>"buzz_credit"===e.reward_type).length||0,n=0,o=0,l=e?.filter(e=>"custom"===e.reward_type).length||0;a({totalActive:i,totalRedeemed:s,buzzRewards:r,clueRewards:n,enigmaRewards:o,fakeRewards:l,failedAttempts:0})}catch(e){console.error("Error loading stats:",e)}},x=(e,t,i)=>{const a=new uL({orientation:"portrait",unit:"mm",format:"a4"});a.setFillColor(0,0,0),a.rect(0,0,210,297,"F"),a.setTextColor(255,255,255),a.setFontSize(28),a.setFont("helvetica","bold"),a.text("M1SSION",105,40,{align:"center"}),a.setTextColor(200,200,200),a.setFontSize(14),a.text("TOP SECRET QR CODE",105,55,{align:"center"});const s=120;a.addImage(e,"PNG",45,80,s,s),a.setTextColor(0,209,255),a.setFontSize(14),a.setFont("helvetica","bold"),a.text(i||"REWARD CLASIFICATO",105,220,{align:"center"}),a.setTextColor(150,150,150),a.setFontSize(12),a.setFont("courier","bold"),a.text(t,105,235,{align:"center"}),a.setTextColor(255,100,100),a.setFontSize(10),a.setFont("helvetica","bold"),a.text(" REWARD CLASSIFICATO",105,250,{align:"center"}),a.setDrawColor(255,255,255),a.setLineWidth(2),a.rect(10,10,190,277),a.save(`M1SSION_QR_${t}.pdf`),Ki.success("PDF generato e scaricato!")},b=(e,t,i)=>{const a=document.createElement("div");a.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0,0,0,0.9);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 10000;\n    ",a.innerHTML=`\n      <div style="\n        background: #000;\n        border: 2px solid #00a3ff;\n        border-radius: 20px;\n        padding: 30px;\n        text-align: center;\n        max-width: 400px;\n        box-shadow: 0 0 50px rgba(0, 163, 255, 0.5);\n      ">\n        <h2 style="color: #00a3ff; margin-bottom: 20px; font-size: 24px;">\n          <span style="color: #00FFFF; text-shadow: 0 0 10px #00FFFF;">M1</span><span style="color: #FFFFFF;">SSION</span> QR CODE\n        </h2>\n        <img src="${e}" style="width: 300px; height: 300px; border-radius: 10px; margin-bottom: 20px;" />\n        <p style="color: #00FFFF; font-size: 16px; margin-bottom: 5px; text-shadow: 0 0 5px #00FFFF;">${i||"REWARD CLASIFICATO"}</p>\n        <p style="color: #999; font-size: 12px; font-family: monospace; margin-bottom: 20px;">${t}</p>\n        <div style="display: flex; gap: 10px; justify-content: center;">\n          <button id="printBtn" style="\n            background: #00a3ff;\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: bold;\n          "> Stampa</button>\n          <button id="closeBtn" style="\n            background: #666;\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            cursor: pointer;\n          ">Chiudi</button>\n        </div>\n      </div>\n    `,document.body.appendChild(a),a.querySelector("#printBtn")?.addEventListener("click",()=>{window.print()}),a.querySelector("#closeBtn")?.addEventListener("click",()=>{document.body.removeChild(a)}),a.addEventListener("click",e=>{e.target===a&&document.body.removeChild(a)})},v=(e,t)=>{let i="REWARD CLASIFICATO";switch(t.rewardType||t.reward_type){case"buzz":case"buzz_gratis":case"buzz_credit":i=" BUZZ GRATUITO";break;case"clue":case"indizio_segreto":i=" INDIZIO SEGRETO";break;case"enigma":case"enigma_misterioso":i=" ENIGMA MISTERIOSO";break;case"fake":case"sorpresa_speciale":i=" SORPRESA SPECIALE";break;case"custom":i=" REWARD PERSONALIZZATO"}(async(e,t)=>{const i=`https://m1ssion.eu/map?marker=${e}`;try{const a=await tE.toDataURL(i,{width:512,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H"}),s=document.createElement("canvas"),r=s.getContext("2d");s.width=512,s.height=512;const n=new Image;n.onload=()=>{r.drawImage(n,0,0,512,512),r.fillStyle="#FFFFFF",r.fillRect(211,211,90,90),r.fillStyle="#000000",r.font="bold 48px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText("M1",256,256);const i=s.toDataURL("image/png");x(i,e,t),b(i,e,t)},n.src=a}catch(a){console.error("Error generating QR:",a),Ki.error("Errore nella generazione del QR Code")}})(e,i)},y=e=>{switch(e){case"buzz_gratis":case"buzz_credit":return"";case"indizio_segreto":return"";case"enigma_misterioso":return"";case"sorpresa_speciale":return"";case"custom":return"";default:return""}},w=e=>{switch(e){case"buzz_gratis":case"buzz_credit":return"bg-green-100 text-green-800";case"indizio_segreto":return"bg-blue-100 text-blue-800";case"enigma_misterioso":return"bg-purple-100 text-purple-800";case"sorpresa_speciale":case"custom":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};return se.jsxs("div",{className:"space-y-6",children:[se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx(lr,{className:"w-8 h-8 text-primary"}),se.jsx("h1",{className:"text-3xl font-bold",children:"QR Control Panel"})]}),se.jsx(cO,{}),se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[se.jsx(Wl,{children:se.jsxs(Gl,{className:"p-4 text-center",children:[se.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.totalActive}),se.jsx("div",{className:"text-sm text-muted-foreground",children:"QR Attivi"})]})}),se.jsx(Wl,{children:se.jsxs(Gl,{className:"p-4 text-center",children:[se.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.totalRedeemed}),se.jsx("div",{className:"text-sm text-muted-foreground",children:"Riscattati"})]})}),se.jsx(Wl,{children:se.jsxs(Gl,{className:"p-4 text-center",children:[se.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.buzzRewards}),se.jsx("div",{className:"text-sm text-muted-foreground",children:"Buzz Dati"})]})}),se.jsx(Wl,{children:se.jsxs(Gl,{className:"p-4 text-center",children:[se.jsx("div",{className:"text-2xl font-bold text-red-600",children:i.failedAttempts}),se.jsx("div",{className:"text-sm text-muted-foreground",children:"Tentativi Falliti"})]})})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(Ms,{className:"w-5 h-5"})," Configurazione Ricompense Marker"]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"locationName",children:"Marker ID *"}),se.jsx(Sl,{id:"locationName",value:c.locationName,onChange:e=>d({...c,locationName:e.target.value}),placeholder:"UUID del marker (es. QR code ID)"})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"rewardType",children:"Tipo Ricompensa *"}),se.jsxs(SA,{value:c.rewardType,onValueChange:e=>d({...c,rewardType:e}),children:[se.jsx(kA,{children:se.jsx(_A,{placeholder:"Seleziona tipo ricompensa"})}),se.jsxs(zA,{className:"z-[100] max-h-[300px] overflow-y-auto bg-card border border-border shadow-xl backdrop-blur-md",children:[se.jsx(EA,{value:"buzz_free",className:"cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent",children:se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-lg",children:""}),se.jsx("span",{children:"BUZZ Gratuiti"})]})}),se.jsx(EA,{value:"message",className:"cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent",children:se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-lg",children:""}),se.jsx("span",{children:"Messaggio"})]})}),se.jsx(EA,{value:"xp_points",className:"cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent",children:se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-lg",children:""}),se.jsx("span",{children:"Punti XP"})]})}),se.jsx(EA,{value:"event_ticket",className:"cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent",children:se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-lg",children:""}),se.jsx("span",{children:"Ticket Evento"})]})}),se.jsx(EA,{value:"badge",className:"cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent",children:se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-lg",children:""}),se.jsx("span",{children:"Badge"})]})})]})]})]})]}),se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsxs(jl,{htmlFor:"lat",children:["Latitudine * ",se.jsx("span",{className:"text-xs text-gray-500",children:"(-90 a +90)"})]}),se.jsx(Sl,{id:"lat",type:"number",step:"any",value:c.lat,onChange:e=>{const t=e.target.value;d({...c,lat:t});const i=parseFloat(t);isFinite(i)&&h(i)},placeholder:"46.0 (Europa)",className:!c.lat||isNaN(parseFloat(c.lat))?"border-red-300":"border-green-300"}),c.lat&&isNaN(parseFloat(c.lat))&&se.jsx("div",{className:"text-xs text-red-500 mt-1",children:" Valore non valido"})]}),se.jsxs("div",{children:[se.jsxs(jl,{htmlFor:"lng",children:["Longitudine * ",se.jsx("span",{className:"text-xs text-gray-500",children:"(-180 a +180)"})]}),se.jsx(Sl,{id:"lng",type:"number",step:"any",value:c.lng,onChange:e=>{const t=e.target.value;d({...c,lng:t});const i=parseFloat(t);isFinite(i)&&p(i)},placeholder:"8.0 (Europa)",className:!c.lng||isNaN(parseFloat(c.lng))?"border-red-300":"border-green-300"}),c.lng&&isNaN(parseFloat(c.lng))&&se.jsx("div",{className:"text-xs text-red-500 mt-1",children:" Valore non valido"})]})]}),se.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[se.jsx("h4",{className:"text-sm font-semibold text-blue-800 mb-2",children:" Coordinate Esempio:"}),se.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[se.jsxs("div",{children:[se.jsx("strong",{children:"Berlin:"})," 52.520008, 13.404954",se.jsx("br",{}),se.jsx("strong",{children:"Europa:"})," 46.0, 8.0",se.jsx("br",{}),se.jsx("strong",{children:"Roma:"})," 41.902782, 12.496365"]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Parigi:"})," 48.856614, 2.352222",se.jsx("br",{}),se.jsx("strong",{children:"Monaco:"})," 43.740070, 7.426540",se.jsx("br",{}),se.jsx("strong",{children:"Monaco:"})," 48.137154, 11.576124"]})]}),se.jsx("div",{className:"mt-2 text-xs text-blue-600",children:' Usa Google Maps per ottenere coordinate precise: click destro  "Cosa c\' qui?"'})]}),se.jsx(lO,{lat:u??(c.lat?parseFloat(c.lat):void 0),lng:m??(c.lng?parseFloat(c.lng):void 0),onChange:(e,t)=>{h(e),p(t),d(i=>({...i,lat:e.toFixed(6),lng:t.toFixed(6)}))}}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"rewardContent",children:"Descrizione (opzionale)"}),se.jsx(Wb,{id:"rewardContent",value:c.rewardContent,onChange:e=>d({...c,rewardContent:e.target.value}),placeholder:"Descrizione breve per il popup del marker...",rows:3})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"expiresAt",children:"Data Scadenza (opzionale)"}),se.jsx(Sl,{id:"expiresAt",type:"datetime-local",value:c.expiresAt,onChange:e=>d({...c,expiresAt:e.target.value})})]}),se.jsx(mo,{onClick:async()=>{if(c.locationName.trim())if(c.rewardType)if(u&&m){c.locationName,c.rewardType;try{o(!0);const e=c.locationName.trim(),{error:t}=await ba.from("qr_codes").upsert([{code:e,title:`Marker ${e}`,lat:u,lng:m,is_active:!0,reward_type:"buzz_credit",expires_at:c.expiresAt||null}]);if(t)throw console.error("M1QR-TRACE:",{step:"qr_codes_error",error:t}),new Error(`Errore creazione marker: ${t.message}`);let i={};switch(c.rewardType){case"buzz_free":i={buzzCount:1};break;case"message":i={text:c.rewardContent||"Congratulazioni agente!"};break;case"xp_points":i={xp:50};break;case"event_ticket":i={event_id:"",ticket_type:"standard"};break;case"badge":i={badge_id:""};break;default:i={}}const{error:a}=await ba.from("marker_rewards").insert([{marker_id:e,reward_type:c.rewardType,payload:i,description:c.rewardContent||`Premio ${c.rewardType}`}]);if(a)throw console.error("M1QR-TRACE:",{step:"marker_rewards_error",error:a}),new Error(`Errore salvataggio ricompense: ${a.message}`);Ki.success(" Marker e ricompense salvati! Ora visibili in mappa."),d({locationName:"",lat:"",lng:"",rewardType:"",rewardContent:"",expiresAt:""}),h(null),p(null),f()}catch(fB){console.error("M1QR-TRACE:",{step:"save_marker_error",error:fB}),Ki.error(` Errore: ${fB?.message||"Errore sconosciuto"}`)}finally{o(!1)}}else Ki.error(" Coordinate marker obbligatorie");else Ki.error(" Tipo ricompensa obbligatorio");else Ki.error(" Marker ID obbligatorio")},disabled:n,className:"w-full",children:n?"Salvando...":se.jsxs(se.Fragment,{children:[se.jsx(Ms,{className:"w-4 h-4 mr-2"}),"Salva Ricompense Marker"]})})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(rs,{className:"w-5 h-5"}),"QR Codes Gestiti (",e.length,")"]})}),se.jsx(Gl,{children:s?se.jsx("div",{className:"text-center py-8",children:"Caricamento..."}):0===e.length?se.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nessun QR code creato"}):se.jsx("div",{className:"space-y-3",children:e.map(e=>se.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[se.jsxs("div",{className:"flex-1",children:[se.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[se.jsx("span",{className:"font-mono font-bold text-lg",children:e.id}),se.jsxs(fc,{className:w(e.reward_type),children:[y(e.reward_type)," ",e.reward_type.toUpperCase()]}),e.attivo?e.scansioni>0?se.jsxs(fc,{variant:"outline",children:["SCANSIONATO (",e.scansioni,")"]}):se.jsx(fc,{variant:"default",children:"ATTIVO"}):se.jsx(fc,{variant:"secondary",children:"DISATTIVATO"})]}),se.jsxs("div",{className:"text-sm text-muted-foreground",children:[se.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[se.jsx(Ys,{className:"w-4 h-4"}),e.location_name," (",l(e.lat),", ",l(e.lon),")"]}),se.jsxs("div",{className:"flex items-center gap-1",children:[se.jsx(as,{className:"w-4 h-4"}),"Creato: ",new Date(e.created_at).toLocaleDateString("it-IT"),e.expires_at&&se.jsxs("span",{className:"ml-2",children:[" Scade: ",new Date(e.expires_at).toLocaleDateString("it-IT")]})]}),e.scansioni>0&&se.jsxs("div",{className:"text-green-600 mt-1",children:["Scansioni: ",e.scansioni,"  Ultimo aggiornamento: ",new Date(e.updated_at).toLocaleDateString("it-IT")]}),e.message&&se.jsxs("div",{className:"text-blue-600 mt-1 text-xs",children:["Messaggio: ",e.message]})]})]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsx(mo,{size:"sm",variant:"outline",onClick:()=>v(e.id,{rewardType:e.reward_type,locationName:e.location_name}),children:se.jsx(or,{className:"w-4 h-4"})}),se.jsx(mo,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(confirm("Sei sicuro di voler eliminare questo QR Code? Questa azione non pu essere annullata."))try{const{error:t}=await ba.from("qr_codes").delete().eq("code",e);if(t)throw t;Ki.success(`QR Code ${e} eliminato con successo`),f(),g()}catch(t){console.error("Error deleting QR:",t),Ki.error("Errore nell'eliminazione del QR code")}})(e.id),title:"Elimina QR Code",children:se.jsx(Er,{className:"w-4 h-4"})})]})]},e.id))})})]})]})};const uO=()=>{const e=["BulkMarkerDropComponent","create-random-markers","WouterRoutes","MissionPanelPage"].join("|");let t=0;for(let i=0;i<e.length;i++){t=(t<<5)-t+e.charCodeAt(i),t&=t}return Math.abs(t).toString(16).padStart(64,"0")},hO=()=>{const{toast:e}=mc(),[t,i]=We.useState(!1),[a,s]=We.useState([{type:"buzz_free",count:1}]),[r,n]=We.useState(24),[o,l]=We.useState(null),[c,d]=We.useState(null),[u,h]=We.useState(""),[m,p]=We.useState(null),[f,g]=We.useState({version:"v1",codeHash:uO()});We.useEffect(()=>{const e=async()=>{try{const{data:{session:e}}=await ba.auth.getSession();if(e?.access_token){const t=JSON.parse(atob(e.access_token.split(".")[1]));p(1e3*t.exp);const{data:i}=await ba.from("profiles").select("role").eq("id",e.user.id).single();h(i?.role?.toLowerCase()||"")}}catch(e){console.error("Auth check failed:",e)}};e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[]);const x="admin"===u||"owner"===u,b=m?Math.max(0,m-Date.now()):0,v=b>0&&b<6e5,y=(e,t,i)=>{const r=[...a];r[e]={...r[e],[t]:i},s(r)};return se.jsxs("div",{className:"space-y-6",children:[se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Security Status"})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Role:"}),se.jsx(fc,{variant:x?"default":"destructive",children:u||"unknown"})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"JWT Status:"}),se.jsx(fc,{variant:v?"destructive":"default",children:b>0?`${Math.floor(b/6e4)}m remaining`:"expired"})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Version:"}),se.jsx(fc,{variant:"outline",children:f.version})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Code Hash:"}),se.jsxs(fc,{variant:"outline",className:"font-mono text-xs",children:[f.codeHash.substring(0,12),"..."]})]}),v&&se.jsx(UA,{children:se.jsx(qA,{children:" JWT expires in less than 10 minutes. Consider refreshing your session."})}),!x&&se.jsx(UA,{children:se.jsx(qA,{children:" Access denied. Admin or Owner role required."})})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Bulk Marker Drop"})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{children:[se.jsx(jl,{className:"text-base font-medium",children:"Distributions"}),se.jsx("div",{className:"space-y-2 mt-2",children:a.map((e,t)=>se.jsxs("div",{className:"space-y-2 p-3 border rounded",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsxs(SA,{value:e.type,onValueChange:e=>y(t,"type",e),children:[se.jsx(kA,{className:"w-48",children:se.jsx(_A,{})}),se.jsxs(zA,{children:[se.jsx(EA,{value:"buzz_free",children:"Buzz Free"}),se.jsx(EA,{value:"message",children:"Message"}),se.jsx(EA,{value:"xp_points",children:"XP Points"})]})]}),se.jsx(Sl,{type:"number",min:"1",max:"100",value:e.count,onChange:e=>y(t,"count",parseInt(e.target.value)||1),className:"w-24",placeholder:"Qty"}),"xp_points"===e.type&&se.jsx(Sl,{type:"number",min:"1",max:"1000",value:e.points||10,onChange:e=>y(t,"points",parseInt(e.target.value)||10),className:"w-24",placeholder:"XP"}),se.jsx(mo,{onClick:()=>(e=>{a.length>1&&s(a.filter((t,i)=>i!==e))})(t),variant:"destructive",size:"sm",disabled:a.length<=1,children:"Remove"})]}),"message"===e.type&&se.jsxs("div",{children:[se.jsx(jl,{htmlFor:`message-${t}`,className:"text-sm",children:"Messaggio"}),se.jsx(Wb,{id:`message-${t}`,value:e.text||"",onChange:e=>y(t,"text",e.target.value),placeholder:"Inserisci il messaggio per questo marker...",className:"min-h-[80px]",maxLength:500}),se.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[(e.text||"").length,"/500 caratteri"]})]})]},t))}),se.jsx(mo,{onClick:()=>{s([...a,{type:"buzz_free",count:1}])},variant:"outline",size:"sm",className:"mt-2",children:"Add Distribution"})]}),se.jsx(cz,{}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"visibility",children:"Visibility Hours"}),se.jsx(Sl,{id:"visibility",type:"number",min:"1",value:r,onChange:e=>n(parseInt(e.target.value)||24),className:"w-32"})]}),se.jsx(mo,{onClick:async()=>{if(x)if(a.length){for(const t of a){if("message"===t.type&&(!t.text||0===t.text.trim().length))return void e({title:"Errore",description:"Tutti i marker di tipo 'Message' devono avere un testo",variant:"destructive"});if("xp_points"===t.type&&(!t.points||t.points<1))return void e({title:"Errore",description:"I marker XP Points devono avere almeno 1 punto",variant:"destructive"});if(t.count<1)return void e({title:"Errore",description:"Tutti i marker devono avere quantit >= 1",variant:"destructive"})}i(!0),d(null);try{const t={distributions:a.map(e=>"message"===e.type?{type:"message",count:e.count,text:e.text}:"xp_points"===e.type?{type:"xp_points",count:e.count,points:e.points}:{type:"buzz_free",count:e.count}),visibilityHours:r},i=await async function(e){const t={lat:e.lat,lng:e.lng,radiusMeters:e.radiusMeters,count:e.count,debug:!1,dryRun:!1},i=await fetch(`${pa}/create-random-markers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await i.json().catch(()=>({message:"Invalid JSON response from function"}));return i.ok?{ok:!0,created:"number"==typeof a?.created?a.created:void 0,message:a?.message??(t.dryRun?"Dry run completed":"Markers created successfully")}:{ok:!1,message:a&&(a.error||a.message)||`Edge function error (${i.status})`}}(t);d(i),e({title:"Successo",description:`Creati ${i.created||0} marker`,variant:"default"})}catch(t){console.error("Submit error:",t);const i=t instanceof Error?t.message:"Errore sconosciuto";d({error:i,timestamp:(new Date).toISOString()}),e({title:"Errore",description:i,variant:"destructive"})}finally{i(!1)}}else e({title:"Errore",description:"Aggiungi almeno una distribuzione",variant:"destructive"});else e({title:"Accesso Negato",description:"Solo admin/owner possono eseguire bulk drops",variant:"destructive"})},disabled:t||!x||b<=0,className:"w-full",children:t?"Creando...":"Crea Marker"})]})]}),c&&se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Response Debug"})}),se.jsx(Gl,{children:se.jsxs("div",{className:"space-y-3",children:[207===c?.httpStatus&&se.jsx(UA,{children:se.jsxs(qA,{children:[" Parziale: ",c?.parsedResponse?.created||0," creati, ",c?.parsedResponse?.partial_failures||0," fallimenti, ",c?.parsedResponse?.errors?.length||0," errori"]})}),se.jsx("pre",{className:"bg-muted p-4 rounded text-sm overflow-auto max-h-96",children:JSON.stringify(c,null,2)})]})})]})]})};async function mO(e){return OA()}function pO(){const[e,t]=Ze.useState(!1);return se.jsx("div",{className:"space-y-4",children:se.jsx(mo,{onClick:async()=>{t(!0);try{await mO()}finally{t(!1)}},disabled:e,children:e?"Enabling":"Enable Push"})})}var fO="Radio",[gO,xO]=re(fO),[bO,vO]=gO(fO),yO=We.forwardRef((e,t)=>{const{__scopeRadio:i,name:a,checked:s=!1,required:r,disabled:n,value:o="on",onCheck:l,form:c,...d}=e,[u,h]=We.useState(null),m=ue(t,e=>h(e)),p=We.useRef(!1),f=!u||(c||!!u.closest("form"));return se.jsxs(bO,{scope:i,checked:s,disabled:n,children:[se.jsx(ne.button,{type:"button",role:"radio","aria-checked":s,"data-state":SO(s),"data-disabled":n?"":void 0,disabled:n,value:o,...d,ref:m,onClick:he(e.onClick,e=>{s||l?.(),f&&(p.current=e.isPropagationStopped(),p.current||e.stopPropagation())})}),f&&se.jsx(jO,{control:u,bubbles:!p.current,name:a,value:o,checked:s,required:r,disabled:n,form:c,style:{transform:"translateX(-100%)"}})]})});yO.displayName=fO;var wO="RadioIndicator",NO=We.forwardRef((e,t)=>{const{__scopeRadio:i,forceMount:a,...s}=e,r=vO(wO,i);return se.jsx(ce,{present:a||r.checked,children:se.jsx(ne.span,{"data-state":SO(r.checked),"data-disabled":r.disabled?"":void 0,...s,ref:t})})});NO.displayName=wO;var jO=We.forwardRef(({__scopeRadio:e,control:t,checked:i,bubbles:a=!0,...s},r)=>{const n=We.useRef(null),o=ue(n,r),l=Aw(i),c=me(t);return We.useEffect(()=>{const e=n.current;if(!e)return;const t=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(t,"checked").set;if(l!==i&&s){const t=new Event("click",{bubbles:a});s.call(e,i),e.dispatchEvent(t)}},[l,i,a]),se.jsx(ne.input,{type:"radio","aria-hidden":!0,defaultChecked:i,...s,tabIndex:-1,ref:o,style:{...s.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function SO(e){return e?"checked":"unchecked"}jO.displayName="RadioBubbleInput";var _O=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],kO="RadioGroup",[CO]=re(kO,[Ue,xO]),AO=Ue(),zO=xO(),[EO,IO]=CO(kO),PO=We.forwardRef((e,t)=>{const{__scopeRadioGroup:i,name:a,defaultValue:s,value:r,required:n=!1,disabled:o=!1,orientation:l,dir:c,loop:d=!0,onValueChange:u,...h}=e,m=AO(i),p=Oe(c),[f,g]=de({prop:r,defaultProp:s??null,onChange:u,caller:kO});return se.jsx(EO,{scope:i,name:a,required:n,disabled:o,value:f,onValueChange:g,children:se.jsx(qe,{asChild:!0,...m,orientation:l,dir:p,loop:d,children:se.jsx(ne.div,{role:"radiogroup","aria-required":n,"aria-orientation":l,"data-disabled":o?"":void 0,dir:p,...h,ref:t})})})});PO.displayName=kO;var TO="RadioGroupItem",MO=We.forwardRef((e,t)=>{const{__scopeRadioGroup:i,disabled:a,...s}=e,r=IO(TO,i),n=r.disabled||a,o=AO(i),l=zO(i),c=We.useRef(null),d=ue(t,c),u=r.value===s.value,h=We.useRef(!1);return We.useEffect(()=>{const e=e=>{_O.includes(e.key)&&(h.current=!0)},t=()=>h.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}},[]),se.jsx($e,{asChild:!0,...o,focusable:!n,active:u,children:se.jsx(yO,{disabled:n,required:r.required,checked:u,...l,...s,name:r.name,ref:d,onCheck:()=>r.onValueChange(s.value),onKeyDown:he(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:he(s.onFocus,()=>{h.current&&c.current?.click()})})})});MO.displayName=TO;var LO=We.forwardRef((e,t)=>{const{__scopeRadioGroup:i,...a}=e,s=zO(i);return se.jsx(NO,{...s,...a,ref:t})});LO.displayName="RadioGroupIndicator";var FO=PO,OO=MO,DO=LO;const RO=We.forwardRef(({className:e,...t},i)=>se.jsx(FO,{className:eo("grid gap-2",e),...t,ref:i}));RO.displayName=FO.displayName;const BO=We.forwardRef(({className:e,...t},i)=>se.jsx(OO,{ref:i,className:eo("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:se.jsx(DO,{className:"flex items-center justify-center",children:se.jsx(xs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));function UO(){const[e,t]=We.useState("all"),[i,a]=We.useState(" M1SSION Alert"),[s,r]=We.useState("Your mission awaits!"),[n,o]=We.useState("/notifications"),[l,c]=We.useState(""),[d,u]=We.useState("{}"),[h,m]=We.useState(""),[p,f]=We.useState(""),[g,x]=We.useState(""),[b,v]=We.useState(!1),[y,w]=We.useState(null),[N,j]=We.useState([]);return se.jsxs("div",{className:"space-y-6",children:[se.jsxs("div",{className:"space-y-3",children:[se.jsx(jl,{className:"text-sm font-semibold",children:"Audience Mode"}),se.jsxs(RO,{value:e,onValueChange:e=>t(e),children:[se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(BO,{value:"all",id:"mode-all"}),se.jsx(jl,{htmlFor:"mode-all",className:"cursor-pointer",children:"ALL - Broadcast to all active subscriptions"})]}),se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(BO,{value:"single",id:"mode-single"}),se.jsx(jl,{htmlFor:"mode-single",className:"cursor-pointer",children:"SINGLE - Send to one User ID"})]}),se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx(BO,{value:"multi",id:"mode-multi"}),se.jsx(jl,{htmlFor:"mode-multi",className:"cursor-pointer",children:"MULTI - Send to multiple User IDs (max 100)"})]})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"admin-token",children:"Admin Token *"}),se.jsx(Sl,{id:"admin-token",type:"password",placeholder:"Enter PUSH_ADMIN_TOKEN",value:g,onChange:e=>x(e.target.value)}),se.jsx("p",{className:"text-xs text-muted-foreground",children:"Required for all send operations"})]}),"single"===e&&se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"user-id",children:"User ID *"}),se.jsx(Sl,{id:"user-id",placeholder:"uuid-user-id",value:h,onChange:e=>m(e.target.value)})]}),"multi"===e&&se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"user-ids",children:"User IDs * (one per line or comma-separated)"}),se.jsx(Wb,{id:"user-ids",className:"min-h-[100px] font-mono text-sm",placeholder:"uuid-1\nuuid-2\nuuid-3",value:p,onChange:e=>f(e.target.value)}),se.jsx("p",{className:"text-xs text-muted-foreground",children:"Max 100 users per batch"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"title",children:"Title * (max 80 chars)"}),se.jsx(Sl,{id:"title",placeholder:" Your notification title",value:i,onChange:e=>a(e.target.value),maxLength:80}),se.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.length,"/80"]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"body",children:"Body * (max 240 chars)"}),se.jsx(Wb,{id:"body",className:"min-h-[80px]",placeholder:"Your notification message",value:s,onChange:e=>r(e.target.value),maxLength:240}),se.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.length,"/240"]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"url",children:"Link URL (optional)"}),se.jsx(Sl,{id:"url",placeholder:"/notifications or https://...",value:n,onChange:e=>o(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"image-url",children:"Image URL (optional, https only)"}),se.jsx(Sl,{id:"image-url",placeholder:"https://example.com/image.jpg",value:l,onChange:e=>c(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"extra",children:"Extra Payload (JSON, optional)"}),se.jsx(Wb,{id:"extra",className:"min-h-[60px] font-mono text-sm",placeholder:'{"key": "value"}',value:d,onChange:e=>u(e.target.value)})]}),se.jsx(mo,{onClick:async()=>{const t=(()=>{if(!i.trim())return"Title is required";if(i.length>80)return"Title too long (max 80 chars)";if(!s.trim())return"Body is required";if(s.length>240)return"Body too long (max 240 chars)";if(n&&!n.startsWith("/")&&!n.startsWith("http://")&&!n.startsWith("https://"))return"URL must start with / or https://";if(l&&!l.startsWith("https://"))return"Image URL must start with https://";try{JSON.parse(d)}catch(fB){return"Extra must be valid JSON"}if("single"===e&&!h.trim())return"User ID required for SINGLE mode";if("multi"===e){const e=p.split(/[\n,]/).map(e=>e.trim()).filter(Boolean);if(0===e.length)return"At least one User ID required for MULTI mode";if(e.length>100)return"Too many users (max 100 per batch)"}return g.trim()?null:"Admin token required"})();if(t)Ki.error(t);else{v(!0),w(null);try{const t=JSON.parse(d),a={title:i,body:s,url:n||"/notifications",image:l||void 0,extra:t},r=`https://${ma()}.supabase.co`,o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk";let c="",u={payload:a};if("all"===e)c=`${r}/functions/v1/webpush-send`,u.audience="all";else if("single"===e)c=`${r}/functions/v1/webpush-targeted-send`,u.user_ids=h.trim();else if("multi"===e){c=`${r}/functions/v1/webpush-targeted-send`;const e=p.split(/[\n,]/).map(e=>e.trim()).filter(Boolean),t=[...new Set(e)];u.user_ids=t}const m=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json","x-admin-token":g,apikey:o},body:JSON.stringify(u)}),f=await m.json();if(m.ok&&f.success){w(f),Ki.success(`Push sent: ${f.sent}/${f.total}`);const t={time:(new Date).toLocaleTimeString(),mode:e.toUpperCase(),sent:f.sent,failed:f.failed};j(e=>[t,...e].slice(0,5))}else w(f),Ki.error(f.error||"Failed to send push")}catch(a){Ki.error(a.message||"Network error"),console.error("[Push Center] Error:",a)}finally{v(!1)}}},disabled:b,className:"w-full",size:"lg",children:b?se.jsxs(se.Fragment,{children:[se.jsx(Hs,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):se.jsxs(se.Fragment,{children:[se.jsx(fr,{className:"w-4 h-4 mr-2"}),"Send Push Notification"]})}),y&&se.jsx(Wl,{className:"p-4 border-2 "+(y.success&&y.sent>0?"border-green-500 bg-green-500/10":"border-red-500 bg-red-500/10"),children:se.jsxs("div",{className:"flex items-start gap-3",children:[y.success&&y.sent>0?se.jsx(ms,{className:"w-6 h-6 text-green-500 flex-shrink-0"}):se.jsx(gs,{className:"w-6 h-6 text-red-500 flex-shrink-0"}),se.jsxs("div",{className:"space-y-2 flex-1",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"font-semibold",children:y.success?"Push Sent":"Push Failed"}),se.jsxs("span",{className:"text-sm text-muted-foreground",children:[y.sent,"/",y.total," sent"]})]}),y.message&&se.jsx("p",{className:"text-sm",children:y.message}),y.failed>0&&se.jsxs("div",{className:"space-y-1",children:[se.jsxs("p",{className:"text-sm font-medium",children:["Failed: ",y.failed]}),y.errors&&y.errors.length>0&&se.jsx("div",{className:"text-xs space-y-1 bg-black/20 p-2 rounded",children:y.errors.slice(0,5).map((e,t)=>se.jsxs("div",{className:"flex items-start gap-2",children:[se.jsx(us,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),se.jsxs("span",{children:[e.user_id&&`User: ${e.user_id.slice(0,8)}... - `,e.reason||"Unknown error"]})]},t))})]})]})]})}),N.length>0&&se.jsxs(Wl,{className:"p-4",children:[se.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[se.jsx(bs,{className:"w-4 h-4"}),"Recent Sends"]}),se.jsx("div",{className:"space-y-2",children:N.map((e,t)=>se.jsxs("div",{className:"flex items-center justify-between text-sm border-b border-border/50 pb-2 last:border-0 last:pb-0",children:[se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("span",{className:"text-muted-foreground",children:e.time}),se.jsx("span",{className:"font-mono text-xs bg-primary/10 px-2 py-0.5 rounded",children:e.mode})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsxs("span",{className:"text-green-500",children:[e.sent," sent"]}),e.failed>0&&se.jsxs("span",{className:"text-red-500",children:[e.failed," failed"]})]})]},t))})]})]})}function qO(){const[e,t]=We.useState("default"),[i,a]=We.useState(""),[s,r]=We.useState(""),[n,o]=We.useState(!1),[l,c]=We.useState(""),[d,u]=We.useState(""),[h,m]=We.useState(""),[p,f]=We.useState(null),[g,x]=We.useState(null),[b,v]=We.useState(!1),y=async()=>{if("Notification"in window&&t(Notification.permission),"serviceWorker"in navigator)if(navigator.serviceWorker.controller){a(" Registered & Controlling");const e=await navigator.serviceWorker.ready;r(e.scope)}else a(" Registered but not controlling");else a(" Not supported");const e=await async function(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return null;try{const e=await navigator.serviceWorker.ready;return await e.pushManager.getSubscription()}catch{return null}}();o(!!e),c(e?.endpoint?"..."+e.endpoint.slice(-20):"");const{data:{session:i}}=await ba.auth.getSession();u(i?.user?`${i.user.email} (${i.user.id.slice(0,8)}...)`:"Not logged in");try{const{loadVAPIDPublicKey:e}=await ae(async()=>{const{loadVAPIDPublicKey:e}=await import("./vapid-loader.p0s-TRMN.js");return{loadVAPIDPublicKey:e}},[]),t=await e();m(t?"..."+t.slice(-12):"Not configured")}catch{m("Error reading VAPID")}};We.useEffect(()=>{y()},[]);return se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"p-4 rounded-lg border border-gray-700 space-y-3",children:[se.jsx("h3",{className:"font-semibold text-white",children:"System Status"}),se.jsxs("div",{className:"flex items-center gap-2 text-sm",children:["granted"===e?se.jsx(hs,{className:"w-4 h-4 text-green-400"}):se.jsx(gs,{className:"w-4 h-4 text-red-400"}),se.jsx("span",{className:"text-gray-300",children:"Permission:"}),se.jsx("span",{className:"granted"===e?"text-green-400":"text-red-400",children:e})]}),se.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.includes("")?se.jsx(hs,{className:"w-4 h-4 text-green-400"}):se.jsx(gs,{className:"w-4 h-4 text-yellow-400"}),se.jsx("span",{className:"text-gray-300",children:"Service Worker:"}),se.jsx("span",{className:"text-gray-400",children:i})]}),s&&se.jsxs("div",{className:"text-xs text-gray-500",children:["Scope: ",s]}),se.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n?se.jsx(hs,{className:"w-4 h-4 text-green-400"}):se.jsx(gs,{className:"w-4 h-4 text-red-400"}),se.jsx("span",{className:"text-gray-300",children:"Subscription:"}),se.jsx("span",{className:n?"text-green-400":"text-red-400",children:n?"Active":"None"})]}),l&&se.jsxs("div",{className:"text-xs text-gray-500",children:["Endpoint: ",l]}),se.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[se.jsx("span",{className:"text-gray-300",children:"Session:"}),se.jsx("span",{className:"text-gray-400",children:d})]}),se.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[se.jsx("span",{className:"text-gray-300",children:"VAPID Public:"}),se.jsx("span",{className:"text-gray-400",children:h})]})]}),se.jsxs("div",{className:"flex gap-2 flex-wrap",children:[se.jsxs(mo,{onClick:y,size:"sm",variant:"outline",disabled:b,children:[se.jsx(ur,{className:"w-4 h-4 mr-1"}),"Refresh"]}),se.jsxs(mo,{onClick:async()=>{v(!0),f(null);try{const e=await async function(){return TA(await navigator.serviceWorker.ready)}(),t=e.endpoint.substring(e.endpoint.length-12);f({status:200,data:{ok:!0,message:"Subscription successful",endpoint_tail:t,mode:"jsonb_keys"},suggestion:" Success! Subscription registered in DB with JSONB keys."}),await y()}catch(e){console.error("[DebugTab] Resubscribe error:",e);let t="unknown_error",i=e.message,a="";e.message.includes("missing_fields")?(t="missing_fields",i="Missing p256dh or auth keys",a=" Browser subscription may have failed. Check VAPID key configuration."):e.message.includes("database_error")?(t="database_error",i="Database error during upsert",a=" Check webpush_subscriptions table schema and RLS policies in Supabase."):e.message.includes("invalid_jwt")||e.message.includes("Unauthorized")?(t="auth_error",i="Authentication failed",a=" JWT invalid or expired. Please log in again."):e.message.includes("Permesso notifiche negato")?(t="permission_denied",i="Notification permission denied",a=" User denied notification permission. Check browser settings."):a=" "+i,f({status:0,data:{error:i,reason:t},suggestion:a})}finally{v(!1)}},size:"sm",variant:"default",disabled:b,children:[se.jsx(fr,{className:"w-4 h-4 mr-1"}),"(Re)Subscribe"]}),se.jsxs(mo,{onClick:async()=>{v(!0),x(null);try{const{data:{session:e}}=await ba.auth.getSession();if(!e?.access_token)throw new Error("Not authenticated");performance.now();const t=await Uz({audience:{user_id:e.user.id},payload:{title:"Test Self",body:`Test at ${(new Date).toLocaleTimeString()}`,url:"/notifications"}},{userJWT:e.access_token});x({...t,suggestion:qz(t.data.error,t.status)})}catch(e){x({status:0,data:{error:e.message},responseTime:0,suggestion:qz(e.message)})}finally{v(!1)}},size:"sm",variant:"secondary",disabled:b,children:[se.jsx(fr,{className:"w-4 h-4 mr-1"}),"Test Self"]}),se.jsxs(mo,{onClick:async()=>{v(!0),x(null);try{const e=prompt("Enter admin token:");if(!e)return void v(!1);const t=await Uz({audience:"all",payload:{title:"Admin Broadcast Test",body:`Broadcast at ${(new Date).toLocaleTimeString()}`,url:"/notifications"}},{adminToken:e});x({...t,suggestion:qz(t.data.error,t.status)})}catch(e){x({status:0,data:{error:e.message},responseTime:0,suggestion:qz(e.message)})}finally{v(!1)}},size:"sm",variant:"destructive",disabled:b,children:[se.jsx(Fr,{className:"w-4 h-4 mr-1"}),"Test All (Admin)"]})]}),p&&se.jsxs("div",{className:"p-4 rounded-lg border border-gray-700 space-y-2",children:[se.jsx("h4",{className:"font-semibold text-white",children:"Last Upsert Result"}),se.jsxs("div",{className:"text-sm "+(200===p.status?"text-green-400":"text-red-400"),children:["Status: ",p.status]}),se.jsx("pre",{className:"text-xs bg-black/40 p-2 rounded overflow-auto max-h-40",children:JSON.stringify(p.data,null,2)}),se.jsx("p",{className:"text-sm text-yellow-400",children:p.suggestion})]}),g&&se.jsxs("div",{className:"p-4 rounded-lg border border-gray-700 space-y-2",children:[se.jsx("h4",{className:"font-semibold text-white",children:"Last Send Result"}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("span",{className:"text-sm "+(200===g.status?"text-green-400":"text-red-400"),children:["Status: ",g.status]}),se.jsxs("span",{className:"text-gray-400 text-xs",children:[g.responseTime,"ms"]})]}),se.jsx("pre",{className:"text-xs bg-black/40 p-2 rounded overflow-auto max-h-40",children:JSON.stringify(g.data,null,2)}),se.jsx("p",{className:"text-sm text-yellow-400",children:g.suggestion})]})]})}function $O(){const[e,t]=We.useState([]),[i,a]=We.useState(!1),[s,r]=We.useState(""),n=async()=>{a(!0),r("");try{const{data:e,error:i}=await ba.from("webpush_subscriptions").select("id, user_id, endpoint, is_active, created_at, last_used_at").order("created_at",{ascending:!1}).limit(50);if(i)throw i;t(e||[])}catch(e){r(e.message||"Failed to fetch subscriptions"),console.error("Error fetching subscriptions:",e)}finally{a(!1)}};return We.useEffect(()=>{n()},[]),se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Latest Subscriptions (",e.length,")"]}),se.jsx(mo,{onClick:n,size:"sm",variant:"outline",disabled:i,children:i?se.jsx(Hs,{className:"w-4 h-4 animate-spin"}):se.jsx(ur,{className:"w-4 h-4"})})]}),s&&se.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:s}),se.jsx("div",{className:"overflow-auto max-h-[500px] border border-gray-700 rounded-lg",children:se.jsxs("table",{className:"w-full text-sm",children:[se.jsx("thead",{className:"bg-gray-800/50 sticky top-0",children:se.jsxs("tr",{children:[se.jsx("th",{className:"text-left p-3 text-gray-400 font-medium",children:"Created"}),se.jsx("th",{className:"text-left p-3 text-gray-400 font-medium",children:"User ID"}),se.jsx("th",{className:"text-left p-3 text-gray-400 font-medium",children:"Endpoint"}),se.jsx("th",{className:"text-left p-3 text-gray-400 font-medium",children:"Active"}),se.jsx("th",{className:"text-left p-3 text-gray-400 font-medium",children:"Last Used"})]})}),se.jsxs("tbody",{children:[0===e.length&&!i&&se.jsx("tr",{children:se.jsx("td",{colSpan:5,className:"text-center p-8 text-gray-500",children:"No subscriptions found"})}),e.map(e=>se.jsxs("tr",{className:"border-t border-gray-800 hover:bg-gray-800/30",children:[se.jsx("td",{className:"p-3 text-gray-300",children:new Date(e.created_at).toLocaleDateString()}),se.jsxs("td",{className:"p-3 text-gray-300 font-mono text-xs",children:[e.user_id.slice(0,8),"..."]}),se.jsxs("td",{className:"p-3 text-gray-400 font-mono text-xs truncate max-w-xs",children:["...",e.endpoint.slice(-30)]}),se.jsx("td",{className:"p-3",children:se.jsx("span",{className:"px-2 py-1 rounded text-xs "+(e.is_active?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"),children:e.is_active?"Active":"Inactive"})}),se.jsx("td",{className:"p-3 text-gray-400 text-xs",children:e.last_used_at?new Date(e.last_used_at).toLocaleString():"-"})]},e.id))]})]})})]})}function WO(){const e=ma(),t=t=>{window.open(`https://supabase.com/dashboard/project/${e}/functions/${t}/logs`,"_blank")};return se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"p-4 rounded-lg border border-gray-700",children:[se.jsx("h3",{className:"font-semibold text-white mb-4",children:"Edge Function Logs"}),se.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Visualizza i logs delle Edge Functions direttamente dalla dashboard Supabase."}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs(mo,{onClick:()=>t("webpush-upsert"),variant:"outline",className:"w-full justify-between",children:[se.jsx("span",{children:"webpush-upsert logs"}),se.jsx(zs,{className:"w-4 h-4"})]}),se.jsxs(mo,{onClick:()=>t("webpush-send"),variant:"outline",className:"w-full justify-between",children:[se.jsx("span",{children:"webpush-send logs"}),se.jsx(zs,{className:"w-4 h-4"})]})]})]}),se.jsxs("div",{className:"p-4 rounded-lg border border-gray-700 bg-blue-500/5",children:[se.jsx("h4",{className:"font-semibold text-blue-400 mb-2",children:"Log Filters"}),se.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Quando visualizzi i logs, cerca questi pattern per identificare problemi:"}),se.jsxs("ul",{className:"text-xs text-gray-500 space-y-1 list-disc list-inside",children:[se.jsxs("li",{children:[se.jsx("code",{className:"text-orange-400",children:"error"})," - Errori generici"]}),se.jsxs("li",{children:[se.jsx("code",{className:"text-orange-400",children:"[WEBPUSH-UPSERT]"})," - Log specifici upsert"]}),se.jsxs("li",{children:[se.jsx("code",{className:"text-orange-400",children:"[WEBPUSH-SEND]"})," - Log specifici invio"]}),se.jsxs("li",{children:[se.jsx("code",{className:"text-orange-400",children:"401"})," - Errori di autenticazione"]}),se.jsxs("li",{children:[se.jsx("code",{className:"text-orange-400",children:"500"})," - Errori server"]}),se.jsxs("li",{children:[se.jsx("code",{className:"text-green-400",children:""})," - Operazioni riuscite"]}),se.jsxs("li",{children:[se.jsx("code",{className:"text-red-400",children:""})," - Operazioni fallite"]})]})]}),se.jsxs("div",{className:"p-4 rounded-lg border border-gray-700 bg-purple-500/5",children:[se.jsx("h4",{className:"font-semibold text-purple-400 mb-2",children:"Quick Debug Tips"}),se.jsxs("ul",{className:"text-sm text-gray-400 space-y-2",children:[se.jsxs("li",{children:[se.jsx("strong",{children:"No logs appearing?"})," Assicurati che le funzioni siano state deployate e invocate almeno una volta."]}),se.jsxs("li",{children:[se.jsx("strong",{children:"CORS errors?"})," Verifica che le funzioni includano gli header CORS corretti per il tuo dominio."]}),se.jsxs("li",{children:[se.jsx("strong",{children:"401 Unauthorized?"})," Controlla che il JWT sia valido e non scaduto."]}),se.jsxs("li",{children:[se.jsx("strong",{children:"500 errors?"})," Verifica che tutti i secrets (VAPID, PUSH_ADMIN_TOKEN) siano configurati."]})]})]})]})}function HO(){const[e,t]=We.useState("activate");return se.jsxs(Wl,{className:"glass-card p-6 border border-[#4361ee]/30",children:[se.jsxs("div",{className:"mb-6",children:[se.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent",children:" Push Center"}),se.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Invio notifiche push (Web Push + FCM)  Debug E2E  Subscriptions  Logs"})]}),se.jsxs(Ky,{value:e,onValueChange:t,className:"w-full",children:[se.jsxs(Xy,{className:"grid w-full grid-cols-5 mb-6",children:[se.jsxs(Jy,{value:"activate",className:"flex items-center gap-2",children:[se.jsx(Xa,{className:"w-4 h-4"}),se.jsx("span",{className:"hidden sm:inline",children:"Attiva"})]}),se.jsxs(Jy,{value:"send",className:"flex items-center gap-2",children:[se.jsx(fr,{className:"w-4 h-4"}),se.jsx("span",{className:"hidden sm:inline",children:"Send"})]}),se.jsxs(Jy,{value:"debug",className:"flex items-center gap-2",children:[se.jsx(is,{className:"w-4 h-4"}),se.jsx("span",{className:"hidden sm:inline",children:"Debug"})]}),se.jsxs(Jy,{value:"subscriptions",className:"flex items-center gap-2",children:[se.jsx(ks,{className:"w-4 h-4"}),se.jsx("span",{className:"hidden sm:inline",children:"Subs"})]}),se.jsxs(Jy,{value:"logs",className:"flex items-center gap-2",children:[se.jsx(Ps,{className:"w-4 h-4"}),se.jsx("span",{className:"hidden sm:inline",children:"Logs"})]})]}),se.jsx(Qy,{value:"activate",className:"space-y-4",children:se.jsx(pO,{})}),se.jsx(Qy,{value:"send",className:"space-y-4",children:se.jsx(UO,{})}),se.jsx(Qy,{value:"debug",className:"space-y-4",children:se.jsx(qO,{})}),se.jsx(Qy,{value:"subscriptions",className:"space-y-4",children:se.jsx($O,{})}),se.jsx(Qy,{value:"logs",className:"space-y-4",children:se.jsx(WO,{})})]})]})}async function ZO(){const e="serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window;let t=!1,i=null;const a="Notification"in window?Notification.permission:null;if(e)try{const e=await navigator.serviceWorker.ready,a=await e.pushManager.getSubscription();t=!!a,i=a?.endpoint??null}catch{}return{supported:e,permission:a,hasSubscription:t,endpoint:i}}BO.displayName=OO.displayName;const VO=()=>{const[e,t]=We.useState(null),[i,a]=We.useState(!1),[s,r]=We.useState(!1),[n,o]=We.useState(!0),l=async()=>{o(!0);try{const e=await ZO();t(e)}catch(e){console.error("Failed to load push status:",e),Ki.error("Errore nel caricamento dello stato")}finally{o(!1)}};We.useEffect(()=>{l();const e=setInterval(l,1e4);return()=>clearInterval(e)},[]);const c=e=>e?"bg-green-500":"bg-red-500",d=e&&"granted"===e.permission&&e.swRegistered&&e.subscriptionPresent&&e.jwtPresent&&e.vapidValid,u=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&/iPhone|iPad|iPod/.test(navigator.userAgent);return se.jsxs(Wl,{className:"bg-black/40 border-cyan-500/30 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-cyan-400 flex items-center gap-2",children:[se.jsx(Xa,{className:"w-5 h-5"}),"Push Center"]})}),se.jsx(Gl,{className:"space-y-4",children:n?se.jsx("div",{className:"flex items-center justify-center py-8",children:se.jsx(Hs,{className:"w-6 h-6 animate-spin text-cyan-400"})}):se.jsxs(se.Fragment,{children:[se.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:`w-3 h-3 rounded-full ${c("granted"===e?.permission)}`}),se.jsx("span",{className:"text-sm text-white/80",children:"Permission"})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:`w-3 h-3 rounded-full ${c(e?.swRegistered)}`}),se.jsx("span",{className:"text-sm text-white/80",children:"Service Worker"})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:`w-3 h-3 rounded-full ${c(e?.subscriptionPresent)}`}),se.jsx("span",{className:"text-sm text-white/80",children:"Subscription"})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:`w-3 h-3 rounded-full ${c(e?.jwtPresent)}`}),se.jsx("span",{className:"text-sm text-white/80",children:"JWT"})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:`w-3 h-3 rounded-full ${c(e?.vapidValid)}`}),se.jsx("span",{className:"text-sm text-white/80",children:"VAPID"})]}),se.jsx("div",{className:"flex items-center gap-2",children:se.jsx(fc,{variant:d?"default":"destructive",className:"text-xs",children:e?.platform})})]}),u&&"granted"!==e?.permission&&se.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-md p-3",children:se.jsxs("div",{className:"flex items-start gap-2",children:[se.jsx(Er,{className:"w-4 h-4 text-yellow-400 mt-0.5"}),se.jsxs("div",{className:"text-xs text-yellow-200",children:[se.jsx("strong",{children:"iOS Safari:"})," Installa l'app alla Home Screen (PWA) per ricevere notifiche (iOS 16.4+)"]})]})}),"denied"===e?.permission&&se.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-md p-3",children:se.jsxs("div",{className:"text-xs text-red-200",children:[se.jsx("strong",{children:"Permesso negato."})," Vai nelle impostazioni del browser e abilita le notifiche per m1ssion.eu"]})}),se.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[se.jsx(mo,{onClick:async()=>{a(!0);try{const e=await async function(){const e=await ZO();if(!e.supported)return e;try{const e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();t&&await t.unsubscribe()}catch{}const t=await Ez();return{supported:!0,permission:Notification.permission,hasSubscription:t.ok,endpoint:t.endpoint??null}}();e.supported&&!e.hasSubscription?(Ki.success("Push riparato"),await l()):Ki.error("Errore riparazione")}catch(e){Ki.error(`Errore: ${e.message}`)}finally{a(!1)}},disabled:i,className:"bg-cyan-500 hover:bg-cyan-600 text-black font-medium",children:i?se.jsxs(se.Fragment,{children:[se.jsx(Hs,{className:"w-4 h-4 mr-2 animate-spin"}),"Riparazione..."]}):se.jsxs(se.Fragment,{children:[se.jsx(qr,{className:"w-4 h-4 mr-2"}),"Ripara"]})}),se.jsx(mo,{onClick:async()=>{r(!0);try{const e=await async function(e={}){const t=`${pa}/webpush-send`;let i={"Content-Type":"application/json"};try{const{data:e}=await ba.auth.getSession(),t=e?.session?.access_token;t&&(i.Authorization=`Bearer ${t}`)}catch{}const a={kind:"self-test",timestamp:(new Date).toISOString(),...e},s=await fetch(t,{method:"POST",headers:i,body:JSON.stringify(a)}),r=s.ok;let n=null;try{n=await s.json()}catch{}return{ok:r,status:s.status,info:n}}();e.ok?Ki.success("Test inviato"):Ki.error(`Test fallito (status: ${e.status??500})`)}catch(e){Ki.error(`Errore: ${e.message}`)}finally{r(!1)}},disabled:s||!d,variant:"outline",className:"border-cyan-500/50 text-cyan-400 hover:bg-cyan-500/10",children:s?se.jsxs(se.Fragment,{children:[se.jsx(Hs,{className:"w-4 h-4 mr-2 animate-spin"}),"Invio..."]}):se.jsxs(se.Fragment,{children:[se.jsx(fr,{className:"w-4 h-4 mr-2"}),"Test"]})})]}),d&&se.jsx("div",{className:"bg-green-500/10 border border-green-500/30 rounded-md p-3",children:se.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[se.jsx(hs,{className:"w-4 h-4"}),se.jsx("span",{children:"Sistema push attivo e configurato"})]})}),se.jsx("div",{className:"pt-2 border-t border-white/10",children:se.jsx("a",{href:"/push-diagnosi",className:"text-xs text-cyan-400 hover:text-cyan-300 underline inline-block",children:" Apri diagnostica completa "})})]})})]})},GO=()=>{const[e,t]=We.useState("all"),[i,a]=We.useState(""),[s,r]=We.useState(""),[n,o]=We.useState(""),[l,c]=We.useState(""),[d,u]=We.useState(""),[h,m]=We.useState("/notifications"),[p,f]=We.useState(!1),[g,x]=We.useState(!1),[b,v]=We.useState(""),[y,w]=We.useState(""),[N,j]=We.useState(""),[S,_]=We.useState(!1);return se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-background/80 p-4 pb-24",children:se.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:se.jsxs(Wl,{className:"border-primary/20",children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(fr,{className:"h-5 w-5"}),"Push Control Panel"]}),se.jsx(Vl,{children:"Invia notifiche push a utenti specifici o broadcast"})]}),se.jsx(Gl,{children:se.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),s||l)if("all"===e||i.trim()){_(!0);try{const t={title:s||void 0,body:l||void 0,url:h||"/notifications"};d&&(t.image=d),n&&(t.badge=Number(n)||0);const a={};let m;if(p&&(a.free_buzz=!0),g&&(a.free_buzz_map=!0),b&&(a.xp_points=Number(b)||0),y&&N&&(a.marker={lat:Number(y)||0,lng:Number(N)||0}),Object.keys(a).length>0&&(t.data={extras:a}),"all"===e)m={audience:"all",payload:t};else{const e=i.split(",").map(e=>e.trim()).filter(Boolean);if(0===e.length)return Ki.error("User IDs non validi"),void _(!1);m={audience:"list",filters:{ids:e},payload:t}}const S=await Uz(m,{});if(200===S.status||201===S.status){const e=S.data;Ki.success(` Push inviata! Sent: ${e.sent||0}, Failed: ${e.failed||0}`),r(""),c(""),u(""),o(""),f(!1),x(!1),v(""),w(""),j("")}else Ki.error(`Errore: ${S.data.message||"Unknown error"}`)}catch(a){console.error("Push send error:",a),Ki.error(a.message||"Errore invio push")}finally{_(!1)}}else Ki.error("Inserisci User ID(s) per invio targeted");else Ki.error("Inserisci almeno title o message")},className:"space-y-6",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{children:"Destinatari"}),se.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[se.jsx(mo,{type:"button",variant:"single"===e?"default":"outline",onClick:()=>t("single"),className:"flex-1",children:"Single User"}),se.jsx(mo,{type:"button",variant:"multi"===e?"default":"outline",onClick:()=>t("multi"),className:"flex-1",children:"Multi User"}),se.jsx(mo,{type:"button",variant:"all"===e?"default":"outline",onClick:()=>t("all"),className:"flex-1",children:"All Users"})]})]}),"all"!==e&&se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"userIds",children:"User ID(s)"}),se.jsx(Sl,{id:"userIds",placeholder:"uuid1, uuid2, uuid3...",value:i,onChange:e=>a(e.target.value)}),se.jsx("p",{className:"text-xs text-muted-foreground",children:"Separati da virgola"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"title",children:"Title"}),se.jsx(Sl,{id:"title",placeholder:"Titolo notifica",value:s,onChange:e=>r(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"badge",children:"Badge (numero)"}),se.jsx(Sl,{id:"badge",type:"number",placeholder:"0",value:n,onChange:e=>o(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"message",children:"Message"}),se.jsx(Wb,{id:"message",placeholder:"Corpo del messaggio",value:l,onChange:e=>c(e.target.value),rows:4})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"imageUrl",children:"Image URL (opzionale)"}),se.jsx(Sl,{id:"imageUrl",placeholder:"https://...",value:d,onChange:e=>u(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"linkUrl",children:"Link URL"}),se.jsx(Sl,{id:"linkUrl",placeholder:"/notifications",value:h,onChange:e=>m(e.target.value)})]}),se.jsxs(Wl,{className:"bg-muted/50",children:[se.jsxs(Hl,{className:"pb-3",children:[se.jsx(Zl,{className:"text-sm",children:"Extras (Opzionali)"}),se.jsx(Vl,{className:"text-xs",children:"Campi addizionali non invasivi"})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx(jl,{htmlFor:"freeBuzz",className:"text-sm",children:"Free Buzz"}),se.jsx(rd,{id:"freeBuzz",checked:p,onCheckedChange:f})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx(jl,{htmlFor:"freeBuzzMap",className:"text-sm",children:"Free Buzz Map"}),se.jsx(rd,{id:"freeBuzzMap",checked:g,onCheckedChange:x})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"xpPoints",className:"text-sm",children:"XP Points"}),se.jsx(Sl,{id:"xpPoints",type:"number",placeholder:"0",value:b,onChange:e=>v(e.target.value)})]}),se.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"markerLat",className:"text-sm",children:"Marker Lat"}),se.jsx(Sl,{id:"markerLat",type:"number",step:"any",placeholder:"45.123",value:y,onChange:e=>w(e.target.value)})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"markerLng",className:"text-sm",children:"Marker Lng"}),se.jsx(Sl,{id:"markerLng",type:"number",step:"any",placeholder:"9.456",value:N,onChange:e=>j(e.target.value)})]})]})]})]}),se.jsx(mo,{type:"submit",className:"w-full",size:"lg",disabled:S||!s&&!l,children:S?se.jsxs(se.Fragment,{children:[se.jsx(Hs,{className:"mr-2 h-4 w-4 animate-spin"}),"Invio..."]}):se.jsxs(se.Fragment,{children:[se.jsx(fr,{className:"mr-2 h-4 w-4"}),"Invia Push"]})})]})})]})})})},YO=()=>{const[e,t]=We.useState({status:"idle",message:""}),[i,a]=We.useState({status:"idle",message:""}),[s,r]=We.useState({status:"idle",message:""}),[n,o]=We.useState({status:"idle",message:""}),[l,c]=We.useState({status:"idle",message:""}),[d,u]=We.useState({status:"idle",message:""});We.useEffect(()=>{h()},[]);const h=async()=>{m(),await p(),await f(),await g(),x(),await b()},m=()=>{if(t({status:"loading",message:"Verifica permessi..."}),!("Notification"in window))return void t({status:"error",message:"Notification API non supportata",details:"Browser non compatibile"});const e=Notification.permission;t("granted"===e?{status:"success",message:"Permessi concessi",details:e}:"denied"===e?{status:"error",message:"Permessi negati",details:e}:{status:"warning",message:"Permessi non richiesti",details:e})},p=async()=>{if(a({status:"loading",message:"Verifica Service Worker..."}),"serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistration();e&&e.active?a({status:"success",message:"Service Worker attivo",details:e.scope}):a({status:"warning",message:"Service Worker non attivo",details:"Nessuna registrazione trovata"})}catch(e){a({status:"error",message:"Errore verifica SW",details:e.message})}else a({status:"error",message:"Service Worker non supportato",details:"Browser non compatibile"})},f=async()=>{r({status:"loading",message:"Verifica subscription..."});try{const e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();if(t){const e=t.endpoint.substring(0,60)+"...",i=t.expirationTime?new Date(t.expirationTime).toLocaleString():"Mai";r({status:"success",message:"Subscription attiva",details:`Endpoint: ${e}\nScadenza: ${i}`})}else r({status:"warning",message:"Nessuna subscription",details:"Utente non iscritto alle push"})}catch(e){r({status:"error",message:"Errore verifica subscription",details:e.message})}},g=async()=>{o({status:"loading",message:"Verifica edge function..."});try{const e=await fetch(`${pa}/webpush-send`,{method:"OPTIONS",headers:{apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk"}});e.ok||204===e.status?o({status:"success",message:"Edge Function disponibile",details:`Status: ${e.status}`}):o({status:"warning",message:"Edge Function risponde",details:`Status: ${e.status}`})}catch(e){o({status:"error",message:"Edge Function non raggiungibile",details:e.message})}},x=()=>{c({status:"loading",message:"Verifica admin token..."});const e="undefined"!=typeof window;c(e?{status:"success",message:"Logica admin token presente",details:"Il codice prevede header x-admin-token (valore non esposto)"}:{status:"warning",message:"Verifica non conclusiva",details:"Ambiente non supportato"})},b=async()=>{u({status:"loading",message:"Verifica accesso DB..."});try{const{count:e,error:t}=await ba.from("webpush_subscriptions").select("*",{count:"exact",head:!0});if(t)return void u({status:"warning",message:"Accesso DB limitato",details:`RLS: ${t.message}`});const{data:i,error:a}=await ba.from("webpush_subscriptions").select("created_at, user_id, endpoint").order("created_at",{ascending:!1}).limit(5);if(a)u({status:"warning",message:`${e??0} subscriptions (no SELECT)`,details:"RLS blocca SELECT"});else{u({status:"success",message:`${e??0} subscriptions totali`,details:`Ultime ${i?.length??0} visibili`})}}catch(e){u({status:"error",message:"Errore accesso DB",details:e.message})}},v=e=>{switch(e){case"loading":return se.jsx(Hs,{className:"h-5 w-5 animate-spin text-blue-500"});case"success":return se.jsx(ms,{className:"h-5 w-5 text-green-500"});case"warning":return se.jsx(us,{className:"h-5 w-5 text-yellow-500"});case"error":return se.jsx(gs,{className:"h-5 w-5 text-red-500"});default:return null}},y=e=>se.jsx(fc,{variant:{idle:"secondary",loading:"secondary",success:"default",warning:"secondary",error:"destructive"}[e],className:"ml-2",children:"loading"===e?"Verifica...":e.toUpperCase()});return se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-background/80 p-4 pb-24",children:se.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[se.jsxs("div",{className:"text-center mb-8",children:[se.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Push Auto-Preflight"}),se.jsx("p",{className:"text-muted-foreground",children:"Verifica stato catena notifiche push (solo lettura)"})]}),se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Web Push Health"}),y(e.status)]}),se.jsx(Vl,{children:"Stato permessi e Service Worker"})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-start gap-3",children:[v(e.status),se.jsxs("div",{className:"flex-1",children:[se.jsx("p",{className:"font-medium",children:e.message}),e.details&&se.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.details})]})]}),se.jsxs("div",{className:"flex items-start gap-3",children:[v(i.status),se.jsxs("div",{className:"flex-1",children:[se.jsx("p",{className:"font-medium",children:i.message}),i.details&&se.jsx("p",{className:"text-sm text-muted-foreground mt-1 break-all",children:i.details})]})]}),se.jsxs("div",{className:"flex items-start gap-3",children:[v(s.status),se.jsxs("div",{className:"flex-1",children:[se.jsx("p",{className:"font-medium",children:s.message}),s.details&&se.jsx("p",{className:"text-sm text-muted-foreground mt-1 whitespace-pre-wrap break-all",children:s.details})]})]})]})]}),se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Edge Function Availability"}),y(n.status)]}),se.jsx(Vl,{children:"Verifica /functions/v1/webpush-send"})]}),se.jsx(Gl,{children:se.jsxs("div",{className:"flex items-start gap-3",children:[v(n.status),se.jsxs("div",{className:"flex-1",children:[se.jsx("p",{className:"font-medium",children:n.message}),n.details&&se.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n.details})]})]})})]}),se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Admin Token Presence"}),y(l.status)]}),se.jsx(Vl,{children:"Verifica logica client-side (no values)"})]}),se.jsx(Gl,{children:se.jsxs("div",{className:"flex items-start gap-3",children:[v(l.status),se.jsxs("div",{className:"flex-1",children:[se.jsx("p",{className:"font-medium",children:l.message}),l.details&&se.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:l.details})]})]})})]}),se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Database Access"}),y(d.status)]}),se.jsx(Vl,{children:"Accesso webpush_subscriptions (se RLS permette)"})]}),se.jsx(Gl,{children:se.jsxs("div",{className:"flex items-start gap-3",children:[v(d.status),se.jsxs("div",{className:"flex-1",children:[se.jsx("p",{className:"font-medium",children:d.message}),d.details&&se.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:d.details})]})]})})]}),se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsx(Zl,{children:"Quiet Hours (Mock)"}),se.jsx(Vl,{children:"Finestra consigliata per invii automatici"})]}),se.jsx(Gl,{children:se.jsxs("div",{className:"space-y-2 text-sm",children:[se.jsxs("p",{children:[se.jsx("strong",{children:"Orario consigliato:"})," 09:00  20:00 (locale)"]}),se.jsxs("p",{children:[se.jsx("strong",{children:"Max push/utente/giorno:"})," 3-5"]}),se.jsxs("p",{children:[se.jsx("strong",{children:"Cooldown minimo:"})," 2-4 ore tra invii"]}),se.jsx("p",{className:"text-muted-foreground mt-4",children:" Queste sono linee guida suggerite. L'implementazione effettiva richiede logica server-side separata."})]})})]})]})})},KO=()=>{const{user:e}=bl(),{profileImage:t}=Qc(),{isWhitelisted:i,isValidating:a,accessDeniedReason:s}=eE(),[r,n]=We.useState("home"),[,o]=Ai(),{isAdmin:l}=((e=!0)=>{const{isAuthenticated:t,hasRole:i,isRoleLoading:a}=sn(),[s,r]=We.useState(null),{navigate:n}=yl();return We.useEffect(()=>{(async()=>{if(!a){const a=t&&i("admin");r(a),e&&!a&&n("/access-denied")}})()},[t,i,a,e,n]),{isAdmin:s,isRoleLoading:a}})(!1),c=i;return i?"ai-generator"===r&&c?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION PANEL - AI Generator"})}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsx("div",{className:"flex items-center gap-4 mb-8",children:se.jsx("button",{onClick:()=>n("home"),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"})}),se.jsx(Hz,{onBack:()=>n("home")})]})})]}):"mission-control"===r&&c?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION PANEL - Mission Control"})}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsx("div",{className:"flex items-center gap-4 mb-8",children:se.jsx("button",{onClick:()=>n("home"),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"})}),se.jsx(Kz,{onBack:()=>n("home")})]})})]}):"mission-reset"===r&&c?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION PANEL - Reset Missione"})}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsx("div",{className:"flex items-center gap-4 mb-8",children:se.jsx("button",{onClick:()=>n("home"),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"})}),se.jsx(Xz,{})]})})]}):"mission-config"===r&&c?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION PANEL - Config Missione"})}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsx("div",{className:"flex items-center gap-4 mb-8",children:se.jsx("button",{onClick:()=>n("home"),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"})}),se.jsx(Jz,{})]})})]}):"qr-control"===r&&c?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION PANEL - QR Control"})}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsx("div",{className:"flex items-center gap-4 mb-8",children:se.jsx("button",{onClick:()=>n("home"),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"})}),se.jsx(dO,{})]})})]}):"push-center"===r&&c&&l?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION PANEL - Push Center"})}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[se.jsx("button",{onClick:()=>n("home"),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"}),se.jsx("h1",{className:"text-2xl font-bold text-white",children:" Push Center"})]}),se.jsx(HO,{})]})})]}):"bulk-marker-drop"===r&&c?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION PANEL - Bulk Marker Drop"})}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[se.jsx("button",{onClick:()=>n("home"),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"}),se.jsx("h1",{className:"text-2xl font-bold text-white",children:"Bulk Marker Drop"})]}),se.jsx(hO,{})]})})]}):("push-control"===r||"push-sender"===r)&&c&&l?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION PANEL - Push Control"})}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsx("div",{className:"flex items-center gap-4 mb-8",children:se.jsx("button",{onClick:()=>n("home"),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"})}),se.jsx(GO,{})]})})]}):"push-preflight"===r&&c&&l?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION PANEL - Push Preflight"})}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsx("div",{className:"flex items-center gap-4 mb-8",children:se.jsx("button",{onClick:()=>n("home"),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"})}),se.jsx(YO,{})]})})]}):se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsxs(pl,{children:[se.jsx("title",{children:"M1SSION PANEL - Centro di Comando"}),se.jsx("meta",{name:"description",content:"Centro di comando blindato per operazioni M1SSION"})]}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-12",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-16",children:[se.jsxs("h1",{className:"text-4xl md:text-6xl font-bold mb-4",children:[se.jsx("span",{className:"bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent",children:"M1SSION PANEL"}),se.jsx("span",{className:"text-xs align-top text-[#7209b7]",children:""})]}),se.jsx("p",{className:"text-gray-400 text-lg",children:"Centro AI Generativo per Test Interni"})]}),se.jsxs(et.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.5},className:"space-y-6",children:[se.jsxs("div",{className:"glass-card p-6 border border-green-500/30",children:[se.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[se.jsx(vr,{className:"w-6 h-6 text-green-400"}),se.jsx("h2",{className:"text-xl font-semibold text-green-400",children:" Accesso Autorizzato - Blindatura Attiva"})]}),se.jsxs("div",{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-gray-400",children:"Utente Autorizzato:"}),se.jsx("span",{className:"text-green-400 font-mono",children:e?.email})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-gray-400",children:"Clearance:"}),se.jsx("span",{className:"text-[#4361ee] font-semibold",children:"MAXIMUM SECURITY"})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-gray-400",children:"Protezione:"}),se.jsx("span",{className:"text-green-400 font-semibold",children:"SHA-256 VERIFIED "})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("span",{className:"text-gray-400",children:"Sessione:"}),se.jsx("span",{className:"text-green-400 font-semibold",children:"TRACKING ATTIVO"})]})]})]}),se.jsx("div",{className:"mb-6",children:se.jsx(VO,{})}),se.jsxs("div",{className:"grid gap-4",children:[se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n("ai-generator"),className:"glass-card p-4 border border-[#4361ee]/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(Wr,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:"AI Content Generator"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Generazione automatica di indizi e contenuti"})]})]})}),se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n("mission-control"),className:"glass-card p-4 border border-[#7209b7]/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-[#7209b7] to-[#4361ee] flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(vr,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:"Mission Control"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Controllo avanzato delle missioni attive"})]})]})}),se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n("mission-reset"),className:"glass-card p-4 border border-red-500/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-red-600 to-red-500 flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(hr,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:"Reset Missione"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Riavvia completamente la missione corrente"})]})]})}),se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n("mission-config"),className:"glass-card p-4 border border-emerald-500/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-emerald-600 to-emerald-500 flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(Ns,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:"Mission Config"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Configurazione parametri missione"})]})]})}),se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>o("/panel-users"),className:"glass-card p-4 border border-purple-500/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-purple-600 to-purple-500 flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(Fr,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:"Users (Realtime)"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Lista utenti con aggiornamenti in tempo reale"})]})]})}),se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>o("/panel/bulk-marker-drop"),className:"glass-card p-4 border border-blue-500/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-blue-600 to-blue-500 flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(Ys,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:"Bulk Marker Drop"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Creazione in massa di marker personalizzati"})]})]})}),se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n("qr-control"),className:"glass-card p-4 border border-cyan-500/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-cyan-600 to-cyan-500 flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(lr,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:"QR Control Panel"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Gestione QR codes e marker"})]})]})}),se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n("bulk-marker-drop"),className:"glass-card p-4 border border-blue-500/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-blue-600 to-blue-500 flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(Ks,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:"Bulk Marker Drop"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Distribuzione massiva marker sulla mappa"})]})]})}),l&&se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n("push-center"),className:"glass-card p-4 border border-[#4361ee]/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(fr,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:" Push Center"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Invio + Debug + Subscriptions + Logs"})]})]})}),l&&se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n("push-control"),className:"glass-card p-4 border border-orange-500/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-orange-600 to-red-500 flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(fr,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:" Push Control Panel"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Invio notifiche push avanzato"})]})]})}),l&&Iz,l&&se.jsx(et.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>o("/panel/push-sender"),className:"glass-card p-4 border border-blue-500/30 cursor-pointer group",children:se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-r from-blue-600 to-cyan-500 flex items-center justify-center group-hover:scale-110 transition-transform",children:se.jsx(fr,{className:"w-6 h-6 text-white"})}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold text-white",children:" Push Sender"}),se.jsx("p",{className:"text-gray-400 text-sm",children:"Invio rapido Broadcast/Targeted/Self"})]})]})})]}),se.jsxs("div",{className:"text-center pt-4",children:[se.jsx("p",{className:"text-xs text-gray-500",children:"M1SSION PANEL - Versione Blindata v3.0.0 -  2025 Joseph MUL"}),se.jsx("p",{className:"text-xs text-green-600 mt-1",children:" Sistema Anti-Infiltrazione Attivo"})]})]})]})})]}):a?se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] flex items-center justify-center",children:se.jsxs("div",{className:"text-center",children:[se.jsx(Cy,{className:"h-12 w-12 text-[#4361ee] mx-auto mb-4"}),se.jsx("p",{className:"text-white text-lg font-semibold",children:"Validazione Accesso M1SSION PANEL"}),se.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Verifica clearance in corso..."})]})}):se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] flex items-center justify-center",children:se.jsxs("div",{className:"text-center max-w-md",children:[se.jsx(Er,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),se.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-2",children:" Accesso Negato"}),se.jsx("p",{className:"text-gray-400 mb-4",children:"Solo gli amministratori possono accedere a questa pagina"}),se.jsxs("div",{className:"bg-black/50 p-4 rounded-lg text-left text-xs font-mono",children:[se.jsx("h3",{className:"text-red-400 mb-2",children:"Debug Info:"}),se.jsxs("p",{className:"text-gray-300",children:["Email: ",e?.email]}),se.jsxs("p",{className:"text-gray-300",children:["Motivo: ",s]})]})]})})};function XO(){const{user:e}=$l(),[t,i]=We.useState(!1),[a,s]=We.useState([]),[r,n]=We.useState({success:0,warnings:0,errors:0}),o=async()=>{s([]),n({success:0,warnings:0,errors:0}),i(!0);const t=[];try{if(t.push({step:"1/10",status:"success",message:"Controllo supporto Push API",details:"Verifica se il browser supporta le notifiche push..."}),!("Notification"in window))return t.push({step:"1/10",status:"error",message:"Push API non supportato",details:"Il tuo browser non supporta le notifiche push"}),void s(t);if(!("serviceWorker"in navigator))return t.push({step:"1/10",status:"error",message:"Service Worker non supportato",details:"Il tuo browser non supporta i Service Workers"}),void s(t);t.push({step:"1/10",status:"success",message:" Push API supportato",details:"Browser compatibile con notifiche push"});const i=Notification.permission;"denied"===i?t.push({step:"2/10",status:"error",message:" Permesso negato",details:"Le notifiche sono bloccate. Vai nelle impostazioni del browser per abilitarle."}):"default"===i?t.push({step:"2/10",status:"warning",message:" Permesso non richiesto",details:'Usa il bottone "Ripara notifiche" per richiedere il permesso'}):t.push({step:"2/10",status:"success",message:" Permesso concesso",details:`Stato permesso: ${i}`});const r=await navigator.serviceWorker.getRegistrations(),n=r.find(e=>e.active?.scriptURL.includes("/sw.js"));0===r.length?t.push({step:"3/10",status:"warning",message:" Nessun SW registrato",details:'Usa "Ripara notifiche" per registrare /sw.js'}):r.length>1?t.push({step:"3/10",status:"warning",message:` ${r.length} SW registrati`,details:"Rilevati SW multipli. Consigliato mantenere solo /sw.js"}):n?t.push({step:"3/10",status:"success",message:" SW corretto attivo",details:`Scope: ${n.scope}, State: ${n.active?.state}`}):t.push({step:"3/10",status:"error",message:" SW non corretto",details:`SW attivo: ${r[0]?.active?.scriptURL||"unknown"}`});try{const{loadVAPIDPublicKey:e,urlBase64ToUint8Array:i}=await ae(async()=>{const{loadVAPIDPublicKey:e,urlBase64ToUint8Array:t}=await import("./vapid-loader.p0s-TRMN.js");return{loadVAPIDPublicKey:e,urlBase64ToUint8Array:t}},[]),a=i(await e());t.push({step:"4/10",status:"success",message:" VAPID key valida",details:`Length: ${a.length} bytes, Prefix: 0x${a[0].toString(16)}`})}catch(a){return t.push({step:"4/10",status:"error",message:" VAPID key non valida",details:a.message}),void s(t)}const{data:{session:o}}=await ba.auth.getSession();if(!o?.access_token)return t.push({step:"5/10",status:"error",message:" JWT mancante",details:"Sessione non valida. Effettua il login."}),void s(t);t.push({step:"5/10",status:"success",message:" JWT presente",details:`User ID: ${o.user?.id?.substring(0,8)}...`});const l=await navigator.serviceWorker.ready,c=await l.pushManager.getSubscription();if(c){const e=c.endpoint.includes("web.push.apple.com")?"iOS":"Web";t.push({step:"6/10",status:"success",message:" Subscription presente",details:`Platform: ${e}, Endpoint: ${c.endpoint.substring(0,50)}...`})}else t.push({step:"6/10",status:"warning",message:" Nessuna subscription",details:'Usa "Ripara notifiche" per creare una subscription'});try{const e=c?{endpoint:c.endpoint,keys:c.toJSON().keys,provider:"webpush",platform:c.endpoint.includes("web.push.apple.com")?"ios":"web",ua:navigator.userAgent}:{test:!0},{data:i,error:a}=await ba.functions.invoke("webpush-upsert",{body:e});a?t.push({step:"7/10",status:"error",message:" Errore backend",details:a.message}):t.push({step:"7/10",status:"success",message:" Backend raggiungibile",details:"Response OK"})}catch(a){t.push({step:"7/10",status:"error",message:" Errore connessione",details:a.message})}try{const{count:i,error:a}=await ba.from("webpush_subscriptions").select("*",{count:"exact",head:!0}).eq("user_id",e?.id||"").eq("is_active",!0);a?t.push({step:"8/10",status:"warning",message:" Errore query database",details:a.message}):t.push({step:"8/10",status:i&&i>0?"success":"warning",message:i&&i>0?" Subscriptions attive":" Nessuna subscription nel DB",details:`Count: ${i||0}`})}catch(a){t.push({step:"8/10",status:"warning",message:" Query non eseguita",details:a.message})}const d=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&/iPhone|iPad|iPod/.test(navigator.userAgent),u=window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone;let h="success",m=" Piattaforma supportata",p=`Browser: ${navigator.userAgent.substring(0,50)}...`;d&&!u&&(h="warning",m=" iOS Safari",p="Su iOS Safari, installa l'app alla Home Screen (PWA) per ricevere notifiche (iOS 16.4+)"),t.push({step:"9/10",status:h,message:m,details:p}),t.push({step:"10/10",status:"success",message:" Diagnosi completata",details:"Controlla i risultati sopra per eventuali problemi"})}catch(a){t.push({step:"ERROR",status:"error",message:" Errore durante la diagnosi",details:a.message})}finally{s(t),i(!1);const e=t.filter(e=>"success"===e.status).length,a=t.filter(e=>"warning"===e.status).length,r=t.filter(e=>"error"===e.status).length;n({success:e,warnings:a,errors:r})}};We.useEffect(()=>{o()},[]);const l=e=>{switch(e){case"success":return se.jsx(hs,{className:"w-5 h-5 text-green-400"});case"error":return se.jsx(gs,{className:"w-5 h-5 text-red-400"});case"warning":return se.jsx(Er,{className:"w-5 h-5 text-yellow-400"})}};return se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsx(pl,{children:se.jsx("title",{children:"M1SSION - Diagnosi Push Notifications"})}),se.jsx(ad,{profileImage:null}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[se.jsxs("div",{className:"flex items-center justify-between mb-4",children:[se.jsxs("div",{children:[se.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:" Diagnosi Push Notifications"}),se.jsx("p",{className:"text-gray-400",children:"Controllo completo della configurazione push"})]}),se.jsxs(mo,{onClick:()=>window.location.href="/panel-access",variant:"outline",className:"border-cyan-500/50 text-cyan-400",children:[se.jsx(Os,{className:"w-4 h-4 mr-2"}),"Panel"]})]}),!t&&a.length>0&&se.jsx(Wl,{className:"bg-black/40 border-cyan-500/30",children:se.jsx(Gl,{className:"p-4",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex gap-4",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(hs,{className:"w-4 h-4 text-green-400"}),se.jsx("span",{className:"text-white font-medium",children:r.success}),se.jsx("span",{className:"text-gray-400 text-sm",children:"Successi"})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(Er,{className:"w-4 h-4 text-yellow-400"}),se.jsx("span",{className:"text-white font-medium",children:r.warnings}),se.jsx("span",{className:"text-gray-400 text-sm",children:"Warning"})]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(gs,{className:"w-4 h-4 text-red-400"}),se.jsx("span",{className:"text-white font-medium",children:r.errors}),se.jsx("span",{className:"text-gray-400 text-sm",children:"Errori"})]})]}),se.jsxs(mo,{onClick:o,variant:"outline",size:"sm",className:"border-cyan-500/50 text-cyan-400",children:[se.jsx(ur,{className:"w-4 h-4 mr-2"}),"Riesegui"]})]})})})]}),se.jsxs("div",{className:"space-y-3",children:[a.map((e,t)=>{return se.jsx(et.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*t},children:se.jsx(Wl,{className:"bg-black/40 border "+("success"===e.status?"border-green-500/30":"error"===e.status?"border-red-500/30":"border-yellow-500/30"),children:se.jsx(Gl,{className:"p-4",children:se.jsxs("div",{className:"flex items-start gap-3",children:[se.jsx("div",{className:"mt-0.5",children:l(e.status)}),se.jsxs("div",{className:"flex-1 min-w-0",children:[se.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[se.jsx(fc,{variant:"outline",className:`text-xs ${i=e.status,{success:"bg-green-500/20 text-green-400 border-green-500/50",error:"bg-red-500/20 text-red-400 border-red-500/50",warning:"bg-yellow-500/20 text-yellow-400 border-yellow-500/50"}[i]}`,children:e.step}),se.jsx("span",{className:"text-white font-medium",children:e.message})]}),e.details&&se.jsx("p",{className:"text-gray-400 text-sm mt-1 break-words",children:e.details})]})]})})})},t);var i}),t&&se.jsxs(et.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center py-8",children:[se.jsx(Hs,{className:"w-8 h-8 animate-spin text-cyan-400"}),se.jsx("span",{className:"ml-3 text-white",children:"Esecuzione diagnosi..."})]})]}),!t&&a.length>0&&se.jsx(et.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"mt-8",children:se.jsxs(Wl,{className:"bg-black/40 border-blue-500/30",children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-blue-400 text-lg",children:" Suggerimenti"})}),se.jsxs(Gl,{className:"space-y-2 text-sm",children:[se.jsxs("p",{className:"text-gray-300",children:[" Se vedi errori o warning, usa il bottone ",se.jsx("strong",{children:'"Ripara notifiche"'})," nel Push Center"]}),se.jsx("p",{className:"text-gray-300",children:" Su iOS Safari, installa l'app alla Home Screen (PWA) per abilitare le notifiche"}),se.jsx("p",{className:"text-gray-300",children:" Se il permesso  negato, vai nelle impostazioni del browser per ripristinarlo"}),se.jsxs("p",{className:"text-gray-300",children:[" Mantieni attivo solo il Service Worker ",se.jsx("strong",{children:"/sw.js"})]})]})]})})]})})]})}function JO({className:e,...t}){return se.jsx("div",{className:eo("animate-pulse rounded-md bg-muted",e),...t})}const QO=We.forwardRef(({className:e,...t},i)=>se.jsx("div",{className:"relative w-full overflow-auto",children:se.jsx("table",{ref:i,className:eo("w-full caption-bottom text-sm",e),...t})}));QO.displayName="Table";const eD=We.forwardRef(({className:e,...t},i)=>se.jsx("thead",{ref:i,className:eo("[&_tr]:border-b",e),...t}));eD.displayName="TableHeader";const tD=We.forwardRef(({className:e,...t},i)=>se.jsx("tbody",{ref:i,className:eo("[&_tr:last-child]:border-0",e),...t}));tD.displayName="TableBody";We.forwardRef(({className:e,...t},i)=>se.jsx("tfoot",{ref:i,className:eo("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";const iD=We.forwardRef(({className:e,...t},i)=>se.jsx("tr",{ref:i,className:eo("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));iD.displayName="TableRow";const aD=We.forwardRef(({className:e,...t},i)=>se.jsx("th",{ref:i,className:eo("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));aD.displayName="TableHead";const sD=We.forwardRef(({className:e,...t},i)=>se.jsx("td",{ref:i,className:eo("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));sD.displayName="TableCell";We.forwardRef(({className:e,...t},i)=>se.jsx("caption",{ref:i,className:eo("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";const rD=()=>{const[e,t]=We.useState([]),[i,a]=We.useState(0),[s,r]=We.useState(!0),[n,o]=We.useState(!1),[l,c]=We.useState(null),[d,u]=We.useState(!0),h=e=>e.first_name&&e.last_name?`${e.first_name} ${e.last_name}`:e.full_name?e.full_name:e.email||"Utente sconosciuto",m=We.useCallback(async(e=0,i=!1)=>{i?o(!0):(r(!0),c(null));try{if(0===e){const{count:e,error:t}=await ba.from("profiles").select("*",{head:!0,count:"exact"});if(t)throw new Error(`Errore nel conteggio: ${t.message}`);a(e||0)}const{data:i,error:s}=await ba.from("profiles").select("id, first_name, last_name, full_name, referral_code, created_at, email").order("created_at",{ascending:!1}).range(e,e+50-1);if(s)throw new Error(`Errore nel caricamento profili: ${s.message}`);const r=i||[];t(0===e?r:e=>[...e,...r]),u(50===r.length)}catch(s){const e=s instanceof Error?s.message:"Errore sconosciuto";c(e),console.error("Error fetching profiles:",s),i||Ki.error(`Errore nel caricamento dati: ${e}`)}finally{r(!1),o(!1)}},[]),p=We.useCallback(()=>{!n&&d&&m(e.length,!0)},[m,e.length,n,d]),f=We.useCallback(()=>{m(0,!1)},[m]);We.useEffect(()=>{m();const e=ba.channel("realtime:profiles").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},e=>{switch(e.eventType){case"INSERT":e.new&&(t(t=>[e.new,...t]),a(e=>e+1),Ki.success("Nuovo utente registrato!"));break;case"UPDATE":e.new&&(t(t=>t.map(t=>t.id===e.new.id?{...t,...e.new}:t)),Ki.info("Profilo utente aggiornato"));break;case"DELETE":e.old&&(t(t=>t.filter(t=>t.id!==e.old.id)),a(e=>Math.max(0,e-1)),Ki.warning("Utente rimosso"))}}).subscribe();return()=>{ba.removeChannel(e)}},[m]);const g=We.useCallback(async e=>{try{r(!0);const{data:i,error:s}=await ba.functions.invoke("admin-delete-user",{body:{user_id:e}});if(s||!i?.success)throw new Error(i?.error||s?.message||"Delete failed");t(t=>t.filter(t=>t.id!==e)),a(e=>Math.max(0,e-1)),Ki.success("Utente cancellato con successo")}catch(i){const e=i instanceof Error?i.message:"Errore sconosciuto";console.error("Error deleting user:",i),Ki.error(`Errore nella cancellazione: ${e}`)}finally{r(!1)}},[]),x=e=>{if(!e)return"Data non disponibile";try{return cy(new Date(e),"dd/MM/yyyy HH:mm",{locale:by})}catch{return"Data non valida"}};return se.jsxs(Wl,{className:"bg-card border-border",children:[se.jsxs(Hl,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[se.jsxs(Zl,{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[se.jsx(Fr,{className:"h-5 w-5 text-primary"}),"Utenti (Realtime)"]}),se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsxs(fc,{variant:"secondary",className:"text-sm",children:["Totale utenti: ",i]}),se.jsx(mo,{variant:"outline",size:"sm",onClick:f,disabled:s,className:"h-8 w-8 p-0",children:se.jsx(ur,{className:"h-4 w-4 "+(s?"animate-spin":"")})})]})]}),se.jsxs(Gl,{className:"space-y-4",children:[l&&se.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-md bg-destructive/10 border border-destructive/20",children:[se.jsx(Er,{className:"h-4 w-4 text-destructive"}),se.jsx("span",{className:"text-sm text-destructive",children:l})]}),s&&0===e.length?se.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((e,t)=>se.jsx(JO,{className:"h-12 w-full"},t))}):se.jsxs(se.Fragment,{children:[se.jsx("div",{className:"rounded-md border border-border",children:se.jsxs(QO,{children:[se.jsx(eD,{children:se.jsxs(iD,{children:[se.jsx(aD,{className:"text-foreground",children:"Nome"}),se.jsx(aD,{className:"text-foreground",children:"Referral Code"}),se.jsx(aD,{className:"text-foreground",children:"User ID"}),se.jsx(aD,{className:"text-foreground",children:"Data Iscrizione"}),se.jsx(aD,{className:"text-foreground",children:"Azioni"})]})}),se.jsx(tD,{children:0===e.length?se.jsx(iD,{children:se.jsx(sD,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Nessun utente trovato"})}):e.map(e=>se.jsxs(iD,{className:"hover:bg-muted/50",children:[se.jsx(sD,{className:"font-medium text-foreground",children:h(e)}),se.jsx(sD,{className:"text-foreground",children:e.referral_code?se.jsx(fc,{variant:"outline",className:"font-mono text-xs",children:e.referral_code}):se.jsx("span",{className:"text-muted-foreground text-sm",children:"N/A"})}),se.jsx(sD,{className:"font-mono text-xs text-muted-foreground",children:e.id}),se.jsx(sD,{className:"text-sm text-foreground",children:x(e.created_at)}),se.jsx(sD,{children:se.jsxs(Kk,{children:[se.jsx(Xk,{asChild:!0,children:se.jsxs(mo,{variant:"destructive",size:"sm",className:"h-8 px-2",children:[se.jsx(Ar,{className:"h-4 w-4 mr-1"}),"Cancella"]})}),se.jsxs(eC,{children:[se.jsxs(tC,{children:[se.jsx(aC,{children:"Conferma cancellazione utente"}),se.jsxs(sC,{children:["Sei sicuro di voler cancellare l'utente \"",h(e),"\"? Questa azione  irreversibile e eliminer l'utente sia da auth.users che da public.profiles."]})]}),se.jsxs(iC,{children:[se.jsx(nC,{children:"Annulla"}),se.jsx(rC,{onClick:()=>g(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Cancella utente"})]})]})]})})]},e.id))})]})}),d&&se.jsx("div",{className:"flex justify-center pt-4",children:se.jsx(mo,{variant:"outline",onClick:p,disabled:n,className:"min-w-[120px]",children:n?se.jsxs(se.Fragment,{children:[se.jsx(ur,{className:"mr-2 h-4 w-4 animate-spin"}),"Caricamento..."]}):"Carica altri 50"})}),!d&&e.length>0&&se.jsx("div",{className:"text-center pt-4",children:se.jsxs("span",{className:"text-sm text-muted-foreground",children:["Tutti i ",i," utenti sono stati caricati"]})})]})]})]})},nD=()=>{const{user:e}=bl(),{profileImage:t}=Qc(),{isWhitelisted:i,isValidating:a,accessDeniedReason:s}=eE();return i?se.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]",children:[se.jsxs(pl,{children:[se.jsx("title",{children:"M1SSION PANEL - Users (Realtime)"}),se.jsx("meta",{name:"description",content:"Gestione utenti con aggiornamenti in tempo reale - M1SSION PANEL"})]}),se.jsx(ad,{profileImage:t}),se.jsx("div",{className:"px-4 py-8",style:{paddingTop:"calc(72px + 47px + env(safe-area-inset-top, 0px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:se.jsxs("div",{className:"max-w-6xl mx-auto",children:[se.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[se.jsx("button",{onClick:()=>window.history.back(),className:"text-gray-400 hover:text-white transition-colors",children:" Torna al Panel"}),se.jsx("h1",{className:"text-2xl font-bold text-white",children:"Users (Realtime)"})]}),se.jsx(rD,{})]})})]}):a?se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] flex items-center justify-center",children:se.jsxs("div",{className:"text-center",children:[se.jsx(Cy,{className:"h-12 w-12 text-[#4361ee] mx-auto mb-4"}),se.jsx("p",{className:"text-white text-lg font-semibold",children:"Validazione Accesso M1SSION PANEL"}),se.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Verifica clearance in corso..."})]})}):se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] flex items-center justify-center",children:se.jsxs("div",{className:"text-center max-w-md",children:[se.jsx(Er,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),se.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-2",children:" Accesso Negato"}),se.jsx("p",{className:"text-gray-400 mb-4",children:"Solo gli amministratori possono accedere a questa pagina"}),se.jsxs("div",{className:"bg-black/50 p-4 rounded-lg text-left text-xs font-mono",children:[se.jsx("h3",{className:"text-red-400 mb-2",children:"Debug Info:"}),se.jsxs("p",{className:"text-gray-300",children:["Email: ",e?.email]}),se.jsxs("p",{className:"text-gray-300",children:["Motivo: ",s]})]})]})})},oD=()=>se.jsx("div",{className:"px-4 md:px-8 py-6",children:se.jsx(hO,{})}),lD=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function cD(e){if("string"!=typeof e||!e)return"";let t=e.trim();return t=t.replace(/^"+|"+$/g,""),t=t.replace(/^'+|'+$/g,""),t=t.trim(),lD.test(t)?t:""}function dD(){return cD(crypto.randomUUID())}const uD=[/\.m1ssion\.pages\.dev$/i,/\.lovableproject\.com$/i,/\.lovable\.app$/i,/^localhost$/i,/^127\.0\.0\.1$/i];function hD(e){if(!e)return!1;try{const t=new URL(e).hostname;return uD.some(e=>e.test(t))}catch{return!1}}const mD="undefined"!=typeof window&&window.location.hostname.includes("lovable"),pD=e=>new Promise(t=>setTimeout(t,e));function fD(){if("undefined"==typeof window)return;const e="undefined"!=typeof window?window.location.origin:"https://m1ssion.pages.dev";if(!hD(e))throw function(e){hD(e)||console.warn("[Norah] Origin not allowlisted for Functions calls:",e,"\nPlease use the app from https://*.m1ssion.pages.dev")}(e),new Error("Origin not allowed for Norah Functions. Please use *.m1ssion.pages.dev")}function gD(){try{const e="norah_cid",t=cD(("undefined"!=typeof localStorage?localStorage.getItem(e):null)||"");if(t)return t;const i=dD();return"undefined"!=typeof localStorage&&localStorage.setItem(e,i),i}catch{return dD()}}function xD(e){const t=String(e?.message??e??"").toLowerCase();return["failed to fetch","failed to send","networkerror","aborterror","operation was aborted","network request failed"].some(e=>t.includes(e))}async function bD(e,t,i){fD();const a=gD(),s=cD(a)||a;if(!s)throw console.warn("[NORAH2] Invalid client_id (UUID), cannot call",e),new Error("Invalid client_id (UUID)");const r={"x-norah-cid":s},n={...t||{},client_id:s};let o=250;"undefined"!=typeof localStorage&&"1"===localStorage.NORAH_DEBUG&&(window.location.origin,Object.keys(n));for(let l=0;l<3;l++)try{mD&&l>0&&await pD(400);const{data:t,error:i}=await ba.functions.invoke(e,{body:n,headers:r});if(i)throw i;return"undefined"!=typeof localStorage&&"1"===localStorage.NORAH_DEBUG&&JSON.stringify(t).slice(0,200),t}catch(fB){if(console.error(`[NORAH2 cid:${a.slice(0,8)}] ${e} failed (attempt ${l+1}/3):`,fB?.message||fB),!xD(fB)||2===l)throw console.error(`[NORAH2] ${e} `,fB),fB;await pD(o),o=Math.min(2*o,800)}throw new Error(`invokePOST fellthrough: ${e}`)}async function vD(e){try{return await bD("norah-ingest",e)}catch(t){throw t}}async function yD(e){try{return await bD("norah-embed",e)}catch(t){throw t}}async function wD(e){if(!e.q||!e.q.trim())return{ok:!1,error:"empty-query",results:[],hits:[]};try{const t=await bD("norah-rag-search",e);return t?.results&&!t?.hits&&(t.hits=t.results),t}catch(t){throw t}}async function ND(){try{return await async function(e){fD();const t="https://vkjrqirvdvjbemsfzxof.supabase.co"?.trim()?.replace(/\/+$/,"")||"",i=`${t?t.replace(".supabase.co",".functions.supabase.co"):""}/${e}`,a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk",s=gD(),r=cD(s)||s;"undefined"!=typeof localStorage&&"1"===localStorage.NORAH_DEBUG&&window.location.origin;let n=250;for(let o=0;o<3;o++)try{mD&&o>0&&await pD(400);const e=await fetch(i,{method:"GET",headers:{"content-type":"application/json",apikey:a,authorization:`Bearer ${a}`,"x-norah-cid":r,"cache-control":"no-store",pragma:"no-cache"},keepalive:!0,mode:"cors"});if(!e.ok){const t=await e.text();throw new Error(`HTTP ${e.status}: ${t}`)}const t=await e.json();return"undefined"!=typeof localStorage&&"1"===localStorage.NORAH_DEBUG&&(e.status,JSON.stringify(t).slice(0,200)),t}catch(fB){if(console.error(`[NORAH2 cid:${s}] ${e} failed (attempt ${o+1}/3):`,fB?.message||fB),!xD(fB)||2===o)throw console.error(`[NORAH2] ${e} `,fB),fB;await pD(n),n=Math.min(2*n,800)}throw new Error(`getFunctionJSON fellthrough: ${e}`)}("norah-kpis")}catch(e){throw e}}async function jD(e){const t=function(e,t=[]){const i=new Set(t),a={push:/\b(push|notification|fcm|apns|vapid)\b/gi,buzz:/\b(buzz|map|area|radius|pricing)\b/gi,mission:/\b(mission|clue|indizio|treasure|final\s*shot)\b/gi,norah:/\b(norah|ai|rag|semantic|vector)\b/gi,security:/\b(security|guard|safe|cors|jwt|auth)\b/gi,payment:/\b(stripe|payment|checkout|subscription|tier)\b/gi,tech:/\b(edge\s*function|supabase|cloudflare|deno)\b/gi};for(const[n,o]of Object.entries(a))o.test(e)&&i.add(n);const s=e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>4&&!["the","and","for","with","that","this","from"].includes(e)),r=new Map;return s.forEach(e=>r.set(e,(r.get(e)||0)+1)),Array.from(r.entries()).sort((e,t)=>t[1]-e[1]).slice(0,3).map(([e])=>e).forEach(e=>i.add(e)),Array.from(i).slice(0,5)}(e.text,e.tags||[]),i=function(e){const t=e.split(/[.!?]+/).filter(e=>e.trim().length>20);if(0===t.length)return"";let i="",a=0;for(const s of t){if(a>=5||i.length+s.length>600)break;i+=`- ${s.trim()}\n`,a++}return i?`## TL;DR\n${i}\n`:""}(e.text),a=e.language||function(e){const t=["il","la","di","che","e","per","con","non","una","sono"],i=["the","is","and","to","of","in","for","on","with","that"],a=e.toLowerCase().split(/\s+/).slice(0,100);return a.filter(e=>t.includes(e)).length>a.filter(e=>i.includes(e)).length?"it":"en"}(e.text),s=await async function(e){const t=(new TextEncoder).encode(e.trim().toLowerCase()),i=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,"0")).join("")}(e.text),r=await async function(e,t){const i=(e+t.slice(0,200)).trim().toLowerCase(),a=(new TextEncoder).encode(i),s=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("")}(e.title,e.text),n=function(e,t=3e3,i=500){const a=e.split(/\n\n+/).filter(e=>e.trim()),s=[];let r="";for(const n of a)(r+n).length>t&&r.length>0?(s.push(r.trim()),r=r.slice(-i)+"\n\n"+n):r+=(r?"\n\n":"")+n;return r.trim()&&s.push(r.trim()),s.length>0?s:[e]}(e.text).map((e,t)=>({idx:t,text:e}));return{...e,text:i+e.text,autoTags:t,tags:t,language:a,sha256:s,dedupeKey:r,summary:i,chunks:n}}function SD(e){const t=new Set,i=[];for(const a of e)a.dedupeKey&&t.has(a.dedupeKey)||(a.dedupeKey&&t.add(a.dedupeKey),i.push(a));return i}function _D(){const{toast:e}=mc(),[t,i]=We.useState("files"),[a,s]=We.useState(""),[r,n]=We.useState(""),[o,l]=We.useState(!1),[c,d]=We.useState([]),[u,h]=We.useState(new Set);return se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"flex gap-2",children:[se.jsxs(mo,{variant:"files"===t?"default":"outline",onClick:()=>i("files"),size:"sm",children:[se.jsx(Ps,{className:"w-4 h-4 mr-2"}),"Files"]}),se.jsxs(mo,{variant:"urls"===t?"default":"outline",onClick:()=>i("urls"),size:"sm",children:[se.jsx(Ws,{className:"w-4 h-4 mr-2"}),"URLs"]}),se.jsxs(mo,{variant:"sitemap"===t?"default":"outline",onClick:()=>i("sitemap"),size:"sm",children:[se.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Sitemap"]})]}),se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"font-orbitron",children:["files"===t&&"File Picker","urls"===t&&"URL List","sitemap"===t&&"Sitemap Crawler"]}),se.jsxs(Vl,{children:["files"===t&&"Upload Markdown, MDX, HTML, or TXT files","urls"===t&&"Paste URLs (one per line)","sitemap"===t&&"Enter sitemap URL (e.g., https://domain.com/sitemap.xml)"]})]}),se.jsxs(Gl,{className:"space-y-4",children:["files"===t&&se.jsx("div",{children:se.jsx("input",{type:"file",multiple:!0,accept:".md,.mdx,.html,.txt",onChange:async t=>{const i=Array.from(t.target.files||[]);l(!0);try{const t=[];for(const e of i){const i=await e.text(),a={title:e.name.replace(/\.(md|mdx|html|txt)$/i,""),text:i,tags:[],source:"kb",url:`file://${e.name}`,language:"it",updatedAt:(new Date).toISOString()},s=await jD(a);t.push(s)}const a=SD(t);d(e=>[...e,...a]),h(new Set(Array.from({length:a.length},(e,t)=>c.length+t))),e({title:" Files Loaded",description:`${a.length} documents ready (${t.length-a.length} duplicates removed)`})}catch(a){e({title:" File Load Failed",description:a.message,variant:"destructive"})}finally{l(!1)}},className:"w-full text-sm text-muted-foreground file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90",disabled:o})}),"urls"===t&&se.jsxs(se.Fragment,{children:[se.jsx(Wb,{value:a,onChange:e=>s(e.target.value),placeholder:"https://example.com/page1\nhttps://example.com/page2",rows:8,disabled:o}),se.jsxs(mo,{onClick:async()=>{const t=a.split("\n").filter(e=>e.trim()&&e.startsWith("http"));if(0!==t.length){l(!0);try{const a=[];for(const e of t)try{const t=await fetch(e),i=await t.text(),s=(new DOMParser).parseFromString(i,"text/html");s.querySelectorAll("script, style, nav, footer").forEach(e=>e.remove());const r=s.body.textContent?.trim()||"";if(r.length<100)continue;const n={title:s.title||new URL(e).pathname.split("/").pop()||"Untitled",text:r,tags:[],source:"site",url:e,language:"it",updatedAt:(new Date).toISOString()},o=await jD(n);a.push(o)}catch(i){console.warn(`Failed to fetch ${e}:`,i)}const s=SD([...c,...a]);d(s),h(new Set(Array.from({length:s.length},(e,t)=>t))),e({title:" URLs Loaded",description:`${a.length} pages fetched from ${t.length} URLs`})}catch(s){e({title:" URL Load Failed",description:s.message,variant:"destructive"})}finally{l(!1)}}else e({title:" No URLs",description:"Enter valid URLs (one per line)",variant:"destructive"})},disabled:o,children:[o?se.jsx(Hs,{className:"w-4 h-4 animate-spin mr-2"}):se.jsx(Pr,{className:"w-4 h-4 mr-2"}),"Load URLs"]})]}),"sitemap"===t&&se.jsxs(se.Fragment,{children:[se.jsx(Sl,{value:r,onChange:e=>n(e.target.value),placeholder:"https://example.com/sitemap.xml",disabled:o}),se.jsxs(mo,{onClick:async()=>{if(r.trim()&&r.startsWith("http")){l(!0);try{const i=await fetch(r),a=await i.text(),s=(new DOMParser).parseFromString(a,"application/xml"),n=Array.from(s.querySelectorAll("loc")).map(e=>e.textContent?.trim()).filter(Boolean);if(0===n.length)return void e({title:" Empty Sitemap",description:"No URLs found",variant:"destructive"});const o=n.slice(0,50),l=[];for(const e of o)try{const t=await fetch(e),i=await t.text(),a=(new DOMParser).parseFromString(i,"text/html");a.querySelectorAll("script, style, nav, footer").forEach(e=>e.remove());const s=a.body.textContent?.trim()||"";if(s.length<100)continue;const r={title:a.title||new URL(e).pathname.split("/").pop()||"Untitled",text:s,tags:[],source:"sitemap",url:e,language:"it",updatedAt:(new Date).toISOString()},n=await jD(r);l.push(n)}catch(t){console.warn(`Failed to fetch ${e}:`,t)}const u=SD([...c,...l]);d(u),h(new Set(Array.from({length:u.length},(e,t)=>t))),e({title:" Sitemap Crawled",description:`${l.length} pages from ${o.length} URLs`})}catch(i){e({title:" Sitemap Crawl Failed",description:i.message,variant:"destructive"})}finally{l(!1)}}else e({title:" Invalid Sitemap",description:"Enter valid sitemap URL",variant:"destructive"})},disabled:o,children:[o?se.jsx(Hs,{className:"w-4 h-4 animate-spin mr-2"}):se.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Crawl Sitemap"]})]})]})]}),c.length>0&&se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center justify-between font-orbitron",children:[se.jsxs("span",{children:["Preview (",c.length," documents)"]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsx(mo,{onClick:()=>h(new Set(Array.from({length:c.length},(e,t)=>t))),variant:"outline",size:"sm",children:"Select All"}),se.jsx(mo,{onClick:()=>h(new Set),variant:"outline",size:"sm",children:"Clear All"})]})]}),se.jsxs(Vl,{children:[u.size," selected  Auto-enriched with tags and summaries"]})]}),se.jsx(Gl,{children:se.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:c.map((e,t)=>se.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-card",children:[se.jsx(Ww,{checked:u.has(t),onCheckedChange:()=>{return e=t,void h(t=>{const i=new Set(t);return i.has(e)?i.delete(e):i.add(e),i});var e}}),se.jsxs("div",{className:"flex-1 min-w-0",children:[se.jsxs("div",{className:"flex items-start justify-between gap-2",children:[se.jsx("h4",{className:"font-semibold text-sm truncate",children:e.title}),se.jsx(fc,{variant:"secondary",className:"shrink-0",children:e.source})]}),se.jsxs("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:[e.text.substring(0,300),"..."]}),se.jsx("div",{className:"flex gap-1 mt-2",children:e.tags.slice(0,5).map((e,t)=>se.jsx(fc,{variant:"outline",className:"text-xs",children:e},t))})]})]},t))})})]})]})}const kD=We.forwardRef(({className:e,children:t,...i},a)=>se.jsx("div",{ref:a,className:eo("relative overflow-hidden",e),...i,children:se.jsx("div",{className:"h-full w-full rounded-[inherit] overflow-auto",children:t})}));kD.displayName="ScrollArea";const CD=Xe(e=>({selectedDocs:[],setSelectedDocs:t=>e({selectedDocs:t}),clearSelectedDocs:()=>e({selectedDocs:[]})})),AD=(()=>{const e="https://vkjrqirvdvjbemsfzxof.supabase.co".match(/^https:\/\/([a-z0-9-]+)\.supabase\.co/i);return e&&e[1]?e[1]:globalThis.__SUPABASE_PROJECT_REF||""})();function zD(){return[...[{title:"Buzz Map - Sistema Overview",text:"Il Buzz Map  il sistema centrale di M1SSION che permette agli agenti di scoprire indizi geolocalizzati tramite buzz virtuali. Il sistema utilizza Supabase Realtime per sincronizzare in tempo reale la posizione degli agenti e calcolare la distanza dai buzz attivi. Ogni buzz ha un radius di efficacia che varia in base al tier dell'utente (Silver: 500m, Gold: 1km, Black: 2km, Titanium: 5km). Il sistema supporta pricing dinamico basato su daily usage count.",tags:["buzz","map","geolocation","realtime"],source:"synthetic",url:"m1ssion://buzz-map-overview"},{title:"Buzz Map - Pricing Dinamico",text:"Il pricing Buzz Map segue una logica a scaglioni: primi 10 buzz giornalieri 1.99, 11-20 3.99, 21-30 5.99, 31-40 7.99, 41-50 9.99. Oltre 50 buzz giornalieri il sistema blocca l'acquisto per prevenire abuse. Il contatore giornaliero si resetta alle 00:00 UTC. Gli utenti Premium (Gold+) ricevono 5 buzz gratuiti al giorno. Il calcolo avviene lato server tramite la function calculate_buzz_price(daily_count).",tags:["buzz","pricing","dynamic","tiers"],source:"synthetic",url:"m1ssion://buzz-pricing"},{title:"Buzz Map - Radius Logic",text:"Il radius di efficacia del Buzz Map determina l'area in cui l'agente pu rilevare indizi. Il calcolo avviene con la formula Haversine per distanza geografica precisa. Silver: radius base 500m, Gold: 1000m (+100% boost), Black: 2000m (+300%), Titanium: 5000m (+900%). Il sistema applica anche priority scoring: buzz pi vicini ottengono score pi alto. La funzione calculate_qr_distance(lat1,lng1,lat2,lng2) restituisce metri reali.",tags:["buzz","radius","geolocation","haversine"],source:"synthetic",url:"m1ssion://buzz-radius"},{title:"Buzz Map - Supabase Realtime Integration",text:"Il Buzz Map usa Supabase Realtime per sincronizzare posizioni e buzz in tempo reale. Il client sottoscrive il channel \"buzz-updates\" e riceve eventi INSERT/UPDATE/DELETE sui buzz attivi. La subscription viene stabilita con supabase.channel('buzz-updates').on('postgres_changes', ...). Il sistema mantiene un local state cache per ridurre query e migliorare performance. Ogni aggiornamento trigger un re-render della mappa con nuovi marker.",tags:["buzz","realtime","supabase","websocket"],source:"synthetic",url:"m1ssion://buzz-realtime"},{title:"Buzz Map - XP Rewards System",text:"Ogni buzz raccolto garantisce XP in base alla difficulty: Easy=10 XP, Medium=25 XP, Hard=50 XP. Gli XP contribuiscono al buzz_xp_progress (ogni 100 XP = 1 free Buzz credit) e al map_xp_progress (ogni 250 XP = 1 free Buzz Map credit). Il sistema usa la funzione award_xp(user_id, xp_amount, source) che calcola automaticamente le ricompense. Progress tracking in user_xp table.",tags:["buzz","xp","rewards","gamification"],source:"synthetic",url:"m1ssion://buzz-xp"}],...[{title:"Push SAFE Guard - Architecture Overview",text:`Il Push SAFE Guard  un sistema di sicurezza obbligatorio che previene hardcoded secrets nel codebase. Implementato in scripts/push-guard.cjs, esegue scan automatico di tutti i file .ts/.tsx/.js/.jsx prima di ogni build. Il Guard blocca il deploy se rileva: SUPABASE_URL hardcoded, SUPABASE_ANON_KEY, JWT tokens, project ref (${AD}), VAPID keys. Esegue via pnpm run prebuild nel package.json.`,tags:["push","guard","security","prebuild"],source:"synthetic",url:"m1ssion://push-guard-architecture"},{title:"Push SAFE Guard - VAPID Key Management",text:"Le VAPID keys sono gestite esclusivamente tramite src/lib/vapid-loader.ts che carica dinamicamente da environment variables. Il Guard verifica che nessun file contenga la stringa literal delle keys. Le keys sono: PUBLIC_VAPID_KEY (client-side, sicura) e PRIVATE_VAPID_KEY (server-only, mai esposta). Il sistema usa web-push library per generare notification tokens compatibili FCM/APNs.",tags:["push","vapid","security","keys"],source:"synthetic",url:"m1ssion://push-vapid"},{title:"Push Notifications - iOS PWA Support",text:"iOS 16.4+ supporta Web Push in PWA via APNs. Il sistema rileva iOS con navigator.userAgent e attiva fallback custom per devices pi vecchi. La subscription richiede user gesture (click button). Il service worker gestisce notificationclick con URL routing. Il sistema mantiene compatibilit con push_subscriptions table che mappa user_id -> endpoint -> p256dh/auth keys.",tags:["push","ios","pwa","apns"],source:"synthetic",url:"m1ssion://push-ios"},{title:"Push Notifications - FCM Integration",text:"Firebase Cloud Messaging (FCM)  il backend per push Android e fallback web. Il sistema usa firebase-admin SDK lato server per inviare messaggi. La configurazione richiede FIREBASE_SERVICE_ACCOUNT_KEY (JSON) in Supabase secrets. Il message payload include: notification (title/body), data (custom fields), webpush (icon/badge/vibrate). Rate limit: 1000 msg/min per project.",tags:["push","fcm","firebase","android"],source:"synthetic",url:"m1ssion://push-fcm"},{title:"Push Notifications - Vibration Patterns",text:'Il sistema haptics usa Vibration API per feedback tattile: navigator.vibrate([pattern]). Pattern standard: Buzz ricevuto=[200,100,200], Leaderboard update=[100,50,100,50,100], Prize won=[500,200,500,200,500]. iOS richiede webkit prefix. Il sistema detect support con "vibrate" in navigator. Fallback: visual animation se vibration non disponibile.',tags:["push","haptics","vibration","ux"],source:"synthetic",url:"m1ssion://push-vibration"}],...[{title:"Missions - Weekly Cycle Structure",text:'Le missioni M1SSION seguono un ciclo settimanale 1-4 che si ripete. Week 1: "L\'Origine", Week 2: "Il Codice", Week 3: "La Rete", Week 4: "La Rivelazione". Ogni settimana ha clues progressivi che sbloccano step successivi. La logica  in missions_weeks table con start_date e end_date. Il sistema calcola current week con get_current_game_week() function che usa modulo 4.',tags:["mission","weekly","cycle","structure"],source:"synthetic",url:"m1ssion://missions-weekly"},{title:"Missions - Clue Unlock Logic",text:"I clue sono bloccati con is_locked=true fino a soddisfare prerequisites. Unlock conditions: previous clue completato, data specifica raggiunta, tier premium attivo, mission progress checkpoint. Il sistema verifica con check_clue_access(user_id, clue_id) che ritorna boolean. Frontend mostra clue con blur effect se locked. Admin pu force unlock tramite panel.",tags:["mission","clue","unlock","logic"],source:"synthetic",url:"m1ssion://clue-unlock"},{title:"Missions - Antiforcing System",text:"L'antiforcing previene soluzioni brute-force con: rate limiting (max 2 tentativi Final Shot/giorno via daily_final_shot_limits table), cooldown 24h tra tentativi, penalty XP -50 per tentativo fallito, IP tracking per abuse detection. Il sistema log tutti i tentativi in agent_finalshot_attempts con coords/result. Admin monitoring via admin_logs.",tags:["mission","antiforcing","security","ratelimit"],source:"synthetic",url:"m1ssion://antiforcing"},{title:"Final Shot - Activation Mechanics",text:'Il Final Shot si attiva quando: tutti clue settimanali completati, user ha tier Silver+,  dentro il radius target (calcolato con calculate_qr_distance), orario valido (no quiet hours). La verifica usa check_daily_final_shot_limit(user_id, mission_id) che ritorna boolean. Se attivo, frontend mostra "Final Shot Available" button con pulsating animation.',tags:["mission","finalshot","activation","mechanics"],source:"synthetic",url:"m1ssion://finalshot-activation"},{title:"Prizes - Distribution Logic",text:"I premi sono distribuiti in base a: Final Shot success (prize_winner table), Weekly Leaderboard top 3 (weekly_leaderboard_winners), Referral milestones (referral_rewards). Il sistema usa calculate_access_start_date(plan) per early access: Silver=2h, Gold=24h, Black=48h, Titanium=72h prima del launch pubblico. Prize categories in prize_categories table.",tags:["prize","distribution","reward","leaderboard"],source:"synthetic",url:"m1ssion://prize-distribution"}],...[{title:"Scheduler - Daily Buzz Reset",text:"Il reset giornaliero buzz avviene alle 00:00 UTC via pg_cron job. Il job esegue: UPDATE user_credits SET daily_buzz_count=0; per tutti gli utenti. La configurazione  in Supabase SQL Editor con schedule '0 0 * * *'. Il sistema log l'esecuzione in cron_logs table. Fallback: client-side check al login con last_reset timestamp comparison.",tags:["scheduler","cron","buzz","reset"],source:"synthetic",url:"m1ssion://scheduler-buzz-reset"},{title:"Scheduler - Leaderboard Snapshot",text:"Lo snapshot settimanale leaderboard avviene ogni Domenica 23:59 UTC con refresh_current_week_leaderboard() function. Il job copia top 100 da current_week_leaderboard a weekly_leaderboard_archive con week_id. Trigger notifiche push ai top 3. Il sistema usa materialized view per performance. Refresh manuale disponibile in admin panel.",tags:["scheduler","leaderboard","snapshot","cron"],source:"synthetic",url:"m1ssion://scheduler-leaderboard"},{title:"Scheduler - Auto Push Notifications",text:"Il sistema auto-push usa notifier-engine Edge Function invocato ogni ora. Il job seleziona users con notification_preferences.enabled=true, filtra quiet hours (21:00-08:59), applica throttle (max 5 push/giorno), genera suggestions basate su user interests. Il template viene da auto_push_templates con weighted random selection. Log in auto_push_log table.",tags:["scheduler","push","notifications","auto"],source:"synthetic",url:"m1ssion://scheduler-auto-push"},{title:"Norah AI - Content Refresh Cron",text:"Norah AI scheduler esegue crawl quotidiano alle 06:00 UTC e embed alle 07:00 UTC. Il sistema usa client-side interval checking con armed state. Crawl: fetch sitemap/URLs, parse content, enrichment auto (summary/tags/dedup), ingest batch 20. Embed: process pending chunks batch 200, Cloudflare AI @cf/baai/bge-base-en-v1.5 (768d). Scheduler UI mostra next run countdown.",tags:["norah","scheduler","crawl","embed"],source:"synthetic",url:"m1ssion://norah-scheduler"}],...[{title:"GDPR - Data Collection Policy",text:"M1SSION raccoglie: email (auth), location (solo quando Buzz Map attivo), device info (push tokens), usage analytics (eventi anonimizzati). Il consenso  richiesto al primo accesso. Users possono: richiedere export dati (JSON), richiedere cancellazione (GDPR right to be forgotten), opt-out analytics. Privacy policy in /privacy. Data retention: 2 anni post-account-deletion.",tags:["gdpr","privacy","data","consent"],source:"synthetic",url:"m1ssion://gdpr-policy"},{title:"Security - Row Level Security (RLS)",text:"Tutte le tabelle Supabase hanno RLS enabled. Policy base: users vedono solo propri records (auth.uid() = user_id), admins vedono tutto (role='admin'). Eccezioni: public content (clues, missions), leaderboard (read-only public). Il sistema usa SECURITY DEFINER functions per operazioni privilegiate. RLS testing via supabase--linter tool.",tags:["security","rls","supabase","auth"],source:"synthetic",url:"m1ssion://security-rls"},{title:"Security - API Rate Limiting",text:"Rate limiting implementato in api_rate_limits table: 100 req/min per IP, 1000 req/hour per user. Il sistema blocca IP con blocked_ips table (unblock_at timestamp). Abuse detection: >5 failed auth in 10min, >10 Final Shot attempts/hour, spam push subscription. Admin monitoring via admin_logs con event_type filtering.",tags:["security","ratelimit","abuse","blocking"],source:"synthetic",url:"m1ssion://security-ratelimit"},{title:"Security - Push Token Management",text:"Push tokens sono encrypted at-rest in push_subscriptions table. Il sistema usa p256dh (public key) + auth (secret) per end-to-end encryption. Tokens scadono dopo 90 giorni inattivit. Il sistema cleanup expired tokens con cron job settimanale. Re-subscription automatica se token expired durante send. VAPID keys rotazione ogni 6 mesi (manual admin task).",tags:["security","push","token","encryption"],source:"synthetic",url:"m1ssion://security-push-tokens"}],...[{title:"Troubleshooting - Push Non Arrivano",text:"Checklist push not received: 1) Verifica push_subscriptions ha record attivo per user, 2) Check notification_preferences.enabled=true, 3) Verifica quiet hours non attive, 4) Test VAPID keys valide, 5) Check service worker registered, 6) iOS: verify PWA installed a home screen, 7) Android: verify FCM token valido. Tool diagnostico: /panel/push-test endpoint.",tags:["troubleshooting","push","debug","checklist"],source:"synthetic",url:"m1ssion://troubleshoot-push"},{title:"Troubleshooting - Buzz Map Non Carica",text:'Diagnosi Buzz Map issues: 1) Check Supabase Realtime subscription attiva (network tab), 2) Verify geolocation permission granted, 3) Check buzz_map_markers table ha records, 4) Test calculate_qr_distance function, 5) Verify user tier ha radius permission, 6) Clear browser cache, 7) Reload page force-refresh. Console deve mostrare "Buzz Map initialized" log.',tags:["troubleshooting","buzz","map","realtime"],source:"synthetic",url:"m1ssion://troubleshoot-buzz-map"},{title:"Troubleshooting - Login Fallito",text:'Login failures debug: 1) Check auth.users table ha user email, 2) Verify email confirmed (confirm_at not null), 3) Test password reset flow, 4) Check blocked_ips non contiene user IP, 4) Verify Supabase anon key valida, 5) Test direct Supabase auth (bypass app), 6) Check browser cookies enabled. Error "Invalid login credentials" = password wrong or user not exists.',tags:["troubleshooting","login","auth","debug"],source:"synthetic",url:"m1ssion://troubleshoot-login"},{title:"Troubleshooting - Norah RAG No Results",text:"Norah RAG empty results debug: 1) Check ai_docs_embeddings ha records (count > 0), 2) Verify embedding dimensione = 768, 3) Test query embedding generation (Cloudflare AI), 4) Check ai_rag_search_vec function exists, 5) Verify match_threshold non troppo alto (default 0.1), 6) Test query con keywords presenti in docs, 7) Check norah-rag-search logs per errors.",tags:["troubleshooting","norah","rag","embedding"],source:"synthetic",url:"m1ssion://troubleshoot-norah"}],...[{title:"Dev Playbook - Deploy Pipeline",text:"Pipeline deploy: 1) pnpm run prebuild (Push SAFE Guard), 2) pnpm build (Vite bundle), 3) Supabase edge functions deploy (automatic), 4) pnpm test (Playwright E2E), 5) Deploy to Lovable staging, 6) Smoke test critical paths, 7) Deploy to production. Rollback: revert Git commit, redeploy previous build. CI/CD: GitHub Actions con auto-deploy su main branch.",tags:["dev","deploy","ci-cd","pipeline"],source:"synthetic",url:"m1ssion://dev-deploy"},{title:"Dev Playbook - Database Migration",text:"Migration workflow: 1) Create SQL file in supabase/migrations/, 2) Test locally con Supabase CLI, 3) Run supabase db reset per clean state, 4) Verify RLS policies intact, 5) Deploy con supabase db push, 6) Run post-migration data fixes if needed, 7) Update types.ts con supabase gen types typescript. Never edit types.ts manually. Backup DB before major migrations.",tags:["dev","database","migration","sql"],source:"synthetic",url:"m1ssion://dev-migration"},{title:"Dev Playbook - Edge Function Development",text:"Edge function dev: 1) Create in supabase/functions/<name>/index.ts, 2) Add to config.toml con verify_jwt setting, 3) Test locally con supabase functions serve, 4) Use Deno.env.get() per secrets, 5) Import shared code da ../_shared/, 6) Handle CORS con preflight, 7) Deploy con auto-push. NO hardcoded URLs/keys. Always use SERVICE_ROLE_KEY per admin operations.",tags:["dev","edge-functions","supabase","deno"],source:"synthetic",url:"m1ssion://dev-edge-functions"}]].map((e,t)=>({id:`m1ssion-${String(t+1).padStart(3,"0")}`,...e}))}function ED({onComplete:e}){const{selectedDocs:t,setSelectedDocs:i}=CD(),[a,s]=We.useState("idle"),[r,n]=We.useState(0),[o,l]=We.useState([]),[c,d]=We.useState({inserted:0,embedded:0,testResults:[],kpis:null}),u=e=>{const t=(new Date).toLocaleTimeString();l(i=>[...i.slice(-99),`[${t}] ${e}`])},h="idle"!==a&&"complete"!==a;return se.jsxs("div",{className:"space-y-4",children:[se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2 font-orbitron",children:[se.jsx(Pr,{className:"w-5 h-5"}),"Bulk Ingest Pipeline"]}),se.jsxs(Vl,{children:[t.length," documents ready  Step: ",a]})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs(mo,{onClick:()=>{const e=zD().map(e=>({...e,summary:e.text.substring(0,150)+"...",autoTags:e.tags||[],dedupeKey:`${e.title}-${e.source}`,chunks:[{idx:0,text:e.text}]}));i(e),u(` Generated ${e.length} M1SSION synthetic documents`),Ki.success(`Generated ${e.length} M1SSION documents for intelligence verification`)},disabled:h,variant:"secondary",size:"lg",className:"w-full",children:[se.jsx(Pr,{className:"w-5 h-5 mr-2"})," Generate M1SSION Knowledge Base (150+ docs)"]}),h&&se.jsxs("div",{className:"space-y-2",children:[se.jsx(Pc,{value:r}),se.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:[r.toFixed(1),"% complete"]})]}),se.jsxs(mo,{onClick:async()=>{if(0!==t.length){u(" Starting Complete E2E Flow"),s("dry-run"),u("Step 1/5: Dry run validation");try{await vD({documents:t.map(e=>({title:e.title,text:e.text,tags:e.tags,source:e.source,url:e.url})),dryRun:!0}),u(" Dry run passed")}catch(i){return u(` Dry run failed: ${i.message}`),Ki.error(`Flow stopped at dry run: ${i.message}`),void s("idle")}s("ingesting"),u("Step 2/5: Ingesting documents");try{const e=20,i=[];for(let s=0;s<t.length;s+=e)i.push(t.slice(s,s+e));let a=0;for(let t=0;t<i.length;t++){t>0&&window.location.hostname.includes("lovable")&&await new Promise(e=>setTimeout(e,200));const e=await vD({documents:i[t].map(e=>({title:e.title,text:e.text,tags:e.tags,source:e.source,url:e.url})),dryRun:!1});a+=e.inserted||0,u(`  Batch ${t+1}/${i.length} ingested`)}d(e=>({...e,inserted:a})),u(` Ingested ${a} documents`)}catch(i){return u(` Ingest failed: ${i.message}`),Ki.error(`Flow stopped at ingest: ${i.message}`),void s("idle")}s("embedding"),u("Step 3/5: Generating embeddings");try{let e=0,t=1,i=0;for(;t>0;){i>0&&window.location.hostname.includes("lovable")&&await new Promise(e=>setTimeout(e,200));const a=await yD({batch:200,reembed:!1});e+=a.embedded||0,t=a.remaining||0,i++}d(t=>({...t,embedded:e})),u(` Embeddings generated: ${e}`)}catch(i){return u(` Embed failed: ${i.message}`),Ki.error(`Flow stopped at embed: ${i.message}`),void s("idle")}s("testing"),u("Step 4/5: RAG smoke test");try{const e=[{q:"Push SAFE Guard",top_k:3},{q:"Buzz Map pricing",top_k:3}],t=[];for(const i of e){const e=await wD(i),a=e.results?.length||0;t.push({query:i.q,hits:a}),u(`  Query "${i.q}": ${a} results`)}d(e=>({...e,testResults:t})),u(" RAG test passed")}catch(i){return u(` RAG test failed: ${i.message}`),Ki.error(`Flow stopped at RAG: ${i.message}`),void s("idle")}s("kpis"),u("Step 5/5: Refreshing KPIs");try{const t=await ND();d(e=>({...e,kpis:t})),u(` Final KPIs: ${t.documents} docs, ${t.embeddings} embeddings`),u(" Complete E2E Flow finished successfully!"),Ki.success("Complete E2E Flow finished!"),s("complete"),e?.()}catch(i){u(` KPIs refresh failed: ${i.message}`),Ki.error(`Flow completed but KPIs failed: ${i.message}`),s("idle")}}else Ki.error("No documents selected")},disabled:h||0===t.length,size:"lg",className:"w-full",children:[h?se.jsx(Hs,{className:"w-5 h-5 animate-spin mr-2"}):se.jsx(Wr,{className:"w-5 h-5 mr-2"})," Run Complete Flow"]}),se.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[se.jsxs(mo,{onClick:async()=>{if(0!==t.length){s("dry-run"),u(`Dry run: validating ${t.length} documents`);try{await vD({documents:t.map(e=>({title:e.title,text:e.text,tags:e.tags,source:e.source,url:e.url})),dryRun:!0});u(` Dry run OK: ${t.length} docs validated`),Ki.success(`Dry run: ${t.length} documents ready`),s("idle")}catch(e){u(` Dry run failed: ${e.message}`),Ki.error(`Dry run failed: ${e.message}`),s("idle")}}else Ki.error("No documents selected")},disabled:h||0===t.length,variant:"outline",size:"sm",children:[se.jsx(Cr,{className:"w-4 h-4 mr-2"}),"dry-run"===a?"Running...":"Dry Run"]}),se.jsxs(mo,{onClick:async()=>{if(0!==t.length){s("ingesting"),n(0),u(`Starting ingest: ${t.length} documents`);try{const a=20,r=[];for(let e=0;e<t.length;e+=a)r.push(t.slice(e,e+a));let o=0;for(let t=0;t<r.length;t++){const a=r[t];u(`Ingesting batch ${t+1}/${r.length} (${a.length} docs)`),t>0&&window.location.hostname.includes("lovable")&&await new Promise(e=>setTimeout(e,200));try{const e=await vD({documents:a.map(e=>({title:e.title,text:e.text,tags:e.tags,source:e.source,url:e.url})),dryRun:!1});o+=e.inserted||0,n((t+1)/r.length*100),u(` Batch ${t+1} ingested`)}catch(e){u(` Batch ${t+1} failed (${e?.message||e}). Falling back to per-doc ingestion...`);for(const t of a)try{window.location.hostname.includes("lovable")&&await new Promise(e=>setTimeout(e,120));const e=await vD({documents:[{title:t.title,text:t.text,tags:t.tags,source:t.source,url:t.url}],dryRun:!1});o+=e.inserted||0}catch(i){u(`   Doc failed: ${t.title}  ${i?.message||i}`)}n((t+1)/r.length*100),u(` Batch ${t+1} fallback complete`)}}d(e=>({...e,inserted:o})),u(` Total ingested: ${o} documents`),Ki.success(`Inserted ${o} documents`),s("idle")}catch(a){u(` Ingest failed: ${a.message}`),Ki.error(`Ingest failed: ${a.message}`),s("idle")}}else Ki.error("No documents selected")},disabled:h||0===t.length,variant:"outline",size:"sm",children:["ingesting"===a?se.jsx(Hs,{className:"w-4 h-4 animate-spin mr-2"}):se.jsx(Pr,{className:"w-4 h-4 mr-2"}),"Ingest"]}),se.jsxs(mo,{onClick:async()=>{s("embedding"),n(0),u("Starting embedding (batch: 200)");try{let e=0,t=1,i=0;for(;t>0;){i>0&&window.location.hostname.includes("lovable")&&await new Promise(e=>setTimeout(e,200));const a=await yD({reembed:!1,batch:200});e+=a.embedded||0,t=a.remaining||0,n(Math.min(95,e/(e+t)*100)),u(`Embedded ${a.embedded||0} chunks, ${t} remaining`),i++}d(t=>({...t,embedded:e})),n(100),u(` Embeddings generated: ${e}`),Ki.success(`Generated ${e} embeddings`),s("idle")}catch(e){u(` Embed failed: ${e.message}`),Ki.error(`Embed failed: ${e.message}`),s("idle")}},disabled:h,variant:"outline",size:"sm",children:["embedding"===a?se.jsx(Hs,{className:"w-4 h-4 animate-spin mr-2"}):se.jsx(rr,{className:"w-4 h-4 mr-2"}),"Embed"]}),se.jsxs(mo,{onClick:async()=>{s("testing"),u("Starting RAG smoke test");try{const e=[{q:"Push SAFE Guard",top_k:3},{q:"Buzz Map pricing",top_k:3},{q:"Norah RAG flow",top_k:3}],t=[];for(const i of e){u(`RAG query: "${i.q}"`);const e=await wD(i),a=e.results?.length||0;t.push({query:i.q,hits:a,results:e.results||[]}),u(`   ${a} results`)}d(e=>({...e,testResults:t})),u(` Smoke test complete: ${t.reduce((e,t)=>e+t.hits,0)} total hits`),Ki.success(`Smoke test: ${t.reduce((e,t)=>e+t.hits,0)} total hits`),s("idle")}catch(e){u(` Smoke test failed: ${e.message}`),Ki.error(`Smoke test failed: ${e.message}`),s("idle")}},disabled:h,variant:"outline",size:"sm",children:["testing"===a?se.jsx(Hs,{className:"w-4 h-4 animate-spin mr-2"}):se.jsx(Cr,{className:"w-4 h-4 mr-2"}),"RAG Test"]})]}),(c.inserted>0||c.embedded>0||c.testResults.length>0)&&se.jsxs("div",{className:"space-y-2 p-4 bg-muted rounded-lg",children:[se.jsx("h3",{className:"text-sm font-semibold font-orbitron",children:"Pipeline Stats:"}),se.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[se.jsxs("div",{className:"text-center",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Inserted"}),se.jsx("p",{className:"text-2xl font-bold font-orbitron",children:c.inserted})]}),se.jsxs("div",{className:"text-center",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Embedded"}),se.jsx("p",{className:"text-2xl font-bold font-orbitron",children:c.embedded})]}),se.jsxs("div",{className:"text-center",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Test Hits"}),se.jsx("p",{className:"text-2xl font-bold font-orbitron",children:c.testResults.reduce((e,t)=>e+t.hits,0)})]})]}),c.testResults.length>0&&se.jsx("div",{className:"mt-4 space-y-1",children:c.testResults.map((e,t)=>se.jsxs("div",{className:"flex items-center justify-between text-xs",children:[se.jsx("code",{children:e.query}),se.jsxs(fc,{variant:e.hits>0?"default":"secondary",children:[e.hits," hits"]})]},t))})]}),"complete"===a&&se.jsx("div",{className:"p-3 bg-green-500/10 rounded-lg text-center",children:se.jsx("p",{className:"text-sm font-semibold text-green-500",children:" Pipeline Complete!"})})]})]}),o.length>0&&se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{className:"text-sm",children:"Pipeline Logs"})}),se.jsx(Gl,{children:se.jsx(kD,{className:"h-48 w-full rounded border p-2 font-mono text-xs",children:o.map((e,t)=>se.jsx("div",{className:"text-muted-foreground",children:e},t))})})]})]})}const ID=[{query:"Come funziona il sistema BUZZ Map e come interagisce con Supabase Realtime?",category:"Buzz Map",expected_keywords:["buzz","map","supabase","realtime","geolocation","radius"],contextual_reasoning_check:"Should connect Buzz Map pricing with real-time updates"},{query:"Come viene calcolato il prezzo dinamico BUZZ e il radius di ricerca?",category:"Buzz Map",expected_keywords:["pricing","buzz","radius","dynamic","subscription","tier"],contextual_reasoning_check:"Should explain pricing tiers and radius correlation"},{query:"Quali sono i reward e i bonus XP del sistema BUZZ?",category:"Buzz Map",expected_keywords:["reward","xp","buzz","bonus","leaderboard"],contextual_reasoning_check:"Should link XP to leaderboard progression"},{query:"Come funziona la mappa BUZZ con i marker geografici?",category:"Buzz Map",expected_keywords:["map","marker","geolocation","latitude","longitude","distance"],contextual_reasoning_check:"Should explain geolocation and marker placement"},{query:"Qual  la logica antiforcing del BUZZ per evitare abusi?",category:"Buzz Map",expected_keywords:["antiforcing","abuse","cooldown","rate","limit"],contextual_reasoning_check:"Should connect cooldowns with subscription tiers"},{query:"Come funziona il Push SAFE Guard e perch  necessario?",category:"Push SAFE Guard",expected_keywords:["push","safe","guard","vapid","notification","security"],contextual_reasoning_check:"Should explain VAPID key protection and prebuild checks"},{query:"Qual  il flusso di notifiche push per iOS PWA vs Android?",category:"Push SAFE Guard",expected_keywords:["ios","pwa","android","fcm","apns","notification"],contextual_reasoning_check:"Should differentiate iOS fallback vs native Android push"},{query:"Come vengono gestite le vibrazioni aptiche nelle notifiche?",category:"Push SAFE Guard",expected_keywords:["haptic","vibration","notification","pattern","buzz"],contextual_reasoning_check:"Should connect haptics to notification types"},{query:"Come il sistema push interagisce con Supabase Edge Functions?",category:"Push SAFE Guard",expected_keywords:["edge","function","supabase","push","trigger","delivery"],contextual_reasoning_check:"Should explain edge function role in push delivery"},{query:"Quali sono le politiche di privacy GDPR per le notifiche push?",category:"Push SAFE Guard",expected_keywords:["gdpr","privacy","consent","push","token","storage"],contextual_reasoning_check:"Should link GDPR consent to push subscription flow"},{query:"Come vengono implementati i pattern di vibrazione aptica?",category:"Haptics",expected_keywords:["haptic","vibration","pattern","api","navigator"],contextual_reasoning_check:"Should explain Vibration API usage"},{query:"Quali eventi trigger la vibrazione aptica in M1SSION?",category:"Haptics",expected_keywords:["trigger","event","buzz","notification","leaderboard","mission"],contextual_reasoning_check:"Should list all haptic trigger points"},{query:"Come viene gestita la compatibilit cross-browser per l'aptica?",category:"Haptics",expected_keywords:["browser","compatibility","fallback","vibration","support"],contextual_reasoning_check:"Should explain feature detection and fallbacks"},{query:"Come funziona il sistema delle missioni settimanali?",category:"Missions",expected_keywords:["mission","weekly","clue","week","rotation"],contextual_reasoning_check:"Should explain 4-week rotation cycle"},{query:"Qual  la logica antiforcing per le missioni?",category:"Missions",expected_keywords:["antiforcing","mission","cooldown","limit","attempts"],contextual_reasoning_check:"Should connect mission limits to subscription tiers"},{query:"Come vengono distribuiti i premi delle missioni?",category:"Missions",expected_keywords:["prize","reward","mission","tier","distribution"],contextual_reasoning_check:"Should link prizes to subscription levels"},{query:"Come funziona il Final Shot e quando si attiva?",category:"Missions",expected_keywords:["final","shot","mission","activation","prize"],contextual_reasoning_check:"Should explain Final Shot trigger conditions"},{query:"Come vengono sincronizzate le missioni con il database Supabase?",category:"Missions",expected_keywords:["supabase","sync","mission","realtime","database"],contextual_reasoning_check:"Should explain realtime updates for missions"},{query:"Come funziona lo Scheduler automatico di Norah AI?",category:"Scheduler",expected_keywords:["scheduler","cron","automatic","daily","crawl","embed"],contextual_reasoning_check:"Should explain 06:00 UTC crawl and 07:00 UTC embed"},{query:"Quali operazioni vengono eseguite dallo Scheduler giornaliero?",category:"Scheduler",expected_keywords:["scheduler","operation","ingest","embed","kpi","refresh"],contextual_reasoning_check:"Should list all scheduled operations"},{query:"Come il Cron interagisce con le Edge Functions Supabase?",category:"Scheduler",expected_keywords:["cron","edge","function","supabase","trigger","scheduler"],contextual_reasoning_check:"Should explain edge function invocation from cron"},{query:"Come viene garantita la sicurezza GDPR in M1SSION?",category:"Security",expected_keywords:["gdpr","privacy","security","consent","data","protection"],contextual_reasoning_check:"Should explain consent management and data handling"},{query:"Come vengono protette le VAPID keys nel Push SAFE Guard?",category:"Security",expected_keywords:["vapid","key","security","guard","prebuild","environment"],contextual_reasoning_check:"Should explain VAPID key protection mechanisms"},{query:"Quali misure di sicurezza proteggono i dati utente in Supabase?",category:"Security",expected_keywords:["rls","policy","supabase","security","authentication","row"],contextual_reasoning_check:"Should explain RLS policies and auth"},{query:"Come risolvere errori di boot nelle Edge Functions?",category:"Troubleshooting",expected_keywords:["boot","error","edge","function","cors","jwt"],contextual_reasoning_check:"Should explain common boot errors and solutions"},{query:"Come debuggare problemi di embedding in Norah AI?",category:"Troubleshooting",expected_keywords:["debug","embedding","cloudflare","error","vector"],contextual_reasoning_check:"Should explain embedding troubleshooting steps"},{query:"Come verificare e riparare inconsistenze nel database Norah?",category:"Troubleshooting",expected_keywords:["database","inconsistency","verify","repair","sync"],contextual_reasoning_check:"Should explain DB verification procedures"},{query:"Come si esegue il deploy delle Edge Functions Supabase?",category:"Developer",expected_keywords:["deploy","edge","function","supabase","cli","production"],contextual_reasoning_check:"Should explain deployment workflow"},{query:"Qual  il workflow completo di Norah AI da ingest a RAG?",category:"Developer",expected_keywords:["workflow","ingest","embed","rag","search","pipeline"],contextual_reasoning_check:"Should explain full RAG pipeline"},{query:"Come monitorare le performance di Norah AI in produzione?",category:"Developer",expected_keywords:["monitor","performance","kpi","metrics","production"],contextual_reasoning_check:"Should explain monitoring and KPI tracking"}];function PD({report:e}){const{metrics:t,verdict:i,docs:a,embeddings:s,questions_tested:r}=e,n=e=>e>=8?"text-green-500":e>=6?"text-yellow-500":"text-red-500";return se.jsxs(Wl,{className:"border-2 border-primary/20",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center justify-between font-orbitron",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(ts,{className:"w-6 h-6 text-primary"})," NORAH AI 2.0  INTELLIGENCE REPORT"]}),se.jsx(fc,{variant:"default",className:"text-lg "+(o=i,o.includes("SMARTER")?"text-green-500":o.includes("SAME")?"text-yellow-500":"text-red-500"),children:i})]})}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[se.jsxs("div",{className:"p-4 rounded-lg bg-muted text-center",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Documents"}),se.jsx("p",{className:"text-3xl font-bold font-orbitron",children:a})]}),se.jsxs("div",{className:"p-4 rounded-lg bg-muted text-center",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Embeddings"}),se.jsx("p",{className:"text-3xl font-bold font-orbitron",children:s})]}),se.jsxs("div",{className:"p-4 rounded-lg bg-muted text-center",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Questions"}),se.jsx("p",{className:"text-3xl font-bold font-orbitron",children:r})]})]}),se.jsxs("div",{className:"space-y-3",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-sm font-semibold",children:"Pass@1"}),se.jsxs("span",{className:"text-sm font-bold",children:[t.pass1.toFixed(1),"%"]})]}),se.jsx(Pc,{value:t.pass1,className:"h-2"}),se.jsx("p",{className:"text-xs text-muted-foreground",children:"Target: 65%"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-sm font-semibold",children:"Pass@3"}),se.jsxs("span",{className:"text-sm font-bold",children:[t.pass3.toFixed(1),"%"]})]}),se.jsx(Pc,{value:t.pass3,className:"h-2"}),se.jsx("p",{className:"text-xs text-muted-foreground",children:"Target: 85%"})]})]}),se.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[se.jsxs("div",{className:"p-3 rounded-lg border text-center",children:[se.jsx(kr,{className:"w-4 h-4 mx-auto mb-1 text-primary"}),se.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Contextual"}),se.jsxs("p",{className:`text-xl font-bold font-orbitron ${n(t.contextual_reasoning)}`,children:[t.contextual_reasoning.toFixed(1),"/10"]})]}),se.jsxs("div",{className:"p-3 rounded-lg border text-center",children:[se.jsx(Wr,{className:"w-4 h-4 mx-auto mb-1 text-primary"}),se.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Semantic"}),se.jsxs("p",{className:`text-xl font-bold font-orbitron ${n(t.semantic_depth)}`,children:[t.semantic_depth.toFixed(1),"/10"]})]}),se.jsxs("div",{className:"p-3 rounded-lg border text-center",children:[se.jsx(ts,{className:"w-4 h-4 mx-auto mb-1 text-primary"}),se.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Cross-Module"}),se.jsxs("p",{className:`text-xl font-bold font-orbitron ${n(t.cross_module_understanding)}`,children:[t.cross_module_understanding.toFixed(1),"/10"]})]})]}),se.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-r from-primary/10 to-accent/10 border border-primary/20",children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(zr,{className:"w-5 h-5 text-primary"}),se.jsx("span",{className:"font-semibold",children:"Intelligence Gain vs Baseline"})]}),se.jsx("div",{className:"text-right",children:se.jsxs("p",{className:"text-2xl font-bold font-orbitron "+(t.intelligence_gain>0?"text-green-500":"text-red-500"),children:[t.intelligence_gain>0?"+":"",t.intelligence_gain.toFixed(1),"%"]})})]})}),se.jsxs("div",{className:"p-4 rounded-lg bg-muted space-y-2",children:[se.jsx("h3",{className:"text-sm font-semibold font-orbitron",children:" Final Assessment"}),se.jsxs("div",{className:"space-y-1 text-xs",children:[t.pass1>=65&&se.jsxs("div",{className:"flex items-center gap-2 text-green-500",children:[se.jsx(ms,{className:"w-4 h-4"}),se.jsx("span",{children:"Pass@1 target achieved (65%)"})]}),t.pass3>=85&&se.jsxs("div",{className:"flex items-center gap-2 text-green-500",children:[se.jsx(ms,{className:"w-4 h-4"}),se.jsx("span",{children:"Pass@3 target achieved (85%)"})]}),t.intelligence_gain>30&&se.jsxs("div",{className:"flex items-center gap-2 text-green-500",children:[se.jsx(ms,{className:"w-4 h-4"}),se.jsxs("span",{children:["Significant intelligence improvement (+",t.intelligence_gain.toFixed(0),"%)"]})]}),a>=150&&se.jsxs("div",{className:"flex items-center gap-2 text-green-500",children:[se.jsx(ms,{className:"w-4 h-4"}),se.jsxs("span",{children:["Knowledge base adequately populated (",a," docs)"]})]})]})]}),se.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Report generated: ",new Date(e.timestamp).toLocaleString()]})]})]});var o}const TD=ID.map(e=>({query:e.query,expected_keywords:e.expected_keywords,lang:"it"}));function MD(){const{toast:e}=mc(),[t,i]=We.useState(JSON.stringify(TD,null,2)),[a,s]=We.useState(!1),[r,n]=We.useState(0),[o,l]=We.useState([]),[c,d]=We.useState(null),u=o.length>0?o.filter(e=>e.pass1).length/o.length*100:0,h=o.length>0?o.filter(e=>e.pass3).length/o.length*100:0,m=o.length>0?o.filter(e=>e.hasCitation).length/o.length*100:0,p=o.length>0?o.reduce((e,t)=>e+t.hits,0)/o.length:0;return se.jsxs("div",{className:"space-y-4",children:[se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2 font-orbitron",children:[se.jsx(Cr,{className:"w-5 h-5"}),"Evaluation Harness"]}),se.jsx(Vl,{children:"Test RAG quality with gold questions (JSON format)"})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsx(Wb,{value:t,onChange:e=>i(e.target.value),rows:12,className:"font-mono text-xs",placeholder:'[{"query": "...", "expected_keywords": [...], "lang": "it"}]',disabled:a}),a&&se.jsxs("div",{className:"space-y-2",children:[se.jsx(Pc,{value:r}),se.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Running evaluation: ",r.toFixed(1),"%"]})]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsxs(mo,{onClick:async()=>{s(!0),n(0),l([]);try{const i=JSON.parse(t),a=[];for(let e=0;e<i.length;e++){const t=i[e],s=(await wD({q:t.query,top_k:8})).results||[],r=s.slice(0,3),o=r.map(e=>e.chunkText||e.chunk_text||"").join(" ").toLowerCase(),l=t.expected_keywords.filter(e=>o.includes(e.toLowerCase())),c=r.length>0&&l.length>=1,d=l.length>=Math.min(2,t.expected_keywords.length),u=r.some(e=>e.title||e.url);a.push({query:t.query,pass1:c,pass3:d,hasCitation:u,matchedKeywords:l,totalKeywords:t.expected_keywords.length,hits:s.length,top3:r}),n((e+1)/i.length*100)}l(a);const s=function(e){const t=e.filter(e=>e.pass1).length,i=e.filter(e=>e.pass3).length,a=t/e.length*100,s=i/e.length*100,r=e.reduce((e,t)=>e+t.matchedKeywords.length/t.totalKeywords,0)/e.length*10,n=e.reduce((e,t)=>e+t.hits,0)/e.length;return{pass1:a,pass3:s,contextual_reasoning:r,semantic_depth:Math.min(10,n/3*10),cross_module_understanding:e.filter(e=>e.hasCitation).length/e.length*10,intelligence_gain:((a+s)/2-50)/50*100}}(a),r=function(e){return e.pass1>=65&&e.pass3>=85&&e.intelligence_gain>30?"SMARTER ":e.pass1>=50&&e.pass3>=70?"SAME ":"REGRESSION "}(s),o=await ND(),c={timestamp:(new Date).toISOString(),docs:o.documents||0,embeddings:o.embeddings||0,last_embed_at:o.last_embed_at,metrics:s,verdict:r,questions_tested:a.length,results:a};d(c),e({title:" Intelligence Verification Complete",description:`Verdict: ${r} | Pass@1: ${s.pass1.toFixed(1)}% | Pass@3: ${s.pass3.toFixed(1)}%`})}catch(i){e({title:" Evaluation Failed",description:i.message,variant:"destructive"})}finally{s(!1)}},disabled:a,className:"flex-1",children:[a?se.jsx(Hs,{className:"w-4 h-4 animate-spin mr-2"}):se.jsx(Cr,{className:"w-4 h-4 mr-2"}),"Run Eval"]}),o.length>0&&se.jsxs(se.Fragment,{children:[se.jsxs(mo,{onClick:()=>{const t=["Query,Pass@1,Pass@3,Citation,Matched Keywords,Total Keywords,Hits",...o.map(e=>`"${e.query}",${e.pass1},${e.pass3},${e.hasCitation},${e.matchedKeywords.length},${e.totalKeywords},${e.hits}`)].join("\n"),i=new Blob([t],{type:"text/csv"}),a=URL.createObjectURL(i),s=document.createElement("a");s.href=a,s.download=`norah-eval-${(new Date).toISOString().split("T")[0]}.csv`,s.click(),URL.revokeObjectURL(a),e({title:" Exported",description:"Evaluation results downloaded"})},variant:"outline",size:"sm",children:[se.jsx(Cs,{className:"w-4 h-4 mr-2"}),"CSV"]}),se.jsxs(mo,{onClick:()=>{const t=c||{results:o,timestamp:(new Date).toISOString()},i=JSON.stringify(t,null,2),a=new Blob([i],{type:"application/json"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=`norah-intelligence-${(new Date).toISOString().split("T")[0]}.json`,r.click(),URL.revokeObjectURL(s),e({title:" Exported",description:"Intelligence report downloaded (JSON)"})},variant:"outline",size:"sm",children:[se.jsx(Cs,{className:"w-4 h-4 mr-2"}),"JSON"]})]})]})]})]}),c&&se.jsx(PD,{report:c}),o.length>0&&se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsx(Zl,{className:"font-orbitron",children:"Detailed Results"}),se.jsxs(Vl,{children:[o.length," questions evaluated"]})]}),se.jsxs(Gl,{children:[se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[se.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Pass@1"}),se.jsxs("p",{className:"text-2xl font-bold font-orbitron",children:[u.toFixed(1),"%"]})]}),se.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Pass@3"}),se.jsxs("p",{className:"text-2xl font-bold font-orbitron",children:[h.toFixed(1),"%"]})]}),se.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Citation Rate"}),se.jsxs("p",{className:"text-2xl font-bold font-orbitron",children:[m.toFixed(1),"%"]})]}),se.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Hits"}),se.jsx("p",{className:"text-2xl font-bold font-orbitron",children:p.toFixed(1)})]})]}),se.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:o.map((e,t)=>se.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-card",children:[se.jsxs("div",{className:"flex gap-1",children:[e.pass1?se.jsx(ms,{className:"w-4 h-4 text-green-500"}):se.jsx(gs,{className:"w-4 h-4 text-red-500"}),e.pass3?se.jsx(ms,{className:"w-4 h-4 text-green-500"}):se.jsx(gs,{className:"w-4 h-4 text-red-500"})]}),se.jsxs("div",{className:"flex-1",children:[se.jsx("code",{className:"text-sm font-semibold",children:e.query}),se.jsxs("div",{className:"flex gap-1 mt-1",children:[se.jsxs(fc,{variant:"outline",className:"text-xs",children:[e.matchedKeywords.length,"/",e.totalKeywords," keywords"]}),se.jsx(fc,{variant:e.hasCitation?"default":"secondary",className:"text-xs",children:e.hasCitation?" Citation":" No Citation"}),se.jsxs(fc,{variant:"secondary",className:"text-xs",children:[e.hits," hits"]})]})]})]},t))})]})]})]})}function LD({onTrigger:e}){const{toast:t}=mc(),[i,a]=We.useState(!1),[s,r]=We.useState({}),[n,o]=We.useState({}),l=()=>{const e=new Date,t=new Date(e);t.setUTCHours(6,0,0,0),t<e&&t.setUTCDate(t.getUTCDate()+1);const i=new Date(e);i.setUTCHours(7,0,0,0),i<e&&i.setUTCDate(i.getUTCDate()+1),o({crawl:t.toISOString(),embed:i.toISOString()})};We.useEffect(()=>{l();const e=setInterval(l,6e4);return()=>clearInterval(e)},[]),We.useEffect(()=>{if(!i)return;const e=setInterval(async()=>{const e=new Date;if(6===e.getUTCHours()&&0===e.getUTCMinutes()){const t=s.crawl,i=e.toISOString().split("T")[0];t&&t.startsWith(i)||await c()}if(7===e.getUTCHours()&&0===e.getUTCMinutes()){const t=s.embed,i=e.toISOString().split("T")[0];t&&t.startsWith(i)||await d()}},6e4);return()=>clearInterval(e)},[i,s]);const c=async()=>{try{t({title:" Daily Crawl Started",description:"Fetching new/updated content..."});const i={title:`Daily Update ${(new Date).toISOString().split("T")[0]}`,text:"Automated daily content refresh",tags:["daily","auto"],source:"sitemap",url:"auto://daily-crawl",language:"it",updatedAt:(new Date).toISOString()};await vD({documents:[i],dryRun:!1}),r(e=>({...e,crawl:(new Date).toISOString()})),t({title:" Daily Crawl Complete",description:"Content updated"}),e?.("crawl")}catch(i){t({title:" Daily Crawl Failed",description:i.message,variant:"destructive"})}},d=async()=>{try{t({title:" Embed Scheduler Started",description:"Processing embedding queue..."});let i=0,a=1;for(;a>0;){const e=await yD({reembed:!1,batch:200});i+=e.embedded||0,a=e.remaining||0}r(e=>({...e,embed:(new Date).toISOString()})),t({title:" Embed Scheduler Complete",description:`Embedded ${i} chunks`}),e?.("embed")}catch(i){t({title:" Embed Scheduler Failed",description:i.message,variant:"destructive"})}},u=e=>{if(!e)return"Never";const t=new Date(e),i=new Date,a=t.getTime()-i.getTime(),s=Math.floor(a/36e5),r=Math.floor(a%36e5/6e4);return s<0?"Overdue":`${s}h ${r}m`};return se.jsxs(Wl,{children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center justify-between font-orbitron",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(bs,{className:"w-5 h-5"}),"Content Refresh Scheduler"]}),se.jsxs(mo,{onClick:()=>a(!i),variant:i?"default":"outline",size:"sm",children:[i?se.jsx(ir,{className:"w-4 h-4 mr-2"}):se.jsx(rr,{className:"w-4 h-4 mr-2"}),i?"Enabled":"Disabled"]})]}),se.jsx(Vl,{children:"Automated daily crawl (06:00 UTC) and embedding (07:00 UTC)"})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted",children:[se.jsx("span",{className:"text-sm font-semibold",children:"Status:"}),se.jsx(fc,{variant:i?"default":"secondary",children:i?" Active":" Paused"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[se.jsxs("div",{children:[se.jsx("p",{className:"text-sm font-semibold",children:"Daily Crawl (06:00 UTC)"}),se.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last: ",s.crawl?new Date(s.crawl).toLocaleString():"Never"]})]}),se.jsxs("div",{className:"text-right",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Next in:"}),se.jsx("p",{className:"text-sm font-semibold",children:u(n.crawl||"")})]})]}),se.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[se.jsxs("div",{children:[se.jsx("p",{className:"text-sm font-semibold",children:"Embed Scheduler (07:00 UTC)"}),se.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last: ",s.embed?new Date(s.embed).toLocaleString():"Never"]})]}),se.jsxs("div",{className:"text-right",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Next in:"}),se.jsx("p",{className:"text-sm font-semibold",children:u(n.embed||"")})]})]})]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsxs(mo,{onClick:c,variant:"outline",size:"sm",className:"flex-1",children:[se.jsx(ur,{className:"w-4 h-4 mr-2"}),"Trigger Crawl Now"]}),se.jsxs(mo,{onClick:d,variant:"outline",size:"sm",className:"flex-1",children:[se.jsx(ur,{className:"w-4 h-4 mr-2"}),"Trigger Embed Now"]})]})]})]})}function FD(){const[e,t]=We.useState(null),[i,a]=We.useState(!1),s=async()=>{a(!0);try{const e=await ND();t(e),Ki.success("KPIs refreshed")}catch(e){Ki.error(`Failed to load KPIs: ${e.message}`)}finally{a(!1)}};return We.useEffect(()=>{s();const e=()=>s();return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[]),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(qa,{className:"w-5 h-5"}),"Norah AI KPIs"]}),se.jsxs("div",{className:"flex gap-2",children:[se.jsx(mo,{onClick:s,disabled:i,size:"sm",children:"Refresh"}),se.jsxs(mo,{onClick:async()=>{try{await async function(){const e=await ND(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(t),a=document.createElement("a");a.href=i,a.download=`norah-kpis-${(new Date).toISOString().replace(/[:.]/g,"-")}.json`,a.click(),URL.revokeObjectURL(i)}(),Ki.success("KPIs exported as JSON")}catch(e){Ki.error(`Export failed: ${e.message}`)}},size:"sm",variant:"outline",children:[se.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Export JSON"]})]})]})}),se.jsx(Gl,{children:e?se.jsxs("div",{className:"grid gap-4",children:[se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{className:"space-y-1",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Documents"}),se.jsx(fc,{variant:"secondary",className:"text-lg",children:e.documents||0})]}),se.jsxs("div",{className:"space-y-1",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Embeddings"}),se.jsx(fc,{variant:"secondary",className:"text-lg",children:e.embeddings||0})]})]}),e.last_embed_at&&se.jsxs("div",{className:"space-y-1",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Embed"}),se.jsx("p",{className:"text-sm font-mono",children:new Date(e.last_embed_at).toLocaleString()})]}),!1===e.ok&&se.jsx("p",{className:"text-sm text-destructive",children:" Backend health check failed"})]}):se.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading KPIs..."})})]})}function OD({onComplete:e}){const[t,i]=We.useState(!1),[a,s]=We.useState(0),[r,n]=We.useState([{name:"Knowledge Base Generation",status:"pending",progress:0,message:"Waiting..."},{name:"Document Ingestion",status:"pending",progress:0,message:"Waiting..."},{name:"Vector Embedding",status:"pending",progress:0,message:"Waiting..."},{name:"Intelligence Evaluation",status:"pending",progress:0,message:"Waiting..."},{name:"Cross-Query Validation",status:"pending",progress:0,message:"Waiting..."},{name:"Final Report Generation",status:"pending",progress:0,message:"Waiting..."}]),[o,l]=We.useState(null),{setSelectedDocs:c}=CD(),d=(e,t)=>{n(i=>i.map((i,a)=>a===e?{...i,...t}:i))},u=async()=>{const e=ID,t={correct_at_1:0,correct_at_3:0,total_similarity:0,questions:[]};for(let n=0;n<e.length;n++){const i=e[n];try{const e=(await wD({q:i.query,top_k:6})).hits||[],a=e[0]?.distance||1;t.total_similarity+=a;const s=e[0]?.chunk_text?.toLowerCase().includes(i.expected_keywords[0].toLowerCase()),r=e.slice(0,3).some(e=>i.expected_keywords.some(t=>e.chunk_text?.toLowerCase().includes(t.toLowerCase())));s&&t.correct_at_1++,r&&t.correct_at_3++,t.questions.push({question:i.query,top1Match:s,top3Match:r,similarity:a})}catch(r){console.error(`Eval question ${n} failed:`,r)}}const i=t.correct_at_1/e.length,a=t.correct_at_3/e.length,s=t.total_similarity/e.length;return{pass_at_1:i,pass_at_3:a,avg_similarity:s,contextual_reasoning:Math.min(10,12*a),semantic_depth:Math.min(10,15*(1-s)),cross_module_understanding:Math.min(10,13*i),details:t.questions}},h=async()=>{const e=["Come il sistema BUZZ si sincronizza con Supabase Realtime?","Che differenza c' tra Push SAFE Guard e cron automatico?","Come Norah AI gestisce i pattern aptici nelle notifiche?","Quali regole governano il Final Shot?","Come funziona l'anti-forcing nelle missioni M1SSION?"];let t=0;for(const a of e)try{const e=await wD({q:a,top_k:3});e.hits&&e.hits.length>0&&e.hits[0].distance<.45&&t++}catch(i){console.error("Cross-query failed:",i)}return{total:e.length,successful:t,success_rate:t/e.length}},m=(e,t)=>{const i=e.kpis||{},a=e.evalResults||{},s=e.crossQueryResults||{},n=Math.min(100,(i.documents||0)/200*100),o=100*(.3*(a.pass_at_1||0)+.3*(a.pass_at_3||0)+.2*(1-(a.avg_similarity||1))+.2*(s.success_rate||0)),l=100*((a.pass_at_1||0)-.45),c=.3*n+.5*o+100*(s.success_rate||0)*.2;let d="SAME ";c>=90&&a.pass_at_1>=.65?d="SMARTER ":c<70&&(d="REGRESSION ");const u=[];return i.documents<200&&u.push("Increase knowledge base to 200 documents"),a.pass_at_1<.65&&u.push("Improve document quality and chunking strategy"),s.success_rate<.8&&u.push("Enhance cross-module semantic linking"),c>=95&&u.push(" Excellent! Consider production deployment"),{timestamp:(new Date).toISOString(),execution_time_seconds:t/1e3,steps:r,knowledge_base:{total_docs:i.documents||0,total_embeddings:i.embeddings||0,target_docs:200,completion_percentage:n},intelligence_metrics:{pass_at_1:a.pass_at_1||0,pass_at_3:a.pass_at_3||0,avg_similarity:a.avg_similarity||1,contextual_reasoning:a.contextual_reasoning||0,semantic_depth:a.semantic_depth||0,cross_module_understanding:a.cross_module_understanding||0},scheduler_status:{enabled:!1,next_crawl:"06:00 UTC",next_embed:"07:00 UTC"},cross_query_validation:{total_queries:s.total||0,successful_queries:s.successful||0,success_rate:s.success_rate||0},intelligence_gain_percentage:l,overall_performance_percentage:c,verdict:d,recommendations:u}},p=e=>{switch(e){case"success":return se.jsx(hs,{className:"w-5 h-5 text-green-500"});case"error":return se.jsx(gs,{className:"w-5 h-5 text-red-500"});case"running":return se.jsx(Hs,{className:"w-5 h-5 animate-spin text-primary"});default:return se.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-muted"})}},f=r.reduce((e,t)=>e+t.progress,0)/r.length;return se.jsxs("div",{className:"space-y-6",children:[se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{children:[se.jsxs(Zl,{className:"flex items-center gap-2 font-orbitron",children:[se.jsx(ts,{className:"w-6 h-6"})," NORAH AI 2.0 Intelligence Activation System"]}),se.jsx(Vl,{children:"Automated full-stack intelligence verification and deployment"})]}),se.jsx(mo,{onClick:async()=>{i(!0),s(Date.now());const e={};try{d(0,{status:"running",progress:10,message:"Generating M1SSION documents..."});const i=zD();e.generatedDocs=i.length,d(0,{status:"running",progress:50,message:`Generated ${i.length} documents`});const s=i.map((e,t)=>({...e,summary:e.text.substring(0,200)+"...",autoTags:e.tags||[],dedupeKey:`${e.title}-${t}`,chunks:[{idx:0,text:e.text}]}));c(s),d(0,{status:"success",progress:100,message:` ${i.length} docs generated`,data:{count:i.length}}),d(1,{status:"running",progress:10,message:"Preparing documents..."});const r=10,o=i.length;let p=0,f=0;const g=i.map(e=>({title:e.title,text:e.text,tags:e.tags,source:e.source,url:e.url}));for(let e=0;e<g.length;e+=r){const i=g.slice(e,e+r),a=Math.floor(e/r)+1,s=Math.ceil(o/r);d(1,{status:"running",progress:10+e/o*80,message:`Ingesting batch ${a}/${s} (${i.length} docs)...`}),e>0&&window.location.hostname.includes("lovable")&&await new Promise(e=>setTimeout(e,200));let l=!1,c=0;const u=2;let h=null;for(;!l&&c<=u;)try{p+=(await vD({documents:i,dryRun:!1})).inserted||0,l=!0}catch(t){if(h=t,c++,c>u){console.error(`Batch ${a} failed after ${u} retries:`,t?.message||t);let e=0;for(const t of i)try{window.location.hostname.includes("lovable")&&await new Promise(e=>setTimeout(e,120));e+=(await vD({documents:[t],dryRun:!1})).inserted||0}catch(n){console.warn(`   Doc failed (batch ${a}): ${t.title}  ${n?.message||n}`)}p+=e,0===e&&f++;break}await new Promise(e=>setTimeout(e,1e3*c))}}e.ingestResult={inserted:p,errors:f},d(1,f>0?{status:"success",progress:100,message:` ${p} docs ingested, ${f} batches failed`,data:{inserted:p,errors:f}}:{status:"success",progress:100,message:` ${p} docs ingested successfully`,data:{inserted:p}}),d(2,{status:"running",progress:10,message:"Generating embeddings..."});let x=0,b=1,v=0;for(;b>0;){v>0&&window.location.hostname.includes("lovable")&&await new Promise(e=>setTimeout(e,200));const e=await yD({batch:200,reembed:!1});x+=e.embedded||0,b=e.remaining||0,d(2,{status:"running",progress:50,message:`Embedded ${x} chunks, ${b} remaining...`}),v++}e.totalEmbedded=x,d(2,{status:"success",progress:100,message:` ${x} embeddings created`,data:{embedded:x}});const y=await ND();e.kpis=y,d(3,{status:"running",progress:10,message:"Running intelligence tests..."});const w=await u();e.evalResults=w,d(3,{status:"success",progress:100,message:` Pass@1: ${(100*w.pass_at_1).toFixed(1)}%, Pass@3: ${(100*w.pass_at_3).toFixed(1)}%`,data:w}),d(4,{status:"running",progress:10,message:"Testing cross-module queries..."});const N=await h();e.crossQueryResults=N,d(4,{status:"success",progress:100,message:` ${N.successful}/${N.total} queries successful`,data:N}),d(5,{status:"running",progress:10,message:"Generating final report..."});const j=m(e,Date.now()-a);l(j),d(5,{status:"success",progress:100,message:` Report generated: ${j.verdict}`,data:j}),Ki.success(` Norah AI 2.0 Activation Complete: ${j.verdict}`,{description:`Overall Performance: ${j.overall_performance_percentage}%`})}catch(t){const e=r.findIndex(e=>"running"===e.status);e>=0&&d(e,{status:"error",progress:0,message:` ${t.message}`}),Ki.error("Intelligence Activation Failed",{description:t.message})}finally{i(!1)}},disabled:t,size:"lg",className:"font-orbitron",children:t?se.jsxs(se.Fragment,{children:[se.jsx(Hs,{className:"w-5 h-5 mr-2 animate-spin"}),"Running..."]}):se.jsxs(se.Fragment,{children:[se.jsx(rr,{className:"w-5 h-5 mr-2"})," Start Full Activation"]})})]})}),se.jsxs(Gl,{className:"space-y-6",children:[t&&se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between text-sm",children:[se.jsx("span",{children:"Overall Progress"}),se.jsxs("span",{className:"font-semibold",children:[f.toFixed(1),"%"]})]}),se.jsx(Pc,{value:f,className:"h-2"})]}),se.jsx("div",{className:"space-y-3",children:r.map((e,t)=>se.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border",children:[se.jsx("div",{className:"mt-0.5",children:p(e.status)}),se.jsxs("div",{className:"flex-1 space-y-1",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"font-semibold text-sm",children:e.name}),se.jsx(fc,{variant:"success"===e.status?"default":"secondary",children:e.status})]}),se.jsx("p",{className:"text-xs text-muted-foreground",children:e.message}),"running"===e.status&&se.jsx(Pc,{value:e.progress,className:"h-1"})]})]},t))})]})]}),o&&se.jsxs(Wl,{className:"border-2 border-primary",children:[se.jsx(Hl,{children:se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx(Zl,{className:"font-orbitron text-2xl",children:" NORAH AI 2.0  FINAL INTELLIGENCE REPORT"}),se.jsxs(mo,{onClick:()=>{if(!o)return;const e=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=`norah-intelligence-${(new Date).toISOString().split("T")[0]}.json`,i.click(),URL.revokeObjectURL(t),Ki.success("Report exported successfully")},variant:"outline",children:[se.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Export JSON"]})]})}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{className:"text-center p-6 rounded-lg bg-primary/10",children:[se.jsx("h2",{className:"text-3xl font-orbitron font-bold mb-2",children:o.verdict}),se.jsxs("p",{className:"text-xl font-semibold text-primary",children:["Overall Performance: ",o.overall_performance_percentage.toFixed(1),"%"]}),se.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Execution Time: ",o.execution_time_seconds.toFixed(2),"s"]})]}),se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[se.jsxs("div",{className:"space-y-1 p-3 rounded-lg bg-muted",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Documents"}),se.jsx("p",{className:"text-2xl font-bold",children:o.knowledge_base.total_docs}),se.jsxs("p",{className:"text-xs text-muted-foreground",children:["Target: ",o.knowledge_base.target_docs]})]}),se.jsxs("div",{className:"space-y-1 p-3 rounded-lg bg-muted",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Embeddings"}),se.jsx("p",{className:"text-2xl font-bold",children:o.knowledge_base.total_embeddings})]}),se.jsxs("div",{className:"space-y-1 p-3 rounded-lg bg-muted",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"KB Completion"}),se.jsxs("p",{className:"text-2xl font-bold",children:[o.knowledge_base.completion_percentage.toFixed(1),"%"]})]}),se.jsxs("div",{className:"space-y-1 p-3 rounded-lg bg-muted",children:[se.jsx("p",{className:"text-xs text-muted-foreground",children:"Intelligence Gain"}),se.jsxs("p",{className:"text-2xl font-bold text-green-500",children:["+",o.intelligence_gain_percentage.toFixed(1),"%"]})]})]}),se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold mb-3",children:"Intelligence Metrics"}),se.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between text-sm",children:[se.jsx("span",{children:"Pass@1"}),se.jsxs("span",{className:"font-semibold",children:[(100*o.intelligence_metrics.pass_at_1).toFixed(1),"%"]})]}),se.jsx(Pc,{value:100*o.intelligence_metrics.pass_at_1})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between text-sm",children:[se.jsx("span",{children:"Pass@3"}),se.jsxs("span",{className:"font-semibold",children:[(100*o.intelligence_metrics.pass_at_3).toFixed(1),"%"]})]}),se.jsx(Pc,{value:100*o.intelligence_metrics.pass_at_3})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between text-sm",children:[se.jsx("span",{children:"Contextual Reasoning"}),se.jsxs("span",{className:"font-semibold",children:[o.intelligence_metrics.contextual_reasoning.toFixed(1),"/10"]})]}),se.jsx(Pc,{value:10*o.intelligence_metrics.contextual_reasoning})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between text-sm",children:[se.jsx("span",{children:"Semantic Depth"}),se.jsxs("span",{className:"font-semibold",children:[o.intelligence_metrics.semantic_depth.toFixed(1),"/10"]})]}),se.jsx(Pc,{value:10*o.intelligence_metrics.semantic_depth})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between text-sm",children:[se.jsx("span",{children:"Cross-Module Understanding"}),se.jsxs("span",{className:"font-semibold",children:[o.intelligence_metrics.cross_module_understanding.toFixed(1),"/10"]})]}),se.jsx(Pc,{value:10*o.intelligence_metrics.cross_module_understanding})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between text-sm",children:[se.jsx("span",{children:"Cross-Query Success"}),se.jsxs("span",{className:"font-semibold",children:[(100*o.cross_query_validation.success_rate).toFixed(1),"%"]})]}),se.jsx(Pc,{value:100*o.cross_query_validation.success_rate})]})]})]}),o.recommendations.length>0&&se.jsxs("div",{children:[se.jsx("h3",{className:"font-semibold mb-2",children:"Recommendations"}),se.jsx("ul",{className:"space-y-1",children:o.recommendations.map((e,t)=>se.jsxs("li",{className:"text-sm flex items-start gap-2",children:[se.jsx("span",{className:"text-primary",children:""}),se.jsx("span",{children:e})]},t))})]})]})]})]})}function DD(){const[e,t]=We.useState(null),i=async()=>{try{const e=await ND();t(e)}catch(e){console.error("Failed to load KPIs:",e)}};return We.useEffect(()=>{i()},[]),se.jsx("div",{className:"min-h-screen bg-background p-6",children:se.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-3",children:[se.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:se.jsx(ts,{className:"w-6 h-6 text-primary"})}),se.jsxs("div",{children:[se.jsx("h1",{className:"text-3xl font-orbitron font-bold bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent",children:"Norah AI 2.0"}),se.jsxs("p",{className:"text-sm text-muted-foreground font-rajdhani",children:["Baseline: ",se.jsx("code",{className:"text-xs bg-muted px-1 rounded",children:"88dfb241"}),"  KB: ",e?.documents||0," docs  ",e?.embeddings||0," emb"]})]})]}),se.jsx(fc,{variant:"outline",className:"font-mono text-xs",children:"Stable 2.0 (No 2.1)"})]}),se.jsxs(Ky,{defaultValue:"activation",className:"w-full",children:[se.jsxs(Xy,{className:"grid w-full grid-cols-7",children:[se.jsxs(Jy,{value:"activation",children:[se.jsx(Wr,{className:"w-4 h-4 mr-2"}),"Activation"]}),se.jsxs(Jy,{value:"sources",children:[se.jsx(Pr,{className:"w-4 h-4 mr-2"}),"Sources"]}),se.jsxs(Jy,{value:"ingest",children:[se.jsx(Pr,{className:"w-4 h-4 mr-2"}),"Bulk Ingest"]}),se.jsxs(Jy,{value:"eval",children:[se.jsx(Cr,{className:"w-4 h-4 mr-2"}),"Evaluation"]}),se.jsxs(Jy,{value:"scheduler",children:[se.jsx(bs,{className:"w-4 h-4 mr-2"}),"Scheduler"]}),se.jsxs(Jy,{value:"kpi",children:[se.jsx(ns,{className:"w-4 h-4 mr-2"}),"KPIs"]}),se.jsxs(Jy,{value:"legacy",children:[se.jsx(qa,{className:"w-4 h-4 mr-2"}),"E2E Tests"]})]}),se.jsx(Qy,{value:"activation",className:"space-y-4",children:se.jsx(OD,{onComplete:i})}),se.jsx(Qy,{value:"sources",className:"space-y-4",children:se.jsx(_D,{})}),se.jsx(Qy,{value:"ingest",className:"space-y-4",children:se.jsx(ED,{onComplete:i})}),se.jsx(Qy,{value:"eval",className:"space-y-4",children:se.jsx(MD,{})}),se.jsx(Qy,{value:"scheduler",className:"space-y-4",children:se.jsx(LD,{onTrigger:i})}),se.jsx(Qy,{value:"kpi",className:"space-y-4",children:se.jsx(FD,{})}),se.jsx(Qy,{value:"legacy",className:"space-y-4",children:!1})]})]})})}function RD(){const[e,t]=Ze.useState(null),[i,a]=Ze.useState(null);Ze.useEffect(()=>{ba.auth.getSession()},[]),Ze.useEffect(()=>{(async()=>{try{const{data:e,error:i}=await ba.rpc("supabase_client_health");i?(a(i.message),console.warn("[SUPABASE-DIAG] RPC error:",i)):t(e)}catch(e){a(e?.message||String(e)),console.warn("[SUPABASE-DIAG] RPC exception:",e)}})()},[]);const s={count:ga,lastInitStack:"",env:{mode:"production",dev:!1,prod:!0}};return se.jsxs("div",{style:{padding:24,fontFamily:"ui-sans-serif, system-ui",maxWidth:800},children:[se.jsx("h1",{style:{fontSize:24,fontWeight:"bold",marginBottom:16},children:" Supabase Runtime Diagnostics"}),se.jsxs("div",{style:{marginBottom:24},children:[se.jsx("h2",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"Client Instances"}),se.jsxs("p",{children:[se.jsx("strong",{children:"Count:"})," ",se.jsx("span",{style:{color:1===s.count?"#10b981":"#ef4444",fontWeight:"bold",fontSize:20},children:s.count})]}),se.jsxs("p",{style:{marginTop:4,color:"#6b7280"},children:[se.jsx("strong",{children:"Expected:"})," count === 1 (singleton pattern)"]}),s.count>1&&se.jsx("div",{style:{marginTop:12,padding:12,backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:4},children:se.jsxs("details",{children:[se.jsx("summary",{style:{cursor:"pointer",fontWeight:600},children:" Last re-initialization stack trace"}),se.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12,marginTop:8,overflow:"auto"},children:s.lastInitStack})]})})]}),se.jsxs("div",{style:{marginBottom:24},children:[se.jsx("h2",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"Environment"}),se.jsxs("ul",{style:{listStyle:"none",padding:0},children:[se.jsxs("li",{children:[se.jsx("strong",{children:"Mode:"})," ",s.env.mode]}),se.jsxs("li",{children:[se.jsx("strong",{children:"Dev:"})," ",String(s.env.dev)]}),se.jsxs("li",{children:[se.jsx("strong",{children:"Prod:"})," ",String(s.env.prod)]})]})]}),se.jsx("hr",{style:{margin:"24px 0",border:"none",borderTop:"1px solid #e5e7eb"}}),se.jsxs("div",{children:[se.jsx("h2",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"Supabase Health (RPC)"}),i?se.jsxs("div",{style:{padding:12,backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:4,color:"#991b1b"},children:[se.jsx("strong",{children:"Error:"})," ",i]}):e?se.jsx("pre",{style:{whiteSpace:"pre-wrap",backgroundColor:"#f3f4f6",padding:12,borderRadius:4,fontSize:13,overflow:"auto"},children:JSON.stringify(e,null,2)}):se.jsx("p",{style:{color:"#6b7280"},children:"Loading health metrics..."})]}),se.jsx("div",{style:{marginTop:24,padding:12,backgroundColor:"#f0fdf4",borderRadius:4},children:se.jsxs("p",{style:{fontSize:14,color:"#166534"},children:[" This page verifies that the Supabase client is a proper singleton. Navigate through the app and return here  the count should remain ",se.jsx("strong",{children:"1"}),"."]})})]})}function BD(){const[e,t]=We.useState([]),[i,a]=We.useState(!1),[s,r]=We.useState([]),[n,o]=We.useState(!1),l=async()=>{o(!0);try{const{data:{user:e}}=await ba.auth.getUser();if(!e)return;const{data:i,error:a}=await ba.from("device_tokens").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});a?(console.error(" Error loading device tokens:",a),Ki.error("Errore caricamento token")):t(i||[])}catch(e){console.error(" Error in loadDeviceTokens:",e)}finally{o(!1)}},c=async t=>{const{data:{user:i}}=await ba.auth.getUser();if(!i||0===e.length)return void Ki.error("Nessun token device registrato");a(!0);const s=` M1SSION Test ${t}`,n=`Test push notification #${t} - ${(new Date).toLocaleTimeString()}`;try{const{data:e,error:a}=await ba.functions.invoke("send-push-notification",{body:{title:s,body:n,target_user_id:i.id}}),o={testNumber:t,timestamp:(new Date).toISOString(),success:!a&&e?.success,data:e,error:a?.message,sent:e?.sent||0,total:e?.total||0};r(e=>[o,...e]),a?(console.error(` Test #${t} failed:`,a),Ki.error(`Test #${t} fallito: ${a.message}`)):Ki.success(`Test #${t} inviato: ${e.sent}/${e.total} dispositivi`)}catch(o){console.error(` Test #${t} exception:`,o),Ki.error(`Test #${t} errore di sistema`)}finally{a(!1)}};return We.useEffect(()=>{l()},[]),se.jsxs("div",{className:"mt-8 p-6 bg-gray-900 rounded-lg border border-gray-700",children:[se.jsx("h3",{className:"text-xl font-bold text-[#00D1FF] mb-4",children:" Push Notifications Debug"}),se.jsxs("div",{className:"mb-6",children:[se.jsxs("h4",{className:"font-semibold text-white mb-2",children:[" Device Tokens (",e.length,")"]}),0===e.length?se.jsx("p",{className:"text-yellow-400",children:" Nessun token registrato"}):e.map((e,t)=>se.jsxs("div",{className:"text-sm bg-gray-800 p-2 rounded mb-1",children:[se.jsx("span",{className:"text-green-400",children:""})," ",e.device_type,": ",e.token.substring(0,20),"...",se.jsxs("span",{className:"text-gray-400 ml-2",children:["(",new Date(e.created_at).toLocaleString(),")"]})]},t))]}),se.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[se.jsxs("button",{onClick:l,disabled:n,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-4 py-2 rounded",children:[n?"":""," Refresh Tokens"]}),se.jsx("button",{onClick:async()=>{try{const{data:{user:e}}=await ba.auth.getUser();if(!e)return void Ki.error("Utente non autenticato");const t=`onesignal-test-${e.id}-${Date.now()}`,{error:i}=await ba.from("device_tokens").upsert({user_id:e.id,token:t,device_type:"onesignal",device_info:{platform:"web",source:"debug_test",created:(new Date).toISOString()},is_active:!0,last_used:(new Date).toISOString(),created_at:(new Date).toISOString()},{onConflict:"user_id,device_type"});i?(console.error(" Error registering test token:",i),Ki.error("Errore registrazione token test")):(Ki.success("Token OneSignal test registrato!"),l())}catch(e){console.error(" Error in registerTestToken:",e)}},className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded",children:" Registra Token Test"}),se.jsx("button",{onClick:async()=>{try{const e=window.OneSignalUtils;if(e){const t=await e.getPlayerId(),i=await e.isSubscribed();Ki.success(`OneSignal: ${i?"Attivo":"Non attivo"} - ID: ${t}`)}else Ki.warning("OneSignal non disponibile (environment dev)")}catch(e){console.error(" Error checking OneSignal status:",e)}},className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded",children:" Check OneSignal"}),se.jsx("button",{onClick:()=>c(1),disabled:i||0===e.length,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-white px-4 py-2 rounded",children:" Test Push Singolo"})]}),se.jsx("div",{className:"grid grid-cols-1 gap-3 mb-6",children:se.jsx("button",{onClick:async()=>{if(!i){r([]);for(let e=1;e<=3;e++)await c(e),e<3&&await new Promise(e=>setTimeout(e,2e3))}},disabled:i||0===e.length,className:"bg-red-600 hover:bg-red-700 disabled:bg-gray-600 text-white px-4 py-2 rounded",children:" Run All Tests (3x Consecutive)"})}),s.length>0&&se.jsxs("div",{children:[se.jsx("h4",{className:"font-semibold text-white mb-2",children:" Test Results"}),s.map((e,t)=>se.jsxs("div",{className:"text-sm p-2 rounded mb-1 "+(e.success?"bg-green-900/30 border border-green-700":"bg-red-900/30 border border-red-700"),children:[se.jsxs("div",{className:"flex justify-between items-start",children:[se.jsxs("span",{className:e.success?"text-green-400":"text-red-400",children:[e.success?"":""," Test #",e.testNumber]}),se.jsx("span",{className:"text-gray-400 text-xs",children:new Date(e.timestamp).toLocaleTimeString()})]}),e.success?se.jsxs("div",{className:"text-gray-300 text-xs mt-1",children:["Sent: ",e.sent,"/",e.total," devices"]}):se.jsxs("div",{className:"text-red-300 text-xs mt-1",children:["Error: ",e.error]})]},t))]}),i&&se.jsx("div",{className:"text-center text-[#00D1FF] font-semibold mt-4",children:" Testing in progress..."}),se.jsxs("div",{className:"mt-6 text-xs text-gray-400 bg-gray-800 p-3 rounded",children:[se.jsxs("p",{children:[se.jsx("strong",{children:" Environment:"})," ",window.location.hostname]}),se.jsxs("p",{children:[se.jsx("strong",{children:" OneSignal:"})," ","m1ssion.eu"===window.location.hostname?"Produzione":"Disabilitato (dev)"]}),se.jsxs("p",{children:[se.jsx("strong",{children:" Status:"})," PWA pronta al 99% - Deploy su https://m1ssion.eu per test finali"]})]})]})}function UD(){const[e,t]=We.useState("M1SSION Test"),[i,a]=We.useState("Test push notification per iOS e Android"),[s,r]=We.useState(!1);return se.jsx("div",{className:"min-h-screen bg-black text-white p-4",children:se.jsxs("div",{className:"max-w-md mx-auto",children:[se.jsx("h1",{className:"text-2xl font-bold text-center mb-8 text-[#00D1FF]",children:" Push Test M1SSION"}),se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{children:[se.jsx("label",{className:"block text-sm font-medium mb-2",children:"Titolo"}),se.jsx("input",{type:"text",value:e,onChange:e=>t(e.target.value),className:"w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white",placeholder:"Titolo notifica"})]}),se.jsxs("div",{children:[se.jsx("label",{className:"block text-sm font-medium mb-2",children:"Messaggio"}),se.jsx("textarea",{value:i,onChange:e=>a(e.target.value),className:"w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white h-24",placeholder:"Testo della notifica"})]}),se.jsx("button",{onClick:async()=>{if(e&&i){r(!0);try{const{data:{user:t}}=await ba.auth.getUser();if(!t)return void Ki.error(" Devi essere loggato per testare le push");const{data:a,error:s}=await ba.functions.invoke("send-push-notification",{body:{title:e.trim(),body:i.trim(),target_user_id:t.id}});s?(console.error(" M1SSION PUSH ERROR:",s),Ki.error(` ERRORE: ${s.message}`)):a.success?Ki.success(` SUCCESSO: Notifica inviata a ${a.sent}/${a.total} dispositivi`):Ki.error(` ERRORE: ${a.message||"Invio fallito"}`)}catch(t){console.error(" M1SSION PUSH EXCEPTION:",t),Ki.error(" ERRORE: Eccezione durante invio notifica")}finally{r(!1)}}else Ki.error("Titolo e messaggio sono obbligatori")},disabled:s,className:"w-full py-3 px-6 rounded-lg font-bold "+(s?"bg-gray-600 cursor-not-allowed":"bg-[#00D1FF] hover:bg-[#00A8CC] text-black"),children:s?" Invio...":" INVIA PUSH OS-NATIVE"})]}),se.jsxs("div",{className:"mt-8 p-4 bg-gray-900 rounded-lg",children:[se.jsx("h3",{className:"font-bold mb-2",children:" Test Checklist:"}),se.jsxs("ul",{className:"text-sm space-y-1",children:[se.jsx("li",{children:" Lock screen iOS con suono e badge"}),se.jsx("li",{children:" Lock screen Android con suono"}),se.jsx("li",{children:" Notifica in /notifications in-app"}),se.jsx("li",{children:" Real-time sync immediato"})]})]}),se.jsx(BD,{})]})})}function qD(){const[e,t]=We.useState(null),[i,a]=We.useState(!1),[s,r]=We.useState(null),[n,o]=We.useState([]),l=e=>{const t=`[${(new Date).toLocaleTimeString()}] ${e}`;o(e=>[t,...e.slice(0,49)])},c=async()=>{a(!0);try{l(" Starting diagnostic scan...");const{data:{user:i}}=await ba.auth.getUser(),a=window.matchMedia("(display-mode: standalone)").matches,s="serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window;let r=[],n=null;if("serviceWorker"in navigator){r=[...await navigator.serviceWorker.getRegistrations()],n=navigator.serviceWorker.controller}let o=null;if(s)try{const e=await navigator.serviceWorker.ready;o=await e.pushManager.getSubscription()}catch(e){l(` Error getting push subscription: ${e}`)}let c=[];if(i)try{const{data:e,error:t}=await ba.from("fcm_subscriptions").select("*").eq("user_id",i.id).order("created_at",{ascending:!1});t?l(` DB query error: ${t.message}`):c=e||[]}catch(e){l(` DB error: ${e.message}`)}const d={isStandalone:a,userAgent:navigator.userAgent,platform:/iPad|iPhone|iPod/.test(navigator.userAgent)?"ios":/Android/.test(navigator.userAgent)?"android":"desktop",notificationPermission:Notification.permission,pushSupported:s,swSupported:"serviceWorker"in navigator,swRegistrations:r.map(e=>({scope:e.scope,scriptURL:e.active?.scriptURL,state:e.active?.state,installing:!!e.installing,waiting:!!e.waiting})),swController:n?{scriptURL:n.scriptURL,state:n.state}:null,currentSubscription:o?{endpoint:o.endpoint.substring(0,50)+"...",endpointType:o.endpoint.includes("fcm.googleapis.com")?"fcm":o.endpoint.includes("web.push.apple.com")?"apns":"unknown"}:null,userId:i?.id||null,isAuthenticated:!!i,fcmSubscriptions:c.map(e=>({id:e.id,token:e.token.substring(0,20)+"...",platform:e.platform,is_active:e.is_active,created_at:e.created_at})),timestamp:(new Date).toISOString()};t(d),l(" Diagnostic scan complete")}catch(e){l(` Diagnostic error: ${e.message}`),Ki.error("Errore diagnostica",{description:e.message})}finally{a(!1)}};We.useEffect(()=>{c()},[]);const d=e=>e?se.jsx(hs,{className:"w-4 h-4 text-green-500"}):se.jsx(us,{className:"w-4 h-4 text-red-500"});return e?se.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("h1",{className:"text-3xl font-bold",children:" Push Diagnostics"}),se.jsxs("div",{className:"flex gap-2",children:[se.jsxs(mo,{variant:"outline",onClick:()=>{if(!e)return;const t=JSON.stringify(e,null,2);navigator.clipboard.writeText(t),Ki.success("Diagnostica copiata negli appunti")},children:[se.jsx(ys,{className:"w-4 h-4 mr-2"}),"Copia JSON"]}),se.jsxs(mo,{onClick:c,disabled:i,children:[se.jsx(ur,{className:"w-4 h-4 mr-2 "+(i?"animate-spin":"")}),"Aggiorna"]})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Environment"})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"PWA Standalone Mode"}),d(e.isStandalone),se.jsx(fc,{variant:e.isStandalone?"default":"secondary",children:e.isStandalone?"Standalone":"Browser"})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Platform"}),se.jsxs(fc,{variant:"outline",children:["ios"===e.platform&&se.jsx(yr,{className:"w-4 h-4 mr-1"}),"android"===e.platform&&se.jsx(yr,{className:"w-4 h-4 mr-1"}),"desktop"===e.platform&&se.jsx(tr,{className:"w-4 h-4 mr-1"}),e.platform]})]}),se.jsxs("div",{className:"text-xs text-muted-foreground",children:[se.jsx("strong",{children:"UA:"})," ",e.userAgent.substring(0,100),"..."]})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Push Support"})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Service Worker Support"}),d(e.swSupported)]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Push Manager Support"}),d(e.pushSupported)]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Notification Permission"}),se.jsx(fc,{variant:"granted"===e.notificationPermission?"default":"denied"===e.notificationPermission?"destructive":"secondary",children:e.notificationPermission})]})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Service Worker"})}),se.jsxs(Gl,{children:[e.swController&&se.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[se.jsxs("div",{className:"text-sm",children:[se.jsx("strong",{children:"Controller:"})," ",e.swController.scriptURL]}),se.jsxs("div",{className:"text-sm text-muted-foreground",children:["State: ",e.swController.state]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("h4",{className:"font-medium",children:["Registrations (",e.swRegistrations.length,")"]}),e.swRegistrations.map((e,t)=>se.jsxs("div",{className:"p-2 bg-muted/50 rounded text-sm",children:[se.jsxs("div",{children:[se.jsx("strong",{children:"Scope:"})," ",e.scope]}),e.scriptURL&&se.jsxs("div",{children:[se.jsx("strong",{children:"Script:"})," ",e.scriptURL]}),se.jsxs("div",{children:[se.jsx("strong",{children:"State:"})," ",e.state]})]},t))]})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Current Push Subscription"})}),se.jsx(Gl,{children:e.currentSubscription?se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Endpoint Type"}),se.jsx(fc,{variant:"outline",children:e.currentSubscription.endpointType})]}),se.jsxs("div",{className:"text-xs text-muted-foreground",children:[se.jsx("strong",{children:"Endpoint:"})," ",e.currentSubscription.endpoint]})]}):se.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No active push subscription"})})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Authentication"})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Authenticated"}),d(e.isAuthenticated)]}),e.userId&&se.jsxs("div",{className:"text-xs text-muted-foreground",children:[se.jsx("strong",{children:"User ID:"})," ",e.userId]})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{children:[" FCM Database (",e.fcmSubscriptions.length,")"]})}),se.jsx(Gl,{children:e.fcmSubscriptions.length>0?se.jsx("div",{className:"space-y-2",children:e.fcmSubscriptions.map((e,t)=>se.jsxs("div",{className:"p-2 bg-muted/50 rounded text-sm",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:e.token}),se.jsx(fc,{variant:e.is_active?"default":"secondary",children:e.is_active?"Active":"Inactive"})]}),se.jsxs("div",{className:"text-xs text-muted-foreground",children:["Platform: ",e.platform,"  Created: ",new Date(e.created_at).toLocaleString()]})]},t))}):se.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No FCM subscriptions found"})})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Test Actions"})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs(mo,{onClick:async()=>{l(" Starting push notification test...");try{await mO(),l(" Push test SUCCESS"),Ki.success("Test push completato!"),await c()}catch(e){l(` Push test ERROR: ${e.message}`),Ki.error("Test push error",{description:e.message})}},className:"w-full",children:[se.jsx(fr,{className:"w-4 h-4 mr-2"}),"Test Complete Push Flow"]}),e.fcmSubscriptions.length>0&&se.jsxs(mo,{onClick:async()=>{if(!e?.fcmSubscriptions?.length)return void Ki.error("Nessun token FCM trovato");const t=e.fcmSubscriptions[0];l(` Testing FCM function with token ${t.token}...`);try{const{data:e,error:i}=await ba.functions.invoke("fcm-test",{body:{token:t.token.replace("...",""),title:"M1SSION FCM Test",body:"Diagnostic test from /debug/push"}});i?(l(` FCM function error: ${i.message}`),Ki.error("FCM test error",{description:i.message})):(l(` FCM function result: ${JSON.stringify(e)}`),Ki.success("FCM test inviato!"))}catch(i){l(` FCM function exception: ${i.message}`),Ki.error("FCM function error",{description:i.message})}},variant:"outline",className:"w-full",children:[se.jsx(fr,{className:"w-4 h-4 mr-2"}),"Test FCM Edge Function"]}),s&&se.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[se.jsx("h4",{className:"font-medium mb-2",children:"Test Result"}),se.jsx("pre",{className:"text-xs overflow-x-auto",children:JSON.stringify(s,null,2)})]})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Logs"})}),se.jsx(Gl,{children:se.jsxs("div",{className:"h-48 overflow-y-auto bg-black text-green-400 p-3 rounded font-mono text-xs",children:[n.map((e,t)=>se.jsx("div",{children:e},t)),0===n.length&&se.jsx("div",{className:"text-muted-foreground",children:"No logs yet..."})]})})]}),se.jsxs("div",{className:"text-xs text-muted-foreground text-center",children:["Diagnostic timestamp: ",new Date(e.timestamp).toLocaleString()]})]}):se.jsx("div",{className:"container mx-auto p-6",children:se.jsx("div",{className:"flex items-center justify-center min-h-screen",children:se.jsxs("div",{className:"text-center",children:[se.jsx(ur,{className:"w-8 h-8 animate-spin mx-auto mb-4"}),se.jsx("p",{children:"Caricamento diagnostica push..."})]})})})}function $D(){return se.jsxs("div",{className:"container mx-auto p-4 space-y-4",children:[se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:"M1SSION Push Test (Placeholder)"})}),se.jsxs(Gl,{className:"space-y-2",children:[se.jsx("p",{className:"text-sm text-muted-foreground",children:"Pagina placeholder per sbloccare la build. Usa il Push Center per i test completi."}),se.jsx(fc,{variant:"secondary",children:"Ready"})]})]}),se.jsx(mo,{onClick:()=>{try{Notification?.requestPermission?.()}catch{}},children:"Request Notification Permission"})]})}const WD=()=>{const[e,t]=We.useState(!1),[i,a]=We.useState(null);return se.jsxs("div",{className:"container mx-auto p-6",children:[se.jsxs(Wl,{className:"mb-6",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[" M1SSION RAW API DEBUG",se.jsx(fc,{variant:"destructive",children:"EMERGENCY TEST"})]})}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsx(UA,{children:se.jsx(qA,{children:"Test diretto dell'API OneSignal per verificare se il problema  nella configurazione o nell'Edge Function."})}),se.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[se.jsxs("p",{children:[se.jsx("strong",{children:" OneSignal App ID:"})," 50cb75f7-f065-4626-9a63-ce5692fa7e70"]}),se.jsxs("p",{children:[se.jsx("strong",{children:" REST API Key:"})," os_v2_app_...6fdxr7fna (configurata)"]}),se.jsxs("p",{children:[se.jsx("strong",{children:" Target:"})," https://onesignal.com/api/v1/notifications"]}),se.jsxs("p",{children:[se.jsx("strong",{children:" Audience:"})," Subscribed Users (broadcast)"]})]}),se.jsx(mo,{onClick:async()=>{t(!0),a(null);try{const e={app_id:"50cb75f7-f065-4626-9a63-ce5692fa7e70",included_segments:["Subscribed Users"],contents:{en:" DIRECT M1SSION API TEST"},headings:{en:"Test Diretto OneSignal"}},t=await fetch("https://onesignal.com/api/v1/notifications",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Basic os_v2_app_kdfxl57qmvdcngtdzzljf6t6od5lu3aqsvfuepv3ssgtn2suiajfh72u3cdgn57kni5akugzkqb5ufocgblyjt7q4vi5yy6fdxr7fna",Accept:"application/json"},body:JSON.stringify(e)}),i=await t.json();t.status,Object.fromEntries(t.headers.entries()),a({success:t.ok,status:t.status,result:i,method:"DIRECT_API_CALL",timestamp:(new Date).toISOString()}),t.ok?Ki.success(" Direct OneSignal API Success!",{description:`Notification ID: ${i.id}`}):Ki.error(" Direct OneSignal API Failed",{description:`Status: ${t.status}`})}catch(e){console.error(" Direct API Test Error:",e),a({success:!1,error:e.message,method:"DIRECT_API_CALL",timestamp:(new Date).toISOString()}),Ki.error("Direct API test failed",{description:e.message})}finally{t(!1)}},disabled:e,className:"w-full",size:"lg",variant:"destructive",children:e?" Testing Direct API...":" TEST DIRECT ONESIGNAL API"}),i&&se.jsxs("div",{className:"mt-6 p-4 border rounded-lg",children:[se.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[i.success?" SUCCESS":" FAILED",se.jsxs(fc,{variant:i.success?"default":"destructive",children:["Status: ",i.status||"ERROR"]})]}),se.jsx("div",{className:"text-xs bg-muted p-3 rounded overflow-auto",children:se.jsx("pre",{children:JSON.stringify(i,null,2)})}),se.jsxs("div",{className:"mt-4 text-sm",children:[se.jsxs("p",{children:[se.jsx("strong",{children:"Timestamp:"})," ",i.timestamp]}),se.jsxs("p",{children:[se.jsx("strong",{children:"Method:"})," ",i.method]}),i.result?.id&&se.jsxs("p",{children:[se.jsx("strong",{children:"OneSignal ID:"})," ",i.result.id]})]})]}),se.jsxs("div",{className:"text-xs text-muted-foreground border-t pt-4",children:[se.jsx("h5",{className:"font-semibold mb-2",children:" Diagnostica:"}),se.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[se.jsx("li",{children:"Se questo test funziona  Problema nell'Edge Function Supabase"}),se.jsx("li",{children:"Se questo test fallisce  Problema nella configurazione OneSignal"}),se.jsx("li",{children:"Status 400  Payload malformato"}),se.jsx("li",{children:"Status 401  API Key non valida"}),se.jsx("li",{children:"Status 429  Rate limit superato"})]})]})]})]}),se.jsx("div",{className:"text-center text-sm text-muted-foreground",children:" 2025 M1SSION  NIYVORA KFT  Joseph MUL"})]})};function HD(e){const[t,i]=We.useState({status:"idle",error:null,subscription:null,userId:null}),[a,s]=We.useState(!1),[r,n]=We.useState(null);We.useEffect(()=>{(()=>{const e=DA.isSupported();s(e),n(Notification.permission)})(),DA.getCurrent().then(e=>{e&&i(t=>({...t,subscription:e,status:"success"}))})},[]);const o=We.useCallback(async()=>{if(a){i(e=>({...e,status:"loading",error:null}));try{const t=await DA.subscribe(e);i({status:"success",error:null,subscription:t,userId:e||null})}catch(t){console.error("[WEBPUSH] hook generate  ERROR:",t),i(e=>({...e,status:"error",error:t.message||"Failed to generate push subscription"}))}}else i(e=>({...e,status:"error",error:"Web Push not supported in this browser"}))},[e,a]);return{...t,generate:o,isSupported:a,permission:r,token:t.subscription?.endpoint||null}}const ZD=()=>{const[e,t]=We.useState(!1),[i,a]=We.useState(null),[s,r]=We.useState("idle"),[n,o]=We.useState(null),{status:l,error:c,token:d,generate:u,isSupported:h,permission:m}=HD();We.useEffect(()=>{const e=window.location.search.includes("debug=true")||"true"===localStorage.getItem("fcm_debug");t(e)},[]),We.useEffect(()=>{e&&(async()=>{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistrations(),t=e.find(e=>e.active);a({registered:e.length>0,count:e.length,scope:t?.scope||"none",scriptURL:t?.active?.scriptURL||"none",state:t?.active?.state||"none"})}catch(e){a({error:e.message})}})()},[e]);return e?se.jsxs(Wl,{className:"fixed bottom-4 right-4 w-96 max-h-[80vh] overflow-y-auto z-50 bg-background/95 backdrop-blur-sm border-2 border-orange-500",children:[se.jsx(Hl,{className:"pb-2",children:se.jsxs(Zl,{className:"text-sm text-orange-500 flex items-center justify-between",children:[" M1SSION FCM Debug Panel",se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>t(!1),className:"h-6 w-6 p-0",children:""})]})}),se.jsxs(Gl,{className:"space-y-3 text-xs",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Browser Support:"}),h?se.jsxs(fc,{variant:"default",className:"bg-green-600",children:[se.jsx(hs,{className:"h-3 w-3 mr-1"}),"Supported"]}):se.jsxs(fc,{variant:"destructive",children:[se.jsx(gs,{className:"h-3 w-3 mr-1"}),"Not Supported"]})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Notification Permission:"}),se.jsx(fc,{variant:"granted"===m?"default":"denied"===m?"destructive":"secondary",className:"granted"===m?"bg-green-600":"",children:m||"default"})]}),se.jsxs("div",{className:"space-y-1",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"Service Worker:"}),i?se.jsxs(fc,{variant:i.registered?"default":"destructive",className:i.registered?"bg-green-600":"",children:[i.registered?se.jsx(hs,{className:"h-3 w-3 mr-1"}):se.jsx(gs,{className:"h-3 w-3 mr-1"}),i.registered?"Active":"None"]}):se.jsx(fc,{variant:"secondary",children:"Loading..."})]}),i&&i.registered&&se.jsxs("div",{className:"text-xs text-muted-foreground pl-2 space-y-1",children:[se.jsxs("div",{children:["Scope: ",i.scope]}),se.jsxs("div",{children:["URL: ",i.scriptURL?.split("/").pop()]}),se.jsxs("div",{children:["State: ",i.state]})]})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{children:"FCM Token:"}),se.jsxs(fc,{variant:"success"===l?"default":"error"===l?"destructive":"secondary",className:"success"===l?"bg-green-600":"",children:["loading"===l&&se.jsx(Hs,{className:"h-3 w-3 mr-1 animate-spin"}),"success"===l&&se.jsx(hs,{className:"h-3 w-3 mr-1"}),"error"===l&&se.jsx(gs,{className:"h-3 w-3 mr-1"}),l]})]}),d&&se.jsxs("div",{className:"text-xs text-muted-foreground",children:["Token: ",d.substring(0,16),"..."]}),c&&se.jsxs("div",{className:"text-xs text-red-500 bg-red-50 p-2 rounded",children:["Error: ",c]}),se.jsxs(mo,{onClick:u,disabled:"loading"===l,size:"sm",className:"w-full",children:["loading"===l?se.jsx(Hs,{className:"h-3 w-3 mr-1 animate-spin"}):"","Generate Token"]}),se.jsxs("div",{className:"border-t pt-3",children:[se.jsxs("div",{className:"flex items-center justify-between mb-2",children:[se.jsx("span",{children:"Edge Function:"}),se.jsxs(fc,{variant:"success"===s?"default":"error"===s?"destructive":"secondary",className:"success"===s?"bg-green-600":"",children:["testing"===s&&se.jsx(Hs,{className:"h-3 w-3 mr-1 animate-spin"}),"success"===s&&se.jsx(hs,{className:"h-3 w-3 mr-1"}),"error"===s&&se.jsx(gs,{className:"h-3 w-3 mr-1"}),s]})]}),n&&se.jsx("div",{className:"text-xs text-red-500 bg-red-50 p-2 rounded mb-2",children:n}),se.jsxs(mo,{onClick:async()=>{if(d){r("testing"),o(null);try{const{data:e,error:t}=await ba.functions.invoke("send-firebase-push",{body:{token:d,title:"M1SSION Debug Test",body:"Edge Function connectivity test",data:{debug:!0,timestamp:Date.now()}}});t?(r("error"),o(t.message)):r("success")}catch(e){r("error"),o(e.message||"Network error")}}},disabled:!d||"testing"===s,size:"sm",variant:"outline",className:"w-full",children:["testing"===s?se.jsx(Hs,{className:"h-3 w-3 mr-1 animate-spin"}):"","Test Push Send"]})]}),se.jsxs("div",{className:"text-xs text-muted-foreground text-center pt-2 border-t",children:["AG-X0197 Debug Mode  ",(new Date).toLocaleTimeString()]})]})]}):null};function VD(){return se.jsx(ZD,{})}function GD(){const[e,t]=We.useState(!1);return se.jsx(mo,{disabled:e,onClick:async()=>{t(!0);try{await mO()}finally{t(!1)}},children:e?"Enabling":"Enable Push"})}function YD(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(t),a=new Uint8Array(i.length);for(let s=0;s<i.length;++s)a[s]=i.charCodeAt(s);return a}function KD(){mc();const{isSupported:e,permission:t}=function(){const[e,t]=We.useState(!1),[i,a]=We.useState(!1),[s,r]=We.useState("undefined"!=typeof window?Notification.permission:"default"),n="undefined"!=typeof window&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window,o=We.useCallback(async()=>{if(!n)throw new Error("Service Worker o Push Manager non supportati");let e=await navigator.serviceWorker.getRegistration("/");return e||(e=await navigator.serviceWorker.register("/sw.js",{scope:"/"}),e.scope),await navigator.serviceWorker.ready},[n]),l=We.useCallback(async()=>{if(!n)throw new Error("Notifiche non supportate in questo browser");const e=await Notification.requestPermission();if(r(e),"granted"!==e)throw new Error("Permesso per le notifiche negato");return e},[n]),c=We.useCallback(async e=>{t(!0);try{"granted"!==s&&await l();const t=await o(),i=await t.pushManager.getSubscription();if(i){const e={endpoint:i.endpoint,keys:{p256dh:btoa(String.fromCharCode(...new Uint8Array(i.getKey("p256dh")))),auth:btoa(String.fromCharCode(...new Uint8Array(i.getKey("auth"))))}};return a(!0),e}const r=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:YD(e)});r.endpoint;const n={endpoint:r.endpoint,keys:{p256dh:btoa(String.fromCharCode(...new Uint8Array(r.getKey("p256dh")))),auth:btoa(String.fromCharCode(...new Uint8Array(r.getKey("auth"))))}};return a(!0),n}catch(i){throw console.error("[useWebPush] Subscription failed:",i),i}finally{t(!1)}},[s,l,o]),d=We.useCallback(async(e,i={})=>{t(!0);try{const t={subscription:{endpoint:e.endpoint,keys:e.keys},platform:navigator.platform||"unknown",ua:navigator.userAgent,app_version:"web-app",...i};JSON.stringify(t,null,2);const{data:a,error:s}=await ba.functions.invoke("push_subscribe",{body:t});if(s)throw console.error("[useWebPush] Save subscription error:",s),new Error(`Errore nel salvare la sottoscrizione: ${s.message}`);return a}catch(a){throw console.error("[useWebPush] Save subscription failed:",a),a}finally{t(!1)}},[]),u=We.useCallback(async e=>{t(!0);try{const t={title:e.title||"M1SSION Test",body:e.body||"Test push notification",url:e.url||"/",...e};JSON.stringify(t,null,2);const{data:i,error:a}=await ba.functions.invoke("push_send",{body:t});if(a)throw console.error("[useWebPush] Test push error:",a),new Error(`Errore nell'invio della notifica: ${a.message}`);return i}catch(i){throw console.error("[useWebPush] Test push failed:",i),i}finally{t(!1)}},[]),h=We.useCallback(async()=>{if(!n)return null;try{const e=await navigator.serviceWorker.getRegistration("/");if(!e)return null;const t=await e.pushManager.getSubscription();if(!t)return null;const i={endpoint:t.endpoint,keys:{p256dh:btoa(String.fromCharCode(...new Uint8Array(t.getKey("p256dh")))),auth:btoa(String.fromCharCode(...new Uint8Array(t.getKey("auth"))))}};return a(!0),i}catch(e){return console.error("[useWebPush] Check subscription failed:",e),null}},[n]);return{isSupported:n,isSubscribed:i,isLoading:e,permission:s,ensureServiceWorker:o,subscribe:c,saveSubscription:d,testPush:u,requestPermission:l,checkSubscription:h}}(),[i,a]=We.useState({serviceWorker:"loading",pushSupport:"loading",vapidKeys:"loading",database:"loading",edgeFunctions:"loading"}),[s,r]=We.useState(null),[n,o]=We.useState(!1),l=async()=>{o(!0);const t={...i};try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistration("/");t.serviceWorker=e?"ok":"error"}else t.serviceWorker="error";t.pushSupport=e?"ok":"error";try{const e=atob("BBjgzWK_1_PBZXGLQb-xQjSEUH5jLsNNgx8N0LgOcKUkZeCUaNV_gRE-QM5pKS2bPKUhVJLn0Q-H3BNGnOOjy8Q".replace(/-/g,"+").replace(/_/g,"/"));t.vapidKeys=65===e.length?"ok":"error"}catch{t.vapidKeys="error"}try{const{count:e,error:i}=await ba.from("push_subscriptions").select("*",{count:"exact",head:!0});i?(t.database="error",console.error("Database check failed:",i)):(t.database="ok",r(e||0))}catch(s){t.database="error",console.error("Database check failed:",s)}try{const{error:e}=await ba.functions.invoke("push_send",{body:{test:!0}});t.edgeFunctions="ok"}catch(s){t.edgeFunctions="error",console.error("Edge function check failed:",s)}}catch(s){console.error("System health check failed:",s)}a(t),o(!1)};We.useEffect(()=>{l()},[]);const c=e=>{switch(e){case"ok":return se.jsx(hs,{className:"h-4 w-4 text-green-500"});case"error":return se.jsx(gs,{className:"h-4 w-4 text-red-500"});case"loading":return se.jsx(ur,{className:"h-4 w-4 animate-spin text-yellow-500"})}},d=e=>{switch(e){case"ok":return se.jsx(fc,{variant:"secondary",children:"OK"});case"error":return se.jsx(fc,{variant:"destructive",children:"Error"});case"loading":return se.jsx(fc,{variant:"outline",children:"Loading..."})}};return se.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{children:[se.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[se.jsx(qa,{className:"h-8 w-8"}),"Push Health Dashboard"]}),se.jsx("p",{className:"text-muted-foreground mt-2",children:"Monitora e testa il sistema di notifiche push"})]}),se.jsxs(mo,{onClick:l,disabled:n,variant:"outline",children:[n?se.jsx(ur,{className:"h-4 w-4 mr-2 animate-spin"}):se.jsx(ur,{className:"h-4 w-4 mr-2"}),"Aggiorna stato"]})]}),se.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(gr,{className:"h-5 w-5"}),"Stato Sistema"]})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[c(i.serviceWorker),se.jsx("span",{className:"text-sm",children:"Service Worker"})]}),d(i.serviceWorker)]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[c(i.pushSupport),se.jsx("span",{className:"text-sm",children:"Push Support"})]}),d(i.pushSupport)]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[c(i.vapidKeys),se.jsx("span",{className:"text-sm",children:"VAPID Keys"})]}),d(i.vapidKeys)]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[c(i.database),se.jsx("span",{className:"text-sm",children:"Database"})]}),d(i.database)]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[c(i.edgeFunctions),se.jsx("span",{className:"text-sm",children:"Edge Functions"})]}),d(i.edgeFunctions)]})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(ks,{className:"h-5 w-5"}),"Statistiche Database"]})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-sm",children:"Sottoscrizioni attive:"}),se.jsx(fc,{variant:"outline",children:null!==s?s:"..."})]}),se.jsxs("div",{className:"flex items-center justify-between",children:[se.jsx("span",{className:"text-sm",children:"Permesso notifiche:"}),se.jsx(fc,{variant:"granted"===t?"secondary":"outline",children:t})]})]})]}),se.jsx("div",{className:"md:col-span-2 lg:col-span-1",children:se.jsx(GD,{})})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(Ur,{className:"h-5 w-5"}),"Riepilogo Sistema"]})}),se.jsxs(Gl,{children:[Object.values(i).every(e=>"ok"===e)?se.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[se.jsx(hs,{className:"h-5 w-5"}),se.jsx("span",{className:"font-medium",children:"Sistema completamente funzionante"})]}):Object.values(i).some(e=>"error"===e)?se.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[se.jsx(gs,{className:"h-5 w-5"}),se.jsx("span",{className:"font-medium",children:"Rilevati problemi nel sistema"})]}):se.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[se.jsx(Er,{className:"h-5 w-5"}),se.jsx("span",{className:"font-medium",children:"Controllo sistema in corso..."})]}),se.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Utilizza questo dashboard per monitorare la salute del sistema push e diagnosticare eventuali problemi."})]})]})]})}const XD=()=>{const[e,t]=We.useState(null),[i,a]=We.useState(!1),[s,r]=We.useState(!1),n=async()=>{a(!0);try{const{data:i}=await ba.from("push_subscriptions").select("endpoint, platform, endpoint_type, created_at, p256dh, auth").order("created_at",{ascending:!1}).limit(10);let a=[];if("serviceWorker"in navigator){a=(await navigator.serviceWorker.getRegistrations()).map(e=>({scriptURL:e.active?.scriptURL||"No active SW",state:e.active?.state||"No active SW",scope:e.scope}))}let s={valid:!1,length:0,error:"Not checked"};try{const e=await fetch("/vapid-public.txt"),t=await e.text();s={valid:t.length>40,length:t.length,error:t.length>40?void 0:"Key too short"}}catch(e){s.error=e instanceof Error?e.message:"Unknown error"}t({subscriptions:(i||[]).map(e=>({...e,p256dh_length:e.p256dh?.length||0,auth_length:e.auth?.length||0})),canary_results:null,service_workers:a,vapid_status:s})}catch(e){console.error("Report generation error:",e),Ki.error("Errore generazione report")}finally{a(!1)}};return We.useEffect(()=>{n()},[]),se.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[se.jsxs("div",{className:"flex justify-between items-center",children:[se.jsx("h1",{className:"text-3xl font-bold",children:" Report Push Notifications"}),se.jsxs("div",{className:"space-x-2",children:[se.jsxs(mo,{onClick:n,disabled:i,children:[i?"":""," Aggiorna Report"]}),se.jsxs(mo,{onClick:async()=>{r(!0);try{const{data:{user:e}}=await ba.auth.getUser(),{data:i,error:a}=await ba.functions.invoke("send-push-canary",{body:{user_id:e?.id,title:"M1SSION Test",body:"Test push da report diagnostico",link:"https://m1ssion.eu/push-report",broadcast:!1}});if(a)throw a;t(e=>e?{...e,canary_results:{...i,pass_rate:i.sent/(i.sent+i.failed)*100||0}}:null),Ki.success(`Test completato: ${i.sent} inviati, ${i.failed} falliti`)}catch(e){console.error("Canary test error:",e),Ki.error("Errore test canary")}finally{r(!1)}},disabled:s||!e?.subscriptions.length,children:[s?"":""," Test Canary"]})]})]}),e?se.jsxs("div",{className:"grid gap-6",children:[se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[" Status VAPID",se.jsx(fc,{variant:e.vapid_status.valid?"default":"destructive",children:e.vapid_status.valid?"Valido":"Errore"})]})}),se.jsx(Gl,{children:se.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[se.jsxs("div",{children:[se.jsx("strong",{children:"Lunghezza chiave:"})," ",e.vapid_status.length]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Status:"})," ",e.vapid_status.valid?" OK":" Errore"]}),e.vapid_status.error&&se.jsxs("div",{className:"col-span-2 text-red-400",children:[se.jsx("strong",{children:"Errore:"})," ",e.vapid_status.error]})]})})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Service Workers Registrati"})}),se.jsx(Gl,{children:0===e.service_workers.length?se.jsx("div",{className:"text-yellow-400",children:" Nessun Service Worker registrato"}):se.jsx("div",{className:"space-y-2",children:e.service_workers.map((e,t)=>se.jsxs("div",{className:"border rounded p-3 text-sm",children:[se.jsxs("div",{children:[se.jsx("strong",{children:"Script:"})," ",e.scriptURL]}),se.jsxs("div",{children:[se.jsx("strong",{children:"State:"})," ",e.state]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Scope:"})," ",e.scope]})]},t))})})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{children:[" Subscriptions (",e.subscriptions.length,")"]})}),se.jsx(Gl,{children:0===e.subscriptions.length?se.jsx("div",{className:"text-yellow-400",children:" Nessuna subscription trovata"}):se.jsx("div",{className:"space-y-3",children:e.subscriptions.map((e,t)=>se.jsxs("div",{className:"border rounded p-3 text-sm",children:[se.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[se.jsx(fc,{variant:"outline",children:e.endpoint_type}),se.jsx(fc,{variant:"outline",children:e.platform})]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Endpoint:"})," ",e.endpoint.substring(0,60),"..."]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Keys:"})," p256dh=",e.p256dh_length,"B, auth=",e.auth_length,"B",(88!==e.p256dh_length||24!==e.auth_length)&&se.jsx("span",{className:"text-red-400 ml-2",children:" Lunghezza invalida"})]}),se.jsxs("div",{children:[se.jsx("strong",{children:"Creata:"})," ",new Date(e.created_at).toLocaleDateString()]})]},t))})})]}),e.canary_results&&se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"flex items-center gap-2",children:[" Risultati Test Canary",se.jsxs(fc,{variant:e.canary_results.pass_rate>=99?"default":"destructive",children:[e.canary_results.pass_rate.toFixed(1),"%"]})]})}),se.jsxs(Gl,{children:[se.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 text-center",children:[se.jsxs("div",{className:"border rounded p-3",children:[se.jsx("div",{className:"text-2xl font-bold text-green-400",children:e.canary_results.sent}),se.jsx("div",{className:"text-sm",children:"Inviati"})]}),se.jsxs("div",{className:"border rounded p-3",children:[se.jsx("div",{className:"text-2xl font-bold text-red-400",children:e.canary_results.failed}),se.jsx("div",{className:"text-sm",children:"Falliti"})]}),se.jsxs("div",{className:"border rounded p-3",children:[se.jsx("div",{className:"text-2xl font-bold",children:e.canary_results.total_processed}),se.jsx("div",{className:"text-sm",children:"Totale"})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx("strong",{children:"Dettagli per endpoint:"}),e.canary_results.results.map((e,t)=>se.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[se.jsx(fc,{variant:"outline",children:e.endpoint_type}),se.jsx(fc,{variant:"success"===e.status?"default":"destructive",children:e.status}),e.status_code&&se.jsxs("span",{children:["HTTP ",e.status_code]}),e.error&&se.jsx("span",{className:"text-red-400",children:e.error})]},t))]})]})]}),se.jsxs(Wl,{children:[se.jsx(Hl,{children:se.jsx(Zl,{children:" Azioni Raccomandate"})}),se.jsx(Gl,{children:se.jsxs("div",{className:"space-y-2 text-sm",children:[!e.vapid_status.valid&&se.jsx("div",{className:"text-red-400",children:" Configurare correttamente le chiavi VAPID"}),0===e.service_workers.length&&se.jsx("div",{className:"text-yellow-400",children:" Registrare Service Worker"}),0===e.subscriptions.length&&se.jsx("div",{className:"text-yellow-400",children:" Creare almeno una subscription di test"}),e.canary_results&&e.canary_results.pass_rate<99&&se.jsx("div",{className:"text-red-400",children:" Investigare fallimenti nell'invio push"}),(!e.canary_results||e.canary_results.pass_rate>=99)&&e.subscriptions.length>0&&e.vapid_status.valid&&se.jsx("div",{className:"text-green-400",children:" Sistema push funzionante correttamente"})]})})]})]}):se.jsx("div",{className:"text-center py-8",children:se.jsx("div",{className:"animate-pulse",children:" Generazione report..."})})]})},JD=()=>{const[,e]=Ai(),[t,i]=We.useState(""),[a,s]=We.useState(""),[r,n]=We.useState(!1),[o,l]=We.useState(null);We.useEffect(()=>{(async()=>{const{data:{session:e}}=await ba.auth.getSession();l(e)})();const{data:{subscription:e}}=ba.auth.onAuthStateChange((e,t)=>{"PASSWORD_RECOVERY"===e&&(l(t),Ki.info("Inserisci la nuova password")),"SIGNED_IN"===e&&t&&l(t)});return()=>e.unsubscribe()},[]);return se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-black bg-gradient-to-b from-background/50 to-black",children:se.jsxs("div",{className:"max-w-md w-full p-6 mx-4",children:[se.jsxs("div",{className:"text-center mb-8",children:[se.jsx("h1",{className:"text-3xl font-bold gradient-text-cyan mb-2",children:"Reset Password"}),se.jsx("p",{className:"text-muted-foreground",children:"Inserisci la tua nuova password"})]}),o?se.jsxs("form",{onSubmit:async i=>{if(i.preventDefault(),t&&a)if(t===a)if(t.length<8)Ki.error("La password deve essere di almeno 8 caratteri");else{n(!0);try{const{error:i}=await ba.auth.updateUser({password:t});i?(console.error("Password reset error:",i),Ki.error("Errore nel reset della password: "+i.message)):(Ki.success("Password aggiornata con successo!"),setTimeout(()=>{e("/home")},2e3))}catch(s){console.error("Password reset error:",s),Ki.error("Errore imprevisto")}finally{n(!1)}}else Ki.error("Le password non corrispondono");else Ki.error("Inserisci entrambe le password")},className:"space-y-4",children:[se.jsx("div",{children:se.jsx(Sl,{type:"password",placeholder:"Nuova password",value:t,onChange:e=>i(e.target.value),className:"bg-background/20 border-white/20",required:!0,minLength:8})}),se.jsx("div",{children:se.jsx(Sl,{type:"password",placeholder:"Conferma password",value:a,onChange:e=>s(e.target.value),className:"bg-background/20 border-white/20",required:!0,minLength:8})}),se.jsx(mo,{type:"submit",className:"w-full",disabled:r,children:r?"Aggiornamento...":"Aggiorna Password"})]}):se.jsxs("div",{className:"text-center space-y-4",children:[se.jsx("p",{className:"text-muted-foreground",children:"Caricamento del link di recovery..."}),se.jsx(mo,{variant:"outline",onClick:()=>e("/login"),children:"Torna al Login"})]})]})})},QD=()=>{const[e,t]=Ai(),[i,a]=We.useState(null),[s,r]=We.useState(!0);We.useEffect(()=>{n()},[]);const n=async()=>{try{const{data:e,error:t}=await ba.from("legal_documents").select("*").eq("type","terms_of_service").eq("is_active",!0).maybeSingle();t&&"PGRST116"!==t.code&&console.error("Error loading terms document:",t),e&&a(e)}catch(e){console.error("Error loading terms document:",e)}finally{r(!1)}},o=()=>{t("/")};return s?se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-black text-white",children:se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-[#00D1FF] border-t-transparent rounded-full mx-auto mb-4"}),se.jsx("p",{children:"Caricamento documento..."})]})}):se.jsx("div",{className:"min-h-screen flex flex-col bg-black text-white p-4 pt-20",children:se.jsxs("div",{className:"container mx-auto max-w-4xl",children:[se.jsxs(mo,{variant:"outline",className:"mb-8",onClick:o,children:[se.jsx(Za,{className:"mr-2 w-4 h-4"})," Torna alla Home"]}),se.jsx("h1",{className:"text-3xl font-bold mb-6",children:i?.title||"Termini e Condizioni"}),i?se.jsx("div",{className:"space-y-6 prose prose-invert max-w-none",children:se.jsx("div",{className:"text-gray-300",dangerouslySetInnerHTML:{__html:i.content_md.replace(/\n/g,"<br />")}})}):se.jsx("div",{className:"space-y-6",children:se.jsxs("div",{className:"text-center py-12",children:[se.jsx("p",{className:"text-gray-400 text-lg mb-4",children:" Documento non disponibile"}),se.jsx("p",{className:"text-gray-500 mb-6",children:"Il documento richiesto non  attualmente disponibile."}),se.jsx(mo,{onClick:o,className:"bg-[#00D1FF] hover:bg-[#00B8E6] text-black",children:"Torna alla Home"})]})}),se.jsx("div",{className:"mt-10 mb-10 text-center",children:se.jsx(mo,{onClick:o,className:"bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink",children:"Torna alla Home"})})]})})},eR=()=>{const[e,t]=We.useState({name:"",email:"",phone:"",subject:"",message:""}),[i,a]=We.useState(!1),{toast:s}=mc(),r=i=>{t({...e,[i.target.name]:i.target.value})};return se.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black p-4 pt-20",children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsxs("div",{className:"text-center mb-12",children:[se.jsxs("h1",{className:"text-4xl font-orbitron font-bold mb-4",children:[se.jsx("span",{className:"text-[#00E5FF]",children:"Contatti"}),se.jsx("span",{className:"text-white",children:" M1SSION"})]}),se.jsx("p",{className:"text-white/70 text-lg",children:"Hai domande? Vuoi maggiori informazioni? Scrivici!"})]}),se.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[se.jsxs(Wl,{className:"bg-black/80 border-[#00D1FF]/30 backdrop-blur-xl",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-2xl font-orbitron text-white flex items-center",children:[se.jsx(Gs,{className:"w-6 h-6 mr-3 text-[#00D1FF]"}),"Informazioni di Contatto"]})}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsxs("div",{className:"flex items-start space-x-4",children:[se.jsx(Gs,{className:"w-5 h-5 text-[#00D1FF] mt-1"}),se.jsxs("div",{children:[se.jsx("h3",{className:"text-white font-medium",children:"Email"}),se.jsx("p",{className:"text-white/70",children:"info@m1ssion.app"}),se.jsx("p",{className:"text-white/70",children:"support@m1ssion.app"})]})]}),se.jsxs("div",{className:"flex items-start space-x-4",children:[se.jsx(sr,{className:"w-5 h-5 text-[#00D1FF] mt-1"}),se.jsxs("div",{children:[se.jsx("h3",{className:"text-white font-medium",children:"Telefono"}),se.jsx("p",{className:"text-white/70",children:"+39 XXX XXX XXXX"}),se.jsx("p",{className:"text-white/60 text-sm",children:"Lun-Ven 9:00-18:00"})]})]}),se.jsxs("div",{className:"flex items-start space-x-4",children:[se.jsx(Ys,{className:"w-5 h-5 text-[#00D1FF] mt-1"}),se.jsxs("div",{children:[se.jsx("h3",{className:"text-white font-medium",children:"Sede"}),se.jsx("p",{className:"text-white/70",children:"NIYVORA KFT"}),se.jsx("p",{className:"text-white/70",children:"Ungheria, EU"})]})]}),se.jsxs("div",{className:"pt-6 border-t border-white/10",children:[se.jsx("h3",{className:"text-white font-medium mb-3",children:"Team di Sviluppo"}),se.jsxs("p",{className:"text-white/70 text-sm",children:["M1SSION  sviluppato da ",se.jsx("strong",{children:"Joseph MUL"}),", CEO di NIYVORA KFT. Il team  dedicato a creare esperienze di gioco innovative e coinvolgenti."]})]})]})]}),se.jsxs(Wl,{className:"bg-black/80 border-[#00D1FF]/30 backdrop-blur-xl",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-2xl font-orbitron text-white flex items-center",children:[se.jsx(fr,{className:"w-6 h-6 mr-3 text-[#00D1FF]"}),"Invia un Messaggio"]})}),se.jsx(Gl,{children:se.jsxs("form",{onSubmit:async i=>{if(i.preventDefault(),e.name&&e.email&&e.message){a(!0);try{const{error:i}=await ba.from("contacts").insert([e]);if(i)throw i;s({title:" Messaggio inviato",description:"Ti contatteremo al pi presto. Grazie per averci scritto!"}),t({name:"",email:"",phone:"",subject:"",message:""})}catch(r){console.error("Error sending contact form:",r),s({title:" Errore invio",description:"Impossibile inviare il messaggio. Riprova pi tardi.",variant:"destructive"})}finally{a(!1)}}else s({title:"Campi obbligatori",description:"Compila nome, email e messaggio per inviare la richiesta.",variant:"destructive"})},className:"space-y-4",children:[se.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"name",className:"text-white",children:"Nome *"}),se.jsx(Sl,{id:"name",name:"name",value:e.name,onChange:r,placeholder:"Il tuo nome",className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",required:!0})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"email",className:"text-white",children:"Email *"}),se.jsx(Sl,{id:"email",name:"email",type:"email",value:e.email,onChange:r,placeholder:"tua@email.com",className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",required:!0})]})]}),se.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"phone",className:"text-white",children:"Telefono"}),se.jsx(Sl,{id:"phone",name:"phone",value:e.phone,onChange:r,placeholder:"+39 XXX XXX XXXX",className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"subject",className:"text-white",children:"Oggetto"}),se.jsx(Sl,{id:"subject",name:"subject",value:e.subject,onChange:r,placeholder:"Oggetto del messaggio",className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]})]}),se.jsxs("div",{children:[se.jsx(jl,{htmlFor:"message",className:"text-white",children:"Messaggio *"}),se.jsx(Wb,{id:"message",name:"message",value:e.message,onChange:r,placeholder:"Scrivi qui il tuo messaggio...",className:"bg-white/5 border-white/20 text-white placeholder:text-white/50 min-h-[120px]",required:!0})]}),se.jsx(mo,{type:"submit",disabled:i,className:"w-full bg-gradient-to-r from-[#00D1FF] to-[#0099CC] hover:from-[#0099CC] hover:to-[#007799] text-black font-medium",children:i?se.jsxs(se.Fragment,{children:[se.jsx("div",{className:"w-4 h-4 border-2 border-black/20 border-t-black rounded-full animate-spin mr-2"}),"Invio in corso..."]}):se.jsxs(se.Fragment,{children:[se.jsx(fr,{className:"w-4 h-4 mr-2"}),"Invia Messaggio"]})})]})})]})]}),se.jsx("div",{className:"text-center mt-12",children:se.jsxs("div",{className:"bg-[#00D1FF]/10 border border-[#00D1FF]/30 rounded-lg p-6 max-w-2xl mx-auto",children:[se.jsx("h3",{className:"text-[#00D1FF] font-medium mb-2",children:"Nota Privacy"}),se.jsx("p",{className:"text-white/70 text-sm",children:"I tuoi dati verranno trattati secondo la nostra Privacy Policy e utilizzati esclusivamente per rispondere alla tua richiesta. Non condividiamo mai i dati degli utenti con terze parti."})]})})]})})},tR=()=>{const[e,t]=Ai(),[i,a]=We.useState(null),[s,r]=We.useState(!0);We.useEffect(()=>{n()},[]);const n=async()=>{try{const{data:e,error:t}=await ba.from("legal_documents").select("*").eq("type","privacy_policy").eq("is_active",!0).maybeSingle();t&&"PGRST116"!==t.code&&console.error("Error loading privacy document:",t),e&&a(e)}catch(e){console.error("Error loading privacy document:",e)}finally{r(!1)}},o=()=>{t("/")};return s?se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-black text-white",children:se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-[#00D1FF] border-t-transparent rounded-full mx-auto mb-4"}),se.jsx("p",{children:"Caricamento documento..."})]})}):se.jsx("div",{className:"min-h-screen flex flex-col bg-black text-white p-4 pt-20",children:se.jsxs("div",{className:"container mx-auto max-w-4xl",children:[se.jsxs(mo,{variant:"outline",className:"mb-8",onClick:o,children:[se.jsx(Za,{className:"mr-2 w-4 h-4"})," Torna alla Home"]}),se.jsx("h1",{className:"text-3xl font-bold mb-6",children:i?.title||"Privacy Policy"}),i?se.jsx("div",{className:"space-y-6 prose prose-invert max-w-none",children:se.jsx("div",{className:"text-gray-300",dangerouslySetInnerHTML:{__html:i.content_md.replace(/\n/g,"<br />")}})}):se.jsx("div",{className:"space-y-6",children:se.jsxs("div",{className:"text-center py-12",children:[se.jsx("p",{className:"text-gray-400 text-lg mb-4",children:" Documento non disponibile"}),se.jsx("p",{className:"text-gray-500 mb-6",children:"Il documento richiesto non  attualmente disponibile."}),se.jsx(mo,{onClick:o,className:"bg-[#00D1FF] hover:bg-[#00B8E6] text-black",children:"Torna alla Home"})]})}),se.jsx("div",{className:"mt-10 mb-10 text-center",children:se.jsx(mo,{onClick:o,className:"bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink",children:"Torna alla Home"})})]})})},iR=()=>{const[e,t]=Ai(),[i,a]=We.useState(null),[s,r]=We.useState(!0);We.useEffect(()=>{n()},[]);const n=async()=>{try{const{data:e,error:t}=await ba.from("legal_documents").select("*").eq("type","cookie_policy").eq("is_active",!0).order("published_at",{ascending:!1}).limit(1).single();t&&"PGRST116"!==t.code&&console.error("Error loading cookie policy:",t),e&&a(e)}catch(e){console.error("Error loading cookie policy:",e)}finally{r(!1)}};return se.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#131524]/70 to-black text-white",children:se.jsx("div",{className:"container mx-auto max-w-4xl px-4 py-6",children:se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[se.jsx("div",{className:"flex items-center space-x-4 mb-8",children:se.jsxs(mo,{variant:"outline",className:"border-white/20 text-white hover:bg-white/10",onClick:()=>t("/"),children:[se.jsx(Za,{className:"mr-2 w-4 h-4"}),"Torna alla Home"]})}),se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{className:"border-b border-white/10",children:se.jsxs(Zl,{className:"flex items-center text-white font-orbitron",children:[se.jsx(vs,{className:"w-6 h-6 mr-3 text-[#00D1FF]"}),se.jsxs("div",{children:[se.jsx("h1",{className:"text-2xl",children:"Cookie Policy M1SSION"}),se.jsx("p",{className:"text-white/70 text-sm font-normal",children:"Informazioni sui cookie utilizzati nell'app"})]})]})}),se.jsxs(Gl,{className:"pt-6",children:[s?se.jsxs("div",{className:"text-center py-8",children:[se.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#00D1FF] mx-auto mb-4"}),se.jsx("p",{className:"text-white/60",children:"Caricamento..."})]}):i?se.jsx("div",{className:"prose prose-invert max-w-none",dangerouslySetInnerHTML:{__html:(o=i.content_md,o.replace(/^# (.*$)/gim,'<h1 class="text-2xl font-orbitron font-bold text-white mb-4">$1</h1>').replace(/^## (.*$)/gim,'<h2 class="text-xl font-semibold text-[#00D1FF] mb-3 mt-6">$2</h2>').replace(/^### (.*$)/gim,'<h3 class="text-lg font-semibold text-[#00D1FF] mb-3">$3</h3>').replace(/^\* (.*$)/gim,'<li class="text-white/80 mb-1">$1</li>').replace(/^\- (.*$)/gim,'<li class="text-white/80 mb-1">$1</li>').replace(/\n\n/g,'</p><p class="text-white/80 mb-4">').replace(/^(?!<[h|l|p])(.*$)/gim,'<p class="text-white/80 mb-4">$1</p>'))}}):se.jsxs("div",{className:"text-center py-8",children:[se.jsx(vs,{className:"w-12 h-12 text-[#00D1FF] mx-auto mb-4"}),se.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Cookie Policy"}),se.jsx("p",{className:"text-white/80 mb-6",children:"Questa pagina descrive l'utilizzo dei cookie nell'app M1SSION."}),se.jsxs("div",{className:"space-y-6 text-left max-w-2xl mx-auto",children:[se.jsxs("section",{children:[se.jsxs("h3",{className:"text-lg font-semibold text-[#00D1FF] mb-3 flex items-center",children:[se.jsx(Us,{className:"w-5 h-5 mr-2"}),"Cosa sono i Cookie"]}),se.jsx("p",{className:"text-white/80 mb-4",children:"I cookie sono piccoli file di testo memorizzati sul tuo dispositivo quando utilizzi la nostra app. Ci aiutano a fornire una migliore esperienza utente e a capire come viene utilizzata l'applicazione."})]}),se.jsxs("section",{children:[se.jsx("h3",{className:"text-lg font-semibold text-[#00D1FF] mb-3",children:"Tipi di Cookie utilizzati"}),se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"bg-[#00D1FF]/10 p-4 rounded-lg border border-[#00D1FF]/20",children:[se.jsx("h4",{className:"font-semibold text-white mb-2",children:" Cookie Essenziali"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Necessari per il funzionamento base dell'app. Include autenticazione, sicurezza e funzionalit core. Non possono essere disabilitati."})]}),se.jsxs("div",{className:"bg-blue-500/10 p-4 rounded-lg border border-blue-500/20",children:[se.jsx("h4",{className:"font-semibold text-white mb-2",children:" Cookie Analitici"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Ci aiutano a capire come utilizzi l'app per migliorare l'esperienza utente. Include analisi dell'utilizzo e performance."})]}),se.jsxs("div",{className:"bg-purple-500/10 p-4 rounded-lg border border-purple-500/20",children:[se.jsx("h4",{className:"font-semibold text-white mb-2",children:" Cookie di Marketing"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Utilizzati per personalizzare contenuti e comunicazioni basate sui tuoi interessi nell'app M1SSION."})]}),se.jsxs("div",{className:"bg-green-500/10 p-4 rounded-lg border border-green-500/20",children:[se.jsx("h4",{className:"font-semibold text-white mb-2",children:" Cookie di Preferenze"}),se.jsx("p",{className:"text-white/70 text-sm",children:"Ricordano le tue impostazioni e preferenze per personalizzare l'esperienza nelle sessioni future."})]})]})]}),se.jsxs("section",{children:[se.jsxs("h3",{className:"text-lg font-semibold text-[#00D1FF] mb-3 flex items-center",children:[se.jsx(xr,{className:"w-5 h-5 mr-2"}),"Gestione delle Preferenze"]}),se.jsx("p",{className:"text-white/80 mb-4",children:"Puoi gestire le tue preferenze sui cookie in qualsiasi momento dalle impostazioni dell'app o dal banner dei cookie che appare al primo accesso."}),se.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:se.jsxs(mo,{className:"bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90",onClick:()=>t("/settings"),children:[se.jsx(xr,{className:"w-4 h-4 mr-2"}),"Vai alle Impostazioni"]})})]})]})]}),i&&se.jsx("div",{className:"mt-8 pt-6 border-t border-white/10",children:se.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center text-sm text-white/60 space-y-2 sm:space-y-0",children:[se.jsxs("div",{children:[se.jsxs("p",{children:["Versione: ",i.version]}),se.jsxs("p",{children:["Ultimo aggiornamento: ",new Date(i.published_at).toLocaleDateString("it-IT")]})]}),se.jsx("div",{className:"text-right",children:se.jsx("p",{className:"font-mono text-xs",children:" 2025 Joseph MUL  M1SSION  ALL RIGHTS RESERVED  NIYVORA KFT"})})]})})]})]}),se.jsxs("div",{className:"text-center space-y-4",children:[se.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[se.jsxs(mo,{variant:"outline",className:"border-white/20 text-white hover:bg-white/10",onClick:()=>t("/privacy-policy"),children:[se.jsx(vr,{className:"w-4 h-4 mr-2"}),"Privacy Policy"]}),se.jsxs(mo,{variant:"outline",className:"border-white/20 text-white hover:bg-white/10",onClick:()=>t("/terms"),children:[se.jsx(Us,{className:"w-4 h-4 mr-2"}),"Termini di Servizio"]})]}),se.jsx(mo,{className:"bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90",onClick:()=>t("/"),children:"Torna alla Home"})]})]})})});var o};function aR(){const{goBack:e}=yl(),[t,i]=We.useState(null),[a,s]=We.useState(!0);We.useEffect(()=>{r()},[]);const r=async()=>{try{const{data:e,error:t}=await ba.from("legal_documents").select("*").eq("type","safecreative").eq("is_active",!0).single();t&&console.error("Error loading SafeCreative document:",t),i(e)}catch(e){console.error("Failed to load SafeCreative document:",e)}finally{s(!1)}},n=()=>{e()};return a?se.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0A0A0A] via-[#1A1A2E] to-[#16213E] flex items-center justify-center",children:se.jsxs("div",{className:"text-center",children:[se.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#00D1FF] mx-auto mb-4"}),se.jsx("p",{className:"text-white/60",children:"Caricamento documento SafeCreative..."})]})}):se.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0A0A0A] via-[#1A1A2E] to-[#16213E]",children:se.jsxs("div",{className:"container mx-auto px-4 py-8",children:[se.jsx("div",{className:"flex items-center justify-between mb-8",children:se.jsxs("button",{onClick:n,className:"flex items-center text-[#00D1FF] hover:text-white transition-colors",children:[se.jsx(Za,{className:"w-5 h-5 mr-2"}),"Indietro"]})}),se.jsx("div",{className:"max-w-4xl mx-auto",children:se.jsx("div",{className:"bg-black/20 backdrop-blur-sm rounded-xl border border-[#00D1FF]/20 p-8",children:t?se.jsxs(se.Fragment,{children:[se.jsx("h1",{className:"text-3xl font-bold text-white mb-2 font-orbitron",children:t.title}),se.jsxs("div",{className:"text-sm text-white/60 mb-8 flex items-center gap-4",children:[se.jsxs("span",{children:["Versione ",t.version]}),se.jsx("span",{children:""}),se.jsxs("span",{children:["Pubblicato: ",new Date(t.published_at).toLocaleDateString("it-IT")]})]}),se.jsx("div",{className:"prose prose-invert max-w-none",dangerouslySetInnerHTML:{__html:(o=t.content_md,o.replace(/^### (.+)$/gm,'<h3 class="text-lg font-semibold text-[#00D1FF] mb-3 mt-6">$1</h3>').replace(/^## (.+)$/gm,'<h2 class="text-xl font-bold text-white mb-4 mt-8">$1</h2>').replace(/^# (.+)$/gm,'<h1 class="text-2xl font-bold text-white mb-6 mt-8">$1</h1>').replace(/^\* (.+)$/gm,'<li class="text-white/80 mb-1">$1</li>').replace(/^- (.+)$/gm,'<li class="text-white/80 mb-1">$1</li>').replace(/\n\n/g,'</p><p class="text-white/80 leading-relaxed mb-4">').replace(/^(.+)$/gm,'<p class="text-white/80 leading-relaxed mb-4">$1</p>').replace(/<li[^>]*>.*<\/li>/gs,e=>`<ul class="list-disc list-inside space-y-1 ml-4 mb-4">${e}</ul>`).replace(/<\/ul><ul[^>]*>/g,""))}})]}):se.jsxs("div",{className:"text-center py-12",children:[se.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Documento non trovato"}),se.jsx("p",{className:"text-white/60 mb-6",children:"Il documento SafeCreative non  attualmente disponibile."}),se.jsxs("button",{onClick:n,className:"inline-flex items-center px-6 py-3 bg-[#00D1FF]/20 text-[#00D1FF] \n                           rounded-lg hover:bg-[#00D1FF]/30 transition-colors",children:[se.jsx(Za,{className:"w-4 h-4 mr-2"}),"Torna indietro"]})]})})})]})});var o}const sR=()=>{const{navigate:e}=yl(),[t,i]=We.useState(null),[a,s]=We.useState(!0);We.useEffect(()=>{r()},[]);const r=async()=>{try{const{data:e,error:t}=await ba.from("legal_documents").select("*").eq("type","game_rules").eq("is_active",!0).single();if(t)return void console.error("Error loading game rules:",t);i(e)}catch(e){console.error("Error loading game rules:",e)}finally{s(!1)}};return se.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0B1426] via-[#1a1d3a] to-[#0B1426] p-4",children:se.jsxs("div",{className:"max-w-4xl mx-auto",children:[se.jsxs("div",{className:"flex items-center mb-6",children:[se.jsxs(mo,{onClick:()=>e("/settings/legal"),variant:"ghost",size:"sm",className:"mr-4 text-white/70 hover:text-white hover:bg-white/10",children:[se.jsx(Za,{className:"w-4 h-4 mr-2"}),"Indietro"]}),se.jsx("h1",{className:"text-2xl font-orbitron font-bold text-white",children:"Regolamento M1SSION"})]}),se.jsx(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{children:se.jsxs(Zl,{className:"text-white font-orbitron flex items-center",children:[se.jsx(Ps,{className:"w-6 h-6 mr-3 text-[#00D1FF]"}),a?"Caricamento...":t?.title||"Regolamento del Gioco"]})}),se.jsx(Gl,{className:"space-y-6",children:a?se.jsxs("div",{className:"flex items-center justify-center py-12",children:[se.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-[#00D1FF] border-t-transparent"}),se.jsx("span",{className:"ml-3 text-white/70",children:"Caricamento documento..."})]}):t?se.jsxs(se.Fragment,{children:[se.jsx("div",{className:"prose prose-invert max-w-none text-white/80 leading-relaxed",dangerouslySetInnerHTML:{__html:(n=t.content_md,n.replace(/\*\*(.*?)\*\*/g,'<strong class="text-white font-semibold">$1</strong>').replace(/^### (.*$)/gim,'<h3 class="text-lg font-semibold text-[#00D1FF] mt-4 mb-2">$1</h3>').replace(/^## (.*$)/gim,'<h2 class="text-xl font-bold text-[#00D1FF] mt-6 mb-3">$1</h2>').replace(/^# (.*$)/gim,'<h1 class="text-2xl font-bold text-white mb-4">$1</h1>').replace(/^- (.*$)/gim,'<li class="text-white/80 ml-4 mb-1"> $1</li>').replace(/^\d+\. (.*$)/gim,'<li class="text-white/80 ml-4 mb-1 list-decimal">$1</li>').replace(/\n/g,"<br>"))}}),se.jsx("div",{className:"mt-8 pt-6 border-t border-white/10",children:se.jsxs("div",{className:"flex flex-wrap gap-6 text-sm text-white/60",children:[se.jsxs("div",{className:"flex items-center",children:[se.jsx(as,{className:"w-4 h-4 mr-2"}),"Versione: ",t.version]}),se.jsxs("div",{className:"flex items-center",children:[se.jsx(as,{className:"w-4 h-4 mr-2"}),"Pubblicato: ",new Date(t.published_at).toLocaleDateString("it-IT")]}),se.jsxs("div",{className:"flex items-center",children:[se.jsx(Gs,{className:"w-4 h-4 mr-2"}),"Contatti: legal@m1ssion.com"]})]})})]}):se.jsxs("div",{className:"text-center py-12",children:[se.jsx(Ps,{className:"w-16 h-16 mx-auto mb-4 text-white/30"}),se.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Documento non disponibile"}),se.jsx("p",{className:"text-white/60 mb-6",children:"Il regolamento del gioco non  attualmente disponibile."}),se.jsx(mo,{onClick:r,variant:"outline",className:"border-[#00D1FF]/50 text-[#00D1FF] hover:bg-[#00D1FF]/10",children:"Riprova"})]})})]})}),se.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 justify-center",children:[se.jsx(mo,{onClick:()=>e("/privacy-policy"),variant:"ghost",size:"sm",className:"text-[#00D1FF] hover:bg-[#00D1FF]/10",children:"Privacy Policy"}),se.jsx(mo,{onClick:()=>e("/terms"),variant:"ghost",size:"sm",className:"text-[#00D1FF] hover:bg-[#00D1FF]/10",children:"Termini di Servizio"}),se.jsx(mo,{onClick:()=>e("/cookie-policy"),variant:"ghost",size:"sm",className:"text-[#00D1FF] hover:bg-[#00D1FF]/10",children:"Cookie Policy"}),se.jsx(mo,{onClick:()=>e("/"),variant:"outline",size:"sm",className:"border-[#00D1FF]/50 text-[#00D1FF] hover:bg-[#00D1FF]/10",children:"Torna alla Home"})]})]})});var n},rR=()=>{const{navigate:e}=yl(),[t,i]=We.useState(0),[a,s]=We.useState(null),r=We.useCallback(()=>{i(e=>e+1),a&&clearTimeout(a);const r=setTimeout(()=>{t+1>=2&&(localStorage.removeItem("developer_access"),window.location.reload()),i(0)},300);s(r),t<1&&e("/")},[e,t,a]);return se.jsxs("button",{onClick:r,className:"flex items-center font-orbitron text-xl md:text-2xl font-bold transition-opacity hover:opacity-80","aria-label":"Go to homepage",style:{cursor:"pointer"},children:[se.jsx("span",{className:"text-[#00E5FF]",style:{textShadow:"0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"},children:"M1"}),se.jsxs("span",{className:"text-white",children:["SSION",se.jsx("span",{className:"text-xs align-top",children:""})]})]})},nR=({planName:e,planPrice:t,planFeatures:i})=>{const[a,s]=We.useState(!1),[r,n]=We.useState(!1),[o,l]=We.useState({number:"",expiry:"",cvc:"",name:""}),{toast:c}=mc(),{navigate:d}=yl();return r?se.jsxs(et.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center py-8",children:[se.jsx(hs,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),se.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Pagamento Completato!"}),se.jsxs("p",{className:"text-white/60",children:["Piano ",e," attivato correttamente"]}),se.jsx("p",{className:"text-sm text-white/40 mt-2",children:"Reindirizzamento in corso..."})]}):se.jsxs(Wl,{className:"bg-white/5 border-white/20",children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2 text-white",children:[se.jsx(js,{className:"h-5 w-5"}),"Dettagli di Pagamento"]}),se.jsxs(Vl,{className:"text-white/60",children:["Completa il pagamento per attivare il piano ",e]})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[se.jsxs("h3",{className:"font-semibold text-white mb-2",children:["Piano Selezionato: ",e]}),se.jsxs("p",{className:"text-2xl font-bold text-primary mb-2",children:[t,"/mese"]}),se.jsx("ul",{className:"space-y-1",children:i.map((e,t)=>se.jsxs("li",{className:"flex items-center gap-2 text-sm text-white/80",children:[se.jsx(hs,{className:"h-3 w-3 text-green-500"}),e]},t))})]}),se.jsxs("div",{className:"space-y-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"cardNumber",className:"text-white",children:"Numero Carta"}),se.jsx(Sl,{id:"cardNumber",placeholder:"1234 5678 9012 3456",value:o.number,onChange:e=>l(t=>({...t,number:e.target.value})),className:"bg-white/5 border-white/20 text-white"})]}),se.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"expiry",className:"text-white",children:"Scadenza"}),se.jsx(Sl,{id:"expiry",placeholder:"MM/AA",value:o.expiry,onChange:e=>l(t=>({...t,expiry:e.target.value})),className:"bg-white/5 border-white/20 text-white"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"cvc",className:"text-white",children:"CVC"}),se.jsx(Sl,{id:"cvc",placeholder:"123",value:o.cvc,onChange:e=>l(t=>({...t,cvc:e.target.value})),className:"bg-white/5 border-white/20 text-white"})]})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsx(jl,{htmlFor:"cardName",className:"text-white",children:"Nome sul Titolare"}),se.jsx(Sl,{id:"cardName",placeholder:"Mario Rossi",value:o.name,onChange:e=>l(t=>({...t,name:e.target.value})),className:"bg-white/5 border-white/20 text-white"})]})]}),se.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/20 rounded-lg",children:[se.jsx(Zs,{className:"h-4 w-4 text-green-500"}),se.jsx("p",{className:"text-xs text-green-400",children:"Pagamento sicuro protetto da crittografia SSL"})]}),se.jsx(mo,{onClick:async()=>{s(!0);try{const{data:{user:a}}=await ba.auth.getUser();if(!a)throw new Error("User not authenticated");await new Promise(e=>setTimeout(e,2e3)),await ba.from("subscriptions").upsert({user_id:a.id,tier:e,status:"active",start_date:(new Date).toISOString(),end_date:new Date(Date.now()+31536e6).toISOString(),provider:"stripe",updated_at:(new Date).toISOString()});const{getPriceEur:r,getPriceCents:o}=await ae(async()=>{const{getPriceEur:e,getPriceCents:t}=await Promise.resolve().then(()=>bz);return{getPriceEur:e,getPriceCents:t}},void 0);await ba.from("payment_transactions").insert({user_id:a.id,amount:o(e)||0,currency:"EUR",description:`Upgrade to ${e} plan`,status:"success",provider:"stripe"});const l={plan:e,price:t,activatedAt:(new Date).toISOString(),features:i};localStorage.setItem("active_subscription",JSON.stringify(l)),localStorage.setItem("subscription_plan",e),window.dispatchEvent(new Event("storage")),s(!1),n(!0),c({title:" Upgrade completato con successo!",description:`Piano ${e} attivato con successo.`}),setTimeout(()=>{d("/profile")},2e3)}catch(a){console.error("Payment error:",a),s(!1),c({title:" Errore durante l'upgrade. Riprova.",description:"Si  verificato un errore durante il processo di pagamento.",variant:"destructive"})}},disabled:a||!o.number||!o.expiry||!o.cvc||!o.name,className:"w-full bg-primary hover:bg-primary/90 h-12",children:a?se.jsx(et.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full"}):`Procedi con il pagamento - ${t}/mese`}),se.jsx("p",{className:"text-xs text-white/40 text-center",children:"Questo  un pagamento simulato per scopi dimostrativi"})]})]})},oR=()=>{const e=gt(),t=["Tutti i vantaggi Base","3 indizi premium aggiuntivi a settimana","Accesso anticipato di 2 ore agli eventi","Badge Silver nel profilo"];return se.jsxs("div",{className:"bg-gradient-to-b from-[#131524]/70 to-black w-full",style:{height:"100dvh",overflow:"hidden",position:"relative"},children:[se.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",style:{height:"72px",paddingTop:"env(safe-area-inset-top, 47px)",background:"rgba(19, 21, 33, 0.55)",backdropFilter:"blur(12px)"},children:se.jsx(ad,{leftComponent:se.jsx(rR,{})})}),se.jsx(et.main,{className:"text-white",style:{paddingTop:"calc(72px + env(safe-area-inset-top, 47px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px))",height:"100dvh",overflowY:"auto",position:"relative",zIndex:0},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:se.jsx("div",{className:"glass-card mx-2 sm:mx-4 mt-4 mb-4",children:se.jsxs("div",{className:"p-3 sm:p-6",children:[se.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>e("/subscriptions"),className:"p-2 hover:bg-white/10",children:se.jsx(Za,{className:"h-5 w-5"})}),se.jsx("h1",{className:"text-xl font-semibold",children:"Piano Silver"})]}),se.jsxs("div",{className:"text-center mb-8",children:[se.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[se.jsx(jr,{className:"h-8 w-8 text-silver"}),se.jsx("h2",{className:"text-3xl font-bold text-white",children:"M1SSION Silver"})]}),se.jsx("p",{className:"text-4xl font-bold text-primary mb-2",children:xz("Silver")}),se.jsx("p",{className:"text-white/60",children:"al mese"})]}),se.jsxs("div",{className:"mb-8",children:[se.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Cosa include:"}),se.jsx("div",{className:"space-y-3",children:t.map((e,t)=>se.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg",children:[se.jsx(jr,{className:"h-4 w-4 text-silver"}),se.jsx("span",{className:"text-white",children:e})]},t))})]}),se.jsx(nR,{planName:"Silver",planPrice:xz("Silver"),planFeatures:t})]})})})]})},lR=()=>{const e=gt(),t=["Tutti i vantaggi Silver","4 indizi premium aggiuntivi a settimana","Accesso anticipato di 12 ore agli eventi","Partecipazione alle estrazioni Gold","Badge Gold esclusivo nel profilo"];return se.jsxs("div",{className:"bg-gradient-to-b from-[#131524]/70 to-black w-full",style:{height:"100dvh",overflow:"hidden",position:"relative"},children:[se.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",style:{height:"72px",paddingTop:"env(safe-area-inset-top, 47px)",background:"rgba(19, 21, 33, 0.55)",backdropFilter:"blur(12px)"},children:se.jsx(ad,{leftComponent:se.jsx(rR,{})})}),se.jsx(et.main,{className:"text-white",style:{paddingTop:"calc(72px + env(safe-area-inset-top, 47px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px))",height:"100dvh",overflowY:"auto",position:"relative",zIndex:0},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:se.jsx("div",{className:"glass-card mx-2 sm:mx-4 mt-4 mb-4",children:se.jsxs("div",{className:"p-3 sm:p-6",children:[se.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>e("/subscriptions"),className:"p-2 hover:bg-white/10",children:se.jsx(Za,{className:"h-5 w-5"})}),se.jsx("h1",{className:"text-xl font-semibold",children:"Piano Gold"}),se.jsx(fc,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Pi Popolare"})]}),se.jsxs("div",{className:"text-center mb-8",children:[se.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[se.jsx(_s,{className:"h-8 w-8 text-yellow-400"}),se.jsx("h2",{className:"text-3xl font-bold text-white",children:"M1SSION Gold"})]}),se.jsx("p",{className:"text-4xl font-bold text-primary mb-2",children:xz("Gold")}),se.jsx("p",{className:"text-white/60",children:"al mese"}),se.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-yellow-500/20 border border-yellow-500/30 rounded-full",children:[se.jsx(jr,{className:"h-4 w-4 text-yellow-400"}),se.jsx("span",{className:"text-yellow-400 font-medium",children:"Piano consigliato"})]})]}),se.jsxs("div",{className:"mb-8",children:[se.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Cosa include:"}),se.jsx("div",{className:"space-y-3",children:t.map((e,t)=>se.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg border border-yellow-500/20",children:[se.jsx(_s,{className:"h-4 w-4 text-yellow-400"}),se.jsx("span",{className:"text-white",children:e})]},t))})]}),se.jsx(nR,{planName:"Gold",planPrice:xz("Gold"),planFeatures:t})]})})})]})},cR=()=>{const e=gt(),t=["Tutti i vantaggi Gold","Accesso VIP anticipato di 24 ore agli eventi","5 indizi premium aggiuntivi a settimana","Badge Black esclusivo"];return se.jsxs("div",{className:"bg-gradient-to-b from-[#131524]/70 to-black w-full",style:{height:"100dvh",overflow:"hidden",position:"relative"},children:[se.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",style:{height:"72px",paddingTop:"env(safe-area-inset-top, 47px)",background:"rgba(19, 21, 33, 0.55)",backdropFilter:"blur(12px)"},children:se.jsx(ad,{leftComponent:se.jsx(rR,{})})}),se.jsx(et.main,{className:"text-white",style:{paddingTop:"calc(72px + env(safe-area-inset-top, 47px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px))",height:"100dvh",overflowY:"auto",position:"relative",zIndex:0},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:se.jsx("div",{className:"glass-card mx-2 sm:mx-4 mt-4 mb-4 border-2 border-purple-500/30",children:se.jsxs("div",{className:"p-3 sm:p-6",children:[se.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>e("/subscriptions"),className:"p-2 hover:bg-white/10",children:se.jsx(Za,{className:"h-5 w-5"})}),se.jsx("h1",{className:"text-xl font-semibold",children:"Piano Black"}),se.jsx(fc,{className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:"Premium"})]}),se.jsxs("div",{className:"text-center mb-8",children:[se.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[se.jsx(Wr,{className:"h-8 w-8 text-purple-400"}),se.jsx("h2",{className:"text-3xl font-bold text-white",children:"M1SSION Black"})]}),se.jsx("p",{className:"text-4xl font-bold text-primary mb-2",children:xz("Black")}),se.jsx("p",{className:"text-white/60",children:"al mese"}),se.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-purple-500/20 border border-purple-500/30 rounded-full",children:[se.jsx(_s,{className:"h-4 w-4 text-purple-400"}),se.jsx("span",{className:"text-purple-400 font-medium",children:"Esperienza VIP Completa"})]})]}),se.jsxs("div",{className:"mb-8",children:[se.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Cosa include:"}),se.jsx("div",{className:"space-y-3",children:t.map((e,t)=>se.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-500/10 rounded-lg border border-purple-500/20",children:[se.jsx(Wr,{className:"h-4 w-4 text-purple-400"}),se.jsx("span",{className:"text-white",children:e})]},t))})]}),se.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-lg",children:se.jsx("p",{className:"text-center text-white font-medium",children:" Accesso esclusivo alle missioni pi segrete di M1SSION"})}),se.jsx(nR,{planName:"Black",planPrice:xz("Black"),planFeatures:t})]})})})]})},dR=()=>{const e=gt(),t=["Tutti i vantaggi Black","7 indizi premium aggiuntivi a settimana","Accesso VIP anticipato di 48 ore agli eventi","Supporto prioritario dedicato (24/7)","Eventi esclusivi M1SSION","Badge Titanium esclusivo"];return se.jsxs("div",{className:"bg-gradient-to-b from-[#131524]/70 to-black w-full",style:{height:"100dvh",overflow:"hidden",position:"relative"},children:[se.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",style:{height:"72px",paddingTop:"env(safe-area-inset-top, 47px)",background:"rgba(19, 21, 33, 0.55)",backdropFilter:"blur(12px)"},children:se.jsx(ad,{leftComponent:se.jsx(rR,{})})}),se.jsx(et.main,{className:"text-white",style:{paddingTop:"calc(72px + env(safe-area-inset-top, 47px))",paddingBottom:"calc(80px + env(safe-area-inset-bottom, 34px))",height:"100dvh",overflowY:"auto",position:"relative",zIndex:0},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:se.jsx("div",{className:"glass-card mx-2 sm:mx-4 mt-4 mb-4 border-2 border-cyan-500/30",children:se.jsxs("div",{className:"p-3 sm:p-6",children:[se.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>e("/subscriptions"),className:"p-2 hover:bg-white/10",children:se.jsx(Za,{className:"h-5 w-5"})}),se.jsx("h1",{className:"text-xl font-semibold",children:"Piano Titanium"}),se.jsx(fc,{className:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30",children:"Ultimate"})]}),se.jsxs("div",{className:"text-center mb-8",children:[se.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[se.jsx(Bs,{className:"h-8 w-8 text-cyan-400"}),se.jsx("h2",{className:"text-3xl font-bold text-white",children:"M1SSION Titanium"})]}),se.jsx("p",{className:"text-4xl font-bold text-primary mb-2",children:xz("Titanium")}),se.jsx("p",{className:"text-white/60",children:"al mese"}),se.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-cyan-500/20 border border-cyan-500/30 rounded-full",children:[se.jsx(_s,{className:"h-4 w-4 text-cyan-400"}),se.jsx("span",{className:"text-cyan-400 font-medium",children:"Esperienza Ultimate Completa"})]})]}),se.jsxs("div",{className:"mb-8",children:[se.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Cosa include:"}),se.jsx("div",{className:"space-y-3",children:t.map((e,t)=>se.jsxs("div",{className:"flex items-center gap-3 p-3 bg-cyan-500/10 rounded-lg border border-cyan-500/20",children:[se.jsx(Bs,{className:"h-4 w-4 text-cyan-400"}),se.jsx("span",{className:"text-white",children:e})]},t))})]}),se.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 border border-cyan-500/30 rounded-lg",children:se.jsx("p",{className:"text-center text-white font-medium",children:" Accesso supremo alle funzionalit pi avanzate di M1SSION"})}),se.jsx(nR,{planName:"Titanium",planPrice:xz("Titanium"),planFeatures:t})]})})})]})},uR=[{id:"free",name:"Free (Base)",price:"0",icon:se.jsx(vr,{className:"w-8 h-8"}),earlyAccess:"Accesso quando disponibile",features:["1 indizio a settimana","Accesso alle missioni quando attive","Badge Base nel profilo","Partecipazione al gioco"],color:"from-gray-500 to-gray-700",free:!0},{id:"Silver",name:"Silver",price:"3.99",icon:se.jsx(vr,{className:"w-8 h-8"}),earlyAccess:"2 ore prima",features:["Tutti i vantaggi Base","3 indizi premium aggiuntivi a settimana","Accesso anticipato di 2 ore agli eventi","Badge Silver nel profilo"],color:"from-slate-400 to-slate-600"},{id:"Gold",name:"Gold",price:"6.99",icon:se.jsx(_s,{className:"w-8 h-8"}),earlyAccess:"12 ore prima",features:["Tutti i vantaggi Silver","4 indizi premium aggiuntivi a settimana","Accesso anticipato di 12 ore agli eventi","Partecipazione alle estrazioni Gold","Badge Gold esclusivo nel profilo"],popular:!0,color:"from-yellow-400 to-yellow-600"},{id:"Black",name:"Black",price:"9.99",icon:se.jsx(Wr,{className:"w-8 h-8"}),earlyAccess:"24 ore prima",features:["Tutti i vantaggi Gold","Accesso VIP anticipato di 24 ore agli eventi","5 indizi premium aggiuntivi a settimana","Badge Black esclusivo"],color:"from-gray-800 to-black"},{id:"Titanium",name:"Titanium",price:"29.99",icon:se.jsx(jr,{className:"w-8 h-8"}),earlyAccess:"48 ore prima",features:["Tutti i vantaggi Black","5 indizi premium aggiuntivi a settimana","Accesso VIP anticipato di 48 ore agli eventi","Supporto prioritario dedicato (24/7)","Eventi esclusivi M1SSION","Badge Titanium esclusivo"],premium:!0,color:"from-purple-400 to-purple-600"}],hR=()=>{const[,e]=Ai(),[t,i]=We.useState(""),[a,s]=We.useState(!1),[r,n]=We.useState(!1),{getCurrentUser:o}=bl();We.useEffect(()=>{(async()=>{try{await ba.rpc("mark_choose_plan_seen")}catch(e){console.warn("Error marking plan as seen:",e)}})()},[]);const{processSubscription:l,showCheckout:c,paymentConfig:d,closeCheckout:u,handlePaymentSuccess:h}=jw(),m=async t=>{if(!a){if("free"===t)return(async()=>{if(!r){n(!0);try{const{data:i,error:a}=await ba.rpc("create_free_subscription");if(console.warn("[FREE][rpc] create_free_subscription ->",{data:i,error:a}),a&&!/23505|unique|duplicate|already/i.test(a.message))return Ki.error("Errore temporaneo, riprova"),void n(!1);try{await ba.rpc("mark_choose_plan_seen")}catch(t){console.warn("[FREE] mark_choose_plan_seen error (ignoring):",t)}e("/home")}catch(fB){console.warn("[FREE] unexpected",fB),Ki.error("Errore temporaneo, riprova"),n(!1)}}})();s(!0),i(t);try{const{data:{user:e}}=await ba.auth.getUser();e&&await ba.from("profiles").update({subscription_plan:t}).eq("id",e.id),await l(t),Ki.success("Checkout aperto - completa il pagamento")}catch(o){console.error(" Errore durante selezione piano:",o),Ki.error("Errore durante la selezione del piano"),s(!1),i("")}}};return se.jsxs("div",{className:"min-h-screen bg-black text-white p-4",children:[se.jsxs(et.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-6xl mx-auto",children:[se.jsxs("div",{className:"text-center mb-12",children:[se.jsxs("h1",{className:"plans-title",children:["Scegli il tuo Piano ",se.jsx("span",{className:"brand-m1",children:"M1"}),se.jsx("span",{className:"brand-ss",children:"SSION"})]}),se.jsx("p",{className:"text-xl text-gray-300",children:"Seleziona il piano di abbonamento per accedere alla missione"})]}),se.jsx("div",{className:"plans-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 max-w-6xl mx-auto",children:uR.map(e=>se.jsx(et.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*uR.indexOf(e)},className:"relative",children:se.jsxs(Wl,{className:`plan-card ${e.popular?"gold":""} ${e.premium?"titanium":""} ${e.free?"free":""} bg-gray-900 border-gray-700 h-full ${e.popular?"border-yellow-500 border-2":e.premium?"border-purple-500 border-2":""}`,children:[e.popular&&se.jsx("div",{className:"ribbon",children:"Pi Popolare"}),e.premium&&se.jsx("div",{className:"ribbon",children:"Premium"}),se.jsxs(Hl,{className:"text-center",children:[se.jsx("div",{className:`w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r ${e.color} flex items-center justify-center text-white`,children:e.icon}),se.jsx(Zl,{className:"text-2xl text-white",children:e.name}),se.jsx(Vl,{className:"text-gray-400",children:e.earlyAccess}),se.jsxs("div",{className:"text-3xl font-bold text-white",children:["",e.price,se.jsx("span",{className:"text-sm text-gray-400",children:"/mese"})]})]}),se.jsxs(Gl,{className:"space-y-3",children:[e.features.map((e,t)=>se.jsxs("div",{className:"flex items-center text-gray-300",children:[se.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-3"}),e]},t)),se.jsx(mo,{onClick:()=>m(e.id),disabled:a||"free"===e.id&&r,"data-testid":"free"===e.id?"cta-free":void 0,className:`w-full mt-6 free-cta ${t===e.id||"free"===e.id&&r?"opacity-50":""} ${e.free?"bg-gray-600 hover:bg-gray-700 text-white":e.popular?"bg-yellow-500 hover:bg-yellow-600 text-black":e.premium?"bg-purple-500 hover:bg-purple-600":"bg-white text-black hover:bg-gray-200"}`,children:"free"===e.id&&r?"Attivazione":t===e.id?"Elaborazione...":e.free?"Inizia Gratis":"Seleziona Piano"})]})]})},e.id))}),se.jsxs("div",{className:"text-center text-gray-400",children:[se.jsx("p",{className:"mb-4",children:"Tutti i piani includono accesso completo al gioco e indizi in base al piano di abbonamento scelto"}),se.jsx("p",{className:"text-sm",children:"Puoi cancellare o modificare il tuo piano in qualsiasi momento"})]})]}),c&&d&&se.jsx(eN,{config:d,onSuccess:t=>{h(t),s(!1),i(""),setTimeout(()=>{e("/subscription-verify")},500)},onCancel:()=>{u(),s(!1),i("")}})]})},mR=()=>{const[,e]=Ai(),[t,i]=We.useState("verifying"),[a,s]=We.useState(0),[r,n]=We.useState(""),o=async()=>{try{const{data:t,error:r}=await ba.auth.getUser();if(r||!t.user)throw new Error("Utente non autenticato");t.user.id;const{data:l,error:c}=await ba.from("profiles").select("subscription_plan, subscription_tier, tier").eq("id",t.user.id).single();if(c)throw console.error(" M1SSION VERIFY: Profile fetch error",c),new Error("Errore nel caricamento del profilo");const d=["SILVER","GOLD","BLACK","TITANIUM"],u=l.subscription_plan||l.subscription_tier||l.tier;if(d.includes(u))return i("success"),void setTimeout(()=>{e("/panel-access")},1500);const h=a+1;s(h),h>=5?(console.warn(" M1SSION VERIFY: Max attempts reached, showing error"),i("error"),n("Errore di sincronizzazione. Il tuo abbonamento potrebbe richiedere alcuni minuti per essere attivato.")):setTimeout(()=>{o()},2e3)}catch(t){console.error(" M1SSION VERIFY: Verification failed",t),i("error"),n(t instanceof Error?t.message:"Errore di connessione")}};return We.useEffect(()=>{const e=setTimeout(()=>{o()},2e3);return()=>clearTimeout(e)},[]),se.jsxs("div",{className:"min-h-screen bg-black text-white flex flex-col items-center justify-center p-4 relative overflow-hidden",children:[se.jsxs("div",{className:"absolute inset-0 opacity-20",children:[se.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-purple-500 rounded-full filter blur-3xl animate-pulse"}),se.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-48 h-48 bg-blue-500 rounded-full filter blur-3xl animate-pulse delay-1000"})]}),se.jsxs(et.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"relative z-10 text-center max-w-md mx-auto",children:[se.jsx(et.h1,{className:"text-4xl md:text-6xl font-bold mb-8 bg-gradient-to-r from-yellow-400 to-red-500 bg-clip-text text-transparent",initial:{y:-20},animate:{y:0},transition:{delay:.2},children:"M1SSION"}),"verifying"===t&&se.jsxs(et.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[se.jsx("div",{className:"relative",children:se.jsxs("div",{className:"w-16 h-16 mx-auto mb-4",children:[se.jsx("div",{className:"absolute inset-0 border-4 border-purple-500/30 rounded-full"}),se.jsx(et.div,{className:"absolute inset-0 border-4 border-transparent border-t-purple-500 rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})]})}),se.jsx(et.h2,{className:"text-2xl font-bold text-white mb-4",animate:{opacity:[1,.5,1]},transition:{duration:1.5,repeat:1/0},children:"Verifica in corso..."}),se.jsx("p",{className:"text-gray-300 text-lg",children:"Sincronizzazione abbonamento con sistema M1SSION"}),se.jsxs("div",{className:"text-sm text-gray-400",children:["Tentativo ",a+1," di 5"]})]}),"success"===t&&se.jsxs(et.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"space-y-6",children:[se.jsx(et.div,{className:"w-16 h-16 mx-auto mb-4 bg-green-500 rounded-full flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.6},children:se.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:se.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),se.jsx("h2",{className:"text-2xl font-bold text-green-400 mb-4",children:" Abbonamento Verificato!"}),se.jsx("p",{className:"text-gray-300",children:"Accesso premium attivato. Reindirizzamento in corso..."})]}),"error"===t&&se.jsxs(et.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[se.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-500 rounded-full flex items-center justify-center",children:se.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:se.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.232 15c-.77.833.192 2.5 1.732 2.5z"})})}),se.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:" Errore di Sincronizzazione"}),se.jsx("p",{className:"text-gray-300 mb-6",children:r||"Errore nella verifica dell'abbonamento. Riprova tra qualche istante."}),se.jsxs("div",{className:"space-y-4",children:[se.jsx(mo,{onClick:()=>{i("verifying"),s(0),n(""),o()},className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300",children:" Riprova Verifica"}),se.jsx(mo,{onClick:()=>e("/choose-plan"),variant:"outline",className:"w-full border-gray-600 text-gray-300 hover:bg-gray-800",children:"Torna alla Selezione Piano"})]})]}),se.jsx(et.div,{className:"mt-12 text-gray-500 text-xs",initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:se.jsx("p",{children:" 2025 Joseph MUL  M1SSION  ALL RIGHTS RESERVED  NIYVORA KFT"})})]})]})},pR=()=>{const[e,t]=We.useState(0),[i,a]=We.useState(""),[s,r]=We.useState(!1),[n,o]=We.useState(!1),{navigate:l}=yl(),{getCurrentUser:c}=bl();We.useEffect(()=>{const e=c();"wikus77@hotmail.it"!==e?.email||l("/home")},[c,l]);const d=["M","M1","M1S","M1SS","M1SSI","M1SSIO","M1SSION","M1SSION"];return We.useEffect(()=>{let e,t;return t=setTimeout(()=>{let t=0;e=setInterval(()=>{t<d.length?(a(d[t]),t++,t===d.length&&(clearInterval(e),setTimeout(()=>{r(!0),setTimeout(()=>{o(!0),setTimeout(()=>{sessionStorage.setItem("hasSeenPostLoginIntro","true"),l("/home")},1500)},1e3)},500))):clearInterval(e)},175)},300),()=>{clearTimeout(t),e&&clearInterval(e)}},[l]),se.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center overflow-hidden",children:se.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[se.jsxs(et.div,{initial:{opacity:0},animate:{opacity:1},className:"text-7xl md:text-8xl lg:text-9xl font-orbitron tracking-wider",style:{fontWeight:"normal",fontFamily:"Orbitron, monospace",position:"absolute",top:"35%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap",zIndex:50,textAlign:"center"},children:[se.jsx("span",{className:"text-[#00D1FF]",style:{textShadow:"0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"},children:i.slice(0,2)}),se.jsx("span",{className:"text-white",style:{textShadow:"0 0 5px rgba(255, 255, 255, 0.3)"},children:i.slice(2)})]}),se.jsx(tt,{children:s&&se.jsx(et.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:-30},transition:{duration:.8,ease:"easeOut"},className:"text-xl md:text-2xl lg:text-3xl font-orbitron tracking-widest",style:{fontWeight:"normal",color:"#BFA342",position:"absolute",top:"52%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap",zIndex:40,textShadow:"0 0 8px rgba(191, 163, 66, 0.4)",textAlign:"center"},children:"IT IS POSSIBLE"})}),se.jsx(tt,{children:n&&se.jsx(et.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"text-base md:text-lg lg:text-xl font-orbitron tracking-wider",style:{fontWeight:"normal",color:"#FFD700",position:"absolute",top:"65%",left:"50%",transform:"translate(-50%, -50%)",whiteSpace:"nowrap",zIndex:30,textShadow:"0 0 6px rgba(255, 215, 0, 0.4)",textAlign:"center"},children:"Inizio: 19-06-25"})})]})})};function fR(){return se.jsx("div",{className:"fixed inset-0 w-full h-full bg-black overflow-hidden z-50",children:se.jsx(pR,{})})}function gR(){const[e,t]=We.useState([]),{status:i,error:a,token:s,generate:r,isSupported:n,permission:o}=HD("web-test"),l=e=>t(t=>[...t,e]);We.useEffect(()=>{"loading"===i?(l(" Inizializzazione FCM..."),l(" Carico Firebase v8 compat SDK..."),l(" Registro Service Worker /firebase-messaging-sw.js..."),l(" Richiedo permessi notifiche..."),l(" Genero token con VAPID (22/08)...")):"success"===i&&s?(l(" FCM configurato con successo!"),l(` Token: ${s.substring(0,20)}...`),l(" Token salvato su Supabase"),l(" M1SSION FCM Ready!")):"error"===i&&a&&l(` Errore FCM: ${a}`)},[i,a,s]),We.useEffect(()=>{l(" M1SSION FCM Test - Build 22/08/2025"),l(" Browser Support: "+(n?"":"")),l(` Permissions: ${o||"non richiesti"}`),s&&l(` Token cached: ${s.substring(0,20)}...`)},[n,o,s]);return se.jsxs("main",{style:{padding:24},children:[se.jsx("h1",{children:" M1SSION  Test Push (isolato)"}),se.jsx("p",{children:"Questa pagina serve SOLO per attivare le push senza toccare la tua UI."}),se.jsx("button",{onClick:async()=>{t([]),await r()},children:"Attiva e salva token"}),se.jsx("pre",{style:{marginTop:16,background:"#111",color:"#0f0",padding:16,borderRadius:8},children:e.join("\n")})]})}const xR=Ze.lazy(()=>ae(()=>import("./MarkersHealthcheck.AImpxiSB.js"),__vite__mapDeps([12,3,2,5,1,7,6,8,9]))),bR=Ze.lazy(()=>ae(()=>import("./PushDebug.CJZhcf47.js"),__vite__mapDeps([13,5,3,2,1,7,6,8,9]))),vR=()=>{const{isAuthenticated:e,isLoading:t,getCurrentUser:i}=bl(),[a,s]=Ai(),[r,n]=We.useState(null),[o,l]=We.useState(!1);!function(){const[,e]=Ai();We.useEffect(()=>{try{const t=new URLSearchParams(window.location.search),i=t.get("qr")?.trim();if(!i)return;e("/map");const a=new URL(window.location.href);a.searchParams.delete("qr"),window.history.replaceState({},document.title,a.toString())}catch(fB){console.warn("[useQueryQRRedirect] redirect error",fB)}},[e])}(),We.useEffect(()=>{!async function(){if(!e||t)return void n(null);const r=i();if(!r?.id)return void n(!1);l(!0);const o=setTimeout(()=>{console.warn("[BOOT] Subscription check timeout - proceeding with fail-open"),n(!1),l(!1)},3e3);try{const e=await vl(ba,r.id);clearTimeout(o),n(e.hasActive);const{data:t}=await ba.from("profiles").select("role, choose_plan_seen").eq("id",r.id).single();if(!["admin","owner"].some(e=>t?.role?.toLowerCase?.().includes(e))&&!e.hasActive&&!t?.choose_plan_seen&&"/"===a)return void s("/choose-plan");const i=["/","/login","/mission-intro","/subscription-verify"];if("free"===e.plan&&i.includes(a))return void s("/home")}catch(c){console.error("[BOOT] Subscription check error - failing open:",c),clearTimeout(o),n(!1)}finally{l(!1)}}()},[e,t,i,a,s]);"undefined"!=typeof window&&("capacitor:"===window.location.protocol||window.location.hostname);return window.location.pathname,(new Date).toISOString(),window.location.pathname,se.jsx(an,{children:se.jsx(Fl,{children:se.jsxs(Li,{children:[se.jsx(Pi,{path:"/",children:t?se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:se.jsxs("div",{className:"text-center space-y-4",children:[se.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),se.jsx("p",{className:"text-muted-foreground font-orbitron",children:"Inizializzazione M1SSION..."})]})}):e?se.jsx(Tl,{children:se.jsxs(od,{children:[se.jsx(_y,{}),o&&se.jsx("div",{className:"fixed top-4 right-4 bg-background/80 backdrop-blur-sm border rounded-lg p-2",children:se.jsx("div",{className:"text-xs text-muted-foreground",children:"Verifica piano..."})})]})}):(()=>{try{return!localStorage.getItem("m1_first_visit_seen")?(localStorage.setItem("m1_first_visit_seen","1"),se.jsx(qb,{})):se.jsx(Il,{})}catch(e){return console.error("[BOOT] Landing page error, showing login:",e),se.jsx(Il,{})}})()}),se.jsx(Pi,{path:"/home",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(_y,{})})})}),se.jsx(Pi,{path:"/map",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(fw,{})})})}),se.jsx(Pi,{path:"/buzz",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(sN,{})})})}),se.jsx(Pi,{path:"/intelligence",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(SS,{})})})}),se.jsx(Pi,{path:"/intelligence/rag",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(kS,{})})})}),se.jsx(Pi,{path:"/intelligence/answer-test",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(CS,{})})})}),se.jsx(Pi,{path:"/norah-assistant",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(uk,{})})})}),se.jsx(Pi,{path:"/intelligence/coordinates",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsxs("div",{className:"min-h-screen w-full overflow-hidden",children:[se.jsx(ev,{title:"Coordinate Selector"}),se.jsx(Hb,{})]})})})}),se.jsx(Pi,{path:"/intelligence/clue-journal",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsxs("div",{className:"min-h-screen w-full overflow-hidden",children:[se.jsx(ev,{title:"Clue Journal"}),se.jsx(Zb,{})]})})})}),se.jsx(Pi,{path:"/intelligence/archive",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsxs("div",{className:"min-h-screen w-full overflow-hidden",children:[se.jsx(ev,{title:"Archivio Indizi"}),se.jsx(Vb,{})]})})})}),se.jsx(Pi,{path:"/intelligence/radar",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsxs("div",{className:"min-h-screen w-full overflow-hidden",children:[se.jsx(ev,{title:"Geo Radar"}),se.jsx(Gb,{})]})})})}),se.jsx(Pi,{path:"/intelligence/interceptor",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsxs("div",{className:"min-h-screen w-full overflow-hidden",children:[se.jsx(ev,{title:"BUZZ Interceptor"}),se.jsx(Yb,{})]})})})}),se.jsx(Pi,{path:"/intelligence/final-shot",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsxs("div",{className:"min-h-screen w-full overflow-hidden",children:[se.jsx(ev,{title:"Final Shot"}),se.jsx(Qb,{})]})})})}),se.jsx(Pi,{path:"/intelligence/rag",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(kS,{})})})}),se.jsx(Pi,{path:"/leaderboard",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(AS,{})})})}),se.jsx(Pi,{path:"/notifications",children:se.jsx(od,{children:se.jsx(BS,{})})}),se.jsx(Pi,{path:"/profile",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(QS,{})})})}),se.jsx(Pi,{path:"/settings",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(fk,{})})})}),se.jsx(Pi,{path:"/settings/agent-profile",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(jk,{})})})}),se.jsx(Pi,{path:"/settings/profile",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(jk,{})})})}),se.jsx(Pi,{path:"/settings/security",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(oC,{})})})}),se.jsx(Pi,{path:"/settings/mission",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(lC,{})})})}),se.jsx(Pi,{path:"/settings/notifications",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(iz,{})})})}),se.jsx(Pi,{path:"/settings/privacy",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(az,{})})})}),se.jsx(Pi,{path:"/settings/legal",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(sz,{})})})}),se.jsx(Pi,{path:"/settings/app-info",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(dz,{})})})}),se.jsx(Pi,{path:"/settings/info",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(dz,{})})})}),se.jsx(Pi,{path:"/settings/diagnostics",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(uz,{})})})}),se.jsx(Pi,{path:"/settings/privacy-permissions",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(hz,{})})})}),se.jsx(Pi,{path:"/subscriptions",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(Nz,{})})})}),se.jsx(Pi,{path:"/subscriptions/silver",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(oR,{})})})}),se.jsx(Pi,{path:"/subscriptions/gold",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(lR,{})})})}),se.jsx(Pi,{path:"/subscriptions/black",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(cR,{})})})}),se.jsx(Pi,{path:"/subscriptions/titanium",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(dR,{})})})}),se.jsx(Pi,{path:"/admin/send-notification",children:se.jsx(Tl,{children:se.jsx(Cz,{})})}),se.jsx(Pi,{path:"/admin/mission-panel",children:se.jsx(Tl,{children:se.jsx(zz,{})})}),se.jsx(Pi,{path:"/panel/push",children:se.jsx(Tl,{children:se.jsx(Rz,{})})}),se.jsx(Pi,{path:"/panel/push-sender",children:se.jsx(Tl,{children:se.jsx($z,{})})}),se.jsx(Pi,{path:"/panel/push-admin",children:se.jsx(Tl,{children:se.jsx(Ze.Suspense,{fallback:se.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}),children:Ze.createElement(Ze.lazy(()=>ae(()=>Promise.resolve().then(()=>Bz),void 0)))})})}),se.jsx(Pi,{path:"/panel/push",children:se.jsx(Tl,{children:se.jsx(Ze.Suspense,{fallback:se.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}),children:Ze.createElement(Ze.lazy(()=>ae(()=>import("./UserPushConsolePage.CZXH3ZPh.js"),__vite__mapDeps([14,3,2,5,1,7,6,8,9]))))})})}),se.jsx(Pi,{path:"/dev/markers-healthcheck",children:se.jsx(Tl,{children:se.jsx(Ze.Suspense,{fallback:se.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}),children:se.jsx(xR,{})})})}),se.jsx(Pi,{path:"/push-test",children:se.jsx(Fz,{})}),se.jsx(Pi,{path:"/unified-push-test",children:se.jsx(od,{children:se.jsx(Fz,{})})}),se.jsx(Pi,{path:"/push-health",children:se.jsx(od,{children:se.jsx(KD,{})})}),se.jsx(Pi,{path:"/notification-debug",children:se.jsx(od,{children:se.jsx(Wz,{})})}),se.jsx(Pi,{path:"/debug/pushtest",children:se.jsx(UD,{})}),se.jsx(Pi,{path:"/debug/push",children:se.jsx(od,{children:se.jsx(qD,{})})}),se.jsx(Pi,{path:"/push-debug",children:se.jsx(od,{children:se.jsx(bR,{})})}),se.jsx(Pi,{path:"/push-report",children:se.jsx(od,{children:se.jsx(XD,{})})}),se.jsx(Pi,{path:"/debug/m1ssion-push-test",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx($D,{})})})}),se.jsx(Pi,{path:"/debug/raw-test",children:se.jsx(od,{children:se.jsx(WD,{})})}),se.jsx(Pi,{path:"/raw-test",children:se.jsx(WD,{})}),se.jsx(Pi,{path:"/panel-access",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(KO,{})})})}),se.jsx(Pi,{path:"/panel-users",children:se.jsx(Tl,{children:se.jsx(nD,{})})}),se.jsx(Pi,{path:"/panel/bulk-marker-drop",children:se.jsx(Tl,{children:se.jsx(oD,{})})}),se.jsx(Pi,{path:"/panel/norah",children:se.jsx(Tl,{children:se.jsx(DD,{})})}),se.jsx(Pi,{path:"/diag-supabase",children:se.jsx(Tl,{children:se.jsx(RD,{})})}),se.jsx(Pi,{path:"/panel/push-control",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(KO,{})})})}),se.jsx(Pi,{path:"/panel/push-preflight",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(KO,{})})})}),se.jsx(Pi,{path:"/push-diagnosi",children:se.jsx(Tl,{children:se.jsx(XO,{})})}),se.jsx(Pi,{path:"/firebase-notification-debug",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(VD,{})})})}),se.jsx(Pi,{path:"/push-debug",children:se.jsx(Tl,{children:se.jsx(od,{children:se.jsx(bR,{})})})}),se.jsx(Pi,{path:"/fcm-test",children:se.jsx(gR,{})}),se.jsx(Pi,{path:"/android-push-test",children:se.jsx(Tl,{children:se.jsx(od,{children:Ze.createElement(Ze.lazy(()=>ae(()=>import("./android-push-test.DXQYT0Bp.js"),__vite__mapDeps([15,3,2,5,1,7,6,8,9]))))})})}),se.jsx(Pi,{path:"/native-push-test",children:se.jsx(Tl,{children:se.jsx(od,{children:Ze.createElement(Ze.lazy(()=>ae(()=>import("./native-push-test.DnGsTR6A.js"),__vite__mapDeps([16,3,2,5,1,7,6,8,9]))))})})}),se.jsx(Pi,{path:"/terms",children:se.jsx(od,{children:se.jsx(QD,{})})}),se.jsx(Pi,{path:"/privacy-policy",children:se.jsx(od,{children:se.jsx(tR,{})})}),se.jsx(Pi,{path:"/cookie-policy",children:se.jsx(od,{children:se.jsx(iR,{})})}),se.jsx(Pi,{path:"/safecreative",children:se.jsx(od,{children:se.jsx(aR,{})})}),se.jsx(Pi,{path:"/game-rules",children:se.jsx(od,{children:se.jsx(sR,{})})}),se.jsx(Pi,{path:"/contact",children:se.jsx(od,{children:se.jsx(eR,{})})}),se.jsx(Pi,{path:"/billing-smoke-test",children:Ze.createElement(Ze.lazy(()=>ae(()=>import("./BillingSmokeTest.52W_56D0.js"),__vite__mapDeps([17,3,2,5,1,7,6,8,9]))))}),se.jsx(Pi,{path:"/dev-stripe-setup",children:Ze.createElement(Ze.lazy(()=>ae(()=>import("./DevStripeKeysSetup.1TJZ-9aC.js"),__vite__mapDeps([18,3,2,5,1,7,6,8,9]))))}),se.jsx(Pi,{path:"/choose-plan",children:e?se.jsx(od,{children:se.jsx(hR,{})}):se.jsx(Il,{})}),se.jsx(Pi,{path:"/subscription-verify",children:e?se.jsx(mR,{}):se.jsx(Il,{})}),se.jsx(Pi,{path:"/mission-intro",children:se.jsx(fR,{})}),se.jsx(Pi,{path:"/login",component:Il}),se.jsx(Pi,{path:"/register",component:kz}),se.jsx(Pi,{path:"/auth/reset",component:JD}),se.jsx(Pi,{children:se.jsx(od,{children:se.jsx("div",{className:"min-h-screen flex items-center justify-center",children:se.jsxs("div",{className:"text-center",children:[se.jsx("h1",{className:"text-2xl font-bold mb-4",children:"404 - Pagina non trovata"}),se.jsx("button",{onClick:()=>window.location.href="/home",children:"Torna alla Home"})]})})})})]})})})},yR=({children:e})=>(We.useEffect(()=>{(()=>{const e={serviceWorker:"serviceWorker"in navigator,webPush:"PushManager"in window,notifications:"Notification"in window,localStorage:"undefined"!=typeof Storage};return Object.values(e).every(Boolean)})()?((...e)=>{e[0]?.includes("CRITICAL")||e[0]?.includes("SECURITY")})(" M1SSION Production Ready - By Joseph Mul / NIYVORA KFT"):console.warn(" Production readiness check failed")},[]),se.jsx(se.Fragment,{children:e})),wR=({children:e})=>(We.useEffect(()=>{{window.__M1_NO_SHIM_DUMP__=!0,window.__M1_PROD_MODE__=!0;const e=()=>{const e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.textContent||"";return t.includes("Stripe Shim Globale")||t.includes("window.getStripe")||t.includes("STRIPE_PK")||t.includes("stripeFallback")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),t=[];let i;for(;i=e.nextNode();)t.push(i);t.forEach(e=>{const t=e.parentNode;if(t&&t.nodeType===Node.ELEMENT_NODE){const i=t;i.textContent?.includes("Stripe Shim Globale")?i.style.display="none":t.removeChild(e)}})};e();const t=new MutationObserver(()=>{e()});return t.observe(document.body,{childList:!0,subtree:!0,characterData:!0}),()=>t.disconnect()}},[]),se.jsx(se.Fragment,{children:e})),NR=()=>{const[e,t]=We.useState(null),[i,a]=We.useState(!1),[s,r]=We.useState(!1),[n,o]=We.useState(!1);We.useEffect(()=>{const e=/iPad|iPhone|iPod/.test(navigator.userAgent);r(e);const i=window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone;o(i);const s=e=>{e.preventDefault(),t(e),i||a(!0)};if(window.addEventListener("beforeinstallprompt",s),e&&!i){const e=setTimeout(()=>{localStorage.getItem("ios-install-dismissed")||a(!0)},3e3);return()=>clearTimeout(e)}return()=>{window.removeEventListener("beforeinstallprompt",s)}},[]);return n||!i?null:se.jsx("div",{className:"fixed bottom-20 left-4 right-4 z-50 animate-fade-in",children:se.jsx("div",{className:"glass-card p-4 border border-primary/20",children:se.jsxs("div",{className:"flex items-start gap-3",children:[se.jsx("div",{className:"flex-shrink-0",children:se.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink flex items-center justify-center",children:se.jsx(yr,{className:"w-5 h-5 text-white"})})}),se.jsxs("div",{className:"flex-1 min-w-0",children:[se.jsx("h3",{className:"font-semibold text-white text-sm mb-1",children:"Installa M1SSION"}),s?se.jsxs("p",{className:"text-xs text-gray-300 mb-3",children:["Tocca ",se.jsx("span",{className:"inline-block w-4 h-4 mx-1 align-middle",children:se.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:se.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),' in Safari, poi "Aggiungi alla schermata Home"']}):se.jsx("p",{className:"text-xs text-gray-300 mb-3",children:"Installa l'app per un'esperienza ottimale"}),se.jsxs("div",{className:"flex gap-2",children:[!s&&e&&se.jsxs(mo,{onClick:async()=>{if(e){e.prompt();const{outcome:i}=await e.userChoice;"accepted"===i&&(t(null),a(!1))}},size:"sm",className:"flex-1 bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink text-white",children:[se.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Installa"]}),se.jsx(mo,{onClick:()=>{a(!1),s&&localStorage.setItem("ios-install-dismissed","true")},variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white",children:se.jsx($r,{className:"w-4 h-4"})})]})]})]})})})},jR=({show:e=!1,onPermissionGranted:t,onPermissionDenied:i})=>{const[a,s]=We.useState(!1),[r,n]=We.useState("default"),[o,l]=We.useState(!1),[c,d]=We.useState(!1),{logPermissionRequested:u,logPermissionGranted:h,logPermissionDenied:m}=(()=>{const{user:e}=$l(),t=We.useCallback(async t=>{try{const{eventType:i,token:a,platform:s,deviceInfo:r,success:n=!0,errorMessage:o}=t,l={userAgent:navigator.userAgent,isIOS:/iPad|iPhone|iPod/.test(navigator.userAgent),isPWA:!0===window.navigator.standalone,hostname:window.location.hostname,protocol:window.location.protocol,timestamp:(new Date).toISOString(),...r},{error:c}=await ba.from("push_notifications_log").insert({user_id:e?.id||null,event_type:i,token:a?.substring(0,50)||null,platform:s||(l.isIOS?"ios_pwa":"web_pwa"),device_info:l,success:n,error_message:o});c&&console.error(" Push log error:",c);const{error:d}=await ba.from("admin_logs").insert({event_type:`push_${i}`,user_id:e?.id||null,note:`M1SSION Push: ${i}`,context:"push_notifications",details:{token:a?.substring(0,20)+"..."||null,platform:s,success:n,errorMessage:o,deviceInfo:l}});d&&console.error(" Admin log error:",d)}catch(i){console.error(" M1SSION: Push logging failed:",i)}},[e]),i=We.useCallback((e,i)=>t({eventType:"token_registered",token:e,platform:i,success:!0}),[t]),a=We.useCallback((e,i)=>t({eventType:"token_registration_failed",platform:i,success:!1,errorMessage:e}),[t]),s=We.useCallback(e=>t({eventType:"permission_requested",platform:e,success:!0}),[t]),r=We.useCallback(e=>t({eventType:"permission_granted",platform:e,success:!0}),[t]),n=We.useCallback(e=>t({eventType:"permission_denied",platform:e,success:!1}),[t]),o=We.useCallback(e=>t({eventType:"initialization_success",platform:e,success:!0}),[t]),l=We.useCallback((e,i)=>t({eventType:"initialization_failed",platform:i,success:!1,errorMessage:e}),[t]);return{logPushEvent:t,logTokenRegistered:i,logTokenRegistrationFailed:a,logPermissionRequested:s,logPermissionGranted:r,logPermissionDenied:n,logInitializationSuccess:o,logInitializationFailed:l}})(),p=/iPad|iPhone|iPod/.test(navigator.userAgent),f=!0===window.navigator.standalone,g=/iPad|iPhone|iPod/.test(navigator.userAgent)&&/Safari/.test(navigator.userAgent)&&!/CriOS/.test(navigator.userAgent),x=We.useCallback(()=>e||p&&f&&"default"===r&&!c&&"undefined"!=typeof window&&"Notification"in window,[e,p,f,r,c]);We.useEffect(()=>{if("undefined"!=typeof window){"Notification"in window&&n(Notification.permission);const e=setTimeout(()=>{s(x())},200);return()=>clearTimeout(e)}},[x]);const b=We.useCallback(async()=>{if(!o&&!c){if("1"===localStorage.getItem("push:disable"))return console.warn("[IOS-PERM] Emergency disable flag active"),void s(!1);l(!0),d(!0);try{let a;if(await u(p?"ios_pwa":"web_pwa"),p&&f&&g)if(window.M1SSIONOneSignalDebug)try{a=await window.M1SSIONOneSignalDebug.forceRequestPermission()?"granted":"denied"}catch(e){console.warn(" M1SSION: OneSignal permission failed, using native API"),a=await Notification.requestPermission()}else a=await Notification.requestPermission();else a=await Notification.requestPermission();n(a),"granted"===a?(await h(p?"ios_pwa":"web_pwa"),Ki.success(" Notifiche attivate!",{description:"Riceverai aggiornamenti importanti per M1SSION"}),t?.(),s(!1)):(await m(p?"ios_pwa":"web_pwa"),Ki.error(" Permessi notifiche negati",{description:p?"Puoi abilitarli in Impostazioni > Safari > Notifiche":"Puoi abilitarli nelle impostazioni del browser"}),i?.())}catch(e){console.error(" M1SSION: Permission request error:",e),Ki.error(" Errore richiesta permessi notifiche"),await m(p?"ios_pwa":"web_pwa"),i?.()}finally{l(!1)}}},[o,c,p,f,g,u,h,m,t,i]);return a&&"granted"!==r&&p?se.jsxs(Wl,{className:"fixed bottom-4 right-4 w-80 z-50 border-2 border-primary shadow-lg",children:[se.jsx(Hl,{className:"pb-2",children:se.jsxs(Zl,{className:"text-sm flex items-center justify-between",children:[" Notifiche Push",se.jsx(mo,{variant:"ghost",size:"sm",onClick:()=>s(!1),className:"h-6 w-6 p-0",children:""})]})}),se.jsxs(Gl,{className:"space-y-3",children:[se.jsx("div",{className:"text-sm text-muted-foreground",children:"Abilita le notifiche push per ricevere aggiornamenti importanti su M1SSION"}),"denied"===r&&c&&se.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded",children:["Permessi negati. Vai in ",se.jsx("strong",{children:"Impostazioni Safari > Notifiche siti web"})," per abilitarli."]}),se.jsxs("div",{className:"flex flex-col gap-2",children:[se.jsx(mo,{onClick:b,disabled:o,className:"w-full",variant:"default",children:o?" Richiesta in corso...":" Abilita Notifiche"}),c&&"denied"===r&&se.jsx(mo,{onClick:()=>s(!1),variant:"outline",className:"w-full",size:"sm",children:"Continua senza notifiche"})]}),se.jsx("div",{className:"text-xs text-muted-foreground",children:p&&f?" iOS PWA Mode":" Web Mode"})]})]}):null},SR=()=>{const[e,t]=We.useState({isSupported:!1,isRegistered:!1,token:null,permission:null,isLoading:!1,error:null}),i=/Android/i.test(navigator.userAgent);We.useEffect(()=>{(async()=>{const e="serviceWorker"in navigator&&"PushManager"in window;if(t(t=>({...t,isSupported:e})),e){t(e=>({...e,isLoading:!0}));try{const e=await Notification.requestPermission();t(t=>({...t,permission:e,isLoading:!1}))}catch(i){console.error(" PWA push initialization error:",i),t(e=>({...e,error:i.message,isLoading:!1}))}}})()},[]);const a=async e=>{try{const{data:{user:t}}=await ba.auth.getUser();if(!t)return;const{error:a}=await ba.from("push_tokens").upsert({user_id:t.id,token:JSON.stringify(e),platform:i?"android":"web",endpoint_type:"web_push",device_info:{platform:"web",userAgent:navigator.userAgent,endpoint:e.endpoint},created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),last_used_at:(new Date).toISOString()});a&&console.error(" Error saving push subscription:",a)}catch(t){console.error(" Error in saveSubscriptionToSupabase:",t)}};return{...e,isAndroid:i,requestPermissionAndRegister:async()=>{if(!e.isSupported)return Ki.error(" Push notifications not supported"),!1;t(e=>({...e,isLoading:!0}));try{const e=await Notification.requestPermission();if(t(t=>({...t,permission:e})),"granted"===e){const e=await navigator.serviceWorker.ready,{loadVAPIDPublicKey:i,urlBase64ToUint8Array:s}=await ae(async()=>{const{loadVAPIDPublicKey:e,urlBase64ToUint8Array:t}=await import("./vapid-loader.p0s-TRMN.js");return{loadVAPIDPublicKey:e,urlBase64ToUint8Array:t}},[]),r=await i();if(!r)throw new Error("VAPID public key not configured");const n=s(r),o=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n});return await a(o),t(e=>({...e,isRegistered:!0,token:JSON.stringify(o),isLoading:!1})),Ki.success(" Push notifications enabled!"),!0}return Ki.error(" Push notification permission denied"),t(e=>({...e,isLoading:!1})),!1}catch(i){return console.error(" Permission request error:",i),t(e=>({...e,error:i.message,isLoading:!1})),Ki.error(" Error enabling push notifications"),!1}}}},_R=({className:e})=>{const{isSupported:t,isAndroid:i,isRegistered:a,token:s,permission:r,isLoading:n,error:o,requestPermissionAndRegister:l}=SR();if(!i||!t)return null;return se.jsxs("div",{className:`glass-card p-6 ${e}`,children:[se.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[se.jsx(yr,{className:"w-6 h-6 text-m1ssion-blue"}),se.jsx("h3",{className:"text-lg font-bold text-white",children:"Notifiche Push Android"})]}),se.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[a&&s?se.jsx(hs,{className:"w-5 h-5 text-green-400"}):o?se.jsx(us,{className:"w-5 h-5 text-red-400"}):se.jsx(Xa,{className:"w-5 h-5 text-m1ssion-blue"}),se.jsxs("div",{className:"flex-1",children:[se.jsx("p",{className:"font-medium text-white mb-1",children:a&&s?"Notifiche Android Attive":"denied"===r?"Permessi Negati":o?"Errore Configurazione":"granted"!==r||a?"Attiva Notifiche Android":"Registrazione in corso..."}),se.jsx("p",{className:"text-sm text-gray-300",children:a&&s?"Riceverai notifiche push native su Android":"denied"===r?"Vai nelle impostazioni per abilitare le notifiche":o||"Abilita le notifiche push per ricevere aggiornamenti M1SSION"})]})]}),!a&&"denied"!==r&&se.jsx(mo,{onClick:l,disabled:n,className:"w-full bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink text-white",children:n?se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Configurazione..."]}):se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx(Xa,{className:"w-4 h-4"}),"Attiva Notifiche"]})}),"denied"===r&&se.jsx("div",{className:"mt-3 p-3 bg-red-500/20 border border-red-500/30 rounded-md",children:se.jsx("p",{className:"text-sm text-red-300",children:" Vai in Impostazioni  App  M1SSION  Notifiche per abilitarle manualmente"})}),s&&se.jsx("div",{className:"mt-3 p-3 bg-green-500/20 border border-green-500/30 rounded-md",children:se.jsxs("p",{className:"text-sm text-green-300",children:[" Token: ",s.substring(0,20),"..."]})})]})},kR=()=>{const e=/iPhone|iPad|iPod/i.test(navigator.userAgent)?"ios":/Android/i.test(navigator.userAgent)?"android":"web",t=SR(),i=(()=>{const[e,t]=We.useState({isSupported:!1,isRegistered:!1,token:null,permission:null,isLoading:!1,error:null}),i=/iPhone|iPad|iPod/i.test(navigator.userAgent);return We.useEffect(()=>{"undefined"!=typeof window&&t(e=>({...e,isSupported:!1}))},[]),{...e,isIOS:i,requestPermissionAndRegister:async()=>{if(!i)return Ki.error("Notifiche push disponibili solo su iOS"),!1;t(e=>({...e,isLoading:!0}));try{const e=await Rc();return t(t=>({...t,permission:e.receive})),"granted"===e.receive?(await Bc(),Ki.success(" Notifiche push iOS attivate!"),!0):(Ki.error(" Permessi notifiche negati"),t(e=>({...e,isLoading:!1})),!1)}catch(e){return console.error(" iOS Permission request error:",e),t(t=>({...t,error:e.message,isLoading:!1})),Ki.error("Errore richiesta permessi iOS"),!1}}}})(),[a,s]=We.useState({isSupported:!1,isRegistered:!1,token:null,permission:null,isLoading:!1,error:null,platform:e});We.useEffect(()=>{s("android"===e?{isSupported:t.isSupported,isRegistered:t.isRegistered,token:t.token,permission:"default"===t.permission?"prompt":t.permission,isLoading:t.isLoading,error:t.error,platform:"android"}:"ios"===e?{isSupported:i.isSupported,isRegistered:i.isRegistered,token:i.token,permission:i.permission,isLoading:i.isLoading,error:i.error,platform:"ios"}:{isSupported:"serviceWorker"in navigator&&"PushManager"in window,isRegistered:!1,token:null,permission:null,isLoading:!1,error:null,platform:"web"})},[e,t.isSupported,t.isRegistered,t.token,t.permission,t.isLoading,t.error,i.isSupported,i.isRegistered,i.token,i.permission,i.isLoading,i.error]);return{...a,requestPermissionAndRegister:async()=>"android"===e?await t.requestPermissionAndRegister():"ios"===e&&await i.requestPermissionAndRegister(),android:t,ios:i}},CR=({className:e})=>{const{isSupported:t,isRegistered:i,token:a,permission:s,isLoading:r,error:n,platform:o,requestPermissionAndRegister:l}=kR();if("web"===o||!t)return se.jsx(Wl,{className:e,children:se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(Xa,{className:"w-5 h-5"}),"Notifiche Push"]}),se.jsx(Vl,{children:"Le notifiche push native sono disponibili solo su dispositivi mobili"})]})});const c=()=>"ios"===o?"iOS":"android"===o?"Android":"Mobile";return se.jsxs(Wl,{className:e,children:[se.jsxs(Hl,{children:[se.jsxs(Zl,{className:"flex items-center gap-2",children:[se.jsx(Xa,{className:"w-5 h-5"}),"Notifiche Push Native",se.jsxs(fc,{variant:"outline",className:"ml-auto",children:["ios"===o?se.jsx($a,{className:"w-4 h-4"}):"android"===o?se.jsx(yr,{className:"w-4 h-4"}):se.jsx(Xa,{className:"w-4 h-4"}),se.jsx("span",{className:"ml-1",children:c()})]})]}),se.jsx(Vl,{children:"Ricevi notifiche push native per aggiornamenti importanti della missione"})]}),se.jsxs(Gl,{className:"space-y-4",children:[se.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[se.jsxs("div",{className:"flex items-center gap-2",children:[se.jsx("div",{className:"w-3 h-3 rounded-full "+(i?"bg-green-500":"denied"===s?"bg-red-500":"granted"===s?"bg-yellow-500":"bg-muted")}),se.jsxs("span",{className:"text-sm font-medium",children:["Stato: ",i?"Attive":"denied"===s?"Negati":"granted"===s?"In corso...":"Non configurate"]})]}),i&&se.jsx(hs,{className:"w-4 h-4 text-green-500"})]}),a&&se.jsx("div",{className:"p-3 bg-muted/30 rounded-lg",children:se.jsxs("p",{className:"text-xs text-muted-foreground",children:["Token: ",a.substring(0,20),"..."]})}),n&&se.jsxs("div",{className:"flex items-center gap-2 p-3 bg-destructive/10 text-destructive rounded-lg",children:[se.jsx(us,{className:"w-4 h-4"}),se.jsx("span",{className:"text-sm",children:n})]}),"denied"===s&&se.jsx("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:se.jsx("p",{className:"text-sm text-orange-800",children:"I permessi per le notifiche sono stati negati. Per attivarle, vai nelle impostazioni del dispositivo e abilita le notifiche per M1SSION."})}),!i&&"denied"!==s&&se.jsx(mo,{onClick:l,disabled:r,className:"w-full",children:r?se.jsxs(se.Fragment,{children:[se.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Configurazione..."]}):se.jsxs(se.Fragment,{children:[se.jsx(Xa,{className:"w-4 h-4 mr-2"}),"Attiva Notifiche Push"]})}),i&&se.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[se.jsx(hs,{className:"w-4 h-4 text-green-600"}),se.jsxs("span",{className:"text-sm text-green-800",children:[" Notifiche push ",c()," configurate correttamente!"]})]})]})]})},AR=()=>{const{user:e,isAuthenticated:t}=sn(),[,i]=Ai();return We.useEffect(()=>{if(!t||!e?.id)return;e.id;const a=ba.channel("payment_monitor").on("postgres_changes",{event:"UPDATE",schema:"public",table:"payment_transactions",filter:`user_id=eq.${e.id}`},e=>{const t=e.new;if("succeeded"===t?.status&&t?.description?.includes("Buzz Map")){const e=()=>{i("/map",{replace:!0,state:{restorePreviousMapState:!0}})};if("visible"===document.visibilityState)e();else{const t=()=>{"visible"===document.visibilityState&&(e(),document.removeEventListener("visibilitychange",t))};document.addEventListener("visibilitychange",t)}}}).subscribe();return()=>{a.unsubscribe()}},[t,e,i]),null};const zR=()=>{const{user:e}=$l();We.useEffect(()=>{(async()=>{try{if(await async function(){const e="m1_pwa_fix_v20250904";if(!localStorage.getItem(e))try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const t of e){const e=t.scope||t.installing?.scriptURL||t.waiting?.scriptURL||t.active?.scriptURL;e&&!e.includes("/sw.js")&&await t.unregister()}}if("caches"in window){const e=(await caches.keys()).filter(e=>e.includes("onesignal")||e.includes("firebase")||e.includes("workbox")||e.startsWith("runtime-"));for(const t of e)await caches.delete(t)}["OneSignal-notificationClicked","OneSignal-isOptedOut","OneSignal-subscription","OneSignal-sessionCount","onesignal-pageview-count","OneSignalSDKUpdaterWorker.js","OneSignalSDKWorker.js"].forEach(e=>{localStorage.getItem(e)&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{(e.includes("OneSignal")||e.includes("onesignal"))&&sessionStorage.removeItem(e)}),localStorage.setItem(e,"1")}catch(t){console.error(" PWA cleanup error:",t),localStorage.setItem(e,"1")}}(),"serviceWorker"in navigator)try{await navigator.serviceWorker.register("/sw.js",{scope:"/",updateViaCache:"none"})}catch(t){console.warn(" PWA Stabilizer: SW registration failed (non-critical):",t)}if(e&&"granted"===Notification.permission)try{const e=await navigator.serviceWorker.ready;await Mz(e)}catch(i){console.error(" PWA Stabilizer: Push subscription failed:",i)}}catch(i){console.error(" PWA Stabilizer: Initialization failed:",i)}})()},[e])},ER={en:{title:"Legal Terms - M1SSION",description:"To play M1SSION, you must accept our Terms of Use. This is not a lottery or gambling game. It is a skill-based experience.",acceptButton:" I Accept",learnMore:"Learn More",skillBased:" Skill-Based Game - No Gambling"},fr:{title:"Conditions Lgales - M1SSION",description:"Pour jouer  M1SSION, vous devez accepter nos Conditions d'utilisation. Ce n'est pas un jeu de hasard, mais un jeu bas sur l'habilet.",acceptButton:" J'accepte",learnMore:"En savoir plus",skillBased:" Jeu d'Habilet - Pas de Jeu de Hasard"},es:{title:"Trminos Legales - M1SSION",description:"Para jugar a M1SSION, debes aceptar nuestros Trminos de uso. No es un juego de azar, sino un desafo de habilidad.",acceptButton:" Acepto",learnMore:"Saber ms",skillBased:" Juego de Habilidad - Sin Apuestas"},de:{title:"Rechtliche Bedingungen - M1SSION",description:"Um M1SSION zu spielen, musst du unsere Nutzungsbedingungen akzeptieren. Es handelt sich nicht um ein Glcksspiel, sondern um ein Geschicklichkeitsspiel.",acceptButton:" Ich akzeptiere",learnMore:"Mehr erfahren",skillBased:" Geschicklichkeitsspiel - Kein Glcksspiel"}},IR=()=>{const{needsConsent:e,isLoading:t,acceptLegalConsent:i}=(()=>{const{user:e}=bl(),{toast:t}=mc(),[i,a]=We.useState({isAccepted:!1,isLoading:!0,needsConsent:!1});We.useEffect(()=>{s()},[e]);const s=async()=>{try{if(a(e=>({...e,isLoading:!0})),e){const{data:t,error:i}=await ba.from("user_consents").select("terms_accepted").eq("user_id",e.id).maybeSingle();i&&"PGRST116"!==i.code&&console.error("Error loading legal consent:",i);const s=!0===t?.terms_accepted;a({isAccepted:s,isLoading:!1,needsConsent:!s})}else{const e="true"===localStorage.getItem("m1ssion_legal_consent");a({isAccepted:e,isLoading:!1,needsConsent:!e})}}catch(t){console.error("Error checking legal consent:",t),a({isAccepted:!1,isLoading:!1,needsConsent:!0})}};return{...i,acceptLegalConsent:async()=>{try{if(a(e=>({...e,isLoading:!0})),e){const{error:t}=await ba.from("user_consents").upsert({user_id:e.id,terms_accepted:!0,updated_at:(new Date).toISOString()},{onConflict:"user_id"});if(t)throw t}else localStorage.setItem("m1ssion_legal_consent","true"),localStorage.setItem("m1ssion_legal_consent_date",(new Date).toISOString());return a({isAccepted:!0,isLoading:!1,needsConsent:!1}),t({title:" Legal Terms Accepted",description:"Welcome to M1SSION! Your skill-based adventure begins now."}),!0}catch(i){return console.error("Error accepting legal consent:",i),a(e=>({...e,isLoading:!1})),t({title:" Error",description:"Unable to save consent. Please try again.",variant:"destructive"}),!1}},refreshConsent:s}})(),[a,s]=We.useState("en"),[r,n]=We.useState(!1),[,o]=Ai();We.useEffect(()=>{s((()=>{const e=navigator.language.toLowerCase();return e.startsWith("fr")?"fr":e.startsWith("es")?"es":e.startsWith("de")?"de":"en"})())},[]);if(t)return null;if(!e)return null;const l=ER[a];return se.jsx(tt,{children:se.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-md z-[10000] flex items-center justify-center p-4",children:se.jsx(et.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"w-full max-w-lg",children:se.jsxs(Wl,{className:"bg-gradient-to-br from-gray-900/95 to-black/95 border-[#00D1FF]/30 shadow-2xl",children:[se.jsxs(Hl,{className:"pb-4",children:[se.jsxs("div",{className:"flex items-center justify-between mb-4",children:[se.jsxs(Zl,{className:"flex items-center text-white text-lg",children:[se.jsx(vr,{className:"w-6 h-6 mr-3 text-[#00D1FF]"}),l.title]}),se.jsx("div",{className:"flex gap-1",children:["en","fr","es","de"].map(e=>se.jsx("button",{onClick:()=>(e=>{s(e)})(e),className:"px-2 py-1 text-xs rounded-md transition-all "+(a===e?"bg-[#00D1FF] text-black font-semibold":"bg-white/10 text-white/70 hover:bg-white/20"),children:e.toUpperCase()},e))})]}),se.jsx("div",{className:"flex items-center justify-center mb-4",children:se.jsx("div",{className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-500/30 rounded-full px-4 py-2",children:se.jsx("span",{className:"text-green-400 text-sm font-medium",children:l.skillBased})})})]}),se.jsxs(Gl,{className:"space-y-6",children:[se.jsx("div",{className:"text-center",children:se.jsx("p",{className:"text-white/90 text-base leading-relaxed mb-6",children:l.description})}),se.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[se.jsxs("div",{className:"flex items-center text-sm text-white/80",children:[se.jsx(os,{className:"w-4 h-4 mr-3 text-green-400 flex-shrink-0"}),se.jsx("span",{children:"Skill-based gameplay only"})]}),se.jsxs("div",{className:"flex items-center text-sm text-white/80",children:[se.jsx(os,{className:"w-4 h-4 mr-3 text-green-400 flex-shrink-0"}),se.jsx("span",{children:"No gambling or random mechanics"})]}),se.jsxs("div",{className:"flex items-center text-sm text-white/80",children:[se.jsx(os,{className:"w-4 h-4 mr-3 text-green-400 flex-shrink-0"}),se.jsx("span",{children:"Fair play and transparency"})]})]}),se.jsxs("div",{className:"flex flex-col space-y-3 pt-4",children:[se.jsx(mo,{onClick:async()=>{n(!0);try{await i()}finally{n(!1)}},disabled:r,className:"w-full bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90 text-white font-semibold py-3",children:r?se.jsxs("div",{className:"flex items-center",children:[se.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Processing..."]}):l.acceptButton}),se.jsxs(mo,{onClick:()=>{o("/terms")},variant:"outline",className:"w-full border-white/20 text-white hover:bg-white/10",children:[se.jsx(Ps,{className:"w-4 h-4 mr-2"}),l.learnMore]})]}),se.jsx("div",{className:"text-center pt-4 border-t border-white/10",children:se.jsx("p",{className:"text-xs text-white/50",children:" 2025 M1SSION  ALL RIGHTS RESERVED  NIYVORA KFT"})})]})]})})})})};function PR({children:e}){return We.useEffect(()=>{let e=!0;const t=setTimeout(async()=>{try{const{useAutoInterestSignals:e}=await ae(async()=>{const{useAutoInterestSignals:e}=await import("./useAutoInterestSignals.Uq2e0Uow.js");return{useAutoInterestSignals:e}},__vite__mapDeps([19,2,20,5,3,1,7,6,8,9]));0}catch(e){}},1e3);return()=>{e=!1,clearTimeout(t)}},[]),se.jsx(se.Fragment,{children:e})}const TR="m1_quiz_last_skip",MR=()=>{try{const e=localStorage.getItem(TR);if(!e)return!0;const t=new Date(e),i=new Date;return t.toDateString()!==i.toDateString()}catch(e){return console.warn("localStorage not available:",e),!0}},LR=()=>{const[e,t]=We.useState(!1),[i,a]=We.useState(!0),{isAuthenticated:s,getCurrentUser:r}=bl();We.useEffect(()=>{(async()=>{if(s){if(!MR())return t(!1),void a(!1);try{const e=r();if(!e)return void a(!1);const{data:i,error:s}=await ba.from("profiles").select("first_login_completed, investigative_style").eq("id",e.id).maybeSingle();if(s)console.error("Error checking quiz status:",s),t(!1);else if(i)if(i?.investigative_style)t(!1);else if(i?.first_login_completed){const e=MR();t(e)}else t(!0);else t(!0)}catch(e){console.error("Error in checkQuizStatus:",e),t(!1)}finally{a(!1)}}else a(!1)})()},[s,r]);return{needsQuiz:e,isLoading:i,markQuizCompleted:()=>{t(!1)},markQuizSkipped:()=>{(()=>{try{const e=new Date;localStorage.setItem(TR,e.toISOString())}catch(e){console.warn("Failed to record quiz skip:",e)}})(),t(!1)}}},FR=[{id:"analyst",name:"Investigatore",description:"Maestro nell'analisi di indizi e nella decodifica di segnali. Ogni dettaglio diventa una prova.",color:"#00D1FF",icon:""},{id:"operative",name:"Commando",description:"Agente da prima linea. Azione rapida, decisioni fulminee, interventi diretti.",color:"#F213A4",icon:""},{id:"tactician",name:"Stratega",description:"Pianificatore meticoloso. Ogni mossa  calcolata, ogni passo  previsto.",color:"#FFD700",icon:""},{id:"engineer",name:"Ingegnere",description:"Specialista in tecnologia, hacking e soluzioni creative per aggirare ogni ostacolo.",color:"#00FF88",icon:""},{id:"ghost",name:"Operatore Invisibile",description:"Agisce nell'ombra, non lascia tracce, ma il suo impatto  decisivo. (categoria bonus M1SSION)",color:"#8B5CF6",icon:""}],OR=[{id:1,text:"Ti trovi di fronte a una situazione critica con informazioni limitate. Qual  il tuo primo istinto?",options:[{text:"Raccolgo tutti i dati disponibili e li analizzo sistematicamente",scores:{analyst:3,operative:0,tactician:1,engineer:0,ghost:0}},{text:"Agisco immediatamente basandomi sull'esperienza",scores:{analyst:0,operative:3,tactician:0,engineer:0,ghost:1}},{text:"Creo una strategia considerando tutti i possibili scenari",scores:{analyst:1,operative:0,tactician:3,engineer:0,ghost:0}},{text:"Cerco soluzioni tecnologiche o innovative",scores:{analyst:0,operative:0,tactician:0,engineer:3,ghost:1}},{text:"Osservo in silenzio prima di muovermi",scores:{analyst:1,operative:0,tactician:1,engineer:0,ghost:3}}]},{id:2,text:"Durante una missione di squadra, preferisci:",options:[{text:"Essere il cervello dell'operazione, coordinando le informazioni",scores:{analyst:3,operative:0,tactician:1,engineer:1,ghost:0}},{text:"Guidare il team in prima linea",scores:{analyst:0,operative:3,tactician:2,engineer:0,ghost:0}},{text:"Pianificare ogni dettaglio dell'operazione",scores:{analyst:1,operative:0,tactician:3,engineer:0,ghost:0}},{text:"Fornire supporto tecnico e soluzioni innovative",scores:{analyst:0,operative:0,tactician:0,engineer:3,ghost:1}},{text:"Operare autonomamente con obiettivi specifici",scores:{analyst:0,operative:1,tactician:0,engineer:1,ghost:3}}]},{id:3,text:"Qual  la tua risorsa pi preziosa in una missione?",options:[{text:"La mia capacit di osservazione e deduzione",scores:{analyst:3,operative:0,tactician:0,engineer:0,ghost:2}},{text:"I miei riflessi e la capacit di adattamento",scores:{analyst:0,operative:3,tactician:0,engineer:1,ghost:1}},{text:"La mia esperienza e conoscenza strategica",scores:{analyst:1,operative:1,tactician:3,engineer:0,ghost:0}},{text:"Le mie competenze tecniche e creativit",scores:{analyst:0,operative:0,tactician:0,engineer:3,ghost:1}},{text:"La mia discrezione e capacit di mimetizzarmi",scores:{analyst:1,operative:0,tactician:0,engineer:0,ghost:3}}]},{id:4,text:"Come preferisci comunicare informazioni critiche?",options:[{text:"Report dettagliati con prove e analisi complete",scores:{analyst:3,operative:0,tactician:1,engineer:0,ghost:0}},{text:"Comunicazioni dirette e immediate",scores:{analyst:0,operative:3,tactician:0,engineer:0,ghost:1}},{text:"Briefing strutturati con piani alternativi",scores:{analyst:1,operative:0,tactician:3,engineer:0,ghost:0}},{text:"Sistemi sicuri e canali criptati",scores:{analyst:0,operative:0,tactician:0,engineer:3,ghost:2}},{text:"Solo quando strettamente necessario, con codici",scores:{analyst:0,operative:0,tactician:0,engineer:1,ghost:3}}]},{id:5,text:"Di fronte a un sistema di sicurezza avanzato, come procedi?",options:[{text:"Studio i pattern e cerco vulnerabilit logiche",scores:{analyst:3,operative:0,tactician:1,engineer:1,ghost:0}},{text:"Cerco una via di accesso diretta e rapida",scores:{analyst:0,operative:3,tactician:0,engineer:0,ghost:1}},{text:"Creo un piano multi-fase per aggirarlo",scores:{analyst:0,operative:0,tactician:3,engineer:1,ghost:1}},{text:"Uso tool tecnologici per bypassarlo",scores:{analyst:1,operative:0,tactician:0,engineer:3,ghost:0}},{text:"Aspetto il momento giusto e mi infiltro invisibilmente",scores:{analyst:0,operative:0,tactician:1,engineer:0,ghost:3}}]},{id:6,text:"Il tuo approccio ideale per raccogliere intelligence :",options:[{text:"Analisi di fonti multiple e cross-referencing",scores:{analyst:3,operative:0,tactician:1,engineer:1,ghost:0}},{text:"Interrogatori diretti e acquisizione rapida",scores:{analyst:0,operative:3,tactician:0,engineer:0,ghost:0}},{text:"Network di contatti e intelligence predittiva",scores:{analyst:1,operative:0,tactician:3,engineer:0,ghost:1}},{text:"Intercettazioni digitali e data mining",scores:{analyst:1,operative:0,tactician:0,engineer:3,ghost:1}},{text:"Osservazione prolungata e infiltrazione silenziosa",scores:{analyst:1,operative:0,tactician:0,engineer:0,ghost:3}}]},{id:7,text:"Qual  il tuo stile di lavoro ideale per M1SSION?",options:[{text:"Laboratorio/base operativa con accesso a database e archivi",scores:{analyst:3,operative:0,tactician:1,engineer:1,ghost:0}},{text:"Sul campo, in movimento, sempre pronti all'azione",scores:{analyst:0,operative:3,tactician:0,engineer:0,ghost:1}},{text:"Centro di comando con overview completa dell'operazione",scores:{analyst:1,operative:1,tactician:3,engineer:0,ghost:0}},{text:"Tech hub con strumenti avanzati e connettivit",scores:{analyst:0,operative:0,tactician:0,engineer:3,ghost:1}},{text:"Ovunque, mantenendo sempre un profilo basso",scores:{analyst:0,operative:0,tactician:0,engineer:1,ghost:3}}]}],DR=({onComplete:e,userId:t})=>{const[i,a]=We.useState(0),[s,r]=We.useState([]),[n,o]=We.useState(null),[l,c]=We.useState({analyst:0,operative:0,tactician:0,engineer:0,ghost:0}),[d,u]=We.useState(!1),h=async(i,a)=>{u(!0);try{let i="analyst",s=a.analyst;Object.keys(a).forEach(e=>{a[e]>s&&(s=a[e],i=e)});const r=FR.find(e=>e.id===i)||FR[0],{error:n}=await ba.rpc("update_personality_quiz_result",{p_user_id:t,p_investigative_style:r.name});if(n)return console.error("Quiz save error:",n),void Ki.error("Errore nel salvare il risultato del quiz. Riprova.");Ki.success(`Profilo assegnato: ${r.name}!`),e(r)}catch(s){console.error("Quiz completion error:",s),Ki.error("Errore durante il completamento del quiz. Riprova.")}finally{u(!1)}},m=(i+1)/OR.length*100;return se.jsx("div",{className:"w-full bg-gradient-to-b from-[#131524]/90 to-black/95 p-2 sm:p-4 py-3 sm:py-4",children:se.jsxs(et.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"w-full max-w-2xl mx-auto",children:[se.jsxs(Wl,{className:"bg-black/60 border-[#00D1FF]/30 backdrop-blur-sm",children:[se.jsxs(Hl,{className:"text-center space-y-2 sm:space-y-3 p-3 sm:p-4",children:[se.jsxs(et.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},children:[se.jsx(Zl,{className:"text-xl sm:text-2xl font-orbitron text-white",children:"Quiz Personalit Agente"}),se.jsx("p",{className:"text-white/70 text-xs sm:text-sm mt-2",children:"Scopri il tuo tipo di agente M1SSION"})]}),se.jsxs("div",{className:"space-y-2",children:[se.jsxs("div",{className:"flex justify-between text-sm text-white/60",children:[se.jsxs("span",{children:["Domanda ",i+1," di ",OR.length]}),se.jsxs("span",{children:[Math.round(m),"%"]})]}),se.jsx(Pc,{value:m,className:"h-2 bg-white/10"})]})]}),se.jsxs(Gl,{className:"space-y-3 sm:space-y-4 p-3 sm:p-4",children:[se.jsx(tt,{mode:"wait",children:se.jsxs(et.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},transition:{duration:.3},className:"space-y-4",children:[se.jsx("h3",{className:"text-base sm:text-lg font-medium text-white leading-relaxed",children:OR[i].text}),se.jsx("div",{className:"space-y-2 sm:space-y-3",children:OR[i].options.map((e,t)=>se.jsx(et.button,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1*t},onClick:()=>{o(t)},className:"w-full p-3 sm:p-4 text-left rounded-lg border transition-all duration-200 "+(n===t?"border-[#00D1FF] bg-[#00D1FF]/10 text-white":"border-white/20 bg-white/5 text-white/80 hover:border-white/40 hover:bg-white/10"),children:se.jsx("span",{className:"text-xs sm:text-sm leading-relaxed",children:e.text})},t))})]},i)}),se.jsxs("div",{className:"flex justify-between items-center pt-3 gap-2",children:[se.jsx(mo,{onClick:async()=>{u(!0);try{const{error:i}=await ba.from("profiles").update({first_login_completed:!0}).eq("id",t);if(i)throw i;Ki.info("Quiz saltato. Potrai completarlo in seguito."),e(null)}catch(i){console.error("Skip quiz error:",i),Ki.error("Errore. Riprova.")}finally{u(!1)}},disabled:d,variant:"outline",className:"border-white/20 text-white/80 hover:bg-white/10 hover:text-white px-3 sm:px-4 text-xs sm:text-sm h-9 sm:h-10",children:"Salta Quiz"}),se.jsx(mo,{onClick:async()=>{if(null===n)return;const e=OR[i].options[n],t=[...s,n];r(t);const d={...l};Object.keys(e.scores).forEach(t=>{d[t]+=e.scores[t]}),c(d),i<OR.length-1?(a(i+1),o(null)):await h(t,d)},disabled:null===n||d,className:"bg-[#00D1FF] hover:bg-[#00A3CC] text-black font-medium px-4 sm:px-6 text-xs sm:text-sm h-9 sm:h-10",children:d?se.jsxs("div",{className:"flex items-center space-x-2",children:[se.jsx("div",{className:"w-4 h-4 border-2 border-black/20 border-t-black rounded-full animate-spin"}),se.jsx("span",{children:"Elaborazione..."})]}):i<OR.length-1?"Prossima Domanda":"Completa Quiz"})]})]})]}),se.jsx(et.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"mt-3 sm:mt-4",children:se.jsxs(Wl,{className:"bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm",children:[se.jsx(Hl,{className:"p-3 sm:p-4",children:se.jsx(Zl,{className:"text-center text-white font-orbitron text-sm sm:text-base",children:"Tipi di Agente M1SSION"})}),se.jsx(Gl,{className:"p-3 sm:p-4 pt-0",children:se.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2",children:FR.map(e=>se.jsxs("div",{className:"text-center p-2 sm:p-3 rounded-lg bg-white/5 border border-white/10",children:[se.jsx("div",{className:"text-xl sm:text-2xl mb-1 sm:mb-2",children:e.icon}),se.jsx(fc,{variant:"outline",className:"text-[10px] sm:text-xs mb-1 sm:mb-2",style:{borderColor:e.color,color:e.color},children:e.name}),se.jsx("p",{className:"text-white/70 text-[10px] sm:text-xs leading-relaxed",children:e.description})]},e.id))})})]})})]})})},RR=({isOpen:e,onComplete:t,userId:i})=>se.jsx(to,{open:e,onOpenChange:()=>{},children:se.jsx(io,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-y-auto p-0 border-none bg-transparent",children:se.jsx("div",{className:"max-h-[95vh] overflow-y-auto",children:se.jsx(DR,{onComplete:t,userId:i})})})}),BR=()=>{const{needsQuiz:e,isLoading:t,markQuizCompleted:i,markQuizSkipped:a}=LR(),{getCurrentUser:s}=bl(),r=s();return!t&&e&&r?se.jsx(RR,{isOpen:e,onComplete:async e=>{e?(i(),Ki.success("Quiz completato! Il tuo profilo  stato aggiornato.",{description:`Sei un ${e.name}!`})):(a(),Ki.info("Quiz saltato. Riapparir domani all'apertura dell'app.",{description:"Potrai completarlo anche dalla tua area profilo."}))},userId:r.id}):null};function UR(){const{user:e}=sn(),[t,i]=We.useState({buzzCompleted:!1,buzzMapCompleted:!1,buzzStep:0,buzzMapStep:0,loading:!0});We.useEffect(()=>{e?.id?a():i(e=>({...e,loading:!1}))},[e?.id]);const a=async()=>{if(e?.id)try{const{data:t,error:a}=await ba.from("profiles").select("buzz_walkthrough_completed, buzz_map_walkthrough_completed, walkthrough_step_buzz, walkthrough_step_buzz_map").eq("id",e.id).single();if(a)throw a;i({buzzCompleted:t?.buzz_walkthrough_completed||!1,buzzMapCompleted:t?.buzz_map_walkthrough_completed||!1,buzzStep:t?.walkthrough_step_buzz||0,buzzMapStep:t?.walkthrough_step_buzz_map||0,loading:!1})}catch(t){console.error("Error loading walkthrough state:",t),i(e=>({...e,loading:!1}))}},s=async t=>{if(!e?.id)return;const a="buzz"===t?"buzz_walkthrough_completed":"buzz_map_walkthrough_completed",s="buzz"===t?"walkthrough_step_buzz":"walkthrough_step_buzz_map";try{await ba.from("profiles").update({[a]:!0,[s]:5}).eq("id",e.id),i(e=>({...e,["buzz"===t?"buzzCompleted":"buzzMapCompleted"]:!0,["buzz"===t?"buzzStep":"buzzMapStep"]:5}))}catch(r){console.error("Error completing walkthrough:",r)}};return{...t,updateStep:async(t,a)=>{if(!e?.id)return;const s="buzz"===t?"walkthrough_step_buzz":"walkthrough_step_buzz_map";try{await ba.from("profiles").update({[s]:a}).eq("id",e.id),i(e=>({...e,["buzz"===t?"buzzStep":"buzzMapStep"]:a}))}catch(r){console.error("Error updating walkthrough step:",r)}},completeWalkthrough:s,skipWalkthrough:async e=>{await s(e)},refresh:a}}const qR=[{id:0,title:"Benvenuto nel BUZZ!",description:"BUZZ ti permette di generare indizi testuali per trovare il premio M1SSION. Scopri come funziona!",icon:Wr,action:null},{id:1,title:"Prova BUZZ GRATIS",description:"Premi il tasto BUZZ per ricevere il tuo primo indizio gratuito. Nessun pagamento richiesto per questa demo!",icon:Ms,action:"demo_buzz"},{id:2,title:"Indizio Ricevuto!",description:"Perfetto! Gli indizi BUZZ ti guidano verso il premio. Pi BUZZ usi, pi ti avvicini al tesoro!",icon:kr,action:null},{id:3,title:"Come Funziona",description:"Ogni BUZZ ha un costo progressivo. Il primo costa 1.99, poi aumenta gradualmente. Pi indizi raccogli, pi precisa diventa la tua ricerca!",icon:Wr,action:null},{id:4,title:"Sei Pronto!",description:"Hai completato il tutorial BUZZ! Ora puoi iniziare la tua caccia al tesoro M1SSION.",icon:Va,action:"complete"}];function $R({onComplete:e,onDemoTrigger:t}){const{buzzStep:i,updateStep:a,completeWalkthrough:s,skipWalkthrough:r}=UR(),[n,o]=We.useState(i),[l,c]=We.useState(!1);We.useEffect(()=>{o(i)},[i]);const d=async()=>{await r("buzz"),e()},u=qR[n]||qR[0],h=u?.icon||Wr,m=(n+1)/qR.length*100;return We.useEffect(()=>{qR[n]||o(0)},[n]),se.jsx(tt,{children:se.jsxs(et.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",children:[l&&se.jsx("div",{className:"absolute inset-0 pointer-events-none",children:Array.from({length:20}).map((e,t)=>se.jsx(et.div,{initial:{x:"50%",y:"50%",scale:0,opacity:1},animate:{x:50+100*(Math.random()-.5)+"%",y:50+100*(Math.random()-.5)+"%",scale:2*Math.random(),opacity:0},transition:{duration:1.5,ease:"easeOut"},className:"absolute w-2 h-2 bg-[#00D1FF] rounded-full",style:{boxShadow:"0 0 10px #00D1FF"}},t))}),se.jsxs(et.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},className:"relative w-full max-w-md bg-gradient-to-b from-[#131524] to-black border border-[#00D1FF]/30 rounded-2xl overflow-hidden",style:{boxShadow:"0 0 40px rgba(0, 209, 255, 0.3)"},children:[se.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-white/10",children:se.jsx(et.div,{initial:{width:0},animate:{width:`${m}%`},transition:{duration:.3},className:"h-full bg-gradient-to-r from-[#00D1FF] to-[#FF1CF7]"})}),se.jsx("button",{onClick:d,className:"absolute top-4 right-4 z-10 p-2 hover:bg-white/10 rounded-lg transition-colors",children:se.jsx($r,{className:"w-5 h-5 text-white/70"})}),se.jsx("div",{className:"p-8 pt-12",children:se.jsxs(et.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"text-center space-y-6",children:[se.jsx(et.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,repeatType:"reverse"},className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-[#00D1FF] to-[#FF1CF7] mx-auto",children:se.jsx(h,{className:"w-10 h-10 text-white"})}),se.jsx("h2",{className:"text-2xl font-orbitron font-bold text-white",children:u.title}),se.jsx("p",{className:"text-white/80 leading-relaxed",children:u.description}),se.jsx("div",{className:"flex items-center justify-center gap-2 pt-4",children:qR.map((e,t)=>se.jsx("div",{className:"w-2 h-2 rounded-full transition-all "+(t===n?"bg-[#00D1FF] w-6":t<n?"bg-[#00D1FF]/50":"bg-white/20")},t))}),se.jsxs("div",{className:"flex gap-3 pt-6",children:[se.jsx(mo,{onClick:d,variant:"outline",className:"flex-1 border-white/20 text-white/80 hover:bg-white/10",children:"Salta"}),se.jsx(mo,{onClick:async()=>{const i=n+1;"demo_buzz"===qR[n].action?(c(!0),t(),setTimeout(async()=>{await a("buzz",i),o(i),c(!1)},1500)):"complete"===qR[n].action?(await s("buzz"),e()):(await a("buzz",i),o(i))},className:"flex-1 bg-gradient-to-r from-[#00D1FF] to-[#FF1CF7] hover:opacity-90 text-white font-medium",children:"demo_buzz"===u.action?"Prova BUZZ":"complete"===u.action?"Completa":"Avanti"})]})]},n)})]})]})})}const WR=[{id:0,title:"Benvenuto in BUZZ MAP!",description:"BUZZ MAP genera un'area geografica dove si trova sicuramente il premio M1SSION. Pi precisa  l'area, pi vicino sei al tesoro!",icon:Ks,action:null},{id:1,title:"Prova BUZZ MAP GRATIS",description:"Premi il tasto BUZZ MAP per generare la tua prima area demo (500km). Questa demo  completamente gratuita!",icon:Ms,action:"demo_buzz_map"},{id:2,title:"Area Generata!",description:"Perfetto! L'area generata contiene sicuramente il premio. Il cerchio sulla mappa mostra dove cercare.",icon:kr,action:null},{id:3,title:"Come Ridurre l'Area",description:"Ogni volta che usi BUZZ MAP, il raggio si riduce progressivamente da 500km fino a pochi metri. Pi usi BUZZ MAP, pi ti avvicini!",icon:ps,action:null},{id:4,title:"Sei Pronto!",description:"Hai completato il tutorial BUZZ MAP! Ora puoi restringere l'area e trovare il tesoro M1SSION.",icon:Va,action:"complete"}];function HR({onComplete:e,onDemoTrigger:t}){const{buzzMapStep:i,updateStep:a,completeWalkthrough:s,skipWalkthrough:r}=UR(),[n,o]=We.useState(i),[l,c]=We.useState(!1),[d,u]=We.useState(!1);We.useEffect(()=>{o(i)},[i]),We.useEffect(()=>{3===n&&u(!0)},[n]);const h=async()=>{await r("buzz_map"),e()},m=WR[n]||WR[0],p=m?.icon||Ks,f=(n+1)/WR.length*100;return We.useEffect(()=>{WR[n]||o(0)},[n]),se.jsx(tt,{children:se.jsxs(et.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",children:[l&&se.jsx("div",{className:"absolute inset-0 pointer-events-none",children:Array.from({length:30}).map((e,t)=>se.jsx(et.div,{initial:{x:"50%",y:"50%",scale:0,opacity:1},animate:{x:50+100*(Math.random()-.5)+"%",y:50+100*(Math.random()-.5)+"%",scale:2*Math.random(),opacity:0},transition:{duration:1.5,ease:"easeOut"},className:"absolute w-2 h-2 bg-[#FF1CF7] rounded-full",style:{boxShadow:"0 0 10px #FF1CF7"}},t))}),se.jsxs(et.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},className:"relative w-full max-w-md bg-gradient-to-b from-[#131524] to-black border border-[#FF1CF7]/30 rounded-2xl overflow-hidden",style:{boxShadow:"0 0 40px rgba(255, 28, 247, 0.3)"},children:[se.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-white/10",children:se.jsx(et.div,{initial:{width:0},animate:{width:`${f}%`},transition:{duration:.3},className:"h-full bg-gradient-to-r from-[#FF1CF7] to-[#00D1FF]"})}),se.jsx("button",{onClick:h,className:"absolute top-4 right-4 z-10 p-2 hover:bg-white/10 rounded-lg transition-colors",children:se.jsx($r,{className:"w-5 h-5 text-white/70"})}),se.jsx("div",{className:"p-8 pt-12",children:se.jsxs(et.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"text-center space-y-6",children:[se.jsxs("div",{className:"relative inline-flex items-center justify-center mx-auto",children:[d&&3===n&&se.jsx(et.div,{initial:{scale:2,opacity:.5},animate:{scale:.8,opacity:0},transition:{duration:2,repeat:1/0,repeatType:"loop"},className:"absolute w-32 h-32 rounded-full border-2 border-[#FF1CF7]"}),se.jsx(et.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,repeatType:"reverse"},className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-[#FF1CF7] to-[#00D1FF]",children:se.jsx(p,{className:"w-10 h-10 text-white"})})]}),se.jsx("h2",{className:"text-2xl font-orbitron font-bold text-white",children:m.title}),se.jsx("p",{className:"text-white/80 leading-relaxed",children:m.description}),se.jsx("div",{className:"flex items-center justify-center gap-2 pt-4",children:WR.map((e,t)=>se.jsx("div",{className:"w-2 h-2 rounded-full transition-all "+(t===n?"bg-[#FF1CF7] w-6":t<n?"bg-[#FF1CF7]/50":"bg-white/20")},t))}),se.jsxs("div",{className:"flex gap-3 pt-6",children:[se.jsx(mo,{onClick:h,variant:"outline",className:"flex-1 border-white/20 text-white/80 hover:bg-white/10",children:"Salta"}),se.jsx(mo,{onClick:async()=>{const i=n+1;"demo_buzz_map"===WR[n].action?(c(!0),t(),setTimeout(async()=>{await a("buzz_map",i),o(i),c(!1)},1500)):"complete"===WR[n].action?(await s("buzz_map"),e()):(await a("buzz_map",i),o(i))},className:"flex-1 bg-gradient-to-r from-[#FF1CF7] to-[#00D1FF] hover:opacity-90 text-white font-medium",children:"demo_buzz_map"===m.action?"Prova BUZZ MAP":"complete"===m.action?"Completa":"Avanti"})]})]},n)})]})]})})}function ZR({onBuzzDemo:e,onBuzzMapDemo:t}){const[i]=Ai(),{user:a,isAuthenticated:s}=sn(),{buzzCompleted:r,buzzMapCompleted:n,loading:o,completeWalkthrough:l,refresh:c}=UR(),[d,u]=We.useState(null),[h,m]=We.useState(!1);We.useEffect(()=>{s&&a&&!o?"/buzz"!==i||r||h?"/map"!==i||n||h?"/buzz"!==i&&"/map"!==i&&m(!1):(u("buzz_map"),m(!0)):(u("buzz"),m(!0)):m(!1)},[i,r,n,s,a,o,h]);return!s||o?null:se.jsxs(se.Fragment,{children:["buzz"===d&&se.jsx($R,{onComplete:async()=>{try{await l("buzz"),await(c?.())}finally{u(null),m(!0)}},onDemoTrigger:()=>{e&&e()}}),"buzz_map"===d&&se.jsx(HR,{onComplete:async()=>{try{await l("buzz_map"),await(c?.())}finally{u(null),m(!0)}},onDemoTrigger:()=>{t&&t()}})]})}const VR=[{slug:"mission-buzz",title:"BUZZ  definizione e regole base",body:"BUZZ  l'azione di scansione attiva che sblocca indizi o aree. Il costo e il raggio sono dinamici in base al tier e alla progressione. Il BUZZ pu essere lanciato anche fuori dalla mappa. Il primo BUZZ Map ha condizioni speciali documentate a parte.",tags:["buzz","regole","onboarding"]},{slug:"mission-buzz-map",title:"BUZZ Map  come funziona",body:"BUZZ Map  l'interazione contestuale dalla mappa: l'utente vede overlay e marker, e pu lanciare il BUZZ direttamente dalla mappa. Differenza chiave: BUZZ = azione singola, BUZZ Map = azione dalla mappa con feedback visivo. Primo BUZZ Map: raggio 500 km, prezzo 4,99 (se confermato nelle policy attuali).",tags:["buzz-map","mappa","onboarding"]},{slug:"mission-final-shot",title:"Final Shot  intento finale",body:"Final Shot  il tentativo finale di claim del premio secondo regole antifrode (posizione, finestra temporale, limiti per tier). Prima del Final Shot viene consigliato rivedere gli indizi raccolti. I dettagli vanno aggiornati con le policy ufficiali.",tags:["final-shot","regole"]},{slug:"mission-tiers",title:"Tiers e limiti",body:"Free/Silver/Gold/Black: limiti mensili di BUZZ, costo/raggio e vantaggi accessori. L'assistente deve sempre rispettare i limiti del tier corrente.",tags:["tiers","pricing"]}];async function GR(e={}){const t=e.documents??VR;try{t.length;const{data:e,error:i}=await ba.functions.invoke("norah-kb-upsert",{body:{documents:t}});if(i)throw console.error(" [NORAH KB] Errore edge function:",i),new Error(`KB upsert failed: ${i.message||JSON.stringify(i)}`);return e?.total||t.length,e?.results&&e.results.forEach(e=>{e.status;e.slug,e.chunks}),e}catch(i){throw console.error(" [NORAH KB] Errore popolamento:",i),i}}"undefined"!=typeof window&&(window.__populateKB__=GR);const YR=()=>((()=>{const{user:e}=sn(),[,t]=Ai();We.useEffect(()=>{if(!e?.id||!("serviceWorker"in navigator))return;const i=e=>{if("norah_proactive"===e.data?.type){const{notification_type:i,title:a,body:s,deepLink:r}=e.data;Ki(a,{description:s,duration:8e3,action:{label:"Apri",onClick:()=>{r&&t(r)}},style:{background:"linear-gradient(135deg, #00FFFF 0%, #0084FF 100%)",color:"white",fontWeight:"bold"}}),e.data.notification_id&&ba.rpc("mark_norah_notification_clicked",{p_notification_id:e.data.notification_id}).then(()=>{})}};return navigator.serviceWorker.addEventListener("message",i),()=>{navigator.serviceWorker.removeEventListener("message",i)}},[e?.id,t])})(),null),KR=()=>{const{user:e}=sn(),[t,i]=We.useState(!1),[a,s]=We.useState(!0);return We.useEffect(()=>{(async()=>{if(!e?.id)return i(!1),void s(!1);try{const{data:t,error:a}=await ba.from("missions").select("id").eq("status","active").order("start_date",{ascending:!1}).limit(1);if(a||!t||0===t.length)return i(!1),void s(!1);const r=t[0].id,{data:n,error:o}=await ba.from("mission_enrollments").select("user_id").eq("user_id",e.id).eq("mission_id",r).maybeSingle();i(!!n&&!o)}catch(t){console.error("Error checking mission enrollment:",t),i(!1)}finally{s(!1)}})()},[e?.id]),{isEnrolled:t,isLoading:a}},XR=()=>{const{user:e}=sn(),[,t]=Ai(),[i,a]=We.useState(!1),{isEnrolled:s,isLoading:r}=KR();if(r||s)return null;return se.jsx(et.button,{onClick:async()=>{a(!0);try{let i=e;if(!i){const{data:e,error:t}=await ba.auth.signInAnonymously();if(t)return console.error(" [START-MISSION] Anonymous sign-in error:",t),Ki.error("Ops, riprova tra poco.",{description:"Impossibile autenticarti automaticamente."}),void a(!1);i=e?.user??null}if(!i)return Ki.error("Ops, riprova tra poco.",{description:"Sessione non valida."}),void a(!1);const{data:s}=await ba.auth.getSession(),r=s?.session?.access_token;if(!r)return Ki.error("Ops, riprova tra poco.",{description:"Token di autenticazione non disponibile."}),void a(!1);const n=await ba.functions.invoke("enroll-mission-of-the-month",{headers:{Authorization:`Bearer ${r}`}});if(n.error)return console.error(" [START-MISSION] Edge function error:",n.error),Ki.error("Ops, riprova tra poco.",{description:"Impossibile iscriverti alla missione."}),void a(!1);const o=n.data;if(!o?.ok)return Ki.error("Ops, riprova tra poco.",{description:o?.error||"Errore sconosciuto."}),void a(!1);o.mission_id,window.dispatchEvent(new CustomEvent("mission:enrolled",{detail:{missionId:o.mission_id}}));try{localStorage.setItem("m1_mission_enrolled","1")}catch(pB){}Ki.success("Sei dentro! Missione del mese attivata.",{description:"Preparati per l'avventura! "}),setTimeout(()=>{t("/map")},800)}catch(i){console.error(" [START-MISSION] Unexpected error:",i),Ki.error("Ops, riprova tra poco.",{description:"Errore imprevisto."})}finally{a(!1)}},disabled:i,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"inline-flex items-center justify-center px-3 py-1 rounded-full bg-[#00D1FF]/10 border border-[#00D1FF]/30 hover:bg-[#00D1FF]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed",whileHover:i?{}:{scale:1.05},whileTap:i?{}:{scale:.95},children:i?se.jsxs(se.Fragment,{children:[se.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-[#00D1FF] border-t-transparent mr-2"}),se.jsx("span",{className:"text-xs font-orbitron font-semibold text-[#00D1FF] uppercase tracking-wider",children:"Caricamento..."})]}):se.jsx("span",{className:"text-xs font-orbitron font-semibold text-[#00D1FF] uppercase tracking-wider",children:"START M1SSION"})})},JR=()=>{const{isEnrolled:e,isLoading:t}=KR(),[i,a]=We.useState(!1),[s,r]=We.useState(!1);if(We.useEffect(()=>{try{"1"===localStorage.getItem("m1_mission_enrolled")&&r(!0)}catch(pB){}},[]),We.useEffect(()=>{if(t)return;let e=0;let i=null,s=null,r=null;const n=()=>{let e=document.getElementById("m1-home-title");e||(e=document.querySelector('h1[aria-label*="Centro di Comando Agente"]')||document.querySelector('h1[aria-label*="M1SSION"]')||Array.from(document.querySelectorAll("h1")).find(e=>e.textContent?.includes("M1SSION")),e&&(e.id="m1-home-title",e.setAttribute("data-m1-anchor","home-title")));const t=e?.closest("div"),i=t?Array.from(t.querySelectorAll("p, span, div")).find(e=>e.textContent?.includes("Centro di Comando Agente")):null;return{headerH1:e,headerWrapper:t,subtitle:i}},o=()=>{const{headerH1:e,headerWrapper:t,subtitle:i}=n();if(!e||!t)return!1;r||(r=document.getElementById("mission-status-badge-portal"),r||(r=document.createElement("div"),r.id="mission-status-badge-portal",r.setAttribute("data-anchor","m1-header-badge"),r.className="flex justify-center my-3",r.setAttribute("data-persistent","true")));return(i?r.nextSibling===i&&r.parentElement===t:r.previousElementSibling===e&&r.parentElement===t)||(i?t.insertBefore(r,i):e.insertAdjacentElement("afterend",r)),a(!0),!0},l=()=>{if(o()){const{headerWrapper:e}=n();return e&&!i&&(i=new MutationObserver(()=>{requestAnimationFrame(()=>o())}),i.observe(e,{childList:!0,subtree:!1})),void(s||(s=new MutationObserver(()=>{r&&!document.body.contains(r)&&requestAnimationFrame(()=>o())}),s.observe(document.body,{childList:!0,subtree:!0})))}e<200?(e++,setTimeout(l,100)):console.warn("[MissionBadgeInjector] Header not found after max retries")};l();const c=()=>{requestAnimationFrame(()=>{a(!1),r=null,setTimeout(l,50)})},d=()=>requestAnimationFrame(l);return window.addEventListener("pageshow",d),window.addEventListener("popstate",c),()=>{i?.disconnect(),s?.disconnect(),window.removeEventListener("pageshow",d),window.removeEventListener("popstate",c),r=null}},[t]),We.useEffect(()=>{const e=()=>{r(!0),a(!0)};return window.addEventListener("mission:enrolled",e),()=>window.removeEventListener("mission:enrolled",e)},[]),t||!i)return null;const n=document.getElementById("mission-status-badge-portal");return n?Ye.createPortal(e||s?se.jsx(et.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"inline-flex items-center justify-center px-3 py-1 rounded-full border border-emerald-400/40 bg-gradient-to-r from-emerald-600/15 to-fuchsia-600/15",children:se.jsx("span",{className:"text-xs font-orbitron font-semibold uppercase tracking-wider bg-gradient-to-r from-emerald-400 to-fuchsia-400 bg-clip-text text-transparent",children:"ON M1SSION"})}):se.jsx(XR,{}),n):null};async function QR(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistration();if(!e||!e.waiting)return;e.waiting.postMessage({type:"SKIP_WAITING"}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()},{once:!0})}catch(e){console.error("[SW Update]  Error applying update:",e)}}const eB=()=>{const[e,t]=We.useState(!1);if(We.useEffect(()=>{!function(e={}){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",t=>{t.data,"SW_UPDATE_READY"===t.data?.type&&(e.onUpdateAvailable&&e.onUpdateAvailable(),e.autoReload&&QR())})}({onUpdateAvailable:()=>{t(!0)},autoReload:!1})},[]),!e)return null;return se.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-[9999] animate-in slide-in-from-bottom-5",children:se.jsx("div",{className:"bg-gradient-to-r from-[#4361ee] to-[#7209b7] rounded-xl shadow-2xl border border-white/20 p-4",children:se.jsxs("div",{className:"flex items-start gap-3",children:[se.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0",children:se.jsx(ur,{className:"w-5 h-5 text-white"})}),se.jsxs("div",{className:"flex-1 min-w-0",children:[se.jsx("h3",{className:"font-bold text-white text-sm",children:"Nuova versione disponibile"}),se.jsx("p",{className:"text-white/80 text-xs mt-1",children:"Un aggiornamento  pronto. Aggiorna ora per le ultime funzionalit."}),se.jsxs("div",{className:"flex gap-2 mt-3",children:[se.jsx(mo,{onClick:()=>{QR()},size:"sm",className:"bg-white text-[#4361ee] hover:bg-white/90 font-semibold",children:"Aggiorna"}),se.jsx(mo,{onClick:()=>{t(!1)},size:"sm",variant:"ghost",className:"text-white hover:bg-white/20",children:"Dopo"})]})]})]})})})};function tB(){return We.useEffect(()=>{navigator.userAgent,window.matchMedia("(display-mode: standalone)").matches,window.location.protocol,window.innerWidth,window.innerHeight,window.location.pathname,(new Date).toISOString();const e=getComputedStyle(document.documentElement);e.getPropertyValue("--background").trim(),e.getPropertyValue("--foreground").trim(),e.getPropertyValue("--background").trim(),e.getPropertyValue("--foreground").trim()},[]),zR(),se.jsxs("div",{className:"app-shell",children:[se.jsx(Hr,{}),se.jsx("div",{className:"ios-safe-top"}),se.jsx(an,{fallback:se.jsx("div",{className:"min-h-screen flex items-center justify-center bg-black text-white p-4",children:se.jsxs("div",{className:"glass-card p-6 max-w-md mx-auto text-center",children:[se.jsx("h2",{className:"text-xl font-bold mb-4",children:"ERRORE CRITICO DI SISTEMA"}),se.jsx("p",{className:"mb-6",children:"L'applicazione ha riscontrato un errore fatale. Ricarica la pagina."}),se.jsx("button",{onClick:()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},className:"px-4 py-2 bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink rounded-md",children:" RIAVVIA EMERGENZA"})]})}),children:se.jsx(wR,{children:se.jsx(yR,{children:se.jsxs(fl,{children:[se.jsx(gl,{}),se.jsx(xl,{}),se.jsx(Ei,{children:se.jsx(Qr,{children:se.jsx(Xr,{children:se.jsxs(PR,{children:[se.jsx(AR,{}),se.jsx(IR,{}),se.jsx(BR,{}),se.jsx(ZR,{}),se.jsx(vR,{}),se.jsx(NR,{}),se.jsx(jR,{}),se.jsx(_R,{className:"hidden"}),se.jsx(CR,{className:"hidden"}),se.jsx(go,{}),se.jsx(YR,{}),se.jsx(JR,{}),se.jsx(ca,{}),se.jsx(Oa,{})]})})})})]})})})}),se.jsx(eB,{})]})}let iB=null,aB=null;try{iB=require("i18next"),aB=require("react-i18next").initReactI18next}catch{}const sB=iB;async function rB(){try{const{data:e}=await ba.auth.getSession();return e?.session?.access_token??""}catch{return""}}function nB(){try{return"1"===localStorage.getItem("push:disable")}catch{return!1}}function oB(){try{localStorage.setItem("push:disable","1"),console.warn("[PUSH-KILL] Push notifications disabled by kill switch")}catch(e){console.error("[PUSH-KILL] Failed to set kill switch:",e)}}function lB(){try{return!!window.location.search.includes("__noPush=1")&&(oB(),!0)}catch{return!1}}"undefined"!=typeof window&&(window.pushKillSwitch={disable:oB,enable:function(){try{localStorage.removeItem("push:disable")}catch(e){console.error("[PUSH-KILL] Failed to remove kill switch:",e)}},isDisabled:nB,checkHotfix:lB}),ae(()=>Promise.resolve({}),__vite__mapDeps([21])),window.__M1_NO_SHIM_DUMP__=!0,"undefined"!=typeof window&&(window.__populateKB__=GR),"undefined"!=typeof window&&(window.__M1_BADGE__={get:()=>({...ja}),test:_a,platform:Na()});(async()=>{if("undefined"!=typeof navigator&&"serviceWorker"in navigator&&location.hostname.endsWith(".pages.dev"))try{const e=navigator.serviceWorker.controller?.scriptURL||"";if(!e.endsWith("/sw.js")){const e=await navigator.serviceWorker.register("/sw.js",{scope:"/",updateViaCache:"none"});e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"});const t="sw-main-reload";sessionStorage.getItem(t)||navigator.serviceWorker.addEventListener("controllerchange",()=>{sessionStorage.setItem(t,"1"),location.reload()},{once:!0})}}catch(e){console.warn("SW controller enforcement failed:",e)}})();const cB=async()=>{if("undefined"!=typeof window)try{const[{initPWABadgeDiagnostics:e,createBadgeTestHelpers:t},{initializeGlobalDebugHelpers:i}]=await Promise.all([ae(()=>Promise.resolve().then(()=>ha),void 0),ae(()=>import("./debugHelpers.DH9Zj0Q8.js"),[])]);e(),t(),i()}catch(e){console.warn("PWA Badge diagnostics initialization failed:",e)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",cB):cB();setTimeout(()=>{(async()=>{try{if(lB()||nB())return void console.warn("[PUSH] Kill switch active, skipping push initialization");if(!("serviceWorker"in navigator)||!("PushManager"in window))return void console.warn("[PUSH] Push notifications not supported");let i;try{const e=navigator.serviceWorker.ready,t=new Promise((e,t)=>setTimeout(()=>t(new Error("SW ready timeout")),8e3));if(i=await Promise.race([e,t]),!i?.active)return void console.warn("[PUSH] No active service worker found, deferring")}catch(e){return void console.warn("[PUSH] Service worker not ready:",e)}try{const e=await ae(()=>import("./testFcm.CUs4c0yT.js"),__vite__mapDeps([22,5,3,2,1,7,6,8,9]));e?.testFcmFlow&&(window.testFcmFlow=e.testFcmFlow)}catch(t){console.warn("[PUSH] Push module import failed (non-critical):",t)}}catch(i){console.warn("[PUSH] Push initialization failed (non-critical):",i)}})().catch(e=>console.warn("[PUSH] Deferred push init error (non-critical):",e))},3e3),(()=>{if("undefined"!=typeof window&&"localhost"!==window.location.hostname){const e=console.log,t=console.warn,i=console.error;console.log=(...t)=>{t.length>0&&"string"==typeof t[0]&&(t[0].includes("CRITICAL")||t[0].includes("ERROR"))&&e.apply(console,t)},console.warn=t,console.error=i,console.debug=()=>{},console.info=()=>{}}})(),(()=>{if("undefined"!=typeof window){const e=console.log,t=console.warn,i=console.error;console.log=(...t)=>{(t[0]?.includes("CRITICAL")||t[0]?.includes("SECURITY"))&&e.apply(console,t)},console.warn=t,console.error=i,console.debug=()=>{},console.info=()=>{},console.trace=()=>{}}})(),"undefined"!=typeof window&&"localhost"!==window.location.hostname&&Object.defineProperty(window,"__REACT_DEVTOOLS_GLOBAL_HOOK__",{value:{isDisabled:!0}}),"undefined"!=typeof window&&(ae(async()=>{const{initPerformanceOptimizations:e}=await import("./performanceOptimizer.BWj6DYfN.js");return{initPerformanceOptimizations:e}},[]).then(({initPerformanceOptimizations:e})=>{e()}),ae(async()=>{const{initAccessibilityEnhancements:e}=await import("./accessibilityEnhancer.CVfAesF3.js");return{initAccessibilityEnhancements:e}},[]).then(({initAccessibilityEnhancements:e})=>{e()}),ae(async()=>{const{monitoring:e}=await import("./productionMonitoring.PtFnv4Xs.js");return{monitoring:e}},__vite__mapDeps([23,20,5,3,2,1,7,6,8,9])).then(({monitoring:e})=>{e.trackFeature("app_initialization")}));"undefined"!=typeof window&&"localhost"!==window.location.hostname&&console.warn(" Sentry DSN not configured in production"),"undefined"!=typeof window&&(window.__M1_DEBUG=Object.assign(window.__M1_DEBUG??{},{env:{TERRAIN:!0,CONTOUR:!0,SUPABASE_URL:!0,SUPABASE_ANON_KEY:!0},presence:{status:"INIT",last:null,error:null,count:0},terrain3D:{available:!1,terrainUrl:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=VRJaVKMtkFdyVzhXCjBF",active:!1},ping:e=>console.log("[M1DEBUG]",e)}));const dB=new ii({defaultOptions:{queries:{retry:2,refetchOnWindowFocus:!1,staleTime:3e5}}}),uB=()=>{(()=>{if(!new URLSearchParams(window.location.search).get("diag"))return;if("1"===new URLSearchParams(window.location.search).get("noerr"))return;const e=(e,t)=>{const i=document.getElementById("error-overlay");i&&i.remove();const a=document.createElement("div");a.id="error-overlay",a.style.cssText="\n      position: fixed; top: 0; left: 0; right: 0; bottom: 0; \n      background: rgba(0,0,0,0.97); color: white; z-index: 999999;\n      font-family: 'Courier New', monospace; padding: 20px;\n      overflow: auto; font-size: 14px; backdrop-filter: blur(2px);\n    ";const s=(e?.message||"").includes("getStripe"),r=(e?.message||"").includes("Failed to fetch"),n=(e?.message||"").includes("service worker");a.innerHTML=`\n      <div style="max-width: 900px; margin: 0 auto;">\n        <h2 style="color: #ff6b6b; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">\n          ${s?" STRIPE ERROR":r?" NETWORK ERROR":n?" SERVICE WORKER ERROR":" RUNTIME ERROR"} (${t})\n        </h2>\n        <div style="background: #1a1a2e; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #4361ee;">\n          <strong>${s?" Prova a ricaricare con reset cache o controlla la configurazione Stripe":r?" Verifica la connessione internet o riprova pi tardi":n?" Ricarica la pagina per risolvere i problemi del service worker":" Prova a ricaricare la pagina. Se il problema persiste, usa Reset App"}</strong>\n        </div>\n        <pre style="background: #0f0f23; padding: 15px; border-radius: 8px; white-space: pre-wrap; font-size: 12px; max-height: 300px; overflow: auto; border: 1px solid #333;">\n${e?.stack||e?.message||String(e)}\n        </pre>\n        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">\n          <button onclick="this.parentElement.parentElement.parentElement.remove()" \n                  style="background: #333; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">\n             Chiudi\n          </button>\n          <button onclick="if('caches' in window){caches.keys().then(n => n.forEach(name => caches.delete(name))).finally(() => window.location.reload());} else {window.location.reload();}" \n                  style="background: #4361ee; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">\n             Ricarica + Cache Reset\n          </button>\n          <button onclick="localStorage.setItem('push:disable', '1'); window.location.reload();" \n                  style="background: #f39c12; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">\n             Disabilita Push\n          </button>\n          <button onclick="localStorage.clear(); sessionStorage.clear(); window.location.href='/app-reset.html';" \n                  style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">\n             Reset App Completo\n          </button>\n          <button onclick="window.location.href='/?noerr=1'" \n                  style="background: #666; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">\n             Disabilita Overlay\n          </button>\n        </div>\n        <div style="margin-top: 15px; padding: 10px; background: #16213e; border-radius: 6px; font-size: 11px; color: #a0a0a0;">\n          <strong>Debug Info:</strong> ${navigator.userAgent.includes("Mobile")?" Mobile":" Desktop"} | \n          ${"capacitor:"===window.location.protocol?" Capacitor":" Web"} | \n          SW: ${navigator.serviceWorker?.controller?.scriptURL?.split("/").pop()||"None"}\n        </div>\n      </div>\n    `,document.body.appendChild(a)};window.addEventListener("error",t=>{e(t.error,"JavaScript Error")}),window.addEventListener("unhandledrejection",t=>{e(t.reason,"Promise Rejection")})})();const e=document.getElementById("root");if(!e){console.error(" Root element not found!");const e=document.createElement("div");return e.innerHTML='\n      <div style="padding: 20px; color: white; background: black; text-align: center;">\n        <h1> CRITICAL ERROR</h1>\n        <p>Root element not found. Please refresh the page.</p>\n        <button onclick="window.location.reload()" style="background: #333; color: white; padding: 8px 16px; margin-top: 16px; border: none; border-radius: 4px; cursor: pointer;">\n           Ricarica App\n        </button>\n      </div>\n    ',void document.body.appendChild(e)}try{Qe.createRoot(e).render(se.jsx($N,{i18n:sB,children:se.jsx(si,{client:dB,children:se.jsx(Ze.Suspense,{fallback:se.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:se.jsxs("div",{className:"text-center space-y-4",children:[se.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),se.jsx("p",{className:"text-muted-foreground font-orbitron",children:"Inizializzazione M1SSION..."}),se.jsx("div",{className:"text-xs text-muted-foreground",children:"Se il caricamento si blocca, ricarica la pagina"})]})}),children:se.jsx(tB,{})})})}))}catch(t){if(console.error("[BOOT] CRITICAL ERROR RENDERING APP:",t),e){const i=document.createElement("div");i.style.cssText="\n        padding: 20px;\n        color: white;\n        background: linear-gradient(135deg, #000, #111);\n        min-height: 100vh;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        text-align: center;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n      ",i.innerHTML=`\n        <h1 style="color: #ff4444; margin-bottom: 20px;"> ERRORE CRITICO DI SISTEMA</h1>\n        <p style="margin-bottom: 20px; max-width: 500px;">\n          L'applicazione M1SSION ha riscontrato un errore critico. \n          Usa i bottoni sotto per riavviare l'app.\n        </p>\n        <div style="margin-top: 20px;">\n          <button \n            onclick="window.location.reload()" \n            style="\n              background: linear-gradient(135deg, #4361ee, #7209b7);\n              color: white;\n              padding: 12px 24px;\n              margin: 8px;\n              border: none;\n              border-radius: 8px;\n              cursor: pointer;\n              font-size: 16px;\n            "\n          >\n             Ricarica App\n          </button>\n          <button \n            onclick="localStorage.clear(); sessionStorage.clear(); window.location.reload();" \n            style="\n              background: #333;\n              color: white;\n              padding: 12px 24px;\n              margin: 8px;\n              border: none;\n              border-radius: 8px;\n              cursor: pointer;\n              font-size: 16px;\n            "\n          >\n             Reset Completo\n          </button>\n        </div>\n        <details style="margin-top: 20px; max-width: 600px; text-align: left;">\n          <summary style="cursor: pointer; margin-bottom: 10px; color: #aaa;">Dettagli tecnici</summary>\n          <pre style="background: #111; padding: 10px; border-radius: 4px; overflow: auto; font-size: 12px;">${t?.stack||t?.message||String(t)}</pre>\n        </details>\n        <div style="margin-top: 30px; font-size: 12px; color: #666;">\n          M1SSION  2025 Joseph MUL  NIYVORA KFT\n        </div>\n      `,e.appendChild(i)}}},hB=(e,t)=>{window.location.search.includes("debug=1")};async function mB(){try{"undefined"!=typeof window&&"serviceWorker"in navigator&&(await(async()=>{if("serviceWorker"in navigator)try{const e=navigator.serviceWorker.controller,t=window.location.hostname.includes("pages.dev");if(hB(),hB(),t&&(!e||!e.scriptURL.endsWith("/sw.js"))){const e=await navigator.serviceWorker.getRegistrations();for(const a of e)a.scope!==window.location.origin+"/"||a.active?.scriptURL.endsWith("/sw.js")||(a.active,await a.unregister());const t=await navigator.serviceWorker.register("/sw.js",{scope:"/",updateViaCache:"none"});await t.update();const i=()=>{const e=document.createElement("div");e.style.cssText="\n          position: fixed; top: 20px; right: 20px; z-index: 999999;\n          background: #4361ee; color: white; padding: 12px 20px;\n          border-radius: 8px; font-family: sans-serif; font-size: 14px;\n          box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        ",e.textContent=" Aggiornamento app...",document.body.appendChild(e),setTimeout(()=>{e.remove(),window.location.reload()},1500)};navigator.serviceWorker.addEventListener("controllerchange",i,{once:!0})}}catch(e){console.warn("[SW-ENFORCE] Failed (non-critical):",e)}})(),ae(()=>import("./swControllerGuard.CP1PtwN6.js"),[]).then(async({ensureAppSWController:e,logActiveSWs:t})=>{try{const i=await e();await t(),i||console.warn("[MAIN]  SW Controller Guard failed but app continues")}catch(i){console.warn("[MAIN] SW guard failed (non-critical):",i)}})),uB()}catch(e){console.error("[MAIN] Init with SW guard failed:",e),uB()}}if("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{mB()}):mB(),"undefined"!=typeof window){setTimeout(()=>{ae(async()=>{const{initSilentAutoUpdate:e}=await import("./silentAutoUpdate.D2AbUBHy.js");return{initSilentAutoUpdate:e}},[]).then(({initSilentAutoUpdate:e})=>{e({debug:!1}).catch(e=>{console.warn("[MAIN] Silent auto-update init failed (non-critical):",e)})})},2500);setTimeout(()=>{try{const e="1"===new URLSearchParams(window.location.search).get("M1_DIAG");e&&ae(async()=>{const{diagnostics:e}=await import("./interestSignals.Bd4q-fDM.js");return{diagnostics:e}},__vite__mapDeps([20,5,3,2,1,7,6,8,9])).then(({diagnostics:e})=>{window.__M1_SIG__=e,Object.keys(e)}),ae(async()=>{const{initAutoInterestSignals:e}=await import("./useAutoInterestSignals.Uq2e0Uow.js");return{initAutoInterestSignals:e}},__vite__mapDeps([19,2,20,5,3,1,7,6,8,9])).then(({initAutoInterestSignals:e})=>{e()}).catch(e=>{console.warn("[MAIN] Interest signals init failed (non-critical):",e)})}catch(e){console.warn("[MAIN] Interest signals setup failed (non-critical):",e)}},3e3),setTimeout(()=>{location.search.includes("M1_DIAG=1")&&(window.__M1_NOTIF_TEST__={...window.__M1_NOTIF_TEST__,async dryRunPref(e,t=5,i){const a=new URLSearchParams({user_id:e,max:String(t),diag:"1"});null!=i&&a.set("cooldown",String(i));const s=`${pa}/notifier-engine`,r=await fetch(`${s}/dry-run?${a.toString()}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await rB()}`}});if(!r.ok){const e=await r.text();return console.error(" [DRY-RUN] HTTP Error:",r.status,e),{error:`HTTP ${r.status}: ${e}`}}const n=await r.json();return Array.isArray(n?.candidates_sample)&&n.candidates_sample.length>0&&console.table(n.candidates_sample.map(e=>({ID:e.id?.substring(0,8)+"...",Title:e.title?.substring(0,50)+"...",Score:e.score?.toFixed(2),Tags:e.tags?.slice(0,3).join(","),Published:e.published_at?new Date(e.published_at).toLocaleDateString():"N/A"}))),n},async triggerPrefFallback(){try{const{data:{user:e}}=await ba.auth.getUser();if(!e)throw new Error("No authenticated user");const{data:t,error:i}=await ba.rpc("fn_candidates_for_user",{p_user_id:e.id,p_limit:3});return i?(console.error(" TEST: Error getting candidates:",i),{error:i.message}):(console.table(t),{success:!0,user_id:e.id,candidates_count:t?.length||0,candidates:t||[]})}catch(e){return console.error(" TEST: Error in triggerPrefFallback:",e),{error:e.message}}},async checkQuota(){try{const{data:{user:e}}=await ba.auth.getUser();if(!e)throw new Error("No authenticated user");const{data:t,error:i}=await ba.from("notification_quota").select("*").eq("user_id",e.id).single();return{user_id:e.id,quota:t||"No quota record",error:i?.message}}catch(e){return console.error(" TEST: Error checking quota:",e),{error:e.message}}},async testCandidates(e){try{const{data:{user:t}}=await ba.auth.getUser(),i=e||t?.id;if(!i)throw new Error("No user ID provided");const{data:a,error:s}=await ba.from("v_user_resolved_tags").select("*").eq("user_id",i).single(),{data:r,error:n}=await ba.from("external_feed_items").select("id, title, tags, score, published_at").gte("published_at",new Date(Date.now()-2592e5).toISOString()).gte("score",.72).order("published_at",{ascending:!1}).limit(10),{data:o,error:l}=await ba.rpc("fn_candidates_for_user",{p_user_id:i,p_limit:5}),c={user_id:i,user_tags:a||"No tags resolved",tags_error:s?.message,feed_items_count:r?.length||0,feed_error:n?.message,recent_items:r||[],candidates_count:o?.length||0,candidates_error:l?.message,candidates:o||[]};return console.table(o),c}catch(t){return console.error(" TEST: Error in testCandidates:",t),{error:t.message}}}})},100)}window.addEventListener("error",e=>{console.error(" GLOBAL ERROR CAUGHT:",{message:e.error?.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})}),window.addEventListener("unhandledrejection",e=>{console.error(" UNHANDLED PROMISE REJECTION:",{reason:e.reason,promise:e.promise})}),"undefined"!=typeof window&&(window.location.protocol,window.location.hostname,window.location.protocol,navigator.userAgent,(new Date).toISOString(),"capacitor:"===window.location.protocol||window.Capacitor?ae(async()=>{const{initializePWA:e}=await Promise.resolve().then(()=>Rl);return{initializePWA:e}},void 0).then(({initializePWA:e})=>{e()}):ae(async()=>{const{optimizePWATouchGestures:e}=await Promise.resolve().then(()=>Rl);return{optimizePWATouchGestures:e}},void 0).then(({optimizePWATouchGestures:e})=>{e()}));export{sn as $,Za as A,fc as B,Wl as C,ks as D,Xa as E,kR as F,CR as G,Vl as H,Sl as I,Dc as J,js as K,jl as L,Ua as M,vr as N,UA as O,rr as P,qA as Q,ur as R,rd as S,Wb as T,Lr as U,Es as V,Is as W,ys as X,ma as Y,Ar as Z,nw as _,mc as a,jw as a0,Zs as a1,eN as a2,xs as a3,to as a4,io as a5,ao as a6,so as a7,pk as a8,ow as a9,II as aa,$r as ab,Hl as b,Zl as c,Gl as d,bs as e,mo as f,cz as g,us as h,pa as i,mO as j,fr as k,Fr as l,RO as m,BO as n,SA as o,kA as p,_A as q,zA as r,ba as s,EA as t,Ai as u,Cr as v,Ki as w,Dz as x,yr as y,_R as z};
