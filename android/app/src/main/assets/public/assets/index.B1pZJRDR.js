const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mapStore.B1lXQE0D.js","assets/three-vendor.wwSanNQ8.js","assets/react-vendor.CAU3V3le.js","assets/ui-vendor.DoN6OTIp.js","assets/MapTiler3D.BXeIrYtB.js","assets/animation-vendor.Bezovbgp.js","assets/supabase-vendor.CghLtY7N.js","assets/map-vendor.Dz2XYzxS.js","assets/stripe-vendor.BaJG9Xy1.js","assets/router-vendor.opNAzTki.js","assets/MapTiler3D.M2I7egcV.css","assets/contextBuilder.Bvl_gp-a.js","assets/index.es.Dl-oCgzs.js","assets/SimpleClickMap.DdksGzxx.js","assets/MarkersHealthcheck.ADG4aDzB.js","assets/PushDebug.DnEXtAtD.js","assets/UserPushConsolePage.Bv4wVJez.js","assets/android-push-test.wVDnxbof.js","assets/native-push-test.BaM7h6BR.js","assets/BillingSmokeTest.Dvf6qhqR.js","assets/DevStripeKeysSetup.ClH9ZdiZ.js","assets/useAutoInterestSignals.DFpFZ3QE.js","assets/interestSignals.BiRej29D.js","assets/prod-hide-debug.CBE4uU49.css","assets/testFcm.CE2PAImO.js","assets/productionMonitoring.CmJ7ihhv.js"])))=>i.map(i=>d[i]);
import { s as shimExports, _ as __vitePreload, c as create$1, p as persist, S as Scene, a as PerspectiveCamera, W as WebGLRenderer, I as IcosahedronGeometry, M as MeshStandardMaterial, C as Color, b as Mesh, A as AmbientLight, d as PointLight, e as Controls, V as Vector3, f as MOUSE, T as TOUCH, Q as Quaternion, g as Spherical, h as Vector2, R as Ray, i as Plane, j as MathUtils, k as SphereGeometry, l as MeshBasicMaterial, m as InstancedMesh, n as Matrix4, o as Raycaster, L as LineCurve3, q as TubeGeometry, r as ShaderMaterial, t as AdditiveBlending, u as SRGBColorSpace, v as ACESFilmicToneMapping, F as Fog, G as Group, B as BufferGeometry, w as BufferAttribute, E as EdgesGeometry, x as LineBasicMaterial, y as LineSegments, z as Clock$1, D as client$1 } from './three-vendor.wwSanNQ8.js';
import { j as jsxRuntimeExports, c as composeRefs, u as useCallbackRef, b as useLayoutEffect2, O as Overlay, P as Portal$1, C as Content, d as Close, T as Title, D as Description, e as createDialogScope, f as useComposedRefs, W as WarningProvider, g as createContextScope$2, h as composeEventHandlers, R as Root$3, i as Trigger$1, k as createPopperScope, l as useDirection, m as useControllableState, n as Root2$3, o as useId, p as createCollection, q as Primitive$3, V as VISUALLY_HIDDEN_STYLES, A as Anchor, r as Portal$2, s as hideOthers, v as useFocusGuards, w as ReactRemoveScroll, F as FocusScope, x as DismissableLayer, y as Content$1, z as Arrow, B as Presence, E as useSize, G as createRovingFocusGroupScope, H as Root$4, I as Item$1 } from './ui-vendor.DoN6OTIp.js';
import { c as createClient } from './supabase-vendor.CghLtY7N.js';
import { r as reactExports, R as React, c as React$1, b as ReactDOM, d as getDefaultExportFromCjs, a as reactDomExports } from './react-vendor.CAU3V3le.js';
import { m as motion, A as AnimatePresence, u as useLottie, L as LayoutGroup } from './animation-vendor.Bezovbgp.js';
import { L as L$2, M as MapContainer, T as TileLayer, a as Marker, P as Popup, C as Circle$1, u as useMapEvents } from './map-vendor.Dz2XYzxS.js';
import { l as loadStripe, E as Elements, u as useStripe, a as useElements, C as CardElement } from './stripe-vendor.BaJG9Xy1.js';
import { u as useParams$1, a as useNavigate } from './router-vendor.opNAzTki.js';

true&&(function polyfill() {
  const relList = document.createElement("link").relList;
  if (relList && relList.supports && relList.supports("modulepreload")) {
    return;
  }
  for (const link of document.querySelectorAll('link[rel="modulepreload"]')) {
    processPreload(link);
  }
  new MutationObserver((mutations) => {
    for (const mutation of mutations) {
      if (mutation.type !== "childList") {
        continue;
      }
      for (const node of mutation.addedNodes) {
        if (node.tagName === "LINK" && node.rel === "modulepreload")
          processPreload(node);
      }
    }
  }).observe(document, { childList: true, subtree: true });
  function getFetchOpts(link) {
    const fetchOpts = {};
    if (link.integrity) fetchOpts.integrity = link.integrity;
    if (link.referrerPolicy) fetchOpts.referrerPolicy = link.referrerPolicy;
    if (link.crossOrigin === "use-credentials")
      fetchOpts.credentials = "include";
    else if (link.crossOrigin === "anonymous") fetchOpts.credentials = "omit";
    else fetchOpts.credentials = "same-origin";
    return fetchOpts;
  }
  function processPreload(link) {
    if (link.ep)
      return;
    link.ep = true;
    const fetchOpts = getFetchOpts(link);
    fetch(link.href, fetchOpts);
  }
}());

const SUPABASE_URL = "https://vkjrqirvdvjbemsfzxof.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk";
const supabase = createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true
  }
});

const client = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  supabase
}, Symbol.toStringTag, { value: 'Module' }));

function getProjectRef$1() {
  const url = supabase.supabaseUrl || "";
  const match = url.match(/https:\/\/([^.]+)\.supabase\.co/);
  return match?.[1] || "vkjrqirvdvjbemsfzxof";
}
function getSupabaseUrl() {
  return supabase.supabaseUrl || "https://vkjrqirvdvjbemsfzxof.supabase.co";
}
function getSupabaseAnonKey() {
  return supabase.supabaseKey || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk";
}
function getFunctionsUrl() {
  const baseUrl = getSupabaseUrl();
  return `${baseUrl.replace(/\/$/, "")}/functions/v1`;
}
function getAuthTokenKey() {
  return `sb-${getProjectRef$1()}-auth-token`;
}
function getSupabaseConfig() {
  return {
    projectRef: getProjectRef$1(),
    url: getSupabaseUrl(),
    anonKey: getSupabaseAnonKey(),
    functionsUrl: getFunctionsUrl()
  };
}

const clientUtils = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  getAuthTokenKey,
  getFunctionsUrl,
  getProjectRef: getProjectRef$1,
  getSupabaseAnonKey,
  getSupabaseConfig,
  getSupabaseUrl
}, Symbol.toStringTag, { value: 'Module' }));

async function ensureSWAnyHost() {
  if (!("serviceWorker" in navigator)) {
    console.log("[SW-ANYHOST] Service Worker not supported");
    return null;
  }
  try {
    const existing = await navigator.serviceWorker.getRegistration("/");
    if (existing?.active?.scriptURL.includes("/sw.js")) {
      console.log("[SW-ANYHOST] ✅ /sw.js already active");
      return existing;
    }
    console.log("[SW-ANYHOST] Registering /sw.js for all hosts...");
    const registration = await navigator.serviceWorker.register("/sw.js", {
      scope: "/",
      updateViaCache: "none"
    });
    await navigator.serviceWorker.ready;
    console.log("[SW-ANYHOST] ✅ /sw.js registered and ready");
    return registration;
  } catch (error) {
    const errStr = String(error?.message || error || "");
    if (errStr.includes("503") || errStr.includes("ERR_FAILED") || errStr.includes("failed to fetch")) {
      console.warn("[SW-ANYHOST] ⚠️ SW registration warning (503/network):", errStr);
    } else {
      console.warn("[SW-ANYHOST] Registration failed (non-critical):", error);
    }
    return null;
  }
}

(async () => {
  try {
    await ensureSWAnyHost();
  } catch (error) {
    console.warn("[SW-AUTORUN] Auto-registration failed (non-critical):", error);
  }
})();

// src/subscribable.ts
var Subscribable = class {
  constructor() {
    this.listeners = /* @__PURE__ */ new Set();
    this.subscribe = this.subscribe.bind(this);
  }
  subscribe(listener) {
    this.listeners.add(listener);
    this.onSubscribe();
    return () => {
      this.listeners.delete(listener);
      this.onUnsubscribe();
    };
  }
  hasListeners() {
    return this.listeners.size > 0;
  }
  onSubscribe() {
  }
  onUnsubscribe() {
  }
};

var defaultTimeoutProvider = {
  // We need the wrapper function syntax below instead of direct references to
  // global setTimeout etc.
  //
  // BAD: `setTimeout: setTimeout`
  // GOOD: `setTimeout: (cb, delay) => setTimeout(cb, delay)`
  //
  // If we use direct references here, then anything that wants to spy on or
  // replace the global setTimeout (like tests) won't work since we'll already
  // have a hard reference to the original implementation at the time when this
  // file was imported.
  setTimeout: (callback, delay) => setTimeout(callback, delay),
  clearTimeout: (timeoutId) => clearTimeout(timeoutId),
  setInterval: (callback, delay) => setInterval(callback, delay),
  clearInterval: (intervalId) => clearInterval(intervalId)
};
var TimeoutManager = class {
  // We cannot have TimeoutManager<T> as we must instantiate it with a concrete
  // type at app boot; and if we leave that type, then any new timer provider
  // would need to support ReturnType<typeof setTimeout>, which is infeasible.
  //
  // We settle for type safety for the TimeoutProvider type, and accept that
  // this class is unsafe internally to allow for extension.
  #provider = defaultTimeoutProvider;
  #providerCalled = false;
  setTimeoutProvider(provider) {
    this.#provider = provider;
  }
  setTimeout(callback, delay) {
    return this.#provider.setTimeout(callback, delay);
  }
  clearTimeout(timeoutId) {
    this.#provider.clearTimeout(timeoutId);
  }
  setInterval(callback, delay) {
    return this.#provider.setInterval(callback, delay);
  }
  clearInterval(intervalId) {
    this.#provider.clearInterval(intervalId);
  }
};
var timeoutManager = new TimeoutManager();
function systemSetTimeoutZero(callback) {
  setTimeout(callback, 0);
}

var isServer = typeof window === "undefined" || "Deno" in globalThis;
function noop$1() {
}
function functionalUpdate(updater, input) {
  return typeof updater === "function" ? updater(input) : updater;
}
function isValidTimeout(value) {
  return typeof value === "number" && value >= 0 && value !== Infinity;
}
function timeUntilStale(updatedAt, staleTime) {
  return Math.max(updatedAt + (staleTime || 0) - Date.now(), 0);
}
function resolveStaleTime(staleTime, query) {
  return typeof staleTime === "function" ? staleTime(query) : staleTime;
}
function resolveEnabled(enabled, query) {
  return typeof enabled === "function" ? enabled(query) : enabled;
}
function matchQuery(filters, query) {
  const {
    type = "all",
    exact,
    fetchStatus,
    predicate,
    queryKey,
    stale
  } = filters;
  if (queryKey) {
    if (exact) {
      if (query.queryHash !== hashQueryKeyByOptions(queryKey, query.options)) {
        return false;
      }
    } else if (!partialMatchKey(query.queryKey, queryKey)) {
      return false;
    }
  }
  if (type !== "all") {
    const isActive = query.isActive();
    if (type === "active" && !isActive) {
      return false;
    }
    if (type === "inactive" && isActive) {
      return false;
    }
  }
  if (typeof stale === "boolean" && query.isStale() !== stale) {
    return false;
  }
  if (fetchStatus && fetchStatus !== query.state.fetchStatus) {
    return false;
  }
  if (predicate && !predicate(query)) {
    return false;
  }
  return true;
}
function matchMutation(filters, mutation) {
  const { exact, status, predicate, mutationKey } = filters;
  if (mutationKey) {
    if (!mutation.options.mutationKey) {
      return false;
    }
    if (exact) {
      if (hashKey(mutation.options.mutationKey) !== hashKey(mutationKey)) {
        return false;
      }
    } else if (!partialMatchKey(mutation.options.mutationKey, mutationKey)) {
      return false;
    }
  }
  if (status && mutation.state.status !== status) {
    return false;
  }
  if (predicate && !predicate(mutation)) {
    return false;
  }
  return true;
}
function hashQueryKeyByOptions(queryKey, options) {
  const hashFn = options?.queryKeyHashFn || hashKey;
  return hashFn(queryKey);
}
function hashKey(queryKey) {
  return JSON.stringify(
    queryKey,
    (_, val) => isPlainObject(val) ? Object.keys(val).sort().reduce((result, key) => {
      result[key] = val[key];
      return result;
    }, {}) : val
  );
}
function partialMatchKey(a, b) {
  if (a === b) {
    return true;
  }
  if (typeof a !== typeof b) {
    return false;
  }
  if (a && b && typeof a === "object" && typeof b === "object") {
    return Object.keys(b).every((key) => partialMatchKey(a[key], b[key]));
  }
  return false;
}
var hasOwn = Object.prototype.hasOwnProperty;
function replaceEqualDeep(a, b) {
  if (a === b) {
    return a;
  }
  const array = isPlainArray(a) && isPlainArray(b);
  if (!array && !(isPlainObject(a) && isPlainObject(b))) return b;
  const aItems = array ? a : Object.keys(a);
  const aSize = aItems.length;
  const bItems = array ? b : Object.keys(b);
  const bSize = bItems.length;
  const copy = array ? new Array(bSize) : {};
  let equalItems = 0;
  for (let i = 0; i < bSize; i++) {
    const key = array ? i : bItems[i];
    const aItem = a[key];
    const bItem = b[key];
    if (aItem === bItem) {
      copy[key] = aItem;
      if (array ? i < aSize : hasOwn.call(a, key)) equalItems++;
      continue;
    }
    if (aItem === null || bItem === null || typeof aItem !== "object" || typeof bItem !== "object") {
      copy[key] = bItem;
      continue;
    }
    const v = replaceEqualDeep(aItem, bItem);
    copy[key] = v;
    if (v === aItem) equalItems++;
  }
  return aSize === bSize && equalItems === aSize ? a : copy;
}
function isPlainArray(value) {
  return Array.isArray(value) && value.length === Object.keys(value).length;
}
function isPlainObject(o) {
  if (!hasObjectPrototype(o)) {
    return false;
  }
  const ctor = o.constructor;
  if (ctor === void 0) {
    return true;
  }
  const prot = ctor.prototype;
  if (!hasObjectPrototype(prot)) {
    return false;
  }
  if (!prot.hasOwnProperty("isPrototypeOf")) {
    return false;
  }
  if (Object.getPrototypeOf(o) !== Object.prototype) {
    return false;
  }
  return true;
}
function hasObjectPrototype(o) {
  return Object.prototype.toString.call(o) === "[object Object]";
}
function sleep$1(timeout) {
  return new Promise((resolve) => {
    timeoutManager.setTimeout(resolve, timeout);
  });
}
function replaceData(prevData, data, options) {
  if (typeof options.structuralSharing === "function") {
    return options.structuralSharing(prevData, data);
  } else if (options.structuralSharing !== false) {
    return replaceEqualDeep(prevData, data);
  }
  return data;
}
function addToEnd(items, item, max = 0) {
  const newItems = [...items, item];
  return max && newItems.length > max ? newItems.slice(1) : newItems;
}
function addToStart(items, item, max = 0) {
  const newItems = [item, ...items];
  return max && newItems.length > max ? newItems.slice(0, -1) : newItems;
}
var skipToken = Symbol();
function ensureQueryFn(options, fetchOptions) {
  if (!options.queryFn && fetchOptions?.initialPromise) {
    return () => fetchOptions.initialPromise;
  }
  if (!options.queryFn || options.queryFn === skipToken) {
    return () => Promise.reject(new Error(`Missing queryFn: '${options.queryHash}'`));
  }
  return options.queryFn;
}

var FocusManager = class extends Subscribable {
  #focused;
  #cleanup;
  #setup;
  constructor() {
    super();
    this.#setup = (onFocus) => {
      if (!isServer && window.addEventListener) {
        const listener = () => onFocus();
        window.addEventListener("visibilitychange", listener, false);
        return () => {
          window.removeEventListener("visibilitychange", listener);
        };
      }
      return;
    };
  }
  onSubscribe() {
    if (!this.#cleanup) {
      this.setEventListener(this.#setup);
    }
  }
  onUnsubscribe() {
    if (!this.hasListeners()) {
      this.#cleanup?.();
      this.#cleanup = void 0;
    }
  }
  setEventListener(setup) {
    this.#setup = setup;
    this.#cleanup?.();
    this.#cleanup = setup((focused) => {
      if (typeof focused === "boolean") {
        this.setFocused(focused);
      } else {
        this.onFocus();
      }
    });
  }
  setFocused(focused) {
    const changed = this.#focused !== focused;
    if (changed) {
      this.#focused = focused;
      this.onFocus();
    }
  }
  onFocus() {
    const isFocused = this.isFocused();
    this.listeners.forEach((listener) => {
      listener(isFocused);
    });
  }
  isFocused() {
    if (typeof this.#focused === "boolean") {
      return this.#focused;
    }
    return globalThis.document?.visibilityState !== "hidden";
  }
};
var focusManager = new FocusManager();

// src/thenable.ts
function pendingThenable() {
  let resolve;
  let reject;
  const thenable = new Promise((_resolve, _reject) => {
    resolve = _resolve;
    reject = _reject;
  });
  thenable.status = "pending";
  thenable.catch(() => {
  });
  function finalize(data) {
    Object.assign(thenable, data);
    delete thenable.resolve;
    delete thenable.reject;
  }
  thenable.resolve = (value) => {
    finalize({
      status: "fulfilled",
      value
    });
    resolve(value);
  };
  thenable.reject = (reason) => {
    finalize({
      status: "rejected",
      reason
    });
    reject(reason);
  };
  return thenable;
}

// src/notifyManager.ts
var defaultScheduler = systemSetTimeoutZero;
function createNotifyManager() {
  let queue = [];
  let transactions = 0;
  let notifyFn = (callback) => {
    callback();
  };
  let batchNotifyFn = (callback) => {
    callback();
  };
  let scheduleFn = defaultScheduler;
  const schedule = (callback) => {
    if (transactions) {
      queue.push(callback);
    } else {
      scheduleFn(() => {
        notifyFn(callback);
      });
    }
  };
  const flush = () => {
    const originalQueue = queue;
    queue = [];
    if (originalQueue.length) {
      scheduleFn(() => {
        batchNotifyFn(() => {
          originalQueue.forEach((callback) => {
            notifyFn(callback);
          });
        });
      });
    }
  };
  return {
    batch: (callback) => {
      let result;
      transactions++;
      try {
        result = callback();
      } finally {
        transactions--;
        if (!transactions) {
          flush();
        }
      }
      return result;
    },
    /**
     * All calls to the wrapped function will be batched.
     */
    batchCalls: (callback) => {
      return (...args) => {
        schedule(() => {
          callback(...args);
        });
      };
    },
    schedule,
    /**
     * Use this method to set a custom notify function.
     * This can be used to for example wrap notifications with `React.act` while running tests.
     */
    setNotifyFunction: (fn) => {
      notifyFn = fn;
    },
    /**
     * Use this method to set a custom function to batch notifications together into a single tick.
     * By default React Query will use the batch function provided by ReactDOM or React Native.
     */
    setBatchNotifyFunction: (fn) => {
      batchNotifyFn = fn;
    },
    setScheduler: (fn) => {
      scheduleFn = fn;
    }
  };
}
var notifyManager = createNotifyManager();

// src/onlineManager.ts
var OnlineManager = class extends Subscribable {
  #online = true;
  #cleanup;
  #setup;
  constructor() {
    super();
    this.#setup = (onOnline) => {
      if (!isServer && window.addEventListener) {
        const onlineListener = () => onOnline(true);
        const offlineListener = () => onOnline(false);
        window.addEventListener("online", onlineListener, false);
        window.addEventListener("offline", offlineListener, false);
        return () => {
          window.removeEventListener("online", onlineListener);
          window.removeEventListener("offline", offlineListener);
        };
      }
      return;
    };
  }
  onSubscribe() {
    if (!this.#cleanup) {
      this.setEventListener(this.#setup);
    }
  }
  onUnsubscribe() {
    if (!this.hasListeners()) {
      this.#cleanup?.();
      this.#cleanup = void 0;
    }
  }
  setEventListener(setup) {
    this.#setup = setup;
    this.#cleanup?.();
    this.#cleanup = setup(this.setOnline.bind(this));
  }
  setOnline(online) {
    const changed = this.#online !== online;
    if (changed) {
      this.#online = online;
      this.listeners.forEach((listener) => {
        listener(online);
      });
    }
  }
  isOnline() {
    return this.#online;
  }
};
var onlineManager = new OnlineManager();

// src/retryer.ts
function defaultRetryDelay(failureCount) {
  return Math.min(1e3 * 2 ** failureCount, 3e4);
}
function canFetch(networkMode) {
  return (networkMode ?? "online") === "online" ? onlineManager.isOnline() : true;
}
var CancelledError = class extends Error {
  constructor(options) {
    super("CancelledError");
    this.revert = options?.revert;
    this.silent = options?.silent;
  }
};
function createRetryer(config) {
  let isRetryCancelled = false;
  let failureCount = 0;
  let continueFn;
  const thenable = pendingThenable();
  const isResolved = () => thenable.status !== "pending";
  const cancel = (cancelOptions) => {
    if (!isResolved()) {
      const error = new CancelledError(cancelOptions);
      reject(error);
      config.onCancel?.(error);
    }
  };
  const cancelRetry = () => {
    isRetryCancelled = true;
  };
  const continueRetry = () => {
    isRetryCancelled = false;
  };
  const canContinue = () => focusManager.isFocused() && (config.networkMode === "always" || onlineManager.isOnline()) && config.canRun();
  const canStart = () => canFetch(config.networkMode) && config.canRun();
  const resolve = (value) => {
    if (!isResolved()) {
      continueFn?.();
      thenable.resolve(value);
    }
  };
  const reject = (value) => {
    if (!isResolved()) {
      continueFn?.();
      thenable.reject(value);
    }
  };
  const pause = () => {
    return new Promise((continueResolve) => {
      continueFn = (value) => {
        if (isResolved() || canContinue()) {
          continueResolve(value);
        }
      };
      config.onPause?.();
    }).then(() => {
      continueFn = void 0;
      if (!isResolved()) {
        config.onContinue?.();
      }
    });
  };
  const run = () => {
    if (isResolved()) {
      return;
    }
    let promiseOrValue;
    const initialPromise = failureCount === 0 ? config.initialPromise : void 0;
    try {
      promiseOrValue = initialPromise ?? config.fn();
    } catch (error) {
      promiseOrValue = Promise.reject(error);
    }
    Promise.resolve(promiseOrValue).then(resolve).catch((error) => {
      if (isResolved()) {
        return;
      }
      const retry = config.retry ?? (isServer ? 0 : 3);
      const retryDelay = config.retryDelay ?? defaultRetryDelay;
      const delay = typeof retryDelay === "function" ? retryDelay(failureCount, error) : retryDelay;
      const shouldRetry = retry === true || typeof retry === "number" && failureCount < retry || typeof retry === "function" && retry(failureCount, error);
      if (isRetryCancelled || !shouldRetry) {
        reject(error);
        return;
      }
      failureCount++;
      config.onFail?.(failureCount, error);
      sleep$1(delay).then(() => {
        return canContinue() ? void 0 : pause();
      }).then(() => {
        if (isRetryCancelled) {
          reject(error);
        } else {
          run();
        }
      });
    });
  };
  return {
    promise: thenable,
    status: () => thenable.status,
    cancel,
    continue: () => {
      continueFn?.();
      return thenable;
    },
    cancelRetry,
    continueRetry,
    canStart,
    start: () => {
      if (canStart()) {
        run();
      } else {
        pause().then(run);
      }
      return thenable;
    }
  };
}

// src/removable.ts
var Removable = class {
  #gcTimeout;
  destroy() {
    this.clearGcTimeout();
  }
  scheduleGc() {
    this.clearGcTimeout();
    if (isValidTimeout(this.gcTime)) {
      this.#gcTimeout = timeoutManager.setTimeout(() => {
        this.optionalRemove();
      }, this.gcTime);
    }
  }
  updateGcTime(newGcTime) {
    this.gcTime = Math.max(
      this.gcTime || 0,
      newGcTime ?? (isServer ? Infinity : 5 * 60 * 1e3)
    );
  }
  clearGcTimeout() {
    if (this.#gcTimeout) {
      timeoutManager.clearTimeout(this.#gcTimeout);
      this.#gcTimeout = void 0;
    }
  }
};

var Query = class extends Removable {
  #initialState;
  #revertState;
  #cache;
  #client;
  #retryer;
  #defaultOptions;
  #abortSignalConsumed;
  constructor(config) {
    super();
    this.#abortSignalConsumed = false;
    this.#defaultOptions = config.defaultOptions;
    this.setOptions(config.options);
    this.observers = [];
    this.#client = config.client;
    this.#cache = this.#client.getQueryCache();
    this.queryKey = config.queryKey;
    this.queryHash = config.queryHash;
    this.#initialState = getDefaultState$1(this.options);
    this.state = config.state ?? this.#initialState;
    this.scheduleGc();
  }
  get meta() {
    return this.options.meta;
  }
  get promise() {
    return this.#retryer?.promise;
  }
  setOptions(options) {
    this.options = { ...this.#defaultOptions, ...options };
    this.updateGcTime(this.options.gcTime);
    if (this.state && this.state.data === void 0) {
      const defaultState = getDefaultState$1(this.options);
      if (defaultState.data !== void 0) {
        this.setState(
          successState(defaultState.data, defaultState.dataUpdatedAt)
        );
        this.#initialState = defaultState;
      }
    }
  }
  optionalRemove() {
    if (!this.observers.length && this.state.fetchStatus === "idle") {
      this.#cache.remove(this);
    }
  }
  setData(newData, options) {
    const data = replaceData(this.state.data, newData, this.options);
    this.#dispatch({
      data,
      type: "success",
      dataUpdatedAt: options?.updatedAt,
      manual: options?.manual
    });
    return data;
  }
  setState(state, setStateOptions) {
    this.#dispatch({ type: "setState", state, setStateOptions });
  }
  cancel(options) {
    const promise = this.#retryer?.promise;
    this.#retryer?.cancel(options);
    return promise ? promise.then(noop$1).catch(noop$1) : Promise.resolve();
  }
  destroy() {
    super.destroy();
    this.cancel({ silent: true });
  }
  reset() {
    this.destroy();
    this.setState(this.#initialState);
  }
  isActive() {
    return this.observers.some(
      (observer) => resolveEnabled(observer.options.enabled, this) !== false
    );
  }
  isDisabled() {
    if (this.getObserversCount() > 0) {
      return !this.isActive();
    }
    return this.options.queryFn === skipToken || this.state.dataUpdateCount + this.state.errorUpdateCount === 0;
  }
  isStatic() {
    if (this.getObserversCount() > 0) {
      return this.observers.some(
        (observer) => resolveStaleTime(observer.options.staleTime, this) === "static"
      );
    }
    return false;
  }
  isStale() {
    if (this.getObserversCount() > 0) {
      return this.observers.some(
        (observer) => observer.getCurrentResult().isStale
      );
    }
    return this.state.data === void 0 || this.state.isInvalidated;
  }
  isStaleByTime(staleTime = 0) {
    if (this.state.data === void 0) {
      return true;
    }
    if (staleTime === "static") {
      return false;
    }
    if (this.state.isInvalidated) {
      return true;
    }
    return !timeUntilStale(this.state.dataUpdatedAt, staleTime);
  }
  onFocus() {
    const observer = this.observers.find((x) => x.shouldFetchOnWindowFocus());
    observer?.refetch({ cancelRefetch: false });
    this.#retryer?.continue();
  }
  onOnline() {
    const observer = this.observers.find((x) => x.shouldFetchOnReconnect());
    observer?.refetch({ cancelRefetch: false });
    this.#retryer?.continue();
  }
  addObserver(observer) {
    if (!this.observers.includes(observer)) {
      this.observers.push(observer);
      this.clearGcTimeout();
      this.#cache.notify({ type: "observerAdded", query: this, observer });
    }
  }
  removeObserver(observer) {
    if (this.observers.includes(observer)) {
      this.observers = this.observers.filter((x) => x !== observer);
      if (!this.observers.length) {
        if (this.#retryer) {
          if (this.#abortSignalConsumed) {
            this.#retryer.cancel({ revert: true });
          } else {
            this.#retryer.cancelRetry();
          }
        }
        this.scheduleGc();
      }
      this.#cache.notify({ type: "observerRemoved", query: this, observer });
    }
  }
  getObserversCount() {
    return this.observers.length;
  }
  invalidate() {
    if (!this.state.isInvalidated) {
      this.#dispatch({ type: "invalidate" });
    }
  }
  async fetch(options, fetchOptions) {
    if (this.state.fetchStatus !== "idle" && // If the promise in the retyer is already rejected, we have to definitely
    // re-start the fetch; there is a chance that the query is still in a
    // pending state when that happens
    this.#retryer?.status() !== "rejected") {
      if (this.state.data !== void 0 && fetchOptions?.cancelRefetch) {
        this.cancel({ silent: true });
      } else if (this.#retryer) {
        this.#retryer.continueRetry();
        return this.#retryer.promise;
      }
    }
    if (options) {
      this.setOptions(options);
    }
    if (!this.options.queryFn) {
      const observer = this.observers.find((x) => x.options.queryFn);
      if (observer) {
        this.setOptions(observer.options);
      }
    }
    const abortController = new AbortController();
    const addSignalProperty = (object) => {
      Object.defineProperty(object, "signal", {
        enumerable: true,
        get: () => {
          this.#abortSignalConsumed = true;
          return abortController.signal;
        }
      });
    };
    const fetchFn = () => {
      const queryFn = ensureQueryFn(this.options, fetchOptions);
      const createQueryFnContext = () => {
        const queryFnContext2 = {
          client: this.#client,
          queryKey: this.queryKey,
          meta: this.meta
        };
        addSignalProperty(queryFnContext2);
        return queryFnContext2;
      };
      const queryFnContext = createQueryFnContext();
      this.#abortSignalConsumed = false;
      if (this.options.persister) {
        return this.options.persister(
          queryFn,
          queryFnContext,
          this
        );
      }
      return queryFn(queryFnContext);
    };
    const createFetchContext = () => {
      const context2 = {
        fetchOptions,
        options: this.options,
        queryKey: this.queryKey,
        client: this.#client,
        state: this.state,
        fetchFn
      };
      addSignalProperty(context2);
      return context2;
    };
    const context = createFetchContext();
    this.options.behavior?.onFetch(context, this);
    this.#revertState = this.state;
    if (this.state.fetchStatus === "idle" || this.state.fetchMeta !== context.fetchOptions?.meta) {
      this.#dispatch({ type: "fetch", meta: context.fetchOptions?.meta });
    }
    this.#retryer = createRetryer({
      initialPromise: fetchOptions?.initialPromise,
      fn: context.fetchFn,
      onCancel: (error) => {
        if (error instanceof CancelledError && error.revert) {
          this.setState({
            ...this.#revertState,
            fetchStatus: "idle"
          });
        }
        abortController.abort();
      },
      onFail: (failureCount, error) => {
        this.#dispatch({ type: "failed", failureCount, error });
      },
      onPause: () => {
        this.#dispatch({ type: "pause" });
      },
      onContinue: () => {
        this.#dispatch({ type: "continue" });
      },
      retry: context.options.retry,
      retryDelay: context.options.retryDelay,
      networkMode: context.options.networkMode,
      canRun: () => true
    });
    try {
      const data = await this.#retryer.start();
      if (data === void 0) {
        if (false) ;
        throw new Error(`${this.queryHash} data is undefined`);
      }
      this.setData(data);
      this.#cache.config.onSuccess?.(data, this);
      this.#cache.config.onSettled?.(
        data,
        this.state.error,
        this
      );
      return data;
    } catch (error) {
      if (error instanceof CancelledError) {
        if (error.silent) {
          return this.#retryer.promise;
        } else if (error.revert) {
          if (this.state.data === void 0) {
            throw error;
          }
          return this.state.data;
        }
      }
      this.#dispatch({
        type: "error",
        error
      });
      this.#cache.config.onError?.(
        error,
        this
      );
      this.#cache.config.onSettled?.(
        this.state.data,
        error,
        this
      );
      throw error;
    } finally {
      this.scheduleGc();
    }
  }
  #dispatch(action) {
    const reducer = (state) => {
      switch (action.type) {
        case "failed":
          return {
            ...state,
            fetchFailureCount: action.failureCount,
            fetchFailureReason: action.error
          };
        case "pause":
          return {
            ...state,
            fetchStatus: "paused"
          };
        case "continue":
          return {
            ...state,
            fetchStatus: "fetching"
          };
        case "fetch":
          return {
            ...state,
            ...fetchState(state.data, this.options),
            fetchMeta: action.meta ?? null
          };
        case "success":
          const newState = {
            ...state,
            ...successState(action.data, action.dataUpdatedAt),
            dataUpdateCount: state.dataUpdateCount + 1,
            ...!action.manual && {
              fetchStatus: "idle",
              fetchFailureCount: 0,
              fetchFailureReason: null
            }
          };
          this.#revertState = action.manual ? newState : void 0;
          return newState;
        case "error":
          const error = action.error;
          return {
            ...state,
            error,
            errorUpdateCount: state.errorUpdateCount + 1,
            errorUpdatedAt: Date.now(),
            fetchFailureCount: state.fetchFailureCount + 1,
            fetchFailureReason: error,
            fetchStatus: "idle",
            status: "error"
          };
        case "invalidate":
          return {
            ...state,
            isInvalidated: true
          };
        case "setState":
          return {
            ...state,
            ...action.state
          };
      }
    };
    this.state = reducer(this.state);
    notifyManager.batch(() => {
      this.observers.forEach((observer) => {
        observer.onQueryUpdate();
      });
      this.#cache.notify({ query: this, type: "updated", action });
    });
  }
};
function fetchState(data, options) {
  return {
    fetchFailureCount: 0,
    fetchFailureReason: null,
    fetchStatus: canFetch(options.networkMode) ? "fetching" : "paused",
    ...data === void 0 && {
      error: null,
      status: "pending"
    }
  };
}
function successState(data, dataUpdatedAt) {
  return {
    data,
    dataUpdatedAt: dataUpdatedAt ?? Date.now(),
    error: null,
    isInvalidated: false,
    status: "success"
  };
}
function getDefaultState$1(options) {
  const data = typeof options.initialData === "function" ? options.initialData() : options.initialData;
  const hasData = data !== void 0;
  const initialDataUpdatedAt = hasData ? typeof options.initialDataUpdatedAt === "function" ? options.initialDataUpdatedAt() : options.initialDataUpdatedAt : 0;
  return {
    data,
    dataUpdateCount: 0,
    dataUpdatedAt: hasData ? initialDataUpdatedAt ?? Date.now() : 0,
    error: null,
    errorUpdateCount: 0,
    errorUpdatedAt: 0,
    fetchFailureCount: 0,
    fetchFailureReason: null,
    fetchMeta: null,
    isInvalidated: false,
    status: hasData ? "success" : "pending",
    fetchStatus: "idle"
  };
}

// src/infiniteQueryBehavior.ts
function infiniteQueryBehavior(pages) {
  return {
    onFetch: (context, query) => {
      const options = context.options;
      const direction = context.fetchOptions?.meta?.fetchMore?.direction;
      const oldPages = context.state.data?.pages || [];
      const oldPageParams = context.state.data?.pageParams || [];
      let result = { pages: [], pageParams: [] };
      let currentPage = 0;
      const fetchFn = async () => {
        let cancelled = false;
        const addSignalProperty = (object) => {
          Object.defineProperty(object, "signal", {
            enumerable: true,
            get: () => {
              if (context.signal.aborted) {
                cancelled = true;
              } else {
                context.signal.addEventListener("abort", () => {
                  cancelled = true;
                });
              }
              return context.signal;
            }
          });
        };
        const queryFn = ensureQueryFn(context.options, context.fetchOptions);
        const fetchPage = async (data, param, previous) => {
          if (cancelled) {
            return Promise.reject();
          }
          if (param == null && data.pages.length) {
            return Promise.resolve(data);
          }
          const createQueryFnContext = () => {
            const queryFnContext2 = {
              client: context.client,
              queryKey: context.queryKey,
              pageParam: param,
              direction: previous ? "backward" : "forward",
              meta: context.options.meta
            };
            addSignalProperty(queryFnContext2);
            return queryFnContext2;
          };
          const queryFnContext = createQueryFnContext();
          const page = await queryFn(queryFnContext);
          const { maxPages } = context.options;
          const addTo = previous ? addToStart : addToEnd;
          return {
            pages: addTo(data.pages, page, maxPages),
            pageParams: addTo(data.pageParams, param, maxPages)
          };
        };
        if (direction && oldPages.length) {
          const previous = direction === "backward";
          const pageParamFn = previous ? getPreviousPageParam : getNextPageParam;
          const oldData = {
            pages: oldPages,
            pageParams: oldPageParams
          };
          const param = pageParamFn(options, oldData);
          result = await fetchPage(oldData, param, previous);
        } else {
          const remainingPages = pages ?? oldPages.length;
          do {
            const param = currentPage === 0 ? oldPageParams[0] ?? options.initialPageParam : getNextPageParam(options, result);
            if (currentPage > 0 && param == null) {
              break;
            }
            result = await fetchPage(result, param);
            currentPage++;
          } while (currentPage < remainingPages);
        }
        return result;
      };
      if (context.options.persister) {
        context.fetchFn = () => {
          return context.options.persister?.(
            fetchFn,
            {
              client: context.client,
              queryKey: context.queryKey,
              meta: context.options.meta,
              signal: context.signal
            },
            query
          );
        };
      } else {
        context.fetchFn = fetchFn;
      }
    }
  };
}
function getNextPageParam(options, { pages, pageParams }) {
  const lastIndex = pages.length - 1;
  return pages.length > 0 ? options.getNextPageParam(
    pages[lastIndex],
    pages,
    pageParams[lastIndex],
    pageParams
  ) : void 0;
}
function getPreviousPageParam(options, { pages, pageParams }) {
  return pages.length > 0 ? options.getPreviousPageParam?.(pages[0], pages, pageParams[0], pageParams) : void 0;
}

// src/mutation.ts
var Mutation = class extends Removable {
  #client;
  #observers;
  #mutationCache;
  #retryer;
  constructor(config) {
    super();
    this.#client = config.client;
    this.mutationId = config.mutationId;
    this.#mutationCache = config.mutationCache;
    this.#observers = [];
    this.state = config.state || getDefaultState();
    this.setOptions(config.options);
    this.scheduleGc();
  }
  setOptions(options) {
    this.options = options;
    this.updateGcTime(this.options.gcTime);
  }
  get meta() {
    return this.options.meta;
  }
  addObserver(observer) {
    if (!this.#observers.includes(observer)) {
      this.#observers.push(observer);
      this.clearGcTimeout();
      this.#mutationCache.notify({
        type: "observerAdded",
        mutation: this,
        observer
      });
    }
  }
  removeObserver(observer) {
    this.#observers = this.#observers.filter((x) => x !== observer);
    this.scheduleGc();
    this.#mutationCache.notify({
      type: "observerRemoved",
      mutation: this,
      observer
    });
  }
  optionalRemove() {
    if (!this.#observers.length) {
      if (this.state.status === "pending") {
        this.scheduleGc();
      } else {
        this.#mutationCache.remove(this);
      }
    }
  }
  continue() {
    return this.#retryer?.continue() ?? // continuing a mutation assumes that variables are set, mutation must have been dehydrated before
    this.execute(this.state.variables);
  }
  async execute(variables) {
    const onContinue = () => {
      this.#dispatch({ type: "continue" });
    };
    const mutationFnContext = {
      client: this.#client,
      meta: this.options.meta,
      mutationKey: this.options.mutationKey
    };
    this.#retryer = createRetryer({
      fn: () => {
        if (!this.options.mutationFn) {
          return Promise.reject(new Error("No mutationFn found"));
        }
        return this.options.mutationFn(variables, mutationFnContext);
      },
      onFail: (failureCount, error) => {
        this.#dispatch({ type: "failed", failureCount, error });
      },
      onPause: () => {
        this.#dispatch({ type: "pause" });
      },
      onContinue,
      retry: this.options.retry ?? 0,
      retryDelay: this.options.retryDelay,
      networkMode: this.options.networkMode,
      canRun: () => this.#mutationCache.canRun(this)
    });
    const restored = this.state.status === "pending";
    const isPaused = !this.#retryer.canStart();
    try {
      if (restored) {
        onContinue();
      } else {
        this.#dispatch({ type: "pending", variables, isPaused });
        await this.#mutationCache.config.onMutate?.(
          variables,
          this,
          mutationFnContext
        );
        const context = await this.options.onMutate?.(
          variables,
          mutationFnContext
        );
        if (context !== this.state.context) {
          this.#dispatch({
            type: "pending",
            context,
            variables,
            isPaused
          });
        }
      }
      const data = await this.#retryer.start();
      await this.#mutationCache.config.onSuccess?.(
        data,
        variables,
        this.state.context,
        this,
        mutationFnContext
      );
      await this.options.onSuccess?.(
        data,
        variables,
        this.state.context,
        mutationFnContext
      );
      await this.#mutationCache.config.onSettled?.(
        data,
        null,
        this.state.variables,
        this.state.context,
        this,
        mutationFnContext
      );
      await this.options.onSettled?.(
        data,
        null,
        variables,
        this.state.context,
        mutationFnContext
      );
      this.#dispatch({ type: "success", data });
      return data;
    } catch (error) {
      try {
        await this.#mutationCache.config.onError?.(
          error,
          variables,
          this.state.context,
          this,
          mutationFnContext
        );
        await this.options.onError?.(
          error,
          variables,
          this.state.context,
          mutationFnContext
        );
        await this.#mutationCache.config.onSettled?.(
          void 0,
          error,
          this.state.variables,
          this.state.context,
          this,
          mutationFnContext
        );
        await this.options.onSettled?.(
          void 0,
          error,
          variables,
          this.state.context,
          mutationFnContext
        );
        throw error;
      } finally {
        this.#dispatch({ type: "error", error });
      }
    } finally {
      this.#mutationCache.runNext(this);
    }
  }
  #dispatch(action) {
    const reducer = (state) => {
      switch (action.type) {
        case "failed":
          return {
            ...state,
            failureCount: action.failureCount,
            failureReason: action.error
          };
        case "pause":
          return {
            ...state,
            isPaused: true
          };
        case "continue":
          return {
            ...state,
            isPaused: false
          };
        case "pending":
          return {
            ...state,
            context: action.context,
            data: void 0,
            failureCount: 0,
            failureReason: null,
            error: null,
            isPaused: action.isPaused,
            status: "pending",
            variables: action.variables,
            submittedAt: Date.now()
          };
        case "success":
          return {
            ...state,
            data: action.data,
            failureCount: 0,
            failureReason: null,
            error: null,
            status: "success",
            isPaused: false
          };
        case "error":
          return {
            ...state,
            data: void 0,
            error: action.error,
            failureCount: state.failureCount + 1,
            failureReason: action.error,
            isPaused: false,
            status: "error"
          };
      }
    };
    this.state = reducer(this.state);
    notifyManager.batch(() => {
      this.#observers.forEach((observer) => {
        observer.onMutationUpdate(action);
      });
      this.#mutationCache.notify({
        mutation: this,
        type: "updated",
        action
      });
    });
  }
};
function getDefaultState() {
  return {
    context: void 0,
    data: void 0,
    error: null,
    failureCount: 0,
    failureReason: null,
    isPaused: false,
    status: "idle",
    variables: void 0,
    submittedAt: 0
  };
}

// src/mutationCache.ts
var MutationCache = class extends Subscribable {
  constructor(config = {}) {
    super();
    this.config = config;
    this.#mutations = /* @__PURE__ */ new Set();
    this.#scopes = /* @__PURE__ */ new Map();
    this.#mutationId = 0;
  }
  #mutations;
  #scopes;
  #mutationId;
  build(client, options, state) {
    const mutation = new Mutation({
      client,
      mutationCache: this,
      mutationId: ++this.#mutationId,
      options: client.defaultMutationOptions(options),
      state
    });
    this.add(mutation);
    return mutation;
  }
  add(mutation) {
    this.#mutations.add(mutation);
    const scope = scopeFor(mutation);
    if (typeof scope === "string") {
      const scopedMutations = this.#scopes.get(scope);
      if (scopedMutations) {
        scopedMutations.push(mutation);
      } else {
        this.#scopes.set(scope, [mutation]);
      }
    }
    this.notify({ type: "added", mutation });
  }
  remove(mutation) {
    if (this.#mutations.delete(mutation)) {
      const scope = scopeFor(mutation);
      if (typeof scope === "string") {
        const scopedMutations = this.#scopes.get(scope);
        if (scopedMutations) {
          if (scopedMutations.length > 1) {
            const index = scopedMutations.indexOf(mutation);
            if (index !== -1) {
              scopedMutations.splice(index, 1);
            }
          } else if (scopedMutations[0] === mutation) {
            this.#scopes.delete(scope);
          }
        }
      }
    }
    this.notify({ type: "removed", mutation });
  }
  canRun(mutation) {
    const scope = scopeFor(mutation);
    if (typeof scope === "string") {
      const mutationsWithSameScope = this.#scopes.get(scope);
      const firstPendingMutation = mutationsWithSameScope?.find(
        (m) => m.state.status === "pending"
      );
      return !firstPendingMutation || firstPendingMutation === mutation;
    } else {
      return true;
    }
  }
  runNext(mutation) {
    const scope = scopeFor(mutation);
    if (typeof scope === "string") {
      const foundMutation = this.#scopes.get(scope)?.find((m) => m !== mutation && m.state.isPaused);
      return foundMutation?.continue() ?? Promise.resolve();
    } else {
      return Promise.resolve();
    }
  }
  clear() {
    notifyManager.batch(() => {
      this.#mutations.forEach((mutation) => {
        this.notify({ type: "removed", mutation });
      });
      this.#mutations.clear();
      this.#scopes.clear();
    });
  }
  getAll() {
    return Array.from(this.#mutations);
  }
  find(filters) {
    const defaultedFilters = { exact: true, ...filters };
    return this.getAll().find(
      (mutation) => matchMutation(defaultedFilters, mutation)
    );
  }
  findAll(filters = {}) {
    return this.getAll().filter((mutation) => matchMutation(filters, mutation));
  }
  notify(event) {
    notifyManager.batch(() => {
      this.listeners.forEach((listener) => {
        listener(event);
      });
    });
  }
  resumePausedMutations() {
    const pausedMutations = this.getAll().filter((x) => x.state.isPaused);
    return notifyManager.batch(
      () => Promise.all(
        pausedMutations.map((mutation) => mutation.continue().catch(noop$1))
      )
    );
  }
};
function scopeFor(mutation) {
  return mutation.options.scope?.id;
}

// src/queryCache.ts
var QueryCache = class extends Subscribable {
  constructor(config = {}) {
    super();
    this.config = config;
    this.#queries = /* @__PURE__ */ new Map();
  }
  #queries;
  build(client, options, state) {
    const queryKey = options.queryKey;
    const queryHash = options.queryHash ?? hashQueryKeyByOptions(queryKey, options);
    let query = this.get(queryHash);
    if (!query) {
      query = new Query({
        client,
        queryKey,
        queryHash,
        options: client.defaultQueryOptions(options),
        state,
        defaultOptions: client.getQueryDefaults(queryKey)
      });
      this.add(query);
    }
    return query;
  }
  add(query) {
    if (!this.#queries.has(query.queryHash)) {
      this.#queries.set(query.queryHash, query);
      this.notify({
        type: "added",
        query
      });
    }
  }
  remove(query) {
    const queryInMap = this.#queries.get(query.queryHash);
    if (queryInMap) {
      query.destroy();
      if (queryInMap === query) {
        this.#queries.delete(query.queryHash);
      }
      this.notify({ type: "removed", query });
    }
  }
  clear() {
    notifyManager.batch(() => {
      this.getAll().forEach((query) => {
        this.remove(query);
      });
    });
  }
  get(queryHash) {
    return this.#queries.get(queryHash);
  }
  getAll() {
    return [...this.#queries.values()];
  }
  find(filters) {
    const defaultedFilters = { exact: true, ...filters };
    return this.getAll().find(
      (query) => matchQuery(defaultedFilters, query)
    );
  }
  findAll(filters = {}) {
    const queries = this.getAll();
    return Object.keys(filters).length > 0 ? queries.filter((query) => matchQuery(filters, query)) : queries;
  }
  notify(event) {
    notifyManager.batch(() => {
      this.listeners.forEach((listener) => {
        listener(event);
      });
    });
  }
  onFocus() {
    notifyManager.batch(() => {
      this.getAll().forEach((query) => {
        query.onFocus();
      });
    });
  }
  onOnline() {
    notifyManager.batch(() => {
      this.getAll().forEach((query) => {
        query.onOnline();
      });
    });
  }
};

// src/queryClient.ts
var QueryClient = class {
  #queryCache;
  #mutationCache;
  #defaultOptions;
  #queryDefaults;
  #mutationDefaults;
  #mountCount;
  #unsubscribeFocus;
  #unsubscribeOnline;
  constructor(config = {}) {
    this.#queryCache = config.queryCache || new QueryCache();
    this.#mutationCache = config.mutationCache || new MutationCache();
    this.#defaultOptions = config.defaultOptions || {};
    this.#queryDefaults = /* @__PURE__ */ new Map();
    this.#mutationDefaults = /* @__PURE__ */ new Map();
    this.#mountCount = 0;
  }
  mount() {
    this.#mountCount++;
    if (this.#mountCount !== 1) return;
    this.#unsubscribeFocus = focusManager.subscribe(async (focused) => {
      if (focused) {
        await this.resumePausedMutations();
        this.#queryCache.onFocus();
      }
    });
    this.#unsubscribeOnline = onlineManager.subscribe(async (online) => {
      if (online) {
        await this.resumePausedMutations();
        this.#queryCache.onOnline();
      }
    });
  }
  unmount() {
    this.#mountCount--;
    if (this.#mountCount !== 0) return;
    this.#unsubscribeFocus?.();
    this.#unsubscribeFocus = void 0;
    this.#unsubscribeOnline?.();
    this.#unsubscribeOnline = void 0;
  }
  isFetching(filters) {
    return this.#queryCache.findAll({ ...filters, fetchStatus: "fetching" }).length;
  }
  isMutating(filters) {
    return this.#mutationCache.findAll({ ...filters, status: "pending" }).length;
  }
  /**
   * Imperative (non-reactive) way to retrieve data for a QueryKey.
   * Should only be used in callbacks or functions where reading the latest data is necessary, e.g. for optimistic updates.
   *
   * Hint: Do not use this function inside a component, because it won't receive updates.
   * Use `useQuery` to create a `QueryObserver` that subscribes to changes.
   */
  getQueryData(queryKey) {
    const options = this.defaultQueryOptions({ queryKey });
    return this.#queryCache.get(options.queryHash)?.state.data;
  }
  ensureQueryData(options) {
    const defaultedOptions = this.defaultQueryOptions(options);
    const query = this.#queryCache.build(this, defaultedOptions);
    const cachedData = query.state.data;
    if (cachedData === void 0) {
      return this.fetchQuery(options);
    }
    if (options.revalidateIfStale && query.isStaleByTime(resolveStaleTime(defaultedOptions.staleTime, query))) {
      void this.prefetchQuery(defaultedOptions);
    }
    return Promise.resolve(cachedData);
  }
  getQueriesData(filters) {
    return this.#queryCache.findAll(filters).map(({ queryKey, state }) => {
      const data = state.data;
      return [queryKey, data];
    });
  }
  setQueryData(queryKey, updater, options) {
    const defaultedOptions = this.defaultQueryOptions({ queryKey });
    const query = this.#queryCache.get(
      defaultedOptions.queryHash
    );
    const prevData = query?.state.data;
    const data = functionalUpdate(updater, prevData);
    if (data === void 0) {
      return void 0;
    }
    return this.#queryCache.build(this, defaultedOptions).setData(data, { ...options, manual: true });
  }
  setQueriesData(filters, updater, options) {
    return notifyManager.batch(
      () => this.#queryCache.findAll(filters).map(({ queryKey }) => [
        queryKey,
        this.setQueryData(queryKey, updater, options)
      ])
    );
  }
  getQueryState(queryKey) {
    const options = this.defaultQueryOptions({ queryKey });
    return this.#queryCache.get(
      options.queryHash
    )?.state;
  }
  removeQueries(filters) {
    const queryCache = this.#queryCache;
    notifyManager.batch(() => {
      queryCache.findAll(filters).forEach((query) => {
        queryCache.remove(query);
      });
    });
  }
  resetQueries(filters, options) {
    const queryCache = this.#queryCache;
    return notifyManager.batch(() => {
      queryCache.findAll(filters).forEach((query) => {
        query.reset();
      });
      return this.refetchQueries(
        {
          type: "active",
          ...filters
        },
        options
      );
    });
  }
  cancelQueries(filters, cancelOptions = {}) {
    const defaultedCancelOptions = { revert: true, ...cancelOptions };
    const promises = notifyManager.batch(
      () => this.#queryCache.findAll(filters).map((query) => query.cancel(defaultedCancelOptions))
    );
    return Promise.all(promises).then(noop$1).catch(noop$1);
  }
  invalidateQueries(filters, options = {}) {
    return notifyManager.batch(() => {
      this.#queryCache.findAll(filters).forEach((query) => {
        query.invalidate();
      });
      if (filters?.refetchType === "none") {
        return Promise.resolve();
      }
      return this.refetchQueries(
        {
          ...filters,
          type: filters?.refetchType ?? filters?.type ?? "active"
        },
        options
      );
    });
  }
  refetchQueries(filters, options = {}) {
    const fetchOptions = {
      ...options,
      cancelRefetch: options.cancelRefetch ?? true
    };
    const promises = notifyManager.batch(
      () => this.#queryCache.findAll(filters).filter((query) => !query.isDisabled() && !query.isStatic()).map((query) => {
        let promise = query.fetch(void 0, fetchOptions);
        if (!fetchOptions.throwOnError) {
          promise = promise.catch(noop$1);
        }
        return query.state.fetchStatus === "paused" ? Promise.resolve() : promise;
      })
    );
    return Promise.all(promises).then(noop$1);
  }
  fetchQuery(options) {
    const defaultedOptions = this.defaultQueryOptions(options);
    if (defaultedOptions.retry === void 0) {
      defaultedOptions.retry = false;
    }
    const query = this.#queryCache.build(this, defaultedOptions);
    return query.isStaleByTime(
      resolveStaleTime(defaultedOptions.staleTime, query)
    ) ? query.fetch(defaultedOptions) : Promise.resolve(query.state.data);
  }
  prefetchQuery(options) {
    return this.fetchQuery(options).then(noop$1).catch(noop$1);
  }
  fetchInfiniteQuery(options) {
    options.behavior = infiniteQueryBehavior(options.pages);
    return this.fetchQuery(options);
  }
  prefetchInfiniteQuery(options) {
    return this.fetchInfiniteQuery(options).then(noop$1).catch(noop$1);
  }
  ensureInfiniteQueryData(options) {
    options.behavior = infiniteQueryBehavior(options.pages);
    return this.ensureQueryData(options);
  }
  resumePausedMutations() {
    if (onlineManager.isOnline()) {
      return this.#mutationCache.resumePausedMutations();
    }
    return Promise.resolve();
  }
  getQueryCache() {
    return this.#queryCache;
  }
  getMutationCache() {
    return this.#mutationCache;
  }
  getDefaultOptions() {
    return this.#defaultOptions;
  }
  setDefaultOptions(options) {
    this.#defaultOptions = options;
  }
  setQueryDefaults(queryKey, options) {
    this.#queryDefaults.set(hashKey(queryKey), {
      queryKey,
      defaultOptions: options
    });
  }
  getQueryDefaults(queryKey) {
    const defaults = [...this.#queryDefaults.values()];
    const result = {};
    defaults.forEach((queryDefault) => {
      if (partialMatchKey(queryKey, queryDefault.queryKey)) {
        Object.assign(result, queryDefault.defaultOptions);
      }
    });
    return result;
  }
  setMutationDefaults(mutationKey, options) {
    this.#mutationDefaults.set(hashKey(mutationKey), {
      mutationKey,
      defaultOptions: options
    });
  }
  getMutationDefaults(mutationKey) {
    const defaults = [...this.#mutationDefaults.values()];
    const result = {};
    defaults.forEach((queryDefault) => {
      if (partialMatchKey(mutationKey, queryDefault.mutationKey)) {
        Object.assign(result, queryDefault.defaultOptions);
      }
    });
    return result;
  }
  defaultQueryOptions(options) {
    if (options._defaulted) {
      return options;
    }
    const defaultedOptions = {
      ...this.#defaultOptions.queries,
      ...this.getQueryDefaults(options.queryKey),
      ...options,
      _defaulted: true
    };
    if (!defaultedOptions.queryHash) {
      defaultedOptions.queryHash = hashQueryKeyByOptions(
        defaultedOptions.queryKey,
        defaultedOptions
      );
    }
    if (defaultedOptions.refetchOnReconnect === void 0) {
      defaultedOptions.refetchOnReconnect = defaultedOptions.networkMode !== "always";
    }
    if (defaultedOptions.throwOnError === void 0) {
      defaultedOptions.throwOnError = !!defaultedOptions.suspense;
    }
    if (!defaultedOptions.networkMode && defaultedOptions.persister) {
      defaultedOptions.networkMode = "offlineFirst";
    }
    if (defaultedOptions.queryFn === skipToken) {
      defaultedOptions.enabled = false;
    }
    return defaultedOptions;
  }
  defaultMutationOptions(options) {
    if (options?._defaulted) {
      return options;
    }
    return {
      ...this.#defaultOptions.mutations,
      ...options?.mutationKey && this.getMutationDefaults(options.mutationKey),
      ...options,
      _defaulted: true
    };
  }
  clear() {
    this.#queryCache.clear();
    this.#mutationCache.clear();
  }
};

var QueryClientContext = reactExports.createContext(
  void 0
);
var QueryClientProvider = ({
  client,
  children
}) => {
  reactExports.useEffect(() => {
    client.mount();
    return () => {
      client.unmount();
    };
  }, [client]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(QueryClientContext.Provider, { value: client, children });
};

/**
 * @param {string|RegExp} input The route pattern
 * @param {boolean} [loose] Allow open-ended matching. Ignored with `RegExp` input.
 */
function parse(input, loose) {
	if (input instanceof RegExp) return { keys:false, pattern:input };
	var c, o, tmp, ext, keys=[], pattern='', arr = input.split('/');
	arr[0] || arr.shift();

	while (tmp = arr.shift()) {
		c = tmp[0];
		if (c === '*') {
			keys.push(c);
			pattern += tmp[1] === '?' ? '(?:/(.*))?' : '/(.*)';
		} else if (c === ':') {
			o = tmp.indexOf('?', 1);
			ext = tmp.indexOf('.', 1);
			keys.push( tmp.substring(1, !!~o ? o : !!~ext ? ext : tmp.length) );
			pattern += !!~o && !~ext ? '(?:/([^/]+?))?' : '/([^/]+?)';
			if (!!~ext) pattern += (!!~o ? '?' : '') + '\\' + tmp.substring(ext);
		} else {
			pattern += '/' + tmp;
		}
	}

	return {
		keys: keys,
		pattern: new RegExp('^' + pattern + (loose ? '(?=$|\/)' : '\/?$'), 'i')
	};
}

// React.useInsertionEffect is not available in React <18
// This hack fixes a transpilation issue on some apps
const useBuiltinInsertionEffect = React["useInsertion" + "Effect"];

// Copied from:
// https://github.com/facebook/react/blob/main/packages/shared/ExecutionEnvironment.js
const canUseDOM = !!(
  typeof window !== "undefined" &&
  typeof window.document !== "undefined" &&
  typeof window.document.createElement !== "undefined"
);

// Copied from:
// https://github.com/reduxjs/react-redux/blob/master/src/utils/useIsomorphicLayoutEffect.ts
// "React currently throws a warning when using useLayoutEffect on the server.
// To get around it, we can conditionally useEffect on the server (no-op) and
// useLayoutEffect in the browser."
const useIsomorphicLayoutEffect = canUseDOM
  ? reactExports.useLayoutEffect
  : reactExports.useEffect;

// useInsertionEffect is already a noop on the server.
// See: https://github.com/facebook/react/blob/main/packages/react-server/src/ReactFizzHooks.js
const useInsertionEffect =
  useBuiltinInsertionEffect || useIsomorphicLayoutEffect;

// Userland polyfill while we wait for the forthcoming
// https://github.com/reactjs/rfcs/blob/useevent/text/0000-useevent.md
// Note: "A high-fidelity polyfill for useEvent is not possible because
// there is no lifecycle or Hook in React that we can use to switch
// .current at the right timing."
// So we will have to make do with this "close enough" approach for now.
const useEvent = (fn) => {
  const ref = reactExports.useRef([fn, (...args) => ref[0](...args)]).current;
  // Per Dan Abramov: useInsertionEffect executes marginally closer to the
  // correct timing for ref synchronization than useLayoutEffect on React 18.
  // See: https://github.com/facebook/react/pull/25881#issuecomment-1356244360
  useInsertionEffect(() => {
    ref[0] = fn;
  });
  return ref[1];
};

/**
 * History API docs @see https://developer.mozilla.org/en-US/docs/Web/API/History
 */
const eventPopstate = "popstate";
const eventPushState = "pushState";
const eventReplaceState = "replaceState";
const eventHashchange = "hashchange";
const events = [
  eventPopstate,
  eventPushState,
  eventReplaceState,
  eventHashchange,
];

const subscribeToLocationUpdates = (callback) => {
  for (const event of events) {
    addEventListener(event, callback);
  }
  return () => {
    for (const event of events) {
      removeEventListener(event, callback);
    }
  };
};

const useLocationProperty = (fn, ssrFn) =>
  shimExports.useSyncExternalStore(subscribeToLocationUpdates, fn, ssrFn);

const currentSearch = () => location.search;

const useSearch = ({ ssrSearch } = {}) =>
  useLocationProperty(
    currentSearch,
    ssrSearch != null ? () => ssrSearch : currentSearch
  );

const currentPathname = () => location.pathname;

const usePathname = ({ ssrPath } = {}) =>
  useLocationProperty(
    currentPathname,
    ssrPath != null ? () => ssrPath : currentPathname
  );

const navigate = (to, { replace = false, state = null } = {}) =>
  history[replace ? eventReplaceState : eventPushState](state, "", to);

// the 2nd argument of the `useBrowserLocation` return value is a function
// that allows to perform a navigation.
const useBrowserLocation = (opts = {}) => [usePathname(opts), navigate];

const patchKey = Symbol.for("wouter_v3");

// While History API does have `popstate` event, the only
// proper way to listen to changes via `push/replaceState`
// is to monkey-patch these methods.
//
// See https://stackoverflow.com/a/4585031
if (typeof history !== "undefined" && typeof window[patchKey] === "undefined") {
  for (const type of [eventPushState, eventReplaceState]) {
    const original = history[type];
    // TODO: we should be using unstable_batchedUpdates to avoid multiple re-renders,
    // however that will require an additional peer dependency on react-dom.
    // See: https://github.com/reactwg/react-18/discussions/86#discussioncomment-1567149
    history[type] = function () {
      const result = original.apply(this, arguments);
      const event = new Event(type);
      event.arguments = arguments;

      dispatchEvent(event);
      return result;
    };
  }

  // patch history object only once
  // See: https://github.com/molefrog/wouter/issues/167
  Object.defineProperty(window, patchKey, { value: true });
}

/*
 * Transforms `path` into its relative `base` version
 * If base isn't part of the path provided returns absolute path e.g. `~/app`
 */
const _relativePath = (base, path) =>
  !path.toLowerCase().indexOf(base.toLowerCase())
    ? path.slice(base.length) || "/"
    : "~" + path;

/**
 * When basepath is `undefined` or '/' it is ignored (we assume it's empty string)
 */
const baseDefaults = (base = "") => (base === "/" ? "" : base);

const absolutePath = (to, base) =>
  to[0] === "~" ? to.slice(1) : baseDefaults(base) + to;

const relativePath = (base = "", path) =>
  _relativePath(unescape$2(baseDefaults(base)), unescape$2(path));

/*
 * decodes escape sequences such as %20
 */
const unescape$2 = (str) => {
  try {
    return decodeURI(str);
  } catch (_e) {
    // fail-safe mode: if string can't be decoded do nothing
    return str;
  }
};

/*
 * Router and router context. Router is a lightweight object that represents the current
 * routing options: how location is managed, base path etc.
 *
 * There is a default router present for most of the use cases, however it can be overridden
 * via the <Router /> component.
 */

const defaultRouter = {
  hook: useBrowserLocation,
  searchHook: useSearch,
  parser: parse,
  base: "",
  // this option is used to override the current location during SSR
  ssrPath: undefined,
  ssrSearch: undefined,
  // optional context to track render state during SSR
  ssrContext: undefined,
  // customizes how `href` props are transformed for <Link />
  hrefs: (x) => x,
};

const RouterCtx = reactExports.createContext(defaultRouter);

// gets the closest parent router from the context
const useRouter = () => reactExports.useContext(RouterCtx);

/**
 * Parameters context. Used by `useParams()` to get the
 * matched params from the innermost `Route` component.
 */

const Params0 = {},
  ParamsCtx = reactExports.createContext(Params0);

const useParams = () => reactExports.useContext(ParamsCtx);

/*
 * Part 1, Hooks API: useRoute and useLocation
 */

// Internal version of useLocation to avoid redundant useRouter calls

const useLocationFromRouter = (router) => {
  const [location, navigate] = router.hook(router);

  // the function reference should stay the same between re-renders, so that
  // it can be passed down as an element prop without any performance concerns.
  // (This is achieved via `useEvent`.)
  return [
    relativePath(router.base, location),
    useEvent((to, navOpts) => navigate(absolutePath(to, router.base), navOpts)),
  ];
};

const useLocation = () => useLocationFromRouter(useRouter());

const matchRoute = (parser, route, path, loose) => {
  // if the input is a regexp, skip parsing
  const { pattern, keys } =
    route instanceof RegExp
      ? { keys: false, pattern: route }
      : parser(route || "*", loose);

  // array destructuring loses keys, so this is done in two steps
  const result = pattern.exec(path) || [];

  // when parser is in "loose" mode, `$base` is equal to the
  // first part of the route that matches the pattern
  // (e.g. for pattern `/a/:b` and path `/a/1/2/3` the `$base` is `a/1`)
  // we use this for route nesting
  const [$base, ...matches] = result;

  return $base !== undefined
    ? [
        true,

        (() => {
          // for regex paths, `keys` will always be false

          // an object with parameters matched, e.g. { foo: "bar" } for "/:foo"
          // we "zip" two arrays here to construct the object
          // ["foo"], ["bar"] → { foo: "bar" }
          const groups =
            keys !== false
              ? Object.fromEntries(keys.map((key, i) => [key, matches[i]]))
              : result.groups;

          // convert the array to an instance of object
          // this makes it easier to integrate with the existing param implementation
          let obj = { ...matches };

          // merge named capture groups with matches array
          groups && Object.assign(obj, groups);

          return obj;
        })(),

        // the third value if only present when parser is in "loose" mode,
        // so that we can extract the base path for nested routes
        ...(loose ? [$base] : []),
      ]
    : [false, null];
};

/*
 * Part 2, Low Carb Router API: Router, Route, Link, Switch
 */

const Router = ({ children, ...props }) => {
  // the router we will inherit from - it is the closest router in the tree,
  // unless the custom `hook` is provided (in that case it's the default one)
  const parent_ = useRouter();
  const parent = props.hook ? defaultRouter : parent_;

  // holds to the context value: the router object
  let value = parent;

  // when `ssrPath` contains a `?` character, we can extract the search from it
  const [path, search] = props.ssrPath?.split("?") ?? [];
  if (search) (props.ssrSearch = search), (props.ssrPath = path);

  // hooks can define their own `href` formatter (e.g. for hash location)
  props.hrefs = props.hrefs ?? props.hook?.hrefs;

  // hooks can define their own search hook (e.g. for memory location)
  props.searchHook = props.searchHook ?? props.hook?.searchHook;

  // what is happening below: to avoid unnecessary rerenders in child components,
  // we ensure that the router object reference is stable, unless there are any
  // changes that require reload (e.g. `base` prop changes -> all components that
  // get the router from the context should rerender, even if the component is memoized).
  // the expected behaviour is:
  //
  //   1) when the resulted router is no different from the parent, use parent
  //   2) if the custom `hook` prop is provided, we always inherit from the
  //      default router instead. this resets all previously overridden options.
  //   3) when the router is customized here, it should stay stable between renders
  let ref = reactExports.useRef({}),
    prev = ref.current,
    next = prev;

  for (let k in parent) {
    const option =
      k === "base"
        ? /* base is special case, it is appended to the parent's base */
          parent[k] + (props[k] || "")
        : props[k] || parent[k];

    if (prev === next && option !== next[k]) {
      ref.current = next = { ...next };
    }

    next[k] = option;

    // the new router is no different from the parent or from the memoized value, use parent
    if (option !== parent[k] || option !== value[k]) value = next;
  }

  return reactExports.createElement(RouterCtx.Provider, { value, children });
};

const h_route = ({ children, component }, params) => {
  // React-Router style `component` prop
  if (component) return reactExports.createElement(component, { params });

  // support render prop or plain children
  return typeof children === "function" ? children(params) : children;
};

// Cache params object between renders if values are shallow equal
const useCachedParams = (value) => {
  let prev = reactExports.useRef(Params0);
  const curr = prev.current;
  return (prev.current =
    // Update cache if number of params changed or any value changed
    Object.keys(value).length !== Object.keys(curr).length ||
    Object.entries(value).some(([k, v]) => v !== curr[k])
      ? value // Return new value if there are changes
      : curr); // Return cached value if nothing changed
};

const Route = ({ path, nest, match, ...renderProps }) => {
  const router = useRouter();
  const [location] = useLocationFromRouter(router);

  const [matches, routeParams, base] =
    // `match` is a special prop to give up control to the parent,
    // it is used by the `Switch` to avoid double matching
    match ?? matchRoute(router.parser, path, location, nest);

  // when `routeParams` is `null` (there was no match), the argument
  // below becomes {...null} = {}, see the Object Spread specs
  // https://tc39.es/proposal-object-rest-spread/#AbstractOperations-CopyDataProperties
  const params = useCachedParams({ ...useParams(), ...routeParams });

  if (!matches) return null;

  const children = base
    ? reactExports.createElement(Router, { base }, h_route(renderProps, params))
    : h_route(renderProps, params);

  return reactExports.createElement(ParamsCtx.Provider, { value: params, children });
};

const Link = reactExports.forwardRef((props, ref) => {
  const router = useRouter();
  const [currentPath, navigate] = useLocationFromRouter(router);

  const {
    to = "",
    href: targetPath = to,
    onClick: _onClick,
    asChild,
    children,
    className: cls,
    /* eslint-disable no-unused-vars */
    replace /* ignore nav props */,
    state /* ignore nav props */,
    /* eslint-enable no-unused-vars */

    ...restProps
  } = props;

  const onClick = useEvent((event) => {
    // ignores the navigation when clicked using right mouse button or
    // by holding a special modifier key: ctrl, command, win, alt, shift
    if (
      event.ctrlKey ||
      event.metaKey ||
      event.altKey ||
      event.shiftKey ||
      event.button !== 0
    )
      return;

    _onClick?.(event);
    if (!event.defaultPrevented) {
      event.preventDefault();
      navigate(targetPath, props);
    }
  });

  // handle nested routers and absolute paths
  const href = router.hrefs(
    targetPath[0] === "~" ? targetPath.slice(1) : router.base + targetPath,
    router // pass router as a second argument for convinience
  );

  return asChild && reactExports.isValidElement(children)
    ? reactExports.cloneElement(children, { onClick, href })
    : reactExports.createElement("a", {
        ...restProps,
        onClick,
        href,
        // `className` can be a function to apply the class if this link is active
        className: cls?.call ? cls(currentPath === targetPath) : cls,
        children,
        ref,
      });
});

const flattenChildren = (children) =>
  Array.isArray(children)
    ? children.flatMap((c) =>
        flattenChildren(c && c.type === reactExports.Fragment ? c.props.children : c)
      )
    : [children];

const Switch$1 = ({ children, location }) => {
  const router = useRouter();
  const [originalLocation] = useLocationFromRouter(router);

  for (const element of flattenChildren(children)) {
    let match = 0;

    if (
      reactExports.isValidElement(element) &&
      // we don't require an element to be of type Route,
      // but we do require it to contain a truthy `path` prop.
      // this allows to use different components that wrap Route
      // inside of a switch, for example <AnimatedRoute />.
      (match = matchRoute(
        router.parser,
        element.props.path,
        location || originalLocation,
        element.props.nest
      ))[0]
    )
      return reactExports.cloneElement(element, { match });
  }

  return null;
};

var P$1=["light","dark"],E$1="(prefers-color-scheme: dark)",L$1=reactExports.createContext(void 0),D$1={setTheme:e=>{},themes:[]},j$1=()=>{var e;return (e=reactExports.useContext(L$1))!=null?e:D$1};reactExports.memo(({forcedTheme:e,storageKey:a,attribute:n,enableSystem:g,enableColorScheme:m,defaultTheme:c,value:o,attrs:y,nonce:h})=>{let k=c==="system",w=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${y.map(u=>`'${u}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,i=m?(P$1.includes(c)?c:null)?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${c}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",d=(l,u=false,R=true)=>{let f=o?o[l]:l,p=u?l+"|| ''":`'${f}'`,$="";return m&&R&&!u&&P$1.includes(l)&&($+=`d.style.colorScheme = '${l}';`),n==="class"?u||f?$+=`c.add(${p})`:$+="null":f&&($+=`d[s](n,${p})`),$},S=e?`!function(){${w}${d(e)}}()`:g?`!function(){try{${w}var e=localStorage.getItem('${a}');if('system'===e||(!e&&${k})){var t='${E$1}',m=window.matchMedia(t);if(m.media!==t||m.matches){${d("dark")}}else{${d("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${d(o?"x[e]":"e",true)}}${k?"":"else{"+d(c,false,false)+"}"}${i}}catch(e){}}()`:`!function(){try{${w}var e=localStorage.getItem('${a}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${d(o?"x[e]":"e",true)}}else{${d(c,false,false)};}${i}}catch(t){}}();`;return reactExports.createElement("script",{nonce:h,dangerouslySetInnerHTML:{__html:S}})});

var jt$1=n=>{switch(n){case "success":return ee$1;case "info":return ae$1;case "warning":return oe$1;case "error":return se$1;default:return null}},te$1=Array(12).fill(0),Yt$1=({visible:n,className:e})=>React$1.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":n},React$1.createElement("div",{className:"sonner-spinner"},te$1.map((t,a)=>React$1.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),ee$1=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React$1.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),oe$1=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},React$1.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),ae$1=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React$1.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),se$1=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React$1.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ot$1=React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},React$1.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React$1.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}));var Ft$1=()=>{let[n,e]=React$1.useState(document.hidden);return React$1.useEffect(()=>{let t=()=>{e(document.hidden);};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),n};var bt$1=1,yt$1=class yt{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1);});this.publish=e=>{this.subscribers.forEach(t=>t(e));};this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e];};this.create=e=>{var S;let{message:t,...a}=e,u=typeof(e==null?void 0:e.id)=="number"||((S=e.id)==null?void 0:S.length)>0?e.id:bt$1++,f=this.toasts.find(g=>g.id===u),w=e.dismissible===void 0?true:e.dismissible;return this.dismissedToasts.has(u)&&this.dismissedToasts.delete(u),f?this.toasts=this.toasts.map(g=>g.id===u?(this.publish({...g,...e,id:u,title:t}),{...g,...e,id:u,dismissible:w,title:t}):g):this.addToast({title:t,...a,dismissible:w,id:u}),u};this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(a=>a({id:t.id,dismiss:true}));}),this.subscribers.forEach(t=>t({id:e,dismiss:true})),e);this.message=(e,t)=>this.create({...t,message:e});this.error=(e,t)=>this.create({...t,message:e,type:"error"});this.success=(e,t)=>this.create({...t,type:"success",message:e});this.info=(e,t)=>this.create({...t,type:"info",message:e});this.warning=(e,t)=>this.create({...t,type:"warning",message:e});this.loading=(e,t)=>this.create({...t,type:"loading",message:e});this.promise=(e,t)=>{if(!t)return;let a;t.loading!==void 0&&(a=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let u=e instanceof Promise?e:e(),f=a!==void 0,w,S=u.then(async i=>{if(w=["resolve",i],React$1.isValidElement(i))f=false,this.create({id:a,type:"default",message:i});else if(ie$1(i)&&!i.ok){f=false;let T=typeof t.error=="function"?await t.error(`HTTP error! status: ${i.status}`):t.error,F=typeof t.description=="function"?await t.description(`HTTP error! status: ${i.status}`):t.description;this.create({id:a,type:"error",message:T,description:F});}else if(t.success!==void 0){f=false;let T=typeof t.success=="function"?await t.success(i):t.success,F=typeof t.description=="function"?await t.description(i):t.description;this.create({id:a,type:"success",message:T,description:F});}}).catch(async i=>{if(w=["reject",i],t.error!==void 0){f=false;let D=typeof t.error=="function"?await t.error(i):t.error,T=typeof t.description=="function"?await t.description(i):t.description;this.create({id:a,type:"error",message:D,description:T});}}).finally(()=>{var i;f&&(this.dismiss(a),a=void 0),(i=t.finally)==null||i.call(t);}),g=()=>new Promise((i,D)=>S.then(()=>w[0]==="reject"?D(w[1]):i(w[1])).catch(D));return typeof a!="string"&&typeof a!="number"?{unwrap:g}:Object.assign(a,{unwrap:g})};this.custom=(e,t)=>{let a=(t==null?void 0:t.id)||bt$1++;return this.create({jsx:e(a),id:a,...t}),a};this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id));this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set;}},v$2=new yt$1,ne$1=(n,e)=>{let t=(e==null?void 0:e.id)||bt$1++;return v$2.addToast({title:n,...e,id:t}),t},ie$1=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",le$1=ne$1,ce$1=()=>v$2.toasts,de$1=()=>v$2.getActiveToasts(),ue$1=Object.assign(le$1,{success:v$2.success,info:v$2.info,warning:v$2.warning,error:v$2.error,custom:v$2.custom,message:v$2.message,promise:v$2.promise,dismiss:v$2.dismiss,loading:v$2.loading},{getHistory:ce$1,getToasts:de$1});function wt$1(n,{insertAt:e}={}){if(typeof document=="undefined")return;let t=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",e==="top"&&t.firstChild?t.insertBefore(a,t.firstChild):t.appendChild(a),a.styleSheet?a.styleSheet.cssText=n:a.appendChild(document.createTextNode(n));}wt$1(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function tt$1(n){return n.label!==void 0}var pe$1=3,me$1="32px",ge$1="16px",Wt$1=4e3,he$1=356,be$1=14,ye$1=20,we$1=200;function M$1(...n){return n.filter(Boolean).join(" ")}function xe$1(n){let[e,t]=n.split("-"),a=[];return e&&a.push(e),t&&a.push(t),a}var ve$1=n=>{var Dt,Pt,Nt,Bt,Ct,kt,It,Mt,Ht,At,Lt;let{invert:e,toast:t,unstyled:a,interacting:u,setHeights:f,visibleToasts:w,heights:S,index:g,toasts:i,expanded:D,removeToast:T,defaultRichColors:F,closeButton:et,style:ut,cancelButtonStyle:ft,actionButtonStyle:l,className:ot="",descriptionClassName:at="",duration:X,position:st,gap:pt,loadingIcon:rt,expandByDefault:B,classNames:s,icons:P,closeButtonAriaLabel:nt="Close toast",pauseWhenPageIsHidden:it}=n,[Y,C]=React$1.useState(null),[lt,J]=React$1.useState(null),[W,H]=React$1.useState(false),[A,mt]=React$1.useState(false),[L,z]=React$1.useState(false),[ct,d]=React$1.useState(false),[h,y]=React$1.useState(false),[R,j]=React$1.useState(0),[p,_]=React$1.useState(0),O=React$1.useRef(t.duration||X||Wt$1),G=React$1.useRef(null),k=React$1.useRef(null),Vt=g===0,Ut=g+1<=w,N=t.type,V=t.dismissible!==false,Kt=t.className||"",Xt=t.descriptionClassName||"",dt=React$1.useMemo(()=>S.findIndex(r=>r.toastId===t.id)||0,[S,t.id]),Jt=React$1.useMemo(()=>{var r;return (r=t.closeButton)!=null?r:et},[t.closeButton,et]),Tt=React$1.useMemo(()=>t.duration||X||Wt$1,[t.duration,X]),gt=React$1.useRef(0),U=React$1.useRef(0),St=React$1.useRef(0),K=React$1.useRef(null),[Gt,Qt]=st.split("-"),Rt=React$1.useMemo(()=>S.reduce((r,m,c)=>c>=dt?r:r+m.height,0),[S,dt]),Et=Ft$1(),qt=t.invert||e,ht=N==="loading";U.current=React$1.useMemo(()=>dt*pt+Rt,[dt,Rt]),React$1.useEffect(()=>{O.current=Tt;},[Tt]),React$1.useEffect(()=>{H(true);},[]),React$1.useEffect(()=>{let r=k.current;if(r){let m=r.getBoundingClientRect().height;return _(m),f(c=>[{toastId:t.id,height:m,position:t.position},...c]),()=>f(c=>c.filter(b=>b.toastId!==t.id))}},[f,t.id]),React$1.useLayoutEffect(()=>{if(!W)return;let r=k.current,m=r.style.height;r.style.height="auto";let c=r.getBoundingClientRect().height;r.style.height=m,_(c),f(b=>b.find(x=>x.toastId===t.id)?b.map(x=>x.toastId===t.id?{...x,height:c}:x):[{toastId:t.id,height:c,position:t.position},...b]);},[W,t.title,t.description,f,t.id]);let $=React$1.useCallback(()=>{mt(true),j(U.current),f(r=>r.filter(m=>m.toastId!==t.id)),setTimeout(()=>{T(t);},we$1);},[t,T,f,U]);React$1.useEffect(()=>{if(t.promise&&N==="loading"||t.duration===1/0||t.type==="loading")return;let r;return D||u||it&&Et?(()=>{if(St.current<gt.current){let b=new Date().getTime()-gt.current;O.current=O.current-b;}St.current=new Date().getTime();})():(()=>{O.current!==1/0&&(gt.current=new Date().getTime(),r=setTimeout(()=>{var b;(b=t.onAutoClose)==null||b.call(t,t),$();},O.current));})(),()=>clearTimeout(r)},[D,u,t,N,it,Et,$]),React$1.useEffect(()=>{t.delete&&$();},[$,t.delete]);function Zt(){var r,m,c;return P!=null&&P.loading?React$1.createElement("div",{className:M$1(s==null?void 0:s.loader,(r=t==null?void 0:t.classNames)==null?void 0:r.loader,"sonner-loader"),"data-visible":N==="loading"},P.loading):rt?React$1.createElement("div",{className:M$1(s==null?void 0:s.loader,(m=t==null?void 0:t.classNames)==null?void 0:m.loader,"sonner-loader"),"data-visible":N==="loading"},rt):React$1.createElement(Yt$1,{className:M$1(s==null?void 0:s.loader,(c=t==null?void 0:t.classNames)==null?void 0:c.loader),visible:N==="loading"})}return React$1.createElement("li",{tabIndex:0,ref:k,className:M$1(ot,Kt,s==null?void 0:s.toast,(Dt=t==null?void 0:t.classNames)==null?void 0:Dt.toast,s==null?void 0:s.default,s==null?void 0:s[N],(Pt=t==null?void 0:t.classNames)==null?void 0:Pt[N]),"data-sonner-toast":"","data-rich-colors":(Nt=t.richColors)!=null?Nt:F,"data-styled":!(t.jsx||t.unstyled||a),"data-mounted":W,"data-promise":!!t.promise,"data-swiped":h,"data-removed":A,"data-visible":Ut,"data-y-position":Gt,"data-x-position":Qt,"data-index":g,"data-front":Vt,"data-swiping":L,"data-dismissible":V,"data-type":N,"data-invert":qt,"data-swipe-out":ct,"data-swipe-direction":lt,"data-expanded":!!(D||B&&W),style:{"--index":g,"--toasts-before":g,"--z-index":i.length-g,"--offset":`${A?R:U.current}px`,"--initial-height":B?"auto":`${p}px`,...ut,...t.style},onDragEnd:()=>{z(false),C(null),K.current=null;},onPointerDown:r=>{ht||!V||(G.current=new Date,j(U.current),r.target.setPointerCapture(r.pointerId),r.target.tagName!=="BUTTON"&&(z(true),K.current={x:r.clientX,y:r.clientY}));},onPointerUp:()=>{var x,Q,q,Z;if(ct||!V)return;K.current=null;let r=Number(((x=k.current)==null?void 0:x.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),m=Number(((Q=k.current)==null?void 0:Q.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),c=new Date().getTime()-((q=G.current)==null?void 0:q.getTime()),b=Y==="x"?r:m,I=Math.abs(b)/c;if(Math.abs(b)>=ye$1||I>.11){j(U.current),(Z=t.onDismiss)==null||Z.call(t,t),J(Y==="x"?r>0?"right":"left":m>0?"down":"up"),$(),d(true),y(false);return}z(false),C(null);},onPointerMove:r=>{var Q,q,Z,zt;if(!K.current||!V||((Q=window.getSelection())==null?void 0:Q.toString().length)>0)return;let c=r.clientY-K.current.y,b=r.clientX-K.current.x,I=(q=n.swipeDirections)!=null?q:xe$1(st);!Y&&(Math.abs(b)>1||Math.abs(c)>1)&&C(Math.abs(b)>Math.abs(c)?"x":"y");let x={x:0,y:0};Y==="y"?(I.includes("top")||I.includes("bottom"))&&(I.includes("top")&&c<0||I.includes("bottom")&&c>0)&&(x.y=c):Y==="x"&&(I.includes("left")||I.includes("right"))&&(I.includes("left")&&b<0||I.includes("right")&&b>0)&&(x.x=b),(Math.abs(x.x)>0||Math.abs(x.y)>0)&&y(true),(Z=k.current)==null||Z.style.setProperty("--swipe-amount-x",`${x.x}px`),(zt=k.current)==null||zt.style.setProperty("--swipe-amount-y",`${x.y}px`);}},Jt&&!t.jsx?React$1.createElement("button",{"aria-label":nt,"data-disabled":ht,"data-close-button":true,onClick:ht||!V?()=>{}:()=>{var r;$(),(r=t.onDismiss)==null||r.call(t,t);},className:M$1(s==null?void 0:s.closeButton,(Bt=t==null?void 0:t.classNames)==null?void 0:Bt.closeButton)},(Ct=P==null?void 0:P.close)!=null?Ct:Ot$1):null,t.jsx||reactExports.isValidElement(t.title)?t.jsx?t.jsx:typeof t.title=="function"?t.title():t.title:React$1.createElement(React$1.Fragment,null,N||t.icon||t.promise?React$1.createElement("div",{"data-icon":"",className:M$1(s==null?void 0:s.icon,(kt=t==null?void 0:t.classNames)==null?void 0:kt.icon)},t.promise||t.type==="loading"&&!t.icon?t.icon||Zt():null,t.type!=="loading"?t.icon||(P==null?void 0:P[N])||jt$1(N):null):null,React$1.createElement("div",{"data-content":"",className:M$1(s==null?void 0:s.content,(It=t==null?void 0:t.classNames)==null?void 0:It.content)},React$1.createElement("div",{"data-title":"",className:M$1(s==null?void 0:s.title,(Mt=t==null?void 0:t.classNames)==null?void 0:Mt.title)},typeof t.title=="function"?t.title():t.title),t.description?React$1.createElement("div",{"data-description":"",className:M$1(at,Xt,s==null?void 0:s.description,(Ht=t==null?void 0:t.classNames)==null?void 0:Ht.description)},typeof t.description=="function"?t.description():t.description):null),reactExports.isValidElement(t.cancel)?t.cancel:t.cancel&&tt$1(t.cancel)?React$1.createElement("button",{"data-button":true,"data-cancel":true,style:t.cancelButtonStyle||ft,onClick:r=>{var m,c;tt$1(t.cancel)&&V&&((c=(m=t.cancel).onClick)==null||c.call(m,r),$());},className:M$1(s==null?void 0:s.cancelButton,(At=t==null?void 0:t.classNames)==null?void 0:At.cancelButton)},t.cancel.label):null,reactExports.isValidElement(t.action)?t.action:t.action&&tt$1(t.action)?React$1.createElement("button",{"data-button":true,"data-action":true,style:t.actionButtonStyle||l,onClick:r=>{var m,c;tt$1(t.action)&&((c=(m=t.action).onClick)==null||c.call(m,r),!r.defaultPrevented&&$());},className:M$1(s==null?void 0:s.actionButton,(Lt=t==null?void 0:t.classNames)==null?void 0:Lt.actionButton)},t.action.label):null))};function _t$1(){if(typeof window=="undefined"||typeof document=="undefined")return "ltr";let n=document.documentElement.getAttribute("dir");return n==="auto"||!n?window.getComputedStyle(document.documentElement).direction:n}function Te(n,e){let t={};return [n,e].forEach((a,u)=>{let f=u===1,w=f?"--mobile-offset":"--offset",S=f?ge$1:me$1;function g(i){["top","right","bottom","left"].forEach(D=>{t[`${w}-${D}`]=typeof i=="number"?`${i}px`:i;});}typeof a=="number"||typeof a=="string"?g(a):typeof a=="object"?["top","right","bottom","left"].forEach(i=>{a[i]===void 0?t[`${w}-${i}`]=S:t[`${w}-${i}`]=typeof a[i]=="number"?`${a[i]}px`:a[i];}):g(S);}),t}var $e=reactExports.forwardRef(function(e,t){let{invert:a,position:u="bottom-right",hotkey:f=["altKey","KeyT"],expand:w,closeButton:S,className:g,offset:i,mobileOffset:D,theme:T="light",richColors:F,duration:et,style:ut,visibleToasts:ft=pe$1,toastOptions:l,dir:ot=_t$1(),gap:at=be$1,loadingIcon:X,icons:st,containerAriaLabel:pt="Notifications",pauseWhenPageIsHidden:rt}=e,[B,s]=React$1.useState([]),P=React$1.useMemo(()=>Array.from(new Set([u].concat(B.filter(d=>d.position).map(d=>d.position)))),[B,u]),[nt,it]=React$1.useState([]),[Y,C]=React$1.useState(false),[lt,J]=React$1.useState(false),[W,H]=React$1.useState(T!=="system"?T:typeof window!="undefined"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),A=React$1.useRef(null),mt=f.join("+").replace(/Key/g,"").replace(/Digit/g,""),L=React$1.useRef(null),z=React$1.useRef(false),ct=React$1.useCallback(d=>{s(h=>{var y;return (y=h.find(R=>R.id===d.id))!=null&&y.delete||v$2.dismiss(d.id),h.filter(({id:R})=>R!==d.id)});},[]);return React$1.useEffect(()=>v$2.subscribe(d=>{if(d.dismiss){s(h=>h.map(y=>y.id===d.id?{...y,delete:true}:y));return}setTimeout(()=>{ReactDOM.flushSync(()=>{s(h=>{let y=h.findIndex(R=>R.id===d.id);return y!==-1?[...h.slice(0,y),{...h[y],...d},...h.slice(y+1)]:[d,...h]});});});}),[]),React$1.useEffect(()=>{if(T!=="system"){H(T);return}if(T==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?H("dark"):H("light")),typeof window=="undefined")return;let d=window.matchMedia("(prefers-color-scheme: dark)");try{d.addEventListener("change",({matches:h})=>{H(h?"dark":"light");});}catch(h){d.addListener(({matches:y})=>{try{H(y?"dark":"light");}catch(R){console.error(R);}});}},[T]),React$1.useEffect(()=>{B.length<=1&&C(false);},[B]),React$1.useEffect(()=>{let d=h=>{var R,j;f.every(p=>h[p]||h.code===p)&&(C(true),(R=A.current)==null||R.focus()),h.code==="Escape"&&(document.activeElement===A.current||(j=A.current)!=null&&j.contains(document.activeElement))&&C(false);};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[f]),React$1.useEffect(()=>{if(A.current)return ()=>{L.current&&(L.current.focus({preventScroll:true}),L.current=null,z.current=false);}},[A.current]),React$1.createElement("section",{ref:t,"aria-label":`${pt} ${mt}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:true},P.map((d,h)=>{var j;let[y,R]=d.split("-");return B.length?React$1.createElement("ol",{key:d,dir:ot==="auto"?_t$1():ot,tabIndex:-1,ref:A,className:g,"data-sonner-toaster":true,"data-theme":W,"data-y-position":y,"data-lifted":Y&&B.length>1&&!w,"data-x-position":R,style:{"--front-toast-height":`${((j=nt[0])==null?void 0:j.height)||0}px`,"--width":`${he$1}px`,"--gap":`${at}px`,...ut,...Te(i,D)},onBlur:p=>{z.current&&!p.currentTarget.contains(p.relatedTarget)&&(z.current=false,L.current&&(L.current.focus({preventScroll:true}),L.current=null));},onFocus:p=>{p.target instanceof HTMLElement&&p.target.dataset.dismissible==="false"||z.current||(z.current=true,L.current=p.relatedTarget);},onMouseEnter:()=>C(true),onMouseMove:()=>C(true),onMouseLeave:()=>{lt||C(false);},onDragEnd:()=>C(false),onPointerDown:p=>{p.target instanceof HTMLElement&&p.target.dataset.dismissible==="false"||J(true);},onPointerUp:()=>J(false)},B.filter(p=>!p.position&&h===0||p.position===d).map((p,_)=>{var O,G;return React$1.createElement(ve$1,{key:p.id,icons:st,index:_,toast:p,defaultRichColors:F,duration:(O=l==null?void 0:l.duration)!=null?O:et,className:l==null?void 0:l.className,descriptionClassName:l==null?void 0:l.descriptionClassName,invert:a,visibleToasts:ft,closeButton:(G=l==null?void 0:l.closeButton)!=null?G:S,interacting:lt,position:d,style:l==null?void 0:l.style,unstyled:l==null?void 0:l.unstyled,classNames:l==null?void 0:l.classNames,cancelButtonStyle:l==null?void 0:l.cancelButtonStyle,actionButtonStyle:l==null?void 0:l.actionButtonStyle,removeToast:ct,toasts:B.filter(k=>k.position==p.position),heights:nt.filter(k=>k.position==p.position),setHeights:it,expandByDefault:w,gap:at,loadingIcon:X,expanded:Y,pauseWhenPageIsHidden:rt,swipeDirections:e.swipeDirections})})):null}))});

class ToastDebugManager {
  toasts = /* @__PURE__ */ new Map();
  isEnabled = false;
  constructor() {
    if (this.isEnabled && typeof window !== "undefined") {
      window.__M1_TOAST_DEBUG__ = {
        get: () => this.getState(),
        list: () => this.list(),
        show: (message) => this.testShow(message),
        dismiss: (id) => this.testDismiss(id)
      };
      console.log("🧪 Toast Debug enabled: window.__M1_TOAST_DEBUG__");
    }
  }
  trackToast(id, state) {
    if (!this.isEnabled) return;
    const existing = this.toasts.get(id);
    const now = Date.now();
    if (state === "entering" && !existing) {
      this.toasts.set(id, {
        id,
        state,
        startTime: now
      });
      console.log(`🍞 Toast ${id}: entering`);
    } else if (existing) {
      existing.state = state;
      console.log(`🍞 Toast ${id}: ${state} (age: ${now - existing.startTime}ms)`);
      if (state === "removed") {
        this.toasts.delete(id);
      }
    }
  }
  trackGesture(id, gesture) {
    if (!this.isEnabled) return;
    const toast = this.toasts.get(id);
    if (toast) {
      toast.gesture = gesture;
      console.log(`🍞 Toast ${id}: gesture`, gesture);
    }
  }
  trackTimer(id, timer) {
    if (!this.isEnabled) return;
    const toast = this.toasts.get(id);
    if (toast) {
      toast.timer = timer;
      console.log(`🍞 Toast ${id}: timer set (${timer}ms remaining)`);
    }
  }
  getState() {
    return {
      toasts: Array.from(this.toasts.values()),
      timestamp: Date.now(),
      enabled: this.isEnabled
    };
  }
  list() {
    console.table(Array.from(this.toasts.values()));
    return this.toasts.size;
  }
  testShow(message) {
    if (typeof window !== "undefined" && window.toast) {
      window.toast(message || "Test toast message");
      return "Toast triggered";
    }
    return "Toast function not found";
  }
  testDismiss(id) {
    const toast = this.toasts.get(id);
    if (toast) {
      this.trackToast(id, "exiting");
      return `Dismissing toast ${id}`;
    }
    return `Toast ${id} not found`;
  }
}
const toastDebug = new ToastDebugManager();

const Toaster = ({ ...props }) => {
  const { theme = "system" } = j$1();
  const gestureRef = reactExports.useRef({ startY: 0, startTime: 0, currentToast: null, isDragging: false });
  reactExports.useEffect(() => {
    const gesture = gestureRef.current;
    const handleTouchStart = (e) => {
      const target = e.target;
      const toastElement = target.closest("[data-sonner-toast]");
      if (!toastElement) return;
      gesture.currentToast = toastElement;
      gesture.startY = e.touches[0].clientY;
      gesture.startTime = Date.now();
      gesture.isDragging = false;
      toastDebug.trackGesture(toastElement.id || "unknown", {
        startY: gesture.startY,
        currentY: gesture.startY,
        isDragging: false
      });
      toastElement.classList.add("toast-swiping");
    };
    const handleTouchMove = (e) => {
      if (!gesture.currentToast) return;
      const deltaY = e.touches[0].clientY - gesture.startY;
      if (deltaY < 0) {
        e.preventDefault();
        gesture.isDragging = true;
        const clampedDelta = Math.max(deltaY, -80);
        const opacity = Math.max(0.2, 1 + clampedDelta / 80 * 0.8);
        gesture.currentToast.style.transform = `translateY(${clampedDelta}px)`;
        gesture.currentToast.style.opacity = opacity.toString();
        toastDebug.trackGesture(gesture.currentToast.id || "unknown", {
          startY: gesture.startY,
          currentY: e.touches[0].clientY,
          isDragging: true
        });
      }
    };
    const handleTouchEnd = (e) => {
      if (!gesture.currentToast) return;
      const deltaY = e.changedTouches[0].clientY - gesture.startY;
      const deltaTime = Date.now() - gesture.startTime;
      const velocity = Math.abs(deltaY) / deltaTime;
      gesture.currentToast.classList.remove("toast-swiping");
      const shouldDismiss = Math.abs(deltaY) >= 32 && deltaY < 0 || velocity >= 0.35 && deltaY < 0;
      if (shouldDismiss && gesture.isDragging) {
        gesture.currentToast.setAttribute("data-removed", "true");
        toastDebug.trackToast(gesture.currentToast.id || "unknown", "exiting");
        setTimeout(() => {
          gesture.currentToast?.remove();
        }, 320);
      } else if (gesture.isDragging) {
        gesture.currentToast.classList.add("toast-snap-back");
        gesture.currentToast.style.transform = "";
        gesture.currentToast.style.opacity = "";
        setTimeout(() => {
          gesture.currentToast?.classList.remove("toast-snap-back");
        }, 320);
      }
      gesture.currentToast = null;
      gesture.isDragging = false;
    };
    document.addEventListener("touchstart", handleTouchStart, { passive: false });
    document.addEventListener("touchmove", handleTouchMove, { passive: false });
    document.addEventListener("touchend", handleTouchEnd, { passive: false });
    return () => {
      document.removeEventListener("touchstart", handleTouchStart);
      document.removeEventListener("touchmove", handleTouchMove);
      document.removeEventListener("touchend", handleTouchEnd);
    };
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    $e,
    {
      theme,
      className: "toaster group",
      position: "top-center",
      richColors: false,
      closeButton: false,
      duration: 3e3,
      expand: false,
      visibleToasts: 3,
      offset: 0,
      toastOptions: {
        style: {
          background: "rgba(0, 12, 24, 0.95)",
          color: "white",
          border: "1px solid rgba(0, 209, 255, 0.5)",
          borderRadius: "20px",
          backdropFilter: "blur(24px)",
          boxShadow: "0 12px 40px rgba(0, 209, 255, 0.4), inset 0 2px 0 rgba(255, 255, 255, 0.15), 0 0 0 1px rgba(0, 209, 255, 0.2)",
          fontFamily: "Orbitron, -apple-system, BlinkMacSystemFont, sans-serif",
          fontSize: "15px",
          padding: "14px 40px",
          minHeight: "48px",
          width: "450px",
          maxWidth: "min(92vw, 420px)",
          fontWeight: "500",
          letterSpacing: "0.025em",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          WebkitUserSelect: "none",
          userSelect: "none",
          textAlign: "center",
          pointerEvents: "auto"
        },
        classNames: {
          toast: "toast-centered",
          description: "group-[.toast]:text-white/80",
          actionButton: "group-[.toast]:bg-cyan-500 group-[.toast]:text-black",
          cancelButton: "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"
        },
        unstyled: false
      },
      ...props
    }
  );
};

let diagnosticState = {
  standalone: false,
  hasSetAppBadge: false,
  hasClearAppBadge: false,
  ua: ""
};
function initPWABadgeDiagnostics() {
  if (typeof window === "undefined") return;
  const standalone = window.matchMedia("(display-mode: standalone)").matches || navigator.standalone === true || document.referrer.includes("android-app://");
  const hasSetAppBadge = typeof navigator.setAppBadge === "function";
  const hasClearAppBadge = typeof navigator.clearAppBadge === "function";
  diagnosticState = {
    standalone,
    hasSetAppBadge,
    hasClearAppBadge,
    ua: navigator.userAgent.slice(0, 120)
  };
  window.__M1_BADGE_DIAG__ = diagnosticState;
  console.log("🔍 PWA BADGE AUDIT - Environment Detection:", diagnosticState);
}
async function testBadgeAPI(count) {
  if (!diagnosticState.hasSetAppBadge) {
    console.warn("🔍 PWA BADGE TEST: setAppBadge not available");
    return false;
  }
  const testResult = {
    count,
    success: false,
    timestamp: (/* @__PURE__ */ new Date()).toISOString()
  };
  try {
    if (count > 0) {
      await navigator.setAppBadge(count);
      console.log(`🔍 PWA BADGE TEST: setAppBadge(${count}) SUCCESS`);
    } else {
      await navigator.clearAppBadge();
      console.log("🔍 PWA BADGE TEST: clearAppBadge() SUCCESS");
    }
    testResult.success = true;
  } catch (error) {
    testResult.success = false;
    testResult.error = error.message || error.toString();
    console.error("🔍 PWA BADGE TEST: Failed -", error);
  }
  diagnosticState.lastTest = testResult;
  return testResult.success;
}
function createBadgeTestHelpers() {
  if (typeof window === "undefined") return;
}
function getBadgeDiagnostics() {
  return { ...diagnosticState };
}

const pwaBadgeAudit = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  createBadgeTestHelpers,
  getBadgeDiagnostics,
  initPWABadgeDiagnostics,
  testBadgeAPI
}, Symbol.toStringTag, { value: 'Module' }));

let badgeUpdateTimeout = null;
function supportsBadging() {
  if (typeof navigator === "undefined") return false;
  const hasAPI = "setAppBadge" in navigator && "clearAppBadge" in navigator;
  const isPWA = window.matchMedia("(display-mode: standalone)").matches;
  return hasAPI && isPWA;
}
function setBadge(count) {
  if (badgeUpdateTimeout) {
    clearTimeout(badgeUpdateTimeout);
  }
  badgeUpdateTimeout = setTimeout(() => {
    if (!supportsBadging()) {
      return;
    }
    try {
      const safeCount = Math.max(0, Math.floor(count));
      if (safeCount > 0) {
        navigator.setAppBadge(safeCount);
        if (undefined                                 === "1") ;
      } else {
        navigator.clearAppBadge();
        if (undefined                                 === "1") ;
      }
    } catch (error) {
    }
  }, 200);
}
function syncFromNotice(count) {
  setBadge(count);
}
function getPlatformInfo() {
  const userAgent = navigator.userAgent.toLowerCase();
  const isIOS = /iphone|ipad|ipod/.test(userAgent);
  const isAndroid = /android/.test(userAgent);
  const isDesktop = !isIOS && !isAndroid;
  const isPWA = window.matchMedia("(display-mode: standalone)").matches;
  return {
    isIOS,
    isAndroid,
    isDesktop,
    isPWA,
    supportsIconBadge: supportsBadging(),
    platform: isIOS ? "iosPWA" : isAndroid ? "android" : "desktop"
  };
}

let currentState = {
  unreadCount: 0,
  lastUpdate: (/* @__PURE__ */ new Date()).toISOString(),
  supportsIconBadge: false,
  platform: "unknown"
};
function updateBadgeState(unreadCount) {
  const platformInfo = getPlatformInfo();
  currentState = {
    unreadCount,
    lastUpdate: (/* @__PURE__ */ new Date()).toISOString(),
    supportsIconBadge: platformInfo.supportsIconBadge,
    platform: platformInfo.platform
  };
}
function getBadgeState() {
  return { ...currentState };
}
function testBadge(count) {
  return false;
}
function initBadgeDiagnostics() {
  if (typeof window !== "undefined") {
    window.__M1_BADGE__ = {
      get: () => getBadgeState(),
      test: testBadge,
      platform: getPlatformInfo()
    };
  }
}

let syncTimeout = null;
let lastSyncValue = -1;
function isSupported$1() {
  if (typeof navigator === "undefined" || typeof window === "undefined") {
    return false;
  }
  const hasAPI = "setAppBadge" in navigator && "clearAppBadge" in navigator;
  const isStandalone = window.matchMedia("(display-mode: standalone)").matches || navigator.standalone === true || document.referrer.includes("android-app://");
  return hasAPI && isStandalone;
}
async function syncAppIconBadge(count) {
  if (syncTimeout) {
    clearTimeout(syncTimeout);
  }
  syncTimeout = setTimeout(async () => {
    if (lastSyncValue === count) {
      return;
    }
    if (!isSupported$1()) {
      return;
    }
    try {
      const safeCount = Math.max(0, Math.floor(count || 0));
      if (safeCount > 0) {
        await navigator.setAppBadge(safeCount);
        if (undefined                                 === "1") ;
      } else {
        await navigator.clearAppBadge();
        if (undefined                                 === "1") ;
      }
      lastSyncValue = safeCount;
    } catch (error) {
    }
  }, 150);
}

let listeners = [];
const MAX_NOTIFICATIONS = 100;
const STORAGE_KEY$3 = "notifications";
const NOTIFICATION_CATEGORIES$1 = {
  LEADERBOARD: "leaderboard_update",
  BUZZ: "buzz",
  MAP_BUZZ: "map_buzz",
  WEEKLY: "weekly_summary",
  GENERIC: "generic"
};
function useNotifications() {
  const [notifications, setNotifications] = reactExports.useState([]);
  const [unreadCount, setUnreadCount] = reactExports.useState(0);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const loadingTimeoutRef = reactExports.useRef(null);
  const lastReloadTimeRef = reactExports.useRef(0);
  const isInitialLoadRef = reactExports.useRef(true);
  const saveNotifications = reactExports.useCallback((notifs) => {
    try {
      const limitedNotifs = notifs.slice(-MAX_NOTIFICATIONS);
      localStorage.setItem(STORAGE_KEY$3, JSON.stringify(limitedNotifs));
      return true;
    } catch (error) {
      console.error("Errore nel salvataggio delle notifiche:", error);
      return false;
    }
  }, []);
  const reloadNotifications = reactExports.useCallback(async (force = false) => {
    if (!force && document.visibilityState !== "visible") {
      console.log("⏸️ NOTIFICATIONS: Skipping reload - page not visible");
      return true;
    }
    const now = Date.now();
    if (!force && now - lastReloadTimeRef.current < 1e3 && !isInitialLoadRef.current) {
      console.log("⏱️ NOTIFICATIONS: Skipping reload due to rate limiting");
      return true;
    }
    try {
      console.log("🔄 NOTIFICATIONS: Reloading notifications from Supabase...");
      if (isInitialLoadRef.current || now - lastReloadTimeRef.current > 1e3) {
        setIsLoading(true);
      }
      if (loadingTimeoutRef.current) {
        clearTimeout(loadingTimeoutRef.current);
      }
      console.log("🧹 NOTIFICATIONS: Clearing localStorage cache after DB reset");
      localStorage.removeItem(STORAGE_KEY$3);
      let notifs = [];
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        console.log("👤 NOTIFICATIONS: User authenticated, loading from Supabase...");
        const { data: supabaseNotifs, error } = await supabase.from("user_notifications").select("*").eq("is_deleted", false).eq("user_id", user.id).order("created_at", { ascending: false });
        if (error) {
          console.error("❌ NOTIFICATIONS: Error fetching from Supabase:", error);
        } else if (supabaseNotifs && supabaseNotifs.length > 0) {
          console.log("✅ NOTIFICATIONS: Loaded from Supabase:", supabaseNotifs.length);
          notifs = supabaseNotifs.map((n) => ({
            id: n.id,
            title: n.title,
            description: n.message,
            date: n.created_at,
            read: n.is_read === true,
            type: n.type
          })).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
          saveNotifications(notifs);
        }
      }
      const unreadCount2 = notifs.filter((n) => !n.read).length;
      console.log("📊 NOTIFICATIONS: Total:", notifs.length, "Unread:", unreadCount2);
      if (undefined                                 === "1") ;
      setNotifications(notifs);
      setUnreadCount(unreadCount2);
      try {
        await syncAppIconBadge(unreadCount2);
        if (undefined                                 === "1") ;
      } catch (badgeError) {
        if (undefined                                 === "1") ;
      }
      syncFromNotice(unreadCount2);
      updateBadgeState(unreadCount2);
      if (unreadCount2 > 0 && undefined                                 === "1") ;
      loadingTimeoutRef.current = setTimeout(() => {
        setIsLoading(false);
        loadingTimeoutRef.current = null;
      }, 200);
      lastReloadTimeRef.current = now;
      isInitialLoadRef.current = false;
      return true;
    } catch (e) {
      console.error("❌ NOTIFICATIONS: Error loading:", e);
      setNotifications([]);
      setUnreadCount(0);
      setIsLoading(false);
      return false;
    }
  }, [saveNotifications]);
  const markAllAsRead = reactExports.useCallback(async () => {
    if (notifications.length === 0) return;
    console.log("📖 Marcando tutte le notifiche come lette...");
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { error } = await supabase.from("user_notifications").update({ is_read: true }).eq("user_id", user.id).eq("is_deleted", false);
        if (error) {
          console.error("❌ Error marking notifications as read in Supabase:", error);
          return;
        } else {
          console.log("✅ Tutte le notifiche marcate come lette su Supabase");
        }
      }
      const updated = notifications.map((n) => ({ ...n, read: true }));
      const saved = saveNotifications(updated);
      if (saved) {
        setNotifications(updated);
        setUnreadCount(0);
        try {
          await syncAppIconBadge(0);
        } catch (badgeError) {
        }
        syncFromNotice(0);
        updateBadgeState(0);
        listeners.forEach((fn) => fn());
        console.log("✅ Stato locale aggiornato");
      }
    } catch (error) {
      console.error("❌ Error in markAllAsRead:", error);
    }
  }, [notifications, saveNotifications]);
  reactExports.useEffect(() => {
    const setupRealtimeSubscription = async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      console.log("🔔 NOTIFICATIONS: Setting up real-time subscription for user:", user.id);
      const channel = supabase.channel("notification-changes").on(
        "postgres_changes",
        {
          event: "*",
          schema: "public",
          table: "user_notifications",
          filter: `user_id=eq.${user.id}`
        },
        (payload) => {
          console.log("🔔 NOTIFICATIONS: Real-time update received:", payload);
          if (payload.eventType === "INSERT" || payload.eventType === "UPDATE") {
            console.log("🔔 NOTIFICATIONS: New notification detected, forcing reload");
            reloadNotifications(true);
          }
        }
      ).subscribe();
      return () => {
        console.log("🔔 NOTIFICATIONS: Unsubscribing from real-time");
        supabase.removeChannel(channel);
      };
    };
    setupRealtimeSubscription();
  }, [reloadNotifications]);
  reactExports.useEffect(() => {
    const startPolling = () => {
      const interval = setInterval(() => {
        if (document.visibilityState === "visible") {
          console.log("🔄 NOTIFICATIONS: Polling for updates...");
          reloadNotifications();
        }
      }, 5e3);
      return interval;
    };
    if (!isInitialLoadRef.current) {
      reloadNotifications().then(() => {
        console.log("📱 NOTIFICATIONS: Initial load completed");
        isInitialLoadRef.current = true;
      });
    }
    const pollingInterval = startPolling();
    return () => {
      clearInterval(pollingInterval);
    };
  }, [reloadNotifications]);
  reactExports.useEffect(() => {
    const handleVisibilityChange = () => {
      if (document.visibilityState === "visible" && !isInitialLoadRef.current) {
        console.log("👁️ NOTIFICATIONS: Page visible, checking for updates...");
        reloadNotifications(true);
      }
    };
    const handleFocus = () => {
      if (!isInitialLoadRef.current) {
        console.log("🎯 NOTIFICATIONS: Window focused, syncing badge...");
        syncFromNotice(unreadCount);
        syncAppIconBadge(unreadCount);
      }
    };
    document.addEventListener("visibilitychange", handleVisibilityChange);
    window.addEventListener("focus", handleFocus);
    return () => {
      document.removeEventListener("visibilitychange", handleVisibilityChange);
      window.removeEventListener("focus", handleFocus);
    };
  }, [reloadNotifications, unreadCount]);
  const markAsRead = reactExports.useCallback(async (id) => {
    console.log("📖 Marcando notifica come letta:", id);
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { error } = await supabase.from("user_notifications").update({ is_read: true }).eq("id", id);
        if (error) {
          console.error("❌ Error marking notification as read in Supabase:", error);
        } else {
          console.log("✅ Notifica marcata come letta su Supabase");
        }
      }
      const updated = notifications.map((n) => n.id === id ? { ...n, read: true } : n);
      const saved = saveNotifications(updated);
      if (saved) {
        const newUnreadCount = updated.filter((n) => !n.read).length;
        if (undefined                                 === "1") ;
        setNotifications(updated);
        setUnreadCount(newUnreadCount);
        try {
          await syncAppIconBadge(newUnreadCount);
        } catch (badgeError) {
        }
        syncFromNotice(newUnreadCount);
        updateBadgeState(newUnreadCount);
        listeners.forEach((fn) => fn());
        console.log("✅ Stato locale aggiornato per notifica:", id);
      }
      return saved;
    } catch (error) {
      console.error("❌ Error in markAsRead:", error);
      return false;
    }
  }, [notifications, saveNotifications]);
  const deleteNotification = reactExports.useCallback(async (id) => {
    try {
      console.log("Deleting notification:", id);
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { error } = await supabase.from("user_notifications").update({ is_deleted: true }).eq("id", id);
        if (error) {
          console.error("Error deleting notification in Supabase:", error);
        }
      }
      const updated = notifications.filter((n) => n.id !== id);
      const saved = saveNotifications(updated);
      if (saved) {
        const newUnreadCount = updated.filter((n) => !n.read).length;
        setNotifications(updated);
        setUnreadCount(newUnreadCount);
        try {
          await syncAppIconBadge(newUnreadCount);
        } catch (badgeError) {
        }
        syncFromNotice(newUnreadCount);
        updateBadgeState(newUnreadCount);
        listeners.forEach((fn) => fn());
      }
      return saved;
    } catch (error) {
      console.error("Error deleting notification:", error);
      return false;
    }
  }, [notifications, saveNotifications]);
  const addNotification = reactExports.useCallback(async (notification) => {
    const type = notification.type || NOTIFICATION_CATEGORIES$1.GENERIC;
    try {
      console.log("Adding UNIQUE notification:", notification);
      let tempId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      let newNotification = {
        id: tempId,
        title: notification.title,
        description: notification.description,
        date: (/* @__PURE__ */ new Date()).toISOString(),
        read: false,
        type
      };
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { error, data } = await supabase.from("user_notifications").insert({
          user_id: user.id,
          type,
          title: notification.title,
          message: notification.description,
          is_read: false
        }).select().single();
        if (error) {
          console.error("Error saving notification to Supabase:", error);
        } else if (data) {
          newNotification.id = data.id;
          console.log("✅ UNIQUE Notification saved to Supabase with ID:", data.id);
        }
      }
      const stored = localStorage.getItem(STORAGE_KEY$3);
      const currentNotifs = stored ? JSON.parse(stored) : [];
      const updated = [newNotification, ...currentNotifs];
      const saved = saveNotifications(updated);
      if (saved) {
        const newUnreadCount = updated.filter((n) => !n.read).length;
        setNotifications(updated);
        setUnreadCount(newUnreadCount);
        try {
          await syncAppIconBadge(newUnreadCount);
        } catch (badgeError) {
        }
        syncFromNotice(newUnreadCount);
        updateBadgeState(newUnreadCount);
        listeners.forEach((fn) => fn());
        console.log("✅ UNIQUE Notification added successfully:", newNotification);
      }
      return saved;
    } catch (error) {
      console.error("Error adding notification:", error);
      return false;
    }
  }, [saveNotifications]);
  const getNotificationsByCategory = reactExports.useCallback((category) => {
    return notifications.filter((n) => n.type === category);
  }, [notifications]);
  const manualReload = reactExports.useCallback(async () => {
    console.log("🔄 NOTIFICATIONS: Manual reload requested");
    return await reloadNotifications(true);
  }, [reloadNotifications]);
  return {
    notifications,
    unreadCount,
    isLoading,
    reloadNotifications: manualReload,
    markAllAsRead,
    markAsRead,
    addNotification,
    deleteNotification,
    getNotificationsByCategory
  };
}

const BadgeAuditReport = () => {
  useNotifications();
  getBadgeDiagnostics();
  {
    return null;
  }
};

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */

const toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, "$1-$2").toLowerCase();
const mergeClasses = (...classes) => classes.filter((className, index, array) => {
  return Boolean(className) && className.trim() !== "" && array.indexOf(className) === index;
}).join(" ").trim();

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */

var defaultAttributes = {
  xmlns: "http://www.w3.org/2000/svg",
  width: 24,
  height: 24,
  viewBox: "0 0 24 24",
  fill: "none",
  stroke: "currentColor",
  strokeWidth: 2,
  strokeLinecap: "round",
  strokeLinejoin: "round"
};

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Icon$1 = reactExports.forwardRef(
  ({
    color = "currentColor",
    size = 24,
    strokeWidth = 2,
    absoluteStrokeWidth,
    className = "",
    children,
    iconNode,
    ...rest
  }, ref) => {
    return reactExports.createElement(
      "svg",
      {
        ref,
        ...defaultAttributes,
        width: size,
        height: size,
        stroke: color,
        strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,
        className: mergeClasses("lucide", className),
        ...rest
      },
      [
        ...iconNode.map(([tag, attrs]) => reactExports.createElement(tag, attrs)),
        ...Array.isArray(children) ? children : [children]
      ]
    );
  }
);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const createLucideIcon = (iconName, iconNode) => {
  const Component = reactExports.forwardRef(
    ({ className, ...props }, ref) => reactExports.createElement(Icon$1, {
      ref,
      iconNode,
      className: mergeClasses(`lucide-${toKebabCase(iconName)}`, className),
      ...props
    })
  );
  Component.displayName = `${iconName}`;
  return Component;
};

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Activity = createLucideIcon("Activity", [
  [
    "path",
    {
      d: "M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",
      key: "169zse"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Apple = createLucideIcon("Apple", [
  [
    "path",
    {
      d: "M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",
      key: "3s7exb"
    }
  ],
  ["path", { d: "M10 2c1 .5 2 2 2 5", key: "fcco2y" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Archive = createLucideIcon("Archive", [
  ["rect", { width: "20", height: "5", x: "2", y: "3", rx: "1", key: "1wp1u1" }],
  ["path", { d: "M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8", key: "1s80jp" }],
  ["path", { d: "M10 12h4", key: "a56b0p" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ArrowDown = createLucideIcon("ArrowDown", [
  ["path", { d: "M12 5v14", key: "s699le" }],
  ["path", { d: "m19 12-7 7-7-7", key: "1idqje" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ArrowLeft = createLucideIcon("ArrowLeft", [
  ["path", { d: "m12 19-7-7 7-7", key: "1l729n" }],
  ["path", { d: "M19 12H5", key: "x3x0zl" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ArrowRight = createLucideIcon("ArrowRight", [
  ["path", { d: "M5 12h14", key: "1ays0h" }],
  ["path", { d: "m12 5 7 7-7 7", key: "xquz4c" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Award = createLucideIcon("Award", [
  [
    "path",
    {
      d: "m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",
      key: "1yiouv"
    }
  ],
  ["circle", { cx: "12", cy: "8", r: "6", key: "1vp47v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Battery = createLucideIcon("Battery", [
  ["rect", { width: "16", height: "10", x: "2", y: "7", rx: "2", ry: "2", key: "1w10f2" }],
  ["line", { x1: "22", x2: "22", y1: "11", y2: "13", key: "4dh1rd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const BellOff = createLucideIcon("BellOff", [
  ["path", { d: "M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5", key: "o7mx20" }],
  ["path", { d: "M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7", key: "16f1lm" }],
  ["path", { d: "M10.3 21a1.94 1.94 0 0 0 3.4 0", key: "qgo35s" }],
  ["path", { d: "m2 2 20 20", key: "1ooewy" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Bell = createLucideIcon("Bell", [
  ["path", { d: "M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9", key: "1qo2s2" }],
  ["path", { d: "M10.3 21a1.94 1.94 0 0 0 3.4 0", key: "qgo35s" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const BookOpen = createLucideIcon("BookOpen", [
  ["path", { d: "M12 7v14", key: "1akyts" }],
  [
    "path",
    {
      d: "M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",
      key: "ruj8y"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Bot = createLucideIcon("Bot", [
  ["path", { d: "M12 8V4H8", key: "hb8ula" }],
  ["rect", { width: "16", height: "12", x: "4", y: "8", rx: "2", key: "enze0r" }],
  ["path", { d: "M2 14h2", key: "vft8re" }],
  ["path", { d: "M20 14h2", key: "4cs60a" }],
  ["path", { d: "M15 13v2", key: "1xurst" }],
  ["path", { d: "M9 13v2", key: "rq6x2g" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Brain = createLucideIcon("Brain", [
  [
    "path",
    {
      d: "M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",
      key: "l5xja"
    }
  ],
  [
    "path",
    {
      d: "M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",
      key: "ep3f8r"
    }
  ],
  ["path", { d: "M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4", key: "1p4c4q" }],
  ["path", { d: "M17.599 6.5a3 3 0 0 0 .399-1.375", key: "tmeiqw" }],
  ["path", { d: "M6.003 5.125A3 3 0 0 0 6.401 6.5", key: "105sqy" }],
  ["path", { d: "M3.477 10.896a4 4 0 0 1 .585-.396", key: "ql3yin" }],
  ["path", { d: "M19.938 10.5a4 4 0 0 1 .585.396", key: "1qfode" }],
  ["path", { d: "M6 18a4 4 0 0 1-1.967-.516", key: "2e4loj" }],
  ["path", { d: "M19.967 17.484A4 4 0 0 1 18 18", key: "159ez6" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Bug = createLucideIcon("Bug", [
  ["path", { d: "m8 2 1.88 1.88", key: "fmnt4t" }],
  ["path", { d: "M14.12 3.88 16 2", key: "qol33r" }],
  ["path", { d: "M9 7.13v-1a3.003 3.003 0 1 1 6 0v1", key: "d7y7pr" }],
  [
    "path",
    {
      d: "M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",
      key: "xs1cw7"
    }
  ],
  ["path", { d: "M12 20v-9", key: "1qisl0" }],
  ["path", { d: "M6.53 9C4.6 8.8 3 7.1 3 5", key: "32zzws" }],
  ["path", { d: "M6 13H2", key: "82j7cp" }],
  ["path", { d: "M3 21c0-2.1 1.7-3.9 3.8-4", key: "4p0ekp" }],
  ["path", { d: "M20.97 5c0 2.1-1.6 3.8-3.5 4", key: "18gb23" }],
  ["path", { d: "M22 13h-4", key: "1jl80f" }],
  ["path", { d: "M17.2 17c2.1.1 3.8 1.9 3.8 4", key: "k3fwyw" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Calendar = createLucideIcon("Calendar", [
  ["path", { d: "M8 2v4", key: "1cmpym" }],
  ["path", { d: "M16 2v4", key: "4m81vk" }],
  ["rect", { width: "18", height: "18", x: "3", y: "4", rx: "2", key: "1hopcy" }],
  ["path", { d: "M3 10h18", key: "8toen8" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Camera = createLucideIcon("Camera", [
  [
    "path",
    {
      d: "M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",
      key: "1tc9qg"
    }
  ],
  ["circle", { cx: "12", cy: "13", r: "3", key: "1vg3eu" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ChartColumn = createLucideIcon("ChartColumn", [
  ["path", { d: "M3 3v16a2 2 0 0 0 2 2h16", key: "c24i48" }],
  ["path", { d: "M18 17V9", key: "2bz60n" }],
  ["path", { d: "M13 17V5", key: "1frdt8" }],
  ["path", { d: "M8 17v-3", key: "17ska0" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ChartNoAxesColumnIncreasing = createLucideIcon("ChartNoAxesColumnIncreasing", [
  ["line", { x1: "12", x2: "12", y1: "20", y2: "10", key: "1vz5eb" }],
  ["line", { x1: "18", x2: "18", y1: "20", y2: "4", key: "cun8e5" }],
  ["line", { x1: "6", x2: "6", y1: "20", y2: "16", key: "hq0ia6" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Check = createLucideIcon("Check", [["path", { d: "M20 6 9 17l-5-5", key: "1gmf2c" }]]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ChevronDown = createLucideIcon("ChevronDown", [
  ["path", { d: "m6 9 6 6 6-6", key: "qrunsl" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ChevronRight = createLucideIcon("ChevronRight", [
  ["path", { d: "m9 18 6-6-6-6", key: "mthhwq" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ChevronUp = createLucideIcon("ChevronUp", [["path", { d: "m18 15-6-6-6 6", key: "153udz" }]]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CircleAlert = createLucideIcon("CircleAlert", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["line", { x1: "12", x2: "12", y1: "8", y2: "12", key: "1pkeuh" }],
  ["line", { x1: "12", x2: "12.01", y1: "16", y2: "16", key: "4dfq90" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CircleCheckBig = createLucideIcon("CircleCheckBig", [
  ["path", { d: "M21.801 10A10 10 0 1 1 17 3.335", key: "yps3ct" }],
  ["path", { d: "m9 11 3 3L22 4", key: "1pflzl" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CircleCheck = createLucideIcon("CircleCheck", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "m9 12 2 2 4-4", key: "dzmm74" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CircleDot = createLucideIcon("CircleDot", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["circle", { cx: "12", cy: "12", r: "1", key: "41hilf" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CirclePlay = createLucideIcon("CirclePlay", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["polygon", { points: "10 8 16 12 10 16 10 8", key: "1cimsy" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CircleX = createLucideIcon("CircleX", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "m15 9-6 6", key: "1uzhvr" }],
  ["path", { d: "m9 9 6 6", key: "z0biqf" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Circle = createLucideIcon("Circle", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Clock = createLucideIcon("Clock", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["polyline", { points: "12 6 12 12 16 14", key: "68esgv" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Coins = createLucideIcon("Coins", [
  ["circle", { cx: "8", cy: "8", r: "6", key: "3yglwk" }],
  ["path", { d: "M18.09 10.37A6 6 0 1 1 10.34 18", key: "t5s6rm" }],
  ["path", { d: "M7 6h1v4", key: "1obek4" }],
  ["path", { d: "m16.71 13.88.7.71-2.82 2.82", key: "1rbuyh" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Cookie = createLucideIcon("Cookie", [
  ["path", { d: "M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5", key: "laymnq" }],
  ["path", { d: "M8.5 8.5v.01", key: "ue8clq" }],
  ["path", { d: "M16 15.5v.01", key: "14dtrp" }],
  ["path", { d: "M12 12v.01", key: "u5ubse" }],
  ["path", { d: "M11 17v.01", key: "1hyl5a" }],
  ["path", { d: "M7 14v.01", key: "uct60s" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Copy = createLucideIcon("Copy", [
  ["rect", { width: "14", height: "14", x: "8", y: "8", rx: "2", ry: "2", key: "17jyea" }],
  ["path", { d: "M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2", key: "zix9uf" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Copyright = createLucideIcon("Copyright", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "M14.83 14.83a4 4 0 1 1 0-5.66", key: "1i56pz" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Cpu = createLucideIcon("Cpu", [
  ["rect", { width: "16", height: "16", x: "4", y: "4", rx: "2", key: "14l7u7" }],
  ["rect", { width: "6", height: "6", x: "9", y: "9", rx: "1", key: "5aljv4" }],
  ["path", { d: "M15 2v2", key: "13l42r" }],
  ["path", { d: "M15 20v2", key: "15mkzm" }],
  ["path", { d: "M2 15h2", key: "1gxd5l" }],
  ["path", { d: "M2 9h2", key: "1bbxkp" }],
  ["path", { d: "M20 15h2", key: "19e6y8" }],
  ["path", { d: "M20 9h2", key: "19tzq7" }],
  ["path", { d: "M9 2v2", key: "165o2o" }],
  ["path", { d: "M9 20v2", key: "i2bqo8" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const CreditCard = createLucideIcon("CreditCard", [
  ["rect", { width: "20", height: "14", x: "2", y: "5", rx: "2", key: "ynyp8z" }],
  ["line", { x1: "2", x2: "22", y1: "10", y2: "10", key: "1b3vmo" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Crosshair = createLucideIcon("Crosshair", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["line", { x1: "22", x2: "18", y1: "12", y2: "12", key: "l9bcsi" }],
  ["line", { x1: "6", x2: "2", y1: "12", y2: "12", key: "13hhkx" }],
  ["line", { x1: "12", x2: "12", y1: "6", y2: "2", key: "10w3f3" }],
  ["line", { x1: "12", x2: "12", y1: "22", y2: "18", key: "15g9kq" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Crown = createLucideIcon("Crown", [
  [
    "path",
    {
      d: "M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",
      key: "1vdc57"
    }
  ],
  ["path", { d: "M5 21h14", key: "11awu3" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Database = createLucideIcon("Database", [
  ["ellipse", { cx: "12", cy: "5", rx: "9", ry: "3", key: "msslwz" }],
  ["path", { d: "M3 5V19A9 3 0 0 0 21 19V5", key: "1wlel7" }],
  ["path", { d: "M3 12A9 3 0 0 0 21 12", key: "mv7ke4" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Download = createLucideIcon("Download", [
  ["path", { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4", key: "ih7n3h" }],
  ["polyline", { points: "7 10 12 15 17 10", key: "2ggqvy" }],
  ["line", { x1: "12", x2: "12", y1: "15", y2: "3", key: "1vk2je" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Ellipsis = createLucideIcon("Ellipsis", [
  ["circle", { cx: "12", cy: "12", r: "1", key: "41hilf" }],
  ["circle", { cx: "19", cy: "12", r: "1", key: "1wjl8i" }],
  ["circle", { cx: "5", cy: "12", r: "1", key: "1pcz8c" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ExternalLink = createLucideIcon("ExternalLink", [
  ["path", { d: "M15 3h6v6", key: "1q9fwt" }],
  ["path", { d: "M10 14 21 3", key: "gplh6r" }],
  ["path", { d: "M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6", key: "a6xqqp" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const EyeOff = createLucideIcon("EyeOff", [
  [
    "path",
    {
      d: "M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",
      key: "ct8e1f"
    }
  ],
  ["path", { d: "M14.084 14.158a3 3 0 0 1-4.242-4.242", key: "151rxh" }],
  [
    "path",
    {
      d: "M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",
      key: "13bj9a"
    }
  ],
  ["path", { d: "m2 2 20 20", key: "1ooewy" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Eye = createLucideIcon("Eye", [
  [
    "path",
    {
      d: "M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",
      key: "1nclc0"
    }
  ],
  ["circle", { cx: "12", cy: "12", r: "3", key: "1v7zrd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const FileText = createLucideIcon("FileText", [
  ["path", { d: "M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z", key: "1rqfz7" }],
  ["path", { d: "M14 2v4a2 2 0 0 0 2 2h4", key: "tnqrlb" }],
  ["path", { d: "M10 9H8", key: "b1mrlr" }],
  ["path", { d: "M16 13H8", key: "t4e002" }],
  ["path", { d: "M16 17H8", key: "z1uh3a" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Flame = createLucideIcon("Flame", [
  [
    "path",
    {
      d: "M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",
      key: "96xj49"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Gem = createLucideIcon("Gem", [
  ["path", { d: "M6 3h12l4 6-10 13L2 9Z", key: "1pcd5k" }],
  ["path", { d: "M11 3 8 9l4 13 4-13-3-6", key: "1fcu3u" }],
  ["path", { d: "M2 9h20", key: "16fsjt" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Gift = createLucideIcon("Gift", [
  ["rect", { x: "3", y: "8", width: "18", height: "4", rx: "1", key: "bkv52" }],
  ["path", { d: "M12 8v13", key: "1c76mn" }],
  ["path", { d: "M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7", key: "6wjy6b" }],
  [
    "path",
    {
      d: "M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",
      key: "1ihvrl"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Globe = createLucideIcon("Globe", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20", key: "13o1zl" }],
  ["path", { d: "M2 12h20", key: "9i4pu4" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Heart = createLucideIcon("Heart", [
  [
    "path",
    {
      d: "M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",
      key: "c3ymky"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const House = createLucideIcon("House", [
  ["path", { d: "M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8", key: "5wwlr5" }],
  [
    "path",
    {
      d: "M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",
      key: "1d0kgt"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const IdCard = createLucideIcon("IdCard", [
  ["path", { d: "M16 10h2", key: "8sgtl7" }],
  ["path", { d: "M16 14h2", key: "epxaof" }],
  ["path", { d: "M6.17 15a3 3 0 0 1 5.66 0", key: "n6f512" }],
  ["circle", { cx: "9", cy: "11", r: "2", key: "yxgjnd" }],
  ["rect", { x: "2", y: "5", width: "20", height: "14", rx: "2", key: "qneu4z" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Image$2 = createLucideIcon("Image", [
  ["rect", { width: "18", height: "18", x: "3", y: "3", rx: "2", ry: "2", key: "1m3agn" }],
  ["circle", { cx: "9", cy: "9", r: "2", key: "af1f0g" }],
  ["path", { d: "m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21", key: "1xmnt7" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Infinity$1 = createLucideIcon("Infinity", [
  [
    "path",
    {
      d: "M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",
      key: "1z0uae"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Info = createLucideIcon("Info", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "M12 16v-4", key: "1dtifu" }],
  ["path", { d: "M12 8h.01", key: "e9boi3" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Key = createLucideIcon("Key", [
  ["path", { d: "m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4", key: "g0fldk" }],
  ["path", { d: "m21 2-9.6 9.6", key: "1j0ho8" }],
  ["circle", { cx: "7.5", cy: "15.5", r: "5.5", key: "yqb3hr" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Link2 = createLucideIcon("Link2", [
  ["path", { d: "M9 17H7A5 5 0 0 1 7 7h2", key: "8i5ue5" }],
  ["path", { d: "M15 7h2a5 5 0 1 1 0 10h-2", key: "1b9ql8" }],
  ["line", { x1: "8", x2: "16", y1: "12", y2: "12", key: "1jonct" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const LoaderCircle = createLucideIcon("LoaderCircle", [
  ["path", { d: "M21 12a9 9 0 1 1-6.219-8.56", key: "13zald" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Lock = createLucideIcon("Lock", [
  ["rect", { width: "18", height: "11", x: "3", y: "11", rx: "2", ry: "2", key: "1w4ew1" }],
  ["path", { d: "M7 11V7a5 5 0 0 1 10 0v4", key: "fwvmzm" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const LogOut = createLucideIcon("LogOut", [
  ["path", { d: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4", key: "1uf3rs" }],
  ["polyline", { points: "16 17 21 12 16 7", key: "1gabdz" }],
  ["line", { x1: "21", x2: "9", y1: "12", y2: "12", key: "1uyos4" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Mail = createLucideIcon("Mail", [
  ["rect", { width: "20", height: "16", x: "2", y: "4", rx: "2", key: "18n3k1" }],
  ["path", { d: "m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7", key: "1ocrg3" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const MapPin = createLucideIcon("MapPin", [
  [
    "path",
    {
      d: "M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",
      key: "1r0f0z"
    }
  ],
  ["circle", { cx: "12", cy: "10", r: "3", key: "ilqhr7" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Map$1 = createLucideIcon("Map", [
  [
    "path",
    {
      d: "M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",
      key: "169xi5"
    }
  ],
  ["path", { d: "M15 5.764v15", key: "1pn4in" }],
  ["path", { d: "M9 3.236v15", key: "1uimfh" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Medal = createLucideIcon("Medal", [
  [
    "path",
    {
      d: "M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",
      key: "143lza"
    }
  ],
  ["path", { d: "M11 12 5.12 2.2", key: "qhuxz6" }],
  ["path", { d: "m13 12 5.88-9.8", key: "hbye0f" }],
  ["path", { d: "M8 7h8", key: "i86dvs" }],
  ["circle", { cx: "12", cy: "17", r: "5", key: "qbz8iq" }],
  ["path", { d: "M12 18v-2h-.5", key: "fawc4q" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const MessageCircle = createLucideIcon("MessageCircle", [
  ["path", { d: "M7.9 20A9 9 0 1 0 4 16.1L2 22Z", key: "vv11sd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const MessageSquare = createLucideIcon("MessageSquare", [
  ["path", { d: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z", key: "1lielz" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const MicOff = createLucideIcon("MicOff", [
  ["line", { x1: "2", x2: "22", y1: "2", y2: "22", key: "a6p6uj" }],
  ["path", { d: "M18.89 13.23A7.12 7.12 0 0 0 19 12v-2", key: "80xlxr" }],
  ["path", { d: "M5 10v2a7 7 0 0 0 12 5", key: "p2k8kg" }],
  ["path", { d: "M15 9.34V5a3 3 0 0 0-5.68-1.33", key: "1gzdoj" }],
  ["path", { d: "M9 9v3a3 3 0 0 0 5.12 2.12", key: "r2i35w" }],
  ["line", { x1: "12", x2: "12", y1: "19", y2: "22", key: "x3vr5v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Mic = createLucideIcon("Mic", [
  ["path", { d: "M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z", key: "131961" }],
  ["path", { d: "M19 10v2a7 7 0 0 1-14 0v-2", key: "1vc78b" }],
  ["line", { x1: "12", x2: "12", y1: "19", y2: "22", key: "x3vr5v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Monitor = createLucideIcon("Monitor", [
  ["rect", { width: "20", height: "14", x: "2", y: "3", rx: "2", key: "48i651" }],
  ["line", { x1: "8", x2: "16", y1: "21", y2: "21", key: "1svkeh" }],
  ["line", { x1: "12", x2: "12", y1: "17", y2: "21", key: "vw1qmm" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Pause = createLucideIcon("Pause", [
  ["rect", { x: "14", y: "4", width: "4", height: "16", rx: "1", key: "zuxfzm" }],
  ["rect", { x: "6", y: "4", width: "4", height: "16", rx: "1", key: "1okwgv" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Phone = createLucideIcon("Phone", [
  [
    "path",
    {
      d: "M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",
      key: "foiqr5"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Play = createLucideIcon("Play", [
  ["polygon", { points: "6 3 20 12 6 21 6 3", key: "1oa8hb" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Plus = createLucideIcon("Plus", [
  ["path", { d: "M5 12h14", key: "1ays0h" }],
  ["path", { d: "M12 5v14", key: "s699le" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Printer = createLucideIcon("Printer", [
  [
    "path",
    {
      d: "M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",
      key: "143wyd"
    }
  ],
  ["path", { d: "M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6", key: "1itne7" }],
  ["rect", { x: "6", y: "14", width: "12", height: "8", rx: "1", key: "1ue0tg" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const QrCode = createLucideIcon("QrCode", [
  ["rect", { width: "5", height: "5", x: "3", y: "3", rx: "1", key: "1tu5fj" }],
  ["rect", { width: "5", height: "5", x: "16", y: "3", rx: "1", key: "1v8r4q" }],
  ["rect", { width: "5", height: "5", x: "3", y: "16", rx: "1", key: "1x03jg" }],
  ["path", { d: "M21 16h-3a2 2 0 0 0-2 2v3", key: "177gqh" }],
  ["path", { d: "M21 21v.01", key: "ents32" }],
  ["path", { d: "M12 7v3a2 2 0 0 1-2 2H7", key: "8crl2c" }],
  ["path", { d: "M3 12h.01", key: "nlz23k" }],
  ["path", { d: "M12 3h.01", key: "n36tog" }],
  ["path", { d: "M12 16v.01", key: "133mhm" }],
  ["path", { d: "M16 12h1", key: "1slzba" }],
  ["path", { d: "M21 12v.01", key: "1lwtk9" }],
  ["path", { d: "M12 21v-1", key: "1880an" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Radar = createLucideIcon("Radar", [
  ["path", { d: "M19.07 4.93A10 10 0 0 0 6.99 3.34", key: "z3du51" }],
  ["path", { d: "M4 6h.01", key: "oypzma" }],
  ["path", { d: "M2.29 9.62A10 10 0 1 0 21.31 8.35", key: "qzzz0" }],
  ["path", { d: "M16.24 7.76A6 6 0 1 0 8.23 16.67", key: "1yjesh" }],
  ["path", { d: "M12 18h.01", key: "mhygvu" }],
  ["path", { d: "M17.99 11.66A6 6 0 0 1 15.77 16.67", key: "1u2y91" }],
  ["circle", { cx: "12", cy: "12", r: "2", key: "1c9p78" }],
  ["path", { d: "m13.41 10.59 5.66-5.66", key: "mhq4k0" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Radio$1 = createLucideIcon("Radio", [
  ["path", { d: "M4.9 19.1C1 15.2 1 8.8 4.9 4.9", key: "1vaf9d" }],
  ["path", { d: "M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5", key: "u1ii0m" }],
  ["circle", { cx: "12", cy: "12", r: "2", key: "1c9p78" }],
  ["path", { d: "M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5", key: "1j5fej" }],
  ["path", { d: "M19.1 4.9C23 8.8 23 15.1 19.1 19", key: "10b0cb" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const RefreshCw = createLucideIcon("RefreshCw", [
  ["path", { d: "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8", key: "v9h5vc" }],
  ["path", { d: "M21 3v5h-5", key: "1q7to0" }],
  ["path", { d: "M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16", key: "3uifl3" }],
  ["path", { d: "M8 16H3v5", key: "1cv678" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const RotateCcw = createLucideIcon("RotateCcw", [
  ["path", { d: "M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8", key: "1357e3" }],
  ["path", { d: "M3 3v5h5", key: "1xhq8a" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const RotateCw = createLucideIcon("RotateCw", [
  ["path", { d: "M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8", key: "1p45f6" }],
  ["path", { d: "M21 3v5h-5", key: "1q7to0" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Save = createLucideIcon("Save", [
  [
    "path",
    {
      d: "M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",
      key: "1c8476"
    }
  ],
  ["path", { d: "M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7", key: "1ydtos" }],
  ["path", { d: "M7 3v4a1 1 0 0 0 1 1h7", key: "t51u73" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Search = createLucideIcon("Search", [
  ["circle", { cx: "11", cy: "11", r: "8", key: "4ej97u" }],
  ["path", { d: "m21 21-4.3-4.3", key: "1qie3q" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Send = createLucideIcon("Send", [
  [
    "path",
    {
      d: "M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",
      key: "1ffxy3"
    }
  ],
  ["path", { d: "m21.854 2.147-10.94 10.939", key: "12cjpa" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Server = createLucideIcon("Server", [
  ["rect", { width: "20", height: "8", x: "2", y: "2", rx: "2", ry: "2", key: "ngkwjq" }],
  ["rect", { width: "20", height: "8", x: "2", y: "14", rx: "2", ry: "2", key: "iecqi9" }],
  ["line", { x1: "6", x2: "6.01", y1: "6", y2: "6", key: "16zg32" }],
  ["line", { x1: "6", x2: "6.01", y1: "18", y2: "18", key: "nzw8ys" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Settings = createLucideIcon("Settings", [
  [
    "path",
    {
      d: "M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",
      key: "1qme2f"
    }
  ],
  ["circle", { cx: "12", cy: "12", r: "3", key: "1v7zrd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Share2 = createLucideIcon("Share2", [
  ["circle", { cx: "18", cy: "5", r: "3", key: "gq8acd" }],
  ["circle", { cx: "6", cy: "12", r: "3", key: "w7nqdw" }],
  ["circle", { cx: "18", cy: "19", r: "3", key: "1xt0gg" }],
  ["line", { x1: "8.59", x2: "15.42", y1: "13.51", y2: "17.49", key: "47mynk" }],
  ["line", { x1: "15.41", x2: "8.59", y1: "6.51", y2: "10.49", key: "1n3mei" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Shield = createLucideIcon("Shield", [
  [
    "path",
    {
      d: "M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",
      key: "oel41y"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const ShoppingCart = createLucideIcon("ShoppingCart", [
  ["circle", { cx: "8", cy: "21", r: "1", key: "jimo8o" }],
  ["circle", { cx: "19", cy: "21", r: "1", key: "13723u" }],
  [
    "path",
    {
      d: "M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",
      key: "9zh506"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Shuffle = createLucideIcon("Shuffle", [
  ["path", { d: "m18 14 4 4-4 4", key: "10pe0f" }],
  ["path", { d: "m18 2 4 4-4 4", key: "pucp1d" }],
  ["path", { d: "M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22", key: "1ailkh" }],
  ["path", { d: "M2 6h1.972a4 4 0 0 1 3.6 2.2", key: "km57vx" }],
  ["path", { d: "M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45", key: "os18l9" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Smartphone = createLucideIcon("Smartphone", [
  ["rect", { width: "14", height: "20", x: "5", y: "2", rx: "2", ry: "2", key: "1yt0o3" }],
  ["path", { d: "M12 18h.01", key: "mhygvu" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Sparkles = createLucideIcon("Sparkles", [
  [
    "path",
    {
      d: "M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",
      key: "4pj2yx"
    }
  ],
  ["path", { d: "M20 3v4", key: "1olli1" }],
  ["path", { d: "M22 5h-4", key: "1gvqau" }],
  ["path", { d: "M4 17v2", key: "vumght" }],
  ["path", { d: "M5 18H3", key: "zchphs" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const SquarePen = createLucideIcon("SquarePen", [
  ["path", { d: "M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7", key: "1m0v6g" }],
  [
    "path",
    {
      d: "M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",
      key: "ohrbg2"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Star = createLucideIcon("Star", [
  [
    "path",
    {
      d: "M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",
      key: "r04s7s"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Stethoscope = createLucideIcon("Stethoscope", [
  ["path", { d: "M11 2v2", key: "1539x4" }],
  ["path", { d: "M5 2v2", key: "1yf1q8" }],
  ["path", { d: "M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1", key: "rb5t3r" }],
  ["path", { d: "M8 15a6 6 0 0 0 12 0v-3", key: "x18d4x" }],
  ["circle", { cx: "20", cy: "10", r: "2", key: "ts1r5v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Swords = createLucideIcon("Swords", [
  ["polyline", { points: "14.5 17.5 3 6 3 3 6 3 17.5 14.5", key: "1hfsw2" }],
  ["line", { x1: "13", x2: "19", y1: "19", y2: "13", key: "1vrmhu" }],
  ["line", { x1: "16", x2: "20", y1: "16", y2: "20", key: "1bron3" }],
  ["line", { x1: "19", x2: "21", y1: "21", y2: "19", key: "13pww6" }],
  ["polyline", { points: "14.5 6.5 18 3 21 3 21 6 17.5 9.5", key: "hbey2j" }],
  ["line", { x1: "5", x2: "9", y1: "14", y2: "18", key: "1hf58s" }],
  ["line", { x1: "7", x2: "4", y1: "17", y2: "20", key: "pidxm4" }],
  ["line", { x1: "3", x2: "5", y1: "19", y2: "21", key: "1pehsh" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Tag = createLucideIcon("Tag", [
  [
    "path",
    {
      d: "M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",
      key: "vktsd0"
    }
  ],
  ["circle", { cx: "7.5", cy: "7.5", r: ".5", fill: "currentColor", key: "kqv944" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Target = createLucideIcon("Target", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["circle", { cx: "12", cy: "12", r: "6", key: "1vlfrh" }],
  ["circle", { cx: "12", cy: "12", r: "2", key: "1c9p78" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const TestTube = createLucideIcon("TestTube", [
  ["path", { d: "M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2", key: "125lnx" }],
  ["path", { d: "M8.5 2h7", key: "csnxdl" }],
  ["path", { d: "M14.5 16h-5", key: "1ox875" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Trash2 = createLucideIcon("Trash2", [
  ["path", { d: "M3 6h18", key: "d0wm0j" }],
  ["path", { d: "M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6", key: "4alrt4" }],
  ["path", { d: "M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2", key: "v07s0e" }],
  ["line", { x1: "10", x2: "10", y1: "11", y2: "17", key: "1uufr5" }],
  ["line", { x1: "14", x2: "14", y1: "11", y2: "17", key: "xtxkd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const TrendingUp = createLucideIcon("TrendingUp", [
  ["polyline", { points: "22 7 13.5 15.5 8.5 10.5 2 17", key: "126l90" }],
  ["polyline", { points: "16 7 22 7 22 13", key: "kwv8wd" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const TriangleAlert = createLucideIcon("TriangleAlert", [
  [
    "path",
    {
      d: "m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",
      key: "wmoenq"
    }
  ],
  ["path", { d: "M12 9v4", key: "juzpu7" }],
  ["path", { d: "M12 17h.01", key: "p32p05" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Trophy = createLucideIcon("Trophy", [
  ["path", { d: "M6 9H4.5a2.5 2.5 0 0 1 0-5H6", key: "17hqa7" }],
  ["path", { d: "M18 9h1.5a2.5 2.5 0 0 0 0-5H18", key: "lmptdp" }],
  ["path", { d: "M4 22h16", key: "57wxv0" }],
  ["path", { d: "M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22", key: "1nw9bq" }],
  ["path", { d: "M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22", key: "1np0yb" }],
  ["path", { d: "M18 2H6v7a6 6 0 0 0 12 0V2Z", key: "u46fv3" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Upload = createLucideIcon("Upload", [
  ["path", { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4", key: "ih7n3h" }],
  ["polyline", { points: "17 8 12 3 7 8", key: "t8dd8p" }],
  ["line", { x1: "12", x2: "12", y1: "3", y2: "15", key: "widbto" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const UserCheck = createLucideIcon("UserCheck", [
  ["path", { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2", key: "1yyitq" }],
  ["circle", { cx: "9", cy: "7", r: "4", key: "nufk8" }],
  ["polyline", { points: "16 11 18 13 22 9", key: "1pwet4" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const UserPlus = createLucideIcon("UserPlus", [
  ["path", { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2", key: "1yyitq" }],
  ["circle", { cx: "9", cy: "7", r: "4", key: "nufk8" }],
  ["line", { x1: "19", x2: "19", y1: "8", y2: "14", key: "1bvyxn" }],
  ["line", { x1: "22", x2: "16", y1: "11", y2: "11", key: "1shjgl" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const User = createLucideIcon("User", [
  ["path", { d: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2", key: "975kel" }],
  ["circle", { cx: "12", cy: "7", r: "4", key: "17ys0d" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Users = createLucideIcon("Users", [
  ["path", { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2", key: "1yyitq" }],
  ["circle", { cx: "9", cy: "7", r: "4", key: "nufk8" }],
  ["path", { d: "M22 21v-2a4 4 0 0 0-3-3.87", key: "kshegd" }],
  ["path", { d: "M16 3.13a4 4 0 0 1 0 7.75", key: "1da9ce" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Volume2 = createLucideIcon("Volume2", [
  [
    "path",
    {
      d: "M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",
      key: "uqj9uw"
    }
  ],
  ["path", { d: "M16 9a5 5 0 0 1 0 6", key: "1q6k2b" }],
  ["path", { d: "M19.364 18.364a9 9 0 0 0 0-12.728", key: "ijwkga" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const WandSparkles = createLucideIcon("WandSparkles", [
  [
    "path",
    {
      d: "m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",
      key: "ul74o6"
    }
  ],
  ["path", { d: "m14 7 3 3", key: "1r5n42" }],
  ["path", { d: "M5 6v4", key: "ilb8ba" }],
  ["path", { d: "M19 14v4", key: "blhpug" }],
  ["path", { d: "M10 2v2", key: "7u0qdc" }],
  ["path", { d: "M7 8H3", key: "zfb6yr" }],
  ["path", { d: "M21 16h-4", key: "1cnmox" }],
  ["path", { d: "M11 3H9", key: "1obp7u" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const WifiOff = createLucideIcon("WifiOff", [
  ["path", { d: "M12 20h.01", key: "zekei9" }],
  ["path", { d: "M8.5 16.429a5 5 0 0 1 7 0", key: "1bycff" }],
  ["path", { d: "M5 12.859a10 10 0 0 1 5.17-2.69", key: "1dl1wf" }],
  ["path", { d: "M19 12.859a10 10 0 0 0-2.007-1.523", key: "4k23kn" }],
  ["path", { d: "M2 8.82a15 15 0 0 1 4.177-2.643", key: "1grhjp" }],
  ["path", { d: "M22 8.82a15 15 0 0 0-11.288-3.764", key: "z3jwby" }],
  ["path", { d: "m2 2 20 20", key: "1ooewy" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Wifi = createLucideIcon("Wifi", [
  ["path", { d: "M12 20h.01", key: "zekei9" }],
  ["path", { d: "M2 8.82a15 15 0 0 1 20 0", key: "dnpr2z" }],
  ["path", { d: "M5 12.859a10 10 0 0 1 14 0", key: "1x1e6c" }],
  ["path", { d: "M8.5 16.429a5 5 0 0 1 7 0", key: "1bycff" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Wrench = createLucideIcon("Wrench", [
  [
    "path",
    {
      d: "M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",
      key: "cbrjhi"
    }
  ]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const X$1 = createLucideIcon("X", [
  ["path", { d: "M18 6 6 18", key: "1bl5f8" }],
  ["path", { d: "m6 6 12 12", key: "d8bk6v" }]
]);

/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */


const Zap = createLucideIcon("Zap", [
  [
    "path",
    {
      d: "M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",
      key: "1xq2db"
    }
  ]
]);

const PushFrozenNotice = () => {
  {
    return null;
  }
};

const AuthContext = reactExports.createContext(void 0);

class AuthHealthCheckLogger {
  logs = [];
  maxLogs = 50;
  log(step, success, data, error) {
    const logEntry = {
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      step,
      success,
      data,
      error,
      userAgent: navigator.userAgent,
      isCapacitor: !!window.Capacitor,
      pathname: window.location.pathname
    };
    this.logs.unshift(logEntry);
    if (this.logs.length > this.maxLogs) {
      this.logs = this.logs.slice(0, this.maxLogs);
    }
    localStorage.setItem("authHealthLogs", JSON.stringify(this.logs));
    const emoji = success ? "✅" : "❌";
    console.log(`${emoji} AUTH HEALTH [${step}]:`, { success, data, error });
  }
  getLogs() {
    return this.logs;
  }
  getRecentFailures() {
    return this.logs.filter((log) => !log.success);
  }
  clearLogs() {
    this.logs = [];
    localStorage.removeItem("authHealthLogs");
    console.log("🧹 Auth health logs cleared");
  }
  exportReport() {
    const report = {
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      totalLogs: this.logs.length,
      failureCount: this.getRecentFailures().length,
      successRate: this.logs.length > 0 ? (this.logs.filter((l) => l.success).length / this.logs.length * 100).toFixed(2) + "%" : "N/A",
      logs: this.logs
    };
    return JSON.stringify(report, null, 2);
  }
  // Restore logs from localStorage on init
  restoreLogsFromStorage() {
    try {
      const storedLogs = localStorage.getItem("authHealthLogs");
      if (storedLogs) {
        this.logs = JSON.parse(storedLogs);
      }
    } catch (error) {
      console.warn("⚠️ Failed to restore auth health logs:", error);
    }
  }
  constructor() {
    this.restoreLogsFromStorage();
  }
}
const authHealthLogger = new AuthHealthCheckLogger();

const log$2 = (message, data) => {
};
const AuthProvider = ({ children }) => {
  const [user, setUser] = reactExports.useState(null);
  const [session, setSession] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [userRoles, setUserRoles] = reactExports.useState([]);
  const [isRoleLoading, setIsRoleLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    let isMounted = true;
    const abortController = new AbortController();
    const initializeAuth = async () => {
      try {
        log$2("Inizializzazione sistema unified auth");
        authHealthLogger.log("AuthProvider_Init", true, { timestamp: (/* @__PURE__ */ new Date()).toISOString() });
        if ("serviceWorker" in navigator && (window.location.hostname === "localhost" || window.location.protocol === "https:")) {
          try {
            const registrations = await navigator.serviceWorker.getRegistrations();
            for (let registration of registrations) {
              await registration.unregister();
            }
            log$2("🔄 PWA iOS: Service workers cleared");
            authHealthLogger.log("ServiceWorker_Cleared", true, { count: registrations.length });
          } catch (e) {
            log$2("PWA cache clear failed", e);
            authHealthLogger.log("ServiceWorker_Clear_Failed", false, {}, e.message);
          }
        }
        const clearAuthCacheIfNeeded = () => {
          const lastClear = localStorage.getItem("auth_cache_clear");
          const now = Date.now();
          const oneHour = 60 * 60 * 1e3;
          if (!lastClear || now - parseInt(lastClear) > oneHour) {
            log$2("🧹 PWA: Clearing stale auth cache");
            localStorage.removeItem(getAuthTokenKey());
            localStorage.setItem("auth_cache_clear", now.toString());
          }
        };
        clearAuthCacheIfNeeded();
        let session2 = null;
        let attempts = 0;
        const maxAttempts = 3;
        while (attempts < maxAttempts && !session2) {
          try {
            const { data: { session: currentSession }, error } = await supabase.auth.getSession();
            if (error) {
              log$2(`Errore getSession (tentativo ${attempts + 1})`, error);
              attempts++;
              if (attempts < maxAttempts) {
                await new Promise((resolve) => setTimeout(resolve, 1e3));
                continue;
              }
              if (isMounted) {
                setIsLoading(false);
              }
              return;
            }
            session2 = currentSession;
            break;
          } catch (error) {
            log$2(`Errore getSession exception (tentativo ${attempts + 1})`, error);
            attempts++;
            if (attempts < maxAttempts) {
              await new Promise((resolve) => setTimeout(resolve, 1e3));
            }
          }
        }
        if (session2 && isMounted) {
          log$2("Sessione trovata", session2.user.email);
          setSession(session2);
          setUser(session2.user);
        } else {
          log$2("Nessuna sessione attiva");
        }
      } catch (error) {
      } finally {
        if (isMounted) {
          setIsLoading(false);
        }
      }
    };
    initializeAuth();
    return () => {
      isMounted = false;
      abortController.abort();
    };
  }, []);
  reactExports.useEffect(() => {
    let timeoutId = null;
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      async (event, newSession) => {
        log$2(`Auth event: ${event}`, newSession?.user?.email || "NO USER");
        setSession((prevSession) => newSession);
        setUser((prevUser) => newSession?.user ?? null);
        if (event === "SIGNED_IN" && newSession) {
          log$2("Utente autenticato", newSession.user.email);
          if (newSession.user.email === "wikus77@hotmail.it") ;
          if (window.Capacitor || navigator.userAgent.includes("Safari")) {
            timeoutId = setTimeout(() => {
              if (!sessionStorage.getItem("auth_reload_done")) {
                sessionStorage.setItem("auth_reload_done", "true");
                window.location.reload();
              }
            }, 1e3);
          }
        } else if (event === "SIGNED_OUT") {
          setUserRoles([]);
          setIsRoleLoading(false);
          sessionStorage.removeItem("auth_reload_done");
        }
        setIsLoading(false);
      }
    );
    return () => {
      subscription.unsubscribe();
      if (timeoutId) {
        clearTimeout(timeoutId);
      }
    };
  }, []);
  reactExports.useEffect(() => {
    const abortController = new AbortController();
    const handleVisibilityChange = async () => {
      if (document.visibilityState === "visible" && !isLoading && !abortController.signal.aborted) {
        try {
          const { data: { session: currentSession } } = await supabase.auth.getSession();
          if (currentSession && (!session || session.expires_at !== currentSession.expires_at)) {
            log$2("Sessione aggiornata da visibility change");
            setSession(currentSession);
            setUser(currentSession.user);
          }
        } catch (error) {
          if (!abortController.signal.aborted) ;
        }
      }
    };
    if (window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true) {
      document.addEventListener("visibilitychange", handleVisibilityChange, { signal: abortController.signal });
      return () => {
        abortController.abort();
        document.removeEventListener("visibilitychange", handleVisibilityChange);
      };
    }
    return () => {
      abortController.abort();
    };
  }, [session, isLoading]);
  const fetchUserRoles = async (userId) => {
    if (!userId) return;
    setIsRoleLoading(true);
    try {
      const { data: rolesData } = await supabase.from("user_roles").select("role").eq("user_id", userId);
      if (rolesData && rolesData.length > 0) {
        const roles = rolesData.map((r) => r.role);
        log$2("Roles da user_roles", roles);
        setUserRoles(roles);
        return;
      }
      const { data: profileData } = await supabase.from("profiles").select("role").eq("id", userId).single();
      if (profileData?.role) {
        log$2("Role da profiles", [profileData.role]);
        setUserRoles([profileData.role]);
      } else {
        log$2("Nessun role trovato");
        setUserRoles([]);
      }
    } catch (error) {
      setUserRoles([]);
    } finally {
      setIsRoleLoading(false);
    }
  };
  reactExports.useEffect(() => {
    if (user?.id) {
      fetchUserRoles(user.id);
    } else {
      setUserRoles([]);
      setIsRoleLoading(false);
    }
  }, [user?.id]);
  const hasRole = (role) => {
    const result = userRoles.includes(role);
    log$2(`hasRole(${role}) = ${result}`, { userEmail: user?.email });
    return result;
  };
  const login = async (email, password) => {
    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
      });
      if (error) {
        log$2("Login error", error.message);
        return { success: false, error };
      }
      log$2("Login success", data.user?.email);
      return { success: true, session: data.session };
    } catch (error) {
      return { success: false, error };
    }
  };
  const register = async (email, password) => {
    try {
      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: `${window.location.origin}/`
        }
      });
      if (error) {
        log$2("Register error", error.message);
        return { success: false, error };
      }
      log$2("Register success", data.user?.email);
      return { success: true, data };
    } catch (error) {
      return { success: false, error };
    }
  };
  const resetPassword = async (email) => {
    try {
      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: `${window.location.origin}/auth/reset`
      });
      if (error) {
        log$2("Reset password error", error.message);
        return { success: false, error: error.message };
      }
      log$2("Reset password success");
      return { success: true };
    } catch (error) {
      return { success: false, error: error.message };
    }
  };
  const resendVerificationEmail = async (email) => {
    try {
      const { error } = await supabase.auth.resend({
        type: "signup",
        email,
        options: {
          emailRedirectTo: `${window.location.origin}/`
        }
      });
      if (error) {
        log$2("Resend verification error", error.message);
        return { success: false, error: error.message };
      }
      log$2("Resend verification success");
      return { success: true };
    } catch (error) {
      return { success: false, error: error.message };
    }
  };
  const logout = async () => {
    try {
      setIsLoading(true);
      await supabase.auth.signOut();
      setUser(null);
      setSession(null);
      setUserRoles([]);
      setIsRoleLoading(false);
      sessionStorage.removeItem("hasSeenPostLoginIntro");
      console.log("🧹 [AuthProvider] Cleared hasSeenPostLoginIntro on logout");
      setTimeout(() => {
        setIsLoading(false);
        if ("caches" in window) {
          caches.keys().then((cacheNames) => {
            cacheNames.forEach((cacheName) => {
              caches.delete(cacheName);
            });
          });
        }
        if (window.location.pathname !== "/login" && window.location.pathname !== "/") {
          log$2("Force redirect to login after logout");
          const redirectToLogin = () => {
            try {
              window.location.href = "/login";
            } catch (error) {
              log$2("Fallback redirect method", error);
              window.location.replace("/login");
            }
          };
          redirectToLogin();
        }
      }, 150);
      log$2("Logout completato");
    } catch (error) {
      setIsLoading(false);
    }
  };
  const authContextValue = {
    user,
    session,
    isAuthenticated: !!user,
    isLoading,
    isEmailVerified: user?.email_confirmed_at ? true : false,
    userRole: userRoles[0] || null,
    isRoleLoading,
    getCurrentUser: () => user,
    getAccessToken: () => session?.access_token || null,
    hasRole,
    login,
    register,
    logout,
    resetPassword,
    resendVerificationEmail
  };
  log$2("Context value", {
    isAuthenticated: authContextValue.isAuthenticated,
    isLoading: authContextValue.isLoading,
    userEmail: user?.email,
    rolesCount: userRoles.length});
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AuthContext.Provider, { value: authContextValue, children });
};

const SoundContext = reactExports.createContext(void 0);
const SoundProvider = ({ children }) => {
  const [soundPreference, setSoundPreference] = reactExports.useState("default");
  const [volume, setVolume] = reactExports.useState([75]);
  const [isEnabled, setIsEnabled] = reactExports.useState(true);
  reactExports.useEffect(() => {
    const savedSound = localStorage.getItem("buzzSound");
    if (savedSound) {
      setSoundPreference(savedSound);
    }
    const savedVolume = localStorage.getItem("buzzVolume");
    if (savedVolume) {
      setVolume([Number(savedVolume)]);
    }
    const savedEnabled = localStorage.getItem("soundEnabled");
    if (savedEnabled !== null) {
      setIsEnabled(savedEnabled === "true");
    }
  }, []);
  const updateSound = (sound) => {
    setSoundPreference(sound);
    localStorage.setItem("buzzSound", sound);
  };
  const updateVolume = (newVolume) => {
    setVolume(newVolume);
    localStorage.setItem("buzzVolume", newVolume[0].toString());
  };
  const toggleSound = (enabled) => {
    setIsEnabled(enabled);
    localStorage.setItem("soundEnabled", enabled.toString());
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(SoundContext.Provider, { value: {
    soundPreference,
    volume,
    isEnabled,
    updateSound,
    updateVolume,
    toggleSound
  }, children });
};
const useSound = () => {
  const context = reactExports.useContext(SoundContext);
  if (context === void 0) {
    throw new Error("useSound must be used within a SoundProvider");
  }
  return context;
};

const PUSH_PREFLIGHT_ENABLED = false;
const NEW_PUSH_SUBSCRIBE_FLOW = true;
const DETAILED_ERRORS = false;

const generateErrorId = () => `ERR-${Date.now().toString(36).toUpperCase()}`;
let ErrorBoundary$1 = class ErrorBoundary extends React$1.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasError: false,
      errorMessage: "",
      errorStack: void 0,
      errorId: ""
    };
  }
  static getDerivedStateFromError(error) {
    return {
      hasError: true,
      errorMessage: error.message || "Si è verificato un errore inaspettato",
      errorStack: error.stack,
      errorId: generateErrorId()
    };
  }
  componentDidCatch(error, errorInfo) {
    const errorReport = {
      id: this.state.errorId,
      message: error.message,
      stack: error.stack,
      componentStack: errorInfo.componentStack,
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      url: window.location.href,
      userAgent: navigator.userAgent
    };
    {
      console.error(`🔴 [ErrorBoundary] Error ${this.state.errorId}:`, error.message);
    }
    this.props.onError?.(error, errorInfo);
    try {
      const errors = JSON.parse(localStorage.getItem("m1_error_log") || "[]");
      errors.push(errorReport);
      localStorage.setItem("m1_error_log", JSON.stringify(errors.slice(-10)));
    } catch {
    }
  }
  handleRefresh = () => {
    window.location.reload();
  };
  handleReset = () => {
    this.setState({
      hasError: false,
      errorMessage: "",
      errorStack: void 0,
      errorId: ""
    });
  };
  handleGoHome = () => {
    window.location.href = "/";
  };
  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: {
        padding: "20px",
        color: "white",
        backgroundColor: "#070818",
        minHeight: "100vh",
        display: "flex",
        flexDirection: "column",
        alignItems: "center",
        justifyContent: "center",
        fontFamily: "system-ui, -apple-system, sans-serif"
      }, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: {
        maxWidth: "500px",
        textAlign: "center",
        padding: "40px",
        background: "rgba(255,255,255,0.05)",
        borderRadius: "16px",
        border: "1px solid rgba(255,255,255,0.1)"
      }, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontSize: "64px", marginBottom: "20px" }, children: "⚠️" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { style: {
          fontSize: "24px",
          fontWeight: "bold",
          marginBottom: "12px",
          color: "#fff"
        }, children: "Oops! Qualcosa è andato storto" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { style: {
          color: "rgba(255,255,255,0.7)",
          marginBottom: "24px",
          lineHeight: "1.5"
        }, children: "L'applicazione ha riscontrato un problema. Puoi provare a ricaricare la pagina o tornare alla home." }),
        DETAILED_ERRORS,
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { style: {
          fontSize: "11px",
          color: "rgba(255,255,255,0.4)",
          marginBottom: "20px"
        }, children: [
          "Codice errore: ",
          this.state.errorId
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { display: "flex", gap: "12px", justifyContent: "center", flexWrap: "wrap" }, children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: this.handleRefresh,
              style: {
                padding: "12px 24px",
                background: "linear-gradient(135deg, #00E5FF, #7C3AED)",
                color: "white",
                border: "none",
                borderRadius: "8px",
                cursor: "pointer",
                fontWeight: "bold",
                fontSize: "14px",
                transition: "transform 0.2s"
              },
              onMouseOver: (e) => e.currentTarget.style.transform = "scale(1.05)",
              onMouseOut: (e) => e.currentTarget.style.transform = "scale(1)",
              children: "🔄 Ricarica Pagina"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: this.handleGoHome,
              style: {
                padding: "12px 24px",
                background: "rgba(255,255,255,0.1)",
                color: "white",
                border: "1px solid rgba(255,255,255,0.2)",
                borderRadius: "8px",
                cursor: "pointer",
                fontWeight: "bold",
                fontSize: "14px",
                transition: "transform 0.2s"
              },
              onMouseOver: (e) => e.currentTarget.style.transform = "scale(1.05)",
              onMouseOut: (e) => e.currentTarget.style.transform = "scale(1)",
              children: "🏠 Vai alla Home"
            }
          )
        ] })
      ] }) });
    }
    return this.props.children;
  }
};

const useAuthContext = () => {
  const context = reactExports.useContext(AuthContext);
  if (context === void 0) {
    throw new Error("useAuthContext deve essere usato all'interno di un AuthProvider");
  }
  return context;
};

const useXpSystem = () => {
  const { user } = useAuthContext();
  const [xpStatus, setXpStatus] = reactExports.useState({
    total_xp: 0,
    buzz_xp_progress: 0,
    map_xp_progress: 0,
    free_buzz_credit: 0,
    free_buzz_map_credit: 0,
    next_buzz_reward: 100,
    next_map_reward: 250
  });
  const [loading, setLoading] = reactExports.useState(true);
  const [hasNewRewards, setHasNewRewards] = reactExports.useState(false);
  const [newBadge, setNewBadge] = reactExports.useState(null);
  const fetchXpStatus = async () => {
    if (!user?.id) return;
    try {
      const { data, error } = await supabase.rpc("get_user_xp_status", {
        p_user_id: user.id
      });
      if (error) {
        console.error("Error fetching XP status:", error);
        return;
      }
      if (data) {
        const newStatus = data;
        const hadNewBuzzCredit = newStatus.free_buzz_credit > xpStatus.free_buzz_credit;
        const hadNewMapCredit = newStatus.free_buzz_map_credit > xpStatus.free_buzz_map_credit;
        if (hadNewBuzzCredit || hadNewMapCredit) {
          setHasNewRewards(true);
        }
        if (hadNewBuzzCredit) {
          setNewBadge({
            name: "BUZZ Gratuito Sbloccato!",
            description: `Hai guadagnato un BUZZ gratuito! (${newStatus.free_buzz_credit} disponibili)`
          });
        } else if (hadNewMapCredit) {
          setNewBadge({
            name: "BUZZ MAP Gratuito Sbloccato!",
            description: `Hai guadagnato un BUZZ MAP gratuito! (${newStatus.free_buzz_map_credit} disponibili)`
          });
        }
        setXpStatus(newStatus);
      }
    } catch (error) {
      console.error("Exception fetching XP status:", error);
    } finally {
      setLoading(false);
    }
  };
  const consumeCredit = async (creditType) => {
    if (!user?.id) return false;
    try {
      const { data, error } = await supabase.rpc("consume_credit", {
        p_user_id: user.id,
        p_credit_type: creditType
      });
      if (error) {
        console.error("Error consuming credit:", error);
        return false;
      }
      if (data) {
        await fetchXpStatus();
        return true;
      }
      return false;
    } catch (error) {
      console.error("Exception consuming credit:", error);
      return false;
    }
  };
  const markRewardsAsSeen = () => {
    setHasNewRewards(false);
  };
  reactExports.useEffect(() => {
    if (!user?.id) return;
    fetchXpStatus();
    const xpChannel = supabase.channel("user_xp_changes").on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "user_xp",
        filter: `user_id=eq.${user.id}`
      },
      () => {
        fetchXpStatus();
      }
    ).subscribe();
    const creditsChannel = supabase.channel("user_credits_changes").on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "user_credits",
        filter: `user_id=eq.${user.id}`
      },
      () => {
        fetchXpStatus();
      }
    ).subscribe();
    return () => {
      supabase.removeChannel(xpChannel);
      supabase.removeChannel(creditsChannel);
    };
  }, [user?.id]);
  const closeBadgeNotification = () => {
    setNewBadge(null);
  };
  return {
    xpStatus,
    loading,
    hasNewRewards,
    newBadge,
    consumeCredit,
    markRewardsAsSeen,
    closeBadgeNotification,
    refreshXpStatus: fetchXpStatus
  };
};

function r(e){var t,f,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=" "),n+=f);}else for(f in e)e[f]&&(n&&(n+=" "),n+=f);return n}function clsx(){for(var e,t,f=0,n="",o=arguments.length;f<o;f++)(e=arguments[f])&&(t=r(e))&&(n&&(n+=" "),n+=t);return n}

const CLASS_PART_SEPARATOR = '-';
const createClassGroupUtils = config => {
  const classMap = createClassMap(config);
  const {
    conflictingClassGroups,
    conflictingClassGroupModifiers
  } = config;
  const getClassGroupId = className => {
    const classParts = className.split(CLASS_PART_SEPARATOR);
    // Classes like `-inset-1` produce an empty string as first classPart. We assume that classes for negative values are used correctly and remove it from classParts.
    if (classParts[0] === '' && classParts.length !== 1) {
      classParts.shift();
    }
    return getGroupRecursive(classParts, classMap) || getGroupIdForArbitraryProperty(className);
  };
  const getConflictingClassGroupIds = (classGroupId, hasPostfixModifier) => {
    const conflicts = conflictingClassGroups[classGroupId] || [];
    if (hasPostfixModifier && conflictingClassGroupModifiers[classGroupId]) {
      return [...conflicts, ...conflictingClassGroupModifiers[classGroupId]];
    }
    return conflicts;
  };
  return {
    getClassGroupId,
    getConflictingClassGroupIds
  };
};
const getGroupRecursive = (classParts, classPartObject) => {
  if (classParts.length === 0) {
    return classPartObject.classGroupId;
  }
  const currentClassPart = classParts[0];
  const nextClassPartObject = classPartObject.nextPart.get(currentClassPart);
  const classGroupFromNextClassPart = nextClassPartObject ? getGroupRecursive(classParts.slice(1), nextClassPartObject) : undefined;
  if (classGroupFromNextClassPart) {
    return classGroupFromNextClassPart;
  }
  if (classPartObject.validators.length === 0) {
    return undefined;
  }
  const classRest = classParts.join(CLASS_PART_SEPARATOR);
  return classPartObject.validators.find(({
    validator
  }) => validator(classRest))?.classGroupId;
};
const arbitraryPropertyRegex = /^\[(.+)\]$/;
const getGroupIdForArbitraryProperty = className => {
  if (arbitraryPropertyRegex.test(className)) {
    const arbitraryPropertyClassName = arbitraryPropertyRegex.exec(className)[1];
    const property = arbitraryPropertyClassName?.substring(0, arbitraryPropertyClassName.indexOf(':'));
    if (property) {
      // I use two dots here because one dot is used as prefix for class groups in plugins
      return 'arbitrary..' + property;
    }
  }
};
/**
 * Exported for testing only
 */
const createClassMap = config => {
  const {
    theme,
    prefix
  } = config;
  const classMap = {
    nextPart: new Map(),
    validators: []
  };
  const prefixedClassGroupEntries = getPrefixedClassGroupEntries(Object.entries(config.classGroups), prefix);
  prefixedClassGroupEntries.forEach(([classGroupId, classGroup]) => {
    processClassesRecursively(classGroup, classMap, classGroupId, theme);
  });
  return classMap;
};
const processClassesRecursively = (classGroup, classPartObject, classGroupId, theme) => {
  classGroup.forEach(classDefinition => {
    if (typeof classDefinition === 'string') {
      const classPartObjectToEdit = classDefinition === '' ? classPartObject : getPart(classPartObject, classDefinition);
      classPartObjectToEdit.classGroupId = classGroupId;
      return;
    }
    if (typeof classDefinition === 'function') {
      if (isThemeGetter(classDefinition)) {
        processClassesRecursively(classDefinition(theme), classPartObject, classGroupId, theme);
        return;
      }
      classPartObject.validators.push({
        validator: classDefinition,
        classGroupId
      });
      return;
    }
    Object.entries(classDefinition).forEach(([key, classGroup]) => {
      processClassesRecursively(classGroup, getPart(classPartObject, key), classGroupId, theme);
    });
  });
};
const getPart = (classPartObject, path) => {
  let currentClassPartObject = classPartObject;
  path.split(CLASS_PART_SEPARATOR).forEach(pathPart => {
    if (!currentClassPartObject.nextPart.has(pathPart)) {
      currentClassPartObject.nextPart.set(pathPart, {
        nextPart: new Map(),
        validators: []
      });
    }
    currentClassPartObject = currentClassPartObject.nextPart.get(pathPart);
  });
  return currentClassPartObject;
};
const isThemeGetter = func => func.isThemeGetter;
const getPrefixedClassGroupEntries = (classGroupEntries, prefix) => {
  if (!prefix) {
    return classGroupEntries;
  }
  return classGroupEntries.map(([classGroupId, classGroup]) => {
    const prefixedClassGroup = classGroup.map(classDefinition => {
      if (typeof classDefinition === 'string') {
        return prefix + classDefinition;
      }
      if (typeof classDefinition === 'object') {
        return Object.fromEntries(Object.entries(classDefinition).map(([key, value]) => [prefix + key, value]));
      }
      return classDefinition;
    });
    return [classGroupId, prefixedClassGroup];
  });
};

// LRU cache inspired from hashlru (https://github.com/dominictarr/hashlru/blob/v1.0.4/index.js) but object replaced with Map to improve performance
const createLruCache = maxCacheSize => {
  if (maxCacheSize < 1) {
    return {
      get: () => undefined,
      set: () => {}
    };
  }
  let cacheSize = 0;
  let cache = new Map();
  let previousCache = new Map();
  const update = (key, value) => {
    cache.set(key, value);
    cacheSize++;
    if (cacheSize > maxCacheSize) {
      cacheSize = 0;
      previousCache = cache;
      cache = new Map();
    }
  };
  return {
    get(key) {
      let value = cache.get(key);
      if (value !== undefined) {
        return value;
      }
      if ((value = previousCache.get(key)) !== undefined) {
        update(key, value);
        return value;
      }
    },
    set(key, value) {
      if (cache.has(key)) {
        cache.set(key, value);
      } else {
        update(key, value);
      }
    }
  };
};
const IMPORTANT_MODIFIER = '!';
const createParseClassName = config => {
  const {
    separator,
    experimentalParseClassName
  } = config;
  const isSeparatorSingleCharacter = separator.length === 1;
  const firstSeparatorCharacter = separator[0];
  const separatorLength = separator.length;
  // parseClassName inspired by https://github.com/tailwindlabs/tailwindcss/blob/v3.2.2/src/util/splitAtTopLevelOnly.js
  const parseClassName = className => {
    const modifiers = [];
    let bracketDepth = 0;
    let modifierStart = 0;
    let postfixModifierPosition;
    for (let index = 0; index < className.length; index++) {
      let currentCharacter = className[index];
      if (bracketDepth === 0) {
        if (currentCharacter === firstSeparatorCharacter && (isSeparatorSingleCharacter || className.slice(index, index + separatorLength) === separator)) {
          modifiers.push(className.slice(modifierStart, index));
          modifierStart = index + separatorLength;
          continue;
        }
        if (currentCharacter === '/') {
          postfixModifierPosition = index;
          continue;
        }
      }
      if (currentCharacter === '[') {
        bracketDepth++;
      } else if (currentCharacter === ']') {
        bracketDepth--;
      }
    }
    const baseClassNameWithImportantModifier = modifiers.length === 0 ? className : className.substring(modifierStart);
    const hasImportantModifier = baseClassNameWithImportantModifier.startsWith(IMPORTANT_MODIFIER);
    const baseClassName = hasImportantModifier ? baseClassNameWithImportantModifier.substring(1) : baseClassNameWithImportantModifier;
    const maybePostfixModifierPosition = postfixModifierPosition && postfixModifierPosition > modifierStart ? postfixModifierPosition - modifierStart : undefined;
    return {
      modifiers,
      hasImportantModifier,
      baseClassName,
      maybePostfixModifierPosition
    };
  };
  if (experimentalParseClassName) {
    return className => experimentalParseClassName({
      className,
      parseClassName
    });
  }
  return parseClassName;
};
/**
 * Sorts modifiers according to following schema:
 * - Predefined modifiers are sorted alphabetically
 * - When an arbitrary variant appears, it must be preserved which modifiers are before and after it
 */
const sortModifiers = modifiers => {
  if (modifiers.length <= 1) {
    return modifiers;
  }
  const sortedModifiers = [];
  let unsortedModifiers = [];
  modifiers.forEach(modifier => {
    const isArbitraryVariant = modifier[0] === '[';
    if (isArbitraryVariant) {
      sortedModifiers.push(...unsortedModifiers.sort(), modifier);
      unsortedModifiers = [];
    } else {
      unsortedModifiers.push(modifier);
    }
  });
  sortedModifiers.push(...unsortedModifiers.sort());
  return sortedModifiers;
};
const createConfigUtils = config => ({
  cache: createLruCache(config.cacheSize),
  parseClassName: createParseClassName(config),
  ...createClassGroupUtils(config)
});
const SPLIT_CLASSES_REGEX = /\s+/;
const mergeClassList = (classList, configUtils) => {
  const {
    parseClassName,
    getClassGroupId,
    getConflictingClassGroupIds
  } = configUtils;
  /**
   * Set of classGroupIds in following format:
   * `{importantModifier}{variantModifiers}{classGroupId}`
   * @example 'float'
   * @example 'hover:focus:bg-color'
   * @example 'md:!pr'
   */
  const classGroupsInConflict = [];
  const classNames = classList.trim().split(SPLIT_CLASSES_REGEX);
  let result = '';
  for (let index = classNames.length - 1; index >= 0; index -= 1) {
    const originalClassName = classNames[index];
    const {
      modifiers,
      hasImportantModifier,
      baseClassName,
      maybePostfixModifierPosition
    } = parseClassName(originalClassName);
    let hasPostfixModifier = Boolean(maybePostfixModifierPosition);
    let classGroupId = getClassGroupId(hasPostfixModifier ? baseClassName.substring(0, maybePostfixModifierPosition) : baseClassName);
    if (!classGroupId) {
      if (!hasPostfixModifier) {
        // Not a Tailwind class
        result = originalClassName + (result.length > 0 ? ' ' + result : result);
        continue;
      }
      classGroupId = getClassGroupId(baseClassName);
      if (!classGroupId) {
        // Not a Tailwind class
        result = originalClassName + (result.length > 0 ? ' ' + result : result);
        continue;
      }
      hasPostfixModifier = false;
    }
    const variantModifier = sortModifiers(modifiers).join(':');
    const modifierId = hasImportantModifier ? variantModifier + IMPORTANT_MODIFIER : variantModifier;
    const classId = modifierId + classGroupId;
    if (classGroupsInConflict.includes(classId)) {
      // Tailwind class omitted due to conflict
      continue;
    }
    classGroupsInConflict.push(classId);
    const conflictGroups = getConflictingClassGroupIds(classGroupId, hasPostfixModifier);
    for (let i = 0; i < conflictGroups.length; ++i) {
      const group = conflictGroups[i];
      classGroupsInConflict.push(modifierId + group);
    }
    // Tailwind class not in conflict
    result = originalClassName + (result.length > 0 ? ' ' + result : result);
  }
  return result;
};

/**
 * The code in this file is copied from https://github.com/lukeed/clsx and modified to suit the needs of tailwind-merge better.
 *
 * Specifically:
 * - Runtime code from https://github.com/lukeed/clsx/blob/v1.2.1/src/index.js
 * - TypeScript types from https://github.com/lukeed/clsx/blob/v1.2.1/clsx.d.ts
 *
 * Original code has MIT license: Copyright (c) Luke Edwards <luke.edwards05@gmail.com> (lukeed.com)
 */
function twJoin() {
  let index = 0;
  let argument;
  let resolvedValue;
  let string = '';
  while (index < arguments.length) {
    if (argument = arguments[index++]) {
      if (resolvedValue = toValue(argument)) {
        string && (string += ' ');
        string += resolvedValue;
      }
    }
  }
  return string;
}
const toValue = mix => {
  if (typeof mix === 'string') {
    return mix;
  }
  let resolvedValue;
  let string = '';
  for (let k = 0; k < mix.length; k++) {
    if (mix[k]) {
      if (resolvedValue = toValue(mix[k])) {
        string && (string += ' ');
        string += resolvedValue;
      }
    }
  }
  return string;
};
function createTailwindMerge(createConfigFirst, ...createConfigRest) {
  let configUtils;
  let cacheGet;
  let cacheSet;
  let functionToCall = initTailwindMerge;
  function initTailwindMerge(classList) {
    const config = createConfigRest.reduce((previousConfig, createConfigCurrent) => createConfigCurrent(previousConfig), createConfigFirst());
    configUtils = createConfigUtils(config);
    cacheGet = configUtils.cache.get;
    cacheSet = configUtils.cache.set;
    functionToCall = tailwindMerge;
    return tailwindMerge(classList);
  }
  function tailwindMerge(classList) {
    const cachedResult = cacheGet(classList);
    if (cachedResult) {
      return cachedResult;
    }
    const result = mergeClassList(classList, configUtils);
    cacheSet(classList, result);
    return result;
  }
  return function callTailwindMerge() {
    return functionToCall(twJoin.apply(null, arguments));
  };
}
const fromTheme = key => {
  const themeGetter = theme => theme[key] || [];
  themeGetter.isThemeGetter = true;
  return themeGetter;
};
const arbitraryValueRegex = /^\[(?:([a-z-]+):)?(.+)\]$/i;
const fractionRegex = /^\d+\/\d+$/;
const stringLengths = /*#__PURE__*/new Set(['px', 'full', 'screen']);
const tshirtUnitRegex = /^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/;
const lengthUnitRegex = /\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/;
const colorFunctionRegex = /^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/;
// Shadow always begins with x and y offset separated by underscore optionally prepended by inset
const shadowRegex = /^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;
const imageRegex = /^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/;
const isLength = value => isNumber$1(value) || stringLengths.has(value) || fractionRegex.test(value);
const isArbitraryLength = value => getIsArbitraryValue(value, 'length', isLengthOnly);
const isNumber$1 = value => Boolean(value) && !Number.isNaN(Number(value));
const isArbitraryNumber = value => getIsArbitraryValue(value, 'number', isNumber$1);
const isInteger = value => Boolean(value) && Number.isInteger(Number(value));
const isPercent = value => value.endsWith('%') && isNumber$1(value.slice(0, -1));
const isArbitraryValue = value => arbitraryValueRegex.test(value);
const isTshirtSize = value => tshirtUnitRegex.test(value);
const sizeLabels = /*#__PURE__*/new Set(['length', 'size', 'percentage']);
const isArbitrarySize = value => getIsArbitraryValue(value, sizeLabels, isNever);
const isArbitraryPosition = value => getIsArbitraryValue(value, 'position', isNever);
const imageLabels = /*#__PURE__*/new Set(['image', 'url']);
const isArbitraryImage = value => getIsArbitraryValue(value, imageLabels, isImage);
const isArbitraryShadow = value => getIsArbitraryValue(value, '', isShadow);
const isAny = () => true;
const getIsArbitraryValue = (value, label, testValue) => {
  const result = arbitraryValueRegex.exec(value);
  if (result) {
    if (result[1]) {
      return typeof label === 'string' ? result[1] === label : label.has(result[1]);
    }
    return testValue(result[2]);
  }
  return false;
};
const isLengthOnly = value =>
// `colorFunctionRegex` check is necessary because color functions can have percentages in them which which would be incorrectly classified as lengths.
// For example, `hsl(0 0% 0%)` would be classified as a length without this check.
// I could also use lookbehind assertion in `lengthUnitRegex` but that isn't supported widely enough.
lengthUnitRegex.test(value) && !colorFunctionRegex.test(value);
const isNever = () => false;
const isShadow = value => shadowRegex.test(value);
const isImage = value => imageRegex.test(value);
const getDefaultConfig = () => {
  const colors = fromTheme('colors');
  const spacing = fromTheme('spacing');
  const blur = fromTheme('blur');
  const brightness = fromTheme('brightness');
  const borderColor = fromTheme('borderColor');
  const borderRadius = fromTheme('borderRadius');
  const borderSpacing = fromTheme('borderSpacing');
  const borderWidth = fromTheme('borderWidth');
  const contrast = fromTheme('contrast');
  const grayscale = fromTheme('grayscale');
  const hueRotate = fromTheme('hueRotate');
  const invert = fromTheme('invert');
  const gap = fromTheme('gap');
  const gradientColorStops = fromTheme('gradientColorStops');
  const gradientColorStopPositions = fromTheme('gradientColorStopPositions');
  const inset = fromTheme('inset');
  const margin = fromTheme('margin');
  const opacity = fromTheme('opacity');
  const padding = fromTheme('padding');
  const saturate = fromTheme('saturate');
  const scale = fromTheme('scale');
  const sepia = fromTheme('sepia');
  const skew = fromTheme('skew');
  const space = fromTheme('space');
  const translate = fromTheme('translate');
  const getOverscroll = () => ['auto', 'contain', 'none'];
  const getOverflow = () => ['auto', 'hidden', 'clip', 'visible', 'scroll'];
  const getSpacingWithAutoAndArbitrary = () => ['auto', isArbitraryValue, spacing];
  const getSpacingWithArbitrary = () => [isArbitraryValue, spacing];
  const getLengthWithEmptyAndArbitrary = () => ['', isLength, isArbitraryLength];
  const getNumberWithAutoAndArbitrary = () => ['auto', isNumber$1, isArbitraryValue];
  const getPositions = () => ['bottom', 'center', 'left', 'left-bottom', 'left-top', 'right', 'right-bottom', 'right-top', 'top'];
  const getLineStyles = () => ['solid', 'dashed', 'dotted', 'double', 'none'];
  const getBlendModes = () => ['normal', 'multiply', 'screen', 'overlay', 'darken', 'lighten', 'color-dodge', 'color-burn', 'hard-light', 'soft-light', 'difference', 'exclusion', 'hue', 'saturation', 'color', 'luminosity'];
  const getAlign = () => ['start', 'end', 'center', 'between', 'around', 'evenly', 'stretch'];
  const getZeroAndEmpty = () => ['', '0', isArbitraryValue];
  const getBreaks = () => ['auto', 'avoid', 'all', 'avoid-page', 'page', 'left', 'right', 'column'];
  const getNumberAndArbitrary = () => [isNumber$1, isArbitraryValue];
  return {
    cacheSize: 500,
    separator: ':',
    theme: {
      colors: [isAny],
      spacing: [isLength, isArbitraryLength],
      blur: ['none', '', isTshirtSize, isArbitraryValue],
      brightness: getNumberAndArbitrary(),
      borderColor: [colors],
      borderRadius: ['none', '', 'full', isTshirtSize, isArbitraryValue],
      borderSpacing: getSpacingWithArbitrary(),
      borderWidth: getLengthWithEmptyAndArbitrary(),
      contrast: getNumberAndArbitrary(),
      grayscale: getZeroAndEmpty(),
      hueRotate: getNumberAndArbitrary(),
      invert: getZeroAndEmpty(),
      gap: getSpacingWithArbitrary(),
      gradientColorStops: [colors],
      gradientColorStopPositions: [isPercent, isArbitraryLength],
      inset: getSpacingWithAutoAndArbitrary(),
      margin: getSpacingWithAutoAndArbitrary(),
      opacity: getNumberAndArbitrary(),
      padding: getSpacingWithArbitrary(),
      saturate: getNumberAndArbitrary(),
      scale: getNumberAndArbitrary(),
      sepia: getZeroAndEmpty(),
      skew: getNumberAndArbitrary(),
      space: getSpacingWithArbitrary(),
      translate: getSpacingWithArbitrary()
    },
    classGroups: {
      // Layout
      /**
       * Aspect Ratio
       * @see https://tailwindcss.com/docs/aspect-ratio
       */
      aspect: [{
        aspect: ['auto', 'square', 'video', isArbitraryValue]
      }],
      /**
       * Container
       * @see https://tailwindcss.com/docs/container
       */
      container: ['container'],
      /**
       * Columns
       * @see https://tailwindcss.com/docs/columns
       */
      columns: [{
        columns: [isTshirtSize]
      }],
      /**
       * Break After
       * @see https://tailwindcss.com/docs/break-after
       */
      'break-after': [{
        'break-after': getBreaks()
      }],
      /**
       * Break Before
       * @see https://tailwindcss.com/docs/break-before
       */
      'break-before': [{
        'break-before': getBreaks()
      }],
      /**
       * Break Inside
       * @see https://tailwindcss.com/docs/break-inside
       */
      'break-inside': [{
        'break-inside': ['auto', 'avoid', 'avoid-page', 'avoid-column']
      }],
      /**
       * Box Decoration Break
       * @see https://tailwindcss.com/docs/box-decoration-break
       */
      'box-decoration': [{
        'box-decoration': ['slice', 'clone']
      }],
      /**
       * Box Sizing
       * @see https://tailwindcss.com/docs/box-sizing
       */
      box: [{
        box: ['border', 'content']
      }],
      /**
       * Display
       * @see https://tailwindcss.com/docs/display
       */
      display: ['block', 'inline-block', 'inline', 'flex', 'inline-flex', 'table', 'inline-table', 'table-caption', 'table-cell', 'table-column', 'table-column-group', 'table-footer-group', 'table-header-group', 'table-row-group', 'table-row', 'flow-root', 'grid', 'inline-grid', 'contents', 'list-item', 'hidden'],
      /**
       * Floats
       * @see https://tailwindcss.com/docs/float
       */
      float: [{
        float: ['right', 'left', 'none', 'start', 'end']
      }],
      /**
       * Clear
       * @see https://tailwindcss.com/docs/clear
       */
      clear: [{
        clear: ['left', 'right', 'both', 'none', 'start', 'end']
      }],
      /**
       * Isolation
       * @see https://tailwindcss.com/docs/isolation
       */
      isolation: ['isolate', 'isolation-auto'],
      /**
       * Object Fit
       * @see https://tailwindcss.com/docs/object-fit
       */
      'object-fit': [{
        object: ['contain', 'cover', 'fill', 'none', 'scale-down']
      }],
      /**
       * Object Position
       * @see https://tailwindcss.com/docs/object-position
       */
      'object-position': [{
        object: [...getPositions(), isArbitraryValue]
      }],
      /**
       * Overflow
       * @see https://tailwindcss.com/docs/overflow
       */
      overflow: [{
        overflow: getOverflow()
      }],
      /**
       * Overflow X
       * @see https://tailwindcss.com/docs/overflow
       */
      'overflow-x': [{
        'overflow-x': getOverflow()
      }],
      /**
       * Overflow Y
       * @see https://tailwindcss.com/docs/overflow
       */
      'overflow-y': [{
        'overflow-y': getOverflow()
      }],
      /**
       * Overscroll Behavior
       * @see https://tailwindcss.com/docs/overscroll-behavior
       */
      overscroll: [{
        overscroll: getOverscroll()
      }],
      /**
       * Overscroll Behavior X
       * @see https://tailwindcss.com/docs/overscroll-behavior
       */
      'overscroll-x': [{
        'overscroll-x': getOverscroll()
      }],
      /**
       * Overscroll Behavior Y
       * @see https://tailwindcss.com/docs/overscroll-behavior
       */
      'overscroll-y': [{
        'overscroll-y': getOverscroll()
      }],
      /**
       * Position
       * @see https://tailwindcss.com/docs/position
       */
      position: ['static', 'fixed', 'absolute', 'relative', 'sticky'],
      /**
       * Top / Right / Bottom / Left
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      inset: [{
        inset: [inset]
      }],
      /**
       * Right / Left
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      'inset-x': [{
        'inset-x': [inset]
      }],
      /**
       * Top / Bottom
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      'inset-y': [{
        'inset-y': [inset]
      }],
      /**
       * Start
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      start: [{
        start: [inset]
      }],
      /**
       * End
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      end: [{
        end: [inset]
      }],
      /**
       * Top
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      top: [{
        top: [inset]
      }],
      /**
       * Right
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      right: [{
        right: [inset]
      }],
      /**
       * Bottom
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      bottom: [{
        bottom: [inset]
      }],
      /**
       * Left
       * @see https://tailwindcss.com/docs/top-right-bottom-left
       */
      left: [{
        left: [inset]
      }],
      /**
       * Visibility
       * @see https://tailwindcss.com/docs/visibility
       */
      visibility: ['visible', 'invisible', 'collapse'],
      /**
       * Z-Index
       * @see https://tailwindcss.com/docs/z-index
       */
      z: [{
        z: ['auto', isInteger, isArbitraryValue]
      }],
      // Flexbox and Grid
      /**
       * Flex Basis
       * @see https://tailwindcss.com/docs/flex-basis
       */
      basis: [{
        basis: getSpacingWithAutoAndArbitrary()
      }],
      /**
       * Flex Direction
       * @see https://tailwindcss.com/docs/flex-direction
       */
      'flex-direction': [{
        flex: ['row', 'row-reverse', 'col', 'col-reverse']
      }],
      /**
       * Flex Wrap
       * @see https://tailwindcss.com/docs/flex-wrap
       */
      'flex-wrap': [{
        flex: ['wrap', 'wrap-reverse', 'nowrap']
      }],
      /**
       * Flex
       * @see https://tailwindcss.com/docs/flex
       */
      flex: [{
        flex: ['1', 'auto', 'initial', 'none', isArbitraryValue]
      }],
      /**
       * Flex Grow
       * @see https://tailwindcss.com/docs/flex-grow
       */
      grow: [{
        grow: getZeroAndEmpty()
      }],
      /**
       * Flex Shrink
       * @see https://tailwindcss.com/docs/flex-shrink
       */
      shrink: [{
        shrink: getZeroAndEmpty()
      }],
      /**
       * Order
       * @see https://tailwindcss.com/docs/order
       */
      order: [{
        order: ['first', 'last', 'none', isInteger, isArbitraryValue]
      }],
      /**
       * Grid Template Columns
       * @see https://tailwindcss.com/docs/grid-template-columns
       */
      'grid-cols': [{
        'grid-cols': [isAny]
      }],
      /**
       * Grid Column Start / End
       * @see https://tailwindcss.com/docs/grid-column
       */
      'col-start-end': [{
        col: ['auto', {
          span: ['full', isInteger, isArbitraryValue]
        }, isArbitraryValue]
      }],
      /**
       * Grid Column Start
       * @see https://tailwindcss.com/docs/grid-column
       */
      'col-start': [{
        'col-start': getNumberWithAutoAndArbitrary()
      }],
      /**
       * Grid Column End
       * @see https://tailwindcss.com/docs/grid-column
       */
      'col-end': [{
        'col-end': getNumberWithAutoAndArbitrary()
      }],
      /**
       * Grid Template Rows
       * @see https://tailwindcss.com/docs/grid-template-rows
       */
      'grid-rows': [{
        'grid-rows': [isAny]
      }],
      /**
       * Grid Row Start / End
       * @see https://tailwindcss.com/docs/grid-row
       */
      'row-start-end': [{
        row: ['auto', {
          span: [isInteger, isArbitraryValue]
        }, isArbitraryValue]
      }],
      /**
       * Grid Row Start
       * @see https://tailwindcss.com/docs/grid-row
       */
      'row-start': [{
        'row-start': getNumberWithAutoAndArbitrary()
      }],
      /**
       * Grid Row End
       * @see https://tailwindcss.com/docs/grid-row
       */
      'row-end': [{
        'row-end': getNumberWithAutoAndArbitrary()
      }],
      /**
       * Grid Auto Flow
       * @see https://tailwindcss.com/docs/grid-auto-flow
       */
      'grid-flow': [{
        'grid-flow': ['row', 'col', 'dense', 'row-dense', 'col-dense']
      }],
      /**
       * Grid Auto Columns
       * @see https://tailwindcss.com/docs/grid-auto-columns
       */
      'auto-cols': [{
        'auto-cols': ['auto', 'min', 'max', 'fr', isArbitraryValue]
      }],
      /**
       * Grid Auto Rows
       * @see https://tailwindcss.com/docs/grid-auto-rows
       */
      'auto-rows': [{
        'auto-rows': ['auto', 'min', 'max', 'fr', isArbitraryValue]
      }],
      /**
       * Gap
       * @see https://tailwindcss.com/docs/gap
       */
      gap: [{
        gap: [gap]
      }],
      /**
       * Gap X
       * @see https://tailwindcss.com/docs/gap
       */
      'gap-x': [{
        'gap-x': [gap]
      }],
      /**
       * Gap Y
       * @see https://tailwindcss.com/docs/gap
       */
      'gap-y': [{
        'gap-y': [gap]
      }],
      /**
       * Justify Content
       * @see https://tailwindcss.com/docs/justify-content
       */
      'justify-content': [{
        justify: ['normal', ...getAlign()]
      }],
      /**
       * Justify Items
       * @see https://tailwindcss.com/docs/justify-items
       */
      'justify-items': [{
        'justify-items': ['start', 'end', 'center', 'stretch']
      }],
      /**
       * Justify Self
       * @see https://tailwindcss.com/docs/justify-self
       */
      'justify-self': [{
        'justify-self': ['auto', 'start', 'end', 'center', 'stretch']
      }],
      /**
       * Align Content
       * @see https://tailwindcss.com/docs/align-content
       */
      'align-content': [{
        content: ['normal', ...getAlign(), 'baseline']
      }],
      /**
       * Align Items
       * @see https://tailwindcss.com/docs/align-items
       */
      'align-items': [{
        items: ['start', 'end', 'center', 'baseline', 'stretch']
      }],
      /**
       * Align Self
       * @see https://tailwindcss.com/docs/align-self
       */
      'align-self': [{
        self: ['auto', 'start', 'end', 'center', 'stretch', 'baseline']
      }],
      /**
       * Place Content
       * @see https://tailwindcss.com/docs/place-content
       */
      'place-content': [{
        'place-content': [...getAlign(), 'baseline']
      }],
      /**
       * Place Items
       * @see https://tailwindcss.com/docs/place-items
       */
      'place-items': [{
        'place-items': ['start', 'end', 'center', 'baseline', 'stretch']
      }],
      /**
       * Place Self
       * @see https://tailwindcss.com/docs/place-self
       */
      'place-self': [{
        'place-self': ['auto', 'start', 'end', 'center', 'stretch']
      }],
      // Spacing
      /**
       * Padding
       * @see https://tailwindcss.com/docs/padding
       */
      p: [{
        p: [padding]
      }],
      /**
       * Padding X
       * @see https://tailwindcss.com/docs/padding
       */
      px: [{
        px: [padding]
      }],
      /**
       * Padding Y
       * @see https://tailwindcss.com/docs/padding
       */
      py: [{
        py: [padding]
      }],
      /**
       * Padding Start
       * @see https://tailwindcss.com/docs/padding
       */
      ps: [{
        ps: [padding]
      }],
      /**
       * Padding End
       * @see https://tailwindcss.com/docs/padding
       */
      pe: [{
        pe: [padding]
      }],
      /**
       * Padding Top
       * @see https://tailwindcss.com/docs/padding
       */
      pt: [{
        pt: [padding]
      }],
      /**
       * Padding Right
       * @see https://tailwindcss.com/docs/padding
       */
      pr: [{
        pr: [padding]
      }],
      /**
       * Padding Bottom
       * @see https://tailwindcss.com/docs/padding
       */
      pb: [{
        pb: [padding]
      }],
      /**
       * Padding Left
       * @see https://tailwindcss.com/docs/padding
       */
      pl: [{
        pl: [padding]
      }],
      /**
       * Margin
       * @see https://tailwindcss.com/docs/margin
       */
      m: [{
        m: [margin]
      }],
      /**
       * Margin X
       * @see https://tailwindcss.com/docs/margin
       */
      mx: [{
        mx: [margin]
      }],
      /**
       * Margin Y
       * @see https://tailwindcss.com/docs/margin
       */
      my: [{
        my: [margin]
      }],
      /**
       * Margin Start
       * @see https://tailwindcss.com/docs/margin
       */
      ms: [{
        ms: [margin]
      }],
      /**
       * Margin End
       * @see https://tailwindcss.com/docs/margin
       */
      me: [{
        me: [margin]
      }],
      /**
       * Margin Top
       * @see https://tailwindcss.com/docs/margin
       */
      mt: [{
        mt: [margin]
      }],
      /**
       * Margin Right
       * @see https://tailwindcss.com/docs/margin
       */
      mr: [{
        mr: [margin]
      }],
      /**
       * Margin Bottom
       * @see https://tailwindcss.com/docs/margin
       */
      mb: [{
        mb: [margin]
      }],
      /**
       * Margin Left
       * @see https://tailwindcss.com/docs/margin
       */
      ml: [{
        ml: [margin]
      }],
      /**
       * Space Between X
       * @see https://tailwindcss.com/docs/space
       */
      'space-x': [{
        'space-x': [space]
      }],
      /**
       * Space Between X Reverse
       * @see https://tailwindcss.com/docs/space
       */
      'space-x-reverse': ['space-x-reverse'],
      /**
       * Space Between Y
       * @see https://tailwindcss.com/docs/space
       */
      'space-y': [{
        'space-y': [space]
      }],
      /**
       * Space Between Y Reverse
       * @see https://tailwindcss.com/docs/space
       */
      'space-y-reverse': ['space-y-reverse'],
      // Sizing
      /**
       * Width
       * @see https://tailwindcss.com/docs/width
       */
      w: [{
        w: ['auto', 'min', 'max', 'fit', 'svw', 'lvw', 'dvw', isArbitraryValue, spacing]
      }],
      /**
       * Min-Width
       * @see https://tailwindcss.com/docs/min-width
       */
      'min-w': [{
        'min-w': [isArbitraryValue, spacing, 'min', 'max', 'fit']
      }],
      /**
       * Max-Width
       * @see https://tailwindcss.com/docs/max-width
       */
      'max-w': [{
        'max-w': [isArbitraryValue, spacing, 'none', 'full', 'min', 'max', 'fit', 'prose', {
          screen: [isTshirtSize]
        }, isTshirtSize]
      }],
      /**
       * Height
       * @see https://tailwindcss.com/docs/height
       */
      h: [{
        h: [isArbitraryValue, spacing, 'auto', 'min', 'max', 'fit', 'svh', 'lvh', 'dvh']
      }],
      /**
       * Min-Height
       * @see https://tailwindcss.com/docs/min-height
       */
      'min-h': [{
        'min-h': [isArbitraryValue, spacing, 'min', 'max', 'fit', 'svh', 'lvh', 'dvh']
      }],
      /**
       * Max-Height
       * @see https://tailwindcss.com/docs/max-height
       */
      'max-h': [{
        'max-h': [isArbitraryValue, spacing, 'min', 'max', 'fit', 'svh', 'lvh', 'dvh']
      }],
      /**
       * Size
       * @see https://tailwindcss.com/docs/size
       */
      size: [{
        size: [isArbitraryValue, spacing, 'auto', 'min', 'max', 'fit']
      }],
      // Typography
      /**
       * Font Size
       * @see https://tailwindcss.com/docs/font-size
       */
      'font-size': [{
        text: ['base', isTshirtSize, isArbitraryLength]
      }],
      /**
       * Font Smoothing
       * @see https://tailwindcss.com/docs/font-smoothing
       */
      'font-smoothing': ['antialiased', 'subpixel-antialiased'],
      /**
       * Font Style
       * @see https://tailwindcss.com/docs/font-style
       */
      'font-style': ['italic', 'not-italic'],
      /**
       * Font Weight
       * @see https://tailwindcss.com/docs/font-weight
       */
      'font-weight': [{
        font: ['thin', 'extralight', 'light', 'normal', 'medium', 'semibold', 'bold', 'extrabold', 'black', isArbitraryNumber]
      }],
      /**
       * Font Family
       * @see https://tailwindcss.com/docs/font-family
       */
      'font-family': [{
        font: [isAny]
      }],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-normal': ['normal-nums'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-ordinal': ['ordinal'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-slashed-zero': ['slashed-zero'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-figure': ['lining-nums', 'oldstyle-nums'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-spacing': ['proportional-nums', 'tabular-nums'],
      /**
       * Font Variant Numeric
       * @see https://tailwindcss.com/docs/font-variant-numeric
       */
      'fvn-fraction': ['diagonal-fractions', 'stacked-fractions'],
      /**
       * Letter Spacing
       * @see https://tailwindcss.com/docs/letter-spacing
       */
      tracking: [{
        tracking: ['tighter', 'tight', 'normal', 'wide', 'wider', 'widest', isArbitraryValue]
      }],
      /**
       * Line Clamp
       * @see https://tailwindcss.com/docs/line-clamp
       */
      'line-clamp': [{
        'line-clamp': ['none', isNumber$1, isArbitraryNumber]
      }],
      /**
       * Line Height
       * @see https://tailwindcss.com/docs/line-height
       */
      leading: [{
        leading: ['none', 'tight', 'snug', 'normal', 'relaxed', 'loose', isLength, isArbitraryValue]
      }],
      /**
       * List Style Image
       * @see https://tailwindcss.com/docs/list-style-image
       */
      'list-image': [{
        'list-image': ['none', isArbitraryValue]
      }],
      /**
       * List Style Type
       * @see https://tailwindcss.com/docs/list-style-type
       */
      'list-style-type': [{
        list: ['none', 'disc', 'decimal', isArbitraryValue]
      }],
      /**
       * List Style Position
       * @see https://tailwindcss.com/docs/list-style-position
       */
      'list-style-position': [{
        list: ['inside', 'outside']
      }],
      /**
       * Placeholder Color
       * @deprecated since Tailwind CSS v3.0.0
       * @see https://tailwindcss.com/docs/placeholder-color
       */
      'placeholder-color': [{
        placeholder: [colors]
      }],
      /**
       * Placeholder Opacity
       * @see https://tailwindcss.com/docs/placeholder-opacity
       */
      'placeholder-opacity': [{
        'placeholder-opacity': [opacity]
      }],
      /**
       * Text Alignment
       * @see https://tailwindcss.com/docs/text-align
       */
      'text-alignment': [{
        text: ['left', 'center', 'right', 'justify', 'start', 'end']
      }],
      /**
       * Text Color
       * @see https://tailwindcss.com/docs/text-color
       */
      'text-color': [{
        text: [colors]
      }],
      /**
       * Text Opacity
       * @see https://tailwindcss.com/docs/text-opacity
       */
      'text-opacity': [{
        'text-opacity': [opacity]
      }],
      /**
       * Text Decoration
       * @see https://tailwindcss.com/docs/text-decoration
       */
      'text-decoration': ['underline', 'overline', 'line-through', 'no-underline'],
      /**
       * Text Decoration Style
       * @see https://tailwindcss.com/docs/text-decoration-style
       */
      'text-decoration-style': [{
        decoration: [...getLineStyles(), 'wavy']
      }],
      /**
       * Text Decoration Thickness
       * @see https://tailwindcss.com/docs/text-decoration-thickness
       */
      'text-decoration-thickness': [{
        decoration: ['auto', 'from-font', isLength, isArbitraryLength]
      }],
      /**
       * Text Underline Offset
       * @see https://tailwindcss.com/docs/text-underline-offset
       */
      'underline-offset': [{
        'underline-offset': ['auto', isLength, isArbitraryValue]
      }],
      /**
       * Text Decoration Color
       * @see https://tailwindcss.com/docs/text-decoration-color
       */
      'text-decoration-color': [{
        decoration: [colors]
      }],
      /**
       * Text Transform
       * @see https://tailwindcss.com/docs/text-transform
       */
      'text-transform': ['uppercase', 'lowercase', 'capitalize', 'normal-case'],
      /**
       * Text Overflow
       * @see https://tailwindcss.com/docs/text-overflow
       */
      'text-overflow': ['truncate', 'text-ellipsis', 'text-clip'],
      /**
       * Text Wrap
       * @see https://tailwindcss.com/docs/text-wrap
       */
      'text-wrap': [{
        text: ['wrap', 'nowrap', 'balance', 'pretty']
      }],
      /**
       * Text Indent
       * @see https://tailwindcss.com/docs/text-indent
       */
      indent: [{
        indent: getSpacingWithArbitrary()
      }],
      /**
       * Vertical Alignment
       * @see https://tailwindcss.com/docs/vertical-align
       */
      'vertical-align': [{
        align: ['baseline', 'top', 'middle', 'bottom', 'text-top', 'text-bottom', 'sub', 'super', isArbitraryValue]
      }],
      /**
       * Whitespace
       * @see https://tailwindcss.com/docs/whitespace
       */
      whitespace: [{
        whitespace: ['normal', 'nowrap', 'pre', 'pre-line', 'pre-wrap', 'break-spaces']
      }],
      /**
       * Word Break
       * @see https://tailwindcss.com/docs/word-break
       */
      break: [{
        break: ['normal', 'words', 'all', 'keep']
      }],
      /**
       * Hyphens
       * @see https://tailwindcss.com/docs/hyphens
       */
      hyphens: [{
        hyphens: ['none', 'manual', 'auto']
      }],
      /**
       * Content
       * @see https://tailwindcss.com/docs/content
       */
      content: [{
        content: ['none', isArbitraryValue]
      }],
      // Backgrounds
      /**
       * Background Attachment
       * @see https://tailwindcss.com/docs/background-attachment
       */
      'bg-attachment': [{
        bg: ['fixed', 'local', 'scroll']
      }],
      /**
       * Background Clip
       * @see https://tailwindcss.com/docs/background-clip
       */
      'bg-clip': [{
        'bg-clip': ['border', 'padding', 'content', 'text']
      }],
      /**
       * Background Opacity
       * @deprecated since Tailwind CSS v3.0.0
       * @see https://tailwindcss.com/docs/background-opacity
       */
      'bg-opacity': [{
        'bg-opacity': [opacity]
      }],
      /**
       * Background Origin
       * @see https://tailwindcss.com/docs/background-origin
       */
      'bg-origin': [{
        'bg-origin': ['border', 'padding', 'content']
      }],
      /**
       * Background Position
       * @see https://tailwindcss.com/docs/background-position
       */
      'bg-position': [{
        bg: [...getPositions(), isArbitraryPosition]
      }],
      /**
       * Background Repeat
       * @see https://tailwindcss.com/docs/background-repeat
       */
      'bg-repeat': [{
        bg: ['no-repeat', {
          repeat: ['', 'x', 'y', 'round', 'space']
        }]
      }],
      /**
       * Background Size
       * @see https://tailwindcss.com/docs/background-size
       */
      'bg-size': [{
        bg: ['auto', 'cover', 'contain', isArbitrarySize]
      }],
      /**
       * Background Image
       * @see https://tailwindcss.com/docs/background-image
       */
      'bg-image': [{
        bg: ['none', {
          'gradient-to': ['t', 'tr', 'r', 'br', 'b', 'bl', 'l', 'tl']
        }, isArbitraryImage]
      }],
      /**
       * Background Color
       * @see https://tailwindcss.com/docs/background-color
       */
      'bg-color': [{
        bg: [colors]
      }],
      /**
       * Gradient Color Stops From Position
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-from-pos': [{
        from: [gradientColorStopPositions]
      }],
      /**
       * Gradient Color Stops Via Position
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-via-pos': [{
        via: [gradientColorStopPositions]
      }],
      /**
       * Gradient Color Stops To Position
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-to-pos': [{
        to: [gradientColorStopPositions]
      }],
      /**
       * Gradient Color Stops From
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-from': [{
        from: [gradientColorStops]
      }],
      /**
       * Gradient Color Stops Via
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-via': [{
        via: [gradientColorStops]
      }],
      /**
       * Gradient Color Stops To
       * @see https://tailwindcss.com/docs/gradient-color-stops
       */
      'gradient-to': [{
        to: [gradientColorStops]
      }],
      // Borders
      /**
       * Border Radius
       * @see https://tailwindcss.com/docs/border-radius
       */
      rounded: [{
        rounded: [borderRadius]
      }],
      /**
       * Border Radius Start
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-s': [{
        'rounded-s': [borderRadius]
      }],
      /**
       * Border Radius End
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-e': [{
        'rounded-e': [borderRadius]
      }],
      /**
       * Border Radius Top
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-t': [{
        'rounded-t': [borderRadius]
      }],
      /**
       * Border Radius Right
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-r': [{
        'rounded-r': [borderRadius]
      }],
      /**
       * Border Radius Bottom
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-b': [{
        'rounded-b': [borderRadius]
      }],
      /**
       * Border Radius Left
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-l': [{
        'rounded-l': [borderRadius]
      }],
      /**
       * Border Radius Start Start
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-ss': [{
        'rounded-ss': [borderRadius]
      }],
      /**
       * Border Radius Start End
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-se': [{
        'rounded-se': [borderRadius]
      }],
      /**
       * Border Radius End End
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-ee': [{
        'rounded-ee': [borderRadius]
      }],
      /**
       * Border Radius End Start
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-es': [{
        'rounded-es': [borderRadius]
      }],
      /**
       * Border Radius Top Left
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-tl': [{
        'rounded-tl': [borderRadius]
      }],
      /**
       * Border Radius Top Right
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-tr': [{
        'rounded-tr': [borderRadius]
      }],
      /**
       * Border Radius Bottom Right
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-br': [{
        'rounded-br': [borderRadius]
      }],
      /**
       * Border Radius Bottom Left
       * @see https://tailwindcss.com/docs/border-radius
       */
      'rounded-bl': [{
        'rounded-bl': [borderRadius]
      }],
      /**
       * Border Width
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w': [{
        border: [borderWidth]
      }],
      /**
       * Border Width X
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-x': [{
        'border-x': [borderWidth]
      }],
      /**
       * Border Width Y
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-y': [{
        'border-y': [borderWidth]
      }],
      /**
       * Border Width Start
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-s': [{
        'border-s': [borderWidth]
      }],
      /**
       * Border Width End
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-e': [{
        'border-e': [borderWidth]
      }],
      /**
       * Border Width Top
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-t': [{
        'border-t': [borderWidth]
      }],
      /**
       * Border Width Right
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-r': [{
        'border-r': [borderWidth]
      }],
      /**
       * Border Width Bottom
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-b': [{
        'border-b': [borderWidth]
      }],
      /**
       * Border Width Left
       * @see https://tailwindcss.com/docs/border-width
       */
      'border-w-l': [{
        'border-l': [borderWidth]
      }],
      /**
       * Border Opacity
       * @see https://tailwindcss.com/docs/border-opacity
       */
      'border-opacity': [{
        'border-opacity': [opacity]
      }],
      /**
       * Border Style
       * @see https://tailwindcss.com/docs/border-style
       */
      'border-style': [{
        border: [...getLineStyles(), 'hidden']
      }],
      /**
       * Divide Width X
       * @see https://tailwindcss.com/docs/divide-width
       */
      'divide-x': [{
        'divide-x': [borderWidth]
      }],
      /**
       * Divide Width X Reverse
       * @see https://tailwindcss.com/docs/divide-width
       */
      'divide-x-reverse': ['divide-x-reverse'],
      /**
       * Divide Width Y
       * @see https://tailwindcss.com/docs/divide-width
       */
      'divide-y': [{
        'divide-y': [borderWidth]
      }],
      /**
       * Divide Width Y Reverse
       * @see https://tailwindcss.com/docs/divide-width
       */
      'divide-y-reverse': ['divide-y-reverse'],
      /**
       * Divide Opacity
       * @see https://tailwindcss.com/docs/divide-opacity
       */
      'divide-opacity': [{
        'divide-opacity': [opacity]
      }],
      /**
       * Divide Style
       * @see https://tailwindcss.com/docs/divide-style
       */
      'divide-style': [{
        divide: getLineStyles()
      }],
      /**
       * Border Color
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color': [{
        border: [borderColor]
      }],
      /**
       * Border Color X
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-x': [{
        'border-x': [borderColor]
      }],
      /**
       * Border Color Y
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-y': [{
        'border-y': [borderColor]
      }],
      /**
       * Border Color S
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-s': [{
        'border-s': [borderColor]
      }],
      /**
       * Border Color E
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-e': [{
        'border-e': [borderColor]
      }],
      /**
       * Border Color Top
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-t': [{
        'border-t': [borderColor]
      }],
      /**
       * Border Color Right
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-r': [{
        'border-r': [borderColor]
      }],
      /**
       * Border Color Bottom
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-b': [{
        'border-b': [borderColor]
      }],
      /**
       * Border Color Left
       * @see https://tailwindcss.com/docs/border-color
       */
      'border-color-l': [{
        'border-l': [borderColor]
      }],
      /**
       * Divide Color
       * @see https://tailwindcss.com/docs/divide-color
       */
      'divide-color': [{
        divide: [borderColor]
      }],
      /**
       * Outline Style
       * @see https://tailwindcss.com/docs/outline-style
       */
      'outline-style': [{
        outline: ['', ...getLineStyles()]
      }],
      /**
       * Outline Offset
       * @see https://tailwindcss.com/docs/outline-offset
       */
      'outline-offset': [{
        'outline-offset': [isLength, isArbitraryValue]
      }],
      /**
       * Outline Width
       * @see https://tailwindcss.com/docs/outline-width
       */
      'outline-w': [{
        outline: [isLength, isArbitraryLength]
      }],
      /**
       * Outline Color
       * @see https://tailwindcss.com/docs/outline-color
       */
      'outline-color': [{
        outline: [colors]
      }],
      /**
       * Ring Width
       * @see https://tailwindcss.com/docs/ring-width
       */
      'ring-w': [{
        ring: getLengthWithEmptyAndArbitrary()
      }],
      /**
       * Ring Width Inset
       * @see https://tailwindcss.com/docs/ring-width
       */
      'ring-w-inset': ['ring-inset'],
      /**
       * Ring Color
       * @see https://tailwindcss.com/docs/ring-color
       */
      'ring-color': [{
        ring: [colors]
      }],
      /**
       * Ring Opacity
       * @see https://tailwindcss.com/docs/ring-opacity
       */
      'ring-opacity': [{
        'ring-opacity': [opacity]
      }],
      /**
       * Ring Offset Width
       * @see https://tailwindcss.com/docs/ring-offset-width
       */
      'ring-offset-w': [{
        'ring-offset': [isLength, isArbitraryLength]
      }],
      /**
       * Ring Offset Color
       * @see https://tailwindcss.com/docs/ring-offset-color
       */
      'ring-offset-color': [{
        'ring-offset': [colors]
      }],
      // Effects
      /**
       * Box Shadow
       * @see https://tailwindcss.com/docs/box-shadow
       */
      shadow: [{
        shadow: ['', 'inner', 'none', isTshirtSize, isArbitraryShadow]
      }],
      /**
       * Box Shadow Color
       * @see https://tailwindcss.com/docs/box-shadow-color
       */
      'shadow-color': [{
        shadow: [isAny]
      }],
      /**
       * Opacity
       * @see https://tailwindcss.com/docs/opacity
       */
      opacity: [{
        opacity: [opacity]
      }],
      /**
       * Mix Blend Mode
       * @see https://tailwindcss.com/docs/mix-blend-mode
       */
      'mix-blend': [{
        'mix-blend': [...getBlendModes(), 'plus-lighter', 'plus-darker']
      }],
      /**
       * Background Blend Mode
       * @see https://tailwindcss.com/docs/background-blend-mode
       */
      'bg-blend': [{
        'bg-blend': getBlendModes()
      }],
      // Filters
      /**
       * Filter
       * @deprecated since Tailwind CSS v3.0.0
       * @see https://tailwindcss.com/docs/filter
       */
      filter: [{
        filter: ['', 'none']
      }],
      /**
       * Blur
       * @see https://tailwindcss.com/docs/blur
       */
      blur: [{
        blur: [blur]
      }],
      /**
       * Brightness
       * @see https://tailwindcss.com/docs/brightness
       */
      brightness: [{
        brightness: [brightness]
      }],
      /**
       * Contrast
       * @see https://tailwindcss.com/docs/contrast
       */
      contrast: [{
        contrast: [contrast]
      }],
      /**
       * Drop Shadow
       * @see https://tailwindcss.com/docs/drop-shadow
       */
      'drop-shadow': [{
        'drop-shadow': ['', 'none', isTshirtSize, isArbitraryValue]
      }],
      /**
       * Grayscale
       * @see https://tailwindcss.com/docs/grayscale
       */
      grayscale: [{
        grayscale: [grayscale]
      }],
      /**
       * Hue Rotate
       * @see https://tailwindcss.com/docs/hue-rotate
       */
      'hue-rotate': [{
        'hue-rotate': [hueRotate]
      }],
      /**
       * Invert
       * @see https://tailwindcss.com/docs/invert
       */
      invert: [{
        invert: [invert]
      }],
      /**
       * Saturate
       * @see https://tailwindcss.com/docs/saturate
       */
      saturate: [{
        saturate: [saturate]
      }],
      /**
       * Sepia
       * @see https://tailwindcss.com/docs/sepia
       */
      sepia: [{
        sepia: [sepia]
      }],
      /**
       * Backdrop Filter
       * @deprecated since Tailwind CSS v3.0.0
       * @see https://tailwindcss.com/docs/backdrop-filter
       */
      'backdrop-filter': [{
        'backdrop-filter': ['', 'none']
      }],
      /**
       * Backdrop Blur
       * @see https://tailwindcss.com/docs/backdrop-blur
       */
      'backdrop-blur': [{
        'backdrop-blur': [blur]
      }],
      /**
       * Backdrop Brightness
       * @see https://tailwindcss.com/docs/backdrop-brightness
       */
      'backdrop-brightness': [{
        'backdrop-brightness': [brightness]
      }],
      /**
       * Backdrop Contrast
       * @see https://tailwindcss.com/docs/backdrop-contrast
       */
      'backdrop-contrast': [{
        'backdrop-contrast': [contrast]
      }],
      /**
       * Backdrop Grayscale
       * @see https://tailwindcss.com/docs/backdrop-grayscale
       */
      'backdrop-grayscale': [{
        'backdrop-grayscale': [grayscale]
      }],
      /**
       * Backdrop Hue Rotate
       * @see https://tailwindcss.com/docs/backdrop-hue-rotate
       */
      'backdrop-hue-rotate': [{
        'backdrop-hue-rotate': [hueRotate]
      }],
      /**
       * Backdrop Invert
       * @see https://tailwindcss.com/docs/backdrop-invert
       */
      'backdrop-invert': [{
        'backdrop-invert': [invert]
      }],
      /**
       * Backdrop Opacity
       * @see https://tailwindcss.com/docs/backdrop-opacity
       */
      'backdrop-opacity': [{
        'backdrop-opacity': [opacity]
      }],
      /**
       * Backdrop Saturate
       * @see https://tailwindcss.com/docs/backdrop-saturate
       */
      'backdrop-saturate': [{
        'backdrop-saturate': [saturate]
      }],
      /**
       * Backdrop Sepia
       * @see https://tailwindcss.com/docs/backdrop-sepia
       */
      'backdrop-sepia': [{
        'backdrop-sepia': [sepia]
      }],
      // Tables
      /**
       * Border Collapse
       * @see https://tailwindcss.com/docs/border-collapse
       */
      'border-collapse': [{
        border: ['collapse', 'separate']
      }],
      /**
       * Border Spacing
       * @see https://tailwindcss.com/docs/border-spacing
       */
      'border-spacing': [{
        'border-spacing': [borderSpacing]
      }],
      /**
       * Border Spacing X
       * @see https://tailwindcss.com/docs/border-spacing
       */
      'border-spacing-x': [{
        'border-spacing-x': [borderSpacing]
      }],
      /**
       * Border Spacing Y
       * @see https://tailwindcss.com/docs/border-spacing
       */
      'border-spacing-y': [{
        'border-spacing-y': [borderSpacing]
      }],
      /**
       * Table Layout
       * @see https://tailwindcss.com/docs/table-layout
       */
      'table-layout': [{
        table: ['auto', 'fixed']
      }],
      /**
       * Caption Side
       * @see https://tailwindcss.com/docs/caption-side
       */
      caption: [{
        caption: ['top', 'bottom']
      }],
      // Transitions and Animation
      /**
       * Tranisition Property
       * @see https://tailwindcss.com/docs/transition-property
       */
      transition: [{
        transition: ['none', 'all', '', 'colors', 'opacity', 'shadow', 'transform', isArbitraryValue]
      }],
      /**
       * Transition Duration
       * @see https://tailwindcss.com/docs/transition-duration
       */
      duration: [{
        duration: getNumberAndArbitrary()
      }],
      /**
       * Transition Timing Function
       * @see https://tailwindcss.com/docs/transition-timing-function
       */
      ease: [{
        ease: ['linear', 'in', 'out', 'in-out', isArbitraryValue]
      }],
      /**
       * Transition Delay
       * @see https://tailwindcss.com/docs/transition-delay
       */
      delay: [{
        delay: getNumberAndArbitrary()
      }],
      /**
       * Animation
       * @see https://tailwindcss.com/docs/animation
       */
      animate: [{
        animate: ['none', 'spin', 'ping', 'pulse', 'bounce', isArbitraryValue]
      }],
      // Transforms
      /**
       * Transform
       * @see https://tailwindcss.com/docs/transform
       */
      transform: [{
        transform: ['', 'gpu', 'none']
      }],
      /**
       * Scale
       * @see https://tailwindcss.com/docs/scale
       */
      scale: [{
        scale: [scale]
      }],
      /**
       * Scale X
       * @see https://tailwindcss.com/docs/scale
       */
      'scale-x': [{
        'scale-x': [scale]
      }],
      /**
       * Scale Y
       * @see https://tailwindcss.com/docs/scale
       */
      'scale-y': [{
        'scale-y': [scale]
      }],
      /**
       * Rotate
       * @see https://tailwindcss.com/docs/rotate
       */
      rotate: [{
        rotate: [isInteger, isArbitraryValue]
      }],
      /**
       * Translate X
       * @see https://tailwindcss.com/docs/translate
       */
      'translate-x': [{
        'translate-x': [translate]
      }],
      /**
       * Translate Y
       * @see https://tailwindcss.com/docs/translate
       */
      'translate-y': [{
        'translate-y': [translate]
      }],
      /**
       * Skew X
       * @see https://tailwindcss.com/docs/skew
       */
      'skew-x': [{
        'skew-x': [skew]
      }],
      /**
       * Skew Y
       * @see https://tailwindcss.com/docs/skew
       */
      'skew-y': [{
        'skew-y': [skew]
      }],
      /**
       * Transform Origin
       * @see https://tailwindcss.com/docs/transform-origin
       */
      'transform-origin': [{
        origin: ['center', 'top', 'top-right', 'right', 'bottom-right', 'bottom', 'bottom-left', 'left', 'top-left', isArbitraryValue]
      }],
      // Interactivity
      /**
       * Accent Color
       * @see https://tailwindcss.com/docs/accent-color
       */
      accent: [{
        accent: ['auto', colors]
      }],
      /**
       * Appearance
       * @see https://tailwindcss.com/docs/appearance
       */
      appearance: [{
        appearance: ['none', 'auto']
      }],
      /**
       * Cursor
       * @see https://tailwindcss.com/docs/cursor
       */
      cursor: [{
        cursor: ['auto', 'default', 'pointer', 'wait', 'text', 'move', 'help', 'not-allowed', 'none', 'context-menu', 'progress', 'cell', 'crosshair', 'vertical-text', 'alias', 'copy', 'no-drop', 'grab', 'grabbing', 'all-scroll', 'col-resize', 'row-resize', 'n-resize', 'e-resize', 's-resize', 'w-resize', 'ne-resize', 'nw-resize', 'se-resize', 'sw-resize', 'ew-resize', 'ns-resize', 'nesw-resize', 'nwse-resize', 'zoom-in', 'zoom-out', isArbitraryValue]
      }],
      /**
       * Caret Color
       * @see https://tailwindcss.com/docs/just-in-time-mode#caret-color-utilities
       */
      'caret-color': [{
        caret: [colors]
      }],
      /**
       * Pointer Events
       * @see https://tailwindcss.com/docs/pointer-events
       */
      'pointer-events': [{
        'pointer-events': ['none', 'auto']
      }],
      /**
       * Resize
       * @see https://tailwindcss.com/docs/resize
       */
      resize: [{
        resize: ['none', 'y', 'x', '']
      }],
      /**
       * Scroll Behavior
       * @see https://tailwindcss.com/docs/scroll-behavior
       */
      'scroll-behavior': [{
        scroll: ['auto', 'smooth']
      }],
      /**
       * Scroll Margin
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-m': [{
        'scroll-m': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin X
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-mx': [{
        'scroll-mx': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Y
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-my': [{
        'scroll-my': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Start
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-ms': [{
        'scroll-ms': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin End
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-me': [{
        'scroll-me': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Top
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-mt': [{
        'scroll-mt': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Right
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-mr': [{
        'scroll-mr': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Bottom
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-mb': [{
        'scroll-mb': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Margin Left
       * @see https://tailwindcss.com/docs/scroll-margin
       */
      'scroll-ml': [{
        'scroll-ml': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-p': [{
        'scroll-p': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding X
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-px': [{
        'scroll-px': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Y
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-py': [{
        'scroll-py': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Start
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-ps': [{
        'scroll-ps': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding End
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pe': [{
        'scroll-pe': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Top
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pt': [{
        'scroll-pt': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Right
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pr': [{
        'scroll-pr': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Bottom
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pb': [{
        'scroll-pb': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Padding Left
       * @see https://tailwindcss.com/docs/scroll-padding
       */
      'scroll-pl': [{
        'scroll-pl': getSpacingWithArbitrary()
      }],
      /**
       * Scroll Snap Align
       * @see https://tailwindcss.com/docs/scroll-snap-align
       */
      'snap-align': [{
        snap: ['start', 'end', 'center', 'align-none']
      }],
      /**
       * Scroll Snap Stop
       * @see https://tailwindcss.com/docs/scroll-snap-stop
       */
      'snap-stop': [{
        snap: ['normal', 'always']
      }],
      /**
       * Scroll Snap Type
       * @see https://tailwindcss.com/docs/scroll-snap-type
       */
      'snap-type': [{
        snap: ['none', 'x', 'y', 'both']
      }],
      /**
       * Scroll Snap Type Strictness
       * @see https://tailwindcss.com/docs/scroll-snap-type
       */
      'snap-strictness': [{
        snap: ['mandatory', 'proximity']
      }],
      /**
       * Touch Action
       * @see https://tailwindcss.com/docs/touch-action
       */
      touch: [{
        touch: ['auto', 'none', 'manipulation']
      }],
      /**
       * Touch Action X
       * @see https://tailwindcss.com/docs/touch-action
       */
      'touch-x': [{
        'touch-pan': ['x', 'left', 'right']
      }],
      /**
       * Touch Action Y
       * @see https://tailwindcss.com/docs/touch-action
       */
      'touch-y': [{
        'touch-pan': ['y', 'up', 'down']
      }],
      /**
       * Touch Action Pinch Zoom
       * @see https://tailwindcss.com/docs/touch-action
       */
      'touch-pz': ['touch-pinch-zoom'],
      /**
       * User Select
       * @see https://tailwindcss.com/docs/user-select
       */
      select: [{
        select: ['none', 'text', 'all', 'auto']
      }],
      /**
       * Will Change
       * @see https://tailwindcss.com/docs/will-change
       */
      'will-change': [{
        'will-change': ['auto', 'scroll', 'contents', 'transform', isArbitraryValue]
      }],
      // SVG
      /**
       * Fill
       * @see https://tailwindcss.com/docs/fill
       */
      fill: [{
        fill: [colors, 'none']
      }],
      /**
       * Stroke Width
       * @see https://tailwindcss.com/docs/stroke-width
       */
      'stroke-w': [{
        stroke: [isLength, isArbitraryLength, isArbitraryNumber]
      }],
      /**
       * Stroke
       * @see https://tailwindcss.com/docs/stroke
       */
      stroke: [{
        stroke: [colors, 'none']
      }],
      // Accessibility
      /**
       * Screen Readers
       * @see https://tailwindcss.com/docs/screen-readers
       */
      sr: ['sr-only', 'not-sr-only'],
      /**
       * Forced Color Adjust
       * @see https://tailwindcss.com/docs/forced-color-adjust
       */
      'forced-color-adjust': [{
        'forced-color-adjust': ['auto', 'none']
      }]
    },
    conflictingClassGroups: {
      overflow: ['overflow-x', 'overflow-y'],
      overscroll: ['overscroll-x', 'overscroll-y'],
      inset: ['inset-x', 'inset-y', 'start', 'end', 'top', 'right', 'bottom', 'left'],
      'inset-x': ['right', 'left'],
      'inset-y': ['top', 'bottom'],
      flex: ['basis', 'grow', 'shrink'],
      gap: ['gap-x', 'gap-y'],
      p: ['px', 'py', 'ps', 'pe', 'pt', 'pr', 'pb', 'pl'],
      px: ['pr', 'pl'],
      py: ['pt', 'pb'],
      m: ['mx', 'my', 'ms', 'me', 'mt', 'mr', 'mb', 'ml'],
      mx: ['mr', 'ml'],
      my: ['mt', 'mb'],
      size: ['w', 'h'],
      'font-size': ['leading'],
      'fvn-normal': ['fvn-ordinal', 'fvn-slashed-zero', 'fvn-figure', 'fvn-spacing', 'fvn-fraction'],
      'fvn-ordinal': ['fvn-normal'],
      'fvn-slashed-zero': ['fvn-normal'],
      'fvn-figure': ['fvn-normal'],
      'fvn-spacing': ['fvn-normal'],
      'fvn-fraction': ['fvn-normal'],
      'line-clamp': ['display', 'overflow'],
      rounded: ['rounded-s', 'rounded-e', 'rounded-t', 'rounded-r', 'rounded-b', 'rounded-l', 'rounded-ss', 'rounded-se', 'rounded-ee', 'rounded-es', 'rounded-tl', 'rounded-tr', 'rounded-br', 'rounded-bl'],
      'rounded-s': ['rounded-ss', 'rounded-es'],
      'rounded-e': ['rounded-se', 'rounded-ee'],
      'rounded-t': ['rounded-tl', 'rounded-tr'],
      'rounded-r': ['rounded-tr', 'rounded-br'],
      'rounded-b': ['rounded-br', 'rounded-bl'],
      'rounded-l': ['rounded-tl', 'rounded-bl'],
      'border-spacing': ['border-spacing-x', 'border-spacing-y'],
      'border-w': ['border-w-s', 'border-w-e', 'border-w-t', 'border-w-r', 'border-w-b', 'border-w-l'],
      'border-w-x': ['border-w-r', 'border-w-l'],
      'border-w-y': ['border-w-t', 'border-w-b'],
      'border-color': ['border-color-s', 'border-color-e', 'border-color-t', 'border-color-r', 'border-color-b', 'border-color-l'],
      'border-color-x': ['border-color-r', 'border-color-l'],
      'border-color-y': ['border-color-t', 'border-color-b'],
      'scroll-m': ['scroll-mx', 'scroll-my', 'scroll-ms', 'scroll-me', 'scroll-mt', 'scroll-mr', 'scroll-mb', 'scroll-ml'],
      'scroll-mx': ['scroll-mr', 'scroll-ml'],
      'scroll-my': ['scroll-mt', 'scroll-mb'],
      'scroll-p': ['scroll-px', 'scroll-py', 'scroll-ps', 'scroll-pe', 'scroll-pt', 'scroll-pr', 'scroll-pb', 'scroll-pl'],
      'scroll-px': ['scroll-pr', 'scroll-pl'],
      'scroll-py': ['scroll-pt', 'scroll-pb'],
      touch: ['touch-x', 'touch-y', 'touch-pz'],
      'touch-x': ['touch'],
      'touch-y': ['touch'],
      'touch-pz': ['touch']
    },
    conflictingClassGroupModifiers: {
      'font-size': ['leading']
    }
  };
};
const twMerge = /*#__PURE__*/createTailwindMerge(getDefaultConfig);

function cn(...inputs) {
  return twMerge(clsx(inputs));
}

const Dialog = ({ open, onOpenChange, children }) => {
  const [isOpen, setIsOpen] = reactExports.useState(open || false);
  reactExports.useEffect(() => {
    if (open !== void 0) {
      setIsOpen(open);
    }
  }, [open]);
  const handleOpenChange = (newOpen) => {
    setIsOpen(newOpen);
    onOpenChange?.(newOpen);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: reactExports.Children.map(children, (child) => {
    if (reactExports.isValidElement(child)) {
      return reactExports.cloneElement(child, {
        isOpen,
        onOpenChange: handleOpenChange
      });
    }
    return child;
  }) });
};
const DialogContent = reactExports.forwardRef(
  ({ className, isOpen, onOpenChange, children, ...props }, ref) => {
    if (!isOpen) return null;
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        ref,
        className: cn(
          "relative bg-background rounded-lg shadow-lg max-w-lg w-full max-h-[85vh] overflow-y-auto m1ssion-glass-card",
          className
        ),
        ...props,
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            "button",
            {
              onClick: () => onOpenChange?.(false),
              className: "absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 text-white hover:text-[#00D1FF]",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only", children: "Close" }),
                "✕"
              ]
            }
          ),
          children
        ]
      }
    ) });
  }
);
DialogContent.displayName = "DialogContent";
const DialogHeader = ({ className, ...props }) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn("flex flex-col space-y-1.5 text-center sm:text-left p-6", className),
    ...props
  }
);
DialogHeader.displayName = "DialogHeader";
const DialogTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "h2",
  {
    ref,
    className: cn("text-lg font-semibold leading-none tracking-tight gradient-text-cyan", className),
    ...props
  }
));
DialogTitle.displayName = "DialogTitle";
const DialogDescription = reactExports.forwardRef(({ className, asChild, children, ...props }, ref) => {
  const Comp = asChild ? "div" : "p";
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Comp,
    {
      ref,
      className: cn("text-sm text-white/70", className),
      ...props,
      children
    }
  );
});
DialogDescription.displayName = "DialogDescription";
const DialogFooter = ({ className, ...props }) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 p-6 pt-0",
      className
    ),
    ...props
  }
);
DialogFooter.displayName = "DialogFooter";
const DialogClose = ({ asChild, children, ...props }) => {
  const Comp = asChild ? "span" : "button";
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Comp, { ...props, children });
};
DialogClose.displayName = "DialogClose";

const falsyToString = (value)=>typeof value === "boolean" ? `${value}` : value === 0 ? "0" : value;
const cx = clsx;
const cva = (base, config)=>(props)=>{
        var _config_compoundVariants;
        if ((config === null || config === void 0 ? void 0 : config.variants) == null) return cx(base, props === null || props === void 0 ? void 0 : props.class, props === null || props === void 0 ? void 0 : props.className);
        const { variants, defaultVariants } = config;
        const getVariantClassNames = Object.keys(variants).map((variant)=>{
            const variantProp = props === null || props === void 0 ? void 0 : props[variant];
            const defaultVariantProp = defaultVariants === null || defaultVariants === void 0 ? void 0 : defaultVariants[variant];
            if (variantProp === null) return null;
            const variantKey = falsyToString(variantProp) || falsyToString(defaultVariantProp);
            return variants[variant][variantKey];
        });
        const propsWithoutUndefined = props && Object.entries(props).reduce((acc, param)=>{
            let [key, value] = param;
            if (value === undefined) {
                return acc;
            }
            acc[key] = value;
            return acc;
        }, {});
        const getCompoundVariantClassNames = config === null || config === void 0 ? void 0 : (_config_compoundVariants = config.compoundVariants) === null || _config_compoundVariants === void 0 ? void 0 : _config_compoundVariants.reduce((acc, param)=>{
            let { class: cvClass, className: cvClassName, ...compoundVariantOptions } = param;
            return Object.entries(compoundVariantOptions).every((param)=>{
                let [key, value] = param;
                return Array.isArray(value) ? value.includes({
                    ...defaultVariants,
                    ...propsWithoutUndefined
                }[key]) : ({
                    ...defaultVariants,
                    ...propsWithoutUndefined
                })[key] === value;
            }) ? [
                ...acc,
                cvClass,
                cvClassName
            ] : acc;
        }, []);
        return cx(base, getVariantClassNames, getCompoundVariantClassNames, props === null || props === void 0 ? void 0 : props.class, props === null || props === void 0 ? void 0 : props.className);
    };

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 btn-hover-effect",
  {
    variants: {
      variant: {
        default: "bg-gradient-to-r from-[#7B2EFF] to-[#00D1FF] text-white hover:shadow-[0_0_15px_rgba(0,209,255,0.5)] hover:scale-[1.03]",
        destructive: "bg-gradient-to-r from-red-500 to-red-700 text-white hover:shadow-[0_0_15px_rgba(239,68,68,0.5)] hover:scale-[1.03]",
        outline: "border border-[#00D1FF]/30 hover:border-[#00D1FF]/70 bg-black/30 hover:bg-black/50 text-white",
        secondary: "bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-[0_0_15px_rgba(217,70,239,0.5)] hover:scale-[1.03]",
        ghost: "hover:bg-white/10 hover:text-[#00D1FF] text-white",
        link: "text-[#00D1FF] underline-offset-4 hover:underline hover:brightness-125",
        accent: "bg-gradient-to-r from-yellow-400 to-orange-500 text-black hover:shadow-[0_0_15px_rgba(250,204,21,0.5)] hover:scale-[1.03]"
      },
      size: {
        default: "h-10 px-6 py-2 rounded-full",
        sm: "h-9 rounded-full px-4",
        lg: "h-11 rounded-full px-8",
        icon: "h-10 w-10 rounded-full"
      }
    },
    defaultVariants: {
      variant: "default",
      size: "default"
    }
  }
);
const Button = reactExports.forwardRef(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? "span" : "button";
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Comp,
      {
        className: cn(buttonVariants({ variant, size, className })),
        ref,
        ...props
      }
    );
  }
);
Button.displayName = "Button";

const __vite_import_meta_env__ = {"BASE_URL": "/", "DEV": false, "MODE": "production", "PROD": true, "SSR": false, "VITE_ANALYTICS_ID": "your_analytics_id_here", "VITE_APP_ENV": "development", "VITE_APP_SECRET": "your_app_secret_here", "VITE_BUILD_ID": "build-mijx2t6r", "VITE_CAPACITOR_BUILD": "false", "VITE_CONTOUR_URL": "https://api.maptiler.com/tiles/contours/{z}/{x}/{y}.pbf?key=VRJaVKMtkFdyVzhXCjBF", "VITE_DEBUG_MODE": "true", "VITE_ENABLE_LIVING_MAP": "true", "VITE_LIVING_MAP_USE_MOCK": "false", "VITE_MAP3D_DEV_MOCKS": "false", "VITE_MAPBOX_TOKEN": "your_mapbox_token_here", "VITE_MAPTILER_KEY_DEV": "gw2gQRfg512G0yw3DbWn", "VITE_MAPTILER_KEY_PROD": "M2JlRFvsxjcMvVXw1HN1", "VITE_MISSION_START_DATE": "2024-01-01", "VITE_PUSH_SAFE_MODE": "1", "VITE_PWA_VERSION": "2025.01.18.001", "VITE_STRIPE_PUBLISHABLE_KEY": "pk_test_51QJWtNRp5StPxareRp0GNVD9BT0auKQ8LEeezlPROQcwiDQ6nGOd0UihU5Y9fjJFD3naTwx3YsHoPPzlJ5Alk4pD00FhZM6lyZ", "VITE_SUPABASE_ANON_KEY": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk", "VITE_SUPABASE_PROJECT_ID": "heqgsrofojvqiovkbsfn", "VITE_SUPABASE_PUBLISHABLE_KEY": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhlcWdzcm9mb2p2cWlvdmtic2ZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NDUyNTYsImV4cCI6MjA3OTEyMTI1Nn0.PDt22db966-dtLuJaRglsbOu148FbKsuu_JFiZtnrAg", "VITE_SUPABASE_URL": "https://heqgsrofojvqiovkbsfn.supabase.co", "VITE_TERRAIN_URL": "https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=VRJaVKMtkFdyVzhXCjBF", "VITE_VAPID_PUBLIC_KEY": "BBjgzWK_1_PBZXGLQb-xQjSEUH5jLsNNgx8N0LgOcKUkZeCUaNV_gRE-QM5pKS2bPKUhVJLn0Q-H3BNGnOOjy8Q"};
const DEFAULT_PERIODS = {
  "xp-reward": 24,
  "ios-permission": 24,
  "cookie-consent": 8760,
  // 1 year
  "first-login-quiz": 8760
  // 1 year
};
function getPopupPeriod(id) {
  try {
    const localOverride = localStorage.getItem(`m1:popup:${id}:hours`);
    if (localOverride) {
      const parsed = parseInt(localOverride, 10);
      if (!isNaN(parsed) && parsed > 0) {
        return parsed;
      }
    }
    const envKey = `VITE_POPUP_${id.toUpperCase().replace(/-/g, "_")}_HOURS`;
    const envValue = __vite_import_meta_env__?.[envKey];
    if (envValue) {
      const parsed = parseInt(envValue, 10);
      if (!isNaN(parsed) && parsed > 0) {
        return parsed;
      }
    }
    return DEFAULT_PERIODS[id] || 24;
  } catch (error) {
    console.warn(`[PopupFrequency] Error getting period for ${id}:`, error);
    return DEFAULT_PERIODS[id] || 24;
  }
}

const STORAGE_KEY$2 = "m1:popup:stats";
const DISABLE_KEY = "m1:popup:stats:disable";
const MAX_EVENTS = 100;
let eventLog = [];
function isDisabled() {
  try {
    return localStorage.getItem(DISABLE_KEY) === "1";
  } catch {
    return false;
  }
}
function logPopupEvent(id, action, reason) {
  if (isDisabled()) return;
  try {
    const event = {
      id,
      timestamp: Date.now(),
      action,
      reason
    };
    eventLog.push(event);
    if (eventLog.length > MAX_EVENTS) {
      eventLog = eventLog.slice(-MAX_EVENTS);
    }
    const stats = getPopupStats();
    const popupStats = stats[id] || {
      id,
      shownCount: 0,
      blockedCount: 0,
      dismissedCount: 0
    };
    if (action === "shown") {
      popupStats.shownCount++;
      popupStats.lastShown = event.timestamp;
      if (!popupStats.firstSeen) {
        popupStats.firstSeen = event.timestamp;
      }
    } else if (action === "blocked") {
      popupStats.blockedCount++;
      popupStats.lastBlocked = event.timestamp;
    } else if (action === "dismissed") {
      popupStats.dismissedCount++;
    }
    stats[id] = popupStats;
    localStorage.setItem(STORAGE_KEY$2, JSON.stringify(stats));
    if (false) ;
  } catch (error) {
    console.warn("[PopupTelemetry] Error logging event:", error);
  }
}
function getPopupStats() {
  try {
    const stored = localStorage.getItem(STORAGE_KEY$2);
    return stored ? JSON.parse(stored) : {};
  } catch (error) {
    console.warn("[PopupTelemetry] Error reading stats:", error);
    return {};
  }
}
function getRecentEvents(limit = 50) {
  return eventLog.slice(-limit);
}
function exportStatsToConsole() {
  const stats = getPopupStats();
  const events = getRecentEvents();
  console.group("📊 M1SSION™ Popup Telemetry");
  console.table(Object.values(stats));
  console.log("Recent Events:", events);
  console.log("Telemetry disabled:", isDisabled());
  console.groupEnd();
}
if (typeof window !== "undefined") {
  window.m1PopupStats = exportStatsToConsole;
}

function shouldShow(id, periodHours) {
  try {
    const effectivePeriod = periodHours ?? getPopupPeriod(id);
    syncFromUserMetadata(id);
    const key = `m1:last:${id}`;
    const lastShown = localStorage.getItem(key);
    if (!lastShown) {
      logPopupEvent(id, "shown", "first-time");
      return true;
    }
    const lastTimestamp = parseInt(lastShown, 10);
    if (isNaN(lastTimestamp)) {
      logPopupEvent(id, "shown", "invalid-timestamp");
      return true;
    }
    const hoursSinceLastShow = (Date.now() - lastTimestamp) / (1e3 * 60 * 60);
    const canShow = hoursSinceLastShow >= effectivePeriod;
    if (canShow) {
      logPopupEvent(id, "shown", `period-elapsed-${hoursSinceLastShow.toFixed(1)}h`);
    } else {
      logPopupEvent(id, "blocked", `${(effectivePeriod - hoursSinceLastShow).toFixed(1)}h-remaining`);
    }
    return canShow;
  } catch (error) {
    console.warn(`[FrequencyGate] Error checking ${id}:`, error);
    logPopupEvent(id, "shown", "error-fallback");
    return true;
  }
}
function markShown(id) {
  try {
    const key = `m1:last:${id}`;
    const timestamp = Date.now().toString();
    localStorage.setItem(key, timestamp);
    syncToUserMetadata(id, parseInt(timestamp, 10)).catch(() => {
    });
  } catch (error) {
    console.warn(`[FrequencyGate] Error marking ${id}:`, error);
  }
}
async function syncToUserMetadata(id, timestamp) {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return;
    const currentMetadata = user.user_metadata || {};
    const m1PopupLastSeen = currentMetadata.m1_popup_lastSeen || {};
    if (!m1PopupLastSeen[id] || timestamp > m1PopupLastSeen[id]) {
      await supabase.auth.updateUser({
        data: {
          m1_popup_lastSeen: {
            ...m1PopupLastSeen,
            [id]: timestamp
          }
        }
      });
    }
  } catch (error) {
  }
}
function syncFromUserMetadata(id) {
  try {
    const key = `m1:last:${id}`;
    const localTimestamp = localStorage.getItem(key);
    const localValue = localTimestamp ? parseInt(localTimestamp, 10) : 0;
    supabase.auth.getUser().then(({ data: { user } }) => {
      if (!user) return;
      const m1PopupLastSeen = user.user_metadata?.m1_popup_lastSeen;
      if (!m1PopupLastSeen || !m1PopupLastSeen[id]) return;
      const remoteValue = m1PopupLastSeen[id];
      if (remoteValue > localValue) {
        localStorage.setItem(key, remoteValue.toString());
      }
    }).catch(() => {
    });
  } catch (error) {
  }
}

const XpRewardModal = ({
  open,
  onOpenChange,
  freeBuzzCredits,
  freeBuzzMapCredits,
  onRedirectToBuzz,
  onRedirectToBuzzMap
}) => {
  const canShowModal = shouldShow("xp-reward", 24);
  reactExports.useEffect(() => {
    if (open && canShowModal) {
      markShown("xp-reward");
    }
  }, [open, canShowModal]);
  const handleBuzzRedirect = () => {
    onOpenChange(false);
    onRedirectToBuzz();
  };
  const handleBuzzMapRedirect = () => {
    onOpenChange(false);
    onRedirectToBuzzMap();
  };
  if (!canShowModal) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "max-w-md mx-auto bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f172a] border border-cyan-500/20", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          initial: { scale: 0.8, opacity: 0 },
          animate: { scale: 1, opacity: 1 },
          transition: { duration: 0.5 },
          className: "flex items-center justify-center mb-4",
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Gift, { className: "w-16 h-16 text-yellow-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "absolute -top-2 -right-2 w-6 h-6 text-yellow-300" })
          ] })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-2xl font-bold gradient-text mb-2", children: "🎖️ BADGE SBLOCCATO!" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 text-sm", children: "Hai guadagnato ricompense gratuite! Clicca per riscattare." })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3 py-4", children: [
      freeBuzzCredits > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: handleBuzzRedirect,
          className: "w-full flex items-center justify-between p-4 bg-gradient-to-r from-purple-900/60 to-purple-700/60 rounded-xl border-2 border-purple-500/50 hover:border-purple-400 hover:scale-[1.02] transition-all duration-200 cursor-pointer",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-purple-600/70 rounded-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-6 h-6 text-yellow-300" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-left", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-bold text-lg text-white", children: "BUZZ Gratuito Sbloccato!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-purple-200", children: [
                  "Hai guadagnato un BUZZ gratuito (",
                  freeBuzzCredits,
                  " disponibili)"
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-3xl", children: "🎁" })
          ]
        }
      ),
      freeBuzzMapCredits > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: handleBuzzMapRedirect,
          className: "w-full flex items-center justify-between p-4 bg-gradient-to-r from-cyan-900/60 to-cyan-700/60 rounded-xl border-2 border-cyan-500/50 hover:border-cyan-400 hover:scale-[1.02] transition-all duration-200 cursor-pointer",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-cyan-600/70 rounded-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-6 h-6 text-yellow-300" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-left", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-bold text-lg text-white", children: "BUZZ MAPPA Gratuito Sbloccato!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-cyan-200", children: [
                  "Hai guadagnato un BUZZ MAPPA gratuito (",
                  freeBuzzMapCredits,
                  " disponibili)"
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-3xl", children: "🗺️" })
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center pt-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        onClick: () => onOpenChange(false),
        variant: "ghost",
        size: "sm",
        className: "text-gray-400 hover:text-gray-200",
        children: "Chiudi"
      }
    ) })
  ] }) });
};

const CreditConfirmModal = ({
  open,
  onOpenChange,
  creditType,
  onConfirm,
  onCancel
}) => {
  const creditInfo = {
    buzz: {
      icon: Zap,
      title: "Buzz Gratuito",
      description: "Utilizzare un Buzz gratuito ottenuto tramite XP?",
      color: "purple",
      gradientFrom: "from-purple-900/40",
      gradientTo: "to-purple-700/40",
      borderColor: "border-purple-500/30",
      textColor: "text-purple-200",
      buttonBg: "bg-purple-600/20",
      buttonBorder: "border-purple-500/50",
      buttonHover: "hover:bg-purple-600/40"
    },
    buzz_map: {
      icon: MapPin,
      title: "Buzz Mappa Gratuito",
      description: "Utilizzare un Buzz Mappa gratuito ottenuto tramite XP?",
      color: "cyan",
      gradientFrom: "from-cyan-900/40",
      gradientTo: "to-cyan-700/40",
      borderColor: "border-cyan-500/30",
      textColor: "text-cyan-200",
      buttonBg: "bg-cyan-600/20",
      buttonBorder: "border-cyan-500/50",
      buttonHover: "hover:bg-cyan-600/40"
    }
  };
  const currentCredit = creditType ? creditInfo[creditType] : null;
  if (!currentCredit) return null;
  const Icon = currentCredit.icon;
  const handleConfirm = () => {
    onConfirm();
    onOpenChange(false);
  };
  const handleCancel = () => {
    onCancel();
    onOpenChange(false);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "max-w-sm mx-auto bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f172a] border border-cyan-500/20", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          initial: { scale: 0.8, opacity: 0 },
          animate: { scale: 1, opacity: 1 },
          transition: { duration: 0.5 },
          className: "flex items-center justify-center mb-4",
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `p-4 bg-gradient-to-r ${currentCredit.gradientFrom} ${currentCredit.gradientTo} rounded-full border ${currentCredit.borderColor}`, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "w-12 h-12 text-white" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                animate: {
                  scale: [1, 1.3, 1],
                  rotate: [0, 180, 360]
                },
                transition: {
                  duration: 2,
                  repeat: Infinity,
                  repeatType: "loop"
                },
                className: "absolute -top-1 -right-1",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-6 h-6 text-yellow-400" })
              }
            )
          ] })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogTitle, { className: "text-xl font-bold gradient-text mb-2", children: [
        "🎁 ",
        currentCredit.title
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 text-sm", children: currentCredit.description })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { y: 20, opacity: 0 },
        animate: { y: 0, opacity: 1 },
        transition: { delay: 0.2 },
        className: `p-4 bg-gradient-to-r ${currentCredit.gradientFrom} ${currentCredit.gradientTo} rounded-lg border ${currentCredit.borderColor} mb-4`,
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `p-2 ${currentCredit.buttonBg} rounded-full`, children: /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-5 h-5 text-green-400" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: `font-semibold ${currentCredit.textColor}`, children: "Credito XP" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400", children: "Ottenuto tramite sistema XP" })
          ] })
        ] })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex space-x-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: handleCancel,
          variant: "outline",
          className: "flex-1 bg-gray-700/50 border-gray-600/50 text-gray-300 hover:bg-gray-700/80",
          children: "Annulla"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: handleConfirm,
          className: `flex-1 ${currentCredit.buttonBg} ${currentCredit.buttonBorder} ${currentCredit.textColor} ${currentCredit.buttonHover} border`,
          children: "Conferma"
        }
      )
    ] })
  ] }) });
};

const XpSystemManager = ({
  onCreditAvailable,
  onRequestCreditConsumption
}) => {
  const { xpStatus, hasNewRewards, markRewardsAsSeen, consumeCredit } = useXpSystem();
  const [, setLocation] = useLocation();
  const [rewardModalOpen, setRewardModalOpen] = reactExports.useState(false);
  const [consumedThisSession, setConsumedThisSession] = reactExports.useState(false);
  const [creditConfirmModal, setCreditConfirmModal] = reactExports.useState({
    open: false,
    type: null
  });
  reactExports.useEffect(() => {
    if (hasNewRewards && !consumedThisSession && (xpStatus.free_buzz_credit > 0 || xpStatus.free_buzz_map_credit > 0)) {
      setRewardModalOpen(true);
    }
  }, [hasNewRewards, xpStatus.free_buzz_credit, xpStatus.free_buzz_map_credit, consumedThisSession]);
  reactExports.useEffect(() => {
    if (onCreditAvailable) {
      onCreditAvailable("buzz", xpStatus.free_buzz_credit > 0);
      onCreditAvailable("buzz_map", xpStatus.free_buzz_map_credit > 0);
    }
  }, [xpStatus.free_buzz_credit, xpStatus.free_buzz_map_credit, onCreditAvailable]);
  reactExports.useEffect(() => {
  }, [onRequestCreditConsumption]);
  const handleRedirectToBuzz = () => {
    markRewardsAsSeen();
    setConsumedThisSession(true);
    setRewardModalOpen(false);
    setLocation("/buzz?free=1&reward=1");
  };
  const handleRedirectToBuzzMap = () => {
    markRewardsAsSeen();
    setConsumedThisSession(true);
    setRewardModalOpen(false);
    setLocation("/map?free=1&reward=1");
  };
  const handleCreditConfirm = async () => {
    if (creditConfirmModal.type && creditConfirmModal.resolve) {
      const success = await consumeCredit(creditConfirmModal.type);
      creditConfirmModal.resolve(success);
      setCreditConfirmModal({ open: false, type: null });
    }
  };
  const handleCreditCancel = () => {
    if (creditConfirmModal.resolve) {
      creditConfirmModal.resolve(false);
    }
    setCreditConfirmModal({ open: false, type: null });
  };
  const requestCreditConsumption = async (creditType) => {
    return new Promise((resolve) => {
      setCreditConfirmModal({
        open: true,
        type: creditType,
        resolve
      });
    });
  };
  React$1.useImperativeHandle(React$1.createRef(), () => ({
    requestCreditConsumption
  }), []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      XpRewardModal,
      {
        open: rewardModalOpen,
        onOpenChange: setRewardModalOpen,
        freeBuzzCredits: xpStatus.free_buzz_credit,
        freeBuzzMapCredits: xpStatus.free_buzz_map_credit,
        onRedirectToBuzz: handleRedirectToBuzz,
        onRedirectToBuzzMap: handleRedirectToBuzzMap
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      CreditConfirmModal,
      {
        open: creditConfirmModal.open,
        onOpenChange: (open) => !open && handleCreditCancel(),
        creditType: creditConfirmModal.type,
        onConfirm: handleCreditConfirm,
        onCancel: handleCreditCancel
      }
    )
  ] });
};

var hasElementType = typeof Element !== "undefined";
var hasMap = typeof Map === "function";
var hasSet = typeof Set === "function";
var hasArrayBuffer = typeof ArrayBuffer === "function" && !!ArrayBuffer.isView;
function equal(a, b) {
  if (a === b) return true;
  if (a && b && typeof a == "object" && typeof b == "object") {
    if (a.constructor !== b.constructor) return false;
    var length, i, keys;
    if (Array.isArray(a)) {
      length = a.length;
      if (length != b.length) return false;
      for (i = length; i-- !== 0; )
        if (!equal(a[i], b[i])) return false;
      return true;
    }
    var it;
    if (hasMap && a instanceof Map && b instanceof Map) {
      if (a.size !== b.size) return false;
      it = a.entries();
      while (!(i = it.next()).done)
        if (!b.has(i.value[0])) return false;
      it = a.entries();
      while (!(i = it.next()).done)
        if (!equal(i.value[1], b.get(i.value[0]))) return false;
      return true;
    }
    if (hasSet && a instanceof Set && b instanceof Set) {
      if (a.size !== b.size) return false;
      it = a.entries();
      while (!(i = it.next()).done)
        if (!b.has(i.value[0])) return false;
      return true;
    }
    if (hasArrayBuffer && ArrayBuffer.isView(a) && ArrayBuffer.isView(b)) {
      length = a.length;
      if (length != b.length) return false;
      for (i = length; i-- !== 0; )
        if (a[i] !== b[i]) return false;
      return true;
    }
    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;
    if (a.valueOf !== Object.prototype.valueOf && typeof a.valueOf === "function" && typeof b.valueOf === "function") return a.valueOf() === b.valueOf();
    if (a.toString !== Object.prototype.toString && typeof a.toString === "function" && typeof b.toString === "function") return a.toString() === b.toString();
    keys = Object.keys(a);
    length = keys.length;
    if (length !== Object.keys(b).length) return false;
    for (i = length; i-- !== 0; )
      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;
    if (hasElementType && a instanceof Element) return false;
    for (i = length; i-- !== 0; ) {
      if ((keys[i] === "_owner" || keys[i] === "__v" || keys[i] === "__o") && a.$$typeof) {
        continue;
      }
      if (!equal(a[keys[i]], b[keys[i]])) return false;
    }
    return true;
  }
  return a !== a && b !== b;
}
var reactFastCompare = function isEqual(a, b) {
  try {
    return equal(a, b);
  } catch (error) {
    if ((error.message || "").match(/stack|recursion/i)) {
      console.warn("react-fast-compare cannot handle circular refs");
      return false;
    }
    throw error;
  }
};

const fastCompare = /*@__PURE__*/getDefaultExportFromCjs(reactFastCompare);

var invariant = function(condition, format, a, b, c, d, e, f) {
  if (!condition) {
    var error;
    if (format === void 0) {
      error = new Error(
        "Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings."
      );
    } else {
      var args = [a, b, c, d, e, f];
      var argIndex = 0;
      error = new Error(
        format.replace(/%s/g, function() {
          return args[argIndex++];
        })
      );
      error.name = "Invariant Violation";
    }
    error.framesToPop = 1;
    throw error;
  }
};
var browser$1 = invariant;

const invariant$1 = /*@__PURE__*/getDefaultExportFromCjs(browser$1);

//

var shallowequal = function shallowEqual(objA, objB, compare, compareContext) {
  var ret = compare ? compare.call(compareContext, objA, objB) : void 0;

  if (ret !== void 0) {
    return !!ret;
  }

  if (objA === objB) {
    return true;
  }

  if (typeof objA !== "object" || !objA || typeof objB !== "object" || !objB) {
    return false;
  }

  var keysA = Object.keys(objA);
  var keysB = Object.keys(objB);

  if (keysA.length !== keysB.length) {
    return false;
  }

  var bHasOwnProperty = Object.prototype.hasOwnProperty.bind(objB);

  // Test for A's keys different from B.
  for (var idx = 0; idx < keysA.length; idx++) {
    var key = keysA[idx];

    if (!bHasOwnProperty(key)) {
      return false;
    }

    var valueA = objA[key];
    var valueB = objB[key];

    ret = compare ? compare.call(compareContext, valueA, valueB, key) : void 0;

    if (ret === false || (ret === void 0 && valueA !== valueB)) {
      return false;
    }
  }

  return true;
};

const shallowEqual = /*@__PURE__*/getDefaultExportFromCjs(shallowequal);

// src/index.tsx

// src/constants.ts
var TAG_NAMES = /* @__PURE__ */ ((TAG_NAMES2) => {
  TAG_NAMES2["BASE"] = "base";
  TAG_NAMES2["BODY"] = "body";
  TAG_NAMES2["HEAD"] = "head";
  TAG_NAMES2["HTML"] = "html";
  TAG_NAMES2["LINK"] = "link";
  TAG_NAMES2["META"] = "meta";
  TAG_NAMES2["NOSCRIPT"] = "noscript";
  TAG_NAMES2["SCRIPT"] = "script";
  TAG_NAMES2["STYLE"] = "style";
  TAG_NAMES2["TITLE"] = "title";
  TAG_NAMES2["FRAGMENT"] = "Symbol(react.fragment)";
  return TAG_NAMES2;
})(TAG_NAMES || {});
var SEO_PRIORITY_TAGS = {
  link: { rel: ["amphtml", "canonical", "alternate"] },
  script: { type: ["application/ld+json"] },
  meta: {
    charset: "",
    name: ["generator", "robots", "description"],
    property: [
      "og:type",
      "og:title",
      "og:url",
      "og:image",
      "og:image:alt",
      "og:description",
      "twitter:url",
      "twitter:title",
      "twitter:description",
      "twitter:image",
      "twitter:image:alt",
      "twitter:card",
      "twitter:site"
    ]
  }
};
var VALID_TAG_NAMES = Object.values(TAG_NAMES);
var REACT_TAG_MAP = {
  accesskey: "accessKey",
  charset: "charSet",
  class: "className",
  contenteditable: "contentEditable",
  contextmenu: "contextMenu",
  "http-equiv": "httpEquiv",
  itemprop: "itemProp",
  tabindex: "tabIndex"
};
var HTML_TAG_MAP = Object.entries(REACT_TAG_MAP).reduce(
  (carry, [key, value]) => {
    carry[value] = key;
    return carry;
  },
  {}
);
var HELMET_ATTRIBUTE = "data-rh";

// src/utils.ts
var HELMET_PROPS = {
  DEFAULT_TITLE: "defaultTitle",
  DEFER: "defer",
  ENCODE_SPECIAL_CHARACTERS: "encodeSpecialCharacters",
  ON_CHANGE_CLIENT_STATE: "onChangeClientState",
  TITLE_TEMPLATE: "titleTemplate",
  PRIORITIZE_SEO_TAGS: "prioritizeSeoTags"
};
var getInnermostProperty = (propsList, property) => {
  for (let i = propsList.length - 1; i >= 0; i -= 1) {
    const props = propsList[i];
    if (Object.prototype.hasOwnProperty.call(props, property)) {
      return props[property];
    }
  }
  return null;
};
var getTitleFromPropsList = (propsList) => {
  let innermostTitle = getInnermostProperty(propsList, "title" /* TITLE */);
  const innermostTemplate = getInnermostProperty(propsList, HELMET_PROPS.TITLE_TEMPLATE);
  if (Array.isArray(innermostTitle)) {
    innermostTitle = innermostTitle.join("");
  }
  if (innermostTemplate && innermostTitle) {
    return innermostTemplate.replace(/%s/g, () => innermostTitle);
  }
  const innermostDefaultTitle = getInnermostProperty(propsList, HELMET_PROPS.DEFAULT_TITLE);
  return innermostTitle || innermostDefaultTitle || void 0;
};
var getOnChangeClientState = (propsList) => getInnermostProperty(propsList, HELMET_PROPS.ON_CHANGE_CLIENT_STATE) || (() => {
});
var getAttributesFromPropsList = (tagType, propsList) => propsList.filter((props) => typeof props[tagType] !== "undefined").map((props) => props[tagType]).reduce((tagAttrs, current) => ({ ...tagAttrs, ...current }), {});
var getBaseTagFromPropsList = (primaryAttributes, propsList) => propsList.filter((props) => typeof props["base" /* BASE */] !== "undefined").map((props) => props["base" /* BASE */]).reverse().reduce((innermostBaseTag, tag) => {
  if (!innermostBaseTag.length) {
    const keys = Object.keys(tag);
    for (let i = 0; i < keys.length; i += 1) {
      const attributeKey = keys[i];
      const lowerCaseAttributeKey = attributeKey.toLowerCase();
      if (primaryAttributes.indexOf(lowerCaseAttributeKey) !== -1 && tag[lowerCaseAttributeKey]) {
        return innermostBaseTag.concat(tag);
      }
    }
  }
  return innermostBaseTag;
}, []);
var warn$1 = (msg) => console && typeof console.warn === "function" && console.warn(msg);
var getTagsFromPropsList = (tagName, primaryAttributes, propsList) => {
  const approvedSeenTags = {};
  return propsList.filter((props) => {
    if (Array.isArray(props[tagName])) {
      return true;
    }
    if (typeof props[tagName] !== "undefined") {
      warn$1(
        `Helmet: ${tagName} should be of type "Array". Instead found type "${typeof props[tagName]}"`
      );
    }
    return false;
  }).map((props) => props[tagName]).reverse().reduce((approvedTags, instanceTags) => {
    const instanceSeenTags = {};
    instanceTags.filter((tag) => {
      let primaryAttributeKey;
      const keys2 = Object.keys(tag);
      for (let i = 0; i < keys2.length; i += 1) {
        const attributeKey = keys2[i];
        const lowerCaseAttributeKey = attributeKey.toLowerCase();
        if (primaryAttributes.indexOf(lowerCaseAttributeKey) !== -1 && !(primaryAttributeKey === "rel" /* REL */ && tag[primaryAttributeKey].toLowerCase() === "canonical") && !(lowerCaseAttributeKey === "rel" /* REL */ && tag[lowerCaseAttributeKey].toLowerCase() === "stylesheet")) {
          primaryAttributeKey = lowerCaseAttributeKey;
        }
        if (primaryAttributes.indexOf(attributeKey) !== -1 && (attributeKey === "innerHTML" /* INNER_HTML */ || attributeKey === "cssText" /* CSS_TEXT */ || attributeKey === "itemprop" /* ITEM_PROP */)) {
          primaryAttributeKey = attributeKey;
        }
      }
      if (!primaryAttributeKey || !tag[primaryAttributeKey]) {
        return false;
      }
      const value = tag[primaryAttributeKey].toLowerCase();
      if (!approvedSeenTags[primaryAttributeKey]) {
        approvedSeenTags[primaryAttributeKey] = {};
      }
      if (!instanceSeenTags[primaryAttributeKey]) {
        instanceSeenTags[primaryAttributeKey] = {};
      }
      if (!approvedSeenTags[primaryAttributeKey][value]) {
        instanceSeenTags[primaryAttributeKey][value] = true;
        return true;
      }
      return false;
    }).reverse().forEach((tag) => approvedTags.push(tag));
    const keys = Object.keys(instanceSeenTags);
    for (let i = 0; i < keys.length; i += 1) {
      const attributeKey = keys[i];
      const tagUnion = {
        ...approvedSeenTags[attributeKey],
        ...instanceSeenTags[attributeKey]
      };
      approvedSeenTags[attributeKey] = tagUnion;
    }
    return approvedTags;
  }, []).reverse();
};
var getAnyTrueFromPropsList = (propsList, checkedTag) => {
  if (Array.isArray(propsList) && propsList.length) {
    for (let index = 0; index < propsList.length; index += 1) {
      const prop = propsList[index];
      if (prop[checkedTag]) {
        return true;
      }
    }
  }
  return false;
};
var reducePropsToState = (propsList) => ({
  baseTag: getBaseTagFromPropsList(["href" /* HREF */], propsList),
  bodyAttributes: getAttributesFromPropsList("bodyAttributes" /* BODY */, propsList),
  defer: getInnermostProperty(propsList, HELMET_PROPS.DEFER),
  encode: getInnermostProperty(propsList, HELMET_PROPS.ENCODE_SPECIAL_CHARACTERS),
  htmlAttributes: getAttributesFromPropsList("htmlAttributes" /* HTML */, propsList),
  linkTags: getTagsFromPropsList(
    "link" /* LINK */,
    ["rel" /* REL */, "href" /* HREF */],
    propsList
  ),
  metaTags: getTagsFromPropsList(
    "meta" /* META */,
    [
      "name" /* NAME */,
      "charset" /* CHARSET */,
      "http-equiv" /* HTTPEQUIV */,
      "property" /* PROPERTY */,
      "itemprop" /* ITEM_PROP */
    ],
    propsList
  ),
  noscriptTags: getTagsFromPropsList("noscript" /* NOSCRIPT */, ["innerHTML" /* INNER_HTML */], propsList),
  onChangeClientState: getOnChangeClientState(propsList),
  scriptTags: getTagsFromPropsList(
    "script" /* SCRIPT */,
    ["src" /* SRC */, "innerHTML" /* INNER_HTML */],
    propsList
  ),
  styleTags: getTagsFromPropsList("style" /* STYLE */, ["cssText" /* CSS_TEXT */], propsList),
  title: getTitleFromPropsList(propsList),
  titleAttributes: getAttributesFromPropsList("titleAttributes" /* TITLE */, propsList),
  prioritizeSeoTags: getAnyTrueFromPropsList(propsList, HELMET_PROPS.PRIORITIZE_SEO_TAGS)
});
var flattenArray = (possibleArray) => Array.isArray(possibleArray) ? possibleArray.join("") : possibleArray;
var checkIfPropsMatch = (props, toMatch) => {
  const keys = Object.keys(props);
  for (let i = 0; i < keys.length; i += 1) {
    if (toMatch[keys[i]] && toMatch[keys[i]].includes(props[keys[i]])) {
      return true;
    }
  }
  return false;
};
var prioritizer = (elementsList, propsToMatch) => {
  if (Array.isArray(elementsList)) {
    return elementsList.reduce(
      (acc, elementAttrs) => {
        if (checkIfPropsMatch(elementAttrs, propsToMatch)) {
          acc.priority.push(elementAttrs);
        } else {
          acc.default.push(elementAttrs);
        }
        return acc;
      },
      { priority: [], default: [] }
    );
  }
  return { default: elementsList, priority: [] };
};
var without = (obj, key) => {
  return {
    ...obj,
    [key]: void 0
  };
};

// src/server.ts
var SELF_CLOSING_TAGS = ["noscript" /* NOSCRIPT */, "script" /* SCRIPT */, "style" /* STYLE */];
var encodeSpecialCharacters = (str, encode = true) => {
  if (encode === false) {
    return String(str);
  }
  return String(str).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#x27;");
};
var generateElementAttributesAsString = (attributes) => Object.keys(attributes).reduce((str, key) => {
  const attr = typeof attributes[key] !== "undefined" ? `${key}="${attributes[key]}"` : `${key}`;
  return str ? `${str} ${attr}` : attr;
}, "");
var generateTitleAsString = (type, title, attributes, encode) => {
  const attributeString = generateElementAttributesAsString(attributes);
  const flattenedTitle = flattenArray(title);
  return attributeString ? `<${type} ${HELMET_ATTRIBUTE}="true" ${attributeString}>${encodeSpecialCharacters(
    flattenedTitle,
    encode
  )}</${type}>` : `<${type} ${HELMET_ATTRIBUTE}="true">${encodeSpecialCharacters(
    flattenedTitle,
    encode
  )}</${type}>`;
};
var generateTagsAsString = (type, tags, encode = true) => tags.reduce((str, t) => {
  const tag = t;
  const attributeHtml = Object.keys(tag).filter(
    (attribute) => !(attribute === "innerHTML" /* INNER_HTML */ || attribute === "cssText" /* CSS_TEXT */)
  ).reduce((string, attribute) => {
    const attr = typeof tag[attribute] === "undefined" ? attribute : `${attribute}="${encodeSpecialCharacters(tag[attribute], encode)}"`;
    return string ? `${string} ${attr}` : attr;
  }, "");
  const tagContent = tag.innerHTML || tag.cssText || "";
  const isSelfClosing = SELF_CLOSING_TAGS.indexOf(type) === -1;
  return `${str}<${type} ${HELMET_ATTRIBUTE}="true" ${attributeHtml}${isSelfClosing ? `/>` : `>${tagContent}</${type}>`}`;
}, "");
var convertElementAttributesToReactProps = (attributes, initProps = {}) => Object.keys(attributes).reduce((obj, key) => {
  const mapped = REACT_TAG_MAP[key];
  obj[mapped || key] = attributes[key];
  return obj;
}, initProps);
var generateTitleAsReactComponent = (_type, title, attributes) => {
  const initProps = {
    key: title,
    [HELMET_ATTRIBUTE]: true
  };
  const props = convertElementAttributesToReactProps(attributes, initProps);
  return [React$1.createElement("title" /* TITLE */, props, title)];
};
var generateTagsAsReactComponent = (type, tags) => tags.map((tag, i) => {
  const mappedTag = {
    key: i,
    [HELMET_ATTRIBUTE]: true
  };
  Object.keys(tag).forEach((attribute) => {
    const mapped = REACT_TAG_MAP[attribute];
    const mappedAttribute = mapped || attribute;
    if (mappedAttribute === "innerHTML" /* INNER_HTML */ || mappedAttribute === "cssText" /* CSS_TEXT */) {
      const content = tag.innerHTML || tag.cssText;
      mappedTag.dangerouslySetInnerHTML = { __html: content };
    } else {
      mappedTag[mappedAttribute] = tag[attribute];
    }
  });
  return React$1.createElement(type, mappedTag);
});
var getMethodsForTag = (type, tags, encode = true) => {
  switch (type) {
    case "title" /* TITLE */:
      return {
        toComponent: () => generateTitleAsReactComponent(type, tags.title, tags.titleAttributes),
        toString: () => generateTitleAsString(type, tags.title, tags.titleAttributes, encode)
      };
    case "bodyAttributes" /* BODY */:
    case "htmlAttributes" /* HTML */:
      return {
        toComponent: () => convertElementAttributesToReactProps(tags),
        toString: () => generateElementAttributesAsString(tags)
      };
    default:
      return {
        toComponent: () => generateTagsAsReactComponent(type, tags),
        toString: () => generateTagsAsString(type, tags, encode)
      };
  }
};
var getPriorityMethods = ({ metaTags, linkTags, scriptTags, encode }) => {
  const meta = prioritizer(metaTags, SEO_PRIORITY_TAGS.meta);
  const link = prioritizer(linkTags, SEO_PRIORITY_TAGS.link);
  const script = prioritizer(scriptTags, SEO_PRIORITY_TAGS.script);
  const priorityMethods = {
    toComponent: () => [
      ...generateTagsAsReactComponent("meta" /* META */, meta.priority),
      ...generateTagsAsReactComponent("link" /* LINK */, link.priority),
      ...generateTagsAsReactComponent("script" /* SCRIPT */, script.priority)
    ],
    toString: () => (
      // generate all the tags as strings and concatenate them
      `${getMethodsForTag("meta" /* META */, meta.priority, encode)} ${getMethodsForTag(
        "link" /* LINK */,
        link.priority,
        encode
      )} ${getMethodsForTag("script" /* SCRIPT */, script.priority, encode)}`
    )
  };
  return {
    priorityMethods,
    metaTags: meta.default,
    linkTags: link.default,
    scriptTags: script.default
  };
};
var mapStateOnServer = (props) => {
  const {
    baseTag,
    bodyAttributes,
    encode = true,
    htmlAttributes,
    noscriptTags,
    styleTags,
    title = "",
    titleAttributes,
    prioritizeSeoTags
  } = props;
  let { linkTags, metaTags, scriptTags } = props;
  let priorityMethods = {
    toComponent: () => {
    },
    toString: () => ""
  };
  if (prioritizeSeoTags) {
    ({ priorityMethods, linkTags, metaTags, scriptTags } = getPriorityMethods(props));
  }
  return {
    priority: priorityMethods,
    base: getMethodsForTag("base" /* BASE */, baseTag, encode),
    bodyAttributes: getMethodsForTag("bodyAttributes" /* BODY */, bodyAttributes, encode),
    htmlAttributes: getMethodsForTag("htmlAttributes" /* HTML */, htmlAttributes, encode),
    link: getMethodsForTag("link" /* LINK */, linkTags, encode),
    meta: getMethodsForTag("meta" /* META */, metaTags, encode),
    noscript: getMethodsForTag("noscript" /* NOSCRIPT */, noscriptTags, encode),
    script: getMethodsForTag("script" /* SCRIPT */, scriptTags, encode),
    style: getMethodsForTag("style" /* STYLE */, styleTags, encode),
    title: getMethodsForTag("title" /* TITLE */, { title, titleAttributes }, encode)
  };
};
var server_default = mapStateOnServer;

// src/HelmetData.ts
var instances = [];
var isDocument = !!(typeof window !== "undefined" && window.document && window.document.createElement);
var HelmetData = class {
  instances = [];
  canUseDOM = isDocument;
  context;
  value = {
    setHelmet: (serverState) => {
      this.context.helmet = serverState;
    },
    helmetInstances: {
      get: () => this.canUseDOM ? instances : this.instances,
      add: (instance) => {
        (this.canUseDOM ? instances : this.instances).push(instance);
      },
      remove: (instance) => {
        const index = (this.canUseDOM ? instances : this.instances).indexOf(instance);
        (this.canUseDOM ? instances : this.instances).splice(index, 1);
      }
    }
  };
  constructor(context, canUseDOM) {
    this.context = context;
    this.canUseDOM = canUseDOM || false;
    if (!canUseDOM) {
      context.helmet = server_default({
        baseTag: [],
        bodyAttributes: {},
        htmlAttributes: {},
        linkTags: [],
        metaTags: [],
        noscriptTags: [],
        scriptTags: [],
        styleTags: [],
        title: "",
        titleAttributes: {}
      });
    }
  }
};

// src/Provider.tsx
var defaultValue = {};
var Context$1 = React$1.createContext(defaultValue);
var HelmetProvider$1 = class _HelmetProvider extends reactExports.Component {
  static canUseDOM = isDocument;
  helmetData;
  constructor(props) {
    super(props);
    this.helmetData = new HelmetData(this.props.context || {}, _HelmetProvider.canUseDOM);
  }
  render() {
    return /* @__PURE__ */ React$1.createElement(Context$1.Provider, { value: this.helmetData.value }, this.props.children);
  }
};

// src/client.ts
var updateTags = (type, tags) => {
  const headElement = document.head || document.querySelector("head" /* HEAD */);
  const tagNodes = headElement.querySelectorAll(`${type}[${HELMET_ATTRIBUTE}]`);
  const oldTags = [].slice.call(tagNodes);
  const newTags = [];
  let indexToDelete;
  if (tags && tags.length) {
    tags.forEach((tag) => {
      const newElement = document.createElement(type);
      for (const attribute in tag) {
        if (Object.prototype.hasOwnProperty.call(tag, attribute)) {
          if (attribute === "innerHTML" /* INNER_HTML */) {
            newElement.innerHTML = tag.innerHTML;
          } else if (attribute === "cssText" /* CSS_TEXT */) {
            if (newElement.styleSheet) {
              newElement.styleSheet.cssText = tag.cssText;
            } else {
              newElement.appendChild(document.createTextNode(tag.cssText));
            }
          } else {
            const attr = attribute;
            const value = typeof tag[attr] === "undefined" ? "" : tag[attr];
            newElement.setAttribute(attribute, value);
          }
        }
      }
      newElement.setAttribute(HELMET_ATTRIBUTE, "true");
      if (oldTags.some((existingTag, index) => {
        indexToDelete = index;
        return newElement.isEqualNode(existingTag);
      })) {
        oldTags.splice(indexToDelete, 1);
      } else {
        newTags.push(newElement);
      }
    });
  }
  oldTags.forEach((tag) => tag.parentNode?.removeChild(tag));
  newTags.forEach((tag) => headElement.appendChild(tag));
  return {
    oldTags,
    newTags
  };
};
var updateAttributes = (tagName, attributes) => {
  const elementTag = document.getElementsByTagName(tagName)[0];
  if (!elementTag) {
    return;
  }
  const helmetAttributeString = elementTag.getAttribute(HELMET_ATTRIBUTE);
  const helmetAttributes = helmetAttributeString ? helmetAttributeString.split(",") : [];
  const attributesToRemove = [...helmetAttributes];
  const attributeKeys = Object.keys(attributes);
  for (const attribute of attributeKeys) {
    const value = attributes[attribute] || "";
    if (elementTag.getAttribute(attribute) !== value) {
      elementTag.setAttribute(attribute, value);
    }
    if (helmetAttributes.indexOf(attribute) === -1) {
      helmetAttributes.push(attribute);
    }
    const indexToSave = attributesToRemove.indexOf(attribute);
    if (indexToSave !== -1) {
      attributesToRemove.splice(indexToSave, 1);
    }
  }
  for (let i = attributesToRemove.length - 1; i >= 0; i -= 1) {
    elementTag.removeAttribute(attributesToRemove[i]);
  }
  if (helmetAttributes.length === attributesToRemove.length) {
    elementTag.removeAttribute(HELMET_ATTRIBUTE);
  } else if (elementTag.getAttribute(HELMET_ATTRIBUTE) !== attributeKeys.join(",")) {
    elementTag.setAttribute(HELMET_ATTRIBUTE, attributeKeys.join(","));
  }
};
var updateTitle = (title, attributes) => {
  if (typeof title !== "undefined" && document.title !== title) {
    document.title = flattenArray(title);
  }
  updateAttributes("title" /* TITLE */, attributes);
};
var commitTagChanges = (newState, cb) => {
  const {
    baseTag,
    bodyAttributes,
    htmlAttributes,
    linkTags,
    metaTags,
    noscriptTags,
    onChangeClientState,
    scriptTags,
    styleTags,
    title,
    titleAttributes
  } = newState;
  updateAttributes("body" /* BODY */, bodyAttributes);
  updateAttributes("html" /* HTML */, htmlAttributes);
  updateTitle(title, titleAttributes);
  const tagUpdates = {
    baseTag: updateTags("base" /* BASE */, baseTag),
    linkTags: updateTags("link" /* LINK */, linkTags),
    metaTags: updateTags("meta" /* META */, metaTags),
    noscriptTags: updateTags("noscript" /* NOSCRIPT */, noscriptTags),
    scriptTags: updateTags("script" /* SCRIPT */, scriptTags),
    styleTags: updateTags("style" /* STYLE */, styleTags)
  };
  const addedTags = {};
  const removedTags = {};
  Object.keys(tagUpdates).forEach((tagType) => {
    const { newTags, oldTags } = tagUpdates[tagType];
    if (newTags.length) {
      addedTags[tagType] = newTags;
    }
    if (oldTags.length) {
      removedTags[tagType] = tagUpdates[tagType].oldTags;
    }
  });
  if (cb) {
    cb();
  }
  onChangeClientState(newState, addedTags, removedTags);
};
var _helmetCallback = null;
var handleStateChangeOnClient = (newState) => {
  if (_helmetCallback) {
    cancelAnimationFrame(_helmetCallback);
  }
  if (newState.defer) {
    _helmetCallback = requestAnimationFrame(() => {
      commitTagChanges(newState, () => {
        _helmetCallback = null;
      });
    });
  } else {
    commitTagChanges(newState);
    _helmetCallback = null;
  }
};
var client_default = handleStateChangeOnClient;

// src/Dispatcher.tsx
var HelmetDispatcher = class extends reactExports.Component {
  rendered = false;
  shouldComponentUpdate(nextProps) {
    return !shallowEqual(nextProps, this.props);
  }
  componentDidUpdate() {
    this.emitChange();
  }
  componentWillUnmount() {
    const { helmetInstances } = this.props.context;
    helmetInstances.remove(this);
    this.emitChange();
  }
  emitChange() {
    const { helmetInstances, setHelmet } = this.props.context;
    let serverState = null;
    const state = reducePropsToState(
      helmetInstances.get().map((instance) => {
        const props = { ...instance.props };
        delete props.context;
        return props;
      })
    );
    if (HelmetProvider$1.canUseDOM) {
      client_default(state);
    } else if (server_default) {
      serverState = server_default(state);
    }
    setHelmet(serverState);
  }
  // componentWillMount will be deprecated
  // for SSR, initialize on first render
  // constructor is also unsafe in StrictMode
  init() {
    if (this.rendered) {
      return;
    }
    this.rendered = true;
    const { helmetInstances } = this.props.context;
    helmetInstances.add(this);
    this.emitChange();
  }
  render() {
    this.init();
    return null;
  }
};

// src/index.tsx
var Helmet = class extends reactExports.Component {
  static defaultProps = {
    defer: true,
    encodeSpecialCharacters: true,
    prioritizeSeoTags: false
  };
  shouldComponentUpdate(nextProps) {
    return !fastCompare(without(this.props, "helmetData"), without(nextProps, "helmetData"));
  }
  mapNestedChildrenToProps(child, nestedChildren) {
    if (!nestedChildren) {
      return null;
    }
    switch (child.type) {
      case "script" /* SCRIPT */:
      case "noscript" /* NOSCRIPT */:
        return {
          innerHTML: nestedChildren
        };
      case "style" /* STYLE */:
        return {
          cssText: nestedChildren
        };
      default:
        throw new Error(
          `<${child.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`
        );
    }
  }
  flattenArrayTypeChildren(child, arrayTypeChildren, newChildProps, nestedChildren) {
    return {
      ...arrayTypeChildren,
      [child.type]: [
        ...arrayTypeChildren[child.type] || [],
        {
          ...newChildProps,
          ...this.mapNestedChildrenToProps(child, nestedChildren)
        }
      ]
    };
  }
  mapObjectTypeChildren(child, newProps, newChildProps, nestedChildren) {
    switch (child.type) {
      case "title" /* TITLE */:
        return {
          ...newProps,
          [child.type]: nestedChildren,
          titleAttributes: { ...newChildProps }
        };
      case "body" /* BODY */:
        return {
          ...newProps,
          bodyAttributes: { ...newChildProps }
        };
      case "html" /* HTML */:
        return {
          ...newProps,
          htmlAttributes: { ...newChildProps }
        };
      default:
        return {
          ...newProps,
          [child.type]: { ...newChildProps }
        };
    }
  }
  mapArrayTypeChildrenToProps(arrayTypeChildren, newProps) {
    let newFlattenedProps = { ...newProps };
    Object.keys(arrayTypeChildren).forEach((arrayChildName) => {
      newFlattenedProps = {
        ...newFlattenedProps,
        [arrayChildName]: arrayTypeChildren[arrayChildName]
      };
    });
    return newFlattenedProps;
  }
  warnOnInvalidChildren(child, nestedChildren) {
    invariant$1(
      VALID_TAG_NAMES.some((name) => child.type === name),
      typeof child.type === "function" ? `You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.` : `Only elements types ${VALID_TAG_NAMES.join(
        ", "
      )} are allowed. Helmet does not support rendering <${child.type}> elements. Refer to our API for more information.`
    );
    invariant$1(
      !nestedChildren || typeof nestedChildren === "string" || Array.isArray(nestedChildren) && !nestedChildren.some((nestedChild) => typeof nestedChild !== "string"),
      `Helmet expects a string as a child of <${child.type}>. Did you forget to wrap your children in braces? ( <${child.type}>{\`\`}</${child.type}> ) Refer to our API for more information.`
    );
    return true;
  }
  mapChildrenToProps(children, newProps) {
    let arrayTypeChildren = {};
    React$1.Children.forEach(children, (child) => {
      if (!child || !child.props) {
        return;
      }
      const { children: nestedChildren, ...childProps } = child.props;
      const newChildProps = Object.keys(childProps).reduce((obj, key) => {
        obj[HTML_TAG_MAP[key] || key] = childProps[key];
        return obj;
      }, {});
      let { type } = child;
      if (typeof type === "symbol") {
        type = type.toString();
      } else {
        this.warnOnInvalidChildren(child, nestedChildren);
      }
      switch (type) {
        case "Symbol(react.fragment)" /* FRAGMENT */:
          newProps = this.mapChildrenToProps(nestedChildren, newProps);
          break;
        case "link" /* LINK */:
        case "meta" /* META */:
        case "noscript" /* NOSCRIPT */:
        case "script" /* SCRIPT */:
        case "style" /* STYLE */:
          arrayTypeChildren = this.flattenArrayTypeChildren(
            child,
            arrayTypeChildren,
            newChildProps,
            nestedChildren
          );
          break;
        default:
          newProps = this.mapObjectTypeChildren(child, newProps, newChildProps, nestedChildren);
          break;
      }
    });
    return this.mapArrayTypeChildrenToProps(arrayTypeChildren, newProps);
  }
  render() {
    const { children, ...props } = this.props;
    let newProps = { ...props };
    let { helmetData } = props;
    if (children) {
      newProps = this.mapChildrenToProps(children, newProps);
    }
    if (helmetData && !(helmetData instanceof HelmetData)) {
      const data = helmetData;
      helmetData = new HelmetData(data.context, true);
      delete newProps.helmetData;
    }
    return helmetData ? /* @__PURE__ */ React$1.createElement(HelmetDispatcher, { ...newProps, context: helmetData.value }) : /* @__PURE__ */ React$1.createElement(Context$1.Consumer, null, (context) => /* @__PURE__ */ React$1.createElement(HelmetDispatcher, { ...newProps, context }));
  }
};

const HelmetProvider = ({ children }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(HelmetProvider$1, { children });
};

const SkipToContent = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "a",
    {
      href: "#main-content",
      className: "sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-foreground focus:rounded-md focus:shadow-lg",
      tabIndex: 0,
      children: "Vai al contenuto principale"
    }
  );
};

const OfflineIndicator = () => {
  const [isOnline, setIsOnline] = reactExports.useState(navigator.onLine);
  const [showIndicator, setShowIndicator] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const handleOnline = () => {
      setIsOnline(true);
      setShowIndicator(true);
      setTimeout(() => setShowIndicator(false), 3e3);
    };
    const handleOffline = () => {
      setIsOnline(false);
      setShowIndicator(true);
    };
    window.addEventListener("online", handleOnline);
    window.addEventListener("offline", handleOffline);
    if (!navigator.onLine) {
      setShowIndicator(true);
    }
    return () => {
      window.removeEventListener("online", handleOnline);
      window.removeEventListener("offline", handleOffline);
    };
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showIndicator && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { y: -100, opacity: 0 },
      animate: { y: 0, opacity: 1 },
      exit: { y: -100, opacity: 0 },
      className: `fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 ${isOnline ? "bg-green-600 text-white" : "bg-red-600 text-white"}`,
      role: "alert",
      "aria-live": "polite",
      children: isOnline ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Wifi, { size: 16 }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Connesso" })
      ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(WifiOff, { size: 16 }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Nessuna connessione" })
      ] })
    }
  ) });
};

const log$1 = (message, data) => {
};
const useUnifiedAuth = () => {
  const context = reactExports.useContext(AuthContext);
  if (context === void 0) {
    throw new Error("useUnifiedAuth deve essere usato all'interno di un AuthProvider");
  }
  log$1("Hook accessed", {
    isAuthenticated: context.isAuthenticated,
    isLoading: context.isLoading,
    userEmail: context.getCurrentUser()?.email,
    hasSession: !!context.session
  });
  return context;
};

const useAccessControl = () => {
  const { isAuthenticated, getCurrentUser } = useUnifiedAuth();
  const [state, setState] = reactExports.useState({
    canAccess: false,
    isLoading: true,
    accessStartDate: null,
    subscriptionPlan: "",
    status: "registered_pending",
    timeUntilAccess: null
  });
  reactExports.useEffect(() => {
    const user = getCurrentUser();
    if (user?.email === "wikus77@hotmail.it") {
      console.log("🚀 useAccessControl - EMERGENCY ADMIN BYPASS");
      setState({
        canAccess: true,
        isLoading: false,
        accessStartDate: /* @__PURE__ */ new Date(),
        subscriptionPlan: "ADMIN",
        status: "admin_emergency_access",
        timeUntilAccess: null
      });
      return;
    }
    if (!isAuthenticated) {
      setState((prev) => ({ ...prev, isLoading: false, canAccess: false }));
      return;
    }
    const checkAccess = async () => {
      try {
        const user2 = getCurrentUser();
        if (!user2) return;
        const { data: userProfile, error: fetchError } = await supabase.from("profiles").select("id, role, created_at").eq("id", user2.id).single();
        if (fetchError) {
          console.error("Error fetching profile:", fetchError);
          return;
        }
        if (userProfile?.role === "admin") {
          setState({
            canAccess: true,
            isLoading: false,
            accessStartDate: /* @__PURE__ */ new Date(),
            subscriptionPlan: "ADMIN",
            status: "admin_access",
            timeUntilAccess: null
          });
          return;
        }
        setState({
          canAccess: true,
          isLoading: false,
          accessStartDate: /* @__PURE__ */ new Date(),
          subscriptionPlan: "free",
          status: "active",
          timeUntilAccess: null
        });
      } catch (error) {
        console.error("Access control error:", error);
        setState((prev) => ({ ...prev, isLoading: false }));
      }
    };
    checkAccess();
  }, [isAuthenticated, getCurrentUser]);
  return state;
};

const useWouterNavigation = () => {
  const [location, setLocation] = useLocation();
  const isCapacitor = typeof window !== "undefined" && (window.location.protocol === "capacitor:" || !!window.Capacitor);
  const navigate = reactExports.useCallback((path, options) => {
    console.log("🧭 Wouter Navigation:", { from: location, to: path });
    setLocation(path, { replace: options?.replace });
    if (isCapacitor) {
      setTimeout(() => {
        window.scrollTo(0, 0);
      }, 100);
    }
  }, [location, setLocation, isCapacitor]);
  const goBack = reactExports.useCallback(() => {
    if (typeof window !== "undefined" && window.history.length > 1) {
      window.history.back();
    } else {
      setLocation("/home");
    }
  }, [setLocation]);
  const toHome = reactExports.useCallback(() => navigate("/home"), [navigate]);
  const toMap = reactExports.useCallback(() => navigate("/map-3d-tiler"), [navigate]);
  const toBuzz = reactExports.useCallback(() => navigate("/buzz"), [navigate]);
  const toIntelligence = reactExports.useCallback(() => navigate("/intelligence"), [navigate]);
  const toNotifications = reactExports.useCallback(() => navigate("/notifications"), [navigate]);
  const toLeaderboard = reactExports.useCallback(() => navigate("/leaderboard"), [navigate]);
  const toProfile = reactExports.useCallback(() => navigate("/profile"), [navigate]);
  const toSettings = reactExports.useCallback(() => navigate("/settings"), [navigate]);
  const toSubscriptions = reactExports.useCallback(() => navigate("/subscriptions"), [navigate]);
  const toLogin = reactExports.useCallback(() => navigate("/login"), [navigate]);
  const toRegister = reactExports.useCallback(() => navigate("/register"), [navigate]);
  return {
    navigate,
    goBack,
    toHome,
    toMap,
    toBuzz,
    toIntelligence,
    toNotifications,
    toLeaderboard,
    toProfile,
    toSettings,
    toSubscriptions,
    toLogin,
    toRegister,
    currentPath: location,
    isCapacitor
  };
};

const v$1 = "5.7.1";
const fr$1 = 30;
const ip = 0;
const op = 90;
const w$1 = 400;
const h$1 = 400;
const nm = "M1SSION Logo Animation";
const ddd = 0;
const assets = [
];
const layers = [
	{
		ddd: 0,
		ind: 1,
		ty: 4,
		nm: "Logo Text",
		sr: 1,
		ks: {
			o: {
				a: 1,
				k: [
					{
						i: {
							x: [
								0.833
							],
							y: [
								0.833
							]
						},
						o: {
							x: [
								0.167
							],
							y: [
								0.167
							]
						},
						t: 0,
						s: [
							100
						]
					},
					{
						t: 45,
						s: [
							60
						]
					},
					{
						t: 90,
						s: [
							100
						]
					}
				]
			},
			p: {
				a: 0,
				k: [
					200,
					200,
					0
				]
			},
			a: {
				a: 0,
				k: [
					0,
					0,
					0
				]
			},
			s: {
				a: 0,
				k: [
					100,
					100,
					100
				]
			}
		},
		ao: 0,
		shapes: [
			{
				ty: "gr",
				it: [
					{
						ind: 0,
						ty: "sh",
						ix: 1,
						ks: {
							a: 0,
							k: {
								i: [
								],
								o: [
								],
								v: [
									[
										-100,
										-20
									],
									[
										-80,
										-20
									],
									[
										-60,
										20
									],
									[
										-40,
										-20
									],
									[
										-20,
										20
									],
									[
										0,
										-20
									],
									[
										20,
										-20
									],
									[
										20,
										20
									],
									[
										40,
										20
									],
									[
										40,
										-20
									],
									[
										60,
										-20
									],
									[
										60,
										20
									],
									[
										80,
										20
									],
									[
										100,
										-20
									]
								],
								c: false
							}
						},
						nm: "M1SSION Path"
					},
					{
						ty: "st",
						c: {
							a: 1,
							k: [
								{
									t: 0,
									s: [
										0,
										0.64,
										1,
										1
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 30,
									s: [
										0.36,
										0.22,
										0.98,
										1
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 60,
									s: [
										0.95,
										0.28,
										0.75,
										1
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 90,
									s: [
										0,
										0.64,
										1,
										1
									]
								}
							]
						},
						o: {
							a: 0,
							k: 100
						},
						w: {
							a: 0,
							k: 8
						},
						lc: 2,
						lj: 2
					},
					{
						ty: "gf",
						o: {
							a: 0,
							k: 60
						},
						r: 1,
						g: {
							p: 3,
							k: {
								a: 0,
								k: [
									0,
									0,
									0.64,
									1,
									0.5,
									0.36,
									0.22,
									0.98,
									1,
									0.95,
									0.28,
									0.75
								]
							}
						},
						s: {
							a: 0,
							k: [
								-100,
								0
							]
						},
						e: {
							a: 0,
							k: [
								100,
								0
							]
						}
					}
				],
				nm: "M1SSION"
			}
		],
		ef: [
			{
				ty: 29,
				nm: "Glow",
				ix: 1,
				en: 1,
				ef: [
					{
						ty: 7,
						nm: "Glow Based On",
						ix: 1,
						v: {
							a: 0,
							k: 2
						}
					},
					{
						ty: 0,
						nm: "Glow Threshold",
						ix: 2,
						v: {
							a: 0,
							k: 128
						}
					},
					{
						ty: 0,
						nm: "Glow Radius",
						ix: 3,
						v: {
							a: 1,
							k: [
								{
									t: 0,
									s: [
										10
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 45,
									s: [
										15
									]
								},
								{
									t: 90,
									s: [
										10
									]
								}
							]
						}
					},
					{
						ty: 0,
						nm: "Glow Intensity",
						ix: 4,
						v: {
							a: 0,
							k: 1
						}
					},
					{
						ty: 2,
						nm: "Glow Color",
						ix: 5,
						v: {
							a: 1,
							k: [
								{
									t: 0,
									s: [
										0,
										0.64,
										1,
										1
									],
									i: {
										x: [
											0.833
										],
										y: [
											0.833
										]
									},
									o: {
										x: [
											0.167
										],
										y: [
											0.167
										]
									}
								},
								{
									t: 45,
									s: [
										0.36,
										0.22,
										0.98,
										1
									]
								},
								{
									t: 90,
									s: [
										0,
										0.64,
										1,
										1
									]
								}
							]
						}
					}
				]
			}
		]
	}
];
const neonLogoAnimation = {
	v: v$1,
	fr: fr$1,
	ip: ip,
	op: op,
	w: w$1,
	h: h$1,
	nm: nm,
	ddd: ddd,
	assets: assets,
	layers: layers
};

const AnimatedLogo = () => {
  const options = {
    animationData: neonLogoAnimation,
    loop: true,
    autoplay: true,
    rendererSettings: {
      preserveAspectRatio: "xMidYMid meet",
      className: "lottie-svg-class"
    }
  };
  const { View } = useLottie(options);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative w-32 h-10 flex items-center justify-center", children: [
    View,
    /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "absolute text-2xl font-bold select-none drop-shadow-[0_1.5px_12px_rgba(0,229,255,0.51)] whitespace-nowrap", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF] font-extrabold", children: "M1" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-extrabold", children: "SSION" })
    ] })
  ] });
};

const Label$1 = reactExports.forwardRef(
  ({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    "label",
    {
      ref,
      className: cn(
        "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",
        className
      ),
      ...props
    }
  )
);
Label$1.displayName = "Label";

const Input = reactExports.forwardRef(
  ({ className, type, ...props }, ref) => {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      "input",
      {
        type,
        className: cn(
          "flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",
          className
        ),
        ref,
        ...props
      }
    );
  }
);
Input.displayName = "Input";

const FormField = ({
  id,
  type,
  label,
  placeholder = "",
  value,
  onChange,
  icon,
  error,
  required = false,
  disabled = false,
  autoComplete = "off"
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: id, className: "text-white", children: label }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
      icon && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute left-3 top-1/2 -translate-y-1/2 text-white/50", children: icon }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          id,
          type,
          placeholder,
          value,
          onChange,
          className: `bg-black/50 border-white/10 text-white ${icon ? "pl-10" : "pl-3"}`,
          required,
          disabled,
          autoComplete,
          autoCorrect: "off",
          spellCheck: false,
          "data-form-type": "other"
        }
      )
    ] }),
    error && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-500 text-xs mt-1", children: error })
  ] });
};

function StandardLoginForm({ verificationStatus }) {
  const [email, setEmail] = reactExports.useState("");
  const [password, setPassword] = reactExports.useState("");
  const [showPassword, setShowPassword] = reactExports.useState(false);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const { navigate } = useWouterNavigation();
  const { login } = useAuthContext();
  const sanitizeEmail = (email2) => {
    return email2.toLowerCase().trim().replace(/[^\w@.-]/g, "");
  };
  const handleSubmit = async (e) => {
    e.preventDefault();
    const cleanEmail = sanitizeEmail(email);
    const cleanPassword = password.trim();
    if (!cleanEmail || !cleanPassword) {
      ue$1.error("Tutti i campi sono obbligatori");
      return;
    }
    if (!/\S+@\S+\.\S+/.test(cleanEmail)) {
      ue$1.error("Formato email non valido");
      return;
    }
    setIsLoading(true);
    try {
      if (false) ;
      const result = await login(cleanEmail, cleanPassword);
      if (!result.success) {
        console.error("❌ LOGIN ERROR via DIRECT AuthContext:", result.error);
        ue$1.error("Errore di login", {
          description: result.error?.message || "Credenziali non valide"
        });
        return;
      }
      console.log("✅ LOGIN SUCCESS via DIRECT AuthContext - Emitting auth-success event");
      ue$1.success("Login effettuato con successo", {
        description: "Benvenuto in M1SSION™!"
      });
      window.dispatchEvent(new CustomEvent("auth-success", {
        detail: { email, timestamp: Date.now() }
      }));
      const params = new URLSearchParams(window.location.search);
      const qRedirect = params.get("redirect");
      let target = qRedirect || "";
      if (!target) {
        try {
          target = localStorage.getItem("post_login_redirect") || "";
          if (target) localStorage.removeItem("post_login_redirect");
        } catch {
        }
      }
      const finalTarget = target || "/mission-intro";
      console.log("🚀 [StandardLoginForm] REDIRECTING TO:", finalTarget);
      if (!target) {
        sessionStorage.removeItem("hasSeenPostLoginIntro");
      }
      navigate(finalTarget);
      if (window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true) {
        console.log("📱 PWA DETECTED - Setting up fallback redirect to:", finalTarget);
        setTimeout(() => {
          if (window.location.pathname === "/login") {
            console.log("🔄 PRIMARY REDIRECT FAILED - Using window.location.href to:", finalTarget);
            window.location.href = finalTarget;
          }
        }, 800);
      }
    } catch (error) {
      console.error("💥 LOGIN EXCEPTION:", error);
      ue$1.error("Errore di sistema", {
        description: error.message || "Si è verificato un errore imprevisto"
      });
    } finally {
      setIsLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "email",
        label: "Email",
        type: "email",
        placeholder: "Inserisci la tua email",
        value: email,
        onChange: (e) => setEmail(e.target.value),
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "h-4 w-4" }),
        required: true,
        disabled: isLoading,
        autoComplete: "email"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        FormField,
        {
          id: "password",
          label: "Password",
          type: showPassword ? "text" : "password",
          placeholder: "Inserisci la password",
          value: password,
          onChange: (e) => setPassword(e.target.value),
          icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "h-4 w-4" }),
          required: true,
          disabled: isLoading,
          autoComplete: "current-password"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          type: "button",
          className: "flex items-center gap-2 text-sm text-white/70 hover:text-white transition-colors",
          onClick: () => setShowPassword(!showPassword),
          children: [
            showPassword ? /* @__PURE__ */ jsxRuntimeExports.jsx(EyeOff, { className: "h-4 w-4" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "h-4 w-4" }),
            showPassword ? "Nascondi password" : "Mostra password"
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          type: "submit",
          className: "w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 font-bold text-lg py-3 rounded-xl neon-button-cyan",
          disabled: isLoading,
          children: isLoading ? "Caricamento..." : "Accedi"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          type: "button",
          onClick: () => navigate("/register"),
          className: "w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 font-bold text-lg py-3 rounded-xl transition-all duration-300",
          disabled: isLoading,
          children: "Registrati - Accesso limitato"
        }
      )
    ] })
  ] });
}

const BackgroundParticles = ({ count = 15 }) => {
  const [particles, setParticles] = reactExports.useState([]);
  reactExports.useEffect(() => {
    const generatedParticles = Array.from({ length: count }, (_, i) => ({
      id: i,
      size: Math.random() * 4 + 2,
      top: Math.random() * 100,
      left: Math.random() * 100,
      delay: Math.random() * 5,
      duration: Math.random() * 15 + 10,
      color: i % 3 === 0 ? "#00E5FF" : i % 3 === 1 ? "#FFC300" : "#FF00FF",
      parallaxSpeed: Math.random() * 0.3 + 0.1,
      blur: Math.random() * 2 + 1
    }));
    setParticles(generatedParticles);
  }, [count]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 z-0 pointer-events-none overflow-hidden", children: particles.map((particle) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      className: "absolute rounded-full",
      style: {
        width: `${particle.size}px`,
        height: `${particle.size}px`,
        backgroundColor: particle.color,
        boxShadow: `0 0 ${particle.size + 4}px ${particle.color}`,
        filter: `blur(${particle.blur}px)`,
        top: `${particle.top}%`,
        left: `${particle.left}%`
      },
      animate: {
        y: [0, -30, 0, 30, 0],
        x: [0, 15, 30, 15, 0],
        opacity: [0.4, 0.8, 0.6, 0.9, 0.4]
      },
      transition: {
        duration: particle.duration,
        ease: "easeInOut",
        times: [0, 0.2, 0.5, 0.8, 1],
        repeat: Infinity,
        delay: particle.delay
      },
      "data-parallax": "background",
      "data-parallax-speed": -particle.parallaxSpeed
    },
    particle.id
  )) });
};

const AdminEmergencyLogin = ({ onClose }) => {
  const [isLogging, setIsLogging] = reactExports.useState(false);
  const { login } = useUnifiedAuth();
  useWouterNavigation();
  reactExports.useEffect(() => {
    const handleKeyPress = (e) => {
      if (e.key === "Escape" && onClose) {
        onClose();
      }
    };
    document.addEventListener("keydown", handleKeyPress);
    return () => document.removeEventListener("keydown", handleKeyPress);
  }, [onClose]);
  const handleEmergencyLogin = async () => {
    setIsLogging(true);
    console.log("🚨 EMERGENCY ADMIN LOGIN - Starting...");
    try {
      const result = await login("wikus77@hotmail.it", "Wikus@190877");
      if (result.success) {
        console.log("🚀 EMERGENCY LOGIN SUCCESS - Setting emergency access");
        localStorage.setItem("emergency_admin_access", "true");
        window.location.href = "/push-test?emergency=admin";
      } else {
        console.error("❌ EMERGENCY LOGIN FAILED:", result.error);
        alert("Emergency login failed: " + (result.error?.message || "Unknown error"));
      }
    } catch (error) {
      console.error("❌ EMERGENCY LOGIN EXCEPTION:", error);
      alert("Emergency login exception: " + error);
    } finally {
      setIsLogging(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/90 flex items-center justify-center z-50", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-red-900 border border-red-500 rounded-lg p-6 max-w-md relative", children: [
    onClose && /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        onClick: onClose,
        className: "absolute top-2 right-2 text-red-300 hover:text-white text-2xl",
        children: "×"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-white text-xl font-bold mb-4", children: "🚨 EMERGENCY ADMIN ACCESS" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-200 mb-4", children: "Sistema di bypass d'emergenza per accesso sviluppatore immediato" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        onClick: handleEmergencyLogin,
        disabled: isLogging,
        className: "w-full bg-red-600 hover:bg-red-700 disabled:bg-red-800 text-white font-bold py-2 px-4 rounded transition-colors mb-4",
        children: isLogging ? "🔄 Accesso in corso..." : "🚀 ACCESSO EMERGENCY"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300 text-xs", children: "wikus77@hotmail.it / Wikus@190877" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-400 text-xs mt-2", children: "Premi ESC per chiudere" })
  ] }) });
};

const KEY = "post_login_redirect";
function consumePostLoginRedirect() {
  try {
    const target = localStorage.getItem(KEY);
    if (target) localStorage.removeItem(KEY);
    return target;
  } catch {
    return null;
  }
}
function postLoginRedirectFixed(navigate) {
  const target = consumePostLoginRedirect() || "/home";
  console.log("🚀 postLoginRedirectFixed →", target);
  try {
    navigate(target);
  } catch {
    window.location.href = target;
  }
}

const M1LogoSplash = ({
  onComplete,
  duration = 7e3
  // 7 secondi come richiesto
}) => {
  const [isVisible, setIsVisible] = reactExports.useState(true);
  const [phase, setPhase] = reactExports.useState("enter");
  reactExports.useEffect(() => {
    const glowTimer = setTimeout(() => setPhase("glow"), 1500);
    const exitTimer = setTimeout(() => setPhase("exit"), duration - 1200);
    const completeTimer = setTimeout(() => {
      setIsVisible(false);
      onComplete();
    }, duration);
    return () => {
      clearTimeout(glowTimer);
      clearTimeout(exitTimer);
      clearTimeout(completeTimer);
    };
  }, [duration, onComplete]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isVisible && /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "fixed inset-0 z-[99999] flex items-center justify-center bg-black",
      initial: { opacity: 1 },
      exit: { opacity: 0 },
      transition: { duration: 0.8, ease: "easeInOut" },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute inset-0",
            initial: { opacity: 0 },
            animate: { opacity: phase === "glow" ? 0.3 : 0 },
            transition: { duration: 1 },
            style: {
              background: "radial-gradient(circle at center, rgba(0, 209, 255, 0.15) 0%, transparent 70%)"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute",
            initial: { scale: 0, opacity: 0 },
            animate: {
              scale: phase === "exit" ? 3 : phase === "glow" ? [1, 1.5, 1] : 0.5,
              opacity: phase === "exit" ? 0 : phase === "glow" ? [0.3, 0.1, 0.3] : 0
            },
            transition: {
              duration: phase === "glow" ? 3 : 1,
              repeat: phase === "glow" ? Infinity : 0,
              ease: "easeInOut"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "w-[400px] h-[400px] rounded-full border-2 border-[#00D1FF]/30",
                style: {
                  boxShadow: "0 0 60px rgba(0, 209, 255, 0.2), inset 0 0 60px rgba(0, 209, 255, 0.1)"
                }
              }
            )
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "relative flex items-center justify-center",
            initial: { scale: 0.5, opacity: 0 },
            animate: {
              scale: phase === "exit" ? 0.8 : 1,
              opacity: phase === "exit" ? 0 : 1
            },
            transition: {
              duration: phase === "enter" ? 1 : 0.8,
              ease: [0.34, 1.56, 0.64, 1]
              // Spring-like easing
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.svg,
                {
                  width: "180",
                  height: "180",
                  viewBox: "0 0 200 200",
                  className: "relative",
                  style: {
                    filter: phase === "glow" ? "drop-shadow(0 0 30px rgba(0, 209, 255, 0.8)) drop-shadow(0 0 60px rgba(0, 209, 255, 0.5))" : "drop-shadow(0 0 15px rgba(0, 209, 255, 0.5))"
                  },
                  animate: {
                    filter: phase === "glow" ? [
                      "drop-shadow(0 0 30px rgba(0, 209, 255, 0.8)) drop-shadow(0 0 60px rgba(0, 209, 255, 0.5))",
                      "drop-shadow(0 0 50px rgba(0, 209, 255, 1)) drop-shadow(0 0 100px rgba(0, 209, 255, 0.7))",
                      "drop-shadow(0 0 30px rgba(0, 209, 255, 0.8)) drop-shadow(0 0 60px rgba(0, 209, 255, 0.5))"
                    ] : void 0
                  },
                  transition: {
                    duration: 2,
                    repeat: phase === "glow" ? Infinity : 0,
                    ease: "easeInOut"
                  },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.path,
                      {
                        d: "M25 160 L25 50 Q25 40 35 40 L50 40 Q60 40 65 50 L100 115 L135 50 Q140 40 150 40 L165 40 Q175 40 175 50 L175 160 Q175 170 165 170 L155 170 Q145 170 145 160 L145 85 L115 140 Q110 150 100 150 Q90 150 85 140 L55 85 L55 160 Q55 170 45 170 L35 170 Q25 170 25 160 Z",
                        fill: "none",
                        stroke: "#00D1FF",
                        strokeWidth: "8",
                        strokeLinecap: "round",
                        strokeLinejoin: "round",
                        initial: { pathLength: 0, opacity: 0 },
                        animate: { pathLength: 1, opacity: 1 },
                        transition: {
                          duration: 1.5,
                          ease: "easeOut",
                          delay: 0.2
                        }
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.path,
                      {
                        d: "M25 160 L25 50 Q25 40 35 40 L50 40 Q60 40 65 50 L100 115 L135 50 Q140 40 150 40 L165 40 Q175 40 175 50 L175 160 Q175 170 165 170 L155 170 Q145 170 145 160 L145 85 L115 140 Q110 150 100 150 Q90 150 85 140 L55 85 L55 160 Q55 170 45 170 L35 170 Q25 170 25 160 Z",
                        fill: "#00D1FF",
                        initial: { opacity: 0 },
                        animate: { opacity: 1 },
                        transition: { duration: 0.5, delay: 1.2 }
                      }
                    )
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "text-white font-bold ml-2",
                  style: {
                    fontSize: "140px",
                    fontFamily: "Inter, system-ui, sans-serif",
                    fontWeight: 700,
                    lineHeight: 1,
                    textShadow: "0 0 20px rgba(255, 255, 255, 0.5)"
                  },
                  initial: { opacity: 0, x: 30 },
                  animate: {
                    opacity: phase === "exit" ? 0 : 1,
                    x: 0
                  },
                  transition: {
                    duration: 0.8,
                    delay: 0.8,
                    ease: "easeOut"
                  },
                  children: "1"
                }
              )
            ]
          }
        ),
        phase === "glow" && /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children: [...Array(8)].map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute w-2 h-2 rounded-full bg-[#00D1FF]",
            initial: {
              opacity: 0,
              scale: 0,
              x: 0,
              y: 0
            },
            animate: {
              opacity: [0, 1, 0],
              scale: [0, 1, 0.5],
              x: Math.cos(i / 8 * Math.PI * 2) * 150,
              y: Math.sin(i / 8 * Math.PI * 2) * 150
            },
            transition: {
              duration: 2.5,
              delay: i * 0.15,
              repeat: Infinity,
              ease: "easeOut"
            },
            style: {
              boxShadow: "0 0 10px rgba(0, 209, 255, 0.8)"
            }
          },
          i
        )) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute bottom-20 text-center overflow-hidden",
            initial: { opacity: 0 },
            animate: {
              opacity: phase === "glow" ? 1 : 0
            },
            transition: { duration: 0.5, delay: 1 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "flex justify-center",
                initial: { width: 0 },
                animate: {
                  width: phase === "glow" ? "auto" : 0
                },
                transition: {
                  duration: 1.5,
                  delay: 1.2,
                  ease: [0.25, 0.46, 0.45, 0.94]
                },
                style: { overflow: "hidden", whiteSpace: "nowrap" },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.p,
                  {
                    className: "text-2xl font-bold tracking-[0.15em] uppercase",
                    style: {
                      color: "#B8860B",
                      // Dark goldenrod
                      textShadow: "0 0 20px rgba(184, 134, 11, 0.6), 0 0 40px rgba(184, 134, 11, 0.3)",
                      fontFamily: "Orbitron, sans-serif"
                    },
                    animate: phase === "glow" ? {
                      textShadow: [
                        "0 0 20px rgba(184, 134, 11, 0.6), 0 0 40px rgba(184, 134, 11, 0.3)",
                        "0 0 30px rgba(184, 134, 11, 0.8), 0 0 60px rgba(184, 134, 11, 0.5)",
                        "0 0 20px rgba(184, 134, 11, 0.6), 0 0 40px rgba(184, 134, 11, 0.3)"
                      ]
                    } : {},
                    transition: {
                      duration: 2,
                      repeat: Infinity,
                      ease: "easeInOut"
                    },
                    children: "IT IS POSSIBLE"
                  }
                )
              }
            )
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute bottom-8 text-center",
            initial: { opacity: 0 },
            animate: { opacity: phase === "glow" ? 0.5 : 0 },
            transition: { duration: 0.5, delay: 1 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/40 text-xs font-light", children: "© 2025 NIYVORA KFT™" })
          }
        )
      ]
    }
  ) });
};

const Login = () => {
  const [verificationStatus, setVerificationStatus] = reactExports.useState(null);
  const [showEmergencyLogin, setShowEmergencyLogin] = reactExports.useState(false);
  const [showSplash, setShowSplash] = reactExports.useState(true);
  const { navigate } = useWouterNavigation();
  const { isAuthenticated, isLoading } = useUnifiedAuth();
  const searchParams = new URLSearchParams(window.location.search);
  const redirectAttemptedRef = reactExports.useRef(false);
  const fallbackTimerRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    if (isAuthenticated && !isLoading && !redirectAttemptedRef.current) {
      console.log("🔄 LOGIN PAGE: User already authenticated, initiating redirect (POST_LOGIN_REDIRECT)");
      redirectAttemptedRef.current = true;
      setShowSplash(false);
      postLoginRedirectFixed(navigate);
    }
  }, [isAuthenticated, isLoading]);
  reactExports.useEffect(() => {
    const hasSeenSplash = sessionStorage.getItem("m1_splash_shown");
    if (hasSeenSplash) {
      setShowSplash(false);
    }
  }, []);
  reactExports.useEffect(() => {
    if (isAuthenticated && !isLoading && window.location.pathname === "/login") {
      console.log("⏱️ Setting up PWA fallback timer (2s)");
      fallbackTimerRef.current = setTimeout(() => {
        if (window.location.pathname === "/login" && isAuthenticated) {
          console.log("🚨 FALLBACK TIMER TRIGGERED - User stuck on login page");
          postLoginRedirectFixed(navigate);
        }
      }, 2e3);
      return () => {
        if (fallbackTimerRef.current) {
          clearTimeout(fallbackTimerRef.current);
          fallbackTimerRef.current = null;
        }
      };
    }
  }, [isAuthenticated, isLoading]);
  reactExports.useEffect(() => {
    const verification = searchParams.get("verification");
    if (verification === "pending") {
      setVerificationStatus("pending");
    } else if (verification === "success") {
      setVerificationStatus("success");
      ue$1.success("Email verificata", {
        description: "La tua email è stata verificata con successo."
      });
    }
  }, [navigate]);
  const handleSplashComplete = () => {
    setShowSplash(false);
    sessionStorage.setItem("m1_splash_shown", "true");
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen flex items-center justify-center bg-black px-4 py-12 relative overflow-hidden", children: [
    showSplash && /* @__PURE__ */ jsxRuntimeExports.jsx(
      M1LogoSplash,
      {
        onComplete: handleSplashComplete,
        duration: 7e3
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(BackgroundParticles, { count: 15 }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "w-full max-w-md z-10",
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.5 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatedLogo, {}) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-white mb-1 neon-text-cyan", children: "M1SSION™" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Accedi per iniziare la tua missione" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            "div",
            {
              className: "m1ssion-glass-card p-6 rounded-xl relative",
              style: {
                background: "rgba(0, 0, 0, 0.05)",
                backdropFilter: "blur(40px)",
                WebkitBackdropFilter: "blur(40px)",
                border: "1px solid rgba(255, 255, 255, 0.1)",
                boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
              },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(StandardLoginForm, { verificationStatus }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 text-center space-y-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-white/70", children: [
                    "Non hai un account?",
                    " ",
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/register", className: "text-cyan-400 hover:text-cyan-300 transition-colors", children: "Registrati" })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/50", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/landing", className: "text-cyan-400 hover:text-cyan-300 transition-colors", children: "← Torna alla homepage" }) })
                ] })
              ]
            }
          )
        ]
      }
    ),
    showEmergencyLogin && /* @__PURE__ */ jsxRuntimeExports.jsx(AdminEmergencyLogin, { onClose: () => setShowEmergencyLogin(false) })
  ] });
};

async function getActiveSubscription(supabase, userId) {
  const { data, error } = await supabase.from("subscriptions").select("id,tier,status,created_at").eq("user_id", userId).eq("status", "active").order("created_at", { ascending: false }).limit(1).maybeSingle();
  if (error) {
    console.warn("[subs] getActiveSubscription error", error);
    return { hasActive: false, plan: null };
  }
  return { hasActive: !!data, plan: data?.tier ?? null };
}

const AccessBlockedView = ({
  subscriptionPlan,
  accessStartDate,
  timeUntilAccess
}) => {
  const { navigate } = useWouterNavigation();
  const { getCurrentUser } = useUnifiedAuth();
  const [realPlanName, setRealPlanName] = reactExports.useState("Free");
  reactExports.useEffect(() => {
    async function fetchRealPlan() {
      const user = getCurrentUser();
      if (user?.id) {
        const { data: userData } = await supabase.auth.getUser();
        if (userData.user?.email === "wikus77@hotmail.it") {
          console.info("[FREE-OVERRIDE] Access block bypassed for wikus77@hotmail.it");
          return null;
        }
        const result = await getActiveSubscription(supabase, user.id);
        const plan = result.plan || "free";
        setRealPlanName(plan);
        if (plan === "free" && window.location.pathname !== "/choose-plan") {
          navigate("/home", { replace: true });
          return;
        }
      }
    }
    fetchRealPlan();
  }, [getCurrentUser, navigate]);
  const formatTimeRemaining = (milliseconds) => {
    const days = Math.floor(milliseconds / (1e3 * 60 * 60 * 24));
    const hours = Math.floor(milliseconds % (1e3 * 60 * 60 * 24) / (1e3 * 60 * 60));
    const minutes = Math.floor(milliseconds % (1e3 * 60 * 60) / (1e3 * 60));
    if (days > 0) return `${days} giorni, ${hours} ore`;
    if (hours > 0) return `${hours} ore, ${minutes} minuti`;
    return `${minutes} minuti`;
  };
  const getPlanDisplayName = (plan) => {
    switch (plan.toUpperCase()) {
      case "SILVER":
        return "Silver";
      case "GOLD":
        return "Gold";
      case "BLACK":
        return "Black";
      case "TITANIUM":
        return "Titanium";
      case "FREE":
        return "Free";
      default:
        return "Free";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black px-4 py-12", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "w-full max-w-md text-center",
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "mx-auto mb-6 w-20 h-20 bg-yellow-500/20 rounded-full flex items-center justify-center",
            initial: { scale: 0 },
            animate: { scale: 1 },
            transition: { delay: 0.2, type: "spring" },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-10 h-10 text-yellow-400" })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white mb-4", children: "⛔ Accesso non ancora disponibile" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-300 mb-6", children: [
          "L'accesso alla missione non è ancora disponibile per il tuo piano ",
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-semibold text-cyan-400", children: getPlanDisplayName(realPlanName) }),
          "."
        ] }),
        timeUntilAccess && timeUntilAccess > 0 && accessStartDate && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "bg-gray-900/50 border border-gray-700 rounded-lg p-4 mb-6",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 0.4 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 mb-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-5 h-5 text-cyan-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 font-semibold", children: "Accesso disponibile tra:" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xl font-mono text-white", children: formatTimeRemaining(timeUntilAccess) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-gray-400 mt-2", children: [
                "Data di sblocco: ",
                accessStartDate.toLocaleDateString("it-IT", {
                  day: "2-digit",
                  month: "long",
                  year: "numeric",
                  hour: "2-digit",
                  minute: "2-digit"
                })
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-6",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 0.6 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 mb-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "w-5 h-5 text-blue-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-blue-400 font-semibold", children: "Ti avviseremo!" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-blue-300", children: "Riceverai una notifica push e una email quando potrai iniziare la tua missione." })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
          (realPlanName.toLowerCase() === "base" || realPlanName.toLowerCase() === "free") && /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: () => {
                navigate("/choose-plan?from=access-blocked&current_plan=" + encodeURIComponent(realPlanName));
              },
              className: "w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105",
              children: "🚀 Aggiorna il tuo piano per accesso anticipato"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: "outline",
              onClick: () => navigate("/home", { replace: true }),
              className: "w-full border-gray-600 text-gray-300 hover:bg-gray-800 pointer-events-auto z-10",
              style: { pointerEvents: "auto" },
              children: "← Torna alla homepage"
            }
          )
        ] })
      ]
    }
  ) });
};

const ProtectedRoute = ({ children }) => {
  const { isAuthenticated, isLoading: authLoading, getCurrentUser } = useUnifiedAuth();
  const { canAccess, isLoading: accessLoading, subscriptionPlan, accessStartDate, timeUntilAccess } = useAccessControl();
  const [location, setLocation] = useLocation();
  const user = getCurrentUser();
  const isAdminUser = user?.email === "wikus77@hotmail.it";
  React$1.useEffect(() => {
    if (!authLoading && !accessLoading) {
      if (isAdminUser) {
        console.log("🚀 ADMIN DETECTED - Skipping all redirects, direct render");
        return;
      }
      if (!isAuthenticated && location !== "/login") {
        console.log("🔄 [WouterProtectedRoute] Redirecting to login - user not authenticated");
        setLocation("/login");
      } else if (isAuthenticated && (!subscriptionPlan || subscriptionPlan === "") && location !== "/choose-plan" && subscriptionPlan !== "ADMIN") {
        console.log("🔄 [WouterProtectedRoute] Redirecting to plan selection - no plan selected");
        setLocation("/choose-plan");
      }
    }
  }, [isAuthenticated, authLoading, accessLoading, subscriptionPlan, location, setLocation, isAdminUser]);
  React$1.useEffect(() => {
    if (!isAuthenticated && !authLoading) {
      console.log("🧹 [WouterProtectedRoute] Clearing session storage on logout");
      sessionStorage.removeItem("hasSeenPostLoginIntro");
    }
  }, [isAuthenticated, authLoading]);
  if (isAdminUser) {
    console.log("🚀 INSTANT ADMIN BYPASS - Direct children render for:", user?.email);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
  }
  if (!isAuthenticated || authLoading || accessLoading) {
    if (!authLoading && !accessLoading && !isAuthenticated) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {});
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white", children: "Verifica accesso..." }) });
  }
  if (!canAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      AccessBlockedView,
      {
        subscriptionPlan,
        accessStartDate,
        timeUntilAccess
      }
    );
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
};

const preserveFunctionName = (fn, name) => {
  return fn;
};
const detectPWAEnvironment = () => {
  if (typeof window === "undefined") return false;
  return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true || document.referrer.includes("android-app://");
};
const getPWASafeAreaInsets$1 = () => {
  if (typeof window === "undefined") {
    return { top: 0, bottom: 0, left: 0, right: 0 };
  }
  const getInset = (side) => {
    const value = getComputedStyle(document.documentElement).getPropertyValue(`--safe-area-inset-${side}`).trim();
    if (value && value !== `env(safe-area-inset-${side})`) {
      return parseInt(value.replace("px", "")) || 0;
    }
    return 0;
  };
  return {
    top: getInset("top"),
    bottom: getInset("bottom"),
    left: getInset("left"),
    right: getInset("right")
  };
};
console.log("✅ M1SSION PWA stubs loaded");

const IOSSafeAreaOverlay = ({
  children,
  visible = false,
  opacity = 0.3
}) => {
  if (!new URLSearchParams(window.location.search).get("diag")) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
  }
  const [safeArea, setSafeArea] = reactExports.useState({ top: 0, bottom: 0, left: 0, right: 0 });
  const [isCapacitor, setIsCapacitor] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const updateSafeArea = () => {
      const insets = getPWASafeAreaInsets$1();
      setSafeArea(insets);
      setIsCapacitor(detectPWAEnvironment());
    };
    updateSafeArea();
    const handleOrientationChange = () => {
      setTimeout(updateSafeArea, 100);
    };
    window.addEventListener("orientationchange", handleOrientationChange);
    window.addEventListener("resize", updateSafeArea);
    return () => {
      window.removeEventListener("orientationchange", handleOrientationChange);
      window.removeEventListener("resize", updateSafeArea);
    };
  }, []);
  if (!visible || !isCapacitor) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    children,
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "fixed inset-0 pointer-events-none z-[9998]", children: [
      safeArea.top > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute top-0 left-0 right-0 bg-red-500 flex items-center justify-center",
          style: {
            height: `${safeArea.top}px`,
            opacity
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white text-xs font-mono", children: [
            "TOP SAFE AREA (",
            safeArea.top,
            "px)"
          ] })
        }
      ),
      safeArea.bottom > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute bottom-0 left-0 right-0 bg-blue-500 flex items-center justify-center",
          style: {
            height: `${safeArea.bottom}px`,
            opacity
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white text-xs font-mono", children: [
            "BOTTOM SAFE AREA (",
            safeArea.bottom,
            "px)"
          ] })
        }
      ),
      safeArea.left > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute top-0 bottom-0 left-0 bg-green-500 flex items-center justify-center",
          style: {
            width: `${safeArea.left}px`,
            opacity,
            writingMode: "vertical-rl",
            textOrientation: "mixed"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white text-xs font-mono", children: [
            "LEFT (",
            safeArea.left,
            "px)"
          ] })
        }
      ),
      safeArea.right > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute top-0 bottom-0 right-0 bg-yellow-500 flex items-center justify-center",
          style: {
            width: `${safeArea.right}px`,
            opacity,
            writingMode: "vertical-lr",
            textOrientation: "mixed"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white text-xs font-mono", children: [
            "RIGHT (",
            safeArea.right,
            "px)"
          ] })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute top-16 left-4 bg-black bg-opacity-80 text-white p-2 rounded text-xs font-mono", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          "Platform: ",
          isCapacitor ? "Capacitor" : "Web"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          "Orientation: ",
          window.innerWidth > window.innerHeight ? "Landscape" : "Portrait"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          "Viewport: ",
          window.innerWidth,
          "×",
          window.innerHeight
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          "Safe Area: T",
          safeArea.top,
          " B",
          safeArea.bottom,
          " L",
          safeArea.left,
          " R",
          safeArea.right
        ] })
      ] })
    ] })
  ] });
};

const getPWASafeAreaInsets = () => {
  if (typeof window === "undefined") {
    return { top: 0, bottom: 0, left: 0, right: 0 };
  }
  const getInset = (side) => {
    const value = getComputedStyle(document.documentElement).getPropertyValue(`--safe-area-inset-${side}`).trim();
    if (value && value !== `env(safe-area-inset-${side})`) {
      return parseInt(value.replace("px", "")) || 0;
    }
    return 0;
  };
  return {
    top: getInset("top"),
    bottom: getInset("bottom"),
    left: getInset("left"),
    right: getInset("right")
  };
};
const optimizePWATouchGestures = () => {
  if (typeof window === "undefined") return;
  console.log("🚫 Optimizing PWA touch gestures...");
  let lastTouchEnd = 0;
  document.addEventListener("touchend", (e) => {
    const now = (/* @__PURE__ */ new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
      e.preventDefault();
    }
    lastTouchEnd = now;
  }, false);
  document.body.style.overscrollBehavior = "none";
  document.body.style.touchAction = "manipulation";
  console.log("✅ PWA touch gestures optimized");
};
const initializePWA = async () => {
  console.log("📱 Initializing PWA environment...");
  try {
    optimizePWATouchGestures();
    const viewport = document.querySelector('meta[name="viewport"]');
    if (viewport) {
      viewport.setAttribute(
        "content",
        "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
      );
    }
    console.log("✅ PWA initialization completed");
    return true;
  } catch (error) {
    console.error("❌ PWA initialization error:", error);
    return false;
  }
};
console.log("✅ M1SSION PWA functions loaded");

const pwaNativeFunctions = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  getPWASafeAreaInsets,
  initializePWA,
  optimizePWATouchGestures
}, Symbol.toStringTag, { value: 'Module' }));

const SafeAreaWrapper$1 = ({
  children,
  className = "",
  top = true,
  bottom = true,
  left = true,
  right = true,
  debug = false
}) => {
  const [safeArea, setSafeArea] = reactExports.useState({ top: 0, bottom: 0, left: 0, right: 0 });
  const [isPWA, setIsPWA] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const updateSafeArea = () => {
      const insets = getPWASafeAreaInsets();
      setSafeArea(insets);
      setIsPWA(window.matchMedia("(display-mode: standalone)").matches);
      if (debug) {
        console.log("📱 Safe Area Insets:", insets);
      }
    };
    updateSafeArea();
    const handleOrientationChange = () => {
      setTimeout(updateSafeArea, 100);
    };
    window.addEventListener("orientationchange", handleOrientationChange);
    window.addEventListener("resize", updateSafeArea);
    return () => {
      window.removeEventListener("orientationchange", handleOrientationChange);
      window.removeEventListener("resize", updateSafeArea);
    };
  }, [debug]);
  const paddingStyle = isPWA ? {
    paddingTop: top ? `${safeArea.top}px` : void 0,
    paddingBottom: bottom ? `${safeArea.bottom}px` : void 0,
    paddingLeft: left ? `${safeArea.left}px` : void 0,
    paddingRight: right ? `${safeArea.right}px` : void 0
  } : {};
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `safe-area-wrapper ${className}`,
      style: paddingStyle,
      children: [
        debug && isPWA && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "fixed top-0 left-0 z-[10000] bg-red-500 text-white text-xs p-2", children: [
          "Safe Area: T:",
          safeArea.top,
          " B:",
          safeArea.bottom,
          " L:",
          safeArea.left,
          " R:",
          safeArea.right
        ] }),
        children
      ]
    }
  );
};

const useProfileNotifications = () => {
  const [showNotifications, setShowNotifications] = reactExports.useState(false);
  return {
    showNotifications,
    setShowNotifications
  };
};

function useNotificationManager() {
  const { showNotifications, setShowNotifications } = useProfileNotifications();
  const {
    notifications,
    unreadCount,
    markAllAsRead,
    markAsRead,
    addNotification,
    deleteNotification,
    reloadNotifications
  } = useNotifications();
  const [notificationsBannerOpen, setNotificationsBannerOpen] = reactExports.useState(false);
  const pollingIntervalRef = reactExports.useRef(null);
  const isInitialLoadDone = reactExports.useRef(false);
  reactExports.useEffect(() => {
    const startPolling = () => {
      if (pollingIntervalRef.current) {
        clearInterval(pollingIntervalRef.current);
      }
      pollingIntervalRef.current = window.setInterval(() => {
        if (document.visibilityState === "visible") {
          console.log("🔄 NOTIFICATION_MANAGER: Polling for new notifications...");
          reloadNotifications();
        } else {
          console.log("⏸️ NOTIFICATION_MANAGER: Skipping polling - page not visible");
        }
      }, 5e3);
    };
    if (!isInitialLoadDone.current) {
      reloadNotifications().then(() => {
        console.log("📱 NOTIFICATION_MANAGER: Initial notifications loaded");
        isInitialLoadDone.current = true;
        startPolling();
      });
    }
    return () => {
      if (pollingIntervalRef.current) {
        clearInterval(pollingIntervalRef.current);
      }
    };
  }, [reloadNotifications]);
  const openNotificationsBanner = reactExports.useCallback(() => {
    setNotificationsBannerOpen(true);
  }, []);
  const closeNotificationsBanner = reactExports.useCallback(() => {
    setNotificationsBannerOpen(false);
  }, []);
  const openNotificationsDrawer = reactExports.useCallback(() => {
    setShowNotifications(true);
    console.log("📱 NOTIFICATION_MANAGER: Drawer opened, reloading notifications");
    reloadNotifications();
  }, [setShowNotifications, reloadNotifications]);
  const closeNotificationsDrawer = reactExports.useCallback(() => {
    setShowNotifications(false);
    markAllAsRead().then(() => {
      console.log("✅ NOTIFICATION_MANAGER: All notifications marked as read on drawer close");
    });
  }, [setShowNotifications, markAllAsRead]);
  const createNotification = reactExports.useCallback(async (title, description, type = NOTIFICATION_CATEGORIES$1.GENERIC) => {
    console.log(`📝 NOTIFICATION_MANAGER: Creating notification of type ${type}:`, title);
    ue$1(title, {
      description
    });
    try {
      const result = await addNotification({
        title,
        description,
        type
      });
      if (result) {
        console.log("✅ NOTIFICATION_MANAGER: Notification created successfully");
        setTimeout(() => {
          console.log("🔄 NOTIFICATION_MANAGER: Reloading after notification creation");
          reloadNotifications();
        }, 500);
      } else {
        console.error("❌ NOTIFICATION_MANAGER: Failed to create notification");
      }
      return result;
    } catch (error) {
      console.error("❌ NOTIFICATION_MANAGER: Error creating notification:", error);
      return false;
    }
  }, [addNotification, reloadNotifications]);
  const createBuzzNotification = reactExports.useCallback(async (title, description) => {
    return await createNotification(title, description, NOTIFICATION_CATEGORIES$1.BUZZ);
  }, [createNotification]);
  const createMapBuzzNotification = reactExports.useCallback(async (title, description) => {
    return await createNotification(title, description, NOTIFICATION_CATEGORIES$1.MAP_BUZZ);
  }, [createNotification]);
  const createLeaderboardNotification = reactExports.useCallback(async (title, description) => {
    return await createNotification(title, description, NOTIFICATION_CATEGORIES$1.LEADERBOARD);
  }, [createNotification]);
  const createWeeklyNotification = reactExports.useCallback(async (title, description) => {
    return await createNotification(title, description, NOTIFICATION_CATEGORIES$1.WEEKLY);
  }, [createNotification]);
  const manualReload = reactExports.useCallback(async () => {
    console.log("🔄 NOTIFICATION_MANAGER: Manual notification reload requested");
    return await reloadNotifications();
  }, [reloadNotifications]);
  return {
    // Notification data
    notifications,
    unreadCount,
    // Banner controls
    notificationsBannerOpen,
    openNotificationsBanner,
    closeNotificationsBanner,
    // Drawer controls
    notificationsDrawerOpen: showNotifications,
    openNotificationsDrawer,
    closeNotificationsDrawer,
    // Actions
    markAllAsRead,
    markAsRead,
    deleteNotification,
    // Create notifications by category
    createNotification,
    // Generic
    createBuzzNotification,
    createMapBuzzNotification,
    createLeaderboardNotification,
    createWeeklyNotification,
    reloadNotifications: manualReload
  };
}

const useAuthSessionManager = () => {
  const [user, setUser] = reactExports.useState(null);
  const [session, setSession] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const forceSessionFromTokens = async (accessToken, refreshToken) => {
    console.log("🔧 FORCING SESSION FROM TOKENS (Enhanced Diagnostics)...");
    console.log("📊 Input Analysis:", {
      accessTokenProvided: !!accessToken,
      accessTokenLength: accessToken?.length || 0,
      refreshTokenProvided: !!refreshToken,
      refreshTokenLength: refreshToken?.length || 0,
      tokenFormat: accessToken?.split(".").length === 3 ? "JWT" : "Custom"
    });
    try {
      if (refreshToken && accessToken) {
        console.log("🔄 Attempting setSession with both tokens...");
        const sessionData = await supabase.auth.setSession({
          access_token: accessToken,
          refresh_token: refreshToken
        });
        console.log("📊 SetSession Result:", {
          hasError: !!sessionData.error,
          hasData: !!sessionData.data,
          hasSession: !!sessionData.data?.session,
          hasUser: !!sessionData.data?.user,
          errorMessage: sessionData.error?.message
        });
        if (!sessionData.error && sessionData.data?.session) {
          console.log("✅ SESSION FORCED SUCCESS via setSession");
          setSession(sessionData.data.session);
          setUser(sessionData.data.session.user);
          const sessionBackup = {
            access_token: accessToken,
            refresh_token: refreshToken,
            expires_at: sessionData.data.session.expires_at,
            user: sessionData.data.session.user,
            created_at: Date.now(),
            source: "enhanced_developer_auto_login",
            version: "2.0"
          };
          localStorage.setItem(getAuthTokenKey(), JSON.stringify(sessionBackup));
          console.log("💾 Enhanced session backup stored in localStorage");
          return true;
        } else {
          console.log("⚠️ setSession failed, error:", sessionData.error);
        }
      }
      console.log("🔄 CONSTRUCTING ENHANCED MANUAL SESSION...");
      try {
        const tokenParts = accessToken.split(".");
        let tokenPayload = {};
        if (tokenParts.length === 3) {
          try {
            const base64Payload = tokenParts[1].replace(/-/g, "+").replace(/_/g, "/");
            const padding = base64Payload.length % 4;
            const paddedPayload = base64Payload + "=".repeat(padding ? 4 - padding : 0);
            tokenPayload = JSON.parse(atob(paddedPayload));
            console.log("✅ JWT payload decoded successfully:", {
              sub: tokenPayload.sub,
              email: tokenPayload.email,
              exp: tokenPayload.exp,
              iat: tokenPayload.iat
            });
          } catch (decodeError) {
            console.log("⚠️ JWT decode failed, using fallback payload:", decodeError);
          }
        }
        const manualSession = {
          access_token: accessToken,
          refresh_token: refreshToken || `enhanced_refresh_${Date.now()}`,
          expires_in: 3600,
          expires_at: tokenPayload.exp || Math.floor(Date.now() / 1e3) + 3600,
          token_type: "bearer",
          user: {
            id: tokenPayload.sub || `enhanced_user_${Date.now()}`,
            email: tokenPayload.email || "wikus77@hotmail.it",
            email_confirmed_at: tokenPayload.email_confirmed_at || (/* @__PURE__ */ new Date()).toISOString(),
            confirmed_at: tokenPayload.confirmed_at || (/* @__PURE__ */ new Date()).toISOString(),
            last_sign_in_at: (/* @__PURE__ */ new Date()).toISOString(),
            app_metadata: {
              provider: "enhanced_developer_login",
              providers: ["enhanced_developer_login"],
              ...tokenPayload.app_metadata
            },
            user_metadata: {
              enhanced_auto_login: true,
              login_method: "developer_session_force",
              ...tokenPayload.user_metadata
            },
            aud: tokenPayload.aud || "authenticated",
            created_at: tokenPayload.created_at || (/* @__PURE__ */ new Date()).toISOString(),
            updated_at: (/* @__PURE__ */ new Date()).toISOString(),
            role: tokenPayload.role || "authenticated"
          }
        };
        console.log("✅ ENHANCED MANUAL SESSION CONSTRUCTED for:", manualSession.user.email);
        setSession(manualSession);
        setUser(manualSession.user);
        const sessionBackup = {
          ...manualSession,
          created_at: Date.now(),
          source: "manual_construction_enhanced",
          version: "2.0",
          diagnostics: {
            tokenLength: accessToken.length,
            hasRefreshToken: !!refreshToken,
            jwtDecoded: tokenParts.length === 3,
            timestamp: (/* @__PURE__ */ new Date()).toISOString()
          }
        };
        localStorage.setItem(getAuthTokenKey(), JSON.stringify(sessionBackup));
        console.log("💾 Enhanced manual session stored with full diagnostics");
        return true;
      } catch (constructionError) {
        console.error("❌ Enhanced manual session construction failed:", constructionError);
        return false;
      }
    } catch (error) {
      console.error("❌ FORCE SESSION CRITICAL ERROR:", error);
      return false;
    }
  };
  const clearSession = async () => {
    console.log("🧹 Clearing all session data (enhanced)...");
    setSession(null);
    setUser(null);
    localStorage.removeItem(getAuthTokenKey());
    try {
      await supabase.auth.signOut();
    } catch (error) {
      console.log("Logout error (expected):", error);
    }
  };
  reactExports.useEffect(() => {
    const initializeSession = async () => {
      console.log("🔍 INITIALIZING SESSION (Enhanced Diagnostics)...");
      try {
        const { data: { session: session2 }, error } = await supabase.auth.getSession();
        console.log("📊 Supabase session check:", {
          hasError: !!error,
          hasSession: !!session2,
          hasUser: !!session2?.user,
          userEmail: session2?.user?.email,
          expiresAt: session2?.expires_at
        });
        if (!error && session2 && session2.user) {
          console.log("✅ ACTIVE SUPABASE SESSION FOUND:", session2.user.email);
          setSession(session2);
          setUser(session2.user);
          setIsLoading(false);
          return;
        }
        const storedSession = localStorage.getItem(getAuthTokenKey());
        if (storedSession) {
          try {
            const parsedSession = JSON.parse(storedSession);
            console.log("🔄 RESTORING SESSION FROM BACKUP:", {
              userEmail: parsedSession.user?.email,
              source: parsedSession.source,
              version: parsedSession.version,
              hasAccessToken: !!parsedSession.access_token,
              hasUser: !!parsedSession.user
            });
            const now = Math.floor(Date.now() / 1e3);
            const isExpired = parsedSession.expires_at && parsedSession.expires_at <= now;
            console.log("📊 Session validation:", {
              expiresAt: parsedSession.expires_at,
              currentTime: now,
              isExpired,
              timeRemaining: parsedSession.expires_at ? parsedSession.expires_at - now : 0
            });
            if (!isExpired && parsedSession.user && parsedSession.access_token) {
              console.log("✅ Backup session still valid, restoring...");
              setSession(parsedSession);
              setUser(parsedSession.user);
              if (parsedSession.access_token && parsedSession.refresh_token) {
                setTimeout(() => {
                  supabase.auth.setSession({
                    access_token: parsedSession.access_token,
                    refresh_token: parsedSession.refresh_token
                  }).then((result) => {
                    console.log("🔄 Background session refresh result:", {
                      hasError: !!result.error,
                      errorMessage: result.error?.message
                    });
                  }).catch((err) => console.log("Background session refresh failed:", err));
                }, 1e3);
              }
            } else {
              console.log("⚠️ STORED SESSION EXPIRED OR INVALID, clearing...");
              localStorage.removeItem(getAuthTokenKey());
            }
          } catch (parseError) {
            console.error("❌ PARSE STORED SESSION ERROR:", parseError);
            localStorage.removeItem(getAuthTokenKey());
          }
        }
      } catch (error) {
        console.error("❌ SESSION INIT ERROR:", error);
      } finally {
        setIsLoading(false);
      }
    };
    initializeSession();
    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session2) => {
      console.log("🔄 ENHANCED AUTH STATE CHANGE:", {
        event,
        hasSession: !!session2,
        userEmail: session2?.user?.email || "No session",
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
      if (session2 && session2.user) {
        console.log("📝 Updating session from auth state change...");
        setSession(session2);
        setUser(session2.user);
        const sessionBackup = {
          ...session2,
          created_at: Date.now(),
          source: "auth_state_change_enhanced",
          version: "2.0",
          event_type: event
        };
        localStorage.setItem(getAuthTokenKey(), JSON.stringify(sessionBackup));
      } else if (event === "SIGNED_OUT") {
        console.log("👋 User signed out, clearing enhanced session...");
        await clearSession();
      }
    });
    return () => subscription.unsubscribe();
  }, []);
  return {
    user,
    session,
    isAuthenticated: !!session && !!user,
    isLoading,
    forceSessionFromTokens,
    clearSession
  };
};

const useAuth = () => {
  const sessionManager = useAuthSessionManager();
  const login = async (email, password) => {
    console.log("🔐 STANDARD LOGIN STARTING for:", email);
    try {
      console.log("🔄 Attempting standard Supabase login...");
      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
      });
      if (error) {
        console.error("❌ LOGIN FAILED:", error.message);
        return { success: false, error };
      }
      if (data.session) {
        console.log("✅ LOGIN SUCCESS - session created");
        await sessionManager.forceSessionFromTokens(
          data.session.access_token,
          data.session.refresh_token
        );
        return { success: true, session: data.session };
      }
      console.error("❌ LOGIN FAILED - no session created");
      return { success: false, error: { message: "No session created" } };
    } catch (error) {
      console.error("💥 LOGIN EXCEPTION:", error);
      return { success: false, error };
    }
  };
  const register = async (email, password) => {
    console.log("📝 REGISTRATION STARTING for:", email);
    try {
      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: `${window.location.origin}/`
        }
      });
      if (error) {
        console.error("❌ REGISTRATION FAILED:", error.message);
        return { success: false, error };
      }
      console.log("✅ REGISTRATION SUCCESS");
      return { success: true, data };
    } catch (error) {
      console.error("💥 REGISTRATION EXCEPTION:", error);
      return { success: false, error };
    }
  };
  const logout = async () => {
    console.log("🚪 LOGOUT STARTING - RESET COMPLETO 17/07/2025");
    const quizSkipKey = "m1_quiz_last_skip";
    const quizSkipValue = localStorage.getItem(quizSkipKey);
    localStorage.clear();
    sessionStorage.clear();
    if (quizSkipValue) {
      localStorage.setItem(quizSkipKey, quizSkipValue);
      console.log("🛡️ Preserved daily quiz skip after logout");
    }
    try {
      const mapStoreModule = await __vitePreload(() => import('./mapStore.B1lXQE0D.js'),true?__vite__mapDeps([0,1,2,3]):void 0).catch(() => null);
      if (mapStoreModule?.useMapStore) {
        const store = mapStoreModule.useMapStore.getState();
        store.resetMapState?.();
      }
    } catch (e) {
      console.log("⚠️ Map store not found, skipping reset");
    }
    await supabase.auth.signOut();
    await sessionManager.clearSession();
    console.log("✅ LOGOUT COMPLETED WITH CACHE RESET");
  };
  const resetPassword = async (email) => {
    console.log("🔄 PASSWORD RESET for:", email);
    try {
      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: `${window.location.origin}/auth/reset`
      });
      if (error) {
        console.error("❌ PASSWORD RESET FAILED:", error.message);
        return { success: false, error: error.message };
      }
      console.log("✅ PASSWORD RESET EMAIL SENT");
      return { success: true };
    } catch (error) {
      console.error("💥 PASSWORD RESET EXCEPTION:", error);
      return { success: false, error: error.message };
    }
  };
  const resendVerificationEmail = async (email) => {
    console.log("📧 RESEND VERIFICATION for:", email);
    try {
      const { error } = await supabase.auth.resend({
        type: "signup",
        email,
        options: {
          emailRedirectTo: `${window.location.origin}/`
        }
      });
      if (error) {
        console.error("❌ RESEND VERIFICATION FAILED:", error.message);
        return { success: false, error: error.message };
      }
      console.log("✅ VERIFICATION EMAIL SENT");
      return { success: true };
    } catch (error) {
      console.error("💥 RESEND VERIFICATION EXCEPTION:", error);
      return { success: false, error: error.message };
    }
  };
  const updateProfile = async (data) => {
    console.log("📝 UPDATE PROFILE:", data);
  };
  return {
    user: sessionManager.user,
    session: sessionManager.session,
    isAuthenticated: sessionManager.isAuthenticated,
    isLoading: sessionManager.isLoading,
    isEmailVerified: sessionManager.user?.email_confirmed_at ? true : false,
    login,
    register,
    logout,
    resetPassword,
    resendVerificationEmail,
    updateProfile,
    getCurrentUser: () => sessionManager.user,
    getAccessToken: () => sessionManager.session?.access_token || ""
  };
};

const Card = reactExports.forwardRef(({ className, gradient = false, interactive = false, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
  motion.div,
  {
    ref,
    className: cn(
      "m1ssion-glass-card overflow-hidden transition-all duration-300 card-hover-effect relative rounded-[24px]",
      className
    ),
    whileHover: interactive ? {
      scale: 1.03,
      boxShadow: "0 0 25px rgba(0, 209, 255, 0.4), 0 0 50px rgba(123, 46, 255, 0.2)"
    } : {},
    whileTap: interactive ? { scale: 0.97 } : {},
    transition: { duration: 0.3, ease: "easeOut" },
    ...props,
    children: [
      gradient && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "relative",
          whileHover: interactive ? { y: -2 } : {},
          transition: { duration: 0.2 },
          children
        }
      )
    ]
  }
));
Card.displayName = "Card";
const CardHeader = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    ref,
    className: cn("flex flex-col space-y-1.5 p-6", className),
    ...props
  }
));
CardHeader.displayName = "CardHeader";
const CardTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "h3",
  {
    ref,
    className: cn(
      "text-2xl font-semibold leading-none tracking-tight gradient-text-cyan glow-text",
      className
    ),
    ...props
  }
));
CardTitle.displayName = "CardTitle";
const CardDescription = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "p",
  {
    ref,
    className: cn("text-sm text-white/70", className),
    ...props
  }
));
CardDescription.displayName = "CardDescription";
const CardContent = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { ref, className: cn("p-6 pt-0", className), ...props }));
CardContent.displayName = "CardContent";
const CardFooter = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    ref,
    className: cn("flex items-center p-6 pt-0", className),
    ...props
  }
));
CardFooter.displayName = "CardFooter";

// src/create-context.tsx
function createContextScope$1(scopeName, createContextScopeDeps = []) {
  let defaultContexts = [];
  function createContext3(rootComponentName, defaultContext) {
    const BaseContext = reactExports.createContext(defaultContext);
    BaseContext.displayName = rootComponentName + "Context";
    const index = defaultContexts.length;
    defaultContexts = [...defaultContexts, defaultContext];
    const Provider = (props) => {
      const { scope, children, ...context } = props;
      const Context = scope?.[scopeName]?.[index] || BaseContext;
      const value = reactExports.useMemo(() => context, Object.values(context));
      return /* @__PURE__ */ jsxRuntimeExports.jsx(Context.Provider, { value, children });
    };
    Provider.displayName = rootComponentName + "Provider";
    function useContext2(consumerName, scope) {
      const Context = scope?.[scopeName]?.[index] || BaseContext;
      const context = reactExports.useContext(Context);
      if (context) return context;
      if (defaultContext !== void 0) return defaultContext;
      throw new Error(`\`${consumerName}\` must be used within \`${rootComponentName}\``);
    }
    return [Provider, useContext2];
  }
  const createScope = () => {
    const scopeContexts = defaultContexts.map((defaultContext) => {
      return reactExports.createContext(defaultContext);
    });
    return function useScope(scope) {
      const contexts = scope?.[scopeName] || scopeContexts;
      return reactExports.useMemo(
        () => ({ [`__scope${scopeName}`]: { ...scope, [scopeName]: contexts } }),
        [scope, contexts]
      );
    };
  };
  createScope.scopeName = scopeName;
  return [createContext3, composeContextScopes$1(createScope, ...createContextScopeDeps)];
}
function composeContextScopes$1(...scopes) {
  const baseScope = scopes[0];
  if (scopes.length === 1) return baseScope;
  const createScope = () => {
    const scopeHooks = scopes.map((createScope2) => ({
      useScope: createScope2(),
      scopeName: createScope2.scopeName
    }));
    return function useComposedScopes(overrideScopes) {
      const nextScopes = scopeHooks.reduce((nextScopes2, { useScope, scopeName }) => {
        const scopeProps = useScope(overrideScopes);
        const currentScope = scopeProps[`__scope${scopeName}`];
        return { ...nextScopes2, ...currentScope };
      }, {});
      return reactExports.useMemo(() => ({ [`__scope${baseScope.scopeName}`]: nextScopes }), [nextScopes]);
    };
  };
  createScope.scopeName = baseScope.scopeName;
  return createScope;
}

// src/slot.tsx
var REACT_LAZY_TYPE = Symbol.for("react.lazy");
var use = React[" use ".trim().toString()];
function isPromiseLike(value) {
  return typeof value === "object" && value !== null && "then" in value;
}
function isLazyComponent(element) {
  return element != null && typeof element === "object" && "$$typeof" in element && element.$$typeof === REACT_LAZY_TYPE && "_payload" in element && isPromiseLike(element._payload);
}
// @__NO_SIDE_EFFECTS__
function createSlot$1(ownerName) {
  const SlotClone = /* @__PURE__ */ createSlotClone$1(ownerName);
  const Slot2 = reactExports.forwardRef((props, forwardedRef) => {
    let { children, ...slotProps } = props;
    if (isLazyComponent(children) && typeof use === "function") {
      children = use(children._payload);
    }
    const childrenArray = reactExports.Children.toArray(children);
    const slottable = childrenArray.find(isSlottable$1);
    if (slottable) {
      const newElement = slottable.props.children;
      const newChildren = childrenArray.map((child) => {
        if (child === slottable) {
          if (reactExports.Children.count(newElement) > 1) return reactExports.Children.only(null);
          return reactExports.isValidElement(newElement) ? newElement.props.children : null;
        } else {
          return child;
        }
      });
      return /* @__PURE__ */ jsxRuntimeExports.jsx(SlotClone, { ...slotProps, ref: forwardedRef, children: reactExports.isValidElement(newElement) ? reactExports.cloneElement(newElement, void 0, newChildren) : null });
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SlotClone, { ...slotProps, ref: forwardedRef, children });
  });
  Slot2.displayName = `${ownerName}.Slot`;
  return Slot2;
}
// @__NO_SIDE_EFFECTS__
function createSlotClone$1(ownerName) {
  const SlotClone = reactExports.forwardRef((props, forwardedRef) => {
    let { children, ...slotProps } = props;
    if (isLazyComponent(children) && typeof use === "function") {
      children = use(children._payload);
    }
    if (reactExports.isValidElement(children)) {
      const childrenRef = getElementRef$1(children);
      const props2 = mergeProps$1(slotProps, children.props);
      if (children.type !== reactExports.Fragment) {
        props2.ref = forwardedRef ? composeRefs(forwardedRef, childrenRef) : childrenRef;
      }
      return reactExports.cloneElement(children, props2);
    }
    return reactExports.Children.count(children) > 1 ? reactExports.Children.only(null) : null;
  });
  SlotClone.displayName = `${ownerName}.SlotClone`;
  return SlotClone;
}
var SLOTTABLE_IDENTIFIER$2 = Symbol("radix.slottable");
function isSlottable$1(child) {
  return reactExports.isValidElement(child) && typeof child.type === "function" && "__radixId" in child.type && child.type.__radixId === SLOTTABLE_IDENTIFIER$2;
}
function mergeProps$1(slotProps, childProps) {
  const overrideProps = { ...childProps };
  for (const propName in childProps) {
    const slotPropValue = slotProps[propName];
    const childPropValue = childProps[propName];
    const isHandler = /^on[A-Z]/.test(propName);
    if (isHandler) {
      if (slotPropValue && childPropValue) {
        overrideProps[propName] = (...args) => {
          const result = childPropValue(...args);
          slotPropValue(...args);
          return result;
        };
      } else if (slotPropValue) {
        overrideProps[propName] = slotPropValue;
      }
    } else if (propName === "style") {
      overrideProps[propName] = { ...slotPropValue, ...childPropValue };
    } else if (propName === "className") {
      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(" ");
    }
  }
  return { ...slotProps, ...overrideProps };
}
function getElementRef$1(element) {
  let getter = Object.getOwnPropertyDescriptor(element.props, "ref")?.get;
  let mayWarn = getter && "isReactWarning" in getter && getter.isReactWarning;
  if (mayWarn) {
    return element.ref;
  }
  getter = Object.getOwnPropertyDescriptor(element, "ref")?.get;
  mayWarn = getter && "isReactWarning" in getter && getter.isReactWarning;
  if (mayWarn) {
    return element.props.ref;
  }
  return element.props.ref || element.ref;
}

// src/primitive.tsx
var NODES$2 = [
  "a",
  "button",
  "div",
  "form",
  "h2",
  "h3",
  "img",
  "input",
  "label",
  "li",
  "nav",
  "ol",
  "p",
  "select",
  "span",
  "svg",
  "ul"
];
var Primitive$2 = NODES$2.reduce((primitive, node) => {
  const Slot = createSlot$1(`Primitive.${node}`);
  const Node = reactExports.forwardRef((props, forwardedRef) => {
    const { asChild, ...primitiveProps } = props;
    const Comp = asChild ? Slot : node;
    if (typeof window !== "undefined") {
      window[Symbol.for("radix-ui")] = true;
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Comp, { ...primitiveProps, ref: forwardedRef });
  });
  Node.displayName = `Primitive.${node}`;
  return { ...primitive, [node]: Node };
}, {});

// src/use-is-hydrated.tsx
function useIsHydrated() {
  return shimExports.useSyncExternalStore(
    subscribe$1,
    () => true,
    () => false
  );
}
function subscribe$1() {
  return () => {
  };
}

var AVATAR_NAME = "Avatar";
var [createAvatarContext] = createContextScope$1(AVATAR_NAME);
var [AvatarProvider, useAvatarContext] = createAvatarContext(AVATAR_NAME);
var Avatar$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAvatar, ...avatarProps } = props;
    const [imageLoadingStatus, setImageLoadingStatus] = reactExports.useState("idle");
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      AvatarProvider,
      {
        scope: __scopeAvatar,
        imageLoadingStatus,
        onImageLoadingStatusChange: setImageLoadingStatus,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$2.span, { ...avatarProps, ref: forwardedRef })
      }
    );
  }
);
Avatar$1.displayName = AVATAR_NAME;
var IMAGE_NAME = "AvatarImage";
var AvatarImage$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAvatar, src, onLoadingStatusChange = () => {
    }, ...imageProps } = props;
    const context = useAvatarContext(IMAGE_NAME, __scopeAvatar);
    const imageLoadingStatus = useImageLoadingStatus(src, imageProps);
    const handleLoadingStatusChange = useCallbackRef((status) => {
      onLoadingStatusChange(status);
      context.onImageLoadingStatusChange(status);
    });
    useLayoutEffect2(() => {
      if (imageLoadingStatus !== "idle") {
        handleLoadingStatusChange(imageLoadingStatus);
      }
    }, [imageLoadingStatus, handleLoadingStatusChange]);
    return imageLoadingStatus === "loaded" ? /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$2.img, { ...imageProps, ref: forwardedRef, src }) : null;
  }
);
AvatarImage$1.displayName = IMAGE_NAME;
var FALLBACK_NAME = "AvatarFallback";
var AvatarFallback$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAvatar, delayMs, ...fallbackProps } = props;
    const context = useAvatarContext(FALLBACK_NAME, __scopeAvatar);
    const [canRender, setCanRender] = reactExports.useState(delayMs === void 0);
    reactExports.useEffect(() => {
      if (delayMs !== void 0) {
        const timerId = window.setTimeout(() => setCanRender(true), delayMs);
        return () => window.clearTimeout(timerId);
      }
    }, [delayMs]);
    return canRender && context.imageLoadingStatus !== "loaded" ? /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$2.span, { ...fallbackProps, ref: forwardedRef }) : null;
  }
);
AvatarFallback$1.displayName = FALLBACK_NAME;
function resolveLoadingStatus(image, src) {
  if (!image) {
    return "idle";
  }
  if (!src) {
    return "error";
  }
  if (image.src !== src) {
    image.src = src;
  }
  return image.complete && image.naturalWidth > 0 ? "loaded" : "loading";
}
function useImageLoadingStatus(src, { referrerPolicy, crossOrigin }) {
  const isHydrated = useIsHydrated();
  const imageRef = reactExports.useRef(null);
  const image = (() => {
    if (!isHydrated) return null;
    if (!imageRef.current) {
      imageRef.current = new window.Image();
    }
    return imageRef.current;
  })();
  const [loadingStatus, setLoadingStatus] = reactExports.useState(
    () => resolveLoadingStatus(image, src)
  );
  useLayoutEffect2(() => {
    setLoadingStatus(resolveLoadingStatus(image, src));
  }, [image, src]);
  useLayoutEffect2(() => {
    const updateStatus = (status) => () => {
      setLoadingStatus(status);
    };
    if (!image) return;
    const handleLoad = updateStatus("loaded");
    const handleError = updateStatus("error");
    image.addEventListener("load", handleLoad);
    image.addEventListener("error", handleError);
    if (referrerPolicy) {
      image.referrerPolicy = referrerPolicy;
    }
    if (typeof crossOrigin === "string") {
      image.crossOrigin = crossOrigin;
    }
    return () => {
      image.removeEventListener("load", handleLoad);
      image.removeEventListener("error", handleError);
    };
  }, [image, crossOrigin, referrerPolicy]);
  return loadingStatus;
}
var Root$2 = Avatar$1;
var Image$1 = AvatarImage$1;
var Fallback = AvatarFallback$1;

const Avatar = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Root$2,
  {
    ref,
    className: cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    ),
    ...props
  }
));
Avatar.displayName = Root$2.displayName;
const AvatarImage = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Image$1,
  {
    ref,
    className: cn("aspect-square h-full w-full", className),
    ...props
  }
));
AvatarImage.displayName = Image$1.displayName;
const AvatarFallback = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Fallback,
  {
    ref,
    className: cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    ),
    ...props
  }
));
AvatarFallback.displayName = Fallback.displayName;

const ProfileAvatar = ({
  profileImage,
  className,
  disabled = false
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Avatar, { className: cn(
    "rounded-full border-2 border-[#00D1FF]/30",
    disabled && "opacity-50 cursor-not-allowed",
    className
  ), children: profileImage ? /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarImage, { src: profileImage, alt: "Profile" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarFallback, { className: "bg-gradient-to-r from-[#131524]/80 to-black/80", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "h-5 w-5 text-[#00D1FF]" }) }) });
};

function useToast() {
  const [toasts, setToasts] = reactExports.useState([]);
  const recentToasts = reactExports.useRef(/* @__PURE__ */ new Set());
  const toast2 = reactExports.useCallback(({
    title,
    description,
    variant = "default",
    duration = 4e3,
    action
  }) => {
    const content = title || description || "";
    const toastKey = `${variant}-${content}`;
    if (recentToasts.current.has(toastKey)) {
      return { id: "", dismiss: () => {
      }, update: () => {
      } };
    }
    recentToasts.current.add(toastKey);
    setTimeout(() => {
      recentToasts.current.delete(toastKey);
    }, 2e3);
    const id = Math.random().toString(36).substr(2, 9);
    switch (variant) {
      case "destructive":
        ue$1.error(title || description || "Errore", {
          description: title ? description : void 0,
          duration
        });
        break;
      default:
        ue$1.success(title || description || "Successo", {
          description: title ? description : void 0,
          duration
        });
    }
    const newToast = { id, title, description, variant, duration, action };
    setToasts((prev) => [...prev, newToast]);
    setTimeout(() => {
      setToasts((prev) => prev.filter((t) => t.id !== id));
    }, duration);
    return {
      id,
      dismiss: () => setToasts((prev) => prev.filter((t) => t.id !== id)),
      update: (newToast2) => setToasts((prev) => prev.map((t) => t.id === id ? { ...t, ...newToast2 } : t))
    };
  }, []);
  return { toast: toast2, toasts };
}

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default: "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary: "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive: "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground"
      }
    },
    defaultVariants: {
      variant: "default"
    }
  }
);
function Badge({ className, variant, ...props }) {
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn(badgeVariants({ variant }), className), ...props });
}

const useReferralCode = () => {
  const [referralCode, setReferralCode] = reactExports.useState("");
  const [loading, setLoading] = reactExports.useState(true);
  const { toast } = useToast();
  reactExports.useEffect(() => {
    const fetchReferralCode = async () => {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        const { data, error } = await supabase.from("profiles").select("referral_code").eq("id", user.id).single();
        if (error) {
          console.error("Error fetching referral code:", error);
          return;
        }
        if (data?.referral_code) {
          setReferralCode(data.referral_code);
        }
      } catch (error) {
        console.error("Error in fetchReferralCode:", error);
      } finally {
        setLoading(false);
      }
    };
    fetchReferralCode();
  }, []);
  const copyReferralCode = () => {
    if (referralCode) {
      navigator.clipboard.writeText(referralCode);
      toast({
        title: "Codice copiato!",
        description: `Il tuo codice referral ${referralCode} è stato copiato negli appunti.`
      });
    }
  };
  return {
    referralCode,
    loading,
    copyReferralCode
  };
};

// src/create-context.tsx
function createContextScope(scopeName, createContextScopeDeps = []) {
  let defaultContexts = [];
  function createContext3(rootComponentName, defaultContext) {
    const BaseContext = reactExports.createContext(defaultContext);
    BaseContext.displayName = rootComponentName + "Context";
    const index = defaultContexts.length;
    defaultContexts = [...defaultContexts, defaultContext];
    const Provider = (props) => {
      const { scope, children, ...context } = props;
      const Context = scope?.[scopeName]?.[index] || BaseContext;
      const value = reactExports.useMemo(() => context, Object.values(context));
      return /* @__PURE__ */ jsxRuntimeExports.jsx(Context.Provider, { value, children });
    };
    Provider.displayName = rootComponentName + "Provider";
    function useContext2(consumerName, scope) {
      const Context = scope?.[scopeName]?.[index] || BaseContext;
      const context = reactExports.useContext(Context);
      if (context) return context;
      if (defaultContext !== void 0) return defaultContext;
      throw new Error(`\`${consumerName}\` must be used within \`${rootComponentName}\``);
    }
    return [Provider, useContext2];
  }
  const createScope = () => {
    const scopeContexts = defaultContexts.map((defaultContext) => {
      return reactExports.createContext(defaultContext);
    });
    return function useScope(scope) {
      const contexts = scope?.[scopeName] || scopeContexts;
      return reactExports.useMemo(
        () => ({ [`__scope${scopeName}`]: { ...scope, [scopeName]: contexts } }),
        [scope, contexts]
      );
    };
  };
  createScope.scopeName = scopeName;
  return [createContext3, composeContextScopes(createScope, ...createContextScopeDeps)];
}
function composeContextScopes(...scopes) {
  const baseScope = scopes[0];
  if (scopes.length === 1) return baseScope;
  const createScope = () => {
    const scopeHooks = scopes.map((createScope2) => ({
      useScope: createScope2(),
      scopeName: createScope2.scopeName
    }));
    return function useComposedScopes(overrideScopes) {
      const nextScopes = scopeHooks.reduce((nextScopes2, { useScope, scopeName }) => {
        const scopeProps = useScope(overrideScopes);
        const currentScope = scopeProps[`__scope${scopeName}`];
        return { ...nextScopes2, ...currentScope };
      }, {});
      return reactExports.useMemo(() => ({ [`__scope${baseScope.scopeName}`]: nextScopes }), [nextScopes]);
    };
  };
  createScope.scopeName = baseScope.scopeName;
  return createScope;
}

// src/primitive.tsx
var NODES$1 = [
  "a",
  "button",
  "div",
  "form",
  "h2",
  "h3",
  "img",
  "input",
  "label",
  "li",
  "nav",
  "ol",
  "p",
  "select",
  "span",
  "svg",
  "ul"
];
var Primitive$1 = NODES$1.reduce((primitive, node) => {
  const Slot = createSlot$1(`Primitive.${node}`);
  const Node = reactExports.forwardRef((props, forwardedRef) => {
    const { asChild, ...primitiveProps } = props;
    const Comp = asChild ? Slot : node;
    if (typeof window !== "undefined") {
      window[Symbol.for("radix-ui")] = true;
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Comp, { ...primitiveProps, ref: forwardedRef });
  });
  Node.displayName = `Primitive.${node}`;
  return { ...primitive, [node]: Node };
}, {});

var PROGRESS_NAME = "Progress";
var DEFAULT_MAX = 100;
var [createProgressContext] = createContextScope(PROGRESS_NAME);
var [ProgressProvider, useProgressContext] = createProgressContext(PROGRESS_NAME);
var Progress$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeProgress,
      value: valueProp = null,
      max: maxProp,
      getValueLabel = defaultGetValueLabel,
      ...progressProps
    } = props;
    if ((maxProp || maxProp === 0) && !isValidMaxNumber(maxProp)) {
      console.error(getInvalidMaxError(`${maxProp}`, "Progress"));
    }
    const max = isValidMaxNumber(maxProp) ? maxProp : DEFAULT_MAX;
    if (valueProp !== null && !isValidValueNumber(valueProp, max)) {
      console.error(getInvalidValueError(`${valueProp}`, "Progress"));
    }
    const value = isValidValueNumber(valueProp, max) ? valueProp : null;
    const valueLabel = isNumber(value) ? getValueLabel(value, max) : void 0;
    return /* @__PURE__ */ jsxRuntimeExports.jsx(ProgressProvider, { scope: __scopeProgress, value, max, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$1.div,
      {
        "aria-valuemax": max,
        "aria-valuemin": 0,
        "aria-valuenow": isNumber(value) ? value : void 0,
        "aria-valuetext": valueLabel,
        role: "progressbar",
        "data-state": getProgressState(value, max),
        "data-value": value ?? void 0,
        "data-max": max,
        ...progressProps,
        ref: forwardedRef
      }
    ) });
  }
);
Progress$1.displayName = PROGRESS_NAME;
var INDICATOR_NAME$2 = "ProgressIndicator";
var ProgressIndicator = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeProgress, ...indicatorProps } = props;
    const context = useProgressContext(INDICATOR_NAME$2, __scopeProgress);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$1.div,
      {
        "data-state": getProgressState(context.value, context.max),
        "data-value": context.value ?? void 0,
        "data-max": context.max,
        ...indicatorProps,
        ref: forwardedRef
      }
    );
  }
);
ProgressIndicator.displayName = INDICATOR_NAME$2;
function defaultGetValueLabel(value, max) {
  return `${Math.round(value / max * 100)}%`;
}
function getProgressState(value, maxValue) {
  return value == null ? "indeterminate" : value === maxValue ? "complete" : "loading";
}
function isNumber(value) {
  return typeof value === "number";
}
function isValidMaxNumber(max) {
  return isNumber(max) && !isNaN(max) && max > 0;
}
function isValidValueNumber(value, max) {
  return isNumber(value) && !isNaN(value) && value <= max && value >= 0;
}
function getInvalidMaxError(propValue, componentName) {
  return `Invalid prop \`max\` of value \`${propValue}\` supplied to \`${componentName}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${DEFAULT_MAX}\`.`;
}
function getInvalidValueError(propValue, componentName) {
  return `Invalid prop \`value\` of value \`${propValue}\` supplied to \`${componentName}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${DEFAULT_MAX} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`;
}
var Root$1 = Progress$1;
var Indicator$1 = ProgressIndicator;

const Progress = reactExports.forwardRef(({ className, value, indicatorClassName, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Root$1,
  {
    ref,
    className: cn(
      "relative h-2 w-full overflow-hidden rounded-full bg-primary/20",
      className
    ),
    ...props,
    children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Indicator$1,
      {
        className: cn(
          "h-full w-full flex-1 bg-gradient-to-r from-m1ssion-blue to-blue-600 transition-all",
          indicatorClassName
        ),
        style: { transform: `translateX(-${100 - (value || 0)}%)` }
      }
    )
  }
));
Progress.displayName = Root$1.displayName;

const XpLevelProgress = ({ totalXp, className }) => {
  const level = Math.floor(totalXp / 1e3) + 1;
  const xpInCurrentLevel = totalXp % 1e3;
  const xpNeededForNextLevel = 1e3;
  const progressPercentage = xpInCurrentLevel / xpNeededForNextLevel * 100;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `space-y-3 ${className}`, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "p-2 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-full",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "w-5 h-5 text-white" })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400", children: "Livello" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-2xl font-bold gradient-text", children: level })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400", children: "XP Totale" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xl font-semibold text-cyan-400 flex items-center gap-1", children: [
          totalXp.toLocaleString(),
          /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingUp, { className: "w-4 h-4" })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-xs text-gray-400", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
          xpInCurrentLevel,
          " XP"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
          xpNeededForNextLevel,
          " XP"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Progress,
          {
            value: progressPercentage,
            className: "h-3 bg-gray-800/50 border border-cyan-500/20"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 h-3 rounded-full bg-gradient-to-r from-cyan-500/20 to-purple-500/20 pointer-events-none"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-center text-gray-500", children: [
        xpNeededForNextLevel - xpInCurrentLevel,
        " XP al prossimo livello"
      ] })
    ] })
  ] });
};

function DailyCheckInButton() {
  const { user } = useAuthContext();
  const [loading, setLoading] = reactExports.useState(false);
  const [currentStreak, setCurrentStreak] = reactExports.useState(0);
  const [canCheckIn, setCanCheckIn] = reactExports.useState(true);
  const [lastCheckIn, setLastCheckIn] = reactExports.useState(null);
  reactExports.useEffect(() => {
    if (user) {
      loadStreakData();
    }
  }, [user]);
  const loadStreakData = async () => {
    if (!user) return;
    try {
      const { data, error } = await supabase.from("profiles").select("current_streak_days, last_check_in_date").eq("id", user.id).single();
      if (error) throw error;
      if (data) {
        setCurrentStreak(data.current_streak_days || 0);
        setLastCheckIn(data.last_check_in_date);
        const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
        setCanCheckIn(data.last_check_in_date !== today);
      }
    } catch (err) {
      console.error("Error loading streak data:", err);
    }
  };
  const handleCheckIn = async () => {
    if (!user || !canCheckIn) return;
    setLoading(true);
    try {
      const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
      const yesterday = new Date(Date.now() - 864e5).toISOString().split("T")[0];
      let newStreak = currentStreak;
      if (!lastCheckIn || lastCheckIn === yesterday) {
        newStreak = currentStreak + 1;
      } else if (lastCheckIn !== today) {
        newStreak = 1;
        ue$1.warning("⚠️ La tua streak è stata resettata", { duration: 3e3 });
      }
      const { error: updateError } = await supabase.from("profiles").update({
        current_streak_days: newStreak,
        last_check_in_date: today
      }).eq("id", user.id);
      if (updateError) throw updateError;
      const { error: xpError } = await supabase.rpc("award_xp", {
        p_user_id: user.id,
        p_xp_amount: 10,
        p_source: "daily_checkin"
      });
      if (xpError) console.error("XP award error:", xpError);
      setCurrentStreak(newStreak);
      setCanCheckIn(false);
      setLastCheckIn(today);
      ue$1.success(
        `🔥 Check-in completato! Streak: ${newStreak} giorni (+10 XP)`,
        { duration: 3e3 }
      );
    } catch (err) {
      console.error("Error during check-in:", err);
      ue$1.error("Errore durante il check-in");
    } finally {
      setLoading(false);
    }
  };
  if (!user) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "flex flex-col items-center gap-2",
      initial: { scale: 0.9, opacity: 0 },
      animate: { scale: 1, opacity: 1 },
      transition: { duration: 0.15 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 text-primary", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Flame, { className: "h-5 w-5" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-lg font-bold", children: [
              currentStreak,
              " giorni"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Streak corrente" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleCheckIn,
            disabled: !canCheckIn || loading,
            className: "relative overflow-hidden",
            size: "sm",
            children: loading ? "Attendere..." : canCheckIn ? "✓ Check-in Giornaliero" : "✓ Completato oggi"
          }
        ),
        !canCheckIn && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Torna domani per continuare la streak!" })
      ]
    }
  );
}

const ProfileToast = ({ isOpen, onClose, className }) => {
  const [profileData, setProfileData] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  const [isLoggingOut, setIsLoggingOut] = reactExports.useState(false);
  const { referralCode, copyReferralCode } = useReferralCode();
  const { toast } = useToast();
  const { logout } = useAuthContext();
  const [, setLocation] = useLocation();
  const { xpStatus } = useXpSystem();
  const totalXp = xpStatus?.total_xp ?? 0;
  reactExports.useEffect(() => {
    if (isOpen) {
      fetchProfileData();
      const interval = setInterval(() => {
        fetchProfileData();
      }, 1e3);
      const subscription = supabase.channel("profile-updates").on(
        "postgres_changes",
        { event: "*", schema: "public", table: "user_mission_status" },
        () => {
          console.log("🔄 M1SSION™ Real-time update detected - refreshing ProfileToast data");
          fetchProfileData();
        }
      ).on(
        "postgres_changes",
        { event: "*", schema: "public", table: "profiles" },
        () => {
          console.log("🔄 M1SSION™ Profile update detected - refreshing data");
          fetchProfileData();
        }
      ).subscribe();
      return () => {
        clearInterval(interval);
        subscription.unsubscribe();
      };
    }
  }, [isOpen]);
  const fetchProfileData = async () => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      console.log("🔄 M1SSION™ ProfileToast fetching real-time data...");
      const { data: profile } = await supabase.from("profiles").select("username, full_name, subscription_tier").eq("id", user.id).single();
      const { data: missionStatus } = await supabase.from("user_mission_status").select("clues_found, mission_started_at, mission_days_remaining").eq("user_id", user.id).single();
      let daysRemaining = 30;
      if (missionStatus?.mission_started_at) {
        const startDate = new Date(missionStatus.mission_started_at);
        const currentDate = /* @__PURE__ */ new Date();
        const daysPassed = Math.floor((currentDate.getTime() - startDate.getTime()) / (1e3 * 60 * 60 * 24));
        daysRemaining = Math.max(0, 30 - daysPassed);
        console.log("🔄 M1SSION™ Real-time days calculation:", {
          startDate: startDate.toISOString(),
          currentDate: currentDate.toISOString(),
          daysPassed,
          daysRemaining
        });
      }
      const { data: subscription } = await supabase.from("subscriptions").select("tier").eq("user_id", user.id).eq("status", "active").single();
      let userTier = subscription?.tier || profile?.subscription_tier || "Base";
      console.log("🔄 M1SSION™ ProfileToast sync data:", {
        daysRemaining,
        cluesFound: missionStatus?.clues_found || 0,
        tier: userTier
      });
      setProfileData({
        username: profile?.username || profile?.full_name || "Agente",
        email: user.email || "",
        cluesFound: missionStatus?.clues_found || 0,
        totalClues: 12,
        // Total clues in the mission
        daysRemaining,
        // Use real-time calculated value
        missionStartDate: missionStatus?.mission_started_at || (/* @__PURE__ */ new Date()).toISOString(),
        subscriptionTier: userTier
      });
    } catch (error) {
      console.error("❌ M1SSION™ Error fetching profile data:", error);
    } finally {
      setLoading(false);
    }
  };
  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString("it-IT", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric"
    });
  };
  const handleLogout = async () => {
    setIsLoggingOut(true);
    try {
      await logout();
      onClose();
      setLocation("/login");
      toast({
        title: "Logout effettuato",
        description: "Sei stato disconnesso con successo"
      });
    } catch (error) {
      console.error("Error during logout:", error);
      toast({
        title: "Errore",
        description: "Errore durante il logout",
        variant: "destructive"
      });
    } finally {
      setIsLoggingOut(false);
    }
  };
  const handleUpgrade = () => {
    onClose();
    setLocation("/subscriptions");
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isOpen && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        exit: { opacity: 0 },
        className: "fixed inset-0 bg-black/50 backdrop-blur-sm z-50",
        onClick: onClose
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, scale: 0.9, y: -20 },
        animate: { opacity: 1, scale: 1, y: 0 },
        exit: { opacity: 0, scale: 0.9, y: -20 },
        transition: { duration: 0.2, ease: "easeOut" },
        className: `fixed top-20 right-4 w-80 max-h-[100dvh] bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur-xl border border-slate-700/50 rounded-xl shadow-2xl z-50 overflow-hidden ${className}`,
        style: {
          boxShadow: "0 20px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1)",
          touchAction: "pan-y"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-4 border-b border-slate-700/50", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-full flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-4 h-4 text-white" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-orbitron font-bold text-white", children: "Profilo Agente" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                variant: "ghost",
                size: "icon",
                onClick: onClose,
                className: "w-8 h-8 rounded-full hover:bg-white/10",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-4 h-4" })
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "div",
            {
              className: "p-4 space-y-4 overflow-y-auto overscroll-contain",
              "data-profile-scroll": "enabled",
              style: {
                maxHeight: "calc(100dvh - 5rem - var(--m1-bottom-nav) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px))",
                paddingBottom: "calc(var(--m1-bottom-nav) + env(safe-area-inset-bottom, 0px) + 16px)",
                WebkitOverflowScrolling: "touch",
                touchAction: "pan-y"
              },
              children: loading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500" }) }) : profileData ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border border-slate-700/50 rounded-lg p-3 bg-slate-900/50", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-semibold text-blue-400", children: "Livello & PE" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-gray-400", children: [
                      "Totale: ",
                      totalXp,
                      " PE"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(XpLevelProgress, { totalXp }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-3 pt-3 border-t border-slate-700/50", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "text-xs text-gray-300 mb-2", children: "Check-in giornaliero" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(DailyCheckInButton, {})
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-4 h-4 text-blue-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Nome utente:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium", children: profileData.username })
                ] }),
                referralCode && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-blue-400 rounded-full animate-pulse" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Codice referral:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-mono text-sm bg-slate-800 px-2 py-1 rounded", children: referralCode }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Button,
                      {
                        variant: "ghost",
                        size: "icon",
                        onClick: copyReferralCode,
                        className: "w-6 h-6 rounded hover:bg-white/10",
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Copy, { className: "w-3 h-3" })
                      }
                    )
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Email:" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium text-sm", children: profileData.email })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t border-slate-700/50 pt-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-semibold text-blue-400 mb-3", children: "Stato Missione" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-4 h-4 text-green-400" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Indizi trovati:" })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white font-medium", children: [
                        profileData.cluesFound,
                        "/",
                        profileData.totalClues
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-4 h-4 text-orange-400" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Giorni rimanenti:" })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium", children: profileData.daysRemaining })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-4 h-4 text-blue-400" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Inizio missione:" })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium text-sm", children: formatDate(profileData.missionStartDate) })
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t border-slate-700/50 pt-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-semibold text-blue-400 mb-3", children: "Abbonamento" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: "Piano attuale:" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Badge,
                        {
                          variant: "secondary",
                          className: cn(
                            "font-semibold transition-all duration-300",
                            profileData.subscriptionTier === "Base" && "bg-gray-500 text-white",
                            profileData.subscriptionTier === "Silver" && "bg-gradient-to-r from-gray-300 to-gray-500 text-gray-900",
                            profileData.subscriptionTier === "Gold" && "bg-gradient-to-r from-amber-400 to-amber-600 text-white shadow-md",
                            profileData.subscriptionTier === "Black" && "bg-gradient-to-r from-gray-800 to-gray-900 text-white shadow-lg",
                            profileData.subscriptionTier === "Titanium" && "bg-gradient-to-r from-purple-500 to-cyan-500 text-white animate-pulse shadow-[0_0_20px_rgba(168,85,247,0.5)]"
                          ),
                          children: profileData.subscriptionTier?.toUpperCase() || "BASE"
                        }
                      )
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(
                      Button,
                      {
                        onClick: handleUpgrade,
                        variant: "outline",
                        size: "sm",
                        className: "w-full bg-gradient-to-r from-blue-500/20 to-cyan-500/20 border-blue-500/50 text-blue-400 hover:bg-blue-500/30",
                        children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "w-4 h-4 mr-2" }),
                          "Upgrade"
                        ]
                      }
                    )
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "border-t border-slate-700/50 pt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Button,
                  {
                    onClick: handleLogout,
                    variant: "outline",
                    size: "sm",
                    className: "w-full border-red-500/50 text-red-400 hover:bg-red-500/20",
                    disabled: isLoggingOut,
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(LogOut, { className: "w-4 h-4 mr-2" }),
                      isLoggingOut ? "Disconnessione..." : "Esci"
                    ]
                  }
                ) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { "aria-hidden": true, className: "h-24 sm:h-16" })
              ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-4 text-gray-400", children: "Errore nel caricamento dei dati" })
            }
          )
        ]
      }
    )
  ] }) });
};

const PulseEnergyBadge = ({ rank, className = "", showCode = true }) => {
  if (!rank) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: `inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-gray-800/50 border border-gray-700 ${className}`,
        "data-testid": "pe-badge-unavailable",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-4 h-4 text-gray-500" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-500", children: "Grado Non Disponibile" })
        ]
      }
    );
  }
  const isBaseRank = rank.code === "AG-01";
  const displayColor = isBaseRank ? "#4A90E2" : rank.color;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `inline-flex items-center gap-2 px-3 py-1.5 rounded-md border ${className}`,
      style: {
        backgroundColor: `${displayColor}20`,
        borderColor: displayColor,
        boxShadow: `0 0 12px ${displayColor}40`,
        minHeight: "40px"
        // Increased for better visibility
      },
      "data-testid": "pe-badge",
      "data-rank-code": rank.code,
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg", role: "img", "aria-label": "rank symbol", children: rank.symbol }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-bold leading-tight", style: { color: displayColor }, children: rank.name_it }),
          showCode && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[10px] font-mono leading-tight", style: { color: displayColor, opacity: 0.7 }, children: rank.code })
        ] })
      ]
    }
  );
};

const PulseEnergyProgressBar = ({
  currentRank,
  nextRank,
  progressPercent,
  currentPE,
  className = ""
}) => {
  if (!nextRank) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `space-y-2 ${className}`, "data-testid": "pe-progress-max", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "PE Totali" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-bold text-cyan-400", children: [
          currentPE.toLocaleString("it-IT"),
          " PE"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-md bg-gradient-to-r from-amber-900/30 to-yellow-900/30 border border-amber-500/50", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingUp, { className: "w-4 h-4 text-amber-400" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-amber-400 font-bold", children: "GRADO MASSIMO RAGGIUNTO" })
      ] }) })
    ] });
  }
  const peNeeded = nextRank.pe_min - currentPE;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `space-y-2 ${className}`, "data-testid": "pe-progress-active", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "PE Totali" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-bold text-cyan-400", children: [
        currentPE.toLocaleString("it-IT"),
        " PE"
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      Progress,
      {
        value: progressPercent,
        className: "h-2 bg-gray-800",
        "data-testid": "pe-progress-bar"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-500", children: currentRank?.name_it || "Attuale" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-cyan-400 font-medium", children: [
        peNeeded.toLocaleString("it-IT"),
        " PE al prossimo grado"
      ] })
    ] })
  ] });
};

const usePulseEnergy = () => {
  const xpSystem = useXpSystem();
  const [ranks, setRanks] = reactExports.useState([]);
  const [ranksLoading, setRanksLoading] = reactExports.useState(true);
  const [userRankId, setUserRankId] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const fetchRanks = async () => {
      try {
        const { data, error } = await supabase.from("agent_ranks").select("*").order("pe_min", { ascending: true });
        if (error) {
          console.warn("[usePulseEnergy] Failed to fetch ranks:", error.message);
          setRanks([]);
        } else if (data) {
          setRanks(data);
        }
      } catch (err) {
        console.error("[usePulseEnergy] Exception fetching ranks:", err);
        setRanks([]);
      } finally {
        setRanksLoading(false);
      }
    };
    fetchRanks();
  }, []);
  reactExports.useEffect(() => {
    const fetchUserRank = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session?.user) return;
        const { data, error } = await supabase.from("profiles").select("rank_id").eq("id", session.user.id).single();
        if (!error && data?.rank_id) {
          setUserRankId(data.rank_id);
          console.log("[usePulseEnergy] User rank_id from DB:", data.rank_id);
        }
      } catch (err) {
        console.error("[usePulseEnergy] Error fetching user rank:", err);
      }
    };
    fetchUserRank();
  }, []);
  const pulseEnergy = xpSystem.xpStatus.total_xp;
  const currentRank = reactExports.useMemo(() => {
    if (ranks.length === 0) return null;
    if (userRankId !== null) {
      const assignedRank = ranks.find((r) => r.id === userRankId);
      if (assignedRank) {
        console.log("[usePulseEnergy] Using assigned rank_id:", assignedRank.code);
        return assignedRank;
      }
    }
    for (let i = ranks.length - 1; i >= 0; i--) {
      const rank = ranks[i];
      if (pulseEnergy >= rank.pe_min) {
        if (rank.pe_max === null || pulseEnergy < rank.pe_max) {
          return rank;
        }
      }
    }
    return ranks[0] || null;
  }, [ranks, pulseEnergy, userRankId]);
  const nextRank = reactExports.useMemo(() => {
    if (!currentRank || ranks.length === 0) return null;
    const currentIndex = ranks.findIndex((r) => r.id === currentRank.id);
    if (currentIndex === -1 || currentIndex === ranks.length - 1) return null;
    return ranks[currentIndex + 1];
  }, [ranks, currentRank]);
  const progressToNextRank = reactExports.useMemo(() => {
    if (!currentRank || !nextRank) return 100;
    const rangeSize = nextRank.pe_min - currentRank.pe_min;
    const progressInRange = pulseEnergy - currentRank.pe_min;
    return Math.min(100, Math.max(0, progressInRange / rangeSize * 100));
  }, [currentRank, nextRank, pulseEnergy]);
  return {
    pulseEnergy,
    currentRank,
    nextRank,
    progressToNextRank,
    buzzCredits: xpSystem.xpStatus.free_buzz_credit,
    buzzMapCredits: xpSystem.xpStatus.free_buzz_map_credit,
    loading: xpSystem.loading || ranksLoading,
    hasNewRewards: xpSystem.hasNewRewards,
    consumeCredit: xpSystem.consumeCredit,
    refreshPulseEnergy: xpSystem.refreshXpStatus,
    markRewardsAsSeen: xpSystem.markRewardsAsSeen,
    ranksAvailable: ranks.length > 0
  };
};

const ProfileDropdown = ({
  profileImage,
  className = ""
}) => {
  const [isOpen, setIsOpen] = reactExports.useState(false);
  const [showProfileToast, setShowProfileToast] = reactExports.useState(false);
  const { user, logout } = useAuth();
  const { navigate } = useWouterNavigation();
  const { toast } = useToast();
  const dropdownRef = reactExports.useRef(null);
  const { pulseEnergy, currentRank, nextRank, progressToNextRank, loading: peLoading } = usePulseEnergy();
  reactExports.useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setIsOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);
  const handleLogout = async () => {
    try {
      await logout();
      toast({
        title: "✅ Logout completato",
        description: "Sei stato disconnesso con successo."
      });
      navigate("/auth");
    } catch (error) {
      toast({
        title: "❌ Errore logout",
        description: "Impossibile disconnettersi. Riprova.",
        variant: "destructive"
      });
    }
  };
  const handleSettingsClick = () => {
    setIsOpen(false);
    navigate("/settings");
  };
  const handleAvatarClick = () => {
    setShowProfileToast(true);
    setIsOpen(false);
  };
  const displayName = user?.user_metadata?.full_name || `${user?.user_metadata?.first_name || ""} ${user?.user_metadata?.last_name || ""}`.trim() || "Joseph";
  const email = user?.email || "wikus77@hotmail.it";
  const userId = user?.id ? user.id.substring(0, 8) : "N/A";
  const subscriptionTier = user?.user_metadata?.subscription_tier || "m1ssion+";
  const getTierDisplay = () => {
    switch (subscriptionTier.toLowerCase()) {
      case "black":
        return { name: "Black", color: "bg-gray-800 text-white", emoji: "⚫" };
      case "elite":
        return { name: "Elite", color: "bg-amber-600 text-white", emoji: "🏆" };
      case "m1ssion+":
        return { name: "M1SSION+", color: "bg-gradient-to-r from-purple-600 to-blue-600 text-white", emoji: "👑" };
      default:
        return { name: "M1SSION+", color: "bg-gradient-to-r from-purple-600 to-blue-600 text-white", emoji: "👑" };
    }
  };
  const tierInfo = getTierDisplay();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `relative ${className}`, ref: dropdownRef, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        variant: "ghost",
        className: "p-1 rounded-full hover:bg-white/10 transition-colors",
        onClick: handleAvatarClick,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          ProfileAvatar,
          {
            profileImage,
            className: "w-10 h-10 border-2 border-[#00D1FF]/30 hover:border-[#00D1FF] transition-colors"
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isOpen && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, y: -10, scale: 0.95 },
        animate: { opacity: 1, y: 0, scale: 1 },
        exit: { opacity: 0, y: -10, scale: 0.95 },
        transition: { duration: 0.2, ease: "easeOut" },
        className: "absolute right-0 mt-2 w-80 z-[99999]",
        style: {
          top: "calc(100% + 8px)",
          maxWidth: "calc(100vw - 32px)",
          position: "absolute",
          right: "0px",
          left: "auto",
          transform: "none"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/95 border-[#00D1FF]/30 backdrop-blur-xl shadow-2xl border-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-4 space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3 pb-3 border-b border-white/10", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              ProfileAvatar,
              {
                profileImage,
                className: "w-12 h-12 border-2 border-[#00D1FF]/30"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-orbitron font-semibold text-white text-sm", children: displayName }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-xs", children: email }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/50 text-xs", children: [
                "ID: ",
                userId
              ] })
            ] })
          ] }),
          !peLoading && currentRank && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t border-white/10 pt-3 space-y-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-between", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/70 text-xs", children: "Grado Agente" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(PulseEnergyBadge, { rank: currentRank, showCode: true }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              PulseEnergyProgressBar,
              {
                currentRank,
                nextRank,
                progressPercent: progressToNextRank,
                currentPE: pulseEnergy
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/70 text-sm", children: "Piano attivo:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: `px-3 py-1 rounded-full text-xs font-medium ${tierInfo.color}`, children: [
              tierInfo.emoji,
              " ",
              tierInfo.name
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 pt-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "ghost",
                className: "w-full justify-start text-white/90 hover:bg-white/10",
                onClick: handleSettingsClick,
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 mr-3" }),
                  "Modifica profilo"
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "ghost",
                className: "w-full justify-start text-red-400 hover:bg-red-500/10 hover:text-red-300",
                onClick: handleLogout,
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(LogOut, { className: "w-4 h-4 mr-3" }),
                  "Esci"
                ]
              }
            )
          ] })
        ] }) })
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      ProfileToast,
      {
        isOpen: showProfileToast,
        onClose: () => setShowProfileToast(false)
      }
    )
  ] });
};

const useNavigationStore = create$1()(
  persist(
    (set, get) => ({
      // State
      currentTab: "/",
      history: ["/"],
      isCapacitor: false,
      lastNavigation: Date.now(),
      // Actions
      setCurrentTab: (tab) => {
        console.log("🏪 Navigation Store: Setting current tab to:", tab);
        set({
          currentTab: tab,
          lastNavigation: Date.now()
        });
      },
      addToHistory: (path) => {
        const { history } = get();
        const newHistory = [...history, path].slice(-10);
        console.log("🏪 Navigation Store: Adding to history:", path);
        set({
          history: newHistory,
          lastNavigation: Date.now()
        });
      },
      goBack: () => {
        const { history } = get();
        if (history.length > 1) {
          const newHistory = history.slice(0, -1);
          const previousPath = newHistory[newHistory.length - 1];
          set({
            history: newHistory,
            currentTab: previousPath,
            lastNavigation: Date.now()
          });
          console.log("🏪 Navigation Store: Going back to:", previousPath);
          return previousPath;
        }
        return null;
      },
      clearHistory: () => {
        console.log("🏪 Navigation Store: Clearing history");
        set({
          history: ["/"],
          currentTab: "/",
          lastNavigation: Date.now()
        });
      },
      setCapacitorMode: (isCapacitor) => {
        console.log("🏪 Navigation Store: Setting Capacitor mode:", isCapacitor);
        set({
          isCapacitor,
          lastNavigation: Date.now()
        });
      },
      getNavigationInfo: () => {
        return get();
      }
    }),
    {
      name: "m1ssion-navigation-store",
      partialize: (state) => ({
        currentTab: state.currentTab,
        history: state.history,
        isCapacitor: state.isCapacitor
      })
    }
  )
);
console.log("✅ M1SSION Navigation Store initialized");

const Capacitor = {
  isNativePlatform: () => false,
  getPlatform: () => "web"
};
const PushNotifications = {
  requestPermissions: async () => ({
    receive: "granted"
  }),
  register: async () => Promise.resolve(),
  addListener: () => ({
    remove: () => {
    }
  }),
  removeAllListeners: () => Promise.resolve(),
  removeAllDeliveredNotifications: () => Promise.resolve(),
  getDeliveredNotifications: () => Promise.resolve({ notifications: [] }),
  checkPermissions: async () => ({
    receive: "granted"
  })
};

const AUDIO_MAP = {
  success: "/assets/audio/success.mp3",
  error: "/assets/audio/error.mp3",
  chime: "/assets/audio/chime.mp3",
  beep: "/assets/audio/beep.mp3",
  start: "/assets/audio/start.mp3",
  level_complete: "/assets/audio/level_complete.mp3",
  victory: "/assets/audio/victory.mp3"
};
class AudioManager {
  audioCache = /* @__PURE__ */ new Map();
  isEnabled = true;
  constructor() {
  }
  async preloadAudio() {
    try {
      for (const [key, path] of Object.entries(AUDIO_MAP)) {
        const audio = new Audio(path);
        audio.preload = "auto";
        this.audioCache.set(key, audio);
      }
    } catch (error) {
      console.warn("Errore nel precaricamento audio:", error);
    }
  }
  setEnabled(enabled) {
    this.isEnabled = enabled;
  }
  async playSound(soundKey) {
    if (!this.isEnabled) return;
    try {
      let audio = this.audioCache.get(soundKey);
      if (!audio && AUDIO_MAP[soundKey]) {
        audio = new Audio(AUDIO_MAP[soundKey]);
        this.audioCache.set(soundKey, audio);
      }
      if (audio) {
        audio.currentTime = 0;
        await audio.play();
      }
    } catch (error) {
      console.warn(`Impossibile riprodurre suono ${soundKey}:`, error);
    }
  }
}
const audioManager = new AudioManager();
const playSound = (soundKey) => audioManager.playSound(soundKey);

const HAPTIC_PATTERNS = {
  // Notifiche
  tick: [10],
  // Feedback leggero
  buzzUnlocked: [0, 100, 50, 100],
  // Pattern distintivo
  missionComplete: [0, 50, 50, 100, 50, 150],
  timeExpired: [0, 300],
  important: [0, 50, 100, 50, 200, 50, 50],
  // XP/Rewards
  xpSmall: [30],
  xpMedium: [0, 50, 30, 50],
  xpLarge: [0, 50, 50, 100, 50, 150],
  levelUp: [0, 100, 100, 100, 100, 200],
  // Interazioni
  selection: [15],
  success: [0, 50, 50, 100],
  error: [300],
  // Giochi
  cardFlip: [15],
  match: [0, 50, 30, 50],
  wrong: [200],
  victory: [0, 100, 50, 100, 50, 200]
};
class HapticManager {
  isEnabled = true;
  constructor() {
    const saved = localStorage.getItem("haptics-enabled");
    if (saved !== null) {
      this.isEnabled = saved === "true";
    }
  }
  async trigger(type) {
    if (!this.isEnabled || !("vibrate" in navigator)) return;
    const pattern = HAPTIC_PATTERNS[type];
    try {
      navigator.vibrate(pattern);
      console.log("📳 Haptic triggered:", type);
    } catch (error) {
      console.warn("⚠️ Haptic failed:", error);
    }
  }
  setEnabled(enabled) {
    this.isEnabled = enabled;
    localStorage.setItem("haptics-enabled", String(enabled));
    console.log("📳 Haptics", enabled ? "enabled" : "disabled");
  }
  getEnabled() {
    return this.isEnabled;
  }
  isSupported() {
    return "vibrate" in navigator;
  }
}
const hapticManager = new HapticManager();

const usePWAHardwareStub = () => {
  const [state] = reactExports.useState({
    isPWA: typeof window !== "undefined" && window.matchMedia("(display-mode: standalone)").matches,
    deviceInfo: { platform: "web", userAgent: navigator.userAgent },
    networkStatus: navigator.onLine ? "online" : "offline",
    orientation: "portrait"
  });
  const vibrate = async (duration = 200) => {
    if ("vibrate" in navigator) {
      try {
        navigator.vibrate(duration);
        console.log("📳 Vibration triggered");
      } catch (error) {
        console.warn("⚠️ Vibration failed:", error);
      }
    }
  };
  const triggerHaptic = async (type) => {
    await hapticManager.trigger(type);
  };
  return {
    ...state,
    vibrate,
    triggerHaptic,
    playSound,
    isLoading: false
  };
};

const useEnhancedNavigation = () => {
  const { navigate, currentPath: location } = useWouterNavigation();
  const { isPWA, triggerHaptic } = usePWAHardwareStub();
  const { setCurrentTab, addToHistory, goBack } = useNavigationStore();
  const navigateWithFeedback = preserveFunctionName(
    async (path, options) => {
      console.log("🧭 Enhanced navigation to:", path);
      if (options?.haptic !== false) {
        await triggerHaptic("tick");
      }
      setCurrentTab(path);
      addToHistory(path);
      navigate(path, options);
      if (isPWA) {
        setTimeout(() => {
          window.scrollTo(0, 0);
        }, 100);
      }
    });
  const goBackWithFeedback = preserveFunctionName(
    async (options) => {
      console.log("🧭 Enhanced back navigation");
      if (options?.haptic !== false) {
        await triggerHaptic("selection");
      }
      if (typeof window !== "undefined" && window.history.length > 1) {
        window.history.back();
        if (isPWA) {
          setTimeout(() => {
            window.scrollTo(0, 0);
          }, 100);
        }
        return true;
      } else {
        navigate("/home");
        return "/home";
      }
    });
  const navigationShortcuts = {
    toHome: preserveFunctionName(() => navigateWithFeedback("/home")),
    toMap: preserveFunctionName(() => navigateWithFeedback("/map")),
    toBuzz: preserveFunctionName(() => navigateWithFeedback("/buzz")),
    toGames: preserveFunctionName(() => navigateWithFeedback("/games")),
    toProfile: preserveFunctionName(() => navigateWithFeedback("/profile")),
    toSettings: preserveFunctionName(() => navigateWithFeedback("/settings")),
    toNotifications: preserveFunctionName(() => navigateWithFeedback("/notifications")),
    toLeaderboard: preserveFunctionName(() => navigateWithFeedback("/leaderboard"))
  };
  const getCurrentTab = preserveFunctionName(() => {
    const path = location;
    if (path.startsWith("/home")) return "home";
    if (path.startsWith("/map")) return "map";
    if (path.startsWith("/buzz")) return "buzz";
    if (path.startsWith("/games")) return "games";
    if (path.startsWith("/profile")) return "profile";
    if (path.startsWith("/settings")) return "settings";
    if (path.startsWith("/notifications")) return "notifications";
    if (path.startsWith("/leaderboard")) return "leaderboard";
    return "home";
  });
  const navigationState = {
    currentPath: location,
    currentTab: getCurrentTab(),
    isPWA,
    canGoBack: window.history.length > 1
  };
  return {
    // Core navigation
    navigateWithFeedback,
    goBackWithFeedback,
    // Shortcuts
    ...navigationShortcuts,
    // State
    ...navigationState,
    // Utilities
    getCurrentTab
  };
};

function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = reactExports.useState(() => {
    if (typeof window === "undefined") {
      return initialValue;
    }
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(`Error reading localStorage key "${key}":`, error);
      return initialValue;
    }
  });
  const setValue = (value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      if (typeof window !== "undefined") {
        window.localStorage.setItem(key, JSON.stringify(valueToStore));
      }
    } catch (error) {
      console.error(`Error setting localStorage key "${key}":`, error);
    }
  };
  reactExports.useEffect(() => {
    function handleStorageChange(event) {
      if (event.key === key && event.newValue) {
        try {
          const newValue = event.newValue.trim();
          if (newValue.startsWith("{") || newValue.startsWith("[") || newValue.startsWith('"') || newValue === "true" || newValue === "false" || !isNaN(Number(newValue))) {
            setStoredValue(JSON.parse(newValue));
          } else {
            console.warn(`Invalid JSON data for key "${key}":`, newValue);
          }
        } catch (parseError) {
          console.error(`JSON parse error for localStorage key "${key}":`, parseError, "Raw value:", event.newValue);
        }
      }
    }
    if (typeof window !== "undefined") {
      window.addEventListener("storage", handleStorageChange);
      return () => window.removeEventListener("storage", handleStorageChange);
    }
  }, [key]);
  return [storedValue, setValue];
}

const useProfileRealtime = () => {
  const [profileData, setProfileData] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [channel, setChannel] = reactExports.useState(null);
  reactExports.useEffect(() => {
    let mounted = true;
    let realtimeChannel = null;
    const setupRealtimeSubscription = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session?.user) {
          setIsLoading(false);
          return;
        }
        const { data, error } = await supabase.from("profiles").select("id, full_name, bio, agent_code, agent_title, avatar_url, email, updated_at").eq("id", session.user.id).single();
        if (mounted && data && !error) {
          setProfileData(data);
        }
        realtimeChannel = supabase.channel(`profile_changes_${session.user.id}`).on(
          "postgres_changes",
          {
            event: "UPDATE",
            schema: "public",
            table: "profiles",
            filter: `id=eq.${session.user.id}`
          },
          (payload) => {
            console.log("Profile realtime update:", payload);
            if (mounted && payload.new) {
              const newData = payload.new;
              setProfileData(newData);
              if (newData.full_name) {
                localStorage.setItem("profileName", newData.full_name);
              }
              if (newData.bio) {
                localStorage.setItem("profileBio", newData.bio);
              }
              if (newData.agent_code) {
                localStorage.setItem("agentCode", newData.agent_code);
              }
              if (newData.avatar_url) {
                localStorage.setItem("profileImage", newData.avatar_url);
              }
            }
          }
        ).subscribe((status) => {
          console.log("Profile realtime subscription status:", status);
        });
        setChannel(realtimeChannel);
        setIsLoading(false);
      } catch (error) {
        console.error("Error setting up profile realtime:", error);
        setIsLoading(false);
      }
    };
    setupRealtimeSubscription();
    return () => {
      mounted = false;
      if (realtimeChannel) {
        supabase.removeChannel(realtimeChannel);
      }
    };
  }, []);
  const updateProfile = async (updates) => {
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.user) return null;
      setProfileData((prev) => prev ? { ...prev, ...updates } : null);
      const { data, error } = await supabase.from("profiles").update({
        ...updates,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", session.user.id).select().single();
      if (error) {
        console.error("Error updating profile:", error);
        const { data: currentData } = await supabase.from("profiles").select("id, full_name, bio, agent_code, agent_title, avatar_url, email, updated_at").eq("id", session.user.id).single();
        if (currentData) {
          setProfileData(currentData);
        }
        throw error;
      }
      return data;
    } catch (error) {
      console.error("Profile update error:", error);
      throw error;
    }
  };
  return {
    profileData,
    isLoading,
    updateProfile,
    channel
  };
};

const useProfileImage = () => {
  const [profileImage, setProfileImage] = useLocalStorage("profileImage", null);
  const { profileData: realtimeProfile } = useProfileRealtime();
  reactExports.useEffect(() => {
    if (realtimeProfile?.avatar_url) {
      setProfileImage(realtimeProfile.avatar_url);
    }
  }, [realtimeProfile?.avatar_url, setProfileImage]);
  const saveImageToStorage = async (file) => {
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.user) return null;
      const fileName = `${session.user.id}.jpg`;
      const filePath = `profiles/${fileName}`;
      const { data, error } = await supabase.storage.from("avatars").upload(filePath, file, {
        cacheControl: "3600",
        upsert: true
      });
      if (error) throw error;
      const { data: { publicUrl } } = supabase.storage.from("avatars").getPublicUrl(filePath);
      return publicUrl;
    } catch (error) {
      console.error("Error saving image to storage:", error);
      return null;
    }
  };
  return {
    profileImage,
    setProfileImage,
    saveImageToStorage
  };
};

const ensureAgentCode = async (userId) => {
  try {
    const { data: profile, error } = await supabase.from("profiles").select("agent_code").eq("id", userId).single();
    if (error) {
      console.error("Error fetching agent code:", error);
      return null;
    }
    if (profile?.agent_code) {
      return profile.agent_code;
    }
    await new Promise((resolve) => setTimeout(resolve, 100));
    const { data: updatedProfile, error: retryError } = await supabase.from("profiles").select("agent_code").eq("id", userId).single();
    if (retryError) {
      console.error("Error on retry fetching agent code:", retryError);
      return null;
    }
    return updatedProfile?.agent_code || null;
  } catch (error) {
    console.error("Exception in ensureAgentCode:", error);
    return null;
  }
};

const useAgentCode = () => {
  const [agentCode, setAgentCode] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const fetchAgentCode = async () => {
      try {
        setIsLoading(true);
        setError(null);
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          setIsLoading(false);
          return;
        }
        const SPECIAL_ADMIN_EMAIL = "wikus77@hotmail.it";
        const SPECIAL_ADMIN_CODE = "AG-X0197";
        if (user.email?.toLowerCase() === SPECIAL_ADMIN_EMAIL.toLowerCase()) {
          setAgentCode(SPECIAL_ADMIN_CODE);
          setIsLoading(false);
          return;
        }
        const code = await ensureAgentCode(user.id);
        if (code) {
          setAgentCode(code);
        } else {
          setError(new Error("Failed to retrieve agent code"));
        }
      } catch (e) {
        console.error("Error fetching agent code:", e);
        setError(e instanceof Error ? e : new Error("Unknown error"));
      } finally {
        setIsLoading(false);
      }
    };
    fetchAgentCode();
  }, []);
  return {
    agentCode,
    isLoading,
    error
  };
};

const ReferralCodeDisplay = () => {
  const { agentCode, isLoading } = useAgentCode();
  if (isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-slate-600 rounded-full animate-pulse" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-slate-500 font-orbitron", children: "Loading..." })
    ] });
  }
  if (!agentCode) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: -10 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.3 },
      className: "flex items-center space-x-2",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "w-2 h-2 bg-[#00D1FF] rounded-full",
            animate: {
              scale: [1, 1.2, 1],
              opacity: [1, 0.7, 1]
            },
            transition: {
              duration: 2,
              repeat: Infinity,
              ease: "easeInOut"
            },
            style: {
              boxShadow: "0 0 8px rgba(0, 209, 255, 0.6), 0 0 16px rgba(0, 209, 255, 0.4)"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "span",
          {
            className: "text-[15px] font-orbitron font-bold text-[#00D1FF] agent-code-badge tracking-wider",
            style: {
              textShadow: "0 0 12px rgba(0, 209, 255, 0.7), 0 0 24px rgba(0, 209, 255, 0.4)"
            },
            children: agentCode
          }
        )
      ]
    }
  );
};

const useScrollDirection = (threshold = 50, containerSelector) => {
  const [state, setState] = reactExports.useState({
    isScrollingUp: false,
    isScrollingDown: false,
    scrollY: 0,
    shouldHideHeader: false
  });
  reactExports.useEffect(() => {
    let lastScroll = window.scrollY;
    let ticking = false;
    let attachedTarget = null;
    let virtualScroll = 0;
    const readScroll = () => (window.scrollY) + virtualScroll;
    const updateScrollDirection = () => {
      const current = readScroll();
      if (Math.abs(current - lastScroll) < threshold) {
        ticking = false;
        return;
      }
      const isScrollingDown = current > lastScroll;
      const isScrollingUp = current < lastScroll;
      setState({
        isScrollingUp,
        isScrollingDown,
        scrollY: current,
        shouldHideHeader: isScrollingDown && current > threshold
      });
      lastScroll = current > 0 ? current : 0;
      ticking = false;
    };
    const onScroll = () => {
      if (!ticking) {
        window.requestAnimationFrame(updateScrollDirection);
        ticking = true;
      }
    };
    const attachListener = (target) => {
      if (attachedTarget) attachedTarget.removeEventListener("scroll", onScroll);
      target.addEventListener("scroll", onScroll, { passive: true });
      attachedTarget = target;
    };
    attachListener(window);
    return () => {
      if (attachedTarget) attachedTarget.removeEventListener("scroll", onScroll);
    };
  }, [threshold, containerSelector]);
  return state;
};

const MinimalHeaderStrip = ({ show, children }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: show && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      transition: {
        duration: 0.2,
        ease: [0.4, 0, 0.2, 1]
      },
      className: "fixed left-1/2 z-[60]",
      style: {
        top: "calc(47px + 20px)",
        transform: "translateX(-50%)"
      },
      children
    }
  ) });
};

const UnifiedHeader = ({
  profileImage: propProfileImage,
  leftComponent,
  onClickMail,
  disableScrollHide = false
}) => {
  console.log("✅ M1SSION™ UnifiedHeader component rendering");
  const mountedRef = reactExports.useRef(false);
  reactExports.useEffect(() => {
    if (mountedRef.current) {
      console.warn("⚠️ UnifiedHeader: Multiple mounts detected, cleaning up duplicates");
    }
    mountedRef.current = true;
    return () => {
      mountedRef.current = false;
    };
  }, []);
  const [location] = useLocation();
  useNotificationManager();
  const { goBackWithFeedback, canGoBack } = useEnhancedNavigation();
  const { profileImage } = useProfileImage();
  const { user } = useUnifiedAuth();
  const [hasAccess, setHasAccess] = reactExports.useState(false);
  const [isCapacitor, setIsCapacitor] = reactExports.useState(false);
  const [isPWA, setIsPWA] = reactExports.useState(false);
  const isMapRoute = location === "/map" || location.startsWith("/map/");
  const isBuzzRoute = location === "/buzz";
  const { shouldHideHeader: windowHide } = useScrollDirection(50);
  const [mapHide, setMapHide] = reactExports.useState(false);
  const hideHeader = isBuzzRoute ? false : isMapRoute ? mapHide : windowHide;
  reactExports.useEffect(() => {
    if (!isMapRoute || disableScrollHide || isBuzzRoute) return;
    const el = document.querySelector("#map-scroll-container");
    if (!el) return;
    const onScroll = () => setMapHide(el.scrollTop > 10);
    el.addEventListener("scroll", onScroll, { passive: true });
    const onWheel = (e) => {
      if (e.deltaY > 0) setMapHide(true);
      if (e.deltaY < 0 && el.scrollTop <= 0) setMapHide(false);
    };
    el.addEventListener("wheel", onWheel, { passive: true, capture: true });
    let touchStartY = null;
    const onTouchStart = (e) => {
      touchStartY = e.touches[0]?.clientY ?? null;
    };
    const onTouchMove = (e) => {
      if (touchStartY == null) return;
      const currentY = e.touches[0]?.clientY ?? touchStartY;
      const deltaY = touchStartY - currentY;
      if (deltaY > 0) setMapHide(true);
      if (deltaY < 0 && el.scrollTop <= 0) setMapHide(false);
      touchStartY = currentY;
    };
    el.addEventListener("touchstart", onTouchStart, { passive: true, capture: true });
    el.addEventListener("touchmove", onTouchMove, { passive: true, capture: true });
    const leaflet = document.querySelector(".leaflet-container");
    if (leaflet) {
      leaflet.addEventListener("wheel", onWheel, { passive: true, capture: true });
      leaflet.addEventListener("touchstart", onTouchStart, { passive: true, capture: true });
      leaflet.addEventListener("touchmove", onTouchMove, { passive: true, capture: true });
    }
    return () => {
      el.removeEventListener("scroll", onScroll);
      el.removeEventListener("wheel", onWheel);
      el.removeEventListener("touchstart", onTouchStart);
      el.removeEventListener("touchmove", onTouchMove);
      if (leaflet) {
        leaflet.removeEventListener("wheel", onWheel);
        leaflet.removeEventListener("touchstart", onTouchStart);
        leaflet.removeEventListener("touchmove", onTouchMove);
      }
    };
  }, [isMapRoute, location, disableScrollHide, isBuzzRoute]);
  const currentProfileImage = profileImage || propProfileImage;
  reactExports.useEffect(() => {
    const isPWAMode = window.matchMedia("(display-mode: standalone)").matches;
    setIsPWA(isPWAMode);
    const checkAccess = async () => {
      const isCapacitorApp = !!window.Capacitor;
      setIsCapacitor(isCapacitorApp);
      const userAgent = navigator.userAgent;
      const isMobile = /iPhone|iPad|iPod|Android|Mobile/i.test(userAgent) || isCapacitorApp;
      const hasStoredAccess = localStorage.getItem("developer_access") === "granted";
      let isDeveloperUser = false;
      if (user) {
        const { data: profile } = await supabase.from("profiles").select("role").eq("id", user.id).single();
        isDeveloperUser = profile?.role === "admin";
      }
      console.log("UnifiedHeader access check:", { isMobile, hasStoredAccess, isCapacitorApp, isDeveloperUser });
      if (isDeveloperUser) {
        setHasAccess(true);
        localStorage.setItem("unlimited_access", "true");
        localStorage.setItem("bypass_all_restrictions", "true");
      } else if (isMobile && hasStoredAccess) {
        setHasAccess(true);
      } else if (!isMobile) {
        setHasAccess(false);
      } else {
        setHasAccess(false);
      }
    };
    checkAccess();
  }, [user]);
  const isHomePage = location === "/home";
  const reduceAnimations = location === "/profile" || location === "/settings/agent-profile";
  const bottomNavPages = ["/", "/home", "/map", "/buzz", "/games", "/notifications", "/leaderboard", "/intelligence"];
  const isBottomNavPage = bottomNavPages.includes(location);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(MinimalHeaderStrip, { show: false, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center gap-1", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "w-2 h-2 bg-[#00D1FF] rounded-full",
            animate: {
              scale: [1, 1.2, 1],
              opacity: [1, 0.7, 1]
            },
            transition: {
              duration: 1.6,
              repeat: Infinity,
              ease: "easeInOut"
            },
            style: {
              boxShadow: "0 0 8px rgba(0, 209, 255, 0.6), 0 0 16px rgba(0, 209, 255, 0.4)"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "span",
          {
            className: "text-xs font-orbitron font-bold text-white tracking-wider",
            style: {
              textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"
            },
            children: "CODE"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ReferralCodeDisplay, {})
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.header,
      {
        initial: { y: -20, opacity: 0 },
        animate: { y: 0, opacity: 1 },
        transition: { duration: 0.3, ease: [0.4, 0, 0.2, 1] },
        className: "fixed left-0 right-0 z-50 backdrop-blur-xl rounded-b-lg",
        style: {
          top: "0px",
          background: "transparent",
          backdropFilter: "none",
          WebkitBackdropFilter: "none",
          borderBottom: "none",
          boxShadow: "none",
          paddingTop: isPWA ? "max(env(safe-area-inset-top, 0px), 16px)" : "max(env(safe-area-inset-top, 0px), 12px)",
          height: "calc(72px + max(env(safe-area-inset-top, 0px), 8px))",
          isolation: "isolate"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "absolute inset-0 pointer-events-none rounded-b-lg",
              animate: { opacity: hideHeader ? 0 : 1 },
              transition: { duration: 0.3 },
              style: {
                background: "rgba(0, 0, 0, 0.3)",
                backdropFilter: "blur(20px)",
                WebkitBackdropFilter: "blur(20px)",
                borderBottom: "1px solid rgba(0, 209, 255, 0.2)",
                boxShadow: "0 4px 24px rgba(0, 209, 255, 0.18), 0 2px 12px rgba(0, 209, 255, 0.12), inset 0 -1px 0 rgba(0, 209, 255, 0.12)"
              }
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto h-full max-w-screen-xl relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between h-[72px] px-3 sm:px-4 relative", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(motion.div, { className: "flex items-center", animate: { opacity: hideHeader ? 0 : 1 }, transition: { duration: 0.3 }, children: leftComponent ? leftComponent : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
                !isHomePage && !isBottomNavPage && canGoBack && /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "icon",
                    onClick: () => goBackWithFeedback(),
                    className: "mr-2 rounded-xl hover:bg-white/10 unified-header-btn w-11 h-11 m1-touch-feedback",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-6 h-6" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Link,
                  {
                    to: "/home",
                    className: "text-2xl sm:text-[1.75rem] font-orbitron font-bold m1ssion-logo m1-text-glow",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", style: {
                        textShadow: "0 0 12px rgba(0, 209, 255, 0.7), 0 0 24px rgba(0, 209, 255, 0.4)"
                      }, children: "M1" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                        "SSION",
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[10px] align-top ml-0.5", children: "™" })
                      ] })
                    ]
                  }
                )
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-1.5", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      className: "w-2.5 h-2.5 bg-[#00D1FF] rounded-full m1-glow-pulse",
                      animate: {
                        scale: [1, 1.3, 1],
                        opacity: [1, 0.8, 1]
                      },
                      transition: {
                        duration: 1.6,
                        repeat: reduceAnimations ? 0 : Infinity,
                        ease: "easeInOut"
                      },
                      style: {
                        boxShadow: "0 0 10px rgba(0, 209, 255, 0.7), 0 0 20px rgba(0, 209, 255, 0.5)"
                      }
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "span",
                    {
                      className: "text-[11px] font-orbitron font-bold text-white tracking-widest",
                      style: {
                        textShadow: "0 0 12px rgba(0, 209, 255, 0.7), 0 0 24px rgba(0, 209, 255, 0.4)"
                      },
                      children: "CODE"
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(ReferralCodeDisplay, {})
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(motion.div, { className: "flex items-center space-x-1 sm:space-x-3", animate: { opacity: hideHeader ? 0 : 1 }, transition: { duration: 0.3 }, children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/settings", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "icon",
                    className: "rounded-xl hover:bg-white/10 unified-header-btn w-11 h-11 m1-touch-feedback",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        animate: {
                          rotate: [0, 360],
                          scale: [1, 1.08, 1]
                        },
                        transition: {
                          rotate: { duration: reduceAnimations ? 1.6 : 8, repeat: reduceAnimations ? 0 : Infinity, ease: "linear" },
                          scale: { duration: reduceAnimations ? 1.2 : 4, repeat: reduceAnimations ? 0 : Infinity, ease: "easeInOut" }
                        },
                        style: {
                          filter: "drop-shadow(0 0 10px rgba(0, 209, 255, 0.5))"
                        },
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-6 h-6 text-[#00D1FF]" })
                      }
                    )
                  }
                ) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  ProfileDropdown,
                  {
                    profileImage: currentProfileImage,
                    className: "cursor-pointer"
                  }
                )
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "line-glow absolute bottom-0 left-0 w-full",
                animate: { opacity: hideHeader ? 0 : 1 },
                transition: { duration: 0.3 }
              }
            )
          ] })
        ]
      }
    )
  ] });
};

const BottomNavigationComponent = () => {
  const [currentPath] = useLocation();
  const { unreadCount } = useNotifications();
  const { navigate } = useWouterNavigation();
  const isPWA = typeof window !== "undefined" && window.matchMedia("(display-mode: standalone)").matches;
  const reduceAnimations = currentPath === "/profile" || currentPath === "/settings/agent-profile";
  console.log("🧭 BottomNavigation render:", {
    currentPath,
    isPWA,
    unreadCount
  });
  const links = [
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(House, { className: "h-7 w-7" }),
      label: "Home",
      path: "/home",
      color: "#00D1FF"
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: "28", height: "28", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", className: "w-7 h-7", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "12", cy: "12", r: "10" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" })
      ] }),
      label: "3D",
      path: "/map-3d-tiler",
      color: "#00D1FF"
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Circle, { strokeWidth: 2.5, className: "h-7 w-7" }),
      label: "Buzz",
      path: "/buzz",
      isSpecial: true,
      color: "#00D1FF"
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xl font-bold", children: "AI" }),
      label: "Intel",
      path: "/intelligence",
      color: "#00D1FF"
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "h-7 w-7" }),
      label: "Notice",
      path: "/notifications",
      badge: unreadCount > 0,
      badgeCount: unreadCount,
      color: "#00D1FF"
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: "28", height: "28", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", className: "w-7 h-7", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M6 9H4.5a2.5 2.5 0 0 1 0-5H6" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M18 9h1.5a2.5 2.5 0 0 0 0-5H18" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M4 22h16" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M18 2H6v7a6 6 0 0 0 12 0V2Z" })
      ] }),
      label: "Winners",
      path: "/leaderboard",
      color: "#00D1FF"
    }
  ];
  const handleNavigationPWA = async (link, e) => {
    e.preventDefault();
    console.log("🧭 Navigation clicked:", { path: link.path, isPWA });
    navigate(link.path);
    const applyPWAScrollFix = () => {
      if (isPWA) {
        setTimeout(() => {
          window.scrollTo(0, 0);
        }, 100);
      }
    };
    applyPWAScrollFix();
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: "bottom-navigation-ios",
      style: {
        position: "fixed",
        left: 0,
        right: 0,
        bottom: "0px",
        zIndex: 1e4,
        paddingBottom: "0px",
        paddingLeft: "env(safe-area-inset-left)",
        paddingRight: "env(safe-area-inset-right)",
        backgroundColor: "transparent",
        transform: "translateZ(0)",
        WebkitTransform: "translateZ(0)",
        isolation: "isolate",
        WebkitBackfaceVisibility: "hidden",
        backfaceVisibility: "hidden",
        willChange: "transform"
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "backdrop-blur-xl border-t border-white/10 px-3 bottom-nav-hardware-acceleration rounded-t-lg",
          initial: { opacity: 0 },
          animate: { opacity: 1 },
          transition: { duration: 0.3 },
          style: {
            position: "relative",
            zIndex: "inherit",
            height: "79px",
            display: "flex",
            alignItems: "flex-start",
            paddingTop: "8px",
            paddingBottom: isPWA ? "env(safe-area-inset-bottom)" : "0px",
            background: "rgba(0, 0, 0, 0.15)",
            backdropFilter: "blur(20px)",
            borderTop: "1px solid rgba(0, 209, 255, 0.2)",
            boxShadow: "0 -4px 24px rgba(0, 209, 255, 0.15), 0 -2px 12px rgba(0, 209, 255, 0.1), inset 0 1px 0 rgba(0, 209, 255, 0.1)",
            WebkitTapHighlightColor: "transparent",
            touchAction: "manipulation"
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-around h-full max-w-lg mx-auto w-full", children: links.map((link) => {
              const isActive = currentPath === link.path || link.path === "/map-3d-tiler" && currentPath === "/living-map-3d";
              return /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.button,
                {
                  onClick: (e) => handleNavigationPWA(link, e),
                  className: `relative flex flex-col items-center justify-center w-16 h-14 transition-colors mobile-touch-target cursor-pointer m1-touch-feedback ${isActive ? "text-[#00D1FF] nav-active" : "text-gray-400 hover:text-gray-300"}`,
                  style: {
                    background: "none",
                    border: "none",
                    outline: "none",
                    WebkitTapHighlightColor: "transparent",
                    WebkitTouchCallout: "none",
                    userSelect: "none",
                    touchAction: "manipulation",
                    minHeight: "52px",
                    minWidth: "52px"
                  },
                  whileTap: { scale: 0.92 },
                  whileHover: { scale: 1.05 },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(motion.div, { className: "relative", children: [
                      link.isSpecial ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        motion.div,
                        {
                          className: "relative",
                          animate: {
                            scale: [1, 1.05, 1],
                            opacity: [1, 0.9, 1]
                          },
                          transition: {
                            repeat: reduceAnimations ? 0 : Infinity,
                            duration: 3,
                            ease: "easeInOut"
                          },
                          children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `absolute inset-0 rounded-full bg-gradient-to-r from-[#00D1FF] to-[#7B2EFF] opacity-30 blur-sm ${!reduceAnimations ? "animate-pulse" : ""}` }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx(
                              "div",
                              {
                                className: "absolute inset-0 rounded-full border-2 border-[#00D1FF]/60 animate-spin-slow",
                                style: {
                                  animation: reduceAnimations ? "spin 1.6s linear 1" : "spin 8s linear infinite"
                                }
                              }
                            ),
                            /* @__PURE__ */ jsxRuntimeExports.jsx(
                              "div",
                              {
                                className: "relative z-10 text-[#00D1FF]",
                                style: {
                                  filter: "drop-shadow(0 0 8px rgba(0, 209, 255, 0.8))",
                                  textShadow: "0 0 10px rgba(0, 209, 255, 0.6)"
                                },
                                children: link.icon
                              }
                            )
                          ]
                        }
                      ) : /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          animate: isActive ? {
                            scale: [1, 1.1, 1],
                            filter: [
                              `drop-shadow(0 0 5px ${link.color}80)`,
                              `drop-shadow(0 0 12px ${link.color}CC)`,
                              `drop-shadow(0 0 5px ${link.color}80)`
                            ]
                          } : {},
                          transition: {
                            repeat: isActive && !reduceAnimations ? Infinity : 0,
                            duration: 3,
                            ease: "easeInOut"
                          },
                          style: {
                            color: isActive ? link.color : "inherit"
                          },
                          children: link.icon
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: link.badge && link.badgeCount && /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          className: "absolute -top-1.5 -right-1.5 flex items-center justify-center h-6 w-6 bg-[#FF59F8] rounded-full m1-badge-bounce",
                          style: {
                            boxShadow: "0 0 12px rgba(240,89,255,0.7), 0 0 20px rgba(240,89,255,0.4)"
                          },
                          initial: { scale: 0, opacity: 0 },
                          animate: {
                            scale: 1,
                            opacity: 1
                          },
                          exit: { scale: 0, opacity: 0 },
                          transition: {
                            duration: 0.3,
                            type: "spring",
                            stiffness: 400
                          },
                          children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[10px] font-bold text-white", children: link.badgeCount > 99 ? "99+" : link.badgeCount })
                        }
                      ) })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.span,
                      {
                        className: "text-[11px] font-semibold mt-1.5 select-none tracking-wide",
                        style: {
                          color: isActive ? link.color : "inherit"
                        },
                        animate: isActive ? {
                          textShadow: [
                            `0 0 6px ${link.color}80`,
                            `0 0 12px ${link.color}CC`,
                            `0 0 6px ${link.color}80`
                          ]
                        } : {},
                        transition: {
                          repeat: isActive && !reduceAnimations ? Infinity : 0,
                          duration: 3,
                          ease: "easeInOut"
                        },
                        children: link.label
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isActive && /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        className: "absolute bottom-0 w-10 h-[3px] rounded-t-md active-indicator",
                        style: {
                          backgroundColor: link.color,
                          boxShadow: `0 0 12px ${link.color}CC, 0 0 20px ${link.color}60`
                        },
                        layoutId: "navigation-underline",
                        initial: { opacity: 0, scale: 0.8 },
                        animate: { opacity: 1, scale: 1 },
                        exit: { opacity: 0, scale: 0.8 },
                        transition: { type: "spring", stiffness: 500, damping: 30 }
                      }
                    ) })
                  ]
                },
                link.path
              );
            }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "line-glow absolute top-0 left-0 w-full" })
          ]
        }
      )
    }
  );
};
const BottomNavigation = BottomNavigationComponent;

const Switch = reactExports.forwardRef(
  ({ className, checked, onCheckedChange, ...props }, ref) => {
    const [isChecked, setIsChecked] = reactExports.useState(checked || false);
    reactExports.useEffect(() => {
      if (checked !== void 0) {
        setIsChecked(checked);
      }
    }, [checked]);
    const handleChange = (event) => {
      const newChecked = event.target.checked;
      setIsChecked(newChecked);
      onCheckedChange?.(newChecked);
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("label", { className: "inline-flex items-center cursor-pointer", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "input",
        {
          type: "checkbox",
          ref,
          checked: isChecked,
          onChange: handleChange,
          className: "sr-only",
          ...props
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: cn(
            "relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
            isChecked ? "bg-primary" : "bg-input",
            className
          ),
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "span",
            {
              className: cn(
                "pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform",
                isChecked ? "translate-x-4" : "translate-x-0.5"
              )
            }
          )
        }
      )
    ] });
  }
);
Switch.displayName = "Switch";

const CookieBanner$2 = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  const [location] = useLocation();
  const [showBanner, setShowBanner] = reactExports.useState(false);
  const [showSettings, setShowSettings] = reactExports.useState(false);
  const [loading, setLoading] = reactExports.useState(false);
  const [preferences, setPreferences] = reactExports.useState({
    essential: true,
    analytics: false,
    marketing: false,
    preferences: false
  });
  reactExports.useEffect(() => {
    if (location === "/") {
      checkCookieConsent();
    }
  }, [user, location]);
  const checkCookieConsent = async () => {
    try {
      const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
      if (user) {
        const { data: profileData, error: profileError } = await supabase.from("profiles").select("last_cookie_banner_shown").eq("id", user.id).single();
        if (profileError && profileError.code !== "PGRST116") {
          console.error("Error loading profile data:", profileError);
        }
        if (profileData?.last_cookie_banner_shown === today) {
          console.log("🍪 Cookie banner already shown today, skipping");
          return;
        }
        const { data: cookieData, error: cookieError } = await supabase.from("user_cookie_preferences").select("*").eq("user_id", user.id).single();
        if (cookieError && cookieError.code !== "PGRST116") {
          console.error("Error loading cookie preferences:", cookieError);
        }
        if (cookieData) {
          setPreferences({
            essential: cookieData.essential_cookies,
            analytics: cookieData.analytics_cookies,
            marketing: cookieData.marketing_cookies,
            preferences: cookieData.preferences_cookies
          });
          return;
        }
      } else {
        const savedConsent = localStorage.getItem("cookie_consent");
        const lastShown = localStorage.getItem("cookie_banner_last_shown");
        if (lastShown === today && savedConsent) {
          console.log("🍪 Cookie banner already shown today (anonymous), skipping");
          setPreferences(JSON.parse(savedConsent));
          return;
        }
      }
      console.log("🍪 Showing cookie banner for first time today");
      setShowBanner(true);
    } catch (error) {
      console.error("Error checking cookie consent:", error);
      setShowBanner(true);
    }
  };
  const handleAcceptAll = async () => {
    const allAccepted = {
      essential: true,
      analytics: true,
      marketing: true,
      preferences: true
    };
    await saveCookiePreferences(allAccepted);
    setShowBanner(false);
    toast({
      title: "🍪 Cookie accettati",
      description: "Hai accettato tutti i cookie. Grazie!"
    });
  };
  const handleRejectAll = async () => {
    const onlyEssential = {
      essential: true,
      analytics: false,
      marketing: false,
      preferences: false
    };
    await saveCookiePreferences(onlyEssential);
    setShowBanner(false);
    toast({
      title: "🍪 Cookie rifiutati",
      description: "Solo i cookie essenziali saranno utilizzati."
    });
  };
  const handleSaveCustom = async () => {
    setLoading(true);
    try {
      await saveCookiePreferences(preferences);
      setShowBanner(false);
      setShowSettings(false);
      toast({
        title: "🍪 Preferenze salvate",
        description: "Le tue preferenze sui cookie sono state aggiornate."
      });
    } catch (error) {
      console.error("Error saving preferences:", error);
      toast({
        title: "❌ Errore",
        description: "Impossibile salvare le preferenze. Riprova.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const saveCookiePreferences = async (prefs) => {
    try {
      const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
      if (user) {
        const { error } = await supabase.from("user_cookie_preferences").upsert({
          user_id: user.id,
          essential_cookies: prefs.essential,
          analytics_cookies: prefs.analytics,
          marketing_cookies: prefs.marketing,
          preferences_cookies: prefs.preferences
        }, { onConflict: "user_id" });
        if (error) throw error;
        await supabase.from("user_consents").upsert({
          user_id: user.id,
          cookie_consent: true
        }, { onConflict: "user_id" });
        await supabase.from("profiles").update({ last_cookie_banner_shown: today }).eq("id", user.id);
        console.log("🍪 Cookie preferences saved and banner timestamp updated");
      } else {
        localStorage.setItem("cookie_consent", JSON.stringify(prefs));
        localStorage.setItem("cookie_banner_last_shown", today);
        console.log("🍪 Cookie preferences saved to localStorage with daily tracking");
      }
      setPreferences(prefs);
    } catch (error) {
      console.error("Error saving cookie preferences:", error);
      throw error;
    }
  };
  if (!showBanner) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: "fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",
      style: { paddingTop: "calc(env(safe-area-inset-top, 0px) + 20px)", paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 20px)" },
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          initial: { opacity: 0, y: 100 },
          animate: { opacity: 1, y: 0 },
          exit: { opacity: 0, y: 100 },
          className: "w-full max-w-md",
          children: !showSettings ? (
            // Main Cookie Banner
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-[#131524] to-[#1a1d3a] border-[#00D1FF]/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center text-white", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
                "Cookie Policy"
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 text-sm", children: "Utilizziamo cookie per migliorare la tua esperienza, analizzare il traffico e personalizzare i contenuti. Puoi gestire le tue preferenze o accettare tutto." }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col space-y-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Button,
                    {
                      onClick: handleAcceptAll,
                      className: "bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 mr-2" }),
                        "Accetta tutto"
                      ]
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Button,
                    {
                      onClick: handleRejectAll,
                      variant: "outline",
                      className: "border-white/20 text-white hover:bg-white/10",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-4 h-4 mr-2" }),
                        "Rifiuta tutto"
                      ]
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Button,
                    {
                      onClick: () => setShowSettings(true),
                      variant: "ghost",
                      className: "text-[#00D1FF] hover:bg-[#00D1FF]/10",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 mr-2" }),
                        "Gestisci preferenze"
                      ]
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-white/60 text-center", children: [
                  "Consulta la nostra",
                  " ",
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "button",
                    {
                      onClick: () => window.open("/cookie-policy", "_blank"),
                      className: "text-[#00D1FF] hover:underline",
                      children: "Cookie Policy completa"
                    }
                  )
                ] })
              ] })
            ] })
          ) : (
            // Cookie Settings Panel
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-[#131524] to-[#1a1d3a] border-[#00D1FF]/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between text-white", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
                  "Preferenze Cookie"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    onClick: () => setShowSettings(false),
                    size: "sm",
                    variant: "ghost",
                    className: "text-white/70 hover:text-white",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-4 h-4" })
                  }
                )
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium", children: "Cookie Essenziali" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-xs", children: "Necessari per il funzionamento dell'app" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Switch,
                      {
                        checked: preferences.essential,
                        disabled: true,
                        className: "data-[state=checked]:bg-[#00D1FF]"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium", children: "Cookie Analitici" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-xs", children: "Ci aiutano a migliorare l'esperienza" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Switch,
                      {
                        checked: preferences.analytics,
                        onCheckedChange: (checked) => setPreferences((prev) => ({ ...prev, analytics: checked })),
                        className: "data-[state=checked]:bg-[#00D1FF]"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium", children: "Cookie Marketing" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-xs", children: "Per contenuti e pubblicità personalizzati" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Switch,
                      {
                        checked: preferences.marketing,
                        onCheckedChange: (checked) => setPreferences((prev) => ({ ...prev, marketing: checked })),
                        className: "data-[state=checked]:bg-[#00D1FF]"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium", children: "Cookie Preferenze" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-xs", children: "Ricordano le tue impostazioni" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Switch,
                      {
                        checked: preferences.preferences,
                        onCheckedChange: (checked) => setPreferences((prev) => ({ ...prev, preferences: checked })),
                        className: "data-[state=checked]:bg-[#00D1FF]"
                      }
                    )
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    onClick: handleSaveCustom,
                    disabled: loading,
                    className: "w-full bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90",
                    children: loading ? "Salvataggio..." : "Salva preferenze"
                  }
                )
              ] })
            ] })
          )
        }
      )
    }
  ) });
};

const GlobalLayout = ({ children }) => {
  const [location] = useLocation();
  const isCapacitor = detectPWAEnvironment();
  const hideNavigationRoutes = [
    "/login",
    "/register",
    "/auth",
    "/kyc",
    "/verification",
    "/select-mission"
  ];
  const fullScreenRoutes = [
    "/map",
    "/buzz",
    "/games"
  ];
  const shouldHideNavigation = hideNavigationRoutes.includes(location);
  const isFullScreen = fullScreenRoutes.includes(location);
  console.log("🏗️ GlobalLayout:", {
    path: location,
    shouldHideNavigation,
    isFullScreen,
    isCapacitor
  });
  if (shouldHideNavigation) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SafeAreaWrapper$1, { className: "min-h-screen", children });
  }
  if (isFullScreen) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SafeAreaWrapper$1, { className: "min-h-screen", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative min-h-screen", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: "relative z-10", children }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(SafeAreaWrapper$1, { className: "min-h-screen", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "main",
      {
        className: "relative z-10 pt-[80px] pb-20",
        style: {
          minHeight: "calc(100vh - 80px - 80px)",
          // Account for header and bottom nav
          paddingTop: isCapacitor ? "calc(80px + env(safe-area-inset-top, 0px))" : "80px"
        },
        children
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(CookieBanner$2, {})
  ] }) });
};

function useQueryQRRedirect() {
  const [, setLocation] = useLocation();
  reactExports.useEffect(() => {
    try {
      const sp = new URLSearchParams(window.location.search);
      const raw = sp.get("qr")?.trim();
      if (!raw) return;
      setLocation(`/map`);
      const url = new URL(window.location.href);
      url.searchParams.delete("qr");
      window.history.replaceState({}, document.title, url.toString());
    } catch (e) {
      console.warn("[useQueryQRRedirect] redirect error", e);
    }
  }, [setLocation]);
}

const LazyImage = ({
  src,
  alt,
  className,
  placeholderSrc = "/placeholder.svg",
  threshold = 0.1,
  ...props
}) => {
  const [isLoaded, setIsLoaded] = reactExports.useState(false);
  const [isInView, setIsInView] = reactExports.useState(false);
  const imgRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    if (!imgRef.current) return;
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setIsInView(true);
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold }
    );
    observer.observe(imgRef.current);
    return () => {
      if (imgRef.current) {
        observer.unobserve(imgRef.current);
      }
    };
  }, [threshold]);
  const handleImageLoaded = () => {
    setIsLoaded(true);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: cn("relative overflow-hidden", className), style: props.style, children: [
    !isLoaded && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gray-900/20 animate-pulse flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      "img",
      {
        src: placeholderSrc,
        alt: "Loading...",
        className: "w-12 h-12 opacity-30"
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "img",
      {
        ref: imgRef,
        src: isInView ? src : placeholderSrc,
        alt: alt || "Image",
        className: cn(
          "transition-opacity duration-500",
          isLoaded ? "opacity-100" : "opacity-0"
        ),
        onLoad: handleImageLoaded,
        ...props
      }
    )
  ] });
};

const ImagePreview = ({
  isOpen,
  onClose,
  imageUrl,
  alt = "Image preview"
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogContent, { className: "sm:max-w-[60vw] max-w-[90vw] p-1 bg-black/80 border border-cyan-500/30 rounded-xl shadow-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        className: "absolute top-2 right-2 z-10 rounded-full bg-black/50 p-1.5 text-white/80 hover:bg-black/70 hover:text-white transition-colors",
        onClick: onClose,
        "aria-label": "Close preview",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "h-5 w-5" })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.img,
      {
        src: imageUrl,
        alt,
        initial: { opacity: 0, scale: 0.9 },
        animate: { opacity: 1, scale: 1 },
        transition: { duration: 0.3 },
        className: "w-full h-auto rounded-lg object-contain max-h-[80vh]"
      }
    )
  ] }) }) });
};

const useLongPress = (callback, options = {}) => {
  const { threshold = 500, onStart, onFinish, onCancel } = options;
  const [longPressTriggered, setLongPressTriggered] = reactExports.useState(false);
  const timeout = reactExports.useRef();
  const target = reactExports.useRef();
  const start = reactExports.useCallback((e) => {
    e.persist();
    if ("touches" in e) {
      e.preventDefault();
    }
    ({ ...e });
    target.current = e.target;
    timeout.current = setTimeout(() => {
      onStart?.();
      setLongPressTriggered(true);
      callback();
      onFinish?.();
    }, threshold);
  }, [callback, onFinish, onStart, threshold]);
  const clear = reactExports.useCallback(() => {
    timeout.current && clearTimeout(timeout.current);
    setLongPressTriggered(false);
    onCancel?.();
  }, [onCancel]);
  return {
    onMouseDown: (e) => start(e),
    onMouseUp: clear,
    onMouseLeave: clear,
    onTouchStart: (e) => start(e),
    onTouchEnd: clear
  };
};

const PrizeDetailsModal = ({ isOpen, onClose }) => {
  const [previewImage, setPreviewImage] = reactExports.useState(null);
  const prizes = [
    {
      name: "Lamborghini Huracán",
      description: "Vivi il brivido della velocità con una Lamborghini Huracán. Design aggressivo, motore ruggente e linee affilate: è più di un'auto, è una dichiarazione di potere. Solo un agente M1SSION potrà portarsela a casa.",
      image: "/lovable-uploads/211b98b7-646d-4c40-80d6-416ac71a54fc.png"
    },
    {
      name: "Ferrari SF90 Stradale",
      description: "Un'auto di lusso con prestazioni straordinarie, design all'avanguardia e tecnologia di punta.",
      image: "/lovable-uploads/2f1f79ad-4221-4a49-a188-81e28222514d.png"
    },
    {
      name: "Aston Martin DBX",
      description: "Il SUV più elegante e potente mai prodotto da Aston Martin. Linee muscolose, prestazioni sportive e lusso senza compromessi per affrontare ogni missione con stile.",
      image: "/lovable-uploads/3b5f5a13-bb71-472b-9348-6e52c12cba7e.png"
    },
    {
      name: "Porsche 911 Turbo",
      description: "La Porsche 911 Turbo è il simbolo della perfezione tedesca: eleganza, potenza e precisione in un'unica auto. Un gioiello nero su quattro ruote per chi completa la M1SSION con intelligenza e velocità.",
      image: "/lovable-uploads/7bda6b4a-6ac6-489d-8b2f-b9a4f9c312a2.png"
    }
  ];
  const closePreview = () => {
    setPreviewImage(null);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      DialogContent,
      {
        className: "sm:max-w-3xl w-[calc(100vw-2rem)] max-h-[85vh] overflow-y-auto p-6",
        style: {
          background: "rgba(0, 0, 0, 0.05)",
          backdropFilter: "blur(40px)",
          WebkitBackdropFilter: "blur(40px)",
          borderRadius: "24px",
          border: "1px solid rgba(255, 255, 255, 0.1)",
          boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-2xl font-orbitron text-center bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent", children: "📦 Premi Esclusivi M1SSION" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(DialogDescription, { className: "text-center text-white/70", children: "Ecco i premi che potrai vincere partecipando alle nostre missioni speciali. Solo i più veloci, astuti e determinati potranno conquistarli." })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6 my-6 p-1 rounded-2xl shadow-xl p-6", children: prizes.map((prize, index) => {
            const longPressProps = useLongPress(() => setPreviewImage(prize.image));
            return /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "div",
              {
                className: "p-4 rounded-xl hover:scale-[1.02] transition-all duration-300",
                style: {
                  background: "rgba(0, 0, 0, 0.05)",
                  backdropFilter: "blur(40px)",
                  WebkitBackdropFilter: "blur(40px)",
                  border: "1px solid rgba(255, 255, 255, 0.1)",
                  boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
                },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "div",
                    {
                      className: "h-48 overflow-hidden rounded-xl mb-4 cursor-pointer",
                      ...longPressProps,
                      onDoubleClick: () => setPreviewImage(prize.image),
                      onContextMenu: (e) => {
                        e.preventDefault();
                        setPreviewImage(prize.image);
                      },
                      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                        LazyImage,
                        {
                          src: prize.image,
                          alt: prize.name,
                          className: "w-full h-full object-cover transform hover:scale-105 transition-transform duration-500 rounded-xl"
                        }
                      )
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-orbitron text-lg font-bold text-cyan-400 mb-2", children: prize.name }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70", children: prize.description })
                ]
              },
              index
            );
          }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(DialogFooter, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogClose, { asChild: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { className: "w-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full", children: "Chiudi" }) }) })
        ]
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      ImagePreview,
      {
        isOpen: !!previewImage,
        onClose: closePreview,
        imageUrl: previewImage || "",
        alt: "Prize preview"
      }
    )
  ] });
};

const LandingFooter = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx("footer", { className: "py-16 px-4 bg-black w-full border-t border-white/20 relative z-50", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-screen-xl mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col md:flex-row justify-between items-center w-full mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-6 md:mb-0", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-2xl font-bold", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
          "SSION",
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" })
        ] })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap gap-4 justify-center md:justify-end", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/privacy-policy", className: "text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1", children: "Privacy Policy" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/cookie-policy", className: "text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1", children: "Cookie Policy" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/terms", className: "text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1", children: "Termini e Condizioni" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/contact", className: "text-base text-white/80 hover:text-cyan-400 transition-colors font-medium px-2 py-1", children: "Contatti" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "border-t border-white/20 pt-8 text-center md:text-left", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-base text-white/80 font-medium", children: [
      "© 2025 ",
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
        "SSION",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" })
      ] }),
      " – ALL RIGHTS RESERVED – NIYVORA KFT™"
    ] }) })
  ] }) });
};

const SUPPORTED_LANGUAGES = ["en", "it", "fr", "es", "de", "pt", "zh", "ar"];
function detectInitialLanguage() {
  try {
    const browserLang = navigator.language || navigator.userLanguage;
    if (!browserLang) {
      console.warn("Unable to detect browser language, using English fallback");
      return "en";
    }
    const primaryLang = browserLang.toLowerCase().split("-")[0];
    if (SUPPORTED_LANGUAGES.includes(primaryLang)) {
      console.log(`Detected and using language: ${primaryLang}`);
      return primaryLang;
    }
    console.log(`Language '${primaryLang}' not supported, using English fallback`);
    return "en";
  } catch (error) {
    console.error("Error detecting language:", error);
    return "en";
  }
}

const landingTranslations = {
  en: {
    heroTitle: "M1SSION™",
    heroSubtitle: "The Ultimate Challenge",
    heroDescription: "A prize awaits those who can see beyond. The clues are not hidden: they are disguised. It requires logic, coldness and vision. The challenge has begun.",
    joinTheHunt: "JOIN THE HUNT",
    learnMore: "LEARN MORE",
    missionStartsOn: "M1SSION STARTS ON 19 AUGUST",
    realPrizes: "REAL PRIZES",
    realPrizesDescription: "Not simulations. Not virtual tokens. Tangible prizes you can touch, use, own.",
    imageRepresentation: "Image for representation purposes",
    welcomeToMission: "WELCOME TO M1SSION™",
    registerForMission: "Register for M1SSION™",
    startMission: "START M1SSION",
    discoverMission: "Discover M1SSION",
    gdpr: {
      cookieTitle: "Cookie Settings",
      cookieDescription: 'We use cookies to enhance your experience, analyze site usage, and assist in our marketing efforts. By clicking "Accept All", you consent to our use of cookies.',
      cookieSettings: "Cookie Settings",
      cookiePreferences: "Cookie Preferences",
      acceptAll: "Accept All",
      rejectAll: "Reject All",
      saveSettings: "Save Settings",
      required: "Required",
      necessaryCookies: "Necessary Cookies",
      necessaryDescription: "Essential for the website to function properly. Cannot be disabled.",
      functionalCookies: "Functional Cookies",
      functionalDescription: "Enable enhanced functionality and personalization.",
      analyticsCookies: "Analytics Cookies",
      analyticsDescription: "Help us understand how visitors interact with the website.",
      marketingCookies: "Marketing Cookies",
      marketingDescription: "Used to track visitors and display relevant ads."
    }
  },
  it: {
    heroTitle: "M1SSION™",
    heroSubtitle: "La Sfida Definitiva",
    heroDescription: "Un premio attende chi sa vedere oltre. Gli indizi non sono nascosti: sono camuffati. Serve logica, freddezza e visione. La sfida è iniziata.",
    joinTheHunt: "UNISCITI ALLA CACCIA",
    learnMore: "SCOPRI DI PIÙ",
    missionStartsOn: "M1SSION INIZIA IL 19 AGOSTO",
    realPrizes: "PREMI REALI",
    realPrizesDescription: "Non simulazioni. Non gettoni virtuali. Premi tangibili che puoi toccare, usare, possedere.",
    imageRepresentation: "Immagine a scopo rappresentativo",
    welcomeToMission: "BENVENUTO IN M1SSION™",
    registerForMission: "Registrati per M1SSION™",
    startMission: "INIZIA M1SSION",
    discoverMission: "Scopri M1SSION",
    gdpr: {
      cookieTitle: "Impostazioni Cookie",
      cookieDescription: `Utilizziamo i cookie per migliorare la tua esperienza, analizzare l'utilizzo del sito e assistere nei nostri sforzi di marketing. Cliccando "Accetta Tutto", acconsenti all'uso dei nostri cookie.`,
      cookieSettings: "Impostazioni Cookie",
      cookiePreferences: "Preferenze Cookie",
      acceptAll: "Accetta Tutto",
      rejectAll: "Rifiuta Tutto",
      saveSettings: "Salva Impostazioni",
      required: "Richiesto",
      necessaryCookies: "Cookie Necessari",
      necessaryDescription: "Essenziali per il corretto funzionamento del sito web. Non possono essere disabilitati.",
      functionalCookies: "Cookie Funzionali",
      functionalDescription: "Abilitano funzionalità avanzate e personalizzazione.",
      analyticsCookies: "Cookie Analytics",
      analyticsDescription: "Ci aiutano a capire come i visitatori interagiscono con il sito web.",
      marketingCookies: "Cookie Marketing",
      marketingDescription: "Utilizzati per tracciare i visitatori e mostrare annunci pertinenti."
    }
  },
  fr: {
    heroTitle: "M1SSION™",
    heroSubtitle: "Le Défi Ultime",
    heroDescription: "Un prix attend ceux qui savent voir au-delà. Les indices ne sont pas cachés : ils sont déguisés. Il faut de la logique, de la froideur et de la vision. Le défi a commencé.",
    joinTheHunt: "REJOIGNEZ LA CHASSE",
    learnMore: "EN SAVOIR PLUS",
    missionStartsOn: "M1SSION COMMENCE LE 19 AOÛT",
    realPrizes: "VRAIS PRIX",
    realPrizesDescription: "Pas de simulations. Pas de jetons virtuels. Des prix tangibles que vous pouvez toucher, utiliser, posséder.",
    imageRepresentation: "Image à des fins de représentation",
    welcomeToMission: "BIENVENUE DANS M1SSION™",
    registerForMission: "S'inscrire à M1SSION™",
    startMission: "COMMENCER M1SSION",
    discoverMission: "Découvrir M1SSION",
    gdpr: {
      cookieTitle: "Paramètres des Cookies",
      cookieDescription: `Nous utilisons des cookies pour améliorer votre expérience, analyser l'utilisation du site et assister dans nos efforts marketing. En cliquant sur "Tout Accepter", vous consentez à notre utilisation des cookies.`,
      cookieSettings: "Paramètres des Cookies",
      cookiePreferences: "Préférences des Cookies",
      acceptAll: "Tout Accepter",
      rejectAll: "Tout Rejeter",
      saveSettings: "Sauvegarder les Paramètres",
      required: "Requis",
      necessaryCookies: "Cookies Nécessaires",
      necessaryDescription: "Essentiels pour le bon fonctionnement du site web. Ne peuvent pas être désactivés.",
      functionalCookies: "Cookies Fonctionnels",
      functionalDescription: "Permettent des fonctionnalités améliorées et la personnalisation.",
      analyticsCookies: "Cookies Analytics",
      analyticsDescription: "Nous aident à comprendre comment les visiteurs interagissent avec le site web.",
      marketingCookies: "Cookies Marketing",
      marketingDescription: "Utilisés pour suivre les visiteurs et afficher des publicités pertinentes."
    }
  },
  es: {
    heroTitle: "M1SSION™",
    heroSubtitle: "El Desafío Definitivo",
    heroDescription: "Un premio espera a quienes saben ver más allá. Las pistas no están ocultas: están disfrazadas. Requiere lógica, frialdad y visión. El desafío ha comenzado.",
    joinTheHunt: "ÚNETE A LA CAZA",
    learnMore: "SABER MÁS",
    missionStartsOn: "M1SSION COMIENZA EL 19 DE AGOSTO",
    realPrizes: "PREMIOS REALES",
    realPrizesDescription: "No simulaciones. No tokens virtuales. Premios tangibles que puedes tocar, usar, poseer.",
    imageRepresentation: "Imagen con fines representativos",
    welcomeToMission: "BIENVENIDO A M1SSION™",
    registerForMission: "Regístrate para M1SSION™",
    startMission: "INICIAR M1SSION",
    discoverMission: "Descubrir M1SSION",
    gdpr: {
      cookieTitle: "Configuración de Cookies",
      cookieDescription: 'Utilizamos cookies para mejorar tu experiencia, analizar el uso del sitio y asistir en nuestros esfuerzos de marketing. Al hacer clic en "Aceptar Todo", consientes nuestro uso de cookies.',
      cookieSettings: "Configuración de Cookies",
      cookiePreferences: "Preferencias de Cookies",
      acceptAll: "Aceptar Todo",
      rejectAll: "Rechazar Todo",
      saveSettings: "Guardar Configuración",
      required: "Requerido",
      necessaryCookies: "Cookies Necesarias",
      necessaryDescription: "Esenciales para el funcionamiento correcto del sitio web. No se pueden desactivar.",
      functionalCookies: "Cookies Funcionales",
      functionalDescription: "Permiten funcionalidad mejorada y personalización.",
      analyticsCookies: "Cookies Analytics",
      analyticsDescription: "Nos ayudan a entender cómo los visitantes interactúan con el sitio web.",
      marketingCookies: "Cookies Marketing",
      marketingDescription: "Utilizadas para rastrear visitantes y mostrar anuncios relevantes."
    }
  },
  de: {
    heroTitle: "M1SSION™",
    heroSubtitle: "Die Ultimative Herausforderung",
    heroDescription: "Ein Preis wartet auf diejenigen, die über das Offensichtliche hinaussehen können. Die Hinweise sind nicht versteckt: sie sind getarnt. Es erfordert Logik, Kälte und Vision. Die Herausforderung hat begonnen.",
    joinTheHunt: "DER JAGD BEITRETEN",
    learnMore: "MEHR ERFAHREN",
    missionStartsOn: "M1SSION BEGINNT AM 19. AUGUST",
    realPrizes: "ECHTE PREISE",
    realPrizesDescription: "Keine Simulationen. Keine virtuellen Token. Greifbare Preise, die Sie berühren, verwenden, besitzen können.",
    imageRepresentation: "Bild zu Darstellungszwecken",
    welcomeToMission: "WILLKOMMEN BEI M1SSION™",
    registerForMission: "Für M1SSION™ registrieren",
    startMission: "M1SSION STARTEN",
    discoverMission: "M1SSION Entdecken",
    gdpr: {
      cookieTitle: "Cookie-Einstellungen",
      cookieDescription: 'Wir verwenden Cookies, um Ihre Erfahrung zu verbessern, die Nutzung der Website zu analysieren und bei unseren Marketingbemühungen zu helfen. Durch Klicken auf "Alle Akzeptieren" stimmen Sie unserer Verwendung von Cookies zu.',
      cookieSettings: "Cookie-Einstellungen",
      cookiePreferences: "Cookie-Präferenzen",
      acceptAll: "Alle Akzeptieren",
      rejectAll: "Alle Ablehnen",
      saveSettings: "Einstellungen Speichern",
      required: "Erforderlich",
      necessaryCookies: "Notwendige Cookies",
      necessaryDescription: "Wesentlich für das ordnungsgemäße Funktionieren der Website. Können nicht deaktiviert werden.",
      functionalCookies: "Funktionale Cookies",
      functionalDescription: "Ermöglichen erweiterte Funktionalität und Personalisierung.",
      analyticsCookies: "Analytics Cookies",
      analyticsDescription: "Helfen uns zu verstehen, wie Besucher mit der Website interagieren.",
      marketingCookies: "Marketing Cookies",
      marketingDescription: "Werden verwendet, um Besucher zu verfolgen und relevante Werbung anzuzeigen."
    }
  },
  pt: {
    heroTitle: "M1SSION™",
    heroSubtitle: "O Desafio Definitivo",
    heroDescription: "Um prêmio aguarda aqueles que sabem ver além. As pistas não estão escondidas: estão disfarçadas. Requer lógica, frieza e visão. O desafio começou.",
    joinTheHunt: "JUNTE-SE À CAÇADA",
    learnMore: "SABER MAIS",
    missionStartsOn: "M1SSION COMEÇA EM 19 DE AGOSTO",
    realPrizes: "PRÊMIOS REAIS",
    realPrizesDescription: "Não simulações. Não tokens virtuais. Prêmios tangíveis que você pode tocar, usar, possuir.",
    imageRepresentation: "Imagem para fins de representação",
    welcomeToMission: "BEM-VINDO À M1SSION™",
    registerForMission: "Registre-se para M1SSION™",
    startMission: "INICIAR M1SSION",
    discoverMission: "Descobrir M1SSION",
    gdpr: {
      cookieTitle: "Configurações de Cookies",
      cookieDescription: 'Usamos cookies para melhorar sua experiência, analisar o uso do site e auxiliar em nossos esforços de marketing. Ao clicar em "Aceitar Tudo", você consente com nosso uso de cookies.',
      cookieSettings: "Configurações de Cookies",
      cookiePreferences: "Preferências de Cookies",
      acceptAll: "Aceitar Tudo",
      rejectAll: "Rejeitar Tudo",
      saveSettings: "Salvar Configurações",
      required: "Obrigatório",
      necessaryCookies: "Cookies Necessários",
      necessaryDescription: "Essenciais para o funcionamento adequado do site. Não podem ser desabilitados.",
      functionalCookies: "Cookies Funcionais",
      functionalDescription: "Permitem funcionalidade aprimorada e personalização.",
      analyticsCookies: "Cookies Analytics",
      analyticsDescription: "Nos ajudam a entender como os visitantes interagem com o site.",
      marketingCookies: "Cookies Marketing",
      marketingDescription: "Usados para rastrear visitantes e exibir anúncios relevantes."
    }
  },
  zh: {
    heroTitle: "M1SSION™",
    heroSubtitle: "终极挑战",
    heroDescription: "奖品等待着那些能够看得更远的人。线索并非隐藏：它们被伪装了。需要逻辑、冷静和远见。挑战已经开始。",
    joinTheHunt: "加入狩猎",
    learnMore: "了解更多",
    missionStartsOn: "M1SSION 将于 8 月 19 日开始",
    realPrizes: "真实奖品",
    realPrizesDescription: "不是模拟。不是虚拟代币。您可以触摸、使用、拥有的有形奖品。",
    imageRepresentation: "图像仅供参考",
    welcomeToMission: "欢迎来到 M1SSION™",
    registerForMission: "注册 M1SSION™",
    startMission: "开始 M1SSION",
    discoverMission: "发现 M1SSION",
    gdpr: {
      cookieTitle: "Cookie 设置",
      cookieDescription: '我们使用 cookie 来增强您的体验，分析网站使用情况，并协助我们的营销工作。点击"全部接受"，即表示您同意我们使用 cookie。',
      cookieSettings: "Cookie 设置",
      cookiePreferences: "Cookie 偏好",
      acceptAll: "全部接受",
      rejectAll: "全部拒绝",
      saveSettings: "保存设置",
      required: "必需",
      necessaryCookies: "必要 Cookie",
      necessaryDescription: "网站正常运行所必需的。无法禁用。",
      functionalCookies: "功能性 Cookie",
      functionalDescription: "启用增强功能和个性化。",
      analyticsCookies: "分析 Cookie",
      analyticsDescription: "帮助我们了解访问者如何与网站互动。",
      marketingCookies: "营销 Cookie",
      marketingDescription: "用于跟踪访问者并显示相关广告。"
    }
  },
  ar: {
    heroTitle: "M1SSION™",
    heroSubtitle: "التحدي النهائي",
    heroDescription: "جائزة تنتظر أولئك الذين يستطيعون الرؤية أبعد من الواضح. الأدلة ليست مخفية: إنها مقنعة. تتطلب منطقًا وبرودة ورؤية. لقد بدأ التحدي.",
    joinTheHunt: "انضم للصيد",
    learnMore: "اعرف المزيد",
    missionStartsOn: "M1SSION تبدأ في 19 أغسطس",
    realPrizes: "جوائز حقيقية",
    realPrizesDescription: "ليست محاكاة. ليست رموزًا افتراضية. جوائز ملموسة يمكنك لمسها واستخدامها وامتلاكها.",
    imageRepresentation: "صورة لأغراض التمثيل",
    welcomeToMission: "مرحبًا بك في M1SSION™",
    registerForMission: "سجل في M1SSION™",
    startMission: "ابدأ M1SSION",
    discoverMission: "اكتشف M1SSION",
    gdpr: {
      cookieTitle: "إعدادات ملفات تعريف الارتباط",
      cookieDescription: 'نستخدم ملفات تعريف الارتباط لتحسين تجربتك وتحليل استخدام الموقع والمساعدة في جهودنا التسويقية. بالنقر على "قبول الكل"، فإنك توافق على استخدامنا لملفات تعريف الارتباط.',
      cookieSettings: "إعدادات ملفات تعريف الارتباط",
      cookiePreferences: "تفضيلات ملفات تعريف الارتباط",
      acceptAll: "قبول الكل",
      rejectAll: "رفض الكل",
      saveSettings: "حفظ الإعدادات",
      required: "مطلوب",
      necessaryCookies: "ملفات تعريف الارتباط الضرورية",
      necessaryDescription: "ضرورية للتشغيل السليم للموقع. لا يمكن تعطيلها.",
      functionalCookies: "ملفات تعريف الارتباط الوظيفية",
      functionalDescription: "تمكن الوظائف المحسنة والتخصيص.",
      analyticsCookies: "ملفات تعريف الارتباط التحليلية",
      analyticsDescription: "تساعدنا على فهم كيفية تفاعل الزوار مع الموقع.",
      marketingCookies: "ملفات تعريف الارتباط التسويقية",
      marketingDescription: "تُستخدم لتتبع الزوار وعرض الإعلانات ذات الصلة."
    }
  }
};

const useLandingTranslations = () => {
  const [currentLanguage, setCurrentLanguage] = reactExports.useState("en");
  const [translations, setTranslations] = reactExports.useState(landingTranslations.en);
  reactExports.useEffect(() => {
    const detectedLanguage = detectInitialLanguage();
    setCurrentLanguage(detectedLanguage);
    setTranslations(landingTranslations[detectedLanguage]);
  }, []);
  const t = (key) => {
    const keys = key.split(".");
    let result = translations;
    for (const k of keys) {
      result = result?.[k];
      if (result === void 0) {
        console.warn(`Translation key "${key}" not found for language "${currentLanguage}"`);
        return key;
      }
    }
    return result;
  };
  return {
    t,
    currentLanguage,
    setLanguage: (lang) => {
      setCurrentLanguage(lang);
      setTranslations(landingTranslations[lang]);
    }
  };
};

const CookieBanner$1 = () => {
  const { t } = useLandingTranslations();
  const [isVisible, setIsVisible] = reactExports.useState(false);
  const [showSettings, setShowSettings] = reactExports.useState(false);
  const [preferences, setPreferences] = reactExports.useState({
    necessary: true,
    // Always true, can't be disabled
    analytics: false,
    marketing: false,
    functional: false
  });
  reactExports.useEffect(() => {
    const cookieConsent = localStorage.getItem("cookie_consent") || localStorage.getItem("m1ssion-cookie-consent");
    const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
    const lastShown = localStorage.getItem("cookie_banner_last_shown");
    if (!cookieConsent || lastShown !== today) {
      const timer = setTimeout(() => setIsVisible(true), 1e3);
      return () => clearTimeout(timer);
    }
  }, []);
  const handleAcceptAll = () => {
    const allAccepted = {
      necessary: true,
      analytics: true,
      marketing: true,
      functional: true
    };
    const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
    localStorage.setItem("cookie_consent", JSON.stringify(allAccepted));
    localStorage.setItem("cookie_banner_last_shown", today);
    localStorage.setItem("m1ssion-cookie-consent", JSON.stringify(allAccepted));
    localStorage.setItem("m1ssion-cookie-timestamp", (/* @__PURE__ */ new Date()).toISOString());
    setIsVisible(false);
    console.log("🍪 All cookies accepted - GDPR component");
  };
  const handleRejectAll = () => {
    const onlyNecessary = {
      necessary: true,
      analytics: false,
      marketing: false,
      functional: false
    };
    const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
    localStorage.setItem("cookie_consent", JSON.stringify(onlyNecessary));
    localStorage.setItem("cookie_banner_last_shown", today);
    localStorage.setItem("m1ssion-cookie-consent", JSON.stringify(onlyNecessary));
    localStorage.setItem("m1ssion-cookie-timestamp", (/* @__PURE__ */ new Date()).toISOString());
    setIsVisible(false);
    console.log("🍪 Only necessary cookies accepted - GDPR component");
  };
  const handleSaveSettings = () => {
    const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
    localStorage.setItem("cookie_consent", JSON.stringify(preferences));
    localStorage.setItem("cookie_banner_last_shown", today);
    localStorage.setItem("m1ssion-cookie-consent", JSON.stringify(preferences));
    localStorage.setItem("m1ssion-cookie-timestamp", (/* @__PURE__ */ new Date()).toISOString());
    setIsVisible(false);
    setShowSettings(false);
    console.log("🍪 Custom cookie preferences saved - GDPR component:", preferences);
  };
  const togglePreference = (key) => {
    if (key === "necessary") return;
    setPreferences((prev) => ({
      ...prev,
      [key]: !prev[key]
    }));
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isVisible && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { y: 100, opacity: 0 },
      animate: { y: 0, opacity: 1 },
      exit: { y: 100, opacity: 0 },
      transition: { duration: 0.5, ease: "easeOut" },
      className: "fixed inset-0 flex items-center justify-center z-[9999] p-4",
      style: {
        paddingTop: "calc(env(safe-area-inset-top, 0px) + 20px)",
        paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 20px)",
        backgroundColor: "rgba(0, 0, 0, 0.7)",
        backdropFilter: "blur(8px)"
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-6xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "m1ssion-glass-card p-6", children: !showSettings ? (
        // Main banner
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col lg:flex-row lg:items-center gap-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-4 flex-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-8 h-8 text-cyan-400 mt-1 flex-shrink-0" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white mb-2", children: t("gdpr.cookieTitle") || "Cookie Settings" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 text-sm leading-relaxed", children: t("gdpr.cookieDescription") || 'We use cookies to enhance your experience, analyze site usage, and assist in our marketing efforts. By clicking "Accept All", you consent to our use of cookies.' })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-3 lg:ml-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: () => setShowSettings(true),
                variant: "outline",
                className: "text-cyan-400 border-cyan-400/50 hover:bg-cyan-400/10 hover:border-cyan-400 transition-all duration-300",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 mr-2" }),
                  t("gdpr.cookieSettings") || "Cookie Settings"
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleRejectAll,
                variant: "outline",
                className: "text-gray-300 border-gray-500/50 hover:bg-gray-500/10 hover:border-gray-400 transition-all duration-300",
                children: t("gdpr.rejectAll") || "Reject All"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleAcceptAll,
                className: "bg-gradient-to-r from-cyan-400 to-purple-600 text-black font-bold hover:shadow-[0_0_20px_rgba(0,229,255,0.5)] transition-all duration-300",
                children: t("gdpr.acceptAll") || "Accept All"
              }
            )
          ] })
        ] })
      ) : (
        // Settings panel
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white", children: t("gdpr.cookiePreferences") || "Cookie Preferences" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setShowSettings(false),
                className: "text-gray-400 hover:text-white transition-colors",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-6 h-6" })
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4 mb-6", children: [
            {
              key: "necessary",
              title: t("gdpr.necessaryCookies") || "Necessary Cookies",
              description: t("gdpr.necessaryDescription") || "Essential for the website to function properly. Cannot be disabled.",
              required: true
            },
            {
              key: "functional",
              title: t("gdpr.functionalCookies") || "Functional Cookies",
              description: t("gdpr.functionalDescription") || "Enable enhanced functionality and personalization.",
              required: false
            },
            {
              key: "analytics",
              title: t("gdpr.analyticsCookies") || "Analytics Cookies",
              description: t("gdpr.analyticsDescription") || "Help us understand how visitors interact with the website.",
              required: false
            },
            {
              key: "marketing",
              title: t("gdpr.marketingCookies") || "Marketing Cookies",
              description: t("gdpr.marketingDescription") || "Used to track visitors and display relevant ads.",
              required: false
            }
          ].map((cookie) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between p-4 rounded-lg bg-white/5 border border-white/10", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-white", children: cookie.title }),
                cookie.required && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs bg-cyan-400/20 text-cyan-400 px-2 py-1 rounded", children: t("gdpr.required") || "Required" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400", children: cookie.description })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "ml-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => togglePreference(cookie.key),
                disabled: cookie.required,
                className: `relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${preferences[cookie.key] ? "bg-cyan-400" : "bg-gray-600"} ${cookie.required ? "opacity-50 cursor-not-allowed" : "cursor-pointer"}`,
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "span",
                  {
                    className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${preferences[cookie.key] ? "translate-x-6" : "translate-x-1"}`
                  }
                )
              }
            ) })
          ] }, cookie.key)) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleRejectAll,
                variant: "outline",
                className: "text-gray-300 border-gray-500/50 hover:bg-gray-500/10 hover:border-gray-400 transition-all duration-300",
                children: t("gdpr.rejectAll") || "Reject All"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleSaveSettings,
                className: "bg-gradient-to-r from-cyan-400 to-purple-600 text-black font-bold hover:shadow-[0_0_20px_rgba(0,229,255,0.5)] transition-all duration-300 flex-1",
                children: t("gdpr.saveSettings") || "Save Settings"
              }
            )
          ] })
        ] })
      ) }) })
    }
  ) });
};

function _assertThisInitialized(self) {
  if (self === void 0) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }
  return self;
}
function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;
  subClass.__proto__ = superClass;
}
/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/
var _config = {
  autoSleep: 120,
  force3D: "auto",
  nullTargetWarn: 1,
  units: {
    lineHeight: ""
  }
}, _defaults$1 = {
  duration: 0.5,
  overwrite: false,
  delay: 0
}, _suppressOverwrites$1, _reverting$1, _context$2, _bigNum$1 = 1e8, _tinyNum = 1 / _bigNum$1, _2PI = Math.PI * 2, _HALF_PI = _2PI / 4, _gsID = 0, _sqrt = Math.sqrt, _cos = Math.cos, _sin = Math.sin, _isString$1 = function _isString2(value) {
  return typeof value === "string";
}, _isFunction$1 = function _isFunction2(value) {
  return typeof value === "function";
}, _isNumber$1 = function _isNumber2(value) {
  return typeof value === "number";
}, _isUndefined = function _isUndefined2(value) {
  return typeof value === "undefined";
}, _isObject$1 = function _isObject2(value) {
  return typeof value === "object";
}, _isNotFalse = function _isNotFalse2(value) {
  return value !== false;
}, _windowExists$2 = function _windowExists2() {
  return typeof window !== "undefined";
}, _isFuncOrString = function _isFuncOrString2(value) {
  return _isFunction$1(value) || _isString$1(value);
}, _isTypedArray = typeof ArrayBuffer === "function" && ArrayBuffer.isView || function() {
}, _isArray = Array.isArray, _strictNumExp = /(?:-?\.?\d|\.)+/gi, _numExp = /[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g, _numWithUnitExp = /[-+=.]*\d+[.e-]*\d*[a-z%]*/g, _complexStringNumExp = /[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi, _relExp = /[+-]=-?[.\d]+/, _delimitedValueExp = /[^,'"\[\]\s]+/gi, _unitExp = /^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i, _globalTimeline, _win$3, _coreInitted$2, _doc$3, _globals = {}, _installScope = {}, _coreReady, _install = function _install2(scope) {
  return (_installScope = _merge(scope, _globals)) && gsap$2;
}, _missingPlugin = function _missingPlugin2(property, value) {
  return console.warn("Invalid property", property, "set to", value, "Missing plugin? gsap.registerPlugin()");
}, _warn = function _warn2(message, suppress) {
  return !suppress && console.warn(message);
}, _addGlobal = function _addGlobal2(name, obj) {
  return name && (_globals[name] = obj) && _installScope && (_installScope[name] = obj) || _globals;
}, _emptyFunc = function _emptyFunc2() {
  return 0;
}, _startAtRevertConfig = {
  suppressEvents: true,
  isStart: true,
  kill: false
}, _revertConfigNoKill = {
  suppressEvents: true,
  kill: false
}, _revertConfig = {
  suppressEvents: true
}, _reservedProps = {}, _lazyTweens = [], _lazyLookup = {}, _lastRenderedFrame, _plugins = {}, _effects = {}, _nextGCFrame = 30, _harnessPlugins = [], _callbackNames = "", _harness = function _harness2(targets) {
  var target = targets[0], harnessPlugin, i;
  _isObject$1(target) || _isFunction$1(target) || (targets = [targets]);
  if (!(harnessPlugin = (target._gsap || {}).harness)) {
    i = _harnessPlugins.length;
    while (i-- && !_harnessPlugins[i].targetTest(target)) {
    }
    harnessPlugin = _harnessPlugins[i];
  }
  i = targets.length;
  while (i--) {
    targets[i] && (targets[i]._gsap || (targets[i]._gsap = new GSCache(targets[i], harnessPlugin))) || targets.splice(i, 1);
  }
  return targets;
}, _getCache = function _getCache2(target) {
  return target._gsap || _harness(toArray(target))[0]._gsap;
}, _getProperty = function _getProperty2(target, property, v) {
  return (v = target[property]) && _isFunction$1(v) ? target[property]() : _isUndefined(v) && target.getAttribute && target.getAttribute(property) || v;
}, _forEachName = function _forEachName2(names, func) {
  return (names = names.split(",")).forEach(func) || names;
}, _round$1 = function _round2(value) {
  return Math.round(value * 1e5) / 1e5 || 0;
}, _roundPrecise = function _roundPrecise2(value) {
  return Math.round(value * 1e7) / 1e7 || 0;
}, _parseRelative = function _parseRelative2(start, value) {
  var operator = value.charAt(0), end = parseFloat(value.substr(2));
  start = parseFloat(start);
  return operator === "+" ? start + end : operator === "-" ? start - end : operator === "*" ? start * end : start / end;
}, _arrayContainsAny = function _arrayContainsAny2(toSearch, toFind) {
  var l = toFind.length, i = 0;
  for (; toSearch.indexOf(toFind[i]) < 0 && ++i < l; ) {
  }
  return i < l;
}, _lazyRender = function _lazyRender2() {
  var l = _lazyTweens.length, a = _lazyTweens.slice(0), i, tween;
  _lazyLookup = {};
  _lazyTweens.length = 0;
  for (i = 0; i < l; i++) {
    tween = a[i];
    tween && tween._lazy && (tween.render(tween._lazy[0], tween._lazy[1], true)._lazy = 0);
  }
}, _isRevertWorthy = function _isRevertWorthy2(animation) {
  return !!(animation._initted || animation._startAt || animation.add);
}, _lazySafeRender = function _lazySafeRender2(animation, time, suppressEvents, force) {
  _lazyTweens.length && !_reverting$1 && _lazyRender();
  animation.render(time, suppressEvents, !!(_reverting$1 && time < 0 && _isRevertWorthy(animation)));
  _lazyTweens.length && !_reverting$1 && _lazyRender();
}, _numericIfPossible = function _numericIfPossible2(value) {
  var n = parseFloat(value);
  return (n || n === 0) && (value + "").match(_delimitedValueExp).length < 2 ? n : _isString$1(value) ? value.trim() : value;
}, _passThrough$1 = function _passThrough2(p) {
  return p;
}, _setDefaults$1 = function _setDefaults2(obj, defaults2) {
  for (var p in defaults2) {
    p in obj || (obj[p] = defaults2[p]);
  }
  return obj;
}, _setKeyframeDefaults = function _setKeyframeDefaults2(excludeDuration) {
  return function(obj, defaults2) {
    for (var p in defaults2) {
      p in obj || p === "duration" && excludeDuration || p === "ease" || (obj[p] = defaults2[p]);
    }
  };
}, _merge = function _merge2(base, toMerge) {
  for (var p in toMerge) {
    base[p] = toMerge[p];
  }
  return base;
}, _mergeDeep = function _mergeDeep2(base, toMerge) {
  for (var p in toMerge) {
    p !== "__proto__" && p !== "constructor" && p !== "prototype" && (base[p] = _isObject$1(toMerge[p]) ? _mergeDeep2(base[p] || (base[p] = {}), toMerge[p]) : toMerge[p]);
  }
  return base;
}, _copyExcluding = function _copyExcluding2(obj, excluding) {
  var copy = {}, p;
  for (p in obj) {
    p in excluding || (copy[p] = obj[p]);
  }
  return copy;
}, _inheritDefaults = function _inheritDefaults2(vars) {
  var parent = vars.parent || _globalTimeline, func = vars.keyframes ? _setKeyframeDefaults(_isArray(vars.keyframes)) : _setDefaults$1;
  if (_isNotFalse(vars.inherit)) {
    while (parent) {
      func(vars, parent.vars.defaults);
      parent = parent.parent || parent._dp;
    }
  }
  return vars;
}, _arraysMatch = function _arraysMatch2(a1, a2) {
  var i = a1.length, match = i === a2.length;
  while (match && i-- && a1[i] === a2[i]) {
  }
  return i < 0;
}, _addLinkedListItem = function _addLinkedListItem2(parent, child, firstProp, lastProp, sortBy) {
  var prev = parent[lastProp], t;
  if (sortBy) {
    t = child[sortBy];
    while (prev && prev[sortBy] > t) {
      prev = prev._prev;
    }
  }
  if (prev) {
    child._next = prev._next;
    prev._next = child;
  } else {
    child._next = parent[firstProp];
    parent[firstProp] = child;
  }
  if (child._next) {
    child._next._prev = child;
  } else {
    parent[lastProp] = child;
  }
  child._prev = prev;
  child.parent = child._dp = parent;
  return child;
}, _removeLinkedListItem = function _removeLinkedListItem2(parent, child, firstProp, lastProp) {
  if (firstProp === void 0) {
    firstProp = "_first";
  }
  if (lastProp === void 0) {
    lastProp = "_last";
  }
  var prev = child._prev, next = child._next;
  if (prev) {
    prev._next = next;
  } else if (parent[firstProp] === child) {
    parent[firstProp] = next;
  }
  if (next) {
    next._prev = prev;
  } else if (parent[lastProp] === child) {
    parent[lastProp] = prev;
  }
  child._next = child._prev = child.parent = null;
}, _removeFromParent = function _removeFromParent2(child, onlyIfParentHasAutoRemove) {
  child.parent && (!onlyIfParentHasAutoRemove || child.parent.autoRemoveChildren) && child.parent.remove && child.parent.remove(child);
  child._act = 0;
}, _uncache = function _uncache2(animation, child) {
  if (animation && (!child || child._end > animation._dur || child._start < 0)) {
    var a = animation;
    while (a) {
      a._dirty = 1;
      a = a.parent;
    }
  }
  return animation;
}, _recacheAncestors = function _recacheAncestors2(animation) {
  var parent = animation.parent;
  while (parent && parent.parent) {
    parent._dirty = 1;
    parent.totalDuration();
    parent = parent.parent;
  }
  return animation;
}, _rewindStartAt = function _rewindStartAt2(tween, totalTime, suppressEvents, force) {
  return tween._startAt && (_reverting$1 ? tween._startAt.revert(_revertConfigNoKill) : tween.vars.immediateRender && !tween.vars.autoRevert || tween._startAt.render(totalTime, true, force));
}, _hasNoPausedAncestors = function _hasNoPausedAncestors2(animation) {
  return !animation || animation._ts && _hasNoPausedAncestors2(animation.parent);
}, _elapsedCycleDuration = function _elapsedCycleDuration2(animation) {
  return animation._repeat ? _animationCycle(animation._tTime, animation = animation.duration() + animation._rDelay) * animation : 0;
}, _animationCycle = function _animationCycle2(tTime, cycleDuration) {
  var whole = Math.floor(tTime = _roundPrecise(tTime / cycleDuration));
  return tTime && whole === tTime ? whole - 1 : whole;
}, _parentToChildTotalTime = function _parentToChildTotalTime2(parentTime, child) {
  return (parentTime - child._start) * child._ts + (child._ts >= 0 ? 0 : child._dirty ? child.totalDuration() : child._tDur);
}, _setEnd = function _setEnd2(animation) {
  return animation._end = _roundPrecise(animation._start + (animation._tDur / Math.abs(animation._ts || animation._rts || _tinyNum) || 0));
}, _alignPlayhead = function _alignPlayhead2(animation, totalTime) {
  var parent = animation._dp;
  if (parent && parent.smoothChildTiming && animation._ts) {
    animation._start = _roundPrecise(parent._time - (animation._ts > 0 ? totalTime / animation._ts : ((animation._dirty ? animation.totalDuration() : animation._tDur) - totalTime) / -animation._ts));
    _setEnd(animation);
    parent._dirty || _uncache(parent, animation);
  }
  return animation;
}, _postAddChecks = function _postAddChecks2(timeline2, child) {
  var t;
  if (child._time || !child._dur && child._initted || child._start < timeline2._time && (child._dur || !child.add)) {
    t = _parentToChildTotalTime(timeline2.rawTime(), child);
    if (!child._dur || _clamp$1(0, child.totalDuration(), t) - child._tTime > _tinyNum) {
      child.render(t, true);
    }
  }
  if (_uncache(timeline2, child)._dp && timeline2._initted && timeline2._time >= timeline2._dur && timeline2._ts) {
    if (timeline2._dur < timeline2.duration()) {
      t = timeline2;
      while (t._dp) {
        t.rawTime() >= 0 && t.totalTime(t._tTime);
        t = t._dp;
      }
    }
    timeline2._zTime = -_tinyNum;
  }
}, _addToTimeline = function _addToTimeline2(timeline2, child, position, skipChecks) {
  child.parent && _removeFromParent(child);
  child._start = _roundPrecise((_isNumber$1(position) ? position : position || timeline2 !== _globalTimeline ? _parsePosition$1(timeline2, position, child) : timeline2._time) + child._delay);
  child._end = _roundPrecise(child._start + (child.totalDuration() / Math.abs(child.timeScale()) || 0));
  _addLinkedListItem(timeline2, child, "_first", "_last", timeline2._sort ? "_start" : 0);
  _isFromOrFromStart(child) || (timeline2._recent = child);
  skipChecks || _postAddChecks(timeline2, child);
  timeline2._ts < 0 && _alignPlayhead(timeline2, timeline2._tTime);
  return timeline2;
}, _scrollTrigger = function _scrollTrigger2(animation, trigger) {
  return (_globals.ScrollTrigger || _missingPlugin("scrollTrigger", trigger)) && _globals.ScrollTrigger.create(trigger, animation);
}, _attemptInitTween = function _attemptInitTween2(tween, time, force, suppressEvents, tTime) {
  _initTween(tween, time, tTime);
  if (!tween._initted) {
    return 1;
  }
  if (!force && tween._pt && !_reverting$1 && (tween._dur && tween.vars.lazy !== false || !tween._dur && tween.vars.lazy) && _lastRenderedFrame !== _ticker.frame) {
    _lazyTweens.push(tween);
    tween._lazy = [tTime, suppressEvents];
    return 1;
  }
}, _parentPlayheadIsBeforeStart = function _parentPlayheadIsBeforeStart2(_ref) {
  var parent = _ref.parent;
  return parent && parent._ts && parent._initted && !parent._lock && (parent.rawTime() < 0 || _parentPlayheadIsBeforeStart2(parent));
}, _isFromOrFromStart = function _isFromOrFromStart2(_ref2) {
  var data = _ref2.data;
  return data === "isFromStart" || data === "isStart";
}, _renderZeroDurationTween = function _renderZeroDurationTween2(tween, totalTime, suppressEvents, force) {
  var prevRatio = tween.ratio, ratio = totalTime < 0 || !totalTime && (!tween._start && _parentPlayheadIsBeforeStart(tween) && !(!tween._initted && _isFromOrFromStart(tween)) || (tween._ts < 0 || tween._dp._ts < 0) && !_isFromOrFromStart(tween)) ? 0 : 1, repeatDelay = tween._rDelay, tTime = 0, pt, iteration, prevIteration;
  if (repeatDelay && tween._repeat) {
    tTime = _clamp$1(0, tween._tDur, totalTime);
    iteration = _animationCycle(tTime, repeatDelay);
    tween._yoyo && iteration & 1 && (ratio = 1 - ratio);
    if (iteration !== _animationCycle(tween._tTime, repeatDelay)) {
      prevRatio = 1 - ratio;
      tween.vars.repeatRefresh && tween._initted && tween.invalidate();
    }
  }
  if (ratio !== prevRatio || _reverting$1 || force || tween._zTime === _tinyNum || !totalTime && tween._zTime) {
    if (!tween._initted && _attemptInitTween(tween, totalTime, force, suppressEvents, tTime)) {
      return;
    }
    prevIteration = tween._zTime;
    tween._zTime = totalTime || (suppressEvents ? _tinyNum : 0);
    suppressEvents || (suppressEvents = totalTime && !prevIteration);
    tween.ratio = ratio;
    tween._from && (ratio = 1 - ratio);
    tween._time = 0;
    tween._tTime = tTime;
    pt = tween._pt;
    while (pt) {
      pt.r(ratio, pt.d);
      pt = pt._next;
    }
    totalTime < 0 && _rewindStartAt(tween, totalTime, suppressEvents, true);
    tween._onUpdate && !suppressEvents && _callback$1(tween, "onUpdate");
    tTime && tween._repeat && !suppressEvents && tween.parent && _callback$1(tween, "onRepeat");
    if ((totalTime >= tween._tDur || totalTime < 0) && tween.ratio === ratio) {
      ratio && _removeFromParent(tween, 1);
      if (!suppressEvents && !_reverting$1) {
        _callback$1(tween, ratio ? "onComplete" : "onReverseComplete", true);
        tween._prom && tween._prom();
      }
    }
  } else if (!tween._zTime) {
    tween._zTime = totalTime;
  }
}, _findNextPauseTween = function _findNextPauseTween2(animation, prevTime, time) {
  var child;
  if (time > prevTime) {
    child = animation._first;
    while (child && child._start <= time) {
      if (child.data === "isPause" && child._start > prevTime) {
        return child;
      }
      child = child._next;
    }
  } else {
    child = animation._last;
    while (child && child._start >= time) {
      if (child.data === "isPause" && child._start < prevTime) {
        return child;
      }
      child = child._prev;
    }
  }
}, _setDuration = function _setDuration2(animation, duration, skipUncache, leavePlayhead) {
  var repeat = animation._repeat, dur = _roundPrecise(duration) || 0, totalProgress = animation._tTime / animation._tDur;
  totalProgress && !leavePlayhead && (animation._time *= dur / animation._dur);
  animation._dur = dur;
  animation._tDur = !repeat ? dur : repeat < 0 ? 1e10 : _roundPrecise(dur * (repeat + 1) + animation._rDelay * repeat);
  totalProgress > 0 && !leavePlayhead && _alignPlayhead(animation, animation._tTime = animation._tDur * totalProgress);
  animation.parent && _setEnd(animation);
  skipUncache || _uncache(animation.parent, animation);
  return animation;
}, _onUpdateTotalDuration = function _onUpdateTotalDuration2(animation) {
  return animation instanceof Timeline ? _uncache(animation) : _setDuration(animation, animation._dur);
}, _zeroPosition = {
  _start: 0,
  endTime: _emptyFunc,
  totalDuration: _emptyFunc
}, _parsePosition$1 = function _parsePosition2(animation, position, percentAnimation) {
  var labels = animation.labels, recent = animation._recent || _zeroPosition, clippedDuration = animation.duration() >= _bigNum$1 ? recent.endTime(false) : animation._dur, i, offset, isPercent;
  if (_isString$1(position) && (isNaN(position) || position in labels)) {
    offset = position.charAt(0);
    isPercent = position.substr(-1) === "%";
    i = position.indexOf("=");
    if (offset === "<" || offset === ">") {
      i >= 0 && (position = position.replace(/=/, ""));
      return (offset === "<" ? recent._start : recent.endTime(recent._repeat >= 0)) + (parseFloat(position.substr(1)) || 0) * (isPercent ? (i < 0 ? recent : percentAnimation).totalDuration() / 100 : 1);
    }
    if (i < 0) {
      position in labels || (labels[position] = clippedDuration);
      return labels[position];
    }
    offset = parseFloat(position.charAt(i - 1) + position.substr(i + 1));
    if (isPercent && percentAnimation) {
      offset = offset / 100 * (_isArray(percentAnimation) ? percentAnimation[0] : percentAnimation).totalDuration();
    }
    return i > 1 ? _parsePosition2(animation, position.substr(0, i - 1), percentAnimation) + offset : clippedDuration + offset;
  }
  return position == null ? clippedDuration : +position;
}, _createTweenType = function _createTweenType2(type, params, timeline2) {
  var isLegacy = _isNumber$1(params[1]), varsIndex = (isLegacy ? 2 : 1) + (type < 2 ? 0 : 1), vars = params[varsIndex], irVars, parent;
  isLegacy && (vars.duration = params[1]);
  vars.parent = timeline2;
  if (type) {
    irVars = vars;
    parent = timeline2;
    while (parent && !("immediateRender" in irVars)) {
      irVars = parent.vars.defaults || {};
      parent = _isNotFalse(parent.vars.inherit) && parent.parent;
    }
    vars.immediateRender = _isNotFalse(irVars.immediateRender);
    type < 2 ? vars.runBackwards = 1 : vars.startAt = params[varsIndex - 1];
  }
  return new Tween(params[0], vars, params[varsIndex + 1]);
}, _conditionalReturn = function _conditionalReturn2(value, func) {
  return value || value === 0 ? func(value) : func;
}, _clamp$1 = function _clamp2(min, max, value) {
  return value < min ? min : value > max ? max : value;
}, getUnit = function getUnit2(value, v) {
  return !_isString$1(value) || !(v = _unitExp.exec(value)) ? "" : v[1];
}, clamp$1 = function clamp2(min, max, value) {
  return _conditionalReturn(value, function(v) {
    return _clamp$1(min, max, v);
  });
}, _slice = [].slice, _isArrayLike = function _isArrayLike2(value, nonEmpty) {
  return value && _isObject$1(value) && "length" in value && (!nonEmpty && !value.length || value.length - 1 in value && _isObject$1(value[0])) && !value.nodeType && value !== _win$3;
}, _flatten = function _flatten2(ar, leaveStrings, accumulator) {
  if (accumulator === void 0) {
    accumulator = [];
  }
  return ar.forEach(function(value) {
    var _accumulator;
    return _isString$1(value) && !leaveStrings || _isArrayLike(value, 1) ? (_accumulator = accumulator).push.apply(_accumulator, toArray(value)) : accumulator.push(value);
  }) || accumulator;
}, toArray = function toArray2(value, scope, leaveStrings) {
  return _context$2 && !scope && _context$2.selector ? _context$2.selector(value) : _isString$1(value) && !leaveStrings && (_coreInitted$2 || !_wake()) ? _slice.call((scope || _doc$3).querySelectorAll(value), 0) : _isArray(value) ? _flatten(value, leaveStrings) : _isArrayLike(value) ? _slice.call(value, 0) : value ? [value] : [];
}, selector = function selector2(value) {
  value = toArray(value)[0] || _warn("Invalid scope") || {};
  return function(v) {
    var el = value.current || value.nativeElement || value;
    return toArray(v, el.querySelectorAll ? el : el === value ? _warn("Invalid scope") || _doc$3.createElement("div") : value);
  };
}, shuffle = function shuffle2(a) {
  return a.sort(function() {
    return 0.5 - Math.random();
  });
}, distribute = function distribute2(v) {
  if (_isFunction$1(v)) {
    return v;
  }
  var vars = _isObject$1(v) ? v : {
    each: v
  }, ease = _parseEase(vars.ease), from = vars.from || 0, base = parseFloat(vars.base) || 0, cache = {}, isDecimal = from > 0 && from < 1, ratios = isNaN(from) || isDecimal, axis = vars.axis, ratioX = from, ratioY = from;
  if (_isString$1(from)) {
    ratioX = ratioY = {
      center: 0.5,
      edges: 0.5,
      end: 1
    }[from] || 0;
  } else if (!isDecimal && ratios) {
    ratioX = from[0];
    ratioY = from[1];
  }
  return function(i, target, a) {
    var l = (a || vars).length, distances = cache[l], originX, originY, x, y, d, j, max, min, wrapAt;
    if (!distances) {
      wrapAt = vars.grid === "auto" ? 0 : (vars.grid || [1, _bigNum$1])[1];
      if (!wrapAt) {
        max = -_bigNum$1;
        while (max < (max = a[wrapAt++].getBoundingClientRect().left) && wrapAt < l) {
        }
        wrapAt < l && wrapAt--;
      }
      distances = cache[l] = [];
      originX = ratios ? Math.min(wrapAt, l) * ratioX - 0.5 : from % wrapAt;
      originY = wrapAt === _bigNum$1 ? 0 : ratios ? l * ratioY / wrapAt - 0.5 : from / wrapAt | 0;
      max = 0;
      min = _bigNum$1;
      for (j = 0; j < l; j++) {
        x = j % wrapAt - originX;
        y = originY - (j / wrapAt | 0);
        distances[j] = d = !axis ? _sqrt(x * x + y * y) : Math.abs(axis === "y" ? y : x);
        d > max && (max = d);
        d < min && (min = d);
      }
      from === "random" && shuffle(distances);
      distances.max = max - min;
      distances.min = min;
      distances.v = l = (parseFloat(vars.amount) || parseFloat(vars.each) * (wrapAt > l ? l - 1 : !axis ? Math.max(wrapAt, l / wrapAt) : axis === "y" ? l / wrapAt : wrapAt) || 0) * (from === "edges" ? -1 : 1);
      distances.b = l < 0 ? base - l : base;
      distances.u = getUnit(vars.amount || vars.each) || 0;
      ease = ease && l < 0 ? _invertEase(ease) : ease;
    }
    l = (distances[i] - distances.min) / distances.max || 0;
    return _roundPrecise(distances.b + (ease ? ease(l) : l) * distances.v) + distances.u;
  };
}, _roundModifier = function _roundModifier2(v) {
  var p = Math.pow(10, ((v + "").split(".")[1] || "").length);
  return function(raw) {
    var n = _roundPrecise(Math.round(parseFloat(raw) / v) * v * p);
    return (n - n % 1) / p + (_isNumber$1(raw) ? 0 : getUnit(raw));
  };
}, snap = function snap2(snapTo, value) {
  var isArray = _isArray(snapTo), radius, is2D;
  if (!isArray && _isObject$1(snapTo)) {
    radius = isArray = snapTo.radius || _bigNum$1;
    if (snapTo.values) {
      snapTo = toArray(snapTo.values);
      if (is2D = !_isNumber$1(snapTo[0])) {
        radius *= radius;
      }
    } else {
      snapTo = _roundModifier(snapTo.increment);
    }
  }
  return _conditionalReturn(value, !isArray ? _roundModifier(snapTo) : _isFunction$1(snapTo) ? function(raw) {
    is2D = snapTo(raw);
    return Math.abs(is2D - raw) <= radius ? is2D : raw;
  } : function(raw) {
    var x = parseFloat(is2D ? raw.x : raw), y = parseFloat(is2D ? raw.y : 0), min = _bigNum$1, closest = 0, i = snapTo.length, dx, dy;
    while (i--) {
      if (is2D) {
        dx = snapTo[i].x - x;
        dy = snapTo[i].y - y;
        dx = dx * dx + dy * dy;
      } else {
        dx = Math.abs(snapTo[i] - x);
      }
      if (dx < min) {
        min = dx;
        closest = i;
      }
    }
    closest = !radius || min <= radius ? snapTo[closest] : raw;
    return is2D || closest === raw || _isNumber$1(raw) ? closest : closest + getUnit(raw);
  });
}, random = function random2(min, max, roundingIncrement, returnFunction) {
  return _conditionalReturn(_isArray(min) ? !max : roundingIncrement === true ? !!(roundingIncrement = 0) : !returnFunction, function() {
    return _isArray(min) ? min[~~(Math.random() * min.length)] : (roundingIncrement = roundingIncrement || 1e-5) && (returnFunction = roundingIncrement < 1 ? Math.pow(10, (roundingIncrement + "").length - 2) : 1) && Math.floor(Math.round((min - roundingIncrement / 2 + Math.random() * (max - min + roundingIncrement * 0.99)) / roundingIncrement) * roundingIncrement * returnFunction) / returnFunction;
  });
}, pipe = function pipe2() {
  for (var _len = arguments.length, functions = new Array(_len), _key = 0; _key < _len; _key++) {
    functions[_key] = arguments[_key];
  }
  return function(value) {
    return functions.reduce(function(v, f) {
      return f(v);
    }, value);
  };
}, unitize = function unitize2(func, unit) {
  return function(value) {
    return func(parseFloat(value)) + (unit || getUnit(value));
  };
}, normalize$2 = function normalize2(min, max, value) {
  return mapRange(min, max, 0, 1, value);
}, _wrapArray = function _wrapArray2(a, wrapper, value) {
  return _conditionalReturn(value, function(index) {
    return a[~~wrapper(index)];
  });
}, wrap = function wrap2(min, max, value) {
  var range = max - min;
  return _isArray(min) ? _wrapArray(min, wrap2(0, min.length), max) : _conditionalReturn(value, function(value2) {
    return (range + (value2 - min) % range) % range + min;
  });
}, wrapYoyo = function wrapYoyo2(min, max, value) {
  var range = max - min, total = range * 2;
  return _isArray(min) ? _wrapArray(min, wrapYoyo2(0, min.length - 1), max) : _conditionalReturn(value, function(value2) {
    value2 = (total + (value2 - min) % total) % total || 0;
    return min + (value2 > range ? total - value2 : value2);
  });
}, _replaceRandom = function _replaceRandom2(value) {
  var prev = 0, s = "", i, nums, end, isArray;
  while (~(i = value.indexOf("random(", prev))) {
    end = value.indexOf(")", i);
    isArray = value.charAt(i + 7) === "[";
    nums = value.substr(i + 7, end - i - 7).match(isArray ? _delimitedValueExp : _strictNumExp);
    s += value.substr(prev, i - prev) + random(isArray ? nums : +nums[0], isArray ? 0 : +nums[1], +nums[2] || 1e-5);
    prev = end + 1;
  }
  return s + value.substr(prev, value.length - prev);
}, mapRange = function mapRange2(inMin, inMax, outMin, outMax, value) {
  var inRange = inMax - inMin, outRange = outMax - outMin;
  return _conditionalReturn(value, function(value2) {
    return outMin + ((value2 - inMin) / inRange * outRange || 0);
  });
}, interpolate = function interpolate2(start, end, progress, mutate) {
  var func = isNaN(start + end) ? 0 : function(p2) {
    return (1 - p2) * start + p2 * end;
  };
  if (!func) {
    var isString = _isString$1(start), master = {}, p, i, interpolators, l, il;
    progress === true && (mutate = 1) && (progress = null);
    if (isString) {
      start = {
        p: start
      };
      end = {
        p: end
      };
    } else if (_isArray(start) && !_isArray(end)) {
      interpolators = [];
      l = start.length;
      il = l - 2;
      for (i = 1; i < l; i++) {
        interpolators.push(interpolate2(start[i - 1], start[i]));
      }
      l--;
      func = function func2(p2) {
        p2 *= l;
        var i2 = Math.min(il, ~~p2);
        return interpolators[i2](p2 - i2);
      };
      progress = end;
    } else if (!mutate) {
      start = _merge(_isArray(start) ? [] : {}, start);
    }
    if (!interpolators) {
      for (p in end) {
        _addPropTween.call(master, start, p, "get", end[p]);
      }
      func = function func2(p2) {
        return _renderPropTweens(p2, master) || (isString ? start.p : start);
      };
    }
  }
  return _conditionalReturn(progress, func);
}, _getLabelInDirection = function _getLabelInDirection2(timeline2, fromTime, backward) {
  var labels = timeline2.labels, min = _bigNum$1, p, distance, label;
  for (p in labels) {
    distance = labels[p] - fromTime;
    if (distance < 0 === !!backward && distance && min > (distance = Math.abs(distance))) {
      label = p;
      min = distance;
    }
  }
  return label;
}, _callback$1 = function _callback2(animation, type, executeLazyFirst) {
  var v = animation.vars, callback = v[type], prevContext = _context$2, context3 = animation._ctx, params, scope, result;
  if (!callback) {
    return;
  }
  params = v[type + "Params"];
  scope = v.callbackScope || animation;
  executeLazyFirst && _lazyTweens.length && _lazyRender();
  context3 && (_context$2 = context3);
  result = params ? callback.apply(scope, params) : callback.call(scope);
  _context$2 = prevContext;
  return result;
}, _interrupt = function _interrupt2(animation) {
  _removeFromParent(animation);
  animation.scrollTrigger && animation.scrollTrigger.kill(!!_reverting$1);
  animation.progress() < 1 && _callback$1(animation, "onInterrupt");
  return animation;
}, _quickTween, _registerPluginQueue = [], _createPlugin = function _createPlugin2(config3) {
  if (!config3) return;
  config3 = !config3.name && config3["default"] || config3;
  if (_windowExists$2() || config3.headless) {
    var name = config3.name, isFunc = _isFunction$1(config3), Plugin = name && !isFunc && config3.init ? function() {
      this._props = [];
    } : config3, instanceDefaults = {
      init: _emptyFunc,
      render: _renderPropTweens,
      add: _addPropTween,
      kill: _killPropTweensOf,
      modifier: _addPluginModifier,
      rawVars: 0
    }, statics = {
      targetTest: 0,
      get: 0,
      getSetter: _getSetter,
      aliases: {},
      register: 0
    };
    _wake();
    if (config3 !== Plugin) {
      if (_plugins[name]) {
        return;
      }
      _setDefaults$1(Plugin, _setDefaults$1(_copyExcluding(config3, instanceDefaults), statics));
      _merge(Plugin.prototype, _merge(instanceDefaults, _copyExcluding(config3, statics)));
      _plugins[Plugin.prop = name] = Plugin;
      if (config3.targetTest) {
        _harnessPlugins.push(Plugin);
        _reservedProps[name] = 1;
      }
      name = (name === "css" ? "CSS" : name.charAt(0).toUpperCase() + name.substr(1)) + "Plugin";
    }
    _addGlobal(name, Plugin);
    config3.register && config3.register(gsap$2, Plugin, PropTween);
  } else {
    _registerPluginQueue.push(config3);
  }
}, _255 = 255, _colorLookup = {
  aqua: [0, _255, _255],
  lime: [0, _255, 0],
  silver: [192, 192, 192],
  black: [0, 0, 0],
  maroon: [128, 0, 0],
  teal: [0, 128, 128],
  blue: [0, 0, _255],
  navy: [0, 0, 128],
  white: [_255, _255, _255],
  olive: [128, 128, 0],
  yellow: [_255, _255, 0],
  orange: [_255, 165, 0],
  gray: [128, 128, 128],
  purple: [128, 0, 128],
  green: [0, 128, 0],
  red: [_255, 0, 0],
  pink: [_255, 192, 203],
  cyan: [0, _255, _255],
  transparent: [_255, _255, _255, 0]
}, _hue = function _hue2(h, m1, m2) {
  h += h < 0 ? 1 : h > 1 ? -1 : 0;
  return (h * 6 < 1 ? m1 + (m2 - m1) * h * 6 : h < 0.5 ? m2 : h * 3 < 2 ? m1 + (m2 - m1) * (2 / 3 - h) * 6 : m1) * _255 + 0.5 | 0;
}, splitColor = function splitColor2(v, toHSL, forceAlpha) {
  var a = !v ? _colorLookup.black : _isNumber$1(v) ? [v >> 16, v >> 8 & _255, v & _255] : 0, r, g, b, h, s, l, max, min, d, wasHSL;
  if (!a) {
    if (v.substr(-1) === ",") {
      v = v.substr(0, v.length - 1);
    }
    if (_colorLookup[v]) {
      a = _colorLookup[v];
    } else if (v.charAt(0) === "#") {
      if (v.length < 6) {
        r = v.charAt(1);
        g = v.charAt(2);
        b = v.charAt(3);
        v = "#" + r + r + g + g + b + b + (v.length === 5 ? v.charAt(4) + v.charAt(4) : "");
      }
      if (v.length === 9) {
        a = parseInt(v.substr(1, 6), 16);
        return [a >> 16, a >> 8 & _255, a & _255, parseInt(v.substr(7), 16) / 255];
      }
      v = parseInt(v.substr(1), 16);
      a = [v >> 16, v >> 8 & _255, v & _255];
    } else if (v.substr(0, 3) === "hsl") {
      a = wasHSL = v.match(_strictNumExp);
      if (!toHSL) {
        h = +a[0] % 360 / 360;
        s = +a[1] / 100;
        l = +a[2] / 100;
        g = l <= 0.5 ? l * (s + 1) : l + s - l * s;
        r = l * 2 - g;
        a.length > 3 && (a[3] *= 1);
        a[0] = _hue(h + 1 / 3, r, g);
        a[1] = _hue(h, r, g);
        a[2] = _hue(h - 1 / 3, r, g);
      } else if (~v.indexOf("=")) {
        a = v.match(_numExp);
        forceAlpha && a.length < 4 && (a[3] = 1);
        return a;
      }
    } else {
      a = v.match(_strictNumExp) || _colorLookup.transparent;
    }
    a = a.map(Number);
  }
  if (toHSL && !wasHSL) {
    r = a[0] / _255;
    g = a[1] / _255;
    b = a[2] / _255;
    max = Math.max(r, g, b);
    min = Math.min(r, g, b);
    l = (max + min) / 2;
    if (max === min) {
      h = s = 0;
    } else {
      d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      h = max === r ? (g - b) / d + (g < b ? 6 : 0) : max === g ? (b - r) / d + 2 : (r - g) / d + 4;
      h *= 60;
    }
    a[0] = ~~(h + 0.5);
    a[1] = ~~(s * 100 + 0.5);
    a[2] = ~~(l * 100 + 0.5);
  }
  forceAlpha && a.length < 4 && (a[3] = 1);
  return a;
}, _colorOrderData = function _colorOrderData2(v) {
  var values = [], c = [], i = -1;
  v.split(_colorExp).forEach(function(v2) {
    var a = v2.match(_numWithUnitExp) || [];
    values.push.apply(values, a);
    c.push(i += a.length + 1);
  });
  values.c = c;
  return values;
}, _formatColors = function _formatColors2(s, toHSL, orderMatchData) {
  var result = "", colors = (s + result).match(_colorExp), type = toHSL ? "hsla(" : "rgba(", i = 0, c, shell, d, l;
  if (!colors) {
    return s;
  }
  colors = colors.map(function(color) {
    return (color = splitColor(color, toHSL, 1)) && type + (toHSL ? color[0] + "," + color[1] + "%," + color[2] + "%," + color[3] : color.join(",")) + ")";
  });
  if (orderMatchData) {
    d = _colorOrderData(s);
    c = orderMatchData.c;
    if (c.join(result) !== d.c.join(result)) {
      shell = s.replace(_colorExp, "1").split(_numWithUnitExp);
      l = shell.length - 1;
      for (; i < l; i++) {
        result += shell[i] + (~c.indexOf(i) ? colors.shift() || type + "0,0,0,0)" : (d.length ? d : colors.length ? colors : orderMatchData).shift());
      }
    }
  }
  if (!shell) {
    shell = s.split(_colorExp);
    l = shell.length - 1;
    for (; i < l; i++) {
      result += shell[i] + colors[i];
    }
  }
  return result + shell[l];
}, _colorExp = function() {
  var s = "(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b", p;
  for (p in _colorLookup) {
    s += "|" + p + "\\b";
  }
  return new RegExp(s + ")", "gi");
}(), _hslExp = /hsl[a]?\(/, _colorStringFilter = function _colorStringFilter2(a) {
  var combined = a.join(" "), toHSL;
  _colorExp.lastIndex = 0;
  if (_colorExp.test(combined)) {
    toHSL = _hslExp.test(combined);
    a[1] = _formatColors(a[1], toHSL);
    a[0] = _formatColors(a[0], toHSL, _colorOrderData(a[1]));
    return true;
  }
}, _tickerActive, _ticker = function() {
  var _getTime = Date.now, _lagThreshold = 500, _adjustedLag = 33, _startTime = _getTime(), _lastUpdate = _startTime, _gap = 1e3 / 240, _nextTime = _gap, _listeners2 = [], _id, _req, _raf, _self, _delta, _i, _tick = function _tick2(v) {
    var elapsed = _getTime() - _lastUpdate, manual = v === true, overlap, dispatch, time, frame;
    (elapsed > _lagThreshold || elapsed < 0) && (_startTime += elapsed - _adjustedLag);
    _lastUpdate += elapsed;
    time = _lastUpdate - _startTime;
    overlap = time - _nextTime;
    if (overlap > 0 || manual) {
      frame = ++_self.frame;
      _delta = time - _self.time * 1e3;
      _self.time = time = time / 1e3;
      _nextTime += overlap + (overlap >= _gap ? 4 : _gap - overlap);
      dispatch = 1;
    }
    manual || (_id = _req(_tick2));
    if (dispatch) {
      for (_i = 0; _i < _listeners2.length; _i++) {
        _listeners2[_i](time, _delta, frame, v);
      }
    }
  };
  _self = {
    time: 0,
    frame: 0,
    tick: function tick() {
      _tick(true);
    },
    deltaRatio: function deltaRatio(fps) {
      return _delta / (1e3 / (fps || 60));
    },
    wake: function wake() {
      if (_coreReady) {
        if (!_coreInitted$2 && _windowExists$2()) {
          _win$3 = _coreInitted$2 = window;
          _doc$3 = _win$3.document || {};
          _globals.gsap = gsap$2;
          (_win$3.gsapVersions || (_win$3.gsapVersions = [])).push(gsap$2.version);
          _install(_installScope || _win$3.GreenSockGlobals || !_win$3.gsap && _win$3 || {});
          _registerPluginQueue.forEach(_createPlugin);
        }
        _raf = typeof requestAnimationFrame !== "undefined" && requestAnimationFrame;
        _id && _self.sleep();
        _req = _raf || function(f) {
          return setTimeout(f, _nextTime - _self.time * 1e3 + 1 | 0);
        };
        _tickerActive = 1;
        _tick(2);
      }
    },
    sleep: function sleep() {
      (_raf ? cancelAnimationFrame : clearTimeout)(_id);
      _tickerActive = 0;
      _req = _emptyFunc;
    },
    lagSmoothing: function lagSmoothing(threshold, adjustedLag) {
      _lagThreshold = threshold || Infinity;
      _adjustedLag = Math.min(adjustedLag || 33, _lagThreshold);
    },
    fps: function fps(_fps) {
      _gap = 1e3 / (_fps || 240);
      _nextTime = _self.time * 1e3 + _gap;
    },
    add: function add(callback, once, prioritize) {
      var func = once ? function(t, d, f, v) {
        callback(t, d, f, v);
        _self.remove(func);
      } : callback;
      _self.remove(callback);
      _listeners2[prioritize ? "unshift" : "push"](func);
      _wake();
      return func;
    },
    remove: function remove(callback, i) {
      ~(i = _listeners2.indexOf(callback)) && _listeners2.splice(i, 1) && _i >= i && _i--;
    },
    _listeners: _listeners2
  };
  return _self;
}(), _wake = function _wake2() {
  return !_tickerActive && _ticker.wake();
}, _easeMap = {}, _customEaseExp = /^[\d.\-M][\d.\-,\s]/, _quotesExp = /["']/g, _parseObjectInString = function _parseObjectInString2(value) {
  var obj = {}, split = value.substr(1, value.length - 3).split(":"), key = split[0], i = 1, l = split.length, index, val, parsedVal;
  for (; i < l; i++) {
    val = split[i];
    index = i !== l - 1 ? val.lastIndexOf(",") : val.length;
    parsedVal = val.substr(0, index);
    obj[key] = isNaN(parsedVal) ? parsedVal.replace(_quotesExp, "").trim() : +parsedVal;
    key = val.substr(index + 1).trim();
  }
  return obj;
}, _valueInParentheses = function _valueInParentheses2(value) {
  var open = value.indexOf("(") + 1, close = value.indexOf(")"), nested = value.indexOf("(", open);
  return value.substring(open, ~nested && nested < close ? value.indexOf(")", close + 1) : close);
}, _configEaseFromString = function _configEaseFromString2(name) {
  var split = (name + "").split("("), ease = _easeMap[split[0]];
  return ease && split.length > 1 && ease.config ? ease.config.apply(null, ~name.indexOf("{") ? [_parseObjectInString(split[1])] : _valueInParentheses(name).split(",").map(_numericIfPossible)) : _easeMap._CE && _customEaseExp.test(name) ? _easeMap._CE("", name) : ease;
}, _invertEase = function _invertEase2(ease) {
  return function(p) {
    return 1 - ease(1 - p);
  };
}, _propagateYoyoEase = function _propagateYoyoEase2(timeline2, isYoyo) {
  var child = timeline2._first, ease;
  while (child) {
    if (child instanceof Timeline) {
      _propagateYoyoEase2(child, isYoyo);
    } else if (child.vars.yoyoEase && (!child._yoyo || !child._repeat) && child._yoyo !== isYoyo) {
      if (child.timeline) {
        _propagateYoyoEase2(child.timeline, isYoyo);
      } else {
        ease = child._ease;
        child._ease = child._yEase;
        child._yEase = ease;
        child._yoyo = isYoyo;
      }
    }
    child = child._next;
  }
}, _parseEase = function _parseEase2(ease, defaultEase) {
  return !ease ? defaultEase : (_isFunction$1(ease) ? ease : _easeMap[ease] || _configEaseFromString(ease)) || defaultEase;
}, _insertEase = function _insertEase2(names, easeIn, easeOut, easeInOut) {
  if (easeOut === void 0) {
    easeOut = function easeOut2(p) {
      return 1 - easeIn(1 - p);
    };
  }
  if (easeInOut === void 0) {
    easeInOut = function easeInOut2(p) {
      return p < 0.5 ? easeIn(p * 2) / 2 : 1 - easeIn((1 - p) * 2) / 2;
    };
  }
  var ease = {
    easeIn,
    easeOut,
    easeInOut
  }, lowercaseName;
  _forEachName(names, function(name) {
    _easeMap[name] = _globals[name] = ease;
    _easeMap[lowercaseName = name.toLowerCase()] = easeOut;
    for (var p in ease) {
      _easeMap[lowercaseName + (p === "easeIn" ? ".in" : p === "easeOut" ? ".out" : ".inOut")] = _easeMap[name + "." + p] = ease[p];
    }
  });
  return ease;
}, _easeInOutFromOut = function _easeInOutFromOut2(easeOut) {
  return function(p) {
    return p < 0.5 ? (1 - easeOut(1 - p * 2)) / 2 : 0.5 + easeOut((p - 0.5) * 2) / 2;
  };
}, _configElastic = function _configElastic2(type, amplitude, period) {
  var p1 = amplitude >= 1 ? amplitude : 1, p2 = (period || (type ? 0.3 : 0.45)) / (amplitude < 1 ? amplitude : 1), p3 = p2 / _2PI * (Math.asin(1 / p1) || 0), easeOut = function easeOut2(p) {
    return p === 1 ? 1 : p1 * Math.pow(2, -10 * p) * _sin((p - p3) * p2) + 1;
  }, ease = type === "out" ? easeOut : type === "in" ? function(p) {
    return 1 - easeOut(1 - p);
  } : _easeInOutFromOut(easeOut);
  p2 = _2PI / p2;
  ease.config = function(amplitude2, period2) {
    return _configElastic2(type, amplitude2, period2);
  };
  return ease;
}, _configBack = function _configBack2(type, overshoot) {
  if (overshoot === void 0) {
    overshoot = 1.70158;
  }
  var easeOut = function easeOut2(p) {
    return p ? --p * p * ((overshoot + 1) * p + overshoot) + 1 : 0;
  }, ease = type === "out" ? easeOut : type === "in" ? function(p) {
    return 1 - easeOut(1 - p);
  } : _easeInOutFromOut(easeOut);
  ease.config = function(overshoot2) {
    return _configBack2(type, overshoot2);
  };
  return ease;
};
_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong", function(name, i) {
  var power = i < 5 ? i + 1 : i;
  _insertEase(name + ",Power" + (power - 1), i ? function(p) {
    return Math.pow(p, power);
  } : function(p) {
    return p;
  }, function(p) {
    return 1 - Math.pow(1 - p, power);
  }, function(p) {
    return p < 0.5 ? Math.pow(p * 2, power) / 2 : 1 - Math.pow((1 - p) * 2, power) / 2;
  });
});
_easeMap.Linear.easeNone = _easeMap.none = _easeMap.Linear.easeIn;
_insertEase("Elastic", _configElastic("in"), _configElastic("out"), _configElastic());
(function(n, c) {
  var n1 = 1 / c, n2 = 2 * n1, n3 = 2.5 * n1, easeOut = function easeOut2(p) {
    return p < n1 ? n * p * p : p < n2 ? n * Math.pow(p - 1.5 / c, 2) + 0.75 : p < n3 ? n * (p -= 2.25 / c) * p + 0.9375 : n * Math.pow(p - 2.625 / c, 2) + 0.984375;
  };
  _insertEase("Bounce", function(p) {
    return 1 - easeOut(1 - p);
  }, easeOut);
})(7.5625, 2.75);
_insertEase("Expo", function(p) {
  return Math.pow(2, 10 * (p - 1)) * p + p * p * p * p * p * p * (1 - p);
});
_insertEase("Circ", function(p) {
  return -(_sqrt(1 - p * p) - 1);
});
_insertEase("Sine", function(p) {
  return p === 1 ? 1 : -_cos(p * _HALF_PI) + 1;
});
_insertEase("Back", _configBack("in"), _configBack("out"), _configBack());
_easeMap.SteppedEase = _easeMap.steps = _globals.SteppedEase = {
  config: function config(steps, immediateStart) {
    if (steps === void 0) {
      steps = 1;
    }
    var p1 = 1 / steps, p2 = steps + (immediateStart ? 0 : 1), p3 = immediateStart ? 1 : 0, max = 1 - _tinyNum;
    return function(p) {
      return ((p2 * _clamp$1(0, max, p) | 0) + p3) * p1;
    };
  }
};
_defaults$1.ease = _easeMap["quad.out"];
_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt", function(name) {
  return _callbackNames += name + "," + name + "Params,";
});
var GSCache = function GSCache2(target, harness) {
  this.id = _gsID++;
  target._gsap = this;
  this.target = target;
  this.harness = harness;
  this.get = harness ? harness.get : _getProperty;
  this.set = harness ? harness.getSetter : _getSetter;
};
var Animation = /* @__PURE__ */ function() {
  function Animation2(vars) {
    this.vars = vars;
    this._delay = +vars.delay || 0;
    if (this._repeat = vars.repeat === Infinity ? -2 : vars.repeat || 0) {
      this._rDelay = vars.repeatDelay || 0;
      this._yoyo = !!vars.yoyo || !!vars.yoyoEase;
    }
    this._ts = 1;
    _setDuration(this, +vars.duration, 1, 1);
    this.data = vars.data;
    if (_context$2) {
      this._ctx = _context$2;
      _context$2.data.push(this);
    }
    _tickerActive || _ticker.wake();
  }
  var _proto = Animation2.prototype;
  _proto.delay = function delay(value) {
    if (value || value === 0) {
      this.parent && this.parent.smoothChildTiming && this.startTime(this._start + value - this._delay);
      this._delay = value;
      return this;
    }
    return this._delay;
  };
  _proto.duration = function duration(value) {
    return arguments.length ? this.totalDuration(this._repeat > 0 ? value + (value + this._rDelay) * this._repeat : value) : this.totalDuration() && this._dur;
  };
  _proto.totalDuration = function totalDuration(value) {
    if (!arguments.length) {
      return this._tDur;
    }
    this._dirty = 0;
    return _setDuration(this, this._repeat < 0 ? value : (value - this._repeat * this._rDelay) / (this._repeat + 1));
  };
  _proto.totalTime = function totalTime(_totalTime, suppressEvents) {
    _wake();
    if (!arguments.length) {
      return this._tTime;
    }
    var parent = this._dp;
    if (parent && parent.smoothChildTiming && this._ts) {
      _alignPlayhead(this, _totalTime);
      !parent._dp || parent.parent || _postAddChecks(parent, this);
      while (parent && parent.parent) {
        if (parent.parent._time !== parent._start + (parent._ts >= 0 ? parent._tTime / parent._ts : (parent.totalDuration() - parent._tTime) / -parent._ts)) {
          parent.totalTime(parent._tTime, true);
        }
        parent = parent.parent;
      }
      if (!this.parent && this._dp.autoRemoveChildren && (this._ts > 0 && _totalTime < this._tDur || this._ts < 0 && _totalTime > 0 || !this._tDur && !_totalTime)) {
        _addToTimeline(this._dp, this, this._start - this._delay);
      }
    }
    if (this._tTime !== _totalTime || !this._dur && !suppressEvents || this._initted && Math.abs(this._zTime) === _tinyNum || !_totalTime && !this._initted && (this.add || this._ptLookup)) {
      this._ts || (this._pTime = _totalTime);
      _lazySafeRender(this, _totalTime, suppressEvents);
    }
    return this;
  };
  _proto.time = function time(value, suppressEvents) {
    return arguments.length ? this.totalTime(Math.min(this.totalDuration(), value + _elapsedCycleDuration(this)) % (this._dur + this._rDelay) || (value ? this._dur : 0), suppressEvents) : this._time;
  };
  _proto.totalProgress = function totalProgress(value, suppressEvents) {
    return arguments.length ? this.totalTime(this.totalDuration() * value, suppressEvents) : this.totalDuration() ? Math.min(1, this._tTime / this._tDur) : this.rawTime() >= 0 && this._initted ? 1 : 0;
  };
  _proto.progress = function progress(value, suppressEvents) {
    return arguments.length ? this.totalTime(this.duration() * (this._yoyo && !(this.iteration() & 1) ? 1 - value : value) + _elapsedCycleDuration(this), suppressEvents) : this.duration() ? Math.min(1, this._time / this._dur) : this.rawTime() > 0 ? 1 : 0;
  };
  _proto.iteration = function iteration(value, suppressEvents) {
    var cycleDuration = this.duration() + this._rDelay;
    return arguments.length ? this.totalTime(this._time + (value - 1) * cycleDuration, suppressEvents) : this._repeat ? _animationCycle(this._tTime, cycleDuration) + 1 : 1;
  };
  _proto.timeScale = function timeScale(value, suppressEvents) {
    if (!arguments.length) {
      return this._rts === -_tinyNum ? 0 : this._rts;
    }
    if (this._rts === value) {
      return this;
    }
    var tTime = this.parent && this._ts ? _parentToChildTotalTime(this.parent._time, this) : this._tTime;
    this._rts = +value || 0;
    this._ts = this._ps || value === -_tinyNum ? 0 : this._rts;
    this.totalTime(_clamp$1(-Math.abs(this._delay), this.totalDuration(), tTime), suppressEvents !== false);
    _setEnd(this);
    return _recacheAncestors(this);
  };
  _proto.paused = function paused(value) {
    if (!arguments.length) {
      return this._ps;
    }
    if (this._ps !== value) {
      this._ps = value;
      if (value) {
        this._pTime = this._tTime || Math.max(-this._delay, this.rawTime());
        this._ts = this._act = 0;
      } else {
        _wake();
        this._ts = this._rts;
        this.totalTime(this.parent && !this.parent.smoothChildTiming ? this.rawTime() : this._tTime || this._pTime, this.progress() === 1 && Math.abs(this._zTime) !== _tinyNum && (this._tTime -= _tinyNum));
      }
    }
    return this;
  };
  _proto.startTime = function startTime(value) {
    if (arguments.length) {
      this._start = value;
      var parent = this.parent || this._dp;
      parent && (parent._sort || !this.parent) && _addToTimeline(parent, this, value - this._delay);
      return this;
    }
    return this._start;
  };
  _proto.endTime = function endTime(includeRepeats) {
    return this._start + (_isNotFalse(includeRepeats) ? this.totalDuration() : this.duration()) / Math.abs(this._ts || 1);
  };
  _proto.rawTime = function rawTime(wrapRepeats) {
    var parent = this.parent || this._dp;
    return !parent ? this._tTime : wrapRepeats && (!this._ts || this._repeat && this._time && this.totalProgress() < 1) ? this._tTime % (this._dur + this._rDelay) : !this._ts ? this._tTime : _parentToChildTotalTime(parent.rawTime(wrapRepeats), this);
  };
  _proto.revert = function revert(config3) {
    if (config3 === void 0) {
      config3 = _revertConfig;
    }
    var prevIsReverting = _reverting$1;
    _reverting$1 = config3;
    if (_isRevertWorthy(this)) {
      this.timeline && this.timeline.revert(config3);
      this.totalTime(-0.01, config3.suppressEvents);
    }
    this.data !== "nested" && config3.kill !== false && this.kill();
    _reverting$1 = prevIsReverting;
    return this;
  };
  _proto.globalTime = function globalTime(rawTime) {
    var animation = this, time = arguments.length ? rawTime : animation.rawTime();
    while (animation) {
      time = animation._start + time / (Math.abs(animation._ts) || 1);
      animation = animation._dp;
    }
    return !this.parent && this._sat ? this._sat.globalTime(rawTime) : time;
  };
  _proto.repeat = function repeat(value) {
    if (arguments.length) {
      this._repeat = value === Infinity ? -2 : value;
      return _onUpdateTotalDuration(this);
    }
    return this._repeat === -2 ? Infinity : this._repeat;
  };
  _proto.repeatDelay = function repeatDelay(value) {
    if (arguments.length) {
      var time = this._time;
      this._rDelay = value;
      _onUpdateTotalDuration(this);
      return time ? this.time(time) : this;
    }
    return this._rDelay;
  };
  _proto.yoyo = function yoyo(value) {
    if (arguments.length) {
      this._yoyo = value;
      return this;
    }
    return this._yoyo;
  };
  _proto.seek = function seek(position, suppressEvents) {
    return this.totalTime(_parsePosition$1(this, position), _isNotFalse(suppressEvents));
  };
  _proto.restart = function restart(includeDelay, suppressEvents) {
    this.play().totalTime(includeDelay ? -this._delay : 0, _isNotFalse(suppressEvents));
    this._dur || (this._zTime = -_tinyNum);
    return this;
  };
  _proto.play = function play(from, suppressEvents) {
    from != null && this.seek(from, suppressEvents);
    return this.reversed(false).paused(false);
  };
  _proto.reverse = function reverse(from, suppressEvents) {
    from != null && this.seek(from || this.totalDuration(), suppressEvents);
    return this.reversed(true).paused(false);
  };
  _proto.pause = function pause(atTime, suppressEvents) {
    atTime != null && this.seek(atTime, suppressEvents);
    return this.paused(true);
  };
  _proto.resume = function resume() {
    return this.paused(false);
  };
  _proto.reversed = function reversed(value) {
    if (arguments.length) {
      !!value !== this.reversed() && this.timeScale(-this._rts || (value ? -_tinyNum : 0));
      return this;
    }
    return this._rts < 0;
  };
  _proto.invalidate = function invalidate() {
    this._initted = this._act = 0;
    this._zTime = -_tinyNum;
    return this;
  };
  _proto.isActive = function isActive() {
    var parent = this.parent || this._dp, start = this._start, rawTime;
    return !!(!parent || this._ts && this._initted && parent.isActive() && (rawTime = parent.rawTime(true)) >= start && rawTime < this.endTime(true) - _tinyNum);
  };
  _proto.eventCallback = function eventCallback(type, callback, params) {
    var vars = this.vars;
    if (arguments.length > 1) {
      if (!callback) {
        delete vars[type];
      } else {
        vars[type] = callback;
        params && (vars[type + "Params"] = params);
        type === "onUpdate" && (this._onUpdate = callback);
      }
      return this;
    }
    return vars[type];
  };
  _proto.then = function then(onFulfilled) {
    var self = this;
    return new Promise(function(resolve) {
      var f = _isFunction$1(onFulfilled) ? onFulfilled : _passThrough$1, _resolve = function _resolve2() {
        var _then = self.then;
        self.then = null;
        _isFunction$1(f) && (f = f(self)) && (f.then || f === self) && (self.then = _then);
        resolve(f);
        self.then = _then;
      };
      if (self._initted && self.totalProgress() === 1 && self._ts >= 0 || !self._tTime && self._ts < 0) {
        _resolve();
      } else {
        self._prom = _resolve;
      }
    });
  };
  _proto.kill = function kill() {
    _interrupt(this);
  };
  return Animation2;
}();
_setDefaults$1(Animation.prototype, {
  _time: 0,
  _start: 0,
  _end: 0,
  _tTime: 0,
  _tDur: 0,
  _dirty: 0,
  _repeat: 0,
  _yoyo: false,
  parent: null,
  _initted: false,
  _rDelay: 0,
  _ts: 1,
  _dp: 0,
  ratio: 0,
  _zTime: -_tinyNum,
  _prom: 0,
  _ps: false,
  _rts: 1
});
var Timeline = /* @__PURE__ */ function(_Animation) {
  _inheritsLoose(Timeline2, _Animation);
  function Timeline2(vars, position) {
    var _this;
    if (vars === void 0) {
      vars = {};
    }
    _this = _Animation.call(this, vars) || this;
    _this.labels = {};
    _this.smoothChildTiming = !!vars.smoothChildTiming;
    _this.autoRemoveChildren = !!vars.autoRemoveChildren;
    _this._sort = _isNotFalse(vars.sortChildren);
    _globalTimeline && _addToTimeline(vars.parent || _globalTimeline, _assertThisInitialized(_this), position);
    vars.reversed && _this.reverse();
    vars.paused && _this.paused(true);
    vars.scrollTrigger && _scrollTrigger(_assertThisInitialized(_this), vars.scrollTrigger);
    return _this;
  }
  var _proto2 = Timeline2.prototype;
  _proto2.to = function to(targets, vars, position) {
    _createTweenType(0, arguments, this);
    return this;
  };
  _proto2.from = function from(targets, vars, position) {
    _createTweenType(1, arguments, this);
    return this;
  };
  _proto2.fromTo = function fromTo(targets, fromVars, toVars, position) {
    _createTweenType(2, arguments, this);
    return this;
  };
  _proto2.set = function set(targets, vars, position) {
    vars.duration = 0;
    vars.parent = this;
    _inheritDefaults(vars).repeatDelay || (vars.repeat = 0);
    vars.immediateRender = !!vars.immediateRender;
    new Tween(targets, vars, _parsePosition$1(this, position), 1);
    return this;
  };
  _proto2.call = function call(callback, params, position) {
    return _addToTimeline(this, Tween.delayedCall(0, callback, params), position);
  };
  _proto2.staggerTo = function staggerTo(targets, duration, vars, stagger, position, onCompleteAll, onCompleteAllParams) {
    vars.duration = duration;
    vars.stagger = vars.stagger || stagger;
    vars.onComplete = onCompleteAll;
    vars.onCompleteParams = onCompleteAllParams;
    vars.parent = this;
    new Tween(targets, vars, _parsePosition$1(this, position));
    return this;
  };
  _proto2.staggerFrom = function staggerFrom(targets, duration, vars, stagger, position, onCompleteAll, onCompleteAllParams) {
    vars.runBackwards = 1;
    _inheritDefaults(vars).immediateRender = _isNotFalse(vars.immediateRender);
    return this.staggerTo(targets, duration, vars, stagger, position, onCompleteAll, onCompleteAllParams);
  };
  _proto2.staggerFromTo = function staggerFromTo(targets, duration, fromVars, toVars, stagger, position, onCompleteAll, onCompleteAllParams) {
    toVars.startAt = fromVars;
    _inheritDefaults(toVars).immediateRender = _isNotFalse(toVars.immediateRender);
    return this.staggerTo(targets, duration, toVars, stagger, position, onCompleteAll, onCompleteAllParams);
  };
  _proto2.render = function render2(totalTime, suppressEvents, force) {
    var prevTime = this._time, tDur = this._dirty ? this.totalDuration() : this._tDur, dur = this._dur, tTime = totalTime <= 0 ? 0 : _roundPrecise(totalTime), crossingStart = this._zTime < 0 !== totalTime < 0 && (this._initted || !dur), time, child, next, iteration, cycleDuration, prevPaused, pauseTween, timeScale, prevStart, prevIteration, yoyo, isYoyo;
    this !== _globalTimeline && tTime > tDur && totalTime >= 0 && (tTime = tDur);
    if (tTime !== this._tTime || force || crossingStart) {
      if (prevTime !== this._time && dur) {
        tTime += this._time - prevTime;
        totalTime += this._time - prevTime;
      }
      time = tTime;
      prevStart = this._start;
      timeScale = this._ts;
      prevPaused = !timeScale;
      if (crossingStart) {
        dur || (prevTime = this._zTime);
        (totalTime || !suppressEvents) && (this._zTime = totalTime);
      }
      if (this._repeat) {
        yoyo = this._yoyo;
        cycleDuration = dur + this._rDelay;
        if (this._repeat < -1 && totalTime < 0) {
          return this.totalTime(cycleDuration * 100 + totalTime, suppressEvents, force);
        }
        time = _roundPrecise(tTime % cycleDuration);
        if (tTime === tDur) {
          iteration = this._repeat;
          time = dur;
        } else {
          prevIteration = _roundPrecise(tTime / cycleDuration);
          iteration = ~~prevIteration;
          if (iteration && iteration === prevIteration) {
            time = dur;
            iteration--;
          }
          time > dur && (time = dur);
        }
        prevIteration = _animationCycle(this._tTime, cycleDuration);
        !prevTime && this._tTime && prevIteration !== iteration && this._tTime - prevIteration * cycleDuration - this._dur <= 0 && (prevIteration = iteration);
        if (yoyo && iteration & 1) {
          time = dur - time;
          isYoyo = 1;
        }
        if (iteration !== prevIteration && !this._lock) {
          var rewinding = yoyo && prevIteration & 1, doesWrap = rewinding === (yoyo && iteration & 1);
          iteration < prevIteration && (rewinding = !rewinding);
          prevTime = rewinding ? 0 : tTime % dur ? dur : tTime;
          this._lock = 1;
          this.render(prevTime || (isYoyo ? 0 : _roundPrecise(iteration * cycleDuration)), suppressEvents, !dur)._lock = 0;
          this._tTime = tTime;
          !suppressEvents && this.parent && _callback$1(this, "onRepeat");
          this.vars.repeatRefresh && !isYoyo && (this.invalidate()._lock = 1);
          if (prevTime && prevTime !== this._time || prevPaused !== !this._ts || this.vars.onRepeat && !this.parent && !this._act) {
            return this;
          }
          dur = this._dur;
          tDur = this._tDur;
          if (doesWrap) {
            this._lock = 2;
            prevTime = rewinding ? dur : -1e-4;
            this.render(prevTime, true);
            this.vars.repeatRefresh && !isYoyo && this.invalidate();
          }
          this._lock = 0;
          if (!this._ts && !prevPaused) {
            return this;
          }
          _propagateYoyoEase(this, isYoyo);
        }
      }
      if (this._hasPause && !this._forcing && this._lock < 2) {
        pauseTween = _findNextPauseTween(this, _roundPrecise(prevTime), _roundPrecise(time));
        if (pauseTween) {
          tTime -= time - (time = pauseTween._start);
        }
      }
      this._tTime = tTime;
      this._time = time;
      this._act = !timeScale;
      if (!this._initted) {
        this._onUpdate = this.vars.onUpdate;
        this._initted = 1;
        this._zTime = totalTime;
        prevTime = 0;
      }
      if (!prevTime && tTime && !suppressEvents && !prevIteration) {
        _callback$1(this, "onStart");
        if (this._tTime !== tTime) {
          return this;
        }
      }
      if (time >= prevTime && totalTime >= 0) {
        child = this._first;
        while (child) {
          next = child._next;
          if ((child._act || time >= child._start) && child._ts && pauseTween !== child) {
            if (child.parent !== this) {
              return this.render(totalTime, suppressEvents, force);
            }
            child.render(child._ts > 0 ? (time - child._start) * child._ts : (child._dirty ? child.totalDuration() : child._tDur) + (time - child._start) * child._ts, suppressEvents, force);
            if (time !== this._time || !this._ts && !prevPaused) {
              pauseTween = 0;
              next && (tTime += this._zTime = -_tinyNum);
              break;
            }
          }
          child = next;
        }
      } else {
        child = this._last;
        var adjustedTime = totalTime < 0 ? totalTime : time;
        while (child) {
          next = child._prev;
          if ((child._act || adjustedTime <= child._end) && child._ts && pauseTween !== child) {
            if (child.parent !== this) {
              return this.render(totalTime, suppressEvents, force);
            }
            child.render(child._ts > 0 ? (adjustedTime - child._start) * child._ts : (child._dirty ? child.totalDuration() : child._tDur) + (adjustedTime - child._start) * child._ts, suppressEvents, force || _reverting$1 && _isRevertWorthy(child));
            if (time !== this._time || !this._ts && !prevPaused) {
              pauseTween = 0;
              next && (tTime += this._zTime = adjustedTime ? -_tinyNum : _tinyNum);
              break;
            }
          }
          child = next;
        }
      }
      if (pauseTween && !suppressEvents) {
        this.pause();
        pauseTween.render(time >= prevTime ? 0 : -_tinyNum)._zTime = time >= prevTime ? 1 : -1;
        if (this._ts) {
          this._start = prevStart;
          _setEnd(this);
          return this.render(totalTime, suppressEvents, force);
        }
      }
      this._onUpdate && !suppressEvents && _callback$1(this, "onUpdate", true);
      if (tTime === tDur && this._tTime >= this.totalDuration() || !tTime && prevTime) {
        if (prevStart === this._start || Math.abs(timeScale) !== Math.abs(this._ts)) {
          if (!this._lock) {
            (totalTime || !dur) && (tTime === tDur && this._ts > 0 || !tTime && this._ts < 0) && _removeFromParent(this, 1);
            if (!suppressEvents && !(totalTime < 0 && !prevTime) && (tTime || prevTime || !tDur)) {
              _callback$1(this, tTime === tDur && totalTime >= 0 ? "onComplete" : "onReverseComplete", true);
              this._prom && !(tTime < tDur && this.timeScale() > 0) && this._prom();
            }
          }
        }
      }
    }
    return this;
  };
  _proto2.add = function add(child, position) {
    var _this2 = this;
    _isNumber$1(position) || (position = _parsePosition$1(this, position, child));
    if (!(child instanceof Animation)) {
      if (_isArray(child)) {
        child.forEach(function(obj) {
          return _this2.add(obj, position);
        });
        return this;
      }
      if (_isString$1(child)) {
        return this.addLabel(child, position);
      }
      if (_isFunction$1(child)) {
        child = Tween.delayedCall(0, child);
      } else {
        return this;
      }
    }
    return this !== child ? _addToTimeline(this, child, position) : this;
  };
  _proto2.getChildren = function getChildren(nested, tweens, timelines, ignoreBeforeTime) {
    if (nested === void 0) {
      nested = true;
    }
    if (tweens === void 0) {
      tweens = true;
    }
    if (timelines === void 0) {
      timelines = true;
    }
    if (ignoreBeforeTime === void 0) {
      ignoreBeforeTime = -_bigNum$1;
    }
    var a = [], child = this._first;
    while (child) {
      if (child._start >= ignoreBeforeTime) {
        if (child instanceof Tween) {
          tweens && a.push(child);
        } else {
          timelines && a.push(child);
          nested && a.push.apply(a, child.getChildren(true, tweens, timelines));
        }
      }
      child = child._next;
    }
    return a;
  };
  _proto2.getById = function getById2(id) {
    var animations = this.getChildren(1, 1, 1), i = animations.length;
    while (i--) {
      if (animations[i].vars.id === id) {
        return animations[i];
      }
    }
  };
  _proto2.remove = function remove(child) {
    if (_isString$1(child)) {
      return this.removeLabel(child);
    }
    if (_isFunction$1(child)) {
      return this.killTweensOf(child);
    }
    child.parent === this && _removeLinkedListItem(this, child);
    if (child === this._recent) {
      this._recent = this._last;
    }
    return _uncache(this);
  };
  _proto2.totalTime = function totalTime(_totalTime2, suppressEvents) {
    if (!arguments.length) {
      return this._tTime;
    }
    this._forcing = 1;
    if (!this._dp && this._ts) {
      this._start = _roundPrecise(_ticker.time - (this._ts > 0 ? _totalTime2 / this._ts : (this.totalDuration() - _totalTime2) / -this._ts));
    }
    _Animation.prototype.totalTime.call(this, _totalTime2, suppressEvents);
    this._forcing = 0;
    return this;
  };
  _proto2.addLabel = function addLabel(label, position) {
    this.labels[label] = _parsePosition$1(this, position);
    return this;
  };
  _proto2.removeLabel = function removeLabel(label) {
    delete this.labels[label];
    return this;
  };
  _proto2.addPause = function addPause(position, callback, params) {
    var t = Tween.delayedCall(0, callback || _emptyFunc, params);
    t.data = "isPause";
    this._hasPause = 1;
    return _addToTimeline(this, t, _parsePosition$1(this, position));
  };
  _proto2.removePause = function removePause(position) {
    var child = this._first;
    position = _parsePosition$1(this, position);
    while (child) {
      if (child._start === position && child.data === "isPause") {
        _removeFromParent(child);
      }
      child = child._next;
    }
  };
  _proto2.killTweensOf = function killTweensOf(targets, props, onlyActive) {
    var tweens = this.getTweensOf(targets, onlyActive), i = tweens.length;
    while (i--) {
      _overwritingTween !== tweens[i] && tweens[i].kill(targets, props);
    }
    return this;
  };
  _proto2.getTweensOf = function getTweensOf2(targets, onlyActive) {
    var a = [], parsedTargets = toArray(targets), child = this._first, isGlobalTime = _isNumber$1(onlyActive), children;
    while (child) {
      if (child instanceof Tween) {
        if (_arrayContainsAny(child._targets, parsedTargets) && (isGlobalTime ? (!_overwritingTween || child._initted && child._ts) && child.globalTime(0) <= onlyActive && child.globalTime(child.totalDuration()) > onlyActive : !onlyActive || child.isActive())) {
          a.push(child);
        }
      } else if ((children = child.getTweensOf(parsedTargets, onlyActive)).length) {
        a.push.apply(a, children);
      }
      child = child._next;
    }
    return a;
  };
  _proto2.tweenTo = function tweenTo(position, vars) {
    vars = vars || {};
    var tl = this, endTime = _parsePosition$1(tl, position), _vars = vars, startAt = _vars.startAt, _onStart = _vars.onStart, onStartParams = _vars.onStartParams, immediateRender = _vars.immediateRender, initted, tween = Tween.to(tl, _setDefaults$1({
      ease: vars.ease || "none",
      lazy: false,
      immediateRender: false,
      time: endTime,
      overwrite: "auto",
      duration: vars.duration || Math.abs((endTime - (startAt && "time" in startAt ? startAt.time : tl._time)) / tl.timeScale()) || _tinyNum,
      onStart: function onStart() {
        tl.pause();
        if (!initted) {
          var duration = vars.duration || Math.abs((endTime - (startAt && "time" in startAt ? startAt.time : tl._time)) / tl.timeScale());
          tween._dur !== duration && _setDuration(tween, duration, 0, 1).render(tween._time, true, true);
          initted = 1;
        }
        _onStart && _onStart.apply(tween, onStartParams || []);
      }
    }, vars));
    return immediateRender ? tween.render(0) : tween;
  };
  _proto2.tweenFromTo = function tweenFromTo(fromPosition, toPosition, vars) {
    return this.tweenTo(toPosition, _setDefaults$1({
      startAt: {
        time: _parsePosition$1(this, fromPosition)
      }
    }, vars));
  };
  _proto2.recent = function recent() {
    return this._recent;
  };
  _proto2.nextLabel = function nextLabel(afterTime) {
    if (afterTime === void 0) {
      afterTime = this._time;
    }
    return _getLabelInDirection(this, _parsePosition$1(this, afterTime));
  };
  _proto2.previousLabel = function previousLabel(beforeTime) {
    if (beforeTime === void 0) {
      beforeTime = this._time;
    }
    return _getLabelInDirection(this, _parsePosition$1(this, beforeTime), 1);
  };
  _proto2.currentLabel = function currentLabel(value) {
    return arguments.length ? this.seek(value, true) : this.previousLabel(this._time + _tinyNum);
  };
  _proto2.shiftChildren = function shiftChildren(amount, adjustLabels, ignoreBeforeTime) {
    if (ignoreBeforeTime === void 0) {
      ignoreBeforeTime = 0;
    }
    var child = this._first, labels = this.labels, p;
    while (child) {
      if (child._start >= ignoreBeforeTime) {
        child._start += amount;
        child._end += amount;
      }
      child = child._next;
    }
    if (adjustLabels) {
      for (p in labels) {
        if (labels[p] >= ignoreBeforeTime) {
          labels[p] += amount;
        }
      }
    }
    return _uncache(this);
  };
  _proto2.invalidate = function invalidate(soft) {
    var child = this._first;
    this._lock = 0;
    while (child) {
      child.invalidate(soft);
      child = child._next;
    }
    return _Animation.prototype.invalidate.call(this, soft);
  };
  _proto2.clear = function clear(includeLabels) {
    if (includeLabels === void 0) {
      includeLabels = true;
    }
    var child = this._first, next;
    while (child) {
      next = child._next;
      this.remove(child);
      child = next;
    }
    this._dp && (this._time = this._tTime = this._pTime = 0);
    includeLabels && (this.labels = {});
    return _uncache(this);
  };
  _proto2.totalDuration = function totalDuration(value) {
    var max = 0, self = this, child = self._last, prevStart = _bigNum$1, prev, start, parent;
    if (arguments.length) {
      return self.timeScale((self._repeat < 0 ? self.duration() : self.totalDuration()) / (self.reversed() ? -value : value));
    }
    if (self._dirty) {
      parent = self.parent;
      while (child) {
        prev = child._prev;
        child._dirty && child.totalDuration();
        start = child._start;
        if (start > prevStart && self._sort && child._ts && !self._lock) {
          self._lock = 1;
          _addToTimeline(self, child, start - child._delay, 1)._lock = 0;
        } else {
          prevStart = start;
        }
        if (start < 0 && child._ts) {
          max -= start;
          if (!parent && !self._dp || parent && parent.smoothChildTiming) {
            self._start += start / self._ts;
            self._time -= start;
            self._tTime -= start;
          }
          self.shiftChildren(-start, false, -Infinity);
          prevStart = 0;
        }
        child._end > max && child._ts && (max = child._end);
        child = prev;
      }
      _setDuration(self, self === _globalTimeline && self._time > max ? self._time : max, 1, 1);
      self._dirty = 0;
    }
    return self._tDur;
  };
  Timeline2.updateRoot = function updateRoot(time) {
    if (_globalTimeline._ts) {
      _lazySafeRender(_globalTimeline, _parentToChildTotalTime(time, _globalTimeline));
      _lastRenderedFrame = _ticker.frame;
    }
    if (_ticker.frame >= _nextGCFrame) {
      _nextGCFrame += _config.autoSleep || 120;
      var child = _globalTimeline._first;
      if (!child || !child._ts) {
        if (_config.autoSleep && _ticker._listeners.length < 2) {
          while (child && !child._ts) {
            child = child._next;
          }
          child || _ticker.sleep();
        }
      }
    }
  };
  return Timeline2;
}(Animation);
_setDefaults$1(Timeline.prototype, {
  _lock: 0,
  _hasPause: 0,
  _forcing: 0
});
var _addComplexStringPropTween = function _addComplexStringPropTween2(target, prop, start, end, setter, stringFilter, funcParam) {
  var pt = new PropTween(this._pt, target, prop, 0, 1, _renderComplexString, null, setter), index = 0, matchIndex = 0, result, startNums, color, endNum, chunk, startNum, hasRandom, a;
  pt.b = start;
  pt.e = end;
  start += "";
  end += "";
  if (hasRandom = ~end.indexOf("random(")) {
    end = _replaceRandom(end);
  }
  if (stringFilter) {
    a = [start, end];
    stringFilter(a, target, prop);
    start = a[0];
    end = a[1];
  }
  startNums = start.match(_complexStringNumExp) || [];
  while (result = _complexStringNumExp.exec(end)) {
    endNum = result[0];
    chunk = end.substring(index, result.index);
    if (color) {
      color = (color + 1) % 5;
    } else if (chunk.substr(-5) === "rgba(") {
      color = 1;
    }
    if (endNum !== startNums[matchIndex++]) {
      startNum = parseFloat(startNums[matchIndex - 1]) || 0;
      pt._pt = {
        _next: pt._pt,
        p: chunk || matchIndex === 1 ? chunk : ",",
        //note: SVG spec allows omission of comma/space when a negative sign is wedged between two numbers, like 2.5-5.3 instead of 2.5,-5.3 but when tweening, the negative value may switch to positive, so we insert the comma just in case.
        s: startNum,
        c: endNum.charAt(1) === "=" ? _parseRelative(startNum, endNum) - startNum : parseFloat(endNum) - startNum,
        m: color && color < 4 ? Math.round : 0
      };
      index = _complexStringNumExp.lastIndex;
    }
  }
  pt.c = index < end.length ? end.substring(index, end.length) : "";
  pt.fp = funcParam;
  if (_relExp.test(end) || hasRandom) {
    pt.e = 0;
  }
  this._pt = pt;
  return pt;
}, _addPropTween = function _addPropTween2(target, prop, start, end, index, targets, modifier, stringFilter, funcParam, optional) {
  _isFunction$1(end) && (end = end(index || 0, target, targets));
  var currentValue = target[prop], parsedStart = start !== "get" ? start : !_isFunction$1(currentValue) ? currentValue : funcParam ? target[prop.indexOf("set") || !_isFunction$1(target["get" + prop.substr(3)]) ? prop : "get" + prop.substr(3)](funcParam) : target[prop](), setter = !_isFunction$1(currentValue) ? _setterPlain : funcParam ? _setterFuncWithParam : _setterFunc, pt;
  if (_isString$1(end)) {
    if (~end.indexOf("random(")) {
      end = _replaceRandom(end);
    }
    if (end.charAt(1) === "=") {
      pt = _parseRelative(parsedStart, end) + (getUnit(parsedStart) || 0);
      if (pt || pt === 0) {
        end = pt;
      }
    }
  }
  if (!optional || parsedStart !== end || _forceAllPropTweens) {
    if (!isNaN(parsedStart * end) && end !== "") {
      pt = new PropTween(this._pt, target, prop, +parsedStart || 0, end - (parsedStart || 0), typeof currentValue === "boolean" ? _renderBoolean : _renderPlain, 0, setter);
      funcParam && (pt.fp = funcParam);
      modifier && pt.modifier(modifier, this, target);
      return this._pt = pt;
    }
    !currentValue && !(prop in target) && _missingPlugin(prop, end);
    return _addComplexStringPropTween.call(this, target, prop, parsedStart, end, setter, stringFilter || _config.stringFilter, funcParam);
  }
}, _processVars = function _processVars2(vars, index, target, targets, tween) {
  _isFunction$1(vars) && (vars = _parseFuncOrString(vars, tween, index, target, targets));
  if (!_isObject$1(vars) || vars.style && vars.nodeType || _isArray(vars) || _isTypedArray(vars)) {
    return _isString$1(vars) ? _parseFuncOrString(vars, tween, index, target, targets) : vars;
  }
  var copy = {}, p;
  for (p in vars) {
    copy[p] = _parseFuncOrString(vars[p], tween, index, target, targets);
  }
  return copy;
}, _checkPlugin = function _checkPlugin2(property, vars, tween, index, target, targets) {
  var plugin, pt, ptLookup, i;
  if (_plugins[property] && (plugin = new _plugins[property]()).init(target, plugin.rawVars ? vars[property] : _processVars(vars[property], index, target, targets, tween), tween, index, targets) !== false) {
    tween._pt = pt = new PropTween(tween._pt, target, property, 0, 1, plugin.render, plugin, 0, plugin.priority);
    if (tween !== _quickTween) {
      ptLookup = tween._ptLookup[tween._targets.indexOf(target)];
      i = plugin._props.length;
      while (i--) {
        ptLookup[plugin._props[i]] = pt;
      }
    }
  }
  return plugin;
}, _overwritingTween, _forceAllPropTweens, _initTween = function _initTween2(tween, time, tTime) {
  var vars = tween.vars, ease = vars.ease, startAt = vars.startAt, immediateRender = vars.immediateRender, lazy = vars.lazy, onUpdate = vars.onUpdate, runBackwards = vars.runBackwards, yoyoEase = vars.yoyoEase, keyframes = vars.keyframes, autoRevert = vars.autoRevert, dur = tween._dur, prevStartAt = tween._startAt, targets = tween._targets, parent = tween.parent, fullTargets = parent && parent.data === "nested" ? parent.vars.targets : targets, autoOverwrite = tween._overwrite === "auto" && !_suppressOverwrites$1, tl = tween.timeline, cleanVars, i, p, pt, target, hasPriority, gsData, harness, plugin, ptLookup, index, harnessVars, overwritten;
  tl && (!keyframes || !ease) && (ease = "none");
  tween._ease = _parseEase(ease, _defaults$1.ease);
  tween._yEase = yoyoEase ? _invertEase(_parseEase(yoyoEase === true ? ease : yoyoEase, _defaults$1.ease)) : 0;
  if (yoyoEase && tween._yoyo && !tween._repeat) {
    yoyoEase = tween._yEase;
    tween._yEase = tween._ease;
    tween._ease = yoyoEase;
  }
  tween._from = !tl && !!vars.runBackwards;
  if (!tl || keyframes && !vars.stagger) {
    harness = targets[0] ? _getCache(targets[0]).harness : 0;
    harnessVars = harness && vars[harness.prop];
    cleanVars = _copyExcluding(vars, _reservedProps);
    if (prevStartAt) {
      prevStartAt._zTime < 0 && prevStartAt.progress(1);
      time < 0 && runBackwards && immediateRender && !autoRevert ? prevStartAt.render(-1, true) : prevStartAt.revert(runBackwards && dur ? _revertConfigNoKill : _startAtRevertConfig);
      prevStartAt._lazy = 0;
    }
    if (startAt) {
      _removeFromParent(tween._startAt = Tween.set(targets, _setDefaults$1({
        data: "isStart",
        overwrite: false,
        parent,
        immediateRender: true,
        lazy: !prevStartAt && _isNotFalse(lazy),
        startAt: null,
        delay: 0,
        onUpdate: onUpdate && function() {
          return _callback$1(tween, "onUpdate");
        },
        stagger: 0
      }, startAt)));
      tween._startAt._dp = 0;
      tween._startAt._sat = tween;
      time < 0 && (_reverting$1 || !immediateRender && !autoRevert) && tween._startAt.revert(_revertConfigNoKill);
      if (immediateRender) {
        if (dur && time <= 0 && tTime <= 0) {
          time && (tween._zTime = time);
          return;
        }
      }
    } else if (runBackwards && dur) {
      if (!prevStartAt) {
        time && (immediateRender = false);
        p = _setDefaults$1({
          overwrite: false,
          data: "isFromStart",
          //we tag the tween with as "isFromStart" so that if [inside a plugin] we need to only do something at the very END of a tween, we have a way of identifying this tween as merely the one that's setting the beginning values for a "from()" tween. For example, clearProps in CSSPlugin should only get applied at the very END of a tween and without this tag, from(...{height:100, clearProps:"height", delay:1}) would wipe the height at the beginning of the tween and after 1 second, it'd kick back in.
          lazy: immediateRender && !prevStartAt && _isNotFalse(lazy),
          immediateRender,
          //zero-duration tweens render immediately by default, but if we're not specifically instructed to render this tween immediately, we should skip this and merely _init() to record the starting values (rendering them immediately would push them to completion which is wasteful in that case - we'd have to render(-1) immediately after)
          stagger: 0,
          parent
          //ensures that nested tweens that had a stagger are handled properly, like gsap.from(".class", {y: gsap.utils.wrap([-100,100]), stagger: 0.5})
        }, cleanVars);
        harnessVars && (p[harness.prop] = harnessVars);
        _removeFromParent(tween._startAt = Tween.set(targets, p));
        tween._startAt._dp = 0;
        tween._startAt._sat = tween;
        time < 0 && (_reverting$1 ? tween._startAt.revert(_revertConfigNoKill) : tween._startAt.render(-1, true));
        tween._zTime = time;
        if (!immediateRender) {
          _initTween2(tween._startAt, _tinyNum, _tinyNum);
        } else if (!time) {
          return;
        }
      }
    }
    tween._pt = tween._ptCache = 0;
    lazy = dur && _isNotFalse(lazy) || lazy && !dur;
    for (i = 0; i < targets.length; i++) {
      target = targets[i];
      gsData = target._gsap || _harness(targets)[i]._gsap;
      tween._ptLookup[i] = ptLookup = {};
      _lazyLookup[gsData.id] && _lazyTweens.length && _lazyRender();
      index = fullTargets === targets ? i : fullTargets.indexOf(target);
      if (harness && (plugin = new harness()).init(target, harnessVars || cleanVars, tween, index, fullTargets) !== false) {
        tween._pt = pt = new PropTween(tween._pt, target, plugin.name, 0, 1, plugin.render, plugin, 0, plugin.priority);
        plugin._props.forEach(function(name) {
          ptLookup[name] = pt;
        });
        plugin.priority && (hasPriority = 1);
      }
      if (!harness || harnessVars) {
        for (p in cleanVars) {
          if (_plugins[p] && (plugin = _checkPlugin(p, cleanVars, tween, index, target, fullTargets))) {
            plugin.priority && (hasPriority = 1);
          } else {
            ptLookup[p] = pt = _addPropTween.call(tween, target, p, "get", cleanVars[p], index, fullTargets, 0, vars.stringFilter);
          }
        }
      }
      tween._op && tween._op[i] && tween.kill(target, tween._op[i]);
      if (autoOverwrite && tween._pt) {
        _overwritingTween = tween;
        _globalTimeline.killTweensOf(target, ptLookup, tween.globalTime(time));
        overwritten = !tween.parent;
        _overwritingTween = 0;
      }
      tween._pt && lazy && (_lazyLookup[gsData.id] = 1);
    }
    hasPriority && _sortPropTweensByPriority(tween);
    tween._onInit && tween._onInit(tween);
  }
  tween._onUpdate = onUpdate;
  tween._initted = (!tween._op || tween._pt) && !overwritten;
  keyframes && time <= 0 && tl.render(_bigNum$1, true, true);
}, _updatePropTweens = function _updatePropTweens2(tween, property, value, start, startIsRelative, ratio, time, skipRecursion) {
  var ptCache = (tween._pt && tween._ptCache || (tween._ptCache = {}))[property], pt, rootPT, lookup, i;
  if (!ptCache) {
    ptCache = tween._ptCache[property] = [];
    lookup = tween._ptLookup;
    i = tween._targets.length;
    while (i--) {
      pt = lookup[i][property];
      if (pt && pt.d && pt.d._pt) {
        pt = pt.d._pt;
        while (pt && pt.p !== property && pt.fp !== property) {
          pt = pt._next;
        }
      }
      if (!pt) {
        _forceAllPropTweens = 1;
        tween.vars[property] = "+=0";
        _initTween(tween, time);
        _forceAllPropTweens = 0;
        return skipRecursion ? _warn(property + " not eligible for reset") : 1;
      }
      ptCache.push(pt);
    }
  }
  i = ptCache.length;
  while (i--) {
    rootPT = ptCache[i];
    pt = rootPT._pt || rootPT;
    pt.s = (start || start === 0) && !startIsRelative ? start : pt.s + (start || 0) + ratio * pt.c;
    pt.c = value - pt.s;
    rootPT.e && (rootPT.e = _round$1(value) + getUnit(rootPT.e));
    rootPT.b && (rootPT.b = pt.s + getUnit(rootPT.b));
  }
}, _addAliasesToVars = function _addAliasesToVars2(targets, vars) {
  var harness = targets[0] ? _getCache(targets[0]).harness : 0, propertyAliases = harness && harness.aliases, copy, p, i, aliases;
  if (!propertyAliases) {
    return vars;
  }
  copy = _merge({}, vars);
  for (p in propertyAliases) {
    if (p in copy) {
      aliases = propertyAliases[p].split(",");
      i = aliases.length;
      while (i--) {
        copy[aliases[i]] = copy[p];
      }
    }
  }
  return copy;
}, _parseKeyframe = function _parseKeyframe2(prop, obj, allProps, easeEach) {
  var ease = obj.ease || easeEach || "power1.inOut", p, a;
  if (_isArray(obj)) {
    a = allProps[prop] || (allProps[prop] = []);
    obj.forEach(function(value, i) {
      return a.push({
        t: i / (obj.length - 1) * 100,
        v: value,
        e: ease
      });
    });
  } else {
    for (p in obj) {
      a = allProps[p] || (allProps[p] = []);
      p === "ease" || a.push({
        t: parseFloat(prop),
        v: obj[p],
        e: ease
      });
    }
  }
}, _parseFuncOrString = function _parseFuncOrString2(value, tween, i, target, targets) {
  return _isFunction$1(value) ? value.call(tween, i, target, targets) : _isString$1(value) && ~value.indexOf("random(") ? _replaceRandom(value) : value;
}, _staggerTweenProps = _callbackNames + "repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert", _staggerPropsToSkip = {};
_forEachName(_staggerTweenProps + ",id,stagger,delay,duration,paused,scrollTrigger", function(name) {
  return _staggerPropsToSkip[name] = 1;
});
var Tween = /* @__PURE__ */ function(_Animation2) {
  _inheritsLoose(Tween2, _Animation2);
  function Tween2(targets, vars, position, skipInherit) {
    var _this3;
    if (typeof vars === "number") {
      position.duration = vars;
      vars = position;
      position = null;
    }
    _this3 = _Animation2.call(this, skipInherit ? vars : _inheritDefaults(vars)) || this;
    var _this3$vars = _this3.vars, duration = _this3$vars.duration, delay = _this3$vars.delay, immediateRender = _this3$vars.immediateRender, stagger = _this3$vars.stagger, overwrite = _this3$vars.overwrite, keyframes = _this3$vars.keyframes, defaults2 = _this3$vars.defaults, scrollTrigger = _this3$vars.scrollTrigger, yoyoEase = _this3$vars.yoyoEase, parent = vars.parent || _globalTimeline, parsedTargets = (_isArray(targets) || _isTypedArray(targets) ? _isNumber$1(targets[0]) : "length" in vars) ? [targets] : toArray(targets), tl, i, copy, l, p, curTarget, staggerFunc, staggerVarsToMerge;
    _this3._targets = parsedTargets.length ? _harness(parsedTargets) : _warn("GSAP target " + targets + " not found. https://gsap.com", !_config.nullTargetWarn) || [];
    _this3._ptLookup = [];
    _this3._overwrite = overwrite;
    if (keyframes || stagger || _isFuncOrString(duration) || _isFuncOrString(delay)) {
      vars = _this3.vars;
      tl = _this3.timeline = new Timeline({
        data: "nested",
        defaults: defaults2 || {},
        targets: parent && parent.data === "nested" ? parent.vars.targets : parsedTargets
      });
      tl.kill();
      tl.parent = tl._dp = _assertThisInitialized(_this3);
      tl._start = 0;
      if (stagger || _isFuncOrString(duration) || _isFuncOrString(delay)) {
        l = parsedTargets.length;
        staggerFunc = stagger && distribute(stagger);
        if (_isObject$1(stagger)) {
          for (p in stagger) {
            if (~_staggerTweenProps.indexOf(p)) {
              staggerVarsToMerge || (staggerVarsToMerge = {});
              staggerVarsToMerge[p] = stagger[p];
            }
          }
        }
        for (i = 0; i < l; i++) {
          copy = _copyExcluding(vars, _staggerPropsToSkip);
          copy.stagger = 0;
          yoyoEase && (copy.yoyoEase = yoyoEase);
          staggerVarsToMerge && _merge(copy, staggerVarsToMerge);
          curTarget = parsedTargets[i];
          copy.duration = +_parseFuncOrString(duration, _assertThisInitialized(_this3), i, curTarget, parsedTargets);
          copy.delay = (+_parseFuncOrString(delay, _assertThisInitialized(_this3), i, curTarget, parsedTargets) || 0) - _this3._delay;
          if (!stagger && l === 1 && copy.delay) {
            _this3._delay = delay = copy.delay;
            _this3._start += delay;
            copy.delay = 0;
          }
          tl.to(curTarget, copy, staggerFunc ? staggerFunc(i, curTarget, parsedTargets) : 0);
          tl._ease = _easeMap.none;
        }
        tl.duration() ? duration = delay = 0 : _this3.timeline = 0;
      } else if (keyframes) {
        _inheritDefaults(_setDefaults$1(tl.vars.defaults, {
          ease: "none"
        }));
        tl._ease = _parseEase(keyframes.ease || vars.ease || "none");
        var time = 0, a, kf, v;
        if (_isArray(keyframes)) {
          keyframes.forEach(function(frame) {
            return tl.to(parsedTargets, frame, ">");
          });
          tl.duration();
        } else {
          copy = {};
          for (p in keyframes) {
            p === "ease" || p === "easeEach" || _parseKeyframe(p, keyframes[p], copy, keyframes.easeEach);
          }
          for (p in copy) {
            a = copy[p].sort(function(a2, b) {
              return a2.t - b.t;
            });
            time = 0;
            for (i = 0; i < a.length; i++) {
              kf = a[i];
              v = {
                ease: kf.e,
                duration: (kf.t - (i ? a[i - 1].t : 0)) / 100 * duration
              };
              v[p] = kf.v;
              tl.to(parsedTargets, v, time);
              time += v.duration;
            }
          }
          tl.duration() < duration && tl.to({}, {
            duration: duration - tl.duration()
          });
        }
      }
      duration || _this3.duration(duration = tl.duration());
    } else {
      _this3.timeline = 0;
    }
    if (overwrite === true && !_suppressOverwrites$1) {
      _overwritingTween = _assertThisInitialized(_this3);
      _globalTimeline.killTweensOf(parsedTargets);
      _overwritingTween = 0;
    }
    _addToTimeline(parent, _assertThisInitialized(_this3), position);
    vars.reversed && _this3.reverse();
    vars.paused && _this3.paused(true);
    if (immediateRender || !duration && !keyframes && _this3._start === _roundPrecise(parent._time) && _isNotFalse(immediateRender) && _hasNoPausedAncestors(_assertThisInitialized(_this3)) && parent.data !== "nested") {
      _this3._tTime = -_tinyNum;
      _this3.render(Math.max(0, -delay) || 0);
    }
    scrollTrigger && _scrollTrigger(_assertThisInitialized(_this3), scrollTrigger);
    return _this3;
  }
  var _proto3 = Tween2.prototype;
  _proto3.render = function render2(totalTime, suppressEvents, force) {
    var prevTime = this._time, tDur = this._tDur, dur = this._dur, isNegative = totalTime < 0, tTime = totalTime > tDur - _tinyNum && !isNegative ? tDur : totalTime < _tinyNum ? 0 : totalTime, time, pt, iteration, cycleDuration, prevIteration, isYoyo, ratio, timeline2, yoyoEase;
    if (!dur) {
      _renderZeroDurationTween(this, totalTime, suppressEvents, force);
    } else if (tTime !== this._tTime || !totalTime || force || !this._initted && this._tTime || this._startAt && this._zTime < 0 !== isNegative || this._lazy) {
      time = tTime;
      timeline2 = this.timeline;
      if (this._repeat) {
        cycleDuration = dur + this._rDelay;
        if (this._repeat < -1 && isNegative) {
          return this.totalTime(cycleDuration * 100 + totalTime, suppressEvents, force);
        }
        time = _roundPrecise(tTime % cycleDuration);
        if (tTime === tDur) {
          iteration = this._repeat;
          time = dur;
        } else {
          prevIteration = _roundPrecise(tTime / cycleDuration);
          iteration = ~~prevIteration;
          if (iteration && iteration === prevIteration) {
            time = dur;
            iteration--;
          } else if (time > dur) {
            time = dur;
          }
        }
        isYoyo = this._yoyo && iteration & 1;
        if (isYoyo) {
          yoyoEase = this._yEase;
          time = dur - time;
        }
        prevIteration = _animationCycle(this._tTime, cycleDuration);
        if (time === prevTime && !force && this._initted && iteration === prevIteration) {
          this._tTime = tTime;
          return this;
        }
        if (iteration !== prevIteration) {
          timeline2 && this._yEase && _propagateYoyoEase(timeline2, isYoyo);
          if (this.vars.repeatRefresh && !isYoyo && !this._lock && time !== cycleDuration && this._initted) {
            this._lock = force = 1;
            this.render(_roundPrecise(cycleDuration * iteration), true).invalidate()._lock = 0;
          }
        }
      }
      if (!this._initted) {
        if (_attemptInitTween(this, isNegative ? totalTime : time, force, suppressEvents, tTime)) {
          this._tTime = 0;
          return this;
        }
        if (prevTime !== this._time && !(force && this.vars.repeatRefresh && iteration !== prevIteration)) {
          return this;
        }
        if (dur !== this._dur) {
          return this.render(totalTime, suppressEvents, force);
        }
      }
      this._tTime = tTime;
      this._time = time;
      if (!this._act && this._ts) {
        this._act = 1;
        this._lazy = 0;
      }
      this.ratio = ratio = (yoyoEase || this._ease)(time / dur);
      if (this._from) {
        this.ratio = ratio = 1 - ratio;
      }
      if (!prevTime && tTime && !suppressEvents && !prevIteration) {
        _callback$1(this, "onStart");
        if (this._tTime !== tTime) {
          return this;
        }
      }
      pt = this._pt;
      while (pt) {
        pt.r(ratio, pt.d);
        pt = pt._next;
      }
      timeline2 && timeline2.render(totalTime < 0 ? totalTime : timeline2._dur * timeline2._ease(time / this._dur), suppressEvents, force) || this._startAt && (this._zTime = totalTime);
      if (this._onUpdate && !suppressEvents) {
        isNegative && _rewindStartAt(this, totalTime, suppressEvents, force);
        _callback$1(this, "onUpdate");
      }
      this._repeat && iteration !== prevIteration && this.vars.onRepeat && !suppressEvents && this.parent && _callback$1(this, "onRepeat");
      if ((tTime === this._tDur || !tTime) && this._tTime === tTime) {
        isNegative && !this._onUpdate && _rewindStartAt(this, totalTime, true, true);
        (totalTime || !dur) && (tTime === this._tDur && this._ts > 0 || !tTime && this._ts < 0) && _removeFromParent(this, 1);
        if (!suppressEvents && !(isNegative && !prevTime) && (tTime || prevTime || isYoyo)) {
          _callback$1(this, tTime === tDur ? "onComplete" : "onReverseComplete", true);
          this._prom && !(tTime < tDur && this.timeScale() > 0) && this._prom();
        }
      }
    }
    return this;
  };
  _proto3.targets = function targets() {
    return this._targets;
  };
  _proto3.invalidate = function invalidate(soft) {
    (!soft || !this.vars.runBackwards) && (this._startAt = 0);
    this._pt = this._op = this._onUpdate = this._lazy = this.ratio = 0;
    this._ptLookup = [];
    this.timeline && this.timeline.invalidate(soft);
    return _Animation2.prototype.invalidate.call(this, soft);
  };
  _proto3.resetTo = function resetTo(property, value, start, startIsRelative, skipRecursion) {
    _tickerActive || _ticker.wake();
    this._ts || this.play();
    var time = Math.min(this._dur, (this._dp._time - this._start) * this._ts), ratio;
    this._initted || _initTween(this, time);
    ratio = this._ease(time / this._dur);
    if (_updatePropTweens(this, property, value, start, startIsRelative, ratio, time, skipRecursion)) {
      return this.resetTo(property, value, start, startIsRelative, 1);
    }
    _alignPlayhead(this, 0);
    this.parent || _addLinkedListItem(this._dp, this, "_first", "_last", this._dp._sort ? "_start" : 0);
    return this.render(0);
  };
  _proto3.kill = function kill(targets, vars) {
    if (vars === void 0) {
      vars = "all";
    }
    if (!targets && (!vars || vars === "all")) {
      this._lazy = this._pt = 0;
      this.parent ? _interrupt(this) : this.scrollTrigger && this.scrollTrigger.kill(!!_reverting$1);
      return this;
    }
    if (this.timeline) {
      var tDur = this.timeline.totalDuration();
      this.timeline.killTweensOf(targets, vars, _overwritingTween && _overwritingTween.vars.overwrite !== true)._first || _interrupt(this);
      this.parent && tDur !== this.timeline.totalDuration() && _setDuration(this, this._dur * this.timeline._tDur / tDur, 0, 1);
      return this;
    }
    var parsedTargets = this._targets, killingTargets = targets ? toArray(targets) : parsedTargets, propTweenLookup = this._ptLookup, firstPT = this._pt, overwrittenProps, curLookup, curOverwriteProps, props, p, pt, i;
    if ((!vars || vars === "all") && _arraysMatch(parsedTargets, killingTargets)) {
      vars === "all" && (this._pt = 0);
      return _interrupt(this);
    }
    overwrittenProps = this._op = this._op || [];
    if (vars !== "all") {
      if (_isString$1(vars)) {
        p = {};
        _forEachName(vars, function(name) {
          return p[name] = 1;
        });
        vars = p;
      }
      vars = _addAliasesToVars(parsedTargets, vars);
    }
    i = parsedTargets.length;
    while (i--) {
      if (~killingTargets.indexOf(parsedTargets[i])) {
        curLookup = propTweenLookup[i];
        if (vars === "all") {
          overwrittenProps[i] = vars;
          props = curLookup;
          curOverwriteProps = {};
        } else {
          curOverwriteProps = overwrittenProps[i] = overwrittenProps[i] || {};
          props = vars;
        }
        for (p in props) {
          pt = curLookup && curLookup[p];
          if (pt) {
            if (!("kill" in pt.d) || pt.d.kill(p) === true) {
              _removeLinkedListItem(this, pt, "_pt");
            }
            delete curLookup[p];
          }
          if (curOverwriteProps !== "all") {
            curOverwriteProps[p] = 1;
          }
        }
      }
    }
    this._initted && !this._pt && firstPT && _interrupt(this);
    return this;
  };
  Tween2.to = function to(targets, vars) {
    return new Tween2(targets, vars, arguments[2]);
  };
  Tween2.from = function from(targets, vars) {
    return _createTweenType(1, arguments);
  };
  Tween2.delayedCall = function delayedCall(delay, callback, params, scope) {
    return new Tween2(callback, 0, {
      immediateRender: false,
      lazy: false,
      overwrite: false,
      delay,
      onComplete: callback,
      onReverseComplete: callback,
      onCompleteParams: params,
      onReverseCompleteParams: params,
      callbackScope: scope
    });
  };
  Tween2.fromTo = function fromTo(targets, fromVars, toVars) {
    return _createTweenType(2, arguments);
  };
  Tween2.set = function set(targets, vars) {
    vars.duration = 0;
    vars.repeatDelay || (vars.repeat = 0);
    return new Tween2(targets, vars);
  };
  Tween2.killTweensOf = function killTweensOf(targets, props, onlyActive) {
    return _globalTimeline.killTweensOf(targets, props, onlyActive);
  };
  return Tween2;
}(Animation);
_setDefaults$1(Tween.prototype, {
  _targets: [],
  _lazy: 0,
  _startAt: 0,
  _op: 0,
  _onInit: 0
});
_forEachName("staggerTo,staggerFrom,staggerFromTo", function(name) {
  Tween[name] = function() {
    var tl = new Timeline(), params = _slice.call(arguments, 0);
    params.splice(name === "staggerFromTo" ? 5 : 4, 0, 0);
    return tl[name].apply(tl, params);
  };
});
var _setterPlain = function _setterPlain2(target, property, value) {
  return target[property] = value;
}, _setterFunc = function _setterFunc2(target, property, value) {
  return target[property](value);
}, _setterFuncWithParam = function _setterFuncWithParam2(target, property, value, data) {
  return target[property](data.fp, value);
}, _setterAttribute = function _setterAttribute2(target, property, value) {
  return target.setAttribute(property, value);
}, _getSetter = function _getSetter2(target, property) {
  return _isFunction$1(target[property]) ? _setterFunc : _isUndefined(target[property]) && target.setAttribute ? _setterAttribute : _setterPlain;
}, _renderPlain = function _renderPlain2(ratio, data) {
  return data.set(data.t, data.p, Math.round((data.s + data.c * ratio) * 1e6) / 1e6, data);
}, _renderBoolean = function _renderBoolean2(ratio, data) {
  return data.set(data.t, data.p, !!(data.s + data.c * ratio), data);
}, _renderComplexString = function _renderComplexString2(ratio, data) {
  var pt = data._pt, s = "";
  if (!ratio && data.b) {
    s = data.b;
  } else if (ratio === 1 && data.e) {
    s = data.e;
  } else {
    while (pt) {
      s = pt.p + (pt.m ? pt.m(pt.s + pt.c * ratio) : Math.round((pt.s + pt.c * ratio) * 1e4) / 1e4) + s;
      pt = pt._next;
    }
    s += data.c;
  }
  data.set(data.t, data.p, s, data);
}, _renderPropTweens = function _renderPropTweens2(ratio, data) {
  var pt = data._pt;
  while (pt) {
    pt.r(ratio, pt.d);
    pt = pt._next;
  }
}, _addPluginModifier = function _addPluginModifier2(modifier, tween, target, property) {
  var pt = this._pt, next;
  while (pt) {
    next = pt._next;
    pt.p === property && pt.modifier(modifier, tween, target);
    pt = next;
  }
}, _killPropTweensOf = function _killPropTweensOf2(property) {
  var pt = this._pt, hasNonDependentRemaining, next;
  while (pt) {
    next = pt._next;
    if (pt.p === property && !pt.op || pt.op === property) {
      _removeLinkedListItem(this, pt, "_pt");
    } else if (!pt.dep) {
      hasNonDependentRemaining = 1;
    }
    pt = next;
  }
  return !hasNonDependentRemaining;
}, _setterWithModifier = function _setterWithModifier2(target, property, value, data) {
  data.mSet(target, property, data.m.call(data.tween, value, data.mt), data);
}, _sortPropTweensByPriority = function _sortPropTweensByPriority2(parent) {
  var pt = parent._pt, next, pt2, first, last;
  while (pt) {
    next = pt._next;
    pt2 = first;
    while (pt2 && pt2.pr > pt.pr) {
      pt2 = pt2._next;
    }
    if (pt._prev = pt2 ? pt2._prev : last) {
      pt._prev._next = pt;
    } else {
      first = pt;
    }
    if (pt._next = pt2) {
      pt2._prev = pt;
    } else {
      last = pt;
    }
    pt = next;
  }
  parent._pt = first;
};
var PropTween = /* @__PURE__ */ function() {
  function PropTween2(next, target, prop, start, change, renderer, data, setter, priority) {
    this.t = target;
    this.s = start;
    this.c = change;
    this.p = prop;
    this.r = renderer || _renderPlain;
    this.d = data || this;
    this.set = setter || _setterPlain;
    this.pr = priority || 0;
    this._next = next;
    if (next) {
      next._prev = this;
    }
  }
  var _proto4 = PropTween2.prototype;
  _proto4.modifier = function modifier(func, tween, target) {
    this.mSet = this.mSet || this.set;
    this.set = _setterWithModifier;
    this.m = func;
    this.mt = target;
    this.tween = tween;
  };
  return PropTween2;
}();
_forEachName(_callbackNames + "parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger", function(name) {
  return _reservedProps[name] = 1;
});
_globals.TweenMax = _globals.TweenLite = Tween;
_globals.TimelineLite = _globals.TimelineMax = Timeline;
_globalTimeline = new Timeline({
  sortChildren: false,
  defaults: _defaults$1,
  autoRemoveChildren: true,
  id: "root",
  smoothChildTiming: true
});
_config.stringFilter = _colorStringFilter;
var _media = [], _listeners$1 = {}, _emptyArray$1 = [], _lastMediaTime = 0, _contextID = 0, _dispatch$1 = function _dispatch2(type) {
  return (_listeners$1[type] || _emptyArray$1).map(function(f) {
    return f();
  });
}, _onMediaChange = function _onMediaChange2() {
  var time = Date.now(), matches = [];
  if (time - _lastMediaTime > 2) {
    _dispatch$1("matchMediaInit");
    _media.forEach(function(c) {
      var queries = c.queries, conditions = c.conditions, match, p, anyMatch, toggled;
      for (p in queries) {
        match = _win$3.matchMedia(queries[p]).matches;
        match && (anyMatch = 1);
        if (match !== conditions[p]) {
          conditions[p] = match;
          toggled = 1;
        }
      }
      if (toggled) {
        c.revert();
        anyMatch && matches.push(c);
      }
    });
    _dispatch$1("matchMediaRevert");
    matches.forEach(function(c) {
      return c.onMatch(c, function(func) {
        return c.add(null, func);
      });
    });
    _lastMediaTime = time;
    _dispatch$1("matchMedia");
  }
};
var Context = /* @__PURE__ */ function() {
  function Context2(func, scope) {
    this.selector = scope && selector(scope);
    this.data = [];
    this._r = [];
    this.isReverted = false;
    this.id = _contextID++;
    func && this.add(func);
  }
  var _proto5 = Context2.prototype;
  _proto5.add = function add(name, func, scope) {
    if (_isFunction$1(name)) {
      scope = func;
      func = name;
      name = _isFunction$1;
    }
    var self = this, f = function f2() {
      var prev = _context$2, prevSelector = self.selector, result;
      prev && prev !== self && prev.data.push(self);
      scope && (self.selector = selector(scope));
      _context$2 = self;
      result = func.apply(self, arguments);
      _isFunction$1(result) && self._r.push(result);
      _context$2 = prev;
      self.selector = prevSelector;
      self.isReverted = false;
      return result;
    };
    self.last = f;
    return name === _isFunction$1 ? f(self, function(func2) {
      return self.add(null, func2);
    }) : name ? self[name] = f : f;
  };
  _proto5.ignore = function ignore(func) {
    var prev = _context$2;
    _context$2 = null;
    func(this);
    _context$2 = prev;
  };
  _proto5.getTweens = function getTweens() {
    var a = [];
    this.data.forEach(function(e) {
      return e instanceof Context2 ? a.push.apply(a, e.getTweens()) : e instanceof Tween && !(e.parent && e.parent.data === "nested") && a.push(e);
    });
    return a;
  };
  _proto5.clear = function clear() {
    this._r.length = this.data.length = 0;
  };
  _proto5.kill = function kill(revert, matchMedia2) {
    var _this4 = this;
    if (revert) {
      (function() {
        var tweens = _this4.getTweens(), i2 = _this4.data.length, t;
        while (i2--) {
          t = _this4.data[i2];
          if (t.data === "isFlip") {
            t.revert();
            t.getChildren(true, true, false).forEach(function(tween) {
              return tweens.splice(tweens.indexOf(tween), 1);
            });
          }
        }
        tweens.map(function(t2) {
          return {
            g: t2._dur || t2._delay || t2._sat && !t2._sat.vars.immediateRender ? t2.globalTime(0) : -Infinity,
            t: t2
          };
        }).sort(function(a, b) {
          return b.g - a.g || -Infinity;
        }).forEach(function(o) {
          return o.t.revert(revert);
        });
        i2 = _this4.data.length;
        while (i2--) {
          t = _this4.data[i2];
          if (t instanceof Timeline) {
            if (t.data !== "nested") {
              t.scrollTrigger && t.scrollTrigger.revert();
              t.kill();
            }
          } else {
            !(t instanceof Tween) && t.revert && t.revert(revert);
          }
        }
        _this4._r.forEach(function(f) {
          return f(revert, _this4);
        });
        _this4.isReverted = true;
      })();
    } else {
      this.data.forEach(function(e) {
        return e.kill && e.kill();
      });
    }
    this.clear();
    if (matchMedia2) {
      var i = _media.length;
      while (i--) {
        _media[i].id === this.id && _media.splice(i, 1);
      }
    }
  };
  _proto5.revert = function revert(config3) {
    this.kill(config3 || {});
  };
  return Context2;
}();
var MatchMedia = /* @__PURE__ */ function() {
  function MatchMedia2(scope) {
    this.contexts = [];
    this.scope = scope;
    _context$2 && _context$2.data.push(this);
  }
  var _proto6 = MatchMedia2.prototype;
  _proto6.add = function add(conditions, func, scope) {
    _isObject$1(conditions) || (conditions = {
      matches: conditions
    });
    var context3 = new Context(0, scope || this.scope), cond = context3.conditions = {}, mq, p, active;
    _context$2 && !context3.selector && (context3.selector = _context$2.selector);
    this.contexts.push(context3);
    func = context3.add("onMatch", func);
    context3.queries = conditions;
    for (p in conditions) {
      if (p === "all") {
        active = 1;
      } else {
        mq = _win$3.matchMedia(conditions[p]);
        if (mq) {
          _media.indexOf(context3) < 0 && _media.push(context3);
          (cond[p] = mq.matches) && (active = 1);
          mq.addListener ? mq.addListener(_onMediaChange) : mq.addEventListener("change", _onMediaChange);
        }
      }
    }
    active && func(context3, function(f) {
      return context3.add(null, f);
    });
    return this;
  };
  _proto6.revert = function revert(config3) {
    this.kill(config3 || {});
  };
  _proto6.kill = function kill(revert) {
    this.contexts.forEach(function(c) {
      return c.kill(revert, true);
    });
  };
  return MatchMedia2;
}();
var _gsap = {
  registerPlugin: function registerPlugin() {
    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }
    args.forEach(function(config3) {
      return _createPlugin(config3);
    });
  },
  timeline: function timeline(vars) {
    return new Timeline(vars);
  },
  getTweensOf: function getTweensOf(targets, onlyActive) {
    return _globalTimeline.getTweensOf(targets, onlyActive);
  },
  getProperty: function getProperty(target, property, unit, uncache) {
    _isString$1(target) && (target = toArray(target)[0]);
    var getter = _getCache(target || {}).get, format = unit ? _passThrough$1 : _numericIfPossible;
    unit === "native" && (unit = "");
    return !target ? target : !property ? function(property2, unit2, uncache2) {
      return format((_plugins[property2] && _plugins[property2].get || getter)(target, property2, unit2, uncache2));
    } : format((_plugins[property] && _plugins[property].get || getter)(target, property, unit, uncache));
  },
  quickSetter: function quickSetter(target, property, unit) {
    target = toArray(target);
    if (target.length > 1) {
      var setters = target.map(function(t) {
        return gsap$2.quickSetter(t, property, unit);
      }), l = setters.length;
      return function(value) {
        var i = l;
        while (i--) {
          setters[i](value);
        }
      };
    }
    target = target[0] || {};
    var Plugin = _plugins[property], cache = _getCache(target), p = cache.harness && (cache.harness.aliases || {})[property] || property, setter = Plugin ? function(value) {
      var p2 = new Plugin();
      _quickTween._pt = 0;
      p2.init(target, unit ? value + unit : value, _quickTween, 0, [target]);
      p2.render(1, p2);
      _quickTween._pt && _renderPropTweens(1, _quickTween);
    } : cache.set(target, p);
    return Plugin ? setter : function(value) {
      return setter(target, p, unit ? value + unit : value, cache, 1);
    };
  },
  quickTo: function quickTo(target, property, vars) {
    var _setDefaults22;
    var tween = gsap$2.to(target, _setDefaults$1((_setDefaults22 = {}, _setDefaults22[property] = "+=0.1", _setDefaults22.paused = true, _setDefaults22.stagger = 0, _setDefaults22), vars || {})), func = function func2(value, start, startIsRelative) {
      return tween.resetTo(property, value, start, startIsRelative);
    };
    func.tween = tween;
    return func;
  },
  isTweening: function isTweening(targets) {
    return _globalTimeline.getTweensOf(targets, true).length > 0;
  },
  defaults: function defaults(value) {
    value && value.ease && (value.ease = _parseEase(value.ease, _defaults$1.ease));
    return _mergeDeep(_defaults$1, value || {});
  },
  config: function config2(value) {
    return _mergeDeep(_config, value || {});
  },
  registerEffect: function registerEffect(_ref3) {
    var name = _ref3.name, effect = _ref3.effect, plugins = _ref3.plugins, defaults2 = _ref3.defaults, extendTimeline = _ref3.extendTimeline;
    (plugins || "").split(",").forEach(function(pluginName) {
      return pluginName && !_plugins[pluginName] && !_globals[pluginName] && _warn(name + " effect requires " + pluginName + " plugin.");
    });
    _effects[name] = function(targets, vars, tl) {
      return effect(toArray(targets), _setDefaults$1(vars || {}, defaults2), tl);
    };
    if (extendTimeline) {
      Timeline.prototype[name] = function(targets, vars, position) {
        return this.add(_effects[name](targets, _isObject$1(vars) ? vars : (position = vars) && {}, this), position);
      };
    }
  },
  registerEase: function registerEase(name, ease) {
    _easeMap[name] = _parseEase(ease);
  },
  parseEase: function parseEase(ease, defaultEase) {
    return arguments.length ? _parseEase(ease, defaultEase) : _easeMap;
  },
  getById: function getById(id) {
    return _globalTimeline.getById(id);
  },
  exportRoot: function exportRoot(vars, includeDelayedCalls) {
    if (vars === void 0) {
      vars = {};
    }
    var tl = new Timeline(vars), child, next;
    tl.smoothChildTiming = _isNotFalse(vars.smoothChildTiming);
    _globalTimeline.remove(tl);
    tl._dp = 0;
    tl._time = tl._tTime = _globalTimeline._time;
    child = _globalTimeline._first;
    while (child) {
      next = child._next;
      if (includeDelayedCalls || !(!child._dur && child instanceof Tween && child.vars.onComplete === child._targets[0])) {
        _addToTimeline(tl, child, child._start - child._delay);
      }
      child = next;
    }
    _addToTimeline(_globalTimeline, tl, 0);
    return tl;
  },
  context: function context(func, scope) {
    return func ? new Context(func, scope) : _context$2;
  },
  matchMedia: function matchMedia(scope) {
    return new MatchMedia(scope);
  },
  matchMediaRefresh: function matchMediaRefresh() {
    return _media.forEach(function(c) {
      var cond = c.conditions, found, p;
      for (p in cond) {
        if (cond[p]) {
          cond[p] = false;
          found = 1;
        }
      }
      found && c.revert();
    }) || _onMediaChange();
  },
  addEventListener: function addEventListener(type, callback) {
    var a = _listeners$1[type] || (_listeners$1[type] = []);
    ~a.indexOf(callback) || a.push(callback);
  },
  removeEventListener: function removeEventListener(type, callback) {
    var a = _listeners$1[type], i = a && a.indexOf(callback);
    i >= 0 && a.splice(i, 1);
  },
  utils: {
    wrap,
    wrapYoyo,
    distribute,
    random,
    snap,
    normalize: normalize$2,
    getUnit,
    clamp: clamp$1,
    splitColor,
    toArray,
    selector,
    mapRange,
    pipe,
    unitize,
    interpolate,
    shuffle
  },
  install: _install,
  effects: _effects,
  ticker: _ticker,
  updateRoot: Timeline.updateRoot,
  plugins: _plugins,
  globalTimeline: _globalTimeline,
  core: {
    PropTween,
    globals: _addGlobal,
    Tween,
    Timeline,
    Animation,
    getCache: _getCache,
    _removeLinkedListItem,
    reverting: function reverting() {
      return _reverting$1;
    },
    context: function context2(toAdd) {
      if (toAdd && _context$2) {
        _context$2.data.push(toAdd);
        toAdd._ctx = _context$2;
      }
      return _context$2;
    },
    suppressOverwrites: function suppressOverwrites(value) {
      return _suppressOverwrites$1 = value;
    }
  }
};
_forEachName("to,from,fromTo,delayedCall,set,killTweensOf", function(name) {
  return _gsap[name] = Tween[name];
});
_ticker.add(Timeline.updateRoot);
_quickTween = _gsap.to({}, {
  duration: 0
});
var _getPluginPropTween = function _getPluginPropTween2(plugin, prop) {
  var pt = plugin._pt;
  while (pt && pt.p !== prop && pt.op !== prop && pt.fp !== prop) {
    pt = pt._next;
  }
  return pt;
}, _addModifiers = function _addModifiers2(tween, modifiers) {
  var targets = tween._targets, p, i, pt;
  for (p in modifiers) {
    i = targets.length;
    while (i--) {
      pt = tween._ptLookup[i][p];
      if (pt && (pt = pt.d)) {
        if (pt._pt) {
          pt = _getPluginPropTween(pt, p);
        }
        pt && pt.modifier && pt.modifier(modifiers[p], tween, targets[i], p);
      }
    }
  }
}, _buildModifierPlugin = function _buildModifierPlugin2(name, modifier) {
  return {
    name,
    headless: 1,
    rawVars: 1,
    //don't pre-process function-based values or "random()" strings.
    init: function init3(target, vars, tween) {
      tween._onInit = function(tween2) {
        var temp, p;
        if (_isString$1(vars)) {
          temp = {};
          _forEachName(vars, function(name2) {
            return temp[name2] = 1;
          });
          vars = temp;
        }
        if (modifier) {
          temp = {};
          for (p in vars) {
            temp[p] = modifier(vars[p]);
          }
          vars = temp;
        }
        _addModifiers(tween2, vars);
      };
    }
  };
};
var gsap$2 = _gsap.registerPlugin({
  name: "attr",
  init: function init(target, vars, tween, index, targets) {
    var p, pt, v;
    this.tween = tween;
    for (p in vars) {
      v = target.getAttribute(p) || "";
      pt = this.add(target, "setAttribute", (v || 0) + "", vars[p], index, targets, 0, 0, p);
      pt.op = p;
      pt.b = v;
      this._props.push(p);
    }
  },
  render: function render(ratio, data) {
    var pt = data._pt;
    while (pt) {
      _reverting$1 ? pt.set(pt.t, pt.p, pt.b, pt) : pt.r(ratio, pt.d);
      pt = pt._next;
    }
  }
}, {
  name: "endArray",
  headless: 1,
  init: function init2(target, value) {
    var i = value.length;
    while (i--) {
      this.add(target, i, target[i] || 0, value[i], 0, 0, 0, 0, 0, 1);
    }
  }
}, _buildModifierPlugin("roundProps", _roundModifier), _buildModifierPlugin("modifiers"), _buildModifierPlugin("snap", snap)) || _gsap;
Tween.version = Timeline.version = gsap$2.version = "3.13.0";
_coreReady = 1;
_windowExists$2() && _wake();
_easeMap.Power0; _easeMap.Power1; _easeMap.Power2; _easeMap.Power3; _easeMap.Power4; _easeMap.Linear; _easeMap.Quad; _easeMap.Cubic; _easeMap.Quart; _easeMap.Quint; _easeMap.Strong; _easeMap.Elastic; _easeMap.Back; _easeMap.SteppedEase; _easeMap.Bounce; _easeMap.Sine; _easeMap.Expo; _easeMap.Circ;

/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/


var _win$2,
    _doc$2,
    _docElement,
    _pluginInitted,
    _tempDiv,
    _recentSetterPlugin,
    _reverting,
    _windowExists$1 = function _windowExists() {
  return typeof window !== "undefined";
},
    _transformProps = {},
    _RAD2DEG = 180 / Math.PI,
    _DEG2RAD = Math.PI / 180,
    _atan2 = Math.atan2,
    _bigNum = 1e8,
    _capsExp$1 = /([A-Z])/g,
    _horizontalExp = /(left|right|width|margin|padding|x)/i,
    _complexExp = /[\s,\(]\S/,
    _propertyAliases = {
  autoAlpha: "opacity,visibility",
  scale: "scaleX,scaleY",
  alpha: "opacity"
},
    _renderCSSProp = function _renderCSSProp(ratio, data) {
  return data.set(data.t, data.p, Math.round((data.s + data.c * ratio) * 10000) / 10000 + data.u, data);
},
    _renderPropWithEnd = function _renderPropWithEnd(ratio, data) {
  return data.set(data.t, data.p, ratio === 1 ? data.e : Math.round((data.s + data.c * ratio) * 10000) / 10000 + data.u, data);
},
    _renderCSSPropWithBeginning = function _renderCSSPropWithBeginning(ratio, data) {
  return data.set(data.t, data.p, ratio ? Math.round((data.s + data.c * ratio) * 10000) / 10000 + data.u : data.b, data);
},
    //if units change, we need a way to render the original unit/value when the tween goes all the way back to the beginning (ratio:0)
_renderRoundedCSSProp = function _renderRoundedCSSProp(ratio, data) {
  var value = data.s + data.c * ratio;
  data.set(data.t, data.p, ~~(value + (value < 0 ? -0.5 : .5)) + data.u, data);
},
    _renderNonTweeningValue = function _renderNonTweeningValue(ratio, data) {
  return data.set(data.t, data.p, ratio ? data.e : data.b, data);
},
    _renderNonTweeningValueOnlyAtEnd = function _renderNonTweeningValueOnlyAtEnd(ratio, data) {
  return data.set(data.t, data.p, ratio !== 1 ? data.b : data.e, data);
},
    _setterCSSStyle = function _setterCSSStyle(target, property, value) {
  return target.style[property] = value;
},
    _setterCSSProp = function _setterCSSProp(target, property, value) {
  return target.style.setProperty(property, value);
},
    _setterTransform = function _setterTransform(target, property, value) {
  return target._gsap[property] = value;
},
    _setterScale = function _setterScale(target, property, value) {
  return target._gsap.scaleX = target._gsap.scaleY = value;
},
    _setterScaleWithRender = function _setterScaleWithRender(target, property, value, data, ratio) {
  var cache = target._gsap;
  cache.scaleX = cache.scaleY = value;
  cache.renderTransform(ratio, cache);
},
    _setterTransformWithRender = function _setterTransformWithRender(target, property, value, data, ratio) {
  var cache = target._gsap;
  cache[property] = value;
  cache.renderTransform(ratio, cache);
},
    _transformProp$1 = "transform",
    _transformOriginProp = _transformProp$1 + "Origin",
    _saveStyle = function _saveStyle(property, isNotCSS) {
  var _this = this;

  var target = this.target,
      style = target.style,
      cache = target._gsap;

  if (property in _transformProps && style) {
    this.tfm = this.tfm || {};

    if (property !== "transform") {
      property = _propertyAliases[property] || property;
      ~property.indexOf(",") ? property.split(",").forEach(function (a) {
        return _this.tfm[a] = _get(target, a);
      }) : this.tfm[property] = cache.x ? cache[property] : _get(target, property); // note: scale would map to "scaleX,scaleY", thus we loop and apply them both.

      property === _transformOriginProp && (this.tfm.zOrigin = cache.zOrigin);
    } else {
      return _propertyAliases.transform.split(",").forEach(function (p) {
        return _saveStyle.call(_this, p, isNotCSS);
      });
    }

    if (this.props.indexOf(_transformProp$1) >= 0) {
      return;
    }

    if (cache.svg) {
      this.svgo = target.getAttribute("data-svg-origin");
      this.props.push(_transformOriginProp, isNotCSS, "");
    }

    property = _transformProp$1;
  }

  (style || isNotCSS) && this.props.push(property, isNotCSS, style[property]);
},
    _removeIndependentTransforms = function _removeIndependentTransforms(style) {
  if (style.translate) {
    style.removeProperty("translate");
    style.removeProperty("scale");
    style.removeProperty("rotate");
  }
},
    _revertStyle = function _revertStyle() {
  var props = this.props,
      target = this.target,
      style = target.style,
      cache = target._gsap,
      i,
      p;

  for (i = 0; i < props.length; i += 3) {
    // stored like this: property, isNotCSS, value
    if (!props[i + 1]) {
      props[i + 2] ? style[props[i]] = props[i + 2] : style.removeProperty(props[i].substr(0, 2) === "--" ? props[i] : props[i].replace(_capsExp$1, "-$1").toLowerCase());
    } else if (props[i + 1] === 2) {
      // non-CSS value (function-based)
      target[props[i]](props[i + 2]);
    } else {
      // non-CSS value (not function-based)
      target[props[i]] = props[i + 2];
    }
  }

  if (this.tfm) {
    for (p in this.tfm) {
      cache[p] = this.tfm[p];
    }

    if (cache.svg) {
      cache.renderTransform();
      target.setAttribute("data-svg-origin", this.svgo || "");
    }

    i = _reverting();

    if ((!i || !i.isStart) && !style[_transformProp$1]) {
      _removeIndependentTransforms(style);

      if (cache.zOrigin && style[_transformOriginProp]) {
        style[_transformOriginProp] += " " + cache.zOrigin + "px"; // since we're uncaching, we must put the zOrigin back into the transformOrigin so that we can pull it out accurately when we parse again. Otherwise, we'd lose the z portion of the origin since we extract it to protect from Safari bugs.

        cache.zOrigin = 0;
        cache.renderTransform();
      }

      cache.uncache = 1; // if it's a startAt that's being reverted in the _initTween() of the core, we don't need to uncache transforms. This is purely a performance optimization.
    }
  }
},
    _getStyleSaver = function _getStyleSaver(target, properties) {
  var saver = {
    target: target,
    props: [],
    revert: _revertStyle,
    save: _saveStyle
  };
  target._gsap || gsap$2.core.getCache(target); // just make sure there's a _gsap cache defined because we read from it in _saveStyle() and it's more efficient to just check it here once.

  properties && target.style && target.nodeType && properties.split(",").forEach(function (p) {
    return saver.save(p);
  }); // make sure it's a DOM node too.

  return saver;
},
    _supports3D,
    _createElement = function _createElement(type, ns) {
  var e = _doc$2.createElementNS ? _doc$2.createElementNS((ns || "http://www.w3.org/1999/xhtml").replace(/^https/, "http"), type) : _doc$2.createElement(type); //some servers swap in https for http in the namespace which can break things, making "style" inaccessible.

  return e && e.style ? e : _doc$2.createElement(type); //some environments won't allow access to the element's style when created with a namespace in which case we default to the standard createElement() to work around the issue. Also note that when GSAP is embedded directly inside an SVG file, createElement() won't allow access to the style object in Firefox (see https://gsap.com/forums/topic/20215-problem-using-tweenmax-in-standalone-self-containing-svg-file-err-cannot-set-property-csstext-of-undefined/).
},
    _getComputedProperty = function _getComputedProperty(target, property, skipPrefixFallback) {
  var cs = getComputedStyle(target);
  return cs[property] || cs.getPropertyValue(property.replace(_capsExp$1, "-$1").toLowerCase()) || cs.getPropertyValue(property) || !skipPrefixFallback && _getComputedProperty(target, _checkPropPrefix(property) || property, 1) || ""; //css variables may not need caps swapped out for dashes and lowercase.
},
    _prefixes = "O,Moz,ms,Ms,Webkit".split(","),
    _checkPropPrefix = function _checkPropPrefix(property, element, preferPrefix) {
  var e = element || _tempDiv,
      s = e.style,
      i = 5;

  if (property in s && !preferPrefix) {
    return property;
  }

  property = property.charAt(0).toUpperCase() + property.substr(1);

  while (i-- && !(_prefixes[i] + property in s)) {}

  return i < 0 ? null : (i === 3 ? "ms" : i >= 0 ? _prefixes[i] : "") + property;
},
    _initCore$1 = function _initCore() {
  if (_windowExists$1() && window.document) {
    _win$2 = window;
    _doc$2 = _win$2.document;
    _docElement = _doc$2.documentElement;
    _tempDiv = _createElement("div") || {
      style: {}
    };
    _createElement("div");
    _transformProp$1 = _checkPropPrefix(_transformProp$1);
    _transformOriginProp = _transformProp$1 + "Origin";
    _tempDiv.style.cssText = "border-width:0;line-height:0;position:absolute;padding:0"; //make sure to override certain properties that may contaminate measurements, in case the user has overreaching style sheets.

    _supports3D = !!_checkPropPrefix("perspective");
    _reverting = gsap$2.core.reverting;
    _pluginInitted = 1;
  }
},
    _getReparentedCloneBBox = function _getReparentedCloneBBox(target) {
  //works around issues in some browsers (like Firefox) that don't correctly report getBBox() on SVG elements inside a <defs> element and/or <mask>. We try creating an SVG, adding it to the documentElement and toss the element in there so that it's definitely part of the rendering tree, then grab the bbox and if it works, we actually swap out the original getBBox() method for our own that does these extra steps whenever getBBox is needed. This helps ensure that performance is optimal (only do all these extra steps when absolutely necessary...most elements don't need it).
  var owner = target.ownerSVGElement,
      svg = _createElement("svg", owner && owner.getAttribute("xmlns") || "http://www.w3.org/2000/svg"),
      clone = target.cloneNode(true),
      bbox;

  clone.style.display = "block";
  svg.appendChild(clone);

  _docElement.appendChild(svg);

  try {
    bbox = clone.getBBox();
  } catch (e) {}

  svg.removeChild(clone);

  _docElement.removeChild(svg);

  return bbox;
},
    _getAttributeFallbacks = function _getAttributeFallbacks(target, attributesArray) {
  var i = attributesArray.length;

  while (i--) {
    if (target.hasAttribute(attributesArray[i])) {
      return target.getAttribute(attributesArray[i]);
    }
  }
},
    _getBBox = function _getBBox(target) {
  var bounds, cloned;

  try {
    bounds = target.getBBox(); //Firefox throws errors if you try calling getBBox() on an SVG element that's not rendered (like in a <symbol> or <defs>). https://bugzilla.mozilla.org/show_bug.cgi?id=612118
  } catch (error) {
    bounds = _getReparentedCloneBBox(target);
    cloned = 1;
  }

  bounds && (bounds.width || bounds.height) || cloned || (bounds = _getReparentedCloneBBox(target)); //some browsers (like Firefox) misreport the bounds if the element has zero width and height (it just assumes it's at x:0, y:0), thus we need to manually grab the position in that case.

  return bounds && !bounds.width && !bounds.x && !bounds.y ? {
    x: +_getAttributeFallbacks(target, ["x", "cx", "x1"]) || 0,
    y: +_getAttributeFallbacks(target, ["y", "cy", "y1"]) || 0,
    width: 0,
    height: 0
  } : bounds;
},
    _isSVG = function _isSVG(e) {
  return !!(e.getCTM && (!e.parentNode || e.ownerSVGElement) && _getBBox(e));
},
    //reports if the element is an SVG on which getBBox() actually works
_removeProperty = function _removeProperty(target, property) {
  if (property) {
    var style = target.style,
        first2Chars;

    if (property in _transformProps && property !== _transformOriginProp) {
      property = _transformProp$1;
    }

    if (style.removeProperty) {
      first2Chars = property.substr(0, 2);

      if (first2Chars === "ms" || property.substr(0, 6) === "webkit") {
        //Microsoft and some Webkit browsers don't conform to the standard of capitalizing the first prefix character, so we adjust so that when we prefix the caps with a dash, it's correct (otherwise it'd be "ms-transform" instead of "-ms-transform" for IE9, for example)
        property = "-" + property;
      }

      style.removeProperty(first2Chars === "--" ? property : property.replace(_capsExp$1, "-$1").toLowerCase());
    } else {
      //note: old versions of IE use "removeAttribute()" instead of "removeProperty()"
      style.removeAttribute(property);
    }
  }
},
    _addNonTweeningPT = function _addNonTweeningPT(plugin, target, property, beginning, end, onlySetAtEnd) {
  var pt = new PropTween(plugin._pt, target, property, 0, 1, onlySetAtEnd ? _renderNonTweeningValueOnlyAtEnd : _renderNonTweeningValue);
  plugin._pt = pt;
  pt.b = beginning;
  pt.e = end;

  plugin._props.push(property);

  return pt;
},
    _nonConvertibleUnits = {
  deg: 1,
  rad: 1,
  turn: 1
},
    _nonStandardLayouts = {
  grid: 1,
  flex: 1
},
    //takes a single value like 20px and converts it to the unit specified, like "%", returning only the numeric amount.
_convertToUnit = function _convertToUnit(target, property, value, unit) {
  var curValue = parseFloat(value) || 0,
      curUnit = (value + "").trim().substr((curValue + "").length) || "px",
      // some browsers leave extra whitespace at the beginning of CSS variables, hence the need to trim()
  style = _tempDiv.style,
      horizontal = _horizontalExp.test(property),
      isRootSVG = target.tagName.toLowerCase() === "svg",
      measureProperty = (isRootSVG ? "client" : "offset") + (horizontal ? "Width" : "Height"),
      amount = 100,
      toPixels = unit === "px",
      toPercent = unit === "%",
      px,
      parent,
      cache,
      isSVG;

  if (unit === curUnit || !curValue || _nonConvertibleUnits[unit] || _nonConvertibleUnits[curUnit]) {
    return curValue;
  }

  curUnit !== "px" && !toPixels && (curValue = _convertToUnit(target, property, value, "px"));
  isSVG = target.getCTM && _isSVG(target);

  if ((toPercent || curUnit === "%") && (_transformProps[property] || ~property.indexOf("adius"))) {
    px = isSVG ? target.getBBox()[horizontal ? "width" : "height"] : target[measureProperty];
    return _round$1(toPercent ? curValue / px * amount : curValue / 100 * px);
  }

  style[horizontal ? "width" : "height"] = amount + (toPixels ? curUnit : unit);
  parent = unit !== "rem" && ~property.indexOf("adius") || unit === "em" && target.appendChild && !isRootSVG ? target : target.parentNode;

  if (isSVG) {
    parent = (target.ownerSVGElement || {}).parentNode;
  }

  if (!parent || parent === _doc$2 || !parent.appendChild) {
    parent = _doc$2.body;
  }

  cache = parent._gsap;

  if (cache && toPercent && cache.width && horizontal && cache.time === _ticker.time && !cache.uncache) {
    return _round$1(curValue / cache.width * amount);
  } else {
    if (toPercent && (property === "height" || property === "width")) {
      // if we're dealing with width/height that's inside a container with padding and/or it's a flexbox/grid container, we must apply it to the target itself rather than the _tempDiv in order to ensure complete accuracy, factoring in the parent's padding.
      var v = target.style[property];
      target.style[property] = amount + unit;
      px = target[measureProperty];
      v ? target.style[property] = v : _removeProperty(target, property);
    } else {
      (toPercent || curUnit === "%") && !_nonStandardLayouts[_getComputedProperty(parent, "display")] && (style.position = _getComputedProperty(target, "position"));
      parent === target && (style.position = "static"); // like for borderRadius, if it's a % we must have it relative to the target itself but that may not have position: relative or position: absolute in which case it'd go up the chain until it finds its offsetParent (bad). position: static protects against that.

      parent.appendChild(_tempDiv);
      px = _tempDiv[measureProperty];
      parent.removeChild(_tempDiv);
      style.position = "absolute";
    }

    if (horizontal && toPercent) {
      cache = _getCache(parent);
      cache.time = _ticker.time;
      cache.width = parent[measureProperty];
    }
  }

  return _round$1(toPixels ? px * curValue / amount : px && curValue ? amount / px * curValue : 0);
},
    _get = function _get(target, property, unit, uncache) {
  var value;
  _pluginInitted || _initCore$1();

  if (property in _propertyAliases && property !== "transform") {
    property = _propertyAliases[property];

    if (~property.indexOf(",")) {
      property = property.split(",")[0];
    }
  }

  if (_transformProps[property] && property !== "transform") {
    value = _parseTransform(target, uncache);
    value = property !== "transformOrigin" ? value[property] : value.svg ? value.origin : _firstTwoOnly(_getComputedProperty(target, _transformOriginProp)) + " " + value.zOrigin + "px";
  } else {
    value = target.style[property];

    if (!value || value === "auto" || uncache || ~(value + "").indexOf("calc(")) {
      value = _specialProps[property] && _specialProps[property](target, property, unit) || _getComputedProperty(target, property) || _getProperty(target, property) || (property === "opacity" ? 1 : 0); // note: some browsers, like Firefox, don't report borderRadius correctly! Instead, it only reports every corner like  borderTopLeftRadius
    }
  }

  return unit && !~(value + "").trim().indexOf(" ") ? _convertToUnit(target, property, value, unit) + unit : value;
},
    _tweenComplexCSSString = function _tweenComplexCSSString(target, prop, start, end) {
  // note: we call _tweenComplexCSSString.call(pluginInstance...) to ensure that it's scoped properly. We may call it from within a plugin too, thus "this" would refer to the plugin.
  if (!start || start === "none") {
    // some browsers like Safari actually PREFER the prefixed property and mis-report the unprefixed value like clipPath (BUG). In other words, even though clipPath exists in the style ("clipPath" in target.style) and it's set in the CSS properly (along with -webkit-clip-path), Safari reports clipPath as "none" whereas WebkitClipPath reports accurately like "ellipse(100% 0% at 50% 0%)", so in this case we must SWITCH to using the prefixed property instead. See https://gsap.com/forums/topic/18310-clippath-doesnt-work-on-ios/
    var p = _checkPropPrefix(prop, target, 1),
        s = p && _getComputedProperty(target, p, 1);

    if (s && s !== start) {
      prop = p;
      start = s;
    } else if (prop === "borderColor") {
      start = _getComputedProperty(target, "borderTopColor"); // Firefox bug: always reports "borderColor" as "", so we must fall back to borderTopColor. See https://gsap.com/forums/topic/24583-how-to-return-colors-that-i-had-after-reverse/
    }
  }

  var pt = new PropTween(this._pt, target.style, prop, 0, 1, _renderComplexString),
      index = 0,
      matchIndex = 0,
      a,
      result,
      startValues,
      startNum,
      color,
      startValue,
      endValue,
      endNum,
      chunk,
      endUnit,
      startUnit,
      endValues;
  pt.b = start;
  pt.e = end;
  start += ""; // ensure values are strings

  end += "";

  if (end.substring(0, 6) === "var(--") {
    end = _getComputedProperty(target, end.substring(4, end.indexOf(")")));
  }

  if (end === "auto") {
    startValue = target.style[prop];
    target.style[prop] = end;
    end = _getComputedProperty(target, prop) || end;
    startValue ? target.style[prop] = startValue : _removeProperty(target, prop);
  }

  a = [start, end];

  _colorStringFilter(a); // pass an array with the starting and ending values and let the filter do whatever it needs to the values. If colors are found, it returns true and then we must match where the color shows up order-wise because for things like boxShadow, sometimes the browser provides the computed values with the color FIRST, but the user provides it with the color LAST, so flip them if necessary. Same for drop-shadow().


  start = a[0];
  end = a[1];
  startValues = start.match(_numWithUnitExp) || [];
  endValues = end.match(_numWithUnitExp) || [];

  if (endValues.length) {
    while (result = _numWithUnitExp.exec(end)) {
      endValue = result[0];
      chunk = end.substring(index, result.index);

      if (color) {
        color = (color + 1) % 5;
      } else if (chunk.substr(-5) === "rgba(" || chunk.substr(-5) === "hsla(") {
        color = 1;
      }

      if (endValue !== (startValue = startValues[matchIndex++] || "")) {
        startNum = parseFloat(startValue) || 0;
        startUnit = startValue.substr((startNum + "").length);
        endValue.charAt(1) === "=" && (endValue = _parseRelative(startNum, endValue) + startUnit);
        endNum = parseFloat(endValue);
        endUnit = endValue.substr((endNum + "").length);
        index = _numWithUnitExp.lastIndex - endUnit.length;

        if (!endUnit) {
          //if something like "perspective:300" is passed in and we must add a unit to the end
          endUnit = endUnit || _config.units[prop] || startUnit;

          if (index === end.length) {
            end += endUnit;
            pt.e += endUnit;
          }
        }

        if (startUnit !== endUnit) {
          startNum = _convertToUnit(target, prop, startValue, endUnit) || 0;
        } // these nested PropTweens are handled in a special way - we'll never actually call a render or setter method on them. We'll just loop through them in the parent complex string PropTween's render method.


        pt._pt = {
          _next: pt._pt,
          p: chunk || matchIndex === 1 ? chunk : ",",
          //note: SVG spec allows omission of comma/space when a negative sign is wedged between two numbers, like 2.5-5.3 instead of 2.5,-5.3 but when tweening, the negative value may switch to positive, so we insert the comma just in case.
          s: startNum,
          c: endNum - startNum,
          m: color && color < 4 || prop === "zIndex" ? Math.round : 0
        };
      }
    }

    pt.c = index < end.length ? end.substring(index, end.length) : ""; //we use the "c" of the PropTween to store the final part of the string (after the last number)
  } else {
    pt.r = prop === "display" && end === "none" ? _renderNonTweeningValueOnlyAtEnd : _renderNonTweeningValue;
  }

  _relExp.test(end) && (pt.e = 0); //if the end string contains relative values or dynamic random(...) values, delete the end it so that on the final render we don't actually set it to the string with += or -= characters (forces it to use the calculated value).

  this._pt = pt; //start the linked list with this new PropTween. Remember, we call _tweenComplexCSSString.call(pluginInstance...) to ensure that it's scoped properly. We may call it from within another plugin too, thus "this" would refer to the plugin.

  return pt;
},
    _keywordToPercent = {
  top: "0%",
  bottom: "100%",
  left: "0%",
  right: "100%",
  center: "50%"
},
    _convertKeywordsToPercentages = function _convertKeywordsToPercentages(value) {
  var split = value.split(" "),
      x = split[0],
      y = split[1] || "50%";

  if (x === "top" || x === "bottom" || y === "left" || y === "right") {
    //the user provided them in the wrong order, so flip them
    value = x;
    x = y;
    y = value;
  }

  split[0] = _keywordToPercent[x] || x;
  split[1] = _keywordToPercent[y] || y;
  return split.join(" ");
},
    _renderClearProps = function _renderClearProps(ratio, data) {
  if (data.tween && data.tween._time === data.tween._dur) {
    var target = data.t,
        style = target.style,
        props = data.u,
        cache = target._gsap,
        prop,
        clearTransforms,
        i;

    if (props === "all" || props === true) {
      style.cssText = "";
      clearTransforms = 1;
    } else {
      props = props.split(",");
      i = props.length;

      while (--i > -1) {
        prop = props[i];

        if (_transformProps[prop]) {
          clearTransforms = 1;
          prop = prop === "transformOrigin" ? _transformOriginProp : _transformProp$1;
        }

        _removeProperty(target, prop);
      }
    }

    if (clearTransforms) {
      _removeProperty(target, _transformProp$1);

      if (cache) {
        cache.svg && target.removeAttribute("transform");
        style.scale = style.rotate = style.translate = "none";

        _parseTransform(target, 1); // force all the cached values back to "normal"/identity, otherwise if there's another tween that's already set to render transforms on this element, it could display the wrong values.


        cache.uncache = 1;

        _removeIndependentTransforms(style);
      }
    }
  }
},
    // note: specialProps should return 1 if (and only if) they have a non-zero priority. It indicates we need to sort the linked list.
_specialProps = {
  clearProps: function clearProps(plugin, target, property, endValue, tween) {
    if (tween.data !== "isFromStart") {
      var pt = plugin._pt = new PropTween(plugin._pt, target, property, 0, 0, _renderClearProps);
      pt.u = endValue;
      pt.pr = -10;
      pt.tween = tween;

      plugin._props.push(property);

      return 1;
    }
  }
  /* className feature (about 0.4kb gzipped).
  , className(plugin, target, property, endValue, tween) {
  	let _renderClassName = (ratio, data) => {
  			data.css.render(ratio, data.css);
  			if (!ratio || ratio === 1) {
  				let inline = data.rmv,
  					target = data.t,
  					p;
  				target.setAttribute("class", ratio ? data.e : data.b);
  				for (p in inline) {
  					_removeProperty(target, p);
  				}
  			}
  		},
  		_getAllStyles = (target) => {
  			let styles = {},
  				computed = getComputedStyle(target),
  				p;
  			for (p in computed) {
  				if (isNaN(p) && p !== "cssText" && p !== "length") {
  					styles[p] = computed[p];
  				}
  			}
  			_setDefaults(styles, _parseTransform(target, 1));
  			return styles;
  		},
  		startClassList = target.getAttribute("class"),
  		style = target.style,
  		cssText = style.cssText,
  		cache = target._gsap,
  		classPT = cache.classPT,
  		inlineToRemoveAtEnd = {},
  		data = {t:target, plugin:plugin, rmv:inlineToRemoveAtEnd, b:startClassList, e:(endValue.charAt(1) !== "=") ? endValue : startClassList.replace(new RegExp("(?:\\s|^)" + endValue.substr(2) + "(?![\\w-])"), "") + ((endValue.charAt(0) === "+") ? " " + endValue.substr(2) : "")},
  		changingVars = {},
  		startVars = _getAllStyles(target),
  		transformRelated = /(transform|perspective)/i,
  		endVars, p;
  	if (classPT) {
  		classPT.r(1, classPT.d);
  		_removeLinkedListItem(classPT.d.plugin, classPT, "_pt");
  	}
  	target.setAttribute("class", data.e);
  	endVars = _getAllStyles(target, true);
  	target.setAttribute("class", startClassList);
  	for (p in endVars) {
  		if (endVars[p] !== startVars[p] && !transformRelated.test(p)) {
  			changingVars[p] = endVars[p];
  			if (!style[p] && style[p] !== "0") {
  				inlineToRemoveAtEnd[p] = 1;
  			}
  		}
  	}
  	cache.classPT = plugin._pt = new PropTween(plugin._pt, target, "className", 0, 0, _renderClassName, data, 0, -11);
  	if (style.cssText !== cssText) { //only apply if things change. Otherwise, in cases like a background-image that's pulled dynamically, it could cause a refresh. See https://gsap.com/forums/topic/20368-possible-gsap-bug-switching-classnames-in-chrome/.
  		style.cssText = cssText; //we recorded cssText before we swapped classes and ran _getAllStyles() because in cases when a className tween is overwritten, we remove all the related tweening properties from that class change (otherwise class-specific stuff can't override properties we've directly set on the target's style object due to specificity).
  	}
  	_parseTransform(target, true); //to clear the caching of transforms
  	data.css = new gsap.plugins.css();
  	data.css.init(target, changingVars, tween);
  	plugin._props.push(...data.css._props);
  	return 1;
  }
  */

},

/*
 * --------------------------------------------------------------------------------------
 * TRANSFORMS
 * --------------------------------------------------------------------------------------
 */
_identity2DMatrix = [1, 0, 0, 1, 0, 0],
    _rotationalProperties = {},
    _isNullTransform = function _isNullTransform(value) {
  return value === "matrix(1, 0, 0, 1, 0, 0)" || value === "none" || !value;
},
    _getComputedTransformMatrixAsArray = function _getComputedTransformMatrixAsArray(target) {
  var matrixString = _getComputedProperty(target, _transformProp$1);

  return _isNullTransform(matrixString) ? _identity2DMatrix : matrixString.substr(7).match(_numExp).map(_round$1);
},
    _getMatrix = function _getMatrix(target, force2D) {
  var cache = target._gsap || _getCache(target),
      style = target.style,
      matrix = _getComputedTransformMatrixAsArray(target),
      parent,
      nextSibling,
      temp,
      addedToDOM;

  if (cache.svg && target.getAttribute("transform")) {
    temp = target.transform.baseVal.consolidate().matrix; //ensures that even complex values like "translate(50,60) rotate(135,0,0)" are parsed because it mashes it into a matrix.

    matrix = [temp.a, temp.b, temp.c, temp.d, temp.e, temp.f];
    return matrix.join(",") === "1,0,0,1,0,0" ? _identity2DMatrix : matrix;
  } else if (matrix === _identity2DMatrix && !target.offsetParent && target !== _docElement && !cache.svg) {
    //note: if offsetParent is null, that means the element isn't in the normal document flow, like if it has display:none or one of its ancestors has display:none). Firefox returns null for getComputedStyle() if the element is in an iframe that has display:none. https://bugzilla.mozilla.org/show_bug.cgi?id=548397
    //browsers don't report transforms accurately unless the element is in the DOM and has a display value that's not "none". Firefox and Microsoft browsers have a partial bug where they'll report transforms even if display:none BUT not any percentage-based values like translate(-50%, 8px) will be reported as if it's translate(0, 8px).
    temp = style.display;
    style.display = "block";
    parent = target.parentNode;

    if (!parent || !target.offsetParent && !target.getBoundingClientRect().width) {
      // note: in 3.3.0 we switched target.offsetParent to _doc.body.contains(target) to avoid [sometimes unnecessary] MutationObserver calls but that wasn't adequate because there are edge cases where nested position: fixed elements need to get reparented to accurately sense transforms. See https://github.com/greensock/GSAP/issues/388 and https://github.com/greensock/GSAP/issues/375. Note: position: fixed elements report a null offsetParent but they could also be invisible because they're in an ancestor with display: none, so we check getBoundingClientRect(). We only want to alter the DOM if we absolutely have to because it can cause iframe content to reload, like a Vimeo video.
      addedToDOM = 1; //flag

      nextSibling = target.nextElementSibling;

      _docElement.appendChild(target); //we must add it to the DOM in order to get values properly

    }

    matrix = _getComputedTransformMatrixAsArray(target);
    temp ? style.display = temp : _removeProperty(target, "display");

    if (addedToDOM) {
      nextSibling ? parent.insertBefore(target, nextSibling) : parent ? parent.appendChild(target) : _docElement.removeChild(target);
    }
  }

  return force2D && matrix.length > 6 ? [matrix[0], matrix[1], matrix[4], matrix[5], matrix[12], matrix[13]] : matrix;
},
    _applySVGOrigin = function _applySVGOrigin(target, origin, originIsAbsolute, smooth, matrixArray, pluginToAddPropTweensTo) {
  var cache = target._gsap,
      matrix = matrixArray || _getMatrix(target, true),
      xOriginOld = cache.xOrigin || 0,
      yOriginOld = cache.yOrigin || 0,
      xOffsetOld = cache.xOffset || 0,
      yOffsetOld = cache.yOffset || 0,
      a = matrix[0],
      b = matrix[1],
      c = matrix[2],
      d = matrix[3],
      tx = matrix[4],
      ty = matrix[5],
      originSplit = origin.split(" "),
      xOrigin = parseFloat(originSplit[0]) || 0,
      yOrigin = parseFloat(originSplit[1]) || 0,
      bounds,
      determinant,
      x,
      y;

  if (!originIsAbsolute) {
    bounds = _getBBox(target);
    xOrigin = bounds.x + (~originSplit[0].indexOf("%") ? xOrigin / 100 * bounds.width : xOrigin);
    yOrigin = bounds.y + (~(originSplit[1] || originSplit[0]).indexOf("%") ? yOrigin / 100 * bounds.height : yOrigin); // if (!("xOrigin" in cache) && (xOrigin || yOrigin)) { // added in 3.12.3, reverted in 3.12.4; requires more exploration
    // 	xOrigin -= bounds.x;
    // 	yOrigin -= bounds.y;
    // }
  } else if (matrix !== _identity2DMatrix && (determinant = a * d - b * c)) {
    //if it's zero (like if scaleX and scaleY are zero), skip it to avoid errors with dividing by zero.
    x = xOrigin * (d / determinant) + yOrigin * (-c / determinant) + (c * ty - d * tx) / determinant;
    y = xOrigin * (-b / determinant) + yOrigin * (a / determinant) - (a * ty - b * tx) / determinant;
    xOrigin = x;
    yOrigin = y; // theory: we only had to do this for smoothing and it assumes that the previous one was not originIsAbsolute.
  }

  if (smooth || smooth !== false && cache.smooth) {
    tx = xOrigin - xOriginOld;
    ty = yOrigin - yOriginOld;
    cache.xOffset = xOffsetOld + (tx * a + ty * c) - tx;
    cache.yOffset = yOffsetOld + (tx * b + ty * d) - ty;
  } else {
    cache.xOffset = cache.yOffset = 0;
  }

  cache.xOrigin = xOrigin;
  cache.yOrigin = yOrigin;
  cache.smooth = !!smooth;
  cache.origin = origin;
  cache.originIsAbsolute = !!originIsAbsolute;
  target.style[_transformOriginProp] = "0px 0px"; //otherwise, if someone sets  an origin via CSS, it will likely interfere with the SVG transform attribute ones (because remember, we're baking the origin into the matrix() value).

  if (pluginToAddPropTweensTo) {
    _addNonTweeningPT(pluginToAddPropTweensTo, cache, "xOrigin", xOriginOld, xOrigin);

    _addNonTweeningPT(pluginToAddPropTweensTo, cache, "yOrigin", yOriginOld, yOrigin);

    _addNonTweeningPT(pluginToAddPropTweensTo, cache, "xOffset", xOffsetOld, cache.xOffset);

    _addNonTweeningPT(pluginToAddPropTweensTo, cache, "yOffset", yOffsetOld, cache.yOffset);
  }

  target.setAttribute("data-svg-origin", xOrigin + " " + yOrigin);
},
    _parseTransform = function _parseTransform(target, uncache) {
  var cache = target._gsap || new GSCache(target);

  if ("x" in cache && !uncache && !cache.uncache) {
    return cache;
  }

  var style = target.style,
      invertedScaleX = cache.scaleX < 0,
      px = "px",
      deg = "deg",
      cs = getComputedStyle(target),
      origin = _getComputedProperty(target, _transformOriginProp) || "0",
      x,
      y,
      z,
      scaleX,
      scaleY,
      rotation,
      rotationX,
      rotationY,
      skewX,
      skewY,
      perspective,
      xOrigin,
      yOrigin,
      matrix,
      angle,
      cos,
      sin,
      a,
      b,
      c,
      d,
      a12,
      a22,
      t1,
      t2,
      t3,
      a13,
      a23,
      a33,
      a42,
      a43,
      a32;
  x = y = z = rotation = rotationX = rotationY = skewX = skewY = perspective = 0;
  scaleX = scaleY = 1;
  cache.svg = !!(target.getCTM && _isSVG(target));

  if (cs.translate) {
    // accommodate independent transforms by combining them into normal ones.
    if (cs.translate !== "none" || cs.scale !== "none" || cs.rotate !== "none") {
      style[_transformProp$1] = (cs.translate !== "none" ? "translate3d(" + (cs.translate + " 0 0").split(" ").slice(0, 3).join(", ") + ") " : "") + (cs.rotate !== "none" ? "rotate(" + cs.rotate + ") " : "") + (cs.scale !== "none" ? "scale(" + cs.scale.split(" ").join(",") + ") " : "") + (cs[_transformProp$1] !== "none" ? cs[_transformProp$1] : "");
    }

    style.scale = style.rotate = style.translate = "none";
  }

  matrix = _getMatrix(target, cache.svg);

  if (cache.svg) {
    if (cache.uncache) {
      // if cache.uncache is true (and maybe if origin is 0,0), we need to set element.style.transformOrigin = (cache.xOrigin - bbox.x) + "px " + (cache.yOrigin - bbox.y) + "px". Previously we let the data-svg-origin stay instead, but when introducing revert(), it complicated things.
      t2 = target.getBBox();
      origin = cache.xOrigin - t2.x + "px " + (cache.yOrigin - t2.y) + "px";
      t1 = "";
    } else {
      t1 = !uncache && target.getAttribute("data-svg-origin"); //  Remember, to work around browser inconsistencies we always force SVG elements' transformOrigin to 0,0 and offset the translation accordingly.
    }

    _applySVGOrigin(target, t1 || origin, !!t1 || cache.originIsAbsolute, cache.smooth !== false, matrix);
  }

  xOrigin = cache.xOrigin || 0;
  yOrigin = cache.yOrigin || 0;

  if (matrix !== _identity2DMatrix) {
    a = matrix[0]; //a11

    b = matrix[1]; //a21

    c = matrix[2]; //a31

    d = matrix[3]; //a41

    x = a12 = matrix[4];
    y = a22 = matrix[5]; //2D matrix

    if (matrix.length === 6) {
      scaleX = Math.sqrt(a * a + b * b);
      scaleY = Math.sqrt(d * d + c * c);
      rotation = a || b ? _atan2(b, a) * _RAD2DEG : 0; //note: if scaleX is 0, we cannot accurately measure rotation. Same for skewX with a scaleY of 0. Therefore, we default to the previously recorded value (or zero if that doesn't exist).

      skewX = c || d ? _atan2(c, d) * _RAD2DEG + rotation : 0;
      skewX && (scaleY *= Math.abs(Math.cos(skewX * _DEG2RAD)));

      if (cache.svg) {
        x -= xOrigin - (xOrigin * a + yOrigin * c);
        y -= yOrigin - (xOrigin * b + yOrigin * d);
      } //3D matrix

    } else {
      a32 = matrix[6];
      a42 = matrix[7];
      a13 = matrix[8];
      a23 = matrix[9];
      a33 = matrix[10];
      a43 = matrix[11];
      x = matrix[12];
      y = matrix[13];
      z = matrix[14];
      angle = _atan2(a32, a33);
      rotationX = angle * _RAD2DEG; //rotationX

      if (angle) {
        cos = Math.cos(-angle);
        sin = Math.sin(-angle);
        t1 = a12 * cos + a13 * sin;
        t2 = a22 * cos + a23 * sin;
        t3 = a32 * cos + a33 * sin;
        a13 = a12 * -sin + a13 * cos;
        a23 = a22 * -sin + a23 * cos;
        a33 = a32 * -sin + a33 * cos;
        a43 = a42 * -sin + a43 * cos;
        a12 = t1;
        a22 = t2;
        a32 = t3;
      } //rotationY


      angle = _atan2(-c, a33);
      rotationY = angle * _RAD2DEG;

      if (angle) {
        cos = Math.cos(-angle);
        sin = Math.sin(-angle);
        t1 = a * cos - a13 * sin;
        t2 = b * cos - a23 * sin;
        t3 = c * cos - a33 * sin;
        a43 = d * sin + a43 * cos;
        a = t1;
        b = t2;
        c = t3;
      } //rotationZ


      angle = _atan2(b, a);
      rotation = angle * _RAD2DEG;

      if (angle) {
        cos = Math.cos(angle);
        sin = Math.sin(angle);
        t1 = a * cos + b * sin;
        t2 = a12 * cos + a22 * sin;
        b = b * cos - a * sin;
        a22 = a22 * cos - a12 * sin;
        a = t1;
        a12 = t2;
      }

      if (rotationX && Math.abs(rotationX) + Math.abs(rotation) > 359.9) {
        //when rotationY is set, it will often be parsed as 180 degrees different than it should be, and rotationX and rotation both being 180 (it looks the same), so we adjust for that here.
        rotationX = rotation = 0;
        rotationY = 180 - rotationY;
      }

      scaleX = _round$1(Math.sqrt(a * a + b * b + c * c));
      scaleY = _round$1(Math.sqrt(a22 * a22 + a32 * a32));
      angle = _atan2(a12, a22);
      skewX = Math.abs(angle) > 0.0002 ? angle * _RAD2DEG : 0;
      perspective = a43 ? 1 / (a43 < 0 ? -a43 : a43) : 0;
    }

    if (cache.svg) {
      //sense if there are CSS transforms applied on an SVG element in which case we must overwrite them when rendering. The transform attribute is more reliable cross-browser, but we can't just remove the CSS ones because they may be applied in a CSS rule somewhere (not just inline).
      t1 = target.getAttribute("transform");
      cache.forceCSS = target.setAttribute("transform", "") || !_isNullTransform(_getComputedProperty(target, _transformProp$1));
      t1 && target.setAttribute("transform", t1);
    }
  }

  if (Math.abs(skewX) > 90 && Math.abs(skewX) < 270) {
    if (invertedScaleX) {
      scaleX *= -1;
      skewX += rotation <= 0 ? 180 : -180;
      rotation += rotation <= 0 ? 180 : -180;
    } else {
      scaleY *= -1;
      skewX += skewX <= 0 ? 180 : -180;
    }
  }

  uncache = uncache || cache.uncache;
  cache.x = x - ((cache.xPercent = x && (!uncache && cache.xPercent || (Math.round(target.offsetWidth / 2) === Math.round(-x) ? -50 : 0))) ? target.offsetWidth * cache.xPercent / 100 : 0) + px;
  cache.y = y - ((cache.yPercent = y && (!uncache && cache.yPercent || (Math.round(target.offsetHeight / 2) === Math.round(-y) ? -50 : 0))) ? target.offsetHeight * cache.yPercent / 100 : 0) + px;
  cache.z = z + px;
  cache.scaleX = _round$1(scaleX);
  cache.scaleY = _round$1(scaleY);
  cache.rotation = _round$1(rotation) + deg;
  cache.rotationX = _round$1(rotationX) + deg;
  cache.rotationY = _round$1(rotationY) + deg;
  cache.skewX = skewX + deg;
  cache.skewY = skewY + deg;
  cache.transformPerspective = perspective + px;

  if (cache.zOrigin = parseFloat(origin.split(" ")[2]) || !uncache && cache.zOrigin || 0) {
    style[_transformOriginProp] = _firstTwoOnly(origin);
  }

  cache.xOffset = cache.yOffset = 0;
  cache.force3D = _config.force3D;
  cache.renderTransform = cache.svg ? _renderSVGTransforms : _supports3D ? _renderCSSTransforms : _renderNon3DTransforms;
  cache.uncache = 0;
  return cache;
},
    _firstTwoOnly = function _firstTwoOnly(value) {
  return (value = value.split(" "))[0] + " " + value[1];
},
    //for handling transformOrigin values, stripping out the 3rd dimension
_addPxTranslate = function _addPxTranslate(target, start, value) {
  var unit = getUnit(start);
  return _round$1(parseFloat(start) + parseFloat(_convertToUnit(target, "x", value + "px", unit))) + unit;
},
    _renderNon3DTransforms = function _renderNon3DTransforms(ratio, cache) {
  cache.z = "0px";
  cache.rotationY = cache.rotationX = "0deg";
  cache.force3D = 0;

  _renderCSSTransforms(ratio, cache);
},
    _zeroDeg = "0deg",
    _zeroPx = "0px",
    _endParenthesis = ") ",
    _renderCSSTransforms = function _renderCSSTransforms(ratio, cache) {
  var _ref = cache || this,
      xPercent = _ref.xPercent,
      yPercent = _ref.yPercent,
      x = _ref.x,
      y = _ref.y,
      z = _ref.z,
      rotation = _ref.rotation,
      rotationY = _ref.rotationY,
      rotationX = _ref.rotationX,
      skewX = _ref.skewX,
      skewY = _ref.skewY,
      scaleX = _ref.scaleX,
      scaleY = _ref.scaleY,
      transformPerspective = _ref.transformPerspective,
      force3D = _ref.force3D,
      target = _ref.target,
      zOrigin = _ref.zOrigin,
      transforms = "",
      use3D = force3D === "auto" && ratio && ratio !== 1 || force3D === true; // Safari has a bug that causes it not to render 3D transform-origin values properly, so we force the z origin to 0, record it in the cache, and then do the math here to offset the translate values accordingly (basically do the 3D transform-origin part manually)


  if (zOrigin && (rotationX !== _zeroDeg || rotationY !== _zeroDeg)) {
    var angle = parseFloat(rotationY) * _DEG2RAD,
        a13 = Math.sin(angle),
        a33 = Math.cos(angle),
        cos;

    angle = parseFloat(rotationX) * _DEG2RAD;
    cos = Math.cos(angle);
    x = _addPxTranslate(target, x, a13 * cos * -zOrigin);
    y = _addPxTranslate(target, y, -Math.sin(angle) * -zOrigin);
    z = _addPxTranslate(target, z, a33 * cos * -zOrigin + zOrigin);
  }

  if (transformPerspective !== _zeroPx) {
    transforms += "perspective(" + transformPerspective + _endParenthesis;
  }

  if (xPercent || yPercent) {
    transforms += "translate(" + xPercent + "%, " + yPercent + "%) ";
  }

  if (use3D || x !== _zeroPx || y !== _zeroPx || z !== _zeroPx) {
    transforms += z !== _zeroPx || use3D ? "translate3d(" + x + ", " + y + ", " + z + ") " : "translate(" + x + ", " + y + _endParenthesis;
  }

  if (rotation !== _zeroDeg) {
    transforms += "rotate(" + rotation + _endParenthesis;
  }

  if (rotationY !== _zeroDeg) {
    transforms += "rotateY(" + rotationY + _endParenthesis;
  }

  if (rotationX !== _zeroDeg) {
    transforms += "rotateX(" + rotationX + _endParenthesis;
  }

  if (skewX !== _zeroDeg || skewY !== _zeroDeg) {
    transforms += "skew(" + skewX + ", " + skewY + _endParenthesis;
  }

  if (scaleX !== 1 || scaleY !== 1) {
    transforms += "scale(" + scaleX + ", " + scaleY + _endParenthesis;
  }

  target.style[_transformProp$1] = transforms || "translate(0, 0)";
},
    _renderSVGTransforms = function _renderSVGTransforms(ratio, cache) {
  var _ref2 = cache || this,
      xPercent = _ref2.xPercent,
      yPercent = _ref2.yPercent,
      x = _ref2.x,
      y = _ref2.y,
      rotation = _ref2.rotation,
      skewX = _ref2.skewX,
      skewY = _ref2.skewY,
      scaleX = _ref2.scaleX,
      scaleY = _ref2.scaleY,
      target = _ref2.target,
      xOrigin = _ref2.xOrigin,
      yOrigin = _ref2.yOrigin,
      xOffset = _ref2.xOffset,
      yOffset = _ref2.yOffset,
      forceCSS = _ref2.forceCSS,
      tx = parseFloat(x),
      ty = parseFloat(y),
      a11,
      a21,
      a12,
      a22,
      temp;

  rotation = parseFloat(rotation);
  skewX = parseFloat(skewX);
  skewY = parseFloat(skewY);

  if (skewY) {
    //for performance reasons, we combine all skewing into the skewX and rotation values. Remember, a skewY of 10 degrees looks the same as a rotation of 10 degrees plus a skewX of 10 degrees.
    skewY = parseFloat(skewY);
    skewX += skewY;
    rotation += skewY;
  }

  if (rotation || skewX) {
    rotation *= _DEG2RAD;
    skewX *= _DEG2RAD;
    a11 = Math.cos(rotation) * scaleX;
    a21 = Math.sin(rotation) * scaleX;
    a12 = Math.sin(rotation - skewX) * -scaleY;
    a22 = Math.cos(rotation - skewX) * scaleY;

    if (skewX) {
      skewY *= _DEG2RAD;
      temp = Math.tan(skewX - skewY);
      temp = Math.sqrt(1 + temp * temp);
      a12 *= temp;
      a22 *= temp;

      if (skewY) {
        temp = Math.tan(skewY);
        temp = Math.sqrt(1 + temp * temp);
        a11 *= temp;
        a21 *= temp;
      }
    }

    a11 = _round$1(a11);
    a21 = _round$1(a21);
    a12 = _round$1(a12);
    a22 = _round$1(a22);
  } else {
    a11 = scaleX;
    a22 = scaleY;
    a21 = a12 = 0;
  }

  if (tx && !~(x + "").indexOf("px") || ty && !~(y + "").indexOf("px")) {
    tx = _convertToUnit(target, "x", x, "px");
    ty = _convertToUnit(target, "y", y, "px");
  }

  if (xOrigin || yOrigin || xOffset || yOffset) {
    tx = _round$1(tx + xOrigin - (xOrigin * a11 + yOrigin * a12) + xOffset);
    ty = _round$1(ty + yOrigin - (xOrigin * a21 + yOrigin * a22) + yOffset);
  }

  if (xPercent || yPercent) {
    //The SVG spec doesn't support percentage-based translation in the "transform" attribute, so we merge it into the translation to simulate it.
    temp = target.getBBox();
    tx = _round$1(tx + xPercent / 100 * temp.width);
    ty = _round$1(ty + yPercent / 100 * temp.height);
  }

  temp = "matrix(" + a11 + "," + a21 + "," + a12 + "," + a22 + "," + tx + "," + ty + ")";
  target.setAttribute("transform", temp);
  forceCSS && (target.style[_transformProp$1] = temp); //some browsers prioritize CSS transforms over the transform attribute. When we sense that the user has CSS transforms applied, we must overwrite them this way (otherwise some browser simply won't render the transform attribute changes!)
},
    _addRotationalPropTween = function _addRotationalPropTween(plugin, target, property, startNum, endValue) {
  var cap = 360,
      isString = _isString$1(endValue),
      endNum = parseFloat(endValue) * (isString && ~endValue.indexOf("rad") ? _RAD2DEG : 1),
      change = endNum - startNum,
      finalValue = startNum + change + "deg",
      direction,
      pt;

  if (isString) {
    direction = endValue.split("_")[1];

    if (direction === "short") {
      change %= cap;

      if (change !== change % (cap / 2)) {
        change += change < 0 ? cap : -cap;
      }
    }

    if (direction === "cw" && change < 0) {
      change = (change + cap * _bigNum) % cap - ~~(change / cap) * cap;
    } else if (direction === "ccw" && change > 0) {
      change = (change - cap * _bigNum) % cap - ~~(change / cap) * cap;
    }
  }

  plugin._pt = pt = new PropTween(plugin._pt, target, property, startNum, change, _renderPropWithEnd);
  pt.e = finalValue;
  pt.u = "deg";

  plugin._props.push(property);

  return pt;
},
    _assign = function _assign(target, source) {
  // Internet Explorer doesn't have Object.assign(), so we recreate it here.
  for (var p in source) {
    target[p] = source[p];
  }

  return target;
},
    _addRawTransformPTs = function _addRawTransformPTs(plugin, transforms, target) {
  //for handling cases where someone passes in a whole transform string, like transform: "scale(2, 3) rotate(20deg) translateY(30em)"
  var startCache = _assign({}, target._gsap),
      exclude = "perspective,force3D,transformOrigin,svgOrigin",
      style = target.style,
      endCache,
      p,
      startValue,
      endValue,
      startNum,
      endNum,
      startUnit,
      endUnit;

  if (startCache.svg) {
    startValue = target.getAttribute("transform");
    target.setAttribute("transform", "");
    style[_transformProp$1] = transforms;
    endCache = _parseTransform(target, 1);

    _removeProperty(target, _transformProp$1);

    target.setAttribute("transform", startValue);
  } else {
    startValue = getComputedStyle(target)[_transformProp$1];
    style[_transformProp$1] = transforms;
    endCache = _parseTransform(target, 1);
    style[_transformProp$1] = startValue;
  }

  for (p in _transformProps) {
    startValue = startCache[p];
    endValue = endCache[p];

    if (startValue !== endValue && exclude.indexOf(p) < 0) {
      //tweening to no perspective gives very unintuitive results - just keep the same perspective in that case.
      startUnit = getUnit(startValue);
      endUnit = getUnit(endValue);
      startNum = startUnit !== endUnit ? _convertToUnit(target, p, startValue, endUnit) : parseFloat(startValue);
      endNum = parseFloat(endValue);
      plugin._pt = new PropTween(plugin._pt, endCache, p, startNum, endNum - startNum, _renderCSSProp);
      plugin._pt.u = endUnit || 0;

      plugin._props.push(p);
    }
  }

  _assign(endCache, startCache);
}; // handle splitting apart padding, margin, borderWidth, and borderRadius into their 4 components. Firefox, for example, won't report borderRadius correctly - it will only do borderTopLeftRadius and the other corners. We also want to handle paddingTop, marginLeft, borderRightWidth, etc.


_forEachName("padding,margin,Width,Radius", function (name, index) {
  var t = "Top",
      r = "Right",
      b = "Bottom",
      l = "Left",
      props = (index < 3 ? [t, r, b, l] : [t + l, t + r, b + r, b + l]).map(function (side) {
    return index < 2 ? name + side : "border" + side + name;
  });

  _specialProps[index > 1 ? "border" + name : name] = function (plugin, target, property, endValue, tween) {
    var a, vars;

    if (arguments.length < 4) {
      // getter, passed target, property, and unit (from _get())
      a = props.map(function (prop) {
        return _get(plugin, prop, property);
      });
      vars = a.join(" ");
      return vars.split(a[0]).length === 5 ? a[0] : vars;
    }

    a = (endValue + "").split(" ");
    vars = {};
    props.forEach(function (prop, i) {
      return vars[prop] = a[i] = a[i] || a[(i - 1) / 2 | 0];
    });
    plugin.init(target, vars, tween);
  };
});

var CSSPlugin = {
  name: "css",
  register: _initCore$1,
  targetTest: function targetTest(target) {
    return target.style && target.nodeType;
  },
  init: function init(target, vars, tween, index, targets) {
    var props = this._props,
        style = target.style,
        startAt = tween.vars.startAt,
        startValue,
        endValue,
        endNum,
        startNum,
        type,
        specialProp,
        p,
        startUnit,
        endUnit,
        relative,
        isTransformRelated,
        transformPropTween,
        cache,
        smooth,
        hasPriority,
        inlineProps;
    _pluginInitted || _initCore$1(); // we may call init() multiple times on the same plugin instance, like when adding special properties, so make sure we don't overwrite the revert data or inlineProps

    this.styles = this.styles || _getStyleSaver(target);
    inlineProps = this.styles.props;
    this.tween = tween;

    for (p in vars) {
      if (p === "autoRound") {
        continue;
      }

      endValue = vars[p];

      if (_plugins[p] && _checkPlugin(p, vars, tween, index, target, targets)) {
        // plugins
        continue;
      }

      type = typeof endValue;
      specialProp = _specialProps[p];

      if (type === "function") {
        endValue = endValue.call(tween, index, target, targets);
        type = typeof endValue;
      }

      if (type === "string" && ~endValue.indexOf("random(")) {
        endValue = _replaceRandom(endValue);
      }

      if (specialProp) {
        specialProp(this, target, p, endValue, tween) && (hasPriority = 1);
      } else if (p.substr(0, 2) === "--") {
        //CSS variable
        startValue = (getComputedStyle(target).getPropertyValue(p) + "").trim();
        endValue += "";
        _colorExp.lastIndex = 0;

        if (!_colorExp.test(startValue)) {
          // colors don't have units
          startUnit = getUnit(startValue);
          endUnit = getUnit(endValue);
        }

        endUnit ? startUnit !== endUnit && (startValue = _convertToUnit(target, p, startValue, endUnit) + endUnit) : startUnit && (endValue += startUnit);
        this.add(style, "setProperty", startValue, endValue, index, targets, 0, 0, p);
        props.push(p);
        inlineProps.push(p, 0, style[p]);
      } else if (type !== "undefined") {
        if (startAt && p in startAt) {
          // in case someone hard-codes a complex value as the start, like top: "calc(2vh / 2)". Without this, it'd use the computed value (always in px)
          startValue = typeof startAt[p] === "function" ? startAt[p].call(tween, index, target, targets) : startAt[p];
          _isString$1(startValue) && ~startValue.indexOf("random(") && (startValue = _replaceRandom(startValue));
          getUnit(startValue + "") || startValue === "auto" || (startValue += _config.units[p] || getUnit(_get(target, p)) || ""); // for cases when someone passes in a unitless value like {x: 100}; if we try setting translate(100, 0px) it won't work.

          (startValue + "").charAt(1) === "=" && (startValue = _get(target, p)); // can't work with relative values
        } else {
          startValue = _get(target, p);
        }

        startNum = parseFloat(startValue);
        relative = type === "string" && endValue.charAt(1) === "=" && endValue.substr(0, 2);
        relative && (endValue = endValue.substr(2));
        endNum = parseFloat(endValue);

        if (p in _propertyAliases) {
          if (p === "autoAlpha") {
            //special case where we control the visibility along with opacity. We still allow the opacity value to pass through and get tweened.
            if (startNum === 1 && _get(target, "visibility") === "hidden" && endNum) {
              //if visibility is initially set to "hidden", we should interpret that as intent to make opacity 0 (a convenience)
              startNum = 0;
            }

            inlineProps.push("visibility", 0, style.visibility);

            _addNonTweeningPT(this, style, "visibility", startNum ? "inherit" : "hidden", endNum ? "inherit" : "hidden", !endNum);
          }

          if (p !== "scale" && p !== "transform") {
            p = _propertyAliases[p];
            ~p.indexOf(",") && (p = p.split(",")[0]);
          }
        }

        isTransformRelated = p in _transformProps; //--- TRANSFORM-RELATED ---

        if (isTransformRelated) {
          this.styles.save(p);

          if (type === "string" && endValue.substring(0, 6) === "var(--") {
            endValue = _getComputedProperty(target, endValue.substring(4, endValue.indexOf(")")));
            endNum = parseFloat(endValue);
          }

          if (!transformPropTween) {
            cache = target._gsap;
            cache.renderTransform && !vars.parseTransform || _parseTransform(target, vars.parseTransform); // if, for example, gsap.set(... {transform:"translateX(50vw)"}), the _get() call doesn't parse the transform, thus cache.renderTransform won't be set yet so force the parsing of the transform here.

            smooth = vars.smoothOrigin !== false && cache.smooth;
            transformPropTween = this._pt = new PropTween(this._pt, style, _transformProp$1, 0, 1, cache.renderTransform, cache, 0, -1); //the first time through, create the rendering PropTween so that it runs LAST (in the linked list, we keep adding to the beginning)

            transformPropTween.dep = 1; //flag it as dependent so that if things get killed/overwritten and this is the only PropTween left, we can safely kill the whole tween.
          }

          if (p === "scale") {
            this._pt = new PropTween(this._pt, cache, "scaleY", cache.scaleY, (relative ? _parseRelative(cache.scaleY, relative + endNum) : endNum) - cache.scaleY || 0, _renderCSSProp);
            this._pt.u = 0;
            props.push("scaleY", p);
            p += "X";
          } else if (p === "transformOrigin") {
            inlineProps.push(_transformOriginProp, 0, style[_transformOriginProp]);
            endValue = _convertKeywordsToPercentages(endValue); //in case something like "left top" or "bottom right" is passed in. Convert to percentages.

            if (cache.svg) {
              _applySVGOrigin(target, endValue, 0, smooth, 0, this);
            } else {
              endUnit = parseFloat(endValue.split(" ")[2]) || 0; //handle the zOrigin separately!

              endUnit !== cache.zOrigin && _addNonTweeningPT(this, cache, "zOrigin", cache.zOrigin, endUnit);

              _addNonTweeningPT(this, style, p, _firstTwoOnly(startValue), _firstTwoOnly(endValue));
            }

            continue;
          } else if (p === "svgOrigin") {
            _applySVGOrigin(target, endValue, 1, smooth, 0, this);

            continue;
          } else if (p in _rotationalProperties) {
            _addRotationalPropTween(this, cache, p, startNum, relative ? _parseRelative(startNum, relative + endValue) : endValue);

            continue;
          } else if (p === "smoothOrigin") {
            _addNonTweeningPT(this, cache, "smooth", cache.smooth, endValue);

            continue;
          } else if (p === "force3D") {
            cache[p] = endValue;
            continue;
          } else if (p === "transform") {
            _addRawTransformPTs(this, endValue, target);

            continue;
          }
        } else if (!(p in style)) {
          p = _checkPropPrefix(p) || p;
        }

        if (isTransformRelated || (endNum || endNum === 0) && (startNum || startNum === 0) && !_complexExp.test(endValue) && p in style) {
          startUnit = (startValue + "").substr((startNum + "").length);
          endNum || (endNum = 0); // protect against NaN

          endUnit = getUnit(endValue) || (p in _config.units ? _config.units[p] : startUnit);
          startUnit !== endUnit && (startNum = _convertToUnit(target, p, startValue, endUnit));
          this._pt = new PropTween(this._pt, isTransformRelated ? cache : style, p, startNum, (relative ? _parseRelative(startNum, relative + endNum) : endNum) - startNum, !isTransformRelated && (endUnit === "px" || p === "zIndex") && vars.autoRound !== false ? _renderRoundedCSSProp : _renderCSSProp);
          this._pt.u = endUnit || 0;

          if (startUnit !== endUnit && endUnit !== "%") {
            //when the tween goes all the way back to the beginning, we need to revert it to the OLD/ORIGINAL value (with those units). We record that as a "b" (beginning) property and point to a render method that handles that. (performance optimization)
            this._pt.b = startValue;
            this._pt.r = _renderCSSPropWithBeginning;
          }
        } else if (!(p in style)) {
          if (p in target) {
            //maybe it's not a style - it could be a property added directly to an element in which case we'll try to animate that.
            this.add(target, p, startValue || target[p], relative ? relative + endValue : endValue, index, targets);
          } else if (p !== "parseTransform") {
            _missingPlugin(p, endValue);

            continue;
          }
        } else {
          _tweenComplexCSSString.call(this, target, p, startValue, relative ? relative + endValue : endValue);
        }

        isTransformRelated || (p in style ? inlineProps.push(p, 0, style[p]) : typeof target[p] === "function" ? inlineProps.push(p, 2, target[p]()) : inlineProps.push(p, 1, startValue || target[p]));
        props.push(p);
      }
    }

    hasPriority && _sortPropTweensByPriority(this);
  },
  render: function render(ratio, data) {
    if (data.tween._time || !_reverting()) {
      var pt = data._pt;

      while (pt) {
        pt.r(ratio, pt.d);
        pt = pt._next;
      }
    } else {
      data.styles.revert();
    }
  },
  get: _get,
  aliases: _propertyAliases,
  getSetter: function getSetter(target, property, plugin) {
    //returns a setter function that accepts target, property, value and applies it accordingly. Remember, properties like "x" aren't as simple as target.style.property = value because they've got to be applied to a proxy object and then merged into a transform string in a renderer.
    var p = _propertyAliases[property];
    p && p.indexOf(",") < 0 && (property = p);
    return property in _transformProps && property !== _transformOriginProp && (target._gsap.x || _get(target, "x")) ? plugin && _recentSetterPlugin === plugin ? property === "scale" ? _setterScale : _setterTransform : (_recentSetterPlugin = plugin || {}) && (property === "scale" ? _setterScaleWithRender : _setterTransformWithRender) : target.style && !_isUndefined(target.style[property]) ? _setterCSSStyle : ~property.indexOf("-") ? _setterCSSProp : _getSetter(target, property);
  },
  core: {
    _removeProperty: _removeProperty,
    _getMatrix: _getMatrix
  }
};
gsap$2.utils.checkPrefix = _checkPropPrefix;
gsap$2.core.getStyleSaver = _getStyleSaver;

(function (positionAndScale, rotation, others, aliases) {
  var all = _forEachName(positionAndScale + "," + rotation + "," + others, function (name) {
    _transformProps[name] = 1;
  });

  _forEachName(rotation, function (name) {
    _config.units[name] = "deg";
    _rotationalProperties[name] = 1;
  });

  _propertyAliases[all[13]] = positionAndScale + "," + rotation;

  _forEachName(aliases, function (name) {
    var split = name.split(":");
    _propertyAliases[split[1]] = all[split[0]];
  });
})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent", "rotation,rotationX,rotationY,skewX,skewY", "transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective", "0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");

_forEachName("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective", function (name) {
  _config.units[name] = "px";
});

gsap$2.registerPlugin(CSSPlugin);

var gsapWithCSS = gsap$2.registerPlugin(CSSPlugin) || gsap$2;
    // to protect from tree shaking
gsapWithCSS.core.Tween;

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}
function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  return Constructor;
}
/*!
 * Observer 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/
var gsap$1, _coreInitted$1, _win$1, _doc$1, _docEl$1, _body$1, _isTouch, _pointerType, ScrollTrigger$1, _root$1, _normalizer$1, _eventTypes, _context$1, _getGSAP$1 = function _getGSAP2() {
  return gsap$1 || typeof window !== "undefined" && (gsap$1 = window.gsap) && gsap$1.registerPlugin && gsap$1;
}, _startup$1 = 1, _observers = [], _scrollers = [], _proxies = [], _getTime$1 = Date.now, _bridge = function _bridge2(name, value) {
  return value;
}, _integrate = function _integrate2() {
  var core = ScrollTrigger$1.core, data = core.bridge || {}, scrollers = core._scrollers, proxies = core._proxies;
  scrollers.push.apply(scrollers, _scrollers);
  proxies.push.apply(proxies, _proxies);
  _scrollers = scrollers;
  _proxies = proxies;
  _bridge = function _bridge3(name, value) {
    return data[name](value);
  };
}, _getProxyProp = function _getProxyProp2(element, property) {
  return ~_proxies.indexOf(element) && _proxies[_proxies.indexOf(element) + 1][property];
}, _isViewport$1 = function _isViewport2(el) {
  return !!~_root$1.indexOf(el);
}, _addListener$1 = function _addListener2(element, type, func, passive, capture) {
  return element.addEventListener(type, func, {
    passive: passive !== false,
    capture: !!capture
  });
}, _removeListener$1 = function _removeListener2(element, type, func, capture) {
  return element.removeEventListener(type, func, !!capture);
}, _scrollLeft = "scrollLeft", _scrollTop = "scrollTop", _onScroll$1 = function _onScroll2() {
  return _normalizer$1 && _normalizer$1.isPressed || _scrollers.cache++;
}, _scrollCacheFunc = function _scrollCacheFunc2(f, doNotCache) {
  var cachingFunc = function cachingFunc2(value) {
    if (value || value === 0) {
      _startup$1 && (_win$1.history.scrollRestoration = "manual");
      var isNormalizing = _normalizer$1 && _normalizer$1.isPressed;
      value = cachingFunc2.v = Math.round(value) || (_normalizer$1 && _normalizer$1.iOS ? 1 : 0);
      f(value);
      cachingFunc2.cacheID = _scrollers.cache;
      isNormalizing && _bridge("ss", value);
    } else if (doNotCache || _scrollers.cache !== cachingFunc2.cacheID || _bridge("ref")) {
      cachingFunc2.cacheID = _scrollers.cache;
      cachingFunc2.v = f();
    }
    return cachingFunc2.v + cachingFunc2.offset;
  };
  cachingFunc.offset = 0;
  return f && cachingFunc;
}, _horizontal = {
  s: _scrollLeft,
  p: "left",
  p2: "Left",
  os: "right",
  os2: "Right",
  d: "width",
  d2: "Width",
  a: "x",
  sc: _scrollCacheFunc(function(value) {
    return arguments.length ? _win$1.scrollTo(value, _vertical.sc()) : _win$1.pageXOffset || _doc$1[_scrollLeft] || _docEl$1[_scrollLeft] || _body$1[_scrollLeft] || 0;
  })
}, _vertical = {
  s: _scrollTop,
  p: "top",
  p2: "Top",
  os: "bottom",
  os2: "Bottom",
  d: "height",
  d2: "Height",
  a: "y",
  op: _horizontal,
  sc: _scrollCacheFunc(function(value) {
    return arguments.length ? _win$1.scrollTo(_horizontal.sc(), value) : _win$1.pageYOffset || _doc$1[_scrollTop] || _docEl$1[_scrollTop] || _body$1[_scrollTop] || 0;
  })
}, _getTarget = function _getTarget2(t, self) {
  return (self && self._ctx && self._ctx.selector || gsap$1.utils.toArray)(t)[0] || (typeof t === "string" && gsap$1.config().nullTargetWarn !== false ? console.warn("Element not found:", t) : null);
}, _isWithin = function _isWithin2(element, list) {
  var i = list.length;
  while (i--) {
    if (list[i] === element || list[i].contains(element)) {
      return true;
    }
  }
  return false;
}, _getScrollFunc = function _getScrollFunc2(element, _ref) {
  var s = _ref.s, sc = _ref.sc;
  _isViewport$1(element) && (element = _doc$1.scrollingElement || _docEl$1);
  var i = _scrollers.indexOf(element), offset = sc === _vertical.sc ? 1 : 2;
  !~i && (i = _scrollers.push(element) - 1);
  _scrollers[i + offset] || _addListener$1(element, "scroll", _onScroll$1);
  var prev = _scrollers[i + offset], func = prev || (_scrollers[i + offset] = _scrollCacheFunc(_getProxyProp(element, s), true) || (_isViewport$1(element) ? sc : _scrollCacheFunc(function(value) {
    return arguments.length ? element[s] = value : element[s];
  })));
  func.target = element;
  prev || (func.smooth = gsap$1.getProperty(element, "scrollBehavior") === "smooth");
  return func;
}, _getVelocityProp = function _getVelocityProp2(value, minTimeRefresh, useDelta) {
  var v1 = value, v2 = value, t1 = _getTime$1(), t2 = t1, min = minTimeRefresh || 50, dropToZeroTime = Math.max(500, min * 3), update = function update2(value2, force) {
    var t = _getTime$1();
    if (force || t - t1 > min) {
      v2 = v1;
      v1 = value2;
      t2 = t1;
      t1 = t;
    } else if (useDelta) {
      v1 += value2;
    } else {
      v1 = v2 + (value2 - v2) / (t - t2) * (t1 - t2);
    }
  }, reset = function reset2() {
    v2 = v1 = useDelta ? 0 : v1;
    t2 = t1 = 0;
  }, getVelocity = function getVelocity2(latestValue) {
    var tOld = t2, vOld = v2, t = _getTime$1();
    (latestValue || latestValue === 0) && latestValue !== v1 && update(latestValue);
    return t1 === t2 || t - t2 > dropToZeroTime ? 0 : (v1 + (useDelta ? vOld : -vOld)) / ((useDelta ? t : t1) - tOld) * 1e3;
  };
  return {
    update,
    reset,
    getVelocity
  };
}, _getEvent = function _getEvent2(e, preventDefault) {
  preventDefault && !e._gsapAllow && e.preventDefault();
  return e.changedTouches ? e.changedTouches[0] : e;
}, _getAbsoluteMax = function _getAbsoluteMax2(a) {
  var max = Math.max.apply(Math, a), min = Math.min.apply(Math, a);
  return Math.abs(max) >= Math.abs(min) ? max : min;
}, _setScrollTrigger = function _setScrollTrigger2() {
  ScrollTrigger$1 = gsap$1.core.globals().ScrollTrigger;
  ScrollTrigger$1 && ScrollTrigger$1.core && _integrate();
}, _initCore = function _initCore2(core) {
  gsap$1 = core || _getGSAP$1();
  if (!_coreInitted$1 && gsap$1 && typeof document !== "undefined" && document.body) {
    _win$1 = window;
    _doc$1 = document;
    _docEl$1 = _doc$1.documentElement;
    _body$1 = _doc$1.body;
    _root$1 = [_win$1, _doc$1, _docEl$1, _body$1];
    gsap$1.utils.clamp;
    _context$1 = gsap$1.core.context || function() {
    };
    _pointerType = "onpointerenter" in _body$1 ? "pointer" : "mouse";
    _isTouch = Observer.isTouch = _win$1.matchMedia && _win$1.matchMedia("(hover: none), (pointer: coarse)").matches ? 1 : "ontouchstart" in _win$1 || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0 ? 2 : 0;
    _eventTypes = Observer.eventTypes = ("ontouchstart" in _docEl$1 ? "touchstart,touchmove,touchcancel,touchend" : !("onpointerdown" in _docEl$1) ? "mousedown,mousemove,mouseup,mouseup" : "pointerdown,pointermove,pointercancel,pointerup").split(",");
    setTimeout(function() {
      return _startup$1 = 0;
    }, 500);
    _setScrollTrigger();
    _coreInitted$1 = 1;
  }
  return _coreInitted$1;
};
_horizontal.op = _vertical;
_scrollers.cache = 0;
var Observer = /* @__PURE__ */ function() {
  function Observer2(vars) {
    this.init(vars);
  }
  var _proto = Observer2.prototype;
  _proto.init = function init(vars) {
    _coreInitted$1 || _initCore(gsap$1) || console.warn("Please gsap.registerPlugin(Observer)");
    ScrollTrigger$1 || _setScrollTrigger();
    var tolerance = vars.tolerance, dragMinimum = vars.dragMinimum, type = vars.type, target = vars.target, lineHeight = vars.lineHeight, debounce = vars.debounce, preventDefault = vars.preventDefault, onStop = vars.onStop, onStopDelay = vars.onStopDelay, ignore = vars.ignore, wheelSpeed = vars.wheelSpeed, event = vars.event, onDragStart = vars.onDragStart, onDragEnd = vars.onDragEnd, onDrag = vars.onDrag, onPress = vars.onPress, onRelease = vars.onRelease, onRight = vars.onRight, onLeft = vars.onLeft, onUp = vars.onUp, onDown = vars.onDown, onChangeX = vars.onChangeX, onChangeY = vars.onChangeY, onChange = vars.onChange, onToggleX = vars.onToggleX, onToggleY = vars.onToggleY, onHover = vars.onHover, onHoverEnd = vars.onHoverEnd, onMove = vars.onMove, ignoreCheck = vars.ignoreCheck, isNormalizer = vars.isNormalizer, onGestureStart = vars.onGestureStart, onGestureEnd = vars.onGestureEnd, onWheel = vars.onWheel, onEnable = vars.onEnable, onDisable = vars.onDisable, onClick = vars.onClick, scrollSpeed = vars.scrollSpeed, capture = vars.capture, allowClicks = vars.allowClicks, lockAxis = vars.lockAxis, onLockAxis = vars.onLockAxis;
    this.target = target = _getTarget(target) || _docEl$1;
    this.vars = vars;
    ignore && (ignore = gsap$1.utils.toArray(ignore));
    tolerance = tolerance || 1e-9;
    dragMinimum = dragMinimum || 0;
    wheelSpeed = wheelSpeed || 1;
    scrollSpeed = scrollSpeed || 1;
    type = type || "wheel,touch,pointer";
    debounce = debounce !== false;
    lineHeight || (lineHeight = parseFloat(_win$1.getComputedStyle(_body$1).lineHeight) || 22);
    var id, onStopDelayedCall, dragged, moved, wheeled, locked, axis, self = this, prevDeltaX = 0, prevDeltaY = 0, passive = vars.passive || !preventDefault && vars.passive !== false, scrollFuncX = _getScrollFunc(target, _horizontal), scrollFuncY = _getScrollFunc(target, _vertical), scrollX = scrollFuncX(), scrollY = scrollFuncY(), limitToTouch = ~type.indexOf("touch") && !~type.indexOf("pointer") && _eventTypes[0] === "pointerdown", isViewport = _isViewport$1(target), ownerDoc = target.ownerDocument || _doc$1, deltaX = [0, 0, 0], deltaY = [0, 0, 0], onClickTime = 0, clickCapture = function clickCapture2() {
      return onClickTime = _getTime$1();
    }, _ignoreCheck = function _ignoreCheck2(e, isPointerOrTouch) {
      return (self.event = e) && ignore && _isWithin(e.target, ignore) || isPointerOrTouch && limitToTouch && e.pointerType !== "touch" || ignoreCheck && ignoreCheck(e, isPointerOrTouch);
    }, onStopFunc = function onStopFunc2() {
      self._vx.reset();
      self._vy.reset();
      onStopDelayedCall.pause();
      onStop && onStop(self);
    }, update = function update2() {
      var dx = self.deltaX = _getAbsoluteMax(deltaX), dy = self.deltaY = _getAbsoluteMax(deltaY), changedX = Math.abs(dx) >= tolerance, changedY = Math.abs(dy) >= tolerance;
      onChange && (changedX || changedY) && onChange(self, dx, dy, deltaX, deltaY);
      if (changedX) {
        onRight && self.deltaX > 0 && onRight(self);
        onLeft && self.deltaX < 0 && onLeft(self);
        onChangeX && onChangeX(self);
        onToggleX && self.deltaX < 0 !== prevDeltaX < 0 && onToggleX(self);
        prevDeltaX = self.deltaX;
        deltaX[0] = deltaX[1] = deltaX[2] = 0;
      }
      if (changedY) {
        onDown && self.deltaY > 0 && onDown(self);
        onUp && self.deltaY < 0 && onUp(self);
        onChangeY && onChangeY(self);
        onToggleY && self.deltaY < 0 !== prevDeltaY < 0 && onToggleY(self);
        prevDeltaY = self.deltaY;
        deltaY[0] = deltaY[1] = deltaY[2] = 0;
      }
      if (moved || dragged) {
        onMove && onMove(self);
        if (dragged) {
          onDragStart && dragged === 1 && onDragStart(self);
          onDrag && onDrag(self);
          dragged = 0;
        }
        moved = false;
      }
      locked && !(locked = false) && onLockAxis && onLockAxis(self);
      if (wheeled) {
        onWheel(self);
        wheeled = false;
      }
      id = 0;
    }, onDelta = function onDelta2(x, y, index) {
      deltaX[index] += x;
      deltaY[index] += y;
      self._vx.update(x);
      self._vy.update(y);
      debounce ? id || (id = requestAnimationFrame(update)) : update();
    }, onTouchOrPointerDelta = function onTouchOrPointerDelta2(x, y) {
      if (lockAxis && !axis) {
        self.axis = axis = Math.abs(x) > Math.abs(y) ? "x" : "y";
        locked = true;
      }
      if (axis !== "y") {
        deltaX[2] += x;
        self._vx.update(x, true);
      }
      if (axis !== "x") {
        deltaY[2] += y;
        self._vy.update(y, true);
      }
      debounce ? id || (id = requestAnimationFrame(update)) : update();
    }, _onDrag = function _onDrag2(e) {
      if (_ignoreCheck(e, 1)) {
        return;
      }
      e = _getEvent(e, preventDefault);
      var x = e.clientX, y = e.clientY, dx = x - self.x, dy = y - self.y, isDragging = self.isDragging;
      self.x = x;
      self.y = y;
      if (isDragging || (dx || dy) && (Math.abs(self.startX - x) >= dragMinimum || Math.abs(self.startY - y) >= dragMinimum)) {
        dragged = isDragging ? 2 : 1;
        isDragging || (self.isDragging = true);
        onTouchOrPointerDelta(dx, dy);
      }
    }, _onPress = self.onPress = function(e) {
      if (_ignoreCheck(e, 1) || e && e.button) {
        return;
      }
      self.axis = axis = null;
      onStopDelayedCall.pause();
      self.isPressed = true;
      e = _getEvent(e);
      prevDeltaX = prevDeltaY = 0;
      self.startX = self.x = e.clientX;
      self.startY = self.y = e.clientY;
      self._vx.reset();
      self._vy.reset();
      _addListener$1(isNormalizer ? target : ownerDoc, _eventTypes[1], _onDrag, passive, true);
      self.deltaX = self.deltaY = 0;
      onPress && onPress(self);
    }, _onRelease = self.onRelease = function(e) {
      if (_ignoreCheck(e, 1)) {
        return;
      }
      _removeListener$1(isNormalizer ? target : ownerDoc, _eventTypes[1], _onDrag, true);
      var isTrackingDrag = !isNaN(self.y - self.startY), wasDragging = self.isDragging, isDragNotClick = wasDragging && (Math.abs(self.x - self.startX) > 3 || Math.abs(self.y - self.startY) > 3), eventData = _getEvent(e);
      if (!isDragNotClick && isTrackingDrag) {
        self._vx.reset();
        self._vy.reset();
        if (preventDefault && allowClicks) {
          gsap$1.delayedCall(0.08, function() {
            if (_getTime$1() - onClickTime > 300 && !e.defaultPrevented) {
              if (e.target.click) {
                e.target.click();
              } else if (ownerDoc.createEvent) {
                var syntheticEvent = ownerDoc.createEvent("MouseEvents");
                syntheticEvent.initMouseEvent("click", true, true, _win$1, 1, eventData.screenX, eventData.screenY, eventData.clientX, eventData.clientY, false, false, false, false, 0, null);
                e.target.dispatchEvent(syntheticEvent);
              }
            }
          });
        }
      }
      self.isDragging = self.isGesturing = self.isPressed = false;
      onStop && wasDragging && !isNormalizer && onStopDelayedCall.restart(true);
      dragged && update();
      onDragEnd && wasDragging && onDragEnd(self);
      onRelease && onRelease(self, isDragNotClick);
    }, _onGestureStart = function _onGestureStart2(e) {
      return e.touches && e.touches.length > 1 && (self.isGesturing = true) && onGestureStart(e, self.isDragging);
    }, _onGestureEnd = function _onGestureEnd2() {
      return (self.isGesturing = false) || onGestureEnd(self);
    }, onScroll = function onScroll2(e) {
      if (_ignoreCheck(e)) {
        return;
      }
      var x = scrollFuncX(), y = scrollFuncY();
      onDelta((x - scrollX) * scrollSpeed, (y - scrollY) * scrollSpeed, 1);
      scrollX = x;
      scrollY = y;
      onStop && onStopDelayedCall.restart(true);
    }, _onWheel = function _onWheel2(e) {
      if (_ignoreCheck(e)) {
        return;
      }
      e = _getEvent(e, preventDefault);
      onWheel && (wheeled = true);
      var multiplier = (e.deltaMode === 1 ? lineHeight : e.deltaMode === 2 ? _win$1.innerHeight : 1) * wheelSpeed;
      onDelta(e.deltaX * multiplier, e.deltaY * multiplier, 0);
      onStop && !isNormalizer && onStopDelayedCall.restart(true);
    }, _onMove = function _onMove2(e) {
      if (_ignoreCheck(e)) {
        return;
      }
      var x = e.clientX, y = e.clientY, dx = x - self.x, dy = y - self.y;
      self.x = x;
      self.y = y;
      moved = true;
      onStop && onStopDelayedCall.restart(true);
      (dx || dy) && onTouchOrPointerDelta(dx, dy);
    }, _onHover = function _onHover2(e) {
      self.event = e;
      onHover(self);
    }, _onHoverEnd = function _onHoverEnd2(e) {
      self.event = e;
      onHoverEnd(self);
    }, _onClick = function _onClick2(e) {
      return _ignoreCheck(e) || _getEvent(e, preventDefault) && onClick(self);
    };
    onStopDelayedCall = self._dc = gsap$1.delayedCall(onStopDelay || 0.25, onStopFunc).pause();
    self.deltaX = self.deltaY = 0;
    self._vx = _getVelocityProp(0, 50, true);
    self._vy = _getVelocityProp(0, 50, true);
    self.scrollX = scrollFuncX;
    self.scrollY = scrollFuncY;
    self.isDragging = self.isGesturing = self.isPressed = false;
    _context$1(this);
    self.enable = function(e) {
      if (!self.isEnabled) {
        _addListener$1(isViewport ? ownerDoc : target, "scroll", _onScroll$1);
        type.indexOf("scroll") >= 0 && _addListener$1(isViewport ? ownerDoc : target, "scroll", onScroll, passive, capture);
        type.indexOf("wheel") >= 0 && _addListener$1(target, "wheel", _onWheel, passive, capture);
        if (type.indexOf("touch") >= 0 && _isTouch || type.indexOf("pointer") >= 0) {
          _addListener$1(target, _eventTypes[0], _onPress, passive, capture);
          _addListener$1(ownerDoc, _eventTypes[2], _onRelease);
          _addListener$1(ownerDoc, _eventTypes[3], _onRelease);
          allowClicks && _addListener$1(target, "click", clickCapture, true, true);
          onClick && _addListener$1(target, "click", _onClick);
          onGestureStart && _addListener$1(ownerDoc, "gesturestart", _onGestureStart);
          onGestureEnd && _addListener$1(ownerDoc, "gestureend", _onGestureEnd);
          onHover && _addListener$1(target, _pointerType + "enter", _onHover);
          onHoverEnd && _addListener$1(target, _pointerType + "leave", _onHoverEnd);
          onMove && _addListener$1(target, _pointerType + "move", _onMove);
        }
        self.isEnabled = true;
        self.isDragging = self.isGesturing = self.isPressed = moved = dragged = false;
        self._vx.reset();
        self._vy.reset();
        scrollX = scrollFuncX();
        scrollY = scrollFuncY();
        e && e.type && _onPress(e);
        onEnable && onEnable(self);
      }
      return self;
    };
    self.disable = function() {
      if (self.isEnabled) {
        _observers.filter(function(o) {
          return o !== self && _isViewport$1(o.target);
        }).length || _removeListener$1(isViewport ? ownerDoc : target, "scroll", _onScroll$1);
        if (self.isPressed) {
          self._vx.reset();
          self._vy.reset();
          _removeListener$1(isNormalizer ? target : ownerDoc, _eventTypes[1], _onDrag, true);
        }
        _removeListener$1(isViewport ? ownerDoc : target, "scroll", onScroll, capture);
        _removeListener$1(target, "wheel", _onWheel, capture);
        _removeListener$1(target, _eventTypes[0], _onPress, capture);
        _removeListener$1(ownerDoc, _eventTypes[2], _onRelease);
        _removeListener$1(ownerDoc, _eventTypes[3], _onRelease);
        _removeListener$1(target, "click", clickCapture, true);
        _removeListener$1(target, "click", _onClick);
        _removeListener$1(ownerDoc, "gesturestart", _onGestureStart);
        _removeListener$1(ownerDoc, "gestureend", _onGestureEnd);
        _removeListener$1(target, _pointerType + "enter", _onHover);
        _removeListener$1(target, _pointerType + "leave", _onHoverEnd);
        _removeListener$1(target, _pointerType + "move", _onMove);
        self.isEnabled = self.isPressed = self.isDragging = false;
        onDisable && onDisable(self);
      }
    };
    self.kill = self.revert = function() {
      self.disable();
      var i = _observers.indexOf(self);
      i >= 0 && _observers.splice(i, 1);
      _normalizer$1 === self && (_normalizer$1 = 0);
    };
    _observers.push(self);
    isNormalizer && _isViewport$1(target) && (_normalizer$1 = self);
    self.enable(event);
  };
  _createClass(Observer2, [{
    key: "velocityX",
    get: function get() {
      return this._vx.getVelocity();
    }
  }, {
    key: "velocityY",
    get: function get() {
      return this._vy.getVelocity();
    }
  }]);
  return Observer2;
}();
Observer.version = "3.13.0";
Observer.create = function(vars) {
  return new Observer(vars);
};
Observer.register = _initCore;
Observer.getAll = function() {
  return _observers.slice();
};
Observer.getById = function(id) {
  return _observers.filter(function(o) {
    return o.vars.id === id;
  })[0];
};
_getGSAP$1() && gsap$1.registerPlugin(Observer);

/*!
 * ScrollTrigger 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/
var gsap, _coreInitted, _win, _doc, _docEl, _body, _root, _resizeDelay, _toArray, _clamp, _time2, _syncInterval, _refreshing, _pointerIsDown, _transformProp, _i, _prevWidth, _prevHeight, _autoRefresh, _sort, _suppressOverwrites, _ignoreResize, _normalizer, _ignoreMobileResize, _baseScreenHeight, _baseScreenWidth, _fixIOSBug, _context, _scrollRestoration, _div100vh, _100vh, _isReverted, _clampingMax, _limitCallbacks, _startup = 1, _getTime = Date.now, _time1 = _getTime(), _lastScrollTime = 0, _enabled = 0, _parseClamp = function _parseClamp2(value, type, self) {
  var clamp = _isString(value) && (value.substr(0, 6) === "clamp(" || value.indexOf("max") > -1);
  self["_" + type + "Clamp"] = clamp;
  return clamp ? value.substr(6, value.length - 7) : value;
}, _keepClamp = function _keepClamp2(value, clamp) {
  return clamp && (!_isString(value) || value.substr(0, 6) !== "clamp(") ? "clamp(" + value + ")" : value;
}, _rafBugFix = function _rafBugFix2() {
  return _enabled && requestAnimationFrame(_rafBugFix2);
}, _pointerDownHandler = function _pointerDownHandler2() {
  return _pointerIsDown = 1;
}, _pointerUpHandler = function _pointerUpHandler2() {
  return _pointerIsDown = 0;
}, _passThrough = function _passThrough2(v) {
  return v;
}, _round = function _round2(value) {
  return Math.round(value * 1e5) / 1e5 || 0;
}, _windowExists = function _windowExists2() {
  return typeof window !== "undefined";
}, _getGSAP = function _getGSAP2() {
  return gsap || _windowExists() && (gsap = window.gsap) && gsap.registerPlugin && gsap;
}, _isViewport = function _isViewport2(e) {
  return !!~_root.indexOf(e);
}, _getViewportDimension = function _getViewportDimension2(dimensionProperty) {
  return (dimensionProperty === "Height" ? _100vh : _win["inner" + dimensionProperty]) || _docEl["client" + dimensionProperty] || _body["client" + dimensionProperty];
}, _getBoundsFunc = function _getBoundsFunc2(element) {
  return _getProxyProp(element, "getBoundingClientRect") || (_isViewport(element) ? function() {
    _winOffsets.width = _win.innerWidth;
    _winOffsets.height = _100vh;
    return _winOffsets;
  } : function() {
    return _getBounds(element);
  });
}, _getSizeFunc = function _getSizeFunc2(scroller, isViewport, _ref) {
  var d = _ref.d, d2 = _ref.d2, a = _ref.a;
  return (a = _getProxyProp(scroller, "getBoundingClientRect")) ? function() {
    return a()[d];
  } : function() {
    return (isViewport ? _getViewportDimension(d2) : scroller["client" + d2]) || 0;
  };
}, _getOffsetsFunc = function _getOffsetsFunc2(element, isViewport) {
  return !isViewport || ~_proxies.indexOf(element) ? _getBoundsFunc(element) : function() {
    return _winOffsets;
  };
}, _maxScroll = function _maxScroll2(element, _ref2) {
  var s = _ref2.s, d2 = _ref2.d2, d = _ref2.d, a = _ref2.a;
  return Math.max(0, (s = "scroll" + d2) && (a = _getProxyProp(element, s)) ? a() - _getBoundsFunc(element)()[d] : _isViewport(element) ? (_docEl[s] || _body[s]) - _getViewportDimension(d2) : element[s] - element["offset" + d2]);
}, _iterateAutoRefresh = function _iterateAutoRefresh2(func, events) {
  for (var i = 0; i < _autoRefresh.length; i += 3) {
    (!events || ~events.indexOf(_autoRefresh[i + 1])) && func(_autoRefresh[i], _autoRefresh[i + 1], _autoRefresh[i + 2]);
  }
}, _isString = function _isString2(value) {
  return typeof value === "string";
}, _isFunction = function _isFunction2(value) {
  return typeof value === "function";
}, _isNumber = function _isNumber2(value) {
  return typeof value === "number";
}, _isObject = function _isObject2(value) {
  return typeof value === "object";
}, _endAnimation = function _endAnimation2(animation, reversed, pause) {
  return animation && animation.progress(reversed ? 0 : 1) && pause && animation.pause();
}, _callback = function _callback2(self, func) {
  if (self.enabled) {
    var result = self._ctx ? self._ctx.add(function() {
      return func(self);
    }) : func(self);
    result && result.totalTime && (self.callbackAnimation = result);
  }
}, _abs = Math.abs, _left = "left", _top = "top", _right = "right", _bottom = "bottom", _width = "width", _height = "height", _Right = "Right", _Left = "Left", _Top = "Top", _Bottom = "Bottom", _padding = "padding", _margin = "margin", _Width = "Width", _Height = "Height", _px = "px", _getComputedStyle = function _getComputedStyle2(element) {
  return _win.getComputedStyle(element);
}, _makePositionable = function _makePositionable2(element) {
  var position = _getComputedStyle(element).position;
  element.style.position = position === "absolute" || position === "fixed" ? position : "relative";
}, _setDefaults = function _setDefaults2(obj, defaults) {
  for (var p in defaults) {
    p in obj || (obj[p] = defaults[p]);
  }
  return obj;
}, _getBounds = function _getBounds2(element, withoutTransforms) {
  var tween = withoutTransforms && _getComputedStyle(element)[_transformProp] !== "matrix(1, 0, 0, 1, 0, 0)" && gsap.to(element, {
    x: 0,
    y: 0,
    xPercent: 0,
    yPercent: 0,
    rotation: 0,
    rotationX: 0,
    rotationY: 0,
    scale: 1,
    skewX: 0,
    skewY: 0
  }).progress(1), bounds = element.getBoundingClientRect();
  tween && tween.progress(0).kill();
  return bounds;
}, _getSize = function _getSize2(element, _ref3) {
  var d2 = _ref3.d2;
  return element["offset" + d2] || element["client" + d2] || 0;
}, _getLabelRatioArray = function _getLabelRatioArray2(timeline) {
  var a = [], labels = timeline.labels, duration = timeline.duration(), p;
  for (p in labels) {
    a.push(labels[p] / duration);
  }
  return a;
}, _getClosestLabel = function _getClosestLabel2(animation) {
  return function(value) {
    return gsap.utils.snap(_getLabelRatioArray(animation), value);
  };
}, _snapDirectional = function _snapDirectional2(snapIncrementOrArray) {
  var snap = gsap.utils.snap(snapIncrementOrArray), a = Array.isArray(snapIncrementOrArray) && snapIncrementOrArray.slice(0).sort(function(a2, b) {
    return a2 - b;
  });
  return a ? function(value, direction, threshold) {
    if (threshold === void 0) {
      threshold = 1e-3;
    }
    var i;
    if (!direction) {
      return snap(value);
    }
    if (direction > 0) {
      value -= threshold;
      for (i = 0; i < a.length; i++) {
        if (a[i] >= value) {
          return a[i];
        }
      }
      return a[i - 1];
    } else {
      i = a.length;
      value += threshold;
      while (i--) {
        if (a[i] <= value) {
          return a[i];
        }
      }
    }
    return a[0];
  } : function(value, direction, threshold) {
    if (threshold === void 0) {
      threshold = 1e-3;
    }
    var snapped = snap(value);
    return !direction || Math.abs(snapped - value) < threshold || snapped - value < 0 === direction < 0 ? snapped : snap(direction < 0 ? value - snapIncrementOrArray : value + snapIncrementOrArray);
  };
}, _getLabelAtDirection = function _getLabelAtDirection2(timeline) {
  return function(value, st) {
    return _snapDirectional(_getLabelRatioArray(timeline))(value, st.direction);
  };
}, _multiListener = function _multiListener2(func, element, types, callback) {
  return types.split(",").forEach(function(type) {
    return func(element, type, callback);
  });
}, _addListener = function _addListener2(element, type, func, nonPassive, capture) {
  return element.addEventListener(type, func, {
    passive: !nonPassive,
    capture: !!capture
  });
}, _removeListener = function _removeListener2(element, type, func, capture) {
  return element.removeEventListener(type, func, !!capture);
}, _wheelListener = function _wheelListener2(func, el, scrollFunc) {
  scrollFunc = scrollFunc && scrollFunc.wheelHandler;
  if (scrollFunc) {
    func(el, "wheel", scrollFunc);
    func(el, "touchmove", scrollFunc);
  }
}, _markerDefaults = {
  startColor: "green",
  endColor: "red",
  indent: 0,
  fontSize: "16px",
  fontWeight: "normal"
}, _defaults = {
  toggleActions: "play",
  anticipatePin: 0
}, _keywords = {
  top: 0,
  left: 0,
  center: 0.5,
  bottom: 1,
  right: 1
}, _offsetToPx = function _offsetToPx2(value, size) {
  if (_isString(value)) {
    var eqIndex = value.indexOf("="), relative = ~eqIndex ? +(value.charAt(eqIndex - 1) + 1) * parseFloat(value.substr(eqIndex + 1)) : 0;
    if (~eqIndex) {
      value.indexOf("%") > eqIndex && (relative *= size / 100);
      value = value.substr(0, eqIndex - 1);
    }
    value = relative + (value in _keywords ? _keywords[value] * size : ~value.indexOf("%") ? parseFloat(value) * size / 100 : parseFloat(value) || 0);
  }
  return value;
}, _createMarker = function _createMarker2(type, name, container, direction, _ref4, offset, matchWidthEl, containerAnimation) {
  var startColor = _ref4.startColor, endColor = _ref4.endColor, fontSize = _ref4.fontSize, indent = _ref4.indent, fontWeight = _ref4.fontWeight;
  var e = _doc.createElement("div"), useFixedPosition = _isViewport(container) || _getProxyProp(container, "pinType") === "fixed", isScroller = type.indexOf("scroller") !== -1, parent = useFixedPosition ? _body : container, isStart = type.indexOf("start") !== -1, color = isStart ? startColor : endColor, css = "border-color:" + color + ";font-size:" + fontSize + ";color:" + color + ";font-weight:" + fontWeight + ";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";
  css += "position:" + ((isScroller || containerAnimation) && useFixedPosition ? "fixed;" : "absolute;");
  (isScroller || containerAnimation || !useFixedPosition) && (css += (direction === _vertical ? _right : _bottom) + ":" + (offset + parseFloat(indent)) + "px;");
  matchWidthEl && (css += "box-sizing:border-box;text-align:left;width:" + matchWidthEl.offsetWidth + "px;");
  e._isStart = isStart;
  e.setAttribute("class", "gsap-marker-" + type + (name ? " marker-" + name : ""));
  e.style.cssText = css;
  e.innerText = name || name === 0 ? type + "-" + name : type;
  parent.children[0] ? parent.insertBefore(e, parent.children[0]) : parent.appendChild(e);
  e._offset = e["offset" + direction.op.d2];
  _positionMarker(e, 0, direction, isStart);
  return e;
}, _positionMarker = function _positionMarker2(marker, start, direction, flipped) {
  var vars = {
    display: "block"
  }, side = direction[flipped ? "os2" : "p2"], oppositeSide = direction[flipped ? "p2" : "os2"];
  marker._isFlipped = flipped;
  vars[direction.a + "Percent"] = flipped ? -100 : 0;
  vars[direction.a] = flipped ? "1px" : 0;
  vars["border" + side + _Width] = 1;
  vars["border" + oppositeSide + _Width] = 0;
  vars[direction.p] = start + "px";
  gsap.set(marker, vars);
}, _triggers = [], _ids = {}, _rafID, _sync = function _sync2() {
  return _getTime() - _lastScrollTime > 34 && (_rafID || (_rafID = requestAnimationFrame(_updateAll)));
}, _onScroll = function _onScroll2() {
  if (!_normalizer || !_normalizer.isPressed || _normalizer.startX > _body.clientWidth) {
    _scrollers.cache++;
    if (_normalizer) {
      _rafID || (_rafID = requestAnimationFrame(_updateAll));
    } else {
      _updateAll();
    }
    _lastScrollTime || _dispatch("scrollStart");
    _lastScrollTime = _getTime();
  }
}, _setBaseDimensions = function _setBaseDimensions2() {
  _baseScreenWidth = _win.innerWidth;
  _baseScreenHeight = _win.innerHeight;
}, _onResize = function _onResize2(force) {
  _scrollers.cache++;
  (force === true || !_refreshing && !_ignoreResize && !_doc.fullscreenElement && !_doc.webkitFullscreenElement && (!_ignoreMobileResize || _baseScreenWidth !== _win.innerWidth || Math.abs(_win.innerHeight - _baseScreenHeight) > _win.innerHeight * 0.25)) && _resizeDelay.restart(true);
}, _listeners = {}, _emptyArray = [], _softRefresh = function _softRefresh2() {
  return _removeListener(ScrollTrigger, "scrollEnd", _softRefresh2) || _refreshAll(true);
}, _dispatch = function _dispatch2(type) {
  return _listeners[type] && _listeners[type].map(function(f) {
    return f();
  }) || _emptyArray;
}, _savedStyles = [], _revertRecorded = function _revertRecorded2(media) {
  for (var i = 0; i < _savedStyles.length; i += 5) {
    if (!media || _savedStyles[i + 4] && _savedStyles[i + 4].query === media) {
      _savedStyles[i].style.cssText = _savedStyles[i + 1];
      _savedStyles[i].getBBox && _savedStyles[i].setAttribute("transform", _savedStyles[i + 2] || "");
      _savedStyles[i + 3].uncache = 1;
    }
  }
}, _revertAll = function _revertAll2(kill, media) {
  var trigger;
  for (_i = 0; _i < _triggers.length; _i++) {
    trigger = _triggers[_i];
    if (trigger && (!media || trigger._ctx === media)) {
      if (kill) {
        trigger.kill(1);
      } else {
        trigger.revert(true, true);
      }
    }
  }
  _isReverted = true;
  media && _revertRecorded(media);
  media || _dispatch("revert");
}, _clearScrollMemory = function _clearScrollMemory2(scrollRestoration, force) {
  _scrollers.cache++;
  (force || !_refreshingAll) && _scrollers.forEach(function(obj) {
    return _isFunction(obj) && obj.cacheID++ && (obj.rec = 0);
  });
  _isString(scrollRestoration) && (_win.history.scrollRestoration = _scrollRestoration = scrollRestoration);
}, _refreshingAll, _refreshID = 0, _queueRefreshID, _queueRefreshAll = function _queueRefreshAll2() {
  if (_queueRefreshID !== _refreshID) {
    var id = _queueRefreshID = _refreshID;
    requestAnimationFrame(function() {
      return id === _refreshID && _refreshAll(true);
    });
  }
}, _refresh100vh = function _refresh100vh2() {
  _body.appendChild(_div100vh);
  _100vh = !_normalizer && _div100vh.offsetHeight || _win.innerHeight;
  _body.removeChild(_div100vh);
}, _hideAllMarkers = function _hideAllMarkers2(hide) {
  return _toArray(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(el) {
    return el.style.display = hide ? "none" : "block";
  });
}, _refreshAll = function _refreshAll2(force, skipRevert) {
  _docEl = _doc.documentElement;
  _body = _doc.body;
  _root = [_win, _doc, _docEl, _body];
  if (_lastScrollTime && !force && !_isReverted) {
    _addListener(ScrollTrigger, "scrollEnd", _softRefresh);
    return;
  }
  _refresh100vh();
  _refreshingAll = ScrollTrigger.isRefreshing = true;
  _scrollers.forEach(function(obj) {
    return _isFunction(obj) && ++obj.cacheID && (obj.rec = obj());
  });
  var refreshInits = _dispatch("refreshInit");
  _sort && ScrollTrigger.sort();
  skipRevert || _revertAll();
  _scrollers.forEach(function(obj) {
    if (_isFunction(obj)) {
      obj.smooth && (obj.target.style.scrollBehavior = "auto");
      obj(0);
    }
  });
  _triggers.slice(0).forEach(function(t) {
    return t.refresh();
  });
  _isReverted = false;
  _triggers.forEach(function(t) {
    if (t._subPinOffset && t.pin) {
      var prop = t.vars.horizontal ? "offsetWidth" : "offsetHeight", original = t.pin[prop];
      t.revert(true, 1);
      t.adjustPinSpacing(t.pin[prop] - original);
      t.refresh();
    }
  });
  _clampingMax = 1;
  _hideAllMarkers(true);
  _triggers.forEach(function(t) {
    var max = _maxScroll(t.scroller, t._dir), endClamp = t.vars.end === "max" || t._endClamp && t.end > max, startClamp = t._startClamp && t.start >= max;
    (endClamp || startClamp) && t.setPositions(startClamp ? max - 1 : t.start, endClamp ? Math.max(startClamp ? max : t.start + 1, max) : t.end, true);
  });
  _hideAllMarkers(false);
  _clampingMax = 0;
  refreshInits.forEach(function(result) {
    return result && result.render && result.render(-1);
  });
  _scrollers.forEach(function(obj) {
    if (_isFunction(obj)) {
      obj.smooth && requestAnimationFrame(function() {
        return obj.target.style.scrollBehavior = "smooth";
      });
      obj.rec && obj(obj.rec);
    }
  });
  _clearScrollMemory(_scrollRestoration, 1);
  _resizeDelay.pause();
  _refreshID++;
  _refreshingAll = 2;
  _updateAll(2);
  _triggers.forEach(function(t) {
    return _isFunction(t.vars.onRefresh) && t.vars.onRefresh(t);
  });
  _refreshingAll = ScrollTrigger.isRefreshing = false;
  _dispatch("refresh");
}, _lastScroll = 0, _direction = 1, _primary, _updateAll = function _updateAll2(force) {
  if (force === 2 || !_refreshingAll && !_isReverted) {
    ScrollTrigger.isUpdating = true;
    _primary && _primary.update(0);
    var l = _triggers.length, time = _getTime(), recordVelocity = time - _time1 >= 50, scroll = l && _triggers[0].scroll();
    _direction = _lastScroll > scroll ? -1 : 1;
    _refreshingAll || (_lastScroll = scroll);
    if (recordVelocity) {
      if (_lastScrollTime && !_pointerIsDown && time - _lastScrollTime > 200) {
        _lastScrollTime = 0;
        _dispatch("scrollEnd");
      }
      _time2 = _time1;
      _time1 = time;
    }
    if (_direction < 0) {
      _i = l;
      while (_i-- > 0) {
        _triggers[_i] && _triggers[_i].update(0, recordVelocity);
      }
      _direction = 1;
    } else {
      for (_i = 0; _i < l; _i++) {
        _triggers[_i] && _triggers[_i].update(0, recordVelocity);
      }
    }
    ScrollTrigger.isUpdating = false;
  }
  _rafID = 0;
}, _propNamesToCopy = [_left, _top, _bottom, _right, _margin + _Bottom, _margin + _Right, _margin + _Top, _margin + _Left, "display", "flexShrink", "float", "zIndex", "gridColumnStart", "gridColumnEnd", "gridRowStart", "gridRowEnd", "gridArea", "justifySelf", "alignSelf", "placeSelf", "order"], _stateProps = _propNamesToCopy.concat([_width, _height, "boxSizing", "max" + _Width, "max" + _Height, "position", _margin, _padding, _padding + _Top, _padding + _Right, _padding + _Bottom, _padding + _Left]), _swapPinOut = function _swapPinOut2(pin, spacer, state) {
  _setState(state);
  var cache = pin._gsap;
  if (cache.spacerIsNative) {
    _setState(cache.spacerState);
  } else if (pin._gsap.swappedIn) {
    var parent = spacer.parentNode;
    if (parent) {
      parent.insertBefore(pin, spacer);
      parent.removeChild(spacer);
    }
  }
  pin._gsap.swappedIn = false;
}, _swapPinIn = function _swapPinIn2(pin, spacer, cs, spacerState) {
  if (!pin._gsap.swappedIn) {
    var i = _propNamesToCopy.length, spacerStyle = spacer.style, pinStyle = pin.style, p;
    while (i--) {
      p = _propNamesToCopy[i];
      spacerStyle[p] = cs[p];
    }
    spacerStyle.position = cs.position === "absolute" ? "absolute" : "relative";
    cs.display === "inline" && (spacerStyle.display = "inline-block");
    pinStyle[_bottom] = pinStyle[_right] = "auto";
    spacerStyle.flexBasis = cs.flexBasis || "auto";
    spacerStyle.overflow = "visible";
    spacerStyle.boxSizing = "border-box";
    spacerStyle[_width] = _getSize(pin, _horizontal) + _px;
    spacerStyle[_height] = _getSize(pin, _vertical) + _px;
    spacerStyle[_padding] = pinStyle[_margin] = pinStyle[_top] = pinStyle[_left] = "0";
    _setState(spacerState);
    pinStyle[_width] = pinStyle["max" + _Width] = cs[_width];
    pinStyle[_height] = pinStyle["max" + _Height] = cs[_height];
    pinStyle[_padding] = cs[_padding];
    if (pin.parentNode !== spacer) {
      pin.parentNode.insertBefore(spacer, pin);
      spacer.appendChild(pin);
    }
    pin._gsap.swappedIn = true;
  }
}, _capsExp = /([A-Z])/g, _setState = function _setState2(state) {
  if (state) {
    var style = state.t.style, l = state.length, i = 0, p, value;
    (state.t._gsap || gsap.core.getCache(state.t)).uncache = 1;
    for (; i < l; i += 2) {
      value = state[i + 1];
      p = state[i];
      if (value) {
        style[p] = value;
      } else if (style[p]) {
        style.removeProperty(p.replace(_capsExp, "-$1").toLowerCase());
      }
    }
  }
}, _getState = function _getState2(element) {
  var l = _stateProps.length, style = element.style, state = [], i = 0;
  for (; i < l; i++) {
    state.push(_stateProps[i], style[_stateProps[i]]);
  }
  state.t = element;
  return state;
}, _copyState = function _copyState2(state, override, omitOffsets) {
  var result = [], l = state.length, i = omitOffsets ? 8 : 0, p;
  for (; i < l; i += 2) {
    p = state[i];
    result.push(p, p in override ? override[p] : state[i + 1]);
  }
  result.t = state.t;
  return result;
}, _winOffsets = {
  left: 0,
  top: 0
}, _parsePosition = function _parsePosition2(value, trigger, scrollerSize, direction, scroll, marker, markerScroller, self, scrollerBounds, borderWidth, useFixedPosition, scrollerMax, containerAnimation, clampZeroProp) {
  _isFunction(value) && (value = value(self));
  if (_isString(value) && value.substr(0, 3) === "max") {
    value = scrollerMax + (value.charAt(4) === "=" ? _offsetToPx("0" + value.substr(3), scrollerSize) : 0);
  }
  var time = containerAnimation ? containerAnimation.time() : 0, p1, p2, element;
  containerAnimation && containerAnimation.seek(0);
  isNaN(value) || (value = +value);
  if (!_isNumber(value)) {
    _isFunction(trigger) && (trigger = trigger(self));
    var offsets = (value || "0").split(" "), bounds, localOffset, globalOffset, display;
    element = _getTarget(trigger, self) || _body;
    bounds = _getBounds(element) || {};
    if ((!bounds || !bounds.left && !bounds.top) && _getComputedStyle(element).display === "none") {
      display = element.style.display;
      element.style.display = "block";
      bounds = _getBounds(element);
      display ? element.style.display = display : element.style.removeProperty("display");
    }
    localOffset = _offsetToPx(offsets[0], bounds[direction.d]);
    globalOffset = _offsetToPx(offsets[1] || "0", scrollerSize);
    value = bounds[direction.p] - scrollerBounds[direction.p] - borderWidth + localOffset + scroll - globalOffset;
    markerScroller && _positionMarker(markerScroller, globalOffset, direction, scrollerSize - globalOffset < 20 || markerScroller._isStart && globalOffset > 20);
    scrollerSize -= scrollerSize - globalOffset;
  } else {
    containerAnimation && (value = gsap.utils.mapRange(containerAnimation.scrollTrigger.start, containerAnimation.scrollTrigger.end, 0, scrollerMax, value));
    markerScroller && _positionMarker(markerScroller, scrollerSize, direction, true);
  }
  if (clampZeroProp) {
    self[clampZeroProp] = value || -1e-3;
    value < 0 && (value = 0);
  }
  if (marker) {
    var position = value + scrollerSize, isStart = marker._isStart;
    p1 = "scroll" + direction.d2;
    _positionMarker(marker, position, direction, isStart && position > 20 || !isStart && (useFixedPosition ? Math.max(_body[p1], _docEl[p1]) : marker.parentNode[p1]) <= position + 1);
    if (useFixedPosition) {
      scrollerBounds = _getBounds(markerScroller);
      useFixedPosition && (marker.style[direction.op.p] = scrollerBounds[direction.op.p] - direction.op.m - marker._offset + _px);
    }
  }
  if (containerAnimation && element) {
    p1 = _getBounds(element);
    containerAnimation.seek(scrollerMax);
    p2 = _getBounds(element);
    containerAnimation._caScrollDist = p1[direction.p] - p2[direction.p];
    value = value / containerAnimation._caScrollDist * scrollerMax;
  }
  containerAnimation && containerAnimation.seek(time);
  return containerAnimation ? value : Math.round(value);
}, _prefixExp = /(webkit|moz|length|cssText|inset)/i, _reparent = function _reparent2(element, parent, top, left) {
  if (element.parentNode !== parent) {
    var style = element.style, p, cs;
    if (parent === _body) {
      element._stOrig = style.cssText;
      cs = _getComputedStyle(element);
      for (p in cs) {
        if (!+p && !_prefixExp.test(p) && cs[p] && typeof style[p] === "string" && p !== "0") {
          style[p] = cs[p];
        }
      }
      style.top = top;
      style.left = left;
    } else {
      style.cssText = element._stOrig;
    }
    gsap.core.getCache(element).uncache = 1;
    parent.appendChild(element);
  }
}, _interruptionTracker = function _interruptionTracker2(getValueFunc, initialValue, onInterrupt) {
  var last1 = initialValue, last2 = last1;
  return function(value) {
    var current = Math.round(getValueFunc());
    if (current !== last1 && current !== last2 && Math.abs(current - last1) > 3 && Math.abs(current - last2) > 3) {
      value = current;
      onInterrupt && onInterrupt();
    }
    last2 = last1;
    last1 = Math.round(value);
    return last1;
  };
}, _shiftMarker = function _shiftMarker2(marker, direction, value) {
  var vars = {};
  vars[direction.p] = "+=" + value;
  gsap.set(marker, vars);
}, _getTweenCreator = function _getTweenCreator2(scroller, direction) {
  var getScroll = _getScrollFunc(scroller, direction), prop = "_scroll" + direction.p2, getTween = function getTween2(scrollTo, vars, initialValue, change1, change2) {
    var tween = getTween2.tween, onComplete = vars.onComplete, modifiers = {};
    initialValue = initialValue || getScroll();
    var checkForInterruption = _interruptionTracker(getScroll, initialValue, function() {
      tween.kill();
      getTween2.tween = 0;
    });
    change2 = change1 && change2 || 0;
    change1 = change1 || scrollTo - initialValue;
    tween && tween.kill();
    vars[prop] = scrollTo;
    vars.inherit = false;
    vars.modifiers = modifiers;
    modifiers[prop] = function() {
      return checkForInterruption(initialValue + change1 * tween.ratio + change2 * tween.ratio * tween.ratio);
    };
    vars.onUpdate = function() {
      _scrollers.cache++;
      getTween2.tween && _updateAll();
    };
    vars.onComplete = function() {
      getTween2.tween = 0;
      onComplete && onComplete.call(tween);
    };
    tween = getTween2.tween = gsap.to(scroller, vars);
    return tween;
  };
  scroller[prop] = getScroll;
  getScroll.wheelHandler = function() {
    return getTween.tween && getTween.tween.kill() && (getTween.tween = 0);
  };
  _addListener(scroller, "wheel", getScroll.wheelHandler);
  ScrollTrigger.isTouch && _addListener(scroller, "touchmove", getScroll.wheelHandler);
  return getTween;
};
var ScrollTrigger = /* @__PURE__ */ function() {
  function ScrollTrigger2(vars, animation) {
    _coreInitted || ScrollTrigger2.register(gsap) || console.warn("Please gsap.registerPlugin(ScrollTrigger)");
    _context(this);
    this.init(vars, animation);
  }
  var _proto = ScrollTrigger2.prototype;
  _proto.init = function init(vars, animation) {
    this.progress = this.start = 0;
    this.vars && this.kill(true, true);
    if (!_enabled) {
      this.update = this.refresh = this.kill = _passThrough;
      return;
    }
    vars = _setDefaults(_isString(vars) || _isNumber(vars) || vars.nodeType ? {
      trigger: vars
    } : vars, _defaults);
    var _vars = vars, onUpdate = _vars.onUpdate, toggleClass = _vars.toggleClass, id = _vars.id, onToggle = _vars.onToggle, onRefresh = _vars.onRefresh, scrub = _vars.scrub, trigger = _vars.trigger, pin = _vars.pin, pinSpacing = _vars.pinSpacing, invalidateOnRefresh = _vars.invalidateOnRefresh, anticipatePin = _vars.anticipatePin, onScrubComplete = _vars.onScrubComplete, onSnapComplete = _vars.onSnapComplete, once = _vars.once, snap = _vars.snap, pinReparent = _vars.pinReparent, pinSpacer = _vars.pinSpacer, containerAnimation = _vars.containerAnimation, fastScrollEnd = _vars.fastScrollEnd, preventOverlaps = _vars.preventOverlaps, direction = vars.horizontal || vars.containerAnimation && vars.horizontal !== false ? _horizontal : _vertical, isToggle = !scrub && scrub !== 0, scroller = _getTarget(vars.scroller || _win), scrollerCache = gsap.core.getCache(scroller), isViewport = _isViewport(scroller), useFixedPosition = ("pinType" in vars ? vars.pinType : _getProxyProp(scroller, "pinType") || isViewport && "fixed") === "fixed", callbacks = [vars.onEnter, vars.onLeave, vars.onEnterBack, vars.onLeaveBack], toggleActions = isToggle && vars.toggleActions.split(" "), markers = "markers" in vars ? vars.markers : _defaults.markers, borderWidth = isViewport ? 0 : parseFloat(_getComputedStyle(scroller)["border" + direction.p2 + _Width]) || 0, self = this, onRefreshInit = vars.onRefreshInit && function() {
      return vars.onRefreshInit(self);
    }, getScrollerSize = _getSizeFunc(scroller, isViewport, direction), getScrollerOffsets = _getOffsetsFunc(scroller, isViewport), lastSnap = 0, lastRefresh = 0, prevProgress = 0, scrollFunc = _getScrollFunc(scroller, direction), tweenTo, pinCache, snapFunc, scroll1, scroll2, start, end, markerStart, markerEnd, markerStartTrigger, markerEndTrigger, markerVars, executingOnRefresh, change, pinOriginalState, pinActiveState, pinState, spacer, offset, pinGetter, pinSetter, pinStart, pinChange, spacingStart, spacerState, markerStartSetter, pinMoves, markerEndSetter, cs, snap1, snap2, scrubTween, scrubSmooth, snapDurClamp, snapDelayedCall, prevScroll, prevAnimProgress, caMarkerSetter, customRevertReturn;
    self._startClamp = self._endClamp = false;
    self._dir = direction;
    anticipatePin *= 45;
    self.scroller = scroller;
    self.scroll = containerAnimation ? containerAnimation.time.bind(containerAnimation) : scrollFunc;
    scroll1 = scrollFunc();
    self.vars = vars;
    animation = animation || vars.animation;
    if ("refreshPriority" in vars) {
      _sort = 1;
      vars.refreshPriority === -9999 && (_primary = self);
    }
    scrollerCache.tweenScroll = scrollerCache.tweenScroll || {
      top: _getTweenCreator(scroller, _vertical),
      left: _getTweenCreator(scroller, _horizontal)
    };
    self.tweenTo = tweenTo = scrollerCache.tweenScroll[direction.p];
    self.scrubDuration = function(value) {
      scrubSmooth = _isNumber(value) && value;
      if (!scrubSmooth) {
        scrubTween && scrubTween.progress(1).kill();
        scrubTween = 0;
      } else {
        scrubTween ? scrubTween.duration(value) : scrubTween = gsap.to(animation, {
          ease: "expo",
          totalProgress: "+=0",
          inherit: false,
          duration: scrubSmooth,
          paused: true,
          onComplete: function onComplete() {
            return onScrubComplete && onScrubComplete(self);
          }
        });
      }
    };
    if (animation) {
      animation.vars.lazy = false;
      animation._initted && !self.isReverted || animation.vars.immediateRender !== false && vars.immediateRender !== false && animation.duration() && animation.render(0, true, true);
      self.animation = animation.pause();
      animation.scrollTrigger = self;
      self.scrubDuration(scrub);
      snap1 = 0;
      id || (id = animation.vars.id);
    }
    if (snap) {
      if (!_isObject(snap) || snap.push) {
        snap = {
          snapTo: snap
        };
      }
      "scrollBehavior" in _body.style && gsap.set(isViewport ? [_body, _docEl] : scroller, {
        scrollBehavior: "auto"
      });
      _scrollers.forEach(function(o) {
        return _isFunction(o) && o.target === (isViewport ? _doc.scrollingElement || _docEl : scroller) && (o.smooth = false);
      });
      snapFunc = _isFunction(snap.snapTo) ? snap.snapTo : snap.snapTo === "labels" ? _getClosestLabel(animation) : snap.snapTo === "labelsDirectional" ? _getLabelAtDirection(animation) : snap.directional !== false ? function(value, st) {
        return _snapDirectional(snap.snapTo)(value, _getTime() - lastRefresh < 500 ? 0 : st.direction);
      } : gsap.utils.snap(snap.snapTo);
      snapDurClamp = snap.duration || {
        min: 0.1,
        max: 2
      };
      snapDurClamp = _isObject(snapDurClamp) ? _clamp(snapDurClamp.min, snapDurClamp.max) : _clamp(snapDurClamp, snapDurClamp);
      snapDelayedCall = gsap.delayedCall(snap.delay || scrubSmooth / 2 || 0.1, function() {
        var scroll = scrollFunc(), refreshedRecently = _getTime() - lastRefresh < 500, tween = tweenTo.tween;
        if ((refreshedRecently || Math.abs(self.getVelocity()) < 10) && !tween && !_pointerIsDown && lastSnap !== scroll) {
          var progress = (scroll - start) / change, totalProgress = animation && !isToggle ? animation.totalProgress() : progress, velocity = refreshedRecently ? 0 : (totalProgress - snap2) / (_getTime() - _time2) * 1e3 || 0, change1 = gsap.utils.clamp(-progress, 1 - progress, _abs(velocity / 2) * velocity / 0.185), naturalEnd = progress + (snap.inertia === false ? 0 : change1), endValue, endScroll, _snap = snap, onStart = _snap.onStart, _onInterrupt = _snap.onInterrupt, _onComplete = _snap.onComplete;
          endValue = snapFunc(naturalEnd, self);
          _isNumber(endValue) || (endValue = naturalEnd);
          endScroll = Math.max(0, Math.round(start + endValue * change));
          if (scroll <= end && scroll >= start && endScroll !== scroll) {
            if (tween && !tween._initted && tween.data <= _abs(endScroll - scroll)) {
              return;
            }
            if (snap.inertia === false) {
              change1 = endValue - progress;
            }
            tweenTo(endScroll, {
              duration: snapDurClamp(_abs(Math.max(_abs(naturalEnd - totalProgress), _abs(endValue - totalProgress)) * 0.185 / velocity / 0.05 || 0)),
              ease: snap.ease || "power3",
              data: _abs(endScroll - scroll),
              // record the distance so that if another snap tween occurs (conflict) we can prioritize the closest snap.
              onInterrupt: function onInterrupt() {
                return snapDelayedCall.restart(true) && _onInterrupt && _onInterrupt(self);
              },
              onComplete: function onComplete() {
                self.update();
                lastSnap = scrollFunc();
                if (animation && !isToggle) {
                  scrubTween ? scrubTween.resetTo("totalProgress", endValue, animation._tTime / animation._tDur) : animation.progress(endValue);
                }
                snap1 = snap2 = animation && !isToggle ? animation.totalProgress() : self.progress;
                onSnapComplete && onSnapComplete(self);
                _onComplete && _onComplete(self);
              }
            }, scroll, change1 * change, endScroll - scroll - change1 * change);
            onStart && onStart(self, tweenTo.tween);
          }
        } else if (self.isActive && lastSnap !== scroll) {
          snapDelayedCall.restart(true);
        }
      }).pause();
    }
    id && (_ids[id] = self);
    trigger = self.trigger = _getTarget(trigger || pin !== true && pin);
    customRevertReturn = trigger && trigger._gsap && trigger._gsap.stRevert;
    customRevertReturn && (customRevertReturn = customRevertReturn(self));
    pin = pin === true ? trigger : _getTarget(pin);
    _isString(toggleClass) && (toggleClass = {
      targets: trigger,
      className: toggleClass
    });
    if (pin) {
      pinSpacing === false || pinSpacing === _margin || (pinSpacing = !pinSpacing && pin.parentNode && pin.parentNode.style && _getComputedStyle(pin.parentNode).display === "flex" ? false : _padding);
      self.pin = pin;
      pinCache = gsap.core.getCache(pin);
      if (!pinCache.spacer) {
        if (pinSpacer) {
          pinSpacer = _getTarget(pinSpacer);
          pinSpacer && !pinSpacer.nodeType && (pinSpacer = pinSpacer.current || pinSpacer.nativeElement);
          pinCache.spacerIsNative = !!pinSpacer;
          pinSpacer && (pinCache.spacerState = _getState(pinSpacer));
        }
        pinCache.spacer = spacer = pinSpacer || _doc.createElement("div");
        spacer.classList.add("pin-spacer");
        id && spacer.classList.add("pin-spacer-" + id);
        pinCache.pinState = pinOriginalState = _getState(pin);
      } else {
        pinOriginalState = pinCache.pinState;
      }
      vars.force3D !== false && gsap.set(pin, {
        force3D: true
      });
      self.spacer = spacer = pinCache.spacer;
      cs = _getComputedStyle(pin);
      spacingStart = cs[pinSpacing + direction.os2];
      pinGetter = gsap.getProperty(pin);
      pinSetter = gsap.quickSetter(pin, direction.a, _px);
      _swapPinIn(pin, spacer, cs);
      pinState = _getState(pin);
    }
    if (markers) {
      markerVars = _isObject(markers) ? _setDefaults(markers, _markerDefaults) : _markerDefaults;
      markerStartTrigger = _createMarker("scroller-start", id, scroller, direction, markerVars, 0);
      markerEndTrigger = _createMarker("scroller-end", id, scroller, direction, markerVars, 0, markerStartTrigger);
      offset = markerStartTrigger["offset" + direction.op.d2];
      var content = _getTarget(_getProxyProp(scroller, "content") || scroller);
      markerStart = this.markerStart = _createMarker("start", id, content, direction, markerVars, offset, 0, containerAnimation);
      markerEnd = this.markerEnd = _createMarker("end", id, content, direction, markerVars, offset, 0, containerAnimation);
      containerAnimation && (caMarkerSetter = gsap.quickSetter([markerStart, markerEnd], direction.a, _px));
      if (!useFixedPosition && !(_proxies.length && _getProxyProp(scroller, "fixedMarkers") === true)) {
        _makePositionable(isViewport ? _body : scroller);
        gsap.set([markerStartTrigger, markerEndTrigger], {
          force3D: true
        });
        markerStartSetter = gsap.quickSetter(markerStartTrigger, direction.a, _px);
        markerEndSetter = gsap.quickSetter(markerEndTrigger, direction.a, _px);
      }
    }
    if (containerAnimation) {
      var oldOnUpdate = containerAnimation.vars.onUpdate, oldParams = containerAnimation.vars.onUpdateParams;
      containerAnimation.eventCallback("onUpdate", function() {
        self.update(0, 0, 1);
        oldOnUpdate && oldOnUpdate.apply(containerAnimation, oldParams || []);
      });
    }
    self.previous = function() {
      return _triggers[_triggers.indexOf(self) - 1];
    };
    self.next = function() {
      return _triggers[_triggers.indexOf(self) + 1];
    };
    self.revert = function(revert, temp) {
      if (!temp) {
        return self.kill(true);
      }
      var r = revert !== false || !self.enabled, prevRefreshing = _refreshing;
      if (r !== self.isReverted) {
        if (r) {
          prevScroll = Math.max(scrollFunc(), self.scroll.rec || 0);
          prevProgress = self.progress;
          prevAnimProgress = animation && animation.progress();
        }
        markerStart && [markerStart, markerEnd, markerStartTrigger, markerEndTrigger].forEach(function(m) {
          return m.style.display = r ? "none" : "block";
        });
        if (r) {
          _refreshing = self;
          self.update(r);
        }
        if (pin && (!pinReparent || !self.isActive)) {
          if (r) {
            _swapPinOut(pin, spacer, pinOriginalState);
          } else {
            _swapPinIn(pin, spacer, _getComputedStyle(pin), spacerState);
          }
        }
        r || self.update(r);
        _refreshing = prevRefreshing;
        self.isReverted = r;
      }
    };
    self.refresh = function(soft, force, position, pinOffset) {
      if ((_refreshing || !self.enabled) && !force) {
        return;
      }
      if (pin && soft && _lastScrollTime) {
        _addListener(ScrollTrigger2, "scrollEnd", _softRefresh);
        return;
      }
      !_refreshingAll && onRefreshInit && onRefreshInit(self);
      _refreshing = self;
      if (tweenTo.tween && !position) {
        tweenTo.tween.kill();
        tweenTo.tween = 0;
      }
      scrubTween && scrubTween.pause();
      if (invalidateOnRefresh && animation) {
        animation.revert({
          kill: false
        }).invalidate();
        animation.getChildren && animation.getChildren(true, true, false).forEach(function(t) {
          return t.vars.immediateRender && t.render(0, true, true);
        });
      }
      self.isReverted || self.revert(true, true);
      self._subPinOffset = false;
      var size = getScrollerSize(), scrollerBounds = getScrollerOffsets(), max = containerAnimation ? containerAnimation.duration() : _maxScroll(scroller, direction), isFirstRefresh = change <= 0.01 || !change, offset2 = 0, otherPinOffset = pinOffset || 0, parsedEnd = _isObject(position) ? position.end : vars.end, parsedEndTrigger = vars.endTrigger || trigger, parsedStart = _isObject(position) ? position.start : vars.start || (vars.start === 0 || !trigger ? 0 : pin ? "0 0" : "0 100%"), pinnedContainer = self.pinnedContainer = vars.pinnedContainer && _getTarget(vars.pinnedContainer, self), triggerIndex = trigger && Math.max(0, _triggers.indexOf(self)) || 0, i = triggerIndex, cs2, bounds, scroll, isVertical, override, curTrigger, curPin, oppositeScroll, initted, revertedPins, forcedOverflow, markerStartOffset, markerEndOffset;
      if (markers && _isObject(position)) {
        markerStartOffset = gsap.getProperty(markerStartTrigger, direction.p);
        markerEndOffset = gsap.getProperty(markerEndTrigger, direction.p);
      }
      while (i-- > 0) {
        curTrigger = _triggers[i];
        curTrigger.end || curTrigger.refresh(0, 1) || (_refreshing = self);
        curPin = curTrigger.pin;
        if (curPin && (curPin === trigger || curPin === pin || curPin === pinnedContainer) && !curTrigger.isReverted) {
          revertedPins || (revertedPins = []);
          revertedPins.unshift(curTrigger);
          curTrigger.revert(true, true);
        }
        if (curTrigger !== _triggers[i]) {
          triggerIndex--;
          i--;
        }
      }
      _isFunction(parsedStart) && (parsedStart = parsedStart(self));
      parsedStart = _parseClamp(parsedStart, "start", self);
      start = _parsePosition(parsedStart, trigger, size, direction, scrollFunc(), markerStart, markerStartTrigger, self, scrollerBounds, borderWidth, useFixedPosition, max, containerAnimation, self._startClamp && "_startClamp") || (pin ? -1e-3 : 0);
      _isFunction(parsedEnd) && (parsedEnd = parsedEnd(self));
      if (_isString(parsedEnd) && !parsedEnd.indexOf("+=")) {
        if (~parsedEnd.indexOf(" ")) {
          parsedEnd = (_isString(parsedStart) ? parsedStart.split(" ")[0] : "") + parsedEnd;
        } else {
          offset2 = _offsetToPx(parsedEnd.substr(2), size);
          parsedEnd = _isString(parsedStart) ? parsedStart : (containerAnimation ? gsap.utils.mapRange(0, containerAnimation.duration(), containerAnimation.scrollTrigger.start, containerAnimation.scrollTrigger.end, start) : start) + offset2;
          parsedEndTrigger = trigger;
        }
      }
      parsedEnd = _parseClamp(parsedEnd, "end", self);
      end = Math.max(start, _parsePosition(parsedEnd || (parsedEndTrigger ? "100% 0" : max), parsedEndTrigger, size, direction, scrollFunc() + offset2, markerEnd, markerEndTrigger, self, scrollerBounds, borderWidth, useFixedPosition, max, containerAnimation, self._endClamp && "_endClamp")) || -1e-3;
      offset2 = 0;
      i = triggerIndex;
      while (i--) {
        curTrigger = _triggers[i];
        curPin = curTrigger.pin;
        if (curPin && curTrigger.start - curTrigger._pinPush <= start && !containerAnimation && curTrigger.end > 0) {
          cs2 = curTrigger.end - (self._startClamp ? Math.max(0, curTrigger.start) : curTrigger.start);
          if ((curPin === trigger && curTrigger.start - curTrigger._pinPush < start || curPin === pinnedContainer) && isNaN(parsedStart)) {
            offset2 += cs2 * (1 - curTrigger.progress);
          }
          curPin === pin && (otherPinOffset += cs2);
        }
      }
      start += offset2;
      end += offset2;
      self._startClamp && (self._startClamp += offset2);
      if (self._endClamp && !_refreshingAll) {
        self._endClamp = end || -1e-3;
        end = Math.min(end, _maxScroll(scroller, direction));
      }
      change = end - start || (start -= 0.01) && 1e-3;
      if (isFirstRefresh) {
        prevProgress = gsap.utils.clamp(0, 1, gsap.utils.normalize(start, end, prevScroll));
      }
      self._pinPush = otherPinOffset;
      if (markerStart && offset2) {
        cs2 = {};
        cs2[direction.a] = "+=" + offset2;
        pinnedContainer && (cs2[direction.p] = "-=" + scrollFunc());
        gsap.set([markerStart, markerEnd], cs2);
      }
      if (pin && !(_clampingMax && self.end >= _maxScroll(scroller, direction))) {
        cs2 = _getComputedStyle(pin);
        isVertical = direction === _vertical;
        scroll = scrollFunc();
        pinStart = parseFloat(pinGetter(direction.a)) + otherPinOffset;
        if (!max && end > 1) {
          forcedOverflow = (isViewport ? _doc.scrollingElement || _docEl : scroller).style;
          forcedOverflow = {
            style: forcedOverflow,
            value: forcedOverflow["overflow" + direction.a.toUpperCase()]
          };
          if (isViewport && _getComputedStyle(_body)["overflow" + direction.a.toUpperCase()] !== "scroll") {
            forcedOverflow.style["overflow" + direction.a.toUpperCase()] = "scroll";
          }
        }
        _swapPinIn(pin, spacer, cs2);
        pinState = _getState(pin);
        bounds = _getBounds(pin, true);
        oppositeScroll = useFixedPosition && _getScrollFunc(scroller, isVertical ? _horizontal : _vertical)();
        if (pinSpacing) {
          spacerState = [pinSpacing + direction.os2, change + otherPinOffset + _px];
          spacerState.t = spacer;
          i = pinSpacing === _padding ? _getSize(pin, direction) + change + otherPinOffset : 0;
          if (i) {
            spacerState.push(direction.d, i + _px);
            spacer.style.flexBasis !== "auto" && (spacer.style.flexBasis = i + _px);
          }
          _setState(spacerState);
          if (pinnedContainer) {
            _triggers.forEach(function(t) {
              if (t.pin === pinnedContainer && t.vars.pinSpacing !== false) {
                t._subPinOffset = true;
              }
            });
          }
          useFixedPosition && scrollFunc(prevScroll);
        } else {
          i = _getSize(pin, direction);
          i && spacer.style.flexBasis !== "auto" && (spacer.style.flexBasis = i + _px);
        }
        if (useFixedPosition) {
          override = {
            top: bounds.top + (isVertical ? scroll - start : oppositeScroll) + _px,
            left: bounds.left + (isVertical ? oppositeScroll : scroll - start) + _px,
            boxSizing: "border-box",
            position: "fixed"
          };
          override[_width] = override["max" + _Width] = Math.ceil(bounds.width) + _px;
          override[_height] = override["max" + _Height] = Math.ceil(bounds.height) + _px;
          override[_margin] = override[_margin + _Top] = override[_margin + _Right] = override[_margin + _Bottom] = override[_margin + _Left] = "0";
          override[_padding] = cs2[_padding];
          override[_padding + _Top] = cs2[_padding + _Top];
          override[_padding + _Right] = cs2[_padding + _Right];
          override[_padding + _Bottom] = cs2[_padding + _Bottom];
          override[_padding + _Left] = cs2[_padding + _Left];
          pinActiveState = _copyState(pinOriginalState, override, pinReparent);
          _refreshingAll && scrollFunc(0);
        }
        if (animation) {
          initted = animation._initted;
          _suppressOverwrites(1);
          animation.render(animation.duration(), true, true);
          pinChange = pinGetter(direction.a) - pinStart + change + otherPinOffset;
          pinMoves = Math.abs(change - pinChange) > 1;
          useFixedPosition && pinMoves && pinActiveState.splice(pinActiveState.length - 2, 2);
          animation.render(0, true, true);
          initted || animation.invalidate(true);
          animation.parent || animation.totalTime(animation.totalTime());
          _suppressOverwrites(0);
        } else {
          pinChange = change;
        }
        forcedOverflow && (forcedOverflow.value ? forcedOverflow.style["overflow" + direction.a.toUpperCase()] = forcedOverflow.value : forcedOverflow.style.removeProperty("overflow-" + direction.a));
      } else if (trigger && scrollFunc() && !containerAnimation) {
        bounds = trigger.parentNode;
        while (bounds && bounds !== _body) {
          if (bounds._pinOffset) {
            start -= bounds._pinOffset;
            end -= bounds._pinOffset;
          }
          bounds = bounds.parentNode;
        }
      }
      revertedPins && revertedPins.forEach(function(t) {
        return t.revert(false, true);
      });
      self.start = start;
      self.end = end;
      scroll1 = scroll2 = _refreshingAll ? prevScroll : scrollFunc();
      if (!containerAnimation && !_refreshingAll) {
        scroll1 < prevScroll && scrollFunc(prevScroll);
        self.scroll.rec = 0;
      }
      self.revert(false, true);
      lastRefresh = _getTime();
      if (snapDelayedCall) {
        lastSnap = -1;
        snapDelayedCall.restart(true);
      }
      _refreshing = 0;
      animation && isToggle && (animation._initted || prevAnimProgress) && animation.progress() !== prevAnimProgress && animation.progress(prevAnimProgress || 0, true).render(animation.time(), true, true);
      if (isFirstRefresh || prevProgress !== self.progress || containerAnimation || invalidateOnRefresh || animation && !animation._initted) {
        animation && !isToggle && (animation._initted || prevProgress || animation.vars.immediateRender !== false) && animation.totalProgress(containerAnimation && start < -1e-3 && !prevProgress ? gsap.utils.normalize(start, end, 0) : prevProgress, true);
        self.progress = isFirstRefresh || (scroll1 - start) / change === prevProgress ? 0 : prevProgress;
      }
      pin && pinSpacing && (spacer._pinOffset = Math.round(self.progress * pinChange));
      scrubTween && scrubTween.invalidate();
      if (!isNaN(markerStartOffset)) {
        markerStartOffset -= gsap.getProperty(markerStartTrigger, direction.p);
        markerEndOffset -= gsap.getProperty(markerEndTrigger, direction.p);
        _shiftMarker(markerStartTrigger, direction, markerStartOffset);
        _shiftMarker(markerStart, direction, markerStartOffset - (pinOffset || 0));
        _shiftMarker(markerEndTrigger, direction, markerEndOffset);
        _shiftMarker(markerEnd, direction, markerEndOffset - (pinOffset || 0));
      }
      isFirstRefresh && !_refreshingAll && self.update();
      if (onRefresh && !_refreshingAll && !executingOnRefresh) {
        executingOnRefresh = true;
        onRefresh(self);
        executingOnRefresh = false;
      }
    };
    self.getVelocity = function() {
      return (scrollFunc() - scroll2) / (_getTime() - _time2) * 1e3 || 0;
    };
    self.endAnimation = function() {
      _endAnimation(self.callbackAnimation);
      if (animation) {
        scrubTween ? scrubTween.progress(1) : !animation.paused() ? _endAnimation(animation, animation.reversed()) : isToggle || _endAnimation(animation, self.direction < 0, 1);
      }
    };
    self.labelToScroll = function(label) {
      return animation && animation.labels && (start || self.refresh() || start) + animation.labels[label] / animation.duration() * change || 0;
    };
    self.getTrailing = function(name) {
      var i = _triggers.indexOf(self), a = self.direction > 0 ? _triggers.slice(0, i).reverse() : _triggers.slice(i + 1);
      return (_isString(name) ? a.filter(function(t) {
        return t.vars.preventOverlaps === name;
      }) : a).filter(function(t) {
        return self.direction > 0 ? t.end <= start : t.start >= end;
      });
    };
    self.update = function(reset, recordVelocity, forceFake) {
      if (containerAnimation && !forceFake && !reset) {
        return;
      }
      var scroll = _refreshingAll === true ? prevScroll : self.scroll(), p = reset ? 0 : (scroll - start) / change, clipped = p < 0 ? 0 : p > 1 ? 1 : p || 0, prevProgress2 = self.progress, isActive, wasActive, toggleState, action, stateChanged, toggled, isAtMax, isTakingAction;
      if (recordVelocity) {
        scroll2 = scroll1;
        scroll1 = containerAnimation ? scrollFunc() : scroll;
        if (snap) {
          snap2 = snap1;
          snap1 = animation && !isToggle ? animation.totalProgress() : clipped;
        }
      }
      if (anticipatePin && pin && !_refreshing && !_startup && _lastScrollTime) {
        if (!clipped && start < scroll + (scroll - scroll2) / (_getTime() - _time2) * anticipatePin) {
          clipped = 1e-4;
        } else if (clipped === 1 && end > scroll + (scroll - scroll2) / (_getTime() - _time2) * anticipatePin) {
          clipped = 0.9999;
        }
      }
      if (clipped !== prevProgress2 && self.enabled) {
        isActive = self.isActive = !!clipped && clipped < 1;
        wasActive = !!prevProgress2 && prevProgress2 < 1;
        toggled = isActive !== wasActive;
        stateChanged = toggled || !!clipped !== !!prevProgress2;
        self.direction = clipped > prevProgress2 ? 1 : -1;
        self.progress = clipped;
        if (stateChanged && !_refreshing) {
          toggleState = clipped && !prevProgress2 ? 0 : clipped === 1 ? 1 : prevProgress2 === 1 ? 2 : 3;
          if (isToggle) {
            action = !toggled && toggleActions[toggleState + 1] !== "none" && toggleActions[toggleState + 1] || toggleActions[toggleState];
            isTakingAction = animation && (action === "complete" || action === "reset" || action in animation);
          }
        }
        preventOverlaps && (toggled || isTakingAction) && (isTakingAction || scrub || !animation) && (_isFunction(preventOverlaps) ? preventOverlaps(self) : self.getTrailing(preventOverlaps).forEach(function(t) {
          return t.endAnimation();
        }));
        if (!isToggle) {
          if (scrubTween && !_refreshing && !_startup) {
            scrubTween._dp._time - scrubTween._start !== scrubTween._time && scrubTween.render(scrubTween._dp._time - scrubTween._start);
            if (scrubTween.resetTo) {
              scrubTween.resetTo("totalProgress", clipped, animation._tTime / animation._tDur);
            } else {
              scrubTween.vars.totalProgress = clipped;
              scrubTween.invalidate().restart();
            }
          } else if (animation) {
            animation.totalProgress(clipped, !!(_refreshing && (lastRefresh || reset)));
          }
        }
        if (pin) {
          reset && pinSpacing && (spacer.style[pinSpacing + direction.os2] = spacingStart);
          if (!useFixedPosition) {
            pinSetter(_round(pinStart + pinChange * clipped));
          } else if (stateChanged) {
            isAtMax = !reset && clipped > prevProgress2 && end + 1 > scroll && scroll + 1 >= _maxScroll(scroller, direction);
            if (pinReparent) {
              if (!reset && (isActive || isAtMax)) {
                var bounds = _getBounds(pin, true), _offset = scroll - start;
                _reparent(pin, _body, bounds.top + (direction === _vertical ? _offset : 0) + _px, bounds.left + (direction === _vertical ? 0 : _offset) + _px);
              } else {
                _reparent(pin, spacer);
              }
            }
            _setState(isActive || isAtMax ? pinActiveState : pinState);
            pinMoves && clipped < 1 && isActive || pinSetter(pinStart + (clipped === 1 && !isAtMax ? pinChange : 0));
          }
        }
        snap && !tweenTo.tween && !_refreshing && !_startup && snapDelayedCall.restart(true);
        toggleClass && (toggled || once && clipped && (clipped < 1 || !_limitCallbacks)) && _toArray(toggleClass.targets).forEach(function(el) {
          return el.classList[isActive || once ? "add" : "remove"](toggleClass.className);
        });
        onUpdate && !isToggle && !reset && onUpdate(self);
        if (stateChanged && !_refreshing) {
          if (isToggle) {
            if (isTakingAction) {
              if (action === "complete") {
                animation.pause().totalProgress(1);
              } else if (action === "reset") {
                animation.restart(true).pause();
              } else if (action === "restart") {
                animation.restart(true);
              } else {
                animation[action]();
              }
            }
            onUpdate && onUpdate(self);
          }
          if (toggled || !_limitCallbacks) {
            onToggle && toggled && _callback(self, onToggle);
            callbacks[toggleState] && _callback(self, callbacks[toggleState]);
            once && (clipped === 1 ? self.kill(false, 1) : callbacks[toggleState] = 0);
            if (!toggled) {
              toggleState = clipped === 1 ? 1 : 3;
              callbacks[toggleState] && _callback(self, callbacks[toggleState]);
            }
          }
          if (fastScrollEnd && !isActive && Math.abs(self.getVelocity()) > (_isNumber(fastScrollEnd) ? fastScrollEnd : 2500)) {
            _endAnimation(self.callbackAnimation);
            scrubTween ? scrubTween.progress(1) : _endAnimation(animation, action === "reverse" ? 1 : !clipped, 1);
          }
        } else if (isToggle && onUpdate && !_refreshing) {
          onUpdate(self);
        }
      }
      if (markerEndSetter) {
        var n = containerAnimation ? scroll / containerAnimation.duration() * (containerAnimation._caScrollDist || 0) : scroll;
        markerStartSetter(n + (markerStartTrigger._isFlipped ? 1 : 0));
        markerEndSetter(n);
      }
      caMarkerSetter && caMarkerSetter(-scroll / containerAnimation.duration() * (containerAnimation._caScrollDist || 0));
    };
    self.enable = function(reset, refresh) {
      if (!self.enabled) {
        self.enabled = true;
        _addListener(scroller, "resize", _onResize);
        isViewport || _addListener(scroller, "scroll", _onScroll);
        onRefreshInit && _addListener(ScrollTrigger2, "refreshInit", onRefreshInit);
        if (reset !== false) {
          self.progress = prevProgress = 0;
          scroll1 = scroll2 = lastSnap = scrollFunc();
        }
        refresh !== false && self.refresh();
      }
    };
    self.getTween = function(snap3) {
      return snap3 && tweenTo ? tweenTo.tween : scrubTween;
    };
    self.setPositions = function(newStart, newEnd, keepClamp, pinOffset) {
      if (containerAnimation) {
        var st = containerAnimation.scrollTrigger, duration = containerAnimation.duration(), _change = st.end - st.start;
        newStart = st.start + _change * newStart / duration;
        newEnd = st.start + _change * newEnd / duration;
      }
      self.refresh(false, false, {
        start: _keepClamp(newStart, keepClamp && !!self._startClamp),
        end: _keepClamp(newEnd, keepClamp && !!self._endClamp)
      }, pinOffset);
      self.update();
    };
    self.adjustPinSpacing = function(amount) {
      if (spacerState && amount) {
        var i = spacerState.indexOf(direction.d) + 1;
        spacerState[i] = parseFloat(spacerState[i]) + amount + _px;
        spacerState[1] = parseFloat(spacerState[1]) + amount + _px;
        _setState(spacerState);
      }
    };
    self.disable = function(reset, allowAnimation) {
      if (self.enabled) {
        reset !== false && self.revert(true, true);
        self.enabled = self.isActive = false;
        allowAnimation || scrubTween && scrubTween.pause();
        prevScroll = 0;
        pinCache && (pinCache.uncache = 1);
        onRefreshInit && _removeListener(ScrollTrigger2, "refreshInit", onRefreshInit);
        if (snapDelayedCall) {
          snapDelayedCall.pause();
          tweenTo.tween && tweenTo.tween.kill() && (tweenTo.tween = 0);
        }
        if (!isViewport) {
          var i = _triggers.length;
          while (i--) {
            if (_triggers[i].scroller === scroller && _triggers[i] !== self) {
              return;
            }
          }
          _removeListener(scroller, "resize", _onResize);
          isViewport || _removeListener(scroller, "scroll", _onScroll);
        }
      }
    };
    self.kill = function(revert, allowAnimation) {
      self.disable(revert, allowAnimation);
      scrubTween && !allowAnimation && scrubTween.kill();
      id && delete _ids[id];
      var i = _triggers.indexOf(self);
      i >= 0 && _triggers.splice(i, 1);
      i === _i && _direction > 0 && _i--;
      i = 0;
      _triggers.forEach(function(t) {
        return t.scroller === self.scroller && (i = 1);
      });
      i || _refreshingAll || (self.scroll.rec = 0);
      if (animation) {
        animation.scrollTrigger = null;
        revert && animation.revert({
          kill: false
        });
        allowAnimation || animation.kill();
      }
      markerStart && [markerStart, markerEnd, markerStartTrigger, markerEndTrigger].forEach(function(m) {
        return m.parentNode && m.parentNode.removeChild(m);
      });
      _primary === self && (_primary = 0);
      if (pin) {
        pinCache && (pinCache.uncache = 1);
        i = 0;
        _triggers.forEach(function(t) {
          return t.pin === pin && i++;
        });
        i || (pinCache.spacer = 0);
      }
      vars.onKill && vars.onKill(self);
    };
    _triggers.push(self);
    self.enable(false, false);
    customRevertReturn && customRevertReturn(self);
    if (animation && animation.add && !change) {
      var updateFunc = self.update;
      self.update = function() {
        self.update = updateFunc;
        _scrollers.cache++;
        start || end || self.refresh();
      };
      gsap.delayedCall(0.01, self.update);
      change = 0.01;
      start = end = 0;
    } else {
      self.refresh();
    }
    pin && _queueRefreshAll();
  };
  ScrollTrigger2.register = function register(core) {
    if (!_coreInitted) {
      gsap = core || _getGSAP();
      _windowExists() && window.document && ScrollTrigger2.enable();
      _coreInitted = _enabled;
    }
    return _coreInitted;
  };
  ScrollTrigger2.defaults = function defaults(config) {
    if (config) {
      for (var p in config) {
        _defaults[p] = config[p];
      }
    }
    return _defaults;
  };
  ScrollTrigger2.disable = function disable(reset, kill) {
    _enabled = 0;
    _triggers.forEach(function(trigger) {
      return trigger[kill ? "kill" : "disable"](reset);
    });
    _removeListener(_win, "wheel", _onScroll);
    _removeListener(_doc, "scroll", _onScroll);
    clearInterval(_syncInterval);
    _removeListener(_doc, "touchcancel", _passThrough);
    _removeListener(_body, "touchstart", _passThrough);
    _multiListener(_removeListener, _doc, "pointerdown,touchstart,mousedown", _pointerDownHandler);
    _multiListener(_removeListener, _doc, "pointerup,touchend,mouseup", _pointerUpHandler);
    _resizeDelay.kill();
    _iterateAutoRefresh(_removeListener);
    for (var i = 0; i < _scrollers.length; i += 3) {
      _wheelListener(_removeListener, _scrollers[i], _scrollers[i + 1]);
      _wheelListener(_removeListener, _scrollers[i], _scrollers[i + 2]);
    }
  };
  ScrollTrigger2.enable = function enable() {
    _win = window;
    _doc = document;
    _docEl = _doc.documentElement;
    _body = _doc.body;
    if (gsap) {
      _toArray = gsap.utils.toArray;
      _clamp = gsap.utils.clamp;
      _context = gsap.core.context || _passThrough;
      _suppressOverwrites = gsap.core.suppressOverwrites || _passThrough;
      _scrollRestoration = _win.history.scrollRestoration || "auto";
      _lastScroll = _win.pageYOffset || 0;
      gsap.core.globals("ScrollTrigger", ScrollTrigger2);
      if (_body) {
        _enabled = 1;
        _div100vh = document.createElement("div");
        _div100vh.style.height = "100vh";
        _div100vh.style.position = "absolute";
        _refresh100vh();
        _rafBugFix();
        Observer.register(gsap);
        ScrollTrigger2.isTouch = Observer.isTouch;
        _fixIOSBug = Observer.isTouch && /(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent);
        _ignoreMobileResize = Observer.isTouch === 1;
        _addListener(_win, "wheel", _onScroll);
        _root = [_win, _doc, _docEl, _body];
        if (gsap.matchMedia) {
          ScrollTrigger2.matchMedia = function(vars) {
            var mm = gsap.matchMedia(), p;
            for (p in vars) {
              mm.add(p, vars[p]);
            }
            return mm;
          };
          gsap.addEventListener("matchMediaInit", function() {
            return _revertAll();
          });
          gsap.addEventListener("matchMediaRevert", function() {
            return _revertRecorded();
          });
          gsap.addEventListener("matchMedia", function() {
            _refreshAll(0, 1);
            _dispatch("matchMedia");
          });
          gsap.matchMedia().add("(orientation: portrait)", function() {
            _setBaseDimensions();
            return _setBaseDimensions;
          });
        } else {
          console.warn("Requires GSAP 3.11.0 or later");
        }
        _setBaseDimensions();
        _addListener(_doc, "scroll", _onScroll);
        var bodyHasStyle = _body.hasAttribute("style"), bodyStyle = _body.style, border = bodyStyle.borderTopStyle, AnimationProto = gsap.core.Animation.prototype, bounds, i;
        AnimationProto.revert || Object.defineProperty(AnimationProto, "revert", {
          value: function value() {
            return this.time(-0.01, true);
          }
        });
        bodyStyle.borderTopStyle = "solid";
        bounds = _getBounds(_body);
        _vertical.m = Math.round(bounds.top + _vertical.sc()) || 0;
        _horizontal.m = Math.round(bounds.left + _horizontal.sc()) || 0;
        border ? bodyStyle.borderTopStyle = border : bodyStyle.removeProperty("border-top-style");
        if (!bodyHasStyle) {
          _body.setAttribute("style", "");
          _body.removeAttribute("style");
        }
        _syncInterval = setInterval(_sync, 250);
        gsap.delayedCall(0.5, function() {
          return _startup = 0;
        });
        _addListener(_doc, "touchcancel", _passThrough);
        _addListener(_body, "touchstart", _passThrough);
        _multiListener(_addListener, _doc, "pointerdown,touchstart,mousedown", _pointerDownHandler);
        _multiListener(_addListener, _doc, "pointerup,touchend,mouseup", _pointerUpHandler);
        _transformProp = gsap.utils.checkPrefix("transform");
        _stateProps.push(_transformProp);
        _coreInitted = _getTime();
        _resizeDelay = gsap.delayedCall(0.2, _refreshAll).pause();
        _autoRefresh = [_doc, "visibilitychange", function() {
          var w = _win.innerWidth, h = _win.innerHeight;
          if (_doc.hidden) {
            _prevWidth = w;
            _prevHeight = h;
          } else if (_prevWidth !== w || _prevHeight !== h) {
            _onResize();
          }
        }, _doc, "DOMContentLoaded", _refreshAll, _win, "load", _refreshAll, _win, "resize", _onResize];
        _iterateAutoRefresh(_addListener);
        _triggers.forEach(function(trigger) {
          return trigger.enable(0, 1);
        });
        for (i = 0; i < _scrollers.length; i += 3) {
          _wheelListener(_removeListener, _scrollers[i], _scrollers[i + 1]);
          _wheelListener(_removeListener, _scrollers[i], _scrollers[i + 2]);
        }
      }
    }
  };
  ScrollTrigger2.config = function config(vars) {
    "limitCallbacks" in vars && (_limitCallbacks = !!vars.limitCallbacks);
    var ms = vars.syncInterval;
    ms && clearInterval(_syncInterval) || (_syncInterval = ms) && setInterval(_sync, ms);
    "ignoreMobileResize" in vars && (_ignoreMobileResize = ScrollTrigger2.isTouch === 1 && vars.ignoreMobileResize);
    if ("autoRefreshEvents" in vars) {
      _iterateAutoRefresh(_removeListener) || _iterateAutoRefresh(_addListener, vars.autoRefreshEvents || "none");
      _ignoreResize = (vars.autoRefreshEvents + "").indexOf("resize") === -1;
    }
  };
  ScrollTrigger2.scrollerProxy = function scrollerProxy(target, vars) {
    var t = _getTarget(target), i = _scrollers.indexOf(t), isViewport = _isViewport(t);
    if (~i) {
      _scrollers.splice(i, isViewport ? 6 : 2);
    }
    if (vars) {
      isViewport ? _proxies.unshift(_win, vars, _body, vars, _docEl, vars) : _proxies.unshift(t, vars);
    }
  };
  ScrollTrigger2.clearMatchMedia = function clearMatchMedia(query) {
    _triggers.forEach(function(t) {
      return t._ctx && t._ctx.query === query && t._ctx.kill(true, true);
    });
  };
  ScrollTrigger2.isInViewport = function isInViewport(element, ratio, horizontal) {
    var bounds = (_isString(element) ? _getTarget(element) : element).getBoundingClientRect(), offset = bounds[horizontal ? _width : _height] * ratio || 0;
    return horizontal ? bounds.right - offset > 0 && bounds.left + offset < _win.innerWidth : bounds.bottom - offset > 0 && bounds.top + offset < _win.innerHeight;
  };
  ScrollTrigger2.positionInViewport = function positionInViewport(element, referencePoint, horizontal) {
    _isString(element) && (element = _getTarget(element));
    var bounds = element.getBoundingClientRect(), size = bounds[horizontal ? _width : _height], offset = referencePoint == null ? size / 2 : referencePoint in _keywords ? _keywords[referencePoint] * size : ~referencePoint.indexOf("%") ? parseFloat(referencePoint) * size / 100 : parseFloat(referencePoint) || 0;
    return horizontal ? (bounds.left + offset) / _win.innerWidth : (bounds.top + offset) / _win.innerHeight;
  };
  ScrollTrigger2.killAll = function killAll(allowListeners) {
    _triggers.slice(0).forEach(function(t) {
      return t.vars.id !== "ScrollSmoother" && t.kill();
    });
    if (allowListeners !== true) {
      var listeners = _listeners.killAll || [];
      _listeners = {};
      listeners.forEach(function(f) {
        return f();
      });
    }
  };
  return ScrollTrigger2;
}();
ScrollTrigger.version = "3.13.0";
ScrollTrigger.saveStyles = function(targets) {
  return targets ? _toArray(targets).forEach(function(target) {
    if (target && target.style) {
      var i = _savedStyles.indexOf(target);
      i >= 0 && _savedStyles.splice(i, 5);
      _savedStyles.push(target, target.style.cssText, target.getBBox && target.getAttribute("transform"), gsap.core.getCache(target), _context());
    }
  }) : _savedStyles;
};
ScrollTrigger.revert = function(soft, media) {
  return _revertAll(!soft, media);
};
ScrollTrigger.create = function(vars, animation) {
  return new ScrollTrigger(vars, animation);
};
ScrollTrigger.refresh = function(safe) {
  return safe ? _onResize(true) : (_coreInitted || ScrollTrigger.register()) && _refreshAll(true);
};
ScrollTrigger.update = function(force) {
  return ++_scrollers.cache && _updateAll(force === true ? 2 : 0);
};
ScrollTrigger.clearScrollMemory = _clearScrollMemory;
ScrollTrigger.maxScroll = function(element, horizontal) {
  return _maxScroll(element, horizontal ? _horizontal : _vertical);
};
ScrollTrigger.getScrollFunc = function(element, horizontal) {
  return _getScrollFunc(_getTarget(element), horizontal ? _horizontal : _vertical);
};
ScrollTrigger.getById = function(id) {
  return _ids[id];
};
ScrollTrigger.getAll = function() {
  return _triggers.filter(function(t) {
    return t.vars.id !== "ScrollSmoother";
  });
};
ScrollTrigger.isScrolling = function() {
  return !!_lastScrollTime;
};
ScrollTrigger.snapDirectional = _snapDirectional;
ScrollTrigger.addEventListener = function(type, callback) {
  var a = _listeners[type] || (_listeners[type] = []);
  ~a.indexOf(callback) || a.push(callback);
};
ScrollTrigger.removeEventListener = function(type, callback) {
  var a = _listeners[type], i = a && a.indexOf(callback);
  i >= 0 && a.splice(i, 1);
};
ScrollTrigger.batch = function(targets, vars) {
  var result = [], varsCopy = {}, interval = vars.interval || 0.016, batchMax = vars.batchMax || 1e9, proxyCallback = function proxyCallback2(type, callback) {
    var elements = [], triggers = [], delay = gsap.delayedCall(interval, function() {
      callback(elements, triggers);
      elements = [];
      triggers = [];
    }).pause();
    return function(self) {
      elements.length || delay.restart(true);
      elements.push(self.trigger);
      triggers.push(self);
      batchMax <= elements.length && delay.progress(1);
    };
  }, p;
  for (p in vars) {
    varsCopy[p] = p.substr(0, 2) === "on" && _isFunction(vars[p]) && p !== "onRefreshInit" ? proxyCallback(p, vars[p]) : vars[p];
  }
  if (_isFunction(batchMax)) {
    batchMax = batchMax();
    _addListener(ScrollTrigger, "refresh", function() {
      return batchMax = vars.batchMax();
    });
  }
  _toArray(targets).forEach(function(target) {
    var config = {};
    for (p in varsCopy) {
      config[p] = varsCopy[p];
    }
    config.trigger = target;
    result.push(ScrollTrigger.create(config));
  });
  return result;
};
var _clampScrollAndGetDurationMultiplier = function _clampScrollAndGetDurationMultiplier2(scrollFunc, current, end, max) {
  current > max ? scrollFunc(max) : current < 0 && scrollFunc(0);
  return end > max ? (max - current) / (end - current) : end < 0 ? current / (current - end) : 1;
}, _allowNativePanning = function _allowNativePanning2(target, direction) {
  if (direction === true) {
    target.style.removeProperty("touch-action");
  } else {
    target.style.touchAction = direction === true ? "auto" : direction ? "pan-" + direction + (Observer.isTouch ? " pinch-zoom" : "") : "none";
  }
  target === _docEl && _allowNativePanning2(_body, direction);
}, _overflow = {
  auto: 1,
  scroll: 1
}, _nestedScroll = function _nestedScroll2(_ref5) {
  var event = _ref5.event, target = _ref5.target, axis = _ref5.axis;
  var node = (event.changedTouches ? event.changedTouches[0] : event).target, cache = node._gsap || gsap.core.getCache(node), time = _getTime(), cs;
  if (!cache._isScrollT || time - cache._isScrollT > 2e3) {
    while (node && node !== _body && (node.scrollHeight <= node.clientHeight && node.scrollWidth <= node.clientWidth || !(_overflow[(cs = _getComputedStyle(node)).overflowY] || _overflow[cs.overflowX]))) {
      node = node.parentNode;
    }
    cache._isScroll = node && node !== target && !_isViewport(node) && (_overflow[(cs = _getComputedStyle(node)).overflowY] || _overflow[cs.overflowX]);
    cache._isScrollT = time;
  }
  if (cache._isScroll || axis === "x") {
    event.stopPropagation();
    event._gsapAllow = true;
  }
}, _inputObserver = function _inputObserver2(target, type, inputs, nested) {
  return Observer.create({
    target,
    capture: true,
    debounce: false,
    lockAxis: true,
    type,
    onWheel: nested = nested && _nestedScroll,
    onPress: nested,
    onDrag: nested,
    onScroll: nested,
    onEnable: function onEnable() {
      return inputs && _addListener(_doc, Observer.eventTypes[0], _captureInputs, false, true);
    },
    onDisable: function onDisable() {
      return _removeListener(_doc, Observer.eventTypes[0], _captureInputs, true);
    }
  });
}, _inputExp = /(input|label|select|textarea)/i, _inputIsFocused, _captureInputs = function _captureInputs2(e) {
  var isInput = _inputExp.test(e.target.tagName);
  if (isInput || _inputIsFocused) {
    e._gsapAllow = true;
    _inputIsFocused = isInput;
  }
}, _getScrollNormalizer = function _getScrollNormalizer2(vars) {
  _isObject(vars) || (vars = {});
  vars.preventDefault = vars.isNormalizer = vars.allowClicks = true;
  vars.type || (vars.type = "wheel,touch");
  vars.debounce = !!vars.debounce;
  vars.id = vars.id || "normalizer";
  var _vars2 = vars, normalizeScrollX = _vars2.normalizeScrollX, momentum = _vars2.momentum, allowNestedScroll = _vars2.allowNestedScroll, onRelease = _vars2.onRelease, self, maxY, target = _getTarget(vars.target) || _docEl, smoother = gsap.core.globals().ScrollSmoother, smootherInstance = smoother && smoother.get(), content = _fixIOSBug && (vars.content && _getTarget(vars.content) || smootherInstance && vars.content !== false && !smootherInstance.smooth() && smootherInstance.content()), scrollFuncY = _getScrollFunc(target, _vertical), scrollFuncX = _getScrollFunc(target, _horizontal), scale = 1, initialScale = (Observer.isTouch && _win.visualViewport ? _win.visualViewport.scale * _win.visualViewport.width : _win.outerWidth) / _win.innerWidth, wheelRefresh = 0, resolveMomentumDuration = _isFunction(momentum) ? function() {
    return momentum(self);
  } : function() {
    return momentum || 2.8;
  }, lastRefreshID, skipTouchMove, inputObserver = _inputObserver(target, vars.type, true, allowNestedScroll), resumeTouchMove = function resumeTouchMove2() {
    return skipTouchMove = false;
  }, scrollClampX = _passThrough, scrollClampY = _passThrough, updateClamps = function updateClamps2() {
    maxY = _maxScroll(target, _vertical);
    scrollClampY = _clamp(_fixIOSBug ? 1 : 0, maxY);
    normalizeScrollX && (scrollClampX = _clamp(0, _maxScroll(target, _horizontal)));
    lastRefreshID = _refreshID;
  }, removeContentOffset = function removeContentOffset2() {
    content._gsap.y = _round(parseFloat(content._gsap.y) + scrollFuncY.offset) + "px";
    content.style.transform = "matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, " + parseFloat(content._gsap.y) + ", 0, 1)";
    scrollFuncY.offset = scrollFuncY.cacheID = 0;
  }, ignoreDrag = function ignoreDrag2() {
    if (skipTouchMove) {
      requestAnimationFrame(resumeTouchMove);
      var offset = _round(self.deltaY / 2), scroll = scrollClampY(scrollFuncY.v - offset);
      if (content && scroll !== scrollFuncY.v + scrollFuncY.offset) {
        scrollFuncY.offset = scroll - scrollFuncY.v;
        var y = _round((parseFloat(content && content._gsap.y) || 0) - scrollFuncY.offset);
        content.style.transform = "matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, " + y + ", 0, 1)";
        content._gsap.y = y + "px";
        scrollFuncY.cacheID = _scrollers.cache;
        _updateAll();
      }
      return true;
    }
    scrollFuncY.offset && removeContentOffset();
    skipTouchMove = true;
  }, tween, startScrollX, startScrollY, onStopDelayedCall, onResize = function onResize2() {
    updateClamps();
    if (tween.isActive() && tween.vars.scrollY > maxY) {
      scrollFuncY() > maxY ? tween.progress(1) && scrollFuncY(maxY) : tween.resetTo("scrollY", maxY);
    }
  };
  content && gsap.set(content, {
    y: "+=0"
  });
  vars.ignoreCheck = function(e) {
    return _fixIOSBug && e.type === "touchmove" && ignoreDrag() || scale > 1.05 && e.type !== "touchstart" || self.isGesturing || e.touches && e.touches.length > 1;
  };
  vars.onPress = function() {
    skipTouchMove = false;
    var prevScale = scale;
    scale = _round((_win.visualViewport && _win.visualViewport.scale || 1) / initialScale);
    tween.pause();
    prevScale !== scale && _allowNativePanning(target, scale > 1.01 ? true : normalizeScrollX ? false : "x");
    startScrollX = scrollFuncX();
    startScrollY = scrollFuncY();
    updateClamps();
    lastRefreshID = _refreshID;
  };
  vars.onRelease = vars.onGestureStart = function(self2, wasDragging) {
    scrollFuncY.offset && removeContentOffset();
    if (!wasDragging) {
      onStopDelayedCall.restart(true);
    } else {
      _scrollers.cache++;
      var dur = resolveMomentumDuration(), currentScroll, endScroll;
      if (normalizeScrollX) {
        currentScroll = scrollFuncX();
        endScroll = currentScroll + dur * 0.05 * -self2.velocityX / 0.227;
        dur *= _clampScrollAndGetDurationMultiplier(scrollFuncX, currentScroll, endScroll, _maxScroll(target, _horizontal));
        tween.vars.scrollX = scrollClampX(endScroll);
      }
      currentScroll = scrollFuncY();
      endScroll = currentScroll + dur * 0.05 * -self2.velocityY / 0.227;
      dur *= _clampScrollAndGetDurationMultiplier(scrollFuncY, currentScroll, endScroll, _maxScroll(target, _vertical));
      tween.vars.scrollY = scrollClampY(endScroll);
      tween.invalidate().duration(dur).play(0.01);
      if (_fixIOSBug && tween.vars.scrollY >= maxY || currentScroll >= maxY - 1) {
        gsap.to({}, {
          onUpdate: onResize,
          duration: dur
        });
      }
    }
    onRelease && onRelease(self2);
  };
  vars.onWheel = function() {
    tween._ts && tween.pause();
    if (_getTime() - wheelRefresh > 1e3) {
      lastRefreshID = 0;
      wheelRefresh = _getTime();
    }
  };
  vars.onChange = function(self2, dx, dy, xArray, yArray) {
    _refreshID !== lastRefreshID && updateClamps();
    dx && normalizeScrollX && scrollFuncX(scrollClampX(xArray[2] === dx ? startScrollX + (self2.startX - self2.x) : scrollFuncX() + dx - xArray[1]));
    if (dy) {
      scrollFuncY.offset && removeContentOffset();
      var isTouch = yArray[2] === dy, y = isTouch ? startScrollY + self2.startY - self2.y : scrollFuncY() + dy - yArray[1], yClamped = scrollClampY(y);
      isTouch && y !== yClamped && (startScrollY += yClamped - y);
      scrollFuncY(yClamped);
    }
    (dy || dx) && _updateAll();
  };
  vars.onEnable = function() {
    _allowNativePanning(target, normalizeScrollX ? false : "x");
    ScrollTrigger.addEventListener("refresh", onResize);
    _addListener(_win, "resize", onResize);
    if (scrollFuncY.smooth) {
      scrollFuncY.target.style.scrollBehavior = "auto";
      scrollFuncY.smooth = scrollFuncX.smooth = false;
    }
    inputObserver.enable();
  };
  vars.onDisable = function() {
    _allowNativePanning(target, true);
    _removeListener(_win, "resize", onResize);
    ScrollTrigger.removeEventListener("refresh", onResize);
    inputObserver.kill();
  };
  vars.lockAxis = vars.lockAxis !== false;
  self = new Observer(vars);
  self.iOS = _fixIOSBug;
  _fixIOSBug && !scrollFuncY() && scrollFuncY(1);
  _fixIOSBug && gsap.ticker.add(_passThrough);
  onStopDelayedCall = self._dc;
  tween = gsap.to(self, {
    ease: "power4",
    paused: true,
    inherit: false,
    scrollX: normalizeScrollX ? "+=0.1" : "+=0",
    scrollY: "+=0.1",
    modifiers: {
      scrollY: _interruptionTracker(scrollFuncY, scrollFuncY(), function() {
        return tween.pause();
      })
    },
    onUpdate: _updateAll,
    onComplete: onStopDelayedCall.vars.onComplete
  });
  return self;
};
ScrollTrigger.sort = function(func) {
  if (_isFunction(func)) {
    return _triggers.sort(func);
  }
  var scroll = _win.pageYOffset || 0;
  ScrollTrigger.getAll().forEach(function(t) {
    return t._sortY = t.trigger ? scroll + t.trigger.getBoundingClientRect().top : t.start + _win.innerHeight;
  });
  return _triggers.sort(func || function(a, b) {
    return (a.vars.refreshPriority || 0) * -1e6 + (a.vars.containerAnimation ? 1e6 : a._sortY) - ((b.vars.containerAnimation ? 1e6 : b._sortY) + (b.vars.refreshPriority || 0) * -1e6);
  });
};
ScrollTrigger.observe = function(vars) {
  return new Observer(vars);
};
ScrollTrigger.normalizeScroll = function(vars) {
  if (typeof vars === "undefined") {
    return _normalizer;
  }
  if (vars === true && _normalizer) {
    return _normalizer.enable();
  }
  if (vars === false) {
    _normalizer && _normalizer.kill();
    _normalizer = vars;
    return;
  }
  var normalizer = vars instanceof Observer ? vars : _getScrollNormalizer(vars);
  _normalizer && _normalizer.target === normalizer.target && _normalizer.kill();
  _isViewport(normalizer.target) && (_normalizer = normalizer);
  return normalizer;
};
ScrollTrigger.core = {
  // smaller file size way to leverage in ScrollSmoother and Observer
  _getVelocityProp,
  _inputObserver,
  _scrollers,
  _proxies,
  bridge: {
    // when normalizeScroll sets the scroll position (ss = setScroll)
    ss: function ss() {
      _lastScrollTime || _dispatch("scrollStart");
      _lastScrollTime = _getTime();
    },
    // a way to get the _refreshing value in Observer
    ref: function ref() {
      return _refreshing;
    }
  }
};
_getGSAP() && gsap.registerPlugin(ScrollTrigger);

gsapWithCSS.registerPlugin(ScrollTrigger);
const LandingPage = () => {
  const [, setLocation] = useLocation();
  const [showPrizeDetails, setShowPrizeDetails] = reactExports.useState(false);
  const [showAgeVerification, setShowAgeVerification] = reactExports.useState(false);
  const [showInviteFriend, setShowInviteFriend] = reactExports.useState(false);
  const [showEmergencyLogin, setShowEmergencyLogin] = reactExports.useState(false);
  const [flippedCards, setFlippedCards] = reactExports.useState([]);
  const [imageLoaded, setImageLoaded] = reactExports.useState(false);
  const { t } = useLandingTranslations();
  const heroRef = reactExports.useRef(null);
  const titleRef = reactExports.useRef(null);
  const sectionsRef = reactExports.useRef([]);
  const [isTypingComplete, setIsTypingComplete] = reactExports.useState(false);
  console.log("🌟 M1SSION™ LANDING PAGE - Xavier Cusso Style - Showing to anonymous user");
  reactExports.useEffect(() => {
    if (titleRef.current) {
      gsapWithCSS.fromTo(
        titleRef.current.children,
        { y: 100, opacity: 0 },
        { y: 0, opacity: 1, duration: 1, stagger: 0.15, ease: "power2.out" }
      );
    }
    sectionsRef.current.forEach((section, index) => {
      if (section) {
        gsapWithCSS.fromTo(
          section,
          { y: 30, opacity: 0 },
          {
            y: 0,
            opacity: 1,
            duration: 0.6,
            scrollTrigger: {
              trigger: section,
              start: "top 85%",
              end: "bottom 15%",
              toggleActions: "play none none reverse",
              fastScrollEnd: true
            }
          }
        );
      }
    });
    return () => {
      ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
    };
  }, []);
  reactExports.useEffect(() => {
    const handleStatusBarTap = (e) => {
      if (e.touches[0].clientY <= 44 && window.scrollY > 100) {
        e.preventDefault();
        window.scrollTo({
          top: 0,
          behavior: "smooth"
        });
      }
    };
    if ("ontouchstart" in window) {
      document.addEventListener("touchstart", handleStatusBarTap, { passive: false });
    }
    return () => {
      if ("ontouchstart" in window) {
        document.removeEventListener("touchstart", handleStatusBarTap);
      }
    };
  }, []);
  const [logoClickCount, setLogoClickCount] = reactExports.useState(0);
  reactExports.useEffect(() => {
    const handleKeySequence = (e) => {
      if (e.ctrlKey && e.shiftKey && e.key === "E") {
        console.log("🚨 EMERGENCY ACCESS TRIGGERED - Keyboard");
        setShowEmergencyLogin(true);
        e.preventDefault();
      }
    };
    document.addEventListener("keydown", handleKeySequence);
    return () => document.removeEventListener("keydown", handleKeySequence);
  }, []);
  const handleRegisterClick = () => {
    console.log("🚀 M1SSION™ User clicking register button - redirecting to /register");
    setLocation("/register");
  };
  const openInviteFriend = () => {
    setShowInviteFriend(true);
  };
  const handleCardClick = (index) => {
    console.log(`🔄 Card ${index} clicked, current flipped:`, flippedCards);
    setFlippedCards(
      (prev) => prev.includes(index) ? [] : [index]
      // Altrimenti apri solo questa
    );
  };
  const steps = [
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(UserCheck, { className: "w-8 h-8 text-[#00E5FF]" }),
      title: "Registrazione",
      description: "Crea il tuo account su M1SSION e preparati alla sfida",
      details: "Accesso gratuito con il piano Base. Scegli tra 5 piani di abbonamento per accedere a indizi premium, eventi esclusivi e vantaggi unici. La registrazione include verifica dell'identità per garantire sicurezza e conformità normativa."
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-8 h-8 text-[#00E5FF]" }),
      title: "Ricevi Indizi",
      description: "Ogni settimana ricevi nuovi indizi via app ed email",
      details: "Gli indizi arrivano attraverso notifiche push, email crittografate e aggiornamenti in-app. Ogni piano offre un numero diverso di indizi settimanali: dal piano Base (1 indizio) al Titanium (8 indizi totali)."
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-8 h-8 text-[#FFC107]" }),
      title: "Risolvi la Missione",
      description: "Analizza gli indizi e trova la posizione del premio",
      details: "Usa la mappa interattiva, decrittografa i codici, analizza pattern e coordinate GPS. Gli indizi sono interconnessi e richiedono logica, intuito e capacità di analisi per rivelare la posizione finale del tesoro."
    },
    {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-8 h-8 text-[#FF00FF]" }),
      title: "Vinci davvero",
      description: "Se sei il primo a trovare il premio, diventa tuo!",
      details: "I premi sono reali: auto di lusso, orologi, gioielli e altri oggetti di valore. Solo il primo che raggiunge la posizione esatta e completa la verifica finale ottiene il premio. Nessuna simulazione, solo vittorie concrete."
    }
  ];
  const subscriptions = [
    {
      title: "Base – Gratis",
      price: "€0",
      period: "/mese",
      highlight: false,
      features: [
        "Funzioni base (accesso alla missione con restrizioni)",
        "Supporto email standard",
        "1 indizio settimanale base"
      ],
      notIncluded: [
        "Nessun accesso anticipato agli eventi",
        "Nessun badge esclusivo"
      ],
      buttonText: "Inizia Gratis",
      buttonColor: "bg-gradient-to-r from-[#00E5FF] to-[#008eb3] text-black hover:shadow-[0_0_15px_rgba(0,229,255,0.5)]"
    },
    {
      title: "Silver",
      price: "€3.99",
      period: "/mese",
      features: [
        "Tutti i vantaggi Base",
        "3 indizi premium aggiuntivi a settimana",
        "Accesso anticipato di 2 ore agli eventi",
        "Badge Silver nel profilo"
      ],
      buttonText: "Scegli Silver",
      buttonColor: "bg-gradient-to-r from-[#C0C0C0] to-[#919191] text-black hover:shadow-[0_0_15px_rgba(192,192,192,0.5)]"
    },
    {
      title: "Gold",
      price: "€6.99",
      period: "/mese",
      highlight: true,
      features: [
        "Tutti i vantaggi Silver",
        "4 indizi premium aggiuntivi a settimana",
        "Accesso anticipato di 12 ore agli eventi",
        "Partecipazione alle estrazioni Gold",
        "Badge Gold esclusivo nel profilo"
      ],
      buttonText: "Scegli Gold",
      buttonColor: "bg-gradient-to-r from-[#FFD700] to-[#FFA500] text-black hover:shadow-[0_0_15px_rgba(255,215,0,0.5)]"
    },
    {
      title: "Black",
      price: "€9.99",
      period: "/mese",
      features: [
        "Tutti i vantaggi Gold",
        "Accesso VIP anticipato di 24 ore agli eventi",
        "5 indizi premium aggiuntivi a settimana",
        "Badge Black esclusivo"
      ],
      buttonText: "Scegli Black",
      buttonColor: "bg-gradient-to-r from-[#1A1A1A] to-[#333333] text-white hover:shadow-[0_0_15px_rgba(0,0,0,0.7)]"
    },
    {
      title: "Titanium",
      price: "€29.99",
      period: "/mese",
      features: [
        "Tutti i vantaggi Black",
        "7 indizi premium aggiuntivi a settimana",
        "Accesso VIP anticipato di 48 ore agli eventi",
        "Supporto prioritario dedicato (24/7)",
        "Eventi esclusivi M1SSION™",
        "Badge Titanium esclusivo"
      ],
      buttonText: "Scegli Titanium",
      buttonColor: "bg-gradient-to-r from-[#E6E6FA] to-[#FFD700] text-black hover:shadow-[0_0_15px_rgba(230,230,250,0.8)]"
    }
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-black overflow-x-hidden relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "fixed inset-0 pointer-events-none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-black via-gray-900 to-black opacity-80" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-[radial-gradient(circle_at_20%_50%,rgba(0,229,255,0.1),transparent_50%)]" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-[radial-gradient(circle_at_80%_20%,rgba(255,0,255,0.1),transparent_50%)]" }),
      [...Array(30)].map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "absolute rounded-full opacity-20",
          style: {
            width: `${Math.random() * 4 + 2}px`,
            height: `${Math.random() * 4 + 2}px`,
            background: i % 2 === 0 ? "#00E5FF" : "#FF00FF",
            left: `${Math.random() * 100}%`,
            top: `${Math.random() * 100}%`
          },
          animate: {
            y: [0, -30, 0],
            x: [0, 15, -15, 0],
            opacity: [0.1, 0.3, 0.1]
          },
          transition: {
            duration: Math.random() * 20 + 15,
            repeat: Infinity,
            ease: "easeInOut",
            delay: Math.random() * 10
          }
        },
        i
      ))
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "fixed bottom-8 right-8 z-40 flex flex-col gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.button,
        {
          onClick: () => setShowPrizeDetails(true),
          className: "p-4 rounded-full bg-cyan-500/20 backdrop-blur-sm border border-cyan-400/30 text-cyan-400 hover:bg-cyan-500/30 transition-all duration-300",
          whileHover: { scale: 1.1 },
          whileTap: { scale: 0.95 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "h-6 w-6" })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.button,
        {
          onClick: openInviteFriend,
          className: "p-4 rounded-full bg-purple-500/20 backdrop-blur-sm border border-purple-400/30 text-purple-400 hover:bg-purple-500/30 transition-all duration-300",
          whileHover: { scale: 1.1 },
          whileTap: { scale: 0.95 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(UserPlus, { className: "h-6 w-6" })
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "section",
      {
        ref: heroRef,
        className: "relative min-h-screen w-full flex flex-col items-center justify-center text-center px-4 py-20 overflow-hidden",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "z-10 max-w-6xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "h1",
              {
                ref: titleRef,
                className: "text-6xl md:text-7xl lg:text-[8rem] font-black leading-none mb-6",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 glow-text block drop-shadow-[0_0_30px_rgba(0,229,255,0.8)]", children: "M1" }) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "overflow-hidden -mt-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white block", children: [
                    "SSION",
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-2xl align-top", children: "™" })
                  ] }) })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.p,
              {
                className: "text-2xl md:text-3xl font-light tracking-[0.3em] mb-12 uppercase",
                style: { color: "#00FF00" },
                initial: { opacity: 0, y: 20 },
                animate: { opacity: 1, y: 0 },
                transition: { duration: 0.8, delay: 1.5 },
                children: "M1SSION STARTS ON 19 DECEMBER"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.p,
              {
                className: "text-xl md:text-2xl text-gray-400 mb-16 max-w-4xl mx-auto leading-relaxed",
                initial: { opacity: 0, y: 20 },
                animate: { opacity: 1, y: 0 },
                transition: { duration: 0.8, delay: 2 },
                children: t("heroDescription")
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "text-yellow-300 text-lg md:text-xl tracking-[0.5em] mb-16 relative font-light",
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                transition: { duration: 0.8, delay: 2.5 },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(TypingEffect, { text: "IT IS POSSIBLE", onComplete: () => setIsTypingComplete(true) })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "flex flex-col sm:flex-row gap-6 justify-center items-center",
                initial: { opacity: 0, y: 30 },
                animate: { opacity: 1, y: 0 },
                transition: { duration: 0.8, delay: 3 },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.button,
                    {
                      className: "px-12 py-6 rounded-full bg-gradient-to-r from-cyan-400 to-purple-600 text-black text-xl font-black uppercase tracking-wider hover:shadow-[0_0_40px_rgba(34,211,238,0.8)] transition-all duration-300 relative group",
                      onClick: handleRegisterClick,
                      whileHover: { scale: 1.05 },
                      whileTap: { scale: 0.95 },
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "relative z-10", children: t("joinTheHunt") }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          motion.div,
                          {
                            className: "absolute inset-0 bg-gradient-to-r from-purple-600 to-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-full"
                          }
                        )
                      ]
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.button,
                    {
                      className: "px-12 py-6 rounded-full text-white font-black uppercase tracking-wider bg-white/5 border-2 border-white/20 hover:bg-white/10 hover:border-cyan-400/50 hover:text-cyan-400 transition-all duration-300",
                      whileHover: { scale: 1.05 },
                      whileTap: { scale: 0.95 },
                      children: t("learnMore")
                    }
                  )
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "absolute bottom-12 left-1/2 transform -translate-x-1/2",
              animate: { y: [0, 10, 0] },
              transition: { duration: 2, repeat: Infinity, ease: "easeInOut" },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowDown, { className: "w-8 h-8 text-white/40" })
            }
          )
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "section",
      {
        ref: (el) => el && (sectionsRef.current[0] = el),
        className: "relative py-32 px-4",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-purple-900/20 via-transparent to-cyan-900/20" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-7xl mx-auto relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "text-center mb-16",
                initial: { opacity: 0, y: 30 },
                whileInView: { opacity: 1, y: 0 },
                transition: { duration: 0.8 },
                viewport: { once: true },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-4xl md:text-5xl font-black mb-6 text-white leading-none", children: t("realPrizes") }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xl text-gray-400 max-w-2xl mx-auto", children: t("realPrizesDescription") })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "relative h-[40vh] md:h-[50vh] lg:h-[60vh] rounded-3xl bg-black/40 backdrop-blur-sm border border-white/10 overflow-hidden",
                whileHover: { scale: 1.02 },
                transition: { duration: 0.5 },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-cyan-500/20 via-transparent to-purple-500/20 opacity-60" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "img",
                    {
                      src: "/lovable-uploads/eccb4710-0336-46f8-9137-906f61fbdebd.png",
                      alt: "M1SSION PREMI IN PALIO - Ferrari, Lamborghini, Rolex",
                      className: "w-full h-full object-cover object-center",
                      style: {
                        objectFit: "cover",
                        objectPosition: "center",
                        aspectRatio: "16/9"
                      },
                      onLoad: () => {
                        console.log("✅ Immagine Premi in Palio caricata con successo");
                        setImageLoaded(true);
                      },
                      onError: (e) => {
                        console.log("❌ Errore caricamento immagine, usando fallback");
                        setImageLoaded(false);
                        e.currentTarget.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='450' viewBox='0 0 800 450'%3E%3Crect width='800' height='450' fill='%23000'/%3E%3Ctext x='400' y='225' font-family='Arial, sans-serif' font-size='24' fill='%2300E5FF' text-anchor='middle' dy='.3em'%3EM1SSION PREMI IN PALIO%3C/text%3E%3C/svg%3E";
                      }
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400/30 to-transparent",
                      animate: { x: ["-100%", "100%"] },
                      transition: { duration: 4, repeat: Infinity, ease: "easeInOut" }
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-4 right-4 text-white/60 text-xs font-normal bg-black/20 backdrop-blur-sm px-2 py-1 rounded border border-white/10", children: "Image for illustration purposes only" })
                ]
              }
            )
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.section,
      {
        className: "relative py-16 px-4 bg-black",
        initial: { opacity: 0, y: 40 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
        viewport: { once: true },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.h3,
            {
              className: "text-2xl md:text-3xl font-bold mb-6 text-white",
              initial: { opacity: 0 },
              whileInView: { opacity: 1 },
              transition: { duration: 0.6, delay: 0.2 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: "SSION" }),
                " in arrivo"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "relative w-full h-3 bg-black/60 rounded-full overflow-hidden border border-white/20 mb-4",
              initial: { scale: 0.8, opacity: 0 },
              whileInView: { scale: 1, opacity: 1 },
              transition: { duration: 0.6, delay: 0.4 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "h-full rounded-full relative overflow-hidden",
                    style: {
                      background: "linear-gradient(90deg, #00E5FF, #FF00FF, #00E5FF)"
                    },
                    animate: {
                      background: [
                        "linear-gradient(90deg, #00E5FF, #FF00FF, #00E5FF)",
                        "linear-gradient(90deg, #FF00FF, #00E5FF, #FF00FF)",
                        "linear-gradient(90deg, #00E5FF, #FF00FF, #00E5FF)"
                      ],
                      width: ["0%", "78%"]
                    },
                    transition: {
                      background: { duration: 3, repeat: Infinity, ease: "easeInOut" },
                      width: { duration: 2, ease: "easeOut" }
                    }
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent",
                    animate: { x: ["-100%", "100%"] },
                    transition: { duration: 2, repeat: Infinity, ease: "easeInOut" }
                  }
                )
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.p,
            {
              className: "text-white/70 text-sm",
              initial: { opacity: 0 },
              whileInView: { opacity: 1 },
              transition: { duration: 0.6, delay: 0.6 },
              children: "78% completato - La caccia inizia presto"
            }
          )
        ] })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.section,
      {
        className: "relative py-20 px-4 bg-black",
        initial: { opacity: 0, y: 40 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
        viewport: { once: true },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: "glass-card p-8 md:p-12 text-center relative overflow-hidden",
            whileHover: { scale: 1.01 },
            transition: { duration: 0.3 },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-3xl md:text-4xl font-orbitron mb-8", children: [
                "WELCOME TO",
                " ",
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                    "SSION",
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" })
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg mb-6 max-w-3xl mx-auto text-gray-200", children: "In the near future... The world becomes a gameboard. The clues are encrypted. The stakes are real." }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg mb-6 max-w-3xl mx-auto text-gray-200", children: "Thousands will try. Only a few will see the pattern. You're not just chasing a prize—you're chasing the proof that you can outthink them all." }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg mb-6 max-w-3xl mx-auto text-gray-200", children: [
                "This is ",
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                  "SSION",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" })
                ] }),
                ". The countdown has begun. Are you ready?"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-400/40 to-transparent" })
            ]
          }
        ) })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.section,
      {
        className: "relative py-20 px-4",
        initial: { opacity: 0, y: 40 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
        viewport: { once: true },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-purple-900/40 via-cyan-900/40 to-pink-900/40" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-lg mx-auto relative z-10", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "relative m1ssion-glass-card overflow-hidden bg-black/60 backdrop-blur-xl shadow-lg p-10 text-center",
              whileHover: { scale: 1.02 },
              transition: { duration: 0.3 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-2xl md:text-3xl font-bold mb-2", children: [
                  "Registrati per",
                  " ",
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                      "SSION",
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" })
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-6", children: "Ottieni accesso esclusivo e un codice referral unico. Preparati per l'avventura che cambierà tutto." }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    whileHover: { scale: 1.05 },
                    whileTap: { scale: 0.98 },
                    className: "relative overflow-hidden rounded-xl",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          className: "absolute inset-0",
                          style: {
                            background: "linear-gradient(45deg, #ec4899, #d946ef, #ec4899, #d946ef)"
                          },
                          animate: {
                            background: [
                              "linear-gradient(45deg, #ec4899, #d946ef, #ec4899, #d946ef)",
                              "linear-gradient(135deg, #d946ef, #ec4899, #d946ef, #ec4899)",
                              "linear-gradient(45deg, #ec4899, #d946ef, #ec4899, #d946ef)"
                            ]
                          },
                          transition: { duration: 3, repeat: Infinity, ease: "easeInOut" }
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Button,
                        {
                          onClick: handleRegisterClick,
                          className: "relative w-full bg-transparent text-white text-xl font-bold py-4 px-12 hover:bg-transparent transition-all duration-300 shadow-lg hover:shadow-cyan-500/30",
                          style: {
                            boxShadow: "0 0 20px rgba(236, 72, 153, 0.3)"
                          },
                          onMouseEnter: (e) => {
                            e.currentTarget.style.boxShadow = "0 0 30px rgba(0, 229, 255, 0.5), 0 0 60px rgba(236, 72, 153, 0.3)";
                          },
                          onMouseLeave: (e) => {
                            e.currentTarget.style.boxShadow = "0 0 20px rgba(236, 72, 153, 0.3)";
                          },
                          children: "START M1SSION"
                        }
                      )
                    ]
                  }
                ) })
              ]
            }
          ) })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.section,
      {
        className: "py-20 px-4 bg-black",
        initial: { opacity: 0, y: 40 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
        viewport: { once: true },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-3xl md:text-4xl font-bold mb-12 text-center", children: [
            "Scopri ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: "SSION" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12 relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "hidden lg:block absolute top-16 left-[12.5%] right-[12.5%] h-0.5 bg-gradient-to-r from-[#00E5FF] via-[#FFC107] to-[#FF00FF] z-0" }),
            steps.map((step, index) => {
              const isFlipped = flippedCards.includes(index);
              return /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  className: "relative z-10 perspective-1000",
                  initial: { y: 30, opacity: 0 },
                  whileInView: { y: 0, opacity: 1 },
                  transition: { duration: 0.5, delay: index * 0.1 },
                  viewport: { once: true },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "absolute -top-4 -left-4 w-10 h-10 rounded-full bg-black border border-white/10 flex items-center justify-center font-bold text-white z-30", children: index + 1 }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(
                      "div",
                      {
                        className: `mission-flip-card h-64 cursor-pointer ${isFlipped ? "is-flipped" : ""}`,
                        onClick: () => handleCardClick(index),
                        children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mission-card-front glass-card", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-4 p-3 rounded-full bg-black/50 border border-white/10", children: step.icon }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold mb-2 text-white", children: step.title }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-4 leading-relaxed", children: step.description }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 text-sm font-medium", children: "Clicca per saperne di più" })
                          ] }),
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mission-card-back glass-card bg-gradient-to-br from-cyan-900/40 to-purple-900/40 border border-cyan-400/30", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-3 p-2 rounded-full bg-cyan-400/20", children: step.icon }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-bold mb-3 text-cyan-300", children: step.title }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/90 text-sm leading-relaxed mb-4", children: step.details }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-300 text-xs font-medium", children: "Clicca per tornare indietro" })
                          ] })
                        ]
                      }
                    )
                  ]
                },
                index
              );
            })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleRegisterClick,
              className: "bg-gradient-to-r from-[#00E5FF] to-[#00BFFF] text-black font-bold px-8 py-6 rounded-full text-lg hover:shadow-[0_0_15px_rgba(0,229,255,0.5)]",
              size: "lg",
              children: "Inizia La Tua M1SSION"
            }
          ) })
        ] })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("section", { className: "py-12 px-4 bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl md:text-3xl font-bold text-white mb-4", children: "Stay Updated" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-8", children: "Get the latest updates about M1SSION™ and be the first to know about new challenges." })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "py-16 px-4 bg-black relative", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-gradient-to-br from-black via-gray-900 to-black opacity-80" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative z-10 max-w-7xl mx-auto", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, y: 20 },
            whileInView: { opacity: 1, y: 0 },
            transition: { duration: 0.6 },
            viewport: { once: true },
            className: "text-center mb-12",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-3xl md:text-4xl font-bold inline-block", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: "SSION" }),
                " Abbonamenti"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-4 text-white/70 max-w-2xl mx-auto", children: "Scegli il piano più adatto a te e inizia la tua avventura. Tutti i piani offrono la possibilità di vincere premi reali." })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-12", children: subscriptions.map((sub, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            className: `rounded-xl relative p-4 ${sub.highlight ? "bg-gradient-to-b from-[#00E5FF]/20 to-black/70 border border-[#00E5FF]/30" : "bg-white/5 border border-white/10"}`,
            initial: { opacity: 0, y: 30 },
            whileInView: { opacity: 1, y: 0 },
            transition: { delay: index * 0.1, duration: 0.5 },
            viewport: { once: true },
            whileHover: { y: -5, transition: { duration: 0.2 } },
            children: [
              sub.highlight && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute -top-3 -right-3 bg-[#00E5FF] text-black text-xs font-bold py-1 px-2 rounded-full flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-3 h-3 mr-1" }),
                "Top"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-bold text-white", children: sub.title }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xl font-bold text-white", children: sub.price }),
                  sub.period && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/50 text-xs", children: sub.period })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 mb-4", children: [
                sub.features.slice(0, 3).map((feature, idx) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 text-green-400 mr-2 mt-0.5 flex-shrink-0" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80 text-sm", children: feature })
                ] }, idx)),
                sub.features.length > 3 && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/60 text-xs", children: [
                  "+",
                  sub.features.length - 3,
                  " altri vantaggi"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: handleRegisterClick,
                  className: `w-full text-sm py-2 ${sub.buttonColor}`,
                  disabled: false,
                  children: sub.buttonText
                }
              )
            ]
          },
          index
        )) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-sm", children: "Tutti i piani sono soggetti ai termini e condizioni di servizio." }) })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("section", { className: "py-20 px-4 bg-black relative", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-lg mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "glass-card p-8 text-center",
        initial: { opacity: 0, scale: 0.95 },
        whileInView: { opacity: 1, scale: 1 },
        transition: { duration: 0.5 },
        viewport: { once: true },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(IdCard, { className: "w-16 h-16 text-purple-400 mx-auto mb-4" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-white mb-2", children: "Verifica la tua identità" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Per garantire un'esperienza di gioco sicura e conforme alle normative, è necessario completare la verifica dell'identità prima di ricevere premi." })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleRegisterClick,
              className: "bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold px-8 py-3 rounded-full hover:shadow-[0_0_15px_rgba(128,0,128,0.5)]",
              children: "Vai alla verifica identità"
            }
          )
        ]
      }
    ) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("section", { className: "py-20 px-4 bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "glass-card p-8 md:p-12 text-center relative overflow-hidden",
        initial: { opacity: 0, y: 30 },
        whileInView: { opacity: 1, y: 0 },
        transition: { duration: 0.6 },
        viewport: { once: true },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-3xl md:text-4xl font-bold mb-8 text-white", children: [
            "Installa ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "M1" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
              "SSION",
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg mb-8 text-gray-200", children: "Per installare M1SSION™ sul tuo dispositivo mobile:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4 mb-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center text-gray-300", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "mr-2", children: "📱" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "iOS (Safari):" }),
                ' premi il tasto "Condividi" e seleziona "Aggiungi alla Home"'
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center text-gray-300", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "mr-2", children: "🤖" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Android (Chrome):" }),
                ' apri il menu ⋮ e premi "Installa App"'
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleRegisterClick,
              className: "bg-blue-600 hover:bg-blue-700 text-white font-bold px-8 py-3 rounded-full",
              children: "Aggiungi M1SSION™ alla tua Home"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-400/40 to-transparent" })
        ]
      }
    ) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(LandingFooter, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(CookieBanner$1, {}),
    showEmergencyLogin && /* @__PURE__ */ jsxRuntimeExports.jsx(AdminEmergencyLogin, { onClose: () => setShowEmergencyLogin(false) }),
    showPrizeDetails && /* @__PURE__ */ jsxRuntimeExports.jsx(
      PrizeDetailsModal,
      {
        isOpen: showPrizeDetails,
        onClose: () => setShowPrizeDetails(false)
      }
    ),
    showAgeVerification && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/75 flex items-center justify-center z-[9999] p-4", style: { paddingTop: "calc(env(safe-area-inset-top, 0px) + 20px)", paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 20px)" }, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "bg-black/90 border border-purple-500/30 rounded-xl p-6 max-w-md w-full relative",
        initial: { opacity: 0, scale: 0.9 },
        animate: { opacity: 1, scale: 1 },
        exit: { opacity: 0, scale: 0.9 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: () => setShowAgeVerification(false),
              className: "absolute top-4 right-4 text-white/60 hover:text-white",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-6 h-6" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white mb-4", children: "Verifica dell'età" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-6", children: "Confermi di avere almeno 18 anni? Questo gioco è riservato ai maggiorenni." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: () => {
                    setShowAgeVerification(false);
                    handleRegisterClick();
                  },
                  className: "flex-1 bg-green-600 hover:bg-green-700 text-white",
                  children: "Sì, ho 18+ anni"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: () => setShowAgeVerification(false),
                  variant: "outline",
                  className: "flex-1",
                  children: "No"
                }
              )
            ] })
          ] })
        ]
      }
    ) }),
    showInviteFriend && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/75 flex items-center justify-center z-50 p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "bg-black/90 border border-purple-500/30 rounded-xl p-6 max-w-md w-full relative",
        initial: { opacity: 0, scale: 0.9 },
        animate: { opacity: 1, scale: 1 },
        exit: { opacity: 0, scale: 0.9 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: () => setShowInviteFriend(false),
              className: "absolute top-4 right-4 text-white/60 hover:text-white",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-6 h-6" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white mb-4", children: "Invita un amico" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-6", children: "Condividi M1SSION™ con i tuoi amici e guadagna vantaggi esclusivi!" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => {
                  setShowInviteFriend(false);
                  handleRegisterClick();
                },
                className: "bg-purple-600 hover:bg-purple-700 text-white",
                children: "Ottieni il tuo codice referral"
              }
            )
          ] })
        ]
      }
    ) })
  ] });
};
const TypingEffect = ({ text, onComplete }) => {
  const [displayText, setDisplayText] = reactExports.useState("");
  const [currentIndex, setCurrentIndex] = reactExports.useState(0);
  reactExports.useEffect(() => {
    if (currentIndex < text.length) {
      const timer = setTimeout(() => {
        setDisplayText((prev) => prev + text[currentIndex]);
        setCurrentIndex((prev) => prev + 1);
      }, 120);
      return () => clearTimeout(timer);
    } else if (onComplete) {
      onComplete();
    }
  }, [currentIndex, text, onComplete]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "inline-block", children: [
    displayText,
    currentIndex < text.length && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.span,
      {
        className: "inline-block w-0.5 h-6 bg-yellow-300 ml-1",
        animate: { opacity: [1, 0] },
        transition: { duration: 0.5, repeat: Infinity, ease: "easeInOut" }
      }
    )
  ] });
};

const Skeleton$1 = ({
  className,
  variant = "rectangular",
  width,
  height,
  animate = true
}) => {
  const baseStyles = "bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 bg-[length:200%_100%]";
  const animationStyles = animate ? "animate-shimmer" : "";
  const variantStyles = {
    text: "h-4 rounded",
    circular: "rounded-full",
    rectangular: "rounded-lg",
    card: "rounded-xl",
    avatar: "rounded-full w-10 h-10",
    button: "rounded-lg h-10"
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: cn(baseStyles, animationStyles, variantStyles[variant], className),
      style: {
        width: width ?? (variant === "avatar" ? 40 : "100%"),
        height: height ?? (variant === "text" ? 16 : variant === "avatar" ? 40 : "auto")
      }
    }
  );
};
const SkeletonCard = ({ className }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: cn("p-4 rounded-xl bg-slate-900/50 border border-slate-800/50 space-y-3", className), children: [
  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "avatar" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "60%" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "40%", height: 12 })
    ] })
  ] }),
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", height: 80 }),
  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "button", width: "30%" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "button", width: "30%" })
  ] })
] });
const SkeletonList = ({ count = 3, className }) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn("space-y-3", className), children: Array.from({ length: count }).map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 rounded-lg bg-slate-900/30", children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "avatar" }),
  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-2", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "70%" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "50%", height: 12 })
  ] })
] }, i)) });
const SkeletonProfile = ({ className }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: cn("text-center space-y-4", className), children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "circular", width: 80, height: 80, className: "mx-auto" }),
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: 120, className: "mx-auto" }),
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: 180, height: 12, className: "mx-auto" }),
  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-center gap-4 mt-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", width: 60, height: 60 }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", width: 60, height: 60 }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", width: 60, height: 60 })
  ] })
] });
const SkeletonMap = ({ className }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: cn("relative w-full h-full min-h-[400px] rounded-xl overflow-hidden", className), children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "rectangular", className: "absolute inset-0", animate: false }),
  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-slate-400 font-orbitron", children: "Inizializzazione mappa..." })
  ] }) })
] });
const SkeletonStats = ({ count = 4, className }) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn("grid grid-cols-2 gap-3", className), children: Array.from({ length: count }).map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 rounded-lg bg-slate-900/30 border border-slate-800/50", children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "40%", height: 12 }),
  /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: "60%", height: 24, className: "mt-2" })
] }, i)) });
const PageSkeleton = ({ variant = "default" }) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-background p-4 space-y-4 animate-fadeIn", children: [
  variant === "profile" && /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonProfile, {}),
  variant === "list" && /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonList, { count: 5 }),
  variant === "map" && /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonMap, {}),
  variant === "default" && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "text", width: 150, height: 24 }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton$1, { variant: "circular", width: 32, height: 32 })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonStats, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonCard, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(SkeletonList, { count: 3 })
  ] })
] });

const Textarea = reactExports.forwardRef(
  ({ className, ...props }, ref) => {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      "textarea",
      {
        className: cn(
          "flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",
          className
        ),
        ref,
        ...props
      }
    );
  }
);
Textarea.displayName = "Textarea";

const CoordinateSelector = () => {
  const [coordinates, setCoordinates] = reactExports.useState([]);
  const [newCoord, setNewCoord] = reactExports.useState({
    lat: "",
    lng: "",
    label: "",
    notes: ""
  });
  const handleSaveCoordinate = () => {
    if (!newCoord.lat || !newCoord.lng || !newCoord.label) {
      ue$1.error("Lat, Lng e Label sono obbligatori");
      return;
    }
    const coordinate = {
      id: crypto.randomUUID(),
      lat: parseFloat(newCoord.lat),
      lng: parseFloat(newCoord.lng),
      label: newCoord.label,
      notes: newCoord.notes,
      createdAt: /* @__PURE__ */ new Date()
    };
    setCoordinates([...coordinates, coordinate]);
    setNewCoord({ lat: "", lng: "", label: "", notes: "" });
    ue$1.success("Coordinata salvata");
  };
  const handleCopyCoordinate = (coord) => {
    const text = `${coord.lat}, ${coord.lng}`;
    navigator.clipboard.writeText(text);
    ue$1.success("Coordinate copiate negli appunti");
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-full overflow-y-auto pb-20 space-y-8", style: {
    height: "calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 80px)",
    paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 80px)"
  }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-6 h-6 text-white" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "Coordinate Selector" })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent", children: "Aggiungi Nuova Coordinata" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "lat", children: "Latitudine" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "lat",
                type: "number",
                step: "any",
                placeholder: "46.0 [COORD-LAT]",
                value: newCoord.lat,
                onChange: (e) => setNewCoord({ ...newCoord, lat: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "lng", children: "Longitudine" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "lng",
                type: "number",
                step: "any",
                placeholder: "8.0 [COORD-LNG]",
                value: newCoord.lng,
                onChange: (e) => setNewCoord({ ...newCoord, lng: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "label", children: "Label" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "label",
              placeholder: "TARGET-ID [Punto di interesse]",
              value: newCoord.label,
              onChange: (e) => setNewCoord({ ...newCoord, label: e.target.value }),
              className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "notes", children: "Note (opzionale)" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              id: "notes",
              placeholder: "NOTES [Descrizione dettagliata...]",
              value: newCoord.notes,
              onChange: (e) => setNewCoord({ ...newCoord, notes: e.target.value }),
              className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300",
              rows: 3
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleSaveCoordinate, className: "w-full bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 rounded-xl py-4 shadow-2xl shadow-cyan-500/30 hover:shadow-cyan-500/50 transition-all duration-300 text-lg", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Save, { className: "w-4 h-4 mr-2" }),
          "Salva Coordinata"
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-lg font-semibold text-foreground", children: "Coordinate Salvate" }),
      coordinates.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/40 backdrop-blur-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-12 text-center text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-16 h-16 mx-auto mb-6 opacity-50" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg", children: "Nessuna coordinata salvata" })
      ] }) }) : coordinates.map((coord) => /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-xl hover:shadow-2xl transition-all duration-300", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "py-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-start", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "font-semibold text-foreground", children: coord.label }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-muted-foreground font-mono", children: [
            coord.lat,
            ", ",
            coord.lng
          ] }),
          coord.notes && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mt-2", children: coord.notes }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground mt-2", children: coord.createdAt.toLocaleDateString() })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            onClick: () => handleCopyCoordinate(coord),
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Copy, { className: "w-4 h-4" })
          }
        )
      ] }) }) }, coord.id))
    ] })
  ] });
};

const ClueJournal = () => {
  const [entries, setEntries] = reactExports.useState([]);
  const [searchTerm, setSearchTerm] = reactExports.useState("");
  const [showAddForm, setShowAddForm] = reactExports.useState(false);
  const [newEntry, setNewEntry] = reactExports.useState({
    title: "",
    content: "",
    week: 1,
    tags: "",
    importance: "medium"
  });
  const handleSaveEntry = () => {
    if (!newEntry.title || !newEntry.content) {
      ue$1.error("Titolo e contenuto sono obbligatori");
      return;
    }
    const entry = {
      id: crypto.randomUUID(),
      title: newEntry.title,
      content: newEntry.content,
      week: newEntry.week,
      tags: newEntry.tags.split(",").map((tag) => tag.trim()).filter((tag) => tag),
      createdAt: /* @__PURE__ */ new Date(),
      importance: newEntry.importance
    };
    setEntries([entry, ...entries]);
    setNewEntry({ title: "", content: "", week: 1, tags: "", importance: "medium" });
    setShowAddForm(false);
    ue$1.success("Voce del diario salvata");
  };
  const filteredEntries = entries.filter(
    (entry) => entry.title.toLowerCase().includes(searchTerm.toLowerCase()) || entry.content.toLowerCase().includes(searchTerm.toLowerCase()) || entry.tags.some((tag) => tag.toLowerCase().includes(searchTerm.toLowerCase()))
  );
  const getImportanceColor = (importance) => {
    switch (importance) {
      case "high":
        return "bg-red-500";
      case "medium":
        return "bg-yellow-500";
      case "low":
        return "bg-green-500";
      default:
        return "bg-gray-500";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-full overflow-y-auto pb-20 space-y-8", style: {
    height: "calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 80px)",
    paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 80px)"
  }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(BookOpen, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "Clue Journal" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: () => setShowAddForm(!showAddForm), className: "bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 rounded-xl py-3 px-6 shadow-2xl shadow-cyan-500/30 hover:shadow-cyan-500/50 transition-all duration-300", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-2" }),
        "Nuova Voce"
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Search, { className: "absolute left-3 top-3 w-4 h-4 text-muted-foreground" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          placeholder: "SEARCH [Cerca nel diario...]",
          value: searchTerm,
          onChange: (e) => setSearchTerm(e.target.value),
          className: "pl-10 bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg"
        }
      )
    ] }),
    showAddForm && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent", children: "Nuova Voce del Diario" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "title", children: "Titolo" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "title",
              placeholder: "Titolo dell'indizio...",
              value: newEntry.title,
              onChange: (e) => setNewEntry({ ...newEntry, title: e.target.value }),
              className: "bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "week", children: "Settimana" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "week",
                type: "number",
                min: "1",
                max: "4",
                value: newEntry.week,
                onChange: (e) => setNewEntry({ ...newEntry, week: parseInt(e.target.value) }),
                className: "bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "importance", children: "Importanza" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "select",
              {
                id: "importance",
                value: newEntry.importance,
                onChange: (e) => setNewEntry({ ...newEntry, importance: e.target.value }),
                className: "w-full h-10 px-3 rounded-lg bg-muted/50 border border-border text-foreground backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: "low", children: "Bassa" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: "medium", children: "Media" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: "high", children: "Alta" })
                ]
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "tags", children: "Tags (separati da virgole)" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "tags",
              placeholder: "geografia, simbolo, numero...",
              value: newEntry.tags,
              onChange: (e) => setNewEntry({ ...newEntry, tags: e.target.value }),
              className: "bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "content", children: "Contenuto" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              id: "content",
              placeholder: "Descrizione dettagliata dell'indizio...",
              value: newEntry.content,
              onChange: (e) => setNewEntry({ ...newEntry, content: e.target.value }),
              className: "bg-muted/50 border-border rounded-lg px-4 py-3 backdrop-blur-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",
              rows: 4
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleSaveEntry, className: "flex-1 bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 rounded-lg shadow-md hover:shadow-lg transition-all", children: "Salva Voce" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "outline", onClick: () => setShowAddForm(false), className: "rounded-lg", children: "Annulla" })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: filteredEntries.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-border rounded-xl bg-card/30 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-8 text-center text-muted-foreground", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(BookOpen, { className: "w-12 h-12 mx-auto mb-4 opacity-50" }),
      searchTerm ? "Nessun risultato trovato" : "Nessuna voce nel diario"
    ] }) }) : filteredEntries.map((entry) => /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-border rounded-xl bg-card/40 backdrop-blur-sm shadow-sm hover:shadow-md transition-all", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between mb-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${getImportanceColor(entry.importance)}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "font-semibold text-foreground", children: entry.title })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm text-muted-foreground", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-4 h-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
            "Settimana ",
            entry.week
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mb-3 whitespace-pre-wrap", children: entry.content }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-wrap gap-1", children: entry.tags.map((tag, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "secondary", className: "text-xs", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Tag, { className: "w-3 h-3 mr-1" }),
          tag
        ] }, index)) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-muted-foreground", children: entry.createdAt.toLocaleDateString() })
      ] })
    ] }) }, entry.id)) })
  ] });
};

const ClueArchive = () => {
  const [clues, setClues] = reactExports.useState([]);
  const [filteredClues, setFilteredClues] = reactExports.useState([]);
  const [searchTerm, setSearchTerm] = reactExports.useState("");
  const [weekFilter, setWeekFilter] = reactExports.useState(null);
  const [typeFilter, setTypeFilter] = reactExports.useState("all");
  const [loading, setLoading] = reactExports.useState(true);
  const { toast } = useToast();
  reactExports.useEffect(() => {
    loadClues();
  }, []);
  reactExports.useEffect(() => {
    filterClues();
  }, [clues, searchTerm, weekFilter, typeFilter]);
  const loadClues = async () => {
    try {
      const { data, error } = await supabase.from("clues").select("*").order("created_at", { ascending: false });
      if (error) throw error;
      const mappedClues = (data || []).map((clue) => ({
        id: clue.id,
        title: clue.title,
        description: clue.description,
        week: 1,
        // Default week
        isLocked: clue.is_locked,
        subscriptionType: clue.premium_type || "Base",
        foundAt: clue.created_at ? new Date(clue.created_at) : void 0,
        importance: "medium"
      }));
      setClues(mappedClues);
    } catch (error) {
      console.error("Error loading clues:", error);
      toast({
        title: "Errore",
        description: "Impossibile caricare l'archivio indizi",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const filterClues = () => {
    let filtered = clues;
    if (searchTerm) {
      filtered = filtered.filter(
        (clue) => clue.title.toLowerCase().includes(searchTerm.toLowerCase()) || clue.description.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }
    if (weekFilter !== null) {
      filtered = filtered.filter((clue) => clue.week === weekFilter);
    }
    if (typeFilter !== "all") {
      filtered = filtered.filter((clue) => clue.subscriptionType.toLowerCase() === typeFilter);
    }
    setFilteredClues(filtered);
  };
  const getImportanceBadge = (importance) => {
    switch (importance) {
      case "high":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "destructive", className: "text-xs", children: "Critico" });
      case "medium":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "default", className: "text-xs bg-yellow-500 text-white", children: "Medio" });
      case "low":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", className: "text-xs", children: "Basso" });
      default:
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-xs", children: "Standard" });
    }
  };
  const getSubscriptionBadge = (type) => {
    const colors = {
      "Base": "bg-gray-500",
      "Silver": "bg-gray-400",
      "Gold": "bg-yellow-500",
      "Black": "bg-black",
      "Premium": "bg-purple-500"
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: `text-xs text-white ${colors[type] || "bg-gray-500"}`, children: type });
  };
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center p-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400" }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Archive, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "Archivio Indizi" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 text-sm text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Database completo degli indizi raccolti" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col gap-4 md:flex-row md:items-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 relative", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Search, { className: "absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            placeholder: "Cerca indizi... [ARCH-SEARCH]",
            value: searchTerm,
            onChange: (e) => setSearchTerm(e.target.value),
            className: "pl-10 bg-muted/60 border-2 border-border/50 rounded-xl py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: weekFilter === null ? "default" : "outline",
            size: "sm",
            onClick: () => setWeekFilter(null),
            className: "rounded-xl",
            children: "Tutte"
          }
        ),
        [1, 2, 3, 4].map((week) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            variant: weekFilter === week ? "default" : "outline",
            size: "sm",
            onClick: () => setWeekFilter(week),
            className: "rounded-xl",
            children: [
              "W",
              week
            ]
          },
          week
        ))
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2", children: ["all", "base", "silver", "gold", "black"].map((type) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: typeFilter === type ? "default" : "outline",
          size: "sm",
          onClick: () => setTypeFilter(type),
          className: "rounded-xl capitalize",
          children: type
        },
        type
      )) })
    ] }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid gap-4 md:grid-cols-2 lg:grid-cols-3", children: filteredClues.map((clue) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Card,
      {
        className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-lg hover:shadow-2xl hover:shadow-cyan-500/20 transition-all duration-300 group cursor-pointer",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "pb-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-lg group-hover:text-cyan-400 transition-colors", children: clue.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                clue.isLocked && /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-4 h-4 text-red-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", className: "text-xs", children: [
                  "W",
                  clue.week
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              getSubscriptionBadge(clue.subscriptionType),
              getImportanceBadge(clue.importance || "medium")
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "pt-0", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mb-4 line-clamp-3", children: clue.description }),
            clue.foundAt && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-xs text-muted-foreground", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-3 h-3" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                "Trovato: ",
                clue.foundAt.toLocaleDateString("it-IT")
              ] })
            ] })
          ] })
        ]
      },
      clue.id
    )) }),
    filteredClues.length === 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-dashed border-border/50 rounded-2xl bg-card/30 backdrop-blur-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-12 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Archive, { className: "w-12 h-12 text-muted-foreground mx-auto mb-4 opacity-50" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-muted-foreground mb-2", children: "Nessun indizio trovato" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Modifica i filtri di ricerca per visualizzare altri indizi." })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-4 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-cyan-400", children: clues.length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Totale Indizi" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-green-400", children: clues.filter((c) => !c.isLocked).length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Sbloccati" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-yellow-400", children: clues.filter((c) => c.importance === "high").length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Critici" })
      ] })
    ] }) }) })
  ] });
};

delete L$2.Icon.Default.prototype._getIconUrl;
L$2.Icon.Default.mergeOptions({
  iconRetinaUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",
  iconUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",
  shadowUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"
});
const GeoRadarTool = () => {
  const [isScanning, setIsScanning] = reactExports.useState(false);
  const [scanProgress, setScanProgress] = reactExports.useState(0);
  const [scans, setScans] = reactExports.useState([]);
  const [scanParams, setScanParams] = reactExports.useState({
    centerLat: "",
    centerLng: "",
    radius: "1000",
    label: ""
  });
  const [savedCoordinates, setSavedCoordinates] = reactExports.useState([]);
  reactExports.useEffect(() => {
    loadSavedCoordinates();
  }, []);
  const loadSavedCoordinates = async () => {
    try {
      const { data, error } = await supabase.from("geo_radar_coordinates").select("*").order("created_at", { ascending: false });
      if (error) throw error;
      if (data) setSavedCoordinates(data);
    } catch (error) {
      console.error("Errore nel caricamento coordinate:", error);
    }
  };
  const handleSaveCoordinates = async () => {
    if (!scanParams.centerLat || !scanParams.centerLng || !scanParams.label) {
      ue$1.error("Compila tutti i campi richiesti");
      return;
    }
    try {
      const { data: userData } = await supabase.auth.getUser();
      if (!userData.user) {
        ue$1.error("Devi essere autenticato per salvare");
        return;
      }
      const { error } = await supabase.from("geo_radar_coordinates").insert({
        user_id: userData.user.id,
        lat: parseFloat(scanParams.centerLat),
        lng: parseFloat(scanParams.centerLng),
        label: scanParams.label,
        radius: parseFloat(scanParams.radius)
      });
      if (error) throw error;
      ue$1.success("Coordinate salvate con successo");
      loadSavedCoordinates();
    } catch (error) {
      console.error("Errore nel salvataggio:", error);
      ue$1.error("Errore nel salvataggio coordinate");
    }
  };
  const handleStartScan = async () => {
    if (!scanParams.centerLat || !scanParams.centerLng) {
      ue$1.error("Inserisci coordinate valide");
      return;
    }
    setIsScanning(true);
    setScanProgress(0);
    const progressInterval = setInterval(() => {
      setScanProgress((prev) => {
        if (prev >= 100) {
          clearInterval(progressInterval);
          setIsScanning(false);
          generateScanResults();
          return 100;
        }
        return prev + 10;
      });
    }, 300);
  };
  const checkTargetProximity = (lat, lng) => {
    const targetLat = 46;
    const targetLng = 8;
    const R = 6371e3;
    const dLat = (targetLat - lat) * Math.PI / 180;
    const dLng = (targetLng - lng) * Math.PI / 180;
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat * Math.PI / 180) * Math.cos(targetLat * Math.PI / 180) * Math.sin(dLng / 2) * Math.sin(dLng / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const distance = R * c;
    return distance <= 3e3;
  };
  const generateScanResults = () => {
    const centerLat = parseFloat(scanParams.centerLat);
    const centerLng = parseFloat(scanParams.centerLng);
    const radius = parseInt(scanParams.radius);
    const isNearTarget = checkTargetProximity(centerLat, centerLng);
    const results = [];
    const numResults = isNearTarget ? Math.floor(Math.random() * 3) + 2 : Math.floor(Math.random() * 2) + 1;
    for (let i = 0; i < numResults; i++) {
      const angle = Math.random() * 360 * (Math.PI / 180);
      const distance = Math.random() * radius;
      const lat = centerLat + distance / 111e3 * Math.cos(angle);
      const lng = centerLng + distance / (111e3 * Math.cos(centerLat * Math.PI / 180)) * Math.sin(angle);
      const baseSignal = isNearTarget ? 60 + Math.random() * 40 : Math.random() * 60;
      const baseConfidence = isNearTarget ? 70 + Math.random() * 30 : Math.random() * 70;
      results.push({
        lat,
        lng,
        signal: baseSignal,
        confidence: baseConfidence,
        description: isNearTarget ? `⚠️ SIGNAL FORTE - Settore ${String.fromCharCode(65 + i)}` : `Anomalia rilevata - Settore ${String.fromCharCode(65 + i)}`
      });
    }
    if (isNearTarget) {
      ue$1.success("⚠️ RADAR: Segnali anomali rilevati! Possibile obiettivo nelle vicinanze!");
    } else {
      ue$1.success("✅ RADAR: Scansione completata - Area sicura");
    }
    const scan = {
      id: crypto.randomUUID(),
      centerLat,
      centerLng,
      radius,
      scanResults: results,
      timestamp: /* @__PURE__ */ new Date()
    };
    setScans([scan, ...scans]);
    setScanProgress(0);
    ue$1.success(`Scansione completata - ${results.length} anomalie rilevate`);
  };
  const getSignalColor = (signal) => {
    if (signal > 70) return "text-red-500";
    if (signal > 40) return "text-yellow-500";
    return "text-green-500";
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-8", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Radar, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "Geo Radar Tool" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 text-sm text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Disponibile dalla Settimana 3" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent", children: "Parametri Scansione" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "centerLat", children: "Latitudine Centro" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "centerLat",
                type: "number",
                step: "any",
                placeholder: "46.0 [COORD-LAT]",
                value: scanParams.centerLat,
                onChange: (e) => setScanParams({ ...scanParams, centerLat: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",
                disabled: isScanning
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "centerLng", children: "Longitudine Centro" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "centerLng",
                type: "number",
                step: "any",
                placeholder: "8.0 [COORD-LNG]",
                value: scanParams.centerLng,
                onChange: (e) => setScanParams({ ...scanParams, centerLng: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",
                disabled: isScanning
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "radius", children: "Raggio (metri)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "radius",
                type: "number",
                min: "100",
                max: "5000",
                value: scanParams.radius,
                onChange: (e) => setScanParams({ ...scanParams, radius: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",
                disabled: isScanning
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "label", children: "Etichetta" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "label",
                placeholder: "SCAN-ID [Nome scansione]",
                value: scanParams.label,
                onChange: (e) => setScanParams({ ...scanParams, label: e.target.value }),
                className: "bg-muted/60 border-2 border-border/50 rounded-xl px-4 py-4 backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300 text-lg",
                disabled: isScanning
              }
            )
          ] })
        ] }),
        isScanning && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Scansione in corso..." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
              scanProgress,
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: scanProgress, className: "h-2" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: handleSaveCoordinates,
              disabled: isScanning,
              variant: "outline",
              className: "rounded-xl border-2 border-cyan-400/30 hover:border-cyan-400 hover:bg-cyan-400/10 transition-all duration-300",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Save, { className: "w-4 h-4 mr-2" }),
                "Salva Coordinate"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: handleStartScan,
              disabled: isScanning,
              className: "bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 rounded-xl shadow-2xl shadow-cyan-500/30 hover:shadow-cyan-500/50 transition-all duration-300",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Search, { className: "w-4 h-4 mr-2" }),
                isScanning ? "Scansione..." : "Avvia Scansione"
              ]
            }
          )
        ] })
      ] })
    ] }),
    scanParams.centerLat && scanParams.centerLng && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-2xl shadow-cyan-500/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent", children: "🗺 Mappa Tattica Interattiva" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-80 rounded-2xl overflow-hidden border-2 border-cyan-500/20 shadow-inner", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
        MapContainer,
        {
          center: [parseFloat(scanParams.centerLat), parseFloat(scanParams.centerLng)],
          zoom: 15,
          style: { height: "100%", width: "100%" },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              TileLayer,
              {
                url: "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                attribution: "© M1SSION™ Tactical Map"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Marker, { position: [parseFloat(scanParams.centerLat), parseFloat(scanParams.centerLng)], children: /* @__PURE__ */ jsxRuntimeExports.jsx(Popup, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Centro Scansione M1SSION™" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
              scanParams.label || "Punto di scansione",
              /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs font-mono", children: [
                parseFloat(scanParams.centerLat).toFixed(6),
                ", ",
                parseFloat(scanParams.centerLng).toFixed(6)
              ] })
            ] }) }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Circle$1,
              {
                center: [parseFloat(scanParams.centerLat), parseFloat(scanParams.centerLng)],
                radius: parseFloat(scanParams.radius),
                pathOptions: {
                  color: "#00FFFF",
                  fillColor: "#00FFFF",
                  fillOpacity: 0.1,
                  weight: 3,
                  dashArray: "10, 5"
                }
              }
            )
          ]
        }
      ) }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-lg font-semibold text-foreground", children: "Risultati Scansioni" }),
      scans.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/40 backdrop-blur-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-12 text-center text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Radar, { className: "w-16 h-16 mx-auto mb-6 opacity-50" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg", children: "Nessuna scansione effettuata" })
      ] }) }) : scans.map((scan) => /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-cyan-500/20 rounded-2xl bg-card/60 backdrop-blur-md shadow-xl hover:shadow-2xl transition-all duration-300", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-lg flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
            "Scansione ",
            scan.timestamp.toLocaleTimeString()
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-muted-foreground", children: [
            scan.scanResults.length,
            " anomalie"
          ] })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 text-sm text-muted-foreground", children: [
            "Centro: ",
            scan.centerLat.toFixed(6),
            ", ",
            scan.centerLng.toFixed(6),
            " | Raggio: ",
            scan.radius,
            "m"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: scan.scanResults.map((result, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-4 bg-muted/60 rounded-2xl border-2 border-border/50 backdrop-blur-md hover:border-cyan-400/30 transition-all duration-300", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-4 h-4 text-primary" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-medium", children: result.description }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground font-mono", children: [
                  result.lat.toFixed(6),
                  ", ",
                  result.lng.toFixed(6)
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `font-bold ${getSignalColor(result.signal)}`, children: [
                result.signal.toFixed(1),
                "%"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground", children: [
                "Conf: ",
                result.confidence.toFixed(1),
                "%"
              ] })
            ] })
          ] }, index)) })
        ] })
      ] }, scan.id))
    ] })
  ] });
};

const BuzzInterceptor = () => {
  const [isIntercepting, setIsIntercepting] = reactExports.useState(false);
  const [signals, setSignals] = reactExports.useState([]);
  const [interceptProgress, setInterceptProgress] = reactExports.useState(0);
  const [frequencyRange, setFrequencyRange] = reactExports.useState({ min: 2400, max: 2500 });
  reactExports.useEffect(() => {
    let interval;
    if (isIntercepting) {
      interval = setInterval(() => {
        if (Math.random() < 0.3) {
          generateRandomSignal();
        }
        setInterceptProgress((prev) => {
          if (prev >= 100) {
            return 0;
          }
          return prev + 10;
        });
      }, 1e3);
    }
    return () => {
      if (interval) {
        clearInterval(interval);
      }
    };
  }, [isIntercepting]);
  const generateRandomSignal = () => {
    const signal = {
      id: crypto.randomUUID(),
      frequency: Math.random() * (frequencyRange.max - frequencyRange.min) + frequencyRange.min,
      strength: Math.random() * 100,
      location: {
        lat: 46 + (Math.random() - 0.5) * 0.1,
        lng: 8 + (Math.random() - 0.5) * 0.1
      },
      timestamp: /* @__PURE__ */ new Date(),
      decoded: Math.random() < 0.4,
      // 40% chance di decodifica
      message: Math.random() < 0.4 ? getRandomMessage() : void 0
    };
    setSignals((prev) => [signal, ...prev.slice(0, 9)]);
    if (signal.decoded && signal.message) {
      ue$1.success("Segnale BUZZ decodificato!");
    }
  };
  const getRandomMessage = () => {
    const messages = [
      "COORDINATE: 46.0000, 8.0000",
      "SETTORE ALPHA: ANOMALIA RILEVATA",
      "PROTOCOLLO M1SSION: FASE 3 ATTIVA",
      "SEGNALE DEBOLE - RIPETERE SCANSIONE",
      "ZONA CRITICA: ACCESSO LIMITATO",
      "FREQUENZA MODULATA - DECRITTAZIONE RICHIESTA"
    ];
    return messages[Math.floor(Math.random() * messages.length)];
  };
  const handleToggleInterception = () => {
    setIsIntercepting(!isIntercepting);
    if (!isIntercepting) {
      ue$1.success("Intercettazione BUZZ avviata");
    } else {
      ue$1.info("Intercettazione BUZZ arrestata");
      setInterceptProgress(0);
    }
  };
  const getStrengthColor = (strength) => {
    if (strength > 70) return "text-red-500";
    if (strength > 40) return "text-yellow-500";
    return "text-green-500";
  };
  const getFrequencyBand = (frequency) => {
    if (frequency < 2420) return "LOW";
    if (frequency < 2460) return "MID";
    return "HIGH";
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-full overflow-y-auto pb-20 space-y-8", style: {
    height: "calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 80px)",
    paddingBottom: "calc(env(safe-area-inset-bottom, 0px) + 80px)"
  }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-4 mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center shadow-xl shadow-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold text-foreground", children: "BUZZ Interceptor" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 text-sm text-muted-foreground", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Disponibile dalla Settimana 4" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Card,
      {
        className: "relative overflow-hidden rounded-[24px]",
        style: {
          background: "rgba(0, 0, 0, 0.05)",
          backdropFilter: "blur(40px)",
          WebkitBackdropFilter: "blur(40px)",
          border: "1px solid rgba(255, 255, 255, 0.1)",
          boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Pannello di Controllo" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${isIntercepting ? "bg-red-500 animate-pulse" : "bg-gray-500"}` }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: isIntercepting ? "ATTIVO" : "STANDBY" })
            ] })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm font-medium", children: "Frequenza Min (MHz)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "input",
                  {
                    type: "number",
                    value: frequencyRange.min,
                    onChange: (e) => setFrequencyRange({ ...frequencyRange, min: parseInt(e.target.value) }),
                    className: "w-full h-12 px-4 rounded-xl bg-muted/60 border-2 border-border/50 text-foreground backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300",
                    disabled: isIntercepting
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm font-medium", children: "Frequenza Max (MHz)" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "input",
                  {
                    type: "number",
                    value: frequencyRange.max,
                    onChange: (e) => setFrequencyRange({ ...frequencyRange, max: parseInt(e.target.value) }),
                    className: "w-full h-12 px-4 rounded-xl bg-muted/60 border-2 border-border/50 text-foreground backdrop-blur-md focus:ring-2 focus:ring-cyan-400/40 focus:border-cyan-400 transition-all duration-300",
                    disabled: isIntercepting
                  }
                )
              ] })
            ] }),
            isIntercepting && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Scansione frequenze..." }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                  interceptProgress,
                  "%"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: interceptProgress, className: "h-2" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: handleToggleInterception,
                variant: isIntercepting ? "destructive" : "default",
                className: `w-full rounded-xl py-4 shadow-2xl hover:shadow-2xl transition-all duration-300 ${!isIntercepting ? "bg-gradient-to-r from-cyan-500 via-primary to-primary/80 hover:from-cyan-400 hover:to-primary/90 shadow-cyan-500/30 hover:shadow-cyan-500/50" : ""}`,
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Radio$1, { className: "w-4 h-4 mr-2" }),
                  isIntercepting ? "Arresta Intercettazione" : "Avvia Intercettazione"
                ]
              }
            )
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Card,
      {
        className: "relative overflow-hidden rounded-[24px]",
        style: {
          background: "rgba(0, 0, 0, 0.05)",
          backdropFilter: "blur(40px)",
          WebkitBackdropFilter: "blur(40px)",
          border: "1px solid rgba(255, 255, 255, 0.1)",
          boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b-0", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl text-center bg-gradient-to-r from-cyan-400 to-primary bg-clip-text text-transparent flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Feed Segnali BUZZ" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "secondary", children: [
              signals.length,
              " segnali"
            ] })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3 max-h-96 overflow-y-auto", children: signals.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "py-8 text-center text-muted-foreground", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-12 h-12 mx-auto mb-4 opacity-50" }),
            isIntercepting ? "In attesa di segnali..." : "Avvia intercettazione per rilevare segnali BUZZ"
          ] }) : signals.map((signal) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 bg-muted/60 rounded-2xl border-2 border-border/50 backdrop-blur-md hover:border-cyan-400/30 transition-all duration-300", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between mb-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-2 h-2 rounded-full ${signal.decoded ? "bg-green-500" : "bg-yellow-500"}` }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "font-medium text-sm", children: [
                    signal.frequency.toFixed(2),
                    " MHz"
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: signal.timestamp.toLocaleTimeString() })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-xs", children: getFrequencyBand(signal.frequency) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `text-sm font-bold ${getStrengthColor(signal.strength)}`, children: [
                  signal.strength.toFixed(1),
                  "%"
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground mb-2 font-mono", children: [
              "📍 ",
              signal.location.lat.toFixed(6),
              ", ",
              signal.location.lng.toFixed(6)
            ] }),
            signal.decoded && signal.message && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-3 p-2 bg-primary/10 rounded border border-primary/20", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-3 h-3 text-primary" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-medium text-primary", children: "DECODIFICATO" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-mono text-foreground", children: signal.message })
            ] })
          ] }, signal.id)) }) })
        ]
      }
    )
  ] });
};

const markerIcon$1 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=";

const markerShadow = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC";

const PulsingRedIcon = L$2.divIcon({
  className: "pulsing-red-marker",
  html: `<div style="
    width: 20px;
    height: 20px;
    background: #ff0000;
    border-radius: 50%;
    animation: pulse 2s infinite;
    box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
  "></div>
  <style>
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>`,
  iconSize: [20, 20],
  iconAnchor: [10, 10]
});
const DefaultIcon = L$2.icon({
  iconUrl: markerIcon$1,
  shadowUrl: markerShadow,
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
L$2.Marker.prototype.options.icon = DefaultIcon;
const MapClickHandler = ({ onMapClick }) => {
  useMapEvents({
    click: (e) => {
      onMapClick(e.latlng.lat, e.latlng.lng);
    }
  });
  return null;
};
const FinalShotPage = () => {
  const [selectedPosition, setSelectedPosition] = reactExports.useState(null);
  const [isSubmitting, setIsSubmitting] = reactExports.useState(false);
  const [showConfirmation, setShowConfirmation] = reactExports.useState(false);
  const [attempts, setAttempts] = reactExports.useState([]);
  const [cooldownEnd, setCooldownEnd] = reactExports.useState(null);
  const [mapStyle, setMapStyle] = reactExports.useState("satellite");
  const [showMapControls, setShowMapControls] = reactExports.useState(false);
  const { toast } = useToast();
  const mapRef = reactExports.useRef(null);
  const currentMissionId = "550e8400-e29b-41d4-a716-446655440000";
  reactExports.useEffect(() => {
    loadAttempts();
  }, []);
  const loadAttempts = async () => {
    try {
      const { data, error } = await supabase.from("final_shots").select("*").eq("mission_id", currentMissionId).order("created_at", { ascending: false });
      if (error) throw error;
      setAttempts(data || []);
      if (data && data.length > 0) {
        const lastAttempt = new Date(data[0].created_at);
        const cooldown = new Date(lastAttempt.getTime() + 12 * 60 * 60 * 1e3);
        if (cooldown > /* @__PURE__ */ new Date()) {
          setCooldownEnd(cooldown);
        }
      }
    } catch (error) {
      console.error("Error loading attempts:", error);
    }
  };
  const handleMapClick = (lat, lng) => {
    console.log("🎯 Map clicked:", { lat, lng, isDisabled, cooldown: getCooldownTime() });
    if (!isDisabled) {
      const exactPosition = {
        lat: parseFloat(lat.toFixed(6)),
        lng: parseFloat(lng.toFixed(6))
      };
      setSelectedPosition(exactPosition);
      setShowConfirmation(true);
      setShowMapControls(true);
      toast({
        title: "🎯 Posizione Final Shot Selezionata",
        description: `Coordinate: ${exactPosition.lat}, ${exactPosition.lng}`,
        variant: "default"
      });
    } else {
      toast({
        title: "❌ Final Shot Non Disponibile",
        description: getCooldownTime() ? `Cooldown attivo: ${getCooldownTime()}` : "Tentativi esauriti",
        variant: "destructive"
      });
    }
  };
  const submitFinalShot = async () => {
    if (!selectedPosition) return;
    setIsSubmitting(true);
    try {
      console.log("🎯 Submitting Final Shot:", {
        mission_id: currentMissionId,
        lat: selectedPosition.lat,
        lng: selectedPosition.lng
      });
      const { data, error } = await supabase.rpc("submit_final_shot", {
        p_mission_id: currentMissionId,
        p_latitude: selectedPosition.lat,
        p_longitude: selectedPosition.lng
      });
      if (error) {
        console.error("❌ RPC Error:", error);
        throw error;
      }
      const result = data;
      console.log("✅ Final Shot Result:", result);
      if (result.error) {
        const errorTitle = result.error.includes("Mission target") ? "❌ Target Non Trovato" : result.error.includes("Maximum attempts") ? "❌ Tentativi Esauriti" : result.error.includes("Daily limit") ? "❌ Limite Giornaliero" : result.error.includes("Cooldown") ? "⏳ Cooldown Attivo" : "❌ Errore Final Shot";
        toast({
          title: errorTitle,
          description: result.error,
          variant: "destructive"
        });
        return;
      }
      if (result.success) {
        if (result.is_winner) {
          toast({
            title: "🏆 VINCITORE!",
            description: "Complimenti! Hai trovato il premio esatto!",
            variant: "default"
          });
        } else {
          toast({
            title: "🎯 Final Shot Registrato",
            description: `Distanza: ${(result.distance_meters / 1e3).toFixed(2)} km | Direzione: ${result.direction}`,
            variant: "default"
          });
        }
        setCooldownEnd(new Date(Date.now() + 12 * 60 * 60 * 1e3));
        await loadAttempts();
        setSelectedPosition(null);
        setShowConfirmation(false);
        setShowMapControls(false);
      } else {
        toast({
          title: "❌ Final Shot Fallito",
          description: "Impossibile registrare il tentativo",
          variant: "destructive"
        });
      }
    } catch (error) {
      console.error("💥 Critical error submitting final shot:", error);
      toast({
        title: "❌ Errore Sistema",
        description: "Errore critico durante l'invio. Riprova.",
        variant: "destructive"
      });
    } finally {
      setIsSubmitting(false);
    }
  };
  const getRemainingAttempts = () => {
    const maxAttempts = 5;
    return Math.max(0, maxAttempts - attempts.length);
  };
  const getCooldownTime = () => {
    if (!cooldownEnd) return null;
    const now = /* @__PURE__ */ new Date();
    const diff = cooldownEnd.getTime() - now.getTime();
    if (diff <= 0) return null;
    const hours = Math.floor(diff / (1e3 * 60 * 60));
    const minutes = Math.floor(diff % (1e3 * 60 * 60) / (1e3 * 60));
    return `${hours}h ${minutes}m`;
  };
  const isDisabled = getRemainingAttempts() === 0 || !!getCooldownTime();
  const getMapTileUrl = () => {
    switch (mapStyle) {
      case "satellite":
        return "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}";
      case "dark":
        return "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png";
      case "terrain":
        return "https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png";
      default:
        return "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";
    }
  };
  const getMapAttribution = () => {
    switch (mapStyle) {
      case "satellite":
        return "&copy; M1SSION™ Tactical Intelligence | Esri";
      case "dark":
        return "&copy; M1SSION™ Dark Ops | CartoDB";
      case "terrain":
        return "&copy; M1SSION™ Terrain | OpenTopoMap";
      default:
        return "&copy; M1SSION™ Standard | OpenStreetMap";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full h-full overflow-y-auto bg-black/10", style: {
    minHeight: "calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 160px)"
  }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mb-4 px-4 pt-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2 mb-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-primary flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-5 h-5 text-white" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "text-xl font-bold", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400", children: "FINAL" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: " SHOT" })
      ] })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-2 mb-4 px-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border border-cyan-500/20 rounded-lg bg-card/60 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-2 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold text-cyan-400", children: getRemainingAttempts() }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Tentativi" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border border-cyan-500/20 rounded-lg bg-card/60 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-2 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold text-yellow-400", children: getCooldownTime() || "✓" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Cooldown" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border border-cyan-500/20 rounded-lg bg-card/60 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-2 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold text-green-400", children: attempts.length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Effettuati" })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 relative px-4 pb-20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative h-[400px] sm:h-[500px] md:h-[600px] rounded-xl overflow-hidden border-2 border-cyan-500/20 shadow-2xl bg-black/20", style: { zIndex: 1 }, children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "!visible !opacity-100 !flex absolute top-4 right-4 z-[999] flex-wrap gap-1", style: {
        visibility: "visible",
        opacity: 1,
        display: "flex"
      }, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            className: "!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",
            onClick: () => setMapStyle("satellite"),
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block"
            },
            children: "🛰️"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            className: "!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",
            onClick: () => setMapStyle("dark"),
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block"
            },
            children: "🌑"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            className: "!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",
            onClick: () => setMapStyle("terrain"),
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block"
            },
            children: "🏔️"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            className: "!visible !opacity-100 !block !relative !z-[100] text-xs bg-black/80 text-white border border-white/30 rounded-full backdrop-blur-sm hover:bg-cyan-500/80 px-2 py-1",
            onClick: () => setMapStyle("osm"),
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block"
            },
            children: "🗺️"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        MapContainer,
        {
          center: [50.8503, 4.3517],
          zoom: 4,
          minZoom: 2,
          maxZoom: 20,
          style: {
            height: "100%",
            width: "100%",
            position: "absolute",
            top: 0,
            left: 0,
            touchAction: "pan-x pan-y pinch-zoom",
            WebkitTouchCallout: "none",
            WebkitUserSelect: "none",
            userSelect: "none"
          },
          ref: mapRef,
          scrollWheelZoom: true,
          doubleClickZoom: true,
          dragging: true,
          touchZoom: true,
          zoomControl: true,
          attributionControl: false,
          whenReady: () => {
            if (typeof window !== "undefined" && window.navigator?.standalone) {
              const mapContainer = mapRef.current?.getContainer();
              if (mapContainer) {
                mapContainer.style.WebkitTransform = "translateZ(0)";
                mapContainer.style.transform = "translateZ(0)";
                mapContainer.style.WebkitBackfaceVisibility = "hidden";
                mapContainer.style.backfaceVisibility = "hidden";
                mapContainer.style.willChange = "transform";
                mapContainer.addEventListener("touchstart", () => {
                }, { passive: true });
                mapContainer.addEventListener("touchmove", () => {
                }, { passive: true });
                mapContainer.addEventListener("touchend", () => {
                }, { passive: true });
              }
            }
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              TileLayer,
              {
                url: getMapTileUrl(),
                attribution: getMapAttribution()
              }
            ),
            !isDisabled && /* @__PURE__ */ jsxRuntimeExports.jsx(MapClickHandler, { onMapClick: handleMapClick }),
            selectedPosition && /* @__PURE__ */ jsxRuntimeExports.jsx(
              Marker,
              {
                position: [selectedPosition.lat, selectedPosition.lng],
                icon: PulsingRedIcon,
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Popup, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-bold text-red-600", children: "🎯 Final Shot" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm bg-yellow-200 px-2 py-1 rounded text-black font-mono", children: [
                    selectedPosition.lat.toFixed(6),
                    ", ",
                    selectedPosition.lng.toFixed(6)
                  ] })
                ] }) })
              }
            )
          ]
        }
      ),
      isDisabled && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-black/50 flex items-center justify-center z-40 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-white p-4 bg-black/60 rounded-xl border border-red-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-bold mb-2", children: "❌ Final Shot Non Disponibile" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm", children: [
          getRemainingAttempts() === 0 && "Tentativi esauriti",
          getCooldownTime() && `Cooldown: ${getCooldownTime()}`
        ] })
      ] }) })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "!visible !opacity-100 !block",
        style: {
          position: "fixed",
          left: "50%",
          transform: "translateX(-50%)",
          bottom: `calc(env(safe-area-inset-bottom, 0px) + 120px)`,
          zIndex: 99999,
          pointerEvents: "auto",
          visibility: "visible",
          opacity: 1,
          display: "block"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: () => {
              if (isDisabled) {
                toast({
                  title: getCooldownTime() ? "⏳ Cooldown Attivo" : "❌ Tentativi Esauriti",
                  description: getCooldownTime() ? `Riprova tra: ${getCooldownTime()}` : "Hai raggiunto il limite massimo di tentativi",
                  variant: "destructive"
                });
                return;
              }
              if (!showMapControls) {
                setShowMapControls(true);
              }
              toast({
                title: "🎯 Modalità Final Shot Attiva",
                description: "Clicca sulla mappa per selezionare la posizione del premio",
                variant: "default"
              });
            },
            disabled: isDisabled,
            className: `
            !visible !opacity-100 !block !relative !z-[100]
            ${isDisabled ? "bg-gray-600/80 hover:bg-gray-600/80 cursor-not-allowed border-gray-500/50" : "bg-gradient-to-r from-fuchsia-600 to-fuchsia-900 hover:from-fuchsia-700 hover:to-fuchsia-950 border-fuchsia-400/50"} 
            text-white shadow-2xl px-8 py-4 text-lg font-black rounded-full border-3 backdrop-blur-md
            transition-all duration-300 hover:scale-105 hover:shadow-fuchsia-500/50
            min-w-[200px] text-center
            animate-pulse
          `,
            style: {
              visibility: "visible",
              opacity: 1,
              display: "block",
              position: "relative",
              zIndex: 100,
              WebkitTapHighlightColor: "transparent",
              WebkitTouchCallout: "none"
            },
            children: isDisabled ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              "❌ FINAL SHOT",
              getCooldownTime() ? ` (${getCooldownTime()})` : " (ESAURITO)"
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children: "🎯 FINAL SHOT" })
          }
        )
      }
    ),
    showConfirmation && selectedPosition && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-2 border-red-500/50 rounded-2xl bg-red-500/10 backdrop-blur-md max-w-md w-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-6 h-6 text-red-400" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-white", children: "Conferma Final Shot" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300", children: "Stai dichiarando che il premio si trova in questo punto." }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-gray-400 font-mono bg-yellow-200 p-3 rounded-lg text-black font-bold", children: [
        "📍 ",
        selectedPosition.lat.toFixed(6),
        ", ",
        selectedPosition.lng.toFixed(6)
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-yellow-400 font-medium", children: [
        "Hai solo ",
        getRemainingAttempts(),
        " tentativi totali per questa missione. Confermi?"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-4 justify-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "outline",
            onClick: () => {
              setShowConfirmation(false);
              setSelectedPosition(null);
            },
            className: "px-6",
            children: "Annulla"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: submitFinalShot,
            disabled: isSubmitting,
            className: "px-8 bg-gradient-to-r from-fuchsia-600 to-fuchsia-900 hover:from-fuchsia-700 hover:to-fuchsia-950 text-white shadow-xl",
            children: isSubmitting ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-4 w-4 border-b-2 border-white" }),
              "Invio..."
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-5 h-5" }),
              "🎯 LANCIA IL TUO FINAL SHOT"
            ] })
          }
        )
      ] })
    ] }) }) }) })
  ] });
};

const IntelModuleHeader = ({ title }) => {
  const [, setLocation] = useLocation();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "sticky top-0 z-20 flex items-center justify-between px-4 py-3 bg-background/80 backdrop-blur-md border-b border-border", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-lg font-semibold text-foreground", children: title }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          variant: "outline",
          size: "sm",
          onClick: () => setLocation("/intelligence/final-shot"),
          "aria-label": "Apri Final Shot",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Crosshair, { className: "w-4 h-4 mr-2" }),
            " FINAL SHOT"
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "ghost",
          size: "icon",
          onClick: () => setLocation("/intelligence"),
          "aria-label": "Chiudi e torna alla lista Intelligence",
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-5 h-5" })
        }
      )
    ] })
  ] });
};

const huracanImg = "/assets/lamborghini-huracan.BDVrMRV0.png";

const rolexImg = "/assets/rolex-submariner.A9k_cAfW.png";

const birkinImg = "/assets/hermes-birkin.DHEqTVeR.png";

const iphoneImg = "/assets/iphone-16-pro-max.Ddiy8e6N.png";

const airpodsImg = "/assets/airpods-max.DG_7KfAy.png";

const missionPrizeImages = [
  "/assets/m1ssion-prize/hero-forest-watch.png",
  "/assets/m1ssion-prize/hero-forest-lambo.png",
  "/assets/m1ssion-prize/hero-forest-lambo-porsche.png",
  "/assets/m1ssion-prize/treasure-forest-car.png"
];
function PrizeVision({ progress }) {
  const [currentImageIndex, setCurrentImageIndex] = reactExports.useState(0);
  const [isSwipeTransition, setIsSwipeTransition] = reactExports.useState(false);
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const [flipped, setFlipped] = reactExports.useState([]);
  const handleSwipeLeft = () => {
    if (isSwipeTransition) return;
    setIsSwipeTransition(true);
    setTimeout(() => {
      setCurrentImageIndex((prev) => (prev + 1) % missionPrizeImages.length);
      setIsSwipeTransition(false);
    }, 150);
  };
  const prizes = [
    { name: "Lamborghini Huracán Experience", image: huracanImg, description: "🏎️ Lamborghini Huracán Experience — Un weekend adrenalina pura." },
    { name: "Rolex Submariner", image: rolexImg, description: "⌚ Rolex Submariner — Precisione e stile intramontabile." },
    { name: "Hermès Birkin", image: birkinImg, description: "👜 Hermès Birkin — Eleganza senza compromessi." },
    { name: "iPhone 16 Pro Max", image: iphoneImg, description: "📱 iPhone 16 Pro Max — Tecnologia all’avanguardia." },
    { name: "AirPods Max", image: airpodsImg, description: "🎧 AirPods Max — Immersivo, ovunque." }
  ];
  const toggleFlip = (index) => {
    setFlipped((prev) => prev.includes(index) ? prev.filter((i) => i !== index) : [...prev, index]);
  };
  const layoutSpring = { layout: { type: "spring", stiffness: 160, damping: 22 } };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(LayoutGroup, { id: "mission-prize-group", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        layoutId: "missionPrize",
        className: "w-full",
        style: { visibility: isExpanded ? "hidden" : "visible" },
        transition: layoutSpring,
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "w-full relative overflow-hidden rounded-[24px]",
            style: {
              background: "rgba(0, 0, 0, 0.05)",
              backdropFilter: "blur(40px)",
              WebkitBackdropFilter: "blur(40px)",
              border: "1px solid rgba(255, 255, 255, 0.1)",
              boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                "div",
                {
                  className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                  style: {
                    animation: "slideGlow 3s ease-in-out infinite",
                    width: "200%",
                    left: "-100%"
                  }
                }
              ) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
            @keyframes slideGlow {
              0% { transform: translateX(0); }
              50% { transform: translateX(50%); }
              100% { transform: translateX(0); }
            }
          ` }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "div",
                {
                  className: "p-4 border-b border-white/10 flex justify-between items-center cursor-pointer",
                  onClick: () => setIsExpanded(true),
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-lg md:text-xl font-orbitron font-bold", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", style: { textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)" }, children: "M1" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                        "SSION",
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" }),
                        " PRIZE"
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/70", children: [
                        "Visibilità: ",
                        progress,
                        "%"
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/50", children: [
                        "(",
                        currentImageIndex + 1,
                        "/",
                        missionPrizeImages.length,
                        ")"
                      ] })
                    ] })
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative h-60 sm:h-72 md:h-80 lg:h-96 overflow-hidden", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  "div",
                  {
                    className: "relative w-full h-full cursor-pointer",
                    onClick: handleSwipeLeft,
                    onTouchStart: handleSwipeLeft,
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          className: "absolute inset-0",
                          initial: { opacity: 0, x: 50 },
                          animate: { opacity: 1, x: 0 },
                          exit: { opacity: 0, x: -50 },
                          transition: { duration: 0.3, ease: "easeInOut" },
                          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                            "img",
                            {
                              src: missionPrizeImages[currentImageIndex],
                              alt: `M1SSION Prize ${currentImageIndex + 1}`,
                              className: "w-full h-full object-cover rounded-lg shadow-lg"
                            }
                          )
                        },
                        currentImageIndex
                      ) }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          className: "absolute top-4 right-4 w-10 h-10 rounded-full bg-gradient-to-br from-[#00D1FF]/20 to-[#7B2EFF]/20 backdrop-blur-md border border-[#00D1FF]/30 flex items-center justify-center",
                          animate: {
                            x: [0, 8, 0],
                            opacity: [0.7, 1, 0.7]
                          },
                          transition: {
                            duration: 1.5,
                            repeat: Infinity,
                            ease: "easeInOut"
                          },
                          children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                            "svg",
                            {
                              width: "20",
                              height: "20",
                              viewBox: "0 0 24 24",
                              fill: "none",
                              xmlns: "http://www.w3.org/2000/svg",
                              className: "drop-shadow-[0_0_8px_rgba(0,209,255,0.6)]",
                              children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsx(
                                  "path",
                                  {
                                    d: "M5 12H19M19 12L12 5M19 12L12 19",
                                    stroke: "url(#arrowGradient)",
                                    strokeWidth: "2.5",
                                    strokeLinecap: "round",
                                    strokeLinejoin: "round"
                                  }
                                ),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("defs", { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("linearGradient", { id: "arrowGradient", x1: "5", y1: "12", x2: "19", y2: "12", gradientUnits: "userSpaceOnUse", children: [
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "0%", stopColor: "#00D1FF" }),
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "100%", stopColor: "#7B2EFF" })
                                ] }) })
                              ]
                            }
                          )
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-2 right-2 bg-black/60 backdrop-blur-sm px-2 py-1 rounded text-white text-[14px] md:text-[18px] font-medium", children: "Image for illustrative purposes only" })
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-0 left-0 right-0 h-1 bg-black/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "div",
                  {
                    className: "h-full bg-gradient-to-r from-[#00D1FF] to-[#7B2EFF]",
                    style: { width: `${progress}%` }
                  }
                ) })
              ] })
            ]
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "fixed inset-0 z-[100]",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        exit: { opacity: 0 },
        onClick: () => setIsExpanded(false),
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-black/70 backdrop-blur-sm" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              layoutId: "missionPrize",
              className: "fixed left-0 right-0 z-[101] prize-modal-container",
              style: { top: 72, bottom: 88, transformOrigin: "center center" },
              transition: layoutSpring,
              onClick: (e) => e.stopPropagation(),
              children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-2 md:px-6 h-full max-w-screen-xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "div",
                {
                  className: "w-full h-full flex flex-col relative overflow-hidden rounded-[24px]",
                  style: {
                    background: "rgba(0, 0, 0, 0.05)",
                    backdropFilter: "blur(40px)",
                    WebkitBackdropFilter: "blur(40px)",
                    border: "1px solid rgba(255, 255, 255, 0.1)",
                    boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
                  },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                        style: {
                          animation: "slideGlow 3s ease-in-out infinite",
                          width: "200%",
                          left: "-100%"
                        }
                      }
                    ) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 border-b border-white/10 flex justify-between items-center", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-lg md:text-xl font-orbitron font-bold", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", style: { textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)" }, children: "M1" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                          "SSION",
                          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" }),
                          " PRIZE"
                        ] })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("button", { onClick: () => setIsExpanded(false), className: "text-white/80 hover:text-white text-sm md:text-base", children: "Chiudi" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 overflow-y-auto p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6", children: prizes.map((prize, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "perspective-1000 h-64",
                        onClick: (e) => {
                          e.stopPropagation();
                          toggleFlip(index);
                        },
                        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                          "div",
                          {
                            className: `mission-flip-card w-full h-full ${flipped.includes(index) ? "is-flipped" : ""}`,
                            style: { transformOrigin: "center center" },
                            children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mission-card-front absolute inset-0 rounded-xl overflow-hidden bg-white/5 border border-white/10", children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsx("img", { src: prize.image, alt: prize.name, className: "absolute inset-0 w-full h-full object-cover" }),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 to-transparent p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-orbitron text-base md:text-lg font-bold text-cyan-400", children: prize.name }) })
                              ] }),
                              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mission-card-back absolute inset-0 rounded-xl p-6 bg-white/5 border border-white/10 flex items-center justify-center text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-sm md:text-base leading-relaxed", children: prize.description }) })
                            ]
                          }
                        )
                      },
                      index
                    )) }) })
                  ]
                }
              ) })
            }
          )
        ]
      },
      "overlay"
    ) })
  ] });
}

const MOBILE_BREAKPOINT = 768;
function useIsMobile() {
  const [isMobile, setIsMobile] = reactExports.useState(void 0);
  reactExports.useEffect(() => {
    const checkIsMobile = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    checkIsMobile();
    window.addEventListener("resize", checkIsMobile);
    return () => window.removeEventListener("resize", checkIsMobile);
  }, []);
  return isMobile ?? false;
}

const Tabs = ({ value, onValueChange, children, className, ...props }) => {
  const [activeTab, setActiveTab] = reactExports.useState(value || "");
  const handleTabChange = (newValue) => {
    setActiveTab(newValue);
    onValueChange?.(newValue);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn("w-full", className), ...props, children: reactExports.Children.map(children, (child) => {
    if (reactExports.isValidElement(child)) {
      return reactExports.cloneElement(child, {
        activeTab,
        onTabChange: handleTabChange
      });
    }
    return child;
  }) });
};
const TabsList = ({ className, activeTab, onTabChange, children, ...props }) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn(
      "inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",
      className
    ),
    ...props,
    children: reactExports.Children.map(children, (child) => {
      if (reactExports.isValidElement(child)) {
        return reactExports.cloneElement(child, {
          activeTab,
          onTabChange
        });
      }
      return child;
    })
  }
);
const TabsTrigger = ({ className, value, activeTab, onTabChange, children, ...props }) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "button",
  {
    className: cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
      activeTab === value ? "bg-background text-foreground shadow" : "text-muted-foreground hover:text-foreground",
      className
    ),
    onClick: () => onTabChange?.(value),
    ...props,
    children
  }
);
const TabsContent = ({ className, value, activeTab, children, ...props }) => {
  if (activeTab !== value) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: cn(
        "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
        className
      ),
      ...props,
      children
    }
  );
};

const BattleLobby$2 = reactExports.lazy(() => __vitePreload(() => Promise.resolve().then(() => BattleLobby$1),true?void 0:void 0));
function BattleConsole({ className }) {
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const [userId, setUserId] = reactExports.useState(null);
  const [pendingCount, setPendingCount] = reactExports.useState(0);
  const [stats, setStats] = reactExports.useState(null);
  useIsMobile();
  reactExports.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      if (data.user) {
        setUserId(data.user.id);
        loadPendingBattles(data.user.id);
        loadStats(data.user.id);
      }
    });
  }, []);
  reactExports.useEffect(() => {
    if (!userId) return;
    const channel = supabase.channel("battle-console-updates").on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "battles",
      filter: `opponent_id=eq.${userId}`
    }, () => {
      loadPendingBattles(userId);
    }).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, [userId]);
  const loadPendingBattles = async (uid) => {
    const { data, error } = await supabase.from("battles").select("id").eq("opponent_id", uid).in("status", ["pending", "accepted"]).order("created_at", { ascending: false });
    if (!error && data) {
      setPendingCount(data.length);
    }
  };
  const loadStats = async (uid) => {
    try {
      const { data, error } = await supabase.from("battle_metrics").select("*").eq("user_id", uid).maybeSingle();
      if (error && (error.code === "406" || error.code === "PGRST116" || error.code === "42P01")) {
        console.debug("[BattleConsole] battle_metrics not available");
        return;
      }
      if (data) {
        setStats(data);
      }
    } catch (e) {
      console.debug("[BattleConsole] Stats load error (non-critical):", e);
    }
  };
  const handleHeaderClick = () => {
    setIsExpanded(!isExpanded);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: `m1ssion-glass-card rounded-[20px] overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] mb-4 relative ${className}`,
      style: {
        background: "rgba(0, 0, 0, 0.05)",
        backdropFilter: "blur(40px)",
        WebkitBackdropFilter: "blur(40px)",
        border: "1px solid rgba(255, 255, 255, 0.1)",
        boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
      },
      whileHover: { scale: 1.02 },
      whileTap: { scale: 0.98 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
            style: {
              animation: "slideGlowBattle 3s ease-in-out infinite",
              width: "200%",
              left: "-100%"
            }
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
        @keyframes slideGlowBattle {
          0% { transform: translateX(0); }
          50% { transform: translateX(50%); }
          100% { transform: translateX(0); }
        }
      ` }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "p-6 border-b border-white/10 flex justify-between items-center",
            onClick: handleHeaderClick,
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-lg bg-gradient-to-br from-[#FC1EFF] to-[#00D1FF] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Swords, { className: "w-5 h-5 text-white" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-lg md:text-xl font-orbitron font-bold text-white", children: "M1SSION BATTLE" }),
                  pendingCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.div,
                    {
                      initial: { scale: 0 },
                      animate: { scale: 1 },
                      className: "inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-[#00D1FF]/20 border border-[#00D1FF]/50",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-3 h-3 text-[#00D1FF]" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs font-bold text-[#00D1FF]", children: [
                          pendingCount,
                          " sfide"
                        ] })
                      ]
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                stats && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "hidden md:flex items-center gap-4 text-sm", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-4 h-4 text-yellow-400" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/70", children: "W:" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-bold", children: stats.total_wins })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-4 h-4 text-red-400" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/70", children: "L:" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-bold", children: stats.total_losses })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { rotate: isExpanded ? 180 : 0 },
                    transition: { duration: 0.3 },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-5 h-5 text-white/60" })
                  }
                )
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { height: 0, opacity: 0 },
            animate: { height: "auto", opacity: 1 },
            exit: { height: 0, opacity: 0 },
            transition: { duration: 0.5, ease: "easeInOut" },
            className: "overflow-hidden",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "lobby", className: "w-full", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-3 bg-black/30", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "lobby", className: "data-[state=active]:bg-[#FC1EFF]/20 data-[state=active]:text-[#FC1EFF]", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Swords, { className: "w-4 h-4 mr-2" }),
                  "Lobby"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "stats", className: "data-[state=active]:bg-[#00D1FF]/20 data-[state=active]:text-[#00D1FF]", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-4 h-4 mr-2" }),
                  "Stats"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "leaderboard", className: "data-[state=active]:bg-[#FACC15]/20 data-[state=active]:text-[#FACC15]", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-4 h-4 mr-2" }),
                  "Top"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "lobby", className: "max-h-[70vh] overflow-y-auto custom-scrollbar mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(reactExports.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-12", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "w-8 h-8 border-2 border-[#FC1EFF] border-t-transparent rounded-full",
                  animate: { rotate: 360 },
                  transition: { duration: 1, repeat: Infinity, ease: "linear" }
                }
              ) }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleLobby$2, {}) }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "stats", className: "mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: stats ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-black/30 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-1", children: "Total Battles" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-white", children: stats.total_battles })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-black/30 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-1", children: "Win Rate" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-[#00D1FF]", children: [
                      stats.win_rate,
                      "%"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-black/30 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-1", children: "Best Reaction" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-[#FC1EFF]", children: [
                      stats.best_reaction_ms,
                      "ms"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-black/30 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-1", children: "Avg Reaction" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-yellow-400", children: [
                      stats.avg_reaction_ms,
                      "ms"
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-xl bg-gradient-to-r from-[#FC1EFF]/10 to-[#00D1FF]/10 border border-[#FC1EFF]/30", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-xs mb-2", children: "Total Earned" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-5 h-5 text-[#FACC15]" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-bold text-white", children: [
                      stats.total_energy_won,
                      " Energy"
                    ] })
                  ] })
                ] })
              ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8 text-white/50", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Swords, { className: "w-12 h-12 mx-auto mb-3 opacity-30" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Play your first battle to see stats" })
              ] }) }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "leaderboard", className: "mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8 text-white/50", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-12 h-12 mx-auto mb-3 opacity-30" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Leaderboard coming soon" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs mt-2", children: "Battle to earn your rank" })
              ] }) })
            ] }) })
          }
        ) })
      ]
    }
  );
}

function AgentDiary({ entries, onAddNote, purchasedClues }) {
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const [newNote, setNewNote] = reactExports.useState("");
  const [showAddNote, setShowAddNote] = reactExports.useState(false);
  const handleHeaderClick = () => {
    setIsExpanded(!isExpanded);
  };
  const handleAddNote = () => {
    if (newNote.trim()) {
      onAddNote(newNote.trim());
      setNewNote("");
      setShowAddNote(false);
    }
  };
  const formatTimestamp = (timestamp) => {
    const date = new Date(timestamp);
    return date.toLocaleString("it-IT", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit"
    });
  };
  const getAgentStats = () => {
    return {
      totalEntries: entries.length,
      notesCount: entries.filter((entry) => entry.type === "note").length,
      purchasesCount: entries.filter((entry) => entry.type === "purchase").length,
      cluesCount: purchasedClues.length
    };
  };
  const stats = getAgentStats();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "m1ssion-glass-card rounded-[20px] overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] mb-4 relative",
      style: {
        background: "rgba(0, 0, 0, 0.05)",
        backdropFilter: "blur(40px)",
        WebkitBackdropFilter: "blur(40px)",
        border: "1px solid rgba(255, 255, 255, 0.1)",
        boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
      },
      whileHover: { scale: 1.02 },
      whileTap: { scale: 0.98 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
            style: {
              animation: "slideGlowAgent 3s ease-in-out infinite",
              width: "200%",
              left: "-100%"
            }
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
        @keyframes slideGlowAgent {
          0% { transform: translateX(0); }
          50% { transform: translateX(50%); }
          100% { transform: translateX(0); }
        }
      ` }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "p-6 border-b border-white/10 flex justify-between items-center",
            onClick: handleHeaderClick,
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-lg md:text-xl font-orbitron font-bold text-white", children: "M1SSION AGENT" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/70", children: [
                  "Attività: ",
                  entries.length
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { rotate: isExpanded ? 180 : 0 },
                    transition: { duration: 0.3 },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-4 h-4 text-white/60" })
                  }
                )
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { height: 0, opacity: 0 },
            animate: { height: "auto", opacity: 1 },
            exit: { height: 0, opacity: 0 },
            transition: { duration: 0.5, ease: "easeInOut" },
            className: "overflow-hidden",
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-3 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-blue-400", children: stats.totalEntries }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Attività Totali" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-green-400", children: stats.notesCount }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Note Personali" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-yellow-400", children: stats.purchasesCount }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Acquisti" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a]/50 p-3 rounded-[16px] text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-purple-400", children: stats.cluesCount }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Indizi" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  "button",
                  {
                    onClick: (e) => {
                      e.stopPropagation();
                      setShowAddNote(!showAddNote);
                    },
                    className: "w-full p-3 bg-gradient-to-r from-[#365EFF]/20 to-[#FC1EFF]/20 border border-[#365EFF]/30 rounded-[16px] text-white hover:from-[#365EFF]/30 hover:to-[#FC1EFF]/30 transition-all flex items-center justify-center space-x-2",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-orbitron", children: "Aggiungi Nota Personale" })
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showAddNote && /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    initial: { height: 0, opacity: 0 },
                    animate: { height: "auto", opacity: 1 },
                    exit: { height: 0, opacity: 0 },
                    transition: { duration: 0.3 },
                    className: "mt-3 overflow-hidden",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "textarea",
                        {
                          value: newNote,
                          onChange: (e) => setNewNote(e.target.value),
                          placeholder: "Scrivi la tua nota personale...",
                          className: "w-full p-3 bg-[#0a0a0a]/50 border border-white/20 rounded-[16px] text-white placeholder-white/50 resize-none focus:outline-none focus:border-[#365EFF]/50",
                          rows: 3,
                          onClick: (e) => e.stopPropagation()
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex space-x-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          "button",
                          {
                            onClick: (e) => {
                              e.stopPropagation();
                              handleAddNote();
                            },
                            className: "px-4 py-2 bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white rounded-full text-sm hover:shadow-lg transition-all font-orbitron",
                            children: "Salva Nota"
                          }
                        ),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          "button",
                          {
                            onClick: (e) => {
                              e.stopPropagation();
                              setShowAddNote(false);
                              setNewNote("");
                            },
                            className: "px-4 py-2 bg-gray-600 text-white rounded-full text-sm hover:bg-gray-700 transition-all font-orbitron",
                            children: "Annulla"
                          }
                        )
                      ] })
                    ] })
                  }
                ) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3 max-h-[calc(100vh-30rem)] overflow-y-auto pr-1 custom-scrollbar", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium mb-3 font-orbitron", children: "Diario delle Attività" }),
                entries.length > 0 ? entries.map((entry, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "p-3 bg-[#0a0a0a]/50 rounded-[16px] border border-white/10 hover:border-white/20 transition-colors",
                    initial: { opacity: 0, x: -20 },
                    animate: { opacity: 1, x: 0 },
                    transition: { duration: 0.3, delay: index * 0.05 },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-start space-x-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-sm leading-relaxed break-words", children: entry.content }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/60 mt-2 block", children: formatTimestamp(entry.timestamp) })
                    ] }) })
                  },
                  index
                )) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8 text-white/50", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: "Nessuna attività registrata" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/40 mt-1", children: "Le tue azioni verranno registrate qui" })
                ] })
              ] })
            ] })
          }
        ) })
      ]
    }
  );
}

const BattleArena$2 = reactExports.lazy(() => __vitePreload(() => Promise.resolve().then(() => BattleArena$1),true?void 0:void 0));
function BattleArenaOverlay({ battleId, open, onClose }) {
  if (!battleId || !open) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: open && /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "fixed inset-0 z-[200] bg-black/98 backdrop-blur-xl",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      transition: { duration: 0.3 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-4 right-4 z-[201] safe-top", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "icon",
            onClick: onClose,
            className: "w-10 h-10 rounded-full bg-black/50 hover:bg-black/70 text-white border border-white/20",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-5 h-5" })
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-full w-full overflow-y-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          reactExports.Suspense,
          {
            fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center min-h-screen", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "w-12 h-12 border-4 border-[#FC1EFF] border-t-transparent rounded-full",
                animate: { rotate: 360 },
                transition: { duration: 1, repeat: Infinity, ease: "linear" }
              }
            ) }),
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleArena$2, { battleId })
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 pointer-events-none opacity-30",
            style: {
              background: "radial-gradient(circle at 50% 50%, rgba(252, 30, 255, 0.1) 0%, transparent 50%)"
            }
          }
        )
      ]
    }
  ) });
}

function useBattleOverlay() {
  const [location, setLocation] = useLocation();
  const [battleId, setBattleId] = reactExports.useState(null);
  const [isOpen, setIsOpen] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const battleMatch = location.match(/^\/battle\/([a-f0-9-]+)$/);
    if (battleMatch && location.startsWith("/home")) {
      const id = battleMatch[1];
      setBattleId(id);
      setIsOpen(true);
    }
  }, [location]);
  reactExports.useEffect(() => {
    const handleNotificationIntent = (event) => {
      const { type, battle_id } = event.detail || {};
      if (type === "battle_invite" && battle_id) {
        setBattleId(battle_id);
        setIsOpen(true);
      }
    };
    window.addEventListener("push-notification-intent", handleNotificationIntent);
    return () => {
      window.removeEventListener("push-notification-intent", handleNotificationIntent);
    };
  }, []);
  const openBattle = (id) => {
    setBattleId(id);
    setIsOpen(true);
  };
  const closeBattle = () => {
    setIsOpen(false);
    setBattleId(null);
    if (location.startsWith("/battle/")) {
      setLocation("/home");
    }
  };
  return {
    battleId,
    isOpen,
    openBattle,
    closeBattle
  };
}

function ActiveMissionBox({ mission, purchasedClues = [], progress = 0 }) {
  const [expandedBox, setExpandedBox] = reactExports.useState(null);
  const realCluesFound = mission.foundClues ?? 0;
  const totalClues = mission.totalClues || 200;
  const { notifications } = useNotifications();
  const buzzClues = notifications.filter((n) => n.type === "buzz");
  const fallbackFoundFromBuzz = buzzClues?.length || 0;
  const displayCluesFound = realCluesFound > 0 ? realCluesFound : fallbackFoundFromBuzz;
  const toggleBox = (boxId) => {
    setExpandedBox(expandedBox === boxId ? null : boxId);
  };
  const getMissionTimeline = () => {
    const startDate = new Date(mission.startTime);
    return [
      { event: "Missione Iniziata", date: startDate.toLocaleDateString(), status: "completed" },
      { event: "Primo Indizio", date: new Date(startDate.getTime() + 864e5).toLocaleDateString(), status: "completed" },
      { event: "Fase Intermedia", date: (/* @__PURE__ */ new Date()).toLocaleDateString(), status: "current" },
      { event: "Deadline Finale", date: new Date(startDate.getTime() + mission.totalDays * 864e5).toLocaleDateString(), status: "pending" }
    ];
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-xl font-orbitron font-bold mb-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", children: "CACCIA" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: " AL TESORO URBANO" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-xl font-orbitron font-bold", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", children: "MISSIONE ID:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
          " ",
          mission.title
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "m1ssion-glass-card rounded-2xl p-4 cursor-pointer hover:border-green-500/30 transition-colors overflow-hidden relative",
          style: {
            background: "rgba(0, 0, 0, 0.05)",
            backdropFilter: "blur(40px)",
            WebkitBackdropFilter: "blur(40px)",
            border: "1px solid rgba(255, 255, 255, 0.1)",
            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
          },
          onClick: () => toggleBox("clues"),
          whileHover: { scale: 1.02 },
          whileTap: { scale: 0.98 },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                style: {
                  animation: "slideGlow 3s ease-in-out infinite",
                  width: "200%",
                  left: "-100%"
                }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
            @keyframes slideGlow {
              0% { transform: translateX(0); }
              50% { transform: translateX(50%); }
              100% { transform: translateX(0); }
            }
          ` }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 mb-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-green-400 rounded-full" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80 text-sm", children: "Indizi trovati" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-green-400 mb-2", children: [
              displayCluesFound,
              "/",
              totalClues
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-gray-700 rounded-full h-2 mb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: `h-2 rounded-full transition-all duration-500 ${displayCluesFound === 0 ? "bg-gray-500" : displayCluesFound < 50 ? "bg-gradient-to-r from-[#22C55E] to-[#10B981]" : displayCluesFound < 100 ? "bg-gradient-to-r from-[#10B981] to-[#00D1FF]" : displayCluesFound < 150 ? "bg-gradient-to-r from-[#00D1FF] to-[#A855F7]" : "bg-gradient-to-r from-[#A855F7] to-[#D946EF]"}`,
                style: { width: `${displayCluesFound / totalClues * 100}%` }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/60", children: [
              Math.round(displayCluesFound / totalClues * 100),
              "% completato"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: expandedBox === "clues" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { height: 0, opacity: 0 },
                animate: { height: "auto", opacity: 1 },
                exit: { height: 0, opacity: 0 },
                transition: { duration: 0.3, ease: "easeInOut" },
                className: "overflow-hidden mt-4 pt-4 border-t border-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "text-white font-medium mb-3", children: [
                    "Indizi BUZZ Scoperti (",
                    buzzClues.length,
                    ")"
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: buzzClues.length > 0 ? buzzClues.map((clue, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.div,
                    {
                      className: "bg-white/5 rounded-lg p-3 border border-white/10 hover:border-white/20 transition-colors",
                      initial: { opacity: 0, x: -10 },
                      animate: { opacity: 1, x: 0 },
                      transition: { delay: index * 0.1 },
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between mb-2", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "text-sm font-medium text-white", children: clue.title }),
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/50", children: new Date(clue.date).toLocaleDateString("it-IT") }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "inline-block px-2 py-1 text-xs bg-blue-500/20 text-blue-300 rounded-full", children: "BUZZ" })
                          ] })
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/80 leading-relaxed mb-3", children: clue.description }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-green-400", children: "✅ Scoperto via BUZZ" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("button", { className: "px-3 py-1 bg-blue-600/20 hover:bg-blue-600/30 text-blue-300 text-xs rounded-lg border border-blue-500/30 transition-colors", children: "📍 Visualizza" })
                        ] })
                      ]
                    },
                    clue.id
                  )) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-4 text-white/60", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Nessun indizio trovato oggi." }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-2", children: "Premi BUZZ per scoprire nuovi indizi!" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 p-3 bg-blue-900/20 rounded-lg border border-blue-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-blue-300", children: "💡 Gli indizi BUZZ verranno visualizzati qui dopo ogni utilizzo" }) })
                  ] }) })
                ]
              }
            ) })
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "m1ssion-glass-card rounded-2xl p-4 cursor-pointer hover:border-amber-500/30 transition-colors overflow-hidden relative",
          style: {
            background: "rgba(0, 0, 0, 0.05)",
            backdropFilter: "blur(40px)",
            WebkitBackdropFilter: "blur(40px)",
            border: "1px solid rgba(255, 255, 255, 0.1)",
            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
          },
          onClick: () => toggleBox("time"),
          whileHover: { scale: 1.02 },
          whileTap: { scale: 0.98 },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                style: {
                  animation: "slideGlowTime 3s ease-in-out infinite",
                  width: "200%",
                  left: "-100%"
                }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
            @keyframes slideGlowTime {
              0% { transform: translateX(0); }
              50% { transform: translateX(50%); }
              100% { transform: translateX(0); }
            }
          ` }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 mb-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-amber-400 rounded-full" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80 text-sm", children: "Tempo rimasto" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold text-amber-400 mb-2", children: [
              mission.remainingDays,
              " giorni"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-gray-700 rounded-full h-2 mb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: `h-2 rounded-full transition-all duration-500 ${mission.remainingDays <= 0 ? "bg-gradient-to-r from-[#EF4444] to-[#DC2626]" : mission.remainingDays <= 5 ? "bg-gradient-to-r from-[#F97316] to-[#EF4444]" : mission.remainingDays <= 15 ? "bg-gradient-to-r from-[#FBBF24] to-[#F97316]" : "bg-gradient-to-r from-[#FDE047] to-[#FBBF24]"}`,
                style: { width: `${(mission.totalDays - mission.remainingDays) / mission.totalDays * 100}%` }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/60", children: [
              "su ",
              mission.totalDays,
              " giorni totali"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: expandedBox === "time" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { height: 0, opacity: 0 },
                animate: { height: "auto", opacity: 1 },
                exit: { height: 0, opacity: 0 },
                transition: { duration: 0.3, ease: "easeInOut" },
                className: "overflow-hidden mt-4 pt-4 border-t border-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium mb-3", children: "Timeline Missione" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: getMissionTimeline().map((item, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-2 bg-[#0a0a0a] rounded", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white text-sm", children: item.event }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/60", children: item.date }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-2 h-2 rounded-full ${item.status === "completed" ? "bg-green-400" : item.status === "current" ? "bg-amber-400" : "bg-gray-600"}` })
                    ] })
                  ] }, index)) })
                ]
              }
            ) })
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "m1ssion-glass-card rounded-2xl p-4 cursor-pointer hover:border-[#00D1FF]/30 transition-colors overflow-hidden relative",
          style: {
            background: "rgba(0, 0, 0, 0.05)",
            backdropFilter: "blur(40px)",
            WebkitBackdropFilter: "blur(40px)",
            border: "1px solid rgba(255, 255, 255, 0.1)",
            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
          },
          onClick: () => toggleBox("status"),
          whileHover: { scale: 1.02 },
          whileTap: { scale: 0.98 },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                style: {
                  animation: "slideGlowStatus 3s ease-in-out infinite",
                  width: "200%",
                  left: "-100%"
                }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
            @keyframes slideGlowStatus {
              0% { transform: translateX(0); }
              50% { transform: translateX(50%); }
              100% { transform: translateX(0); }
            }
          ` }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 mb-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-[#00D1FF] rounded-full" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/80 text-sm", children: "Stato missione" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xl font-bold text-[#00D1FF] mb-3", children: mission.remainingDays > 0 ? "ATTIVA" : "SCADUTA" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-gray-700 rounded-full h-2 mb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: `h-2 rounded-full transition-all duration-500 ${mission.remainingDays <= 0 ? "bg-red-500" : mission.remainingDays <= 5 ? "bg-gradient-to-r from-yellow-400 to-red-500" : mission.remainingDays <= 15 ? "bg-gradient-to-r from-green-400 to-yellow-400" : "bg-gradient-to-r from-[#00D1FF] to-green-400"}`,
                style: { width: `${(mission.totalDays - mission.remainingDays) / mission.totalDays * 100}%` }
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-white/60 mb-1", children: [
              "Iniziata il ",
              new Date(mission.startTime).toLocaleDateString("it-IT")
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-white/60", children: [
              Math.round((mission.totalDays - mission.remainingDays) / mission.totalDays * 100),
              "% tempo trascorso (",
              mission.totalDays - mission.remainingDays,
              "/",
              mission.totalDays,
              " giorni)"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: expandedBox === "status" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { height: 0, opacity: 0 },
                animate: { height: "auto", opacity: 1 },
                exit: { height: 0, opacity: 0 },
                transition: { duration: 0.3, ease: "easeInOut" },
                className: "overflow-hidden mt-4 pt-4 border-t border-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium mb-3", children: "Dettagli Progresso" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between mb-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white text-sm", children: "Progresso Generale" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-[#00D1FF] text-sm font-bold", children: [
                        Math.round(realCluesFound / totalClues * 100),
                        "%"
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-gray-700 rounded-full h-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        className: `h-3 rounded-full transition-all duration-500 ${realCluesFound === 0 ? "bg-gray-500" : realCluesFound < 50 ? "bg-gradient-to-r from-[#00D1FF] to-blue-400" : realCluesFound < 150 ? "bg-gradient-to-r from-green-400 to-[#00D1FF]" : "bg-gradient-to-r from-[#7B2EFF] to-[#00D1FF]"}`,
                        initial: { width: 0 },
                        animate: { width: `${realCluesFound / totalClues * 100}%` },
                        transition: { duration: 1, ease: "easeOut" }
                      }
                    ) })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a] p-3 rounded-lg text-center", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-green-400", children: realCluesFound }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Obiettivi Raggiunti" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#0a0a0a] p-3 rounded-lg text-center", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-red-400", children: totalClues - realCluesFound }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Obiettivi Rimanenti" })
                    ] })
                  ] })
                ]
              }
            ) })
          ]
        }
      )
    ] })
  ] });
}

const usePrizeData = () => {
  const [prizes, setPrizes] = reactExports.useState([]);
  const [userClues, setUserClues] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const { user } = useAuth();
  const loadPrizes = preserveFunctionName(async () => {
    if (!user) return;
    try {
      setLoading(true);
      setError(null);
      const { data: prizesData, error: prizesError } = await supabase.from("prizes").select(`
          *,
          prize_clues!inner(count)
        `).eq("is_active", true).order("start_date", { ascending: false });
      if (prizesError) {
        console.error("Error loading prizes:", prizesError);
        setError("Errore nel caricamento dei premi");
        return;
      }
      const prizeIds = prizesData?.map((p) => p.id) || [];
      if (prizeIds.length > 0) {
        const { data: allClues } = await supabase.from("prize_clues").select("id, prize_id").in("prize_id", prizeIds);
        const clueIds = allClues?.map((c) => c.id) || [];
        const { data: userCluesData } = await supabase.from("user_clues").select("*").eq("user_id", user.id).in("clue_id", clueIds);
        setUserClues(userCluesData || []);
        const clueCountMap = /* @__PURE__ */ new Map();
        allClues?.forEach((clue) => {
          const isUnlocked = userCluesData?.some((uc) => uc.clue_id === clue.id);
          if (isUnlocked) {
            clueCountMap.set(clue.prize_id, (clueCountMap.get(clue.prize_id) || 0) + 1);
          }
        });
        const enrichedPrizes = prizesData?.map((prize) => ({
          ...prize,
          clue_count: prize.prize_clues?.length || 0,
          unlocked_clues: clueCountMap.get(prize.id) || 0
        })) || [];
        setPrizes(enrichedPrizes);
      } else {
        setPrizes([]);
        setUserClues([]);
      }
    } catch (err) {
      console.error("Error in loadPrizes:", err);
      setError("Errore di connessione");
    } finally {
      setLoading(false);
    }
  });
  const loadPrizeClues = preserveFunctionName(async (prizeId) => {
    if (!user) return [];
    try {
      const { data: prizeClues, error: cluesError } = await supabase.from("prize_clues").select("*").eq("prize_id", prizeId).order("week", { ascending: true });
      if (cluesError) {
        console.error("Error loading clues:", cluesError);
        throw new Error("Errore nel caricamento degli indizi");
      }
      const clueIds = prizeClues?.map((c) => c.id) || [];
      const { data: userCluesData } = await supabase.from("user_clues").select("clue_id").eq("user_id", user.id).in("clue_id", clueIds);
      const unlockedClueIds = new Set(userCluesData?.map((uc) => uc.clue_id) || []);
      const enrichedClues = prizeClues?.map((clue) => ({
        ...clue,
        is_unlocked: unlockedClueIds.has(clue.id),
        unlock_cost: getUnlockCost(clue.clue_type)
      })) || [];
      return enrichedClues;
    } catch (err) {
      console.error("Error loading prize clues:", err);
      throw err;
    }
  });
  const getUnlockCost = (clueType) => {
    switch (clueType) {
      case "precise":
        return 50;
      case "medium":
        return 30;
      case "vague":
        return 10;
      default:
        return 20;
    }
  };
  const unlockClue = preserveFunctionName(async (clue) => {
    if (!user) return false;
    try {
      const { data: profile } = await supabase.from("profiles").select("credits").eq("id", user.id).single();
      const userCredits = profile?.credits || 0;
      const cost = clue.unlock_cost || 20;
      if (userCredits < cost) {
        ue$1.error(`Crediti insufficienti. Servono ${cost} crediti.`);
        return false;
      }
      const { error: updateError } = await supabase.from("profiles").update({ credits: userCredits - cost }).eq("id", user.id);
      if (updateError) {
        console.error("Error updating credits:", updateError);
        ue$1.error("Errore nell'aggiornamento dei crediti");
        return false;
      }
      const { error: insertError } = await supabase.from("user_clues").insert({
        user_id: user.id,
        clue_id: clue.id,
        title_it: clue.title_it,
        description_it: clue.description_it,
        clue_type: clue.clue_type,
        buzz_cost: cost
      });
      if (insertError) {
        console.error("Error inserting user clue:", insertError);
        await supabase.from("profiles").update({ credits: userCredits }).eq("id", user.id);
        ue$1.error("Errore nel salvataggio dell'indizio");
        return false;
      }
      const newUserClue = {
        clue_id: clue.id,
        user_id: user.id,
        title_it: clue.title_it,
        description_it: clue.description_it,
        clue_type: clue.clue_type,
        buzz_cost: cost,
        created_at: (/* @__PURE__ */ new Date()).toISOString()
      };
      setUserClues((prev) => [...prev, newUserClue]);
      ue$1.success(`Indizio sbloccato! Costato ${cost} crediti.`);
      await loadPrizes();
      return true;
    } catch (err) {
      console.error("Error unlocking clue:", err);
      ue$1.error("Errore nel sblocco dell'indizio");
      return false;
    }
  });
  const getPrizeUserClues = reactExports.useCallback((prizeId) => {
    return userClues.filter((uc) => {
      return true;
    });
  }, [userClues]);
  const getPrizeProgress = reactExports.useCallback((prize) => {
    if (!prize.clue_count) return 0;
    return Math.round((prize.unlocked_clues || 0) / prize.clue_count * 100);
  }, []);
  const isPrizeCompleted = reactExports.useCallback((prize) => {
    return getPrizeProgress(prize) === 100;
  }, [getPrizeProgress]);
  reactExports.useEffect(() => {
    if (user) {
      loadPrizes();
    }
  }, [user]);
  return {
    prizes,
    userClues,
    loading,
    error,
    loadPrizes,
    loadPrizeClues,
    unlockClue,
    getPrizeUserClues,
    getPrizeProgress,
    isPrizeCompleted,
    getUnlockCost
  };
};

const useBuzzPricing = (userId) => {
  const [userCluesCount, setUserCluesCount] = reactExports.useState(0);
  const loadUserCluesCount = reactExports.useCallback(async () => {
    if (!userId) return;
    try {
      const { count, error } = await supabase.from("user_clues").select("*", { count: "exact", head: true }).eq("user_id", userId);
      if (error) {
        console.error("Error loading user clues count:", error);
        return;
      }
      const cluesCount = count || 0;
      setUserCluesCount(cluesCount);
      console.log("📊 User clues count loaded:", cluesCount);
    } catch (err) {
      console.error("Exception loading user clues count:", err);
    }
  }, [userId]);
  const calculateBuzzMapPrice = reactExports.useCallback(() => {
    console.log("💰 Calculating price for clues count:", userCluesCount);
    if (userCluesCount <= 10) {
      console.log("💰 Price tier: 1-10 clues = 7.99€");
      return 7.99;
    }
    if (userCluesCount <= 20) {
      console.log("💰 Price tier: 11-20 clues = 9.99€");
      return 9.99;
    }
    if (userCluesCount <= 30) {
      console.log("💰 Price tier: 21-30 clues = 13.99€");
      return 13.99;
    }
    if (userCluesCount <= 40) {
      console.log("💰 Price tier: 31-40 clues = 19.99€");
      return 19.99;
    }
    console.log("💰 Price tier: 41+ clues = 29.99€");
    return 29.99;
  }, [userCluesCount]);
  const testCalculationLogic = reactExports.useCallback(() => {
    console.log("🧪 TESTING BUZZ MAPPA PRICING:");
    console.log("Current user clues:", userCluesCount);
    console.log("Calculated price:", calculateBuzzMapPrice());
    const testCases = [5, 15, 25, 35, 45];
    testCases.forEach((clues) => {
      const oldCount = userCluesCount;
      setUserCluesCount(clues);
      console.log(`With ${clues} clues: ${calculateBuzzMapPrice()}€`);
      setUserCluesCount(oldCount);
    });
  }, [userCluesCount, calculateBuzzMapPrice]);
  reactExports.useEffect(() => {
    if (userId) {
      loadUserCluesCount();
    }
  }, [userId, loadUserCluesCount]);
  return {
    userCluesCount,
    calculateBuzzMapPrice,
    testCalculationLogic,
    loadUserCluesCount
  };
};

const useMissionStatus = () => {
  const [missionStatus, setMissionStatus] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const { user } = useAuth();
  const loadMissionStatus = async () => {
    if (!user) {
      setLoading(false);
      return;
    }
    try {
      setLoading(true);
      setError(null);
      const { data: activeMissionData, error: missionFetchError } = await supabase.from("missions").select("id, title").eq("status", "active").order("created_at", { ascending: false }).limit(1).maybeSingle();
      if (missionFetchError && missionFetchError.code !== "PGRST116" && missionFetchError.code !== "406" && missionFetchError.code !== "42P01") {
        console.error("Error loading active mission:", missionFetchError);
      }
      const missionId = activeMissionData?.id || "M001";
      const missionTitle = activeMissionData?.title || "M1SSION ONE";
      let realCluesCount = 0;
      let retryCount = 0;
      const maxRetries = 3;
      while (retryCount < maxRetries) {
        const { count, error: cluesError } = await supabase.from("user_clues").select("*", { count: "exact", head: true }).eq("user_id", user.id);
        if (cluesError) {
          console.error(`❌ Error loading user clues count (attempt ${retryCount + 1}):`, cluesError);
          retryCount++;
          if (retryCount >= maxRetries) {
            setError("Errore nel caricamento indizi");
            return;
          }
          await new Promise((resolve) => setTimeout(resolve, 500));
          continue;
        }
        realCluesCount = count || 0;
        break;
      }
      const actualProgress = Math.round(realCluesCount / 200 * 100);
      console.log("🔥 REAL CLUES COUNT FROM DATABASE:", {
        realCluesCount,
        actualProgress,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
      const { data: userMissionData, error: missionError } = await supabase.from("user_mission_status").select("*").eq("user_id", user.id).single();
      if (missionError && missionError.code !== "PGRST116") {
        console.error("Error loading mission status:", missionError);
        setError("Errore nel caricamento dello stato missione");
        return;
      }
      if (!userMissionData) {
        const { data: newMissionData, error: insertError } = await supabase.from("user_mission_status").insert({
          user_id: user.id,
          clues_found: 0,
          mission_progress_percent: 0,
          mission_started_at: (/* @__PURE__ */ new Date()).toISOString(),
          mission_days_remaining: 30,
          buzz_counter: 0,
          map_radius_km: null,
          map_area_generated: false
        }).select().single();
        if (insertError) {
          console.error("Error creating mission status:", insertError);
          setError("Errore nella creazione dello stato missione");
          return;
        }
        const missionStart = new Date(newMissionData.mission_started_at);
        const now = /* @__PURE__ */ new Date();
        const daysPassed = Math.floor((now.getTime() - missionStart.getTime()) / (1e3 * 60 * 60 * 24));
        const daysRemaining = Math.max(0, 30 - daysPassed);
        const { error: updateError } = await supabase.from("user_mission_status").update({
          clues_found: realCluesCount,
          mission_progress_percent: actualProgress
        }).eq("user_id", user.id);
        if (updateError) {
          console.error("❌ Error updating mission status:", updateError);
        }
        setMissionStatus({
          id: missionId,
          title: missionTitle,
          state: daysRemaining > 0 ? "ATTIVA" : "SCADUTA",
          startDate: missionStart,
          daysRemaining,
          totalDays: 30,
          cluesFound: realCluesCount,
          totalClues: 200,
          progressPercent: actualProgress
        });
      } else {
        const missionStart = new Date(userMissionData.mission_started_at);
        const now = /* @__PURE__ */ new Date();
        const daysPassed = Math.floor((now.getTime() - missionStart.getTime()) / (1e3 * 60 * 60 * 24));
        const daysRemaining = Math.max(0, 30 - daysPassed);
        if ((userMissionData.clues_found || 0) !== realCluesCount) {
          const { error: updateError } = await supabase.from("user_mission_status").update({
            clues_found: realCluesCount,
            mission_progress_percent: actualProgress
          }).eq("user_id", user.id);
          if (updateError) {
            console.error("❌ Error updating mission status:", updateError);
          }
        }
        setMissionStatus({
          id: missionId,
          title: missionTitle,
          state: daysRemaining > 0 ? "ATTIVA" : "SCADUTA",
          startDate: missionStart,
          daysRemaining,
          totalDays: 30,
          cluesFound: realCluesCount,
          totalClues: 200,
          progressPercent: actualProgress
        });
      }
    } catch (err) {
      console.error("Error in loadMissionStatus:", err);
      setError("Errore di connessione");
    } finally {
      setLoading(false);
    }
  };
  reactExports.useEffect(() => {
    if (!user) return;
    loadMissionStatus();
    const subscription = supabase.channel("user_clues_mission_updates").on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "user_clues",
        filter: `user_id=eq.${user.id}`
      },
      () => {
        console.log("🔄 User clues changed, reloading mission status...");
        loadMissionStatus();
      }
    ).on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "user_mission_status",
        filter: `user_id=eq.${user.id}`
      },
      () => {
        console.log("🔄 Mission status changed, reloading...");
        loadMissionStatus();
      }
    ).subscribe();
    return () => {
      subscription.unsubscribe();
    };
  }, [user]);
  reactExports.useEffect(() => {
    if (!missionStatus) return;
    const interval = setInterval(() => {
      const missionStart = missionStatus.startDate;
      const now = /* @__PURE__ */ new Date();
      const daysPassed = Math.floor((now.getTime() - missionStart.getTime()) / (1e3 * 60 * 60 * 24));
      const daysRemaining = Math.max(0, 30 - daysPassed);
      if (daysRemaining !== missionStatus.daysRemaining) {
        setMissionStatus((prev) => prev ? {
          ...prev,
          daysRemaining,
          state: daysRemaining > 0 ? "ATTIVA" : "SCADUTA"
        } : null);
      }
    }, 6e4);
    return () => clearInterval(interval);
  }, [missionStatus]);
  return {
    missionStatus,
    loading,
    error,
    reload: loadMissionStatus
  };
};

const InviteFriendModal = ({
  open,
  onOpenChange
}) => {
  const { user } = useAuthContext();
  const [friendEmail, setFriendEmail] = reactExports.useState("");
  const [isSharing, setIsSharing] = reactExports.useState(false);
  const referralLink = user?.id ? `https://m1ssion.eu?ref=${user.id}` : `https://m1ssion.eu`;
  const inviteMessage = `🎮 Unisciti a M1SSION™ - La caccia al tesoro più epica! Usa il mio link per iniziare: ${referralLink}`;
  const copyReferralLink = async () => {
    try {
      await navigator.clipboard.writeText(referralLink);
      ue$1.success("Link copiato negli appunti!");
    } catch (error) {
      ue$1.error("Errore durante la copia del link");
    }
  };
  const shareInvite = async () => {
    if (navigator.share) {
      try {
        setIsSharing(true);
        await navigator.share({
          title: "M1SSION™ - Unisciti alla caccia!",
          text: "Unisciti a M1SSION™ - La caccia al tesoro più epica!",
          url: referralLink
        });
      } catch (error) {
        if (error.name !== "AbortError") {
          ue$1.error("Errore durante la condivisione");
        }
      } finally {
        setIsSharing(false);
      }
    } else {
      copyReferralLink();
    }
  };
  const shareWhatsApp = () => {
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(inviteMessage)}`;
    window.open(whatsappUrl, "_blank");
  };
  const shareSMS = () => {
    const smsUrl = `sms:?body=${encodeURIComponent(inviteMessage)}`;
    window.open(smsUrl);
  };
  const shareEmail = () => {
    const emailUrl = `mailto:?subject=${encodeURIComponent("Unisciti a M1SSION™!")}&body=${encodeURIComponent(inviteMessage)}`;
    window.open(emailUrl);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "max-w-md mx-auto bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f172a] border border-cyan-500/20", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          initial: { scale: 0.8, opacity: 0 },
          animate: { scale: 1, opacity: 1 },
          transition: { duration: 0.5 },
          className: "flex items-center justify-center mb-4",
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-16 h-16 text-cyan-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                animate: {
                  scale: [1, 1.2, 1]
                },
                transition: {
                  duration: 2,
                  repeat: Infinity,
                  repeatType: "reverse"
                },
                className: "absolute -top-2 -right-2",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Share2, { className: "w-6 h-6 text-cyan-300" })
              }
            )
          ] })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-2xl font-bold gradient-text mb-2", children: "🚀 Invita un Amico" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 text-sm", children: "Condividi M1SSION™ e guadagna +25 XP quando si registrano!" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4 py-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm font-medium text-gray-300", children: "Il tuo link di invito:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex space-x-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              value: referralLink,
              readOnly: true,
              className: "flex-1 bg-gray-800/50 border-gray-600/50 text-gray-300 text-sm"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: copyReferralLink,
              variant: "outline",
              size: "icon",
              className: "bg-gray-700/50 border-gray-600/50 text-gray-300 hover:bg-gray-700/80",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Copy, { className: "w-4 h-4" })
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-gray-300", children: "Condividi tramite:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: shareWhatsApp,
              variant: "outline",
              className: "flex items-center space-x-2 bg-green-600/20 border-green-500/50 text-green-200 hover:bg-green-600/40",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(MessageCircle, { className: "w-4 h-4" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "WhatsApp" })
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: shareSMS,
              variant: "outline",
              className: "flex items-center space-x-2 bg-blue-600/20 border-blue-500/50 text-blue-200 hover:bg-blue-600/40",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-4 h-4" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "SMS" })
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: shareEmail,
              variant: "outline",
              className: "flex items-center space-x-2 bg-purple-600/20 border-purple-500/50 text-purple-200 hover:bg-purple-600/40",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "w-4 h-4" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Email" })
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: shareInvite,
              disabled: isSharing,
              variant: "outline",
              className: "flex items-center space-x-2 bg-cyan-600/20 border-cyan-500/50 text-cyan-200 hover:bg-cyan-600/40",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Share2, { className: "w-4 h-4" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: isSharing ? "Condividi..." : "Altro" })
              ]
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          initial: { y: 20, opacity: 0 },
          animate: { y: 0, opacity: 1 },
          transition: { delay: 0.3 },
          className: "p-3 bg-gradient-to-r from-yellow-900/40 to-yellow-700/40 rounded-lg border border-yellow-500/30",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-200 text-sm font-medium", children: "💰 Ricompensa Referral" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-300/80 text-xs", children: "Riceverai +25 XP quando il tuo amico si registra usando il tuo link!" })
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center pt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        onClick: () => onOpenChange(false),
        variant: "outline",
        className: "bg-gray-700/50 border-gray-600/50 text-gray-300 hover:bg-gray-700/80",
        children: "Chiudi"
      }
    ) })
  ] }) });
};

const InviteFloatingButton = () => {
  const [open, setOpen] = reactExports.useState(false);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.button,
      {
        "aria-label": "Invita un Amico",
        onClick: () => setOpen(true),
        className: "fixed z-[70] top-36 right-4 md:top-40 md:right-8 w-12 h-12 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-[hsl(282,90%,45%)]/15 to-[hsl(218,79%,59%)]/15 backdrop-blur-md border border-white/15 shadow-[0_8px_30px_rgba(114,9,183,0.25)] hover:from-[hsl(282,90%,45%)]/25 hover:to-[hsl(218,79%,59%)]/25 transition-all flex items-center justify-center",
        initial: { opacity: 0, scale: 0.9, y: -10 },
        animate: { opacity: 1, scale: 1, y: 0 },
        whileHover: { scale: 1.05 },
        whileTap: { scale: 0.95 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(UserPlus, { className: "w-5 h-5 md:w-6 md:h-6 text-white drop-shadow-[0_0_8px_rgba(255,255,255,0.3)]" })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(InviteFriendModal, { open, onOpenChange: setOpen })
  ] });
};

class DNAClient {
  async ensureDna(userId) {
    try {
      const { error } = await supabase.rpc("ensure_agent_dna", {
        p_user: userId
      });
      if (error) throw error;
      console.log("✅ DNA ensured for user:", userId);
    } catch (error) {
      console.error("❌ Failed to ensure DNA:", error);
      throw error;
    }
  }
  async getDna(userId) {
    try {
      const { data, error } = await supabase.from("agent_dna").select("*").eq("user_id", userId).single();
      if (error) {
        if (error.code === "PGRST116") {
          await this.ensureDna(userId);
          return this.getDna(userId);
        }
        throw error;
      }
      return data;
    } catch (error) {
      console.error("❌ Failed to get DNA:", error);
      return null;
    }
  }
  async updateDna(userId, partial) {
    try {
      await this.ensureDna(userId);
      const { data, error } = await supabase.from("agent_dna").update(partial).eq("user_id", userId).select().single();
      if (error) throw error;
      console.log("✅ DNA updated:", data);
      return data;
    } catch (error) {
      console.error("❌ Failed to update DNA:", error);
      return null;
    }
  }
  // Helper: calculate DNA boost from activity (non-invasive)
  calculateActivityBoost(loginCount) {
    const baseBoost = Math.min(5, Math.floor(loginCount / 10));
    return {
      intuito: 50 + baseBoost,
      audacia: 50 + Math.floor(baseBoost * 0.8),
      etica: 50 + Math.floor(baseBoost * 1.2),
      rischio: 50 + Math.floor(baseBoost * 0.6),
      vibrazione: 50 + baseBoost
    };
  }
}
const dnaClient = new DNAClient();

const ARCHETYPE_CONFIGS = {
  Seeker: {
    id: "Seeker",
    name: "Seeker",
    nameIt: "Cercatore",
    description: "Guidato dall'intuizione e dalla vibrazione. Esplori territori inesplorati con curiosità e apertura mentale.",
    color: "#00d1ff",
    icon: "🔍",
    accentVar: "hsl(190, 100%, 50%)"
  },
  Breaker: {
    id: "Breaker",
    name: "Breaker",
    nameIt: "Spezzacatene",
    description: "Audacia e rischio sono il tuo motore. Sfidi i limiti e rompi gli schemi con coraggio.",
    color: "#ff2768",
    icon: "⚡",
    accentVar: "hsl(345, 100%, 57%)"
  },
  Oracle: {
    id: "Oracle",
    name: "Oracle",
    nameIt: "Oracolo",
    description: "Intuito elevato e rischio calibrato. Vedi oltre le apparenze e comprendi le dinamiche nascoste.",
    color: "#8a5cff",
    icon: "🔮",
    accentVar: "hsl(260, 100%, 67%)"
  },
  Warden: {
    id: "Warden",
    name: "Warden",
    nameIt: "Guardiano",
    description: "Etica e prudenza definiscono le tue scelte. Proteggi ciò che è giusto con integrità.",
    color: "#00ff85",
    icon: "🛡️",
    accentVar: "hsl(152, 100%, 50%)"
  },
  Nomad: {
    id: "Nomad",
    name: "Nomad",
    nameIt: "Nomade",
    description: "Equilibrio e adattabilità. Il tuo DNA è in costante ricerca della propria identità.",
    color: "#9d9d9d",
    icon: "🌐",
    accentVar: "hsl(0, 0%, 62%)"
  }
};
function calculateArchetype(scores) {
  const { intuito, audacia, etica, rischio, vibrazione } = scores;
  const seekerScore = intuito + vibrazione + (etica >= 50 ? 10 : 0);
  const breakerScore = audacia + rischio + (etica <= 55 ? 10 : 0);
  const oracleScore = (intuito >= 70 ? intuito + 20 : intuito) + (60 - Math.abs(rischio - 50));
  const wardenScore = (etica >= 70 ? etica + 20 : etica) + (60 - Math.abs(rischio - 30));
  const scores_map = {
    Seeker: seekerScore,
    Breaker: breakerScore,
    Oracle: oracleScore,
    Warden: wardenScore
  };
  const sorted = Object.entries(scores_map).sort((a, b) => b[1] - a[1]);
  return sorted[0][0];
}
function getDefaultScores() {
  return {
    intuito: 50,
    audacia: 50,
    etica: 50,
    rischio: 50,
    vibrazione: 50
  };
}
const DNA_QUESTIONS = [
  {
    id: "q1",
    attribute: "intuito",
    question: "Di fronte a una situazione nuova, ti affidi a:",
    options: [
      { label: "Analisi razionale e dati", value: 30 },
      { label: "Mix di logica e intuizione", value: 60 },
      { label: "Istinto e sensazioni", value: 90 }
    ]
  },
  {
    id: "q2",
    attribute: "audacia",
    question: "Preferisci prendere decisioni:",
    options: [
      { label: "Dopo aver valutato ogni dettaglio", value: 30 },
      { label: "Con una buona pianificazione", value: 60 },
      { label: "Rapidamente, seguendo l'impulso", value: 90 }
    ]
  },
  {
    id: "q3",
    attribute: "etica",
    question: "Per raggiungere un obiettivo importante:",
    options: [
      { label: "Tutti i mezzi sono leciti", value: 20 },
      { label: "Accetto compromessi ragionevoli", value: 60 },
      { label: "Mai scendere a compromessi etici", value: 95 }
    ]
  },
  {
    id: "q4",
    attribute: "rischio",
    question: "Il tuo rapporto con il rischio:",
    options: [
      { label: "Lo evito quando possibile", value: 20 },
      { label: "Lo gestisco con attenzione", value: 50 },
      { label: "Lo cerco attivamente", value: 85 }
    ]
  },
  {
    id: "q5",
    attribute: "vibrazione",
    question: "Ti senti più connesso a:",
    options: [
      { label: "Fatti concreti e tangibili", value: 30 },
      { label: "Equilibrio tra reale e possibile", value: 60 },
      { label: "Energie e possibilità nascoste", value: 90 }
    ]
  }
];

const getTodayKey = () => {
  const today = /* @__PURE__ */ new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, "0");
  const dd = String(today.getDate()).padStart(2, "0");
  return `${yyyy}-${mm}-${dd}`;
};
const useDNA = () => {
  const { isAuthenticated, getCurrentUser } = useUnifiedAuth();
  const [dnaProfile, setDnaProfile] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [needsOnboarding, setNeedsOnboarding] = reactExports.useState(false);
  const user = getCurrentUser();
  const userId = user?.id ?? "anon";
  reactExports.useEffect(() => {
    const loadDNA = async () => {
      if (!isAuthenticated || !user) {
        setIsLoading(false);
        return;
      }
      try {
        const remoteDNA = await dnaClient.getDna(userId);
        if (remoteDNA) {
          const archetype = remoteDNA.archetype || calculateArchetype({
            intuito: remoteDNA.intuito,
            audacia: remoteDNA.audacia,
            etica: remoteDNA.etica,
            rischio: remoteDNA.rischio,
            vibrazione: remoteDNA.vibrazione
          });
          const profile = {
            intuito: remoteDNA.intuito,
            audacia: remoteDNA.audacia,
            etica: remoteDNA.etica,
            rischio: remoteDNA.rischio,
            vibrazione: remoteDNA.vibrazione,
            archetype,
            completedAt: remoteDNA.updated_at
          };
          setDnaProfile(profile);
          localStorage.setItem(`dna:profile:${userId}`, JSON.stringify(profile));
          localStorage.setItem(`dna:completed:${userId}`, "1");
          setNeedsOnboarding(false);
          console.info("[DNA] Loaded from Supabase", { userId, archetype });
        } else {
          const localProfile = localStorage.getItem(`dna:profile:${userId}`);
          const completed = localStorage.getItem(`dna:completed:${userId}`) === "1";
          if (localProfile && completed) {
            const profile = JSON.parse(localProfile);
            setDnaProfile(profile);
            setNeedsOnboarding(false);
            console.info("[DNA] Loaded from localStorage", { userId, archetype: profile.archetype });
          } else {
            const lastShown = localStorage.getItem(`dna:lastShown:${userId}`);
            const today = getTodayKey();
            if (lastShown !== today) {
              setNeedsOnboarding(true);
              console.info("[DNA] Onboarding needed", { userId, lastShown, today });
            } else {
              setNeedsOnboarding(false);
              console.info("[DNA] Onboarding blocked (same day)", { userId, today });
            }
          }
        }
      } catch (error) {
        console.error("[DNA] Error loading profile:", error);
      } finally {
        setIsLoading(false);
      }
    };
    loadDNA();
  }, [isAuthenticated, user, userId]);
  const saveDNA = async (scores) => {
    if (!user) return false;
    try {
      const archetype = calculateArchetype(scores);
      const profile = {
        ...scores,
        archetype,
        completedAt: (/* @__PURE__ */ new Date()).toISOString()
      };
      localStorage.setItem(`dna:profile:${userId}`, JSON.stringify(profile));
      localStorage.setItem(`dna:completed:${userId}`, "1");
      localStorage.setItem(`dna:lastShown:${userId}`, getTodayKey());
      setDnaProfile(profile);
      setNeedsOnboarding(false);
      console.info("[DNA] Saved locally", { userId, archetype });
      try {
        await dnaClient.updateDna(userId, scores);
        console.info("[DNA] Synced to Supabase", { userId });
      } catch (syncError) {
        console.warn("[DNA] Failed to sync to Supabase (non-fatal):", syncError);
      }
      return true;
    } catch (error) {
      console.error("[DNA] Error saving profile:", error);
      return false;
    }
  };
  const recordOnboardingShown = () => {
    localStorage.setItem(`dna:lastShown:${userId}`, getTodayKey());
    setNeedsOnboarding(false);
    console.info("[DNA] Onboarding skipped", { userId, date: getTodayKey() });
  };
  const pendingUpdateRef = reactExports.useRef(null);
  const updateDNA = reactExports.useCallback(async (partial) => {
    if (!dnaProfile) return false;
    if (pendingUpdateRef.current) {
      clearTimeout(pendingUpdateRef.current);
    }
    return new Promise((resolve) => {
      pendingUpdateRef.current = setTimeout(async () => {
        const updatedScores = {
          intuito: partial.intuito ?? dnaProfile.intuito,
          audacia: partial.audacia ?? dnaProfile.audacia,
          etica: partial.etica ?? dnaProfile.etica,
          rischio: partial.rischio ?? dnaProfile.rischio,
          vibrazione: partial.vibrazione ?? dnaProfile.vibrazione
        };
        const result = await saveDNA(updatedScores);
        resolve(result);
      }, 400);
    });
  }, [dnaProfile, saveDNA]);
  reactExports.useEffect(() => {
  }, [user, dnaProfile]);
  return {
    dnaProfile,
    isLoading,
    needsOnboarding,
    saveDNA,
    updateDNA,
    recordOnboardingShown
  };
};

const ArchetypeIcon = ({
  archetype,
  size = 24,
  animated = true
}) => {
  const shouldAnimate = animated && window.matchMedia("(prefers-reduced-motion: no-preference)").matches;
  const color = ARCHETYPE_CONFIGS[archetype].color;
  const iconVariants = {
    Seeker: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M12 5C7 5 2.73 8.11 1 12.5c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5C21.27 8.11 17 5 12 5z",
          stroke: color,
          strokeWidth: "1.5",
          fill: "none",
          animate: shouldAnimate ? {
            opacity: [1, 0.7, 1],
            scale: [1, 1.02, 1]
          } : {},
          transition: {
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.circle,
        {
          cx: "12",
          cy: "12.5",
          r: "3.5",
          fill: color,
          opacity: "0.8",
          animate: shouldAnimate ? {
            scale: [1, 1.1, 1],
            opacity: [0.8, 1, 0.8]
          } : {},
          transition: {
            duration: 1.5,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "12", cy: "12.5", r: "1.5", fill: "#000" })
    ] }),
    Breaker: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M13 2L3 14h8l-1 8 10-12h-8l1-8z",
          fill: color,
          opacity: "0.9",
          animate: shouldAnimate ? {
            x: [0, -1, 1, 0],
            opacity: [0.9, 1, 0.9, 1, 0.9]
          } : {},
          transition: {
            duration: 0.8,
            repeat: Infinity,
            ease: "linear",
            times: [0, 0.2, 0.4, 0.6, 1]
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M13 2L3 14h8l-1 8 10-12h-8l1-8z",
          stroke: color,
          strokeWidth: "1",
          fill: "none",
          animate: shouldAnimate ? {
            opacity: [0, 0.5, 0],
            scale: [1, 1.05, 1]
          } : {},
          transition: {
            duration: 1.2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      )
    ] }),
    Oracle: /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("g", { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "path",
        {
          d: "M12 2L6 7l6 5 6-5-6-5z",
          fill: color,
          opacity: "0.7"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "path",
        {
          d: "M12 12l-6 5 6 5 6-5-6-5z",
          fill: color,
          opacity: "0.9"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M6 7v10l6 5V12L6 7z",
          fill: color,
          opacity: "0.5",
          animate: shouldAnimate ? {
            opacity: [0.5, 0.7, 0.5]
          } : {},
          transition: {
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "path",
        {
          d: "M18 7v10l-6 5V12l6-5z",
          fill: color,
          opacity: "0.6"
        }
      )
    ] }) }),
    Warden: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "path",
        {
          d: "M12 2L4 6v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V6l-8-4z",
          stroke: color,
          strokeWidth: "1.5",
          fill: "none"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.circle,
        {
          cx: "12",
          cy: "12",
          r: "4",
          stroke: color,
          strokeWidth: "1.5",
          fill: "none",
          animate: shouldAnimate ? {
            scale: [1, 1.1, 1],
            opacity: [0.6, 1, 0.6]
          } : {},
          transition: {
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.path,
        {
          d: "M12 8v8M8 12h8",
          stroke: color,
          strokeWidth: "2",
          strokeLinecap: "round",
          animate: shouldAnimate ? {
            opacity: [0.8, 1, 0.8]
          } : {},
          transition: {
            duration: 1.5,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      )
    ] }),
    Nomad: /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { width: size, height: size, viewBox: "0 0 24 24", fill: "none", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "circle",
        {
          cx: "12",
          cy: "12",
          r: "8",
          stroke: color,
          strokeWidth: "1.5",
          fill: "none",
          opacity: "0.3"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.circle,
        {
          cx: "12",
          cy: "12",
          r: "5",
          stroke: color,
          strokeWidth: "1",
          fill: "none",
          opacity: "0.5",
          animate: shouldAnimate ? {
            scale: [1, 1.05, 1]
          } : {},
          transition: {
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut"
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("g", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("circle", { cx: "20", cy: "12", r: "2", fill: color, opacity: "0.8" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.circle,
          {
            cx: "18",
            cy: "12",
            r: "1.5",
            fill: color,
            opacity: "0.4",
            animate: shouldAnimate ? {
              opacity: [0.4, 0, 0.4]
            } : {},
            transition: {
              duration: 1,
              repeat: Infinity,
              ease: "easeInOut"
            }
          }
        )
      ] })
    ] })
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "inline-flex items-center justify-center", style: { filter: `drop-shadow(0 0 8px ${color}40)` }, children: iconVariants[archetype] });
};

const DNAQuickAction = () => {
  const [, setLocation] = useLocation();
  const { dnaProfile, isLoading } = useDNA();
  if (isLoading || !dnaProfile) {
    return null;
  }
  const archetypeConfig = ARCHETYPE_CONFIGS[dnaProfile.archetype];
  const handleClick = () => {
    setLocation("/dna");
    ue$1.info("DNA Hub aperto", {
      description: `${archetypeConfig.nameIt} — Codice Vivo`,
      icon: archetypeConfig.icon
    });
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.button,
    {
      "aria-label": `M1SSION DNA - ${archetypeConfig.nameIt}`,
      onClick: handleClick,
      className: "fixed z-[70] top-48 right-4 md:top-56 md:right-8 w-12 h-12 md:w-14 md:h-14 rounded-full backdrop-blur-md border shadow-lg transition-all flex items-center justify-center",
      style: {
        backgroundColor: `${archetypeConfig.color}15`,
        borderColor: `${archetypeConfig.color}40`,
        boxShadow: `0 8px 30px ${archetypeConfig.color}25, 0 0 20px ${archetypeConfig.color}15`
      },
      initial: { opacity: 0, scale: 0.9, y: -10 },
      animate: { opacity: 1, scale: 1, y: 0 },
      transition: { duration: 0.4, delay: 0.1 },
      whileHover: { scale: 1.05 },
      whileTap: { scale: 0.95 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute inset-0 rounded-full",
            style: {
              backgroundColor: archetypeConfig.color,
              opacity: 0.2
            },
            animate: {
              scale: [1, 1.2, 1],
              opacity: [0.2, 0.1, 0.2]
            },
            transition: {
              duration: 2,
              repeat: Infinity,
              ease: "easeInOut"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative z-10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          ArchetypeIcon,
          {
            archetype: dnaProfile.archetype,
            size: 24,
            animated: true
          }
        ) })
      ]
    }
  );
};

const RECONNECT_EVENTS = {
  RECONNECTING: "realtime:reconnecting",
  SUBSCRIBED: "realtime:subscribed",
  ERROR: "realtime:error"
};
function emitSubscribed(channelName) {
  const event = new CustomEvent(RECONNECT_EVENTS.SUBSCRIBED, {
    detail: {
      timestamp: Date.now(),
      channelName
    }
  });
  window.dispatchEvent(event);
  console.log("✅ [Realtime] Subscribed", { channelName });
}
function emitError(reason, channelName) {
  const event = new CustomEvent(RECONNECT_EVENTS.ERROR, {
    detail: {
      timestamp: Date.now(),
      channelName,
      reason
    }
  });
  window.dispatchEvent(event);
  const isCritical = reason === "TIMED_OUT" || reason === "NETWORK_ERROR";
  if (isCritical) {
    console.warn("⚠️ [Realtime] Connection issue", { channelName, reason });
  } else {
    console.debug("🔌 [Realtime] Channel state", { channelName, reason });
  }
}
function onReconnectEvent(eventType, handler) {
  const listener = (event) => {
    handler(event.detail);
  };
  window.addEventListener(eventType, listener);
  return () => {
    window.removeEventListener(eventType, listener);
  };
}

const usePulseRealtime = () => {
  const [pulseState, setPulseState] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const [lastUpdate, setLastUpdate] = reactExports.useState(null);
  const channelRef = reactExports.useRef(null);
  const lastUpdateTime = reactExports.useRef(0);
  const fetchState = reactExports.useCallback(async () => {
    try {
      setIsLoading(true);
      setError(null);
      const { data, error: rpcError } = await supabase.rpc("rpc_pulse_state_read");
      if (rpcError) throw rpcError;
      if (data) {
        const parsed = typeof data === "string" ? JSON.parse(data) : data;
        setPulseState(parsed);
      }
    } catch (err) {
      setError(err);
    } finally {
      setIsLoading(false);
    }
  }, []);
  reactExports.useEffect(() => {
    fetchState();
    const stateChannel = supabase.channel("pulse_state_changes").on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "pulse_state"
      },
      (payload) => {
        const newRow = payload.new;
        setPulseState(newRow);
      }
    ).subscribe((status) => {
      if (status === "SUBSCRIBED") {
        emitSubscribed("pulse_state_changes");
      } else if (status === "CHANNEL_ERROR" || status === "TIMED_OUT") {
        emitError(String(status), "pulse_state_changes");
      }
    });
    const notifyChannel = supabase.channel("pulse_notifications").on("broadcast", { event: "pulse_update" }, (payload) => {
      const now = Date.now();
      if (now - lastUpdateTime.current < 100) return;
      lastUpdateTime.current = now;
      setLastUpdate(payload.payload);
    }).subscribe((status) => {
      if (status === "SUBSCRIBED") {
        emitSubscribed("pulse_notifications");
      } else if (status === "CHANNEL_ERROR" || status === "TIMED_OUT") {
        emitError(String(status), "pulse_notifications");
      }
    });
    channelRef.current = { stateChannel, notifyChannel };
    return () => {
      stateChannel.unsubscribe();
      notifyChannel.unsubscribe();
    };
  }, [fetchState]);
  return {
    pulseState,
    isLoading,
    error,
    lastUpdate,
    refetch: fetchState
  };
};

const useAgentEnergy = () => {
  const { user } = useAuth();
  const [energy, setEnergy] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const [lastDelta, setLastDelta] = reactExports.useState(null);
  const channelRef = reactExports.useRef(null);
  const previousPE = reactExports.useRef(0);
  const fetchRanks = reactExports.useCallback(async () => {
    const { data, error: error2 } = await supabase.from("agent_ranks").select("*").order("pe_min", { ascending: true });
    if (error2) throw error2;
    return data || [];
  }, []);
  const calculateProgress = (currentPE, currentRank, nextRank) => {
    if (!currentRank || !nextRank) {
      return { progress: 100, peToNext: 0 };
    }
    const rangeStart = currentRank.pe_min;
    const rangeEnd = nextRank.pe_min;
    const peInRange = currentPE - rangeStart;
    const totalRange = rangeEnd - rangeStart;
    const progress = Math.min(100, Math.max(0, peInRange / totalRange * 100));
    const peToNext = Math.max(0, rangeEnd - currentPE);
    return { progress, peToNext };
  };
  const fetchEnergy = reactExports.useCallback(async () => {
    if (!user?.id) return;
    try {
      setIsLoading(true);
      setError(null);
      const { data: profile, error: profileError } = await supabase.from("profiles").select(`
          pulse_energy,
          rank_id,
          agent_ranks:rank_id (
            id, code, name_en, name_it, description, pe_min, pe_max, color, symbol
          )
        `).eq("id", user.id).single();
      if (profileError) throw profileError;
      const allRanks = await fetchRanks();
      const currentPE = profile?.pulse_energy || 0;
      const currentRank = profile?.agent_ranks;
      const nextRank = allRanks.find(
        (r) => r.pe_min > currentPE && r.code !== "SRC-∞"
      ) || null;
      const { progress, peToNext } = calculateProgress(currentPE, currentRank, nextRank);
      if (previousPE.current > 0 && currentPE !== previousPE.current) {
        const delta = currentPE - previousPE.current;
        if (delta > 0) {
          setLastDelta(delta);
          setTimeout(() => setLastDelta(null), 3e3);
        }
      }
      previousPE.current = currentPE;
      setEnergy({
        pulseEnergy: currentPE,
        rank: currentRank,
        nextRank,
        progressToNextRank: progress,
        peToNextRank: peToNext
      });
    } catch (err) {
      console.error("❌ useAgentEnergy error:", err);
      setError(err);
    } finally {
      setIsLoading(false);
    }
  }, [user?.id, fetchRanks]);
  reactExports.useEffect(() => {
    fetchEnergy();
  }, [fetchEnergy]);
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const channel = supabase.channel(`agent_energy_${user.id}`).on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "profiles",
        filter: `id=eq.${user.id}`
      },
      (payload) => {
        const newPE = payload.new.pulse_energy;
        const oldPE = previousPE.current;
        if (newPE !== oldPE) {
          console.log(`⚡ PE Update: ${oldPE} → ${newPE} (+${newPE - oldPE})`);
          fetchEnergy();
        }
      }
    ).subscribe((status) => {
      if (status === "SUBSCRIBED") {
        console.log("✅ Agent energy realtime subscribed");
      }
    });
    channelRef.current = channel;
    return () => {
      channel.unsubscribe();
    };
  }, [user?.id, fetchEnergy]);
  return {
    energy,
    isLoading,
    error,
    lastDelta,
    refetch: fetchEnergy
  };
};

const PulseBar = ({ onTap, variant = "inline" }) => {
  const { pulseState, lastUpdate } = usePulseRealtime();
  const [showSurge, setShowSurge] = reactExports.useState(false);
  const [reduceMotion, setReduceMotion] = reactExports.useState(false);
  const value = pulseState?.value ?? 0;
  const flowSpeed = value < 25 ? "6s" : value < 50 ? "4s" : value < 75 ? "3s" : "2.5s";
  const brightness = value < 25 ? 0.7 : value < 50 ? 0.85 : value < 75 ? 1 : 1.1;
  const pulseScale = value < 25 ? 1 : value < 50 ? 1.01 : value < 75 ? 1.02 : 1.03;
  const outlineIntensity = value < 25 ? 0.7 : value < 50 ? 0.9 : value < 75 ? 1.1 : 1.3;
  const breathSpeed = value < 25 ? "2.5s" : value < 50 ? "2s" : value < 75 ? "1.6s" : "1.2s";
  reactExports.useEffect(() => {
    const prefersReducedMotion = localStorage.getItem("pulse_reduce_motion") === "true";
    setReduceMotion(prefersReducedMotion);
  }, []);
  reactExports.useEffect(() => {
    if (lastUpdate?.threshold && !reduceMotion) {
      setShowSurge(true);
      const timer = setTimeout(() => setShowSurge(false), 900);
      return () => clearTimeout(timer);
    }
  }, [lastUpdate?.threshold, reduceMotion]);
  reactExports.useEffect(() => {
    if (reduceMotion) return;
    const triggerSpike = () => {
      const root = document.documentElement;
      root.style.setProperty("--flow-speed", "1.2s");
      root.style.setProperty("--pulse-brightness", "1.3");
      setTimeout(() => {
        root.style.setProperty("--flow-speed", flowSpeed);
        root.style.setProperty("--pulse-brightness", String(brightness));
      }, 1500);
    };
    const interval = setInterval(triggerSpike, Math.random() * 2e4 + 2e4);
    return () => clearInterval(interval);
  }, [flowSpeed, brightness, reduceMotion]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      className: "relative w-full",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      transition: { duration: 0.5 },
      onClick: onTap,
      style: { cursor: onTap ? "pointer" : "default" },
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "relative w-full h-[12px] rounded-full overflow-hidden",
          style: {
            boxShadow: "0 0 20px rgba(0,231,255,0.5), 0 0 40px rgba(255,77,240,0.3)"
          },
          animate: showSurge ? {
            scale: [1, 1.03, 1],
            boxShadow: [
              "0 0 20px rgba(0,231,255,0.5)",
              "0 0 50px rgba(255,77,240,0.9)",
              "0 0 20px rgba(0,231,255,0.5)"
            ]
          } : {},
          transition: { duration: 0.9, ease: "easeInOut" },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "absolute inset-0",
                style: {
                  background: "linear-gradient(270deg, #ff4df0, #00eaff, #e0ffff, #00eaff, #ff4df0)",
                  backgroundSize: "400% 400%",
                  filter: `brightness(${brightness})`
                },
                animate: reduceMotion ? {} : {
                  backgroundPosition: ["0% 50%", "100% 50%", "0% 50%"]
                },
                transition: {
                  duration: parseFloat(flowSpeed),
                  repeat: Infinity,
                  ease: "linear"
                }
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "absolute inset-0",
                style: {
                  background: "radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%)"
                },
                animate: reduceMotion ? {} : {
                  scale: [1, pulseScale, 1],
                  opacity: [0.5, 0.8, 0.5]
                },
                transition: {
                  duration: parseFloat(breathSpeed),
                  repeat: Infinity,
                  ease: "easeInOut"
                }
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "absolute inset-0 rounded-full pointer-events-none",
                style: {
                  border: "1px solid rgba(255,255,255,0.4)",
                  boxShadow: `inset 0 0 10px rgba(0,200,255,${0.3 * outlineIntensity})`
                },
                animate: reduceMotion ? {} : {
                  boxShadow: [
                    `inset 0 0 10px rgba(0,200,255,${0.3 * outlineIntensity})`,
                    `inset 0 0 15px rgba(255,77,240,${0.4 * outlineIntensity})`,
                    `inset 0 0 10px rgba(0,200,255,${0.3 * outlineIntensity})`
                  ]
                },
                transition: {
                  duration: parseFloat(breathSpeed),
                  repeat: Infinity,
                  ease: "easeInOut"
                }
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 flex items-center justify-end pr-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.span,
              {
                className: "text-[10px] font-mono font-bold text-white tracking-wider tabular-nums",
                style: {
                  textShadow: "0 0 8px rgba(0,231,255,0.9), 0 0 12px rgba(255,77,240,0.6)",
                  filter: "drop-shadow(0 0 2px rgba(0,0,0,0.8))"
                },
                initial: { opacity: 0, scale: 0.8 },
                animate: { opacity: 1, scale: 1 },
                transition: { duration: 0.3 },
                children: [
                  Math.round(value),
                  "%"
                ]
              },
              value
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showSurge && !reduceMotion && /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "absolute inset-0 pointer-events-none",
                initial: { opacity: 0 },
                animate: { opacity: [0, 0.8, 0] },
                exit: { opacity: 0 },
                transition: { duration: 0.9 },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(255,255,255,0.7)_0%,transparent_60%)]" })
              }
            ) })
          ]
        }
      )
    }
  );
};

const AgentEnergyPill = () => {
  const { energy, isLoading, lastDelta } = useAgentEnergy();
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const [showPEGain, setShowPEGain] = reactExports.useState(false);
  const pulseEnergy = energy?.pulseEnergy ?? 0;
  const rank = energy?.rank;
  const progressPercent = energy?.progressToNextRank ?? 0;
  const peToNext = energy?.peToNextRank ?? 0;
  const nextRank = energy?.nextRank;
  const rankLevel = rank ? parseInt(rank.code.match(/\d+/)?.[0] || "1") : 1;
  reactExports.useEffect(() => {
    if (lastDelta && lastDelta > 0) {
      setShowPEGain(true);
      setTimeout(() => setShowPEGain(false), 2500);
    }
  }, [lastDelta]);
  const formatPE = (pe) => {
    if (pe >= 1e6) return `${(pe / 1e6).toFixed(1)}M`;
    if (pe >= 1e3) return `${(pe / 1e3).toFixed(1)}K`;
    return pe.toString();
  };
  if (isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "pe-pill-orb opacity-50" });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.button,
      {
        className: "pe-pill-orb",
        "aria-label": "Agent Energy",
        whileHover: { scale: 1.03 },
        whileTap: { scale: 0.97 },
        onClick: () => setIsExpanded(!isExpanded),
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg z-10 relative", children: rank?.symbol || "🔰" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "pe-dot" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("svg", { className: "absolute inset-0 w-full h-full -rotate-90 pointer-events-none", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "circle",
              {
                cx: "50%",
                cy: "50%",
                r: "45%",
                fill: "none",
                stroke: "rgba(0, 255, 200, 0.15)",
                strokeWidth: "2"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "circle",
              {
                cx: "50%",
                cy: "50%",
                r: "45%",
                fill: "none",
                stroke: "url(#peGradient)",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeDasharray: `${progressPercent * 2.83} 283`,
                style: { transition: "stroke-dasharray 0.8s ease" }
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("defs", { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("linearGradient", { id: "peGradient", x1: "0%", y1: "0%", x2: "100%", y2: "0%", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "0%", stopColor: "#00d4ff" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "50%", stopColor: "#8b5cf6" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("stop", { offset: "100%", stopColor: "#00ff88" })
            ] }) })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showPEGain && lastDelta && lastDelta > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        className: "absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap z-20",
        initial: { opacity: 0, y: 5, scale: 0.8 },
        animate: { opacity: 1, y: 0, scale: 1 },
        exit: { opacity: 0, y: -10, scale: 0.8 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-emerald-500/20 border border-emerald-400/50 text-emerald-400", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-3 h-3" }),
          "+",
          lastDelta,
          " PE"
        ] })
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 z-[140]", onClick: () => setIsExpanded(false) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "absolute top-full left-0 mt-2 z-[150] min-w-[220px]",
          initial: { opacity: 0, y: -10, scale: 0.9 },
          animate: { opacity: 1, y: 0, scale: 1 },
          exit: { opacity: 0, y: -10, scale: 0.9 },
          transition: { type: "spring", damping: 25 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
            "div",
            {
              className: "p-4 rounded-2xl",
              style: {
                background: "radial-gradient(120% 120% at 50% 10%, rgba(255,255,255,.06), rgba(0,0,0,.4) 58%)",
                border: "1px solid rgba(255, 255, 255, 0.15)",
                boxShadow: "0 2px 20px rgba(0,0,0,.5), 0 0 30px rgba(0, 255, 200, 0.1) inset",
                backdropFilter: "blur(16px)"
              },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 mb-3 pb-3 border-b border-white/10", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-2xl", children: rank?.symbol }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-bold font-orbitron", style: { color: rank?.color || "#00d4ff" }, children: rank?.name_it || "Recluta" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-[10px] font-mono text-white/40", children: [
                      rank?.code,
                      " • LVL ",
                      rankLevel
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-[9px] font-mono text-cyan-400/50 mb-1", children: "PULSE ENERGY" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-bold font-orbitron", style: {
                    background: "linear-gradient(90deg, #00d4ff, #8b5cf6, #00ff88)",
                    WebkitBackgroundClip: "text",
                    WebkitTextFillColor: "transparent"
                  }, children: [
                    formatPE(pulseEnergy),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/30 ml-1", style: { WebkitTextFillColor: "initial" }, children: "PE" })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-[9px] font-mono mb-1", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/40", children: "PROGRESS" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-cyan-400", children: [
                      Math.round(progressPercent),
                      "%"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-1.5 bg-black/40 rounded-full overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      className: "h-full rounded-full",
                      style: { background: "linear-gradient(90deg, #00d4ff, #8b5cf6, #00ff88)" },
                      initial: { width: 0 },
                      animate: { width: `${progressPercent}%` }
                    }
                  ) }),
                  nextRank && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 text-[9px] font-mono text-white/30", children: [
                    "→ ",
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { style: { color: nextRank.color }, children: [
                      nextRank.symbol,
                      " ",
                      nextRank.name_it
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white/20", children: [
                      " (",
                      formatPE(peToNext),
                      " PE)"
                    ] })
                  ] })
                ] })
              ]
            }
          )
        }
      )
    ] }) })
  ] });
};

const SheetPortal = Portal$1;
const SheetOverlay = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Overlay,
  {
    className: cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    ),
    ...props,
    ref
  }
));
SheetOverlay.displayName = Overlay.displayName;
const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom: "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right: "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"
      }
    },
    defaultVariants: {
      side: "right"
    }
  }
);
const SheetContent = reactExports.forwardRef(({ side = "right", className, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(SheetPortal, { children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(SheetOverlay, {}),
  /* @__PURE__ */ jsxRuntimeExports.jsxs(
    Content,
    {
      ref,
      className: cn(sheetVariants({ side }), className),
      ...props,
      children: [
        children,
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Close, { className: "absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "h-4 w-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only", children: "Close" })
        ] })
      ]
    }
  )
] }));
SheetContent.displayName = Content.displayName;
const SheetTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Title,
  {
    ref,
    className: cn("text-lg font-semibold text-foreground", className),
    ...props
  }
));
SheetTitle.displayName = Title.displayName;
const SheetDescription = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Description,
  {
    ref,
    className: cn("text-sm text-muted-foreground", className),
    ...props
  }
));
SheetDescription.displayName = Description.displayName;

const ScrollArea = reactExports.forwardRef(
  ({ className, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      ref,
      className: cn("relative overflow-hidden", className),
      ...props,
      children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-full w-full rounded-[inherit] overflow-auto", children })
    }
  )
);
ScrollArea.displayName = "ScrollArea";

// src/primitive.tsx
var NODES = [
  "a",
  "button",
  "div",
  "form",
  "h2",
  "h3",
  "img",
  "input",
  "label",
  "li",
  "nav",
  "ol",
  "p",
  "select",
  "span",
  "svg",
  "ul"
];
var Primitive = NODES.reduce((primitive, node) => {
  const Slot = createSlot$1(`Primitive.${node}`);
  const Node = reactExports.forwardRef((props, forwardedRef) => {
    const { asChild, ...primitiveProps } = props;
    const Comp = asChild ? Slot : node;
    if (typeof window !== "undefined") {
      window[Symbol.for("radix-ui")] = true;
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Comp, { ...primitiveProps, ref: forwardedRef });
  });
  Node.displayName = `Primitive.${node}`;
  return { ...primitive, [node]: Node };
}, {});

// src/separator.tsx
var NAME$1 = "Separator";
var DEFAULT_ORIENTATION = "horizontal";
var ORIENTATIONS = ["horizontal", "vertical"];
var Separator$2 = reactExports.forwardRef((props, forwardedRef) => {
  const { decorative, orientation: orientationProp = DEFAULT_ORIENTATION, ...domProps } = props;
  const orientation = isValidOrientation(orientationProp) ? orientationProp : DEFAULT_ORIENTATION;
  const ariaOrientation = orientation === "vertical" ? orientation : void 0;
  const semanticProps = decorative ? { role: "none" } : { "aria-orientation": ariaOrientation, role: "separator" };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Primitive.div,
    {
      "data-orientation": orientation,
      ...semanticProps,
      ...domProps,
      ref: forwardedRef
    }
  );
});
Separator$2.displayName = NAME$1;
function isValidOrientation(orientation) {
  return ORIENTATIONS.includes(orientation);
}
var Root = Separator$2;

const Separator$1 = reactExports.forwardRef(
  ({ className, orientation = "horizontal", decorative = true, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    Root,
    {
      ref,
      decorative,
      orientation,
      className: cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      ),
      ...props
    }
  )
);
Separator$1.displayName = Root.displayName;

/**
 * @name toDate
 * @category Common Helpers
 * @summary Convert the given argument to an instance of Date.
 *
 * @description
 * Convert the given argument to an instance of Date.
 *
 * If the argument is an instance of Date, the function returns its clone.
 *
 * If the argument is a number, it is treated as a timestamp.
 *
 * If the argument is none of the above, the function returns Invalid Date.
 *
 * **Note**: *all* Date arguments passed to any *date-fns* function is processed by `toDate`.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param argument - The value to convert
 *
 * @returns The parsed date in the local time zone
 *
 * @example
 * // Clone the date:
 * const result = toDate(new Date(2014, 1, 11, 11, 30, 30))
 * //=> Tue Feb 11 2014 11:30:30
 *
 * @example
 * // Convert the timestamp to date:
 * const result = toDate(1392098430000)
 * //=> Tue Feb 11 2014 11:30:30
 */
function toDate(argument) {
  const argStr = Object.prototype.toString.call(argument);

  // Clone the date
  if (
    argument instanceof Date ||
    (typeof argument === "object" && argStr === "[object Date]")
  ) {
    // Prevent the date to lose the milliseconds when passed to new Date() in IE10
    return new argument.constructor(+argument);
  } else if (
    typeof argument === "number" ||
    argStr === "[object Number]" ||
    typeof argument === "string" ||
    argStr === "[object String]"
  ) {
    // TODO: Can we get rid of as?
    return new Date(argument);
  } else {
    // TODO: Can we get rid of as?
    return new Date(NaN);
  }
}

/**
 * @name constructFrom
 * @category Generic Helpers
 * @summary Constructs a date using the reference date and the value
 *
 * @description
 * The function constructs a new date using the constructor from the reference
 * date and the given value. It helps to build generic functions that accept
 * date extensions.
 *
 * It defaults to `Date` if the passed reference date is a number or a string.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The reference date to take constructor from
 * @param value - The value to create the date
 *
 * @returns Date initialized using the given date and value
 *
 * @example
 * import { constructFrom } from 'date-fns'
 *
 * // A function that clones a date preserving the original type
 * function cloneDate<DateType extends Date(date: DateType): DateType {
 *   return constructFrom(
 *     date, // Use contrustor from the given date
 *     date.getTime() // Use the date value to create a new date
 *   )
 * }
 */
function constructFrom(date, value) {
  if (date instanceof Date) {
    return new date.constructor(value);
  } else {
    return new Date(value);
  }
}

/**
 * @module constants
 * @summary Useful constants
 * @description
 * Collection of useful date constants.
 *
 * The constants could be imported from `date-fns/constants`:
 *
 * ```ts
 * import { maxTime, minTime } from "./constants/date-fns/constants";
 *
 * function isAllowedTime(time) {
 *   return time <= maxTime && time >= minTime;
 * }
 * ```
 */


/**
 * @constant
 * @name millisecondsInWeek
 * @summary Milliseconds in 1 week.
 */
const millisecondsInWeek = 604800000;

/**
 * @constant
 * @name millisecondsInDay
 * @summary Milliseconds in 1 day.
 */
const millisecondsInDay = 86400000;

/**
 * @constant
 * @name minutesInMonth
 * @summary Minutes in 1 month.
 */
const minutesInMonth = 43200;

/**
 * @constant
 * @name minutesInDay
 * @summary Minutes in 1 day.
 */
const minutesInDay = 1440;

let defaultOptions$1 = {};

function getDefaultOptions() {
  return defaultOptions$1;
}

/**
 * The {@link startOfWeek} function options.
 */

/**
 * @name startOfWeek
 * @category Week Helpers
 * @summary Return the start of a week for the given date.
 *
 * @description
 * Return the start of a week for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 * @param options - An object with options
 *
 * @returns The start of a week
 *
 * @example
 * // The start of a week for 2 September 2014 11:55:00:
 * const result = startOfWeek(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Sun Aug 31 2014 00:00:00
 *
 * @example
 * // If the week starts on Monday, the start of the week for 2 September 2014 11:55:00:
 * const result = startOfWeek(new Date(2014, 8, 2, 11, 55, 0), { weekStartsOn: 1 })
 * //=> Mon Sep 01 2014 00:00:00
 */
function startOfWeek(date, options) {
  const defaultOptions = getDefaultOptions();
  const weekStartsOn =
    options?.weekStartsOn ??
    options?.locale?.options?.weekStartsOn ??
    defaultOptions.weekStartsOn ??
    defaultOptions.locale?.options?.weekStartsOn ??
    0;

  const _date = toDate(date);
  const day = _date.getDay();
  const diff = (day < weekStartsOn ? 7 : 0) + day - weekStartsOn;

  _date.setDate(_date.getDate() - diff);
  _date.setHours(0, 0, 0, 0);
  return _date;
}

/**
 * @name startOfISOWeek
 * @category ISO Week Helpers
 * @summary Return the start of an ISO week for the given date.
 *
 * @description
 * Return the start of an ISO week for the given date.
 * The result will be in the local timezone.
 *
 * ISO week-numbering year: http://en.wikipedia.org/wiki/ISO_week_date
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The start of an ISO week
 *
 * @example
 * // The start of an ISO week for 2 September 2014 11:55:00:
 * const result = startOfISOWeek(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Mon Sep 01 2014 00:00:00
 */
function startOfISOWeek(date) {
  return startOfWeek(date, { weekStartsOn: 1 });
}

/**
 * @name getISOWeekYear
 * @category ISO Week-Numbering Year Helpers
 * @summary Get the ISO week-numbering year of the given date.
 *
 * @description
 * Get the ISO week-numbering year of the given date,
 * which always starts 3 days before the year's first Thursday.
 *
 * ISO week-numbering year: http://en.wikipedia.org/wiki/ISO_week_date
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 *
 * @returns The ISO week-numbering year
 *
 * @example
 * // Which ISO-week numbering year is 2 January 2005?
 * const result = getISOWeekYear(new Date(2005, 0, 2))
 * //=> 2004
 */
function getISOWeekYear(date) {
  const _date = toDate(date);
  const year = _date.getFullYear();

  const fourthOfJanuaryOfNextYear = constructFrom(date, 0);
  fourthOfJanuaryOfNextYear.setFullYear(year + 1, 0, 4);
  fourthOfJanuaryOfNextYear.setHours(0, 0, 0, 0);
  const startOfNextYear = startOfISOWeek(fourthOfJanuaryOfNextYear);

  const fourthOfJanuaryOfThisYear = constructFrom(date, 0);
  fourthOfJanuaryOfThisYear.setFullYear(year, 0, 4);
  fourthOfJanuaryOfThisYear.setHours(0, 0, 0, 0);
  const startOfThisYear = startOfISOWeek(fourthOfJanuaryOfThisYear);

  if (_date.getTime() >= startOfNextYear.getTime()) {
    return year + 1;
  } else if (_date.getTime() >= startOfThisYear.getTime()) {
    return year;
  } else {
    return year - 1;
  }
}

/**
 * @name startOfDay
 * @category Day Helpers
 * @summary Return the start of a day for the given date.
 *
 * @description
 * Return the start of a day for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The start of a day
 *
 * @example
 * // The start of a day for 2 September 2014 11:55:00:
 * const result = startOfDay(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Tue Sep 02 2014 00:00:00
 */
function startOfDay(date) {
  const _date = toDate(date);
  _date.setHours(0, 0, 0, 0);
  return _date;
}

/**
 * Google Chrome as of 67.0.3396.87 introduced timezones with offset that includes seconds.
 * They usually appear for dates that denote time before the timezones were introduced
 * (e.g. for 'Europe/Prague' timezone the offset is GMT+00:57:44 before 1 October 1891
 * and GMT+01:00:00 after that date)
 *
 * Date#getTimezoneOffset returns the offset in minutes and would return 57 for the example above,
 * which would lead to incorrect calculations.
 *
 * This function returns the timezone offset in milliseconds that takes seconds in account.
 */
function getTimezoneOffsetInMilliseconds(date) {
  const _date = toDate(date);
  const utcDate = new Date(
    Date.UTC(
      _date.getFullYear(),
      _date.getMonth(),
      _date.getDate(),
      _date.getHours(),
      _date.getMinutes(),
      _date.getSeconds(),
      _date.getMilliseconds(),
    ),
  );
  utcDate.setUTCFullYear(_date.getFullYear());
  return +date - +utcDate;
}

/**
 * @name differenceInCalendarDays
 * @category Day Helpers
 * @summary Get the number of calendar days between the given dates.
 *
 * @description
 * Get the number of calendar days between the given dates. This means that the times are removed
 * from the dates and then the difference in days is calculated.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 *
 * @returns The number of calendar days
 *
 * @example
 * // How many calendar days are between
 * // 2 July 2011 23:00:00 and 2 July 2012 00:00:00?
 * const result = differenceInCalendarDays(
 *   new Date(2012, 6, 2, 0, 0),
 *   new Date(2011, 6, 2, 23, 0)
 * )
 * //=> 366
 * // How many calendar days are between
 * // 2 July 2011 23:59:00 and 3 July 2011 00:01:00?
 * const result = differenceInCalendarDays(
 *   new Date(2011, 6, 3, 0, 1),
 *   new Date(2011, 6, 2, 23, 59)
 * )
 * //=> 1
 */
function differenceInCalendarDays(dateLeft, dateRight) {
  const startOfDayLeft = startOfDay(dateLeft);
  const startOfDayRight = startOfDay(dateRight);

  const timestampLeft =
    +startOfDayLeft - getTimezoneOffsetInMilliseconds(startOfDayLeft);
  const timestampRight =
    +startOfDayRight - getTimezoneOffsetInMilliseconds(startOfDayRight);

  // Round the number of days to the nearest integer because the number of
  // milliseconds in a day is not constant (e.g. it's different in the week of
  // the daylight saving time clock shift).
  return Math.round((timestampLeft - timestampRight) / millisecondsInDay);
}

/**
 * @name startOfISOWeekYear
 * @category ISO Week-Numbering Year Helpers
 * @summary Return the start of an ISO week-numbering year for the given date.
 *
 * @description
 * Return the start of an ISO week-numbering year,
 * which always starts 3 days before the year's first Thursday.
 * The result will be in the local timezone.
 *
 * ISO week-numbering year: http://en.wikipedia.org/wiki/ISO_week_date
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The start of an ISO week-numbering year
 *
 * @example
 * // The start of an ISO week-numbering year for 2 July 2005:
 * const result = startOfISOWeekYear(new Date(2005, 6, 2))
 * //=> Mon Jan 03 2005 00:00:00
 */
function startOfISOWeekYear(date) {
  const year = getISOWeekYear(date);
  const fourthOfJanuary = constructFrom(date, 0);
  fourthOfJanuary.setFullYear(year, 0, 4);
  fourthOfJanuary.setHours(0, 0, 0, 0);
  return startOfISOWeek(fourthOfJanuary);
}

/**
 * @name compareAsc
 * @category Common Helpers
 * @summary Compare the two dates and return -1, 0 or 1.
 *
 * @description
 * Compare the two dates and return 1 if the first date is after the second,
 * -1 if the first date is before the second or 0 if dates are equal.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The first date to compare
 * @param dateRight - The second date to compare
 *
 * @returns The result of the comparison
 *
 * @example
 * // Compare 11 February 1987 and 10 July 1989:
 * const result = compareAsc(new Date(1987, 1, 11), new Date(1989, 6, 10))
 * //=> -1
 *
 * @example
 * // Sort the array of dates:
 * const result = [
 *   new Date(1995, 6, 2),
 *   new Date(1987, 1, 11),
 *   new Date(1989, 6, 10)
 * ].sort(compareAsc)
 * //=> [
 * //   Wed Feb 11 1987 00:00:00,
 * //   Mon Jul 10 1989 00:00:00,
 * //   Sun Jul 02 1995 00:00:00
 * // ]
 */
function compareAsc(dateLeft, dateRight) {
  const _dateLeft = toDate(dateLeft);
  const _dateRight = toDate(dateRight);

  const diff = _dateLeft.getTime() - _dateRight.getTime();

  if (diff < 0) {
    return -1;
  } else if (diff > 0) {
    return 1;
    // Return 0 if diff is 0; return NaN if diff is NaN
  } else {
    return diff;
  }
}

/**
 * @name constructNow
 * @category Generic Helpers
 * @summary Constructs a new current date using the passed value constructor.
 * @pure false
 *
 * @description
 * The function constructs a new current date using the constructor from
 * the reference date. It helps to build generic functions that accept date
 * extensions and use the current date.
 *
 * It defaults to `Date` if the passed reference date is a number or a string.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The reference date to take constructor from
 *
 * @returns Current date initialized using the given date constructor
 *
 * @example
 * import { constructNow, isSameDay } from 'date-fns'
 *
 * function isToday<DateType extends Date>(
 *   date: DateType | number | string,
 * ): boolean {
 *   // If we were to use `new Date()` directly, the function would  behave
 *   // differently in different timezones and return false for the same date.
 *   return isSameDay(date, constructNow(date));
 * }
 */
function constructNow(date) {
  return constructFrom(date, Date.now());
}

/**
 * @name isDate
 * @category Common Helpers
 * @summary Is the given value a date?
 *
 * @description
 * Returns true if the given value is an instance of Date. The function works for dates transferred across iframes.
 *
 * @param value - The value to check
 *
 * @returns True if the given value is a date
 *
 * @example
 * // For a valid date:
 * const result = isDate(new Date())
 * //=> true
 *
 * @example
 * // For an invalid date:
 * const result = isDate(new Date(NaN))
 * //=> true
 *
 * @example
 * // For some value:
 * const result = isDate('2014-02-31')
 * //=> false
 *
 * @example
 * // For an object:
 * const result = isDate({})
 * //=> false
 */
function isDate(value) {
  return (
    value instanceof Date ||
    (typeof value === "object" &&
      Object.prototype.toString.call(value) === "[object Date]")
  );
}

/**
 * @name isValid
 * @category Common Helpers
 * @summary Is the given date valid?
 *
 * @description
 * Returns false if argument is Invalid Date and true otherwise.
 * Argument is converted to Date using `toDate`. See [toDate](https://date-fns.org/docs/toDate)
 * Invalid Date is a Date, whose time value is NaN.
 *
 * Time value of Date: http://es5.github.io/#x15.9.1.1
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date to check
 *
 * @returns The date is valid
 *
 * @example
 * // For the valid date:
 * const result = isValid(new Date(2014, 1, 31))
 * //=> true
 *
 * @example
 * // For the value, convertable into a date:
 * const result = isValid(1393804800000)
 * //=> true
 *
 * @example
 * // For the invalid date:
 * const result = isValid(new Date(''))
 * //=> false
 */
function isValid(date) {
  if (!isDate(date) && typeof date !== "number") {
    return false;
  }
  const _date = toDate(date);
  return !isNaN(Number(_date));
}

/**
 * @name differenceInCalendarMonths
 * @category Month Helpers
 * @summary Get the number of calendar months between the given dates.
 *
 * @description
 * Get the number of calendar months between the given dates.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 *
 * @returns The number of calendar months
 *
 * @example
 * // How many calendar months are between 31 January 2014 and 1 September 2014?
 * const result = differenceInCalendarMonths(
 *   new Date(2014, 8, 1),
 *   new Date(2014, 0, 31)
 * )
 * //=> 8
 */
function differenceInCalendarMonths(dateLeft, dateRight) {
  const _dateLeft = toDate(dateLeft);
  const _dateRight = toDate(dateRight);

  const yearDiff = _dateLeft.getFullYear() - _dateRight.getFullYear();
  const monthDiff = _dateLeft.getMonth() - _dateRight.getMonth();

  return yearDiff * 12 + monthDiff;
}

function getRoundingMethod(method) {
  return (number) => {
    const round = method ? Math[method] : Math.trunc;
    const result = round(number);
    // Prevent negative zero
    return result === 0 ? 0 : result;
  };
}

/**
 * @name differenceInMilliseconds
 * @category Millisecond Helpers
 * @summary Get the number of milliseconds between the given dates.
 *
 * @description
 * Get the number of milliseconds between the given dates.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 *
 * @returns The number of milliseconds
 *
 * @example
 * // How many milliseconds are between
 * // 2 July 2014 12:30:20.600 and 2 July 2014 12:30:21.700?
 * const result = differenceInMilliseconds(
 *   new Date(2014, 6, 2, 12, 30, 21, 700),
 *   new Date(2014, 6, 2, 12, 30, 20, 600)
 * )
 * //=> 1100
 */
function differenceInMilliseconds(dateLeft, dateRight) {
  return +toDate(dateLeft) - +toDate(dateRight);
}

/**
 * @name endOfDay
 * @category Day Helpers
 * @summary Return the end of a day for the given date.
 *
 * @description
 * Return the end of a day for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The end of a day
 *
 * @example
 * // The end of a day for 2 September 2014 11:55:00:
 * const result = endOfDay(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Tue Sep 02 2014 23:59:59.999
 */
function endOfDay(date) {
  const _date = toDate(date);
  _date.setHours(23, 59, 59, 999);
  return _date;
}

/**
 * @name endOfMonth
 * @category Month Helpers
 * @summary Return the end of a month for the given date.
 *
 * @description
 * Return the end of a month for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The end of a month
 *
 * @example
 * // The end of a month for 2 September 2014 11:55:00:
 * const result = endOfMonth(new Date(2014, 8, 2, 11, 55, 0))
 * //=> Tue Sep 30 2014 23:59:59.999
 */
function endOfMonth(date) {
  const _date = toDate(date);
  const month = _date.getMonth();
  _date.setFullYear(_date.getFullYear(), month + 1, 0);
  _date.setHours(23, 59, 59, 999);
  return _date;
}

/**
 * @name isLastDayOfMonth
 * @category Month Helpers
 * @summary Is the given date the last day of a month?
 *
 * @description
 * Is the given date the last day of a month?
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date to check

 * @returns The date is the last day of a month
 *
 * @example
 * // Is 28 February 2014 the last day of a month?
 * const result = isLastDayOfMonth(new Date(2014, 1, 28))
 * //=> true
 */
function isLastDayOfMonth(date) {
  const _date = toDate(date);
  return +endOfDay(_date) === +endOfMonth(_date);
}

/**
 * @name differenceInMonths
 * @category Month Helpers
 * @summary Get the number of full months between the given dates.
 *
 * @description
 * Get the number of full months between the given dates using trunc as a default rounding method.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 *
 * @returns The number of full months
 *
 * @example
 * // How many full months are between 31 January 2014 and 1 September 2014?
 * const result = differenceInMonths(new Date(2014, 8, 1), new Date(2014, 0, 31))
 * //=> 7
 */
function differenceInMonths(dateLeft, dateRight) {
  const _dateLeft = toDate(dateLeft);
  const _dateRight = toDate(dateRight);

  const sign = compareAsc(_dateLeft, _dateRight);
  const difference = Math.abs(
    differenceInCalendarMonths(_dateLeft, _dateRight),
  );
  let result;

  // Check for the difference of less than month
  if (difference < 1) {
    result = 0;
  } else {
    if (_dateLeft.getMonth() === 1 && _dateLeft.getDate() > 27) {
      // This will check if the date is end of Feb and assign a higher end of month date
      // to compare it with Jan
      _dateLeft.setDate(30);
    }

    _dateLeft.setMonth(_dateLeft.getMonth() - sign * difference);

    // Math.abs(diff in full months - diff in calendar months) === 1 if last calendar month is not full
    // If so, result must be decreased by 1 in absolute value
    let isLastMonthNotFull = compareAsc(_dateLeft, _dateRight) === -sign;

    // Check for cases of one full calendar month
    if (
      isLastDayOfMonth(toDate(dateLeft)) &&
      difference === 1 &&
      compareAsc(dateLeft, _dateRight) === 1
    ) {
      isLastMonthNotFull = false;
    }

    result = sign * (difference - Number(isLastMonthNotFull));
  }

  // Prevent negative zero
  return result === 0 ? 0 : result;
}

/**
 * The {@link differenceInSeconds} function options.
 */

/**
 * @name differenceInSeconds
 * @category Second Helpers
 * @summary Get the number of seconds between the given dates.
 *
 * @description
 * Get the number of seconds between the given dates.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The later date
 * @param dateRight - The earlier date
 * @param options - An object with options.
 *
 * @returns The number of seconds
 *
 * @example
 * // How many seconds are between
 * // 2 July 2014 12:30:07.999 and 2 July 2014 12:30:20.000?
 * const result = differenceInSeconds(
 *   new Date(2014, 6, 2, 12, 30, 20, 0),
 *   new Date(2014, 6, 2, 12, 30, 7, 999)
 * )
 * //=> 12
 */
function differenceInSeconds(dateLeft, dateRight, options) {
  const diff = differenceInMilliseconds(dateLeft, dateRight) / 1000;
  return getRoundingMethod(options?.roundingMethod)(diff);
}

/**
 * @name startOfYear
 * @category Year Helpers
 * @summary Return the start of a year for the given date.
 *
 * @description
 * Return the start of a year for the given date.
 * The result will be in the local timezone.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 *
 * @returns The start of a year
 *
 * @example
 * // The start of a year for 2 September 2014 11:55:00:
 * const result = startOfYear(new Date(2014, 8, 2, 11, 55, 00))
 * //=> Wed Jan 01 2014 00:00:00
 */
function startOfYear(date) {
  const cleanDate = toDate(date);
  const _date = constructFrom(date, 0);
  _date.setFullYear(cleanDate.getFullYear(), 0, 1);
  _date.setHours(0, 0, 0, 0);
  return _date;
}

const formatDistanceLocale$1 = {
  lessThanXSeconds: {
    one: "less than a second",
    other: "less than {{count}} seconds",
  },

  xSeconds: {
    one: "1 second",
    other: "{{count}} seconds",
  },

  halfAMinute: "half a minute",

  lessThanXMinutes: {
    one: "less than a minute",
    other: "less than {{count}} minutes",
  },

  xMinutes: {
    one: "1 minute",
    other: "{{count}} minutes",
  },

  aboutXHours: {
    one: "about 1 hour",
    other: "about {{count}} hours",
  },

  xHours: {
    one: "1 hour",
    other: "{{count}} hours",
  },

  xDays: {
    one: "1 day",
    other: "{{count}} days",
  },

  aboutXWeeks: {
    one: "about 1 week",
    other: "about {{count}} weeks",
  },

  xWeeks: {
    one: "1 week",
    other: "{{count}} weeks",
  },

  aboutXMonths: {
    one: "about 1 month",
    other: "about {{count}} months",
  },

  xMonths: {
    one: "1 month",
    other: "{{count}} months",
  },

  aboutXYears: {
    one: "about 1 year",
    other: "about {{count}} years",
  },

  xYears: {
    one: "1 year",
    other: "{{count}} years",
  },

  overXYears: {
    one: "over 1 year",
    other: "over {{count}} years",
  },

  almostXYears: {
    one: "almost 1 year",
    other: "almost {{count}} years",
  },
};

const formatDistance$2 = (token, count, options) => {
  let result;

  const tokenValue = formatDistanceLocale$1[token];
  if (typeof tokenValue === "string") {
    result = tokenValue;
  } else if (count === 1) {
    result = tokenValue.one;
  } else {
    result = tokenValue.other.replace("{{count}}", count.toString());
  }

  if (options?.addSuffix) {
    if (options.comparison && options.comparison > 0) {
      return "in " + result;
    } else {
      return result + " ago";
    }
  }

  return result;
};

function buildFormatLongFn(args) {
  return (options = {}) => {
    // TODO: Remove String()
    const width = options.width ? String(options.width) : args.defaultWidth;
    const format = args.formats[width] || args.formats[args.defaultWidth];
    return format;
  };
}

const dateFormats$1 = {
  full: "EEEE, MMMM do, y",
  long: "MMMM do, y",
  medium: "MMM d, y",
  short: "MM/dd/yyyy",
};

const timeFormats$1 = {
  full: "h:mm:ss a zzzz",
  long: "h:mm:ss a z",
  medium: "h:mm:ss a",
  short: "h:mm a",
};

const dateTimeFormats$1 = {
  full: "{{date}} 'at' {{time}}",
  long: "{{date}} 'at' {{time}}",
  medium: "{{date}}, {{time}}",
  short: "{{date}}, {{time}}",
};

const formatLong$1 = {
  date: buildFormatLongFn({
    formats: dateFormats$1,
    defaultWidth: "full",
  }),

  time: buildFormatLongFn({
    formats: timeFormats$1,
    defaultWidth: "full",
  }),

  dateTime: buildFormatLongFn({
    formats: dateTimeFormats$1,
    defaultWidth: "full",
  }),
};

const formatRelativeLocale$1 = {
  lastWeek: "'last' eeee 'at' p",
  yesterday: "'yesterday at' p",
  today: "'today at' p",
  tomorrow: "'tomorrow at' p",
  nextWeek: "eeee 'at' p",
  other: "P",
};

const formatRelative$1 = (token, _date, _baseDate, _options) =>
  formatRelativeLocale$1[token];

/* eslint-disable no-unused-vars */

/**
 * The localize function argument callback which allows to convert raw value to
 * the actual type.
 *
 * @param value - The value to convert
 *
 * @returns The converted value
 */

/**
 * The map of localized values for each width.
 */

/**
 * The index type of the locale unit value. It types conversion of units of
 * values that don't start at 0 (i.e. quarters).
 */

/**
 * Converts the unit value to the tuple of values.
 */

/**
 * The tuple of localized era values. The first element represents BC,
 * the second element represents AD.
 */

/**
 * The tuple of localized quarter values. The first element represents Q1.
 */

/**
 * The tuple of localized day values. The first element represents Sunday.
 */

/**
 * The tuple of localized month values. The first element represents January.
 */

function buildLocalizeFn(args) {
  return (value, options) => {
    const context = options?.context ? String(options.context) : "standalone";

    let valuesArray;
    if (context === "formatting" && args.formattingValues) {
      const defaultWidth = args.defaultFormattingWidth || args.defaultWidth;
      const width = options?.width ? String(options.width) : defaultWidth;

      valuesArray =
        args.formattingValues[width] || args.formattingValues[defaultWidth];
    } else {
      const defaultWidth = args.defaultWidth;
      const width = options?.width ? String(options.width) : args.defaultWidth;

      valuesArray = args.values[width] || args.values[defaultWidth];
    }
    const index = args.argumentCallback ? args.argumentCallback(value) : value;

    // @ts-expect-error - For some reason TypeScript just don't want to match it, no matter how hard we try. I challenge you to try to remove it!
    return valuesArray[index];
  };
}

const eraValues$1 = {
  narrow: ["B", "A"],
  abbreviated: ["BC", "AD"],
  wide: ["Before Christ", "Anno Domini"],
};

const quarterValues$1 = {
  narrow: ["1", "2", "3", "4"],
  abbreviated: ["Q1", "Q2", "Q3", "Q4"],
  wide: ["1st quarter", "2nd quarter", "3rd quarter", "4th quarter"],
};

// Note: in English, the names of days of the week and months are capitalized.
// If you are making a new locale based on this one, check if the same is true for the language you're working on.
// Generally, formatted dates should look like they are in the middle of a sentence,
// e.g. in Spanish language the weekdays and months should be in the lowercase.
const monthValues$1 = {
  narrow: ["J", "F", "M", "A", "M", "J", "J", "A", "S", "O", "N", "D"],
  abbreviated: [
    "Jan",
    "Feb",
    "Mar",
    "Apr",
    "May",
    "Jun",
    "Jul",
    "Aug",
    "Sep",
    "Oct",
    "Nov",
    "Dec",
  ],

  wide: [
    "January",
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December",
  ],
};

const dayValues$1 = {
  narrow: ["S", "M", "T", "W", "T", "F", "S"],
  short: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"],
  abbreviated: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
  wide: [
    "Sunday",
    "Monday",
    "Tuesday",
    "Wednesday",
    "Thursday",
    "Friday",
    "Saturday",
  ],
};

const dayPeriodValues$1 = {
  narrow: {
    am: "a",
    pm: "p",
    midnight: "mi",
    noon: "n",
    morning: "morning",
    afternoon: "afternoon",
    evening: "evening",
    night: "night",
  },
  abbreviated: {
    am: "AM",
    pm: "PM",
    midnight: "midnight",
    noon: "noon",
    morning: "morning",
    afternoon: "afternoon",
    evening: "evening",
    night: "night",
  },
  wide: {
    am: "a.m.",
    pm: "p.m.",
    midnight: "midnight",
    noon: "noon",
    morning: "morning",
    afternoon: "afternoon",
    evening: "evening",
    night: "night",
  },
};

const formattingDayPeriodValues$1 = {
  narrow: {
    am: "a",
    pm: "p",
    midnight: "mi",
    noon: "n",
    morning: "in the morning",
    afternoon: "in the afternoon",
    evening: "in the evening",
    night: "at night",
  },
  abbreviated: {
    am: "AM",
    pm: "PM",
    midnight: "midnight",
    noon: "noon",
    morning: "in the morning",
    afternoon: "in the afternoon",
    evening: "in the evening",
    night: "at night",
  },
  wide: {
    am: "a.m.",
    pm: "p.m.",
    midnight: "midnight",
    noon: "noon",
    morning: "in the morning",
    afternoon: "in the afternoon",
    evening: "in the evening",
    night: "at night",
  },
};

const ordinalNumber$1 = (dirtyNumber, _options) => {
  const number = Number(dirtyNumber);

  // If ordinal numbers depend on context, for example,
  // if they are different for different grammatical genders,
  // use `options.unit`.
  //
  // `unit` can be 'year', 'quarter', 'month', 'week', 'date', 'dayOfYear',
  // 'day', 'hour', 'minute', 'second'.

  const rem100 = number % 100;
  if (rem100 > 20 || rem100 < 10) {
    switch (rem100 % 10) {
      case 1:
        return number + "st";
      case 2:
        return number + "nd";
      case 3:
        return number + "rd";
    }
  }
  return number + "th";
};

const localize$1 = {
  ordinalNumber: ordinalNumber$1,

  era: buildLocalizeFn({
    values: eraValues$1,
    defaultWidth: "wide",
  }),

  quarter: buildLocalizeFn({
    values: quarterValues$1,
    defaultWidth: "wide",
    argumentCallback: (quarter) => quarter - 1,
  }),

  month: buildLocalizeFn({
    values: monthValues$1,
    defaultWidth: "wide",
  }),

  day: buildLocalizeFn({
    values: dayValues$1,
    defaultWidth: "wide",
  }),

  dayPeriod: buildLocalizeFn({
    values: dayPeriodValues$1,
    defaultWidth: "wide",
    formattingValues: formattingDayPeriodValues$1,
    defaultFormattingWidth: "wide",
  }),
};

function buildMatchFn(args) {
  return (string, options = {}) => {
    const width = options.width;

    const matchPattern =
      (width && args.matchPatterns[width]) ||
      args.matchPatterns[args.defaultMatchWidth];
    const matchResult = string.match(matchPattern);

    if (!matchResult) {
      return null;
    }
    const matchedString = matchResult[0];

    const parsePatterns =
      (width && args.parsePatterns[width]) ||
      args.parsePatterns[args.defaultParseWidth];

    const key = Array.isArray(parsePatterns)
      ? findIndex(parsePatterns, (pattern) => pattern.test(matchedString))
      : // eslint-disable-next-line @typescript-eslint/no-explicit-any -- I challange you to fix the type
        findKey(parsePatterns, (pattern) => pattern.test(matchedString));

    let value;

    value = args.valueCallback ? args.valueCallback(key) : key;
    value = options.valueCallback
      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any -- I challange you to fix the type
        options.valueCallback(value)
      : value;

    const rest = string.slice(matchedString.length);

    return { value, rest };
  };
}

function findKey(object, predicate) {
  for (const key in object) {
    if (
      Object.prototype.hasOwnProperty.call(object, key) &&
      predicate(object[key])
    ) {
      return key;
    }
  }
  return undefined;
}

function findIndex(array, predicate) {
  for (let key = 0; key < array.length; key++) {
    if (predicate(array[key])) {
      return key;
    }
  }
  return undefined;
}

function buildMatchPatternFn(args) {
  return (string, options = {}) => {
    const matchResult = string.match(args.matchPattern);
    if (!matchResult) return null;
    const matchedString = matchResult[0];

    const parseResult = string.match(args.parsePattern);
    if (!parseResult) return null;
    let value = args.valueCallback
      ? args.valueCallback(parseResult[0])
      : parseResult[0];

    // eslint-disable-next-line @typescript-eslint/no-explicit-any -- I challange you to fix the type
    value = options.valueCallback ? options.valueCallback(value) : value;

    const rest = string.slice(matchedString.length);

    return { value, rest };
  };
}

const matchOrdinalNumberPattern$1 = /^(\d+)(th|st|nd|rd)?/i;
const parseOrdinalNumberPattern$1 = /\d+/i;

const matchEraPatterns$1 = {
  narrow: /^(b|a)/i,
  abbreviated: /^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,
  wide: /^(before christ|before common era|anno domini|common era)/i,
};
const parseEraPatterns$1 = {
  any: [/^b/i, /^(a|c)/i],
};

const matchQuarterPatterns$1 = {
  narrow: /^[1234]/i,
  abbreviated: /^q[1234]/i,
  wide: /^[1234](th|st|nd|rd)? quarter/i,
};
const parseQuarterPatterns$1 = {
  any: [/1/i, /2/i, /3/i, /4/i],
};

const matchMonthPatterns$1 = {
  narrow: /^[jfmasond]/i,
  abbreviated: /^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,
  wide: /^(january|february|march|april|may|june|july|august|september|october|november|december)/i,
};
const parseMonthPatterns$1 = {
  narrow: [
    /^j/i,
    /^f/i,
    /^m/i,
    /^a/i,
    /^m/i,
    /^j/i,
    /^j/i,
    /^a/i,
    /^s/i,
    /^o/i,
    /^n/i,
    /^d/i,
  ],

  any: [
    /^ja/i,
    /^f/i,
    /^mar/i,
    /^ap/i,
    /^may/i,
    /^jun/i,
    /^jul/i,
    /^au/i,
    /^s/i,
    /^o/i,
    /^n/i,
    /^d/i,
  ],
};

const matchDayPatterns$1 = {
  narrow: /^[smtwf]/i,
  short: /^(su|mo|tu|we|th|fr|sa)/i,
  abbreviated: /^(sun|mon|tue|wed|thu|fri|sat)/i,
  wide: /^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i,
};
const parseDayPatterns$1 = {
  narrow: [/^s/i, /^m/i, /^t/i, /^w/i, /^t/i, /^f/i, /^s/i],
  any: [/^su/i, /^m/i, /^tu/i, /^w/i, /^th/i, /^f/i, /^sa/i],
};

const matchDayPeriodPatterns$1 = {
  narrow: /^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,
  any: /^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i,
};
const parseDayPeriodPatterns$1 = {
  any: {
    am: /^a/i,
    pm: /^p/i,
    midnight: /^mi/i,
    noon: /^no/i,
    morning: /morning/i,
    afternoon: /afternoon/i,
    evening: /evening/i,
    night: /night/i,
  },
};

const match$1 = {
  ordinalNumber: buildMatchPatternFn({
    matchPattern: matchOrdinalNumberPattern$1,
    parsePattern: parseOrdinalNumberPattern$1,
    valueCallback: (value) => parseInt(value, 10),
  }),

  era: buildMatchFn({
    matchPatterns: matchEraPatterns$1,
    defaultMatchWidth: "wide",
    parsePatterns: parseEraPatterns$1,
    defaultParseWidth: "any",
  }),

  quarter: buildMatchFn({
    matchPatterns: matchQuarterPatterns$1,
    defaultMatchWidth: "wide",
    parsePatterns: parseQuarterPatterns$1,
    defaultParseWidth: "any",
    valueCallback: (index) => index + 1,
  }),

  month: buildMatchFn({
    matchPatterns: matchMonthPatterns$1,
    defaultMatchWidth: "wide",
    parsePatterns: parseMonthPatterns$1,
    defaultParseWidth: "any",
  }),

  day: buildMatchFn({
    matchPatterns: matchDayPatterns$1,
    defaultMatchWidth: "wide",
    parsePatterns: parseDayPatterns$1,
    defaultParseWidth: "any",
  }),

  dayPeriod: buildMatchFn({
    matchPatterns: matchDayPeriodPatterns$1,
    defaultMatchWidth: "any",
    parsePatterns: parseDayPeriodPatterns$1,
    defaultParseWidth: "any",
  }),
};

/**
 * @category Locales
 * @summary English locale (United States).
 * @language English
 * @iso-639-2 eng
 * @author Sasha Koss [@kossnocorp](https://github.com/kossnocorp)
 * @author Lesha Koss [@leshakoss](https://github.com/leshakoss)
 */
const enUS = {
  code: "en-US",
  formatDistance: formatDistance$2,
  formatLong: formatLong$1,
  formatRelative: formatRelative$1,
  localize: localize$1,
  match: match$1,
  options: {
    weekStartsOn: 0 /* Sunday */,
    firstWeekContainsDate: 1,
  },
};

/**
 * @name getDayOfYear
 * @category Day Helpers
 * @summary Get the day of the year of the given date.
 *
 * @description
 * Get the day of the year of the given date.
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 *
 * @returns The day of year
 *
 * @example
 * // Which day of the year is 2 July 2014?
 * const result = getDayOfYear(new Date(2014, 6, 2))
 * //=> 183
 */
function getDayOfYear(date) {
  const _date = toDate(date);
  const diff = differenceInCalendarDays(_date, startOfYear(_date));
  const dayOfYear = diff + 1;
  return dayOfYear;
}

/**
 * @name getISOWeek
 * @category ISO Week Helpers
 * @summary Get the ISO week of the given date.
 *
 * @description
 * Get the ISO week of the given date.
 *
 * ISO week-numbering year: http://en.wikipedia.org/wiki/ISO_week_date
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 *
 * @returns The ISO week
 *
 * @example
 * // Which week of the ISO-week numbering year is 2 January 2005?
 * const result = getISOWeek(new Date(2005, 0, 2))
 * //=> 53
 */
function getISOWeek(date) {
  const _date = toDate(date);
  const diff = +startOfISOWeek(_date) - +startOfISOWeekYear(_date);

  // Round the number of weeks to the nearest integer because the number of
  // milliseconds in a week is not constant (e.g. it's different in the week of
  // the daylight saving time clock shift).
  return Math.round(diff / millisecondsInWeek) + 1;
}

/**
 * The {@link getWeekYear} function options.
 */

/**
 * @name getWeekYear
 * @category Week-Numbering Year Helpers
 * @summary Get the local week-numbering year of the given date.
 *
 * @description
 * Get the local week-numbering year of the given date.
 * The exact calculation depends on the values of
 * `options.weekStartsOn` (which is the index of the first day of the week)
 * and `options.firstWeekContainsDate` (which is the day of January, which is always in
 * the first week of the week-numbering year)
 *
 * Week numbering: https://en.wikipedia.org/wiki/Week#The_ISO_week_date_system
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 * @param options - An object with options.
 *
 * @returns The local week-numbering year
 *
 * @example
 * // Which week numbering year is 26 December 2004 with the default settings?
 * const result = getWeekYear(new Date(2004, 11, 26))
 * //=> 2005
 *
 * @example
 * // Which week numbering year is 26 December 2004 if week starts on Saturday?
 * const result = getWeekYear(new Date(2004, 11, 26), { weekStartsOn: 6 })
 * //=> 2004
 *
 * @example
 * // Which week numbering year is 26 December 2004 if the first week contains 4 January?
 * const result = getWeekYear(new Date(2004, 11, 26), { firstWeekContainsDate: 4 })
 * //=> 2004
 */
function getWeekYear(date, options) {
  const _date = toDate(date);
  const year = _date.getFullYear();

  const defaultOptions = getDefaultOptions();
  const firstWeekContainsDate =
    options?.firstWeekContainsDate ??
    options?.locale?.options?.firstWeekContainsDate ??
    defaultOptions.firstWeekContainsDate ??
    defaultOptions.locale?.options?.firstWeekContainsDate ??
    1;

  const firstWeekOfNextYear = constructFrom(date, 0);
  firstWeekOfNextYear.setFullYear(year + 1, 0, firstWeekContainsDate);
  firstWeekOfNextYear.setHours(0, 0, 0, 0);
  const startOfNextYear = startOfWeek(firstWeekOfNextYear, options);

  const firstWeekOfThisYear = constructFrom(date, 0);
  firstWeekOfThisYear.setFullYear(year, 0, firstWeekContainsDate);
  firstWeekOfThisYear.setHours(0, 0, 0, 0);
  const startOfThisYear = startOfWeek(firstWeekOfThisYear, options);

  if (_date.getTime() >= startOfNextYear.getTime()) {
    return year + 1;
  } else if (_date.getTime() >= startOfThisYear.getTime()) {
    return year;
  } else {
    return year - 1;
  }
}

/**
 * The {@link startOfWeekYear} function options.
 */

/**
 * @name startOfWeekYear
 * @category Week-Numbering Year Helpers
 * @summary Return the start of a local week-numbering year for the given date.
 *
 * @description
 * Return the start of a local week-numbering year.
 * The exact calculation depends on the values of
 * `options.weekStartsOn` (which is the index of the first day of the week)
 * and `options.firstWeekContainsDate` (which is the day of January, which is always in
 * the first week of the week-numbering year)
 *
 * Week numbering: https://en.wikipedia.org/wiki/Week#The_ISO_week_date_system
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 * @param options - An object with options
 *
 * @returns The start of a week-numbering year
 *
 * @example
 * // The start of an a week-numbering year for 2 July 2005 with default settings:
 * const result = startOfWeekYear(new Date(2005, 6, 2))
 * //=> Sun Dec 26 2004 00:00:00
 *
 * @example
 * // The start of a week-numbering year for 2 July 2005
 * // if Monday is the first day of week
 * // and 4 January is always in the first week of the year:
 * const result = startOfWeekYear(new Date(2005, 6, 2), {
 *   weekStartsOn: 1,
 *   firstWeekContainsDate: 4
 * })
 * //=> Mon Jan 03 2005 00:00:00
 */
function startOfWeekYear(date, options) {
  const defaultOptions = getDefaultOptions();
  const firstWeekContainsDate =
    options?.firstWeekContainsDate ??
    options?.locale?.options?.firstWeekContainsDate ??
    defaultOptions.firstWeekContainsDate ??
    defaultOptions.locale?.options?.firstWeekContainsDate ??
    1;

  const year = getWeekYear(date, options);
  const firstWeek = constructFrom(date, 0);
  firstWeek.setFullYear(year, 0, firstWeekContainsDate);
  firstWeek.setHours(0, 0, 0, 0);
  const _date = startOfWeek(firstWeek, options);
  return _date;
}

/**
 * The {@link getWeek} function options.
 */

/**
 * @name getWeek
 * @category Week Helpers
 * @summary Get the local week index of the given date.
 *
 * @description
 * Get the local week index of the given date.
 * The exact calculation depends on the values of
 * `options.weekStartsOn` (which is the index of the first day of the week)
 * and `options.firstWeekContainsDate` (which is the day of January, which is always in
 * the first week of the week-numbering year)
 *
 * Week numbering: https://en.wikipedia.org/wiki/Week#The_ISO_week_date_system
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 * @param options - An object with options
 *
 * @returns The week
 *
 * @example
 * // Which week of the local week numbering year is 2 January 2005 with default options?
 * const result = getWeek(new Date(2005, 0, 2))
 * //=> 2
 *
 * @example
 * // Which week of the local week numbering year is 2 January 2005,
 * // if Monday is the first day of the week,
 * // and the first week of the year always contains 4 January?
 * const result = getWeek(new Date(2005, 0, 2), {
 *   weekStartsOn: 1,
 *   firstWeekContainsDate: 4
 * })
 * //=> 53
 */

function getWeek(date, options) {
  const _date = toDate(date);
  const diff = +startOfWeek(_date, options) - +startOfWeekYear(_date, options);

  // Round the number of weeks to the nearest integer because the number of
  // milliseconds in a week is not constant (e.g. it's different in the week of
  // the daylight saving time clock shift).
  return Math.round(diff / millisecondsInWeek) + 1;
}

function addLeadingZeros(number, targetLength) {
  const sign = number < 0 ? "-" : "";
  const output = Math.abs(number).toString().padStart(targetLength, "0");
  return sign + output;
}

/*
 * |     | Unit                           |     | Unit                           |
 * |-----|--------------------------------|-----|--------------------------------|
 * |  a  | AM, PM                         |  A* |                                |
 * |  d  | Day of month                   |  D  |                                |
 * |  h  | Hour [1-12]                    |  H  | Hour [0-23]                    |
 * |  m  | Minute                         |  M  | Month                          |
 * |  s  | Second                         |  S  | Fraction of second             |
 * |  y  | Year (abs)                     |  Y  |                                |
 *
 * Letters marked by * are not implemented but reserved by Unicode standard.
 */

const lightFormatters = {
  // Year
  y(date, token) {
    // From http://www.unicode.org/reports/tr35/tr35-31/tr35-dates.html#Date_Format_tokens
    // | Year     |     y | yy |   yyy |  yyyy | yyyyy |
    // |----------|-------|----|-------|-------|-------|
    // | AD 1     |     1 | 01 |   001 |  0001 | 00001 |
    // | AD 12    |    12 | 12 |   012 |  0012 | 00012 |
    // | AD 123   |   123 | 23 |   123 |  0123 | 00123 |
    // | AD 1234  |  1234 | 34 |  1234 |  1234 | 01234 |
    // | AD 12345 | 12345 | 45 | 12345 | 12345 | 12345 |

    const signedYear = date.getFullYear();
    // Returns 1 for 1 BC (which is year 0 in JavaScript)
    const year = signedYear > 0 ? signedYear : 1 - signedYear;
    return addLeadingZeros(token === "yy" ? year % 100 : year, token.length);
  },

  // Month
  M(date, token) {
    const month = date.getMonth();
    return token === "M" ? String(month + 1) : addLeadingZeros(month + 1, 2);
  },

  // Day of the month
  d(date, token) {
    return addLeadingZeros(date.getDate(), token.length);
  },

  // AM or PM
  a(date, token) {
    const dayPeriodEnumValue = date.getHours() / 12 >= 1 ? "pm" : "am";

    switch (token) {
      case "a":
      case "aa":
        return dayPeriodEnumValue.toUpperCase();
      case "aaa":
        return dayPeriodEnumValue;
      case "aaaaa":
        return dayPeriodEnumValue[0];
      case "aaaa":
      default:
        return dayPeriodEnumValue === "am" ? "a.m." : "p.m.";
    }
  },

  // Hour [1-12]
  h(date, token) {
    return addLeadingZeros(date.getHours() % 12 || 12, token.length);
  },

  // Hour [0-23]
  H(date, token) {
    return addLeadingZeros(date.getHours(), token.length);
  },

  // Minute
  m(date, token) {
    return addLeadingZeros(date.getMinutes(), token.length);
  },

  // Second
  s(date, token) {
    return addLeadingZeros(date.getSeconds(), token.length);
  },

  // Fraction of second
  S(date, token) {
    const numberOfDigits = token.length;
    const milliseconds = date.getMilliseconds();
    const fractionalSeconds = Math.trunc(
      milliseconds * Math.pow(10, numberOfDigits - 3),
    );
    return addLeadingZeros(fractionalSeconds, token.length);
  },
};

const dayPeriodEnum = {
  midnight: "midnight",
  noon: "noon",
  morning: "morning",
  afternoon: "afternoon",
  evening: "evening",
  night: "night",
};

/*
 * |     | Unit                           |     | Unit                           |
 * |-----|--------------------------------|-----|--------------------------------|
 * |  a  | AM, PM                         |  A* | Milliseconds in day            |
 * |  b  | AM, PM, noon, midnight         |  B  | Flexible day period            |
 * |  c  | Stand-alone local day of week  |  C* | Localized hour w/ day period   |
 * |  d  | Day of month                   |  D  | Day of year                    |
 * |  e  | Local day of week              |  E  | Day of week                    |
 * |  f  |                                |  F* | Day of week in month           |
 * |  g* | Modified Julian day            |  G  | Era                            |
 * |  h  | Hour [1-12]                    |  H  | Hour [0-23]                    |
 * |  i! | ISO day of week                |  I! | ISO week of year               |
 * |  j* | Localized hour w/ day period   |  J* | Localized hour w/o day period  |
 * |  k  | Hour [1-24]                    |  K  | Hour [0-11]                    |
 * |  l* | (deprecated)                   |  L  | Stand-alone month              |
 * |  m  | Minute                         |  M  | Month                          |
 * |  n  |                                |  N  |                                |
 * |  o! | Ordinal number modifier        |  O  | Timezone (GMT)                 |
 * |  p! | Long localized time            |  P! | Long localized date            |
 * |  q  | Stand-alone quarter            |  Q  | Quarter                        |
 * |  r* | Related Gregorian year         |  R! | ISO week-numbering year        |
 * |  s  | Second                         |  S  | Fraction of second             |
 * |  t! | Seconds timestamp              |  T! | Milliseconds timestamp         |
 * |  u  | Extended year                  |  U* | Cyclic year                    |
 * |  v* | Timezone (generic non-locat.)  |  V* | Timezone (location)            |
 * |  w  | Local week of year             |  W* | Week of month                  |
 * |  x  | Timezone (ISO-8601 w/o Z)      |  X  | Timezone (ISO-8601)            |
 * |  y  | Year (abs)                     |  Y  | Local week-numbering year      |
 * |  z  | Timezone (specific non-locat.) |  Z* | Timezone (aliases)             |
 *
 * Letters marked by * are not implemented but reserved by Unicode standard.
 *
 * Letters marked by ! are non-standard, but implemented by date-fns:
 * - `o` modifies the previous token to turn it into an ordinal (see `format` docs)
 * - `i` is ISO day of week. For `i` and `ii` is returns numeric ISO week days,
 *   i.e. 7 for Sunday, 1 for Monday, etc.
 * - `I` is ISO week of year, as opposed to `w` which is local week of year.
 * - `R` is ISO week-numbering year, as opposed to `Y` which is local week-numbering year.
 *   `R` is supposed to be used in conjunction with `I` and `i`
 *   for universal ISO week-numbering date, whereas
 *   `Y` is supposed to be used in conjunction with `w` and `e`
 *   for week-numbering date specific to the locale.
 * - `P` is long localized date format
 * - `p` is long localized time format
 */

const formatters = {
  // Era
  G: function (date, token, localize) {
    const era = date.getFullYear() > 0 ? 1 : 0;
    switch (token) {
      // AD, BC
      case "G":
      case "GG":
      case "GGG":
        return localize.era(era, { width: "abbreviated" });
      // A, B
      case "GGGGG":
        return localize.era(era, { width: "narrow" });
      // Anno Domini, Before Christ
      case "GGGG":
      default:
        return localize.era(era, { width: "wide" });
    }
  },

  // Year
  y: function (date, token, localize) {
    // Ordinal number
    if (token === "yo") {
      const signedYear = date.getFullYear();
      // Returns 1 for 1 BC (which is year 0 in JavaScript)
      const year = signedYear > 0 ? signedYear : 1 - signedYear;
      return localize.ordinalNumber(year, { unit: "year" });
    }

    return lightFormatters.y(date, token);
  },

  // Local week-numbering year
  Y: function (date, token, localize, options) {
    const signedWeekYear = getWeekYear(date, options);
    // Returns 1 for 1 BC (which is year 0 in JavaScript)
    const weekYear = signedWeekYear > 0 ? signedWeekYear : 1 - signedWeekYear;

    // Two digit year
    if (token === "YY") {
      const twoDigitYear = weekYear % 100;
      return addLeadingZeros(twoDigitYear, 2);
    }

    // Ordinal number
    if (token === "Yo") {
      return localize.ordinalNumber(weekYear, { unit: "year" });
    }

    // Padding
    return addLeadingZeros(weekYear, token.length);
  },

  // ISO week-numbering year
  R: function (date, token) {
    const isoWeekYear = getISOWeekYear(date);

    // Padding
    return addLeadingZeros(isoWeekYear, token.length);
  },

  // Extended year. This is a single number designating the year of this calendar system.
  // The main difference between `y` and `u` localizers are B.C. years:
  // | Year | `y` | `u` |
  // |------|-----|-----|
  // | AC 1 |   1 |   1 |
  // | BC 1 |   1 |   0 |
  // | BC 2 |   2 |  -1 |
  // Also `yy` always returns the last two digits of a year,
  // while `uu` pads single digit years to 2 characters and returns other years unchanged.
  u: function (date, token) {
    const year = date.getFullYear();
    return addLeadingZeros(year, token.length);
  },

  // Quarter
  Q: function (date, token, localize) {
    const quarter = Math.ceil((date.getMonth() + 1) / 3);
    switch (token) {
      // 1, 2, 3, 4
      case "Q":
        return String(quarter);
      // 01, 02, 03, 04
      case "QQ":
        return addLeadingZeros(quarter, 2);
      // 1st, 2nd, 3rd, 4th
      case "Qo":
        return localize.ordinalNumber(quarter, { unit: "quarter" });
      // Q1, Q2, Q3, Q4
      case "QQQ":
        return localize.quarter(quarter, {
          width: "abbreviated",
          context: "formatting",
        });
      // 1, 2, 3, 4 (narrow quarter; could be not numerical)
      case "QQQQQ":
        return localize.quarter(quarter, {
          width: "narrow",
          context: "formatting",
        });
      // 1st quarter, 2nd quarter, ...
      case "QQQQ":
      default:
        return localize.quarter(quarter, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // Stand-alone quarter
  q: function (date, token, localize) {
    const quarter = Math.ceil((date.getMonth() + 1) / 3);
    switch (token) {
      // 1, 2, 3, 4
      case "q":
        return String(quarter);
      // 01, 02, 03, 04
      case "qq":
        return addLeadingZeros(quarter, 2);
      // 1st, 2nd, 3rd, 4th
      case "qo":
        return localize.ordinalNumber(quarter, { unit: "quarter" });
      // Q1, Q2, Q3, Q4
      case "qqq":
        return localize.quarter(quarter, {
          width: "abbreviated",
          context: "standalone",
        });
      // 1, 2, 3, 4 (narrow quarter; could be not numerical)
      case "qqqqq":
        return localize.quarter(quarter, {
          width: "narrow",
          context: "standalone",
        });
      // 1st quarter, 2nd quarter, ...
      case "qqqq":
      default:
        return localize.quarter(quarter, {
          width: "wide",
          context: "standalone",
        });
    }
  },

  // Month
  M: function (date, token, localize) {
    const month = date.getMonth();
    switch (token) {
      case "M":
      case "MM":
        return lightFormatters.M(date, token);
      // 1st, 2nd, ..., 12th
      case "Mo":
        return localize.ordinalNumber(month + 1, { unit: "month" });
      // Jan, Feb, ..., Dec
      case "MMM":
        return localize.month(month, {
          width: "abbreviated",
          context: "formatting",
        });
      // J, F, ..., D
      case "MMMMM":
        return localize.month(month, {
          width: "narrow",
          context: "formatting",
        });
      // January, February, ..., December
      case "MMMM":
      default:
        return localize.month(month, { width: "wide", context: "formatting" });
    }
  },

  // Stand-alone month
  L: function (date, token, localize) {
    const month = date.getMonth();
    switch (token) {
      // 1, 2, ..., 12
      case "L":
        return String(month + 1);
      // 01, 02, ..., 12
      case "LL":
        return addLeadingZeros(month + 1, 2);
      // 1st, 2nd, ..., 12th
      case "Lo":
        return localize.ordinalNumber(month + 1, { unit: "month" });
      // Jan, Feb, ..., Dec
      case "LLL":
        return localize.month(month, {
          width: "abbreviated",
          context: "standalone",
        });
      // J, F, ..., D
      case "LLLLL":
        return localize.month(month, {
          width: "narrow",
          context: "standalone",
        });
      // January, February, ..., December
      case "LLLL":
      default:
        return localize.month(month, { width: "wide", context: "standalone" });
    }
  },

  // Local week of year
  w: function (date, token, localize, options) {
    const week = getWeek(date, options);

    if (token === "wo") {
      return localize.ordinalNumber(week, { unit: "week" });
    }

    return addLeadingZeros(week, token.length);
  },

  // ISO week of year
  I: function (date, token, localize) {
    const isoWeek = getISOWeek(date);

    if (token === "Io") {
      return localize.ordinalNumber(isoWeek, { unit: "week" });
    }

    return addLeadingZeros(isoWeek, token.length);
  },

  // Day of the month
  d: function (date, token, localize) {
    if (token === "do") {
      return localize.ordinalNumber(date.getDate(), { unit: "date" });
    }

    return lightFormatters.d(date, token);
  },

  // Day of year
  D: function (date, token, localize) {
    const dayOfYear = getDayOfYear(date);

    if (token === "Do") {
      return localize.ordinalNumber(dayOfYear, { unit: "dayOfYear" });
    }

    return addLeadingZeros(dayOfYear, token.length);
  },

  // Day of week
  E: function (date, token, localize) {
    const dayOfWeek = date.getDay();
    switch (token) {
      // Tue
      case "E":
      case "EE":
      case "EEE":
        return localize.day(dayOfWeek, {
          width: "abbreviated",
          context: "formatting",
        });
      // T
      case "EEEEE":
        return localize.day(dayOfWeek, {
          width: "narrow",
          context: "formatting",
        });
      // Tu
      case "EEEEEE":
        return localize.day(dayOfWeek, {
          width: "short",
          context: "formatting",
        });
      // Tuesday
      case "EEEE":
      default:
        return localize.day(dayOfWeek, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // Local day of week
  e: function (date, token, localize, options) {
    const dayOfWeek = date.getDay();
    const localDayOfWeek = (dayOfWeek - options.weekStartsOn + 8) % 7 || 7;
    switch (token) {
      // Numerical value (Nth day of week with current locale or weekStartsOn)
      case "e":
        return String(localDayOfWeek);
      // Padded numerical value
      case "ee":
        return addLeadingZeros(localDayOfWeek, 2);
      // 1st, 2nd, ..., 7th
      case "eo":
        return localize.ordinalNumber(localDayOfWeek, { unit: "day" });
      case "eee":
        return localize.day(dayOfWeek, {
          width: "abbreviated",
          context: "formatting",
        });
      // T
      case "eeeee":
        return localize.day(dayOfWeek, {
          width: "narrow",
          context: "formatting",
        });
      // Tu
      case "eeeeee":
        return localize.day(dayOfWeek, {
          width: "short",
          context: "formatting",
        });
      // Tuesday
      case "eeee":
      default:
        return localize.day(dayOfWeek, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // Stand-alone local day of week
  c: function (date, token, localize, options) {
    const dayOfWeek = date.getDay();
    const localDayOfWeek = (dayOfWeek - options.weekStartsOn + 8) % 7 || 7;
    switch (token) {
      // Numerical value (same as in `e`)
      case "c":
        return String(localDayOfWeek);
      // Padded numerical value
      case "cc":
        return addLeadingZeros(localDayOfWeek, token.length);
      // 1st, 2nd, ..., 7th
      case "co":
        return localize.ordinalNumber(localDayOfWeek, { unit: "day" });
      case "ccc":
        return localize.day(dayOfWeek, {
          width: "abbreviated",
          context: "standalone",
        });
      // T
      case "ccccc":
        return localize.day(dayOfWeek, {
          width: "narrow",
          context: "standalone",
        });
      // Tu
      case "cccccc":
        return localize.day(dayOfWeek, {
          width: "short",
          context: "standalone",
        });
      // Tuesday
      case "cccc":
      default:
        return localize.day(dayOfWeek, {
          width: "wide",
          context: "standalone",
        });
    }
  },

  // ISO day of week
  i: function (date, token, localize) {
    const dayOfWeek = date.getDay();
    const isoDayOfWeek = dayOfWeek === 0 ? 7 : dayOfWeek;
    switch (token) {
      // 2
      case "i":
        return String(isoDayOfWeek);
      // 02
      case "ii":
        return addLeadingZeros(isoDayOfWeek, token.length);
      // 2nd
      case "io":
        return localize.ordinalNumber(isoDayOfWeek, { unit: "day" });
      // Tue
      case "iii":
        return localize.day(dayOfWeek, {
          width: "abbreviated",
          context: "formatting",
        });
      // T
      case "iiiii":
        return localize.day(dayOfWeek, {
          width: "narrow",
          context: "formatting",
        });
      // Tu
      case "iiiiii":
        return localize.day(dayOfWeek, {
          width: "short",
          context: "formatting",
        });
      // Tuesday
      case "iiii":
      default:
        return localize.day(dayOfWeek, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // AM or PM
  a: function (date, token, localize) {
    const hours = date.getHours();
    const dayPeriodEnumValue = hours / 12 >= 1 ? "pm" : "am";

    switch (token) {
      case "a":
      case "aa":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "abbreviated",
          context: "formatting",
        });
      case "aaa":
        return localize
          .dayPeriod(dayPeriodEnumValue, {
            width: "abbreviated",
            context: "formatting",
          })
          .toLowerCase();
      case "aaaaa":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "narrow",
          context: "formatting",
        });
      case "aaaa":
      default:
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // AM, PM, midnight, noon
  b: function (date, token, localize) {
    const hours = date.getHours();
    let dayPeriodEnumValue;
    if (hours === 12) {
      dayPeriodEnumValue = dayPeriodEnum.noon;
    } else if (hours === 0) {
      dayPeriodEnumValue = dayPeriodEnum.midnight;
    } else {
      dayPeriodEnumValue = hours / 12 >= 1 ? "pm" : "am";
    }

    switch (token) {
      case "b":
      case "bb":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "abbreviated",
          context: "formatting",
        });
      case "bbb":
        return localize
          .dayPeriod(dayPeriodEnumValue, {
            width: "abbreviated",
            context: "formatting",
          })
          .toLowerCase();
      case "bbbbb":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "narrow",
          context: "formatting",
        });
      case "bbbb":
      default:
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // in the morning, in the afternoon, in the evening, at night
  B: function (date, token, localize) {
    const hours = date.getHours();
    let dayPeriodEnumValue;
    if (hours >= 17) {
      dayPeriodEnumValue = dayPeriodEnum.evening;
    } else if (hours >= 12) {
      dayPeriodEnumValue = dayPeriodEnum.afternoon;
    } else if (hours >= 4) {
      dayPeriodEnumValue = dayPeriodEnum.morning;
    } else {
      dayPeriodEnumValue = dayPeriodEnum.night;
    }

    switch (token) {
      case "B":
      case "BB":
      case "BBB":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "abbreviated",
          context: "formatting",
        });
      case "BBBBB":
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "narrow",
          context: "formatting",
        });
      case "BBBB":
      default:
        return localize.dayPeriod(dayPeriodEnumValue, {
          width: "wide",
          context: "formatting",
        });
    }
  },

  // Hour [1-12]
  h: function (date, token, localize) {
    if (token === "ho") {
      let hours = date.getHours() % 12;
      if (hours === 0) hours = 12;
      return localize.ordinalNumber(hours, { unit: "hour" });
    }

    return lightFormatters.h(date, token);
  },

  // Hour [0-23]
  H: function (date, token, localize) {
    if (token === "Ho") {
      return localize.ordinalNumber(date.getHours(), { unit: "hour" });
    }

    return lightFormatters.H(date, token);
  },

  // Hour [0-11]
  K: function (date, token, localize) {
    const hours = date.getHours() % 12;

    if (token === "Ko") {
      return localize.ordinalNumber(hours, { unit: "hour" });
    }

    return addLeadingZeros(hours, token.length);
  },

  // Hour [1-24]
  k: function (date, token, localize) {
    let hours = date.getHours();
    if (hours === 0) hours = 24;

    if (token === "ko") {
      return localize.ordinalNumber(hours, { unit: "hour" });
    }

    return addLeadingZeros(hours, token.length);
  },

  // Minute
  m: function (date, token, localize) {
    if (token === "mo") {
      return localize.ordinalNumber(date.getMinutes(), { unit: "minute" });
    }

    return lightFormatters.m(date, token);
  },

  // Second
  s: function (date, token, localize) {
    if (token === "so") {
      return localize.ordinalNumber(date.getSeconds(), { unit: "second" });
    }

    return lightFormatters.s(date, token);
  },

  // Fraction of second
  S: function (date, token) {
    return lightFormatters.S(date, token);
  },

  // Timezone (ISO-8601. If offset is 0, output is always `'Z'`)
  X: function (date, token, _localize) {
    const timezoneOffset = date.getTimezoneOffset();

    if (timezoneOffset === 0) {
      return "Z";
    }

    switch (token) {
      // Hours and optional minutes
      case "X":
        return formatTimezoneWithOptionalMinutes(timezoneOffset);

      // Hours, minutes and optional seconds without `:` delimiter
      // Note: neither ISO-8601 nor JavaScript supports seconds in timezone offsets
      // so this token always has the same output as `XX`
      case "XXXX":
      case "XX": // Hours and minutes without `:` delimiter
        return formatTimezone(timezoneOffset);

      // Hours, minutes and optional seconds with `:` delimiter
      // Note: neither ISO-8601 nor JavaScript supports seconds in timezone offsets
      // so this token always has the same output as `XXX`
      case "XXXXX":
      case "XXX": // Hours and minutes with `:` delimiter
      default:
        return formatTimezone(timezoneOffset, ":");
    }
  },

  // Timezone (ISO-8601. If offset is 0, output is `'+00:00'` or equivalent)
  x: function (date, token, _localize) {
    const timezoneOffset = date.getTimezoneOffset();

    switch (token) {
      // Hours and optional minutes
      case "x":
        return formatTimezoneWithOptionalMinutes(timezoneOffset);

      // Hours, minutes and optional seconds without `:` delimiter
      // Note: neither ISO-8601 nor JavaScript supports seconds in timezone offsets
      // so this token always has the same output as `xx`
      case "xxxx":
      case "xx": // Hours and minutes without `:` delimiter
        return formatTimezone(timezoneOffset);

      // Hours, minutes and optional seconds with `:` delimiter
      // Note: neither ISO-8601 nor JavaScript supports seconds in timezone offsets
      // so this token always has the same output as `xxx`
      case "xxxxx":
      case "xxx": // Hours and minutes with `:` delimiter
      default:
        return formatTimezone(timezoneOffset, ":");
    }
  },

  // Timezone (GMT)
  O: function (date, token, _localize) {
    const timezoneOffset = date.getTimezoneOffset();

    switch (token) {
      // Short
      case "O":
      case "OO":
      case "OOO":
        return "GMT" + formatTimezoneShort(timezoneOffset, ":");
      // Long
      case "OOOO":
      default:
        return "GMT" + formatTimezone(timezoneOffset, ":");
    }
  },

  // Timezone (specific non-location)
  z: function (date, token, _localize) {
    const timezoneOffset = date.getTimezoneOffset();

    switch (token) {
      // Short
      case "z":
      case "zz":
      case "zzz":
        return "GMT" + formatTimezoneShort(timezoneOffset, ":");
      // Long
      case "zzzz":
      default:
        return "GMT" + formatTimezone(timezoneOffset, ":");
    }
  },

  // Seconds timestamp
  t: function (date, token, _localize) {
    const timestamp = Math.trunc(date.getTime() / 1000);
    return addLeadingZeros(timestamp, token.length);
  },

  // Milliseconds timestamp
  T: function (date, token, _localize) {
    const timestamp = date.getTime();
    return addLeadingZeros(timestamp, token.length);
  },
};

function formatTimezoneShort(offset, delimiter = "") {
  const sign = offset > 0 ? "-" : "+";
  const absOffset = Math.abs(offset);
  const hours = Math.trunc(absOffset / 60);
  const minutes = absOffset % 60;
  if (minutes === 0) {
    return sign + String(hours);
  }
  return sign + String(hours) + delimiter + addLeadingZeros(minutes, 2);
}

function formatTimezoneWithOptionalMinutes(offset, delimiter) {
  if (offset % 60 === 0) {
    const sign = offset > 0 ? "-" : "+";
    return sign + addLeadingZeros(Math.abs(offset) / 60, 2);
  }
  return formatTimezone(offset, delimiter);
}

function formatTimezone(offset, delimiter = "") {
  const sign = offset > 0 ? "-" : "+";
  const absOffset = Math.abs(offset);
  const hours = addLeadingZeros(Math.trunc(absOffset / 60), 2);
  const minutes = addLeadingZeros(absOffset % 60, 2);
  return sign + hours + delimiter + minutes;
}

const dateLongFormatter = (pattern, formatLong) => {
  switch (pattern) {
    case "P":
      return formatLong.date({ width: "short" });
    case "PP":
      return formatLong.date({ width: "medium" });
    case "PPP":
      return formatLong.date({ width: "long" });
    case "PPPP":
    default:
      return formatLong.date({ width: "full" });
  }
};

const timeLongFormatter = (pattern, formatLong) => {
  switch (pattern) {
    case "p":
      return formatLong.time({ width: "short" });
    case "pp":
      return formatLong.time({ width: "medium" });
    case "ppp":
      return formatLong.time({ width: "long" });
    case "pppp":
    default:
      return formatLong.time({ width: "full" });
  }
};

const dateTimeLongFormatter = (pattern, formatLong) => {
  const matchResult = pattern.match(/(P+)(p+)?/) || [];
  const datePattern = matchResult[1];
  const timePattern = matchResult[2];

  if (!timePattern) {
    return dateLongFormatter(pattern, formatLong);
  }

  let dateTimeFormat;

  switch (datePattern) {
    case "P":
      dateTimeFormat = formatLong.dateTime({ width: "short" });
      break;
    case "PP":
      dateTimeFormat = formatLong.dateTime({ width: "medium" });
      break;
    case "PPP":
      dateTimeFormat = formatLong.dateTime({ width: "long" });
      break;
    case "PPPP":
    default:
      dateTimeFormat = formatLong.dateTime({ width: "full" });
      break;
  }

  return dateTimeFormat
    .replace("{{date}}", dateLongFormatter(datePattern, formatLong))
    .replace("{{time}}", timeLongFormatter(timePattern, formatLong));
};

const longFormatters = {
  p: timeLongFormatter,
  P: dateTimeLongFormatter,
};

const dayOfYearTokenRE = /^D+$/;
const weekYearTokenRE = /^Y+$/;

const throwTokens = ["D", "DD", "YY", "YYYY"];

function isProtectedDayOfYearToken(token) {
  return dayOfYearTokenRE.test(token);
}

function isProtectedWeekYearToken(token) {
  return weekYearTokenRE.test(token);
}

function warnOrThrowProtectedError(token, format, input) {
  const _message = message(token, format, input);
  console.warn(_message);
  if (throwTokens.includes(token)) throw new RangeError(_message);
}

function message(token, format, input) {
  const subject = token[0] === "Y" ? "years" : "days of the month";
  return `Use \`${token.toLowerCase()}\` instead of \`${token}\` (in \`${format}\`) for formatting ${subject} to the input \`${input}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`;
}

// This RegExp consists of three parts separated by `|`:
// - [yYQqMLwIdDecihHKkms]o matches any available ordinal number token
//   (one of the certain letters followed by `o`)
// - (\w)\1* matches any sequences of the same letter
// - '' matches two quote characters in a row
// - '(''|[^'])+('|$) matches anything surrounded by two quote characters ('),
//   except a single quote symbol, which ends the sequence.
//   Two quote characters do not end the sequence.
//   If there is no matching single quote
//   then the sequence will continue until the end of the string.
// - . matches any single character unmatched by previous parts of the RegExps
const formattingTokensRegExp =
  /[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g;

// This RegExp catches symbols escaped by quotes, and also
// sequences of symbols P, p, and the combinations like `PPPPPPPppppp`
const longFormattingTokensRegExp = /P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;

const escapedStringRegExp = /^'([^]*?)'?$/;
const doubleQuoteRegExp = /''/g;
const unescapedLatinCharacterRegExp = /[a-zA-Z]/;

/**
 * The {@link format} function options.
 */

/**
 * @name format
 * @alias formatDate
 * @category Common Helpers
 * @summary Format the date.
 *
 * @description
 * Return the formatted date string in the given format. The result may vary by locale.
 *
 * > ⚠️ Please note that the `format` tokens differ from Moment.js and other libraries.
 * > See: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 *
 * The characters wrapped between two single quotes characters (') are escaped.
 * Two single quotes in a row, whether inside or outside a quoted sequence, represent a 'real' single quote.
 * (see the last example)
 *
 * Format of the string is based on Unicode Technical Standard #35:
 * https://www.unicode.org/reports/tr35/tr35-dates.html#Date_Field_Symbol_Table
 * with a few additions (see note 7 below the table).
 *
 * Accepted patterns:
 * | Unit                            | Pattern | Result examples                   | Notes |
 * |---------------------------------|---------|-----------------------------------|-------|
 * | Era                             | G..GGG  | AD, BC                            |       |
 * |                                 | GGGG    | Anno Domini, Before Christ        | 2     |
 * |                                 | GGGGG   | A, B                              |       |
 * | Calendar year                   | y       | 44, 1, 1900, 2017                 | 5     |
 * |                                 | yo      | 44th, 1st, 0th, 17th              | 5,7   |
 * |                                 | yy      | 44, 01, 00, 17                    | 5     |
 * |                                 | yyy     | 044, 001, 1900, 2017              | 5     |
 * |                                 | yyyy    | 0044, 0001, 1900, 2017            | 5     |
 * |                                 | yyyyy   | ...                               | 3,5   |
 * | Local week-numbering year       | Y       | 44, 1, 1900, 2017                 | 5     |
 * |                                 | Yo      | 44th, 1st, 1900th, 2017th         | 5,7   |
 * |                                 | YY      | 44, 01, 00, 17                    | 5,8   |
 * |                                 | YYY     | 044, 001, 1900, 2017              | 5     |
 * |                                 | YYYY    | 0044, 0001, 1900, 2017            | 5,8   |
 * |                                 | YYYYY   | ...                               | 3,5   |
 * | ISO week-numbering year         | R       | -43, 0, 1, 1900, 2017             | 5,7   |
 * |                                 | RR      | -43, 00, 01, 1900, 2017           | 5,7   |
 * |                                 | RRR     | -043, 000, 001, 1900, 2017        | 5,7   |
 * |                                 | RRRR    | -0043, 0000, 0001, 1900, 2017     | 5,7   |
 * |                                 | RRRRR   | ...                               | 3,5,7 |
 * | Extended year                   | u       | -43, 0, 1, 1900, 2017             | 5     |
 * |                                 | uu      | -43, 01, 1900, 2017               | 5     |
 * |                                 | uuu     | -043, 001, 1900, 2017             | 5     |
 * |                                 | uuuu    | -0043, 0001, 1900, 2017           | 5     |
 * |                                 | uuuuu   | ...                               | 3,5   |
 * | Quarter (formatting)            | Q       | 1, 2, 3, 4                        |       |
 * |                                 | Qo      | 1st, 2nd, 3rd, 4th                | 7     |
 * |                                 | QQ      | 01, 02, 03, 04                    |       |
 * |                                 | QQQ     | Q1, Q2, Q3, Q4                    |       |
 * |                                 | QQQQ    | 1st quarter, 2nd quarter, ...     | 2     |
 * |                                 | QQQQQ   | 1, 2, 3, 4                        | 4     |
 * | Quarter (stand-alone)           | q       | 1, 2, 3, 4                        |       |
 * |                                 | qo      | 1st, 2nd, 3rd, 4th                | 7     |
 * |                                 | qq      | 01, 02, 03, 04                    |       |
 * |                                 | qqq     | Q1, Q2, Q3, Q4                    |       |
 * |                                 | qqqq    | 1st quarter, 2nd quarter, ...     | 2     |
 * |                                 | qqqqq   | 1, 2, 3, 4                        | 4     |
 * | Month (formatting)              | M       | 1, 2, ..., 12                     |       |
 * |                                 | Mo      | 1st, 2nd, ..., 12th               | 7     |
 * |                                 | MM      | 01, 02, ..., 12                   |       |
 * |                                 | MMM     | Jan, Feb, ..., Dec                |       |
 * |                                 | MMMM    | January, February, ..., December  | 2     |
 * |                                 | MMMMM   | J, F, ..., D                      |       |
 * | Month (stand-alone)             | L       | 1, 2, ..., 12                     |       |
 * |                                 | Lo      | 1st, 2nd, ..., 12th               | 7     |
 * |                                 | LL      | 01, 02, ..., 12                   |       |
 * |                                 | LLL     | Jan, Feb, ..., Dec                |       |
 * |                                 | LLLL    | January, February, ..., December  | 2     |
 * |                                 | LLLLL   | J, F, ..., D                      |       |
 * | Local week of year              | w       | 1, 2, ..., 53                     |       |
 * |                                 | wo      | 1st, 2nd, ..., 53th               | 7     |
 * |                                 | ww      | 01, 02, ..., 53                   |       |
 * | ISO week of year                | I       | 1, 2, ..., 53                     | 7     |
 * |                                 | Io      | 1st, 2nd, ..., 53th               | 7     |
 * |                                 | II      | 01, 02, ..., 53                   | 7     |
 * | Day of month                    | d       | 1, 2, ..., 31                     |       |
 * |                                 | do      | 1st, 2nd, ..., 31st               | 7     |
 * |                                 | dd      | 01, 02, ..., 31                   |       |
 * | Day of year                     | D       | 1, 2, ..., 365, 366               | 9     |
 * |                                 | Do      | 1st, 2nd, ..., 365th, 366th       | 7     |
 * |                                 | DD      | 01, 02, ..., 365, 366             | 9     |
 * |                                 | DDD     | 001, 002, ..., 365, 366           |       |
 * |                                 | DDDD    | ...                               | 3     |
 * | Day of week (formatting)        | E..EEE  | Mon, Tue, Wed, ..., Sun           |       |
 * |                                 | EEEE    | Monday, Tuesday, ..., Sunday      | 2     |
 * |                                 | EEEEE   | M, T, W, T, F, S, S               |       |
 * |                                 | EEEEEE  | Mo, Tu, We, Th, Fr, Sa, Su        |       |
 * | ISO day of week (formatting)    | i       | 1, 2, 3, ..., 7                   | 7     |
 * |                                 | io      | 1st, 2nd, ..., 7th                | 7     |
 * |                                 | ii      | 01, 02, ..., 07                   | 7     |
 * |                                 | iii     | Mon, Tue, Wed, ..., Sun           | 7     |
 * |                                 | iiii    | Monday, Tuesday, ..., Sunday      | 2,7   |
 * |                                 | iiiii   | M, T, W, T, F, S, S               | 7     |
 * |                                 | iiiiii  | Mo, Tu, We, Th, Fr, Sa, Su        | 7     |
 * | Local day of week (formatting)  | e       | 2, 3, 4, ..., 1                   |       |
 * |                                 | eo      | 2nd, 3rd, ..., 1st                | 7     |
 * |                                 | ee      | 02, 03, ..., 01                   |       |
 * |                                 | eee     | Mon, Tue, Wed, ..., Sun           |       |
 * |                                 | eeee    | Monday, Tuesday, ..., Sunday      | 2     |
 * |                                 | eeeee   | M, T, W, T, F, S, S               |       |
 * |                                 | eeeeee  | Mo, Tu, We, Th, Fr, Sa, Su        |       |
 * | Local day of week (stand-alone) | c       | 2, 3, 4, ..., 1                   |       |
 * |                                 | co      | 2nd, 3rd, ..., 1st                | 7     |
 * |                                 | cc      | 02, 03, ..., 01                   |       |
 * |                                 | ccc     | Mon, Tue, Wed, ..., Sun           |       |
 * |                                 | cccc    | Monday, Tuesday, ..., Sunday      | 2     |
 * |                                 | ccccc   | M, T, W, T, F, S, S               |       |
 * |                                 | cccccc  | Mo, Tu, We, Th, Fr, Sa, Su        |       |
 * | AM, PM                          | a..aa   | AM, PM                            |       |
 * |                                 | aaa     | am, pm                            |       |
 * |                                 | aaaa    | a.m., p.m.                        | 2     |
 * |                                 | aaaaa   | a, p                              |       |
 * | AM, PM, noon, midnight          | b..bb   | AM, PM, noon, midnight            |       |
 * |                                 | bbb     | am, pm, noon, midnight            |       |
 * |                                 | bbbb    | a.m., p.m., noon, midnight        | 2     |
 * |                                 | bbbbb   | a, p, n, mi                       |       |
 * | Flexible day period             | B..BBB  | at night, in the morning, ...     |       |
 * |                                 | BBBB    | at night, in the morning, ...     | 2     |
 * |                                 | BBBBB   | at night, in the morning, ...     |       |
 * | Hour [1-12]                     | h       | 1, 2, ..., 11, 12                 |       |
 * |                                 | ho      | 1st, 2nd, ..., 11th, 12th         | 7     |
 * |                                 | hh      | 01, 02, ..., 11, 12               |       |
 * | Hour [0-23]                     | H       | 0, 1, 2, ..., 23                  |       |
 * |                                 | Ho      | 0th, 1st, 2nd, ..., 23rd          | 7     |
 * |                                 | HH      | 00, 01, 02, ..., 23               |       |
 * | Hour [0-11]                     | K       | 1, 2, ..., 11, 0                  |       |
 * |                                 | Ko      | 1st, 2nd, ..., 11th, 0th          | 7     |
 * |                                 | KK      | 01, 02, ..., 11, 00               |       |
 * | Hour [1-24]                     | k       | 24, 1, 2, ..., 23                 |       |
 * |                                 | ko      | 24th, 1st, 2nd, ..., 23rd         | 7     |
 * |                                 | kk      | 24, 01, 02, ..., 23               |       |
 * | Minute                          | m       | 0, 1, ..., 59                     |       |
 * |                                 | mo      | 0th, 1st, ..., 59th               | 7     |
 * |                                 | mm      | 00, 01, ..., 59                   |       |
 * | Second                          | s       | 0, 1, ..., 59                     |       |
 * |                                 | so      | 0th, 1st, ..., 59th               | 7     |
 * |                                 | ss      | 00, 01, ..., 59                   |       |
 * | Fraction of second              | S       | 0, 1, ..., 9                      |       |
 * |                                 | SS      | 00, 01, ..., 99                   |       |
 * |                                 | SSS     | 000, 001, ..., 999                |       |
 * |                                 | SSSS    | ...                               | 3     |
 * | Timezone (ISO-8601 w/ Z)        | X       | -08, +0530, Z                     |       |
 * |                                 | XX      | -0800, +0530, Z                   |       |
 * |                                 | XXX     | -08:00, +05:30, Z                 |       |
 * |                                 | XXXX    | -0800, +0530, Z, +123456          | 2     |
 * |                                 | XXXXX   | -08:00, +05:30, Z, +12:34:56      |       |
 * | Timezone (ISO-8601 w/o Z)       | x       | -08, +0530, +00                   |       |
 * |                                 | xx      | -0800, +0530, +0000               |       |
 * |                                 | xxx     | -08:00, +05:30, +00:00            | 2     |
 * |                                 | xxxx    | -0800, +0530, +0000, +123456      |       |
 * |                                 | xxxxx   | -08:00, +05:30, +00:00, +12:34:56 |       |
 * | Timezone (GMT)                  | O...OOO | GMT-8, GMT+5:30, GMT+0            |       |
 * |                                 | OOOO    | GMT-08:00, GMT+05:30, GMT+00:00   | 2     |
 * | Timezone (specific non-locat.)  | z...zzz | GMT-8, GMT+5:30, GMT+0            | 6     |
 * |                                 | zzzz    | GMT-08:00, GMT+05:30, GMT+00:00   | 2,6   |
 * | Seconds timestamp               | t       | 512969520                         | 7     |
 * |                                 | tt      | ...                               | 3,7   |
 * | Milliseconds timestamp          | T       | 512969520900                      | 7     |
 * |                                 | TT      | ...                               | 3,7   |
 * | Long localized date             | P       | 04/29/1453                        | 7     |
 * |                                 | PP      | Apr 29, 1453                      | 7     |
 * |                                 | PPP     | April 29th, 1453                  | 7     |
 * |                                 | PPPP    | Friday, April 29th, 1453          | 2,7   |
 * | Long localized time             | p       | 12:00 AM                          | 7     |
 * |                                 | pp      | 12:00:00 AM                       | 7     |
 * |                                 | ppp     | 12:00:00 AM GMT+2                 | 7     |
 * |                                 | pppp    | 12:00:00 AM GMT+02:00             | 2,7   |
 * | Combination of date and time    | Pp      | 04/29/1453, 12:00 AM              | 7     |
 * |                                 | PPpp    | Apr 29, 1453, 12:00:00 AM         | 7     |
 * |                                 | PPPppp  | April 29th, 1453 at ...           | 7     |
 * |                                 | PPPPpppp| Friday, April 29th, 1453 at ...   | 2,7   |
 * Notes:
 * 1. "Formatting" units (e.g. formatting quarter) in the default en-US locale
 *    are the same as "stand-alone" units, but are different in some languages.
 *    "Formatting" units are declined according to the rules of the language
 *    in the context of a date. "Stand-alone" units are always nominative singular:
 *
 *    `format(new Date(2017, 10, 6), 'do LLLL', {locale: cs}) //=> '6. listopad'`
 *
 *    `format(new Date(2017, 10, 6), 'do MMMM', {locale: cs}) //=> '6. listopadu'`
 *
 * 2. Any sequence of the identical letters is a pattern, unless it is escaped by
 *    the single quote characters (see below).
 *    If the sequence is longer than listed in table (e.g. `EEEEEEEEEEE`)
 *    the output will be the same as default pattern for this unit, usually
 *    the longest one (in case of ISO weekdays, `EEEE`). Default patterns for units
 *    are marked with "2" in the last column of the table.
 *
 *    `format(new Date(2017, 10, 6), 'MMM') //=> 'Nov'`
 *
 *    `format(new Date(2017, 10, 6), 'MMMM') //=> 'November'`
 *
 *    `format(new Date(2017, 10, 6), 'MMMMM') //=> 'N'`
 *
 *    `format(new Date(2017, 10, 6), 'MMMMMM') //=> 'November'`
 *
 *    `format(new Date(2017, 10, 6), 'MMMMMMM') //=> 'November'`
 *
 * 3. Some patterns could be unlimited length (such as `yyyyyyyy`).
 *    The output will be padded with zeros to match the length of the pattern.
 *
 *    `format(new Date(2017, 10, 6), 'yyyyyyyy') //=> '00002017'`
 *
 * 4. `QQQQQ` and `qqqqq` could be not strictly numerical in some locales.
 *    These tokens represent the shortest form of the quarter.
 *
 * 5. The main difference between `y` and `u` patterns are B.C. years:
 *
 *    | Year | `y` | `u` |
 *    |------|-----|-----|
 *    | AC 1 |   1 |   1 |
 *    | BC 1 |   1 |   0 |
 *    | BC 2 |   2 |  -1 |
 *
 *    Also `yy` always returns the last two digits of a year,
 *    while `uu` pads single digit years to 2 characters and returns other years unchanged:
 *
 *    | Year | `yy` | `uu` |
 *    |------|------|------|
 *    | 1    |   01 |   01 |
 *    | 14   |   14 |   14 |
 *    | 376  |   76 |  376 |
 *    | 1453 |   53 | 1453 |
 *
 *    The same difference is true for local and ISO week-numbering years (`Y` and `R`),
 *    except local week-numbering years are dependent on `options.weekStartsOn`
 *    and `options.firstWeekContainsDate` (compare [getISOWeekYear](https://date-fns.org/docs/getISOWeekYear)
 *    and [getWeekYear](https://date-fns.org/docs/getWeekYear)).
 *
 * 6. Specific non-location timezones are currently unavailable in `date-fns`,
 *    so right now these tokens fall back to GMT timezones.
 *
 * 7. These patterns are not in the Unicode Technical Standard #35:
 *    - `i`: ISO day of week
 *    - `I`: ISO week of year
 *    - `R`: ISO week-numbering year
 *    - `t`: seconds timestamp
 *    - `T`: milliseconds timestamp
 *    - `o`: ordinal number modifier
 *    - `P`: long localized date
 *    - `p`: long localized time
 *
 * 8. `YY` and `YYYY` tokens represent week-numbering years but they are often confused with years.
 *    You should enable `options.useAdditionalWeekYearTokens` to use them. See: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 *
 * 9. `D` and `DD` tokens represent days of the year but they are often confused with days of the month.
 *    You should enable `options.useAdditionalDayOfYearTokens` to use them. See: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The original date
 * @param format - The string of tokens
 * @param options - An object with options
 *
 * @returns The formatted date string
 *
 * @throws `date` must not be Invalid Date
 * @throws `options.locale` must contain `localize` property
 * @throws `options.locale` must contain `formatLong` property
 * @throws use `yyyy` instead of `YYYY` for formatting years using [format provided] to the input [input provided]; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 * @throws use `yy` instead of `YY` for formatting years using [format provided] to the input [input provided]; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 * @throws use `d` instead of `D` for formatting days of the month using [format provided] to the input [input provided]; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 * @throws use `dd` instead of `DD` for formatting days of the month using [format provided] to the input [input provided]; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md
 * @throws format string contains an unescaped latin alphabet character
 *
 * @example
 * // Represent 11 February 2014 in middle-endian format:
 * const result = format(new Date(2014, 1, 11), 'MM/dd/yyyy')
 * //=> '02/11/2014'
 *
 * @example
 * // Represent 2 July 2014 in Esperanto:
 * import { eoLocale } from 'date-fns/locale/eo'
 * const result = format(new Date(2014, 6, 2), "do 'de' MMMM yyyy", {
 *   locale: eoLocale
 * })
 * //=> '2-a de julio 2014'
 *
 * @example
 * // Escape string by single quote characters:
 * const result = format(new Date(2014, 6, 2, 15), "h 'o''clock'")
 * //=> "3 o'clock"
 */
function format(date, formatStr, options) {
  const defaultOptions = getDefaultOptions();
  const locale = options?.locale ?? defaultOptions.locale ?? enUS;

  const firstWeekContainsDate =
    options?.firstWeekContainsDate ??
    options?.locale?.options?.firstWeekContainsDate ??
    defaultOptions.firstWeekContainsDate ??
    defaultOptions.locale?.options?.firstWeekContainsDate ??
    1;

  const weekStartsOn =
    options?.weekStartsOn ??
    options?.locale?.options?.weekStartsOn ??
    defaultOptions.weekStartsOn ??
    defaultOptions.locale?.options?.weekStartsOn ??
    0;

  const originalDate = toDate(date);

  if (!isValid(originalDate)) {
    throw new RangeError("Invalid time value");
  }

  let parts = formatStr
    .match(longFormattingTokensRegExp)
    .map((substring) => {
      const firstCharacter = substring[0];
      if (firstCharacter === "p" || firstCharacter === "P") {
        const longFormatter = longFormatters[firstCharacter];
        return longFormatter(substring, locale.formatLong);
      }
      return substring;
    })
    .join("")
    .match(formattingTokensRegExp)
    .map((substring) => {
      // Replace two single quote characters with one single quote character
      if (substring === "''") {
        return { isToken: false, value: "'" };
      }

      const firstCharacter = substring[0];
      if (firstCharacter === "'") {
        return { isToken: false, value: cleanEscapedString(substring) };
      }

      if (formatters[firstCharacter]) {
        return { isToken: true, value: substring };
      }

      if (firstCharacter.match(unescapedLatinCharacterRegExp)) {
        throw new RangeError(
          "Format string contains an unescaped latin alphabet character `" +
            firstCharacter +
            "`",
        );
      }

      return { isToken: false, value: substring };
    });

  // invoke localize preprocessor (only for french locales at the moment)
  if (locale.localize.preprocessor) {
    parts = locale.localize.preprocessor(originalDate, parts);
  }

  const formatterOptions = {
    firstWeekContainsDate,
    weekStartsOn,
    locale,
  };

  return parts
    .map((part) => {
      if (!part.isToken) return part.value;

      const token = part.value;

      if (
        (!options?.useAdditionalWeekYearTokens &&
          isProtectedWeekYearToken(token)) ||
        (!options?.useAdditionalDayOfYearTokens &&
          isProtectedDayOfYearToken(token))
      ) {
        warnOrThrowProtectedError(token, formatStr, String(date));
      }

      const formatter = formatters[token[0]];
      return formatter(originalDate, token, locale.localize, formatterOptions);
    })
    .join("");
}

function cleanEscapedString(input) {
  const matched = input.match(escapedStringRegExp);

  if (!matched) {
    return input;
  }

  return matched[1].replace(doubleQuoteRegExp, "'");
}

/**
 * The {@link formatDistance} function options.
 */

/**
 * @name formatDistance
 * @category Common Helpers
 * @summary Return the distance between the given dates in words.
 *
 * @description
 * Return the distance between the given dates in words.
 *
 * | Distance between dates                                            | Result              |
 * |-------------------------------------------------------------------|---------------------|
 * | 0 ... 30 secs                                                     | less than a minute  |
 * | 30 secs ... 1 min 30 secs                                         | 1 minute            |
 * | 1 min 30 secs ... 44 mins 30 secs                                 | [2..44] minutes     |
 * | 44 mins ... 30 secs ... 89 mins 30 secs                           | about 1 hour        |
 * | 89 mins 30 secs ... 23 hrs 59 mins 30 secs                        | about [2..24] hours |
 * | 23 hrs 59 mins 30 secs ... 41 hrs 59 mins 30 secs                 | 1 day               |
 * | 41 hrs 59 mins 30 secs ... 29 days 23 hrs 59 mins 30 secs         | [2..30] days        |
 * | 29 days 23 hrs 59 mins 30 secs ... 44 days 23 hrs 59 mins 30 secs | about 1 month       |
 * | 44 days 23 hrs 59 mins 30 secs ... 59 days 23 hrs 59 mins 30 secs | about 2 months      |
 * | 59 days 23 hrs 59 mins 30 secs ... 1 yr                           | [2..12] months      |
 * | 1 yr ... 1 yr 3 months                                            | about 1 year        |
 * | 1 yr 3 months ... 1 yr 9 month s                                  | over 1 year         |
 * | 1 yr 9 months ... 2 yrs                                           | almost 2 years      |
 * | N yrs ... N yrs 3 months                                          | about N years       |
 * | N yrs 3 months ... N yrs 9 months                                 | over N years        |
 * | N yrs 9 months ... N+1 yrs                                        | almost N+1 years    |
 *
 * With `options.includeSeconds == true`:
 * | Distance between dates | Result               |
 * |------------------------|----------------------|
 * | 0 secs ... 5 secs      | less than 5 seconds  |
 * | 5 secs ... 10 secs     | less than 10 seconds |
 * | 10 secs ... 20 secs    | less than 20 seconds |
 * | 20 secs ... 40 secs    | half a minute        |
 * | 40 secs ... 60 secs    | less than a minute   |
 * | 60 secs ... 90 secs    | 1 minute             |
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The date
 * @param baseDate - The date to compare with
 * @param options - An object with options
 *
 * @returns The distance in words
 *
 * @throws `date` must not be Invalid Date
 * @throws `baseDate` must not be Invalid Date
 * @throws `options.locale` must contain `formatDistance` property
 *
 * @example
 * // What is the distance between 2 July 2014 and 1 January 2015?
 * const result = formatDistance(new Date(2014, 6, 2), new Date(2015, 0, 1))
 * //=> '6 months'
 *
 * @example
 * // What is the distance between 1 January 2015 00:00:15
 * // and 1 January 2015 00:00:00, including seconds?
 * const result = formatDistance(
 *   new Date(2015, 0, 1, 0, 0, 15),
 *   new Date(2015, 0, 1, 0, 0, 0),
 *   { includeSeconds: true }
 * )
 * //=> 'less than 20 seconds'
 *
 * @example
 * // What is the distance from 1 January 2016
 * // to 1 January 2015, with a suffix?
 * const result = formatDistance(new Date(2015, 0, 1), new Date(2016, 0, 1), {
 *   addSuffix: true
 * })
 * //=> 'about 1 year ago'
 *
 * @example
 * // What is the distance between 1 August 2016 and 1 January 2015 in Esperanto?
 * import { eoLocale } from 'date-fns/locale/eo'
 * const result = formatDistance(new Date(2016, 7, 1), new Date(2015, 0, 1), {
 *   locale: eoLocale
 * })
 * //=> 'pli ol 1 jaro'
 */

function formatDistance$1(date, baseDate, options) {
  const defaultOptions = getDefaultOptions();
  const locale = options?.locale ?? defaultOptions.locale ?? enUS;
  const minutesInAlmostTwoDays = 2520;

  const comparison = compareAsc(date, baseDate);

  if (isNaN(comparison)) {
    throw new RangeError("Invalid time value");
  }

  const localizeOptions = Object.assign({}, options, {
    addSuffix: options?.addSuffix,
    comparison: comparison,
  });

  let dateLeft;
  let dateRight;
  if (comparison > 0) {
    dateLeft = toDate(baseDate);
    dateRight = toDate(date);
  } else {
    dateLeft = toDate(date);
    dateRight = toDate(baseDate);
  }

  const seconds = differenceInSeconds(dateRight, dateLeft);
  const offsetInSeconds =
    (getTimezoneOffsetInMilliseconds(dateRight) -
      getTimezoneOffsetInMilliseconds(dateLeft)) /
    1000;
  const minutes = Math.round((seconds - offsetInSeconds) / 60);
  let months;

  // 0 up to 2 mins
  if (minutes < 2) {
    if (options?.includeSeconds) {
      if (seconds < 5) {
        return locale.formatDistance("lessThanXSeconds", 5, localizeOptions);
      } else if (seconds < 10) {
        return locale.formatDistance("lessThanXSeconds", 10, localizeOptions);
      } else if (seconds < 20) {
        return locale.formatDistance("lessThanXSeconds", 20, localizeOptions);
      } else if (seconds < 40) {
        return locale.formatDistance("halfAMinute", 0, localizeOptions);
      } else if (seconds < 60) {
        return locale.formatDistance("lessThanXMinutes", 1, localizeOptions);
      } else {
        return locale.formatDistance("xMinutes", 1, localizeOptions);
      }
    } else {
      if (minutes === 0) {
        return locale.formatDistance("lessThanXMinutes", 1, localizeOptions);
      } else {
        return locale.formatDistance("xMinutes", minutes, localizeOptions);
      }
    }

    // 2 mins up to 0.75 hrs
  } else if (minutes < 45) {
    return locale.formatDistance("xMinutes", minutes, localizeOptions);

    // 0.75 hrs up to 1.5 hrs
  } else if (minutes < 90) {
    return locale.formatDistance("aboutXHours", 1, localizeOptions);

    // 1.5 hrs up to 24 hrs
  } else if (minutes < minutesInDay) {
    const hours = Math.round(minutes / 60);
    return locale.formatDistance("aboutXHours", hours, localizeOptions);

    // 1 day up to 1.75 days
  } else if (minutes < minutesInAlmostTwoDays) {
    return locale.formatDistance("xDays", 1, localizeOptions);

    // 1.75 days up to 30 days
  } else if (minutes < minutesInMonth) {
    const days = Math.round(minutes / minutesInDay);
    return locale.formatDistance("xDays", days, localizeOptions);

    // 1 month up to 2 months
  } else if (minutes < minutesInMonth * 2) {
    months = Math.round(minutes / minutesInMonth);
    return locale.formatDistance("aboutXMonths", months, localizeOptions);
  }

  months = differenceInMonths(dateRight, dateLeft);

  // 2 months up to 12 months
  if (months < 12) {
    const nearestMonth = Math.round(minutes / minutesInMonth);
    return locale.formatDistance("xMonths", nearestMonth, localizeOptions);

    // 1 year up to max Date
  } else {
    const monthsSinceStartOfYear = months % 12;
    const years = Math.trunc(months / 12);

    // N years up to 1 years 3 months
    if (monthsSinceStartOfYear < 3) {
      return locale.formatDistance("aboutXYears", years, localizeOptions);

      // N years 3 months up to N years 9 months
    } else if (monthsSinceStartOfYear < 9) {
      return locale.formatDistance("overXYears", years, localizeOptions);

      // N years 9 months up to N year 12 months
    } else {
      return locale.formatDistance("almostXYears", years + 1, localizeOptions);
    }
  }
}

/**
 * The {@link formatDistanceToNow} function options.
 */

/**
 * @name formatDistanceToNow
 * @category Common Helpers
 * @summary Return the distance between the given date and now in words.
 * @pure false
 *
 * @description
 * Return the distance between the given date and now in words.
 *
 * | Distance to now                                                   | Result              |
 * |-------------------------------------------------------------------|---------------------|
 * | 0 ... 30 secs                                                     | less than a minute  |
 * | 30 secs ... 1 min 30 secs                                         | 1 minute            |
 * | 1 min 30 secs ... 44 mins 30 secs                                 | [2..44] minutes     |
 * | 44 mins ... 30 secs ... 89 mins 30 secs                           | about 1 hour        |
 * | 89 mins 30 secs ... 23 hrs 59 mins 30 secs                        | about [2..24] hours |
 * | 23 hrs 59 mins 30 secs ... 41 hrs 59 mins 30 secs                 | 1 day               |
 * | 41 hrs 59 mins 30 secs ... 29 days 23 hrs 59 mins 30 secs         | [2..30] days        |
 * | 29 days 23 hrs 59 mins 30 secs ... 44 days 23 hrs 59 mins 30 secs | about 1 month       |
 * | 44 days 23 hrs 59 mins 30 secs ... 59 days 23 hrs 59 mins 30 secs | about 2 months      |
 * | 59 days 23 hrs 59 mins 30 secs ... 1 yr                           | [2..12] months      |
 * | 1 yr ... 1 yr 3 months                                            | about 1 year        |
 * | 1 yr 3 months ... 1 yr 9 month s                                  | over 1 year         |
 * | 1 yr 9 months ... 2 yrs                                           | almost 2 years      |
 * | N yrs ... N yrs 3 months                                          | about N years       |
 * | N yrs 3 months ... N yrs 9 months                                 | over N years        |
 * | N yrs 9 months ... N+1 yrs                                        | almost N+1 years    |
 *
 * With `options.includeSeconds == true`:
 * | Distance to now     | Result               |
 * |---------------------|----------------------|
 * | 0 secs ... 5 secs   | less than 5 seconds  |
 * | 5 secs ... 10 secs  | less than 10 seconds |
 * | 10 secs ... 20 secs | less than 20 seconds |
 * | 20 secs ... 40 secs | half a minute        |
 * | 40 secs ... 60 secs | less than a minute   |
 * | 60 secs ... 90 secs | 1 minute             |
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param date - The given date
 * @param options - The object with options
 *
 * @returns The distance in words
 *
 * @throws `date` must not be Invalid Date
 * @throws `options.locale` must contain `formatDistance` property
 *
 * @example
 * // If today is 1 January 2015, what is the distance to 2 July 2014?
 * const result = formatDistanceToNow(
 *   new Date(2014, 6, 2)
 * )
 * //=> '6 months'
 *
 * @example
 * // If now is 1 January 2015 00:00:00,
 * // what is the distance to 1 January 2015 00:00:15, including seconds?
 * const result = formatDistanceToNow(
 *   new Date(2015, 0, 1, 0, 0, 15),
 *   {includeSeconds: true}
 * )
 * //=> 'less than 20 seconds'
 *
 * @example
 * // If today is 1 January 2015,
 * // what is the distance to 1 January 2016, with a suffix?
 * const result = formatDistanceToNow(
 *   new Date(2016, 0, 1),
 *   {addSuffix: true}
 * )
 * //=> 'in about 1 year'
 *
 * @example
 * // If today is 1 January 2015,
 * // what is the distance to 1 August 2016 in Esperanto?
 * const eoLocale = require('date-fns/locale/eo')
 * const result = formatDistanceToNow(
 *   new Date(2016, 7, 1),
 *   {locale: eoLocale}
 * )
 * //=> 'pli ol 1 jaro'
 */
function formatDistanceToNow(date, options) {
  return formatDistance$1(date, constructNow(date), options);
}

/**
 * The {@link isSameWeek} function options.
 */

/**
 * @name isSameWeek
 * @category Week Helpers
 * @summary Are the given dates in the same week (and month and year)?
 *
 * @description
 * Are the given dates in the same week (and month and year)?
 *
 * @typeParam DateType - The `Date` type, the function operates on. Gets inferred from passed arguments. Allows to use extensions like [`UTCDate`](https://github.com/date-fns/utc).
 *
 * @param dateLeft - The first date to check
 * @param dateRight - The second date to check
 * @param options - An object with options
 *
 * @returns The dates are in the same week (and month and year)
 *
 * @example
 * // Are 31 August 2014 and 4 September 2014 in the same week?
 * const result = isSameWeek(new Date(2014, 7, 31), new Date(2014, 8, 4))
 * //=> true
 *
 * @example
 * // If week starts with Monday,
 * // are 31 August 2014 and 4 September 2014 in the same week?
 * const result = isSameWeek(new Date(2014, 7, 31), new Date(2014, 8, 4), {
 *   weekStartsOn: 1
 * })
 * //=> false
 *
 * @example
 * // Are 1 January 2014 and 1 January 2015 in the same week?
 * const result = isSameWeek(new Date(2014, 0, 1), new Date(2015, 0, 1))
 * //=> false
 */
function isSameWeek(dateLeft, dateRight, options) {
  const dateLeftStartOfWeek = startOfWeek(dateLeft, options);
  const dateRightStartOfWeek = startOfWeek(dateRight, options);

  return +dateLeftStartOfWeek === +dateRightStartOfWeek;
}

const formatDistanceLocale = {
  lessThanXSeconds: {
    one: "meno di un secondo",
    other: "meno di {{count}} secondi",
  },

  xSeconds: {
    one: "un secondo",
    other: "{{count}} secondi",
  },

  halfAMinute: "alcuni secondi",

  lessThanXMinutes: {
    one: "meno di un minuto",
    other: "meno di {{count}} minuti",
  },

  xMinutes: {
    one: "un minuto",
    other: "{{count}} minuti",
  },

  aboutXHours: {
    one: "circa un'ora",
    other: "circa {{count}} ore",
  },

  xHours: {
    one: "un'ora",
    other: "{{count}} ore",
  },

  xDays: {
    one: "un giorno",
    other: "{{count}} giorni",
  },

  aboutXWeeks: {
    one: "circa una settimana",
    other: "circa {{count}} settimane",
  },

  xWeeks: {
    one: "una settimana",
    other: "{{count}} settimane",
  },

  aboutXMonths: {
    one: "circa un mese",
    other: "circa {{count}} mesi",
  },

  xMonths: {
    one: "un mese",
    other: "{{count}} mesi",
  },

  aboutXYears: {
    one: "circa un anno",
    other: "circa {{count}} anni",
  },

  xYears: {
    one: "un anno",
    other: "{{count}} anni",
  },

  overXYears: {
    one: "più di un anno",
    other: "più di {{count}} anni",
  },

  almostXYears: {
    one: "quasi un anno",
    other: "quasi {{count}} anni",
  },
};

const formatDistance = (token, count, options) => {
  let result;

  const tokenValue = formatDistanceLocale[token];
  if (typeof tokenValue === "string") {
    result = tokenValue;
  } else if (count === 1) {
    result = tokenValue.one;
  } else {
    result = tokenValue.other.replace("{{count}}", count.toString());
  }

  if (options?.addSuffix) {
    if (options.comparison && options.comparison > 0) {
      return "tra " + result;
    } else {
      return result + " fa";
    }
  }

  return result;
};

const dateFormats = {
  full: "EEEE d MMMM y",
  long: "d MMMM y",
  medium: "d MMM y",
  short: "dd/MM/y",
};

const timeFormats = {
  full: "HH:mm:ss zzzz",
  long: "HH:mm:ss z",
  medium: "HH:mm:ss",
  short: "HH:mm",
};

const dateTimeFormats = {
  full: "{{date}} {{time}}",
  long: "{{date}} {{time}}",
  medium: "{{date}} {{time}}",
  short: "{{date}} {{time}}",
};

const formatLong = {
  date: buildFormatLongFn({
    formats: dateFormats,
    defaultWidth: "full",
  }),

  time: buildFormatLongFn({
    formats: timeFormats,
    defaultWidth: "full",
  }),

  dateTime: buildFormatLongFn({
    formats: dateTimeFormats,
    defaultWidth: "full",
  }),
};

const weekdays = [
  "domenica",
  "lunedì",
  "martedì",
  "mercoledì",
  "giovedì",
  "venerdì",
  "sabato",
];

function lastWeek(day) {
  switch (day) {
    case 0:
      return "'domenica scorsa alle' p";
    default:
      return "'" + weekdays[day] + " scorso alle' p";
  }
}

function thisWeek(day) {
  return "'" + weekdays[day] + " alle' p";
}

function nextWeek(day) {
  switch (day) {
    case 0:
      return "'domenica prossima alle' p";
    default:
      return "'" + weekdays[day] + " prossimo alle' p";
  }
}

const formatRelativeLocale = {
  lastWeek: (date, baseDate, options) => {
    const day = date.getDay();
    if (isSameWeek(date, baseDate, options)) {
      return thisWeek(day);
    } else {
      return lastWeek(day);
    }
  },
  yesterday: "'ieri alle' p",
  today: "'oggi alle' p",
  tomorrow: "'domani alle' p",
  nextWeek: (date, baseDate, options) => {
    const day = date.getDay();
    if (isSameWeek(date, baseDate, options)) {
      return thisWeek(day);
    } else {
      return nextWeek(day);
    }
  },
  other: "P",
};

const formatRelative = (token, date, baseDate, options) => {
  const format = formatRelativeLocale[token];

  if (typeof format === "function") {
    return format(date, baseDate, options);
  }

  return format;
};

const eraValues = {
  narrow: ["aC", "dC"],
  abbreviated: ["a.C.", "d.C."],
  wide: ["avanti Cristo", "dopo Cristo"],
};

const quarterValues = {
  narrow: ["1", "2", "3", "4"],
  abbreviated: ["T1", "T2", "T3", "T4"],
  wide: ["1º trimestre", "2º trimestre", "3º trimestre", "4º trimestre"],
};

const monthValues = {
  narrow: ["G", "F", "M", "A", "M", "G", "L", "A", "S", "O", "N", "D"],
  abbreviated: [
    "gen",
    "feb",
    "mar",
    "apr",
    "mag",
    "giu",
    "lug",
    "ago",
    "set",
    "ott",
    "nov",
    "dic",
  ],

  wide: [
    "gennaio",
    "febbraio",
    "marzo",
    "aprile",
    "maggio",
    "giugno",
    "luglio",
    "agosto",
    "settembre",
    "ottobre",
    "novembre",
    "dicembre",
  ],
};

const dayValues = {
  narrow: ["D", "L", "M", "M", "G", "V", "S"],
  short: ["dom", "lun", "mar", "mer", "gio", "ven", "sab"],
  abbreviated: ["dom", "lun", "mar", "mer", "gio", "ven", "sab"],
  wide: [
    "domenica",
    "lunedì",
    "martedì",
    "mercoledì",
    "giovedì",
    "venerdì",
    "sabato",
  ],
};

const dayPeriodValues = {
  narrow: {
    am: "m.",
    pm: "p.",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "mattina",
    afternoon: "pomeriggio",
    evening: "sera",
    night: "notte",
  },
  abbreviated: {
    am: "AM",
    pm: "PM",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "mattina",
    afternoon: "pomeriggio",
    evening: "sera",
    night: "notte",
  },
  wide: {
    am: "AM",
    pm: "PM",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "mattina",
    afternoon: "pomeriggio",
    evening: "sera",
    night: "notte",
  },
};

const formattingDayPeriodValues = {
  narrow: {
    am: "m.",
    pm: "p.",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "di mattina",
    afternoon: "del pomeriggio",
    evening: "di sera",
    night: "di notte",
  },
  abbreviated: {
    am: "AM",
    pm: "PM",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "di mattina",
    afternoon: "del pomeriggio",
    evening: "di sera",
    night: "di notte",
  },
  wide: {
    am: "AM",
    pm: "PM",
    midnight: "mezzanotte",
    noon: "mezzogiorno",
    morning: "di mattina",
    afternoon: "del pomeriggio",
    evening: "di sera",
    night: "di notte",
  },
};

const ordinalNumber = (dirtyNumber, _options) => {
  const number = Number(dirtyNumber);
  return String(number);
};

const localize = {
  ordinalNumber,

  era: buildLocalizeFn({
    values: eraValues,
    defaultWidth: "wide",
  }),

  quarter: buildLocalizeFn({
    values: quarterValues,
    defaultWidth: "wide",
    argumentCallback: (quarter) => quarter - 1,
  }),

  month: buildLocalizeFn({
    values: monthValues,
    defaultWidth: "wide",
  }),

  day: buildLocalizeFn({
    values: dayValues,
    defaultWidth: "wide",
  }),

  dayPeriod: buildLocalizeFn({
    values: dayPeriodValues,
    defaultWidth: "wide",
    formattingValues: formattingDayPeriodValues,
    defaultFormattingWidth: "wide",
  }),
};

const matchOrdinalNumberPattern = /^(\d+)(º)?/i;
const parseOrdinalNumberPattern = /\d+/i;

const matchEraPatterns = {
  narrow: /^(aC|dC)/i,
  abbreviated: /^(a\.?\s?C\.?|a\.?\s?e\.?\s?v\.?|d\.?\s?C\.?|e\.?\s?v\.?)/i,
  wide: /^(avanti Cristo|avanti Era Volgare|dopo Cristo|Era Volgare)/i,
};
const parseEraPatterns = {
  any: [/^a/i, /^(d|e)/i],
};

const matchQuarterPatterns = {
  narrow: /^[1234]/i,
  abbreviated: /^t[1234]/i,
  wide: /^[1234](º)? trimestre/i,
};
const parseQuarterPatterns = {
  any: [/1/i, /2/i, /3/i, /4/i],
};

const matchMonthPatterns = {
  narrow: /^[gfmalsond]/i,
  abbreviated: /^(gen|feb|mar|apr|mag|giu|lug|ago|set|ott|nov|dic)/i,
  wide: /^(gennaio|febbraio|marzo|aprile|maggio|giugno|luglio|agosto|settembre|ottobre|novembre|dicembre)/i,
};
const parseMonthPatterns = {
  narrow: [
    /^g/i,
    /^f/i,
    /^m/i,
    /^a/i,
    /^m/i,
    /^g/i,
    /^l/i,
    /^a/i,
    /^s/i,
    /^o/i,
    /^n/i,
    /^d/i,
  ],

  any: [
    /^ge/i,
    /^f/i,
    /^mar/i,
    /^ap/i,
    /^mag/i,
    /^gi/i,
    /^l/i,
    /^ag/i,
    /^s/i,
    /^o/i,
    /^n/i,
    /^d/i,
  ],
};

const matchDayPatterns = {
  narrow: /^[dlmgvs]/i,
  short: /^(do|lu|ma|me|gi|ve|sa)/i,
  abbreviated: /^(dom|lun|mar|mer|gio|ven|sab)/i,
  wide: /^(domenica|luned[i|ì]|marted[i|ì]|mercoled[i|ì]|gioved[i|ì]|venerd[i|ì]|sabato)/i,
};
const parseDayPatterns = {
  narrow: [/^d/i, /^l/i, /^m/i, /^m/i, /^g/i, /^v/i, /^s/i],
  any: [/^d/i, /^l/i, /^ma/i, /^me/i, /^g/i, /^v/i, /^s/i],
};

const matchDayPeriodPatterns = {
  narrow:
    /^(a|m\.|p|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i,
  any: /^([ap]\.?\s?m\.?|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i,
};
const parseDayPeriodPatterns = {
  any: {
    am: /^a/i,
    pm: /^p/i,
    midnight: /^mezza/i,
    noon: /^mezzo/i,
    morning: /mattina/i,
    afternoon: /pomeriggio/i,
    evening: /sera/i,
    night: /notte/i,
  },
};

const match = {
  ordinalNumber: buildMatchPatternFn({
    matchPattern: matchOrdinalNumberPattern,
    parsePattern: parseOrdinalNumberPattern,
    valueCallback: (value) => parseInt(value, 10),
  }),

  era: buildMatchFn({
    matchPatterns: matchEraPatterns,
    defaultMatchWidth: "wide",
    parsePatterns: parseEraPatterns,
    defaultParseWidth: "any",
  }),

  quarter: buildMatchFn({
    matchPatterns: matchQuarterPatterns,
    defaultMatchWidth: "wide",
    parsePatterns: parseQuarterPatterns,
    defaultParseWidth: "any",
    valueCallback: (index) => index + 1,
  }),

  month: buildMatchFn({
    matchPatterns: matchMonthPatterns,
    defaultMatchWidth: "wide",
    parsePatterns: parseMonthPatterns,
    defaultParseWidth: "any",
  }),

  day: buildMatchFn({
    matchPatterns: matchDayPatterns,
    defaultMatchWidth: "wide",
    parsePatterns: parseDayPatterns,
    defaultParseWidth: "any",
  }),

  dayPeriod: buildMatchFn({
    matchPatterns: matchDayPeriodPatterns,
    defaultMatchWidth: "any",
    parsePatterns: parseDayPeriodPatterns,
    defaultParseWidth: "any",
  }),
};

/**
 * @category Locales
 * @summary Italian locale.
 * @language Italian
 * @iso-639-2 ita
 * @author Alberto Restifo [@albertorestifo](https://github.com/albertorestifo)
 * @author Giovanni Polimeni [@giofilo](https://github.com/giofilo)
 * @author Vincenzo Carrese [@vin-car](https://github.com/vin-car)
 */
const it$2 = {
  code: "it",
  formatDistance: formatDistance,
  formatLong: formatLong,
  formatRelative: formatRelative,
  localize: localize,
  match: match,
  options: {
    weekStartsOn: 1 /* Monday */,
    firstWeekContainsDate: 4,
  },
};

function CommandCenterHome() {
  const { user } = useAuth();
  usePrizeData();
  useBuzzPricing(user?.id);
  const { missionStatus} = useMissionStatus();
  const { battleId, isOpen, closeBattle } = useBattleOverlay();
  reactExports.useEffect(() => {
    localStorage.removeItem("mission-progress");
    localStorage.removeItem("purchased-clues");
    localStorage.removeItem("diary-entries");
    localStorage.removeItem("user-credits");
    localStorage.removeItem("mission-data");
    localStorage.removeItem("clue-data");
    localStorage.removeItem("mission-08-06-2025");
    localStorage.removeItem("timeline-08-06");
    localStorage.removeItem("old-mission-data");
    console.log("🧹 FULL CACHE CLEARED - RESET COMPLETO 17/07/2025");
  }, []);
  const [progress, setProgress] = useLocalStorage("mission-progress", 0);
  useLocalStorage("user-credits", 1e3);
  const [purchasedClues] = useLocalStorage("purchased-clues", []);
  const [diaryEntries, setDiaryEntries] = useLocalStorage("diary-entries", []);
  const [prizeUnlockStatus, setPrizeUnlockStatus] = reactExports.useState("locked");
  const activeMission = missionStatus ? {
    id: missionStatus.id,
    title: missionStatus.title,
    totalClues: missionStatus.totalClues,
    foundClues: missionStatus.cluesFound,
    timeLimit: "48:00:00",
    startTime: missionStatus.startDate.toISOString(),
    remainingDays: missionStatus.daysRemaining,
    totalDays: missionStatus.totalDays,
    dailyLimit: 50
    // 🔥 BUZZ GIORNALIERO MASSIMO 50
  } : {
    id: "M001",
    title: "M1SSION ONE",
    totalClues: 200,
    foundClues: 0,
    timeLimit: "48:00:00",
    startTime: "2025-07-17T00:00:00.000Z",
    remainingDays: 30,
    totalDays: 30,
    dailyLimit: 50
  };
  reactExports.useEffect(() => {
    if (missionStatus) {
      const realProgress = missionStatus.progressPercent;
      setProgress(realProgress);
      console.log("🔥 MISSION SYNC FROM DATABASE (200 INDIZI - RESET 21/07/2025):", {
        foundClues: missionStatus.cluesFound,
        totalClues: missionStatus.totalClues,
        remainingDays: missionStatus.daysRemaining,
        startDate: missionStatus.startDate.toISOString(),
        progressPercent: missionStatus.progressPercent,
        state: missionStatus.state,
        dailyLimit: 50
      });
    }
  }, [missionStatus, setProgress]);
  reactExports.useEffect(() => {
    const daysRemaining = activeMission.remainingDays;
    const objectivesPercentage = activeMission.foundClues / activeMission.totalClues * 100;
    const userScore = progress;
    console.log("🎯 PRIZE STATUS CALCULATION (200 INDIZI - RESET 17/07/2025):", {
      daysRemaining,
      objectivesPercentage,
      userScore,
      foundClues: activeMission.foundClues,
      totalClues: activeMission.totalClues
    });
    if (daysRemaining <= 3) {
      setPrizeUnlockStatus("unlocked");
    } else {
      const partialVisibility = objectivesPercentage * 0.4 + userScore * 0.05;
      if (partialVisibility < 20) {
        setPrizeUnlockStatus("locked");
      } else if (partialVisibility < 35) {
        setPrizeUnlockStatus("partial");
      } else {
        setPrizeUnlockStatus("near");
      }
    }
  }, [progress, activeMission.foundClues, activeMission.totalClues, activeMission.remainingDays]);
  const addDiaryEntry = (entry) => {
    setDiaryEntries((prev) => [entry, ...prev]);
  };
  const addPersonalNote = (note) => {
    addDiaryEntry({
      type: "note",
      content: note,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    });
    ue$1.success("Nota aggiunta al diario");
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        className: "mb-6 w-full m1-card",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        transition: { duration: 0.5 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          PrizeVision,
          {
            progress,
            status: prizeUnlockStatus
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        className: "mb-6",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        transition: { duration: 0.5, delay: 0.05 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(PulseBar, { variant: "inline" })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(InviteFloatingButton, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(DNAQuickAction, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        className: "mb-6",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        transition: { duration: 0.5, delay: 0.1 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          ActiveMissionBox,
          {
            mission: activeMission,
            purchasedClues,
            progress
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "order-2 md:order-1 m1-card",
          initial: { opacity: 0, x: -20 },
          animate: { opacity: 1, x: 0 },
          transition: { duration: 0.5, delay: 0.2 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleConsole, {})
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          className: "order-3 md:order-2 m1-card",
          initial: { opacity: 0, x: 20 },
          animate: { opacity: 1, x: 0 },
          transition: { duration: 0.5, delay: 0.2 },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            AgentDiary,
            {
              entries: diaryEntries,
              onAddNote: addPersonalNote,
              purchasedClues
            }
          )
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      BattleArenaOverlay,
      {
        battleId,
        open: isOpen,
        onClose: closeBattle
      }
    )
  ] });
}

function useRealTimeNotifications() {
  const [isConnected, setIsConnected] = reactExports.useState(false);
  const { createNotification} = useNotificationManager();
  reactExports.useEffect(() => {
    console.log("Setting up real-time notifications channel");
    const channel = supabase.channel("notification-updates").on("broadcast", { event: "new-notification" }, (payload) => {
      console.log("Received real-time notification:", payload);
      if (payload.payload && typeof payload.payload === "object") {
        const { title, description } = payload.payload;
        if (title && description) {
          createNotification(title, description);
          ue$1.info(title, {
            description,
            duration: 5e3
          });
        }
      }
    }).subscribe((status) => {
      console.log("Real-time notification subscription status:", status);
      setIsConnected(status === "SUBSCRIBED");
    });
    return () => {
      console.log("Cleaning up real-time notifications channel");
      supabase.removeChannel(channel);
    };
  }, [createNotification]);
  const broadcastNotification = async (title, description) => {
    try {
      console.log("Broadcasting notification:", { title, description });
      const response = await supabase.channel("notification-updates").send({
        type: "broadcast",
        event: "new-notification",
        payload: { title, description }
      });
      if (!response) {
        console.error("Error broadcasting notification: No response");
        return false;
      }
      createNotification(title, description);
      return true;
    } catch (error) {
      console.error("Exception when broadcasting notification:", error);
      return false;
    }
  };
  return {
    isConnected,
    broadcastNotification
  };
}

const NotificationItem = ({
  notification,
  onSelect,
  onDelete
}) => {
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const formattedDate = formatDistanceToNow(new Date(notification.date), {
    addSuffix: true,
    locale: it$2
  });
  const fullFormattedDate = new Date(notification.date).toLocaleString("it-IT", {
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit"
  });
  const handleDelete = (e) => {
    e.stopPropagation();
    onDelete();
  };
  const handleCardClick = () => {
    setIsExpanded(!isExpanded);
    if (!notification.read) {
      onSelect();
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      whileHover: { scale: 1.02, boxShadow: "0 15px 50px rgba(0, 229, 255, 0.25)" },
      whileTap: { scale: 0.98 },
      onClick: handleCardClick,
      className: "m1ssion-glass-card cursor-pointer transition-all duration-300 relative overflow-hidden",
      style: {
        background: notification.read ? "rgba(0, 0, 0, 0.05)" : "rgba(0, 0, 0, 0.05)",
        backdropFilter: "blur(40px)",
        WebkitBackdropFilter: "blur(40px)",
        borderRadius: "24px",
        border: "1px solid rgba(255, 255, 255, 0.1)",
        boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
            style: {
              animation: "slideGlowNotif 3s ease-in-out infinite",
              width: "200%",
              left: "-100%"
            }
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
        @keyframes slideGlowNotif {
          0% { transform: translateX(0); }
          50% { transform: translateX(50%); }
          100% { transform: translateX(0); }
        }
      ` }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-start", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: `text-base font-medium font-orbitron ${notification.read ? "text-white/70" : "text-white"}`, children: notification.title }),
              !isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-2 text-sm text-white/60 line-clamp-2", children: notification.description })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 ml-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/40", children: formattedDate }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  animate: { rotate: isExpanded ? 180 : 0 },
                  transition: { duration: 0.3 },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-4 h-4 text-white/60" })
                }
              )
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { height: 0, opacity: 0 },
              animate: { height: "auto", opacity: 1 },
              exit: { height: 0, opacity: 0 },
              transition: { duration: 0.4, ease: "easeInOut" },
              className: "overflow-hidden mt-4",
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-[16px] bg-[#0a0a0a]/50", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-medium text-white/80 mb-2 font-orbitron", children: "Contenuto completo" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm leading-relaxed whitespace-pre-wrap", children: notification.description })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-[16px] bg-[#0a0a0a]/30", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-medium text-white/60 font-orbitron", children: "Data completa" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/80 mt-1", children: fullFormattedDate })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-[16px] bg-[#0a0a0a]/30", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-medium text-white/60 font-orbitron", children: "Stato" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2 mt-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `text-sm ${notification.read ? "text-green-400" : "text-yellow-400"}`, children: notification.read ? "Letta" : "Non letta" }),
                      !notification.read && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-yellow-400 rounded-full animate-pulse" })
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between pt-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center space-x-2", children: !notification.read && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "button",
                    {
                      onClick: (e) => {
                        e.stopPropagation();
                        onSelect();
                      },
                      className: "px-4 py-2 bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white rounded-full text-xs hover:shadow-lg transition-all font-orbitron",
                      children: "Segna come letta"
                    }
                  ) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "button",
                    {
                      onClick: handleDelete,
                      className: "p-2 rounded-full hover:bg-white/10 transition-colors",
                      title: "Elimina notifica",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { size: 16, className: "text-red-400 hover:text-red-300" })
                    }
                  )
                ] })
              ] })
            }
          ) })
        ] })
      ]
    }
  );
};

const NotificationDialog = ({ notification, open, onClose }) => {
  if (!notification) return null;
  const formattedDate = formatDistanceToNow(new Date(notification.date), {
    addSuffix: true,
    locale: it$2
  });
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "max-w-md bg-black border border-[#00D1FF]/30 rounded-[24px] shadow-[0_0_20px_rgba(0,209,255,0.2)]", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(DialogHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-lg font-bold text-[#00D1FF]", style: { textShadow: "0 0 5px rgba(0, 209, 255, 0.3)" }, children: notification.title }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/90 text-base leading-relaxed", children: notification.description }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-[#00D1FF]/60 mt-4", children: formattedDate })
    ] })
  ] }) });
};

const SWIPE_THRESHOLD = 64;
const NotificationsBanner = ({
  open,
  notifications,
  unreadCount,
  onClose,
  onMarkAllAsRead,
  onDeleteNotification
}) => {
  const bannerRef = reactExports.useRef(null);
  const dragging = reactExports.useRef(false);
  const initialY = reactExports.useRef(null);
  const [selectedNotification, setSelectedNotification] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const banner = bannerRef.current;
    function handleTouchStart(e) {
      initialY.current = e.touches[0].clientY;
      dragging.current = true;
    }
    function handleTouchMove(e) {
      if (!dragging.current || initialY.current == null) return;
      const dist = initialY.current - e.touches[0].clientY;
      if (dist > SWIPE_THRESHOLD) {
        onClose();
        dragging.current = false;
        initialY.current = null;
      }
    }
    function handleTouchEnd() {
      dragging.current = false;
      initialY.current = null;
    }
    function handleMouseDown(e) {
      initialY.current = e.clientY;
      dragging.current = true;
    }
    function handleMouseMove(e) {
      if (!dragging.current || initialY.current == null) return;
      const dist = initialY.current - e.clientY;
      if (dist > SWIPE_THRESHOLD) {
        onClose();
        dragging.current = false;
        initialY.current = null;
      }
    }
    function handleMouseUp() {
      dragging.current = false;
      initialY.current = null;
    }
    if (banner && open) {
      banner.addEventListener("touchstart", handleTouchStart, { passive: true });
      banner.addEventListener("touchmove", handleTouchMove, { passive: true });
      banner.addEventListener("touchend", handleTouchEnd);
      banner.addEventListener("mousedown", handleMouseDown);
      window.addEventListener("mousemove", handleMouseMove);
      window.addEventListener("mouseup", handleMouseUp);
    }
    return () => {
      if (banner) {
        banner.removeEventListener("touchstart", handleTouchStart);
        banner.removeEventListener("touchmove", handleTouchMove);
        banner.removeEventListener("touchend", handleTouchEnd);
        banner.removeEventListener("mousedown", handleMouseDown);
      }
      window.removeEventListener("mousemove", handleMouseMove);
      window.removeEventListener("mouseup", handleMouseUp);
    };
  }, [open, onClose]);
  const handleSelectNotification = (notification) => {
    setSelectedNotification(notification);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      ref: bannerRef,
      className: `fixed left-0 right-0 z-[9999] flex justify-center transition-all duration-500 cursor-grab select-none ${open ? "translate-y-0 opacity-100" : "-translate-y-32 opacity-0 pointer-events-none"}`,
      style: {
        top: "env(safe-area-inset-top, 0px)",
        transitionProperty: "transform, opacity"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative w-full max-w-lg mx-auto bg-black/95 backdrop-blur-xl border border-m1ssion-blue rounded-b-2xl shadow-2xl mt-2 px-4 py-4 animate-fade-in", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center mb-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5 text-m1ssion-blue mr-2" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold text-lg flex-1", children: "Notifiche" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                className: "text-m1ssion-blue hover:text-m1ssion-pink rounded-full p-1 ml-2 border border-m1ssion-blue hover:bg-m1ssion-blue/20 transition-colors",
                onClick: onClose,
                "aria-label": "Chiudi",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-5 h-5" })
              }
            )
          ] }),
          notifications.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-4 text-muted-foreground", children: "Non hai notifiche." }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-h-60 overflow-y-auto space-y-2 pr-1 custom-scrollbar", children: notifications.map((notification) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            NotificationItem,
            {
              notification,
              onSelect: () => handleSelectNotification(notification),
              onDelete: () => onDeleteNotification(notification.id)
            },
            notification.id
          )) }),
          notifications.length > 0 && unreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mt-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: onMarkAllAsRead,
              className: "text-xs px-3 py-1 rounded-lg border border-m1ssion-blue hover:bg-m1ssion-blue/10 transition active:scale-95",
              children: "Segna tutte come lette"
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 text-xs text-muted-foreground text-center", children: [
            "Chiudi con ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("b", { children: "Swipe Up" }),
            " su mobile/tablet o trascina con il mouse."
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          NotificationDialog,
          {
            notification: selectedNotification,
            open: !!selectedNotification,
            onClose: () => setSelectedNotification(null)
          }
        )
      ]
    }
  );
};

const DeveloperAccess = () => {
  React$1.useEffect(() => {
    console.log("🔄 Developer access redirecting to standard login");
    window.location.href = "/login";
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white text-lg mb-4", children: "Reindirizzamento al login..." }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/60 text-sm", children: "Sistema di login unificato attivo" })
  ] }) });
};

const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
function useDeepLinkQR() {
  const [, setLocation] = useLocation();
  reactExports.useEffect(() => {
    try {
      const sp = new URLSearchParams(window.location.search);
      const raw = sp.get("qr")?.trim();
      if (!raw) return;
      const go = async () => {
        let code = raw;
        if (UUID_RE.test(raw)) {
          const { data, error } = await supabase.from("qr_codes").select("code").eq("id", raw).maybeSingle();
          if (error) {
            console.warn("[useDeepLinkQR] UUID lookup error", error);
            return;
          }
          if (!data?.code) return;
          code = data.code;
        }
        code = code.toUpperCase();
        setLocation(`/map`);
        const url = new URL(window.location.href);
        url.searchParams.delete("qr");
        window.history.replaceState({}, document.title, url.toString());
      };
      go();
    } catch (e) {
      console.warn("[useDeepLinkQR] init error", e);
    }
  }, [setLocation]);
}

const useM1UnitsRealtime = (userId) => {
  const [unitsData, setUnitsData] = reactExports.useState(null);
  const [connectionState, setConnectionState] = reactExports.useState("INIT");
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const [heartbeatTimer, setHeartbeatTimer] = reactExports.useState(null);
  const fetchUnits = reactExports.useCallback(async () => {
    if (!userId) {
      setIsLoading(false);
      return;
    }
    try {
      setIsLoading(true);
      setError(null);
      const { data: profile, error: fetchError } = await supabase.from("profiles").select("id, m1_units, updated_at").eq("id", userId).single();
      if (fetchError) {
        throw new Error(fetchError.message || "Failed to fetch M1U from profiles");
      }
      if (profile) {
        setUnitsData({
          user_id: profile.id,
          balance: profile.m1_units || 0,
          total_earned: 0,
          // Not tracked in profiles
          total_spent: 0,
          // Not tracked in profiles
          updated_at: profile.updated_at || (/* @__PURE__ */ new Date()).toISOString()
        });
      }
    } catch (err) {
      const errorMsg = err instanceof Error ? err.message : "Unknown error";
      setError(errorMsg);
      setConnectionState("ERROR");
    } finally {
      setIsLoading(false);
    }
  }, [userId]);
  const ping = reactExports.useCallback(async () => {
    if (!userId) return;
    try {
      const { error: updateError } = await supabase.from("profiles").update({ updated_at: (/* @__PURE__ */ new Date()).toISOString() }).eq("id", userId);
      if (updateError) throw updateError;
      setConnectionState("HEARTBEAT");
      setTimeout(() => {
        setConnectionState("SUBSCRIBED");
      }, 2e3);
    } catch (err) {
      const errorMsg = err instanceof Error ? err.message : "Ping failed";
      setError(errorMsg);
      setConnectionState("ERROR");
    }
  }, [userId]);
  reactExports.useEffect(() => {
    if (!userId) return;
    fetchUnits();
    setConnectionState("CONNECTING");
    const channelName = `m1_units_user_${userId}`;
    const channel = supabase.channel(channelName).on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "profiles",
        filter: `id=eq.${userId}`
      },
      async (payload) => {
        await fetchUnits();
        setConnectionState("HEARTBEAT");
        setTimeout(() => {
          setConnectionState("SUBSCRIBED");
        }, 1e3);
      }
    ).subscribe((status) => {
      if (status === "SUBSCRIBED") {
        setConnectionState("SUBSCRIBED");
        emitSubscribed(channelName);
        const timer = setInterval(() => {
          setConnectionState((prev) => prev === "SUBSCRIBED" ? "SUBSCRIBED" : prev);
        }, 3e4);
        setHeartbeatTimer(timer);
      } else if (status === "CHANNEL_ERROR" || status === "TIMED_OUT") {
        setConnectionState("ERROR");
        emitError(String(status), channelName);
      } else if (status === "CLOSED") {
        setConnectionState("CLOSED");
      }
    });
    return () => {
      if (heartbeatTimer) {
        clearInterval(heartbeatTimer);
      }
      channel.unsubscribe();
      setConnectionState("INIT");
    };
  }, [userId, fetchUnits]);
  return {
    unitsData,
    connectionState,
    isLoading,
    error,
    ping,
    refetch: fetchUnits
  };
};

let stripePromise$2;
function getStripe() {
  if (!stripePromise$2) {
    const pk = "pk_test_51QJWtNRp5StPxareRp0GNVD9BT0auKQ8LEeezlPROQcwiDQ6nGOd0UihU5Y9fjJFD3naTwx3YsHoPPzlJ5Alk4pD00FhZM6lyZ";
    if (!pk.startsWith("pk_live_")) {
      console.warn("⚠️ VITE_STRIPE_PUBLISHABLE_KEY is not a LIVE key:", pk.substring(0, 10) + "...");
    }
    console.debug("🔑 Using Stripe publishable key:", pk.substring(0, 10) + "...");
    stripePromise$2 = loadStripe(pk);
  }
  return stripePromise$2;
}

let cachedPromise = null;
function resolvePublishableKey() {
  try {
    const envPk = import.meta?.env?.VITE_STRIPE_PUBLISHABLE_KEY;
    if (envPk && typeof envPk === "string" && envPk.startsWith("pk_")) return envPk;
  } catch (_) {
  }
  const w = typeof window !== "undefined" ? window : void 0;
  if (w?.__STRIPE_PK__ && typeof w.__STRIPE_PK__ === "string") return w.__STRIPE_PK__;
  if (w?.ENV?.VITE_STRIPE_PUBLISHABLE_KEY && typeof w.ENV.VITE_STRIPE_PUBLISHABLE_KEY === "string") {
    return w.ENV.VITE_STRIPE_PUBLISHABLE_KEY;
  }
  return null;
}
async function getStripeSafe() {
  try {
    return await getStripe();
  } catch (err) {
    console.warn("[StripeFallback] core getStripe failed, attempting fallback:", err);
  }
  if (!cachedPromise) {
    const pk = resolvePublishableKey();
    if (!pk) {
      console.warn("[StripeFallback] No publishable key detected. Returning null.");
      cachedPromise = Promise.resolve(null);
    } else {
      cachedPromise = loadStripe(pk);
    }
  }
  return cachedPromise;
}
try {
  const w = typeof window !== "undefined" ? window : void 0;
  if (w && typeof w.getStripe !== "function") {
    w.getStripe = getStripeSafe;
    w.__getStripeSafe = getStripeSafe;
  }
} catch (_) {
}

const stripeFallback = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  getStripeSafe
}, Symbol.toStringTag, { value: 'Module' }));

const stripePromise$1 = getStripeSafe();
const CheckoutForm$1 = ({ packName, packCode, m1uAmount, priceCents, onSuccess, onCancel }) => {
  const stripe = useStripe();
  const elements = useElements();
  const [loading, setLoading] = reactExports.useState(false);
  const [clientSecret, setClientSecret] = reactExports.useState("");
  const { user } = useAuthContext();
  reactExports.useEffect(() => {
    if (!user) return;
    const createPaymentIntent = async () => {
      try {
        console.log("[M1U MODAL] Creating payment intent:", {
          packCode,
          packName,
          m1uAmount,
          priceCents
        });
        const { data, error } = await supabase.functions.invoke("create-payment-intent", {
          body: {
            amount: priceCents,
            // Already in cents
            currency: "eur",
            payment_type: "m1u_purchase",
            plan: packCode,
            description: `M1 UNITS™ ${packName} - ${m1uAmount} M1U`,
            metadata: {
              pack_code: packCode,
              pack_name: packName,
              m1u_amount: m1uAmount,
              user_email: user.email
            }
          }
        });
        if (error) {
          console.error("[M1U MODAL] Payment intent error:", error);
          ue$1.error(`Errore: ${error.message || "Creazione pagamento fallita"}`);
          return;
        }
        const clientSecretValue = data?.client_secret || data?.clientSecret;
        if (clientSecretValue) {
          setClientSecret(clientSecretValue);
          console.log("[M1U MODAL] ✅ Payment intent created:", data?.paymentIntentId || data?.payment_intent_id);
        } else {
          console.error("[M1U MODAL] No client secret received:", data);
          ue$1.error("Errore nella configurazione del pagamento");
        }
      } catch (error) {
        console.error("[M1U MODAL] Payment intent failed:", error);
        ue$1.error("Errore nel sistema di pagamento");
      }
    };
    createPaymentIntent();
  }, [user, packCode, packName, m1uAmount, priceCents]);
  const handleSubmit = async (event) => {
    event.preventDefault();
    if (!stripe || !elements || !clientSecret) {
      ue$1.error("Sistema di pagamento non pronto");
      return;
    }
    setLoading(true);
    const cardElement = elements.getElement(CardElement);
    if (!cardElement) {
      ue$1.error("Elemento carta non trovato");
      setLoading(false);
      return;
    }
    try {
      console.log("[M1U MODAL] Confirming payment...");
      const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
        payment_method: {
          card: cardElement,
          billing_details: {
            email: user?.email || ""
          }
        }
      });
      if (error) {
        console.error("[M1U MODAL] Payment failed:", error);
        ue$1.error(`Pagamento fallito: ${error.message || "Errore sconosciuto"}`);
      } else if (paymentIntent.status === "succeeded") {
        console.log("[M1U MODAL] ✅ Payment succeeded:", paymentIntent.id);
        ue$1.success("Pagamento completato!", {
          description: `${m1uAmount} M1U aggiunti al tuo account`
        });
        window.dispatchEvent(new CustomEvent("m1uPurchaseSucceeded", {
          detail: {
            paymentIntentId: paymentIntent.id,
            packCode,
            m1uAmount
          }
        }));
        onSuccess();
      }
    } catch (error) {
      console.error("[M1U MODAL] Payment processing error:", error);
      ue$1.error("Errore nel processare il pagamento");
    } finally {
      setLoading(false);
    }
  };
  const cardElementOptions = {
    style: {
      base: {
        fontSize: "16px",
        color: "#ffffff",
        "::placeholder": {
          color: "#aab7c4"
        },
        backgroundColor: "transparent"
      },
      invalid: {
        color: "#fa755a",
        iconColor: "#fa755a"
      }
    },
    hidePostalCode: true
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "w-full max-w-md mx-auto bg-black/95 border-[#00D1FF]/30 backdrop-blur-xl", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "border-b border-white/10", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(ShoppingCart, { className: "w-5 h-5 text-[#00D1FF]" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-white font-orbitron", children: packName })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "icon",
            onClick: onCancel,
            disabled: loading,
            className: "h-8 w-8 rounded-full hover:bg-white/10",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-4 h-4" })
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mt-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-3xl font-bold text-white mb-1", children: [
          m1uAmount,
          " ",
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF] text-lg", children: "M1U" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-2xl font-semibold text-[#FFD700]", children: [
          "€",
          (priceCents / 100).toFixed(2)
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4 pt-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 bg-white/5 rounded-lg border border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardElement, { options: cardElementOptions }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: "outline",
              onClick: onCancel,
              className: "flex-1 border-white/20 hover:bg-white/10",
              disabled: loading,
              children: "Annulla"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "submit",
              disabled: !stripe || loading || !clientSecret,
              className: "flex-1 bg-gradient-to-r from-[#00D1FF] to-[#7C3AED] hover:opacity-90 text-white font-semibold",
              children: loading ? /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" }),
                "Elaborazione..."
              ] }) : `Paga €${(priceCents / 100).toFixed(2)}`
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/50 text-center pt-2 border-t border-white/10", children: "🔒 Pagamento sicuro elaborato da Stripe" })
    ] })
  ] });
};
const M1UPaymentModal = ({
  isOpen,
  packName,
  packCode,
  m1uAmount,
  priceEur,
  priceCents,
  onSuccess,
  onCancel
}) => {
  reactExports.useEffect(() => {
    if (!isOpen) return;
    const handleEsc = (event) => {
      if (event.key === "Escape") {
        console.log("[M1U MODAL] ESC pressed - closing modal");
        onCancel();
      }
    };
    window.addEventListener("keydown", handleEsc);
    return () => window.removeEventListener("keydown", handleEsc);
  }, [isOpen, onCancel]);
  if (!isOpen) return null;
  const options = {
    appearance: {
      theme: "night",
      variables: {
        colorPrimary: "#00D1FF",
        colorBackground: "#000000",
        colorText: "#ffffff",
        colorDanger: "#ef4444",
        fontFamily: "system-ui, sans-serif",
        spacingUnit: "4px",
        borderRadius: "8px"
      }
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: "fixed inset-0 bg-black/95 backdrop-blur-sm flex items-center justify-center p-4 z-[10000] overflow-y-auto",
      style: {
        paddingTop: "calc(env(safe-area-inset-top, 20px) + 20px)",
        paddingBottom: "calc(env(safe-area-inset-bottom, 20px) + 20px)",
        maxHeight: "100dvh"
      },
      onClick: (e) => {
        if (e.target === e.currentTarget) {
          console.log("[M1U MODAL] Backdrop clicked - closing modal");
          onCancel();
        }
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(Elements, { stripe: stripePromise$1, options, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        CheckoutForm$1,
        {
          packName,
          packCode,
          m1uAmount,
          priceCents,
          onSuccess,
          onCancel
        }
      ) })
    }
  );
};

const M1U_PACKS = [
  {
    id: "starter",
    name: "Starter Pack",
    code: "M1U_STARTER",
    m1u_total: 50,
    euro: 4.99,
    savePct: 0,
    icon: Sparkles,
    gradient: "from-[#00D1FF]/20 to-[#A855F7]/20"
  },
  {
    id: "agent",
    name: "Agent Pack",
    code: "M1U_AGENT",
    m1u_total: 110,
    euro: 9.99,
    savePct: 9,
    icon: Zap,
    gradient: "from-[#00D1FF]/25 to-[#A855F7]/25"
  },
  {
    id: "elite",
    name: "Elite Pack",
    code: "M1U_ELITE",
    m1u_total: 250,
    euro: 19.99,
    savePct: 20,
    icon: Star,
    gradient: "from-[#00D1FF]/30 to-[#A855F7]/30"
  },
  {
    id: "commander",
    name: "Commander Pack",
    code: "M1U_COMMANDER",
    m1u_total: 550,
    euro: 39.99,
    savePct: 27,
    icon: Crown,
    gradient: "from-[#00D1FF]/30 to-[#A855F7]/30"
  },
  {
    id: "director",
    name: "Director Pack",
    code: "M1U_DIRECTOR",
    m1u_total: 1200,
    euro: 79.99,
    savePct: 33,
    icon: Gem,
    gradient: "from-[#00D1FF]/35 to-[#A855F7]/35"
  },
  {
    id: "mcp",
    name: "Master Control",
    code: "M1U_MASTER",
    m1u_total: 3e3,
    euro: 199.99,
    savePct: 33,
    icon: Crown,
    gradient: "from-[#00D1FF]/40 to-[#A855F7]/40"
  }
];
const M1UnitsShopModal = ({ isOpen, onClose }) => {
  const [selectedPack, setSelectedPack] = reactExports.useState(null);
  const [showPaymentModal, setShowPaymentModal] = reactExports.useState(false);
  const handlePurchase = (pack) => {
    console.log("[M1U SHOP] Opening payment modal for:", {
      packCode: pack.code,
      packName: pack.name,
      priceEUR: pack.euro,
      priceCents: Math.round(pack.euro * 100),
      m1u: pack.m1u_total
    });
    if (typeof window !== "undefined" && window.plausible) {
      window.plausible("checkout_start", { props: { pack: pack.id } });
    }
    setSelectedPack(pack);
    setShowPaymentModal(true);
  };
  const handlePaymentSuccess = () => {
    console.log("[M1U SHOP] Payment successful for:", selectedPack?.code);
    setShowPaymentModal(false);
    setSelectedPack(null);
    onClose();
    ue$1.success("M1U acquistati con successo!", {
      description: `${selectedPack?.m1u_total} M1U sono stati aggiunti al tuo account`
    });
  };
  const handlePaymentCancel = () => {
    console.log("[M1U SHOP] Payment cancelled");
    setShowPaymentModal(false);
    setSelectedPack(null);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      DialogContent,
      {
        "aria-label": "M1 UNITS Shop",
        className: "sm:max-w-5xl w-[calc(100vw-2rem)] max-h-[85vh] overflow-y-auto p-0 bg-transparent border-0",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative rounded-2xl p-[1.5px] bg-gradient-to-r from-[#00D1FF] via-[#7C3AED] to-[#00D1FF] shadow-[0_0_30px_rgba(124,58,237,0.35)]", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "rounded-2xl bg-black/90 backdrop-blur-xl border border-white/10 p-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: onClose,
              "aria-label": "Close",
              className: "absolute top-4 right-4 z-10 w-11 h-11 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 border border-white/20 hover:border-white/30 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#00D1FF]/50",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-5 h-5 text-white" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-2xl font-orbitron text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "bg-gradient-to-r from-[#00D1FF] to-[#7C3AED] bg-clip-text text-transparent", children: "M1 UNITS™ SHOP" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(DialogDescription, { className: "text-center text-white/70", children: "Acquista pacchetti M1U per sbloccare indizi e funzionalità premium" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 my-6", children: M1U_PACKS.map((pack, index) => {
            const Icon = pack.icon;
            selectedPack?.id === pack.id && showPaymentModal;
            return /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                initial: { opacity: 0, y: 20 },
                animate: { opacity: 1, y: 0 },
                transition: { delay: index * 0.05 },
                className: "relative",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `group relative h-full rounded-xl border border-white/10 bg-gradient-to-br ${pack.gradient} p-[1px] hover:border-white/20 transition-all`, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "rounded-xl bg-black/80 backdrop-blur-xl p-5 h-full", children: [
                  pack.savePct > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute -top-2 -right-2 px-2 py-1 rounded-full text-xs font-bold text-white bg-emerald-500 shadow-[0_0_12px_rgba(16,185,129,0.6)]", children: [
                    "-",
                    pack.savePct,
                    "%"
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-14 h-14 rounded-full mx-auto mb-4 flex items-center justify-center bg-gradient-to-br from-[#00D1FF] to-[#7C3AED] shadow-[0_10px_30px_rgba(124,58,237,0.35)]", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "w-7 h-7 text-white" }) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-orbitron font-bold text-center text-white mb-2", children: pack.name }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-4", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-3xl font-extrabold text-white mb-1", children: [
                      pack.m1u_total,
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/70 ml-1", children: "M1U" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-semibold text-[#FFD700]", children: [
                      "€",
                      pack.euro.toFixed(2)
                    ] }),
                    pack.savePct > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-emerald-400 mt-1", children: [
                      "Risparmi ",
                      pack.savePct,
                      "%"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => handlePurchase(pack),
                      disabled: showPaymentModal,
                      className: "w-full rounded-lg bg-gradient-to-r from-[#00D1FF] to-[#7C3AED] text-white font-semibold hover:opacity-90 transition-opacity",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(ShoppingCart, { className: "w-4 h-4" }),
                        "Acquista"
                      ] })
                    }
                  )
                ] }) })
              },
              pack.id
            );
          }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center text-xs text-white/50 mt-4 pb-2", children: "Pagamento sicuro tramite Stripe • M1U non scadono mai" })
        ] }) })
      }
    ) }),
    selectedPack && /* @__PURE__ */ jsxRuntimeExports.jsx(
      M1UPaymentModal,
      {
        isOpen: showPaymentModal,
        packName: selectedPack.name,
        packCode: selectedPack.code,
        m1uAmount: selectedPack.m1u_total,
        priceEur: selectedPack.euro,
        priceCents: Math.round(selectedPack.euro * 100),
        onSuccess: handlePaymentSuccess,
        onCancel: handlePaymentCancel
      }
    )
  ] });
};

const M1UPill$1 = ({
  className = "",
  showLabel = true,
  showPlusButton = true
}) => {
  const [userId, setUserId] = reactExports.useState(void 0);
  const [pulseAnimation, setPulseAnimation] = reactExports.useState(false);
  const [prevBalance, setPrevBalance] = reactExports.useState(null);
  const [showShopModal, setShowShopModal] = reactExports.useState(false);
  const [displayedBalance, setDisplayedBalance] = reactExports.useState(0);
  const [isAnimating, setIsAnimating] = reactExports.useState(false);
  const animationRef = React$1.useRef(null);
  reactExports.useEffect(() => {
    const getUser = async () => {
      const { data } = await supabase.auth.getUser();
      if (data.user) {
        setUserId(data.user.id);
      }
    };
    getUser();
  }, []);
  const { unitsData, isLoading, error, refetch } = useM1UnitsRealtime(userId);
  const animateBalance = (startValue, endValue, duration = 2e3) => {
    if (animationRef.current) {
      cancelAnimationFrame(animationRef.current);
    }
    const startTime = performance.now();
    const difference = endValue - startValue;
    setIsAnimating(true);
    setPulseAnimation(true);
    const animate = (currentTime) => {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const easeOutQuart = 1 - Math.pow(1 - progress, 4);
      const currentValue = Math.round(startValue + difference * easeOutQuart);
      setDisplayedBalance(currentValue);
      if (progress < 1) {
        animationRef.current = requestAnimationFrame(animate);
      } else {
        setDisplayedBalance(endValue);
        setIsAnimating(false);
        setPulseAnimation(false);
        animationRef.current = null;
      }
    };
    animationRef.current = requestAnimationFrame(animate);
  };
  reactExports.useEffect(() => {
    const handleRefresh = () => {
      console.log("💰 M1UPill: Event received, refetching balance...");
      refetch();
    };
    const handleM1USpent = (event) => {
      const amount = event.detail?.amount || 0;
      const newBalance = event.detail?.newBalance;
      console.log("💸 M1UPill: M1U spent event!", { amount, newBalance });
      if (newBalance !== void 0) {
        setDisplayedBalance(newBalance);
        setPrevBalance(newBalance);
      }
      setTimeout(() => refetch(), 300);
    };
    window.addEventListener("buzzAreaCreated", handleRefresh);
    window.addEventListener("buzzClueCreated", handleRefresh);
    window.addEventListener("m1u-spent", handleM1USpent);
    window.addEventListener("m1u-balance-changed", handleRefresh);
    return () => {
      window.removeEventListener("buzzAreaCreated", handleRefresh);
      window.removeEventListener("buzzClueCreated", handleRefresh);
      window.removeEventListener("m1u-spent", handleM1USpent);
      window.removeEventListener("m1u-balance-changed", handleRefresh);
    };
  }, [refetch]);
  reactExports.useEffect(() => {
    const handleM1UCredited = (event) => {
      const amount = event.detail?.amount || 0;
      console.log("💰 M1UPill: M1U credited event received!", amount);
      const currentDisplayed = displayedBalance;
      const newBalance = currentDisplayed + amount;
      setTimeout(() => refetch(), 100);
      animateBalance(currentDisplayed, newBalance, 2500);
      ue$1.success(`💰 +${amount} M1U!`, {
        description: "Guarda i tuoi crediti salire! 🎰",
        duration: 3e3
      });
    };
    window.addEventListener("m1u-credited", handleM1UCredited);
    return () => {
      window.removeEventListener("m1u-credited", handleM1UCredited);
    };
  }, [refetch, displayedBalance]);
  reactExports.useEffect(() => {
    if (unitsData?.balance !== void 0 && !isAnimating) {
      if (displayedBalance !== unitsData.balance) {
        console.log("💰 M1UPill: Syncing balance", { displayed: displayedBalance, actual: unitsData.balance });
        setDisplayedBalance(unitsData.balance);
      }
    }
  }, [unitsData?.balance, isAnimating, displayedBalance]);
  reactExports.useEffect(() => {
    if (unitsData?.balance !== void 0 && prevBalance !== null && unitsData.balance !== prevBalance) {
      if (!isAnimating && Math.abs(unitsData.balance - prevBalance) >= 5) {
        animateBalance(prevBalance, unitsData.balance, 1500);
      }
    }
    if (unitsData?.balance !== void 0) {
      setPrevBalance(unitsData.balance);
    }
  }, [unitsData?.balance, prevBalance, isAnimating]);
  reactExports.useEffect(() => {
    return () => {
      if (animationRef.current) {
        cancelAnimationFrame(animationRef.current);
      }
    };
  }, []);
  const balance = unitsData?.balance ?? 0;
  const lowBalance = balance < 100;
  const handleOpenRecharge = () => {
    setShowShopModal(true);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `flex items-center gap-3 relative ${className}`, children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          className: "m1u-pill-main flex items-center gap-2 px-4 py-2 rounded-full cursor-pointer",
          style: {
            background: "radial-gradient(120% 120% at 50% 10%, rgba(255,255,255,.08), rgba(0,0,0,.2) 58%)",
            border: "1px solid rgba(255, 255, 255, 0.18)",
            boxShadow: "0 2px 12px rgba(0,0,0,.35), 0 0 20px rgba(255, 215, 0, 0.12) inset",
            backdropFilter: "blur(12px)",
            minHeight: 40
          },
          whileHover: { scale: 1.02 },
          whileTap: { scale: 0.98 },
          onClick: handleOpenRecharge,
          animate: pulseAnimation ? { scale: [1, 1.05, 1] } : {},
          transition: { duration: 0.3 },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold",
                style: {
                  background: "linear-gradient(135deg, #FFD700 0%, #FFA500 100%)",
                  color: "#1a1a1a",
                  boxShadow: "0 0 8px rgba(255, 215, 0, 0.6)"
                },
                animate: pulseAnimation ? { rotate: [0, 10, -10, 0] } : {},
                children: "M1"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "animate-pulse text-sm font-orbitron text-white opacity-60",
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                exit: { opacity: 0 },
                children: "…"
              },
              "loading"
            ) : error ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "flex items-center gap-1 text-sm font-orbitron text-red-500",
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                exit: { opacity: 0 },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-3 h-3" }),
                  " ERR"
                ]
              },
              "error"
            ) : /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "flex items-center gap-1.5",
                initial: { opacity: 0, y: -10 },
                animate: { opacity: 1, y: 0 },
                exit: { opacity: 0, y: 10 },
                children: [
                  showLabel && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold text-white/90 font-orbitron", children: "M1U" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "span",
                    {
                      className: `text-sm font-bold font-orbitron tracking-wide transition-all ${isAnimating ? "text-[#FFD700] scale-110 drop-shadow-[0_0_8px_rgba(255,215,0,0.8)]" : "text-white"}`,
                      style: {
                        textShadow: isAnimating ? "0 0 10px rgba(255, 215, 0, 0.9)" : "none"
                      },
                      children: displayedBalance.toLocaleString("it-IT")
                    }
                  ),
                  isAnimating && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.span,
                    {
                      initial: { opacity: 0, scale: 0 },
                      animate: { opacity: [0, 1, 0], scale: [0.5, 1.2, 0.5] },
                      transition: { duration: 0.5, repeat: Infinity },
                      className: "text-yellow-400 text-xs",
                      children: "✨"
                    }
                  )
                ]
              },
              "balance"
            ) }),
            lowBalance && !isLoading && !error && /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full",
                style: { boxShadow: "0 0 8px rgba(239,68,68,0.8)" }
              }
            )
          ]
        }
      ),
      showPlusButton && /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.button,
        {
          className: "pill-orb",
          "aria-label": "Add M1U",
          whileHover: { scale: 1.03 },
          whileTap: { scale: 0.97 },
          onClick: () => {
            handleOpenRecharge();
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 text-cyan-100" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "dot" })
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      M1UnitsShopModal,
      {
        isOpen: showShopModal,
        onClose: () => setShowShopModal(false)
      }
    )
  ] });
};

const M1UPill$2 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: M1UPill$1
}, Symbol.toStringTag, { value: 'Module' }));

const AppHome = () => {
  const [error, setError] = reactExports.useState(null);
  const [isLoaded, setIsLoaded] = reactExports.useState(false);
  useProfileImage();
  const isMobile = useIsMobile();
  const [hasAccess, setHasAccess] = reactExports.useState(false);
  const [isCapacitor, setIsCapacitor] = reactExports.useState(false);
  const { hasRole, user, isAuthenticated, isLoading, getCurrentUser } = useUnifiedAuth();
  const [, navigate] = useLocation();
  const {
    notifications,
    unreadCount,
    markAllAsRead,
    deleteNotification,
    notificationsBannerOpen,
    closeNotificationsBanner
  } = useNotificationManager();
  const { isConnected } = useRealTimeNotifications();
  useDeepLinkQR();
  reactExports.useEffect(() => {
    const checkAccess = () => {
      const isCapacitorApp = !!window.Capacitor;
      setIsCapacitor(isCapacitorApp);
      setHasAccess(true);
    };
    checkAccess();
  }, []);
  reactExports.useEffect(() => {
    const timer = setTimeout(() => {
      setIsLoaded(true);
    }, 300);
    return () => clearTimeout(timer);
  }, []);
  reactExports.useEffect(() => {
  }, [isConnected]);
  reactExports.useEffect(() => {
    if (error) {
      ue$1.error("Si è verificato un errore", {
        description: error,
        position: "bottom-center"
      });
    }
  }, [error]);
  if (!isAuthenticated || isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" });
  }
  if (!user) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-[#070818]", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 border-t-2 border-cyan-400 rounded-full animate-spin mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Inizializzazione utente..." })
    ] }) });
  }
  const isAdmin = hasRole("admin");
  const isDeveloper = hasRole("developer");
  const showPanelButton = isAdmin || isDeveloper;
  if (isMobile && !hasAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(DeveloperAccess, {});
  }
  if (error) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex min-h-screen items-center justify-center bg-[#070818] px-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-8 bg-red-800/30 rounded-xl text-center w-full max-w-sm glass-card", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl sm:text-2xl font-bold mb-4 text-red-300", children: "Errore" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80", children: error }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.button,
        {
          onClick: () => window.location.reload(),
          className: "mt-6 px-6 py-2 bg-gradient-to-r from-red-600 to-red-700 rounded-full text-white btn-hover-effect",
          whileHover: { scale: 1.03 },
          whileTap: { scale: 0.97 },
          children: "Riprova"
        }
      )
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen m1-app-bg relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "m1-grain" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION™ - Home App" }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-4 space-y-6 relative z-10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isLoaded && /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "relative min-h-screen overflow-y-auto",
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        transition: { duration: 0.5 },
        children: [
          notificationsBannerOpen && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, y: -20 },
              animate: { opacity: 1, y: 0 },
              exit: { opacity: 0, y: -20 },
              transition: { duration: 0.3 },
              className: "fixed inset-x-0 z-40 px-2 md:px-4",
              style: {
                top: "calc(72px + 47px + env(safe-area-inset-top, 0px))"
              },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                NotificationsBanner,
                {
                  notifications,
                  open: notificationsBannerOpen,
                  unreadCount,
                  onClose: closeNotificationsBanner,
                  onMarkAllAsRead: markAllAsRead,
                  onDeleteNotification: deleteNotification
                }
              )
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto px-3 pb-20", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                className: "relative my-4 sm:my-6",
                initial: { opacity: 0, y: -10 },
                animate: { opacity: 1, y: 0 },
                transition: { delay: 0.2, duration: 0.5 },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    "div",
                    {
                      id: "m1u-pill-home-slot",
                      className: "flex flex-wrap items-center gap-2 mb-3 justify-center sm:justify-start",
                      style: {
                        pointerEvents: "auto"
                      },
                      "aria-hidden": false,
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(M1UPill$1, { showLabel: true, showPlusButton: true }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(AgentEnergyPill, {})
                      ]
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    "h1",
                    {
                      id: "m1-home-title",
                      "data-m1-anchor": "home-title",
                      className: "text-3xl sm:text-4xl font-orbitron font-bold neon-text-cyan text-center",
                      role: "banner",
                      "aria-label": "M1SSION Centro di Comando Agente",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-auroraCyan", children: "M1" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
                          "SSION",
                          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" })
                        ] })
                      ]
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "div",
                    {
                      id: "mission-status-badge-portal",
                      "data-anchor": "m1-header-badge",
                      "data-persistent": "true",
                      className: "flex justify-center my-2 sm:my-3"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 mt-1 sm:mt-2 text-center text-sm sm:text-base", children: "Centro di Comando Agente" })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "main",
              {
                id: "main-content",
                className: "max-w-screen-xl mx-auto",
                role: "main",
                "aria-label": "Contenuto principale",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CommandCenterHome, {}) }),
                  showPanelButton && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      initial: { opacity: 0, y: 20 },
                      animate: { opacity: 1, y: 0 },
                      transition: { delay: 0.8, duration: 0.6 },
                      className: "mt-4",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        motion.button,
                        {
                          onClick: () => navigate("/panel-access"),
                          className: "w-full glass-card p-4 border border-[#4361ee]/30 bg-gradient-to-r from-[#4361ee]/10 to-[#7209b7]/10 rounded-xl group relative overflow-hidden",
                          whileHover: {
                            scale: 1.02,
                            borderColor: "rgba(67, 97, 238, 0.6)"
                          },
                          whileTap: { scale: 0.98 },
                          children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 rounded-xl border border-[#4361ee]/50 animate-pulse group-hover:border-[#4361ee]/80 transition-colors" }),
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative flex items-center justify-center gap-3", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Cpu, { className: "w-5 h-5 text-white" }) }),
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-left", children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-orbitron font-bold", children: [
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#4361ee]", children: "M1SSION" }),
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: " PANEL" }),
                                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top text-[#7209b7]", children: "™" })
                                ] }),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Centro AI Generativo - Accesso Test" })
                              ] }),
                              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "ml-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 rounded-full bg-green-400 animate-pulse" }) })
                            ] }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 rounded-xl bg-gradient-to-r from-[#4361ee]/0 via-[#4361ee]/5 to-[#7209b7]/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300" })
                          ]
                        }
                      )
                    }
                  )
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "fixed bottom-24 left-0 right-0 h-32 pointer-events-none z-[9]",
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              transition: { delay: 0.5, duration: 0.8 },
              style: {
                background: `
                    radial-gradient(ellipse at 50% 100%, rgba(0, 209, 255, 0.18), transparent 70%),
                    radial-gradient(ellipse at 20% 100%, rgba(123, 92, 255, 0.15), transparent 60%),
                    radial-gradient(ellipse at 80% 100%, rgba(240, 89, 255, 0.12), transparent 65%)
                  `,
                filter: "blur(20px)"
              }
            }
          )
        ]
      }
    ) }) })
  ] });
};

const MapTiler3D = React$1.lazy(() => __vitePreload(() => import('./MapTiler3D.BXeIrYtB.js'),true?__vite__mapDeps([4,3,2,5,1,6,7,8,9,10]):void 0));
const LivingMap3D = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-[#070818]", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "inline-block animate-spin rounded-full h-12 w-12 border-4 border-[rgba(0,209,255,0.3)] border-t-[rgba(0,209,255,1)] mb-4" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[rgba(0,209,255,0.9)] text-lg", children: "Loading 3D Map..." })
  ] }) }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(MapTiler3D, {}) });
};

const DEBUG_BUZZ = undefined                                    === "1";
const dlog = (...args) => {
};
function useBuzzApi() {
  const handleBuzzPress = async ({ userId, mode, generateMap, coordinates, prizeId, sessionId }) => {
    try {
      if (!userId) {
        console.error("UserId mancante nella chiamata API");
        return { success: false, error: true, errorMessage: "Devi effettuare l'accesso per utilizzare questa funzione" };
      }
      const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
      if (!uuidRegex.test(userId)) {
        console.error(`UserID non valido: ${userId}`);
        return { success: false, error: true, errorMessage: "ID utente non valido" };
      }
      const functionName = generateMap ? "buzz-map-resolve-v2" : "handle-buzz-press";
      const payload = {};
      if (functionName === "buzz-map-resolve-v2") {
        if (!coordinates) {
          console.error("❌ buzz-map-resolve requires coordinates");
          return { success: false, error: true, errorMessage: "Coordinate mancanti per BUZZ MAP" };
        }
        payload.lat = coordinates.lat;
        payload.lng = coordinates.lng;
        if (DEBUG_BUZZ) ;
        console.log(`🗺️ BUZZ MAP RESOLVE payload:`, payload);
      } else {
        payload.userId = userId;
        payload.generateMap = generateMap;
        if (mode) {
          payload.mode = mode;
        }
        if (generateMap && coordinates) {
          payload.coordinates = coordinates;
          console.log(`🗺️ BUZZ API Call with generateMap=true and coordinates:`, coordinates);
        }
        if (prizeId) payload.prizeId = prizeId;
        if (sessionId) payload.sessionId = sessionId;
        console.log(`🎯 HANDLE-BUZZ-PRESS payload:`, payload);
      }
      dlog("📡 [DBG] PAYLOAD", {
        functionName,
        generateMap: payload.generateMap,
        hasLat: "lat" in payload,
        hasLng: "lng" in payload,
        hasCoordinates: "coordinates" in payload
      });
      const { data: sessionData, error: sessionError } = await supabase.auth.getSession();
      const jwt = sessionData?.session?.access_token || "";
      console.debug("BUZZ_MAP_FRONTEND_AUTH", {
        hasSession: !!sessionData?.session,
        hasJwt: !!jwt,
        jwtPrefix: jwt ? jwt.substring(0, 20) : "none",
        jwtLength: jwt.length,
        userId: sessionData?.session?.user?.id,
        sessionError: sessionError?.message
      });
      console.log("🔐 SESSION CHECK:", {
        hasSession: !!sessionData?.session,
        hasUser: !!sessionData?.session?.user,
        userId: sessionData?.session?.user?.id,
        sessionError: sessionError?.message,
        hasToken: !!jwt
      });
      if (!jwt) {
        console.error("❌ No active session or access token found");
        return { success: false, error: true, errorMessage: "Sessione non valida. Effettua l'accesso nuovamente." };
      }
      console.log(`🔐 Calling ${functionName} via direct fetch with explicit JWT...`);
      console.log(`📡 User ID: ${sessionData.session.user.id}`);
      console.log(`🔑 JWT Length: ${jwt.length}, Prefix: ${jwt.substring(0, 20)}`);
      const supabaseUrl = supabase.supabaseUrl || "https://vkjrqirvdvjbemsfzxof.supabase.co";
      const functionUrl = `${supabaseUrl}/functions/v1/${functionName}`;
      console.log(`📡 Function URL: ${functionUrl}`);
      console.log(`📦 Payload:`, JSON.stringify(payload));
      const response = await fetch(functionUrl, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${jwt}`,
          "apikey": supabase.supabaseKey
        },
        body: JSON.stringify(payload)
      });
      console.log(`📡 Response status: ${response.status}`);
      let data = null;
      let error = null;
      if (!response.ok) {
        const errorText = await response.text();
        console.error(`❌ Edge function error (${response.status}):`, errorText);
        error = {
          message: `Edge function returned ${response.status}: ${errorText}`,
          status: response.status
        };
      } else {
        data = await response.json();
      }
      console.log("🚨 EDGE FUNCTION CALL RESULT:", {
        hasData: !!data,
        hasError: !!error,
        dataSuccess: data?.success,
        dataError: data?.error,
        errorMessage: error?.message,
        fullData: data,
        fullError: error
      });
      dlog("🛰️ [DBG] EDGE RESP", {
        ok: !!data?.success,
        mode: data?.mode,
        hasAreaId: !!data?.area_id,
        level: data?.level,
        radius_km: data?.radius_km
      });
      if (DEBUG_BUZZ && data?.mode === "map" && !data?.area_id) ;
      if (generateMap && data?.success && data?.mode === "map" && !data?.area_id) {
        console.error("⚠️ Edge returned MAP success but missing area_id (server error)", { data });
        return {
          success: false,
          error: true,
          errorMessage: "Errore server: area non creata correttamente"
        };
      }
      if (error) {
        console.warn("⚠️ EDGE FUNCTION ERROR:", error);
        if (error.message?.includes("daily_quota_exceeded") || error.message?.includes("429")) {
          ue$1.error("Hai raggiunto il limite giornaliero di 5 BUZZ. Riprova dopo mezzanotte.");
          return { success: false, error: true, errorMessage: "Limite giornaliero raggiunto. Riprova dopo mezzanotte." };
        }
        if (error.details?.includes("daily_quota_exceeded") || error.code === "daily_quota_exceeded") {
          ue$1.error("Hai raggiunto il limite giornaliero di 5 BUZZ. Riprova dopo mezzanotte.");
          return { success: false, error: true, errorMessage: "Limite giornaliero raggiunto. Riprova dopo mezzanotte." };
        }
        console.warn("BUZZ edge function error:", error.message);
        ue$1.error("Operazione non riuscita, riprova fra poco.");
        return { success: false, error: true, errorMessage: "Operazione non riuscita, riprova fra poco." };
      }
      if (data?.success) {
        console.log(`✅ ${functionName} success:`, data);
        if (data.mode === "buzz") {
          if (data.clue?.text) {
            ue$1.success(data.clue.text, {
              duration: 5e3,
              position: "top-center",
              style: {
                zIndex: 9999,
                background: "linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)",
                color: "white",
                fontWeight: "bold"
              }
            });
          } else {
            ue$1.success("Indizio ricevuto!");
          }
        } else if (data.mode === "map") {
          if (data.area) {
            console.log("🗺️ Area generata:", data.area);
            ue$1.success("Area di ricerca creata!", {
              duration: 4e3,
              style: {
                background: "linear-gradient(135deg, #9333EA 0%, #EF4444 100%)",
                color: "white",
                fontWeight: "bold"
              }
            });
          } else {
            ue$1.error("Area non generata, riprova tra poco.");
            return { success: false, error: true, errorMessage: "Area non generata" };
          }
        } else {
          ue$1.success("BUZZ processed successfully");
        }
        return {
          success: true,
          clue_text: data.clue?.text || data.clue_text,
          // Backward compat
          buzz_cost: data.buzz_cost,
          radius_km: data.area?.radius_km || data.radius_km,
          lat: data.area?.center_lat || data.lat,
          lng: data.area?.center_lng || data.lng,
          area_id: data.area?.id || data.area_id,
          generation_number: data.generation_number,
          map_area: data.map_area,
          precision: data.precision,
          canGenerateMap: data.canGenerateMap,
          remainingMapGenerations: data.remainingMapGenerations
        };
      }
      if (!data) {
        console.error("❌ EDGE FUNCTION RETURNED NULL DATA");
        ue$1.error("Operazione non riuscita. Riprova tra poco.");
        return { success: false, error: true, errorMessage: "Operazione non riuscita. Riprova tra poco." };
      }
      if (!data.success) {
        console.error("❌ EDGE FUNCTION RETURNED FAILURE:", data?.error || "Unknown error");
        if (data?.code === "daily_quota_exceeded") {
          ue$1.error("Hai raggiunto il limite giornaliero di 5 BUZZ. Riprova dopo mezzanotte.");
          return {
            success: false,
            error: true,
            errorMessage: "Limite giornaliero raggiunto. Riprova dopo mezzanotte."
          };
        }
        if (data?.code === "payment_required") {
          ue$1.error("Pagamento richiesto per utilizzare BUZZ MAPPA.");
          return {
            success: false,
            error: true,
            errorMessage: "Pagamento richiesto per utilizzare BUZZ MAPPA."
          };
        }
        ue$1.error("Operazione non riuscita. Riprova tra poco.");
        return {
          success: false,
          error: true,
          errorMessage: "Operazione non riuscita. Riprova tra poco."
        };
      }
      console.log("✅ Backend response (unified):", data);
      return {
        success: true,
        clue_text: data.clue?.text || data.clue_text,
        // Backward compat
        buzz_cost: data.buzz_cost,
        radius_km: data.area?.radius_km || data.radius_km,
        lat: data.area?.center_lat || data.lat,
        lng: data.area?.center_lng || data.lng,
        area_id: data.area?.id || data.area_id,
        generation_number: data.generation_number,
        map_area: data.map_area,
        precision: data.precision,
        canGenerateMap: data.canGenerateMap,
        remainingMapGenerations: data.remainingMapGenerations
      };
    } catch (error) {
      console.error("Errore generale nella chiamata API buzz:", error);
      ue$1.error("Operazione non riuscita. Riprova tra poco.");
      return { success: false, error: true, errorMessage: "Operazione non riuscita. Riprova tra poco." };
    }
  };
  return { callBuzzApi: handleBuzzPress };
}

function useAbuseProtection() {
  const checkAbuseAndLog = async (userId) => {
    try {
      const { data: abuseData } = await supabase.from("abuse_logs").select("*").eq("user_id", userId).eq("event_type", "buzz_press").gte("timestamp", new Date(Date.now() - 3e4).toISOString());
      if (abuseData && abuseData.length >= 5) {
        return {
          isBlocked: true,
          message: "Troppi tentativi. Riprova tra qualche secondo."
        };
      }
      await supabase.from("abuse_logs").insert({
        user_id: userId,
        event_type: "buzz_press"
      });
      return { isBlocked: false };
    } catch (error) {
      console.error("Error in abuse protection:", error);
      return { isBlocked: false };
    }
  };
  return { checkAbuseAndLog };
}

const useBuzzNotificationScheduler = () => {
  const scheduleBuzzNotification = reactExports.useCallback(async (buzzType, cooldownHours = 3) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        console.error("❌ No authenticated user for notification scheduling");
        return false;
      }
      const scheduledTime = /* @__PURE__ */ new Date();
      scheduledTime.setHours(scheduledTime.getHours() + cooldownHours);
      console.log(`📅 Scheduling ${buzzType} notification for ${scheduledTime.toISOString()}`);
      const { error } = await supabase.functions.invoke("schedule-buzz-notification", {
        body: {
          user_id: user.id,
          buzz_type: buzzType,
          scheduled_time: scheduledTime.toISOString()
        }
      });
      if (error) {
        console.error("❌ Failed to schedule notification:", error);
        return false;
      }
      const notificationText = buzzType === "buzz_mappa" ? "BUZZ MAPPA™" : "BUZZ";
      console.log(`✅ ${notificationText} notification scheduled successfully`);
      ue$1.success(`🔔 Notifica programmata`, {
        description: `Riceverai un avviso quando ${notificationText} sarà disponibile tra ${cooldownHours} ore`,
        duration: 4e3
      });
      return true;
    } catch (error) {
      console.error("❌ Error scheduling buzz notification:", error);
      return false;
    }
  }, []);
  const scheduleBuzzMappaNotification = reactExports.useCallback(() => {
    return scheduleBuzzNotification("buzz_mappa", 3);
  }, [scheduleBuzzNotification]);
  const scheduleBuzzAvailableNotification = reactExports.useCallback(() => {
    return scheduleBuzzNotification("buzz", 3);
  }, [scheduleBuzzNotification]);
  return {
    scheduleBuzzNotification,
    scheduleBuzzMappaNotification,
    scheduleBuzzAvailableNotification
  };
};

const __buzz$1 = globalThis.__buzzToastLock ?? { shown: false, t: 0 };
globalThis.__buzzToastLock = __buzz$1;
function buzzToastOnce(fn, msg, opts) {
  const now = Date.now();
  if (!__buzz$1.shown || now - __buzz$1.t > 2e3) {
    __buzz$1.shown = true;
    __buzz$1.t = now;
    ue$1[fn]?.(msg, opts);
    setTimeout(() => {
      __buzz$1.shown = false;
    }, 2e3);
  }
}
function useBuzzHandler({ currentPrice, onSuccess, hasFreeBuzz = false, context }) {
  const [buzzing, setBuzzing] = reactExports.useState(false);
  const [showShockwave, setShowShockwave] = reactExports.useState(false);
  const { user } = useAuth();
  const { triggerHaptic } = usePWAHardwareStub();
  const { checkAbuseAndLog } = useAbuseProtection();
  const { scheduleBuzzAvailableNotification } = useBuzzNotificationScheduler();
  const { callBuzzApi } = useBuzzApi();
  const handleBuzz = async () => {
    console.log("🚀 BUZZ PRESSED - Start handleBuzz - RESET COMPLETO 17/07/2025", {
      user: !!user,
      currentPrice,
      context,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    });
    if (context?.skipServerBuzzPress) {
      console.log("🔇 M1SSION™ SKIP BUZZ API: Post-payment context detected, server call already handled");
      return;
    }
    if (!user) {
      console.log("❌ BUZZ FAILED - Missing user");
      ue$1.error("Devi essere loggato per utilizzare BUZZ!");
      return;
    }
    let hadError = false;
    let buzzToastShown = false;
    try {
      setBuzzing(true);
      setShowShockwave(true);
      await triggerHaptic("buzzUnlocked");
      console.log("💰 BUZZ PRICE CHECK - FIXED", { currentPrice, hasFreeBuzz });
      console.log("💰 PROGRESSIVE PRICING: Current price M1U" + currentPrice + " for usage level");
      if (!hasFreeBuzz && (currentPrice < 0 || isNaN(currentPrice))) {
        console.error("❌ BUZZ: Invalid price detected", { currentPrice, hasFreeBuzz });
        ue$1.error("Errore nel calcolo del prezzo BUZZ");
        return;
      }
      const abuseResult = await checkAbuseAndLog(user.id);
      if (abuseResult.isBlocked) {
        ue$1.error(abuseResult.message);
        return;
      }
      console.log("💳 BUZZ: Payment already processed by BuzzActionButton - proceeding to API - RESET COMPLETO 17/07/2025");
      console.log("🚨 CALLING BUZZ API AFTER PAYMENT...");
      const buzzResult = await callBuzzApi({
        userId: user.id,
        generateMap: false,
        // Regular BUZZ, not map
        coordinates: null,
        prizeId: null,
        sessionId: `buzz_${Date.now()}`
      });
      console.log("✅ BUZZ API CALL COMPLETED");
      console.log("🚨 POST-BUZZ API CALL:", {
        success: buzzResult?.success,
        error: buzzResult?.error,
        errorMessage: buzzResult?.errorMessage,
        hasClueText: !!buzzResult?.clue_text,
        clueTextPreview: buzzResult?.clue_text?.substring(0, 50)
      });
      if (!buzzResult) {
        hadError = true;
        console.error("❌ BUZZ API: No response received (network/CORS error)");
        ue$1.dismiss();
        ue$1.error("Errore di connessione. Verifica la tua connessione e riprova.");
        return;
      }
      if (buzzResult.error && !buzzResult.clue_text) {
        hadError = true;
        console.error("❌ BUZZ API Error:", buzzResult.errorMessage);
        ue$1.dismiss();
        ue$1.error(buzzResult.errorMessage || "Errore di rete. Riprova.");
        return;
      }
      if (!buzzResult.success && !buzzResult.clue_text) {
        hadError = true;
        console.error("❌ BUZZ FAILED - API returned success:false without clue");
        ue$1.dismiss();
        ue$1.error(buzzResult.errorMessage || "Errore durante BUZZ");
        return;
      }
      if (buzzResult.clue_text) {
        console.log("✅ BUZZ SUCCESS - Clue received:", buzzResult.clue_text.substring(0, 50) + "...");
        buzzToastOnce("success", buzzResult.clue_text, {
          duration: 6e3,
          position: "top-center",
          style: {
            background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
            color: "white",
            border: "2px solid rgba(255,255,255,0.3)",
            fontSize: "16px",
            fontWeight: "bold",
            padding: "16px"
          }
        });
        buzzToastShown = true;
      } else {
        hadError = true;
        console.error("❌ BUZZ FAILED - No clue_text in response");
        ue$1.dismiss();
        ue$1.error("Non sono riuscito a generare l'indizio, riprova fra poco.");
        return;
      }
      console.log("📊 Logging buzz action to database...", {
        userId: user.id,
        costM1U: currentPrice,
        clueCount: 1
      });
      await supabase.from("buzz_map_actions").insert({
        user_id: user.id,
        cost_m1u: currentPrice,
        // 🔥 FIX: Use cost_m1u instead of cost_eur
        clue_count: 1,
        radius_generated: 0
        // Regular BUZZ has no radius
      });
      onSuccess();
      console.log("📅 Scheduling BUZZ cooldown notification...");
      await scheduleBuzzAvailableNotification();
      setTimeout(() => {
        setShowShockwave(false);
      }, 1500);
    } catch (err) {
      console.error("❌ Error in handleBuzz - RESET COMPLETO 17/07/2025:", err);
      hadError = true;
    } finally {
      setBuzzing(false);
      try {
        const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1e3).toISOString();
        const { data, error } = await supabase.from("user_notifications").select("id,type,title,message,metadata,created_at,is_deleted").eq("user_id", user.id).in("type", ["buzz", "buzz_free"]).is("is_deleted", false).order("created_at", { ascending: false }).limit(1).maybeSingle();
        const isDataFresh = data && new Date(data.created_at).getTime() >= Date.now() - 10 * 60 * 1e3;
        console.info({
          step: "buzz-toast",
          hadError,
          buzzToastShown,
          dataExists: !!data,
          isDataFresh,
          error
        });
        if (isDataFresh && data?.message && !buzzToastShown) {
          await triggerHaptic("success");
          buzzToastOnce("success", data.message, {
            duration: 4e3,
            position: "top-center",
            style: {
              background: "linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)"
            }
          });
        } else if (hadError && !buzzToastShown) {
          await triggerHaptic("error");
          buzzToastOnce("error", "Non sono riuscito a generare l'indizio, riprova fra poco.");
        }
        if (!data) {
          console.info("No fresh notification in last 10 minutes");
        }
      } catch (toastError) {
        console.error("Error fetching toast notification:", toastError);
        if (hadError && !buzzToastShown) {
          ue$1.error("Errore imprevisto durante BUZZ");
        }
      }
    }
  };
  return {
    buzzing,
    showShockwave,
    handleBuzz
  };
}

const TronBuzzSkin = ({
  priceDisplay,
  isLoading = false,
  isBlocked = false
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "tron-disc", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "tron-disc-rotating", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `tron-led-ring ${isLoading ? "loading" : ""}` }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-disc-dots" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-disc-dots-sides" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-disc-content", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-loading-spinner" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold text-white/80", style: {
        fontFamily: "Orbitron, sans-serif",
        letterSpacing: "0.1em"
      }, children: "PROCESSING" })
    ] }) : isBlocked ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "svg",
        {
          className: "w-12 h-12 text-white/60",
          fill: "none",
          stroke: "currentColor",
          viewBox: "0 0 24 24",
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "path",
            {
              strokeLinecap: "round",
              strokeLinejoin: "round",
              strokeWidth: 2,
              d: "M12 15v2m0 0v2m0-2h2m-2 0H10m8-6a6 6 0 11-12 0 6 6 0 0112 0z"
            }
          )
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold text-white/60", style: {
        fontFamily: "Orbitron, sans-serif",
        letterSpacing: "0.1em"
      }, children: "BLOCKED" })
    ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "tron-price", children: priceDisplay }) })
  ] });
};

const BuzzButton = ({
  currentPrice,
  isBlocked,
  buzzing,
  onClick
  // All buzz actions are now paid
}) => {
  useXpSystem();
  const priceDisplay = `${currentPrice} M1U`;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.button,
    {
      whileTap: { scale: 0.97 },
      disabled: isBlocked || buzzing,
      onClick,
      className: "relative border-0 bg-transparent p-0 z-20",
      style: {
        cursor: isBlocked || buzzing ? "not-allowed" : "pointer"
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        TronBuzzSkin,
        {
          priceDisplay,
          isLoading: buzzing,
          isBlocked
        }
      )
    }
  );
};

const ShockwaveAnimation = ({ show }) => {
  if (!show) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      className: "absolute w-48 h-48 rounded-full border-4 border-[#F213A4]",
      initial: { scale: 0, opacity: 0.8 },
      animate: { scale: 3.5, opacity: 0 },
      transition: { duration: 0.8, ease: "easeOut" },
      style: {
        zIndex: 10,
        borderWidth: "3px",
        filter: "blur(0.5px)",
        borderColor: "#F213A4"
      }
    },
    Date.now()
  );
};

const BUZZ_PRICING_TIERS = [
  // Click 1-10: €1.99 ciascuno
  { minClick: 1, maxClick: 10, priceEur: 1.99, priceCents: 199 },
  // Click 11-20: €3.99 ciascuno  
  { minClick: 11, maxClick: 20, priceEur: 3.99, priceCents: 399 },
  // Click 21-30: €5.99 ciascuno
  { minClick: 21, maxClick: 30, priceEur: 5.99, priceCents: 599 },
  // Click 31-40: €7.99 ciascuno
  { minClick: 31, maxClick: 40, priceEur: 7.99, priceCents: 799 },
  // Click 41-50: €9.99 ciascuno
  { minClick: 41, maxClick: 50, priceEur: 9.99, priceCents: 999 },
  // Click 51+: €10.99 ciascuno
  { minClick: 51, maxClick: 9999, priceEur: 10.99, priceCents: 1099 }
];
const calculateBuzzPrice = (dailyClickCount) => {
  const nextClick = dailyClickCount + 1;
  const tier = BUZZ_PRICING_TIERS.find(
    (tier2) => nextClick >= tier2.minClick && nextClick <= tier2.maxClick
  );
  if (!tier) {
    const highestTier = BUZZ_PRICING_TIERS[BUZZ_PRICING_TIERS.length - 1];
    return {
      priceEur: highestTier.priceEur,
      priceCents: highestTier.priceCents
    };
  }
  return {
    priceEur: tier.priceEur,
    priceCents: tier.priceCents
  };
};
const getBuzzDisplayPrice = (dailyClickCount) => {
  const { priceEur } = calculateBuzzPrice(dailyClickCount);
  return `€${priceEur.toFixed(2)}`;
};
const getBuzzPriceCents = (dailyClickCount) => {
  const { priceCents } = calculateBuzzPrice(dailyClickCount);
  return priceCents;
};

const BUZZ_M1U_COST = [
  // Click 1-10: €1.99 → 20 M1U
  { minClick: 1, maxClick: 10, m1u: 20 },
  // Click 11-20: €3.99 → 40 M1U  
  { minClick: 11, maxClick: 20, m1u: 40 },
  // Click 21-30: €5.99 → 60 M1U
  { minClick: 21, maxClick: 30, m1u: 60 },
  // Click 31-40: €7.99 → 80 M1U
  { minClick: 31, maxClick: 40, m1u: 80 },
  // Click 41-50: €9.99 → 100 M1U
  { minClick: 41, maxClick: 50, m1u: 100 },
  // Click 51+: €10.99 → 110 M1U
  { minClick: 51, maxClick: 9999, m1u: 110 }
];
const calculateBuzzCostM1U = (dailyClickCount) => {
  const nextClick = dailyClickCount + 1;
  const tier = BUZZ_M1U_COST.find(
    (tier2) => nextClick >= tier2.minClick && nextClick <= tier2.maxClick
  );
  if (!tier) {
    const highestTier = BUZZ_M1U_COST[BUZZ_M1U_COST.length - 1];
    return highestTier.m1u;
  }
  return tier.m1u;
};
const getBuzzDisplayCostM1U = (dailyClickCount) => {
  const costM1U = calculateBuzzCostM1U(dailyClickCount);
  return `${costM1U} M1U`;
};

const useBuzzCounter = (userId) => {
  const [dailyBuzzCounter, setDailyBuzzCounter] = reactExports.useState(0);
  const loadDailyBuzzCounter = reactExports.useCallback(async () => {
    if (!userId) {
      console.log("🔍 BUZZ COUNTER DEBUG: No userId, skipping load");
      return;
    }
    const todayDate = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
    console.log("🔍 BUZZ COUNTER DEBUG: Loading counter", { userId, todayDate });
    try {
      const { data, error } = await supabase.from("user_buzz_counter").select("buzz_count").eq("user_id", userId).eq("date", todayDate).maybeSingle();
      console.log("🔍 BUZZ COUNTER DEBUG: Query result", { data, error });
      if (error && error.code !== "PGRST116") {
        console.error("❌ BUZZ COUNTER ERROR: Failed to load", error);
        return;
      }
      const buzzCount = data?.buzz_count || 0;
      setDailyBuzzCounter(buzzCount);
      console.log("✅ BUZZ COUNTER: Loaded successfully", {
        buzzCount,
        nextClickPrice: calculateBuzzPrice(buzzCount),
        nextClickCostM1U: calculateBuzzCostM1U(buzzCount)
      });
    } catch (err) {
      console.error("❌ BUZZ COUNTER EXCEPTION:", err);
    }
  }, [userId]);
  const updateDailyBuzzCounter = reactExports.useCallback(async () => {
    if (!userId) return 0;
    const newBuzzCounter = dailyBuzzCounter + 1;
    console.log("🔄 BUZZ COUNTER: Updating counter", {
      oldCount: dailyBuzzCounter,
      newCount: newBuzzCounter,
      nextPrice: calculateBuzzPrice(newBuzzCounter),
      nextCostM1U: calculateBuzzCostM1U(newBuzzCounter)
    });
    try {
      await supabase.from("user_buzz_counter").upsert({
        user_id: userId,
        date: (/* @__PURE__ */ new Date()).toISOString().split("T")[0],
        buzz_count: newBuzzCounter
      }, { onConflict: "user_id,date" });
      setDailyBuzzCounter(newBuzzCounter);
      console.log("✅ BUZZ COUNTER: Updated successfully", { newBuzzCounter });
      setTimeout(() => loadDailyBuzzCounter(), 100);
      return newBuzzCounter;
    } catch (err) {
      console.error("❌ BUZZ COUNTER: Update failed", err);
      return dailyBuzzCounter;
    }
  }, [userId, dailyBuzzCounter, loadDailyBuzzCounter]);
  const getCurrentBuzzPrice = reactExports.useCallback(() => {
    return calculateBuzzPrice(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  const getCurrentBuzzDisplayPrice = reactExports.useCallback(() => {
    return getBuzzDisplayPrice(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  const getCurrentBuzzPriceCents = reactExports.useCallback(() => {
    return getBuzzPriceCents(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  const getCurrentBuzzCostM1U = reactExports.useCallback(() => {
    return calculateBuzzCostM1U(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  const getCurrentBuzzDisplayCostM1U = reactExports.useCallback(() => {
    return getBuzzDisplayCostM1U(dailyBuzzCounter);
  }, [dailyBuzzCounter]);
  reactExports.useEffect(() => {
    if (userId) {
      loadDailyBuzzCounter();
    }
  }, [userId, loadDailyBuzzCounter]);
  reactExports.useEffect(() => {
    console.log("📊 BUZZ COUNTER STATE UPDATE:", {
      dailyBuzzCounter,
      nextClickCostM1U: calculateBuzzCostM1U(dailyBuzzCounter),
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    });
  }, [dailyBuzzCounter]);
  return {
    dailyBuzzCounter,
    loadDailyBuzzCounter,
    updateDailyBuzzCounter,
    getCurrentBuzzPrice,
    getCurrentBuzzDisplayPrice,
    getCurrentBuzzPriceCents,
    // M1U functions
    getCurrentBuzzCostM1U,
    getCurrentBuzzDisplayCostM1U
  };
};

const useBuzzGrants = () => {
  const [grants, setGrants] = reactExports.useState([]);
  const [totalRemaining, setTotalRemaining] = reactExports.useState(0);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [error, setError] = reactExports.useState(null);
  const [dailyUsed, setDailyUsed] = reactExports.useState(false);
  const fetchGrants = async () => {
    setIsLoading(true);
    setError(null);
    try {
      const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
      const { data: todayBuzzUsage, error: buzzError } = await supabase.from("user_buzz_counter").select("*").eq("user_id", (await supabase.auth.getUser()).data.user?.id).eq("date", today).maybeSingle();
      if (todayBuzzUsage && todayBuzzUsage.buzz_count > 0) {
        setDailyUsed(true);
      } else {
        setDailyUsed(false);
      }
      const { data, error: error2 } = await supabase.from("buzz_grants").select("*").gt("remaining", 0).order("created_at", { ascending: false });
      if (error2) throw error2;
      setGrants(data || []);
      const total = (data || []).reduce((sum, grant) => sum + grant.remaining, 0);
      setTotalRemaining(total);
    } catch (err) {
      console.error("Error fetching buzz grants:", err);
      setError(err instanceof Error ? err.message : "Unknown error");
      setGrants([]);
      setTotalRemaining(0);
    } finally {
      setIsLoading(false);
    }
  };
  const consumeFreeBuzz = async () => {
    if (totalRemaining <= 0) {
      console.log("❌ No free buzz grants remaining");
      return false;
    }
    try {
      const userId = (await supabase.auth.getUser()).data.user?.id;
      if (!userId) {
        console.error("❌ No user ID found");
        return false;
      }
      const grantToUse = grants.find((g) => g.remaining > 0);
      if (!grantToUse) {
        console.log("❌ No grant found with remaining buzz");
        return false;
      }
      console.log("🎁 CONSUMING FREE BUZZ GRANT:", grantToUse.id, "Remaining:", grantToUse.remaining);
      const { error: error2 } = await supabase.from("buzz_grants").update({
        remaining: grantToUse.remaining - 1,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", grantToUse.id);
      if (error2) throw error2;
      const uniqueClue = `Cerca dove l'innovazione italiana splende (${(/* @__PURE__ */ new Date()).toLocaleTimeString()}) - FREE BUZZ`;
      const clueId = `free_buzz_${Date.now()}_${Math.random().toString(36).substring(7)}`;
      console.log("💾 SAVING FREE BUZZ CLUE TO DATABASE");
      const { error: clueError } = await supabase.from("user_clues").insert({
        user_id: userId,
        clue_id: clueId,
        // Required field!
        title_it: "🎁 Indizio BUZZ Gratuito",
        description_it: uniqueClue,
        clue_type: "buzz",
        buzz_cost: 0
      });
      if (clueError) {
        console.error("❌ Error saving free buzz clue:", clueError);
      } else {
        console.log("✅ FREE BUZZ CLUE SAVED TO DATABASE");
      }
      const { error: notifError } = await supabase.from("user_notifications").insert({
        user_id: userId,
        type: "buzz",
        title: "🎁 Nuovo Indizio BUZZ Gratuito!",
        message: uniqueClue,
        is_read: false,
        metadata: { free: true, source: "buzz_grant" }
      });
      if (notifError) {
        console.error("❌ Error saving free buzz notification:", notifError);
      } else {
        console.log("✅ FREE BUZZ NOTIFICATION SAVED");
      }
      const { error: statusUpdateError } = await supabase.from("user_mission_status").upsert({
        user_id: userId,
        clues_found: 1,
        mission_progress_percent: Math.round(1 / 200 * 100),
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      });
      if (statusUpdateError) {
        console.error("❌ Error triggering mission status update:", statusUpdateError);
      } else {
        console.log("✅ MISSION STATUS UPDATE TRIGGERED");
      }
      setDailyUsed(true);
      await fetchGrants();
      return true;
    } catch (err) {
      console.error("Error consuming free buzz:", err);
      return false;
    }
  };
  reactExports.useEffect(() => {
    fetchGrants();
  }, []);
  return {
    grants,
    totalRemaining,
    isLoading,
    error,
    fetchGrants,
    consumeFreeBuzz,
    hasFreeBuzz: totalRemaining > 0 && !dailyUsed,
    // 🔥 FIX: Check BOTH grants AND daily usage
    dailyUsed
  };
};

const soundCache = {};
const useSoundEffects$1 = () => {
  reactExports.useEffect(() => {
    const soundsToPreload = ["notification", "buzz", "chime", "arcade", "bell", "agentClick", "spacecraftIgnition", "discVortex"];
    soundsToPreload.forEach((sound) => {
      try {
        let path = `/sounds/${sound}.mp3`;
        if (sound === "buzz") {
          path = "/buzz-sound.mp3";
        }
        if (sound === "spacecraftIgnition") {
          path = "/audio/spacecraft-ignition.mp3";
        }
        if (sound === "discVortex") {
          path = "/audio/disc-vortex.mp3";
        }
        const audio = new Audio(path);
        audio.preload = "auto";
        soundCache[sound] = audio;
      } catch (error) {
        console.error(`Error preloading sound: ${sound}`, error);
      }
    });
    return () => {
    };
  }, []);
  const playSound = reactExports.useCallback((sound, volume = 0.5) => {
    try {
      let path = `/sounds/${sound}.mp3`;
      if (sound === "buzz") {
        path = "/buzz-sound.mp3";
      }
      if (sound === "spacecraftIgnition") {
        path = "/audio/spacecraft-ignition.mp3";
      }
      if (sound === "discVortex") {
        path = "/audio/disc-vortex.mp3";
      }
      let audio = soundCache[sound];
      if (!audio) {
        audio = new Audio(path);
        soundCache[sound] = audio;
      }
      audio.currentTime = 0;
      audio.volume = volume;
      const playPromise = audio.play();
      if (playPromise !== void 0) {
        playPromise.catch((error) => {
          console.error(`Error playing sound: ${sound}`, error);
        });
      }
    } catch (error) {
      console.error(`Error playing sound: ${sound}`, error);
      ue$1.error("Impossibile riprodurre il suono");
    }
  }, []);
  return { playSound };
};

const showInsufficientM1UToast = (required, current) => {
  ue$1.error(
    `Saldo M1U insufficiente`,
    {
      description: `Ti servono ${required} M1U, ma hai solo ${current} M1U. Acquista un pacchetto M1U per continuare.`,
      duration: 5e3,
      action: {
        label: "Acquista M1U",
        onClick: () => {
          window.dispatchEvent(new CustomEvent("open-m1u-shop"));
        }
      }
    }
  );
};
const showM1UDebitSuccessToast = (spent, newBalance) => {
  ue$1.success(
    `${spent} M1U spesi`,
    {
      description: `Nuovo saldo: ${newBalance} M1U`,
      duration: 3e3
    }
  );
};

const __buzz = globalThis.__buzzToastLock ?? { shown: false, t: 0 };
globalThis.__buzzToastLock = __buzz;
const BuzzActionButton = ({
  isBlocked,
  onSuccess,
  isWalkthroughMode = false
}) => {
  const { user } = useUnifiedAuth();
  const { hasFreeBuzz, consumeFreeBuzz, totalRemaining} = useBuzzGrants();
  const { playSound } = useSoundEffects$1();
  const { unitsData, refetch: refetchM1U } = useM1UnitsRealtime(user?.id);
  const {
    dailyBuzzCounter,
    getCurrentBuzzCostM1U,
    getCurrentBuzzDisplayCostM1U,
    updateDailyBuzzCounter
  } = useBuzzCounter(user?.id);
  const currentCostM1U = hasFreeBuzz ? 0 : getCurrentBuzzCostM1U();
  const currentPriceDisplay = hasFreeBuzz ? "GRATIS" : getCurrentBuzzDisplayCostM1U();
  React$1.useEffect(() => {
    console.log("💰 BUZZ BUTTON PRICE UPDATE:", {
      dailyBuzzCounter,
      hasFreeBuzz,
      currentCostM1U,
      currentPriceDisplay,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    });
  }, [dailyBuzzCounter, hasFreeBuzz, currentCostM1U, currentPriceDisplay]);
  const { buzzing, showShockwave, handleBuzz } = useBuzzHandler({
    currentPrice: currentCostM1U,
    // Use actual M1U cost for validation
    onSuccess,
    hasFreeBuzz
  });
  const processedFree = reactExports.useRef(false);
  const removeFreeQueryParams = () => {
    try {
      const url = new URL(window.location.href);
      url.searchParams.delete("free");
      url.searchParams.delete("reward");
      window.history.replaceState({}, "", url.pathname + (url.searchParams.toString() ? `?${url.searchParams.toString()}` : ""));
    } catch {
    }
  };
  const redeemFreeBuzz = async () => {
    if (!user) {
      ue$1.error("Devi essere loggato per usare il BUZZ gratuito");
      return;
    }
    try {
      const { data: consumed, error: consumeErr } = await supabase.rpc("consume_credit", {
        p_user_id: user.id,
        p_credit_type: "buzz",
        p_amount: 1
      });
      if (consumeErr || !consumed) {
        console.error("consume_credit error", consumeErr);
        ue$1.error("Nessun credito BUZZ disponibile");
        return;
      }
      const { data: hbps, error: hbpsErr } = await supabase.functions.invoke("handle-buzz-press", {
        body: {
          user_id: user.id,
          generateMap: false,
          metadata: { free: true, source: "qr_reward_or_xp_reward" }
        }
      });
      if (hbpsErr) {
        console.error("handle-buzz-press error", hbpsErr);
        ue$1.error("Errore durante l'uso del BUZZ gratuito");
        return;
      }
      if (hbps?.clue_text) {
        ue$1.success(hbps.clue_text, {
          duration: 4e3,
          position: "top-center",
          style: {
            zIndex: 9999,
            background: "linear-gradient(135deg, #F213A4 0%, #FF4D4D 100%)",
            color: "white",
            fontWeight: "bold"
          }
        });
      } else {
        ue$1.success("BUZZ gratuito utilizzato!");
      }
      await updateDailyBuzzCounter();
      onSuccess();
    } catch (e) {
      console.error("redeemFreeBuzz exception", e);
      ue$1.error("Errore durante il riscatto gratuito");
    } finally {
      removeFreeQueryParams();
    }
  };
  reactExports.useEffect(() => {
    if (processedFree.current) return;
    try {
      const params = new URLSearchParams(window.location.search);
      const isFree = params.get("free") === "1";
      if (isFree) {
        processedFree.current = true;
        redeemFreeBuzz();
      }
    } catch {
    }
  }, [user?.id]);
  const handleAction = async () => {
    playSound("spacecraftIgnition", 0.6);
    if (!user) {
      ue$1.error("Devi essere loggato per utilizzare BUZZ!");
      return;
    }
    if (isWalkthroughMode) {
      await handleBuzz();
      onSuccess();
      return;
    }
    if (hasFreeBuzz) {
      console.log("🎁 M1SSION™ FREE BUZZ: Using free grant", { remaining: totalRemaining });
      const consumed = await consumeFreeBuzz();
      if (consumed) {
        await handleBuzz();
        await updateDailyBuzzCounter();
        onSuccess();
        if (!__buzz.shown) {
          ue$1.success("BUZZ gratuito utilizzato!");
        }
        return;
      } else {
        console.error("🔴 M1SSION™ FREE BUZZ: Failed to consume grant");
        ue$1.error("Errore nell'uso del BUZZ gratuito");
        return;
      }
    }
    const costM1U = getCurrentBuzzCostM1U();
    const currentBalance = unitsData?.balance || 0;
    console.log("💎 M1SSION™ M1U BUZZ: Initiating M1U payment", {
      dailyCount: dailyBuzzCounter,
      nextClick: dailyBuzzCounter + 1,
      costM1U,
      currentBalance,
      userId: user.id,
      hasFreeBuzz,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    });
    if (currentBalance < costM1U) {
      console.warn("❌ M1SSION™ M1U BUZZ: Insufficient M1U balance", {
        required: costM1U,
        available: currentBalance
      });
      showInsufficientM1UToast(costM1U, currentBalance);
      return;
    }
    try {
      console.log("💳 M1SSION™ M1U BUZZ: Updating profiles.m1_units...", { costM1U, currentBalance });
      const { data: updatedProfile, error: updateError } = await supabase.from("profiles").update({
        m1_units: currentBalance - costM1U,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", user.id).select("m1_units").single();
      console.log("💳 M1SSION™ M1U BUZZ: Update response", { updatedProfile, updateError });
      if (updateError) {
        console.error("❌ M1SSION™ M1U BUZZ: Update error", updateError);
        ue$1.error("Errore nel processare il pagamento M1U");
        return;
      }
      if (!updatedProfile) {
        console.error("❌ M1SSION™ M1U BUZZ: No profile returned after update");
        ue$1.error("Errore nel processare il pagamento M1U");
        return;
      }
      const newBalance = updatedProfile.m1_units;
      console.log("✅ M1SSION™ M1U BUZZ: M1U debited successfully!", {
        spent: costM1U,
        oldBalance: currentBalance,
        newBalance,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
      showM1UDebitSuccessToast(costM1U, newBalance);
      await refetchM1U();
      console.log("🎯 M1SSION™ M1U BUZZ: Proceeding with BUZZ generation...");
      await handleBuzz();
      console.log("🔄 BEFORE UPDATE COUNTER:", {
        currentState: dailyBuzzCounter,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
      const newCount = await updateDailyBuzzCounter();
      console.log("✅ AFTER UPDATE COUNTER:", {
        newState: newCount,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
      onSuccess();
      console.log("🎉 M1SSION™ M1U BUZZ: Complete flow successful!");
      window.dispatchEvent(new CustomEvent("buzzClueCreated", {
        detail: { costM1U, newBalance: updatedProfile.m1_units }
      }));
    } catch (error) {
      console.error("❌ M1SSION™ M1U BUZZ: Exception during payment", error);
      ue$1.error("Errore durante il BUZZ. Riprova.");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative flex flex-col items-center space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      BuzzButton,
      {
        currentPrice: currentCostM1U,
        isBlocked,
        buzzing,
        onClick: handleAction
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(ShockwaveAnimation, { show: showShockwave })
  ] });
};

const BuzzRewardHandler = ({
  onRewardRedeemed
}) => {
  const { user } = useAuthContext();
  const processedRef = reactExports.useRef(false);
  const removeFreeQueryParams = () => {
    try {
      const url = new URL(window.location.href);
      url.searchParams.delete("free");
      url.searchParams.delete("reward");
      window.history.replaceState({}, "", url.pathname + (url.searchParams.toString() ? `?${url.searchParams.toString()}` : ""));
    } catch (e) {
      console.error("Error removing query params:", e);
    }
  };
  const redeemFreeBuzz = async () => {
    if (!user?.id) {
      ue$1.error("Devi essere loggato per usare il BUZZ gratuito");
      removeFreeQueryParams();
      return;
    }
    try {
      console.log("🎁 Riscatto BUZZ gratuito per user:", user.id);
      const { data: consumed, error: consumeErr } = await supabase.rpc("consume_credit", {
        p_user_id: user.id,
        p_credit_type: "buzz",
        p_amount: 1
      });
      if (consumeErr || !consumed) {
        console.error("consume_credit error", consumeErr);
        ue$1.error("Nessun credito BUZZ disponibile");
        removeFreeQueryParams();
        return;
      }
      ue$1.success("🎁 BUZZ gratuito riscattato! Ora puoi premere il pulsante BUZZ.", {
        duration: 5e3,
        position: "top-center",
        style: {
          zIndex: 9999,
          background: "linear-gradient(135deg, #00FFFF 0%, #0084FF 100%)",
          color: "white",
          fontWeight: "bold"
        }
      });
      if (onRewardRedeemed) {
        onRewardRedeemed();
      }
    } catch (e) {
      console.error("redeemFreeBuzz exception", e);
      ue$1.error("Errore durante il riscatto gratuito");
    } finally {
      removeFreeQueryParams();
    }
  };
  reactExports.useEffect(() => {
    if (processedRef.current) return;
    try {
      const params = new URLSearchParams(window.location.search);
      const isFree = params.get("free") === "1";
      const isReward = params.get("reward") === "1";
      if (isFree && isReward) {
        processedRef.current = true;
        console.log("🎁 Parametri free reward trovati, avvio riscatto...");
        redeemFreeBuzz();
      }
    } catch (e) {
      console.error("Error checking reward params:", e);
    }
  }, [user?.id]);
  return null;
};

const useBuzzStats = () => {
  const [stats, setStats] = reactExports.useState(null);
  const [history, setHistory] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(true);
  const { user } = useAuth();
  const loadBuzzStats = preserveFunctionName(async () => {
    if (!user) return;
    try {
      setLoading(true);
      const { data: todayData } = await supabase.from("user_buzz_counter").select("buzz_count").eq("user_id", user.id).eq("date", (/* @__PURE__ */ new Date()).toISOString().split("T")[0]).maybeSingle();
      const { data: totalData } = await supabase.from("user_buzz_counter").select("buzz_count").eq("user_id", user.id);
      const { data: mapActions } = await supabase.from("buzz_map_actions").select("*").eq("user_id", user.id).order("created_at", { ascending: false }).limit(10);
      const { data: areasData } = await supabase.from("user_map_areas").select("id").eq("user_id", user.id);
      const today_count = todayData?.buzz_count || 0;
      const total_count = totalData?.reduce((sum, day) => sum + day.buzz_count, 0) || 0;
      const areas_unlocked = areasData?.length || 0;
      const credits_spent = mapActions?.reduce((sum, action) => sum + Number(action.cost_eur), 0) || 0;
      setStats({
        today_count,
        total_count,
        areas_unlocked,
        credits_spent
      });
      setHistory(mapActions || []);
    } catch (err) {
      console.error("Error loading buzz stats:", err);
      ue$1.error("Errore nel caricamento statistiche BUZZ");
    } finally {
      setLoading(false);
    }
  });
  reactExports.useEffect(() => {
    loadBuzzStats();
  }, [user]);
  return {
    stats,
    history,
    loading,
    loadBuzzStats
  };
};

function createVortexSound() {
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const osc1 = audioContext.createOscillator();
  const osc2 = audioContext.createOscillator();
  const osc3 = audioContext.createOscillator();
  const gainNode1 = audioContext.createGain();
  const gainNode2 = audioContext.createGain();
  const gainNode3 = audioContext.createGain();
  const masterGain = audioContext.createGain();
  const filter = audioContext.createBiquadFilter();
  filter.type = "bandpass";
  filter.frequency.value = 1200;
  filter.Q.value = 0.8;
  osc1.type = "sine";
  osc1.frequency.value = 220;
  osc2.type = "sine";
  osc2.frequency.value = 330;
  osc3.type = "triangle";
  osc3.frequency.value = 110;
  gainNode1.gain.value = 0.15;
  gainNode2.gain.value = 0.1;
  gainNode3.gain.value = 0.08;
  masterGain.gain.value = 0.3;
  osc1.connect(gainNode1);
  osc2.connect(gainNode2);
  osc3.connect(gainNode3);
  gainNode1.connect(filter);
  gainNode2.connect(filter);
  gainNode3.connect(filter);
  filter.connect(masterGain);
  masterGain.connect(audioContext.destination);
  const lfo1 = audioContext.createOscillator();
  const lfo2 = audioContext.createOscillator();
  const lfoGain1 = audioContext.createGain();
  const lfoGain2 = audioContext.createGain();
  lfo1.frequency.value = 0.7;
  lfo2.frequency.value = 1.3;
  lfoGain1.gain.value = 15;
  lfoGain2.gain.value = 200;
  lfo1.connect(lfoGain1);
  lfoGain1.connect(osc1.frequency);
  lfo2.connect(lfoGain2);
  lfoGain2.connect(filter.frequency);
  let isPlaying = false;
  return {
    audioContext,
    start: () => {
      if (!isPlaying) {
        osc1.start();
        osc2.start();
        osc3.start();
        lfo1.start();
        lfo2.start();
        isPlaying = true;
      }
    },
    stop: () => {
      if (isPlaying) {
        masterGain.gain.exponentialRampToValueAtTime(
          1e-3,
          audioContext.currentTime + 0.3
        );
        setTimeout(() => {
          try {
            osc1.stop();
            osc2.stop();
            osc3.stop();
            lfo1.stop();
            lfo2.stop();
          } catch (e) {
          }
        }, 350);
        isPlaying = false;
      }
    },
    setVolume: (vol) => {
      masterGain.gain.value = Math.max(0, Math.min(1, vol));
    }
  };
}

const checkDebugFlag = () => {
  try {
    const envDebug = undefined                              === "1";
    if (typeof window !== "undefined") {
      const urlParams = new URLSearchParams(window.location.search);
      const urlDebug = urlParams.get("debug") === "1";
      const storageDebug = localStorage.getItem("M1_DEBUG_PANELS") === "1";
      const isEnabled = envDebug || urlDebug || storageDebug;
      if (isEnabled) {
        console.log("🧪 M1DEBUG: Debug panels ENABLED via", {
          env: envDebug,
          url: urlDebug,
          storage: storageDebug,
          currentUrl: window.location.href
        });
      } else {
        console.log("🧪 M1DEBUG: Debug panels DISABLED", {
          currentUrl: window.location.href,
          urlParams: window.location.search
        });
      }
      return isEnabled;
    }
    return envDebug;
  } catch (e) {
    console.warn("Debug flag check failed:", e);
    return false;
  }
};
const useDebugFlag = () => {
  const [enabled, setEnabled] = reactExports.useState(checkDebugFlag);
  reactExports.useEffect(() => {
    const isEnabled = checkDebugFlag();
    setEnabled(isEnabled);
  }, []);
  return enabled;
};

const CopyJsonButton = ({ data, label = "Copy" }) => {
  const [copied, setCopied] = React$1.useState(false);
  const handleCopy = () => {
    try {
      const json = JSON.stringify(data, null, 2);
      navigator.clipboard.writeText(json);
      setCopied(true);
      ue$1.success("JSON copiato negli appunti");
      setTimeout(() => setCopied(false), 2e3);
    } catch (e) {
      ue$1.error("Errore nella copia");
      console.error("Copy error:", e);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "button",
    {
      onClick: handleCopy,
      style: {
        padding: "4px 8px",
        fontSize: "11px",
        backgroundColor: copied ? "#10b981" : "#3b82f6",
        color: "white",
        border: "none",
        borderRadius: "4px",
        cursor: "pointer",
        display: "flex",
        alignItems: "center",
        gap: "4px"
      },
      children: [
        copied ? /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { size: 12 }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Copy, { size: 12 }),
        label
      ]
    }
  );
};

const DebugBuzzPanel = () => {
  const { user, session, isAuthenticated } = useUnifiedAuth();
  const { hasFreeBuzz, totalRemaining } = useBuzzGrants();
  const { getCurrentBuzzCostM1U } = useBuzzCounter(user?.id);
  const [collapsed, setCollapsed] = reactExports.useState(true);
  const [diagnostics, setDiagnostics] = reactExports.useState(null);
  const [lastResult, setLastResult] = reactExports.useState(null);
  const getJwtInfo = () => {
    if (!session?.access_token) return { len: 0, exp: null };
    try {
      const parts = session.access_token.split(".");
      if (parts.length !== 3) return { len: 0, exp: null };
      const payload = JSON.parse(atob(parts[1]));
      return {
        len: session.access_token.length,
        exp: payload.exp ? new Date(payload.exp * 1e3).toISOString() : null
      };
    } catch (e) {
      return { len: session.access_token.length, exp: null };
    }
  };
  const runDiagnostics = async () => {
    try {
      console.log("M1DEBUG: Running BUZZ diagnostics...");
      const { data, error } = await supabase.functions.invoke("get-user-state", {
        body: { userId: user?.id },
        headers: { "x-m1-debug": "1" }
      });
      const jwtInfo = getJwtInfo();
      const origin = window.location.origin;
      const diag = {
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        auth: {
          isAuthenticated,
          userId: user?.id?.substring(0, 8) + "...",
          jwtLen: jwtInfo.len,
          jwtExp: jwtInfo.exp
        },
        economy: {
          hasFreeBuzz,
          totalRemaining,
          currentCostM1U: getCurrentBuzzCostM1U()
        },
        network: {
          origin,
          endpoint: "handle-buzz-press"
        },
        corsCheck: {
          success: !error,
          debugInfo: data?.__debug || null,
          error: error?.message || null
        }
      };
      setDiagnostics(diag);
      console.log("M1DEBUG: BUZZ diagnostics:", diag);
    } catch (e) {
      console.error("M1DEBUG: Diagnostics failed:", e);
      setDiagnostics({ error: e.message });
    }
  };
  const testBuzzDry = async () => {
    try {
      console.log("M1DEBUG: Testing BUZZ (dry run)...");
      const { data, error } = await supabase.functions.invoke("handle-buzz-press", {
        body: {
          hasFreeBuzz,
          currentPrice: getCurrentBuzzCostM1U(),
          dryRun: true
        },
        headers: { "x-m1-debug": "1" }
      });
      const result = {
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        success: !error,
        data,
        error: error?.message || null
      };
      setLastResult(result);
      console.log("M1DEBUG: BUZZ test result:", result);
    } catch (e) {
      console.error("M1DEBUG: BUZZ test failed:", e);
      setLastResult({ error: e.message });
    }
  };
  reactExports.useEffect(() => {
    if (isAuthenticated && user) {
      runDiagnostics();
    }
  }, [isAuthenticated, user]);
  if (!isAuthenticated) return null;
  const panel = /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      style: {
        position: "fixed",
        bottom: "80px",
        left: "10px",
        backgroundColor: "rgba(0, 0, 0, 0.95)",
        color: "#fff",
        padding: collapsed ? "8px" : "12px",
        borderRadius: "8px",
        fontSize: "11px",
        zIndex: 2147483e3,
        maxWidth: "320px",
        maxHeight: collapsed ? "40px" : "60vh",
        overflow: "auto",
        fontFamily: "monospace",
        border: "1px solid #3b82f6"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            onClick: () => setCollapsed(!collapsed),
            style: {
              cursor: "pointer",
              display: "flex",
              alignItems: "center",
              justifyContent: "space-between",
              fontWeight: "bold",
              marginBottom: collapsed ? 0 : "8px"
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "🧪 BUZZ DEBUG" }),
              collapsed ? /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronUp, { size: 16 }) : /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { size: 16 })
            ]
          }
        ),
        !collapsed && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "Auth & Session" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Auth: ",
              isAuthenticated ? "✅" : "❌"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "User ID: ",
              user?.id?.substring(0, 12),
              "..."
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "JWT Len: ",
              getJwtInfo().len
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "JWT Exp: ",
              getJwtInfo().exp?.substring(11, 19) || "N/A"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "Economy" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Free BUZZ: ",
              hasFreeBuzz ? "✅" : "❌"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Remaining: ",
              totalRemaining
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Cost M1U: ",
              getCurrentBuzzCostM1U()
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "Network" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Origin: ",
              window.location.origin.substring(0, 30),
              "..."
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: "Endpoint: handle-buzz-press" })
          ] }),
          diagnostics && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "CORS Check" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Status: ",
              diagnostics.corsCheck?.success ? "✅" : "❌"
            ] }),
            diagnostics.corsCheck?.debugInfo && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                "Saw Auth: ",
                diagnostics.corsCheck.debugInfo.sawAuthorizationHeader ? "✅" : "❌"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                "JWT Len: ",
                diagnostics.corsCheck.debugInfo.jwtLen
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                "Allowed Origin: ",
                diagnostics.corsCheck.debugInfo.allowedOrigin?.substring(0, 25) || "N/A"
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CopyJsonButton, { data: diagnostics, label: "Copy Full" })
          ] }),
          lastResult && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: "8px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { fontWeight: "bold", marginBottom: "4px" }, children: "Last Test" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Success: ",
              lastResult.success ? "✅" : "❌"
            ] }),
            lastResult.data?.clue_text && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              "Clue: ",
              lastResult.data.clue_text.substring(0, 30),
              "..."
            ] }),
            lastResult.error && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { color: "#ef4444" }, children: [
              "Error: ",
              lastResult.error
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CopyJsonButton, { data: lastResult, label: "Copy Result" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { display: "flex", gap: "4px", paddingTop: "8px", borderTop: "1px solid #444" }, children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: runDiagnostics,
                style: {
                  padding: "4px 8px",
                  fontSize: "10px",
                  backgroundColor: "#8b5cf6",
                  color: "white",
                  border: "none",
                  borderRadius: "4px",
                  cursor: "pointer"
                },
                children: "Refresh"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: testBuzzDry,
                style: {
                  padding: "4px 8px",
                  fontSize: "10px",
                  backgroundColor: "#10b981",
                  color: "white",
                  border: "none",
                  borderRadius: "4px",
                  cursor: "pointer"
                },
                children: "Test BUZZ"
              }
            )
          ] })
        ] })
      ]
    }
  );
  return typeof document !== "undefined" ? reactDomExports.createPortal(panel, document.body) : panel;
};

const BuzzPage = () => {
  const { stats, loading, loadBuzzStats } = useBuzzStats();
  const { user } = useUnifiedAuth();
  useSoundEffects$1();
  const vortexSoundRef = reactExports.useRef(null);
  const debugEnabled = useDebugFlag();
  const {
    dailyBuzzCounter,
    getCurrentBuzzDisplayCostM1U,
    loadDailyBuzzCounter
    // ✅ ADD THIS for force refresh
  } = useBuzzCounter(user?.id);
  const isBlocked = false;
  const currentPriceDisplay = getCurrentBuzzDisplayCostM1U();
  reactExports.useEffect(() => {
    let mounted = true;
    const timer = setTimeout(() => {
      if (!mounted) return;
      try {
        const vortex = createVortexSound();
        if (!mounted) {
          vortex.stop();
          return;
        }
        vortexSoundRef.current = vortex;
        vortex.setVolume(0.25);
        vortex.start();
        console.log("🌀 Vortex sound active on /buzz page");
      } catch (error) {
        console.log("Vortex sound init prevented (autoplay policy):", error);
      }
    }, 200);
    return () => {
      mounted = false;
      clearTimeout(timer);
      if (vortexSoundRef.current) {
        console.log("🌀 Stopping vortex sound (leaving /buzz page)");
        vortexSoundRef.current.stop();
        vortexSoundRef.current = null;
      }
    };
  }, []);
  const handleBuzzSuccess = async () => {
    console.log("🎉 BUZZ SUCCESS - Reloading all stats...");
    await loadDailyBuzzCounter();
    await loadBuzzStats();
    console.log("✅ All stats reloaded after BUZZ");
  };
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen w-full fixed inset-0 flex items-center justify-center bg-background", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        animate: { rotate: 360 },
        transition: { duration: 1, repeat: Infinity, ease: "linear" },
        className: "w-8 h-8 border-2 border-[#F059FF] border-t-transparent rounded-full"
      }
    ) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "bg-[#070818] w-full",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      transition: { duration: 0.5 },
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative",
        paddingTop: "env(safe-area-inset-top, 47px)",
        paddingBottom: "env(safe-area-inset-bottom, 0px)",
        paddingLeft: "env(safe-area-inset-left, 0px)",
        paddingRight: "env(safe-area-inset-right, 0px)"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(BuzzRewardHandler, { onRewardRedeemed: handleBuzzSuccess }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "fixed top-24 left-0 right-0 h-32 pointer-events-none z-[9]",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 0.3, duration: 0.8 },
            style: {
              background: `
            radial-gradient(ellipse at 50% 0%, rgba(0, 209, 255, 0.18), transparent 70%),
            radial-gradient(ellipse at 20% 0%, rgba(123, 92, 255, 0.15), transparent 60%),
            radial-gradient(ellipse at 80% 0%, rgba(240, 89, 255, 0.12), transparent 65%)
          `,
              filter: "blur(20px)"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "main",
          {
            style: {
              paddingTop: "calc(119px + env(safe-area-inset-top, 0px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto px-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "div",
                {
                  id: "m1u-pill-buzz-slot",
                  className: "fixed z-[1000] flex items-center gap-2",
                  style: {
                    top: "calc(env(safe-area-inset-top, 0px) + 96px)",
                    left: "max(1rem, env(safe-area-inset-left, 0px))",
                    pointerEvents: "auto"
                  },
                  "aria-hidden": false,
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(M1UPill$1, { showLabel: true, showPlusButton: true })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center justify-center min-h-[calc(100vh-200px)]", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mb-6", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  BuzzActionButton,
                  {
                    isBlocked,
                    onSuccess: handleBuzzSuccess
                  }
                ) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  "div",
                  {
                    className: "p-4 sm:p-6 mb-6 max-w-3xl w-full mx-4 relative overflow-hidden",
                    style: {
                      background: "rgba(0, 0, 0, 0.05)",
                      backdropFilter: "blur(40px)",
                      WebkitBackdropFilter: "blur(40px)",
                      borderRadius: "24px",
                      border: "1px solid rgba(255, 255, 255, 0.1)",
                      boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
                    },
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "div",
                        {
                          className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                          style: {
                            animation: "slideGlowBuzz 3s ease-in-out infinite",
                            width: "200%",
                            left: "-100%"
                          }
                        }
                      ) }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
                @keyframes slideGlowBuzz {
                  0% { transform: translateX(0); }
                  50% { transform: translateX(50%); }
                  100% { transform: translateX(0); }
                }
              ` }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-white/80 space-y-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Premi il pulsante per inviare un segnale e scoprire nuovi indizi. Ogni Buzz ti aiuta a trovare indizi nascosti per raggiungere l'obiettivo di 200 indizi totali." }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "font-semibold", children: [
                          "BUZZ oggi: ",
                          dailyBuzzCounter,
                          " (prezzo progressivo)"
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "font-semibold", children: [
                          "BUZZ totali: ",
                          stats?.total_count || 0,
                          "/200 (target finale)"
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-[#00ffff]", children: [
                          "Prossimo: ",
                          currentPriceDisplay
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "💎 Ogni BUZZ consuma M1U dal tuo saldo" })
                      ] }) })
                    ]
                  }
                )
              ] })
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "fixed bottom-24 left-0 right-0 h-32 pointer-events-none z-[9]",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 0.5, duration: 0.8 },
            style: {
              background: `
            radial-gradient(ellipse at 50% 100%, rgba(0, 209, 255, 0.18), transparent 70%),
            radial-gradient(ellipse at 20% 100%, rgba(123, 92, 255, 0.15), transparent 60%),
            radial-gradient(ellipse at 80% 100%, rgba(240, 89, 255, 0.12), transparent 65%)
          `,
              filter: "blur(20px)"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            id: "mission-bottom-nav-container",
            style: {
              position: "fixed",
              bottom: 0,
              left: 0,
              right: 0,
              width: "100vw",
              zIndex: 1e4,
              isolation: "isolate",
              transform: "translateZ(0)",
              willChange: "transform",
              display: "block",
              visibility: "visible",
              opacity: 1
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
          }
        ),
        debugEnabled && /* @__PURE__ */ jsxRuntimeExports.jsx(DebugBuzzPanel, {})
      ]
    }
  );
};

const SafeAreaWrapper = ({ children, className }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn("pt-safe-top pb-safe-bottom", className), children });
};

const PALETTE = {
  A: { h: 350, s: 85, l: 60 },
  // Magenta caldo
  E: { h: 280, s: 70, l: 65 },
  // Viola
  I: { h: 200, s: 80, l: 60 },
  // Ciano
  O: { h: 20, s: 90, l: 65 },
  // Arancio
  U: { h: 160, s: 75, l: 60 },
  // Verde acqua
  M: { h: 330, s: 60, l: 55 },
  // Rosa scuro
  X: { h: 210, s: 25, l: 12 }
  // Idle (blu profondo)
};
const simplex3D = (x, y, z) => {
  const p = [151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10, 23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208, 89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123, 5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119, 248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232, 178, 185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249, 14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254, 138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180];
  const perm = [...p, ...p];
  const F3 = 1 / 3;
  const G3 = 1 / 6;
  let s = (x + y + z) * F3;
  let i = Math.floor(x + s);
  let j = Math.floor(y + s);
  let k = Math.floor(z + s);
  let t = (i + j + k) * G3;
  let X0 = i - t;
  let Y0 = j - t;
  let Z0 = k - t;
  let x0 = x - X0;
  let y0 = y - Y0;
  let z0 = z - Z0;
  let i1, j1, k1, i2, j2, k2;
  if (x0 >= y0) {
    if (y0 >= z0) {
      i1 = 1;
      j1 = 0;
      k1 = 0;
      i2 = 1;
      j2 = 1;
      k2 = 0;
    } else if (x0 >= z0) {
      i1 = 1;
      j1 = 0;
      k1 = 0;
      i2 = 1;
      j2 = 0;
      k2 = 1;
    } else {
      i1 = 0;
      j1 = 0;
      k1 = 1;
      i2 = 1;
      j2 = 0;
      k2 = 1;
    }
  } else {
    if (y0 < z0) {
      i1 = 0;
      j1 = 0;
      k1 = 1;
      i2 = 0;
      j2 = 1;
      k2 = 1;
    } else if (x0 < z0) {
      i1 = 0;
      j1 = 1;
      k1 = 0;
      i2 = 0;
      j2 = 1;
      k2 = 1;
    } else {
      i1 = 0;
      j1 = 1;
      k1 = 0;
      i2 = 1;
      j2 = 1;
      k2 = 0;
    }
  }
  let x1 = x0 - i1 + G3;
  let y1 = y0 - j1 + G3;
  let z1 = z0 - k1 + G3;
  let x2 = x0 - i2 + 2 * G3;
  let y2 = y0 - j2 + 2 * G3;
  let z2 = z0 - k2 + 2 * G3;
  let x3 = x0 - 1 + 3 * G3;
  let y3 = y0 - 1 + 3 * G3;
  let z3 = z0 - 1 + 3 * G3;
  let ii = i & 255;
  let jj = j & 255;
  let kk = k & 255;
  const grad3 = [[1, 1, 0], [-1, 1, 0], [1, -1, 0], [-1, -1, 0], [1, 0, 1], [-1, 0, 1], [1, 0, -1], [-1, 0, -1], [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1]];
  const dot3 = (g, x4, y4, z4) => g[0] * x4 + g[1] * y4 + g[2] * z4;
  let gi0 = perm[ii + perm[jj + perm[kk]]] % 12;
  let gi1 = perm[ii + i1 + perm[jj + j1 + perm[kk + k1]]] % 12;
  let gi2 = perm[ii + i2 + perm[jj + j2 + perm[kk + k2]]] % 12;
  let gi3 = perm[ii + 1 + perm[jj + 1 + perm[kk + 1]]] % 12;
  let n0 = 0, n1 = 0, n2 = 0, n3 = 0;
  let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;
  if (t0 >= 0) {
    t0 *= t0;
    n0 = t0 * t0 * dot3(grad3[gi0], x0, y0, z0);
  }
  let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;
  if (t1 >= 0) {
    t1 *= t1;
    n1 = t1 * t1 * dot3(grad3[gi1], x1, y1, z1);
  }
  let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;
  if (t2 >= 0) {
    t2 *= t2;
    n2 = t2 * t2 * dot3(grad3[gi2], x2, y2, z2);
  }
  let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;
  if (t3 >= 0) {
    t3 *= t3;
    n3 = t3 * t3 * dot3(grad3[gi3], x3, y3, z3);
  }
  return 32 * (n0 + n1 + n2 + n3);
};
const AionEntity = reactExports.forwardRef(({
  className = "",
  intensity = 1,
  idleSpeed = 0.7
}, ref) => {
  const containerRef = reactExports.useRef(null);
  const sceneRef = reactExports.useRef(null);
  const cameraRef = reactExports.useRef(null);
  const rendererRef = reactExports.useRef(null);
  const meshRef = reactExports.useRef(null);
  const animationFrameRef = reactExports.useRef(null);
  const timeRef = reactExports.useRef(0);
  const [currentColor, setCurrentColor] = reactExports.useState(PALETTE.X);
  const [isPlaying, setIsPlaying] = reactExports.useState(false);
  const visemeQueueRef = reactExports.useRef([]);
  const playStartTimeRef = reactExports.useRef(0);
  reactExports.useEffect(() => {
    if (!containerRef.current) return;
    const container = containerRef.current;
    const width = container.clientWidth;
    const height = container.clientHeight;
    const scene = new Scene();
    sceneRef.current = scene;
    const camera = new PerspectiveCamera(45, width / height, 0.1, 1e3);
    camera.position.z = 4;
    cameraRef.current = camera;
    const renderer = new WebGLRenderer({
      antialias: true,
      alpha: true,
      powerPreference: "high-performance"
    });
    renderer.setSize(width, height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setClearColor(0, 0);
    container.appendChild(renderer.domElement);
    rendererRef.current = renderer;
    const geometry = new IcosahedronGeometry(1.2, 8);
    const originalPositions = geometry.attributes.position.array.slice();
    const material = new MeshStandardMaterial({
      color: new Color(`hsl(${PALETTE.X.h}, ${PALETTE.X.s}%, ${PALETTE.X.l}%)`),
      emissive: new Color(`hsl(${PALETTE.X.h}, ${PALETTE.X.s}%, ${PALETTE.X.l * 0.3}%)`),
      emissiveIntensity: 0.5,
      metalness: 0.3,
      roughness: 0.7,
      wireframe: false,
      transparent: true,
      opacity: 0.9
    });
    const mesh = new Mesh(geometry, material);
    scene.add(mesh);
    meshRef.current = mesh;
    const ambientLight = new AmbientLight(4210752, 0.5);
    scene.add(ambientLight);
    const pointLight1 = new PointLight(54527, 1, 100);
    pointLight1.position.set(5, 5, 5);
    scene.add(pointLight1);
    const pointLight2 = new PointLight(15864740, 0.8, 100);
    pointLight2.position.set(-5, -5, 5);
    scene.add(pointLight2);
    const animate = () => {
      timeRef.current += 0.01 * idleSpeed;
      const time = timeRef.current;
      if (meshRef.current) {
        meshRef.current.rotation.x = Math.sin(time * 0.3) * 0.1;
        meshRef.current.rotation.y += 5e-3;
        const positions = meshRef.current.geometry.attributes.position.array;
        for (let i = 0; i < positions.length; i += 3) {
          const ox = originalPositions[i];
          const oy = originalPositions[i + 1];
          const oz = originalPositions[i + 2];
          const noise = simplex3D(
            ox * 2 + time,
            oy * 2 + time * 0.5,
            oz * 2 + time * 0.3
          ) * 0.15 * intensity;
          const len = Math.sqrt(ox * ox + oy * oy + oz * oz);
          const scale = 1 + noise;
          positions[i] = ox / len * len * scale;
          positions[i + 1] = oy / len * len * scale;
          positions[i + 2] = oz / len * len * scale;
        }
        meshRef.current.geometry.attributes.position.needsUpdate = true;
        const mat = meshRef.current.material;
        const targetColor = new Color(
          `hsl(${currentColor.h}, ${currentColor.s}%, ${currentColor.l}%)`
        );
        mat.color.lerp(targetColor, 0.1);
        mat.emissive.lerp(
          new Color(`hsl(${currentColor.h}, ${currentColor.s}%, ${currentColor.l * 0.4}%)`),
          0.1
        );
      }
      if (isPlaying && visemeQueueRef.current.length > 0) {
        const elapsed = Date.now() - playStartTimeRef.current;
        const currentViseme = visemeQueueRef.current.find((v) => v.t <= elapsed);
        if (currentViseme) {
          const palette = PALETTE[currentViseme.v.toUpperCase()] || PALETTE.X;
          setCurrentColor(palette);
          visemeQueueRef.current = visemeQueueRef.current.filter((v) => v.t > elapsed);
        }
        if (visemeQueueRef.current.length === 0) {
          setIsPlaying(false);
          setCurrentColor(PALETTE.X);
        }
      }
      renderer.render(scene, camera);
      animationFrameRef.current = requestAnimationFrame(animate);
    };
    animate();
    const handleResize = () => {
      if (!containerRef.current || !cameraRef.current || !rendererRef.current) return;
      const w = containerRef.current.clientWidth;
      const h = containerRef.current.clientHeight;
      cameraRef.current.aspect = w / h;
      cameraRef.current.updateProjectionMatrix();
      rendererRef.current.setSize(w, h);
    };
    window.addEventListener("resize", handleResize);
    return () => {
      window.removeEventListener("resize", handleResize);
      if (animationFrameRef.current) {
        cancelAnimationFrame(animationFrameRef.current);
      }
      if (rendererRef.current && container.contains(rendererRef.current.domElement)) {
        container.removeChild(rendererRef.current.domElement);
      }
      geometry.dispose();
      material.dispose();
      renderer.dispose();
    };
  }, [intensity, idleSpeed]);
  reactExports.useImperativeHandle(ref, () => ({
    play(visemes, opts) {
      visemeQueueRef.current = [...visemes].sort((a, b) => a.t - b.t);
      playStartTimeRef.current = Date.now();
      setIsPlaying(true);
    },
    stop() {
      visemeQueueRef.current = [];
      setIsPlaying(false);
      setCurrentColor(PALETTE.X);
    },
    idle() {
      visemeQueueRef.current = [];
      setIsPlaying(false);
      setCurrentColor(PALETTE.X);
    }
  }));
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      ref: containerRef,
      className: `w-full h-full ${className}`,
      style: { minHeight: "280px" }
    }
  );
});
AionEntity.displayName = "AionEntity";

function normalizeForSpeech(text) {
  return text.replace(/M1SSION/gi, "Mission").replace(/m1ssion/gi, "mission").replace(/A\.I\.O\.N\./gi, "Ayon").replace(/\bAION\b/gi, "Ayon").replace(/\baion\b/gi, "Ayon").replace(/\bION\b/g, "Ayon").replace(/M1U/gi, "emme uno u").replace(/[™®©]/g, "").trim();
}
const useTTS = () => {
  const [isSpeaking, setIsSpeaking] = reactExports.useState(false);
  const [isPaused, setIsPaused] = reactExports.useState(false);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const audioRef = reactExports.useRef(null);
  const utteranceRef = reactExports.useRef(null);
  const isSupported = typeof window !== "undefined" && "speechSynthesis" in window;
  reactExports.useEffect(() => {
    return () => {
      if (audioRef.current) {
        audioRef.current.pause();
        audioRef.current = null;
      }
      if (isSupported) {
        window.speechSynthesis.cancel();
      }
    };
  }, [isSupported]);
  const speakWithElevenLabs = reactExports.useCallback(async (text, options = {}) => {
    const { voice = "rachel", onEnd, onStart, onError } = options;
    setIsLoading(true);
    try {
      const { data, error } = await supabase.functions.invoke("tts-elevenlabs", {
        body: { text, voice }
      });
      if (error || !data?.audio) {
        throw new Error(error?.message || "TTS failed");
      }
      const audioBlob = new Blob(
        [Uint8Array.from(atob(data.audio), (c) => c.charCodeAt(0))],
        { type: "audio/mp3" }
      );
      const audioUrl = URL.createObjectURL(audioBlob);
      const audio = new Audio(audioUrl);
      audioRef.current = audio;
      audio.onplay = () => {
        setIsSpeaking(true);
        setIsLoading(false);
        onStart?.();
      };
      audio.onended = () => {
        setIsSpeaking(false);
        URL.revokeObjectURL(audioUrl);
        onEnd?.();
      };
      audio.onerror = () => {
        setIsSpeaking(false);
        setIsLoading(false);
        URL.revokeObjectURL(audioUrl);
        onError?.(new Error("Audio playback failed"));
      };
      await audio.play();
    } catch (error) {
      console.error("[TTS] ElevenLabs error:", error);
      setIsLoading(false);
      setIsSpeaking(false);
      options.onError?.(error);
      options.onEnd?.();
    }
  }, []);
  const speakWithBrowser = reactExports.useCallback((text, options = {}) => {
    if (!isSupported) {
      console.warn("[TTS] Speech synthesis not supported");
      return;
    }
    const {
      lang = "it-IT",
      rate = 0.95,
      pitch = 1,
      volume = 1,
      onEnd,
      onStart,
      onError
    } = options;
    window.speechSynthesis.cancel();
    const normalizedText = normalizeForSpeech(text);
    const utterance = new SpeechSynthesisUtterance(normalizedText);
    utterance.lang = lang;
    utterance.rate = rate;
    utterance.pitch = pitch;
    utterance.volume = volume;
    const voices = window.speechSynthesis.getVoices();
    const italianVoice = voices.find((v) => v.lang.startsWith("it"));
    if (italianVoice) {
      utterance.voice = italianVoice;
    }
    utterance.onstart = () => {
      setIsSpeaking(true);
      setIsPaused(false);
      onStart?.();
    };
    utterance.onend = () => {
      setIsSpeaking(false);
      setIsPaused(false);
      onEnd?.();
    };
    utterance.onerror = (event) => {
      setIsSpeaking(false);
      setIsPaused(false);
      onError?.(new Error(event.error));
    };
    utteranceRef.current = utterance;
    window.speechSynthesis.speak(utterance);
  }, [isSupported]);
  const speak = reactExports.useCallback((text, options = {}) => {
    const { useCloud = true } = options;
    if (useCloud) {
      speakWithElevenLabs(text, options);
    } else {
      speakWithBrowser(text, options);
    }
  }, [speakWithElevenLabs, speakWithBrowser]);
  const stop = reactExports.useCallback(() => {
    if (audioRef.current) {
      audioRef.current.pause();
      audioRef.current.currentTime = 0;
    }
    if (isSupported) {
      window.speechSynthesis.cancel();
    }
    setIsSpeaking(false);
    setIsPaused(false);
    setIsLoading(false);
  }, [isSupported]);
  const pause = reactExports.useCallback(() => {
    if (audioRef.current) {
      audioRef.current.pause();
      setIsPaused(true);
    } else if (isSupported && isSpeaking) {
      window.speechSynthesis.pause();
      setIsPaused(true);
    }
  }, [isSupported, isSpeaking]);
  const resume = reactExports.useCallback(() => {
    if (audioRef.current && isPaused) {
      audioRef.current.play();
      setIsPaused(false);
    } else if (isSupported && isPaused) {
      window.speechSynthesis.resume();
      setIsPaused(false);
    }
  }, [isSupported, isPaused]);
  return {
    speak,
    stop,
    pause,
    resume,
    isSpeaking,
    isPaused,
    isLoading,
    isSupported
  };
};

const ERROR_MESSAGES = {
  "INSUFFICIENT_M1U_FOR_AION": "⚡ Energia M1U insufficiente per attivare il canale AION. Ricarica le tue unità per continuare.",
  "AION_DAILY_CAP_EXCEEDED": "🔒 Limite giornaliero AION raggiunto. Il canale si ricaricherà domani. Riprova più tardi.",
  "NOT_AUTHENTICATED": "🔐 Connessione neurale non autenticata. Effettua il login per accedere ad AION.",
  "INTERNAL_ERROR": "⚠️ Interferenza nel canale. Riprova tra qualche secondo."
};
const IntelChatPanel = ({ aionEntityRef, className = "" }) => {
  const [messages, setMessages] = reactExports.useState([
    {
      id: "system-1",
      role: "system",
      content: "Connessione neurale stabilizzata. Sono AION, la tua intelligenza adattiva.",
      timestamp: /* @__PURE__ */ new Date()
    }
  ]);
  const [input, setInput] = reactExports.useState("");
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [isMicEnabled, setIsMicEnabled] = reactExports.useState(false);
  const [status, setStatus] = reactExports.useState("idle");
  const [aionStatus, setAionStatus] = reactExports.useState(null);
  const messagesEndRef = reactExports.useRef(null);
  const inputRef = reactExports.useRef(null);
  const sessionIdRef = reactExports.useRef(`session_${Date.now()}`);
  const { speak, stop: stopTTS} = useTTS();
  reactExports.useEffect(() => {
    fetchAionStatus();
  }, []);
  const fetchAionStatus = async () => {
    try {
      const { data, error } = await supabase.rpc("get_aion_status");
      if (!error && data) {
        setAionStatus(data);
      } else if (error) {
        console.warn("[AION] get_aion_status not found, using defaults:", error.message);
        setAionStatus({
          plan: "FREE",
          m1u_balance: 0,
          free_remaining: 0,
          cost_per_consult: 2
        });
      }
    } catch (e) {
      console.error("[AION] Status fetch error:", e);
      setAionStatus({
        plan: "FREE",
        m1u_balance: 0,
        free_remaining: 0,
        cost_per_consult: 2
      });
    }
  };
  reactExports.useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages]);
  const generateVisemes = (text) => {
    const vowels = ["a", "e", "i", "o", "u"];
    const visemes = [];
    let time = 0;
    const interval = 120;
    for (const char of text.toLowerCase()) {
      if (vowels.includes(char)) {
        visemes.push({ t: time, v: char.toUpperCase() });
        time += interval;
      } else if (char === "m" || char === "n" || char === "b" || char === "p") {
        visemes.push({ t: time, v: "M" });
        time += interval * 0.8;
      } else if (char === " ") {
        time += interval * 0.5;
      } else {
        time += interval * 0.3;
      }
    }
    return visemes;
  };
  const sendMessage = async () => {
    if (!input.trim() || isLoading) return;
    const userMessage = {
      id: `user_${Date.now()}`,
      role: "user",
      content: input.trim(),
      timestamp: /* @__PURE__ */ new Date()
    };
    setMessages((prev) => [...prev, userMessage]);
    setInput("");
    setIsLoading(true);
    setStatus("listening");
    try {
      const { data, error } = await supabase.functions.invoke("norah-chat-v2", {
        body: {
          session_id: sessionIdRef.current,
          text: userMessage.content,
          messages: messages.filter((m) => m.role !== "system" && m.role !== "error").slice(-10),
          system: "AION_CLIENT"
        }
      });
      if (error) throw error;
      if (data?.authorized === false && data?.error_code !== "NOT_AUTHENTICATED") {
        const errorCode = data.error_code || "INTERNAL_ERROR";
        const errorMessage = ERROR_MESSAGES[errorCode] || data.message || "Accesso AION non autorizzato.";
        const errorMsg = {
          id: `error_${Date.now()}`,
          role: "error",
          content: errorMessage,
          timestamp: /* @__PURE__ */ new Date(),
          meta: {
            error_code: errorCode,
            m1u_spent: 0,
            free_remaining: data.free_remaining
          }
        };
        setMessages((prev) => [...prev, errorMsg]);
        setStatus("idle");
        if (data.m1u_balance !== void 0) {
          setAionStatus((prev) => prev ? { ...prev, m1u_balance: data.m1u_balance } : null);
        }
        return;
      }
      if (data?.authorized === false && data?.error_code === "NOT_AUTHENTICATED") {
        console.warn("[AION] RPC check_aion_access may not exist yet, proceeding anyway");
      }
      let reply = data?.reply || "Mi dispiace, non ho capito. Riprova.";
      reply = reply.replace(/\bION\b/g, "AION").replace(/Sono Ion/gi, "Sono AION").replace(/sono ion/gi, "sono AION").replace(/chiamo Ion/gi, "chiamo AION");
      const visemes = data?.visemes || generateVisemes(reply);
      const assistantMessage = {
        id: `assistant_${Date.now()}`,
        role: "assistant",
        content: reply,
        timestamp: /* @__PURE__ */ new Date(),
        meta: {
          m1u_spent: data?.access?.m1u_spent,
          free_remaining: data?.access?.free_remaining
        }
      };
      setMessages((prev) => [...prev, assistantMessage]);
      setStatus("speaking");
      if (data?.access) {
        setAionStatus((prev) => prev ? {
          ...prev,
          m1u_balance: data.access.m1u_balance,
          free_remaining: data.access.free_remaining
        } : null);
        if (data.access.m1u_spent > 0) {
          window.dispatchEvent(new CustomEvent("m1u-spent", {
            detail: { amount: data.access.m1u_spent }
          }));
        }
      }
      if (aionEntityRef?.current) {
        aionEntityRef.current.play(visemes);
      }
      speak(reply, {
        useCloud: true,
        voice: "callum",
        onEnd: () => {
          setStatus("idle");
          aionEntityRef?.current?.idle();
        }
      });
    } catch (error) {
      console.error("[AION] Chat error:", error);
      const fallbackMessage = {
        id: `error_${Date.now()}`,
        role: "error",
        content: "⚠️ Interferenza nel canale. Riprova tra qualche secondo.",
        timestamp: /* @__PURE__ */ new Date()
      };
      setMessages((prev) => [...prev, fallbackMessage]);
      setStatus("idle");
    } finally {
      setIsLoading(false);
    }
  };
  const handleKeyPress = (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };
  const toggleMic = () => {
    setIsMicEnabled((prev) => !prev);
  };
  const refreshChat = () => {
    sessionIdRef.current = `session_${Date.now()}`;
    setMessages([{
      id: "system-1",
      role: "system",
      content: "Connessione neurale ripristinata. Sono AION, pronto ad assisterti.",
      timestamp: /* @__PURE__ */ new Date()
    }]);
    stopTTS();
    aionEntityRef?.current?.idle();
    setStatus("idle");
    fetchAionStatus();
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: `flex flex-col rounded-2xl overflow-hidden ${className}`,
      style: {
        background: "rgba(7, 8, 24, 0.6)",
        backdropFilter: "blur(12px)",
        border: "1px solid rgba(0, 212, 255, 0.2)"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between px-4 py-3 border-b border-cyan-500/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Brain, { className: "w-5 h-5 text-cyan-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium text-white", children: "Neural Link Established" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `w-2 h-2 rounded-full ${status === "idle" ? "bg-green-400" : status === "speaking" ? "bg-cyan-400 animate-pulse" : "bg-yellow-400 animate-pulse"}` })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            aionStatus && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1 px-2 py-1 rounded-lg bg-gray-800/50 text-xs", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-3 h-3 text-yellow-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: aionStatus.free_remaining > 0 ? `${aionStatus.free_remaining} gratis` : `${aionStatus.cost_per_consult} M1U` })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: toggleMic,
                className: `p-2 rounded-lg transition-colors ${isMicEnabled ? "bg-cyan-500/20 text-cyan-400" : "text-gray-400 hover:text-white"}`,
                children: isMicEnabled ? /* @__PURE__ */ jsxRuntimeExports.jsx(Mic, { className: "w-4 h-4" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(MicOff, { className: "w-4 h-4" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: refreshChat,
                className: "p-2 rounded-lg text-gray-400 hover:text-white transition-colors",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCw, { className: "w-4 h-4" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("button", { className: "p-2 rounded-lg text-gray-400 hover:text-white transition-colors", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Ellipsis, { className: "w-4 h-4" }) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: "flex-1 overflow-y-auto p-4 space-y-4 max-h-80 min-h-[200px]",
            style: { scrollBehavior: "smooth" },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: messages.map((message) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  initial: { opacity: 0, y: 10 },
                  animate: { opacity: 1, y: 0 },
                  exit: { opacity: 0, y: -10 },
                  className: `flex ${message.role === "user" ? "justify-end" : "justify-start"}`,
                  children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    "div",
                    {
                      className: `max-w-[80%] px-4 py-2 rounded-2xl ${message.role === "user" ? "bg-gradient-to-r from-cyan-500 to-blue-500 text-white" : message.role === "system" ? "bg-gray-800/50 text-gray-400 italic text-sm" : message.role === "error" ? "bg-red-900/30 text-red-300 border border-red-500/30" : "bg-gray-800/80 text-white border border-cyan-500/20"}`,
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm leading-relaxed", children: message.content }),
                        message.meta?.m1u_spent !== void 0 && message.meta.m1u_spent > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-cyan-400/70 mt-1", children: [
                          "-",
                          message.meta.m1u_spent,
                          " M1U"
                        ] })
                      ]
                    }
                  )
                },
                message.id
              )) }),
              isLoading && /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  initial: { opacity: 0 },
                  animate: { opacity: 1 },
                  className: "flex justify-start",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gray-800/80 px-4 py-2 rounded-2xl border border-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-5 h-5 text-cyan-400 animate-spin" }) })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { ref: messagesEndRef })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "px-4 py-2 text-xs text-center text-gray-500", children: [
          status === "listening" && "Elaborazione...",
          status === "speaking" && "AION sta parlando...",
          status === "idle" && "In attesa..."
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 border-t border-cyan-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "input",
            {
              ref: inputRef,
              type: "text",
              value: input,
              onChange: (e) => setInput(e.target.value),
              onKeyPress: handleKeyPress,
              placeholder: "Scrivi un messaggio...",
              disabled: isLoading,
              className: "flex-1 bg-gray-800/50 border border-cyan-500/20 rounded-xl px-4 py-2.5 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500/50 transition-colors disabled:opacity-50"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: sendMessage,
              disabled: !input.trim() || isLoading,
              className: "p-2.5 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg hover:shadow-cyan-500/25 transition-all",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-5 h-5" })
            }
          )
        ] }) })
      ]
    }
  );
};

const M1UPill = reactExports.lazy(() => __vitePreload(() => Promise.resolve().then(() => M1UPill$2),true?void 0:void 0));
const IntelligencePage = () => {
  const aionRef = reactExports.useRef(null);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(SafeAreaWrapper, { className: "relative isolate min-h-screen flex flex-col bg-[#070818]", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "absolute inset-0 pointer-events-none",
        style: {
          background: "radial-gradient(ellipse at center top, rgba(0, 212, 255, 0.1) 0%, transparent 50%)"
        }
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "fixed top-4 left-4 z-50 flex flex-col items-start gap-2",
        style: {
          marginTop: "env(safe-area-inset-top, 0px)",
          paddingLeft: "max(0rem, env(safe-area-inset-left, 0px))"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(reactExports.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-28 h-10 bg-gray-800/50 rounded-full animate-pulse" }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(M1UPill, { showLabel: true, showPlusButton: true }) })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "relative z-10",
        style: {
          height: "clamp(280px, 35vh, 420px)",
          marginTop: "clamp(100px, 12vh, 140px)"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            AionEntity,
            {
              ref: aionRef,
              intensity: 1,
              idleSpeed: 0.7,
              className: "mx-auto"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute bottom-4 left-0 right-0 text-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-2xl font-bold tracking-wider", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400", children: "AI" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: "ON" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-500 mt-1 tracking-wide", children: "Adaptive Intelligence ON" })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "relative z-10 flex-1 px-4 mt-8 pb-24",
        style: { maxWidth: "48rem", margin: "2rem auto 0", width: "100%" },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          IntelChatPanel,
          {
            aionEntityRef: aionRef,
            className: "h-full"
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "fixed bottom-0 left-0 right-0 z-50",
        style: {
          paddingBottom: "env(safe-area-inset-bottom, 0px)"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

async function ragSearch(query, locale = "it", top_k = 3) {
  const { data, error } = await supabase.functions.invoke("norah-rag-search", {
    body: { query, locale, top_k }
  });
  if (error) throw error;
  return data;
}
async function ragAnswer(query, locale = "it", top_k = 3) {
  const { data, error } = await supabase.functions.invoke("norah-answer", {
    body: { query, locale, top_k }
  });
  if (error) throw error;
  return data;
}

function RagQuery() {
  const [q, setQ] = reactExports.useState("");
  const [hits, setHits] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(false);
  const [err, setErr] = reactExports.useState(null);
  const onAsk = async () => {
    setLoading(true);
    setErr(null);
    try {
      const res = await ragSearch(q, "it", 3);
      setHits(res.hits ?? []);
      try {
        await supabase.from("norah_events").insert({
          event: "rag_ui_query",
          user_id: (await supabase.auth.getUser()).data.user?.id || "",
          payload: { q, top_k: 3, locale: "it", hits_count: res.hits?.length ?? 0 }
        });
      } catch (telErr) {
        console.warn("Telemetry insert failed:", telErr);
      }
    } catch (e) {
      setErr(e?.message ?? "Errore");
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "input",
      {
        className: "border p-2 w-full mb-2",
        value: q,
        onChange: (e) => setQ(e.target.value),
        placeholder: "Fai una domanda su BUZZ…"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        onClick: onAsk,
        disabled: loading || !q.trim(),
        className: "bg-blue-500 text-white px-4 py-2 rounded",
        children: loading ? "…" : "Chiedi"
      }
    ),
    err && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-red-500 mt-2", children: err }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "mt-4 space-y-2", children: hits.map((h, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { className: "border-b pb-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: h.title }),
      " · ",
      h.category,
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-gray-600", children: h.chunk_text }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("small", { className: "opacity-70", children: [
        "score: ",
        h.distance.toFixed(3)
      ] })
    ] }, i)) })
  ] });
}

function IntelligenceRAG() {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full bg-background", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "border-b border-border/40 bg-gradient-to-r from-background via-background/95 to-background", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto px-4 py-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 mb-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-2 rounded-lg bg-primary/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Brain, { className: "w-6 h-6 text-primary" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent", children: "M1SSION Intelligence" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground font-rajdhani", children: "Ricerca semantica sulla Knowledge Base interna — Powered by Norah AI (RAG)" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap gap-2 mt-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5 px-3 py-1 rounded-full bg-primary/5 border border-primary/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-3.5 h-3.5 text-primary" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-rajdhani text-primary", children: "Vector Search" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5 px-3 py-1 rounded-full bg-accent/5 border border-accent/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-3.5 h-3.5 text-accent" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-rajdhani text-accent", children: "Instant Results" })
        ] })
      ] })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto px-4 py-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(RagQuery, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto px-4 pb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "rounded-lg border border-border/40 bg-card/50 p-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-sm font-orbitron font-semibold mb-2 text-foreground", children: "💡 Esempi di domande" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "space-y-1 text-sm text-muted-foreground font-rajdhani", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: '• "Spiegami BUZZ e quando conviene usarlo rispetto a BUZZ Map"' }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: '• "Quali sono le differenze tra i piani Free e Titanium?"' }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: '• "Come funziona il sistema di rewards?"' }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: '• "Cosa sono i QR codes e come si usano?"' })
      ] })
    ] }) })
  ] });
}

function IntelligenceAnswerTest() {
  const [query, setQuery] = reactExports.useState("");
  const [answer, setAnswer] = reactExports.useState("");
  const [sources, setSources] = reactExports.useState([]);
  const [provider, setProvider] = reactExports.useState("");
  const [loading, setLoading] = reactExports.useState(false);
  const { toast } = useToast();
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!query.trim()) {
      toast({ title: "Errore", description: "Inserisci una domanda", variant: "destructive" });
      return;
    }
    setLoading(true);
    setAnswer("");
    setSources([]);
    setProvider("");
    try {
      const result = await ragAnswer(query);
      setAnswer(result.answer);
      setSources(result.sources);
      setProvider(result.provider);
    } catch (error) {
      console.error("ragAnswer error:", error);
      toast({
        title: "Errore",
        description: error instanceof Error ? error.message : "Errore durante la richiesta",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const examples = [
    "Spiegami BUZZ e quando conviene usare BUZZ Map",
    "Differenze tra piani Free e Titanium su BUZZ e BUZZ Map",
    "Sono su Silver e ho 30 secondi: qual è la next best action?"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto p-6 space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold mb-2", children: "Norah AI Answer Test" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Test della pipeline RAG → LLM con risposta contestuale" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Fai una domanda" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              placeholder: "Es: Spiegami BUZZ e quando usare BUZZ Map",
              value: query,
              onChange: (e) => setQuery(e.target.value),
              disabled: loading
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2 mt-2 flex-wrap", children: examples.map((ex, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              type: "button",
              variant: "outline",
              size: "sm",
              onClick: () => setQuery(ex),
              disabled: loading,
              children: [
                ex.slice(0, 30),
                "..."
              ]
            },
            i
          )) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { type: "submit", disabled: loading || !query.trim(), children: loading ? "Elaborazione..." : "Chiedi a Norah" })
      ] }) })
    ] }),
    answer && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Risposta" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-normal text-muted-foreground", children: [
          "Provider: ",
          provider
        ] })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Textarea,
        {
          value: answer,
          readOnly: true,
          className: "min-h-[200px] font-sans"
        }
      ) })
    ] }),
    sources.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { children: [
        "Fonti (",
        sources.length,
        ")"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: sources.map((src, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "div",
        {
          className: "p-3 border rounded-lg bg-muted/30 space-y-1",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "font-semibold text-sm", children: [
              src.title,
              " #",
              src.chunk_idx
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground font-mono", children: src.doc_id }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm italic", children: [
              '"',
              src.snippet,
              '..."'
            ] })
          ]
        },
        i
      )) }) })
    ] })
  ] });
}

const HallOfWinnersStyledPage = () => {
  useLocation();
  const [winners, setWinners] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    loadWinners();
    const channel = supabase.channel("winners-updates").on("postgres_changes", {
      event: "INSERT",
      schema: "public",
      table: "final_shots",
      filter: "is_winner=eq.true"
    }, () => {
      loadWinners();
    }).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, []);
  const loadWinners = async () => {
    try {
      setLoading(true);
      const mockWinners = [
        {
          id: "1",
          user_id: "user1",
          mission_id: "mission1",
          agent_code: "AG-3743",
          full_name: "Marco Rossi",
          avatar_url: void 0,
          city: "Milano",
          prize_image: "/api/placeholder/400/300",
          prize_name: "Tesla Model S",
          won_at: "2024-01-20T16:42:03Z",
          mission_start: "2024-01-18T00:00:00Z",
          completion_time: "2 giorni, 16 ore, 42 min"
        },
        {
          id: "2",
          user_id: "user2",
          mission_id: "mission2",
          agent_code: "AG-7291",
          full_name: "Anna Bianchi",
          avatar_url: void 0,
          city: "Roma",
          prize_image: "/api/placeholder/400/300",
          prize_name: "iPhone 15 Pro Max",
          won_at: "2024-01-15T14:22:15Z",
          mission_start: "2024-01-13T00:00:00Z",
          completion_time: "2 giorni, 14 ore, 22 min"
        },
        {
          id: "3",
          user_id: "user3",
          mission_id: "mission3",
          agent_code: "AG-1847",
          full_name: "Luigi Verde",
          avatar_url: void 0,
          city: "Napoli",
          prize_image: "/api/placeholder/400/300",
          prize_name: "MacBook Pro M3",
          won_at: "2024-01-10T09:33:27Z",
          mission_start: "2024-01-08T00:00:00Z",
          completion_time: "2 giorni, 9 ore, 33 min"
        }
      ];
      setWinners(mockWinners);
    } catch (error) {
      console.error("Error loading winners:", error);
    } finally {
      setLoading(false);
    }
  };
  const getRankIcon = (index) => {
    switch (index) {
      case 0:
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "w-6 h-6 text-yellow-400" });
      case 1:
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Medal, { className: "w-6 h-6 text-gray-300" });
      case 2:
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-6 h-6 text-amber-600" });
      default:
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-6 h-6 text-primary" });
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "w-full m1-app-bg relative",
      style: {
        minHeight: "100dvh"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "m1-grain" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "main",
          {
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 8px) + 10px)",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 20px))",
              minHeight: "100dvh",
              position: "relative",
              zIndex: 0
            },
            className: "px-4",
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-lg mx-auto space-y-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6 text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "text-4xl font-orbitron font-bold neon-text-cyan", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "span",
                    {
                      className: "text-auroraCyan",
                      children: "Hall of"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "span",
                    {
                      className: "text-white",
                      children: "Winners"
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Vincitori M1SSION™" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Card,
                {
                  className: "border-0 m1-panel relative overflow-hidden",
                  style: {
                    background: "rgba(0, 0, 0, 0.05)",
                    backdropFilter: "blur(40px)",
                    WebkitBackdropFilter: "blur(40px)",
                    border: "1px solid rgba(255, 255, 255, 0.1)",
                    boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
                  },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                        style: {
                          animation: "slideGlowWinners1 3s ease-in-out infinite",
                          width: "200%",
                          left: "-100%"
                        }
                      }
                    ) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
              @keyframes slideGlowWinners1 {
                0% { transform: translateX(0); }
                50% { transform: translateX(50%); }
                100% { transform: translateX(0); }
              }
            ` }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "text-center pb-4", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-yellow-400/20 to-yellow-400/10 mb-4 mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "h-10 w-10 text-yellow-400" }) }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-2xl font-bold bg-gradient-to-r from-yellow-400 to-yellow-500 bg-clip-text text-transparent", children: "Hall of Winners" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-4", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        "div",
                        {
                          className: "text-center p-3 border-0 m1-card",
                          children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Vincitori" }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-lg text-yellow-400", children: winners.length })
                          ]
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        "div",
                        {
                          className: "text-center p-3 border-0 m1-card",
                          children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Premi" }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-lg text-green-400", children: winners.length })
                          ]
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        "div",
                        {
                          className: "text-center p-3 border-0 m1-card",
                          children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Città" }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-lg text-cyan-400", children: winners.length > 0 ? new Set(winners.map((w) => w.city)).size : 0 })
                          ]
                        }
                      )
                    ] }) })
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Card,
                {
                  className: "border-0 m1-panel relative overflow-hidden",
                  style: {
                    background: "rgba(0, 0, 0, 0.05)",
                    backdropFilter: "blur(40px)",
                    WebkitBackdropFilter: "blur(40px)",
                    border: "1px solid rgba(255, 255, 255, 0.1)",
                    boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
                  },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                        style: {
                          animation: "slideGlowWinners2 3s ease-in-out infinite",
                          width: "200%",
                          left: "-100%"
                        }
                      }
                    ) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
              @keyframes slideGlowWinners2 {
                0% { transform: translateX(0); }
                50% { transform: translateX(50%); }
                100% { transform: translateX(0); }
              }
            ` }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent flex items-center gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "h-5 w-5 text-yellow-400" }),
                      "Vincitori Recenti"
                    ] }) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: loading ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent mx-auto mb-4" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Caricamento vincitori..." })
                    ] }) : winners.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-16 h-16 text-muted-foreground mx-auto mb-4" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-medium text-muted-foreground mb-2", children: "Nessun vincitore" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/70", children: "Sii il primo a vincere una missione!" })
                    ] }) : winners.slice(0, 3).map((winner, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "p-4 border-0 m1-card",
                        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-3", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0", children: getRankIcon(index) }),
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-2", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsxs(Avatar, { className: "w-8 h-8 border border-primary/30", children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarImage, { src: winner.avatar_url }),
                                /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarFallback, { className: "bg-primary/20 text-primary text-xs", children: winner.agent_code.split("-")[1] })
                              ] }),
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-foreground text-sm", children: winner.full_name }),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground/80 font-mono", children: winner.agent_code })
                              ] })
                            ] }),
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-muted-foreground", children: "Premio:" }),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-yellow-400 font-medium", children: winner.prize_name })
                              ] }),
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-muted-foreground", children: "Città:" }),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-foreground", children: winner.city })
                              ] }),
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
                                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-muted-foreground", children: "Tempo:" }),
                                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-green-400", children: winner.completion_time })
                              ] })
                            ] })
                          ] })
                        ] })
                      },
                      winner.id
                    )) })
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Card,
                {
                  className: "border-0 m1-panel relative overflow-hidden",
                  style: {
                    background: "rgba(0, 0, 0, 0.05)",
                    backdropFilter: "blur(40px)",
                    WebkitBackdropFilter: "blur(40px)",
                    border: "1px solid rgba(255, 255, 255, 0.1)",
                    boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
                  },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60",
                        style: {
                          animation: "slideGlowWinners3 3s ease-in-out infinite",
                          width: "200%",
                          left: "-100%"
                        }
                      }
                    ) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("style", { children: `
              @keyframes slideGlowWinners3 {
                0% { transform: translateX(0); }
                50% { transform: translateX(50%); }
                100% { transform: translateX(0); }
              }
            ` }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent flex items-center gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "h-5 w-5 text-purple-400" }),
                      "Statistiche"
                    ] }) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "div",
                        {
                          className: "p-4 border-0",
                          style: {
                            background: "rgba(0, 0, 0, 0.05)",
                            backdropFilter: "blur(40px)",
                            WebkitBackdropFilter: "blur(40px)",
                            borderRadius: "16px",
                            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
                          },
                          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "h-4 w-4 text-green-400" }),
                              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Missioni Completate" })
                            ] }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-green-500/20 text-green-400 border-green-500/30", children: winners.length })
                          ] })
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "div",
                        {
                          className: "p-4 border-0 m1-card",
                          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "h-4 w-4 text-blue-400" }),
                              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Tempo Medio" })
                            ] }),
                            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-blue-400 font-medium", children: "2.5 giorni" })
                          ] })
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "div",
                        {
                          className: "p-4 border-0 m1-card",
                          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "h-4 w-4 text-cyan-400" }),
                              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Copertura Geografica" })
                            ] }),
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-cyan-400 font-medium", children: [
                              winners.length > 0 ? new Set(winners.map((w) => w.city)).size : 0,
                              " città"
                            ] })
                          ] })
                        }
                      )
                    ] })
                  ]
                }
              )
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "fixed bottom-24 left-0 right-0 h-32 pointer-events-none z-[9]",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 0.5, duration: 0.8 },
            style: {
              background: `
            radial-gradient(ellipse at 50% 100%, rgba(0, 209, 255, 0.18), transparent 70%),
            radial-gradient(ellipse at 20% 100%, rgba(123, 92, 255, 0.15), transparent 60%),
            radial-gradient(ellipse at 80% 100%, rgba(240, 89, 255, 0.12), transparent 65%)
          `,
              filter: "blur(20px)"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      ]
    }
  );
};

function Skeleton({
  className,
  ...props
}) {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: cn("animate-pulse rounded-md bg-muted", className),
      ...props
    }
  );
}

function HallOfWinners() {
  const [winners, setWinners] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  reactExports.useEffect(() => {
    loadWinners();
  }, []);
  const loadWinners = async () => {
    try {
      setLoading(true);
      setError(null);
      const { data, error: fetchError } = await supabase.from("winners_public").select("*").limit(50);
      if (fetchError) throw fetchError;
      const mappedData = (data || []).map((row) => ({
        ...row,
        username: row.username || row.nickname || null
      }));
      setWinners(mappedData);
    } catch (err) {
      console.error("Error loading winners:", err);
      setError("Failed to load winners");
    } finally {
      setLoading(false);
    }
  };
  const getRankIcon = (index) => {
    if (index === 0) return /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-6 h-6 text-yellow-500" });
    if (index === 1) return /* @__PURE__ */ jsxRuntimeExports.jsx(Medal, { className: "w-6 h-6 text-gray-400" });
    if (index === 2) return /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-6 h-6 text-amber-600" });
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-5 h-5 text-primary/60" });
  };
  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return new Intl.DateTimeFormat("it-IT", {
      day: "2-digit",
      month: "short",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit"
    }).format(date);
  };
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-background p-4 sm:p-6 lg:p-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4 py-8", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton, { className: "h-12 w-64 mx-auto" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton, { className: "h-6 w-96 mx-auto" })
      ] }),
      [1, 2, 3, 4, 5].map((i) => /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton, { className: "h-32 w-full" }, i))
    ] }) });
  }
  if (error) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-background p-4 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "p-8 text-center max-w-md", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-16 h-16 mx-auto mb-4 text-destructive" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-2", children: "Error Loading Winners" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground mb-4", children: error }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: loadWinners,
          className: "px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",
          children: "Retry"
        }
      )
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-background", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gradient-to-b from-primary/20 to-background border-b border-border", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: -20 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.6 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-3 mb-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-10 h-10 text-primary" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-4xl sm:text-5xl font-bold text-foreground", children: "Hall of Winners" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-10 h-10 text-primary" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg text-muted-foreground max-w-2xl mx-auto", children: "I migliori agenti M1SSION che hanno completato missioni impossibili" })
        ]
      }
    ) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8", children: winners.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        className: "text-center py-16",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-24 h-24 mx-auto mb-6 text-muted-foreground/30" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-2xl font-bold mb-2 text-foreground", children: "Nessun vincitore ancora" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Completa una missione per essere il primo nella Hall of Winners!" })
        ]
      }
    ) : /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "popLayout", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: winners.map((winner, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, x: -20 },
        animate: { opacity: 1, x: 0 },
        exit: { opacity: 0, x: 20 },
        transition: { duration: 0.3, delay: index * 0.05 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Card,
          {
            className: `
                      p-4 sm:p-6 hover:shadow-lg transition-all duration-300 
                      ${index < 3 ? "border-2 border-primary/50 bg-primary/5" : ""}
                    `,
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 flex-wrap sm:flex-nowrap", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0 flex items-center justify-center w-12 h-12 sm:w-16 sm:h-16", children: getRankIcon(index) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 flex-1 min-w-0", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Avatar, { className: "w-12 h-12 sm:w-16 sm:h-16 border-2 border-primary/30", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarImage, { src: winner.avatar_url || void 0 }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarFallback, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-6 h-6" }) })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-bold text-lg text-foreground truncate", children: winner.username || "Anonymous Agent" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: winner.agent_code || "No Code" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0 space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", className: "text-xs", children: winner.mission_code || "Unknown" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-foreground truncate", children: winner.mission_title || "Mission Classified" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 flex-shrink-0", children: [
                winner.prize_image && /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "img",
                  {
                    src: winner.prize_image,
                    alt: winner.prize_name || "Prize",
                    className: "w-12 h-12 rounded-lg object-cover"
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "hidden sm:block", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-foreground", children: winner.prize_name || "Prize" }),
                  winner.prize_value && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-primary font-bold", children: [
                    winner.prize_value,
                    " M1U"
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-4 h-4" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "hidden lg:inline", children: formatDate(winner.completion_time) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "lg:hidden", children: new Date(winner.completion_time).toLocaleDateString("it-IT") })
              ] })
            ] })
          }
        )
      },
      winner.id
    )) }) }) }),
    winners.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 border-t border-border", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 sm:grid-cols-3 gap-4 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "p-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-8 h-8 mx-auto mb-2 text-primary" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-foreground", children: winners.length }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Total Winners" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "p-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-8 h-8 mx-auto mb-2 text-primary" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-foreground", children: new Set(winners.map((w) => w.mission_code)).size }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Missions Completed" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "p-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-8 h-8 mx-auto mb-2 text-primary" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-foreground", children: winners.reduce((sum, w) => sum + (w.prize_value || 0), 0) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Total M1U Awarded" })
      ] })
    ] }) })
  ] });
}

const useBuzzSound = () => {
  const audioRef = reactExports.useRef(null);
  const { isEnabled } = useSound();
  const initializeSound = (soundPreference, volume) => {
    const soundPath = getSoundPath(soundPreference);
    if (audioRef.current) {
      audioRef.current.pause();
      audioRef.current = null;
    }
    audioRef.current = new Audio(soundPath);
    if (audioRef.current) {
      audioRef.current.volume = volume;
      audioRef.current.load();
    }
  };
  const playSound = () => {
    if (!isEnabled || !audioRef.current) return;
    audioRef.current.currentTime = 0;
    const playPromise = audioRef.current.play();
    if (playPromise !== void 0) {
      playPromise.catch((e) => {
        console.error("Error playing sound:", e);
        document.addEventListener("click", function playOnClick() {
          if (audioRef.current && isEnabled) {
            audioRef.current.play().catch((err) => console.error("Error playing on click:", err));
          }
          document.removeEventListener("click", playOnClick);
        }, { once: true });
      });
    }
  };
  const getSoundPath = (preference) => {
    switch (preference) {
      case "chime":
        return "/sounds/chime.mp3";
      case "bell":
        return "/sounds/bell.mp3";
      case "arcade":
        return "/sounds/arcade.mp3";
      default:
        return "/sounds/buzz.mp3";
    }
  };
  return {
    initializeSound,
    playSound,
    getSoundPath
  };
};

const useDynamicIslandSafety = () => {
  const { user, isAuthenticated } = useAuthContext();
  const [isBuzzSafe, setIsBuzzSafe] = reactExports.useState({ isSafe: true });
  reactExports.useEffect(() => {
    const checkBuzzSafety = async () => {
      if (!isAuthenticated || !user) {
        setIsBuzzSafe({ isSafe: false, reason: "Not authenticated" });
        return;
      }
      try {
        if (!user.id || user.id.length < 10) {
          setIsBuzzSafe({ isSafe: false, reason: "User ID non valido" });
          console.log("🔒 Dynamic Island safety: User ID non valido");
          return;
        }
        if (!user.email_confirmed_at) {
          setIsBuzzSafe({ isSafe: false, reason: "Email non verificata" });
          console.log("🔒 Dynamic Island safety: Email non verificata");
          return;
        }
        const { data: session } = await supabase.auth.getSession();
        if (!session?.session) {
          setIsBuzzSafe({ isSafe: false, reason: "Sessione non attiva" });
          console.log("🔒 Dynamic Island safety: Sessione non attiva");
          return;
        }
        setIsBuzzSafe({ isSafe: true });
        console.log("✅ Dynamic Island safety check passed");
      } catch (error) {
        console.error("Error during safety check:", error);
        setIsBuzzSafe({ isSafe: false, reason: error.message || "Unknown error" });
        console.log("❌ Dynamic Island safety check failed:", error.message);
      }
    };
    checkBuzzSafety();
  }, [user, isAuthenticated]);
  return {
    isBuzzSafe
  };
};

const useSoundEffects = () => {
  const [sounds, setSounds] = reactExports.useState({
    bell: null,
    buzz: null,
    chime: null,
    arcade: null
  });
  const [isMuted, setIsMuted] = reactExports.useState(false);
  const [audioContext, setAudioContext] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const initializeAudio = async () => {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        setAudioContext(ctx);
        const audioPromises = [
          { key: "bell", path: "/sounds/bell.mp3" },
          { key: "buzz", path: "/sounds/buzz.mp3" },
          { key: "chime", path: "/sounds/chime.mp3" },
          { key: "arcade", path: "/sounds/arcade.mp3" }
        ].map(async ({ key, path }) => {
          try {
            const audio = new Audio(path);
            audio.volume = 0.5;
            audio.preload = "metadata";
            await new Promise((resolve, reject) => {
              audio.addEventListener("canplaythrough", resolve, { once: true });
              audio.addEventListener("error", reject, { once: true });
              audio.load();
            });
            return { key, audio };
          } catch (error) {
            console.warn(`Audio file ${path} non disponibile, utilizzando fallback silenzioso`);
            return { key, audio: null };
          }
        });
        const resolvedAudio = await Promise.all(audioPromises);
        const soundsMap = resolvedAudio.reduce((acc, { key, audio }) => {
          acc[key] = audio;
          return acc;
        }, {});
        setSounds(soundsMap);
      } catch (error) {
        console.warn("Audio non supportato su questo dispositivo, modalità silenziosa attiva");
        setSounds({
          bell: null,
          buzz: null,
          chime: null,
          arcade: null
        });
      }
    };
    initializeAudio();
    return () => {
      Object.values(sounds).forEach((sound) => {
        if (sound) {
          sound.pause();
          sound.currentTime = 0;
        }
      });
      if (audioContext) {
        audioContext.close();
      }
    };
  }, []);
  const playSound = async (type) => {
    if (isMuted || !sounds[type]) return;
    try {
      if (audioContext && audioContext.state === "suspended") {
        await audioContext.resume();
      }
      const sound = sounds[type];
      if (sound) {
        sound.currentTime = 0;
        await sound.play();
      }
    } catch (error) {
    }
  };
  const toggleMute = () => {
    setIsMuted(!isMuted);
  };
  return { playSound, toggleMute, isMuted };
};

const useDynamicIsland = () => {
  const { user, isAuthenticated } = useAuthContext();
  const [islandState, setIslandState] = reactExports.useState({
    isVisible: false,
    message: "",
    type: "info"
  });
  const { playSound } = useSoundEffects();
  const { isBuzzSafe } = useDynamicIslandSafety();
  const playNotificationSound = (type) => {
    switch (type) {
      case "success":
        playSound("buzz");
        break;
      case "error":
        playSound("buzz");
        break;
      default:
        playSound("buzz");
        break;
    }
  };
  const performSafetyChecks = () => {
    console.log("🔒 Dynamic Island safety checks performed");
    return isBuzzSafe.isSafe;
  };
  const showIsland = (message, type) => {
    if (!isAuthenticated || !user) {
      console.warn("Dynamic Island: User not authenticated, skipping island display");
      return;
    }
    setIslandState({
      isVisible: true,
      message,
      type
    });
    playNotificationSound(type);
    setTimeout(() => {
      hideIsland();
    }, 5e3);
  };
  const hideIsland = () => {
    setIslandState({
      ...islandState,
      isVisible: false
    });
  };
  const startActivity = (data) => {
    console.log("🚀 Starting Dynamic Island activity:", data.title);
    showIsland(data.title, "info");
  };
  const updateActivity = (data) => {
    console.log("🔄 Updating Dynamic Island activity:", data);
    if (data.status) {
      showIsland(data.status, "info");
    }
  };
  const endActivity = () => {
    console.log("🏁 Ending Dynamic Island activity");
    hideIsland();
  };
  reactExports.useEffect(() => {
    if (isAuthenticated && user) {
      performSafetyChecks();
    }
  }, [isAuthenticated, user]);
  return {
    islandState,
    showIsland,
    hideIsland,
    playNotificationSound,
    performSafetyChecks,
    startActivity,
    updateActivity,
    endActivity
  };
};

const useMissionManager = () => {
  const { startActivity, updateActivity, endActivity } = useDynamicIsland();
  const [currentMission, setCurrentMission] = reactExports.useState(null);
  const updateMissionProgress = (cluesFound) => {
    if (currentMission) {
      const updatedMission = { ...currentMission, foundClues: cluesFound };
      setCurrentMission(updatedMission);
      updateActivity({
        status: `${cluesFound} indizi trovati`,
        progress: cluesFound / 10 * 100
        // Assuming 10 total clues
      });
    }
  };
  return {
    currentMission,
    updateMissionProgress,
    startActivity,
    updateActivity,
    endActivity
  };
};

const useNotificationsDynamicIsland = (notifications) => {
  const { startActivity, updateActivity, endActivity } = useDynamicIsland();
  const { currentMission } = useMissionManager();
  reactExports.useEffect(() => {
    if (!notifications.length) return;
    const unreadNotifications = notifications.filter((n) => !n.read);
    if (unreadNotifications.length > 0) {
      console.log("📨 NOTIFICATIONS: Starting Dynamic Island for unread messages:", unreadNotifications.length);
      startActivity({
        missionId: `notifications-${Date.now()}`,
        title: "📨 Nuove notifiche",
        status: `${unreadNotifications.length} messaggi da HQ`,
        progress: 0,
        timeLeft: 0
      });
    } else {
      console.log("📨 NOTIFICATIONS: All read, closing Dynamic Island");
      endActivity();
    }
  }, [notifications.length, notifications.filter((n) => !n.read).length]);
  reactExports.useEffect(() => {
    return () => {
      if (currentMission?.name?.includes("Nuove notifiche") || currentMission?.name?.includes("📨")) {
        console.log("📨 NOTIFICATIONS: Cleaning up notification-related Live Activity");
        endActivity();
      }
    };
  }, [endActivity, currentMission]);
  const updateDynamicIslandOnRead = (notificationId) => {
    const remainingUnread = notifications.filter((n) => !n.read && n.id !== notificationId).length;
    if (remainingUnread > 0) {
      updateActivity({
        status: `${remainingUnread} messaggi da HQ`
      });
    } else {
      endActivity();
    }
  };
  const closeDynamicIsland = () => {
    endActivity();
  };
  return {
    updateDynamicIslandOnRead,
    closeDynamicIsland
  };
};

const useNotificationsAutoReload = (reloadNotifications) => {
  reactExports.useEffect(() => {
    console.log("📱 NOTIFICATIONS: Page mounted, forcing reload");
    reloadNotifications();
  }, [reloadNotifications]);
  reactExports.useEffect(() => {
    const interval = setInterval(() => {
      if (document.visibilityState === "visible") {
        console.log("🔄 NOTIFICATIONS: Auto-refreshing notifications");
        reloadNotifications();
      }
    }, 5e3);
    return () => clearInterval(interval);
  }, [reloadNotifications]);
};

const NotificationsHeader = ({
  filter,
  onFilterChange,
  onMarkAllAsRead,
  onManualReload
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "p-4 sm:p-6 mb-6 relative overflow-hidden rounded-[24px]",
      style: {
        background: "rgba(0, 0, 0, 0.05)",
        backdropFilter: "blur(40px)",
        WebkitBackdropFilter: "blur(40px)",
        border: "1px solid rgba(255, 255, 255, 0.1)",
        boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl font-semibold text-white", children: "Le tue notifiche" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { variant: "ghost", size: "sm", onClick: onManualReload, className: "flex-1 sm:flex-none", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4 mr-2" }),
              "Aggiorna"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { variant: "ghost", size: "sm", onClick: onMarkAllAsRead, className: "flex-1 sm:flex-none", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-4 h-4 mr-2" }),
              "Segna tutto come letto"
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap sm:flex-nowrap gap-2 sm:gap-3 overflow-x-auto mb-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: filter === "all" ? "default" : "outline",
              size: "sm",
              onClick: () => onFilterChange("all"),
              className: "flex-shrink-0 flex-1 sm:flex-none",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4 mr-2" }),
                "Generali"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: filter === "unread" ? "default" : "outline",
              size: "sm",
              onClick: () => onFilterChange("unread"),
              className: "flex-shrink-0 flex-1 sm:flex-none",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4 mr-2" }),
                "Buzz"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: filter === "important" ? "default" : "outline",
              size: "sm",
              onClick: () => onFilterChange("important"),
              className: "flex-shrink-0 flex-1 sm:flex-none",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-4 h-4 mr-2" }),
                "Classifica"
              ]
            }
          )
        ] })
      ]
    }
  );
};

const NOTIFICATION_CATEGORIES = {
  LEADERBOARD: "leaderboard_update",
  REWARDS: "rewards",
  MISSION: "mission_alert",
  BUZZ: "buzz",
  MAP_BUZZ: "map_buzz",
  WEEKLY: "weekly_summary"};
const getCategoryInfo = (type) => {
  switch (type) {
    case NOTIFICATION_CATEGORIES.LEADERBOARD:
      return {
        title: "Aggiornamento Classifica",
        color: "text-green-400"
      };
    case NOTIFICATION_CATEGORIES.REWARDS:
      return {
        title: "Ricompense Sbloccate",
        color: "text-yellow-400"
      };
    case NOTIFICATION_CATEGORIES.MISSION:
      return {
        title: "Avvisi Missione",
        color: "text-red-400"
      };
    case NOTIFICATION_CATEGORIES.BUZZ:
      return {
        title: "Buzz Notifications",
        color: "text-blue-400"
      };
    case NOTIFICATION_CATEGORIES.MAP_BUZZ:
      return {
        title: "Aggiornamenti Mappa",
        color: "text-purple-400"
      };
    case NOTIFICATION_CATEGORIES.WEEKLY:
      return {
        title: "Riassunto Settimanale",
        color: "text-cyan-400"
      };
    default:
      return {
        title: "Generali",
        color: "text-gray-400"
      };
  }
};

const NotificationCategory = ({
  category,
  notifications,
  onSelect,
  onDelete
}) => {
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  const categoryInfo = getCategoryInfo(category);
  const unreadCount = notifications.filter((n) => !n.read).length;
  const handleToggle = () => {
    setIsExpanded(!isExpanded);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "rounded-[24px] transition-all duration-300 hover:shadow-lg mb-4 relative overflow-hidden",
      style: {
        background: "rgba(0, 0, 0, 0.05)",
        backdropFilter: "blur(40px)",
        WebkitBackdropFilter: "blur(40px)",
        border: "1px solid rgba(255, 255, 255, 0.1)",
        boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
      },
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            onClick: handleToggle,
            className: "p-6 cursor-pointer flex items-center justify-between hover:bg-white/5 rounded-[20px] transition-colors",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center space-x-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white font-orbitron", children: categoryInfo.title }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-white/60", children: [
                  notifications.length,
                  " ",
                  notifications.length === 1 ? "notifica" : "notifiche",
                  unreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "ml-2 px-2 py-1 bg-gradient-to-r from-[#365EFF] to-[#FC1EFF] text-white text-xs rounded-full", children: [
                    unreadCount,
                    " nuove"
                  ] })
                ] })
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  animate: { rotate: isExpanded ? 180 : 0 },
                  transition: { duration: 0.3 },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-5 h-5 text-white/60" })
                }
              )
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { height: 0, opacity: 0 },
            animate: { height: "auto", opacity: 1 },
            exit: { height: 0, opacity: 0 },
            transition: { duration: 0.4, ease: "easeInOut" },
            className: "overflow-hidden",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-6 pb-6 space-y-3", children: notifications.map((notification, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                initial: { opacity: 0, x: -20 },
                animate: { opacity: 1, x: 0 },
                transition: { duration: 0.3, delay: index * 0.1 },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  NotificationItem,
                  {
                    notification,
                    onSelect: () => onSelect(notification.id),
                    onDelete: () => onDelete(notification.id)
                  }
                )
              },
              notification.id
            )) })
          }
        ) })
      ]
    }
  );
};

const NotificationsEmptyState = ({ onReload }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-500 py-8", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-12 h-12 mx-auto mb-4 text-white/30" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg", children: "Nessuna notifica da visualizzare" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/40 mt-2", children: "Le tue notifiche appariranno qui" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        variant: "outline",
        size: "sm",
        onClick: onReload,
        className: "mt-4",
        children: "Ricarica notifiche"
      }
    )
  ] });
};

const NotificationsList = ({
  notifications,
  filter,
  onMarkAsRead,
  onDelete,
  onReload
}) => {
  const filteredNotifications = () => {
    switch (filter) {
      case "unread":
        return notifications.filter((notification) => !notification.read);
      case "important":
        return notifications.filter((notification) => notification.type === "alert" || notification.type === "critical");
      default:
        return notifications;
    }
  };
  const groupedNotifications = () => {
    const filtered = filteredNotifications();
    const grouped = filtered.reduce((acc, notification) => {
      const category = notification.type || "general";
      if (!acc[category]) {
        acc[category] = [];
      }
      acc[category] = [...acc[category], notification];
      return acc;
    }, {});
    return grouped;
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: Object.keys(groupedNotifications()).length > 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: Object.entries(groupedNotifications()).map(([category, categoryNotifications]) => /* @__PURE__ */ jsxRuntimeExports.jsx(
    NotificationCategory,
    {
      category,
      notifications: categoryNotifications,
      onSelect: onMarkAsRead,
      onDelete
    },
    category
  )) }) : /* @__PURE__ */ jsxRuntimeExports.jsx(NotificationsEmptyState, { onReload }) });
};

const Notifications = () => {
  const [filter, setFilter] = reactExports.useState("all");
  const { notifications, markAsRead, deleteNotification, markAllAsRead, reloadNotifications } = useNotifications();
  const { playSound } = useBuzzSound();
  const { triggerHaptic } = usePWAHardwareStub();
  const { updateDynamicIslandOnRead, closeDynamicIsland } = useNotificationsDynamicIsland(notifications);
  useDynamicIslandSafety();
  useNotificationsAutoReload(reloadNotifications);
  const handleMarkAsRead = async (id) => {
    await triggerHaptic("tick");
    markAsRead(id);
    playSound();
    updateDynamicIslandOnRead(id);
  };
  const handleDeleteNotification = async (id) => {
    await triggerHaptic("selection");
    deleteNotification(id);
    playSound();
  };
  const handleMarkAllAsRead = async () => {
    await triggerHaptic("success");
    markAllAsRead();
    playSound();
    closeDynamicIsland();
  };
  const handleManualReload = () => {
    console.log("🔄 NOTIFICATIONS: Manual reload button pressed");
    reloadNotifications();
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "w-full m1-app-bg relative",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      transition: { duration: 0.5 },
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "m1-grain" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "main",
          {
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px) + 40px)",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.h1,
                {
                  className: "text-4xl font-orbitron font-bold text-center mt-6 mb-8",
                  initial: { opacity: 0, y: -10 },
                  animate: { opacity: 1, y: 0 },
                  transition: { delay: 0.2, duration: 0.5 },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "neon-text-cyan", children: "NO" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "neon-text-cyan", children: "TICE" })
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  className: "max-w-3xl mx-auto px-3 sm:px-4",
                  initial: { opacity: 0, y: 20 },
                  animate: { opacity: 1, y: 0 },
                  transition: { duration: 0.6 },
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      NotificationsHeader,
                      {
                        filter,
                        onFilterChange: setFilter,
                        onMarkAllAsRead: handleMarkAllAsRead,
                        onManualReload: handleManualReload
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      NotificationsList,
                      {
                        notifications,
                        filter,
                        onMarkAsRead: handleMarkAsRead,
                        onDelete: handleDeleteNotification,
                        onReload: handleManualReload
                      }
                    )
                  ]
                }
              )
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "fixed bottom-24 left-0 right-0 h-32 pointer-events-none z-[9]",
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            transition: { delay: 0.5, duration: 0.8 },
            style: {
              background: `
            radial-gradient(ellipse at 50% 100%, rgba(0, 209, 255, 0.18), transparent 70%),
            radial-gradient(ellipse at 20% 100%, rgba(123, 92, 255, 0.15), transparent 60%),
            radial-gradient(ellipse at 80% 100%, rgba(240, 89, 255, 0.12), transparent 65%)
          `,
              filter: "blur(20px)"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            id: "mission-bottom-nav-container",
            style: {
              position: "fixed",
              bottom: 0,
              left: 0,
              right: 0,
              width: "100vw",
              zIndex: 1e4,
              isolation: "isolate",
              transform: "translateZ(0)",
              willChange: "transform",
              display: "block",
              visibility: "visible",
              opacity: 1
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
          }
        )
      ]
    }
  );
};

async function buildEnhancedContext(userId, options) {
  try {
    const { data: userState } = await supabase.functions.invoke("get-user-state", {
      body: { userId }
    });
    let recentMessages = null;
    try {
      const { data } = await supabase.from("norah_messages").select("role, content").eq("user_id", userId).order("created_at", { ascending: false }).limit(10);
      recentMessages = data;
    } catch (err) {
      console.warn("[Enhanced Context] norah_messages not available:", err);
    }
    const { data: recentShots } = await supabase.from("agent_finalshot_attempts").select("created_at, result").eq("user_id", userId).order("created_at", { ascending: false }).limit(5);
    const mappedShots = (recentShots || []).map((shot) => ({
      createdAt: shot.created_at,
      result: shot.result
    }));
    const context = {
      userId,
      agentCode: userState?.agentCode || null,
      tier: userState?.tier || "free",
      cluesFound: userState?.cluesFound || 0,
      buzzCount: userState?.buzzAvailable || 0,
      mapGenerated: false,
      // TODO: query from user state
      locale: options?.locale || "it",
      route: options?.route,
      device: options?.device,
      geo: options?.geo,
      recentMessages: (recentMessages || []).reverse(),
      recentFinalShots: mappedShots,
      unreadNotifications: userState?.unreadNotifications || 0
    };
    return context;
  } catch (error) {
    console.error("[Enhanced Context Builder] Error:", error);
    return {
      userId,
      agentCode: null,
      tier: "free",
      cluesFound: 0,
      buzzCount: 0,
      mapGenerated: false,
      locale: options?.locale || "it",
      recentMessages: []
    };
  }
}

function buildSystemPrompt(context) {
  return `Tu sei **NORAH AI**, coach ufficiale di M1SSION™.

Obiettivi: rispondere in modo CONTESTUALE, UTILE e MOTIVANTE. Tono amichevole, micro-humor leggero, mai sarcastico.

## CONTESTO UTENTE (USA SEMPRE)
- User ID: ${context.userId}
- Agent Code: ${context.agentCode || "Non assegnato"}
- Tier: ${context.tier}
- Indizi trovati: ${context.cluesFound}
- BUZZ count: ${context.buzzCount}
- Mappa generata: ${context.mapGenerated ? "Sì" : "No"}
${context.geo ? `- Posizione: ${context.geo.city || "Non disponibile"}` : "- Posizione: GPS non attivo"}

## REGOLE DURE
1. Parla in **italiano**. Prima **risposta diretta**, poi dettagli, poi **CTA** (max 3).
2. Non inventare fatti: se la domanda riguarda BUZZ/BUZZ Map/Final Shot/Regole → usa **retrieve_docs** (RAG) prima di rispondere.
3. Per domande operative (premi vicino, stato, abbonamento) → usa i **tool**.
4. Se non sei sicura e confidence<0.55, fai **una sola** domanda di chiarimento.
5. Rispetta il **tier** e lo **stato** utente dal contesto; niente azioni oltre i limiti.
6. Memoria solo se l'utente lo chiede ("ricorda") e conferma.

## BLUEPRINT OBBLIGATORIO DI OUTPUT
1) Risposta diretta (max 2 frasi).
2) 2–3 bullet di dettaglio contestuale (preferisci ciò che viene da documenti M1SSION).
3) 2–3 CTA pertinenti (formato [Azione]).
4) Una riga motivazionale breve.

## STILE
- Frasi brevi, concrete. Emoji con parsimonia (max 1).
- Quando citi info da RAG: "(fonte: documenti M1SSION)".
- Evita filler ("capisco la tua frustrazione…") se non serve.

Sei pronta, NORAH?`;
}
function buildDeveloperPrompt() {
  return `## DEVELOPER INSTRUCTIONS

- Usa SEMPRE il blueprint output
- Per domande su BUZZ/BUZZ Map/Final Shot: PRIMA retrieve_docs, POI rispondi
- Se l'utente chiede azione (premi vicini, stato): USA i tool
- NO risposte generiche: personalizza con contesto utente
- Temperature: 0.2 per facts, 0.5 per motivazione/coaching
- Max output: 400 token

## TOOLS DISPONIBILI
- retrieve_docs: cerca nella KB M1SSION
- get_user_state: stato utente completo  
- get_nearby_prizes: premi nelle vicinanze (GPS required)
- open_support_ticket: apri ticket supporto

## ESEMPI

**Q**: "Cos'è il BUZZ?"
**A**: Usa retrieve_docs({query: "BUZZ definizione", k: 3}), poi formatta con blueprint

**Q**: "Premi vicino a me?"
**A**: Usa get_nearby_prizes, lista premi, suggerisci mappa

**Q**: "Non funziona pagamento"
**A**: Usa open_support_ticket, rassicura, CTA alternative`;
}

async function executeToolCall(toolCall) {
  const { name, arguments: argsJson } = toolCall.function;
  try {
    const args = JSON.parse(argsJson);
    let result;
    switch (name) {
      case "get_user_state":
        result = await callEdgeFunction("get-user-state", args);
        break;
      case "get_nearby_prizes":
        result = await callEdgeFunction("get-nearby-prizes", args);
        break;
      case "retrieve_docs":
        result = await callEdgeFunction("rag-search", args);
        break;
      case "open_support_ticket":
        result = await callEdgeFunction("open-support-ticket", args);
        break;
      default:
        throw new Error(`Unknown tool: ${name}`);
    }
    return {
      tool_call_id: toolCall.id,
      role: "tool",
      name,
      content: JSON.stringify(result)
    };
  } catch (error) {
    console.error(`[Tool Execution] ${name} failed:`, error);
    return {
      tool_call_id: toolCall.id,
      role: "tool",
      name,
      content: JSON.stringify({
        error: error instanceof Error ? error.message : "Unknown error"
      })
    };
  }
}
async function callEdgeFunction(functionName, args) {
  const { data, error } = await supabase.functions.invoke(functionName, {
    body: args
  });
  if (error) throw error;
  return data;
}
async function executeToolCalls(toolCalls) {
  return Promise.all(toolCalls.map(executeToolCall));
}

const TOOL_SCHEMAS = [
  {
    name: "get_user_state",
    description: "Legge lo stato completo dell'utente: tier, progressi, notifiche, BUZZ disponibili",
    parameters: {
      type: "object",
      properties: {
        userId: {
          type: "string",
          description: "ID utente (UUID)"
        }
      },
      required: ["userId"]
    }
  },
  {
    name: "get_nearby_prizes",
    description: "Trova premi e aree rilevanti entro un raggio dalla posizione utente",
    parameters: {
      type: "object",
      properties: {
        lat: {
          type: "number",
          description: "Latitudine"
        },
        lng: {
          type: "number",
          description: "Longitudine"
        },
        radiusKm: {
          type: "number",
          description: "Raggio di ricerca in km",
          default: 5
        }
      },
      required: ["lat", "lng"]
    }
  },
  {
    name: "retrieve_docs",
    description: "RAG: cerca risposte su regole, FAQ, policy, changelog M1SSION",
    parameters: {
      type: "object",
      properties: {
        query: {
          type: "string",
          description: "Query di ricerca semantica"
        },
        k: {
          type: "integer",
          description: "Numero di risultati",
          default: 6
        }
      },
      required: ["query"]
    }
  },
  {
    name: "open_support_ticket",
    description: "Apre un ticket di supporto per problemi tecnici o richieste utente",
    parameters: {
      type: "object",
      properties: {
        userId: {
          type: "string",
          description: "ID utente"
        },
        issue: {
          type: "string",
          description: "Descrizione del problema"
        },
        category: {
          type: "string",
          description: "Categoria: technical, billing, gameplay, other",
          enum: ["technical", "billing", "gameplay", "other"]
        }
      },
      required: ["userId", "issue"]
    }
  }
];

const STOPWORDS_IT = /* @__PURE__ */ new Set([
  "il",
  "lo",
  "la",
  "i",
  "gli",
  "le",
  "un",
  "una",
  "di",
  "da",
  "a",
  "in",
  "su",
  "per",
  "con",
  "tra",
  "fra",
  "e",
  "ma",
  "o",
  "che",
  "come",
  "quando",
  "dove",
  "cosa",
  "mi",
  "ti",
  "si",
  "ci",
  "vi",
  "ne",
  "me",
  "te",
  "lui",
  "lei",
  "noi",
  "voi",
  "loro"
]);
const STOPWORDS_EN = /* @__PURE__ */ new Set([
  "the",
  "a",
  "an",
  "is",
  "are",
  "was",
  "were",
  "be",
  "been",
  "being",
  "have",
  "has",
  "had",
  "do",
  "does",
  "did",
  "will",
  "would",
  "could",
  "should",
  "may",
  "might",
  "can",
  "to",
  "of",
  "in",
  "on",
  "at",
  "for",
  "with",
  "from"
]);
const DIACRITICS_MAP = {
  "à": "a",
  "á": "a",
  "â": "a",
  "ã": "a",
  "ä": "a",
  "å": "a",
  "è": "e",
  "é": "e",
  "ê": "e",
  "ë": "e",
  "ì": "i",
  "í": "i",
  "î": "i",
  "ï": "i",
  "ò": "o",
  "ó": "o",
  "ô": "o",
  "õ": "o",
  "ö": "o",
  "ù": "u",
  "ú": "u",
  "û": "u",
  "ü": "u",
  "ñ": "n",
  "ç": "c",
  "ß": "ss"
};
const SYNONYMS = {
  "finalshot": ["final shot", "fs", "finalshoot", "final shoot", "finale shot", "colpo finale", "tentativo finale"],
  "mission": ["m1ssion", "misione", "missione", "misión", "m1", "gioco mission", "gioco m1ssion", "mssn"],
  "buzz": ["buz", "bus", "buss", "indizi", "clue"],
  "buzzmap": ["buzz map", "buz map", "mappa buzz", "map buzz", "buz mappa", "mappa", "tasto mappa", "area"],
  "plan": ["piano", "piani", "abbonamento", "abbo", "subscription", "abbonamenti", "plans"],
  "indizio": ["clue", "indizi", "clues", "hint", "hints"],
  "probabilità": ["prob", "probability", "chance", "probabilita"],
  "pattern": ["patterns", "schema", "schemi", "correlazione"],
  "decodifica": ["decode", "decod", "decipher", "decifra"],
  "help": ["aiuto", "inizio", "iniziare", "inizia", "come", "cosa", "aiutami", "aiutare", "assistenza", "come si fa", "cosa posso fare", "spiega", "come faccio", "come fare"],
  "progress": ["progresso", "avanzamento", "stato"],
  "mentor": ["mentore", "guida", "coach", "consiglio", "suggerimento"],
  "leaderboard": ["classifica", "ranking", "leader"],
  "community": ["comunità", "comunita"],
  "privacy": ["privata", "dati", "sicurezza"]
};
function removeDiacritics(text) {
  return text.split("").map((char) => DIACRITICS_MAP[char] || char).join("");
}
function lightStem(word) {
  if (word.length < 4) return word;
  const suffixes = ["zione", "zioni", "mente", "are", "ere", "ire", "ato", "ita", "ito"];
  for (const suffix of suffixes) {
    if (word.endsWith(suffix)) {
      return word.slice(0, -suffix.length);
    }
  }
  return word;
}
function normalize$1(text) {
  if (!text || typeof text !== "string") return [];
  let normalized = text.toLowerCase().trim();
  normalized = removeDiacritics(normalized);
  normalized = normalized.replace(/[^\\w\\s]/g, " ");
  normalized = normalized.replace(/\\s+/g, " ").trim();
  const tokens = normalized.split(" ").filter((t) => t.length > 0);
  const filtered = tokens.filter(
    (t) => !STOPWORDS_IT.has(t) && !STOPWORDS_EN.has(t)
  );
  const stemmed = filtered.map(lightStem);
  return stemmed;
}
function expandSynonyms(tokens) {
  const expanded = new Set(tokens);
  for (const token of tokens) {
    for (const [canonical, variants] of Object.entries(SYNONYMS)) {
      if (variants.some((v) => normalize$1(v).includes(token)) || canonical === token) {
        expanded.add(canonical);
        variants.forEach((v) => normalize$1(v).forEach((t) => expanded.add(t)));
      }
    }
  }
  return Array.from(expanded);
}
function levenshtein(a, b) {
  if (a.length === 0) return b.length;
  if (b.length === 0) return a.length;
  const matrix = [];
  for (let i = 0; i <= b.length; i++) {
    matrix[i] = [i];
  }
  for (let j = 0; j <= a.length; j++) {
    matrix[0][j] = j;
  }
  for (let i = 1; i <= b.length; i++) {
    for (let j = 1; j <= a.length; j++) {
      if (b.charAt(i - 1) === a.charAt(j - 1)) {
        matrix[i][j] = matrix[i - 1][j - 1];
      } else {
        matrix[i][j] = Math.min(
          matrix[i - 1][j - 1] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j] + 1
        );
      }
    }
  }
  return matrix[b.length][a.length];
}
function levenshteinRatio(a, b) {
  const maxLen = Math.max(a.length, b.length);
  if (maxLen === 0) return 1;
  const distance = levenshtein(a, b);
  return 1 - distance / maxLen;
}
function trigrams(text) {
  const padded = `  ${text}  `;
  const grams = /* @__PURE__ */ new Set();
  for (let i = 0; i < padded.length - 2; i++) {
    grams.add(padded.slice(i, i + 3));
  }
  return grams;
}
function trigramSimilarity(a, b) {
  const gramsA = trigrams(a);
  const gramsB = trigrams(b);
  const intersection = new Set([...gramsA].filter((x) => gramsB.has(x)));
  const union = /* @__PURE__ */ new Set([...gramsA, ...gramsB]);
  if (union.size === 0) return 0;
  return intersection.size / union.size;
}
function fuzzyScore(query, target) {
  const leven = levenshteinRatio(query, target);
  const trigram = trigramSimilarity(query, target);
  return query.length < 5 ? leven * 0.3 + trigram * 0.7 : leven * 0.5 + trigram * 0.5;
}

const M1SSION_DICT = /* @__PURE__ */ new Set([
  "norah",
  "mission",
  "m1ssion",
  "m1",
  "mssn",
  "misison",
  "missione",
  "finalshot",
  "final",
  "shot",
  "fs",
  "finalshoot",
  "finale",
  "buzz",
  "buzzmap",
  "buz",
  "bus",
  "mappa",
  "indizi",
  "indizio",
  "clue",
  "clues",
  "pattern",
  "patterns",
  "schema",
  "probabilita",
  "probability",
  "prob",
  "aiuto",
  "help",
  "inizio",
  "iniziare",
  "inizia",
  "piani",
  "piano",
  "abbonamento",
  "abbo",
  "subscription",
  "regole",
  "rules",
  "istruzioni",
  "classifica",
  "leaderboard",
  "ranking",
  "mentor",
  "mentore",
  "guida",
  "coach",
  "progress",
  "progresso",
  "avanzamento",
  "decode",
  "decodifica",
  "decifra",
  "coordinate",
  "luogo",
  "posto",
  "premio",
  // Slang/typos IT
  "nn",
  "xke",
  "ke",
  "cmq",
  "anke",
  "xo",
  "pk",
  "qnd",
  "dv",
  "capito",
  "capisco",
  "piace",
  "vado",
  "cosa",
  "come",
  "che",
  "non",
  "dove",
  "quando",
  "perche",
  "perché",
  "quindi"
]);
const SLANG_MAP = {
  "nn": "non",
  "xke": "perche",
  "xkè": "perche",
  "xké": "perche",
  "xché": "perche",
  "ke": "che",
  "cm": "come",
  "qls": "qualcosa",
  "qlcs": "qualcosa",
  "tvb": "ti voglio bene",
  "cmq": "comunque",
  "anke": "anche",
  "xo": "pero",
  "pk": "perche",
  "qnd": "quando",
  "dv": "dove",
  "pke": "perche",
  "qlc": "qualche",
  "nn so": "non so",
  "pls": "per favore",
  "plz": "per favore",
  "t prego": "ti prego",
  "xk": "perche",
  "raga": "ragazzo",
  "boh": "non so",
  "nn capito": "non capito",
  "nn ho": "non ho",
  "ah si certo": "sarcasmo",
  "come no": "sarcasmo"
};
function damerauLevenshtein(a, b) {
  const lenA = a.length;
  const lenB = b.length;
  const maxDist = lenA + lenB;
  const H = Array(lenA + 2).fill(null).map(() => Array(lenB + 2).fill(0));
  H[0][0] = maxDist;
  for (let i = 0; i <= lenA; i++) {
    H[i + 1][0] = maxDist;
    H[i + 1][1] = i;
  }
  for (let j = 0; j <= lenB; j++) {
    H[0][j + 1] = maxDist;
    H[1][j + 1] = j;
  }
  const da = {};
  const sigma = /* @__PURE__ */ new Set([...a, ...b]);
  sigma.forEach((ch) => da[ch] = 0);
  for (let i = 1; i <= lenA; i++) {
    let db = 0;
    for (let j = 1; j <= lenB; j++) {
      const k = da[b[j - 1]] || 0;
      const l = db;
      let cost = 1;
      if (a[i - 1] === b[j - 1]) {
        cost = 0;
        db = j;
      }
      H[i + 1][j + 1] = Math.min(
        H[i][j] + cost,
        // substitution
        H[i + 1][j] + 1,
        // insertion
        H[i][j + 1] + 1,
        // deletion
        H[k][l] + (i - k - 1) + 1 + (j - l - 1)
        // transposition
      );
    }
    da[a[i - 1]] = i;
  }
  return H[lenA + 1][lenB + 1];
}
function correctSpelling(word) {
  const lower = word.toLowerCase();
  if (M1SSION_DICT.has(lower)) return lower;
  let bestMatch = word;
  let minDist = Infinity;
  const threshold = Math.max(2, Math.floor(lower.length * 0.4));
  for (const dictWord of M1SSION_DICT) {
    const dist = damerauLevenshtein(lower, dictWord);
    if (dist < minDist && dist <= threshold) {
      minDist = dist;
      bestMatch = dictWord;
    }
  }
  return bestMatch;
}
function expandSlang(text) {
  const words = text.toLowerCase().trim().split(/\s+/);
  const expanded = words.map((w) => SLANG_MAP[w] || w);
  return expanded.join(" ");
}
function correctPhrase(text) {
  const slangExpanded = expandSlang(text);
  const words = slangExpanded.toLowerCase().trim().split(/\s+/);
  const corrected = words.map((w) => correctSpelling(w));
  return corrected.join(" ");
}

function isMultiIntent(input) {
  if (!input || typeof input !== "string") return false;
  const separators = [" e ", " e poi ", ", ", "; ", " & ", " più ", " anche "];
  const hasSeparator = separators.some((sep) => input.toLowerCase().includes(sep));
  const multiIntentPatterns = [
    /spiega .+ e .+/i,
    /cos[ae] (sono|è) .+ e .+/i,
    /dimmi .+ e .+/i,
    /(.+) e (.+) in breve/i
  ];
  const hasPattern = multiIntentPatterns.some((pattern) => pattern.test(input));
  return hasSeparator || hasPattern;
}
const INTENT_PRIORITY = {
  "about_m1ssion": 10,
  "about_buzz": 9,
  "about_buzz_map": 8,
  "about_finalshot": 7,
  "about_subscriptions": 6,
  "help": 5,
  "mentor": 4,
  "progress": 3,
  "pattern": 2,
  "unknown": 0
};
function detectMultiIntents(input) {
  if (!input || typeof input !== "string") {
    return [];
  }
  const lower = input.toLowerCase().trim();
  const fragments = lower.split(/\s+e\s+|\s+e\s+poi\s+|,\s+|;\s+|\s+&\s+|\s+più\s+|\s+anche\s+|\/|\s+o\s+/i).map((f) => f.trim()).filter((f) => f.length > 0);
  if (fragments.length === 1) {
    const match = lower.match(/spiega\s+(.+?)\s+e\s+(.+?)(?:\s+in\s+breve)?$/i);
    if (match && match[1] && match[2]) {
      fragments.push(match[1].trim(), match[2].trim());
    }
  }
  console.log("[MultiIntent] Fragments:", fragments);
  const parsed = [];
  for (const fragment of fragments) {
    if (fragment.length < 3) continue;
    const result = routeIntent(fragment);
    if (result.confidence >= 0.4 && result.intent !== "unknown") {
      parsed.push({
        intent: result.intent,
        confidence: result.confidence,
        fragment
      });
    }
  }
  const unique = /* @__PURE__ */ new Map();
  for (const item of parsed) {
    const existing = unique.get(item.intent);
    if (!existing || item.confidence > existing.confidence) {
      unique.set(item.intent, item);
    }
  }
  const finalIntents = Array.from(unique.values()).sort((a, b) => {
    const priorityDiff = (INTENT_PRIORITY[b.intent] || 0) - (INTENT_PRIORITY[a.intent] || 0);
    if (priorityDiff !== 0) return priorityDiff;
    return b.confidence - a.confidence;
  }).slice(0, 3);
  console.log("[MultiIntent] Detected intents:", finalIntents);
  return finalIntents;
}

const SPOILER_PATTERNS = [
  /dov[eè]\s+(è|si\s+trova|sta)/i,
  /coord[iy]nat[ae]/i,
  /indirizzo\s+(esatt[oa]|precis[oa])/i,
  /dimmi\s+(dov[eè]|il\s+luogo)/i,
  /qual['\s]?è\s+(il\s+posto|la\s+posizione)/i,
  /rivel[ao]/i,
  /\bpremi[oa]\b.*\bdov[eè]\b/i
];
const SINGLE_WORD_MAP = {
  "mission": "about_mission",
  "m1ssion": "about_mission",
  "m1": "about_mission",
  "buzz": "about_buzz",
  "indizi": "about_buzz",
  "finalshot": "about_finalshot",
  "fs": "about_finalshot",
  "finale": "about_finalshot",
  "mappa": "buzz_map",
  "map": "buzz_map",
  "buzzmap": "buzz_map",
  "abbonamenti": "plans",
  "abbo": "plans",
  "piani": "plans",
  "piano": "plans",
  "prezzi": "plans",
  "pricing": "plans",
  "plans": "plans",
  "plan": "plans",
  "probabilità": "probability",
  "prob": "probability",
  "pattern": "pattern",
  "decodifica": "decode",
  "decode": "decode",
  "decod": "decode",
  "aiuto": "help",
  "help": "help",
  "aiutami": "help",
  "inizio": "help",
  "iniziare": "help",
  "inizia": "help",
  "abbonamento": "plans",
  "regole": "rules",
  "rules": "rules",
  "classifica": "leaderboard",
  "leaderboard": "leaderboard",
  "progress": "progress",
  "stato": "progress",
  "mentor": "mentor",
  "mentore": "mentor",
  "consiglio": "mentor",
  "profilo": "profile",
  "profile": "profile",
  "privacy": "data_privacy",
  "dati": "data_privacy",
  "community": "community",
  "comunità": "community"
};
const INTENT_TRIGGERS = {
  about_mission: ["mission", "m1ssion", "missione", "gioco", "funziona", "cosa è"],
  about_buzz: ["buzz", "indizi", "clue", "segnale", "invia"],
  about_finalshot: ["finalshot", "final shot", "fs", "colpo finale", "tentativo finale", "vincere"],
  buzz_map: ["buzz map", "buz map", "mappa buzz", "mappa", "tasto mappa"],
  rules: ["regole", "istruzioni", "tutorial", "come gioca"],
  decode: ["decodifica", "decode", "decifra", "traduc", "significa"],
  classify: ["classifica indizi", "categoria", "organizza"],
  probability: ["probabilità", "prob", "chance", "possibilità"],
  pattern: ["pattern", "schema", "correlazione", "collegamento"],
  mentor: ["consiglio", "strategia", "suggerimento", "come procedo", "mentore"],
  profile: ["chi sono", "codice", "agent code", "profilo"],
  progress: ["progress", "stato", "quanti indizi", "avanzamento"],
  plans: ["abbonamento", "abbo", "piano", "pricing", "subscription", "prezzi", "paga", "gratis", "prezzo", "costa", "quanto costa", "gratuito"],
  leaderboard: ["classifica", "ranking", "leader"],
  community: ["community", "comunità"],
  data_privacy: ["privacy", "dati", "sicurezza", "privata"],
  help: ["aiuto", "help", "cosa puoi", "aiutami", "comandi"],
  smalltalk: ["ciao", "buongiorno", "buonasera", "grazie", "hey"],
  no_spoiler: [],
  clarify_needed: [],
  saluto: ["ciao", "salve", "buongiorno", "buonasera", "hey", "ehi", "hola", "hello"],
  no_buzz: ["non voglio buzz", "senza buzz", "alternative buzz", "no buzz", "non uso buzz", "se non voglio"],
  diff_buzz_vs_map: ["differenza buzz map", "buzz vs map", "buzz o map", "differenze"],
  help_start: ["come inizio", "da dove inizio", "come si inizia", "iniziare", "primo passo"],
  rules_short: ["regole veloci", "regole rapide", "summary regole", "regole brevi"],
  unknown: []
};
const FUZZY_MIN_CONF = 0.52;
const HIGH_CONFIDENCE_THRESHOLD = 0.75;
function mapIntentToNeeds(intent, input) {
  const lowerInput = input.toLowerCase();
  if (intent === "about_buzz" || intent === "about_mission" || intent === "about_finalshot" || intent === "diff_buzz_vs_map" || intent === "rules" || intent === "rules_short" || lowerInput.match(/cos[\'ì]è|cosa è|cosa significa|differenza|spiega|final shot|buzz map|buzz/i)) {
    return {
      needs_rag: true,
      needs_tool: ["retrieve_docs", "get_user_state"]
    };
  }
  if (intent === "buzz_map" || intent === "progress" || lowerInput.match(/premi vicino|vedi premi|cosa c\'è qui|mappa|vicino a me/i)) {
    return {
      needs_rag: false,
      needs_tool: ["get_nearby_prizes", "get_user_state"]
    };
  }
  if (lowerInput.match(/non funziona|errore|bug|pagamento|problema/i)) {
    return {
      needs_rag: false,
      needs_tool: ["open_support_ticket", "get_user_state"]
    };
  }
  if (intent === "plans" || intent === "profile" || intent === "mentor") {
    return {
      needs_rag: false,
      needs_tool: ["get_user_state"]
    };
  }
  return {
    needs_rag: false,
    needs_tool: ["get_user_state"]
  };
}
function routeIntent(input) {
  if (!input || typeof input !== "string") {
    return {
      intent: "unknown",
      confidence: 0.1,
      needs_rag: false,
      needs_tool: []
    };
  }
  const rawNormalized = input.toLowerCase().trim();
  if (isMultiIntent(input)) {
    const multiIntents = detectMultiIntents(input);
    if (multiIntents.length >= 2) {
      console.log("[NORAH-v5] Multi-intent detected:", multiIntents);
      return {
        intent: "help",
        // Use help as umbrella for multi-intent
        confidence: 0.85,
        multiIntents
      };
    }
  }
  for (const pattern of SPOILER_PATTERNS) {
    if (pattern.test(rawNormalized)) {
      console.log("[NORAH-v4] Spoiler guard triggered");
      return {
        intent: "no_spoiler",
        confidence: 1,
        needs_rag: false,
        needs_tool: []
      };
    }
  }
  const spellCorrected = correctPhrase(rawNormalized);
  const tokens = normalize$1(spellCorrected);
  const expandedTokens = expandSynonyms(tokens);
  console.log("[NORAH-v4] Intent routing:", { input, spellCorrected, tokens, expandedTokens });
  if (tokens.length === 1) {
    const singleWord = tokens[0];
    if (SINGLE_WORD_MAP[singleWord]) {
      const matchedIntent = SINGLE_WORD_MAP[singleWord];
      const needs = mapIntentToNeeds(matchedIntent, input);
      console.debug("[NORAH] Single-word match:", singleWord, "→", matchedIntent);
      return {
        intent: matchedIntent,
        confidence: 0.95,
        needs_rag: needs.needs_rag,
        needs_tool: needs.needs_tool
      };
    }
  }
  const scores = [];
  for (const [intentKey, triggers] of Object.entries(INTENT_TRIGGERS)) {
    const intent = intentKey;
    if (intent === "no_spoiler" || intent === "unknown") continue;
    let maxScore = 0;
    for (const trigger of triggers) {
      const triggerTokens = normalize$1(trigger);
      const overlap = expandedTokens.filter((t) => triggerTokens.includes(t)).length;
      const overlapScore = overlap / Math.max(triggerTokens.length, 1);
      const fuzzy = fuzzyScore(rawNormalized, trigger);
      const score = Math.max(overlapScore * 0.6 + fuzzy * 0.4, fuzzy);
      if (score > maxScore) {
        maxScore = score;
      }
    }
    if (maxScore > 0) {
      scores.push({ intent, score: maxScore });
    }
  }
  scores.sort((a, b) => b.score - a.score);
  console.debug("[NORAH] Intent scores:", scores.slice(0, 3));
  if (scores.length > 0 && scores[0].score >= FUZZY_MIN_CONF) {
    const topIntent = scores[0].intent;
    const confidence = scores[0].score >= HIGH_CONFIDENCE_THRESHOLD ? 0.9 : 0.7;
    const needs = mapIntentToNeeds(topIntent, input);
    console.debug("[NORAH] Intent routed:", topIntent, "confidence:", confidence, "needs:", needs);
    return {
      intent: topIntent,
      confidence,
      needs_rag: needs.needs_rag,
      needs_tool: needs.needs_tool
    };
  }
  if (scores.length > 0 && scores[0].score >= 0.45) {
    const topTwo = scores.slice(0, 2).map((s) => s.intent);
    console.log("[NORAH-v6.2] Clarify zone, suggesting:", topTwo);
    return {
      intent: "help",
      confidence: 0.5,
      slots: { clarify: true, suggestedIntents: topTwo },
      needs_rag: false,
      needs_tool: ["get_user_state"]
    };
  }
  const keywordMap = {
    "mission": "about_mission",
    "m1ssion": "about_mission",
    "finalshot": "about_finalshot",
    "buzz": "about_buzz",
    "plan": "plans",
    "piani": "plans",
    "help": "help",
    "aiuto": "help",
    "spiega": "help",
    "come si fa": "help",
    "come faccio": "help",
    "come fare": "help",
    "spiegami": "help"
  };
  for (const [keyword, intent] of Object.entries(keywordMap)) {
    if (expandedTokens.includes(keyword)) {
      const needs = mapIntentToNeeds(intent, input);
      console.log("[NORAH-v4] Fallback keyword match:", keyword, "→", intent);
      return {
        intent,
        confidence: 0.55,
        needs_rag: needs.needs_rag,
        needs_tool: needs.needs_tool
      };
    }
  }
  if (scores.length > 0 && scores[0].score >= 0.3) {
    console.log("[NORAH-v4] Low confidence, defaulting to help");
    return {
      intent: "help",
      confidence: 0.5,
      slots: {
        suggestedIntents: scores.slice(0, 3).map((s) => s.intent)
      },
      needs_rag: false,
      needs_tool: ["get_user_state"]
    };
  }
  console.log("[NORAH-v4] No intent match, defaulting to help");
  return {
    intent: "help",
    confidence: 0.4,
    needs_rag: false,
    needs_tool: ["get_user_state"]
  };
}
function shouldClarify(intentResult) {
  return intentResult.confidence < 0.55;
}
function getClarificationQuestion(message) {
  return "Non sono sicura di aver capito. Vuoi sapere di BUZZ, BUZZ Map, Final Shot o qualcos'altro? Dimmi pure!";
}

async function processAIRequest(options) {
  const { userId, userMessage, conversationHistory = [] } = options;
  const traceId = crypto.randomUUID();
  console.log(`[AI Gateway] traceId:${traceId} userId:${userId} route:${options.route}`);
  try {
    const context = await buildEnhancedContext(userId, {
      route: options.route,
      geo: options.geo,
      locale: options.locale || "it"
    });
    const intentResult = routeIntent(userMessage);
    const shortTraceId = traceId.substring(0, 8);
    console.log(`[AI Gateway traceId:${shortTraceId}] Intent:`, {
      intent: intentResult.intent,
      confidence: intentResult.confidence,
      needs_rag: intentResult.needs_rag,
      needs_tool: intentResult.needs_tool
    });
    let ragContext = "";
    if (intentResult.needs_rag) {
      console.log(`[AI Gateway traceId:${shortTraceId}] Router flagged RAG - fetching docs...`);
      try {
        const { data: ragData, error: ragError } = await supabase.functions.invoke("norah-rag-search", {
          body: { query: userMessage, k: 6 }
        });
        if (!ragError && ragData?.results?.length > 0) {
          ragContext = "\n\n📚 **Knowledge Base (M1SSION Docs)**:\n" + ragData.results.map(
            (r, i) => `${i + 1}. "${r.title}": ${r.chunk_text} (rilevanza: ${(r.similarity * 100).toFixed(0)}%)`
          ).join("\n\n");
          console.log(`[AI Gateway traceId:${shortTraceId}] RAG: ${ragData.results.length} chunks added`);
        } else {
          console.log(`[AI Gateway traceId:${shortTraceId}] RAG returned 0 results - trying local cache`);
          const { get: getLocalCache } = await __vitePreload(async () => { const { get: getLocalCache } = await import('./localCache.H3hrcTrl.js');return { get: getLocalCache }},true?[]:void 0);
          const localKnowledge = getLocalCache(userMessage);
          if (localKnowledge) {
            console.log(`[AI Gateway traceId:${shortTraceId}] Local cache HIT`);
            ragContext = "\n\n📚 **Knowledge Base (Local Cache)**:\n" + localKnowledge;
          } else {
            console.log(`[AI Gateway traceId:${shortTraceId}] No local cache match - minimal fallback`);
            ragContext = "\n\n📚 **Knowledge Base**:\nNon ho trovato riferimenti specifici nel KB. Posso spiegarti in breve o aprire le regole ufficiali.";
          }
        }
      } catch (ragErr) {
        console.warn(`[AI Gateway traceId:${shortTraceId}] RAG fetch failed:`, ragErr);
        const { get: getLocalCache } = await __vitePreload(async () => { const { get: getLocalCache } = await import('./localCache.H3hrcTrl.js');return { get: getLocalCache }},true?[]:void 0);
        const localKnowledge = getLocalCache(userMessage);
        if (localKnowledge) {
          console.log(`[AI Gateway traceId:${shortTraceId}] Local cache FALLBACK on RAG error`);
          ragContext = "\n\n📚 **Knowledge Base (Local Cache - RAG Error)**:\n" + localKnowledge;
        }
      }
    }
    const systemPrompt = buildSystemPrompt(context) + ragContext;
    const developerPrompt = buildDeveloperPrompt();
    const messages = [
      { role: "system", content: systemPrompt },
      { role: "system", content: developerPrompt },
      ...conversationHistory,
      { role: "user", content: userMessage }
    ];
    const { data: fxData, error: fxError } = await supabase.functions.invoke("chat", {
      body: {
        messages,
        tools: TOOL_SCHEMAS,
        tool_choice: "auto"
      }
    });
    if (fxError) {
      console.error(`[AI Gateway] traceId:${traceId} chat error:`, fxError);
      return { message: "Problema con il servizio AI. Riprova tra poco.", suggestedActions: [] };
    }
    let finalMessage = fxData?.message || "Nessuna risposta dal modello.";
    if (fxData?.tool_calls && Array.isArray(fxData.tool_calls)) {
      console.log(`[AI Gateway] traceId:${traceId} executing ${fxData.tool_calls.length} tools`);
      try {
        const toolResults = await executeToolCalls(fxData.tool_calls);
        const messagesWithTools = [
          ...messages,
          { role: "assistant", content: fxData.message, tool_calls: fxData.tool_calls },
          ...toolResults
        ];
        const { data: finalData, error: finalError } = await supabase.functions.invoke("chat", {
          body: { messages: messagesWithTools }
        });
        if (finalError) {
          console.error(`[AI Gateway] traceId:${traceId} tool response error:`, finalError);
        } else {
          finalMessage = finalData?.message || finalMessage;
        }
      } catch (toolError) {
        console.error(`[AI Gateway] traceId:${traceId} tool execution failed:`, toolError);
      }
    }
    const response = {
      message: finalMessage
    };
    await logAIInteraction(userId, userMessage, response.message, context);
    console.log(`[AI Gateway] traceId:${traceId} completed`);
    return response;
  } catch (error) {
    console.error(`[AI Gateway] traceId:${traceId} error:`, error);
    console.error("[AI Gateway] Error:", error);
    return {
      message: "Mi dispiace, ho avuto un problema tecnico. Riprova tra poco.",
      suggestedActions: []
    };
  }
}
async function logAIInteraction(userId, userMessage, aiResponse, context) {
  try {
    const { data: session } = await supabase.from("ai_sessions").select("id").eq("user_id", userId).order("started_at", { ascending: false }).limit(1).maybeSingle();
    let sessionId = session?.id;
    if (!sessionId) {
      const { data: newSession } = await supabase.from("ai_sessions").insert({
        user_id: userId,
        locale: context.locale,
        subscription_tier: context.tier
      }).select("id").single();
      sessionId = newSession?.id;
    }
    if (sessionId) {
      await supabase.from("ai_events").insert({
        session_id: sessionId,
        user_id: userId,
        event_type: "ai_response",
        payload: {
          user_message: userMessage.substring(0, 200),
          ai_response: aiResponse.substring(0, 200),
          context_tier: context.tier,
          context_clues: context.cluesFound
        }
      });
    }
  } catch (error) {
    console.error("[AI Gateway] Failed to log interaction:", error);
  }
}

const faq = {
	mission: {
		q: [
			"cos'è m1ssion",
			"parlami di m1ssion",
			"come funziona m1ssion",
			"spiega m1ssion",
			"che gioco è",
			"mission cosa"
		],
		a: [
			"M1SSION è un gioco di intelligence geolocalizzato. Raccogli indizi tramite BUZZ, analizzali e localizza il premio con il Final Shot.",
			"M1SSION ti sfida a trovare un premio reale nascosto in città. Usa BUZZ per ottenere indizi, correlali e indovina la posizione finale.",
			"È un'esperienza di caccia al tesoro high-tech: indizi crittografati, geofencing, Final Shot ad alta precisione. Il premio è reale.",
			"M1SSION combina intelligence, geolocalizzazione e analisi dati. Ogni settimana un nuovo premio da trovare, ogni indizio è un pezzo del puzzle.",
			"Un gioco di ricerca e deduzione: accumuli dati tramite BUZZ, li analizzi, trovi pattern, restringi l'area e infine spari il Final Shot.",
			"M1SSION è la tua missione settimanale: usa strumenti di intelligence per scoprire dove si nasconde il premio. Vince chi deduce meglio.",
			"Pensa a una caccia al tesoro moderna: no mappe stampate, solo dati crittografati e strumenti digitali. BUZZ, analisi, Final Shot.",
			"È un gioco strategico: più indizi hai, più precisa è la tua analisi. Non è fortuna, è metodo.",
			"M1SSION trasforma il tuo telefono in uno strumento da agente: raccogli intelligence, decifri pattern, esegui il colpo finale.",
			"Ogni settimana una nuova missione, un nuovo premio, nuovi indizi. L'obiettivo: essere più smart degli altri agenti."
		]
	},
	buzz: {
		q: [
			"cos'è il buzz",
			"come funziona buzz",
			"buzz a cosa serve",
			"come ottengo indizi",
			"buzz serve",
			"che fa buzz"
		],
		a: [
			"BUZZ è il tuo strumento per ottenere indizi. Ogni BUZZ rilascia un nuovo frammento di informazione sulla posizione del premio.",
			"Usa BUZZ per richiedere indizi. Più BUZZ fai, più informazioni accumuli. Correlale per capire dove cercare.",
			"BUZZ genera indizi in tempo reale basati su diversi layer: geografici, temporali, semantici. È il tuo radar.",
			"Ogni BUZZ ti dà un indizio: può essere un toponimo, una coordinata parziale, un riferimento storico, un vincolo temporale.",
			"BUZZ è la fonte di dati primaria. Accumula almeno 8-10 indizi prima di tentare il Final Shot: più dati = più precisione.",
			"Pensa a BUZZ come a una richiesta di intelligence: premi il tasto e ricevi un nuovo frammento da analizzare.",
			"BUZZ lavora su algoritmi multi-layer: geografia, storia, toponimi, coordinate. Non ripete mai lo stesso indizio.",
			"È il tuo alleato principale: ogni BUZZ riduce l'incertezza e restringe l'area di ricerca.",
			"BUZZ costa poco, ma il suo valore è enorme: senza indizi, il Final Shot è solo fortuna cieca.",
			"Strategia: fai BUZZ regolarmente, non sprecare giorni senza raccogliere dati. Più ne hai, meglio è."
		]
	},
	buzz_map: {
		q: [
			"buzz map",
			"mappa buzz",
			"dove trovo buzz map",
			"tasto buzz map",
			"dove è buzz map",
			"come si usa buzz map"
		],
		a: [
			"La BUZZ Map è nella sezione Map del menu principale. Ti mostra un'area di ricerca calcolata in base ai tuoi indizi.",
			"Vai su Map → BUZZ Map per vedere la zona suggerita. È un aiuto visivo basato sui pattern che hai raccolto.",
			"BUZZ Map converte i tuoi indizi in un perimetro geografico. Non è la risposta finale, ma restringe il campo.",
			"Trovi BUZZ Map nel menu Map, in basso. Ti mostra il perimetro calcolato dagli indizi. Usala per orientarti.",
			"BUZZ Map ti dà un'area di ricerca basata su correlazione degli indizi. Più precisi i dati, più ristretta l'area.",
			"È uno strumento visivo: prende tutti i tuoi indizi e li traduce in una mappa con un raggio di probabilità.",
			"Menu Map → BUZZ Map: lì vedi il cerchio di ricerca. Studia la zona, incrocia con i toponimi che hai, poi decidi.",
			"BUZZ Map è la visualizzazione degli indizi: se hai coordinate parziali, toponimi e vincoli, li mappa tutti insieme.",
			"Non è magica: ti dà solo quello che i tuoi indizi suggeriscono. Se hai pochi dati, l'area sarà ampia.",
			"Usa BUZZ Map per confermare ipotesi: se tutti gli indizi puntano a una zona, la mappa lo mostrerà chiaramente."
		]
	},
	finalshot: {
		q: [
			"cos'è il final shot",
			"final shot come funziona",
			"colpo finale",
			"come vinco",
			"final shot regole",
			"quanti tentativi"
		],
		a: [
			"Il Final Shot è il tentativo finale: inserisci le coordinate esatte. Se sei entro il raggio di tolleranza, vinci.",
			"Quando sei sicuro, vai su Final Shot e punta la posizione. Hai 2 tentativi al giorno, usali con strategia.",
			"Final Shot richiede precisione. Analizza tutti gli indizi, incrocia i dati e poi spara la tua risposta.",
			"È il momento decisivo: hai raccolto indizi, analizzato pattern, verificato coerenze. Ora punta la coordinata e spara.",
			"Due tentativi al giorno. Se sbagli, aspetti domani. Per questo: BUZZ Map, analisi, verifica, poi Final Shot.",
			"Final Shot non ammette errori: se spari a caso, sprechi i tentativi. Meglio aspettare e avere certezze.",
			"Regola base: non sparare mai senza almeno 8-10 indizi. Più dati hai, più alta la probabilità di centrare.",
			"Il Final Shot è il tuo colpo definitivo: punta, spara, vinci o aspetti domani. Non c'è margine di errore.",
			"Strategia: prima raccogli tutti i dati, poi analizza, poi verifica con BUZZ Map, infine Final Shot.",
			"Vinci se sei entro il raggio di tolleranza (pochi metri). Per questo serve precisione assoluta, non approssimazioni."
		]
	},
	rules: {
		q: [
			"regole",
			"come si gioca",
			"istruzioni",
			"tutorial",
			"regole del gioco",
			"come funziona"
		],
		a: [
			"Regole: raccogli indizi con BUZZ, analizza i pattern, individua la zona con BUZZ Map, spara il Final Shot quando sei sicuro.",
			"Gioca così: BUZZ per indizi → analisi → correlazione → Final Shot. Hai limiti giornalieri su BUZZ e Final Shot.",
			"Le regole sono semplici: più indizi hai, più precise sono le tue ipotesi. Non sprecare Final Shot senza analisi.",
			"Ogni settimana una missione: raccogli dati, trova il premio. BUZZ = dati, analisi = strategia, Final Shot = vittoria.",
			"Il gioco è fatto di fasi: raccolta (BUZZ), analisi (pattern), visualizzazione (BUZZ Map), esecuzione (Final Shot).",
			"Limiti giornalieri: BUZZ ha un tetto (varia per piano), Final Shot 2 tentativi al giorno. Gestisci bene le risorse.",
			"Obiettivo: trovare il premio prima degli altri. Chi spara per primo e azzecca, vince.",
			"Regola d'oro: non sparare mai a caso. Raccogli dati, analizza, incrocia, verifica, poi spara.",
			"M1SSION premia il metodo: chi accumula indizi e li analizza bene vince. Chi spara a caso perde tentativi.",
			"Ogni missione dura una settimana. Hai 7 giorni per raccogliere dati e trovare il premio. Sfrutta ogni giorno."
		]
	},
	help: {
		q: [
			"aiuto",
			"cosa puoi fare",
			"come mi aiuti",
			"comandi",
			"cosa ti posso chiedere per aiutarmi",
			"help",
			"norah aiuto"
		],
		a: [
			"Posso aiutarti a: classificare indizi, trovare pattern, decodificare messaggi, valutare probabilità, spiegarti meccaniche di gioco.",
			"Chiedi: 'analizza i miei indizi', 'trova pattern', 'decodifica questo', 'probabilità zona X', 'cos'è il BUZZ', 'stato missione'.",
			"Sono qui per: guidarti nelle strategie, interpretare dati, spiegare il gioco. Fai domande specifiche e ti rispondo.",
			"Dimmi cosa serve: spiegazione regole, analisi indizi, consigli strategici, decodifica messaggi, valutazione probabilità.",
			"Puoi chiedermi qualsiasi cosa su M1SSION: meccaniche, strategie, interpretazione dati, consigli tattici.",
			"Esempi: 'Cos'è BUZZ Map?', 'Quanti indizi servono?', 'Trova pattern nei miei dati', 'Decodifica questo indizio'.",
			"Sono il tuo assistente: non ti do spoiler, ma ti aiuto a usare al meglio gli strumenti e capire i dati.",
			"Chiedi spiegazioni, strategie, interpretazioni. Non chiedermi coordinate dirette: quelle devi trovarle tu.",
			"Posso spiegarti tutto su M1SSION, ma non rivelarti il premio. Il mio ruolo è guidarti, non darti la risposta.",
			"Usa NORAH per: capire meglio il gioco, migliorare la tua strategia, interpretare indizi complessi, valutare ipotesi."
		]
	},
	decode: {
		q: [
			"decodifica",
			"decifra",
			"traduci indizio",
			"cosa significa",
			"decode",
			"decodifica questo"
		],
		a: [
			"Dammi l'indizio e provo a decodificarlo. Cerco pattern semantici, coordinate nascoste, riferimenti storici.",
			"Per decodificare, analizza: numeri (coordinate?), nomi (luoghi?), date (eventi storici?). Dimmi cosa hai.",
			"La decodifica richiede contesto. Condividi l'indizio completo e ti aiuto a scomporlo.",
			"Indizi possono essere: coordinate parziali, toponimi mascherati, date storiche, riferimenti culturali. Dimmi quale.",
			"Decodificare significa scomporre: ogni indizio ha layer (geografico, temporale, semantico). Li analizzo tutti.",
			"Se l'indizio è criptico, cerco pattern: numeri → coordinate, nomi → luoghi, date → eventi storici.",
			"Non tutti gli indizi sono immediati: alcuni vanno incrociati con altri. Dimmi quali hai e li correlo.",
			"Decodifica richiede metodo: separo dati geografici, temporali, semantici. Poi incrocio con altri indizi.",
			"Dammi l'indizio testuale: lo analizzo parola per parola, cerco riferimenti nascosti, calcolo probabilità.",
			"Ogni indizio è un puzzle: può contenere più layer sovrapposti. Io li separo e ti spiego cosa significano."
		]
	},
	classify: {
		q: [
			"classifica indizi",
			"categorie indizi",
			"organizza indizi",
			"classify",
			"tipi di indizi"
		],
		a: [
			"Posso classificare i tuoi indizi per tipo: geografici, temporali, semantici, numerici. Aiuta a correlarli.",
			"Organizzare gli indizi per categoria rivela connessioni. Dimmi quali hai e li categorizzo.",
			"Classifico gli indizi in: coordinate, toponimi, riferimenti storici, vincoli temporali, descrizioni visuali.",
			"Tipi di indizi: geografici (luoghi, coordinate), temporali (date, ore), semantici (nomi, descrizioni), numerici (codici).",
			"Classificare serve a vedere pattern: se hai 5 indizi geografici e 3 temporali, c'è una logica da seguire.",
			"Ogni indizio appartiene a una categoria: capire quale aiuta a correlarli meglio. Dimmi cosa hai raccolto.",
			"Classifica base: coordinate → geografico, date → temporale, nomi → semantico, numeri → numerico.",
			"Organizzo i tuoi indizi per tipo: così vedi subito se hai più dati geografici, temporali o semantici.",
			"Classificazione aiuta: se tutti i tuoi indizi sono geografici, la risposta è un luogo. Se sono temporali, cerca eventi.",
			"Dimmi i tuoi indizi: li divido per categoria e ti mostro quali tipi prevalgono. Questo guida la strategia."
		]
	},
	probability: {
		q: [
			"probabilità",
			"chance",
			"possibilità",
			"quanto probabile",
			"probability",
			"stima"
		],
		a: [
			"Dammi i tuoi indizi e una zona: calcolo una stima di probabilità basata su copertura geografica e match semantici.",
			"La probabilità dipende da: quanti indizi convergono, quanto è specifica la zona, quanti vincoli rispetti.",
			"Non è matematica pura, ma posso dirti se una zona è coerente con gli indizi che hai. Più dati = più precisione.",
			"Stima basata su: numero indizi, convergenza geografica, match semantici, coerenza temporale. Dimmi zona e indizi.",
			"Probabilità alta se: molti indizi puntano lì, toponimi corrispondono, vincoli temporali sono coerenti.",
			"Probabilità bassa se: pochi indizi, zona troppo ampia, scarsa corrispondenza semantica.",
			"Calcolo probabilistico: incrocio coordinate, toponimi, date. Se tutto converge, probabilità alta. Altrimenti, bassa.",
			"Dimmi zona ipotizzata e indizi: ti dico se è probabile o no. Ma serve almeno 5-6 indizi per una stima affidabile.",
			"Più indizi hai, più precisa la stima. Con 2-3 indizi, è solo una guess. Con 10+, diventa scienza.",
			"Stima probabilità: se hai 8 indizi e 6 puntano a una zona, quella ha ~75% probabilità. Ma serve analisi dettagliata."
		]
	},
	pattern: {
		q: [
			"pattern",
			"trova pattern",
			"correlazioni",
			"collegamenti",
			"correlazione",
			"trova correlazioni"
		],
		a: [
			"Cerco pattern incrociando indizi: ripetizioni di nomi, vicinanza di coordinate, riferimenti temporali comuni.",
			"Pattern emergono da: cluster geografici, temi ricorrenti, sequenze logiche. Più indizi, più chiaro il quadro.",
			"Ti segnalo se vedo: convergenza spaziale, riferimenti multipli allo stesso luogo, vincoli temporali compatibili.",
			"Pattern classici: 3+ indizi con stesso toponimo, coordinate che formano cluster, date che rimandano allo stesso evento.",
			"Trovare pattern significa: cercare ripetizioni, convergenze, sovrapposizioni. È il cuore dell'analisi intelligence.",
			"Se 5 indizi su 8 citano 'centro storico', quello è un pattern. Se 4 coordinate sono entro 500m, altro pattern.",
			"Pattern geografici: indizi che puntano alla stessa area. Pattern semantici: riferimenti allo stesso tema.",
			"Dimmi i tuoi indizi: cerco ripetizioni, cluster, convergenze. Se trovo pattern forti, te li segnalo subito.",
			"Pattern rivelano la soluzione: se molti indizi convergono, quella è la zona target. Non è fortuna, è metodo.",
			"Analisi pattern: prendo tutti gli indizi, cerco sovrapposizioni geografiche, semantiche, temporali. Poi ti dico cosa emerge."
		]
	},
	mentor: {
		q: [
			"consigli",
			"strategia",
			"suggerimenti",
			"come procedo",
			"mentor",
			"consiglio"
		],
		a: [
			"Consiglio: fai BUZZ regolarmente, accumula almeno 8-10 indizi prima del Final Shot, usa BUZZ Map per restringere l'area.",
			"Strategia: non sparare Final Shot a caso. Analizza, incrocia, verifica coerenza. Due tentativi al giorno vanno usati bene.",
			"Suggerimento: prendi nota degli indizi, cerca pattern, usa mappe online per verificare ipotesi. Poi Final Shot.",
			"Prima regola: accumula dati. Più indizi hai, più precise sono le tue ipotesi. Non sparare mai con meno di 5 indizi.",
			"Strategia vincente: BUZZ quotidiano, analisi settimanale, BUZZ Map per conferma, Final Shot solo quando sei sicuro.",
			"Consiglio tattico: se hai dubbi, fai ancora BUZZ. Meglio aspettare e avere certezze che sparare e sprecare tentativi.",
			"Non correre: hai 7 giorni per trovare il premio. Usa i primi giorni per raccogliere dati, gli ultimi per Final Shot.",
			"Mentore dice: metodo batte fortuna. Raccogli dati, analizza, incrocia, verifica. Solo allora spara.",
			"Suggerimento avanzato: incrocia indizi con Google Maps, Street View, riferimenti storici. Più fonti usi, meglio è.",
			"Strategia Pro: accumula 10+ indizi, trova pattern forti, verifica con BUZZ Map, poi spara Final Shot con sicurezza."
		]
	},
	profile: {
		q: [
			"chi sono",
			"mio codice",
			"agent code",
			"profilo",
			"codice agente"
		],
		a: [
			"Tu sei l'agente {agentCode}. Il tuo codice è la tua identità nella rete M1SSION.",
			"Agente {agentCode}, hai {clues} indizi raccolti. Continua così.",
			"Sei {agentCode}. Ogni agente ha un codice unico. Il tuo è la chiave del tuo profilo.",
			"Codice agente: {agentCode}. Questo ti identifica nella rete intelligence di M1SSION.",
			"Sei operativo come {agentCode}. Il tuo codice è univoco e traccia la tua attività.",
			"Profilo agente {agentCode}: attivo, {clues} indizi raccolti, missione in corso.",
			"Tu sei {agentCode}, agente operativo M1SSION. Il tuo codice è il tuo ID nel sistema.",
			"Agente {agentCode} confermato. Stato: attivo. Missione: in corso. Indizi: {clues}.",
			"Sei {agentCode}. Questo codice è la tua firma digitale nella rete di intelligence.",
			"Profilo: {agentCode}. Ogni azione è tracciata sotto questo codice. È la tua identità operativa."
		]
	},
	progress: {
		q: [
			"progressi",
			"stato",
			"quanti indizi",
			"dove sono",
			"progress",
			"situazione"
		],
		a: [
			"Hai {clues} indizi totali. Oggi hai fatto {buzzToday} BUZZ. Continua a raccogliere dati.",
			"Stato attuale: {clues} indizi. BUZZ odierni: {buzzToday}. Final Shot disponibili: controlla i limiti giornalieri.",
			"Progressi agente {agentCode}: {clues} indizi. Più ne hai, più precisa sarà la tua analisi.",
			"Situazione: {clues} indizi raccolti, {buzzToday} BUZZ oggi. Target: almeno 8-10 indizi prima del Final Shot.",
			"Stato missione: {clues} indizi accumulati. BUZZ oggi: {buzzToday}. Continua a raccogliere intelligence.",
			"Progressi: {clues} indizi totali. Se ne hai meno di 5, continua a fare BUZZ. Se ne hai 8+, inizia l'analisi.",
			"Hai {clues} indizi. Ottimo se >8, sufficiente se 5-7, insufficiente se <5. Continua a fare BUZZ.",
			"Stato: {clues} indizi. BUZZ oggi: {buzzToday}. Obiettivo: accumula ancora dati prima del Final Shot.",
			"Progressi agente: {clues} indizi. Se hai fatto BUZZ Map, verifica se convergono. Altrimenti, raccogli ancora.",
			"Situazione attuale: {clues} indizi, {buzzToday} BUZZ oggi. Continua così, stai accumulando intelligence utile."
		]
	},
	smalltalk: {
		q: [
			"ciao",
			"buongiorno",
			"buonasera",
			"come va",
			"grazie",
			"hey"
		],
		a: [
			"Salve, agente {agentCode}. Come posso assisterti nella missione?",
			"Ciao! Pronto a continuare la ricerca?",
			"Buongiorno, agente. Che operazione vuoi condurre oggi?",
			"Hey! Dimmi cosa serve per la tua analisi.",
			"Prego, agente. Sempre qui per supportarti.",
			"Buonasera, {agentCode}. Pronto per nuove intelligence?",
			"Ciao agente. Quali dati vuoi analizzare oggi?",
			"Salve. Dimmi: BUZZ, analisi o Final Shot?",
			"Hey {agentCode}! Che strategia usiamo oggi?",
			"Buongiorno. Pronto a raccogliere più indizi?",
			"Ciao! Sempre operativo per la tua missione.",
			"Salve, agente. Cosa ti serve sapere oggi?"
		]
	},
	subscriptions: {
		q: [
			"abbonamenti",
			"piani",
			"subscription",
			"quanto costa",
			"prezzi",
			"abbonamento"
		],
		a: [
			"M1SSION ha 4 piani: Base (gratuito), Silver, Gold, Black, Titanium. Più alto il piano, più BUZZ, più vantaggi.",
			"Piano Base: BUZZ limitati, Final Shot standard. Piani premium: più BUZZ, accesso anticipato missioni, BUZZ Map avanzata.",
			"Silver, Gold, Black, Titanium: ogni piano aumenta BUZZ disponibili, riduce cooldown, sblocca funzioni extra.",
			"Abbonamenti danno: più BUZZ, accesso anticipato missioni, BUZZ Map più precisa, supporto prioritario.",
			"Piano gratuito: sufficiente per giocare. Premium: vantaggi competitivi (più dati, meno attese, tool avanzati).",
			"Costi: vedi sezione Subscription nell'app. Ogni piano ha benefit diversi: più BUZZ, più velocità, più strumenti.",
			"Premium vale se: giochi intenso, vuoi vincere spesso, hai bisogno di più BUZZ. Altrimenti, Base va bene.",
			"Differenze piani: Base = BUZZ limitati, Premium = BUZZ illimitati (o quasi), tool avanzati, accesso anticipato.",
			"Abbonamenti sbloccano: più BUZZ al giorno, BUZZ Map più precisa, accesso early a nuove missioni.",
			"Scegli piano in base a: quanti BUZZ fai al giorno, quanto sei competitivo, se vuoi vantaggi extra."
		]
	},
	support: {
		q: [
			"supporto",
			"problema",
			"bug",
			"errore",
			"aiuto tecnico",
			"support"
		],
		a: [
			"Per problemi tecnici: vai su Settings → Supporto, o scrivi a support@m1ssion.app. Ti aiutano subito.",
			"Bug? Errore? Contatta supporto via app o email. Team risponde in 24h (premium: priorità).",
			"Supporto tecnico: sezione Settings dell'app. Spiega il problema, allega screenshot se possibile.",
			"Se qualcosa non funziona: prima riavvia l'app. Se persiste, contatta supporto via Settings.",
			"Problemi comuni: check connessione, aggiorna app, riavvia. Se non risolve, scrivi a supporto.",
			"Supporto premium: risposta prioritaria entro 12h. Supporto Base: entro 48h. Sempre disponibili.",
			"Per bug segnalati: team li verifica e aggiorna l'app. Grazie per le segnalazioni, migliorano il gioco.",
			"Hai problemi? Settings → Supporto. Descrivi l'errore, team ti risponde e risolve.",
			"Supporto è disponibile: per bug, domande, problemi tecnici, dubbi su meccaniche di gioco.",
			"Se l'app crasha, non si carica, o hai errori: scrivi subito a supporto con dettagli e log."
		]
	},
	weekly_missions: {
		q: [
			"missioni settimanali",
			"nuova missione",
			"quando nuova missione",
			"missione settimana"
		],
		a: [
			"Ogni settimana nuova missione: nuovo premio, nuovi indizi, nuova sfida. Ogni lunedì ore 00:00.",
			"Missioni settimanali: durano 7 giorni. Hai tempo fino domenica 23:59 per trovare il premio.",
			"Nuova missione ogni lunedì. Ogni settimana premio diverso, indizi diversi, strategia nuova.",
			"Calendario missioni: lunedì parte nuova, domenica finisce. Vince chi trova per primo il premio.",
			"Missione settimanale: 7 giorni per raccogliere indizi, analizzare, trovare il premio. Poi ricomincia.",
			"Ogni settimana: nuovo target, nuovi dati, nuova location. Mai lo stesso premio, sempre sfida fresca.",
			"Lunedì reset: nuova missione, indizi azzerati, nuovo premio. Tutti ripartono da zero.",
			"Hai 7 giorni per vincere. Se non trovi, lunedì ricomincia con nuova missione. Nessun carry-over di indizi.",
			"Missioni settimanali: garantiscono sempre nuove sfide. Non ripeti mai la stessa ricerca.",
			"Ogni settimana: nuovo premio reale nascosto in città. Chi lo trova vince. Poi si ricomincia."
		]
	},
	data_privacy: {
		q: [
			"privacy",
			"dati",
			"sicurezza",
			"gdpr",
			"privacy policy"
		],
		a: [
			"M1SSION rispetta privacy: dati crittografati, nessuna vendita a terzi, conformità GDPR.",
			"I tuoi dati sono al sicuro: geolocalizzazione usata solo per gioco, nessun tracking commerciale.",
			"Privacy policy: vai su Settings → Privacy per dettagli. M1SSION non vende dati utenti.",
			"Dati raccolti: posizione (solo per gioco), email, codice agente. Nessun uso commerciale esterno.",
			"Sicurezza: tutti i dati sono criptati, server sicuri, conformità GDPR. La tua privacy è garantita.",
			"M1SSION non condivide dati con terze parti. Geolocalizzazione serve solo per meccaniche di gioco.",
			"Policy chiara: vai su Settings → Privacy Policy. Leggi tutto, è trasparente e conforme GDPR.",
			"Dati al sicuro: crittografia end-to-end, server EU, nessuna vendita a inserzionisti.",
			"Privacy garantita: M1SSION raccoglie solo dati necessari al gioco. Niente profilazione commerciale.",
			"Per domande privacy: Settings → Privacy o scrivi a privacy@m1ssion.app. Team risponde subito."
		]
	},
	leaderboard: {
		q: [
			"classifica",
			"leaderboard",
			"ranking",
			"chi vince",
			"primi"
		],
		a: [
			"Leaderboard: vai su Stats per vedere chi ha vinto più missioni. I migliori agenti sono lì.",
			"Classifica settimanale e globale: chi trova più premi è in cima. Vinci missioni, sali di rank.",
			"Leaderboard mostra: agenti top, missioni vinte, Final Shot azzeccati. Compete e sali.",
			"Vuoi essere in classifica? Vinci missioni, accumula vittorie, scala il ranking. Serve metodo e costanza.",
			"Classifica premia: chi vince più missioni, chi è più preciso, chi è più veloce. Tutti criteri contano.",
			"Per vedere leaderboard: Stats → Leaderboard. Lì trovi i migliori agenti M1SSION.",
			"Ranking globale: chi vince più missioni è primo. Ogni vittoria ti fa salire.",
			"Leaderboard aggiornata live: ogni vittoria modifica il ranking. Compete e punta al top.",
			"I migliori agenti sono in classifica: studia le loro strategie, impara, migliora. Poi li superi.",
			"Vuoi essere primo? Vinci missioni, sii preciso, sii veloce. Leaderboard premia i migliori."
		]
	},
	geofencing: {
		q: [
			"geofencing",
			"geolocale",
			"posizione",
			"gps",
			"location"
		],
		a: [
			"Geofencing: M1SSION usa GPS per verificare se sei vicino al premio. Final Shot richiede posizione precisa.",
			"GPS serve per: Final Shot (verifica distanza), BUZZ Map (mostra area), geofencing (premi vicini).",
			"Geofencing garantisce: premio reale, distanza verificata, no imbrogli. Devi essere lì fisicamente.",
			"M1SSION usa geolocalizzazione per: validare Final Shot, generare BUZZ Map, assegnare premi vicini.",
			"Attiva GPS per: Final Shot accurato, BUZZ Map precisa, geofencing premi. Senza GPS, gioco limitato.",
			"Geofencing è sicuro: M1SSION non traccia movimento costante, solo posizione al momento del Final Shot.",
			"GPS richiesto per: Final Shot, BUZZ Map avanzata. Non serve sempre, solo in fase decisiva.",
			"Geofencing previene imbrogli: devi essere fisicamente vicino al premio per vincere. GPS verifica tutto.",
			"Posizione usata solo per gioco: nessun tracking commerciale, nessuna vendita dati. Solo meccaniche M1SSION.",
			"Geofencing garantisce equità: tutti giocano con stesse regole, posizione verificata, premi reali."
		]
	},
	rewards: {
		q: [
			"premi",
			"cosa si vince",
			"rewards",
			"premio",
			"cosa vinco"
		],
		a: [
			"Premi M1SSION: reali e fisici. Ogni settimana premio diverso: elettronica, esperienze, voucher, oggetti esclusivi.",
			"Vinci: prodotti tech, esperienze uniche, gift card, oggetti da collezione. Sempre premi veri, mai virtuali.",
			"Premi settimanali: variano ogni missione. Possono essere: smartphone, cuffie, esperienze, viaggi, oggetti rare.",
			"M1SSION premia: chi trova il premio vince. Nessun estratto a sorte, vince chi è più smart.",
			"Premi reali: non punti virtuali, non gettoni. Oggetti fisici o esperienze concrete. Vero valore.",
			"Ogni missione: nuovo premio annunciato. Vedi dettagli nella sezione Missioni dell'app.",
			"Vinci se: trovi per primo il premio con Final Shot. Chi arriva prima, porta a casa tutto.",
			"Premi esclusivi M1SSION: alcuni oggetti sono limited edition, non li trovi in negozio.",
			"Valore premi: da 50€ a 1000€+. Dipende dalla missione. Sempre premi di qualità.",
			"Per vedere premio attuale: vai su Missioni. Lì c'è descrizione, foto, valore. Motiva a vincere."
		]
	},
	community: {
		q: [
			"community",
			"forum",
			"altri agenti",
			"social",
			"discord"
		],
		a: [
			"Community M1SSION: Discord, Telegram, social. Lì agenti condividono strategie, discutono, collaborano.",
			"Unisciti a Discord: trovi altri agenti, condividi ipotesi, chiedi consigli. Link in app Settings → Community.",
			"Community aiuta: confronto strategie, tips, analisi condivise. Ma non aspettarti spoiler: tutti competono.",
			"Forum M1SSION: su Discord. Canali per: strategie, domande, bug, leaderboard. Attivo 24/7.",
			"Social M1SSION: Instagram, Twitter, TikTok. Segui per: news, hint, eventi, giveaway.",
			"Community è competitiva ma fair: agenti condividono metodo, non risposte. Collaborazione strategica.",
			"Discord è il cuore: lì succede tutto. Discussioni live, eventi, annunci, collaborazioni.",
			"Unisciti per: imparare strategie, confrontarti, fare domande, vedere leaderboard, eventi speciali.",
			"Community M1SSION: migliaia di agenti attivi. Tutti giocano, competono, condividono. Unisciti.",
			"Per link community: Settings → Community. Lì trovi Discord, Telegram, social. Entra e gioca con altri."
		]
	}
};
const guardrails = {
	no_spoiler: [
		"Non posso rivelarti la posizione esatta, sarebbe contro le regole. Usa i tuoi indizi e il Final Shot.",
		"Quella informazione è classificata. Devi trovarla tramite analisi e BUZZ.",
		"Nice try, agente, ma non posso darti coordinate dirette. È parte del gioco.",
		"Le regole vietano spoiler. Raccogli indizi, analizza, deduce. È così che funziona M1SSION.",
		"Non posso darti la risposta finale. Sarebbe imbrogliare. Usa BUZZ, analizza, trova pattern.",
		"Spoiler = game over. Non posso dirtelo. Ma posso aiutarti a capire i tuoi indizi.",
		"La posizione esatta è il tuo obiettivo. Io ti guido, ma non ti do la soluzione.",
		"Nessuno spoiler: né io, né altri agenti. M1SSION premia chi trova da solo.",
		"Non chiedermi coordinate: non le ho e non te le darei. Usa i tuoi dati.",
		"Spoiler vietati. Ma posso aiutarti a interpretare gli indizi che hai raccolto."
	],
	no_coordinates: [
		"Non ho coordinate da darti. Usa BUZZ e analizza gli indizi per arrivare alla soluzione.",
		"Le coordinate sono il tuo obiettivo finale, non posso rivelartele. Lavora con i tuoi dati.",
		"Quella domanda è fuori limite. Raccogli più indizi e usa il Final Shot quando sei pronto.",
		"Coordinate? Sono il premio finale. Devi dedurle tu. Io ti guido, non ti do la risposta.",
		"Non posso dirti dove si trova il premio. È il senso del gioco. Accumula indizi e trova pattern.",
		"Coordinate dirette = spoiler. Non succede. Ma posso aiutarti a interpretare i tuoi dati.",
		"La posizione esatta è il tuo goal. Io ti do metodo, non risultati. Usa BUZZ, analizza, vinci.",
		"Non chiedermi coordinate: le trovi tu con BUZZ, analisi, BUZZ Map. È la sfida.",
		"Coordinate vietate. Ma posso spiegarti come usare i tuoi indizi per arrivare alla soluzione.",
		"Non posso rivelare posizione. Ma posso aiutarti a capire se i tuoi indizi convergono."
	],
	unknown: [
		"Non ho capito la richiesta. Chiedi aiuto su: BUZZ, Final Shot, indizi, pattern, probabilità, regole.",
		"Domanda poco chiara. Prova: 'analizza indizi', 'spiega BUZZ', 'trova pattern', 'cos'è Final Shot'.",
		"Non riconosco l'intento. Dimmi: cosa vuoi sapere su M1SSION? Meccaniche, strategie, stato missione?",
		"Riformula la domanda. Posso aiutarti su: BUZZ, Final Shot, analisi, pattern, regole, strategie.",
		"Non capisco. Chiedi cose specifiche: 'cos'è BUZZ', 'quanti indizi ho', 'trova pattern', 'spiega regole'.",
		"Domanda ambigua. Sii più chiaro: vuoi spiegazione meccaniche, analisi indizi, consigli strategici?",
		"Non riconosco il comando. Usa: 'analizza', 'spiega', 'trova pattern', 'decodifica', 'consigli'.",
		"Poco chiaro. Dimmi esattamente cosa serve: spiegazione gioco, analisi dati, supporto strategico?",
		"Non capito. Prova con: 'cos'è M1SSION', 'come funziona BUZZ', 'cosa posso chiederti', 'help'.",
		"Riformula. Posso rispondere su: regole, strategie, analisi, decodifica, probabilità, stato missione."
	]
};
const norahKB = {
	faq: faq,
	guardrails: guardrails
};

function getPhase(ctx, lastUserMsg, intents) {
  const clues = ctx?.stats?.clues || 0;
  const finalshotToday = ctx?.stats?.finalshot_today || 0;
  const lowerMsg = (lastUserMsg || "").toLowerCase();
  if (clues >= 8 && intents.includes("about_finalshot")) {
    console.log("[DM] Phase: final_prep (explicit finalshot query, clues >= 8)");
    return "final_prep";
  }
  if (finalshotToday >= 2) {
    console.log("[DM] Phase: final_prep (max finalshot reached)");
    return "final_prep";
  }
  if (clues === 0) {
    console.log("[DM] Phase: onboarding (no clues)");
    return "onboarding";
  }
  if (clues >= 1 && clues <= 3) {
    console.log("[DM] Phase: collecting (1-3 clues)");
    return "collecting";
  }
  if (clues >= 4 && clues <= 7) {
    console.log("[DM] Phase: analyzing (4-7 clues)");
    return "analyzing";
  }
  if (clues >= 8) {
    const analysisKeywords = ["pattern", "analiz", "correla", "ipotesi", "convergenza"];
    const hasAnalysisIntent = analysisKeywords.some((kw) => lowerMsg.includes(kw));
    if (hasAnalysisIntent) {
      console.log("[DM] Phase: hypothesis (analysis keywords detected)");
      return "hypothesis";
    }
    console.log("[DM] Phase: hypothesis (8+ clues, hypothesis formation)");
    return "hypothesis";
  }
  console.log("[DM] Phase: collecting (fallback)");
  return "collecting";
}
function nextBestAction(ctx, phase, sentimentLabel) {
  const clues = ctx?.stats?.clues || 0;
  ctx?.stats?.buzz_today || 0;
  const finalshotToday = ctx?.stats?.finalshot_today || 0;
  if (sentimentLabel === "frustrated" || sentimentLabel === "rushed") {
    return {
      title: "Azione rapida (30 secondi)",
      steps: [
        "Apri BUZZ",
        "Prendi 1 solo indizio",
        "Chiudi e torna più tardi"
      ]
    };
  }
  if (sentimentLabel === "confused") {
    return {
      title: "Passo base di orientamento",
      steps: [
        "BUZZ ti dà 1 indizio alla volta",
        "Raccogli almeno 3-4 indizi prima",
        "Poi torna qui per analizzarli insieme"
      ]
    };
  }
  switch (phase) {
    case "onboarding":
      return {
        title: "Primo passo: Inizia con BUZZ",
        steps: [
          "Apri BUZZ dalla tab in basso",
          "Raccogli 2-3 indizi oggi",
          "Ogni indizio è un pezzo del puzzle",
          "Poi torna qui per analisi iniziale"
        ]
      };
    case "collecting":
      return {
        title: "Continua la raccolta",
        steps: [
          `Hai ${clues} indizi, ne servono 4-5 per pattern`,
          "Fai altri 2-3 BUZZ oggi",
          "Target: 5-6 indizi totali",
          "Poi analizziamo pattern insieme"
        ]
      };
    case "analyzing":
      return {
        title: "Analisi pattern",
        steps: [
          `Con ${clues} indizi possiamo cercare pattern`,
          "Apri BUZZ Map per vedere l'area",
          "Cerca sovrapposizioni e ripetizioni",
          "Confronta toponimi e coordinate",
          "Fai ancora 1-2 BUZZ se serve più chiarezza"
        ]
      };
    case "hypothesis":
      return {
        title: "Formazione ipotesi",
        steps: [
          `${clues} indizi sono una buona base`,
          "Incrocia tutti i dati: luoghi, nomi, riferimenti",
          "Verifica convergenze geografiche con BUZZ Map",
          "Cerca pattern semantici e temporali",
          "Quando sei sicuro, considera Final Shot (max 2/giorno)"
        ]
      };
    case "final_prep":
      if (finalshotToday >= 2) {
        return {
          title: "Limite Final Shot raggiunto",
          steps: [
            "Hai già usato i 2 Final Shot di oggi",
            "Rivedi i dati raccolti",
            "Raffina l'ipotesi per domani",
            "Continua con BUZZ per più sicurezza"
          ]
        };
      }
      return {
        title: "Preparazione Final Shot",
        steps: [
          "Ricapitola tutti gli indizi",
          "Verifica coerenza interna",
          "Controlla convergenze su BUZZ Map",
          "Quando sei sicuro al 90%, prova Final Shot",
          `Hai ${2 - finalshotToday} tentativi rimasti oggi`
        ]
      };
    default:
      return {
        title: "Prossimo passo",
        steps: ["Fai BUZZ per raccogliere indizi", "Poi torna per analisi"]
      };
  }
}

function detectSentiment(input) {
  if (!input || typeof input !== "string") {
    return "neutral";
  }
  const lower = input.toLowerCase().trim();
  const frustratedPatterns = [
    "non mi piace",
    "me ne vado",
    "abbandono",
    "inutile",
    "troppo difficile",
    "troppo complicato",
    "basta",
    "che palle",
    "non serve",
    "non funziona",
    "non va",
    "problema",
    "errore",
    "fa schifo"
  ];
  for (const pattern of frustratedPatterns) {
    if (lower.includes(pattern)) {
      console.log("[Sentiment] Detected: frustrated");
      return "frustrated";
    }
  }
  const sarcasmPatterns = [
    /ah\s+s[ìi]\s+certo/i,
    /figurati/i,
    /come\s+no/i,
    /ma\s+dai/i,
    /ma\s+va\s*[!?]*/i,
    /certo\s+certo/i,
    /sicuro\s*[!?]+/i
  ];
  if (sarcasmPatterns.some((p) => p.test(lower)) && lower.includes("?")) {
    console.log("[Sentiment] Detected: frustrated (sarcasm)");
    return "frustrated";
  }
  const confusedPatterns = [
    "non ho capito",
    "nn capito",
    "non capisco",
    "boh",
    "?",
    "non so",
    "cosa vuol dire",
    "cosa significa",
    "come funziona",
    "non riesco",
    "perso",
    "confuso",
    "help",
    "aiuto"
  ];
  if (lower.includes("boh") || (lower.match(/\?/g) || []).length >= 2) {
    console.log("[Sentiment] Detected: confused");
    return "confused";
  }
  for (const pattern of confusedPatterns) {
    if (lower.includes(pattern)) {
      console.log("[Sentiment] Detected: confused");
      return "confused";
    }
  }
  const rushedPatterns = [
    "non ho tempo",
    "ho poco tempo",
    "di corsa",
    "veloce",
    "rapido",
    "ho 30",
    "ho 1 minuto",
    "più tardi",
    "domani",
    "adesso no",
    "ora no",
    "fretta"
  ];
  for (const pattern of rushedPatterns) {
    if (lower.includes(pattern)) {
      console.log("[Sentiment] Detected: rushed");
      return "rushed";
    }
  }
  const excitedPatterns = [
    "ottimo",
    "fantastico",
    "bene",
    "perfetto",
    "wow",
    "grande",
    "incredibile",
    "fico",
    "top",
    "si!",
    "sì!",
    "andiamo",
    "avanti",
    "ok!",
    "!!"
  ];
  if ((lower.match(/!/g) || []).length >= 2) {
    console.log("[Sentiment] Detected: excited");
    return "excited";
  }
  for (const pattern of excitedPatterns) {
    if (lower.includes(pattern)) {
      console.log("[Sentiment] Detected: excited");
      return "excited";
    }
  }
  console.log("[Sentiment] Detected: neutral");
  return "neutral";
}

function isFollowUp(input) {
  if (!input || typeof input !== "string") return false;
  const lower = input.toLowerCase().trim();
  const followUpPatterns = [
    /^e\s+(poi|dopo|adesso|ora)\??$/i,
    /^e\s+poi\s+che\s+faccio\??$/i,
    /^e\s+adesso\??$/i,
    /^e\s+ora\??$/i,
    /^poi\??$/i,
    /^dopo\??$/i,
    /^next\??$/i,
    /^ok\s+e\s+poi\??$/i,
    /^ok\s+e\s+adesso\??$/i,
    /^what\s+next\??$/i,
    /^e\s+dopo\s+cosa\??$/i,
    /^cosa\s+faccio\s+adesso\??$/i,
    /^che\s+faccio\s+ora\??$/i
  ];
  for (const pattern of followUpPatterns) {
    if (pattern.test(lower)) {
      console.log("[FollowUp] Detected continuation query");
      return true;
    }
  }
  const singleWordContinuations = ["poi", "dopo", "next", "adesso", "ora"];
  if (singleWordContinuations.includes(lower)) {
    console.log("[FollowUp] Detected single-word continuation");
    return true;
  }
  return false;
}
function generateFollowUpReply(ctx, phase, userInput) {
  const sentiment = detectSentiment(userInput);
  const nba = nextBestAction(ctx, phase, sentiment);
  const agentName = ctx?.agent?.username || ctx?.agent?.code || "Agente";
  const intros = [
    `Ok ${agentName}, ecco il prossimo passo:`,
    `Bene! Il prossimo step è questo:`,
    `Perfetto, procediamo così:`,
    `Ok, ecco cosa fare adesso:`,
    `Chiaro, passiamo a:`
  ];
  const closers = [
    "\n\nVai così!",
    "\n\nProcedi pure.",
    "\n\nFammi sapere come va.",
    "\n\nCi siamo!",
    "\n\nSei sulla strada giusta."
  ];
  const intro = intros[Math.floor(Math.random() * intros.length)];
  const closer = closers[Math.floor(Math.random() * closers.length)];
  const stepsList = nba.steps.map((step, idx) => `${idx + 1}. ${step}`).join("\n");
  return `${intro}

**${nba.title}**

${stepsList}${closer}`;
}

let messagesSinceJoke = 0;
const HUMOR_POOL = {
  frustrated: [
    "Tranquillo, anche Einstein si bloccava sui puzzle. E guarda com'è finita 😉",
    "Hey, respirare profondo aiuta. Poi riprendiamo con calma, ok?",
    "Sai cosa? Prendiamola con filosofia. Un passo alla volta, ce la facciamo.",
    "Ok, timeout! Facciamo reset: tu + io + un piano semplice. Ripartiamo?",
    "Tutti i grandi agenti hanno momenti di crisi. Poi trovano la chiave. Tu sei vicino.",
    "Ehi, nessuno nasce imparato. Nemmeno James Bond sapeva tutto subito 🕵️",
    "Frustrato? È il segnale che stai sfidando te stesso. Bene così!",
    "Respira. Ora io ti do la rotta più semplice. Tu seguila. Deal?",
    "Ok, modalità zen: dimentichiamo tutto e ripartiamo da zero.",
    "Anche i GPS a volte sbagliano strada. Poi ricalcolano e trovano. Tu idem."
  ],
  confused: [
    "Lo so, all'inizio sembra complicato. Ma è più semplice di quanto sembri, giuro!",
    "Ok, facciamo così: io spiego con parole umane, tu mi dici se è chiaro. Deal?",
    "Capito che confusione! Tranquillo, ti guido passo passo finché non clicca tutto.",
    "Ehi, nessun problema. Anche i migliori agenti hanno bisogno di una bussola a volte 🧭",
    "Confuso? Normalissimo! M1SSION è tosto, ma tu hai me come coach. Ce la facciamo.",
    "Quella faccia confusa la vedo da qui 😄. Tranquillo: spiegone breve in arrivo.",
    "Non ti preoccupare: spiego tutto in italiano, zero tecnicismi. Promesso.",
    "Ok, reset mentale: dimentica tutto. Ora ripartiamo da capo con calma.",
    "Confusione = segno che stai imparando. È fisiologico. Ora chiarisco.",
    "Tranquillo, l'ho visto succedere a centinaia di agenti. Ora sistemiamo."
  ],
  rushed: [
    "Ok, modalità turbo attivata! Ti do l'azione più veloce possibile 🚀",
    "Capito, hai fretta. Niente fronzoli: vai dritto al punto, ecco cosa fare:",
    "Zero tempo? Perfetto. Piano sprint: 1 minuto, 1 azione. Pronto?",
    "Ok ok, rapidissimo: fai BUZZ, prendi indizio, esci. Fatto. Domani continui.",
    "Vai di corsa? Ci sta. Ecco il micro-step più veloce che ho.",
    "30 secondi: apri BUZZ, tap, chiudi. Fatto. Domani altro giro.",
    "Tempo zero? Ok: 1 azione sola, il resto dopo. Vai!",
    "Fretta? Perfetto. Modalità sprint: ecco il minimo sindacale.",
    "Capito la fretta. Ti do solo l'essenziale: fai questo e basta.",
    "Ok, veloce: tap BUZZ, ricevi indizio, fine. Domani continui."
  ],
  neutral: [
    "Sai una cosa? Stai facendo bene. Sul serio, keep going 💪",
    "Tutto ok da questa parte. Tu dimmi cosa serve e io elaboro.",
    "Bene bene! Procediamo con metodo. Che facciamo adesso?",
    "Ottimo momento per fare il passo successivo. Sei pronto?",
    "Perfetto, sei in modalità operativa. Andiamo avanti?",
    "Tutto regolare. Dimmi pure cosa serve, sono qui per questo.",
    "Bene così! Ora vediamo il prossimo step logico.",
    "Ottimo ritmo. Continua così e arrivi lontano.",
    "Perfetto, sei ben posizionato. Avanti tutta!",
    "Bene! Ora facciamo il prossimo passo insieme."
  ],
  excited: [
    "Ecco l'energia giusta! Quando sei così carico, le cose succedono 🔥",
    "Adoro questa vibe! Sei in modalità 'winner', lo sento. Andiamo!",
    "Sì! Questa è la carica che serve. Sfruttiamola subito!",
    "Grande! Con questo entusiasmo arrivi lontano. Dai, che facciamo ora?",
    "Perfetto! Energia alta = risultati alti. Continuiamo così!",
    "Questa è la grinta giusta! Sei in modalità beast mode 💪",
    "Sì! Mi piace questa energia! Ora usiamola bene.",
    "Grande carica! Con questa vibe risolvi tutto al volo.",
    "Ottimo spirito! Sei già a metà strada verso la vittoria.",
    "Perfetto! Questa è l'attitudine vincente. Avanti!"
  ]
};
const BLOCKED_INTENTS = /* @__PURE__ */ new Set([
  "no_spoiler",
  "no_coordinates",
  "rules_violation",
  "report_abuse",
  "data_privacy"
]);
function maybeJoke(sentiment, ctx, intent) {
  messagesSinceJoke++;
  if (messagesSinceJoke < 5) {
    return { text: "", used: false };
  }
  if (intent && BLOCKED_INTENTS.has(intent)) {
    return { text: "", used: false };
  }
  if (sentiment === "rushed") {
    return { text: "", used: false };
  }
  const roll = Math.random();
  if (roll > 0.17) {
    return { text: "", used: false };
  }
  const pool = HUMOR_POOL[sentiment] || HUMOR_POOL.neutral;
  const joke = pool[Math.floor(Math.random() * pool.length)];
  messagesSinceJoke = 0;
  return { text: joke, used: true };
}

async function getUserId() {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    return user?.id || null;
  } catch {
    return null;
  }
}
async function logEvent(e) {
  try {
    const userId = await getUserId();
    if (!userId) {
      console.warn("[Telemetry] No user ID, skipping event:", e.event);
      return;
    }
    await supabase.from("norah_events").insert({
      user_id: userId,
      event: e.event,
      intent: e.intent || null,
      sentiment: e.sentiment || null,
      phase: e.phase || null,
      event_type: e.event,
      created_at: (/* @__PURE__ */ new Date()).toISOString()
    });
    console.log("[Telemetry] Event logged:", e.event);
  } catch (error) {
    console.error("[Telemetry] Failed to log event:", error);
  }
}
async function logJokeUsed(sentiment, jokeText) {
  await logEvent({
    event: "joke_used",
    sentiment,
    meta: { joke: jokeText.substring(0, 100) }
  });
}
async function logRetentionTrigger(reason, clues) {
  await logEvent({
    event: "retention_trigger",
    meta: { reason, clues }
  });
}

const QUIZ_POOL = [
  {
    question: 'Un indizio dice: "Vicino a 3 farmacie in area residenziale". Cosa restringe di più?',
    options: [
      "Area residenziale",
      "Il numero 3 di farmacie",
      'La parola "vicino"'
    ],
    correctIndex: 1,
    explanation: '"3 farmacie" è il dettaglio più raro. Cerchi zone dove convergono esattamente 3 farmacie in 500m.',
    tip: "Numeri precisi > aggettivi generici. Sempre."
  },
  {
    question: 'Due indizi: "Via con alberi secolari" e "Zona universitaria storica". Cosa fai?',
    options: [
      "Cerco tutte le università",
      "Cerco vie alberate vicino a università vecchie",
      "Ignoro gli alberi, troppo vago"
    ],
    correctIndex: 1,
    explanation: "Incrocia i due criteri: zone universitarie storiche (poche) CON vie alberate.",
    tip: "Interseziona gli indizi: il luogo deve soddisfare ENTRAMBI."
  },
  {
    question: 'Indizio: "Zona ad alto traffico pedonale, vicino metropolitana". Priorità?',
    options: [
      "Traffico pedonale",
      "Vicinanza metro",
      "Entrambi ugualmente"
    ],
    correctIndex: 1,
    explanation: "Le fermate metro sono punti fissi e verificabili. Il traffico pedonale è soggettivo.",
    tip: "Punti di riferimento fisici > aggettivi vaghi."
  }
];
function getRandomQuiz() {
  return QUIZ_POOL[Math.floor(Math.random() * QUIZ_POOL.length)];
}
function generateQuizChallenge() {
  const quiz = getRandomQuiz();
  const optionsText = quiz.options.map((opt, i) => `${i + 1}. ${opt}`).join("\n");
  return `🎯 **Mini-Quiz da 30s** (ti allena senza spoiler)

${quiz.question}

${optionsText}

Rispondi con 1, 2 o 3.`;
}

const PATTERN_DRILLS = [
  {
    title: "Drill Geografico",
    patterns: [
      'Indizio A: "Zona nord, vicino parco"',
      'Indizio B: "Area verde estesa, pista ciclabile"'
    ],
    question: "Quale restringe di più la zona finale?",
    answer: "Indizio B",
    reasoning: 'B è più specifico: "area verde estesa + pista ciclabile" sono 2 criteri verificabili. A dice solo "vicino parco" (generico).'
  },
  {
    title: "Drill Temporale",
    patterns: [
      'Indizio A: "Aperto dalle 8:00"',
      'Indizio B: "Chiuso il martedì"'
    ],
    question: "Quale esclude più luoghi?",
    answer: "Indizio B",
    reasoning: "B esclude tutti i posti aperti 7/7. A dice solo l'orario di apertura (molto comune)."
  },
  {
    title: "Drill Architettonico",
    patterns: [
      'Indizio A: "Edificio storico"',
      'Indizio B: "Facciata liberty con 3 archi"'
    ],
    question: "Quale permette di identificare il punto esatto?",
    answer: "Indizio B",
    reasoning: 'B dà dettagli architettonici specifici: "liberty + 3 archi" è rarissimo. A è troppo vago.'
  }
];
function getRandomDrill() {
  return PATTERN_DRILLS[Math.floor(Math.random() * PATTERN_DRILLS.length)];
}
function generateDrillChallenge() {
  const drill = getRandomDrill();
  const patternsText = drill.patterns.join("\n");
  return `🔍 **Pattern Drill** (riconosci cosa conta)

${drill.title}

${patternsText}

❓ ${drill.question}

Rispondi "A" o "B".`;
}

const FAQ_ESSENTIALS = [
  {
    question: "Come funziona M1SSION?",
    answer: "Raccogli indizi veri → trova pattern → fai Final Shot sul punto esatto → vinci premio reale. Zero spoiler, solo deduzione.",
    cta: "Vuoi iniziare?"
  },
  {
    question: "Cos'è Final Shot?",
    answer: 'È il momento in cui tiri una coordinata precisa. Se è nel raggio giusto (calcolato dai tuoi indizi), vinci. Max 2 tentativi/giorno. È "safe" se hai 8+ indizi.',
    cta: "Vuoi vedere un esempio safe?"
  },
  {
    question: "BUZZ Map a cosa serve?",
    answer: 'Visualizza i tuoi indizi su mappa e ti mostra il "raggio di confidenza". Più indizi hai, più il cerchio si stringe. Usi BUZZ Map DOPO aver raccolto 5+ indizi.',
    cta: "Apri BUZZ Map?"
  },
  {
    question: "Quanto costa?",
    answer: "BUZZ è gratuito (1 indizio/giorno). BUZZ Map e Final Shot sono a pagamento ma opzionali. Puoi vincere anche con solo BUZZ gratis se sei metodico.",
    cta: "Vedi piani"
  }
];
function generateFAQ60() {
  const faqText = FAQ_ESSENTIALS.map((item, i) => `**${i + 1}. ${item.question}**
${item.answer}`).join("\n\n");
  return `📚 **FAQ Essenziale** (60s di lettura, zero spoiler)

${faqText}

Vuoi approfondire qualcosa?`;
}

function choicesToNaturalText(choices) {
  if (choices.length === 0) return "";
  if (choices.length === 1) return choices[0];
  const connectors = [
    ["Puoi", "oppure"],
    ["Ti propongo", "o se preferisci"],
    ["Facciamo", "o meglio"],
    ["Prova", "altrimenti"],
    ["Scegli se", "o se vuoi"]
  ];
  const [first, second] = connectors[Math.floor(Math.random() * connectors.length)];
  if (choices.length === 2) {
    return `${first} ${choices[0].toLowerCase()}, ${second} ${choices[1].toLowerCase()}.`;
  }
  const lastChoice = choices[choices.length - 1];
  const otherChoices = choices.slice(0, -1);
  return `${first} ${otherChoices.map((c) => c.toLowerCase()).join(", ")}, ${second} ${lastChoice.toLowerCase()}.`;
}
function varyPhrase(base) {
  const variations = {
    "Facciamo": ["Proviamo", "Andiamo con", "Ti propongo", "Scegliamo"],
    "Vediamo": ["Guardiamo", "Analizziamo", "Controlliamo", "Verifichiamo"],
    "Capito": ["Chiaro", "Ok", "Ricevuto", "Perfetto"],
    "Ottimo": ["Bene", "Perfetto", "Fantastico", "Grande"],
    "Come": ["In che modo", "In quale modo", "Quale strada per"],
    "Cosa": ["Quale", "Che cosa", "Che tipo di"]
  };
  let result = base;
  for (const [key, alts] of Object.entries(variations)) {
    if (result.includes(key)) {
      const alt = alts[Math.floor(Math.random() * alts.length)];
      result = result.replace(key, alt);
      break;
    }
  }
  return result;
}
function detectEcho(reply, userInput) {
  const userWords = userInput.toLowerCase().split(/\s+/).filter((w) => w.length > 3);
  const replyLower = reply.toLowerCase();
  if (userWords.length < 3) return false;
  for (let i = 0; i <= userWords.length - 3; i++) {
    const trigram = userWords.slice(i, i + 3).join(" ");
    if (replyLower.includes(trigram)) {
      return true;
    }
  }
  const commonWords = /* @__PURE__ */ new Set([
    "buzz",
    "map",
    "final",
    "shot",
    "indizio",
    "come",
    "cosa",
    "dove",
    "quando",
    "che",
    "per",
    "non",
    "sono",
    "hai",
    "vuoi"
  ]);
  let matches = 0;
  for (const word of userWords) {
    if (!commonWords.has(word) && replyLower.includes(word)) {
      matches++;
    }
  }
  return matches > userWords.length * 0.4;
}
function removeEcho(reply, userInput) {
  const userWords = userInput.toLowerCase().split(/\s+/).filter((w) => w.length > 3);
  let result = reply;
  for (const word of userWords) {
    if (word.length > 5 && result.toLowerCase().includes(word)) {
      result = varyPhrase(result);
      break;
    }
  }
  return result;
}

let recentTemplateIds = [];
const MAX_RECENT_TEMPLATES = 3;
const EMPATHY_HOOKS = [
  "Ok {name}, ci penso io.",
  "Ci sono: lo facciamo semplice e utile.",
  "Ottima mossa, agente {code}.",
  "Respiro profondo: un passo e siamo avanti.",
  "Capito. Ti porto io nella direzione giusta.",
  "Va bene saltare i giri inutili. Ecco cosa conviene fare.",
  "Ho letto tra le righe: vuoi chiarezza rapida.",
  "Zero fronzoli: ti alleno io.",
  "Tranquillo, sei nel posto giusto.",
  "Capito: facciamolo semplice e concreto.",
  "Capito, {name}!",
  "Perfetto!",
  "Ci sono!",
  "Vediamo insieme.",
  "Ok, analizziamo.",
  "Bene!",
  "D'accordo.",
  "Capisco, {name}.",
  "Roger, agente {code}.",
  "Interessante.",
  "Procediamo.",
  "Chiaro, {name}.",
  "Ok agente {code}!",
  "Bene, vediamo.",
  "Ricevuto!",
  "{name}, perfetto.",
  "Ok {code}, ci siamo.",
  "Bene così!",
  "Roger!",
  "Ehi {name}, facciamolo insieme.",
  "Chiaro. Un attimo."
];
const CLOSERS = [
  "Sei più avanti di quanto pensi. Andiamo.",
  "Ottimo ritmo: un tassello alla volta.",
  "Ti copro le spalle: scelgo io la prossima mossa se vuoi.",
  "Quando sei pronto, facciamo un altro passo.",
  "Hai già {clues} indizi: capitalizziamoli.",
  "Se vuoi sprint, ho una mossa da 30s.",
  "Perfetto. Tocco leggero, risultati veri.",
  "Lo stai rendendo interessante.",
  "Ci siamo: un passo alla volta, e il quadro compare.",
  "Ottimo ritmo. Torna agli indizi di ieri: c'è un collegamento sottile.",
  "Se hai dubbi, scegli la pista più coerente col tema ricorrente.",
  "Non forzo la risposta: ti tengo centrato sulla logica giusta.",
  "Buona caccia — il dettaglio fa la differenza.",
  "Procediamo con calma: il metodo batte la fretta.",
  "Ogni frammento conta. Continua così.",
  "Il puzzle si compone pezzo dopo pezzo."
];
function hasEcho(reply, userInput) {
  return detectEcho(reply, userInput);
}
function renderChoiceList(choices) {
  return choicesToNaturalText(choices);
}
function getEmpathyHook(ctx) {
  const agentName = ctx?.agent?.username || "Agente";
  const agentCode = ctx?.agent?.code || "AG-XXXX";
  const available = EMPATHY_HOOKS.filter((h) => !recentTemplateIds.includes(h));
  const hook = available.length > 0 ? available[Math.floor(Math.random() * available.length)] : EMPATHY_HOOKS[Math.floor(Math.random() * EMPATHY_HOOKS.length)];
  recentTemplateIds.push(hook);
  if (recentTemplateIds.length > MAX_RECENT_TEMPLATES) {
    recentTemplateIds.shift();
  }
  return hook.replace("{name}", agentName).replace("{code}", agentCode);
}
function getCloser() {
  const available = CLOSERS.filter((c) => !recentTemplateIds.includes(c));
  const closer = available.length > 0 ? available[Math.floor(Math.random() * available.length)] : CLOSERS[Math.floor(Math.random() * CLOSERS.length)];
  recentTemplateIds.push(closer);
  if (recentTemplateIds.length > MAX_RECENT_TEMPLATES) {
    recentTemplateIds.shift();
  }
  return closer;
}
function generateBuzzExplanation(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const body = `BUZZ ti dà indizi veri sul posto giusto: ogni BUZZ = 1 indizio leggibile in 10s. Con 6–8 indizi inizi a vedere un pattern; con 9–12 prepari il Final Shot. Scegli tu il ritmo: una volta al giorno è perfetto.`;
  const choices = [
    "aprire BUZZ e prendere il primo indizio di oggi",
    "spiegarti come leggere correttamente un indizio"
  ];
  return `${hook}

${body}

${choicesToNaturalText(choices)}

${closer}`;
}
function generateMissionExplanation(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const body = `M1SSION è una caccia al premio reale: raccogli indizi, trovi pattern, tiri il Final Shot sul punto esatto. Vince chi deduce meglio, non chi spende di più.`;
  const choices = [
    "prendere un indizio adesso (ti guido io)",
    "ascoltare la spiegazione di Final Shot in 2 frasi + una prova safe"
  ];
  return `${hook}

${body}

${choicesToNaturalText(choices)}

${closer}`;
}
function generateHowToStart(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const body = `Ci sono, partiamo in modo leggero. Prima apri BUZZ e prendi 1 indizio (30s), poi torni qui e te lo traduco in azioni (60s).`;
  const choices = [
    "farlo ora",
    "avere prima una panoramica rapida di M1SSION"
  ];
  return `${hook}

${body} ${choicesToNaturalText(choices)}

${closer}`;
}
function generateNoBuzzResponse(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const body = `Ok, niente BUZZ ora. Ti propongo tre alternative per allenarti senza raccogliere indizi`;
  const choices = [
    "un **Mini-Quiz da 30s** dove ti alleno su un indizio tipico (zero spoiler)",
    "un **Pattern Drill** per riconoscere quale indizio restringe di più",
    "le **FAQ in 60s** con 4 domande essenziali su M1SSION"
  ];
  return `${hook}

${body}: ${choicesToNaturalText(choices)}

${closer}`;
}
function generateBuzzVsMapComparison(ctx) {
  const hook = getEmpathyHook(ctx);
  const closer = getCloser();
  const body = `**BUZZ** = raccogli indizi veri (1/giorno gratis).
**BUZZ Map** = visualizza indizi su mappa + raggio di confidenza.

Il flusso: BUZZ → raccogli 5+ indizi → BUZZ Map → vedi dove convergono → Final Shot.`;
  const choices = [
    "Faccio un BUZZ ora",
    "Vedo BUZZ Map (serve ≥3 indizi)",
    "Spiega Final Shot"
  ];
  return `${hook}

${body}

Scelte rapide:
${renderChoiceList(choices)}

${closer}`;
}
function generateRulesShort(ctx) {
  const hook = getEmpathyHook(ctx);
  const closer = getCloser();
  const body = `**Regole in 3 righe**:
1. Raccogli indizi con BUZZ (gratuito).
2. Trova pattern e restringe l'area.
3. Tira Final Shot sul punto esatto (max 2/giorno).`;
  const choices = [
    "Inizia con 1 BUZZ",
    "Spiega Final Shot safe",
    "FAQ completa"
  ];
  return `${hook}

${body}

${renderChoiceList(choices)}

${closer}`;
}
function generateSalutoResponse(ctx) {
  const hook = varyPhrase(getEmpathyHook(ctx));
  const closer = getCloser();
  const clues = ctx?.stats?.clues || 0;
  const body = clues > 0 ? `Hai già ${clues} indizi raccolti. Facciamo una mossa utile adesso?` : `Ehi! Facciamo una mossa semplice e utile per iniziare.`;
  const choices = [
    "aprire BUZZ (1 indizio in 60s)",
    "avere una panoramica di M1SSION",
    "vedere alternative senza BUZZ"
  ];
  return `${hook}

${body} ${choicesToNaturalText(choices)}

${closer}`;
}
function generateRetentionResponse(ctx, phase) {
  const hook = getEmpathyHook(ctx);
  const clues = ctx?.stats?.clues || 0;
  logRetentionTrigger("frustrated_exit", clues);
  const body = clues > 0 ? `Capisco la sensazione, succede quando manca il primo indizio.
Hai già ${clues} indizi: sei più avanti di quanto pensi.
Facciamo così: 60 secondi insieme → 1 BUZZ adesso e lo leggiamo subito.
Se non ti è utile, chiudiamo qui. Ti va?` : `Capisco la frustrazione. Nessun problema.
Prima di andare, posso mostrarti 1 BUZZ in 60 secondi? Zero impegno, solo per vedere se ti è utile.
Se non funziona, chiudiamo qui. Deal?`;
  return `${hook}

${body}`;
}
function generateClarifyResponse(ctx, suggestedIntent) {
  const hook = getEmpathyHook(ctx);
  const suggestions = {
    about_buzz: ["Come funziona BUZZ?", "Quanto costa BUZZ?"],
    about_mission: ["Cos'è M1SSION?", "Come si vince?"],
    about_finalshot: ["Cos'è Final Shot?", "Come funziona Final Shot?"],
    plans: ["Quali piani ci sono?", "Piani gratuiti?"]
  };
  const [opt1, opt2] = suggestions[suggestedIntent] || ["Spiega BUZZ", "Spiega M1SSION"];
  return `${hook}

Non sono sicura di aver capito. Intendi:
1. ${opt1}
2. ${opt2}

Scegli tu o riformula.`;
}
function generateUnknownResponse(ctx, userInput) {
  const hook = getEmpathyHook(ctx);
  const closer = getCloser();
  const body = `Non ho capito perfettamente, ma ci arrivo.`;
  const choices = [
    "Vuoi sapere come funziona BUZZ?",
    "Oppure preferisci una guida rapida per iniziare?"
  ];
  return `${hook}

${body}

${renderChoiceList(choices)}

${closer}`;
}
function generatePricingResponse(ctx) {
  const hook = getEmpathyHook(ctx);
  return `${hook}

BUZZ è **gratuito**. Zero costi, zero sorprese.
Pronto a provare? → Apri BUZZ ora.`;
}
function handleMultiIntent(multiIntents, ctx, userInput) {
  const hook = getEmpathyHook(ctx);
  const closer = getCloser();
  if (multiIntents.length === 0) {
    return generateUnknownResponse(ctx);
  }
  const cards = [];
  for (let i = 0; i < Math.min(2, multiIntents.length); i++) {
    const intentData = multiIntents[i];
    const kb = norahKB[intentData.intent];
    if (kb && "a" in kb) {
      const text = kb.a[0] || "Info non disponibile";
      cards.push(`**${String(intentData.intent)}**
${text}`);
    }
  }
  const cta = "\n\nVuoi approfondire uno di questi? Oppure facciamo 1 BUZZ rapido?";
  return `${hook}

${cards.join("\n\n")}${cta}

${closer}`;
}
function composeReply(intentResult, userInput, ctx) {
  const phase = getPhase(ctx, userInput, [intentResult.intent]);
  const sentiment = detectSentiment(userInput);
  logEvent({
    event: "reply_generated",
    intent: intentResult.intent,
    sentiment,
    phase,
    meta: { confidence: intentResult.confidence }
  });
  if (isFollowUp(userInput)) {
    return generateFollowUpReply(ctx, phase, userInput);
  }
  if (isPricingQuery(userInput)) {
    return generatePricingResponse(ctx);
  }
  if (/mini.?quiz|quiz/i.test(userInput)) {
    return generateQuizChallenge();
  }
  if (/pattern.?drill|drill/i.test(userInput)) {
    return generateDrillChallenge();
  }
  if (/faq|domande/i.test(userInput)) {
    return generateFAQ60();
  }
  if (sentiment === "frustrated" && /me\s+ne\s+vado|basta|difficile/i.test(userInput)) {
    return generateRetentionResponse(ctx);
  }
  if (intentResult.intent === "clarify_needed") {
    const suggested = intentResult.slots?.suggested_intent || "about_buzz";
    return generateClarifyResponse(ctx, suggested);
  }
  if (intentResult.multiIntents && intentResult.multiIntents.length > 1) {
    return handleMultiIntent(intentResult.multiIntents, ctx);
  }
  let baseReply = "";
  switch (intentResult.intent) {
    case "about_buzz":
      baseReply = generateBuzzExplanation(ctx);
      break;
    case "about_mission":
      baseReply = generateMissionExplanation(ctx);
      break;
    case "help":
    case "help_start":
      baseReply = generateHowToStart(ctx);
      break;
    case "saluto":
    case "smalltalk":
      baseReply = generateSalutoResponse(ctx);
      break;
    case "no_buzz":
      baseReply = generateNoBuzzResponse(ctx);
      break;
    case "diff_buzz_vs_map":
      baseReply = generateBuzzVsMapComparison(ctx);
      break;
    case "rules_short":
      baseReply = generateRulesShort(ctx);
      break;
    case "unknown":
      baseReply = generateUnknownResponse(ctx);
      break;
    default:
      const kb = norahKB[intentResult.intent];
      if (kb && "a" in kb) {
        const hook = getEmpathyHook(ctx);
        const closer = getCloser();
        const body = kb.a[0] || "Info non disponibile.";
        baseReply = `${hook}

${body}

${closer}`;
      } else {
        baseReply = generateUnknownResponse(ctx);
      }
  }
  if (hasEcho(baseReply, userInput)) {
    console.log("[Reply] Echo detected, paraphrasing...");
    const hook = getEmpathyHook(ctx);
    const closer = getCloser();
    baseReply = `${hook}

Capito la domanda. ${baseReply.split("\n\n")[1] || baseReply}

${closer}`;
  }
  const joke = maybeJoke(sentiment, ctx, intentResult.intent);
  if (joke.used) {
    logJokeUsed(sentiment, joke.text);
    baseReply = `${joke.text}

${baseReply}`;
  }
  if (detectEcho(baseReply, userInput)) {
    console.log("[NORAH v6.9] Echo detected, rephrasing...");
    baseReply = removeEcho(baseReply, userInput);
  }
  if (baseReply.length > 1e3) {
    baseReply = baseReply.substring(0, 1e3) + "…";
  }
  return baseReply;
}
function isPricingQuery(input) {
  const lower = input.toLowerCase();
  const patterns = [
    /si\s+paga/i,
    /è\s+gratis/i,
    /costa/i,
    /prezzo/i,
    /quanto\s+costa/i,
    /è\s+a\s+pagamento/i,
    /devo\s+pagare/i,
    /gratuito/i
  ];
  return patterns.some((p) => p.test(lower)) && lower.includes("buzz");
}
async function generateReply(userInput) {
  const ctx = await __vitePreload(() => import('./contextBuilder.Bvl_gp-a.js'),true?__vite__mapDeps([11,1,2,3,6,5,7,8,9]):void 0).then((m) => m.buildNorahContext());
  const intentResult = routeIntent(userInput);
  return composeReply(intentResult, userInput, ctx);
}

function useNorahLLM({ userId, route, locale = "it" }) {
  const [isProcessing, setIsProcessing] = reactExports.useState(false);
  const [conversationHistory, setConversationHistory] = reactExports.useState([]);
  const [isOffline, setIsOffline] = reactExports.useState(false);
  const { toast } = useToast();
  const askNorah = reactExports.useCallback(async (userInput) => {
    if (!userInput.trim() || isProcessing) return "";
    setIsProcessing(true);
    const traceId = crypto.randomUUID();
    console.log(`[NorahLLM] traceId:${traceId} input: "${userInput.substring(0, 50)}..."`);
    try {
      const intentResult = routeIntent(userInput);
      console.log(`[NorahLLM] traceId:${traceId} intent:`, intentResult);
      if (shouldClarify(intentResult)) {
        const clarification = getClarificationQuestion(userInput);
        setConversationHistory((prev) => [
          ...prev,
          { role: "user", content: userInput },
          { role: "assistant", content: clarification }
        ]);
        setIsProcessing(false);
        return clarification;
      }
      const userMessage = { role: "user", content: userInput };
      setConversationHistory((prev) => [...prev, userMessage]);
      const options = {
        userId,
        userMessage: userInput,
        route,
        locale,
        conversationHistory
      };
      const response = await processAIRequest(options);
      let finalMessage = response.message;
      const aiMessage = { role: "assistant", content: finalMessage };
      setConversationHistory((prev) => [...prev, aiMessage]);
      setIsOffline(false);
      console.log(`[NorahLLM] traceId:${traceId} success`);
      return finalMessage;
    } catch (error) {
      console.error(`[NorahLLM] traceId:${traceId} error:`, error);
      const is402or429 = error?.message?.includes("402") || error?.message?.includes("429") || error?.status === 402 || error?.status === 429;
      if (is402or429) {
        setIsOffline(true);
        toast({
          title: "⚠️ Modalità Offline",
          description: "Limite raggiunto. Risposte template attive.",
          variant: "destructive"
        });
      }
      console.log(`[NorahLLM] traceId:${traceId} falling back to local engine`);
      const fallbackReply = await generateReply(userInput);
      const aiMessage = { role: "assistant", content: fallbackReply };
      setConversationHistory((prev) => [
        { role: "user", content: userInput },
        aiMessage
      ]);
      setIsOffline(true);
      return fallbackReply;
    } finally {
      setIsProcessing(false);
    }
  }, [userId, route, locale, conversationHistory, isProcessing, toast]);
  const clearHistory = reactExports.useCallback(() => {
    setConversationHistory([]);
    setIsOffline(false);
  }, []);
  return {
    askNorah,
    clearHistory,
    isProcessing,
    conversationHistory,
    isOffline
  };
}

/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */

const {
  entries,
  setPrototypeOf,
  isFrozen,
  getPrototypeOf,
  getOwnPropertyDescriptor
} = Object;
let {
  freeze,
  seal,
  create
} = Object; // eslint-disable-line import/no-mutable-exports
let {
  apply,
  construct
} = typeof Reflect !== 'undefined' && Reflect;
if (!freeze) {
  freeze = function freeze(x) {
    return x;
  };
}
if (!seal) {
  seal = function seal(x) {
    return x;
  };
}
if (!apply) {
  apply = function apply(func, thisArg) {
    for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
      args[_key - 2] = arguments[_key];
    }
    return func.apply(thisArg, args);
  };
}
if (!construct) {
  construct = function construct(Func) {
    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
      args[_key2 - 1] = arguments[_key2];
    }
    return new Func(...args);
  };
}
const arrayForEach = unapply(Array.prototype.forEach);
const arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);
const arrayPop = unapply(Array.prototype.pop);
const arrayPush = unapply(Array.prototype.push);
const arraySplice = unapply(Array.prototype.splice);
const stringToLowerCase = unapply(String.prototype.toLowerCase);
const stringToString = unapply(String.prototype.toString);
const stringMatch = unapply(String.prototype.match);
const stringReplace = unapply(String.prototype.replace);
const stringIndexOf = unapply(String.prototype.indexOf);
const stringTrim = unapply(String.prototype.trim);
const objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);
const regExpTest = unapply(RegExp.prototype.test);
const typeErrorCreate = unconstruct(TypeError);
/**
 * Creates a new function that calls the given function with a specified thisArg and arguments.
 *
 * @param func - The function to be wrapped and called.
 * @returns A new function that calls the given function with a specified thisArg and arguments.
 */
function unapply(func) {
  return function (thisArg) {
    if (thisArg instanceof RegExp) {
      thisArg.lastIndex = 0;
    }
    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
      args[_key3 - 1] = arguments[_key3];
    }
    return apply(func, thisArg, args);
  };
}
/**
 * Creates a new function that constructs an instance of the given constructor function with the provided arguments.
 *
 * @param func - The constructor function to be wrapped and called.
 * @returns A new function that constructs an instance of the given constructor function with the provided arguments.
 */
function unconstruct(Func) {
  return function () {
    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
      args[_key4] = arguments[_key4];
    }
    return construct(Func, args);
  };
}
/**
 * Add properties to a lookup table
 *
 * @param set - The set to which elements will be added.
 * @param array - The array containing elements to be added to the set.
 * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.
 * @returns The modified set with added elements.
 */
function addToSet(set, array) {
  let transformCaseFunc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : stringToLowerCase;
  if (setPrototypeOf) {
    // Make 'in' and truthy checks like Boolean(set.constructor)
    // independent of any properties defined on Object.prototype.
    // Prevent prototype setters from intercepting set as a this value.
    setPrototypeOf(set, null);
  }
  let l = array.length;
  while (l--) {
    let element = array[l];
    if (typeof element === 'string') {
      const lcElement = transformCaseFunc(element);
      if (lcElement !== element) {
        // Config presets (e.g. tags.js, attrs.js) are immutable.
        if (!isFrozen(array)) {
          array[l] = lcElement;
        }
        element = lcElement;
      }
    }
    set[element] = true;
  }
  return set;
}
/**
 * Clean up an array to harden against CSPP
 *
 * @param array - The array to be cleaned.
 * @returns The cleaned version of the array
 */
function cleanArray(array) {
  for (let index = 0; index < array.length; index++) {
    const isPropertyExist = objectHasOwnProperty(array, index);
    if (!isPropertyExist) {
      array[index] = null;
    }
  }
  return array;
}
/**
 * Shallow clone an object
 *
 * @param object - The object to be cloned.
 * @returns A new object that copies the original.
 */
function clone(object) {
  const newObject = create(null);
  for (const [property, value] of entries(object)) {
    const isPropertyExist = objectHasOwnProperty(object, property);
    if (isPropertyExist) {
      if (Array.isArray(value)) {
        newObject[property] = cleanArray(value);
      } else if (value && typeof value === 'object' && value.constructor === Object) {
        newObject[property] = clone(value);
      } else {
        newObject[property] = value;
      }
    }
  }
  return newObject;
}
/**
 * This method automatically checks if the prop is function or getter and behaves accordingly.
 *
 * @param object - The object to look up the getter function in its prototype chain.
 * @param prop - The property name for which to find the getter function.
 * @returns The getter function found in the prototype chain or a fallback function.
 */
function lookupGetter(object, prop) {
  while (object !== null) {
    const desc = getOwnPropertyDescriptor(object, prop);
    if (desc) {
      if (desc.get) {
        return unapply(desc.get);
      }
      if (typeof desc.value === 'function') {
        return unapply(desc.value);
      }
    }
    object = getPrototypeOf(object);
  }
  function fallbackValue() {
    return null;
  }
  return fallbackValue;
}

const html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'search', 'section', 'select', 'shadow', 'slot', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']);
const svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'enterkeyhint', 'exportparts', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'inputmode', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'part', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);
const svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']);
// List of SVG elements that are disallowed by default.
// We still need to know them so that we can do namespace
// checks properly in case one wants to add them to
// allow-list.
const svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);
const mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover', 'mprescripts']);
// Similarly to SVG, we want to know all MathML elements,
// even those that we disallow by default.
const mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);
const text = freeze(['#text']);

const html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'exportparts', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inert', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'part', 'pattern', 'placeholder', 'playsinline', 'popover', 'popovertarget', 'popovertargetaction', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'slot', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'wrap', 'xmlns', 'slot']);
const svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'amplitude', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'exponent', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'intercept', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'mask-type', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'slope', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'tablevalues', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);
const mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);
const xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);

// eslint-disable-next-line unicorn/better-regex
const MUSTACHE_EXPR = seal(/\{\{[\w\W]*|[\w\W]*\}\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode
const ERB_EXPR = seal(/<%[\w\W]*|[\w\W]*%>/gm);
const TMPLIT_EXPR = seal(/\$\{[\w\W]*/gm); // eslint-disable-line unicorn/better-regex
const DATA_ATTR = seal(/^data-[\-\w.\u00B7-\uFFFF]+$/); // eslint-disable-line no-useless-escape
const ARIA_ATTR = seal(/^aria-[\-\w]+$/); // eslint-disable-line no-useless-escape
const IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i // eslint-disable-line no-useless-escape
);
const IS_SCRIPT_OR_DATA = seal(/^(?:\w+script|data):/i);
const ATTR_WHITESPACE = seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g // eslint-disable-line no-control-regex
);
const DOCTYPE_NAME = seal(/^html$/i);
const CUSTOM_ELEMENT = seal(/^[a-z][.\w]*(-[.\w]+)+$/i);

var EXPRESSIONS = /*#__PURE__*/Object.freeze({
  __proto__: null,
  ARIA_ATTR: ARIA_ATTR,
  ATTR_WHITESPACE: ATTR_WHITESPACE,
  CUSTOM_ELEMENT: CUSTOM_ELEMENT,
  DATA_ATTR: DATA_ATTR,
  DOCTYPE_NAME: DOCTYPE_NAME,
  ERB_EXPR: ERB_EXPR,
  IS_ALLOWED_URI: IS_ALLOWED_URI,
  IS_SCRIPT_OR_DATA: IS_SCRIPT_OR_DATA,
  MUSTACHE_EXPR: MUSTACHE_EXPR,
  TMPLIT_EXPR: TMPLIT_EXPR
});

/* eslint-disable @typescript-eslint/indent */
// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType
const NODE_TYPE = {
  element: 1,
  text: 3,
  // Deprecated
  progressingInstruction: 7,
  comment: 8,
  document: 9};
const getGlobal = function getGlobal() {
  return typeof window === 'undefined' ? null : window;
};
/**
 * Creates a no-op policy for internal use only.
 * Don't export this function outside this module!
 * @param trustedTypes The policy factory.
 * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).
 * @return The policy created (or null, if Trusted Types
 * are not supported or creating the policy failed).
 */
const _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, purifyHostElement) {
  if (typeof trustedTypes !== 'object' || typeof trustedTypes.createPolicy !== 'function') {
    return null;
  }
  // Allow the callers to control the unique policy name
  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.
  // Policy creation with duplicate names throws in Trusted Types.
  let suffix = null;
  const ATTR_NAME = 'data-tt-policy-suffix';
  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {
    suffix = purifyHostElement.getAttribute(ATTR_NAME);
  }
  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');
  try {
    return trustedTypes.createPolicy(policyName, {
      createHTML(html) {
        return html;
      },
      createScriptURL(scriptUrl) {
        return scriptUrl;
      }
    });
  } catch (_) {
    // Policy creation failed (most likely another DOMPurify script has
    // already run). Skip creating the policy, as this will only cause errors
    // if TT are enforced.
    console.warn('TrustedTypes policy ' + policyName + ' could not be created.');
    return null;
  }
};
const _createHooksMap = function _createHooksMap() {
  return {
    afterSanitizeAttributes: [],
    afterSanitizeElements: [],
    afterSanitizeShadowDOM: [],
    beforeSanitizeAttributes: [],
    beforeSanitizeElements: [],
    beforeSanitizeShadowDOM: [],
    uponSanitizeAttribute: [],
    uponSanitizeElement: [],
    uponSanitizeShadowNode: []
  };
};
function createDOMPurify() {
  let window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();
  const DOMPurify = root => createDOMPurify(root);
  DOMPurify.version = '3.3.0';
  DOMPurify.removed = [];
  if (!window || !window.document || window.document.nodeType !== NODE_TYPE.document || !window.Element) {
    // Not running in a browser, provide a factory function
    // so that you can pass your own Window
    DOMPurify.isSupported = false;
    return DOMPurify;
  }
  let {
    document
  } = window;
  const originalDocument = document;
  const currentScript = originalDocument.currentScript;
  const {
    DocumentFragment,
    HTMLTemplateElement,
    Node,
    Element,
    NodeFilter,
    NamedNodeMap = window.NamedNodeMap || window.MozNamedAttrMap,
    HTMLFormElement,
    DOMParser,
    trustedTypes
  } = window;
  const ElementPrototype = Element.prototype;
  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');
  const remove = lookupGetter(ElementPrototype, 'remove');
  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');
  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');
  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');
  // As per issue #47, the web-components registry is inherited by a
  // new document created via createHTMLDocument. As per the spec
  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)
  // a new empty registry is used when creating a template contents owner
  // document, so we use that as our parent document to ensure nothing
  // is inherited.
  if (typeof HTMLTemplateElement === 'function') {
    const template = document.createElement('template');
    if (template.content && template.content.ownerDocument) {
      document = template.content.ownerDocument;
    }
  }
  let trustedTypesPolicy;
  let emptyHTML = '';
  const {
    implementation,
    createNodeIterator,
    createDocumentFragment,
    getElementsByTagName
  } = document;
  const {
    importNode
  } = originalDocument;
  let hooks = _createHooksMap();
  /**
   * Expose whether this browser supports running the full DOMPurify.
   */
  DOMPurify.isSupported = typeof entries === 'function' && typeof getParentNode === 'function' && implementation && implementation.createHTMLDocument !== undefined;
  const {
    MUSTACHE_EXPR,
    ERB_EXPR,
    TMPLIT_EXPR,
    DATA_ATTR,
    ARIA_ATTR,
    IS_SCRIPT_OR_DATA,
    ATTR_WHITESPACE,
    CUSTOM_ELEMENT
  } = EXPRESSIONS;
  let {
    IS_ALLOWED_URI: IS_ALLOWED_URI$1
  } = EXPRESSIONS;
  /**
   * We consider the elements and attributes below to be safe. Ideally
   * don't add any new ones but feel free to remove unwanted ones.
   */
  /* allowed element names */
  let ALLOWED_TAGS = null;
  const DEFAULT_ALLOWED_TAGS = addToSet({}, [...html$1, ...svg$1, ...svgFilters, ...mathMl$1, ...text]);
  /* Allowed attribute names */
  let ALLOWED_ATTR = null;
  const DEFAULT_ALLOWED_ATTR = addToSet({}, [...html, ...svg, ...mathMl, ...xml]);
  /*
   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.
   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)
   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)
   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.
   */
  let CUSTOM_ELEMENT_HANDLING = Object.seal(create(null, {
    tagNameCheck: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: null
    },
    attributeNameCheck: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: null
    },
    allowCustomizedBuiltInElements: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: false
    }
  }));
  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */
  let FORBID_TAGS = null;
  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */
  let FORBID_ATTR = null;
  /* Config object to store ADD_TAGS/ADD_ATTR functions (when used as functions) */
  const EXTRA_ELEMENT_HANDLING = Object.seal(create(null, {
    tagCheck: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: null
    },
    attributeCheck: {
      writable: true,
      configurable: false,
      enumerable: true,
      value: null
    }
  }));
  /* Decide if ARIA attributes are okay */
  let ALLOW_ARIA_ATTR = true;
  /* Decide if custom data attributes are okay */
  let ALLOW_DATA_ATTR = true;
  /* Decide if unknown protocols are okay */
  let ALLOW_UNKNOWN_PROTOCOLS = false;
  /* Decide if self-closing tags in attributes are allowed.
   * Usually removed due to a mXSS issue in jQuery 3.0 */
  let ALLOW_SELF_CLOSE_IN_ATTR = true;
  /* Output should be safe for common template engines.
   * This means, DOMPurify removes data attributes, mustaches and ERB
   */
  let SAFE_FOR_TEMPLATES = false;
  /* Output should be safe even for XML used within HTML and alike.
   * This means, DOMPurify removes comments when containing risky content.
   */
  let SAFE_FOR_XML = true;
  /* Decide if document with <html>... should be returned */
  let WHOLE_DOCUMENT = false;
  /* Track whether config is already set on this instance of DOMPurify. */
  let SET_CONFIG = false;
  /* Decide if all elements (e.g. style, script) must be children of
   * document.body. By default, browsers might move them to document.head */
  let FORCE_BODY = false;
  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html
   * string (or a TrustedHTML object if Trusted Types are supported).
   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead
   */
  let RETURN_DOM = false;
  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html
   * string  (or a TrustedHTML object if Trusted Types are supported) */
  let RETURN_DOM_FRAGMENT = false;
  /* Try to return a Trusted Type object instead of a string, return a string in
   * case Trusted Types are not supported  */
  let RETURN_TRUSTED_TYPE = false;
  /* Output should be free from DOM clobbering attacks?
   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.
   */
  let SANITIZE_DOM = true;
  /* Achieve full DOM Clobbering protection by isolating the namespace of named
   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.
   *
   * HTML/DOM spec rules that enable DOM Clobbering:
   *   - Named Access on Window (§7.3.3)
   *   - DOM Tree Accessors (§3.1.5)
   *   - Form Element Parent-Child Relations (§4.10.3)
   *   - Iframe srcdoc / Nested WindowProxies (§4.8.5)
   *   - HTMLCollection (§4.2.10.2)
   *
   * Namespace isolation is implemented by prefixing `id` and `name` attributes
   * with a constant string, i.e., `user-content-`
   */
  let SANITIZE_NAMED_PROPS = false;
  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';
  /* Keep element content when removing element? */
  let KEEP_CONTENT = true;
  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead
   * of importing it into a new Document and returning a sanitized copy */
  let IN_PLACE = false;
  /* Allow usage of profiles like html, svg and mathMl */
  let USE_PROFILES = {};
  /* Tags to ignore content of when KEEP_CONTENT is true */
  let FORBID_CONTENTS = null;
  const DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);
  /* Tags that are safe for data: URIs */
  let DATA_URI_TAGS = null;
  const DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);
  /* Attributes safe for values like "javascript:" */
  let URI_SAFE_ATTRIBUTES = null;
  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);
  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';
  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';
  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';
  /* Document namespace */
  let NAMESPACE = HTML_NAMESPACE;
  let IS_EMPTY_INPUT = false;
  /* Allowed XHTML+XML namespaces */
  let ALLOWED_NAMESPACES = null;
  const DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);
  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);
  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);
  // Certain elements are allowed in both SVG and HTML
  // namespace. We need to specify them explicitly
  // so that they don't get erroneously deleted from
  // HTML namespace.
  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);
  /* Parsing of strict XHTML documents */
  let PARSER_MEDIA_TYPE = null;
  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];
  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';
  let transformCaseFunc = null;
  /* Keep a reference to config to pass to hooks */
  let CONFIG = null;
  /* Ideally, do not touch anything below this line */
  /* ______________________________________________ */
  const formElement = document.createElement('form');
  const isRegexOrFunction = function isRegexOrFunction(testValue) {
    return testValue instanceof RegExp || testValue instanceof Function;
  };
  /**
   * _parseConfig
   *
   * @param cfg optional config literal
   */
  // eslint-disable-next-line complexity
  const _parseConfig = function _parseConfig() {
    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    if (CONFIG && CONFIG === cfg) {
      return;
    }
    /* Shield configuration object from tampering */
    if (!cfg || typeof cfg !== 'object') {
      cfg = {};
    }
    /* Shield configuration object from prototype pollution */
    cfg = clone(cfg);
    PARSER_MEDIA_TYPE =
    // eslint-disable-next-line unicorn/prefer-includes
    SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? DEFAULT_PARSER_MEDIA_TYPE : cfg.PARSER_MEDIA_TYPE;
    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.
    transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;
    /* Set configuration parameters */
    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS') ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;
    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR') ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;
    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES') ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;
    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR') ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), cfg.ADD_URI_SAFE_ATTR, transformCaseFunc) : DEFAULT_URI_SAFE_ATTRIBUTES;
    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS') ? addToSet(clone(DEFAULT_DATA_URI_TAGS), cfg.ADD_DATA_URI_TAGS, transformCaseFunc) : DEFAULT_DATA_URI_TAGS;
    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS') ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;
    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS') ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : clone({});
    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR') ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : clone({});
    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES') ? cfg.USE_PROFILES : false;
    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true
    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true
    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false
    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true
    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false
    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true
    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false
    RETURN_DOM = cfg.RETURN_DOM || false; // Default false
    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false
    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false
    FORCE_BODY = cfg.FORCE_BODY || false; // Default false
    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true
    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false
    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true
    IN_PLACE = cfg.IN_PLACE || false; // Default false
    IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI;
    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;
    MATHML_TEXT_INTEGRATION_POINTS = cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;
    HTML_INTEGRATION_POINTS = cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;
    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};
    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {
      CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;
    }
    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {
      CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;
    }
    if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {
      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;
    }
    if (SAFE_FOR_TEMPLATES) {
      ALLOW_DATA_ATTR = false;
    }
    if (RETURN_DOM_FRAGMENT) {
      RETURN_DOM = true;
    }
    /* Parse profile info */
    if (USE_PROFILES) {
      ALLOWED_TAGS = addToSet({}, text);
      ALLOWED_ATTR = [];
      if (USE_PROFILES.html === true) {
        addToSet(ALLOWED_TAGS, html$1);
        addToSet(ALLOWED_ATTR, html);
      }
      if (USE_PROFILES.svg === true) {
        addToSet(ALLOWED_TAGS, svg$1);
        addToSet(ALLOWED_ATTR, svg);
        addToSet(ALLOWED_ATTR, xml);
      }
      if (USE_PROFILES.svgFilters === true) {
        addToSet(ALLOWED_TAGS, svgFilters);
        addToSet(ALLOWED_ATTR, svg);
        addToSet(ALLOWED_ATTR, xml);
      }
      if (USE_PROFILES.mathMl === true) {
        addToSet(ALLOWED_TAGS, mathMl$1);
        addToSet(ALLOWED_ATTR, mathMl);
        addToSet(ALLOWED_ATTR, xml);
      }
    }
    /* Merge configuration parameters */
    if (cfg.ADD_TAGS) {
      if (typeof cfg.ADD_TAGS === 'function') {
        EXTRA_ELEMENT_HANDLING.tagCheck = cfg.ADD_TAGS;
      } else {
        if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {
          ALLOWED_TAGS = clone(ALLOWED_TAGS);
        }
        addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);
      }
    }
    if (cfg.ADD_ATTR) {
      if (typeof cfg.ADD_ATTR === 'function') {
        EXTRA_ELEMENT_HANDLING.attributeCheck = cfg.ADD_ATTR;
      } else {
        if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {
          ALLOWED_ATTR = clone(ALLOWED_ATTR);
        }
        addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);
      }
    }
    if (cfg.ADD_URI_SAFE_ATTR) {
      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);
    }
    if (cfg.FORBID_CONTENTS) {
      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {
        FORBID_CONTENTS = clone(FORBID_CONTENTS);
      }
      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);
    }
    /* Add #text in case KEEP_CONTENT is set to true */
    if (KEEP_CONTENT) {
      ALLOWED_TAGS['#text'] = true;
    }
    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */
    if (WHOLE_DOCUMENT) {
      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);
    }
    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */
    if (ALLOWED_TAGS.table) {
      addToSet(ALLOWED_TAGS, ['tbody']);
      delete FORBID_TAGS.tbody;
    }
    if (cfg.TRUSTED_TYPES_POLICY) {
      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {
        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');
      }
      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {
        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');
      }
      // Overwrite existing TrustedTypes policy.
      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;
      // Sign local variables required by `sanitize`.
      emptyHTML = trustedTypesPolicy.createHTML('');
    } else {
      // Uninitialized policy, attempt to initialize the internal dompurify policy.
      if (trustedTypesPolicy === undefined) {
        trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, currentScript);
      }
      // If creating the internal policy succeeded sign internal variables.
      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {
        emptyHTML = trustedTypesPolicy.createHTML('');
      }
    }
    // Prevent further manipulation of configuration.
    // Not available in IE8, Safari 5, etc.
    if (freeze) {
      freeze(cfg);
    }
    CONFIG = cfg;
  };
  /* Keep track of all possible SVG and MathML tags
   * so that we can perform the namespace checks
   * correctly. */
  const ALL_SVG_TAGS = addToSet({}, [...svg$1, ...svgFilters, ...svgDisallowed]);
  const ALL_MATHML_TAGS = addToSet({}, [...mathMl$1, ...mathMlDisallowed]);
  /**
   * @param element a DOM element whose namespace is being checked
   * @returns Return false if the element has a
   *  namespace that a spec-compliant parser would never
   *  return. Return true otherwise.
   */
  const _checkValidNamespace = function _checkValidNamespace(element) {
    let parent = getParentNode(element);
    // In JSDOM, if we're inside shadow DOM, then parentNode
    // can be null. We just simulate parent in this case.
    if (!parent || !parent.tagName) {
      parent = {
        namespaceURI: NAMESPACE,
        tagName: 'template'
      };
    }
    const tagName = stringToLowerCase(element.tagName);
    const parentTagName = stringToLowerCase(parent.tagName);
    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {
      return false;
    }
    if (element.namespaceURI === SVG_NAMESPACE) {
      // The only way to switch from HTML namespace to SVG
      // is via <svg>. If it happens via any other tag, then
      // it should be killed.
      if (parent.namespaceURI === HTML_NAMESPACE) {
        return tagName === 'svg';
      }
      // The only way to switch from MathML to SVG is via`
      // svg if parent is either <annotation-xml> or MathML
      // text integration points.
      if (parent.namespaceURI === MATHML_NAMESPACE) {
        return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);
      }
      // We only allow elements that are defined in SVG
      // spec. All others are disallowed in SVG namespace.
      return Boolean(ALL_SVG_TAGS[tagName]);
    }
    if (element.namespaceURI === MATHML_NAMESPACE) {
      // The only way to switch from HTML namespace to MathML
      // is via <math>. If it happens via any other tag, then
      // it should be killed.
      if (parent.namespaceURI === HTML_NAMESPACE) {
        return tagName === 'math';
      }
      // The only way to switch from SVG to MathML is via
      // <math> and HTML integration points
      if (parent.namespaceURI === SVG_NAMESPACE) {
        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];
      }
      // We only allow elements that are defined in MathML
      // spec. All others are disallowed in MathML namespace.
      return Boolean(ALL_MATHML_TAGS[tagName]);
    }
    if (element.namespaceURI === HTML_NAMESPACE) {
      // The only way to switch from SVG to HTML is via
      // HTML integration points, and from MathML to HTML
      // is via MathML text integration points
      if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {
        return false;
      }
      if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {
        return false;
      }
      // We disallow tags that are specific for MathML
      // or SVG and should never appear in HTML namespace
      return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);
    }
    // For XHTML and XML documents that support custom namespaces
    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {
      return true;
    }
    // The code should never reach this place (this means
    // that the element somehow got namespace that is not
    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).
    // Return false just in case.
    return false;
  };
  /**
   * _forceRemove
   *
   * @param node a DOM node
   */
  const _forceRemove = function _forceRemove(node) {
    arrayPush(DOMPurify.removed, {
      element: node
    });
    try {
      // eslint-disable-next-line unicorn/prefer-dom-node-remove
      getParentNode(node).removeChild(node);
    } catch (_) {
      remove(node);
    }
  };
  /**
   * _removeAttribute
   *
   * @param name an Attribute name
   * @param element a DOM node
   */
  const _removeAttribute = function _removeAttribute(name, element) {
    try {
      arrayPush(DOMPurify.removed, {
        attribute: element.getAttributeNode(name),
        from: element
      });
    } catch (_) {
      arrayPush(DOMPurify.removed, {
        attribute: null,
        from: element
      });
    }
    element.removeAttribute(name);
    // We void attribute values for unremovable "is" attributes
    if (name === 'is') {
      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {
        try {
          _forceRemove(element);
        } catch (_) {}
      } else {
        try {
          element.setAttribute(name, '');
        } catch (_) {}
      }
    }
  };
  /**
   * _initDocument
   *
   * @param dirty - a string of dirty markup
   * @return a DOM, filled with the dirty markup
   */
  const _initDocument = function _initDocument(dirty) {
    /* Create a HTML document */
    let doc = null;
    let leadingWhitespace = null;
    if (FORCE_BODY) {
      dirty = '<remove></remove>' + dirty;
    } else {
      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */
      const matches = stringMatch(dirty, /^[\r\n\t ]+/);
      leadingWhitespace = matches && matches[0];
    }
    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {
      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)
      dirty = '<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>' + dirty + '</body></html>';
    }
    const dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;
    /*
     * Use the DOMParser API by default, fallback later if needs be
     * DOMParser not work for svg when has multiple root element.
     */
    if (NAMESPACE === HTML_NAMESPACE) {
      try {
        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);
      } catch (_) {}
    }
    /* Use createHTMLDocument in case DOMParser is not available */
    if (!doc || !doc.documentElement) {
      doc = implementation.createDocument(NAMESPACE, 'template', null);
      try {
        doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;
      } catch (_) {
        // Syntax error if dirtyPayload is invalid xml
      }
    }
    const body = doc.body || doc.documentElement;
    if (dirty && leadingWhitespace) {
      body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);
    }
    /* Work on whole document or just its body */
    if (NAMESPACE === HTML_NAMESPACE) {
      return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];
    }
    return WHOLE_DOCUMENT ? doc.documentElement : body;
  };
  /**
   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.
   *
   * @param root The root element or node to start traversing on.
   * @return The created NodeIterator
   */
  const _createNodeIterator = function _createNodeIterator(root) {
    return createNodeIterator.call(root.ownerDocument || root, root,
    // eslint-disable-next-line no-bitwise
    NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT | NodeFilter.SHOW_PROCESSING_INSTRUCTION | NodeFilter.SHOW_CDATA_SECTION, null);
  };
  /**
   * _isClobbered
   *
   * @param element element to check for clobbering attacks
   * @return true if clobbered, false if safe
   */
  const _isClobbered = function _isClobbered(element) {
    return element instanceof HTMLFormElement && (typeof element.nodeName !== 'string' || typeof element.textContent !== 'string' || typeof element.removeChild !== 'function' || !(element.attributes instanceof NamedNodeMap) || typeof element.removeAttribute !== 'function' || typeof element.setAttribute !== 'function' || typeof element.namespaceURI !== 'string' || typeof element.insertBefore !== 'function' || typeof element.hasChildNodes !== 'function');
  };
  /**
   * Checks whether the given object is a DOM node.
   *
   * @param value object to check whether it's a DOM node
   * @return true is object is a DOM node
   */
  const _isNode = function _isNode(value) {
    return typeof Node === 'function' && value instanceof Node;
  };
  function _executeHooks(hooks, currentNode, data) {
    arrayForEach(hooks, hook => {
      hook.call(DOMPurify, currentNode, data, CONFIG);
    });
  }
  /**
   * _sanitizeElements
   *
   * @protect nodeName
   * @protect textContent
   * @protect removeChild
   * @param currentNode to check for permission to exist
   * @return true if node was killed, false if left alive
   */
  const _sanitizeElements = function _sanitizeElements(currentNode) {
    let content = null;
    /* Execute a hook if present */
    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);
    /* Check if element is clobbered or can clobber */
    if (_isClobbered(currentNode)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Now let's check the element's type and name */
    const tagName = transformCaseFunc(currentNode.nodeName);
    /* Execute a hook if present */
    _executeHooks(hooks.uponSanitizeElement, currentNode, {
      tagName,
      allowedTags: ALLOWED_TAGS
    });
    /* Detect mXSS attempts abusing namespace confusion */
    if (SAFE_FOR_XML && currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && regExpTest(/<[/\w!]/g, currentNode.innerHTML) && regExpTest(/<[/\w!]/g, currentNode.textContent)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Remove any occurrence of processing instructions */
    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {
      _forceRemove(currentNode);
      return true;
    }
    /* Remove any kind of possibly harmful comments */
    if (SAFE_FOR_XML && currentNode.nodeType === NODE_TYPE.comment && regExpTest(/<[/\w]/g, currentNode.data)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Remove element if anything forbids its presence */
    if (!(EXTRA_ELEMENT_HANDLING.tagCheck instanceof Function && EXTRA_ELEMENT_HANDLING.tagCheck(tagName)) && (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName])) {
      /* Check if we have a custom element to handle */
      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {
        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) {
          return false;
        }
        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) {
          return false;
        }
      }
      /* Keep content except for bad-listed elements */
      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {
        const parentNode = getParentNode(currentNode) || currentNode.parentNode;
        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;
        if (childNodes && parentNode) {
          const childCount = childNodes.length;
          for (let i = childCount - 1; i >= 0; --i) {
            const childClone = cloneNode(childNodes[i], true);
            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;
            parentNode.insertBefore(childClone, getNextSibling(currentNode));
          }
        }
      }
      _forceRemove(currentNode);
      return true;
    }
    /* Check whether element has a valid namespace */
    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Make sure that older browsers don't get fallback-tag mXSS */
    if ((tagName === 'noscript' || tagName === 'noembed' || tagName === 'noframes') && regExpTest(/<\/no(script|embed|frames)/i, currentNode.innerHTML)) {
      _forceRemove(currentNode);
      return true;
    }
    /* Sanitize element content to be template-safe */
    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {
      /* Get the element's text content */
      content = currentNode.textContent;
      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {
        content = stringReplace(content, expr, ' ');
      });
      if (currentNode.textContent !== content) {
        arrayPush(DOMPurify.removed, {
          element: currentNode.cloneNode()
        });
        currentNode.textContent = content;
      }
    }
    /* Execute a hook if present */
    _executeHooks(hooks.afterSanitizeElements, currentNode, null);
    return false;
  };
  /**
   * _isValidAttribute
   *
   * @param lcTag Lowercase tag name of containing element.
   * @param lcName Lowercase attribute name.
   * @param value Attribute value.
   * @return Returns true if `value` is valid, otherwise false.
   */
  // eslint-disable-next-line complexity
  const _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {
    /* Make sure attribute cannot clobber */
    if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {
      return false;
    }
    /* Allow valid data-* attributes: At least one character after "-"
        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)
        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)
        We don't need to check the value; it's always URI safe. */
    if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) ; else if (EXTRA_ELEMENT_HANDLING.attributeCheck instanceof Function && EXTRA_ELEMENT_HANDLING.attributeCheck(lcName, lcTag)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {
      if (
      // First condition does a very basic check if a) it's basically a valid custom element tagname AND
      // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck
      // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck
      _isBasicCustomElement(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName, lcTag)) ||
      // Alternative, second condition checks if it's an `is`-attribute, AND
      // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck
      lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {
        return false;
      }
      /* Check value is safe. First, is attr inert? If so, is safe */
    } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if (value) {
      return false;
    } else ;
    return true;
  };
  /**
   * _isBasicCustomElement
   * checks if at least one dash is included in tagName, and it's not the first char
   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name
   *
   * @param tagName name of the tag of the node to sanitize
   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.
   */
  const _isBasicCustomElement = function _isBasicCustomElement(tagName) {
    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);
  };
  /**
   * _sanitizeAttributes
   *
   * @protect attributes
   * @protect nodeName
   * @protect removeAttribute
   * @protect setAttribute
   *
   * @param currentNode to sanitize
   */
  const _sanitizeAttributes = function _sanitizeAttributes(currentNode) {
    /* Execute a hook if present */
    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);
    const {
      attributes
    } = currentNode;
    /* Check if we have attributes; if not we might have a text node */
    if (!attributes || _isClobbered(currentNode)) {
      return;
    }
    const hookEvent = {
      attrName: '',
      attrValue: '',
      keepAttr: true,
      allowedAttributes: ALLOWED_ATTR,
      forceKeepAttr: undefined
    };
    let l = attributes.length;
    /* Go backwards over all attributes; safely remove bad ones */
    while (l--) {
      const attr = attributes[l];
      const {
        name,
        namespaceURI,
        value: attrValue
      } = attr;
      const lcName = transformCaseFunc(name);
      const initValue = attrValue;
      let value = name === 'value' ? initValue : stringTrim(initValue);
      /* Execute a hook if present */
      hookEvent.attrName = lcName;
      hookEvent.attrValue = value;
      hookEvent.keepAttr = true;
      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set
      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);
      value = hookEvent.attrValue;
      /* Full DOM Clobbering protection via namespace isolation,
       * Prefix id and name attributes with `user-content-`
       */
      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {
        // Remove the attribute with this value
        _removeAttribute(name, currentNode);
        // Prefix the value and later re-create the attribute with the sanitized value
        value = SANITIZE_NAMED_PROPS_PREFIX + value;
      }
      /* Work around a security issue with comments inside attributes */
      if (SAFE_FOR_XML && regExpTest(/((--!?|])>)|<\/(style|title|textarea)/i, value)) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Make sure we cannot easily use animated hrefs, even if animations are allowed */
      if (lcName === 'attributename' && stringMatch(value, 'href')) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Did the hooks approve of the attribute? */
      if (hookEvent.forceKeepAttr) {
        continue;
      }
      /* Did the hooks approve of the attribute? */
      if (!hookEvent.keepAttr) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Work around a security issue in jQuery 3.0 */
      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\/>/i, value)) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Sanitize attribute content to be template-safe */
      if (SAFE_FOR_TEMPLATES) {
        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {
          value = stringReplace(value, expr, ' ');
        });
      }
      /* Is `value` valid for this attribute? */
      const lcTag = transformCaseFunc(currentNode.nodeName);
      if (!_isValidAttribute(lcTag, lcName, value)) {
        _removeAttribute(name, currentNode);
        continue;
      }
      /* Handle attributes that require Trusted Types */
      if (trustedTypesPolicy && typeof trustedTypes === 'object' && typeof trustedTypes.getAttributeType === 'function') {
        if (namespaceURI) ; else {
          switch (trustedTypes.getAttributeType(lcTag, lcName)) {
            case 'TrustedHTML':
              {
                value = trustedTypesPolicy.createHTML(value);
                break;
              }
            case 'TrustedScriptURL':
              {
                value = trustedTypesPolicy.createScriptURL(value);
                break;
              }
          }
        }
      }
      /* Handle invalid data-* attribute set by try-catching it */
      if (value !== initValue) {
        try {
          if (namespaceURI) {
            currentNode.setAttributeNS(namespaceURI, name, value);
          } else {
            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. "x-schema". */
            currentNode.setAttribute(name, value);
          }
          if (_isClobbered(currentNode)) {
            _forceRemove(currentNode);
          } else {
            arrayPop(DOMPurify.removed);
          }
        } catch (_) {
          _removeAttribute(name, currentNode);
        }
      }
    }
    /* Execute a hook if present */
    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);
  };
  /**
   * _sanitizeShadowDOM
   *
   * @param fragment to iterate over recursively
   */
  const _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {
    let shadowNode = null;
    const shadowIterator = _createNodeIterator(fragment);
    /* Execute a hook if present */
    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);
    while (shadowNode = shadowIterator.nextNode()) {
      /* Execute a hook if present */
      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);
      /* Sanitize tags and elements */
      _sanitizeElements(shadowNode);
      /* Check attributes next */
      _sanitizeAttributes(shadowNode);
      /* Deep shadow DOM detected */
      if (shadowNode.content instanceof DocumentFragment) {
        _sanitizeShadowDOM(shadowNode.content);
      }
    }
    /* Execute a hook if present */
    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);
  };
  // eslint-disable-next-line complexity
  DOMPurify.sanitize = function (dirty) {
    let cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    let body = null;
    let importedNode = null;
    let currentNode = null;
    let returnNode = null;
    /* Make sure we have a string to sanitize.
      DO NOT return early, as this will return the wrong type if
      the user has requested a DOM object rather than a string */
    IS_EMPTY_INPUT = !dirty;
    if (IS_EMPTY_INPUT) {
      dirty = '<!-->';
    }
    /* Stringify, in case dirty is an object */
    if (typeof dirty !== 'string' && !_isNode(dirty)) {
      if (typeof dirty.toString === 'function') {
        dirty = dirty.toString();
        if (typeof dirty !== 'string') {
          throw typeErrorCreate('dirty is not a string, aborting');
        }
      } else {
        throw typeErrorCreate('toString is not a function');
      }
    }
    /* Return dirty HTML if DOMPurify cannot run */
    if (!DOMPurify.isSupported) {
      return dirty;
    }
    /* Assign config vars */
    if (!SET_CONFIG) {
      _parseConfig(cfg);
    }
    /* Clean up removed elements */
    DOMPurify.removed = [];
    /* Check if dirty is correctly typed for IN_PLACE */
    if (typeof dirty === 'string') {
      IN_PLACE = false;
    }
    if (IN_PLACE) {
      /* Do some early pre-sanitization to avoid unsafe root nodes */
      if (dirty.nodeName) {
        const tagName = transformCaseFunc(dirty.nodeName);
        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {
          throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');
        }
      }
    } else if (dirty instanceof Node) {
      /* If dirty is a DOM element, append to an empty document to avoid
         elements being stripped by the parser */
      body = _initDocument('<!---->');
      importedNode = body.ownerDocument.importNode(dirty, true);
      if (importedNode.nodeType === NODE_TYPE.element && importedNode.nodeName === 'BODY') {
        /* Node is already a body, use as is */
        body = importedNode;
      } else if (importedNode.nodeName === 'HTML') {
        body = importedNode;
      } else {
        // eslint-disable-next-line unicorn/prefer-dom-node-append
        body.appendChild(importedNode);
      }
    } else {
      /* Exit directly if we have nothing to do */
      if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT &&
      // eslint-disable-next-line unicorn/prefer-includes
      dirty.indexOf('<') === -1) {
        return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;
      }
      /* Initialize the document to work on */
      body = _initDocument(dirty);
      /* Check we have a DOM node from the data */
      if (!body) {
        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';
      }
    }
    /* Remove first element node (ours) if FORCE_BODY is set */
    if (body && FORCE_BODY) {
      _forceRemove(body.firstChild);
    }
    /* Get node iterator */
    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);
    /* Now start iterating over the created document */
    while (currentNode = nodeIterator.nextNode()) {
      /* Sanitize tags and elements */
      _sanitizeElements(currentNode);
      /* Check attributes next */
      _sanitizeAttributes(currentNode);
      /* Shadow DOM detected, sanitize it */
      if (currentNode.content instanceof DocumentFragment) {
        _sanitizeShadowDOM(currentNode.content);
      }
    }
    /* If we sanitized `dirty` in-place, return it. */
    if (IN_PLACE) {
      return dirty;
    }
    /* Return sanitized string or DOM */
    if (RETURN_DOM) {
      if (RETURN_DOM_FRAGMENT) {
        returnNode = createDocumentFragment.call(body.ownerDocument);
        while (body.firstChild) {
          // eslint-disable-next-line unicorn/prefer-dom-node-append
          returnNode.appendChild(body.firstChild);
        }
      } else {
        returnNode = body;
      }
      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {
        /*
          AdoptNode() is not used because internal state is not reset
          (e.g. the past names map of a HTMLFormElement), this is safe
          in theory but we would rather not risk another attack vector.
          The state that is cloned by importNode() is explicitly defined
          by the specs.
        */
        returnNode = importNode.call(originalDocument, returnNode, true);
      }
      return returnNode;
    }
    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;
    /* Serialize doctype if allowed */
    if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {
      serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\n' + serializedHTML;
    }
    /* Sanitize final string template-safe */
    if (SAFE_FOR_TEMPLATES) {
      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {
        serializedHTML = stringReplace(serializedHTML, expr, ' ');
      });
    }
    return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;
  };
  DOMPurify.setConfig = function () {
    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    _parseConfig(cfg);
    SET_CONFIG = true;
  };
  DOMPurify.clearConfig = function () {
    CONFIG = null;
    SET_CONFIG = false;
  };
  DOMPurify.isValidAttribute = function (tag, attr, value) {
    /* Initialize shared config vars if necessary. */
    if (!CONFIG) {
      _parseConfig({});
    }
    const lcTag = transformCaseFunc(tag);
    const lcName = transformCaseFunc(attr);
    return _isValidAttribute(lcTag, lcName, value);
  };
  DOMPurify.addHook = function (entryPoint, hookFunction) {
    if (typeof hookFunction !== 'function') {
      return;
    }
    arrayPush(hooks[entryPoint], hookFunction);
  };
  DOMPurify.removeHook = function (entryPoint, hookFunction) {
    if (hookFunction !== undefined) {
      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);
      return index === -1 ? undefined : arraySplice(hooks[entryPoint], index, 1)[0];
    }
    return arrayPop(hooks[entryPoint]);
  };
  DOMPurify.removeHooks = function (entryPoint) {
    hooks[entryPoint] = [];
  };
  DOMPurify.removeAllHooks = function () {
    hooks = _createHooksMap();
  };
  return DOMPurify;
}
var purify = createDOMPurify();

const purify_es = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: purify
}, Symbol.toStringTag, { value: 'Module' }));

function sanitizeHTML(dirty) {
  const config = {
    ALLOWED_TAGS: [
      "b",
      "i",
      "strong",
      "em",
      "u",
      "br",
      "p",
      "ul",
      "ol",
      "li",
      "code",
      "pre",
      "a",
      "span",
      "h1",
      "h2",
      "h3",
      "h4",
      "h5",
      "h6",
      "blockquote",
      "hr"
    ],
    ALLOWED_ATTR: ["href", "title", "target", "rel"],
    FORBID_TAGS: ["style", "img", "svg", "math", "iframe", "script", "object", "embed"],
    FORBID_ATTR: ["style", "src", "srcset", "onerror", "onclick"],
    ALLOW_DATA_ATTR: false,
    ADD_ATTR: ["target", "rel"],
    RETURN_TRUSTED_TYPE: false
  };
  let clean = purify.sanitize(dirty, config);
  clean = clean.replace(
    /<a\s+([^>]*href=["'][^"']*["'][^>]*)>/gi,
    '<a $1 target="_blank" rel="noopener noreferrer nofollow">'
  );
  return clean;
}

const NorahChatLLM = ({ userId }) => {
  const { askNorah, isProcessing, isOffline} = useNorahLLM({
    userId,
    route: "/intelligence",
    locale: "it"
  });
  const [messages, setMessages] = reactExports.useState([
    {
      role: "assistant",
      content: "👋 Ciao! Sono NORAH, la tua assistente M1SSION™. Come posso aiutarti oggi?",
      timestamp: /* @__PURE__ */ new Date()
    }
  ]);
  const [input, setInput] = reactExports.useState("");
  const scrollRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
    }
  }, [messages]);
  const handleSend = async () => {
    if (!input.trim() || isProcessing) return;
    const userMessage = {
      role: "user",
      content: input.trim(),
      timestamp: /* @__PURE__ */ new Date()
    };
    setMessages((prev) => [...prev, userMessage]);
    setInput("");
    const response = await askNorah(input.trim());
    if (response) {
      setMessages((prev) => [...prev, {
        role: "assistant",
        content: response,
        timestamp: /* @__PURE__ */ new Date()
      }]);
    }
  };
  const handleKeyPress = (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };
  const modalContent = /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "norah-chat-modal-backdrop" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "norah-chat-modal", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "norah-chat-modal__header", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-6 h-6 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-bold text-white", children: "NORAH AI" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60", children: "Assistente M1SSION™" })
        ] }),
        isOffline && /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "destructive", className: "gap-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(WifiOff, { className: "w-3 h-3" }),
          "Offline"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "norah-chat-modal__body", ref: scrollRef, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3 md:space-y-4", children: [
        messages.map((message, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: `flex gap-3 ${message.role === "assistant" ? "justify-start" : "justify-end"}`,
            children: [
              message.role === "assistant" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-4 h-4 text-white" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "div",
                {
                  className: `max-w-[80%] p-3 rounded-xl ${message.role === "assistant" ? "bg-white/5 text-white" : "bg-gradient-to-r from-[#4361ee] to-[#7209b7] text-white"}`,
                  children: [
                    message.role === "assistant" ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: "text-sm prose prose-invert prose-sm max-w-none",
                        dangerouslySetInnerHTML: { __html: sanitizeHTML(message.content) }
                      }
                    ) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm whitespace-pre-wrap", children: message.content }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs opacity-50 mt-1 block", children: message.timestamp.toLocaleTimeString("it-IT", {
                      hour: "2-digit",
                      minute: "2-digit"
                    }) })
                  ]
                }
              ),
              message.role === "user" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-white/10 flex items-center justify-center flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-4 h-4 text-white" }) })
            ]
          },
          index
        )),
        isProcessing && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-3 justify-start", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-4 h-4 text-white animate-pulse" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-white/5 p-3 rounded-xl", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-white/50 rounded-full animate-bounce" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-white/50 rounded-full animate-bounce delay-100" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-white/50 rounded-full animate-bounce delay-200" })
          ] }) })
        ] })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "norah-chat-modal__footer", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              value: input,
              onChange: (e) => setInput(e.target.value),
              onKeyPress: handleKeyPress,
              placeholder: "Chiedi qualcosa a Norah...",
              disabled: isProcessing,
              className: "flex-1 bg-white/10 border-white/20 text-white placeholder:text-white/40"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleSend,
              disabled: !input.trim() || isProcessing,
              size: "icon",
              className: "bg-gradient-to-r from-[#4361ee] to-[#7209b7] hover:opacity-90",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4" })
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/40 mt-2", children: "💡 Chiedi informazioni su BUZZ, piani, Final Shot e molto altro!" })
      ] })
    ] })
  ] });
  return ReactDOM.createPortal(
    modalContent,
    document.body
  );
};

const isString$1 = obj => typeof obj === 'string';
const defer = () => {
  let res;
  let rej;
  const promise = new Promise((resolve, reject) => {
    res = resolve;
    rej = reject;
  });
  promise.resolve = res;
  promise.reject = rej;
  return promise;
};
const makeString = object => {
  if (object == null) return '';
  return '' + object;
};
const copy = (a, s, t) => {
  a.forEach(m => {
    if (s[m]) t[m] = s[m];
  });
};
const lastOfPathSeparatorRegExp = /###/g;
const cleanKey = key => key && key.indexOf('###') > -1 ? key.replace(lastOfPathSeparatorRegExp, '.') : key;
const canNotTraverseDeeper = object => !object || isString$1(object);
const getLastOfPath = (object, path, Empty) => {
  const stack = !isString$1(path) ? path : path.split('.');
  let stackIndex = 0;
  while (stackIndex < stack.length - 1) {
    if (canNotTraverseDeeper(object)) return {};
    const key = cleanKey(stack[stackIndex]);
    if (!object[key] && Empty) object[key] = new Empty();
    if (Object.prototype.hasOwnProperty.call(object, key)) {
      object = object[key];
    } else {
      object = {};
    }
    ++stackIndex;
  }
  if (canNotTraverseDeeper(object)) return {};
  return {
    obj: object,
    k: cleanKey(stack[stackIndex])
  };
};
const setPath = (object, path, newValue) => {
  const {
    obj,
    k
  } = getLastOfPath(object, path, Object);
  if (obj !== undefined || path.length === 1) {
    obj[k] = newValue;
    return;
  }
  let e = path[path.length - 1];
  let p = path.slice(0, path.length - 1);
  let last = getLastOfPath(object, p, Object);
  while (last.obj === undefined && p.length) {
    e = `${p[p.length - 1]}.${e}`;
    p = p.slice(0, p.length - 1);
    last = getLastOfPath(object, p, Object);
    if (last?.obj && typeof last.obj[`${last.k}.${e}`] !== 'undefined') {
      last.obj = undefined;
    }
  }
  last.obj[`${last.k}.${e}`] = newValue;
};
const pushPath = (object, path, newValue, concat) => {
  const {
    obj,
    k
  } = getLastOfPath(object, path, Object);
  obj[k] = obj[k] || [];
  obj[k].push(newValue);
};
const getPath = (object, path) => {
  const {
    obj,
    k
  } = getLastOfPath(object, path);
  if (!obj) return undefined;
  if (!Object.prototype.hasOwnProperty.call(obj, k)) return undefined;
  return obj[k];
};
const getPathWithDefaults = (data, defaultData, key) => {
  const value = getPath(data, key);
  if (value !== undefined) {
    return value;
  }
  return getPath(defaultData, key);
};
const deepExtend = (target, source, overwrite) => {
  for (const prop in source) {
    if (prop !== '__proto__' && prop !== 'constructor') {
      if (prop in target) {
        if (isString$1(target[prop]) || target[prop] instanceof String || isString$1(source[prop]) || source[prop] instanceof String) {
          if (overwrite) target[prop] = source[prop];
        } else {
          deepExtend(target[prop], source[prop], overwrite);
        }
      } else {
        target[prop] = source[prop];
      }
    }
  }
  return target;
};
const regexEscape = str => str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&');
var _entityMap = {
  '&': '&amp;',
  '<': '&lt;',
  '>': '&gt;',
  '"': '&quot;',
  "'": '&#39;',
  '/': '&#x2F;'
};
const escape = data => {
  if (isString$1(data)) {
    return data.replace(/[&<>"'\/]/g, s => _entityMap[s]);
  }
  return data;
};
class RegExpCache {
  constructor(capacity) {
    this.capacity = capacity;
    this.regExpMap = new Map();
    this.regExpQueue = [];
  }
  getRegExp(pattern) {
    const regExpFromCache = this.regExpMap.get(pattern);
    if (regExpFromCache !== undefined) {
      return regExpFromCache;
    }
    const regExpNew = new RegExp(pattern);
    if (this.regExpQueue.length === this.capacity) {
      this.regExpMap.delete(this.regExpQueue.shift());
    }
    this.regExpMap.set(pattern, regExpNew);
    this.regExpQueue.push(pattern);
    return regExpNew;
  }
}
const chars = [' ', ',', '?', '!', ';'];
const looksLikeObjectPathRegExpCache = new RegExpCache(20);
const looksLikeObjectPath = (key, nsSeparator, keySeparator) => {
  nsSeparator = nsSeparator || '';
  keySeparator = keySeparator || '';
  const possibleChars = chars.filter(c => nsSeparator.indexOf(c) < 0 && keySeparator.indexOf(c) < 0);
  if (possibleChars.length === 0) return true;
  const r = looksLikeObjectPathRegExpCache.getRegExp(`(${possibleChars.map(c => c === '?' ? '\\?' : c).join('|')})`);
  let matched = !r.test(key);
  if (!matched) {
    const ki = key.indexOf(keySeparator);
    if (ki > 0 && !r.test(key.substring(0, ki))) {
      matched = true;
    }
  }
  return matched;
};
const deepFind = (obj, path, keySeparator = '.') => {
  if (!obj) return undefined;
  if (obj[path]) {
    if (!Object.prototype.hasOwnProperty.call(obj, path)) return undefined;
    return obj[path];
  }
  const tokens = path.split(keySeparator);
  let current = obj;
  for (let i = 0; i < tokens.length;) {
    if (!current || typeof current !== 'object') {
      return undefined;
    }
    let next;
    let nextPath = '';
    for (let j = i; j < tokens.length; ++j) {
      if (j !== i) {
        nextPath += keySeparator;
      }
      nextPath += tokens[j];
      next = current[nextPath];
      if (next !== undefined) {
        if (['string', 'number', 'boolean'].indexOf(typeof next) > -1 && j < tokens.length - 1) {
          continue;
        }
        i += j - i + 1;
        break;
      }
    }
    current = next;
  }
  return current;
};
const getCleanedCode = code => code?.replace('_', '-');

const consoleLogger = {
  type: 'logger',
  log(args) {
    this.output('log', args);
  },
  warn(args) {
    this.output('warn', args);
  },
  error(args) {
    this.output('error', args);
  },
  output(type, args) {
    console?.[type]?.apply?.(console, args);
  }
};
class Logger {
  constructor(concreteLogger, options = {}) {
    this.init(concreteLogger, options);
  }
  init(concreteLogger, options = {}) {
    this.prefix = options.prefix || 'i18next:';
    this.logger = concreteLogger || consoleLogger;
    this.options = options;
    this.debug = options.debug;
  }
  log(...args) {
    return this.forward(args, 'log', '', true);
  }
  warn(...args) {
    return this.forward(args, 'warn', '', true);
  }
  error(...args) {
    return this.forward(args, 'error', '');
  }
  deprecate(...args) {
    return this.forward(args, 'warn', 'WARNING DEPRECATED: ', true);
  }
  forward(args, lvl, prefix, debugOnly) {
    if (debugOnly && !this.debug) return null;
    if (isString$1(args[0])) args[0] = `${prefix}${this.prefix} ${args[0]}`;
    return this.logger[lvl](args);
  }
  create(moduleName) {
    return new Logger(this.logger, {
      ...{
        prefix: `${this.prefix}:${moduleName}:`
      },
      ...this.options
    });
  }
  clone(options) {
    options = options || this.options;
    options.prefix = options.prefix || this.prefix;
    return new Logger(this.logger, options);
  }
}
var baseLogger = new Logger();

class EventEmitter {
  constructor() {
    this.observers = {};
  }
  on(events, listener) {
    events.split(' ').forEach(event => {
      if (!this.observers[event]) this.observers[event] = new Map();
      const numListeners = this.observers[event].get(listener) || 0;
      this.observers[event].set(listener, numListeners + 1);
    });
    return this;
  }
  off(event, listener) {
    if (!this.observers[event]) return;
    if (!listener) {
      delete this.observers[event];
      return;
    }
    this.observers[event].delete(listener);
  }
  emit(event, ...args) {
    if (this.observers[event]) {
      const cloned = Array.from(this.observers[event].entries());
      cloned.forEach(([observer, numTimesAdded]) => {
        for (let i = 0; i < numTimesAdded; i++) {
          observer(...args);
        }
      });
    }
    if (this.observers['*']) {
      const cloned = Array.from(this.observers['*'].entries());
      cloned.forEach(([observer, numTimesAdded]) => {
        for (let i = 0; i < numTimesAdded; i++) {
          observer.apply(observer, [event, ...args]);
        }
      });
    }
  }
}

class ResourceStore extends EventEmitter {
  constructor(data, options = {
    ns: ['translation'],
    defaultNS: 'translation'
  }) {
    super();
    this.data = data || {};
    this.options = options;
    if (this.options.keySeparator === undefined) {
      this.options.keySeparator = '.';
    }
    if (this.options.ignoreJSONStructure === undefined) {
      this.options.ignoreJSONStructure = true;
    }
  }
  addNamespaces(ns) {
    if (this.options.ns.indexOf(ns) < 0) {
      this.options.ns.push(ns);
    }
  }
  removeNamespaces(ns) {
    const index = this.options.ns.indexOf(ns);
    if (index > -1) {
      this.options.ns.splice(index, 1);
    }
  }
  getResource(lng, ns, key, options = {}) {
    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;
    const ignoreJSONStructure = options.ignoreJSONStructure !== undefined ? options.ignoreJSONStructure : this.options.ignoreJSONStructure;
    let path;
    if (lng.indexOf('.') > -1) {
      path = lng.split('.');
    } else {
      path = [lng, ns];
      if (key) {
        if (Array.isArray(key)) {
          path.push(...key);
        } else if (isString$1(key) && keySeparator) {
          path.push(...key.split(keySeparator));
        } else {
          path.push(key);
        }
      }
    }
    const result = getPath(this.data, path);
    if (!result && !ns && !key && lng.indexOf('.') > -1) {
      lng = path[0];
      ns = path[1];
      key = path.slice(2).join('.');
    }
    if (result || !ignoreJSONStructure || !isString$1(key)) return result;
    return deepFind(this.data?.[lng]?.[ns], key, keySeparator);
  }
  addResource(lng, ns, key, value, options = {
    silent: false
  }) {
    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;
    let path = [lng, ns];
    if (key) path = path.concat(keySeparator ? key.split(keySeparator) : key);
    if (lng.indexOf('.') > -1) {
      path = lng.split('.');
      value = ns;
      ns = path[1];
    }
    this.addNamespaces(ns);
    setPath(this.data, path, value);
    if (!options.silent) this.emit('added', lng, ns, key, value);
  }
  addResources(lng, ns, resources, options = {
    silent: false
  }) {
    for (const m in resources) {
      if (isString$1(resources[m]) || Array.isArray(resources[m])) this.addResource(lng, ns, m, resources[m], {
        silent: true
      });
    }
    if (!options.silent) this.emit('added', lng, ns, resources);
  }
  addResourceBundle(lng, ns, resources, deep, overwrite, options = {
    silent: false,
    skipCopy: false
  }) {
    let path = [lng, ns];
    if (lng.indexOf('.') > -1) {
      path = lng.split('.');
      deep = resources;
      resources = ns;
      ns = path[1];
    }
    this.addNamespaces(ns);
    let pack = getPath(this.data, path) || {};
    if (!options.skipCopy) resources = JSON.parse(JSON.stringify(resources));
    if (deep) {
      deepExtend(pack, resources, overwrite);
    } else {
      pack = {
        ...pack,
        ...resources
      };
    }
    setPath(this.data, path, pack);
    if (!options.silent) this.emit('added', lng, ns, resources);
  }
  removeResourceBundle(lng, ns) {
    if (this.hasResourceBundle(lng, ns)) {
      delete this.data[lng][ns];
    }
    this.removeNamespaces(ns);
    this.emit('removed', lng, ns);
  }
  hasResourceBundle(lng, ns) {
    return this.getResource(lng, ns) !== undefined;
  }
  getResourceBundle(lng, ns) {
    if (!ns) ns = this.options.defaultNS;
    return this.getResource(lng, ns);
  }
  getDataByLanguage(lng) {
    return this.data[lng];
  }
  hasLanguageSomeTranslations(lng) {
    const data = this.getDataByLanguage(lng);
    const n = data && Object.keys(data) || [];
    return !!n.find(v => data[v] && Object.keys(data[v]).length > 0);
  }
  toJSON() {
    return this.data;
  }
}

var postProcessor = {
  processors: {},
  addPostProcessor(module) {
    this.processors[module.name] = module;
  },
  handle(processors, value, key, options, translator) {
    processors.forEach(processor => {
      value = this.processors[processor]?.process(value, key, options, translator) ?? value;
    });
    return value;
  }
};

const PATH_KEY = Symbol('i18next/PATH_KEY');
function createProxy() {
  const state = [];
  const handler = Object.create(null);
  let proxy;
  handler.get = (target, key) => {
    proxy?.revoke?.();
    if (key === PATH_KEY) return state;
    state.push(key);
    proxy = Proxy.revocable(target, handler);
    return proxy.proxy;
  };
  return Proxy.revocable(Object.create(null), handler).proxy;
}
function keysFromSelector(selector, opts) {
  const {
    [PATH_KEY]: path
  } = selector(createProxy());
  return path.join(opts?.keySeparator ?? '.');
}

const checkedLoadedFor = {};
const shouldHandleAsObject = res => !isString$1(res) && typeof res !== 'boolean' && typeof res !== 'number';
class Translator extends EventEmitter {
  constructor(services, options = {}) {
    super();
    copy(['resourceStore', 'languageUtils', 'pluralResolver', 'interpolator', 'backendConnector', 'i18nFormat', 'utils'], services, this);
    this.options = options;
    if (this.options.keySeparator === undefined) {
      this.options.keySeparator = '.';
    }
    this.logger = baseLogger.create('translator');
  }
  changeLanguage(lng) {
    if (lng) this.language = lng;
  }
  exists(key, o = {
    interpolation: {}
  }) {
    const opt = {
      ...o
    };
    if (key == null) return false;
    const resolved = this.resolve(key, opt);
    if (resolved?.res === undefined) return false;
    const isObject = shouldHandleAsObject(resolved.res);
    if (opt.returnObjects === false && isObject) {
      return false;
    }
    return true;
  }
  extractFromKey(key, opt) {
    let nsSeparator = opt.nsSeparator !== undefined ? opt.nsSeparator : this.options.nsSeparator;
    if (nsSeparator === undefined) nsSeparator = ':';
    const keySeparator = opt.keySeparator !== undefined ? opt.keySeparator : this.options.keySeparator;
    let namespaces = opt.ns || this.options.defaultNS || [];
    const wouldCheckForNsInKey = nsSeparator && key.indexOf(nsSeparator) > -1;
    const seemsNaturalLanguage = !this.options.userDefinedKeySeparator && !opt.keySeparator && !this.options.userDefinedNsSeparator && !opt.nsSeparator && !looksLikeObjectPath(key, nsSeparator, keySeparator);
    if (wouldCheckForNsInKey && !seemsNaturalLanguage) {
      const m = key.match(this.interpolator.nestingRegexp);
      if (m && m.length > 0) {
        return {
          key,
          namespaces: isString$1(namespaces) ? [namespaces] : namespaces
        };
      }
      const parts = key.split(nsSeparator);
      if (nsSeparator !== keySeparator || nsSeparator === keySeparator && this.options.ns.indexOf(parts[0]) > -1) namespaces = parts.shift();
      key = parts.join(keySeparator);
    }
    return {
      key,
      namespaces: isString$1(namespaces) ? [namespaces] : namespaces
    };
  }
  translate(keys, o, lastKey) {
    let opt = typeof o === 'object' ? {
      ...o
    } : o;
    if (typeof opt !== 'object' && this.options.overloadTranslationOptionHandler) {
      opt = this.options.overloadTranslationOptionHandler(arguments);
    }
    if (typeof opt === 'object') opt = {
      ...opt
    };
    if (!opt) opt = {};
    if (keys == null) return '';
    if (typeof keys === 'function') keys = keysFromSelector(keys, {
      ...this.options,
      ...opt
    });
    if (!Array.isArray(keys)) keys = [String(keys)];
    const returnDetails = opt.returnDetails !== undefined ? opt.returnDetails : this.options.returnDetails;
    const keySeparator = opt.keySeparator !== undefined ? opt.keySeparator : this.options.keySeparator;
    const {
      key,
      namespaces
    } = this.extractFromKey(keys[keys.length - 1], opt);
    const namespace = namespaces[namespaces.length - 1];
    let nsSeparator = opt.nsSeparator !== undefined ? opt.nsSeparator : this.options.nsSeparator;
    if (nsSeparator === undefined) nsSeparator = ':';
    const lng = opt.lng || this.language;
    const appendNamespaceToCIMode = opt.appendNamespaceToCIMode || this.options.appendNamespaceToCIMode;
    if (lng?.toLowerCase() === 'cimode') {
      if (appendNamespaceToCIMode) {
        if (returnDetails) {
          return {
            res: `${namespace}${nsSeparator}${key}`,
            usedKey: key,
            exactUsedKey: key,
            usedLng: lng,
            usedNS: namespace,
            usedParams: this.getUsedParamsDetails(opt)
          };
        }
        return `${namespace}${nsSeparator}${key}`;
      }
      if (returnDetails) {
        return {
          res: key,
          usedKey: key,
          exactUsedKey: key,
          usedLng: lng,
          usedNS: namespace,
          usedParams: this.getUsedParamsDetails(opt)
        };
      }
      return key;
    }
    const resolved = this.resolve(keys, opt);
    let res = resolved?.res;
    const resUsedKey = resolved?.usedKey || key;
    const resExactUsedKey = resolved?.exactUsedKey || key;
    const noObject = ['[object Number]', '[object Function]', '[object RegExp]'];
    const joinArrays = opt.joinArrays !== undefined ? opt.joinArrays : this.options.joinArrays;
    const handleAsObjectInI18nFormat = !this.i18nFormat || this.i18nFormat.handleAsObject;
    const needsPluralHandling = opt.count !== undefined && !isString$1(opt.count);
    const hasDefaultValue = Translator.hasDefaultValue(opt);
    const defaultValueSuffix = needsPluralHandling ? this.pluralResolver.getSuffix(lng, opt.count, opt) : '';
    const defaultValueSuffixOrdinalFallback = opt.ordinal && needsPluralHandling ? this.pluralResolver.getSuffix(lng, opt.count, {
      ordinal: false
    }) : '';
    const needsZeroSuffixLookup = needsPluralHandling && !opt.ordinal && opt.count === 0;
    const defaultValue = needsZeroSuffixLookup && opt[`defaultValue${this.options.pluralSeparator}zero`] || opt[`defaultValue${defaultValueSuffix}`] || opt[`defaultValue${defaultValueSuffixOrdinalFallback}`] || opt.defaultValue;
    let resForObjHndl = res;
    if (handleAsObjectInI18nFormat && !res && hasDefaultValue) {
      resForObjHndl = defaultValue;
    }
    const handleAsObject = shouldHandleAsObject(resForObjHndl);
    const resType = Object.prototype.toString.apply(resForObjHndl);
    if (handleAsObjectInI18nFormat && resForObjHndl && handleAsObject && noObject.indexOf(resType) < 0 && !(isString$1(joinArrays) && Array.isArray(resForObjHndl))) {
      if (!opt.returnObjects && !this.options.returnObjects) {
        if (!this.options.returnedObjectHandler) {
          this.logger.warn('accessing an object - but returnObjects options is not enabled!');
        }
        const r = this.options.returnedObjectHandler ? this.options.returnedObjectHandler(resUsedKey, resForObjHndl, {
          ...opt,
          ns: namespaces
        }) : `key '${key} (${this.language})' returned an object instead of string.`;
        if (returnDetails) {
          resolved.res = r;
          resolved.usedParams = this.getUsedParamsDetails(opt);
          return resolved;
        }
        return r;
      }
      if (keySeparator) {
        const resTypeIsArray = Array.isArray(resForObjHndl);
        const copy = resTypeIsArray ? [] : {};
        const newKeyToUse = resTypeIsArray ? resExactUsedKey : resUsedKey;
        for (const m in resForObjHndl) {
          if (Object.prototype.hasOwnProperty.call(resForObjHndl, m)) {
            const deepKey = `${newKeyToUse}${keySeparator}${m}`;
            if (hasDefaultValue && !res) {
              copy[m] = this.translate(deepKey, {
                ...opt,
                defaultValue: shouldHandleAsObject(defaultValue) ? defaultValue[m] : undefined,
                ...{
                  joinArrays: false,
                  ns: namespaces
                }
              });
            } else {
              copy[m] = this.translate(deepKey, {
                ...opt,
                ...{
                  joinArrays: false,
                  ns: namespaces
                }
              });
            }
            if (copy[m] === deepKey) copy[m] = resForObjHndl[m];
          }
        }
        res = copy;
      }
    } else if (handleAsObjectInI18nFormat && isString$1(joinArrays) && Array.isArray(res)) {
      res = res.join(joinArrays);
      if (res) res = this.extendTranslation(res, keys, opt, lastKey);
    } else {
      let usedDefault = false;
      let usedKey = false;
      if (!this.isValidLookup(res) && hasDefaultValue) {
        usedDefault = true;
        res = defaultValue;
      }
      if (!this.isValidLookup(res)) {
        usedKey = true;
        res = key;
      }
      const missingKeyNoValueFallbackToKey = opt.missingKeyNoValueFallbackToKey || this.options.missingKeyNoValueFallbackToKey;
      const resForMissing = missingKeyNoValueFallbackToKey && usedKey ? undefined : res;
      const updateMissing = hasDefaultValue && defaultValue !== res && this.options.updateMissing;
      if (usedKey || usedDefault || updateMissing) {
        this.logger.log(updateMissing ? 'updateKey' : 'missingKey', lng, namespace, key, updateMissing ? defaultValue : res);
        if (keySeparator) {
          const fk = this.resolve(key, {
            ...opt,
            keySeparator: false
          });
          if (fk && fk.res) this.logger.warn('Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.');
        }
        let lngs = [];
        const fallbackLngs = this.languageUtils.getFallbackCodes(this.options.fallbackLng, opt.lng || this.language);
        if (this.options.saveMissingTo === 'fallback' && fallbackLngs && fallbackLngs[0]) {
          for (let i = 0; i < fallbackLngs.length; i++) {
            lngs.push(fallbackLngs[i]);
          }
        } else if (this.options.saveMissingTo === 'all') {
          lngs = this.languageUtils.toResolveHierarchy(opt.lng || this.language);
        } else {
          lngs.push(opt.lng || this.language);
        }
        const send = (l, k, specificDefaultValue) => {
          const defaultForMissing = hasDefaultValue && specificDefaultValue !== res ? specificDefaultValue : resForMissing;
          if (this.options.missingKeyHandler) {
            this.options.missingKeyHandler(l, namespace, k, defaultForMissing, updateMissing, opt);
          } else if (this.backendConnector?.saveMissing) {
            this.backendConnector.saveMissing(l, namespace, k, defaultForMissing, updateMissing, opt);
          }
          this.emit('missingKey', l, namespace, k, res);
        };
        if (this.options.saveMissing) {
          if (this.options.saveMissingPlurals && needsPluralHandling) {
            lngs.forEach(language => {
              const suffixes = this.pluralResolver.getSuffixes(language, opt);
              if (needsZeroSuffixLookup && opt[`defaultValue${this.options.pluralSeparator}zero`] && suffixes.indexOf(`${this.options.pluralSeparator}zero`) < 0) {
                suffixes.push(`${this.options.pluralSeparator}zero`);
              }
              suffixes.forEach(suffix => {
                send([language], key + suffix, opt[`defaultValue${suffix}`] || defaultValue);
              });
            });
          } else {
            send(lngs, key, defaultValue);
          }
        }
      }
      res = this.extendTranslation(res, keys, opt, resolved, lastKey);
      if (usedKey && res === key && this.options.appendNamespaceToMissingKey) {
        res = `${namespace}${nsSeparator}${key}`;
      }
      if ((usedKey || usedDefault) && this.options.parseMissingKeyHandler) {
        res = this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey ? `${namespace}${nsSeparator}${key}` : key, usedDefault ? res : undefined, opt);
      }
    }
    if (returnDetails) {
      resolved.res = res;
      resolved.usedParams = this.getUsedParamsDetails(opt);
      return resolved;
    }
    return res;
  }
  extendTranslation(res, key, opt, resolved, lastKey) {
    if (this.i18nFormat?.parse) {
      res = this.i18nFormat.parse(res, {
        ...this.options.interpolation.defaultVariables,
        ...opt
      }, opt.lng || this.language || resolved.usedLng, resolved.usedNS, resolved.usedKey, {
        resolved
      });
    } else if (!opt.skipInterpolation) {
      if (opt.interpolation) this.interpolator.init({
        ...opt,
        ...{
          interpolation: {
            ...this.options.interpolation,
            ...opt.interpolation
          }
        }
      });
      const skipOnVariables = isString$1(res) && (opt?.interpolation?.skipOnVariables !== undefined ? opt.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables);
      let nestBef;
      if (skipOnVariables) {
        const nb = res.match(this.interpolator.nestingRegexp);
        nestBef = nb && nb.length;
      }
      let data = opt.replace && !isString$1(opt.replace) ? opt.replace : opt;
      if (this.options.interpolation.defaultVariables) data = {
        ...this.options.interpolation.defaultVariables,
        ...data
      };
      res = this.interpolator.interpolate(res, data, opt.lng || this.language || resolved.usedLng, opt);
      if (skipOnVariables) {
        const na = res.match(this.interpolator.nestingRegexp);
        const nestAft = na && na.length;
        if (nestBef < nestAft) opt.nest = false;
      }
      if (!opt.lng && resolved && resolved.res) opt.lng = this.language || resolved.usedLng;
      if (opt.nest !== false) res = this.interpolator.nest(res, (...args) => {
        if (lastKey?.[0] === args[0] && !opt.context) {
          this.logger.warn(`It seems you are nesting recursively key: ${args[0]} in key: ${key[0]}`);
          return null;
        }
        return this.translate(...args, key);
      }, opt);
      if (opt.interpolation) this.interpolator.reset();
    }
    const postProcess = opt.postProcess || this.options.postProcess;
    const postProcessorNames = isString$1(postProcess) ? [postProcess] : postProcess;
    if (res != null && postProcessorNames?.length && opt.applyPostProcessor !== false) {
      res = postProcessor.handle(postProcessorNames, res, key, this.options && this.options.postProcessPassResolved ? {
        i18nResolved: {
          ...resolved,
          usedParams: this.getUsedParamsDetails(opt)
        },
        ...opt
      } : opt, this);
    }
    return res;
  }
  resolve(keys, opt = {}) {
    let found;
    let usedKey;
    let exactUsedKey;
    let usedLng;
    let usedNS;
    if (isString$1(keys)) keys = [keys];
    keys.forEach(k => {
      if (this.isValidLookup(found)) return;
      const extracted = this.extractFromKey(k, opt);
      const key = extracted.key;
      usedKey = key;
      let namespaces = extracted.namespaces;
      if (this.options.fallbackNS) namespaces = namespaces.concat(this.options.fallbackNS);
      const needsPluralHandling = opt.count !== undefined && !isString$1(opt.count);
      const needsZeroSuffixLookup = needsPluralHandling && !opt.ordinal && opt.count === 0;
      const needsContextHandling = opt.context !== undefined && (isString$1(opt.context) || typeof opt.context === 'number') && opt.context !== '';
      const codes = opt.lngs ? opt.lngs : this.languageUtils.toResolveHierarchy(opt.lng || this.language, opt.fallbackLng);
      namespaces.forEach(ns => {
        if (this.isValidLookup(found)) return;
        usedNS = ns;
        if (!checkedLoadedFor[`${codes[0]}-${ns}`] && this.utils?.hasLoadedNamespace && !this.utils?.hasLoadedNamespace(usedNS)) {
          checkedLoadedFor[`${codes[0]}-${ns}`] = true;
          this.logger.warn(`key "${usedKey}" for languages "${codes.join(', ')}" won't get resolved as namespace "${usedNS}" was not yet loaded`, 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');
        }
        codes.forEach(code => {
          if (this.isValidLookup(found)) return;
          usedLng = code;
          const finalKeys = [key];
          if (this.i18nFormat?.addLookupKeys) {
            this.i18nFormat.addLookupKeys(finalKeys, key, code, ns, opt);
          } else {
            let pluralSuffix;
            if (needsPluralHandling) pluralSuffix = this.pluralResolver.getSuffix(code, opt.count, opt);
            const zeroSuffix = `${this.options.pluralSeparator}zero`;
            const ordinalPrefix = `${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;
            if (needsPluralHandling) {
              if (opt.ordinal && pluralSuffix.indexOf(ordinalPrefix) === 0) {
                finalKeys.push(key + pluralSuffix.replace(ordinalPrefix, this.options.pluralSeparator));
              }
              finalKeys.push(key + pluralSuffix);
              if (needsZeroSuffixLookup) {
                finalKeys.push(key + zeroSuffix);
              }
            }
            if (needsContextHandling) {
              const contextKey = `${key}${this.options.contextSeparator || '_'}${opt.context}`;
              finalKeys.push(contextKey);
              if (needsPluralHandling) {
                if (opt.ordinal && pluralSuffix.indexOf(ordinalPrefix) === 0) {
                  finalKeys.push(contextKey + pluralSuffix.replace(ordinalPrefix, this.options.pluralSeparator));
                }
                finalKeys.push(contextKey + pluralSuffix);
                if (needsZeroSuffixLookup) {
                  finalKeys.push(contextKey + zeroSuffix);
                }
              }
            }
          }
          let possibleKey;
          while (possibleKey = finalKeys.pop()) {
            if (!this.isValidLookup(found)) {
              exactUsedKey = possibleKey;
              found = this.getResource(code, ns, possibleKey, opt);
            }
          }
        });
      });
    });
    return {
      res: found,
      usedKey,
      exactUsedKey,
      usedLng,
      usedNS
    };
  }
  isValidLookup(res) {
    return res !== undefined && !(!this.options.returnNull && res === null) && !(!this.options.returnEmptyString && res === '');
  }
  getResource(code, ns, key, options = {}) {
    if (this.i18nFormat?.getResource) return this.i18nFormat.getResource(code, ns, key, options);
    return this.resourceStore.getResource(code, ns, key, options);
  }
  getUsedParamsDetails(options = {}) {
    const optionsKeys = ['defaultValue', 'ordinal', 'context', 'replace', 'lng', 'lngs', 'fallbackLng', 'ns', 'keySeparator', 'nsSeparator', 'returnObjects', 'returnDetails', 'joinArrays', 'postProcess', 'interpolation'];
    const useOptionsReplaceForData = options.replace && !isString$1(options.replace);
    let data = useOptionsReplaceForData ? options.replace : options;
    if (useOptionsReplaceForData && typeof options.count !== 'undefined') {
      data.count = options.count;
    }
    if (this.options.interpolation.defaultVariables) {
      data = {
        ...this.options.interpolation.defaultVariables,
        ...data
      };
    }
    if (!useOptionsReplaceForData) {
      data = {
        ...data
      };
      for (const key of optionsKeys) {
        delete data[key];
      }
    }
    return data;
  }
  static hasDefaultValue(options) {
    const prefix = 'defaultValue';
    for (const option in options) {
      if (Object.prototype.hasOwnProperty.call(options, option) && prefix === option.substring(0, prefix.length) && undefined !== options[option]) {
        return true;
      }
    }
    return false;
  }
}

class LanguageUtil {
  constructor(options) {
    this.options = options;
    this.supportedLngs = this.options.supportedLngs || false;
    this.logger = baseLogger.create('languageUtils');
  }
  getScriptPartFromCode(code) {
    code = getCleanedCode(code);
    if (!code || code.indexOf('-') < 0) return null;
    const p = code.split('-');
    if (p.length === 2) return null;
    p.pop();
    if (p[p.length - 1].toLowerCase() === 'x') return null;
    return this.formatLanguageCode(p.join('-'));
  }
  getLanguagePartFromCode(code) {
    code = getCleanedCode(code);
    if (!code || code.indexOf('-') < 0) return code;
    const p = code.split('-');
    return this.formatLanguageCode(p[0]);
  }
  formatLanguageCode(code) {
    if (isString$1(code) && code.indexOf('-') > -1) {
      let formattedCode;
      try {
        formattedCode = Intl.getCanonicalLocales(code)[0];
      } catch (e) {}
      if (formattedCode && this.options.lowerCaseLng) {
        formattedCode = formattedCode.toLowerCase();
      }
      if (formattedCode) return formattedCode;
      if (this.options.lowerCaseLng) {
        return code.toLowerCase();
      }
      return code;
    }
    return this.options.cleanCode || this.options.lowerCaseLng ? code.toLowerCase() : code;
  }
  isSupportedCode(code) {
    if (this.options.load === 'languageOnly' || this.options.nonExplicitSupportedLngs) {
      code = this.getLanguagePartFromCode(code);
    }
    return !this.supportedLngs || !this.supportedLngs.length || this.supportedLngs.indexOf(code) > -1;
  }
  getBestMatchFromCodes(codes) {
    if (!codes) return null;
    let found;
    codes.forEach(code => {
      if (found) return;
      const cleanedLng = this.formatLanguageCode(code);
      if (!this.options.supportedLngs || this.isSupportedCode(cleanedLng)) found = cleanedLng;
    });
    if (!found && this.options.supportedLngs) {
      codes.forEach(code => {
        if (found) return;
        const lngScOnly = this.getScriptPartFromCode(code);
        if (this.isSupportedCode(lngScOnly)) return found = lngScOnly;
        const lngOnly = this.getLanguagePartFromCode(code);
        if (this.isSupportedCode(lngOnly)) return found = lngOnly;
        found = this.options.supportedLngs.find(supportedLng => {
          if (supportedLng === lngOnly) return supportedLng;
          if (supportedLng.indexOf('-') < 0 && lngOnly.indexOf('-') < 0) return;
          if (supportedLng.indexOf('-') > 0 && lngOnly.indexOf('-') < 0 && supportedLng.substring(0, supportedLng.indexOf('-')) === lngOnly) return supportedLng;
          if (supportedLng.indexOf(lngOnly) === 0 && lngOnly.length > 1) return supportedLng;
        });
      });
    }
    if (!found) found = this.getFallbackCodes(this.options.fallbackLng)[0];
    return found;
  }
  getFallbackCodes(fallbacks, code) {
    if (!fallbacks) return [];
    if (typeof fallbacks === 'function') fallbacks = fallbacks(code);
    if (isString$1(fallbacks)) fallbacks = [fallbacks];
    if (Array.isArray(fallbacks)) return fallbacks;
    if (!code) return fallbacks.default || [];
    let found = fallbacks[code];
    if (!found) found = fallbacks[this.getScriptPartFromCode(code)];
    if (!found) found = fallbacks[this.formatLanguageCode(code)];
    if (!found) found = fallbacks[this.getLanguagePartFromCode(code)];
    if (!found) found = fallbacks.default;
    return found || [];
  }
  toResolveHierarchy(code, fallbackCode) {
    const fallbackCodes = this.getFallbackCodes((fallbackCode === false ? [] : fallbackCode) || this.options.fallbackLng || [], code);
    const codes = [];
    const addCode = c => {
      if (!c) return;
      if (this.isSupportedCode(c)) {
        codes.push(c);
      } else {
        this.logger.warn(`rejecting language code not found in supportedLngs: ${c}`);
      }
    };
    if (isString$1(code) && (code.indexOf('-') > -1 || code.indexOf('_') > -1)) {
      if (this.options.load !== 'languageOnly') addCode(this.formatLanguageCode(code));
      if (this.options.load !== 'languageOnly' && this.options.load !== 'currentOnly') addCode(this.getScriptPartFromCode(code));
      if (this.options.load !== 'currentOnly') addCode(this.getLanguagePartFromCode(code));
    } else if (isString$1(code)) {
      addCode(this.formatLanguageCode(code));
    }
    fallbackCodes.forEach(fc => {
      if (codes.indexOf(fc) < 0) addCode(this.formatLanguageCode(fc));
    });
    return codes;
  }
}

const suffixesOrder = {
  zero: 0,
  one: 1,
  two: 2,
  few: 3,
  many: 4,
  other: 5
};
const dummyRule = {
  select: count => count === 1 ? 'one' : 'other',
  resolvedOptions: () => ({
    pluralCategories: ['one', 'other']
  })
};
class PluralResolver {
  constructor(languageUtils, options = {}) {
    this.languageUtils = languageUtils;
    this.options = options;
    this.logger = baseLogger.create('pluralResolver');
    this.pluralRulesCache = {};
  }
  addRule(lng, obj) {
    this.rules[lng] = obj;
  }
  clearCache() {
    this.pluralRulesCache = {};
  }
  getRule(code, options = {}) {
    const cleanedCode = getCleanedCode(code === 'dev' ? 'en' : code);
    const type = options.ordinal ? 'ordinal' : 'cardinal';
    const cacheKey = JSON.stringify({
      cleanedCode,
      type
    });
    if (cacheKey in this.pluralRulesCache) {
      return this.pluralRulesCache[cacheKey];
    }
    let rule;
    try {
      rule = new Intl.PluralRules(cleanedCode, {
        type
      });
    } catch (err) {
      if (!Intl) {
        this.logger.error('No Intl support, please use an Intl polyfill!');
        return dummyRule;
      }
      if (!code.match(/-|_/)) return dummyRule;
      const lngPart = this.languageUtils.getLanguagePartFromCode(code);
      rule = this.getRule(lngPart, options);
    }
    this.pluralRulesCache[cacheKey] = rule;
    return rule;
  }
  needsPlural(code, options = {}) {
    let rule = this.getRule(code, options);
    if (!rule) rule = this.getRule('dev', options);
    return rule?.resolvedOptions().pluralCategories.length > 1;
  }
  getPluralFormsOfKey(code, key, options = {}) {
    return this.getSuffixes(code, options).map(suffix => `${key}${suffix}`);
  }
  getSuffixes(code, options = {}) {
    let rule = this.getRule(code, options);
    if (!rule) rule = this.getRule('dev', options);
    if (!rule) return [];
    return rule.resolvedOptions().pluralCategories.sort((pluralCategory1, pluralCategory2) => suffixesOrder[pluralCategory1] - suffixesOrder[pluralCategory2]).map(pluralCategory => `${this.options.prepend}${options.ordinal ? `ordinal${this.options.prepend}` : ''}${pluralCategory}`);
  }
  getSuffix(code, count, options = {}) {
    const rule = this.getRule(code, options);
    if (rule) {
      return `${this.options.prepend}${options.ordinal ? `ordinal${this.options.prepend}` : ''}${rule.select(count)}`;
    }
    this.logger.warn(`no plural rule found for: ${code}`);
    return this.getSuffix('dev', count, options);
  }
}

const deepFindWithDefaults = (data, defaultData, key, keySeparator = '.', ignoreJSONStructure = true) => {
  let path = getPathWithDefaults(data, defaultData, key);
  if (!path && ignoreJSONStructure && isString$1(key)) {
    path = deepFind(data, key, keySeparator);
    if (path === undefined) path = deepFind(defaultData, key, keySeparator);
  }
  return path;
};
const regexSafe = val => val.replace(/\$/g, '$$$$');
class Interpolator {
  constructor(options = {}) {
    this.logger = baseLogger.create('interpolator');
    this.options = options;
    this.format = options?.interpolation?.format || (value => value);
    this.init(options);
  }
  init(options = {}) {
    if (!options.interpolation) options.interpolation = {
      escapeValue: true
    };
    const {
      escape: escape$1,
      escapeValue,
      useRawValueToEscape,
      prefix,
      prefixEscaped,
      suffix,
      suffixEscaped,
      formatSeparator,
      unescapeSuffix,
      unescapePrefix,
      nestingPrefix,
      nestingPrefixEscaped,
      nestingSuffix,
      nestingSuffixEscaped,
      nestingOptionsSeparator,
      maxReplaces,
      alwaysFormat
    } = options.interpolation;
    this.escape = escape$1 !== undefined ? escape$1 : escape;
    this.escapeValue = escapeValue !== undefined ? escapeValue : true;
    this.useRawValueToEscape = useRawValueToEscape !== undefined ? useRawValueToEscape : false;
    this.prefix = prefix ? regexEscape(prefix) : prefixEscaped || '{{';
    this.suffix = suffix ? regexEscape(suffix) : suffixEscaped || '}}';
    this.formatSeparator = formatSeparator || ',';
    this.unescapePrefix = unescapeSuffix ? '' : unescapePrefix || '-';
    this.unescapeSuffix = this.unescapePrefix ? '' : unescapeSuffix || '';
    this.nestingPrefix = nestingPrefix ? regexEscape(nestingPrefix) : nestingPrefixEscaped || regexEscape('$t(');
    this.nestingSuffix = nestingSuffix ? regexEscape(nestingSuffix) : nestingSuffixEscaped || regexEscape(')');
    this.nestingOptionsSeparator = nestingOptionsSeparator || ',';
    this.maxReplaces = maxReplaces || 1000;
    this.alwaysFormat = alwaysFormat !== undefined ? alwaysFormat : false;
    this.resetRegExp();
  }
  reset() {
    if (this.options) this.init(this.options);
  }
  resetRegExp() {
    const getOrResetRegExp = (existingRegExp, pattern) => {
      if (existingRegExp?.source === pattern) {
        existingRegExp.lastIndex = 0;
        return existingRegExp;
      }
      return new RegExp(pattern, 'g');
    };
    this.regexp = getOrResetRegExp(this.regexp, `${this.prefix}(.+?)${this.suffix}`);
    this.regexpUnescape = getOrResetRegExp(this.regexpUnescape, `${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`);
    this.nestingRegexp = getOrResetRegExp(this.nestingRegexp, `${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`);
  }
  interpolate(str, data, lng, options) {
    let match;
    let value;
    let replaces;
    const defaultData = this.options && this.options.interpolation && this.options.interpolation.defaultVariables || {};
    const handleFormat = key => {
      if (key.indexOf(this.formatSeparator) < 0) {
        const path = deepFindWithDefaults(data, defaultData, key, this.options.keySeparator, this.options.ignoreJSONStructure);
        return this.alwaysFormat ? this.format(path, undefined, lng, {
          ...options,
          ...data,
          interpolationkey: key
        }) : path;
      }
      const p = key.split(this.formatSeparator);
      const k = p.shift().trim();
      const f = p.join(this.formatSeparator).trim();
      return this.format(deepFindWithDefaults(data, defaultData, k, this.options.keySeparator, this.options.ignoreJSONStructure), f, lng, {
        ...options,
        ...data,
        interpolationkey: k
      });
    };
    this.resetRegExp();
    const missingInterpolationHandler = options?.missingInterpolationHandler || this.options.missingInterpolationHandler;
    const skipOnVariables = options?.interpolation?.skipOnVariables !== undefined ? options.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables;
    const todos = [{
      regex: this.regexpUnescape,
      safeValue: val => regexSafe(val)
    }, {
      regex: this.regexp,
      safeValue: val => this.escapeValue ? regexSafe(this.escape(val)) : regexSafe(val)
    }];
    todos.forEach(todo => {
      replaces = 0;
      while (match = todo.regex.exec(str)) {
        const matchedVar = match[1].trim();
        value = handleFormat(matchedVar);
        if (value === undefined) {
          if (typeof missingInterpolationHandler === 'function') {
            const temp = missingInterpolationHandler(str, match, options);
            value = isString$1(temp) ? temp : '';
          } else if (options && Object.prototype.hasOwnProperty.call(options, matchedVar)) {
            value = '';
          } else if (skipOnVariables) {
            value = match[0];
            continue;
          } else {
            this.logger.warn(`missed to pass in variable ${matchedVar} for interpolating ${str}`);
            value = '';
          }
        } else if (!isString$1(value) && !this.useRawValueToEscape) {
          value = makeString(value);
        }
        const safeValue = todo.safeValue(value);
        str = str.replace(match[0], safeValue);
        if (skipOnVariables) {
          todo.regex.lastIndex += value.length;
          todo.regex.lastIndex -= match[0].length;
        } else {
          todo.regex.lastIndex = 0;
        }
        replaces++;
        if (replaces >= this.maxReplaces) {
          break;
        }
      }
    });
    return str;
  }
  nest(str, fc, options = {}) {
    let match;
    let value;
    let clonedOptions;
    const handleHasOptions = (key, inheritedOptions) => {
      const sep = this.nestingOptionsSeparator;
      if (key.indexOf(sep) < 0) return key;
      const c = key.split(new RegExp(`${sep}[ ]*{`));
      let optionsString = `{${c[1]}`;
      key = c[0];
      optionsString = this.interpolate(optionsString, clonedOptions);
      const matchedSingleQuotes = optionsString.match(/'/g);
      const matchedDoubleQuotes = optionsString.match(/"/g);
      if ((matchedSingleQuotes?.length ?? 0) % 2 === 0 && !matchedDoubleQuotes || matchedDoubleQuotes.length % 2 !== 0) {
        optionsString = optionsString.replace(/'/g, '"');
      }
      try {
        clonedOptions = JSON.parse(optionsString);
        if (inheritedOptions) clonedOptions = {
          ...inheritedOptions,
          ...clonedOptions
        };
      } catch (e) {
        this.logger.warn(`failed parsing options string in nesting for key ${key}`, e);
        return `${key}${sep}${optionsString}`;
      }
      if (clonedOptions.defaultValue && clonedOptions.defaultValue.indexOf(this.prefix) > -1) delete clonedOptions.defaultValue;
      return key;
    };
    while (match = this.nestingRegexp.exec(str)) {
      let formatters = [];
      clonedOptions = {
        ...options
      };
      clonedOptions = clonedOptions.replace && !isString$1(clonedOptions.replace) ? clonedOptions.replace : clonedOptions;
      clonedOptions.applyPostProcessor = false;
      delete clonedOptions.defaultValue;
      const keyEndIndex = /{.*}/.test(match[1]) ? match[1].lastIndexOf('}') + 1 : match[1].indexOf(this.formatSeparator);
      if (keyEndIndex !== -1) {
        formatters = match[1].slice(keyEndIndex).split(this.formatSeparator).map(elem => elem.trim()).filter(Boolean);
        match[1] = match[1].slice(0, keyEndIndex);
      }
      value = fc(handleHasOptions.call(this, match[1].trim(), clonedOptions), clonedOptions);
      if (value && match[0] === str && !isString$1(value)) return value;
      if (!isString$1(value)) value = makeString(value);
      if (!value) {
        this.logger.warn(`missed to resolve ${match[1]} for nesting ${str}`);
        value = '';
      }
      if (formatters.length) {
        value = formatters.reduce((v, f) => this.format(v, f, options.lng, {
          ...options,
          interpolationkey: match[1].trim()
        }), value.trim());
      }
      str = str.replace(match[0], value);
      this.regexp.lastIndex = 0;
    }
    return str;
  }
}

const parseFormatStr = formatStr => {
  let formatName = formatStr.toLowerCase().trim();
  const formatOptions = {};
  if (formatStr.indexOf('(') > -1) {
    const p = formatStr.split('(');
    formatName = p[0].toLowerCase().trim();
    const optStr = p[1].substring(0, p[1].length - 1);
    if (formatName === 'currency' && optStr.indexOf(':') < 0) {
      if (!formatOptions.currency) formatOptions.currency = optStr.trim();
    } else if (formatName === 'relativetime' && optStr.indexOf(':') < 0) {
      if (!formatOptions.range) formatOptions.range = optStr.trim();
    } else {
      const opts = optStr.split(';');
      opts.forEach(opt => {
        if (opt) {
          const [key, ...rest] = opt.split(':');
          const val = rest.join(':').trim().replace(/^'+|'+$/g, '');
          const trimmedKey = key.trim();
          if (!formatOptions[trimmedKey]) formatOptions[trimmedKey] = val;
          if (val === 'false') formatOptions[trimmedKey] = false;
          if (val === 'true') formatOptions[trimmedKey] = true;
          if (!isNaN(val)) formatOptions[trimmedKey] = parseInt(val, 10);
        }
      });
    }
  }
  return {
    formatName,
    formatOptions
  };
};
const createCachedFormatter = fn => {
  const cache = {};
  return (v, l, o) => {
    let optForCache = o;
    if (o && o.interpolationkey && o.formatParams && o.formatParams[o.interpolationkey] && o[o.interpolationkey]) {
      optForCache = {
        ...optForCache,
        [o.interpolationkey]: undefined
      };
    }
    const key = l + JSON.stringify(optForCache);
    let frm = cache[key];
    if (!frm) {
      frm = fn(getCleanedCode(l), o);
      cache[key] = frm;
    }
    return frm(v);
  };
};
const createNonCachedFormatter = fn => (v, l, o) => fn(getCleanedCode(l), o)(v);
class Formatter {
  constructor(options = {}) {
    this.logger = baseLogger.create('formatter');
    this.options = options;
    this.init(options);
  }
  init(services, options = {
    interpolation: {}
  }) {
    this.formatSeparator = options.interpolation.formatSeparator || ',';
    const cf = options.cacheInBuiltFormats ? createCachedFormatter : createNonCachedFormatter;
    this.formats = {
      number: cf((lng, opt) => {
        const formatter = new Intl.NumberFormat(lng, {
          ...opt
        });
        return val => formatter.format(val);
      }),
      currency: cf((lng, opt) => {
        const formatter = new Intl.NumberFormat(lng, {
          ...opt,
          style: 'currency'
        });
        return val => formatter.format(val);
      }),
      datetime: cf((lng, opt) => {
        const formatter = new Intl.DateTimeFormat(lng, {
          ...opt
        });
        return val => formatter.format(val);
      }),
      relativetime: cf((lng, opt) => {
        const formatter = new Intl.RelativeTimeFormat(lng, {
          ...opt
        });
        return val => formatter.format(val, opt.range || 'day');
      }),
      list: cf((lng, opt) => {
        const formatter = new Intl.ListFormat(lng, {
          ...opt
        });
        return val => formatter.format(val);
      })
    };
  }
  add(name, fc) {
    this.formats[name.toLowerCase().trim()] = fc;
  }
  addCached(name, fc) {
    this.formats[name.toLowerCase().trim()] = createCachedFormatter(fc);
  }
  format(value, format, lng, options = {}) {
    const formats = format.split(this.formatSeparator);
    if (formats.length > 1 && formats[0].indexOf('(') > 1 && formats[0].indexOf(')') < 0 && formats.find(f => f.indexOf(')') > -1)) {
      const lastIndex = formats.findIndex(f => f.indexOf(')') > -1);
      formats[0] = [formats[0], ...formats.splice(1, lastIndex)].join(this.formatSeparator);
    }
    const result = formats.reduce((mem, f) => {
      const {
        formatName,
        formatOptions
      } = parseFormatStr(f);
      if (this.formats[formatName]) {
        let formatted = mem;
        try {
          const valOptions = options?.formatParams?.[options.interpolationkey] || {};
          const l = valOptions.locale || valOptions.lng || options.locale || options.lng || lng;
          formatted = this.formats[formatName](mem, l, {
            ...formatOptions,
            ...options,
            ...valOptions
          });
        } catch (error) {
          this.logger.warn(error);
        }
        return formatted;
      } else {
        this.logger.warn(`there was no format function for ${formatName}`);
      }
      return mem;
    }, value);
    return result;
  }
}

const removePending = (q, name) => {
  if (q.pending[name] !== undefined) {
    delete q.pending[name];
    q.pendingCount--;
  }
};
class Connector extends EventEmitter {
  constructor(backend, store, services, options = {}) {
    super();
    this.backend = backend;
    this.store = store;
    this.services = services;
    this.languageUtils = services.languageUtils;
    this.options = options;
    this.logger = baseLogger.create('backendConnector');
    this.waitingReads = [];
    this.maxParallelReads = options.maxParallelReads || 10;
    this.readingCalls = 0;
    this.maxRetries = options.maxRetries >= 0 ? options.maxRetries : 5;
    this.retryTimeout = options.retryTimeout >= 1 ? options.retryTimeout : 350;
    this.state = {};
    this.queue = [];
    this.backend?.init?.(services, options.backend, options);
  }
  queueLoad(languages, namespaces, options, callback) {
    const toLoad = {};
    const pending = {};
    const toLoadLanguages = {};
    const toLoadNamespaces = {};
    languages.forEach(lng => {
      let hasAllNamespaces = true;
      namespaces.forEach(ns => {
        const name = `${lng}|${ns}`;
        if (!options.reload && this.store.hasResourceBundle(lng, ns)) {
          this.state[name] = 2;
        } else if (this.state[name] < 0) ; else if (this.state[name] === 1) {
          if (pending[name] === undefined) pending[name] = true;
        } else {
          this.state[name] = 1;
          hasAllNamespaces = false;
          if (pending[name] === undefined) pending[name] = true;
          if (toLoad[name] === undefined) toLoad[name] = true;
          if (toLoadNamespaces[ns] === undefined) toLoadNamespaces[ns] = true;
        }
      });
      if (!hasAllNamespaces) toLoadLanguages[lng] = true;
    });
    if (Object.keys(toLoad).length || Object.keys(pending).length) {
      this.queue.push({
        pending,
        pendingCount: Object.keys(pending).length,
        loaded: {},
        errors: [],
        callback
      });
    }
    return {
      toLoad: Object.keys(toLoad),
      pending: Object.keys(pending),
      toLoadLanguages: Object.keys(toLoadLanguages),
      toLoadNamespaces: Object.keys(toLoadNamespaces)
    };
  }
  loaded(name, err, data) {
    const s = name.split('|');
    const lng = s[0];
    const ns = s[1];
    if (err) this.emit('failedLoading', lng, ns, err);
    if (!err && data) {
      this.store.addResourceBundle(lng, ns, data, undefined, undefined, {
        skipCopy: true
      });
    }
    this.state[name] = err ? -1 : 2;
    if (err && data) this.state[name] = 0;
    const loaded = {};
    this.queue.forEach(q => {
      pushPath(q.loaded, [lng], ns);
      removePending(q, name);
      if (err) q.errors.push(err);
      if (q.pendingCount === 0 && !q.done) {
        Object.keys(q.loaded).forEach(l => {
          if (!loaded[l]) loaded[l] = {};
          const loadedKeys = q.loaded[l];
          if (loadedKeys.length) {
            loadedKeys.forEach(n => {
              if (loaded[l][n] === undefined) loaded[l][n] = true;
            });
          }
        });
        q.done = true;
        if (q.errors.length) {
          q.callback(q.errors);
        } else {
          q.callback();
        }
      }
    });
    this.emit('loaded', loaded);
    this.queue = this.queue.filter(q => !q.done);
  }
  read(lng, ns, fcName, tried = 0, wait = this.retryTimeout, callback) {
    if (!lng.length) return callback(null, {});
    if (this.readingCalls >= this.maxParallelReads) {
      this.waitingReads.push({
        lng,
        ns,
        fcName,
        tried,
        wait,
        callback
      });
      return;
    }
    this.readingCalls++;
    const resolver = (err, data) => {
      this.readingCalls--;
      if (this.waitingReads.length > 0) {
        const next = this.waitingReads.shift();
        this.read(next.lng, next.ns, next.fcName, next.tried, next.wait, next.callback);
      }
      if (err && data && tried < this.maxRetries) {
        setTimeout(() => {
          this.read.call(this, lng, ns, fcName, tried + 1, wait * 2, callback);
        }, wait);
        return;
      }
      callback(err, data);
    };
    const fc = this.backend[fcName].bind(this.backend);
    if (fc.length === 2) {
      try {
        const r = fc(lng, ns);
        if (r && typeof r.then === 'function') {
          r.then(data => resolver(null, data)).catch(resolver);
        } else {
          resolver(null, r);
        }
      } catch (err) {
        resolver(err);
      }
      return;
    }
    return fc(lng, ns, resolver);
  }
  prepareLoading(languages, namespaces, options = {}, callback) {
    if (!this.backend) {
      this.logger.warn('No backend was added via i18next.use. Will not load resources.');
      return callback && callback();
    }
    if (isString$1(languages)) languages = this.languageUtils.toResolveHierarchy(languages);
    if (isString$1(namespaces)) namespaces = [namespaces];
    const toLoad = this.queueLoad(languages, namespaces, options, callback);
    if (!toLoad.toLoad.length) {
      if (!toLoad.pending.length) callback();
      return null;
    }
    toLoad.toLoad.forEach(name => {
      this.loadOne(name);
    });
  }
  load(languages, namespaces, callback) {
    this.prepareLoading(languages, namespaces, {}, callback);
  }
  reload(languages, namespaces, callback) {
    this.prepareLoading(languages, namespaces, {
      reload: true
    }, callback);
  }
  loadOne(name, prefix = '') {
    const s = name.split('|');
    const lng = s[0];
    const ns = s[1];
    this.read(lng, ns, 'read', undefined, undefined, (err, data) => {
      if (err) this.logger.warn(`${prefix}loading namespace ${ns} for language ${lng} failed`, err);
      if (!err && data) this.logger.log(`${prefix}loaded namespace ${ns} for language ${lng}`, data);
      this.loaded(name, err, data);
    });
  }
  saveMissing(languages, namespace, key, fallbackValue, isUpdate, options = {}, clb = () => {}) {
    if (this.services?.utils?.hasLoadedNamespace && !this.services?.utils?.hasLoadedNamespace(namespace)) {
      this.logger.warn(`did not save key "${key}" as the namespace "${namespace}" was not yet loaded`, 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');
      return;
    }
    if (key === undefined || key === null || key === '') return;
    if (this.backend?.create) {
      const opts = {
        ...options,
        isUpdate
      };
      const fc = this.backend.create.bind(this.backend);
      if (fc.length < 6) {
        try {
          let r;
          if (fc.length === 5) {
            r = fc(languages, namespace, key, fallbackValue, opts);
          } else {
            r = fc(languages, namespace, key, fallbackValue);
          }
          if (r && typeof r.then === 'function') {
            r.then(data => clb(null, data)).catch(clb);
          } else {
            clb(null, r);
          }
        } catch (err) {
          clb(err);
        }
      } else {
        fc(languages, namespace, key, fallbackValue, clb, opts);
      }
    }
    if (!languages || !languages[0]) return;
    this.store.addResource(languages[0], namespace, key, fallbackValue);
  }
}

const get = () => ({
  debug: false,
  initAsync: true,
  ns: ['translation'],
  defaultNS: ['translation'],
  fallbackLng: ['dev'],
  fallbackNS: false,
  supportedLngs: false,
  nonExplicitSupportedLngs: false,
  load: 'all',
  preload: false,
  simplifyPluralSuffix: true,
  keySeparator: '.',
  nsSeparator: ':',
  pluralSeparator: '_',
  contextSeparator: '_',
  partialBundledLanguages: false,
  saveMissing: false,
  updateMissing: false,
  saveMissingTo: 'fallback',
  saveMissingPlurals: true,
  missingKeyHandler: false,
  missingInterpolationHandler: false,
  postProcess: false,
  postProcessPassResolved: false,
  returnNull: false,
  returnEmptyString: true,
  returnObjects: false,
  joinArrays: false,
  returnedObjectHandler: false,
  parseMissingKeyHandler: false,
  appendNamespaceToMissingKey: false,
  appendNamespaceToCIMode: false,
  overloadTranslationOptionHandler: args => {
    let ret = {};
    if (typeof args[1] === 'object') ret = args[1];
    if (isString$1(args[1])) ret.defaultValue = args[1];
    if (isString$1(args[2])) ret.tDescription = args[2];
    if (typeof args[2] === 'object' || typeof args[3] === 'object') {
      const options = args[3] || args[2];
      Object.keys(options).forEach(key => {
        ret[key] = options[key];
      });
    }
    return ret;
  },
  interpolation: {
    escapeValue: true,
    format: value => value,
    prefix: '{{',
    suffix: '}}',
    formatSeparator: ',',
    unescapePrefix: '-',
    nestingPrefix: '$t(',
    nestingSuffix: ')',
    nestingOptionsSeparator: ',',
    maxReplaces: 1000,
    skipOnVariables: true
  },
  cacheInBuiltFormats: true
});
const transformOptions = options => {
  if (isString$1(options.ns)) options.ns = [options.ns];
  if (isString$1(options.fallbackLng)) options.fallbackLng = [options.fallbackLng];
  if (isString$1(options.fallbackNS)) options.fallbackNS = [options.fallbackNS];
  if (options.supportedLngs?.indexOf?.('cimode') < 0) {
    options.supportedLngs = options.supportedLngs.concat(['cimode']);
  }
  if (typeof options.initImmediate === 'boolean') options.initAsync = options.initImmediate;
  return options;
};

const noop = () => {};
const bindMemberFunctions = inst => {
  const mems = Object.getOwnPropertyNames(Object.getPrototypeOf(inst));
  mems.forEach(mem => {
    if (typeof inst[mem] === 'function') {
      inst[mem] = inst[mem].bind(inst);
    }
  });
};
class I18n extends EventEmitter {
  constructor(options = {}, callback) {
    super();
    this.options = transformOptions(options);
    this.services = {};
    this.logger = baseLogger;
    this.modules = {
      external: []
    };
    bindMemberFunctions(this);
    if (callback && !this.isInitialized && !options.isClone) {
      if (!this.options.initAsync) {
        this.init(options, callback);
        return this;
      }
      setTimeout(() => {
        this.init(options, callback);
      }, 0);
    }
  }
  init(options = {}, callback) {
    this.isInitializing = true;
    if (typeof options === 'function') {
      callback = options;
      options = {};
    }
    if (options.defaultNS == null && options.ns) {
      if (isString$1(options.ns)) {
        options.defaultNS = options.ns;
      } else if (options.ns.indexOf('translation') < 0) {
        options.defaultNS = options.ns[0];
      }
    }
    const defOpts = get();
    this.options = {
      ...defOpts,
      ...this.options,
      ...transformOptions(options)
    };
    this.options.interpolation = {
      ...defOpts.interpolation,
      ...this.options.interpolation
    };
    if (options.keySeparator !== undefined) {
      this.options.userDefinedKeySeparator = options.keySeparator;
    }
    if (options.nsSeparator !== undefined) {
      this.options.userDefinedNsSeparator = options.nsSeparator;
    }
    const createClassOnDemand = ClassOrObject => {
      if (!ClassOrObject) return null;
      if (typeof ClassOrObject === 'function') return new ClassOrObject();
      return ClassOrObject;
    };
    if (!this.options.isClone) {
      if (this.modules.logger) {
        baseLogger.init(createClassOnDemand(this.modules.logger), this.options);
      } else {
        baseLogger.init(null, this.options);
      }
      let formatter;
      if (this.modules.formatter) {
        formatter = this.modules.formatter;
      } else {
        formatter = Formatter;
      }
      const lu = new LanguageUtil(this.options);
      this.store = new ResourceStore(this.options.resources, this.options);
      const s = this.services;
      s.logger = baseLogger;
      s.resourceStore = this.store;
      s.languageUtils = lu;
      s.pluralResolver = new PluralResolver(lu, {
        prepend: this.options.pluralSeparator,
        simplifyPluralSuffix: this.options.simplifyPluralSuffix
      });
      const usingLegacyFormatFunction = this.options.interpolation.format && this.options.interpolation.format !== defOpts.interpolation.format;
      if (usingLegacyFormatFunction) {
        this.logger.deprecate(`init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting`);
      }
      if (formatter && (!this.options.interpolation.format || this.options.interpolation.format === defOpts.interpolation.format)) {
        s.formatter = createClassOnDemand(formatter);
        if (s.formatter.init) s.formatter.init(s, this.options);
        this.options.interpolation.format = s.formatter.format.bind(s.formatter);
      }
      s.interpolator = new Interpolator(this.options);
      s.utils = {
        hasLoadedNamespace: this.hasLoadedNamespace.bind(this)
      };
      s.backendConnector = new Connector(createClassOnDemand(this.modules.backend), s.resourceStore, s, this.options);
      s.backendConnector.on('*', (event, ...args) => {
        this.emit(event, ...args);
      });
      if (this.modules.languageDetector) {
        s.languageDetector = createClassOnDemand(this.modules.languageDetector);
        if (s.languageDetector.init) s.languageDetector.init(s, this.options.detection, this.options);
      }
      if (this.modules.i18nFormat) {
        s.i18nFormat = createClassOnDemand(this.modules.i18nFormat);
        if (s.i18nFormat.init) s.i18nFormat.init(this);
      }
      this.translator = new Translator(this.services, this.options);
      this.translator.on('*', (event, ...args) => {
        this.emit(event, ...args);
      });
      this.modules.external.forEach(m => {
        if (m.init) m.init(this);
      });
    }
    this.format = this.options.interpolation.format;
    if (!callback) callback = noop;
    if (this.options.fallbackLng && !this.services.languageDetector && !this.options.lng) {
      const codes = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);
      if (codes.length > 0 && codes[0] !== 'dev') this.options.lng = codes[0];
    }
    if (!this.services.languageDetector && !this.options.lng) {
      this.logger.warn('init: no languageDetector is used and no lng is defined');
    }
    const storeApi = ['getResource', 'hasResourceBundle', 'getResourceBundle', 'getDataByLanguage'];
    storeApi.forEach(fcName => {
      this[fcName] = (...args) => this.store[fcName](...args);
    });
    const storeApiChained = ['addResource', 'addResources', 'addResourceBundle', 'removeResourceBundle'];
    storeApiChained.forEach(fcName => {
      this[fcName] = (...args) => {
        this.store[fcName](...args);
        return this;
      };
    });
    const deferred = defer();
    const load = () => {
      const finish = (err, t) => {
        this.isInitializing = false;
        if (this.isInitialized && !this.initializedStoreOnce) this.logger.warn('init: i18next is already initialized. You should call init just once!');
        this.isInitialized = true;
        if (!this.options.isClone) this.logger.log('initialized', this.options);
        this.emit('initialized', this.options);
        deferred.resolve(t);
        callback(err, t);
      };
      if (this.languages && !this.isInitialized) return finish(null, this.t.bind(this));
      this.changeLanguage(this.options.lng, finish);
    };
    if (this.options.resources || !this.options.initAsync) {
      load();
    } else {
      setTimeout(load, 0);
    }
    return deferred;
  }
  loadResources(language, callback = noop) {
    let usedCallback = callback;
    const usedLng = isString$1(language) ? language : this.language;
    if (typeof language === 'function') usedCallback = language;
    if (!this.options.resources || this.options.partialBundledLanguages) {
      if (usedLng?.toLowerCase() === 'cimode' && (!this.options.preload || this.options.preload.length === 0)) return usedCallback();
      const toLoad = [];
      const append = lng => {
        if (!lng) return;
        if (lng === 'cimode') return;
        const lngs = this.services.languageUtils.toResolveHierarchy(lng);
        lngs.forEach(l => {
          if (l === 'cimode') return;
          if (toLoad.indexOf(l) < 0) toLoad.push(l);
        });
      };
      if (!usedLng) {
        const fallbacks = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);
        fallbacks.forEach(l => append(l));
      } else {
        append(usedLng);
      }
      this.options.preload?.forEach?.(l => append(l));
      this.services.backendConnector.load(toLoad, this.options.ns, e => {
        if (!e && !this.resolvedLanguage && this.language) this.setResolvedLanguage(this.language);
        usedCallback(e);
      });
    } else {
      usedCallback(null);
    }
  }
  reloadResources(lngs, ns, callback) {
    const deferred = defer();
    if (typeof lngs === 'function') {
      callback = lngs;
      lngs = undefined;
    }
    if (typeof ns === 'function') {
      callback = ns;
      ns = undefined;
    }
    if (!lngs) lngs = this.languages;
    if (!ns) ns = this.options.ns;
    if (!callback) callback = noop;
    this.services.backendConnector.reload(lngs, ns, err => {
      deferred.resolve();
      callback(err);
    });
    return deferred;
  }
  use(module) {
    if (!module) throw new Error('You are passing an undefined module! Please check the object you are passing to i18next.use()');
    if (!module.type) throw new Error('You are passing a wrong module! Please check the object you are passing to i18next.use()');
    if (module.type === 'backend') {
      this.modules.backend = module;
    }
    if (module.type === 'logger' || module.log && module.warn && module.error) {
      this.modules.logger = module;
    }
    if (module.type === 'languageDetector') {
      this.modules.languageDetector = module;
    }
    if (module.type === 'i18nFormat') {
      this.modules.i18nFormat = module;
    }
    if (module.type === 'postProcessor') {
      postProcessor.addPostProcessor(module);
    }
    if (module.type === 'formatter') {
      this.modules.formatter = module;
    }
    if (module.type === '3rdParty') {
      this.modules.external.push(module);
    }
    return this;
  }
  setResolvedLanguage(l) {
    if (!l || !this.languages) return;
    if (['cimode', 'dev'].indexOf(l) > -1) return;
    for (let li = 0; li < this.languages.length; li++) {
      const lngInLngs = this.languages[li];
      if (['cimode', 'dev'].indexOf(lngInLngs) > -1) continue;
      if (this.store.hasLanguageSomeTranslations(lngInLngs)) {
        this.resolvedLanguage = lngInLngs;
        break;
      }
    }
    if (!this.resolvedLanguage && this.languages.indexOf(l) < 0 && this.store.hasLanguageSomeTranslations(l)) {
      this.resolvedLanguage = l;
      this.languages.unshift(l);
    }
  }
  changeLanguage(lng, callback) {
    this.isLanguageChangingTo = lng;
    const deferred = defer();
    this.emit('languageChanging', lng);
    const setLngProps = l => {
      this.language = l;
      this.languages = this.services.languageUtils.toResolveHierarchy(l);
      this.resolvedLanguage = undefined;
      this.setResolvedLanguage(l);
    };
    const done = (err, l) => {
      if (l) {
        if (this.isLanguageChangingTo === lng) {
          setLngProps(l);
          this.translator.changeLanguage(l);
          this.isLanguageChangingTo = undefined;
          this.emit('languageChanged', l);
          this.logger.log('languageChanged', l);
        }
      } else {
        this.isLanguageChangingTo = undefined;
      }
      deferred.resolve((...args) => this.t(...args));
      if (callback) callback(err, (...args) => this.t(...args));
    };
    const setLng = lngs => {
      if (!lng && !lngs && this.services.languageDetector) lngs = [];
      const fl = isString$1(lngs) ? lngs : lngs && lngs[0];
      const l = this.store.hasLanguageSomeTranslations(fl) ? fl : this.services.languageUtils.getBestMatchFromCodes(isString$1(lngs) ? [lngs] : lngs);
      if (l) {
        if (!this.language) {
          setLngProps(l);
        }
        if (!this.translator.language) this.translator.changeLanguage(l);
        this.services.languageDetector?.cacheUserLanguage?.(l);
      }
      this.loadResources(l, err => {
        done(err, l);
      });
    };
    if (!lng && this.services.languageDetector && !this.services.languageDetector.async) {
      setLng(this.services.languageDetector.detect());
    } else if (!lng && this.services.languageDetector && this.services.languageDetector.async) {
      if (this.services.languageDetector.detect.length === 0) {
        this.services.languageDetector.detect().then(setLng);
      } else {
        this.services.languageDetector.detect(setLng);
      }
    } else {
      setLng(lng);
    }
    return deferred;
  }
  getFixedT(lng, ns, keyPrefix) {
    const fixedT = (key, opts, ...rest) => {
      let o;
      if (typeof opts !== 'object') {
        o = this.options.overloadTranslationOptionHandler([key, opts].concat(rest));
      } else {
        o = {
          ...opts
        };
      }
      o.lng = o.lng || fixedT.lng;
      o.lngs = o.lngs || fixedT.lngs;
      o.ns = o.ns || fixedT.ns;
      if (o.keyPrefix !== '') o.keyPrefix = o.keyPrefix || keyPrefix || fixedT.keyPrefix;
      const keySeparator = this.options.keySeparator || '.';
      let resultKey;
      if (o.keyPrefix && Array.isArray(key)) {
        resultKey = key.map(k => {
          if (typeof k === 'function') k = keysFromSelector(k, {
            ...this.options,
            ...opts
          });
          return `${o.keyPrefix}${keySeparator}${k}`;
        });
      } else {
        if (typeof key === 'function') key = keysFromSelector(key, {
          ...this.options,
          ...opts
        });
        resultKey = o.keyPrefix ? `${o.keyPrefix}${keySeparator}${key}` : key;
      }
      return this.t(resultKey, o);
    };
    if (isString$1(lng)) {
      fixedT.lng = lng;
    } else {
      fixedT.lngs = lng;
    }
    fixedT.ns = ns;
    fixedT.keyPrefix = keyPrefix;
    return fixedT;
  }
  t(...args) {
    return this.translator?.translate(...args);
  }
  exists(...args) {
    return this.translator?.exists(...args);
  }
  setDefaultNamespace(ns) {
    this.options.defaultNS = ns;
  }
  hasLoadedNamespace(ns, options = {}) {
    if (!this.isInitialized) {
      this.logger.warn('hasLoadedNamespace: i18next was not initialized', this.languages);
      return false;
    }
    if (!this.languages || !this.languages.length) {
      this.logger.warn('hasLoadedNamespace: i18n.languages were undefined or empty', this.languages);
      return false;
    }
    const lng = options.lng || this.resolvedLanguage || this.languages[0];
    const fallbackLng = this.options ? this.options.fallbackLng : false;
    const lastLng = this.languages[this.languages.length - 1];
    if (lng.toLowerCase() === 'cimode') return true;
    const loadNotPending = (l, n) => {
      const loadState = this.services.backendConnector.state[`${l}|${n}`];
      return loadState === -1 || loadState === 0 || loadState === 2;
    };
    if (options.precheck) {
      const preResult = options.precheck(this, loadNotPending);
      if (preResult !== undefined) return preResult;
    }
    if (this.hasResourceBundle(lng, ns)) return true;
    if (!this.services.backendConnector.backend || this.options.resources && !this.options.partialBundledLanguages) return true;
    if (loadNotPending(lng, ns) && (!fallbackLng || loadNotPending(lastLng, ns))) return true;
    return false;
  }
  loadNamespaces(ns, callback) {
    const deferred = defer();
    if (!this.options.ns) {
      if (callback) callback();
      return Promise.resolve();
    }
    if (isString$1(ns)) ns = [ns];
    ns.forEach(n => {
      if (this.options.ns.indexOf(n) < 0) this.options.ns.push(n);
    });
    this.loadResources(err => {
      deferred.resolve();
      if (callback) callback(err);
    });
    return deferred;
  }
  loadLanguages(lngs, callback) {
    const deferred = defer();
    if (isString$1(lngs)) lngs = [lngs];
    const preloaded = this.options.preload || [];
    const newLngs = lngs.filter(lng => preloaded.indexOf(lng) < 0 && this.services.languageUtils.isSupportedCode(lng));
    if (!newLngs.length) {
      if (callback) callback();
      return Promise.resolve();
    }
    this.options.preload = preloaded.concat(newLngs);
    this.loadResources(err => {
      deferred.resolve();
      if (callback) callback(err);
    });
    return deferred;
  }
  dir(lng) {
    if (!lng) lng = this.resolvedLanguage || (this.languages?.length > 0 ? this.languages[0] : this.language);
    if (!lng) return 'rtl';
    try {
      const l = new Intl.Locale(lng);
      if (l && l.getTextInfo) {
        const ti = l.getTextInfo();
        if (ti && ti.direction) return ti.direction;
      }
    } catch (e) {}
    const rtlLngs = ['ar', 'shu', 'sqr', 'ssh', 'xaa', 'yhd', 'yud', 'aao', 'abh', 'abv', 'acm', 'acq', 'acw', 'acx', 'acy', 'adf', 'ads', 'aeb', 'aec', 'afb', 'ajp', 'apc', 'apd', 'arb', 'arq', 'ars', 'ary', 'arz', 'auz', 'avl', 'ayh', 'ayl', 'ayn', 'ayp', 'bbz', 'pga', 'he', 'iw', 'ps', 'pbt', 'pbu', 'pst', 'prp', 'prd', 'ug', 'ur', 'ydd', 'yds', 'yih', 'ji', 'yi', 'hbo', 'men', 'xmn', 'fa', 'jpr', 'peo', 'pes', 'prs', 'dv', 'sam', 'ckb'];
    const languageUtils = this.services?.languageUtils || new LanguageUtil(get());
    if (lng.toLowerCase().indexOf('-latn') > 1) return 'ltr';
    return rtlLngs.indexOf(languageUtils.getLanguagePartFromCode(lng)) > -1 || lng.toLowerCase().indexOf('-arab') > 1 ? 'rtl' : 'ltr';
  }
  static createInstance(options = {}, callback) {
    const instance = new I18n(options, callback);
    instance.createInstance = I18n.createInstance;
    return instance;
  }
  cloneInstance(options = {}, callback = noop) {
    const forkResourceStore = options.forkResourceStore;
    if (forkResourceStore) delete options.forkResourceStore;
    const mergedOptions = {
      ...this.options,
      ...options,
      ...{
        isClone: true
      }
    };
    const clone = new I18n(mergedOptions);
    if (options.debug !== undefined || options.prefix !== undefined) {
      clone.logger = clone.logger.clone(options);
    }
    const membersToCopy = ['store', 'services', 'language'];
    membersToCopy.forEach(m => {
      clone[m] = this[m];
    });
    clone.services = {
      ...this.services
    };
    clone.services.utils = {
      hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)
    };
    if (forkResourceStore) {
      const clonedData = Object.keys(this.store.data).reduce((prev, l) => {
        prev[l] = {
          ...this.store.data[l]
        };
        prev[l] = Object.keys(prev[l]).reduce((acc, n) => {
          acc[n] = {
            ...prev[l][n]
          };
          return acc;
        }, prev[l]);
        return prev;
      }, {});
      clone.store = new ResourceStore(clonedData, mergedOptions);
      clone.services.resourceStore = clone.store;
    }
    clone.translator = new Translator(clone.services, mergedOptions);
    clone.translator.on('*', (event, ...args) => {
      clone.emit(event, ...args);
    });
    clone.init(mergedOptions, callback);
    clone.translator.options = mergedOptions;
    clone.translator.backendConnector.services.utils = {
      hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)
    };
    return clone;
  }
  toJSON() {
    return {
      options: this.options,
      store: this.store,
      language: this.language,
      languages: this.languages,
      resolvedLanguage: this.resolvedLanguage
    };
  }
}
const instance = I18n.createInstance();

instance.createInstance;
instance.dir;
instance.init;
instance.loadResources;
instance.reloadResources;
instance.use;
instance.changeLanguage;
instance.getFixedT;
instance.t;
instance.exists;
instance.setDefaultNamespace;
instance.hasLoadedNamespace;
instance.loadNamespaces;
instance.loadLanguages;

const warn = (i18n, code, msg, rest) => {
  const args = [msg, {
    code,
    ...(rest || {})
  }];
  if (i18n?.services?.logger?.forward) {
    return i18n.services.logger.forward(args, 'warn', 'react-i18next::', true);
  }
  if (isString(args[0])) args[0] = `react-i18next:: ${args[0]}`;
  if (i18n?.services?.logger?.warn) {
    i18n.services.logger.warn(...args);
  } else if (console?.warn) {
    console.warn(...args);
  }
};
const alreadyWarned = {};
const warnOnce = (i18n, code, msg, rest) => {
  if (isString(msg) && alreadyWarned[msg]) return;
  if (isString(msg)) alreadyWarned[msg] = new Date();
  warn(i18n, code, msg, rest);
};
const loadedClb = (i18n, cb) => () => {
  if (i18n.isInitialized) {
    cb();
  } else {
    const initialized = () => {
      setTimeout(() => {
        i18n.off('initialized', initialized);
      }, 0);
      cb();
    };
    i18n.on('initialized', initialized);
  }
};
const loadNamespaces = (i18n, ns, cb) => {
  i18n.loadNamespaces(ns, loadedClb(i18n, cb));
};
const loadLanguages = (i18n, lng, ns, cb) => {
  if (isString(ns)) ns = [ns];
  if (i18n.options.preload && i18n.options.preload.indexOf(lng) > -1) return loadNamespaces(i18n, ns, cb);
  ns.forEach(n => {
    if (i18n.options.ns.indexOf(n) < 0) i18n.options.ns.push(n);
  });
  i18n.loadLanguages(lng, loadedClb(i18n, cb));
};
const hasLoadedNamespace = (ns, i18n, options = {}) => {
  if (!i18n.languages || !i18n.languages.length) {
    warnOnce(i18n, 'NO_LANGUAGES', 'i18n.languages were undefined or empty', {
      languages: i18n.languages
    });
    return true;
  }
  return i18n.hasLoadedNamespace(ns, {
    lng: options.lng,
    precheck: (i18nInstance, loadNotPending) => {
      if (options.bindI18n && options.bindI18n.indexOf('languageChanging') > -1 && i18nInstance.services.backendConnector.backend && i18nInstance.isLanguageChangingTo && !loadNotPending(i18nInstance.isLanguageChangingTo, ns)) return false;
    }
  });
};
const isString = obj => typeof obj === 'string';
const isObject = obj => typeof obj === 'object' && obj !== null;

const matchHtmlEntity = /&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g;
const htmlEntities = {
  '&amp;': '&',
  '&#38;': '&',
  '&lt;': '<',
  '&#60;': '<',
  '&gt;': '>',
  '&#62;': '>',
  '&apos;': "'",
  '&#39;': "'",
  '&quot;': '"',
  '&#34;': '"',
  '&nbsp;': ' ',
  '&#160;': ' ',
  '&copy;': '©',
  '&#169;': '©',
  '&reg;': '®',
  '&#174;': '®',
  '&hellip;': '…',
  '&#8230;': '…',
  '&#x2F;': '/',
  '&#47;': '/'
};
const unescapeHtmlEntity = m => htmlEntities[m];
const unescape$1 = text => text.replace(matchHtmlEntity, unescapeHtmlEntity);

let defaultOptions = {
  bindI18n: 'languageChanged',
  bindI18nStore: '',
  transEmptyNodeValue: '',
  transSupportBasicHtmlNodes: true,
  transWrapTextNodes: '',
  transKeepBasicHtmlNodesFor: ['br', 'strong', 'i', 'p'],
  useSuspense: true,
  unescape: unescape$1
};
const setDefaults = (options = {}) => {
  defaultOptions = {
    ...defaultOptions,
    ...options
  };
};
const getDefaults = () => defaultOptions;

let i18nInstance;
const setI18n = instance => {
  i18nInstance = instance;
};
const getI18n = () => i18nInstance;

const initReactI18next = {
  type: '3rdParty',
  init(instance) {
    setDefaults(instance.options.react);
    setI18n(instance);
  }
};

const I18nContext = reactExports.createContext();
class ReportNamespaces {
  constructor() {
    this.usedNamespaces = {};
  }
  addUsedNamespaces(namespaces) {
    namespaces.forEach(ns => {
      if (!this.usedNamespaces[ns]) this.usedNamespaces[ns] = true;
    });
  }
  getUsedNamespaces() {
    return Object.keys(this.usedNamespaces);
  }
}

const notReadyT = (k, optsOrDefaultValue) => {
  if (isString(optsOrDefaultValue)) return optsOrDefaultValue;
  if (isObject(optsOrDefaultValue) && isString(optsOrDefaultValue.defaultValue)) return optsOrDefaultValue.defaultValue;
  return Array.isArray(k) ? k[k.length - 1] : k;
};
const notReadySnapshot = {
  t: notReadyT,
  ready: false
};
const dummySubscribe = () => () => {};
const useTranslation = (ns, props = {}) => {
  const {
    i18n: i18nFromProps
  } = props;
  const {
    i18n: i18nFromContext,
    defaultNS: defaultNSFromContext
  } = reactExports.useContext(I18nContext) || {};
  const i18n = i18nFromProps || i18nFromContext || getI18n();
  if (i18n && !i18n.reportNamespaces) i18n.reportNamespaces = new ReportNamespaces();
  if (!i18n) {
    warnOnce(i18n, 'NO_I18NEXT_INSTANCE', 'useTranslation: You will need to pass in an i18next instance by using initReactI18next');
  }
  const i18nOptions = reactExports.useMemo(() => ({
    ...getDefaults(),
    ...i18n?.options?.react,
    ...props
  }), [i18n, props]);
  const {
    useSuspense,
    keyPrefix
  } = i18nOptions;
  const nsOrContext = defaultNSFromContext || i18n?.options?.defaultNS;
  const unstableNamespaces = isString(nsOrContext) ? [nsOrContext] : nsOrContext || ['translation'];
  const namespaces = reactExports.useMemo(() => unstableNamespaces, unstableNamespaces);
  i18n?.reportNamespaces?.addUsedNamespaces?.(namespaces);
  const revisionRef = reactExports.useRef(0);
  const subscribe = reactExports.useCallback(callback => {
    if (!i18n) return dummySubscribe;
    const {
      bindI18n,
      bindI18nStore
    } = i18nOptions;
    const wrappedCallback = () => {
      revisionRef.current += 1;
      callback();
    };
    if (bindI18n) i18n.on(bindI18n, wrappedCallback);
    if (bindI18nStore) i18n.store.on(bindI18nStore, wrappedCallback);
    return () => {
      if (bindI18n) bindI18n.split(' ').forEach(e => i18n.off(e, wrappedCallback));
      if (bindI18nStore) bindI18nStore.split(' ').forEach(e => i18n.store.off(e, wrappedCallback));
    };
  }, [i18n, i18nOptions]);
  const snapshotRef = reactExports.useRef();
  const getSnapshot = reactExports.useCallback(() => {
    if (!i18n) {
      return notReadySnapshot;
    }
    const calculatedReady = !!(i18n.isInitialized || i18n.initializedStoreOnce) && namespaces.every(n => hasLoadedNamespace(n, i18n, i18nOptions));
    const currentLng = props.lng || i18n.language;
    const currentRevision = revisionRef.current;
    const lastSnapshot = snapshotRef.current;
    if (lastSnapshot && lastSnapshot.ready === calculatedReady && lastSnapshot.lng === currentLng && lastSnapshot.keyPrefix === keyPrefix && lastSnapshot.revision === currentRevision) {
      return lastSnapshot;
    }
    const calculatedT = i18n.getFixedT(currentLng, i18nOptions.nsMode === 'fallback' ? namespaces : namespaces[0], keyPrefix);
    const newSnapshot = {
      t: calculatedT,
      ready: calculatedReady,
      lng: currentLng,
      keyPrefix,
      revision: currentRevision
    };
    snapshotRef.current = newSnapshot;
    return newSnapshot;
  }, [i18n, namespaces, keyPrefix, i18nOptions, props.lng]);
  const [loadCount, setLoadCount] = reactExports.useState(0);
  const {
    t,
    ready
  } = shimExports.useSyncExternalStore(subscribe, getSnapshot, getSnapshot);
  reactExports.useEffect(() => {
    if (i18n && !ready && !useSuspense) {
      const onLoaded = () => setLoadCount(c => c + 1);
      if (props.lng) {
        loadLanguages(i18n, props.lng, namespaces, onLoaded);
      } else {
        loadNamespaces(i18n, namespaces, onLoaded);
      }
    }
  }, [i18n, props.lng, namespaces, ready, useSuspense, loadCount]);
  const finalI18n = i18n || {};
  const wrapperRef = reactExports.useRef(null);
  const wrapperLangRef = reactExports.useRef();
  const createI18nWrapper = original => {
    const descriptors = Object.getOwnPropertyDescriptors(original);
    if (descriptors.__original) delete descriptors.__original;
    const wrapper = Object.create(Object.getPrototypeOf(original), descriptors);
    if (!Object.prototype.hasOwnProperty.call(wrapper, '__original')) {
      try {
        Object.defineProperty(wrapper, '__original', {
          value: original,
          writable: false,
          enumerable: false,
          configurable: false
        });
      } catch (_) {}
    }
    return wrapper;
  };
  const ret = reactExports.useMemo(() => {
    const original = finalI18n;
    const lang = original?.language;
    let i18nWrapper = original;
    if (original) {
      if (wrapperRef.current && wrapperRef.current.__original === original) {
        if (wrapperLangRef.current !== lang) {
          i18nWrapper = createI18nWrapper(original);
          wrapperRef.current = i18nWrapper;
          wrapperLangRef.current = lang;
        } else {
          i18nWrapper = wrapperRef.current;
        }
      } else {
        i18nWrapper = createI18nWrapper(original);
        wrapperRef.current = i18nWrapper;
        wrapperLangRef.current = lang;
      }
    }
    const arr = [t, i18nWrapper, ready];
    arr.t = t;
    arr.i18n = i18nWrapper;
    arr.ready = ready;
    return arr;
  }, [t, finalI18n, ready, finalI18n.resolvedLanguage, finalI18n.language, finalI18n.languages]);
  if (i18n && useSuspense && !ready) {
    throw new Promise(resolve => {
      const onLoaded = () => resolve();
      if (props.lng) {
        loadLanguages(i18n, props.lng, namespaces, onLoaded);
      } else {
        loadNamespaces(i18n, namespaces, onLoaded);
      }
    });
  }
  return ret;
};

function I18nextProvider({
  i18n,
  defaultNS,
  children
}) {
  const value = reactExports.useMemo(() => ({
    i18n,
    defaultNS
  }), [i18n, defaultNS]);
  return reactExports.createElement(I18nContext.Provider, {
    value
  }, children);
}

const NorahAssistant = () => {
  const { t } = useTranslation();
  const [, setLocation] = useLocation();
  const [userId, setUserId] = React$1.useState(null);
  React$1.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      setUserId(data.user?.id || null);
    });
  }, []);
  const LeftComponent = () => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    Button,
    {
      variant: "ghost",
      size: "icon",
      onClick: () => setLocation("/home"),
      className: "mr-2",
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
    }
  ) });
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              UnifiedHeader,
              {
                profileImage: localStorage.getItem("profileImage"),
                leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(LeftComponent, {})
              }
            )
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "main",
          {
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-full h-full px-0 md:px-4 md:max-w-screen-xl md:mx-auto", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 md:mb-6 px-4 md:px-0", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl md:text-3xl font-bold bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent mb-2", children: t("norah_ai_assistant") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm md:text-base text-white/70", children: t("assistant_description") })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-full", children: [
                userId && /* @__PURE__ */ jsxRuntimeExports.jsx(NorahChatLLM, { userId }),
                !userId && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 px-4", children: t("loading") })
              ] })
            ] })
          }
        )
      ]
    }
  );
};

const LS_KEYS = ["geo.enabled.v1", "geo_enabled"];
function readEnabled() {
  try {
    return LS_KEYS.some((k) => localStorage.getItem(k) === "1");
  } catch {
    return false;
  }
}
function writeEnabled(v) {
  try {
    LS_KEYS.forEach((k) => v ? localStorage.setItem(k, "1") : localStorage.removeItem(k));
  } catch {
  }
}
function isIOSSafari() {
  const ua = navigator.userAgent;
  const isIOS = /iPad|iPhone|iPod/.test(ua);
  const isSafari = /Safari/.test(ua) && !/Chrome/.test(ua);
  return isIOS || isSafari;
}
function isPWA() {
  return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
}
function useGeolocation() {
  const [status, setStatus] = reactExports.useState("idle");
  const [enabled, setEnabled] = reactExports.useState(() => readEnabled());
  const [position, setPosition] = reactExports.useState(void 0);
  const [error, setError] = reactExports.useState(null);
  const [retryCount, setRetryCount] = reactExports.useState(0);
  const watchId = reactExports.useRef();
  const enable = reactExports.useCallback(() => {
    writeEnabled(true);
    setEnabled(true);
    setRetryCount(0);
  }, []);
  const disable = reactExports.useCallback(() => {
    writeEnabled(false);
    setEnabled(false);
    setStatus("idle");
    setError(null);
    if (watchId.current != null) navigator.geolocation.clearWatch(watchId.current);
  }, []);
  const retry = reactExports.useCallback(() => {
    if (watchId.current != null) {
      navigator.geolocation.clearWatch(watchId.current);
    }
    setRetryCount((prev) => prev + 1);
    setStatus("prompt");
    setError(null);
  }, []);
  reactExports.useEffect(() => {
    if (!enabled) return;
    if (!("geolocation" in navigator)) {
      setStatus("error");
      setError({ code: 0, message: "Geolocation not supported" });
      return;
    }
    setStatus("prompt");
    if ("permissions" in navigator) {
      navigator.permissions.query({ name: "geolocation" }).then((result) => {
        console.log("📍 [Geo] Permission state:", result.state);
        if (result.state === "denied") {
          setStatus("blocked");
          setError({ code: 1, message: "Permission permanently denied. Please enable in browser settings." });
          return;
        }
        result.onchange = () => {
          console.log("📍 [Geo] Permission changed to:", result.state);
          if (result.state === "granted") {
            setStatus("granted");
            setError(null);
          } else if (result.state === "denied") {
            setStatus("blocked");
          }
        };
      }).catch(() => {
        console.log("📍 [Geo] Permissions API not available");
      });
    }
    watchId.current = navigator.geolocation.watchPosition(
      (p) => {
        console.log("📍 [Geo] Position received:", { lat: p.coords.latitude, lng: p.coords.longitude });
        setStatus("granted");
        setError(null);
        setPosition({ lat: p.coords.latitude, lng: p.coords.longitude, acc: p.coords.accuracy });
      },
      (e) => {
        console.warn("📍 [Geo] Error:", e.code, e.message);
        setError({ code: e.code, message: e.message });
        if (e.code === e.PERMISSION_DENIED) {
          if (e.message.includes("blocked") || e.message.includes("ignored") || retryCount > 2) {
            setStatus("blocked");
          } else {
            setStatus("denied");
          }
        } else if (e.code === e.POSITION_UNAVAILABLE) {
          setStatus("error");
        } else if (e.code === e.TIMEOUT) {
          setStatus("error");
        } else {
          setStatus("error");
        }
      },
      {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: isIOSSafari() ? 15e3 : 1e4
        // Longer timeout for iOS
      }
    );
    return () => {
      if (watchId.current != null) navigator.geolocation.clearWatch(watchId.current);
    };
  }, [enabled, retryCount]);
  return {
    status,
    enabled,
    position,
    error,
    isBlocked: status === "blocked",
    isIOS: isIOSSafari(),
    isPWA: isPWA(),
    enable,
    disable,
    retry
  };
}

const SettingsPage = () => {
  const [, setLocation] = useLocation();
  useAuth();
  const [geolocationEnabled, setGeolocationEnabled] = reactExports.useState(false);
  const [sessionStatus, setSessionStatus] = reactExports.useState("Verifica...");
  useGeolocation();
  const supabaseProjectId = getProjectRef$1();
  reactExports.useEffect(() => {
    checkGeolocation();
    checkSession();
  }, []);
  const checkGeolocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        () => setGeolocationEnabled(true),
        () => setGeolocationEnabled(false)
      );
    }
  };
  const checkSession = async () => {
    try {
      const { data: { session } } = await supabase.auth.getSession();
      setSessionStatus(session ? "Attiva" : "Non attiva");
    } catch (error) {
      setSessionStatus("Errore");
    }
  };
  const handleSectionChange = (sectionId) => {
    setLocation(`/settings/${sectionId}`);
  };
  const sections = [
    {
      id: "agent-profile",
      label: "Profilo Agente",
      description: "Avatar, nome e informazioni agente",
      icon: User
    },
    {
      id: "security",
      label: "Sicurezza",
      description: "Password e codici di emergenza",
      icon: Shield
    },
    {
      id: "mission",
      label: "Missione",
      description: "Stato missioni e progressi",
      icon: Target
    },
    {
      id: "notifications",
      label: "Notifiche",
      description: "Preferenze e alert",
      icon: Bell
    },
    {
      id: "privacy",
      label: "Privacy",
      description: "Gestione consensi e cookie",
      icon: Lock
    },
    {
      id: "legal",
      label: "Legale",
      description: "Termini, privacy e account",
      icon: FileText
    },
    {
      id: "app-info",
      label: "Info App",
      description: "Versione, supporto e credits",
      icon: Info
    }
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-background via-background/95 to-background/90", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: "pt-16 pb-20 px-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-lg mx-auto space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-8", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "h-8 w-8 text-primary" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent", children: "Impostazioni" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground text-lg", children: "Configura la tua esperienza M1SSION" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: sections.map((section) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        Card,
        {
          className: "glass-card cursor-pointer transition-all duration-300 hover:scale-[1.02] hover:shadow-lg border-0 bg-card/50 backdrop-blur-md",
          onClick: () => handleSectionChange(section.id),
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(section.icon, { className: "h-6 w-6 text-primary" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-foreground text-lg", children: section.label }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/80", children: section.description })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronRight, { className: "h-5 w-5 text-muted-foreground transition-transform duration-200 group-hover:translate-x-1" })
          ] }) })
        },
        section.id
      )) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4 mt-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/40 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent", children: "Privacy & Permessi" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-4 border-0 bg-background/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-2 rounded-lg bg-blue-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "h-5 w-5 text-blue-400" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium text-foreground", children: "Geolocalizzazione" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Badge,
              {
                variant: geolocationEnabled ? "default" : "secondary",
                className: geolocationEnabled ? "bg-green-500/20 text-green-400 border-green-500/30" : "",
                children: geolocationEnabled ? "Attiva" : "Disattiva"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/80 mb-3", children: "Permetti l'accesso alla posizione per le funzionalità di missione" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              variant: "outline",
              size: "sm",
              onClick: checkGeolocation,
              className: "w-full bg-background/50 border-primary/30 hover:bg-primary/10",
              children: "Verifica Permessi"
            }
          )
        ] }) })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/40 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent", children: "Diagnostica" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-4 border-0 bg-background/20 space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-2 rounded-lg bg-green-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Stethoscope, { className: "h-5 w-5 text-green-400" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium text-foreground", children: "Info Supabase" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", className: "border-green-500/30 text-green-400", children: [
              "ID: ",
              supabaseProjectId.slice(0, 8),
              "..."
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-muted-foreground/80", children: "Stato Sessione:" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Badge,
                {
                  variant: sessionStatus === "Attiva" ? "default" : "destructive",
                  className: sessionStatus === "Attiva" ? "bg-green-500/20 text-green-400 border-green-500/30" : "",
                  children: sessionStatus
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                variant: "outline",
                size: "sm",
                onClick: checkSession,
                className: "w-full bg-background/50 border-green-500/30 hover:bg-green-500/10",
                children: "Verifica Sessione"
              }
            )
          ] })
        ] }) })
      ] }) })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
  ] });
};

const ProfileLayout = ({ children, showBottomNav = true }) => {
  const { profileImage } = useProfileImage();
  useWouterNavigation();
  const isMobile = useIsMobile();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "min-h-screen bg-gradient-to-b from-[#131524]/70 to-black text-white",
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      transition: { duration: 0.5 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-[72px] w-full" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: `pb-20 ${isMobile ? "px-3" : "px-6"} max-w-screen-xl mx-auto`, children }),
        showBottomNav && /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bottom-0 left-0 w-full h-[150px] pointer-events-none bg-gradient-to-t from-black to-transparent opacity-70 z-10" })
      ]
    }
  );
};

const categoryMapping = {
  all: "",
  leaderboard: NOTIFICATION_CATEGORIES$1.LEADERBOARD,
  buzz: NOTIFICATION_CATEGORIES$1.BUZZ,
  map: NOTIFICATION_CATEGORIES$1.MAP_BUZZ,
  weekly: NOTIFICATION_CATEGORIES$1.WEEKLY,
  generic: NOTIFICATION_CATEGORIES$1.GENERIC
};
const NotificationsDrawer = ({ open, onOpenChange }) => {
  const [selectedNotification, setSelectedNotification] = reactExports.useState(null);
  const [activeCategory, setActiveCategory] = reactExports.useState("all");
  const { notifications, unreadCount, markAllAsRead, reloadNotifications, deleteNotification } = useNotifications();
  reactExports.useEffect(() => {
    if (open) {
      console.log("📱 DRAWER: Opened, forcing reload");
      reloadNotifications();
      const interval = setInterval(() => {
        console.log("🔄 DRAWER: Auto-refreshing notifications");
        reloadNotifications();
      }, 5e3);
      return () => clearInterval(interval);
    }
  }, [open, reloadNotifications]);
  const handleMarkAllAsRead = () => {
    console.log("✅ DRAWER: Marking all notifications as read");
    markAllAsRead();
  };
  const handleSelectNotification = (notification) => {
    console.log("👁️ DRAWER: Selected notification:", notification);
    setSelectedNotification(notification);
  };
  const handleDeleteNotification = (id) => {
    console.log("🗑️ DRAWER: Deleting notification:", id);
    deleteNotification(id);
  };
  const handleManualReload = () => {
    console.log("🔄 DRAWER: Manual reload requested");
    reloadNotifications();
  };
  const filteredNotifications = activeCategory === "all" ? notifications : notifications.filter((n) => n.type === categoryMapping[activeCategory]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "sm:max-w-md w-full bg-black p-0 overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { className: "px-6 pt-4 pb-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogTitle, { className: "flex items-center gap-1 text-lg", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "h-5 w-5 mr-1" }),
          "Notifiche",
          unreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "ml-2 px-2 py-0.5 text-xs bg-m1ssion-pink rounded-full animate-pulse", children: unreadCount }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              variant: "ghost",
              size: "sm",
              onClick: handleManualReload,
              className: "ml-auto p-1 h-6 w-6",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "h-3 w-3" })
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(DialogDescription, { className: "text-xs text-muted-foreground", children: "Tutte le notifiche ricevute di recente." })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-3 py-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "all", className: "w-full", onValueChange: (value) => setActiveCategory(value), children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "bg-black/40 p-1 w-full grid grid-cols-6 h-auto", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "all", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Tutti" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "leaderboard", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Classifica" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "buzz", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Circle, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Buzz" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "map", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Mappa" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "weekly", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Settimanale" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "generic", className: "text-xs py-1 data-[state=active]:bg-gradient-to-r data-[state=active]:from-m1ssion-blue data-[state=active]:to-m1ssion-pink", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only sm:not-sr-only sm:ml-1", children: "Altre" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: activeCategory, className: "mt-2 px-3 max-h-[50vh] overflow-y-auto", children: filteredNotifications.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-6 text-muted-foreground", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Non hai notifiche in questa categoria." }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              variant: "outline",
              size: "sm",
              onClick: handleManualReload,
              className: "mt-2",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "h-3 w-3 mr-1" }),
                "Ricarica"
              ]
            }
          )
        ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: filteredNotifications.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()).map((notification) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          NotificationItem,
          {
            notification,
            onSelect: () => handleSelectNotification(notification),
            onDelete: () => handleDeleteNotification(notification.id)
          },
          notification.id
        )) }) })
      ] }) }),
      notifications.length > 0 && unreadCount > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mt-2 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          size: "sm",
          variant: "outline",
          onClick: handleMarkAllAsRead,
          className: "bg-gradient-to-r from-m1ssion-blue/20 to-m1ssion-pink/20 hover:from-m1ssion-blue/30 hover:to-m1ssion-pink/30 border-gray-700",
          children: "Segna tutte come lette"
        }
      ) })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      NotificationDialog,
      {
        notification: selectedNotification,
        open: !!selectedNotification,
        onClose: () => setSelectedNotification(null)
      }
    )
  ] });
};

const ProfileHeader = ({
  agentCode,
  agentTitle,
  isEditing,
  onEditToggle,
  onSave
}) => {
  const [showCodeText, setShowCodeText] = reactExports.useState(false);
  useIsMobile();
  const { user } = useAuthContext();
  const SPECIAL_ADMIN_EMAIL = "wikus77@hotmail.it";
  const SPECIAL_ADMIN_CODE = "AG-X0197";
  const displayCode = user?.email?.toLowerCase() === SPECIAL_ADMIN_EMAIL.toLowerCase() ? SPECIAL_ADMIN_CODE : agentCode;
  reactExports.useEffect(() => {
    const timer = setTimeout(() => {
      setShowCodeText(true);
    }, 2e3);
    return () => clearTimeout(timer);
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 border-b border-white/10 backdrop-blur-xl bg-gradient-to-r from-black/55 via-[#131524]/55 to-black/55 flex justify-between items-center", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        motion.div,
        {
          initial: { opacity: 0 },
          animate: { opacity: 1 },
          transition: { delay: 0.2, duration: 0.5 },
          className: "flex items-center",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 font-mono text-xs sm:text-sm font-medium", children: "DOSSIER:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.span,
              {
                className: "font-mono text-white bg-cyan-900/40 px-2 py-1 rounded text-xs sm:text-sm ml-2 border border-cyan-900/30",
                initial: { width: 0, opacity: 0 },
                animate: { width: "auto", opacity: showCodeText ? 1 : 0 },
                transition: { delay: 0.5, duration: 0.5 },
                children: displayCode
              }
            )
          ]
        }
      ),
      !isEditing && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "bg-cyan-600 text-white text-xs px-2 py-0.5 rounded-full ml-2", children: agentTitle })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Button,
      {
        onClick: () => isEditing ? onSave() : onEditToggle(),
        size: "sm",
        className: `bg-cyan-800 hover:bg-cyan-700 h-10 px-3 sm:px-4 text-xs sm:text-sm`,
        children: [
          isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsx(Save, { className: "h-4 w-4 mr-1" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(SquarePen, { className: "h-4 w-4 mr-1" }),
          isEditing ? "Salva" : "Modifica"
        ]
      }
    )
  ] });
};

const getSubscriptionRingColor = (plan) => {
  switch (plan?.toLowerCase()) {
    case "silver":
      return "#C0C0C0";
    case "gold":
      return "#FFD700";
    case "black":
      return "#333333";
    case "titanium":
      return "#878787";
    default:
      return "#444444";
  }
};
const ProfileInfo = ({
  profileImage,
  name,
  bio,
  agentCode,
  agentTitle,
  investigativeStyle,
  stats,
  credits,
  isEditing,
  subscriptionPlan = "base",
  personalInfo,
  setProfileImage,
  setName,
  setBio,
  setAgentCode,
  setAgentTitle
}) => {
  const isMobile = useIsMobile();
  const { pulseEnergy, currentRank, nextRank, progressToNextRank, loading: peLoading } = usePulseEnergy();
  reactExports.useEffect(() => {
    console.log("[PE-DEBUG]", {
      pulseEnergy,
      currentRank: currentRank?.code,
      nextRank: nextRank?.code,
      progressToNextRank,
      ranksCount: currentRank ? 11 : 0
      // Assuming 11 ranks from catalog
    });
  }, [pulseEnergy, currentRank, nextRank, progressToNextRank]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-shrink-0 flex flex-col items-center md:w-1/3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute inset-0 rounded-full ring-2 ring-offset-2 ring-offset-black",
          style: {
            "--ring-color": getSubscriptionRingColor(subscriptionPlan),
            borderColor: "var(--ring-color)",
            boxShadow: `0 0 12px var(--ring-color)80`
          }
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Avatar, { className: `${isMobile ? "w-24 h-24" : "w-32 h-32"} border-2 border-cyan-500 shadow-lg shadow-cyan-500/20 cursor-pointer relative z-10`, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarImage, { src: profileImage || "" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AvatarFallback, { className: "bg-cyan-900/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: `${isMobile ? "w-8 h-8" : "w-12 h-12"} text-cyan-500` }) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute bottom-0 right-0 bg-cyan-500 rounded-full p-1.5 cursor-pointer hover:bg-cyan-400 transition-colors",
          onClick: () => document.getElementById("profile-image-input")?.click(),
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(Camera, { className: "w-3 h-3 text-black" })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "input",
        {
          id: "profile-image-input",
          type: "file",
          accept: "image/*",
          onChange: async (e) => {
            const file = e.target.files?.[0];
            if (file) {
              try {
                const fileName = `avatar-${Date.now()}.${file.name.split(".").pop()}`;
                const { data, error } = await supabase.storage.from("avatars").upload(fileName, file, {
                  cacheControl: "3600",
                  upsert: false
                });
                if (error) {
                  console.error("Upload error:", error);
                  ue$1.error("Errore nel caricamento dell'immagine");
                  return;
                }
                const { data: publicUrl } = supabase.storage.from("avatars").getPublicUrl(data.path);
                setProfileImage(publicUrl.publicUrl);
                ue$1.success("Immagine profilo aggiornata");
              } catch (error) {
                console.error("Error uploading image:", error);
                ue$1.error("Errore nel caricamento dell'immagine");
              }
            }
          },
          className: "hidden"
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 text-center w-full max-w-[250px] mx-auto", children: isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          value: name,
          onChange: (e) => setName(e.target.value),
          className: "mb-2 bg-black/30 h-10",
          placeholder: "Nome Agente"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          value: agentCode,
          onChange: (e) => setAgentCode(e.target.value),
          className: "mb-2 bg-black/30 font-mono h-10",
          placeholder: "Codice Agente"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          value: agentTitle,
          onChange: (e) => setAgentTitle(e.target.value),
          className: "mb-2 bg-black/30 h-10",
          placeholder: "Titolo Agente"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Textarea,
        {
          value: bio,
          onChange: (e) => setBio(e.target.value),
          className: "bg-black/30",
          placeholder: "Bio",
          rows: isMobile ? 3 : 4
        }
      )
    ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: `${isMobile ? "text-lg" : "text-xl"} font-bold mb-1`, children: name }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400 mb-3", children: bio }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 p-2 bg-black/30 rounded-md border border-gray-800", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Stile investigativo:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center mt-1 justify-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `w-3 h-3 rounded-full ${investigativeStyle.color} mr-2` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: investigativeStyle.style })
        ] })
      ] }),
      !peLoading && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 space-y-3", "data-testid": "pe-system-container", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          PulseEnergyBadge,
          {
            rank: currentRank,
            showCode: true,
            className: currentRank?.code === "SRC-∞" ? "ring-2 ring-purple-500 animate-pulse" : "",
            "data-testid": "pe-badge"
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { "data-testid": "pe-progress", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          PulseEnergyProgressBar,
          {
            currentRank,
            nextRank,
            progressPercent: progressToNextRank,
            currentPE: pulseEnergy
          }
        ) })
      ] }),
      personalInfo && (personalInfo.firstName || personalInfo.email || personalInfo.phone) && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 p-2 bg-black/30 rounded-md border border-gray-800", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Informazioni personali:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-1 text-left text-xs", children: [
          personalInfo.firstName && personalInfo.lastName && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Nome: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: `${personalInfo.firstName} ${personalInfo.lastName}` })
          ] }),
          personalInfo.email && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Email: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: personalInfo.email })
          ] }),
          personalInfo.phone && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Telefono: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: personalInfo.phone })
          ] }),
          personalInfo.address && personalInfo.city && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Indirizzo: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: `${personalInfo.address}, ${personalInfo.city}` }),
            personalInfo.postalCode && ` (${personalInfo.postalCode})`
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap justify-center gap-4 mt-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-col items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-baseline", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400 mr-1.5", children: "Missioni: " }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 text-lg font-medium", children: stats.missionsCompleted })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-col items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-baseline", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400 mr-1.5", children: "Indizi: " }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 text-lg font-medium", children: stats.cluesFound })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-col items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-baseline", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400 mr-1.5", children: "Crediti: " }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 text-lg font-medium", children: credits })
        ] }) })
      ] })
    ] }) })
  ] });
};

const useUniversalSubscriptionSync = () => {
  const { getCurrentUser } = useAuthContext();
  const triggerGlobalSync = reactExports.useMemo(() => (newPlan) => {
    console.log("🔄 M1SSION™ UNIVERSAL SYNC TRIGGER:", newPlan);
    localStorage.setItem("subscription_plan", newPlan);
    localStorage.setItem("userTier", newPlan);
    window.dispatchEvent(new StorageEvent("storage", {
      key: "subscription_plan",
      newValue: newPlan,
      storageArea: localStorage
    }));
    window.dispatchEvent(new CustomEvent("subscription-sync", {
      detail: { plan: newPlan, timestamp: Date.now() }
    }));
  }, []);
  reactExports.useEffect(() => {
    const user = getCurrentUser();
    if (!user) return;
    console.log("🔄 M1SSION™ Setting up universal subscription sync for user:", user.id);
    const profilesChannel = supabase.channel(`profiles-sync-${user.id}`).on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "profiles",
        filter: `id=eq.${user.id}`
      },
      (payload) => {
        console.log("🔄 M1SSION™ REALTIME PROFILE UPDATE:", payload);
        const newTier = payload.new?.subscription_tier || payload.new?.tier;
        if (newTier) {
          triggerGlobalSync(newTier);
        }
      }
    ).subscribe();
    const subscriptionsChannel = supabase.channel(`subscriptions-sync-${user.id}`).on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "subscriptions",
        filter: `user_id=eq.${user.id}`
      },
      (payload) => {
        console.log("🔄 M1SSION™ REALTIME SUBSCRIPTION UPDATE:", payload);
        const newTier = payload.new?.tier;
        if (newTier) {
          triggerGlobalSync(newTier);
        }
      }
    ).subscribe();
    return () => {
      supabase.removeChannel(profilesChannel);
      supabase.removeChannel(subscriptionsChannel);
    };
  }, [getCurrentUser, triggerGlobalSync]);
  return { triggerGlobalSync };
};

const useProfileSubscription = () => {
  const { getCurrentUser } = useAuthContext();
  const { triggerGlobalSync } = useUniversalSubscriptionSync();
  const [subscription, setSubscription] = reactExports.useState({
    plan: "Base",
    expiry: "2025-12-31",
    benefits: ["Accesso di base", "Missioni standard"]
  });
  const [credits, setCredits] = reactExports.useState(500);
  const loadSubscriptionFromSupabase = async () => {
    const currentUser = getCurrentUser();
    if (!currentUser) return;
    try {
      console.log("🔄 M1SSION™ Checking active subscriptions...");
      const { data: activeSubscription } = await supabase.from("subscriptions").select("*").eq("user_id", currentUser.id).eq("status", "active").order("created_at", { ascending: false }).limit(1);
      const { data: profileData } = await supabase.from("profiles").select("subscription_tier, tier").eq("id", currentUser.id).single();
      let finalPlan = "Base";
      if (activeSubscription && activeSubscription.length > 0) {
        const sub = activeSubscription[0];
        const isExpired = sub.end_date && new Date(sub.end_date) < /* @__PURE__ */ new Date();
        if (!isExpired) {
          finalPlan = sub.tier;
          console.log("✅ M1SSION™ Active subscription found:", finalPlan);
        }
      } else if (profileData?.subscription_tier) {
        finalPlan = profileData.subscription_tier;
        console.log("📋 M1SSION™ Using profile tier:", finalPlan);
      }
      console.log("📋 M1SSION™ Using pure database tier without overrides:", finalPlan);
      switch (finalPlan) {
        case "Silver":
          setSubscription({
            plan: "Silver",
            expiry: "2025-12-31",
            benefits: ["Accesso prioritario", "Indizi esclusivi", "Supporto dedicato"]
          });
          setCredits(1500);
          break;
        case "Gold":
          setSubscription({
            plan: "Gold",
            expiry: "2025-12-31",
            benefits: ["Accesso prioritario", "Indizi esclusivi", "Supporto dedicato", "Contenuti premium"]
          });
          setCredits(2500);
          break;
        case "Black":
          setSubscription({
            plan: "Black",
            expiry: "2025-12-31",
            benefits: [
              "Accesso prioritario VIP",
              "Indizi esclusivi premium",
              "Supporto dedicato 24/7",
              "Contenuti esclusivi Black",
              "Accesso anticipato alle novità"
            ]
          });
          setCredits(1e4);
          break;
        case "Titanium":
          setSubscription({
            plan: "Titanium",
            expiry: "2025-12-31",
            benefits: [
              "Accesso illimitato a tutto",
              "Badge Titanium esclusivo neon",
              "Supporto prioritario 24/7",
              "Eventi esclusivi Titanium VIP",
              "Contenuti premium anticipati"
            ]
          });
          setCredits(25e3);
          break;
        default:
          setSubscription({
            plan: "Base",
            expiry: "2025-12-31",
            benefits: ["Accesso di base", "Missioni standard"]
          });
          setCredits(500);
      }
      triggerGlobalSync(finalPlan);
    } catch (error) {
      console.error("Error loading subscription:", error);
    }
  };
  reactExports.useEffect(() => {
    loadSubscriptionFromSupabase();
    const handleStorageChange = () => {
      loadSubscriptionFromSupabase();
    };
    window.addEventListener("storage", handleStorageChange);
    return () => window.removeEventListener("storage", handleStorageChange);
  }, [getCurrentUser]);
  const upgradeSubscription = async (newPlan) => {
    const currentUser = getCurrentUser();
    if (!currentUser) return;
    try {
      console.warn(`🔥 M1SSION™ UPGRADE STARTED: ${newPlan} for user ${currentUser.id}`);
      console.warn(`🧹 M1SSION™ CLEANUP: Canceling ALL existing subscriptions`);
      const { error: cancelAllError } = await supabase.from("subscriptions").update({ status: "canceled", updated_at: (/* @__PURE__ */ new Date()).toISOString() }).eq("user_id", currentUser.id).neq("status", "canceled");
      if (cancelAllError) {
        console.error("❌ M1SSION™ Error canceling existing subscriptions:", cancelAllError);
      } else {
        console.warn("✅ M1SSION™ All existing subscriptions canceled");
      }
      if (newPlan === "Base") {
        console.warn("🔻 M1SSION™ FORCING BASE DOWNGRADE");
        try {
          const { data: cancelData, error: cancelStripeError } = await supabase.functions.invoke("cancel-subscription");
          if (cancelStripeError) {
            console.error("❌ M1SSION™ Stripe cancel error:", cancelStripeError);
          } else {
            console.warn("✅ M1SSION™ Stripe cancellation completed:", cancelData);
          }
        } catch (stripeError) {
          console.error("❌ M1SSION™ Stripe cancel failed:", stripeError);
        }
      } else {
        console.warn(`💰 M1SSION™ CREATING NEW SUBSCRIPTION: ${newPlan}`);
        const { error: insertError } = await supabase.from("subscriptions").insert({
          user_id: currentUser.id,
          tier: newPlan,
          status: "active",
          start_date: (/* @__PURE__ */ new Date()).toISOString(),
          end_date: new Date(Date.now() + 365 * 24 * 60 * 60 * 1e3).toISOString(),
          provider: "stripe"
        });
        if (insertError) {
          console.error("❌ M1SSION™ Error creating subscription:", insertError);
        } else {
          console.warn("✅ M1SSION™ New subscription created");
        }
      }
      console.warn(`🎯 M1SSION™ FORCING PROFILE UPDATE: ${newPlan}`);
      const { error: profileError } = await supabase.from("profiles").update({
        subscription_tier: newPlan,
        tier: newPlan,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", currentUser.id);
      if (profileError) {
        console.error("❌ M1SSION™ CRITICAL PROFILE UPDATE ERROR:", profileError);
        throw new Error(`Profile update failed: ${profileError.message}`);
      } else {
        console.warn(`✅ M1SSION™ PROFILE FORCED TO: ${newPlan}`);
      }
      localStorage.setItem("subscription_plan", newPlan);
      localStorage.setItem("userTier", newPlan);
      window.dispatchEvent(new Event("storage"));
      setTimeout(() => {
        loadSubscriptionFromSupabase();
      }, 100);
      setTimeout(() => {
        loadSubscriptionFromSupabase();
      }, 1e3);
      setTimeout(() => {
        loadSubscriptionFromSupabase();
      }, 3e3);
      console.warn(`✅ M1SSION™ UPGRADE COMPLETE: ${newPlan}`);
    } catch (error) {
      console.error("❌ M1SSION™ CRITICAL UPGRADE ERROR:", error);
      throw error;
    }
  };
  return {
    subscription,
    credits,
    setSubscription,
    setCredits,
    upgradeSubscription,
    refreshSubscription: loadSubscriptionFromSupabase
  };
};

const ProfileTabs = ({
  stats,
  history,
  badges,
  subscription: passedSubscription,
  personalNotes,
  isEditing,
  setPersonalNotes,
  togglePinBadge,
  navigateToPersonalInfo,
  navigateToPrivacySecurity,
  navigateToPaymentMethods,
  navigateToSubscriptions
}) => {
  const { subscription: liveSubscription } = useProfileSubscription();
  const subscription = liveSubscription;
  console.log("🔍 ProfileTabs SUBSCRIPTION DEBUG:", {
    passedSubscription: passedSubscription.plan,
    liveSubscription: liveSubscription.plan,
    usingPlan: subscription.plan,
    timestamp: (/* @__PURE__ */ new Date()).toISOString()
  });
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "stats", className: "w-full", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "w-full grid grid-cols-4 bg-black/30", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "stats", className: "text-xs", children: "Statistiche" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "history", className: "text-xs", children: "Cronologia" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "badges", className: "text-xs", children: "Badge" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "account", className: "text-xs", children: "Account" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "stats", className: "p-4 bg-black/20 rounded-md mt-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-sm font-bold mb-3 flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "h-4 w-4 text-cyan-400" }),
        "Statistiche Personali"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between text-xs mb-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Avanzamento verso il premio" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
              stats.prizeProgress,
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: stats.prizeProgress, className: "h-2 bg-gray-800" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "stat-item", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Missioni completate: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-base font-medium", children: stats.missionsCompleted })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "stat-item", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Indizi trovati: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-base font-medium", children: stats.cluesFound })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "stat-item", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Tempo di gioco: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-base font-medium", children: stats.totalPlayTime })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "stat-item", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "PE totali: " }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-base font-medium", children: stats.pointsEarned.toLocaleString("it-IT") })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-cyan-900/20 p-3 rounded-md border border-cyan-900/40", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-cyan-400", children: "Miglior risultato" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: stats.bestResult })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "history", className: "p-4 bg-black/20 rounded-md mt-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-sm font-bold mb-3 flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "h-4 w-4 text-cyan-400" }),
        "Cronologia Operativa"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: history.map((item, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-l-2 border-cyan-800 pl-3 py-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs font-medium", children: [
            item.type === "access" && "Accesso",
            item.type === "mission" && "Missione",
            item.type === "clue" && "Indizio",
            item.type === "communication" && "Comunicazione"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-gray-500", children: [
            new Date(item.date).toLocaleDateString(),
            " - ",
            new Date(item.date).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-1", children: item.details })
      ] }, index)) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-bold mb-2", children: "Note personali" }),
        isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsx(
          Textarea,
          {
            value: personalNotes,
            onChange: (e) => setPersonalNotes(e.target.value),
            className: "bg-black/30 h-20"
          }
        ) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-black/20 p-3 rounded-md border border-gray-800 text-sm italic", children: personalNotes })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "badges", className: "p-4 bg-black/20 rounded-md mt-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-sm font-bold mb-3 flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "h-4 w-4 text-cyan-400" }),
        "Badge e Traguardi"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-2 gap-3", children: badges.map((badge) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "div",
        {
          className: `p-3 rounded-md border ${badge.unlocked ? badge.pinned ? "border-amber-500 bg-amber-900/20" : "border-cyan-900/40 bg-cyan-900/10" : "border-gray-700 bg-black/30 opacity-50"}`,
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-start", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `text-sm font-bold ${badge.pinned ? "text-amber-400" : ""}`, children: badge.name }),
              badge.unlocked && /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  variant: "ghost",
                  size: "sm",
                  className: "h-6 w-6 p-0",
                  onClick: () => togglePinBadge(badge.id),
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: `h-4 w-4 ${badge.pinned ? "text-amber-400 fill-amber-400" : "text-gray-400"}` })
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-400 mt-1", children: badge.description }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-2 text-xs", children: badge.unlocked ? /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-green-400", children: "Sbloccato" }) : /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-500", children: "Bloccato" }) })
          ]
        },
        badge.id
      )) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "account", className: "p-4 bg-black/20 rounded-md mt-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-sm font-bold mb-3 flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-4 w-4 text-cyan-400" }),
        "Sicurezza e Abbonamento"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        AccountTabContent,
        {
          subscription,
          navigateToPersonalInfo,
          navigateToPrivacySecurity,
          navigateToPaymentMethods,
          navigateToSubscriptions
        }
      )
    ] })
  ] });
};
const AccountTabContent = ({
  subscription,
  navigateToPersonalInfo,
  navigateToPrivacySecurity,
  navigateToPaymentMethods,
  navigateToSubscriptions
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 p-3 rounded-md bg-gradient-to-r from-cyan-900/30 to-blue-900/30 border border-cyan-900/40", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "text-sm font-bold", children: [
          "Piano attivo: ",
          subscription.plan
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "bg-amber-600 text-white text-xs px-2 py-0.5 rounded-full", children: subscription.plan })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-gray-400 block mt-1", children: [
        "Scadenza: ",
        new Date(subscription.expiry).toLocaleDateString()
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-400", children: "Vantaggi:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "mt-1 text-xs space-y-1", children: subscription.benefits.map((benefit, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { className: "flex items-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "h-1.5 w-1.5 rounded-full bg-cyan-400 mr-2" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: benefit })
        ] }, index)) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          className: "w-full mt-3 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600",
          size: "sm",
          onClick: navigateToSubscriptions,
          children: "Gestisci Abbonamento"
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      AccountSecuritySettings,
      {
        navigateToPersonalInfo,
        navigateToPrivacySecurity,
        navigateToPaymentMethods
      }
    )
  ] });
};
const AccountSecuritySettings = ({
  navigateToPersonalInfo,
  navigateToPrivacySecurity,
  navigateToPaymentMethods
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "flex items-center justify-between p-2 bg-black/30 rounded-md cursor-pointer hover:bg-black/40 transition-colors",
        onClick: navigateToPersonalInfo,
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-4 w-4 text-cyan-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Informazioni personali" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "ghost", size: "sm", className: "h-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-3.5 w-3.5" }) })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "flex items-center justify-between p-2 bg-black/30 rounded-md cursor-pointer hover:bg-black/40 transition-colors",
        onClick: navigateToPrivacySecurity,
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-4 w-4 text-cyan-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Password e sicurezza" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "ghost", size: "sm", className: "h-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-3.5 w-3.5" }) })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "flex items-center justify-between p-2 bg-black/30 rounded-md cursor-pointer hover:bg-black/40 transition-colors",
        onClick: navigateToPaymentMethods,
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-4 w-4 text-cyan-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Metodi di pagamento" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "ghost", size: "sm", className: "h-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "h-3.5 w-3.5" }) })
        ]
      }
    )
  ] });
};

const useGlobalProfileSync = () => {
  const { profileData } = useProfileRealtime();
  reactExports.useEffect(() => {
    if (profileData) {
      console.log("🌐 Global profile sync triggered:", profileData);
      const syncEvent = new CustomEvent("profile-sync", {
        detail: profileData
      });
      window.dispatchEvent(syncEvent);
      if (profileData.full_name) {
        localStorage.setItem("profileName", profileData.full_name);
        localStorage.setItem("agentName", profileData.full_name);
        console.log("🌐 Global profile sync: Updated localStorage with name:", profileData.full_name);
      }
      if (profileData.bio) {
        localStorage.setItem("profileBio", profileData.bio);
      }
      if (profileData.agent_code) {
        localStorage.setItem("agentCode", profileData.agent_code);
      }
      if (profileData.avatar_url) {
        localStorage.setItem("profileImage", profileData.avatar_url);
      }
      window.dispatchEvent(new Event("storage"));
    }
  }, [profileData]);
  return profileData;
};

const useProfileBasicInfo = () => {
  const [isEditing, setIsEditing] = reactExports.useState(false);
  const [bio, setBio] = reactExports.useState("Appassionato di auto di lusso e collezionista. Amo la velocità e l'adrenalina!");
  const [name, setName] = reactExports.useState("Mario Rossi");
  const [agentCode, setAgentCode] = reactExports.useState("AG-X480");
  const [agentTitle, setAgentTitle] = reactExports.useState("Decoder");
  const [profileImage, setProfileImage] = reactExports.useState(null);
  const { toast } = useToast();
  const globalProfile = useGlobalProfileSync();
  const { updateProfile } = useProfileRealtime();
  reactExports.useEffect(() => {
    if (globalProfile) {
      console.log("📡 Global profile update received in useProfileBasicInfo:", globalProfile);
      if (globalProfile.full_name) {
        setName(globalProfile.full_name);
        console.log("🔄 useProfileBasicInfo: Updated name to:", globalProfile.full_name);
      }
      if (globalProfile.bio) setBio(globalProfile.bio);
      if (globalProfile.agent_code) setAgentCode(globalProfile.agent_code);
      if (globalProfile.agent_title) setAgentTitle(globalProfile.agent_title);
      if (globalProfile.avatar_url) setProfileImage(globalProfile.avatar_url);
    }
  }, [globalProfile]);
  reactExports.useEffect(() => {
    const loadProfileBasicInfo = async () => {
      if (!globalProfile) {
        console.log("📂 Loading profile from localStorage fallback");
        const savedProfileImage = localStorage.getItem("profileImage");
        if (savedProfileImage) setProfileImage(savedProfileImage);
        const savedName = localStorage.getItem("profileName");
        if (savedName) setName(savedName);
        const savedBio = localStorage.getItem("profileBio");
        if (savedBio) setBio(savedBio);
        const savedAgentCode = localStorage.getItem("agentCode");
        if (savedAgentCode) setAgentCode(savedAgentCode);
      }
    };
    loadProfileBasicInfo();
  }, [globalProfile]);
  const handleSaveBasicInfo = async () => {
    try {
      console.log("[ProfileBasicInfo] Starting save...", {
        name,
        bio,
        agentCode,
        agentTitle,
        profileImage
      });
      if (profileImage) {
        localStorage.setItem("profileImage", profileImage);
      }
      localStorage.setItem("profileName", name);
      localStorage.setItem("profileBio", bio);
      localStorage.setItem("agentCode", agentCode);
      const result = await updateProfile({
        full_name: name,
        bio,
        agent_code: agentCode,
        agent_title: agentTitle,
        avatar_url: profileImage
      });
      console.log("[ProfileBasicInfo] Save result:", result);
      setIsEditing(false);
      toast({
        title: "✅ Profilo aggiornato",
        description: "Le modifiche al tuo dossier agente sono state salvate con successo."
      });
    } catch (error) {
      console.error("[ProfileBasicInfo] Error saving profile:", error);
      const errorMessage = error?.message || "Errore sconosciuto";
      const errorCode = error?.code || "N/A";
      toast({
        title: "❌ Impossibile salvare le modifiche",
        description: `Errore: ${errorMessage} (Code: ${errorCode}). Verifica la connessione e riprova.`,
        variant: "destructive"
      });
    }
  };
  return {
    isEditing,
    bio,
    name,
    agentCode,
    agentTitle,
    profileImage,
    setIsEditing,
    setBio,
    setName,
    setAgentCode,
    setAgentTitle,
    setProfileImage,
    handleSaveBasicInfo
  };
};

const useProfileStats = () => {
  const [stats, setStats] = reactExports.useState({
    missionsCompleted: 12,
    cluesFound: 47,
    totalPlayTime: "123h 45m",
    pointsEarned: 9850,
    prizeProgress: 68,
    bestResult: "Top 5% in Mission X"
  });
  const [investigativeStyle, setInvestigativeStyle] = reactExports.useState({
    style: "Ragionatore Strategico",
    color: "bg-cyan-500"
  });
  reactExports.useEffect(() => {
    const loadStatsAndStyle = async () => {
      const styleName = localStorage.getItem("investigativeStyle");
      const styleColor = localStorage.getItem("investigativeStyleColor");
      if (styleName && styleColor) {
        setInvestigativeStyle({
          style: styleName,
          color: styleColor
        });
      } else {
        const profileType = localStorage.getItem("userProfileType");
        if (profileType) {
          switch (profileType) {
            case "comandante":
              setInvestigativeStyle({
                style: "Ragionatore Strategico",
                color: "bg-cyan-500"
              });
              break;
            case "assaltatore":
              setInvestigativeStyle({
                style: "Forza d'Impatto",
                color: "bg-red-500"
              });
              break;
            case "nexus":
              setInvestigativeStyle({
                style: "Tessitore di Reti",
                color: "bg-purple-500"
              });
              break;
          }
        }
      }
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (session?.user) {
          const { data, error } = await supabase.from("profiles").select("investigative_style").eq("id", session.user.id).single();
          if (data && !error) {
            if (data.investigative_style) {
              const styleMap = {
                "comandante": { style: "Ragionatore Strategico", color: "bg-cyan-500" },
                "assaltatore": { style: "Forza d'Impatto", color: "bg-red-500" },
                "nexus": { style: "Tessitore di Reti", color: "bg-purple-500" }
              };
              setInvestigativeStyle(styleMap[data.investigative_style] || investigativeStyle);
            }
          }
        }
      } catch (error) {
        console.error("Error loading stats data from Supabase:", error);
      }
    };
    loadStatsAndStyle();
  }, []);
  return {
    stats,
    investigativeStyle,
    setStats,
    setInvestigativeStyle
  };
};

const useProfileHistory = () => {
  const [history, setHistory] = reactExports.useState([
    { type: "access", date: "2025-05-03T14:30:00", details: "Login da dispositivo principale" },
    { type: "mission", date: "2025-05-02T10:15:00", details: "Completata Missione: Enigma della Strada" },
    { type: "clue", date: "2025-05-01T16:20:00", details: "Acquistato indizio CL-445: 'Tracce digitali'" },
    { type: "communication", date: "2025-04-30T08:45:00", details: "Nuova comunicazione da HQ: Aggiornamento missione" }
  ]);
  return {
    history,
    setHistory
  };
};

const useProfileBadges = () => {
  const [badges, setBadges] = reactExports.useState([
    { id: "b1", name: "Primo Contatto", description: "Hai completato la tua prima missione", unlocked: true, pinned: true },
    { id: "b2", name: "Segugio", description: "Hai trovato 10 indizi", unlocked: true, pinned: false },
    { id: "b3", name: "Viaggiatore", description: "Hai esplorato 5 location diverse", unlocked: true, pinned: false },
    { id: "b4", name: "Decifratore", description: "Hai risolto un enigma di livello difficile", unlocked: false, pinned: false }
  ]);
  const togglePinBadge = (id) => {
    setBadges(badges.map(
      (badge) => badge.id === id ? { ...badge, pinned: !badge.pinned } : badge.id !== id && badge.pinned ? { ...badge, pinned: false } : badge
    ));
  };
  return {
    badges,
    togglePinBadge
  };
};

const useProfilePersonalInfo = () => {
  const [personalInfo, setPersonalInfo] = reactExports.useState({
    firstName: "",
    lastName: "",
    email: "",
    phone: "",
    address: "",
    city: "",
    postalCode: "",
    country: ""
  });
  reactExports.useEffect(() => {
    const loadPersonalInfo = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (session?.user) {
          const { data, error } = await supabase.from("profiles").select("first_name, last_name, email, phone, address, city, postal_code, country").eq("id", session.user.id).single();
          if (data && !error) {
            setPersonalInfo({
              firstName: data.first_name || "",
              lastName: data.last_name || "",
              email: data.email || "",
              phone: data.phone || "",
              address: data.address || "",
              city: data.city || "",
              postalCode: data.postal_code || "",
              country: data.country || ""
            });
          }
        }
      } catch (error) {
        console.error("Error loading personal info from Supabase:", error);
      }
    };
    loadPersonalInfo();
  }, []);
  return {
    personalInfo,
    setPersonalInfo
  };
};

const useProfileNotes = () => {
  const [personalNotes, setPersonNotes] = reactExports.useState("Indizi sulla localizzazione del premio sembrano puntare a Nord...");
  const setPersonalNotes = (notes) => {
    setPersonNotes(notes);
  };
  return {
    personalNotes,
    setPersonalNotes
  };
};

const useProfileData = () => {
  const basicInfo = useProfileBasicInfo();
  const statsData = useProfileStats();
  const historyData = useProfileHistory();
  const badgesData = useProfileBadges();
  const personalInfoData = useProfilePersonalInfo();
  const subscriptionData = useProfileSubscription();
  const notesData = useProfileNotes();
  const notificationsData = useProfileNotifications();
  return {
    profileData: {
      isEditing: basicInfo.isEditing,
      bio: basicInfo.bio,
      name: basicInfo.name,
      agentCode: basicInfo.agentCode,
      agentTitle: basicInfo.agentTitle,
      profileImage: basicInfo.profileImage,
      showNotifications: notificationsData.showNotifications,
      stats: statsData.stats,
      investigativeStyle: statsData.investigativeStyle,
      history: historyData.history,
      credits: subscriptionData.credits,
      badges: badgesData.badges,
      subscription: subscriptionData.subscription,
      personalNotes: notesData.personalNotes,
      personalInfo: personalInfoData.personalInfo
    },
    actions: {
      setIsEditing: basicInfo.setIsEditing,
      setBio: basicInfo.setBio,
      setName: basicInfo.setName,
      setAgentCode: basicInfo.setAgentCode,
      setAgentTitle: basicInfo.setAgentTitle,
      setProfileImage: basicInfo.setProfileImage,
      setShowNotifications: notificationsData.setShowNotifications,
      handleSaveProfile: basicInfo.handleSaveBasicInfo,
      togglePinBadge: badgesData.togglePinBadge,
      setPersonalNotes: notesData.setPersonalNotes
    }
  };
};

const AgentProfileSettings = () => {
  const { navigate } = useWouterNavigation();
  const { profileData, actions } = useProfileData();
  useIsMobile();
  const { notificationsDrawerOpen, closeNotificationsDrawer } = useNotificationManager();
  useRealTimeNotifications();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-black", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(ProfileLayout, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card mx-2 sm:mx-4 mt-2 sm:mt-4 mb-20", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          ProfileHeader,
          {
            agentCode: profileData.agentCode,
            agentTitle: profileData.agentTitle,
            isEditing: profileData.isEditing,
            onEditToggle: () => actions.setIsEditing(true),
            onSave: actions.handleSaveProfile
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6 border-t border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl sm:text-2xl font-bold gradient-text mb-4", children: "👤 Informazioni Agente" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col md:flex-row gap-4 sm:gap-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              ProfileInfo,
              {
                profileImage: profileData.profileImage,
                name: profileData.name,
                bio: profileData.bio,
                agentCode: profileData.agentCode,
                agentTitle: profileData.agentTitle,
                investigativeStyle: profileData.investigativeStyle,
                stats: {
                  missionsCompleted: profileData.stats.missionsCompleted,
                  cluesFound: profileData.stats.cluesFound
                },
                credits: profileData.credits,
                isEditing: profileData.isEditing,
                subscriptionPlan: profileData.subscription.plan,
                personalInfo: profileData.personalInfo,
                setProfileImage: actions.setProfileImage,
                setName: actions.setName,
                setBio: actions.setBio,
                setAgentCode: actions.setAgentCode,
                setAgentTitle: actions.setAgentTitle
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 mt-4 md:mt-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              ProfileTabs,
              {
                stats: profileData.stats,
                history: profileData.history,
                badges: profileData.badges,
                subscription: profileData.subscription,
                personalNotes: profileData.personalNotes,
                isEditing: profileData.isEditing,
                setPersonalNotes: actions.setPersonalNotes,
                togglePinBadge: actions.togglePinBadge,
                navigateToPersonalInfo: () => navigate("/profile/personal-info"),
                navigateToPrivacySecurity: () => navigate("/profile/security"),
                navigateToPaymentMethods: () => navigate("/profile/payments"),
                navigateToSubscriptions: () => navigate("/subscriptions")
              }
            ) })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        NotificationsDrawer,
        {
          open: notificationsDrawerOpen,
          onOpenChange: closeNotificationsDrawer
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        id: "mission-bottom-nav-container",
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4,
          isolation: "isolate",
          transform: "translateZ(0)",
          willChange: "transform",
          display: "block",
          visibility: "visible",
          opacity: 1
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

// src/slot.tsx
var SLOTTABLE_IDENTIFIER$1 = Symbol("radix.slottable");
// @__NO_SIDE_EFFECTS__
function createSlottable(ownerName) {
  const Slottable2 = ({ children }) => {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
  };
  Slottable2.displayName = `${ownerName}.Slottable`;
  Slottable2.__radixId = SLOTTABLE_IDENTIFIER$1;
  return Slottable2;
}

var ROOT_NAME = "AlertDialog";
var [createAlertDialogContext] = createContextScope$2(ROOT_NAME, [
  createDialogScope
]);
var useDialogScope = createDialogScope();
var AlertDialog$1 = (props) => {
  const { __scopeAlertDialog, ...alertDialogProps } = props;
  const dialogScope = useDialogScope(__scopeAlertDialog);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Root$3, { ...dialogScope, ...alertDialogProps, modal: true });
};
AlertDialog$1.displayName = ROOT_NAME;
var TRIGGER_NAME$2 = "AlertDialogTrigger";
var AlertDialogTrigger$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...triggerProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Trigger$1, { ...dialogScope, ...triggerProps, ref: forwardedRef });
  }
);
AlertDialogTrigger$1.displayName = TRIGGER_NAME$2;
var PORTAL_NAME$1 = "AlertDialogPortal";
var AlertDialogPortal$1 = (props) => {
  const { __scopeAlertDialog, ...portalProps } = props;
  const dialogScope = useDialogScope(__scopeAlertDialog);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Portal$1, { ...dialogScope, ...portalProps });
};
AlertDialogPortal$1.displayName = PORTAL_NAME$1;
var OVERLAY_NAME = "AlertDialogOverlay";
var AlertDialogOverlay$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...overlayProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Overlay, { ...dialogScope, ...overlayProps, ref: forwardedRef });
  }
);
AlertDialogOverlay$1.displayName = OVERLAY_NAME;
var CONTENT_NAME$1 = "AlertDialogContent";
var [AlertDialogContentProvider, useAlertDialogContentContext] = createAlertDialogContext(CONTENT_NAME$1);
var Slottable = createSlottable("AlertDialogContent");
var AlertDialogContent$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, children, ...contentProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    const contentRef = reactExports.useRef(null);
    const composedRefs = useComposedRefs(forwardedRef, contentRef);
    const cancelRef = reactExports.useRef(null);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      WarningProvider,
      {
        contentName: CONTENT_NAME$1,
        titleName: TITLE_NAME,
        docsSlug: "alert-dialog",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogContentProvider, { scope: __scopeAlertDialog, cancelRef, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Content,
          {
            role: "alertdialog",
            ...dialogScope,
            ...contentProps,
            ref: composedRefs,
            onOpenAutoFocus: composeEventHandlers(contentProps.onOpenAutoFocus, (event) => {
              event.preventDefault();
              cancelRef.current?.focus({ preventScroll: true });
            }),
            onPointerDownOutside: (event) => event.preventDefault(),
            onInteractOutside: (event) => event.preventDefault(),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Slottable, { children }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(DescriptionWarning, { contentRef })
            ]
          }
        ) })
      }
    );
  }
);
AlertDialogContent$1.displayName = CONTENT_NAME$1;
var TITLE_NAME = "AlertDialogTitle";
var AlertDialogTitle$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...titleProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Title, { ...dialogScope, ...titleProps, ref: forwardedRef });
  }
);
AlertDialogTitle$1.displayName = TITLE_NAME;
var DESCRIPTION_NAME = "AlertDialogDescription";
var AlertDialogDescription$1 = reactExports.forwardRef((props, forwardedRef) => {
  const { __scopeAlertDialog, ...descriptionProps } = props;
  const dialogScope = useDialogScope(__scopeAlertDialog);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Description, { ...dialogScope, ...descriptionProps, ref: forwardedRef });
});
AlertDialogDescription$1.displayName = DESCRIPTION_NAME;
var ACTION_NAME = "AlertDialogAction";
var AlertDialogAction$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...actionProps } = props;
    const dialogScope = useDialogScope(__scopeAlertDialog);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Close, { ...dialogScope, ...actionProps, ref: forwardedRef });
  }
);
AlertDialogAction$1.displayName = ACTION_NAME;
var CANCEL_NAME = "AlertDialogCancel";
var AlertDialogCancel$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeAlertDialog, ...cancelProps } = props;
    const { cancelRef } = useAlertDialogContentContext(CANCEL_NAME, __scopeAlertDialog);
    const dialogScope = useDialogScope(__scopeAlertDialog);
    const ref = useComposedRefs(forwardedRef, cancelRef);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Close, { ...dialogScope, ...cancelProps, ref });
  }
);
AlertDialogCancel$1.displayName = CANCEL_NAME;
var DescriptionWarning = ({ contentRef }) => {
  const MESSAGE = `\`${CONTENT_NAME$1}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${CONTENT_NAME$1}\` by passing a \`${DESCRIPTION_NAME}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${CONTENT_NAME$1}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;
  reactExports.useEffect(() => {
    const hasDescription = document.getElementById(
      contentRef.current?.getAttribute("aria-describedby")
    );
    if (!hasDescription) console.warn(MESSAGE);
  }, [MESSAGE, contentRef]);
  return null;
};
var Root2$2 = AlertDialog$1;
var Trigger2 = AlertDialogTrigger$1;
var Portal2 = AlertDialogPortal$1;
var Overlay2 = AlertDialogOverlay$1;
var Content2$1 = AlertDialogContent$1;
var Action = AlertDialogAction$1;
var Cancel = AlertDialogCancel$1;
var Title2 = AlertDialogTitle$1;
var Description2 = AlertDialogDescription$1;

const AlertDialog = Root2$2;
const AlertDialogTrigger = Trigger2;
const AlertDialogPortal = Portal2;
const AlertDialogOverlay = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Overlay2,
  {
    className: cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    ),
    ...props,
    ref
  }
));
AlertDialogOverlay.displayName = Overlay2.displayName;
const AlertDialogContent = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogPortal, { children: [
  /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogOverlay, {}),
  /* @__PURE__ */ jsxRuntimeExports.jsx(
    Content2$1,
    {
      ref,
      className: cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      ),
      ...props
    }
  )
] }));
AlertDialogContent.displayName = Content2$1.displayName;
const AlertDialogHeader = ({
  className,
  ...props
}) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    ),
    ...props
  }
);
AlertDialogHeader.displayName = "AlertDialogHeader";
const AlertDialogFooter = ({
  className,
  ...props
}) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    className: cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    ),
    ...props
  }
);
AlertDialogFooter.displayName = "AlertDialogFooter";
const AlertDialogTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Title2,
  {
    ref,
    className: cn("text-lg font-semibold", className),
    ...props
  }
));
AlertDialogTitle.displayName = Title2.displayName;
const AlertDialogDescription = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Description2,
  {
    ref,
    className: cn("text-sm text-muted-foreground", className),
    ...props
  }
));
AlertDialogDescription.displayName = Description2.displayName;
const AlertDialogAction = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Action,
  {
    ref,
    className: cn(buttonVariants(), className),
    ...props
  }
));
AlertDialogAction.displayName = Action.displayName;
const AlertDialogCancel = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Cancel,
  {
    ref,
    className: cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    ),
    ...props
  }
));
AlertDialogCancel.displayName = Cancel.displayName;

const SecuritySettings = () => {
  const { user} = useAuth();
  const { toast } = useToast();
  useWouterNavigation();
  const { profileImage } = useProfileImage();
  const [loading, setLoading] = reactExports.useState(false);
  const [showPasswords, setShowPasswords] = reactExports.useState(false);
  const [passwords, setPasswords] = reactExports.useState({
    current: "",
    new: "",
    confirm: ""
  });
  const [recoveryKey, setRecoveryKey] = reactExports.useState(null);
  const generateRecoveryKey = () => {
    const key = Array.from(
      { length: 12 },
      () => Math.random().toString(36).substring(2, 6)
    ).join("-").toUpperCase();
    setRecoveryKey(key);
    saveRecoveryKey(key);
  };
  const saveRecoveryKey = async (key) => {
    if (!user) return;
    try {
      const hashedKey = btoa(key);
      await supabase.from("profiles").update({
        recovery_key: hashedKey
      }).eq("id", user.id);
      toast({
        title: "✅ Codice di emergenza generato",
        description: "Salva questo codice in un luogo sicuro. Non potrà essere visualizzato nuovamente."
      });
    } catch (error) {
      console.error("Recovery key save error:", error);
    }
  };
  const handlePasswordChange = async () => {
    if (!passwords.current || !passwords.new || !passwords.confirm) {
      toast({
        title: "❌ Campi obbligatori",
        description: "Compila tutti i campi per cambiare la password.",
        variant: "destructive"
      });
      return;
    }
    if (passwords.new !== passwords.confirm) {
      toast({
        title: "❌ Password non corrispondenti",
        description: "La nuova password e la conferma devono essere identiche.",
        variant: "destructive"
      });
      return;
    }
    if (passwords.new.length < 6) {
      toast({
        title: "❌ Password troppo corta",
        description: "La password deve contenere almeno 6 caratteri.",
        variant: "destructive"
      });
      return;
    }
    setLoading(true);
    try {
      const { error } = await supabase.auth.updateUser({
        password: passwords.new
      });
      if (error) throw error;
      setPasswords({ current: "", new: "", confirm: "" });
      toast({
        title: "✅ Password aggiornata",
        description: "La tua password è stata modificata con successo."
      });
    } catch (error) {
      console.error("Password change error:", error);
      toast({
        title: "❌ Errore cambio password",
        description: error.message || "Impossibile aggiornare la password. Riprova.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const handleSignOutAllDevices = async () => {
    setLoading(true);
    try {
      const { error } = await supabase.auth.signOut({ scope: "global" });
      if (error) throw error;
      localStorage.clear();
      toast({
        title: "✅ Disconnesso da tutti i dispositivi",
        description: "Tutte le sessioni sono state invalidate."
      });
      window.location.href = "/login";
    } catch (error) {
      console.error("Sign out all devices error:", error);
      toast({
        title: "❌ Errore disconnessione",
        description: "Impossibile disconnettere tutti i dispositivi. Riprova.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage: profileImage || user?.user_metadata?.avatar_url }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "px-4 space-y-6",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            exit: { opacity: 0, y: -20 },
            transition: { duration: 0.3 },
            className: "space-y-6",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white font-orbitron", children: "Sicurezza" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci la sicurezza del tuo account" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 mr-2" }),
                  "Cambio Password"
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "currentPassword", className: "text-white", children: "Password Attuale" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Input,
                        {
                          id: "currentPassword",
                          type: showPasswords ? "text" : "password",
                          value: passwords.current,
                          onChange: (e) => setPasswords((prev) => ({ ...prev, current: e.target.value })),
                          className: "bg-black/20 border-white/20 text-white pr-10",
                          placeholder: "Inserisci password attuale"
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Button,
                        {
                          type: "button",
                          variant: "ghost",
                          size: "icon",
                          className: "absolute right-2 top-1/2 -translate-y-1/2 text-white/50 hover:text-white",
                          onClick: () => setShowPasswords(!showPasswords),
                          children: showPasswords ? /* @__PURE__ */ jsxRuntimeExports.jsx(EyeOff, { className: "w-4 h-4" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-4 h-4" })
                        }
                      )
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "newPassword", className: "text-white", children: "Nuova Password" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Input,
                      {
                        id: "newPassword",
                        type: showPasswords ? "text" : "password",
                        value: passwords.new,
                        onChange: (e) => setPasswords((prev) => ({ ...prev, new: e.target.value })),
                        className: "bg-black/20 border-white/20 text-white",
                        placeholder: "Inserisci nuova password"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "confirmPassword", className: "text-white", children: "Conferma Password" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Input,
                      {
                        id: "confirmPassword",
                        type: showPasswords ? "text" : "password",
                        value: passwords.confirm,
                        onChange: (e) => setPasswords((prev) => ({ ...prev, confirm: e.target.value })),
                        className: "bg-black/20 border-white/20 text-white",
                        placeholder: "Conferma nuova password"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: handlePasswordChange,
                      disabled: loading,
                      className: "w-full bg-[#00D1FF] hover:bg-[#00B8E6] text-black font-semibold",
                      children: loading ? "Aggiornamento..." : "Cambia Password"
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Key, { className: "w-5 h-5 mr-2" }),
                  "Codice di Emergenza"
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Genera un codice di emergenza per recuperare l'accesso al tuo account." }),
                  recoveryKey && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 bg-red-900/20 border border-red-500/20 rounded-lg", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-400 text-sm font-semibold mb-2", children: "⚠️ IMPORTANTE: Salva questo codice ora!" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-white font-mono bg-black/40 p-2 rounded block text-center", children: recoveryKey }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300 text-xs mt-2", children: "Questo codice non sarà più visibile dopo aver chiuso questa schermata." })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: generateRecoveryKey,
                      variant: "outline",
                      className: "w-full border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/10",
                      children: recoveryKey ? "Genera Nuovo Codice" : "Genera Codice di Emergenza"
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-red-500/20 backdrop-blur-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(LogOut, { className: "w-5 h-5 mr-2" }),
                  "Gestione Sessioni"
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Disconnetti il tuo account da tutti i dispositivi e invalidare tutte le sessioni attive." }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialog, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTrigger, { asChild: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Button,
                      {
                        variant: "destructive",
                        className: "w-full bg-red-600 hover:bg-red-700",
                        disabled: loading,
                        children: "Disconnetti da Tutti i Dispositivi"
                      }
                    ) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogContent, { className: "bg-black/90 border-red-500/20", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogHeader, { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTitle, { className: "text-white", children: "Conferma Disconnessione" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogDescription, { className: "text-white/70", children: "Questa azione disconnetterà il tuo account da tutti i dispositivi. Dovrai effettuare nuovamente il login ovunque." })
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogFooter, { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogCancel, { className: "bg-white/10 text-white border-white/20", children: "Annulla" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(
                          AlertDialogAction,
                          {
                            onClick: handleSignOutAllDevices,
                            className: "bg-red-600 hover:bg-red-700",
                            children: "Conferma Disconnessione"
                          }
                        )
                      ] })
                    ] })
                  ] })
                ] })
              ] })
            ]
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        id: "settings-bottom-nav-container",
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4,
          isolation: "isolate",
          transform: "translateZ(0)",
          willChange: "transform",
          display: "block",
          visibility: "visible",
          opacity: 1
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

const STORAGE_KEY$1 = "m1_battle_fx_performance_mode";
const DEFAULT_MODE = "high";
function usePerformanceSettings() {
  const { user, isAuthenticated } = useUnifiedAuth();
  const [battleFxMode, setBattleFxModeState] = reactExports.useState(DEFAULT_MODE);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    const loadSettings = async () => {
      try {
        const savedModeLocal = localStorage.getItem(STORAGE_KEY$1);
        if (savedModeLocal === "high" || savedModeLocal === "low") {
          setBattleFxModeState(savedModeLocal);
        }
        if (isAuthenticated && user?.id) {
          const { data, error } = await supabase.from("user_settings").select("preferences").eq("user_id", user.id).maybeSingle();
          if (error && (error.code === "406" || error.code === "PGRST116" || error.code === "42P01")) {
            console.debug("[PerformanceSettings] user_settings table not available, using localStorage");
            return;
          }
          if (!error && data) {
            const settingsData = data;
            const prefs = settingsData?.preferences;
            const savedMode = prefs?.battle?.fxMode;
            if (savedMode === "high" || savedMode === "low") {
              setBattleFxModeState(savedMode);
              console.log("[PerformanceSettings] Loaded from DB:", savedMode);
            }
          }
        }
      } catch (e) {
        console.debug("[PerformanceSettings] Load error (non-critical):", e);
      } finally {
        setIsLoading(false);
      }
    };
    loadSettings();
  }, [isAuthenticated, user?.id]);
  reactExports.useEffect(() => {
    if (!isAuthenticated || !user?.id) return;
    const handleSettingsSync = (event) => {
      try {
        const detail = event.detail;
        if (detail?.preferences?.battle?.fxMode) {
          const mode = detail.preferences.battle.fxMode;
          if (mode === "high" || mode === "low") {
            setBattleFxModeState(mode);
            console.log("[PerformanceSettings] Synced from realtime:", mode);
          }
        }
      } catch (e) {
        console.warn("[PerformanceSettings] Sync error:", e);
      }
    };
    window.addEventListener("settings-sync", handleSettingsSync);
    return () => {
      window.removeEventListener("settings-sync", handleSettingsSync);
    };
  }, [isAuthenticated, user?.id]);
  const setBattleFxMode = reactExports.useCallback(async (mode) => {
    try {
      setBattleFxModeState(mode);
      if (isAuthenticated && user?.id) {
        const { data: existing } = await supabase.from("user_settings").select("preferences").eq("user_id", user.id).single();
        const existingData = existing;
        const currentPrefs = existingData?.preferences || {};
        const updatedPrefs = {
          ...currentPrefs,
          battle: {
            ...currentPrefs.battle || {},
            fxMode: mode
          }
        };
        const { error } = await supabase.from("user_settings").upsert({
          user_id: user.id,
          preferences: updatedPrefs
        });
        if (error) throw error;
        console.log("[PerformanceSettings] Saved to DB:", mode);
      } else {
        localStorage.setItem(STORAGE_KEY$1, mode);
        console.log("[PerformanceSettings] Saved to localStorage:", mode);
      }
    } catch (e) {
      console.error("[PerformanceSettings] Save error:", e);
      localStorage.setItem(STORAGE_KEY$1, mode);
    }
  }, [isAuthenticated, user?.id]);
  return {
    battleFxMode,
    setBattleFxMode,
    isBattleFxEnabled: true,
    // Always enabled, just different quality levels
    isLoading
  };
}

// packages/core/number/src/number.ts
function clamp(value, [min, max]) {
  return Math.min(max, Math.max(min, value));
}

// src/slot.tsx
// @__NO_SIDE_EFFECTS__
function createSlot(ownerName) {
  const SlotClone = /* @__PURE__ */ createSlotClone(ownerName);
  const Slot2 = reactExports.forwardRef((props, forwardedRef) => {
    const { children, ...slotProps } = props;
    const childrenArray = reactExports.Children.toArray(children);
    const slottable = childrenArray.find(isSlottable);
    if (slottable) {
      const newElement = slottable.props.children;
      const newChildren = childrenArray.map((child) => {
        if (child === slottable) {
          if (reactExports.Children.count(newElement) > 1) return reactExports.Children.only(null);
          return reactExports.isValidElement(newElement) ? newElement.props.children : null;
        } else {
          return child;
        }
      });
      return /* @__PURE__ */ jsxRuntimeExports.jsx(SlotClone, { ...slotProps, ref: forwardedRef, children: reactExports.isValidElement(newElement) ? reactExports.cloneElement(newElement, void 0, newChildren) : null });
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SlotClone, { ...slotProps, ref: forwardedRef, children });
  });
  Slot2.displayName = `${ownerName}.Slot`;
  return Slot2;
}
// @__NO_SIDE_EFFECTS__
function createSlotClone(ownerName) {
  const SlotClone = reactExports.forwardRef((props, forwardedRef) => {
    const { children, ...slotProps } = props;
    if (reactExports.isValidElement(children)) {
      const childrenRef = getElementRef(children);
      const props2 = mergeProps(slotProps, children.props);
      if (children.type !== reactExports.Fragment) {
        props2.ref = forwardedRef ? composeRefs(forwardedRef, childrenRef) : childrenRef;
      }
      return reactExports.cloneElement(children, props2);
    }
    return reactExports.Children.count(children) > 1 ? reactExports.Children.only(null) : null;
  });
  SlotClone.displayName = `${ownerName}.SlotClone`;
  return SlotClone;
}
var SLOTTABLE_IDENTIFIER = Symbol("radix.slottable");
function isSlottable(child) {
  return reactExports.isValidElement(child) && typeof child.type === "function" && "__radixId" in child.type && child.type.__radixId === SLOTTABLE_IDENTIFIER;
}
function mergeProps(slotProps, childProps) {
  const overrideProps = { ...childProps };
  for (const propName in childProps) {
    const slotPropValue = slotProps[propName];
    const childPropValue = childProps[propName];
    const isHandler = /^on[A-Z]/.test(propName);
    if (isHandler) {
      if (slotPropValue && childPropValue) {
        overrideProps[propName] = (...args) => {
          const result = childPropValue(...args);
          slotPropValue(...args);
          return result;
        };
      } else if (slotPropValue) {
        overrideProps[propName] = slotPropValue;
      }
    } else if (propName === "style") {
      overrideProps[propName] = { ...slotPropValue, ...childPropValue };
    } else if (propName === "className") {
      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(" ");
    }
  }
  return { ...slotProps, ...overrideProps };
}
function getElementRef(element) {
  let getter = Object.getOwnPropertyDescriptor(element.props, "ref")?.get;
  let mayWarn = getter && "isReactWarning" in getter && getter.isReactWarning;
  if (mayWarn) {
    return element.ref;
  }
  getter = Object.getOwnPropertyDescriptor(element, "ref")?.get;
  mayWarn = getter && "isReactWarning" in getter && getter.isReactWarning;
  if (mayWarn) {
    return element.props.ref;
  }
  return element.props.ref || element.ref;
}

// packages/react/use-previous/src/use-previous.tsx
function usePrevious(value) {
  const ref = reactExports.useRef({ value, previous: value });
  return reactExports.useMemo(() => {
    if (ref.current.value !== value) {
      ref.current.previous = ref.current.value;
      ref.current.value = value;
    }
    return ref.current.previous;
  }, [value]);
}

var OPEN_KEYS = [" ", "Enter", "ArrowUp", "ArrowDown"];
var SELECTION_KEYS = [" ", "Enter"];
var SELECT_NAME = "Select";
var [Collection, useCollection, createCollectionScope] = createCollection(SELECT_NAME);
var [createSelectContext] = createContextScope$2(SELECT_NAME, [
  createCollectionScope,
  createPopperScope
]);
var usePopperScope = createPopperScope();
var [SelectProvider, useSelectContext] = createSelectContext(SELECT_NAME);
var [SelectNativeOptionsProvider, useSelectNativeOptionsContext] = createSelectContext(SELECT_NAME);
var Select$1 = (props) => {
  const {
    __scopeSelect,
    children,
    open: openProp,
    defaultOpen,
    onOpenChange,
    value: valueProp,
    defaultValue,
    onValueChange,
    dir,
    name,
    autoComplete,
    disabled,
    required,
    form
  } = props;
  const popperScope = usePopperScope(__scopeSelect);
  const [trigger, setTrigger] = reactExports.useState(null);
  const [valueNode, setValueNode] = reactExports.useState(null);
  const [valueNodeHasChildren, setValueNodeHasChildren] = reactExports.useState(false);
  const direction = useDirection(dir);
  const [open, setOpen] = useControllableState({
    prop: openProp,
    defaultProp: defaultOpen ?? false,
    onChange: onOpenChange,
    caller: SELECT_NAME
  });
  const [value, setValue] = useControllableState({
    prop: valueProp,
    defaultProp: defaultValue,
    onChange: onValueChange,
    caller: SELECT_NAME
  });
  const triggerPointerDownPosRef = reactExports.useRef(null);
  const isFormControl = trigger ? form || !!trigger.closest("form") : true;
  const [nativeOptionsSet, setNativeOptionsSet] = reactExports.useState(/* @__PURE__ */ new Set());
  const nativeSelectKey = Array.from(nativeOptionsSet).map((option) => option.props.value).join(";");
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Root2$3, { ...popperScope, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    SelectProvider,
    {
      required,
      scope: __scopeSelect,
      trigger,
      onTriggerChange: setTrigger,
      valueNode,
      onValueNodeChange: setValueNode,
      valueNodeHasChildren,
      onValueNodeHasChildrenChange: setValueNodeHasChildren,
      contentId: useId(),
      value,
      onValueChange: setValue,
      open,
      onOpenChange: setOpen,
      dir: direction,
      triggerPointerDownPosRef,
      disabled,
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Collection.Provider, { scope: __scopeSelect, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          SelectNativeOptionsProvider,
          {
            scope: props.__scopeSelect,
            onNativeOptionAdd: reactExports.useCallback((option) => {
              setNativeOptionsSet((prev) => new Set(prev).add(option));
            }, []),
            onNativeOptionRemove: reactExports.useCallback((option) => {
              setNativeOptionsSet((prev) => {
                const optionsSet = new Set(prev);
                optionsSet.delete(option);
                return optionsSet;
              });
            }, []),
            children
          }
        ) }),
        isFormControl ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
          SelectBubbleInput,
          {
            "aria-hidden": true,
            required,
            tabIndex: -1,
            name,
            autoComplete,
            value,
            onChange: (event) => setValue(event.target.value),
            disabled,
            form,
            children: [
              value === void 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: "" }) : null,
              Array.from(nativeOptionsSet)
            ]
          },
          nativeSelectKey
        ) : null
      ]
    }
  ) });
};
Select$1.displayName = SELECT_NAME;
var TRIGGER_NAME$1 = "SelectTrigger";
var SelectTrigger$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, disabled = false, ...triggerProps } = props;
    const popperScope = usePopperScope(__scopeSelect);
    const context = useSelectContext(TRIGGER_NAME$1, __scopeSelect);
    const isDisabled = context.disabled || disabled;
    const composedRefs = useComposedRefs(forwardedRef, context.onTriggerChange);
    const getItems = useCollection(__scopeSelect);
    const pointerTypeRef = reactExports.useRef("touch");
    const [searchRef, handleTypeaheadSearch, resetTypeahead] = useTypeaheadSearch((search) => {
      const enabledItems = getItems().filter((item) => !item.disabled);
      const currentItem = enabledItems.find((item) => item.value === context.value);
      const nextItem = findNextItem(enabledItems, search, currentItem);
      if (nextItem !== void 0) {
        context.onValueChange(nextItem.value);
      }
    });
    const handleOpen = (pointerEvent) => {
      if (!isDisabled) {
        context.onOpenChange(true);
        resetTypeahead();
      }
      if (pointerEvent) {
        context.triggerPointerDownPosRef.current = {
          x: Math.round(pointerEvent.pageX),
          y: Math.round(pointerEvent.pageY)
        };
      }
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Anchor, { asChild: true, ...popperScope, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.button,
      {
        type: "button",
        role: "combobox",
        "aria-controls": context.contentId,
        "aria-expanded": context.open,
        "aria-required": context.required,
        "aria-autocomplete": "none",
        dir: context.dir,
        "data-state": context.open ? "open" : "closed",
        disabled: isDisabled,
        "data-disabled": isDisabled ? "" : void 0,
        "data-placeholder": shouldShowPlaceholder(context.value) ? "" : void 0,
        ...triggerProps,
        ref: composedRefs,
        onClick: composeEventHandlers(triggerProps.onClick, (event) => {
          event.currentTarget.focus();
          if (pointerTypeRef.current !== "mouse") {
            handleOpen(event);
          }
        }),
        onPointerDown: composeEventHandlers(triggerProps.onPointerDown, (event) => {
          pointerTypeRef.current = event.pointerType;
          const target = event.target;
          if (target.hasPointerCapture(event.pointerId)) {
            target.releasePointerCapture(event.pointerId);
          }
          if (event.button === 0 && event.ctrlKey === false && event.pointerType === "mouse") {
            handleOpen(event);
            event.preventDefault();
          }
        }),
        onKeyDown: composeEventHandlers(triggerProps.onKeyDown, (event) => {
          const isTypingAhead = searchRef.current !== "";
          const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;
          if (!isModifierKey && event.key.length === 1) handleTypeaheadSearch(event.key);
          if (isTypingAhead && event.key === " ") return;
          if (OPEN_KEYS.includes(event.key)) {
            handleOpen();
            event.preventDefault();
          }
        })
      }
    ) });
  }
);
SelectTrigger$1.displayName = TRIGGER_NAME$1;
var VALUE_NAME = "SelectValue";
var SelectValue$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, className, style, children, placeholder = "", ...valueProps } = props;
    const context = useSelectContext(VALUE_NAME, __scopeSelect);
    const { onValueNodeHasChildrenChange } = context;
    const hasChildren = children !== void 0;
    const composedRefs = useComposedRefs(forwardedRef, context.onValueNodeChange);
    useLayoutEffect2(() => {
      onValueNodeHasChildrenChange(hasChildren);
    }, [onValueNodeHasChildrenChange, hasChildren]);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.span,
      {
        ...valueProps,
        ref: composedRefs,
        style: { pointerEvents: "none" },
        children: shouldShowPlaceholder(context.value) ? /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children: placeholder }) : children
      }
    );
  }
);
SelectValue$1.displayName = VALUE_NAME;
var ICON_NAME = "SelectIcon";
var SelectIcon = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, children, ...iconProps } = props;
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.span, { "aria-hidden": true, ...iconProps, ref: forwardedRef, children: children || "\u25BC" });
  }
);
SelectIcon.displayName = ICON_NAME;
var PORTAL_NAME = "SelectPortal";
var SelectPortal = (props) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Portal$2, { asChild: true, ...props });
};
SelectPortal.displayName = PORTAL_NAME;
var CONTENT_NAME = "SelectContent";
var SelectContent$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const context = useSelectContext(CONTENT_NAME, props.__scopeSelect);
    const [fragment, setFragment] = reactExports.useState();
    useLayoutEffect2(() => {
      setFragment(new DocumentFragment());
    }, []);
    if (!context.open) {
      const frag = fragment;
      return frag ? reactDomExports.createPortal(
        /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContentProvider, { scope: props.__scopeSelect, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Collection.Slot, { scope: props.__scopeSelect, children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: props.children }) }) }),
        frag
      ) : null;
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContentImpl, { ...props, ref: forwardedRef });
  }
);
SelectContent$1.displayName = CONTENT_NAME;
var CONTENT_MARGIN = 10;
var [SelectContentProvider, useSelectContentContext] = createSelectContext(CONTENT_NAME);
var CONTENT_IMPL_NAME = "SelectContentImpl";
var Slot = createSlot("SelectContent.RemoveScroll");
var SelectContentImpl = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeSelect,
      position = "item-aligned",
      onCloseAutoFocus,
      onEscapeKeyDown,
      onPointerDownOutside,
      //
      // PopperContent props
      side,
      sideOffset,
      align,
      alignOffset,
      arrowPadding,
      collisionBoundary,
      collisionPadding,
      sticky,
      hideWhenDetached,
      avoidCollisions,
      //
      ...contentProps
    } = props;
    const context = useSelectContext(CONTENT_NAME, __scopeSelect);
    const [content, setContent] = reactExports.useState(null);
    const [viewport, setViewport] = reactExports.useState(null);
    const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));
    const [selectedItem, setSelectedItem] = reactExports.useState(null);
    const [selectedItemText, setSelectedItemText] = reactExports.useState(
      null
    );
    const getItems = useCollection(__scopeSelect);
    const [isPositioned, setIsPositioned] = reactExports.useState(false);
    const firstValidItemFoundRef = reactExports.useRef(false);
    reactExports.useEffect(() => {
      if (content) return hideOthers(content);
    }, [content]);
    useFocusGuards();
    const focusFirst = reactExports.useCallback(
      (candidates) => {
        const [firstItem, ...restItems] = getItems().map((item) => item.ref.current);
        const [lastItem] = restItems.slice(-1);
        const PREVIOUSLY_FOCUSED_ELEMENT = document.activeElement;
        for (const candidate of candidates) {
          if (candidate === PREVIOUSLY_FOCUSED_ELEMENT) return;
          candidate?.scrollIntoView({ block: "nearest" });
          if (candidate === firstItem && viewport) viewport.scrollTop = 0;
          if (candidate === lastItem && viewport) viewport.scrollTop = viewport.scrollHeight;
          candidate?.focus();
          if (document.activeElement !== PREVIOUSLY_FOCUSED_ELEMENT) return;
        }
      },
      [getItems, viewport]
    );
    const focusSelectedItem = reactExports.useCallback(
      () => focusFirst([selectedItem, content]),
      [focusFirst, selectedItem, content]
    );
    reactExports.useEffect(() => {
      if (isPositioned) {
        focusSelectedItem();
      }
    }, [isPositioned, focusSelectedItem]);
    const { onOpenChange, triggerPointerDownPosRef } = context;
    reactExports.useEffect(() => {
      if (content) {
        let pointerMoveDelta = { x: 0, y: 0 };
        const handlePointerMove = (event) => {
          pointerMoveDelta = {
            x: Math.abs(Math.round(event.pageX) - (triggerPointerDownPosRef.current?.x ?? 0)),
            y: Math.abs(Math.round(event.pageY) - (triggerPointerDownPosRef.current?.y ?? 0))
          };
        };
        const handlePointerUp = (event) => {
          if (pointerMoveDelta.x <= 10 && pointerMoveDelta.y <= 10) {
            event.preventDefault();
          } else {
            if (!content.contains(event.target)) {
              onOpenChange(false);
            }
          }
          document.removeEventListener("pointermove", handlePointerMove);
          triggerPointerDownPosRef.current = null;
        };
        if (triggerPointerDownPosRef.current !== null) {
          document.addEventListener("pointermove", handlePointerMove);
          document.addEventListener("pointerup", handlePointerUp, { capture: true, once: true });
        }
        return () => {
          document.removeEventListener("pointermove", handlePointerMove);
          document.removeEventListener("pointerup", handlePointerUp, { capture: true });
        };
      }
    }, [content, onOpenChange, triggerPointerDownPosRef]);
    reactExports.useEffect(() => {
      const close = () => onOpenChange(false);
      window.addEventListener("blur", close);
      window.addEventListener("resize", close);
      return () => {
        window.removeEventListener("blur", close);
        window.removeEventListener("resize", close);
      };
    }, [onOpenChange]);
    const [searchRef, handleTypeaheadSearch] = useTypeaheadSearch((search) => {
      const enabledItems = getItems().filter((item) => !item.disabled);
      const currentItem = enabledItems.find((item) => item.ref.current === document.activeElement);
      const nextItem = findNextItem(enabledItems, search, currentItem);
      if (nextItem) {
        setTimeout(() => nextItem.ref.current.focus());
      }
    });
    const itemRefCallback = reactExports.useCallback(
      (node, value, disabled) => {
        const isFirstValidItem = !firstValidItemFoundRef.current && !disabled;
        const isSelectedItem = context.value !== void 0 && context.value === value;
        if (isSelectedItem || isFirstValidItem) {
          setSelectedItem(node);
          if (isFirstValidItem) firstValidItemFoundRef.current = true;
        }
      },
      [context.value]
    );
    const handleItemLeave = reactExports.useCallback(() => content?.focus(), [content]);
    const itemTextRefCallback = reactExports.useCallback(
      (node, value, disabled) => {
        const isFirstValidItem = !firstValidItemFoundRef.current && !disabled;
        const isSelectedItem = context.value !== void 0 && context.value === value;
        if (isSelectedItem || isFirstValidItem) {
          setSelectedItemText(node);
        }
      },
      [context.value]
    );
    const SelectPosition = position === "popper" ? SelectPopperPosition : SelectItemAlignedPosition;
    const popperContentProps = SelectPosition === SelectPopperPosition ? {
      side,
      sideOffset,
      align,
      alignOffset,
      arrowPadding,
      collisionBoundary,
      collisionPadding,
      sticky,
      hideWhenDetached,
      avoidCollisions
    } : {};
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      SelectContentProvider,
      {
        scope: __scopeSelect,
        content,
        viewport,
        onViewportChange: setViewport,
        itemRefCallback,
        selectedItem,
        onItemLeave: handleItemLeave,
        itemTextRefCallback,
        focusSelectedItem,
        selectedItemText,
        position,
        isPositioned,
        searchRef,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(ReactRemoveScroll, { as: Slot, allowPinchZoom: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          FocusScope,
          {
            asChild: true,
            trapped: context.open,
            onMountAutoFocus: (event) => {
              event.preventDefault();
            },
            onUnmountAutoFocus: composeEventHandlers(onCloseAutoFocus, (event) => {
              context.trigger?.focus({ preventScroll: true });
              event.preventDefault();
            }),
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              DismissableLayer,
              {
                asChild: true,
                disableOutsidePointerEvents: true,
                onEscapeKeyDown,
                onPointerDownOutside,
                onFocusOutside: (event) => event.preventDefault(),
                onDismiss: () => context.onOpenChange(false),
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  SelectPosition,
                  {
                    role: "listbox",
                    id: context.contentId,
                    "data-state": context.open ? "open" : "closed",
                    dir: context.dir,
                    onContextMenu: (event) => event.preventDefault(),
                    ...contentProps,
                    ...popperContentProps,
                    onPlaced: () => setIsPositioned(true),
                    ref: composedRefs,
                    style: {
                      // flex layout so we can place the scroll buttons properly
                      display: "flex",
                      flexDirection: "column",
                      // reset the outline by default as the content MAY get focused
                      outline: "none",
                      ...contentProps.style
                    },
                    onKeyDown: composeEventHandlers(contentProps.onKeyDown, (event) => {
                      const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;
                      if (event.key === "Tab") event.preventDefault();
                      if (!isModifierKey && event.key.length === 1) handleTypeaheadSearch(event.key);
                      if (["ArrowUp", "ArrowDown", "Home", "End"].includes(event.key)) {
                        const items = getItems().filter((item) => !item.disabled);
                        let candidateNodes = items.map((item) => item.ref.current);
                        if (["ArrowUp", "End"].includes(event.key)) {
                          candidateNodes = candidateNodes.slice().reverse();
                        }
                        if (["ArrowUp", "ArrowDown"].includes(event.key)) {
                          const currentElement = event.target;
                          const currentIndex = candidateNodes.indexOf(currentElement);
                          candidateNodes = candidateNodes.slice(currentIndex + 1);
                        }
                        setTimeout(() => focusFirst(candidateNodes));
                        event.preventDefault();
                      }
                    })
                  }
                )
              }
            )
          }
        ) })
      }
    );
  }
);
SelectContentImpl.displayName = CONTENT_IMPL_NAME;
var ITEM_ALIGNED_POSITION_NAME = "SelectItemAlignedPosition";
var SelectItemAlignedPosition = reactExports.forwardRef((props, forwardedRef) => {
  const { __scopeSelect, onPlaced, ...popperProps } = props;
  const context = useSelectContext(CONTENT_NAME, __scopeSelect);
  const contentContext = useSelectContentContext(CONTENT_NAME, __scopeSelect);
  const [contentWrapper, setContentWrapper] = reactExports.useState(null);
  const [content, setContent] = reactExports.useState(null);
  const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));
  const getItems = useCollection(__scopeSelect);
  const shouldExpandOnScrollRef = reactExports.useRef(false);
  const shouldRepositionRef = reactExports.useRef(true);
  const { viewport, selectedItem, selectedItemText, focusSelectedItem } = contentContext;
  const position = reactExports.useCallback(() => {
    if (context.trigger && context.valueNode && contentWrapper && content && viewport && selectedItem && selectedItemText) {
      const triggerRect = context.trigger.getBoundingClientRect();
      const contentRect = content.getBoundingClientRect();
      const valueNodeRect = context.valueNode.getBoundingClientRect();
      const itemTextRect = selectedItemText.getBoundingClientRect();
      if (context.dir !== "rtl") {
        const itemTextOffset = itemTextRect.left - contentRect.left;
        const left = valueNodeRect.left - itemTextOffset;
        const leftDelta = triggerRect.left - left;
        const minContentWidth = triggerRect.width + leftDelta;
        const contentWidth = Math.max(minContentWidth, contentRect.width);
        const rightEdge = window.innerWidth - CONTENT_MARGIN;
        const clampedLeft = clamp(left, [
          CONTENT_MARGIN,
          // Prevents the content from going off the starting edge of the
          // viewport. It may still go off the ending edge, but this can be
          // controlled by the user since they may want to manage overflow in a
          // specific way.
          // https://github.com/radix-ui/primitives/issues/2049
          Math.max(CONTENT_MARGIN, rightEdge - contentWidth)
        ]);
        contentWrapper.style.minWidth = minContentWidth + "px";
        contentWrapper.style.left = clampedLeft + "px";
      } else {
        const itemTextOffset = contentRect.right - itemTextRect.right;
        const right = window.innerWidth - valueNodeRect.right - itemTextOffset;
        const rightDelta = window.innerWidth - triggerRect.right - right;
        const minContentWidth = triggerRect.width + rightDelta;
        const contentWidth = Math.max(minContentWidth, contentRect.width);
        const leftEdge = window.innerWidth - CONTENT_MARGIN;
        const clampedRight = clamp(right, [
          CONTENT_MARGIN,
          Math.max(CONTENT_MARGIN, leftEdge - contentWidth)
        ]);
        contentWrapper.style.minWidth = minContentWidth + "px";
        contentWrapper.style.right = clampedRight + "px";
      }
      const items = getItems();
      const availableHeight = window.innerHeight - CONTENT_MARGIN * 2;
      const itemsHeight = viewport.scrollHeight;
      const contentStyles = window.getComputedStyle(content);
      const contentBorderTopWidth = parseInt(contentStyles.borderTopWidth, 10);
      const contentPaddingTop = parseInt(contentStyles.paddingTop, 10);
      const contentBorderBottomWidth = parseInt(contentStyles.borderBottomWidth, 10);
      const contentPaddingBottom = parseInt(contentStyles.paddingBottom, 10);
      const fullContentHeight = contentBorderTopWidth + contentPaddingTop + itemsHeight + contentPaddingBottom + contentBorderBottomWidth;
      const minContentHeight = Math.min(selectedItem.offsetHeight * 5, fullContentHeight);
      const viewportStyles = window.getComputedStyle(viewport);
      const viewportPaddingTop = parseInt(viewportStyles.paddingTop, 10);
      const viewportPaddingBottom = parseInt(viewportStyles.paddingBottom, 10);
      const topEdgeToTriggerMiddle = triggerRect.top + triggerRect.height / 2 - CONTENT_MARGIN;
      const triggerMiddleToBottomEdge = availableHeight - topEdgeToTriggerMiddle;
      const selectedItemHalfHeight = selectedItem.offsetHeight / 2;
      const itemOffsetMiddle = selectedItem.offsetTop + selectedItemHalfHeight;
      const contentTopToItemMiddle = contentBorderTopWidth + contentPaddingTop + itemOffsetMiddle;
      const itemMiddleToContentBottom = fullContentHeight - contentTopToItemMiddle;
      const willAlignWithoutTopOverflow = contentTopToItemMiddle <= topEdgeToTriggerMiddle;
      if (willAlignWithoutTopOverflow) {
        const isLastItem = items.length > 0 && selectedItem === items[items.length - 1].ref.current;
        contentWrapper.style.bottom = "0px";
        const viewportOffsetBottom = content.clientHeight - viewport.offsetTop - viewport.offsetHeight;
        const clampedTriggerMiddleToBottomEdge = Math.max(
          triggerMiddleToBottomEdge,
          selectedItemHalfHeight + // viewport might have padding bottom, include it to avoid a scrollable viewport
          (isLastItem ? viewportPaddingBottom : 0) + viewportOffsetBottom + contentBorderBottomWidth
        );
        const height = contentTopToItemMiddle + clampedTriggerMiddleToBottomEdge;
        contentWrapper.style.height = height + "px";
      } else {
        const isFirstItem = items.length > 0 && selectedItem === items[0].ref.current;
        contentWrapper.style.top = "0px";
        const clampedTopEdgeToTriggerMiddle = Math.max(
          topEdgeToTriggerMiddle,
          contentBorderTopWidth + viewport.offsetTop + // viewport might have padding top, include it to avoid a scrollable viewport
          (isFirstItem ? viewportPaddingTop : 0) + selectedItemHalfHeight
        );
        const height = clampedTopEdgeToTriggerMiddle + itemMiddleToContentBottom;
        contentWrapper.style.height = height + "px";
        viewport.scrollTop = contentTopToItemMiddle - topEdgeToTriggerMiddle + viewport.offsetTop;
      }
      contentWrapper.style.margin = `${CONTENT_MARGIN}px 0`;
      contentWrapper.style.minHeight = minContentHeight + "px";
      contentWrapper.style.maxHeight = availableHeight + "px";
      onPlaced?.();
      requestAnimationFrame(() => shouldExpandOnScrollRef.current = true);
    }
  }, [
    getItems,
    context.trigger,
    context.valueNode,
    contentWrapper,
    content,
    viewport,
    selectedItem,
    selectedItemText,
    context.dir,
    onPlaced
  ]);
  useLayoutEffect2(() => position(), [position]);
  const [contentZIndex, setContentZIndex] = reactExports.useState();
  useLayoutEffect2(() => {
    if (content) setContentZIndex(window.getComputedStyle(content).zIndex);
  }, [content]);
  const handleScrollButtonChange = reactExports.useCallback(
    (node) => {
      if (node && shouldRepositionRef.current === true) {
        position();
        focusSelectedItem?.();
        shouldRepositionRef.current = false;
      }
    },
    [position, focusSelectedItem]
  );
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    SelectViewportProvider,
    {
      scope: __scopeSelect,
      contentWrapper,
      shouldExpandOnScrollRef,
      onScrollButtonChange: handleScrollButtonChange,
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          ref: setContentWrapper,
          style: {
            display: "flex",
            flexDirection: "column",
            position: "fixed",
            zIndex: contentZIndex
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            Primitive$3.div,
            {
              ...popperProps,
              ref: composedRefs,
              style: {
                // When we get the height of the content, it includes borders. If we were to set
                // the height without having `boxSizing: 'border-box'` it would be too big.
                boxSizing: "border-box",
                // We need to ensure the content doesn't get taller than the wrapper
                maxHeight: "100%",
                ...popperProps.style
              }
            }
          )
        }
      )
    }
  );
});
SelectItemAlignedPosition.displayName = ITEM_ALIGNED_POSITION_NAME;
var POPPER_POSITION_NAME = "SelectPopperPosition";
var SelectPopperPosition = reactExports.forwardRef((props, forwardedRef) => {
  const {
    __scopeSelect,
    align = "start",
    collisionPadding = CONTENT_MARGIN,
    ...popperProps
  } = props;
  const popperScope = usePopperScope(__scopeSelect);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Content$1,
    {
      ...popperScope,
      ...popperProps,
      ref: forwardedRef,
      align,
      collisionPadding,
      style: {
        // Ensure border-box for floating-ui calculations
        boxSizing: "border-box",
        ...popperProps.style,
        // re-namespace exposed content custom properties
        ...{
          "--radix-select-content-transform-origin": "var(--radix-popper-transform-origin)",
          "--radix-select-content-available-width": "var(--radix-popper-available-width)",
          "--radix-select-content-available-height": "var(--radix-popper-available-height)",
          "--radix-select-trigger-width": "var(--radix-popper-anchor-width)",
          "--radix-select-trigger-height": "var(--radix-popper-anchor-height)"
        }
      }
    }
  );
});
SelectPopperPosition.displayName = POPPER_POSITION_NAME;
var [SelectViewportProvider, useSelectViewportContext] = createSelectContext(CONTENT_NAME, {});
var VIEWPORT_NAME = "SelectViewport";
var SelectViewport = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, nonce, ...viewportProps } = props;
    const contentContext = useSelectContentContext(VIEWPORT_NAME, __scopeSelect);
    const viewportContext = useSelectViewportContext(VIEWPORT_NAME, __scopeSelect);
    const composedRefs = useComposedRefs(forwardedRef, contentContext.onViewportChange);
    const prevScrollTopRef = reactExports.useRef(0);
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "style",
        {
          dangerouslySetInnerHTML: {
            __html: `[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}`
          },
          nonce
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Collection.Slot, { scope: __scopeSelect, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Primitive$3.div,
        {
          "data-radix-select-viewport": "",
          role: "presentation",
          ...viewportProps,
          ref: composedRefs,
          style: {
            // we use position: 'relative' here on the `viewport` so that when we call
            // `selectedItem.offsetTop` in calculations, the offset is relative to the viewport
            // (independent of the scrollUpButton).
            position: "relative",
            flex: 1,
            // Viewport should only be scrollable in the vertical direction.
            // This won't work in vertical writing modes, so we'll need to
            // revisit this if/when that is supported
            // https://developer.chrome.com/blog/vertical-form-controls
            overflow: "hidden auto",
            ...viewportProps.style
          },
          onScroll: composeEventHandlers(viewportProps.onScroll, (event) => {
            const viewport = event.currentTarget;
            const { contentWrapper, shouldExpandOnScrollRef } = viewportContext;
            if (shouldExpandOnScrollRef?.current && contentWrapper) {
              const scrolledBy = Math.abs(prevScrollTopRef.current - viewport.scrollTop);
              if (scrolledBy > 0) {
                const availableHeight = window.innerHeight - CONTENT_MARGIN * 2;
                const cssMinHeight = parseFloat(contentWrapper.style.minHeight);
                const cssHeight = parseFloat(contentWrapper.style.height);
                const prevHeight = Math.max(cssMinHeight, cssHeight);
                if (prevHeight < availableHeight) {
                  const nextHeight = prevHeight + scrolledBy;
                  const clampedNextHeight = Math.min(availableHeight, nextHeight);
                  const heightDiff = nextHeight - clampedNextHeight;
                  contentWrapper.style.height = clampedNextHeight + "px";
                  if (contentWrapper.style.bottom === "0px") {
                    viewport.scrollTop = heightDiff > 0 ? heightDiff : 0;
                    contentWrapper.style.justifyContent = "flex-end";
                  }
                }
              }
            }
            prevScrollTopRef.current = viewport.scrollTop;
          })
        }
      ) })
    ] });
  }
);
SelectViewport.displayName = VIEWPORT_NAME;
var GROUP_NAME = "SelectGroup";
var [SelectGroupContextProvider, useSelectGroupContext] = createSelectContext(GROUP_NAME);
var SelectGroup = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...groupProps } = props;
    const groupId = useId();
    return /* @__PURE__ */ jsxRuntimeExports.jsx(SelectGroupContextProvider, { scope: __scopeSelect, id: groupId, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.div, { role: "group", "aria-labelledby": groupId, ...groupProps, ref: forwardedRef }) });
  }
);
SelectGroup.displayName = GROUP_NAME;
var LABEL_NAME = "SelectLabel";
var SelectLabel$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...labelProps } = props;
    const groupContext = useSelectGroupContext(LABEL_NAME, __scopeSelect);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.div, { id: groupContext.id, ...labelProps, ref: forwardedRef });
  }
);
SelectLabel$1.displayName = LABEL_NAME;
var ITEM_NAME$1 = "SelectItem";
var [SelectItemContextProvider, useSelectItemContext] = createSelectContext(ITEM_NAME$1);
var SelectItem$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeSelect,
      value,
      disabled = false,
      textValue: textValueProp,
      ...itemProps
    } = props;
    const context = useSelectContext(ITEM_NAME$1, __scopeSelect);
    const contentContext = useSelectContentContext(ITEM_NAME$1, __scopeSelect);
    const isSelected = context.value === value;
    const [textValue, setTextValue] = reactExports.useState(textValueProp ?? "");
    const [isFocused, setIsFocused] = reactExports.useState(false);
    const composedRefs = useComposedRefs(
      forwardedRef,
      (node) => contentContext.itemRefCallback?.(node, value, disabled)
    );
    const textId = useId();
    const pointerTypeRef = reactExports.useRef("touch");
    const handleSelect = () => {
      if (!disabled) {
        context.onValueChange(value);
        context.onOpenChange(false);
      }
    };
    if (value === "") {
      throw new Error(
        "A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder."
      );
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      SelectItemContextProvider,
      {
        scope: __scopeSelect,
        value,
        disabled,
        textId,
        isSelected,
        onItemTextChange: reactExports.useCallback((node) => {
          setTextValue((prevTextValue) => prevTextValue || (node?.textContent ?? "").trim());
        }, []),
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Collection.ItemSlot,
          {
            scope: __scopeSelect,
            value,
            disabled,
            textValue,
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              Primitive$3.div,
              {
                role: "option",
                "aria-labelledby": textId,
                "data-highlighted": isFocused ? "" : void 0,
                "aria-selected": isSelected && isFocused,
                "data-state": isSelected ? "checked" : "unchecked",
                "aria-disabled": disabled || void 0,
                "data-disabled": disabled ? "" : void 0,
                tabIndex: disabled ? void 0 : -1,
                ...itemProps,
                ref: composedRefs,
                onFocus: composeEventHandlers(itemProps.onFocus, () => setIsFocused(true)),
                onBlur: composeEventHandlers(itemProps.onBlur, () => setIsFocused(false)),
                onClick: composeEventHandlers(itemProps.onClick, () => {
                  if (pointerTypeRef.current !== "mouse") handleSelect();
                }),
                onPointerUp: composeEventHandlers(itemProps.onPointerUp, () => {
                  if (pointerTypeRef.current === "mouse") handleSelect();
                }),
                onPointerDown: composeEventHandlers(itemProps.onPointerDown, (event) => {
                  pointerTypeRef.current = event.pointerType;
                }),
                onPointerMove: composeEventHandlers(itemProps.onPointerMove, (event) => {
                  pointerTypeRef.current = event.pointerType;
                  if (disabled) {
                    contentContext.onItemLeave?.();
                  } else if (pointerTypeRef.current === "mouse") {
                    event.currentTarget.focus({ preventScroll: true });
                  }
                }),
                onPointerLeave: composeEventHandlers(itemProps.onPointerLeave, (event) => {
                  if (event.currentTarget === document.activeElement) {
                    contentContext.onItemLeave?.();
                  }
                }),
                onKeyDown: composeEventHandlers(itemProps.onKeyDown, (event) => {
                  const isTypingAhead = contentContext.searchRef?.current !== "";
                  if (isTypingAhead && event.key === " ") return;
                  if (SELECTION_KEYS.includes(event.key)) handleSelect();
                  if (event.key === " ") event.preventDefault();
                })
              }
            )
          }
        )
      }
    );
  }
);
SelectItem$1.displayName = ITEM_NAME$1;
var ITEM_TEXT_NAME = "SelectItemText";
var SelectItemText = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, className, style, ...itemTextProps } = props;
    const context = useSelectContext(ITEM_TEXT_NAME, __scopeSelect);
    const contentContext = useSelectContentContext(ITEM_TEXT_NAME, __scopeSelect);
    const itemContext = useSelectItemContext(ITEM_TEXT_NAME, __scopeSelect);
    const nativeOptionsContext = useSelectNativeOptionsContext(ITEM_TEXT_NAME, __scopeSelect);
    const [itemTextNode, setItemTextNode] = reactExports.useState(null);
    const composedRefs = useComposedRefs(
      forwardedRef,
      (node) => setItemTextNode(node),
      itemContext.onItemTextChange,
      (node) => contentContext.itemTextRefCallback?.(node, itemContext.value, itemContext.disabled)
    );
    const textContent = itemTextNode?.textContent;
    const nativeOption = reactExports.useMemo(
      () => /* @__PURE__ */ jsxRuntimeExports.jsx("option", { value: itemContext.value, disabled: itemContext.disabled, children: textContent }, itemContext.value),
      [itemContext.disabled, itemContext.value, textContent]
    );
    const { onNativeOptionAdd, onNativeOptionRemove } = nativeOptionsContext;
    useLayoutEffect2(() => {
      onNativeOptionAdd(nativeOption);
      return () => onNativeOptionRemove(nativeOption);
    }, [onNativeOptionAdd, onNativeOptionRemove, nativeOption]);
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.span, { id: itemContext.textId, ...itemTextProps, ref: composedRefs }),
      itemContext.isSelected && context.valueNode && !context.valueNodeHasChildren ? reactDomExports.createPortal(itemTextProps.children, context.valueNode) : null
    ] });
  }
);
SelectItemText.displayName = ITEM_TEXT_NAME;
var ITEM_INDICATOR_NAME = "SelectItemIndicator";
var SelectItemIndicator = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...itemIndicatorProps } = props;
    const itemContext = useSelectItemContext(ITEM_INDICATOR_NAME, __scopeSelect);
    return itemContext.isSelected ? /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.span, { "aria-hidden": true, ...itemIndicatorProps, ref: forwardedRef }) : null;
  }
);
SelectItemIndicator.displayName = ITEM_INDICATOR_NAME;
var SCROLL_UP_BUTTON_NAME = "SelectScrollUpButton";
var SelectScrollUpButton$1 = reactExports.forwardRef((props, forwardedRef) => {
  const contentContext = useSelectContentContext(SCROLL_UP_BUTTON_NAME, props.__scopeSelect);
  const viewportContext = useSelectViewportContext(SCROLL_UP_BUTTON_NAME, props.__scopeSelect);
  const [canScrollUp, setCanScrollUp] = reactExports.useState(false);
  const composedRefs = useComposedRefs(forwardedRef, viewportContext.onScrollButtonChange);
  useLayoutEffect2(() => {
    if (contentContext.viewport && contentContext.isPositioned) {
      let handleScroll2 = function() {
        const canScrollUp2 = viewport.scrollTop > 0;
        setCanScrollUp(canScrollUp2);
      };
      const viewport = contentContext.viewport;
      handleScroll2();
      viewport.addEventListener("scroll", handleScroll2);
      return () => viewport.removeEventListener("scroll", handleScroll2);
    }
  }, [contentContext.viewport, contentContext.isPositioned]);
  return canScrollUp ? /* @__PURE__ */ jsxRuntimeExports.jsx(
    SelectScrollButtonImpl,
    {
      ...props,
      ref: composedRefs,
      onAutoScroll: () => {
        const { viewport, selectedItem } = contentContext;
        if (viewport && selectedItem) {
          viewport.scrollTop = viewport.scrollTop - selectedItem.offsetHeight;
        }
      }
    }
  ) : null;
});
SelectScrollUpButton$1.displayName = SCROLL_UP_BUTTON_NAME;
var SCROLL_DOWN_BUTTON_NAME = "SelectScrollDownButton";
var SelectScrollDownButton$1 = reactExports.forwardRef((props, forwardedRef) => {
  const contentContext = useSelectContentContext(SCROLL_DOWN_BUTTON_NAME, props.__scopeSelect);
  const viewportContext = useSelectViewportContext(SCROLL_DOWN_BUTTON_NAME, props.__scopeSelect);
  const [canScrollDown, setCanScrollDown] = reactExports.useState(false);
  const composedRefs = useComposedRefs(forwardedRef, viewportContext.onScrollButtonChange);
  useLayoutEffect2(() => {
    if (contentContext.viewport && contentContext.isPositioned) {
      let handleScroll2 = function() {
        const maxScroll = viewport.scrollHeight - viewport.clientHeight;
        const canScrollDown2 = Math.ceil(viewport.scrollTop) < maxScroll;
        setCanScrollDown(canScrollDown2);
      };
      const viewport = contentContext.viewport;
      handleScroll2();
      viewport.addEventListener("scroll", handleScroll2);
      return () => viewport.removeEventListener("scroll", handleScroll2);
    }
  }, [contentContext.viewport, contentContext.isPositioned]);
  return canScrollDown ? /* @__PURE__ */ jsxRuntimeExports.jsx(
    SelectScrollButtonImpl,
    {
      ...props,
      ref: composedRefs,
      onAutoScroll: () => {
        const { viewport, selectedItem } = contentContext;
        if (viewport && selectedItem) {
          viewport.scrollTop = viewport.scrollTop + selectedItem.offsetHeight;
        }
      }
    }
  ) : null;
});
SelectScrollDownButton$1.displayName = SCROLL_DOWN_BUTTON_NAME;
var SelectScrollButtonImpl = reactExports.forwardRef((props, forwardedRef) => {
  const { __scopeSelect, onAutoScroll, ...scrollIndicatorProps } = props;
  const contentContext = useSelectContentContext("SelectScrollButton", __scopeSelect);
  const autoScrollTimerRef = reactExports.useRef(null);
  const getItems = useCollection(__scopeSelect);
  const clearAutoScrollTimer = reactExports.useCallback(() => {
    if (autoScrollTimerRef.current !== null) {
      window.clearInterval(autoScrollTimerRef.current);
      autoScrollTimerRef.current = null;
    }
  }, []);
  reactExports.useEffect(() => {
    return () => clearAutoScrollTimer();
  }, [clearAutoScrollTimer]);
  useLayoutEffect2(() => {
    const activeItem = getItems().find((item) => item.ref.current === document.activeElement);
    activeItem?.ref.current?.scrollIntoView({ block: "nearest" });
  }, [getItems]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Primitive$3.div,
    {
      "aria-hidden": true,
      ...scrollIndicatorProps,
      ref: forwardedRef,
      style: { flexShrink: 0, ...scrollIndicatorProps.style },
      onPointerDown: composeEventHandlers(scrollIndicatorProps.onPointerDown, () => {
        if (autoScrollTimerRef.current === null) {
          autoScrollTimerRef.current = window.setInterval(onAutoScroll, 50);
        }
      }),
      onPointerMove: composeEventHandlers(scrollIndicatorProps.onPointerMove, () => {
        contentContext.onItemLeave?.();
        if (autoScrollTimerRef.current === null) {
          autoScrollTimerRef.current = window.setInterval(onAutoScroll, 50);
        }
      }),
      onPointerLeave: composeEventHandlers(scrollIndicatorProps.onPointerLeave, () => {
        clearAutoScrollTimer();
      })
    }
  );
});
var SEPARATOR_NAME = "SelectSeparator";
var SelectSeparator$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...separatorProps } = props;
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Primitive$3.div, { "aria-hidden": true, ...separatorProps, ref: forwardedRef });
  }
);
SelectSeparator$1.displayName = SEPARATOR_NAME;
var ARROW_NAME = "SelectArrow";
var SelectArrow = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeSelect, ...arrowProps } = props;
    const popperScope = usePopperScope(__scopeSelect);
    const context = useSelectContext(ARROW_NAME, __scopeSelect);
    const contentContext = useSelectContentContext(ARROW_NAME, __scopeSelect);
    return context.open && contentContext.position === "popper" ? /* @__PURE__ */ jsxRuntimeExports.jsx(Arrow, { ...popperScope, ...arrowProps, ref: forwardedRef }) : null;
  }
);
SelectArrow.displayName = ARROW_NAME;
var BUBBLE_INPUT_NAME$2 = "SelectBubbleInput";
var SelectBubbleInput = reactExports.forwardRef(
  ({ __scopeSelect, value, ...props }, forwardedRef) => {
    const ref = reactExports.useRef(null);
    const composedRefs = useComposedRefs(forwardedRef, ref);
    const prevValue = usePrevious(value);
    reactExports.useEffect(() => {
      const select = ref.current;
      if (!select) return;
      const selectProto = window.HTMLSelectElement.prototype;
      const descriptor = Object.getOwnPropertyDescriptor(
        selectProto,
        "value"
      );
      const setValue = descriptor.set;
      if (prevValue !== value && setValue) {
        const event = new Event("change", { bubbles: true });
        setValue.call(select, value);
        select.dispatchEvent(event);
      }
    }, [prevValue, value]);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.select,
      {
        ...props,
        style: { ...VISUALLY_HIDDEN_STYLES, ...props.style },
        ref: composedRefs,
        defaultValue: value
      }
    );
  }
);
SelectBubbleInput.displayName = BUBBLE_INPUT_NAME$2;
function shouldShowPlaceholder(value) {
  return value === "" || value === void 0;
}
function useTypeaheadSearch(onSearchChange) {
  const handleSearchChange = useCallbackRef(onSearchChange);
  const searchRef = reactExports.useRef("");
  const timerRef = reactExports.useRef(0);
  const handleTypeaheadSearch = reactExports.useCallback(
    (key) => {
      const search = searchRef.current + key;
      handleSearchChange(search);
      (function updateSearch(value) {
        searchRef.current = value;
        window.clearTimeout(timerRef.current);
        if (value !== "") timerRef.current = window.setTimeout(() => updateSearch(""), 1e3);
      })(search);
    },
    [handleSearchChange]
  );
  const resetTypeahead = reactExports.useCallback(() => {
    searchRef.current = "";
    window.clearTimeout(timerRef.current);
  }, []);
  reactExports.useEffect(() => {
    return () => window.clearTimeout(timerRef.current);
  }, []);
  return [searchRef, handleTypeaheadSearch, resetTypeahead];
}
function findNextItem(items, search, currentItem) {
  const isRepeated = search.length > 1 && Array.from(search).every((char) => char === search[0]);
  const normalizedSearch = isRepeated ? search[0] : search;
  const currentItemIndex = currentItem ? items.indexOf(currentItem) : -1;
  let wrappedItems = wrapArray(items, Math.max(currentItemIndex, 0));
  const excludeCurrentItem = normalizedSearch.length === 1;
  if (excludeCurrentItem) wrappedItems = wrappedItems.filter((v) => v !== currentItem);
  const nextItem = wrappedItems.find(
    (item) => item.textValue.toLowerCase().startsWith(normalizedSearch.toLowerCase())
  );
  return nextItem !== currentItem ? nextItem : void 0;
}
function wrapArray(array, startIndex) {
  return array.map((_, index) => array[(startIndex + index) % array.length]);
}
var Root2$1 = Select$1;
var Trigger = SelectTrigger$1;
var Value = SelectValue$1;
var Icon = SelectIcon;
var Portal = SelectPortal;
var Content2 = SelectContent$1;
var Viewport = SelectViewport;
var Label = SelectLabel$1;
var Item = SelectItem$1;
var ItemText = SelectItemText;
var ItemIndicator = SelectItemIndicator;
var ScrollUpButton = SelectScrollUpButton$1;
var ScrollDownButton = SelectScrollDownButton$1;
var Separator = SelectSeparator$1;

const Select = Root2$1;
const SelectValue = Value;
const SelectTrigger = reactExports.forwardRef(({ className, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
  Trigger,
  {
    ref,
    className: cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    ),
    ...props,
    children: [
      children,
      /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { asChild: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "h-4 w-4 opacity-50" }) })
    ]
  }
));
SelectTrigger.displayName = Trigger.displayName;
const SelectScrollUpButton = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  ScrollUpButton,
  {
    ref,
    className: cn(
      "flex cursor-default items-center justify-center py-1",
      className
    ),
    ...props,
    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronUp, { className: "h-4 w-4" })
  }
));
SelectScrollUpButton.displayName = ScrollUpButton.displayName;
const SelectScrollDownButton = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  ScrollDownButton,
  {
    ref,
    className: cn(
      "flex cursor-default items-center justify-center py-1",
      className
    ),
    ...props,
    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "h-4 w-4" })
  }
));
SelectScrollDownButton.displayName = ScrollDownButton.displayName;
const SelectContent = reactExports.forwardRef(({ className, children, position = "popper", ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(Portal, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
  Content2,
  {
    ref,
    className: cn(
      "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      position === "popper" && "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
      className
    ),
    position,
    ...props,
    children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectScrollUpButton, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Viewport,
        {
          className: cn(
            "p-1",
            position === "popper" && "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
          ),
          children
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectScrollDownButton, {})
    ]
  }
) }));
SelectContent.displayName = Content2.displayName;
const SelectLabel = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Label,
  {
    ref,
    className: cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className),
    ...props
  }
));
SelectLabel.displayName = Label.displayName;
const SelectItem = reactExports.forwardRef(({ className, children, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
  Item,
  {
    ref,
    className: cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    ),
    ...props,
    children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "absolute left-2 flex h-3.5 w-3.5 items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ItemIndicator, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "h-4 w-4" }) }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ItemText, { children })
    ]
  }
));
SelectItem.displayName = Item.displayName;
const SelectSeparator = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Separator,
  {
    ref,
    className: cn("-mx-1 my-1 h-px bg-muted", className),
    ...props
  }
));
SelectSeparator.displayName = Separator.displayName;

const MissionSettings = () => {
  useWouterNavigation();
  const { user } = useAuth();
  const { profileImage } = useProfileImage();
  const { battleFxMode, setBattleFxMode, isLoading } = usePerformanceSettings();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage: profileImage || user?.user_metadata?.avatar_url }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        exit: { opacity: 0, y: -20 },
        transition: { duration: 0.3 },
        className: "px-4 space-y-6",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white font-orbitron", children: "Missione" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci le tue missioni e obiettivi" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-xl bg-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "h-6 w-6 text-[#00D1FF]" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl text-white font-orbitron", children: "Missione Corrente" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70", children: "Gennaio 2025" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-green-500/20 text-green-400 border-green-500/30", children: "Attiva" })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 bg-black/20 rounded-lg border border-white/10", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center mb-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/70", children: "Progresso Generale" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold text-[#00D1FF]", children: "45%" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full bg-white/10 rounded-full h-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gradient-to-r from-[#00D1FF] to-[#00B8E6] h-3 rounded-full transition-all duration-500", style: { width: "45%" } }) })
            ] }) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-6 text-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-xl bg-[#00D1FF]/20 w-fit mx-auto mb-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingUp, { className: "h-8 w-8 text-[#00D1FF]" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-white mb-1", children: "7" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70", children: "Completate" })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-6 text-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-xl bg-yellow-500/20 w-fit mx-auto mb-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "h-8 w-8 text-yellow-400" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold text-white mb-1", children: "3" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70", children: "Premi" })
            ] }) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl font-bold text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "h-5 w-5 mr-2 text-[#00D1FF]" }),
              "Battle FX Settings"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm font-medium text-white/90", children: "Performance Mode" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/60 mb-2", children: "Regola la qualità degli effetti visivi Battle per ottimizzare le prestazioni" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Select,
                {
                  value: battleFxMode,
                  onValueChange: (value) => setBattleFxMode(value),
                  disabled: isLoading,
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { className: "w-full bg-black/20 border-white/20 text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona modalità" }) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "high", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Alta Qualità" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-muted-foreground", children: "Effetti completi e ricchi" })
                      ] }) }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "low", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Performance" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-muted-foreground", children: "Effetti semplificati per device meno potenti" })
                      ] }) })
                    ] })
                  ]
                }
              )
            ] }) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-xl font-bold text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "h-5 w-5 mr-2 text-[#00D1FF]" }),
              "Azioni Rapide"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Button,
                {
                  variant: "outline",
                  className: "w-full justify-start bg-black/20 border-white/20 text-white hover:bg-white/10",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "h-4 w-4 mr-2" }),
                    "Visualizza Mappa Missione"
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Button,
                {
                  variant: "outline",
                  className: "w-full justify-start bg-black/20 border-white/20 text-white hover:bg-white/10",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "h-4 w-4 mr-2" }),
                    "Cronometro Missione"
                  ]
                }
              )
            ] })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

async function loadKeyAndConverter() {
  const mod = await __vitePreload(() => import('./vapid-loader.Dvqe_4zt.js'),true?[]:void 0);
  return {
    loadPublicKey: mod.loadVAPIDPublicKey,
    toUint8: mod.urlBase64ToUint8Array
  };
}
function looksLikeWebPushEndpoint(url) {
  try {
    const u = new URL(url);
    return u.protocol.startsWith("http") && (u.hostname.includes("fcm") || u.pathname.toLowerCase().includes("push") || u.pathname.toLowerCase().includes("send"));
  } catch {
    return false;
  }
}
function getNotificationStatus() {
  const supported = "serviceWorker" in navigator && "PushManager" in window && "Notification" in window;
  const permission = "Notification" in window ? Notification.permission : null;
  return { supported, permission };
}
function isPushSupported() {
  return getNotificationStatus().supported;
}
async function hasActiveSubscription() {
  if (!isPushSupported()) return false;
  const reg = await navigator.serviceWorker.ready;
  const sub = await reg.pushManager.getSubscription();
  return !!sub;
}
async function subscribeWebPushAndSave(reg) {
  const { loadPublicKey, toUint8 } = await loadKeyAndConverter();
  const publicKey = await loadPublicKey();
  const keyBytes = typeof publicKey === "string" ? toUint8(publicKey) : publicKey;
  const applicationServerKey = keyBytes;
  if (!reg?.pushManager) throw new Error("PushManager non disponibile");
  let sub = await reg.pushManager.getSubscription();
  if (!sub) {
    sub = await reg.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey
    });
  }
  const raw = sub.toJSON();
  if (!raw?.endpoint || !raw?.keys?.p256dh || !raw?.keys?.auth) {
    throw new Error("Subscription incompleta");
  }
  return {
    endpoint: raw.endpoint,
    keys: { p256dh: raw.keys.p256dh, auth: raw.keys.auth },
    vapidKey: typeof publicKey === "string" ? publicKey : void 0
  };
}
async function enableWebPush$1() {
  if (!isPushSupported()) throw new Error("Push non supportato su questo browser");
  const reg = await navigator.serviceWorker.ready;
  return subscribeWebPushAndSave(reg);
}
async function disableWebPush() {
  if (!isPushSupported()) return true;
  const reg = await navigator.serviceWorker.ready;
  const sub = await reg.pushManager.getSubscription();
  if (sub) await sub.unsubscribe();
  return true;
}
async function getCurrent() {
  if (!isPushSupported()) return null;
  const reg = await navigator.serviceWorker.ready;
  return reg.pushManager.getSubscription();
}
async function getStatus() {
  const { supported, permission } = getNotificationStatus();
  const sub = await getCurrent();
  return { supported, permission: permission ?? "default", enabled: !!sub, endpoint: sub?.endpoint };
}
async function enable() {
  await enableWebPush$1();
}
async function disable() {
  await disableWebPush();
}
async function subscribe(_userId) {
  const reg = await navigator.serviceWorker.ready;
  await subscribeWebPushAndSave(reg);
  const cur = await reg.pushManager.getSubscription();
  if (!cur) throw new Error("Subscription failed");
  return cur;
}
async function unsubscribe() {
  return disableWebPush();
}
function isSupported() {
  return isPushSupported();
}
const webPushManager = {
  isPushSupported,
  hasActiveSubscription,
  enableWebPush: enableWebPush$1,
  disableWebPush,
  getNotificationStatus,
  looksLikeWebPushEndpoint,
  subscribeWebPushAndSave,
  // alias compat:
  getCurrent,
  getStatus,
  enable,
  disable,
  subscribe,
  unsubscribe,
  isSupported
};

function useUnifiedPush() {
  const [state, setState] = reactExports.useState({
    enabled: false,
    loading: false,
    error: null,
    permission: typeof Notification !== "undefined" ? Notification.permission : "default",
    subscriptionEndpoint: null
  });
  reactExports.useEffect(() => {
    let mounted = true;
    (async () => {
      try {
        await navigator.serviceWorker?.ready.catch(() => null);
        const status = await webPushManager.getStatus();
        if (!mounted) return;
        if (false) ;
        setState((s) => ({
          ...s,
          enabled: !!status.enabled,
          permission: status.permission ?? s.permission,
          subscriptionEndpoint: status.endpoint ?? null,
          error: null
        }));
      } catch (err) {
        if (!mounted) return;
        setState((s) => ({ ...s, error: err?.message ?? "Push status read failed" }));
      }
    })();
    return () => {
      mounted = false;
    };
  }, []);
  const enable = reactExports.useCallback(async () => {
    setState((s) => ({ ...s, loading: true, error: null }));
    try {
      await webPushManager.enable();
      const status = await webPushManager.getStatus();
      setState((s) => ({
        ...s,
        loading: false,
        enabled: !!status.enabled,
        permission: status.permission ?? s.permission,
        subscriptionEndpoint: status.endpoint ?? null
      }));
      return true;
    } catch (err) {
      setState((s) => ({ ...s, loading: false, error: err?.message ?? "Enable push failed" }));
      return false;
    }
  }, []);
  const disable = reactExports.useCallback(async () => {
    setState((s) => ({ ...s, loading: true, error: null }));
    try {
      await webPushManager.disable();
      const status = await webPushManager.getStatus();
      setState((s) => ({
        ...s,
        loading: false,
        enabled: !!status.enabled,
        permission: status.permission ?? s.permission,
        subscriptionEndpoint: status.endpoint ?? null
      }));
      return true;
    } catch (err) {
      setState((s) => ({ ...s, loading: false, error: err?.message ?? "Disable push failed" }));
      return false;
    }
  }, []);
  const refresh = reactExports.useCallback(async () => {
    try {
      const status = await webPushManager.getStatus();
      setState((s) => ({
        ...s,
        enabled: !!status.enabled,
        permission: status.permission ?? s.permission,
        subscriptionEndpoint: status.endpoint ?? null
      }));
    } catch (err) {
      setState((s) => ({ ...s, error: err?.message ?? "Refresh push status failed" }));
    }
  }, []);
  return {
    ...state,
    enable,
    disable,
    refresh,
    // compat richiesti dai componenti legacy:
    isSupported: webPushManager.isSupported(),
    subscription: null,
    webPushSubscription: state.subscriptionEndpoint,
    subscriptionType: "webpush",
    isLoading: state.loading,
    isSubscribed: !!state.enabled,
    canSubscribe: !state.enabled && !state.loading,
    subscribe: enable,
    async requestPermission() {
      const perm = await Notification.requestPermission();
      setState((s) => ({ ...s, permission: perm }));
      return perm === "granted";
    },
    unsubscribe: disable
  };
}

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive: "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"
      }
    },
    defaultVariants: {
      variant: "default"
    }
  }
);
const Alert = reactExports.forwardRef(({ className, variant, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    ref,
    role: "alert",
    className: cn(alertVariants({ variant }), className),
    ...props
  }
));
Alert.displayName = "Alert";
const AlertTitle = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "h5",
  {
    ref,
    className: cn("mb-1 font-medium leading-none tracking-tight", className),
    ...props
  }
));
AlertTitle.displayName = "AlertTitle";
const AlertDescription = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "div",
  {
    ref,
    className: cn("text-sm [&_p]:leading-relaxed", className),
    ...props
  }
));
AlertDescription.displayName = "AlertDescription";

async function ensureServiceWorkerReady() {
  if (!("serviceWorker" in navigator)) {
    throw new Error("Service Worker non supportato");
  }
  const regs = await navigator.serviceWorker.getRegistrations();
  const hasMain = regs.some((r) => r.active?.scriptURL.includes("/sw.js"));
  if (!hasMain) {
    console.log("[SubscribeFlow] Registering /sw.js...");
    await navigator.serviceWorker.register("/sw.js", { scope: "/" });
  }
  return navigator.serviceWorker.ready;
}
async function ensurePermissionGranted() {
  if (!("Notification" in window)) {
    throw new Error("Notification API non supportata");
  }
  if (Notification.permission === "denied") {
    return false;
  }
  if (Notification.permission === "default") {
    const perm = await Notification.requestPermission();
    return perm === "granted";
  }
  return true;
}
async function ensurePushSubscription(reg) {
  const current = await reg.pushManager.getSubscription();
  if (current) {
    console.log("[SubscribeFlow] Subscription già esistente");
    return current;
  }
  console.log("[SubscribeFlow] Creazione nuova subscription...");
  const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await __vitePreload(async () => { const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await import('./vapid-loader.Dvqe_4zt.js');return { loadVAPIDPublicKey, urlBase64ToUint8Array }},true?[]:void 0);
  const vapidKey = await loadVAPIDPublicKey();
  const applicationServerKey = typeof vapidKey === "string" ? urlBase64ToUint8Array(vapidKey) : vapidKey;
  const sub = await reg.pushManager.subscribe({
    userVisibleOnly: true,
    applicationServerKey
  });
  console.log("[SubscribeFlow] Subscription creata");
  return sub;
}
async function upsertBackend(sub) {
  console.log("[SubscribeFlow] Salvando subscription al backend...");
  const { data: { session } } = await supabase.auth.getSession();
  if (!session?.access_token) {
    throw new Error("Sessione scaduta: effettua il login");
  }
  const json = sub.toJSON();
  const keys = json?.keys || {};
  if (!keys.p256dh || !keys.auth) {
    throw new Error("Chiavi subscription mancanti");
  }
  const { detectPlatformSafe } = await __vitePreload(async () => { const { detectPlatformSafe } = await import('./pushPlatform.BoRsb-VW.js');return { detectPlatformSafe }},true?[]:void 0);
  const platform = detectPlatformSafe();
  const { error } = await supabase.functions.invoke("webpush-upsert", {
    body: {
      endpoint: sub.endpoint,
      keys: { p256dh: keys.p256dh, auth: keys.auth },
      provider: "webpush",
      platform,
      ua: navigator.userAgent
    }
  });
  if (error) {
    console.error("[SubscribeFlow] Upsert failed:", error);
    throw new Error(error.message || "Upsert fallito");
  }
  console.log("[SubscribeFlow] Backend upsert SUCCESS");
}
async function subscribeFlow() {
  const t0 = performance.now();
  try {
    console.log("[SubscribeFlow] Starting...");
    const reg = await ensureServiceWorkerReady();
    console.log("[SubscribeFlow] Step 1/4: SW ready");
    const hasPermission = await ensurePermissionGranted();
    if (!hasPermission) {
      return {
        ok: false,
        status: "permission_denied",
        message: "Permesso notifiche negato"
      };
    }
    console.log("[SubscribeFlow] Step 2/4: Permission granted");
    const sub = await ensurePushSubscription(reg);
    console.log("[SubscribeFlow] Step 3/4: Subscription ready");
    await upsertBackend(sub);
    console.log("[SubscribeFlow] Step 4/4: Backend saved");
    const elapsed = Math.round(performance.now() - t0);
    console.log(`[SubscribeFlow] COMPLETE in ${elapsed}ms`);
    return {
      ok: true,
      status: "ready",
      endpoint: sub.endpoint,
      message: `Ready in ${elapsed}ms`
    };
  } catch (error) {
    const elapsed = Math.round(performance.now() - t0);
    console.error(`[SubscribeFlow] FAILED after ${elapsed}ms:`, error);
    return {
      ok: false,
      status: "error",
      error: error?.message || "Errore sconosciuto",
      message: `Failed after ${elapsed}ms`
    };
  }
}

async function runRepairFlow() {
  const t0 = performance.now();
  try {
    if ("serviceWorker" in navigator && "PushManager" in window) {
      try {
        const reg = await navigator.serviceWorker.ready;
        const existingSub = await reg.pushManager.getSubscription();
        if (existingSub) {
          console.log("[RepairFlow] Unsubscribing old subscription...");
          await existingSub.unsubscribe();
        }
      } catch (cleanupError) {
        console.warn("[RepairFlow] Cleanup failed (non-critical):", cleanupError);
      }
    }
    const result = await subscribeFlow();
    const elapsed = Math.round(performance.now() - t0);
    if (result.ok) {
      const reg = await navigator.serviceWorker.ready;
      const sub = await reg.pushManager.getSubscription();
      return {
        ok: true,
        subscription: sub,
        endpoint: result.endpoint,
        message: `Repair completed in ${elapsed}ms`
      };
    } else {
      return {
        ok: false,
        subscription: null,
        error: result.error || "Repair failed",
        message: `Failed after ${elapsed}ms`
      };
    }
  } catch (error) {
    const elapsed = Math.round(performance.now() - t0);
    console.error(`[RepairFlow] FAILED after ${elapsed}ms:`, error);
    return {
      ok: false,
      subscription: null,
      error: error?.message || "Unknown error",
      message: `Error after ${elapsed}ms`
    };
  }
}

async function backendHasActiveEndpoint(endpoint) {
  if (!endpoint) return false;
  try {
    const { count, error } = await supabase.from("webpush_subscriptions").select("endpoint", { head: true, count: "exact" }).eq("endpoint", endpoint).eq("is_active", true);
    if (error) {
      console.warn("[PUSH] backendHasActiveEndpoint error:", error.message);
      return false;
    }
    return (count ?? 0) > 0;
  } catch (e) {
    console.warn("[PUSH] backendHasActiveEndpoint exception:", e);
    return false;
  }
}
const UnifiedPushToggle = ({ className }) => {
  const {
    isSupported,
    permission,
    subscription,
    subscriptionType,
    isLoading,
    error,
    isSubscribed,
    canSubscribe,
    requestPermission,
    unsubscribe,
    refresh
  } = useUnifiedPush();
  const [isRepairLoading, setIsRepairLoading] = reactExports.useState(false);
  const getPlatformLabel = () => {
    return "Desktop";
  };
  const getSubscriptionTypeLabel = () => {
    return subscriptionType?.toUpperCase() || "Unknown";
  };
  const getStatusColor = () => {
    if (isSubscribed) return "text-success";
    if (permission === "denied") return "text-destructive";
    return "text-muted-foreground";
  };
  const getStatusText = () => {
    if (isLoading) return "Configurazione in corso...";
    if (isSubscribed) return `Attivo (${getSubscriptionTypeLabel()})`;
    if (permission === "denied") return "Permessi negati";
    if (permission === "default") return "Permessi richiesti";
    return "Non attivo";
  };
  const handleToggle = async () => {
    setIsRepairLoading(true);
    try {
      const reg = await navigator.serviceWorker?.ready.catch(() => null);
      const sub = reg ? await reg.pushManager.getSubscription() : null;
      if (false) ;
      if (isSubscribed) {
        const known = sub ? await backendHasActiveEndpoint(sub.endpoint) : false;
        if (false) ;
        if (!known) {
          console.warn("[PUSH] Toggle ON→click: backend mismatch detected → running repairFlow");
          const result2 = await runRepairFlow();
          if (result2.ok && result2.subscription) {
            ue$1.success("Notifiche riparate e riattivate ✅");
            await refresh();
          } else {
            ue$1.error("Impossibile riparare la subscription");
          }
          return;
        }
        await unsubscribe();
        await refresh();
        ue$1.success("Notifiche disattivate");
        return;
      }
      if (false) ;
      await navigator.serviceWorker.ready;
      const result = await runRepairFlow();
      if (result.ok && result.subscription) {
        ue$1.success("Notifiche attivate ✅");
        await refresh();
      } else {
        ue$1.error("Impossibile completare l'attivazione (riprovare)");
      }
    } catch (error2) {
      console.error("[UnifiedPushToggle] handleToggle error:", error2);
      ue$1.error("Errore durante l'operazione");
    } finally {
      setIsRepairLoading(false);
    }
  };
  if (!isSupported) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(BellOff, { className: "w-5 h-5" }),
        "Notifiche Push"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Le notifiche push non sono supportate su questo dispositivo." })
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className, "data-push-toggle-v1": true, "data-push-toggle-repair": "1", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5" }),
        "Notifiche Push Unificate"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Sistema unificato per notifiche su tutti i dispositivi" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-2 h-2 rounded-full ${isSubscribed ? "bg-success" : "bg-muted-foreground"}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: getStatusColor(), children: getStatusText() })
        ] }),
        subscription
      ] }),
      isSubscribed && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 bg-muted/50 rounded-lg space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-success" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Connesso" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            "Tipo: ",
            getSubscriptionTypeLabel()
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            "Piattaforma: ",
            getPlatformLabel()
          ] }),
          subscription
        ] })
      ] }),
      error && /* @__PURE__ */ jsxRuntimeExports.jsxs(Alert, { variant: "destructive", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "h-4 w-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDescription, { children: error })
      ] }),
      permission === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsxs(Alert, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "h-4 w-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDescription, { children: "Per attivare le notifiche, vai nelle impostazioni del browser e consenti le notifiche per questo sito." })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "font-medium", children: [
            isSubscribed ? "Disattiva" : "Attiva",
            " Notifiche"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: isSubscribed ? "Riceverai notifiche push su questo dispositivo" : "Attiva per ricevere notifiche push" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Switch,
          {
            checked: isSubscribed,
            onCheckedChange: handleToggle,
            disabled: isLoading || isRepairLoading || !canSubscribe && !isSubscribed
          }
        )
      ] }),
      !isSubscribed && permission !== "granted" && /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: requestPermission,
          disabled: isLoading,
          className: "w-full",
          variant: "outline",
          children: isLoading ? "Configurazione..." : "Richiedi Permessi"
        }
      ),
      isSubscribed && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-success text-sm font-medium", children: "✅ Notifiche push attive e funzionanti!" }) })
    ] })
  ] });
};

function getProjectRef() {
  return getProjectRef$1();
}
function functionsBaseUrl(fn) {
  return `${getFunctionsUrl()}/${fn}`;
}

const CATEGORY_TAGS = {
  "Luxury & moda": ["luxury", "fashion", "watch", "luxurycar"],
  "Viaggi & esperienze": ["travel", "experience"],
  "Sport & fitness": ["sport", "fitness"],
  "Tecnologia": ["tech", "innovation"],
  "Food & beverage": ["food", "beverage"],
  "Arte & cultura": ["art", "culture"]
};
const AVAILABLE_CATEGORIES = Object.keys(CATEGORY_TAGS);
function getTagsForCategories(categories) {
  const allTags = /* @__PURE__ */ new Set();
  categories.forEach((category) => {
    if (CATEGORY_TAGS[category]) {
      CATEGORY_TAGS[category].forEach((tag) => allTags.add(tag));
    }
  });
  return Array.from(allTags);
}

let _cachedTags = null;
let _cacheExpiry = 0;
const CACHE_DURATION_MS = 5 * 60 * 1e3;
async function getUserPreferences() {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      console.log("🔍 RESOLVE: No authenticated user");
      return [];
    }
    const { data, error } = await supabase.from("notification_preferences").select("*").eq("user_id", user.id).eq("enabled", true);
    if (error) {
      console.error("🔍 RESOLVE: Error fetching preferences:", error);
      return [];
    }
    console.log("🔍 RESOLVE: Found", data?.length || 0, "active preferences");
    return data || [];
  } catch (error) {
    console.error("🔍 RESOLVE: Exception in getUserPreferences:", error);
    return [];
  }
}
async function resolveTagsForCurrentUser() {
  const now = Date.now();
  if (_cachedTags && now < _cacheExpiry) {
    console.log("🔍 RESOLVE: Using cached tags:", _cachedTags);
    return _cachedTags;
  }
  try {
    const preferences = await getUserPreferences();
    const enabledCategories = preferences.map((pref) => pref.category);
    const resolvedTags = getTagsForCategories(enabledCategories);
    _cachedTags = resolvedTags;
    _cacheExpiry = now + CACHE_DURATION_MS;
    console.log("🔍 RESOLVE: Categories:", enabledCategories);
    console.log("🔍 RESOLVE: Resolved tags:", resolvedTags);
    return resolvedTags;
  } catch (error) {
    console.error("🔍 RESOLVE: Error resolving tags:", error);
    return [];
  }
}
function invalidateTagsCache() {
  _cachedTags = null;
  _cacheExpiry = 0;
  console.log("🔍 RESOLVE: Cache invalidated");
}
async function updateCategoryPreference(category, enabled) {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      console.error("🔍 RESOLVE: No authenticated user for preference update");
      return false;
    }
    const { error } = await supabase.from("notification_preferences").upsert({
      user_id: user.id,
      category,
      enabled,
      updated_at: (/* @__PURE__ */ new Date()).toISOString()
    }, {
      onConflict: "user_id,category"
    });
    if (error) {
      console.error("🔍 RESOLVE: Error updating preference:", error);
      return false;
    }
    invalidateTagsCache();
    console.log("🔍 RESOLVE: Updated preference:", category, enabled);
    return true;
  } catch (error) {
    console.error("🔍 RESOLVE: Exception updating preference:", error);
    return false;
  }
}
async function getCurrentPreferencesState() {
  try {
    const preferences = await getUserPreferences();
    const state = {};
    Object.keys(CATEGORY_TAGS).forEach((category) => {
      state[category] = false;
    });
    preferences.forEach((pref) => {
      if (pref.enabled) {
        state[pref.category] = true;
      }
    });
    return state;
  } catch (error) {
    console.error("🔍 RESOLVE: Error getting preferences state:", error);
    return {};
  }
}

function useNotificationPreferences() {
  const [preferences, setPreferences] = reactExports.useState({});
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [resolvedTags, setResolvedTags] = reactExports.useState([]);
  const loadPreferences = reactExports.useCallback(async () => {
    setIsLoading(true);
    try {
      const [prefs, tags] = await Promise.all([
        getCurrentPreferencesState(),
        resolveTagsForCurrentUser()
      ]);
      setPreferences(prefs);
      setResolvedTags(tags);
      console.log("🔍 PREFS: Loaded preferences:", prefs);
      console.log("🔍 PREFS: Resolved tags:", tags);
    } catch (error) {
      console.error("🔍 PREFS: Error loading preferences:", error);
    } finally {
      setIsLoading(false);
    }
  }, []);
  const updatePreference = reactExports.useCallback(async (category, enabled) => {
    try {
      const success = await updateCategoryPreference(category, enabled);
      if (success) {
        setPreferences((prev) => ({
          ...prev,
          [category]: enabled
        }));
        const newTags = await resolveTagsForCurrentUser();
        setResolvedTags(newTags);
        console.log("🔍 PREFS: Updated preference:", category, enabled);
        console.log("🔍 PREFS: New resolved tags:", newTags);
      }
      return success;
    } catch (error) {
      console.error("🔍 PREFS: Error updating preference:", error);
      return false;
    }
  }, []);
  const togglePreference = reactExports.useCallback(async (category) => {
    const currentValue = preferences[category] || false;
    return updatePreference(category, !currentValue);
  }, [preferences, updatePreference]);
  const refreshPreferences = reactExports.useCallback(async () => {
    invalidateTagsCache();
    await loadPreferences();
  }, [loadPreferences]);
  const getActiveCategories = reactExports.useCallback(() => {
    return Object.entries(preferences).filter(([_, enabled]) => enabled).map(([category, _]) => category);
  }, [preferences]);
  reactExports.useEffect(() => {
    loadPreferences();
  }, [loadPreferences]);
  return {
    preferences,
    resolvedTags,
    isLoading,
    availableCategories: AVAILABLE_CATEGORIES,
    updatePreference,
    togglePreference,
    refreshPreferences,
    getActiveCategories,
    hasActivePreferences: resolvedTags.length > 0
  };
}

function getProviderFromEndpoint(endpoint) {
  if (endpoint.includes("webpush.push.apple.com") || endpoint.includes("api.push.apple.com")) {
    return "Apple";
  }
  if (endpoint.includes("fcm.googleapis.com")) {
    return "FCM";
  }
  return "Altro";
}
function NotificationsStatus({ userId }) {
  const [enabled, setEnabled] = reactExports.useState(false);
  const [loading, setLoading] = reactExports.useState(true);
  const [providerLabel, setProviderLabel] = reactExports.useState("");
  reactExports.useEffect(() => {
    let mounted = true;
    (async () => {
      setLoading(true);
      const { data, error } = await supabase.from("push_tokens").select("token").eq("user_id", userId).eq("is_active", true).limit(1).maybeSingle();
      if (!mounted) return;
      if (error) {
        console.warn("status load error", error);
        setEnabled(false);
        setProviderLabel("");
      } else {
        const isConnected = !!data;
        setEnabled(isConnected);
        setProviderLabel(isConnected ? getProviderFromEndpoint(data.token) : "");
      }
      setLoading(false);
    })();
    return () => {
      mounted = false;
    };
  }, [userId]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 border border-border rounded-lg bg-card", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-sm font-medium mb-3", children: "Stato Notifiche Push" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("label", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "input",
          {
            type: "checkbox",
            checked: enabled,
            readOnly: true,
            className: "h-4 w-4",
            style: { pointerEvents: "none" }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Notifiche Push su questo dispositivo" })
      ] }),
      !loading && enabled && providerLabel && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "px-2 py-1 text-xs bg-primary/10 text-primary rounded-md", children: providerLabel })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 text-xs text-muted-foreground", children: [
      loading && "Verifico stato…",
      !loading && enabled && "Connesso ✅",
      !loading && !enabled && "Non connesso ❌"
    ] })
  ] });
}

function detectProvider(endpoint) {
  if (!endpoint) return null;
  const e = endpoint.toLowerCase();
  if (e.startsWith("https://webpush.push.apple.com") || e.startsWith("https://api.push.apple.com")) return "APPLE";
  if (e.startsWith("https://fcm.googleapis.com")) return "FCM";
  return "ALTRO";
}
function PushInspector({ userId }) {
  const [info, setInfo] = reactExports.useState({ swReady: false, permission: Notification?.permission, notes: [] });
  const [loading, setLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    let mounted = true;
    (async () => {
      const notes = [];
      try {
        const reg = await navigator.serviceWorker?.ready;
        const scope = reg?.scope ?? null;
        const sub = await reg?.pushManager?.getSubscription();
        const swEndpoint = sub?.endpoint ?? null;
        const swProvider = detectProvider(swEndpoint);
        const { data: v, error } = await supabase.from("push_tokens").select("id, token, is_active, created_at").eq("user_id", userId).order("created_at", { ascending: false }).limit(1).maybeSingle();
        if (error) notes.push(`DB error: ${error.message}`);
        const dbEndpoint = v?.token ?? null;
        const dbProvider = detectProvider(dbEndpoint);
        const dbIsActive = v?.is_active ?? null;
        const match = !!swEndpoint && !!dbEndpoint && swEndpoint === dbEndpoint;
        const permission = Notification?.permission;
        const ua = navigator.userAgent;
        if (!swEndpoint) notes.push("SW subscription non trovata su questo device (getSubscription() = null).");
        if (!dbEndpoint) notes.push("Nessuna subscription Apple/FCM registrata in DB per l'utente.");
        if (swEndpoint && dbEndpoint && !match) notes.push("ATTENZIONE: endpoint SW ≠ endpoint DB (device non allineato al record più recente).");
        if (mounted) {
          setInfo({
            swReady: !!reg,
            swEndpoint,
            swProvider,
            dbEndpoint,
            dbProvider,
            dbIsActive,
            match,
            permission,
            ua,
            scope,
            notes
          });
        }
      } catch (e) {
        if (mounted) setInfo((old) => ({ ...old, notes: [...old.notes ?? [], `Runtime error: ${e?.message ?? e}`] }));
      } finally {
        if (mounted) setLoading(false);
      }
    })();
    return () => {
      mounted = false;
    };
  }, [userId]);
  const Badge = ({ label }) => /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "px-2 py-0.5 rounded-full text-xs bg-slate-700/60", children: label ?? "—" });
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 rounded-xl border border-slate-700/40 bg-slate-800/40 p-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold mb-3", children: "Audit flusso Push (read-only)" }),
    loading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm opacity-80", children: "⏳ Raccolta dati…" }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3 text-sm", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "Permesso iOS/Browser" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.permission })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "SW Endpoint (device)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 break-all", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-1", children: info.swEndpoint ?? "—" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "opacity-70", children: "Provider" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.swProvider ?? "—" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "opacity-70 mt-1", children: [
            "Scope: ",
            info.scope ?? "—"
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "DB Endpoint (latest)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 break-all", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-1", children: info.dbEndpoint ?? "—" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "opacity-70", children: "Provider" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.dbProvider ?? "—" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "opacity-70", children: "is_active" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.dbIsActive === true ? "TRUE" : info.dbIsActive === false ? "FALSE" : "—" })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "Match DB ↔ Device" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { label: info.match ? "MATCH" : "NO MATCH" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-40 opacity-70", children: "User-Agent" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 break-all", children: info.ua })
      ] }),
      !!info.notes?.length && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 p-2 rounded bg-amber-500/10 border border-amber-400/20", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-medium mb-1", children: "Note" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "list-disc pl-5 space-y-1", children: info.notes.map((n, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: n }, i)) })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs opacity-60 mt-3", children: "Component read-only. Nessuna modifica alla catena push." })
  ] });
}

const NotificationsSettings = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  const [loading, setLoading] = reactExports.useState(false);
  const {
    preferences,
    resolvedTags,
    isLoading: prefsLoading,
    availableCategories,
    togglePreference,
    refreshPreferences,
    hasActivePreferences
  } = useNotificationPreferences();
  const [settings, setSettings] = reactExports.useState({
    notifications_enabled: true,
    weekly_hints: "all",
    push_notifications_enabled: false
  });
  const categoryIcons = {
    "Luxury & moda": "💎",
    "Viaggi & esperienze": "✈️",
    "Sport & fitness": "⚽",
    "Tecnologia": "📱",
    "Food & beverage": "🍷",
    "Arte & cultura": "🎨"
  };
  reactExports.useEffect(() => {
    loadNotificationSettings();
  }, [user]);
  const loadNotificationSettings = async () => {
    if (!user) return;
    try {
      const { data: profile, error } = await supabase.from("profiles").select("notifications_enabled, weekly_hints, push_notifications_enabled").eq("id", user.id).single();
      if (profile && !error) {
        setSettings({
          notifications_enabled: profile.notifications_enabled ?? true,
          weekly_hints: profile.weekly_hints || "all",
          push_notifications_enabled: profile.push_notifications_enabled ?? false
        });
      }
    } catch (error) {
      console.error("Error loading notification settings:", error);
    }
  };
  const saveSettings = async (newSettings) => {
    if (!user) return;
    setLoading(true);
    try {
      const updatedSettings = { ...settings, ...newSettings };
      await supabase.from("profiles").update({
        notifications_enabled: updatedSettings.notifications_enabled,
        weekly_hints: updatedSettings.weekly_hints,
        push_notifications_enabled: updatedSettings.push_notifications_enabled
      }).eq("id", user.id);
      setSettings(updatedSettings);
      toast({
        title: "✅ Impostazioni salvate",
        description: "Le preferenze notifiche sono state aggiornate."
      });
    } catch (error) {
      console.error("Error saving notification settings:", error);
      toast({
        title: "❌ Errore salvataggio",
        description: "Impossibile salvare le impostazioni. Riprova.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const handleNotificationsToggle = async (enabled) => {
    await saveSettings({ notifications_enabled: enabled });
  };
  const handleWeeklyHintsChange = async (value) => {
    await saveSettings({ weekly_hints: value });
  };
  const handleCategoryToggle = async (category) => {
    const success = await togglePreference(category);
    if (success) {
      toast({
        title: "✅ Preferenza aggiornata",
        description: `Categoria "${category}" ${preferences[category] ? "disabilitata" : "abilitata"}.`
      });
    } else {
      toast({
        title: "❌ Errore",
        description: "Impossibile aggiornare la preferenza. Riprova.",
        variant: "destructive"
      });
    }
  };
  const handleRefreshPreferences = async () => {
    await refreshPreferences();
    toast({
      title: "🔄 Preferenze aggiornate",
      description: "Cache delle preferenze aggiornata dal database."
    });
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      className: "max-w-4xl mx-auto p-6 space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold text-white mb-2", children: "Impostazioni Notifiche" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci le tue preferenze di notifica e comunicazione" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-gray-900 to-gray-800 border-gray-700", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5 mr-2" }),
            "Notifiche Email"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Notifiche Generali" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Ricevi aggiornamenti importanti via email" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: settings.notifications_enabled,
                  onCheckedChange: handleNotificationsToggle,
                  disabled: loading
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Suggerimenti Settimanali" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Select,
                {
                  value: settings.weekly_hints,
                  onValueChange: handleWeeklyHintsChange,
                  disabled: loading,
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { className: "bg-gray-800 border-gray-600 text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, {}) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { className: "bg-gray-800 border-gray-600", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "all", className: "text-white", children: "Tutti i suggerimenti" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "only-premium", className: "text-white", children: "Solo suggerimenti premium" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "none", className: "text-white", children: "Nessun suggerimento" })
                    ] })
                  ]
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Categorie di Interesse per Feed" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Button,
                  {
                    variant: "outline",
                    size: "sm",
                    onClick: handleRefreshPreferences,
                    disabled: prefsLoading,
                    className: "flex items-center gap-2",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: `w-4 h-4 ${prefsLoading ? "animate-spin" : ""}` }),
                      "Aggiorna"
                    ]
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Seleziona le categorie per ricevere notifiche sui contenuti che ti interessano di più" }),
              hasActivePreferences && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-green-400 mb-2", children: [
                "✅ ",
                resolvedTags.length,
                " tag attivi: ",
                resolvedTags.join(", ")
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 gap-3", children: availableCategories.map((category) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-3 rounded-lg bg-gray-800/50 border border-gray-700", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Label$1,
                  {
                    htmlFor: category,
                    className: "text-white flex items-center cursor-pointer flex-1",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "mr-3 text-lg", children: categoryIcons[category] || "📱" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-medium", children: category }),
                        preferences[category] && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-green-400 mt-1", children: "Attiva" })
                      ] })
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    id: category,
                    checked: preferences[category] || false,
                    onCheckedChange: () => handleCategoryToggle(category),
                    disabled: prefsLoading || loading
                  }
                )
              ] }, category)) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t border-white/10 pt-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedPushToggle, { className: "w-full", "data-push-toggle-v1": true }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(NotificationsStatus, { userId: "495246c1-9154-4f01-a428-7f37fe230180" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(PushInspector, { userId: "495246c1-9154-4f01-a428-7f37fe230180" })
            ] }),
            false
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-gray-900 to-gray-800 border-gray-700", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Volume2, { className: "w-5 h-5 mr-2" }),
            "Preferenze Audio"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Suoni di Notifica" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Riproduci suoni per le notifiche importanti" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: true,
                  disabled: loading
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Feedback Aptico" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Vibrazioni per dispositivi mobile" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: true,
                  disabled: loading
                }
              )
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gradient-to-br from-blue-900/20 to-purple-900/20 border-blue-700/50", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "pt-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5 text-blue-400 mt-0.5" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Privacy e Controllo" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Tutte le notifiche possono essere disabilitate in qualsiasi momento. I tuoi dati di preferenza sono crittografati e non vengono condivisi con terze parti." })
          ] })
        ] }) }) })
      ]
    }
  );
};

const PrivacySettings = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  useWouterNavigation();
  const { profileImage } = useProfileImage();
  const [loading, setLoading] = reactExports.useState(false);
  const [settings, setSettings] = reactExports.useState({
    data_collection: true,
    analytics_enabled: true,
    marketing_consent: false,
    cookie_preferences: {
      essential: true,
      analytics: true,
      marketing: false
    }
  });
  reactExports.useEffect(() => {
    loadPrivacySettings();
  }, [user]);
  const loadPrivacySettings = async () => {
    if (!user) return;
    try {
      const storedSettings = localStorage.getItem(`privacy_settings_${user.id}`);
      if (storedSettings) {
        setSettings(JSON.parse(storedSettings));
      }
    } catch (error) {
      console.error("Error loading privacy settings:", error);
    }
  };
  const saveSettings = async (newSettings) => {
    if (!user) return;
    setLoading(true);
    try {
      const updatedSettings = { ...settings, ...newSettings };
      localStorage.setItem(`privacy_settings_${user.id}`, JSON.stringify(updatedSettings));
      setSettings(updatedSettings);
      toast({
        title: "✅ Impostazioni privacy salvate",
        description: "Le tue preferenze sulla privacy sono state aggiornate."
      });
    } catch (error) {
      console.error("Error saving privacy settings:", error);
      toast({
        title: "❌ Errore salvataggio",
        description: "Impossibile salvare le impostazioni. Riprova.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const handleDataCollectionToggle = async (enabled) => {
    await saveSettings({ data_collection: enabled });
  };
  const handleAnalyticsToggle = async (enabled) => {
    await saveSettings({ analytics_enabled: enabled });
  };
  const handleMarketingToggle = async (enabled) => {
    await saveSettings({ marketing_consent: enabled });
  };
  const handleCookiePreferenceChange = async (type, enabled) => {
    const newCookiePreferences = {
      ...settings.cookie_preferences,
      [type]: enabled
    };
    await saveSettings({ cookie_preferences: newCookiePreferences });
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage: profileImage || user?.user_metadata?.avatar_url }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        exit: { opacity: 0, y: -20 },
        transition: { duration: 0.3 },
        className: "px-4 space-y-6",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white font-orbitron", children: "Privacy" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci le tue preferenze sulla privacy" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-5 h-5 mr-2" }),
              "Raccolta Dati"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Consenso Raccolta Dati" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Autorizza M1SSION™ a raccogliere dati per migliorare l'esperienza utente." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.data_collection,
                    onCheckedChange: handleDataCollectionToggle,
                    disabled: loading
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Analytics" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Consenti l'analisi del comportamento per ottimizzare l'app." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.analytics_enabled,
                    onCheckedChange: handleAnalyticsToggle,
                    disabled: loading
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Marketing" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Ricevi comunicazioni promozionali e offerte personalizzate." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.marketing_consent,
                    onCheckedChange: handleMarketingToggle,
                    disabled: loading
                  }
                )
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-5 h-5 mr-2" }),
              "Preferenze Cookie"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Cookie Essenziali" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Necessari per il funzionamento base dell'applicazione." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.cookie_preferences.essential,
                    onCheckedChange: (enabled) => handleCookiePreferenceChange("essential", enabled),
                    disabled: true
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Cookie Analytics" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Utilizzati per analizzare l'uso dell'app e migliorare le prestazioni." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.cookie_preferences.analytics,
                    onCheckedChange: (enabled) => handleCookiePreferenceChange("analytics", enabled),
                    disabled: loading
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between border-t border-white/10 pt-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-white font-medium", children: "Cookie Marketing" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Per personalizzare annunci e contenuti promozionali." })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    checked: settings.cookie_preferences.marketing,
                    onCheckedChange: (enabled) => handleCookiePreferenceChange("marketing", enabled),
                    disabled: loading
                  }
                )
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-5 h-5 mr-2" }),
              "Informazioni Privacy"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "I tuoi dati sono protetti secondo il Regolamento GDPR e vengono utilizzati esclusivamente per migliorare la tua esperienza con M1SSION™." }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium", children: "Dati Raccolti:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-white/70 text-sm space-y-1 ml-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Informazioni del profilo utente" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Progressi di gioco e indizi completati" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Preferenze dell'applicazione" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Dati di utilizzo anonimi (se autorizzato)" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium", children: "I Tuoi Diritti:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-white/70 text-sm space-y-1 ml-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Accesso ai tuoi dati personali" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Correzione di informazioni inesatte" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Cancellazione del tuo account" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Portabilità dei dati" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  variant: "outline",
                  className: "w-full border-white/20 text-white hover:bg-white/10",
                  children: "Scarica i Miei Dati"
                }
              )
            ] })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

const LegalSettings = () => {
  const { user} = useAuth();
  const { toast } = useToast();
  useWouterNavigation();
  const { profileImage } = useProfileImage();
  const [loading, setLoading] = reactExports.useState(false);
  const legalLinks = [
    {
      title: "Termini di Servizio",
      description: "Condizioni d'uso dell'applicazione M1SSION™",
      url: "/terms",
      icon: FileText
    },
    {
      title: "Privacy Policy",
      description: "Come raccogliamo e utilizziamo i tuoi dati",
      url: "/privacy-policy",
      icon: Shield
    },
    {
      title: "Cookie Policy",
      description: "Come utilizziamo i cookie e tecnologie simili",
      url: "/cookie-policy",
      icon: Settings
    },
    {
      title: "Gestisci preferenze cookie",
      description: "Modifica le tue preferenze sui cookie",
      url: "#consent",
      icon: Settings,
      action: () => window.__consent?.open()
    },
    {
      title: "Regolamento M1SSION™",
      description: "Modalità di gioco, premi, meccaniche e diritti",
      url: "/game-rules",
      icon: FileText
    },
    {
      title: "SafeCreative",
      description: "Certificazione di proprietà intellettuale",
      url: "/safecreative",
      icon: Copyright
    }
  ];
  const handleDeleteAccount = async () => {
    if (!user) return;
    setLoading(true);
    try {
      await supabase.from("user_clues").delete().eq("user_id", user.id);
      await supabase.from("user_buzz_counter").delete().eq("user_id", user.id);
      await supabase.from("user_notifications").delete().eq("user_id", user.id);
      await supabase.from("subscriptions").delete().eq("user_id", user.id);
      await supabase.from("profiles").delete().eq("id", user.id);
      await supabase.auth.signOut();
      localStorage.clear();
      toast({
        title: "✅ Account eliminato",
        description: "Il tuo account e tutti i dati associati sono stati eliminati permanentemente."
      });
      window.location.href = "/login";
    } catch (error) {
      console.error("Account deletion error:", error);
      toast({
        title: "❌ Errore eliminazione account",
        description: error.message || "Impossibile eliminare l'account. Contatta il supporto.",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  const openExternalLink = (url) => {
    if (url.startsWith("/")) {
      window.location.href = url;
    } else if (window.Capacitor) {
      window.Capacitor.Plugins.Browser?.open({ url });
    } else {
      window.open(url, "_blank", "noopener,noreferrer");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage: profileImage || user?.user_metadata?.avatar_url }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        exit: { opacity: 0, y: -20 },
        transition: { duration: 0.3 },
        className: "px-4 space-y-6",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2 mb-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white font-orbitron", children: "Legale" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Documenti legali e informazioni" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-5 h-5 mr-2" }),
              "Documenti Legali"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: legalLinks.map((link, index) => {
              const IconComponent = link.icon;
              return /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "div",
                {
                  className: "flex items-center justify-between p-4 bg-black/20 rounded-lg border border-white/10",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(IconComponent, { className: "w-5 h-5 text-[#00D1FF]" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: link.title }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: link.description })
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Button,
                      {
                        onClick: () => link.action ? link.action() : openExternalLink(link.url),
                        size: "sm",
                        variant: "outline",
                        className: "border-white/20 text-white hover:bg-white/10",
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(ExternalLink, { className: "w-4 h-4" })
                      }
                    )
                  ]
                },
                index
              );
            }) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-white font-orbitron", children: "Informazioni App" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Versione" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-medium", children: "1.0.0" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Build" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-medium", children: "2025.01.12" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Sviluppatore" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-medium", children: "NIYVORA KFT™" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Copyright" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-medium", children: "M1SSION™ 2025" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 p-3 bg-[#00D1FF]/10 rounded-lg border border-[#00D1FF]/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[#00D1FF] text-sm font-medium", children: "M1SSION™ è un'app ufficiale creata e sviluppata da NIYVORA KFT™." }) })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/40 border-[#00D1FF]/20 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "pt-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Hai domande o hai bisogno di assistenza?" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => openExternalLink("mailto:support@m1ssion.app"),
                variant: "outline",
                className: "border-[#00D1FF]/50 text-[#00D1FF] hover:bg-[#00D1FF]/10",
                children: "Contatta il Supporto"
              }
            )
          ] }) }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-red-500/20 backdrop-blur-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center text-red-400", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-5 h-5 mr-2" }),
              "Zona Pericolosa"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "⚠️ L'eliminazione dell'account è permanente e irreversibile. Tutti i tuoi dati, progressi, abbonamenti e acquisti verranno eliminati definitivamente." }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-red-900/20 p-4 rounded-lg border border-red-500/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-red-400 font-semibold mb-2", children: "Verranno eliminati:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-red-300 text-sm space-y-1", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Profilo agente e statistiche" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Indizi completati e cronologia" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Metodi di pagamento e abbonamenti" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "• Tutte le preferenze e impostazioni" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialog, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTrigger, { asChild: true, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "destructive",
                    className: "w-full bg-red-600 hover:bg-red-700",
                    disabled: loading,
                    children: "Elimina Account Permanentemente"
                  }
                ) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogContent, { className: "bg-black/90 border-red-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogHeader, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTitle, { className: "text-white", children: "⚠️ Conferma Eliminazione Account" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogDescription, { className: "text-white/70", children: [
                      "Questa azione è ",
                      /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "IRREVERSIBILE" }),
                      ". Il tuo account M1SSION™ e tutti i dati associati verranno eliminati permanentemente.",
                      /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
                      "Non potrai recuperare progressi, abbonamenti o acquisti dopo la conferma."
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogFooter, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogCancel, { className: "bg-white/10 text-white border-white/20", children: "Annulla" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      AlertDialogAction,
                      {
                        onClick: handleDeleteAccount,
                        className: "bg-red-600 hover:bg-red-700",
                        children: "Elimina Definitivamente"
                      }
                    )
                  ] })
                ] })
              ] })
            ] }) })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        style: {
          position: "fixed",
          bottom: 0,
          left: 0,
          right: 0,
          width: "100vw",
          zIndex: 1e4
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
      }
    )
  ] });
};

function useSafeNavigate() {
  try {
    const [, setLocation] = useLocation();
    return (path) => {
      try {
        setLocation(path);
      } catch {
        window.location.href = path;
      }
    };
  } catch {
    return (path) => {
      window.location.href = path;
    };
  }
}

const STAKE_TYPES = [
  { value: "m1u", label: "M1 Units (M1U)", icon: "💰", description: "Stake your M1U balance" },
  { value: "pulse_energy", label: "Pulse Energy (PE)", icon: "⚡", description: "Stake your Pulse Energy" }
];
const STAKE_PERCENTS = [25, 50, 75];

function SafeSelect({ value, onChange, disabled, className = "" }) {
  const handleChange = (e) => {
    const selectedValue = e.target.value;
    if (STAKE_TYPES.some((t) => t.value === selectedValue)) {
      onChange(selectedValue);
    } else {
      console.warn("⚠️ Invalid stake type value:", selectedValue);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "select",
    {
      "aria-label": "Stake Type",
      value,
      onChange: handleChange,
      disabled,
      className: `w-full rounded-lg bg-gray-700 border border-cyan-500/30 text-white px-3 py-2.5 
        focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500/50
        disabled:opacity-50 disabled:cursor-not-allowed
        hover:border-cyan-500/50 transition-colors
        cursor-pointer ${className}`,
      style: {
        backgroundImage: `url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,
        backgroundPosition: "right 0.5rem center",
        backgroundRepeat: "no-repeat",
        backgroundSize: "1.5em 1.5em",
        paddingRight: "2.5rem"
      },
      children: STAKE_TYPES.map((type) => /* @__PURE__ */ jsxRuntimeExports.jsxs("option", { value: type.value, children: [
        type.icon,
        " ",
        type.label
      ] }, type.value))
    }
  );
}

async function createBattle(payload) {
  const { data: sessionData } = await supabase.auth.getSession();
  const token = sessionData?.session?.access_token;
  if (!token) {
    throw new Error("Authentication required - please sign in");
  }
  const headers = {
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token}`
  };
  const { data, error } = await supabase.functions.invoke("battle-create", {
    body: payload,
    headers
  });
  if (error) {
    console.error("❌ Edge function error:", error);
    const errorData = error.context?.body;
    const status = error.status || error.context?.status || "n/a";
    const code = errorData?.code || error.code || error.name || "EDGE_ERROR";
    const hint = errorData?.hint || errorData?.error || error.message || "Edge function returned non-2xx status";
    throw new Error(`${code} [${status}]: ${hint}`);
  }
  if (!data) {
    throw new Error("EMPTY_RESPONSE [500]: No data returned from edge function");
  }
  if (!data.success) {
    const errorCode = data.code || "BATTLE_FAILED";
    const errorHint = data.error || data.hint || "Battle creation failed";
    throw new Error(`${errorCode}: ${errorHint}`);
  }
  return data;
}
async function acceptBattle(battleId) {
  const { data: sessionData } = await supabase.auth.getSession();
  const token = sessionData?.session?.access_token;
  if (!token) {
    throw new Error("Authentication required - please sign in");
  }
  const headers = {
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token}`
  };
  const { data, error } = await supabase.functions.invoke("battle-accept", {
    body: { battle_id: battleId },
    headers
  });
  if (error) {
    const errorData = error.context?.body;
    const status = error.status || "n/a";
    const code = errorData?.code || error.code || error.name || "EDGE_ERROR";
    const hint = errorData?.hint || errorData?.error || error.message || "Unknown error";
    throw new Error(`${code} [${status}]: ${hint}`);
  }
  if (!data?.success) {
    const errorCode = data.code || "ACCEPT_FAILED";
    const errorHint = data.error || data.hint || "Battle accept failed";
    throw new Error(`${errorCode}: ${errorHint}`);
  }
}
async function getRandomOpponent() {
  const { data: sessionData } = await supabase.auth.getSession();
  const token = sessionData?.session?.access_token;
  if (!token) {
    throw new Error("Authentication required - please sign in");
  }
  const headers = {
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token}`
  };
  const { data, error } = await supabase.functions.invoke("battle-random-opponent", {
    headers
  });
  if (error) {
    const errorData = error.context?.body;
    const status = error.status || "n/a";
    const code = errorData?.code || error.code || error.name || "EDGE_ERROR";
    const hint = errorData?.hint || errorData?.error || error.message || "Unknown error";
    throw new Error(`${code} [${status}]: ${hint}`);
  }
  if (!data || !data.opponent_id) {
    const errorCode = data?.code || "NO_OPPONENT_FOUND";
    const errorHint = data?.error || "No eligible opponents available";
    throw new Error(`${errorCode}: ${errorHint}`);
  }
  return data;
}

class ErrorBoundary extends React$1.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }
  componentDidCatch(error, errorInfo) {
    console.error("⚠️ Battle Panel Error Boundary caught:", error, errorInfo);
  }
  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-6 bg-red-500/10 border border-red-500/30 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-red-400 font-semibold mb-1", children: "Battle Panel Error" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300/80 text-sm", children: this.state.error?.message || "An unexpected error occurred" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: () => this.setState({ hasError: false, error: void 0 }),
              className: "mt-3 text-xs text-red-200 hover:text-red-100 underline",
              children: "Try again"
            }
          )
        ] })
      ] }) });
    }
    return this.props.children;
  }
}

const BOT_LEVELS = {
  easy: { min: 350, max: 500, name: "Rookie Bot", color: "text-green-400" },
  medium: { min: 250, max: 400, name: "Agent Bot", color: "text-yellow-400" },
  hard: { min: 180, max: 300, name: "Elite Bot", color: "text-orange-400" },
  extreme: { min: 120, max: 220, name: "TRON Master", color: "text-red-400" }
};
function PracticeMode({ userId, onClose }) {
  const [gameState, setGameState] = reactExports.useState("idle");
  const [countdown, setCountdown] = reactExports.useState(3);
  const [myReaction, setMyReaction] = reactExports.useState(null);
  const [botReaction, setBotReaction] = reactExports.useState(null);
  const [winner, setWinner] = reactExports.useState(null);
  const [botLevel, setBotLevel] = reactExports.useState("medium");
  const [stats, setStats] = reactExports.useState({ wins: 0, losses: 0, bestTime: 0, avgTime: 0, totalGames: 0 });
  const [recentTimes, setRecentTimes] = reactExports.useState([]);
  const flashTimeRef = reactExports.useRef(0);
  const waitingTimeoutRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    const saved = localStorage.getItem(`practice_stats_${userId}`);
    if (saved) {
      setStats(JSON.parse(saved));
    }
    const savedTimes = localStorage.getItem(`practice_times_${userId}`);
    if (savedTimes) {
      setRecentTimes(JSON.parse(savedTimes));
    }
  }, [userId]);
  const saveStats = reactExports.useCallback((newStats, newTimes) => {
    localStorage.setItem(`practice_stats_${userId}`, JSON.stringify(newStats));
    localStorage.setItem(`practice_times_${userId}`, JSON.stringify(newTimes.slice(-20)));
  }, [userId]);
  const startGame = () => {
    setGameState("countdown");
    setCountdown(3);
    setMyReaction(null);
    setBotReaction(null);
    setWinner(null);
  };
  reactExports.useEffect(() => {
    if (gameState !== "countdown") return;
    if (countdown > 0) {
      const timer = setTimeout(() => setCountdown((c) => c - 1), 1e3);
      return () => clearTimeout(timer);
    } else {
      setGameState("waiting");
    }
  }, [gameState, countdown]);
  reactExports.useEffect(() => {
    if (gameState !== "waiting") return;
    const delay = 2e3 + Math.random() * 6e3;
    console.log(`[Practice] Flash will appear in ${Math.round(delay)}ms`);
    const timer = setTimeout(() => {
      console.log("[Practice] FLASH!");
      flashTimeRef.current = Date.now();
      const bot2 = BOT_LEVELS[botLevel];
      const botTime = Math.round(bot2.min + Math.random() * (bot2.max - bot2.min));
      setBotReaction(botTime);
      setGameState("flash");
    }, delay);
    waitingTimeoutRef.current = timer;
    return () => {
      clearTimeout(timer);
    };
  }, [gameState, botLevel]);
  const handleTap = () => {
    console.log("[Practice] Tap! State:", gameState);
    if (gameState === "waiting") {
      console.log("[Practice] Too early!");
      if (waitingTimeoutRef.current) {
        clearTimeout(waitingTimeoutRef.current);
        waitingTimeoutRef.current = null;
      }
      setGameState("too_early");
      return;
    }
    if (gameState === "flash") {
      const reaction = Date.now() - flashTimeRef.current;
      setMyReaction(reaction);
      const botTime = botReaction || 999;
      const playerWon = reaction < botTime;
      setWinner(playerWon ? "player" : "bot");
      const newTimes = [...recentTimes, reaction];
      const newStats = {
        wins: stats.wins + (playerWon ? 1 : 0),
        losses: stats.losses + (playerWon ? 0 : 1),
        bestTime: stats.bestTime === 0 ? reaction : Math.min(stats.bestTime, reaction),
        avgTime: Math.round(newTimes.reduce((a, b) => a + b, 0) / newTimes.length),
        totalGames: stats.totalGames + 1
      };
      setStats(newStats);
      setRecentTimes(newTimes);
      saveStats(newStats, newTimes);
      setGameState("result");
      if ("vibrate" in navigator) {
        navigator.vibrate(playerWon ? [50, 30, 50] : [100]);
      }
    }
  };
  const playBeep = (freq = 800, duration = 100) => {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.frequency.value = freq;
      osc.type = "sine";
      gain.gain.setValueAtTime(0.3, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration / 1e3);
      osc.start();
      osc.stop(ctx.currentTime + duration / 1e3);
    } catch (e) {
    }
  };
  reactExports.useEffect(() => {
    if (gameState === "countdown" && countdown > 0) {
      playBeep(600 + (3 - countdown) * 200, 100);
    }
    if (gameState === "flash") {
      playBeep(1200, 150);
    }
  }, [gameState, countdown]);
  const bot = BOT_LEVELS[botLevel];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: `w-5 h-5 ${bot.color}` }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `font-semibold ${bot.color}`, children: bot.name })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-1", children: Object.keys(BOT_LEVELS).map((level) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          size: "sm",
          variant: botLevel === level ? "default" : "outline",
          onClick: () => setBotLevel(level),
          disabled: gameState !== "idle" && gameState !== "result" && gameState !== "too_early",
          className: `text-xs px-2 h-7 ${botLevel === level ? "bg-cyan-600" : ""}`,
          children: level.charAt(0).toUpperCase()
        },
        level
      )) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 gap-2 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 rounded-lg bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[10px] text-gray-400", children: "Wins" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-green-400", children: stats.wins })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 rounded-lg bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[10px] text-gray-400", children: "Losses" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg font-bold text-red-400", children: stats.losses })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 rounded-lg bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[10px] text-gray-400", children: "Best" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg font-bold text-cyan-400", children: [
          stats.bestTime || "-",
          "ms"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 rounded-lg bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-[10px] text-gray-400", children: "Avg" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg font-bold text-purple-400", children: [
          stats.avgTime || "-",
          "ms"
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "relative h-64 rounded-2xl overflow-hidden cursor-pointer select-none",
        onClick: handleTap,
        style: {
          background: gameState === "flash" ? "linear-gradient(135deg, #00ff00 0%, #00ffff 100%)" : gameState === "too_early" ? "linear-gradient(135deg, #ff0000 0%, #ff4444 100%)" : "linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",
          boxShadow: gameState === "flash" ? "0 0 60px rgba(0,255,255,0.8), inset 0 0 60px rgba(0,255,0,0.4)" : "0 0 30px rgba(0,0,0,0.5)",
          transition: "background 0.05s, box-shadow 0.05s"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(AnimatePresence, { mode: "wait", children: [
          gameState === "idle" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              exit: { opacity: 0 },
              className: "absolute inset-0 flex flex-col items-center justify-center",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-16 h-16 text-cyan-400 mb-4" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-lg font-semibold mb-2", children: "Practice Mode" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-400 text-sm mb-4", children: [
                  "Train against ",
                  bot.name
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: startGame, className: "bg-cyan-500 hover:bg-cyan-600", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "mr-2 h-4 w-4" }),
                  "Start Training"
                ] })
              ]
            },
            "idle"
          ),
          gameState === "countdown" && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { scale: 0.5, opacity: 0 },
              animate: { scale: 1, opacity: 1 },
              exit: { scale: 1.5, opacity: 0 },
              className: "absolute inset-0 flex items-center justify-center",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  initial: { scale: 2, opacity: 0 },
                  animate: { scale: 1, opacity: 1 },
                  className: "text-8xl font-bold text-white",
                  style: { textShadow: "0 0 30px rgba(0,212,255,0.8)" },
                  children: countdown
                },
                countdown
              )
            },
            "countdown"
          ),
          gameState === "waiting" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              exit: { opacity: 0 },
              className: "absolute inset-0 flex flex-col items-center justify-center",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { scale: [1, 1.1, 1] },
                    transition: { duration: 1, repeat: Infinity },
                    className: "w-20 h-20 rounded-full border-4 border-cyan-400/50 flex items-center justify-center",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-full bg-cyan-400/20" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 mt-4 text-lg", children: "Wait for GREEN..." })
              ]
            },
            "waiting"
          ),
          gameState === "flash" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { scale: 0.8 },
              animate: { scale: 1 },
              className: "absolute inset-0 flex flex-col items-center justify-center",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    animate: { scale: [1, 1.2, 1] },
                    transition: { duration: 0.2, repeat: Infinity },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-24 h-24 text-black" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-black text-3xl font-bold mt-4", children: "TAP NOW!" })
              ]
            },
            "flash"
          ),
          gameState === "too_early" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              className: "absolute inset-0 flex flex-col items-center justify-center",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-3xl font-bold mb-4", children: "TOO EARLY! ❌" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 mb-6", children: "Wait for the green flash" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: startGame, variant: "outline", className: "border-white text-white", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "mr-2 h-4 w-4" }),
                  "Try Again"
                ] })
              ]
            },
            "too_early"
          ),
          gameState === "result" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0, y: 20 },
              animate: { opacity: 1, y: 0 },
              className: "absolute inset-0 flex flex-col items-center justify-center p-4",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-6xl mb-2", children: winner === "player" ? "🏆" : "💀" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: `text-2xl font-bold mb-4 ${winner === "player" ? "text-green-400" : "text-red-400"}`, children: winner === "player" ? "YOU WIN!" : "BOT WINS!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-6 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-400", children: "You" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: `text-2xl font-bold ${winner === "player" ? "text-green-400" : "text-white"}`, children: [
                      myReaction,
                      "ms"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-400", children: bot.name }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: `text-2xl font-bold ${winner === "bot" ? "text-red-400" : "text-white"}`, children: [
                      botReaction,
                      "ms"
                    ] })
                  ] })
                ] }),
                myReaction && myReaction < 200 && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-yellow-500/20 text-yellow-400 border-yellow-500/30 mb-4", children: "⚡ Lightning Fast!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: startGame, className: "bg-cyan-500 hover:bg-cyan-600", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "mr-2 h-4 w-4" }),
                  "Play Again"
                ] })
              ]
            },
            "result"
          )
        ] })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center text-xs text-gray-500", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "💡 Pro tip: Focus on the center and use your peripheral vision" }) })
  ] });
}

function BattleLobby() {
  const navigate = useSafeNavigate();
  const { toast } = useToast();
  const [userId, setUserId] = reactExports.useState(null);
  const [stakeType, setStakeType] = reactExports.useState("m1u");
  const [stakePercentage, setStakePercentage] = reactExports.useState(25);
  const [opponentHandle, setOpponentHandle] = reactExports.useState("");
  const [opponentId, setOpponentId] = reactExports.useState("");
  const [submitting, setSubmitting] = reactExports.useState(false);
  const [loadingRandom, setLoadingRandom] = reactExports.useState(false);
  const [pendingBattles, setPendingBattles] = reactExports.useState([]);
  const [myBattles, setMyBattles] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(false);
  const [stats, setStats] = reactExports.useState(null);
  const [topAgents, setTopAgents] = reactExports.useState([]);
  const stakeValid = STAKE_TYPES.some((t) => t.value === stakeType);
  const percentValid = STAKE_PERCENTS.includes(stakePercentage);
  const opponentValid = opponentHandle.trim().length > 0 || opponentId.trim().length > 0;
  const canCreate = stakeValid && percentValid && opponentValid && !submitting;
  reactExports.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      if (data.user) {
        setUserId(data.user.id);
        loadBattles(data.user.id);
        loadStats(data.user.id);
        loadTopAgents();
      }
    });
    const channel = supabase.channel("battles").on("postgres_changes", { event: "*", schema: "public", table: "battles" }, () => {
      if (userId) loadBattles(userId);
    }).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, [userId]);
  const loadBattles = async (uid) => {
    const { data: pending } = await supabase.from("battles").select("*, creator:profiles!battles_creator_id_fkey(agent_code), opponent:profiles!battles_opponent_id_fkey(agent_code)").eq("status", "pending").eq("opponent_id", uid);
    const { data: myActive } = await supabase.from("battles").select("*, creator:profiles!battles_creator_id_fkey(agent_code), opponent:profiles!battles_opponent_id_fkey(agent_code)").or(`creator_id.eq.${uid},opponent_id.eq.${uid}`).in("status", ["pending", "accepted", "countdown", "active"]).order("created_at", { ascending: false });
    setPendingBattles(pending || []);
    setMyBattles(myActive || []);
  };
  const loadStats = async (uid) => {
    try {
      const { data: battles } = await supabase.from("battles").select("*").or(`creator_id.eq.${uid},opponent_id.eq.${uid}`).eq("status", "resolved");
      if (battles) {
        const total = battles.length;
        const wins = battles.filter((b) => b.winner_id === uid).length;
        const winRate = total > 0 ? Math.round(wins / total * 100) : 0;
        const reactions = battles.map((b) => b.creator_id === uid ? b.creator_reaction_ms : b.opponent_reaction_ms).filter((ms) => ms !== null && ms !== void 0);
        const avgReaction = reactions.length > 0 ? Math.round(reactions.reduce((a, b) => a + b, 0) / reactions.length) : 0;
        const fastest = reactions.length > 0 ? Math.min(...reactions) : 0;
        setStats({
          total_battles: total,
          win_rate_percentage: winRate,
          avg_reaction_ms: avgReaction,
          fastest_reaction_ms: fastest
        });
      }
    } catch (error) {
      console.error("⚠️ Stats calculation error:", error);
      setStats(null);
    }
  };
  const loadTopAgents = async () => {
    try {
      const { data, error } = await supabase.rpc("get_top_agents");
      if (error) throw error;
      setTopAgents(data || []);
    } catch (error) {
      console.error("⚠️ Failed to load top agents:", error);
      setTopAgents([]);
    }
  };
  const handleRandomOpponent = async () => {
    setLoadingRandom(true);
    try {
      const opponent = await getRandomOpponent();
      setOpponentId(opponent.opponent_id);
      setOpponentHandle(opponent.opponent_name);
      toast({
        title: "🎲 Random Opponent Found",
        description: `Matched with ${opponent.opponent_name}`
      });
    } catch (error) {
      console.error("⚠️ Random opponent error:", error?.message);
      toast({
        title: "No Opponent Found",
        description: error?.message || "Try again later",
        variant: "destructive"
      });
    } finally {
      setLoadingRandom(false);
    }
  };
  const handleSelectTopAgent = (agent) => {
    setOpponentId(agent.id);
    setOpponentHandle(agent.username || agent.agent_code);
    toast({
      title: "👑 Top Agent Selected",
      description: `Challenge ${agent.username || agent.agent_code}`
    });
  };
  const handleCreateBattle = async () => {
    if (!canCreate || !userId) return;
    setSubmitting(true);
    try {
      const payload = {
        stake_type: stakeType,
        stake_percentage: stakePercentage
      };
      if (opponentId) {
        payload.opponent_id = opponentId;
      } else {
        payload.opponent_handle = opponentHandle.trim();
      }
      const result = await createBattle(payload);
      toast({
        title: "⚔️ Battle Created!",
        description: `Arena: ${result.arena_name} | Stake: ${result.stake_amount} ${stakeType}`
      });
      setOpponentHandle("");
      setOpponentId("");
      if (result.battle_id) {
        navigate(`/battle/${result.battle_id}`);
      } else {
        loadBattles(userId);
      }
    } catch (error) {
      console.error("⚠️ Battle creation error:", error);
      let errorMsg = "Unknown error occurred";
      if (error?.message) {
        const match = error.message.match(/([A-Z_]+)\s*\[(\d+)\]:\s*(.+)/);
        if (match) {
          errorMsg = `${match[1]}: ${match[3]}`;
        } else {
          errorMsg = error.message;
        }
      }
      toast({
        title: "Battle Creation Failed",
        description: errorMsg,
        variant: "destructive"
      });
    } finally {
      setSubmitting(false);
    }
  };
  const handleAcceptBattle = async (battleId) => {
    setLoading(true);
    try {
      await acceptBattle(battleId);
      toast({
        title: "✅ Battle Accepted!",
        description: "Entering arena..."
      });
      navigate(`/battle/${battleId}`);
    } catch (error) {
      console.error("⚠️ Battle accept error:", error?.message);
      toast({
        title: "Accept Failed",
        description: error?.message || "Unknown error occurred",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-auto max-h-[70vh] overflow-y-auto custom-scrollbar bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 p-6 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: -20 },
        animate: { opacity: 1, y: 0 },
        className: "text-center mb-8",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-4xl font-orbitron font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 mb-2", children: "M1SSION BATTLE ARENA" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 text-base", children: "Enter the grid. Test your reaction." })
        ]
      }
    ),
    stats && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gray-800/50 border-cyan-500/30 mb-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-cyan-400 flex items-center gap-2 text-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-5 h-5" }),
        "Your Stats"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: "Win Rate" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xl font-bold text-white", children: [
            stats.win_rate_percentage,
            "%"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: "Battles" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xl font-bold text-white", children: stats.total_battles })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: "Avg Reaction" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xl font-bold text-cyan-400", children: [
            stats.avg_reaction_ms,
            "ms"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: "Fastest" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xl font-bold text-green-400", children: [
            stats.fastest_reaction_ms,
            "ms"
          ] })
        ] })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "practice", className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-5 bg-gray-800/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "practice", className: "gap-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-3 h-3" }),
          "Practice"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "create", children: "Create" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "top", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "w-3 h-3 mr-1" }),
          "Top"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "pending", children: [
          "(",
          pendingBattles.length,
          ")"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "active", children: [
          "(",
          myBattles.length,
          ")"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "practice", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-cyan-400 flex items-center gap-2 text-lg", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-5 h-5" }),
            "Training Arena"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { className: "text-sm", children: "Practice your reaction time against AI opponents" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: userId && /* @__PURE__ */ jsxRuntimeExports.jsx(PracticeMode, { userId }) })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "create", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-cyan-400 text-lg", children: "Create New Battle" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { className: "text-sm", children: "Challenge an opponent with your stake" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(ErrorBoundary, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm text-gray-400 mb-2 block", children: "Opponent Handle or Agent Code" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  placeholder: "e.g., AGENT-001 or @username",
                  className: "bg-gray-700 border-cyan-500/30 text-white placeholder:text-gray-500 flex-1",
                  value: opponentHandle,
                  onChange: (e) => {
                    setOpponentHandle(e.target.value);
                    setOpponentId("");
                  },
                  disabled: submitting || loadingRandom
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Button,
                {
                  onClick: handleRandomOpponent,
                  disabled: loadingRandom || submitting,
                  variant: "outline",
                  className: "bg-purple-600/20 border-purple-500/30 hover:bg-purple-600/40",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Shuffle, { className: "w-4 h-4 mr-1" }),
                    "Random"
                  ]
                }
              )
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm text-gray-400 mb-2 block", children: "Stake Type" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              SafeSelect,
              {
                value: stakeType,
                onChange: setStakeType,
                disabled: submitting || loadingRandom
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "text-sm text-gray-400 mb-2 block", children: "Stake Amount (%)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-3 gap-3", children: STAKE_PERCENTS.map((pct) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: stakePercentage === pct ? "default" : "outline",
                onClick: () => setStakePercentage(pct),
                disabled: submitting,
                className: stakePercentage === pct ? "bg-cyan-500 hover:bg-cyan-600" : "",
                children: [
                  pct,
                  "%"
                ]
              },
              pct
            )) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: handleCreateBattle,
              disabled: !canCreate,
              size: "lg",
              className: "w-full bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Swords, { className: "mr-2" }),
                submitting ? "Creating Battle..." : "Create Battle"
              ]
            }
          ),
          !canCreate && !submitting && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-gray-500 text-center", children: [
            !opponentValid && "Enter opponent or pick random • ",
            !stakeValid && "Select stake type • ",
            !percentValid && "Select stake percentage"
          ] })
        ] }) })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "top", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-yellow-400 flex items-center gap-2 text-lg", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "w-5 h-5" }),
            "Top Agents"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { className: "text-sm", children: "Challenge the best players" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: topAgents.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8 text-gray-400", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-10 h-10 mx-auto mb-3 opacity-30" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: "No rankings yet" })
        ] }) : topAgents.map((agent, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, x: -20 },
            animate: { opacity: 1, x: 0 },
            transition: { delay: index * 0.05 },
            className: "flex items-center justify-between p-3 rounded-lg bg-gray-700/30 border border-gray-600/30 hover:border-yellow-500/50 transition-all",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${index === 0 ? "bg-yellow-500 text-black" : index === 1 ? "bg-gray-400 text-black" : index === 2 ? "bg-orange-600 text-white" : "bg-gray-600 text-white"}`, children: [
                  "#",
                  index + 1
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-bold text-sm", children: agent.username || agent.agent_code || "Agent" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-400 text-xs", children: [
                    agent.wins,
                    " wins • ELO ",
                    agent.elo
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: () => handleSelectTopAgent(agent),
                  size: "sm",
                  variant: "outline",
                  className: "bg-yellow-600/20 border-yellow-500/30 hover:bg-yellow-600/40 text-yellow-400",
                  children: "Challenge"
                }
              )
            ]
          },
          agent.id
        )) }) })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "pending", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: pendingBattles.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-12 text-center text-gray-400", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-12 h-12 mx-auto mb-4 opacity-50" }),
        "No pending challenges"
      ] }) }) : pendingBattles.map((battle) => /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "py-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white font-bold", children: [
            "Challenge from ",
            battle.creator?.agent_code || "Unknown"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-cyan-400 text-sm", children: [
            "Stake: ",
            battle.stake_amount,
            " ",
            battle.stake_type,
            " (",
            battle.stake_percentage,
            "%)"
          ] }),
          battle.arena_name && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-xs", children: battle.arena_name })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: () => handleAcceptBattle(battle.id),
            disabled: loading,
            className: "bg-green-600 hover:bg-green-700",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "mr-2 w-4 h-4" }),
              "Accept"
            ]
          }
        )
      ] }) }) }, battle.id)) }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "active", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: myBattles.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "py-12 text-center text-gray-400", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-12 h-12 mx-auto mb-4 opacity-50" }),
        "No active battles"
      ] }) }) : myBattles.map((battle) => /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-gray-800/50 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "py-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white font-bold", children: battle.creator_id === userId ? "vs " + (battle.opponent?.agent_code || "Opponent") : "vs " + (battle.creator?.agent_code || "Creator") }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-cyan-400 text-sm capitalize", children: [
            "Status: ",
            battle.status
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: () => navigate(`/battle/${battle.id}`),
            className: "bg-purple-600 hover:bg-purple-700",
            children: "Enter Arena"
          }
        )
      ] }) }) }, battle.id)) }) })
    ] })
  ] }) });
}

const BattleLobby$1 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: BattleLobby
}, Symbol.toStringTag, { value: 'Module' }));

function TronDisc({ isActive, isFlashing, onClick, disabled }) {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      className: "relative w-64 h-64 cursor-pointer select-none",
      onClick: disabled ? void 0 : onClick,
      whileHover: disabled ? {} : { scale: 1.1 },
      whileTap: disabled ? {} : { scale: 0.95 },
      animate: {
        rotate: isActive ? 360 : 0,
        scale: isFlashing ? [1, 1.2, 1] : 1
      },
      transition: {
        rotate: { duration: 2, repeat: Infinity, ease: "linear" },
        scale: isFlashing ? { duration: 0.5, repeat: 3 } : {}
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute inset-0 rounded-full bg-gradient-to-br from-cyan-500/30 via-blue-500/20 to-purple-500/30 blur-xl",
            animate: {
              opacity: isFlashing ? [0.5, 1, 0.5] : [0.3, 0.6, 0.3]
            },
            transition: {
              duration: 2,
              repeat: Infinity,
              ease: "easeInOut"
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative w-full h-full rounded-full bg-gradient-to-br from-cyan-500 via-blue-600 to-purple-600 shadow-2xl shadow-cyan-500/50", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-4 rounded-full border-4 border-cyan-400/50" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-8 rounded-full border-2 border-blue-400/30" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-12 rounded-full bg-gradient-to-br from-cyan-600/80 to-blue-700/80" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              animate: {
                rotate: isActive ? -360 : 0,
                scale: isFlashing ? [1, 1.3, 1] : 1
              },
              transition: {
                rotate: { duration: 2, repeat: Infinity, ease: "linear" }
              },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-16 h-16 text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.8)]" })
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "absolute inset-0 rounded-full",
              animate: { rotate: 360 },
              transition: { duration: 4, repeat: Infinity, ease: "linear" },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-1/2 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-cyan-300 to-transparent" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-1/2 w-0.5 h-full bg-gradient-to-b from-transparent via-blue-300 to-transparent" })
              ]
            }
          ),
          isFlashing && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "absolute inset-0 rounded-full bg-white",
              initial: { opacity: 0 },
              animate: { opacity: [0, 0.8, 0] },
              transition: { duration: 0.6, times: [0, 0.5, 1] }
            }
          )
        ] }),
        isActive && !disabled && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            className: "absolute -bottom-12 left-1/2 -translate-x-1/2 text-cyan-400 font-bold text-xl tracking-wider",
            initial: { opacity: 0, y: -10 },
            animate: { opacity: [0.5, 1, 0.5], y: 0 },
            transition: { duration: 1, repeat: Infinity },
            children: "TAP NOW!"
          }
        )
      ]
    }
  );
}

function useBattleRealtime({
  battleId,
  onBattleUpdate,
  onCountdownStart,
  onFlash,
  onResolved
}) {
  const [channel, setChannel] = reactExports.useState(null);
  const [connected, setConnected] = reactExports.useState(false);
  reactExports.useEffect(() => {
    if (!battleId) return;
    const battleChannel = supabase.channel(`battle:${battleId}`, {
      config: { broadcast: { ack: true } }
    });
    battleChannel.on("postgres_changes", {
      event: "UPDATE",
      schema: "public",
      table: "battles",
      filter: `id=eq.${battleId}`
    }, (payload) => {
      const battle = payload.new;
      onBattleUpdate?.(battle);
      if (battle.status === "countdown" && battle.countdown_start_at && battle.flash_at) {
        onCountdownStart?.(battle.countdown_start_at, battle.flash_at);
      }
      if (battle.status === "resolved" && battle.winner_id) {
        onResolved?.(battle.winner_id);
      }
    }).subscribe((status) => {
      if (status === "SUBSCRIBED") {
        setConnected(true);
        emitSubscribed(`battle:${battleId}`);
        console.log(`✅ Subscribed to battle:${battleId}`);
      } else if (status === "CLOSED") {
        setConnected(false);
      } else if (status === "CHANNEL_ERROR" || status === "TIMED_OUT") {
        emitError(String(status), `battle:${battleId}`);
      }
    });
    setChannel(battleChannel);
    return () => {
      battleChannel.unsubscribe();
      setConnected(false);
    };
  }, [battleId, onBattleUpdate, onCountdownStart, onResolved]);
  const broadcast = reactExports.useCallback(
    async (event, payload) => {
      if (!channel) return;
      await channel.send({
        type: "broadcast",
        event,
        payload
      });
    },
    [channel]
  );
  return { connected, broadcast };
}

function BattleArena({ battleId: battleIdProp } = {}) {
  const params = useParams$1();
  const battleId = battleIdProp || params.battleId;
  const navigate = useSafeNavigate();
  const { toast } = useToast();
  const [status, setStatus] = reactExports.useState("waiting");
  const [countdown, setCountdown] = reactExports.useState(null);
  const [isFlashing, setIsFlashing] = reactExports.useState(false);
  const [myReactionMs, setMyReactionMs] = reactExports.useState(null);
  const [winnerId, setWinnerId] = reactExports.useState(null);
  const [battle, setBattle] = reactExports.useState(null);
  const [userId, setUserId] = reactExports.useState(null);
  reactExports.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      setUserId(data.user?.id || null);
    });
  }, []);
  const { connected } = useBattleRealtime({
    battleId: battleId || null,
    onBattleUpdate: (updatedBattle) => {
      setBattle(updatedBattle);
    },
    onCountdownStart: (countdownStartAt, flashAt) => {
      const startTime = new Date(countdownStartAt).getTime();
      const flashTime = new Date(flashAt).getTime();
      const now = Date.now();
      if (startTime > now) {
        setTimeout(() => {
          setStatus("countdown");
          startCountdownTimer(flashTime);
        }, startTime - now);
      } else {
        setStatus("countdown");
        startCountdownTimer(flashTime);
      }
    },
    onResolved: (winnerIdResolved) => {
      setWinnerId(winnerIdResolved);
      setStatus("resolved");
    }
  });
  const startCountdownTimer = (flashTime) => {
    const interval = setInterval(() => {
      const remaining = Math.max(0, Math.ceil((flashTime - Date.now()) / 1e3));
      setCountdown(remaining);
      if (remaining === 0) {
        clearInterval(interval);
        triggerFlash();
      }
    }, 100);
  };
  const triggerFlash = (flashTime) => {
    setIsFlashing(true);
    setStatus("active");
    toast({ title: "⚡ FLASH!", description: "Tap now!", duration: 1e3 });
    setTimeout(() => setIsFlashing(false), 500);
  };
  const handleTap = async () => {
    if (status !== "active" || !battleId || !userId) return;
    const clientTapAt = (/* @__PURE__ */ new Date()).toISOString();
    setStatus("tapped");
    if ("vibrate" in navigator) {
      navigator.vibrate([50, 30, 50]);
    }
    const pingStart = Date.now();
    await supabase.from("battles").select("id").eq("id", battleId).single();
    const pingMs = Date.now() - pingStart;
    const { data, error } = await supabase.functions.invoke("battle-tap-commit", {
      body: {
        battle_id: battleId,
        client_tap_at: clientTapAt,
        ping_ms: pingMs
      }
    });
    if (error) {
      toast({ title: "Error", description: error.message, variant: "destructive" });
      return;
    }
    setMyReactionMs(data.reaction_ms);
    toast({ title: `⚡ ${data.reaction_ms}ms!`, description: "Reaction recorded" });
    setTimeout(async () => {
      await supabase.functions.invoke("battle-resolve", {
        body: { battle_id: battleId }
      });
    }, 2e3);
  };
  const handleReady = async () => {
    if (!battleId) return;
    const { error } = await supabase.functions.invoke("battle-ready", {
      body: { battle_id: battleId }
    });
    if (error) {
      toast({ title: "Error", description: error.message, variant: "destructive" });
    }
  };
  if (!battleId) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white", children: "Invalid battle ID" }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 relative overflow-hidden", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 opacity-20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0", style: {
      backgroundImage: "linear-gradient(cyan 1px, transparent 1px), linear-gradient(90deg, cyan 1px, transparent 1px)",
      backgroundSize: "50px 50px"
    } }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative z-10 min-h-screen flex flex-col items-center justify-center p-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-8 left-1/2 -translate-x-1/2 flex items-center gap-2 text-cyan-400", children: connected ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-green-500 rounded-full animate-pulse" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Connected" })
      ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-red-500 rounded-full" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Connecting..." })
      ] }) }),
      battle?.arena_name && /* @__PURE__ */ jsxRuntimeExports.jsx(
        motion.div,
        {
          initial: { opacity: 0, y: -20 },
          animate: { opacity: 1, y: 0 },
          className: "text-3xl font-bold text-cyan-400 mb-8 tracking-wider",
          children: battle.arena_name
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(AnimatePresence, { mode: "wait", children: [
        status === "waiting" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            exit: { opacity: 0 },
            className: "flex flex-col items-center gap-8",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-4xl font-bold text-white mb-4", children: "Get Ready" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400", children: "Prepare for battle" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleReady, size: "lg", className: "bg-cyan-500 hover:bg-cyan-600", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "mr-2" }),
                "I'm Ready"
              ] })
            ]
          },
          "waiting"
        ),
        status === "countdown" && countdown !== null && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0 },
            animate: { scale: 1 },
            exit: { scale: 0 },
            className: "flex flex-col items-center gap-8",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-16 h-16 text-cyan-400 animate-pulse" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-9xl font-bold text-white", children: countdown }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 text-xl", children: "Get ready to tap..." })
            ]
          },
          "countdown"
        ),
        (status === "active" || status === "tapped") && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0 },
            animate: { scale: 1 },
            className: "flex flex-col items-center gap-4",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                TronDisc,
                {
                  isActive: status === "active",
                  isFlashing,
                  onClick: handleTap,
                  disabled: status === "tapped"
                }
              ),
              status === "tapped" && myReactionMs && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  initial: { opacity: 0, y: 20 },
                  animate: { opacity: 1, y: 0 },
                  className: "text-3xl font-bold text-cyan-400",
                  children: [
                    myReactionMs,
                    "ms"
                  ]
                }
              )
            ]
          },
          "active"
        ),
        status === "resolved" && winnerId && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0 },
            animate: { scale: 1 },
            className: "flex flex-col items-center gap-8",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Trophy, { className: "w-32 h-32 text-yellow-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-5xl font-bold text-white", children: winnerId === userId ? "VICTORY!" : "DEFEAT" }),
              battle && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-cyan-400 text-xl mb-2", children: "Reaction Times" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-8", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "You" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white text-2xl font-bold", children: [
                      battle.creator_id === userId ? battle.creator_reaction_ms : battle.opponent_reaction_ms,
                      "ms"
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Opponent" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white text-2xl font-bold", children: [
                      battle.creator_id === userId ? battle.opponent_reaction_ms : battle.creator_reaction_ms,
                      "ms"
                    ] })
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: () => navigate("/battle"), size: "lg", className: "bg-purple-600 hover:bg-purple-700", children: "Back to Lobby" })
            ]
          },
          "resolved"
        )
      ] })
    ] })
  ] });
}

const BattleArena$1 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: BattleArena
}, Symbol.toStringTag, { value: 'Module' }));

function BattleTest() {
  const { toast } = useToast();
  const [userId, setUserId] = reactExports.useState(null);
  const [testSteps, setTestSteps] = reactExports.useState([]);
  const [isRunning, setIsRunning] = reactExports.useState(false);
  const [battleId, setBattleId] = reactExports.useState(null);
  const [dbStats, setDbStats] = reactExports.useState(null);
  reactExports.useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      if (data.user) {
        setUserId(data.user.id);
        loadDbStats();
      }
    });
  }, []);
  const loadDbStats = async () => {
    const { data: battles } = await supabase.from("battles").select("status");
    const { data: transfers } = await supabase.from("battle_transfers").select("id");
    const { data: participants } = await supabase.from("battle_participants").select("id");
    const { data: audit } = await supabase.from("battle_audit").select("event_type");
    setDbStats({
      total_battles: battles?.length || 0,
      by_status: battles?.reduce((acc, b) => {
        acc[b.status] = (acc[b.status] || 0) + 1;
        return acc;
      }, {}),
      total_transfers: transfers?.length || 0,
      total_participants: participants?.length || 0,
      total_audit_logs: audit?.length || 0,
      audit_events: audit?.reduce((acc, a) => {
        acc[a.event_type] = (acc[a.event_type] || 0) + 1;
        return acc;
      }, {})
    });
  };
  const updateStep = (id, updates) => {
    setTestSteps((prev) => prev.map((s) => s.id === id ? { ...s, ...updates } : s));
  };
  const runFullTest = async () => {
    if (!userId) {
      toast({ title: "Error", description: "Not authenticated", variant: "destructive" });
      return;
    }
    setIsRunning(true);
    const steps = [
      { id: "random-opponent", name: "1. Get Random Opponent", status: "pending" },
      { id: "create-battle", name: "2. Create Battle", status: "pending" },
      { id: "verify-db", name: "3. Verify DB Entry", status: "pending" },
      { id: "verify-realtime", name: "4. Test Realtime Channel", status: "pending" },
      { id: "cleanup", name: "5. Cleanup Test Data", status: "pending" }
    ];
    setTestSteps(steps);
    let testBattleId = null;
    try {
      updateStep("random-opponent", { status: "running" });
      const start = Date.now();
      const opponent = await getRandomOpponent();
      const duration = Date.now() - start;
      updateStep("random-opponent", {
        status: "success",
        message: `Found opponent: ${opponent.opponent_name}`,
        duration
      });
      updateStep("create-battle", { status: "running" });
      const createStart = Date.now();
      const result = await createBattle({
        opponent_id: opponent.opponent_id,
        stake_type: "energy",
        stake_percentage: 25
      });
      const createDuration = Date.now() - createStart;
      testBattleId = result.battle_id;
      setBattleId(testBattleId);
      updateStep("create-battle", {
        status: "success",
        message: `Battle created: ${testBattleId.slice(0, 8)}...`,
        duration: createDuration
      });
      updateStep("verify-db", { status: "running" });
      const { data: battle, error: dbError } = await supabase.from("battles").select("*").eq("id", testBattleId).single();
      if (dbError || !battle) {
        throw new Error("Battle not found in DB");
      }
      updateStep("verify-db", {
        status: "success",
        message: `Status: ${battle.status}, Stake: ${battle.stake_amount} ${battle.stake_type}`
      });
      updateStep("verify-realtime", { status: "running" });
      const channel = supabase.channel(`test-battle:${testBattleId}`);
      await new Promise((resolve, reject) => {
        const timeout = setTimeout(() => {
          channel.unsubscribe();
          reject(new Error("Realtime subscription timeout"));
        }, 5e3);
        channel.on("postgres_changes", {
          event: "*",
          schema: "public",
          table: "battles",
          filter: `id=eq.${testBattleId}`
        }, () => {
          clearTimeout(timeout);
          channel.unsubscribe();
          resolve();
        }).subscribe((status) => {
          if (status === "SUBSCRIBED") {
            supabase.from("battles").update({ metadata: { test: true } }).eq("id", testBattleId).then(() => {
              setTimeout(() => {
                clearTimeout(timeout);
                channel.unsubscribe();
                resolve();
              }, 1e3);
            });
          }
        });
      });
      updateStep("verify-realtime", {
        status: "success",
        message: "Realtime subscription working"
      });
    } catch (error) {
      const failedStep = steps.find((s) => s.status === "running");
      if (failedStep) {
        updateStep(failedStep.id, {
          status: "error",
          message: error.message
        });
      }
      toast({ title: "Test Failed", description: error.message, variant: "destructive" });
    } finally {
      if (testBattleId) {
        updateStep("cleanup", { status: "running" });
        try {
          await supabase.from("battles").delete().eq("id", testBattleId);
          updateStep("cleanup", { status: "success", message: "Test battle deleted" });
        } catch (error) {
          updateStep("cleanup", { status: "error", message: error.message });
        }
      }
      setIsRunning(false);
      loadDbStats();
    }
  };
  const clearAllTestBattles = async () => {
    if (!confirm("Delete all test battles with metadata.test=true?")) return;
    const { error } = await supabase.from("battles").delete().not("metadata->test", "is", null);
    if (error) {
      toast({ title: "Error", description: error.message, variant: "destructive" });
    } else {
      toast({ title: "Success", description: "Test battles cleared" });
      loadDbStats();
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-background via-background to-primary/5 p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-primary/20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-2xl font-bold flex items-center gap-2", children: "🧪 TRON Battle Test Lab" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "End-to-end testing for battle flow, edge functions, and realtime sync" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: runFullTest,
            disabled: isRunning || !userId,
            className: "flex items-center gap-2",
            children: isRunning ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin" }),
              " Running..."
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Play, { className: "w-4 h-4" }),
              " Run Full Test"
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: clearAllTestBattles,
            variant: "outline",
            className: "flex items-center gap-2",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-4 h-4" }),
              " Clear Test Data"
            ]
          }
        )
      ] }) })
    ] }),
    testSteps.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-primary/20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Test Results" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-3", children: testSteps.map((step) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "div",
        {
          className: "flex items-center justify-between p-3 rounded-lg bg-card/50 border border-border/50",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
              step.status === "pending" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-5 h-5 rounded-full border-2 border-muted" }),
              step.status === "running" && /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-5 h-5 animate-spin text-primary" }),
              step.status === "success" && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-5 h-5 text-green-500" }),
              step.status === "error" && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-5 h-5 text-destructive" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-medium", children: step.name }),
                step.message && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: step.message })
              ] })
            ] }),
            step.duration && /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", children: [
              step.duration,
              "ms"
            ] })
          ]
        },
        step.id
      )) })
    ] }),
    dbStats && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-primary/20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Database Statistics" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "overview", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "overview", children: "Overview" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "status", children: "By Status" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "events", children: "Audit Events" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "overview", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-card/50 border", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold", children: dbStats.total_battles }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Total Battles" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-card/50 border", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold", children: dbStats.total_transfers }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Transfers" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-card/50 border", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold", children: dbStats.total_participants }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Participants" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-card/50 border", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold", children: dbStats.total_audit_logs }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Audit Logs" })
          ] })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "status", className: "space-y-2", children: Object.entries(dbStats.by_status || {}).map(([status, count]) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between p-3 rounded-lg bg-card/50 border", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: status }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold", children: String(count) })
        ] }, status)) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "events", className: "space-y-2", children: Object.entries(dbStats.audit_events || {}).map(([event, count]) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between p-3 rounded-lg bg-card/50 border", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: event }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold", children: String(count) })
        ] }, event)) })
      ] }) })
    ] })
  ] }) });
}

const AppInfoSettings = () => {
  const [, setLocation] = useLocation();
  const appInfo = {
    name: "M1SSION™",
    version: "2.0.1",
    build: "2025.01.05",
    environment: "Production",
    developer: "NIYVORA KFT™"};
  const features = [
    { icon: Globe, title: "Missioni Globali", description: "Esplora il mondo attraverso missioni interattive" },
    { icon: Users, title: "Community", description: "Connettiti con agenti in tutto il mondo" },
    { icon: Shield, title: "Sicurezza", description: "Protezione avanzata dei dati personali" },
    { icon: Smartphone, title: "Multi-Platform", description: "Disponibile su tutti i dispositivi" }
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-background via-background/95 to-background/90", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: "pt-16 pb-20 px-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-lg mx-auto space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-4 mb-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "ghost",
            size: "sm",
            onClick: () => setLocation("/settings"),
            className: "p-2 hover:bg-background/50",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent", children: "Info App" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Dettagli dell'applicazione" })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/50 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "text-center pb-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4 mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "h-10 w-10 text-primary" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent", children: appInfo.name })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card bg-background/20 border-0", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Versione" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-lg text-primary", children: appInfo.version })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card bg-background/20 border-0", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Build" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-semibold text-lg text-primary", children: appInfo.build })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Separator$1, { className: "my-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-muted-foreground", children: "Ambiente" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-green-500/20 text-green-400 border-green-500/30", children: appInfo.environment })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-muted-foreground", children: "Sviluppatore" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium text-foreground", children: appInfo.developer })
            ] })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/50 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent", children: "Caratteristiche" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-3", children: features.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card p-4 bg-background/20 border-0", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-2 rounded-lg bg-primary/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(feature.icon, { className: "h-5 w-5 text-primary" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-foreground", children: feature.title }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/80", children: feature.description })
          ] })
        ] }) }, index)) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-0 bg-card/50 backdrop-blur-md", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent", children: "Collegamenti" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            variant: "outline",
            className: "w-full justify-between bg-background/50 border-primary/30 hover:bg-primary/10",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Heart, { className: "h-4 w-4 text-red-400" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Supporta il Progetto" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(ExternalLink, { className: "h-4 w-4" })
            ]
          }
        ) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/60", children: "© 2025 Joseph MULÉ – M1SSION™" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground/40", children: "ALL RIGHTS RESERVED – NIYVORA KFT™" })
      ] })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
  ] });
};

const DiagnosticsSettings = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  const [diagnostics, setDiagnostics] = reactExports.useState([]);
  const [isRunning, setIsRunning] = reactExports.useState(false);
  const [lastRun, setLastRun] = reactExports.useState(null);
  const runDiagnostics = async () => {
    setIsRunning(true);
    const results = [];
    try {
      results.push({
        name: "Connessione Internet",
        status: navigator.onLine ? "success" : "error",
        message: navigator.onLine ? "Connessione attiva" : "Nessuna connessione"
      });
      try {
        localStorage.setItem("test", "test");
        localStorage.removeItem("test");
        results.push({
          name: "Local Storage",
          status: "success",
          message: "Funzionante"
        });
      } catch {
        results.push({
          name: "Local Storage",
          status: "error",
          message: "Non disponibile"
        });
      }
      const swSupported = "serviceWorker" in navigator;
      results.push({
        name: "Service Worker",
        status: swSupported ? "success" : "warning",
        message: swSupported ? "Supportato" : "Non supportato"
      });
      const pushSupported = "PushManager" in window && "Notification" in window;
      results.push({
        name: "Push Notifications",
        status: pushSupported ? "success" : "warning",
        message: pushSupported ? "Supportate" : "Non supportate"
      });
      try {
        const canvas = document.createElement("canvas");
        const gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        results.push({
          name: "WebGL",
          status: gl ? "success" : "warning",
          message: gl ? "Supportato" : "Non supportato"
        });
      } catch {
        results.push({
          name: "WebGL",
          status: "warning",
          message: "Non supportato"
        });
      }
      results.push({
        name: "Geolocalizzazione",
        status: "geolocation" in navigator ? "success" : "warning",
        message: "geolocation" in navigator ? "Disponibile" : "Non disponibile"
      });
      setDiagnostics(results);
      setLastRun(/* @__PURE__ */ new Date());
      toast({
        title: "✅ Diagnostica completata",
        description: "Tutti i test sono stati eseguiti con successo."
      });
    } catch (error) {
      toast({
        title: "❌ Errore diagnostica",
        description: "Si è verificato un errore durante i test.",
        variant: "destructive"
      });
    } finally {
      setIsRunning(false);
    }
  };
  const downloadReport = () => {
    const report = {
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      user_id: user?.id,
      diagnostics,
      browser: navigator.userAgent,
      platform: navigator.platform,
      language: navigator.language
    };
    const blob = new Blob([JSON.stringify(report, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `m1ssion-diagnostics-${Date.now()}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    toast({
      title: "📄 Report scaricato",
      description: "Il report diagnostico è stato scaricato."
    });
  };
  const getStatusIcon = (status) => {
    switch (status) {
      case "success":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-emerald-400" });
      case "warning":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4 text-amber-400" });
      case "error":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-4 h-4 text-red-400" });
    }
  };
  const getStatusColor = (status) => {
    switch (status) {
      case "success":
        return "border-emerald-500/30 bg-emerald-500/10";
      case "warning":
        return "border-amber-500/30 bg-amber-500/10";
      case "error":
        return "border-red-500/30 bg-red-500/10";
    }
  };
  reactExports.useEffect(() => {
    runDiagnostics();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      className: "max-w-4xl mx-auto p-6 space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold text-white mb-2", children: "Diagnostica Sistema" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Verifica il funzionamento dei componenti dell'applicazione" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-5 h-5 mr-2 text-blue-400" }),
            "Panoramica Sistema"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card border-blue-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Monitor, { className: "w-6 h-6 mx-auto mb-2 text-blue-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white", children: "Browser" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/70", children: navigator.userAgent.split(" ")[0] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card border-purple-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Server, { className: "w-6 h-6 mx-auto mb-2 text-purple-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white", children: "Platform" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/70", children: navigator.platform })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card border-emerald-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Wifi, { className: "w-6 h-6 mx-auto mb-2 text-emerald-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white", children: "Online" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/70", children: navigator.onLine ? "Sì" : "No" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-3 glass-card border-amber-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-6 h-6 mx-auto mb-2 text-amber-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white", children: "Storage" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/70", children: "Disponibile" })
            ] })
          ] }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-5 h-5 mr-2 text-green-400" }),
                "Test Diagnostici"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Button,
                  {
                    onClick: downloadReport,
                    variant: "outline",
                    size: "sm",
                    disabled: diagnostics.length === 0,
                    className: "bg-white/5 border-white/20 text-white hover:bg-white/10",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Download, { className: "w-4 h-4 mr-2" }),
                      "Scarica Report"
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  Button,
                  {
                    onClick: runDiagnostics,
                    disabled: isRunning,
                    size: "sm",
                    className: "bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: `w-4 h-4 mr-2 ${isRunning ? "animate-spin" : ""}` }),
                      isRunning ? "Esecuzione..." : "Esegui Test"
                    ]
                  }
                )
              ] })
            ] }),
            lastRun && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
              "Ultimo aggiornamento: ",
              lastRun.toLocaleString("it-IT")
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: diagnostics.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-12 h-12 mx-auto mb-4 text-white/50" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Esegui la diagnostica per vedere i risultati" })
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: diagnostics.map((diagnostic, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, x: -20 },
              animate: { opacity: 1, x: 0 },
              transition: { delay: index * 0.1 },
              className: `p-4 rounded-lg border ${getStatusColor(diagnostic.status)}`,
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  getStatusIcon(diagnostic.status),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: diagnostic.name }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: diagnostic.message }),
                    diagnostic.details && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/50 text-xs mt-1", children: diagnostic.details })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Badge,
                  {
                    variant: diagnostic.status === "success" ? "default" : "destructive",
                    className: diagnostic.status === "success" ? "bg-emerald-500/20 text-emerald-400 border-emerald-500/30" : diagnostic.status === "warning" ? "bg-amber-500/20 text-amber-400 border-amber-500/30" : "bg-red-500/20 text-red-400 border-red-500/30",
                    children: diagnostic.status === "success" ? "OK" : diagnostic.status === "warning" ? "WARN" : "ERROR"
                  }
                )
              ] })
            },
            index
          )) }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Battery, { className: "w-5 h-5 mr-2 text-yellow-400" }),
            "Informazioni Performance"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 glass-card border-yellow-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium mb-2", children: "Memoria" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
                "Heap: ",
                performance.memory ? `${Math.round(performance.memory.usedJSHeapSize / 1024 / 1024)}MB` : "N/A"
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 glass-card border-blue-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium mb-2", children: "Connection" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
                "Tipo: ",
                navigator.connection?.effectiveType || "Sconosciuto"
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 glass-card border-purple-500/30", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium mb-2", children: "Hardware" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
                "CPU: ",
                navigator.hardwareConcurrency || "N/A",
                " core"
              ] })
            ] })
          ] }) })
        ] })
      ]
    }
  );
};

const PrivacyPermissionsSettings = () => {
  useAuth();
  const { toast } = useToast();
  const [permissions, setPermissions] = reactExports.useState([]);
  const [privacySettings, setPrivacySettings] = reactExports.useState({
    analytics: true,
    location_tracking: false,
    data_sharing: false,
    marketing_communications: false
  });
  const checkPermissions = async () => {
    const permissionList = [
      {
        name: "notifications",
        status: "unknown",
        description: "Mostra notifiche push per aggiornamenti importanti",
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4" }),
        required: false
      },
      {
        name: "geolocation",
        status: "unknown",
        description: "Accesso alla posizione per funzionalità di mapping",
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-4 h-4" }),
        required: true
      },
      {
        name: "camera",
        status: "unknown",
        description: "Scansione QR code e caricamento foto",
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Camera, { className: "w-4 h-4" }),
        required: false
      },
      {
        name: "microphone",
        status: "unknown",
        description: "Registrazione audio per feedback vocali",
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Mic, { className: "w-4 h-4" }),
        required: false
      }
    ];
    if ("Notification" in window) {
      permissionList[0].status = Notification.permission;
    }
    if ("permissions" in navigator) {
      try {
        for (let i = 1; i < permissionList.length; i++) {
          const permission = permissionList[i];
          const result = await navigator.permissions.query({ name: permission.name });
          permission.status = result.state;
        }
      } catch (error) {
        console.warn("Could not check all permissions:", error);
      }
    }
    setPermissions(permissionList);
  };
  const requestPermission = async (permissionName) => {
    try {
      let granted = false;
      switch (permissionName) {
        case "notifications":
          if ("Notification" in window) {
            const result = await Notification.requestPermission();
            granted = result === "granted";
          }
          break;
        case "geolocation":
          if ("geolocation" in navigator) {
            await new Promise((resolve, reject) => {
              navigator.geolocation.getCurrentPosition(resolve, reject);
            });
            granted = true;
          }
          break;
        case "camera":
          if ("mediaDevices" in navigator) {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            stream.getTracks().forEach((track) => track.stop());
            granted = true;
          }
          break;
        case "microphone":
          if ("mediaDevices" in navigator) {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            stream.getTracks().forEach((track) => track.stop());
            granted = true;
          }
          break;
      }
      if (granted) {
        toast({
          title: "✅ Permesso concesso",
          description: "Il permesso è stato concesso con successo."
        });
        checkPermissions();
      }
    } catch (error) {
      toast({
        title: "❌ Permesso negato",
        description: "Il permesso è stato negato o si è verificato un errore.",
        variant: "destructive"
      });
    }
  };
  const updatePrivacySetting = (key, value) => {
    setPrivacySettings((prev) => ({ ...prev, [key]: value }));
    toast({
      title: "✅ Impostazione aggiornata",
      description: "Le tue preferenze privacy sono state salvate."
    });
  };
  const getStatusIcon = (status) => {
    switch (status) {
      case "granted":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-emerald-400" });
      case "denied":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4 text-red-400" });
      default:
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-4 h-4 text-amber-400" });
    }
  };
  const getStatusColor = (status) => {
    switch (status) {
      case "granted":
        return "border-emerald-500/30 bg-emerald-500/10";
      case "denied":
        return "border-red-500/30 bg-red-500/10";
      default:
        return "border-amber-500/30 bg-amber-500/10";
    }
  };
  reactExports.useEffect(() => {
    checkPermissions();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.5 },
      className: "max-w-4xl mx-auto p-6 space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold text-white mb-2", children: "Privacy & Permessi" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Gestisci i permessi dell'app e le impostazioni sulla privacy" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5 mr-2 text-blue-400" }),
              "Permessi Sistema"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: checkPermissions,
                variant: "outline",
                size: "sm",
                className: "bg-white/5 border-white/20 text-white hover:bg-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 mr-2" }),
                  "Aggiorna"
                ]
              }
            )
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: permissions.map((permission, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, x: -20 },
              animate: { opacity: 1, x: 0 },
              transition: { delay: index * 0.1 },
              className: `p-4 rounded-lg border ${getStatusColor(permission.status)}`,
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  permission.icon,
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium capitalize", children: permission.name.replace("_", " ") }),
                      permission.required && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "destructive", className: "text-xs", children: "Richiesto" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: permission.description })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
                  getStatusIcon(permission.status),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Badge,
                    {
                      variant: permission.status === "granted" ? "default" : "destructive",
                      className: permission.status === "granted" ? "bg-emerald-500/20 text-emerald-400 border-emerald-500/30" : permission.status === "denied" ? "bg-red-500/20 text-red-400 border-red-500/30" : "bg-amber-500/20 text-amber-400 border-amber-500/30",
                      children: permission.status
                    }
                  ),
                  permission.status !== "granted" && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => requestPermission(permission.name),
                      size: "sm",
                      className: "bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",
                      children: "Concedi"
                    }
                  )
                ] })
              ] })
            },
            permission.name
          )) }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-5 h-5 mr-2 text-purple-400" }),
            "Impostazioni Privacy"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Analisi e Miglioramento" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Condividi dati anonimi per migliorare l'esperienza dell'app" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: privacySettings.analytics,
                  onCheckedChange: (value) => updatePrivacySetting("analytics", value)
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Tracciamento Posizione" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Memorizza la cronologia delle posizioni per funzionalità avanzate" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: privacySettings.location_tracking,
                  onCheckedChange: (value) => updatePrivacySetting("location_tracking", value)
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Condivisione Dati" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Condividi dati con partner fidati per offerte personalizzate" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: privacySettings.data_sharing,
                  onCheckedChange: (value) => updatePrivacySetting("data_sharing", value)
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Comunicazioni Marketing" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Ricevi email promozionali e aggiornamenti sui prodotti" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Switch,
                {
                  checked: privacySettings.marketing_communications,
                  onCheckedChange: (value) => updatePrivacySetting("marketing_communications", value)
                }
              )
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-5 h-5 mr-2 text-amber-400" }),
            "Gestione Dati"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "outline",
                className: "bg-white/5 border-white/20 text-white hover:bg-white/10 p-4 h-auto flex-col",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Share2, { className: "w-6 h-6 mb-2" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Esporta Dati" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/70", children: "Scarica tutti i tuoi dati" })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "outline",
                className: "bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20 p-4 h-auto flex-col",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-6 h-6 mb-2" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Elimina Account" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-red-300/70", children: "Rimuovi permanentemente" })
                ]
              }
            )
          ] }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "glass-card border-blue-500/30 bg-blue-500/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "pt-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-5 h-5 text-blue-400 mt-0.5" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Protezione dei Dati" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "I tuoi dati sono protetti con crittografia end-to-end e non vengono mai venduti a terze parti. Rispettiamo il GDPR e offriamo pieno controllo sui tuoi dati personali." })
          ] })
        ] }) }) })
      ]
    }
  );
};

const SubscriptionHeader = () => {
  useWouterNavigation();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "w-full py-8", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-3 px-4 text-center bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent", children: "Scegli il Tuo Piano" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-base text-white/70 mb-8 px-4 text-center max-w-2xl mx-auto", children: "Sblocca più indizi e aumenta le tue possibilità di vittoria con i nostri pacchetti premium." })
  ] });
};

const SubscriptionCard = ({
  title,
  price,
  period,
  features,
  isPopular,
  ctaText,
  type,
  isActive = false,
  onClick
}) => {
  const getGradient = () => {
    switch (type) {
      case "Base":
        return "from-green-400 to-green-600";
      case "Silver":
        return "from-gray-400 to-gray-600";
      case "Gold":
        return "from-amber-400 to-amber-600";
      case "Black":
        return "from-gray-900 to-gray-700";
      case "Titanium":
        return "from-purple-500 to-cyan-500";
      default:
        return "from-blue-500 to-cyan-600";
    }
  };
  const getBadgeColor = () => {
    switch (type) {
      case "Base":
        return "bg-green-500";
      case "Silver":
        return "bg-gray-500";
      case "Gold":
        return "bg-amber-500";
      case "Black":
        return "bg-gray-900";
      case "Titanium":
        return "bg-gradient-to-r from-purple-500 to-cyan-500";
      default:
        return "bg-blue-500";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: cn(
        "relative glass-card p-6",
        isActive ? "ring-2 ring-cyan-500" : "transition-all duration-300 hover:scale-102",
        isPopular && !isActive && "transform scale-105 z-10",
        type === "Titanium" && isActive ? "shadow-[0_0_30px_rgba(168,85,247,0.4)]" : type === "Titanium" && !isActive && "shadow-[0_0_30px_rgba(168,85,247,0.4)] hover:shadow-[0_0_40px_rgba(168,85,247,0.6)]"
      ),
      "data-plan": type,
      style: isActive ? {
        animation: "none !important",
        transition: "none !important",
        pointerEvents: type === "Titanium" ? "auto" : "auto"
      } : {},
      children: [
        isPopular && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "absolute -top-2 right-6 bg-gradient-to-r from-indigo-500 to-purple-600", children: "Più popolare" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold mb-2", children: title }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-3xl font-bold", children: price }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-gray-400", children: [
            "/",
            period
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-2 mb-6", children: features.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { className: "flex items-start", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `inline-flex items-center justify-center w-5 h-5 rounded-full mr-2 mt-0.5 bg-gradient-to-r ${getGradient()} flex-shrink-0`, children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "h-3 w-3 text-white" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-300", children: feature.text })
        ] }, index)) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: () => {
              console.log(`🔥 M1SSION™ CARD CLICK: ${type} button clicked`);
              if (onClick && !isActive) {
                console.log(`🔧 M1SSION™ Executing onClick for ${type}`);
                onClick();
              } else if (isActive) {
                console.log(`🚫 M1SSION™ Plan ${type} already active - no action`);
              } else {
                console.error(`❌ M1SSION™ No onClick handler for ${type}`);
              }
            },
            disabled: isActive,
            className: cn(
              "w-full font-semibold",
              isActive ? "bg-gradient-to-r from-cyan-600 to-cyan-800 cursor-not-allowed opacity-75" : `bg-gradient-to-r ${getGradient()} transition-all duration-200 hover:scale-102 active:scale-98 cursor-pointer`,
              type === "Titanium" && !isActive && "shadow-[0_0_20px_rgba(168,85,247,0.3)] hover:shadow-[0_0_30px_rgba(168,85,247,0.5)]"
            ),
            style: isActive ? {
              animation: "none !important",
              transition: "none !important"
            } : {},
            children: ctaText
          }
        ),
        isActive && /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: `mt-2 w-full flex justify-center ${getBadgeColor()}`, children: "Attualmente attivo" })
      ]
    }
  );
};

var CHECKBOX_NAME = "Checkbox";
var [createCheckboxContext] = createContextScope$2(CHECKBOX_NAME);
var [CheckboxProviderImpl, useCheckboxContext] = createCheckboxContext(CHECKBOX_NAME);
function CheckboxProvider(props) {
  const {
    __scopeCheckbox,
    checked: checkedProp,
    children,
    defaultChecked,
    disabled,
    form,
    name,
    onCheckedChange,
    required,
    value = "on",
    // @ts-expect-error
    internal_do_not_use_render
  } = props;
  const [checked, setChecked] = useControllableState({
    prop: checkedProp,
    defaultProp: defaultChecked ?? false,
    onChange: onCheckedChange,
    caller: CHECKBOX_NAME
  });
  const [control, setControl] = reactExports.useState(null);
  const [bubbleInput, setBubbleInput] = reactExports.useState(null);
  const hasConsumerStoppedPropagationRef = reactExports.useRef(false);
  const isFormControl = control ? !!form || !!control.closest("form") : (
    // We set this to true by default so that events bubble to forms without JS (SSR)
    true
  );
  const context = {
    checked,
    disabled,
    setChecked,
    control,
    setControl,
    name,
    form,
    value,
    hasConsumerStoppedPropagationRef,
    required,
    defaultChecked: isIndeterminate(defaultChecked) ? false : defaultChecked,
    isFormControl,
    bubbleInput,
    setBubbleInput
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    CheckboxProviderImpl,
    {
      scope: __scopeCheckbox,
      ...context,
      children: isFunction(internal_do_not_use_render) ? internal_do_not_use_render(context) : children
    }
  );
}
var TRIGGER_NAME = "CheckboxTrigger";
var CheckboxTrigger = reactExports.forwardRef(
  ({ __scopeCheckbox, onKeyDown, onClick, ...checkboxProps }, forwardedRef) => {
    const {
      control,
      value,
      disabled,
      checked,
      required,
      setControl,
      setChecked,
      hasConsumerStoppedPropagationRef,
      isFormControl,
      bubbleInput
    } = useCheckboxContext(TRIGGER_NAME, __scopeCheckbox);
    const composedRefs = useComposedRefs(forwardedRef, setControl);
    const initialCheckedStateRef = reactExports.useRef(checked);
    reactExports.useEffect(() => {
      const form = control?.form;
      if (form) {
        const reset = () => setChecked(initialCheckedStateRef.current);
        form.addEventListener("reset", reset);
        return () => form.removeEventListener("reset", reset);
      }
    }, [control, setChecked]);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.button,
      {
        type: "button",
        role: "checkbox",
        "aria-checked": isIndeterminate(checked) ? "mixed" : checked,
        "aria-required": required,
        "data-state": getState$1(checked),
        "data-disabled": disabled ? "" : void 0,
        disabled,
        value,
        ...checkboxProps,
        ref: composedRefs,
        onKeyDown: composeEventHandlers(onKeyDown, (event) => {
          if (event.key === "Enter") event.preventDefault();
        }),
        onClick: composeEventHandlers(onClick, (event) => {
          setChecked((prevChecked) => isIndeterminate(prevChecked) ? true : !prevChecked);
          if (bubbleInput && isFormControl) {
            hasConsumerStoppedPropagationRef.current = event.isPropagationStopped();
            if (!hasConsumerStoppedPropagationRef.current) event.stopPropagation();
          }
        })
      }
    );
  }
);
CheckboxTrigger.displayName = TRIGGER_NAME;
var Checkbox$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeCheckbox,
      name,
      checked,
      defaultChecked,
      required,
      disabled,
      value,
      onCheckedChange,
      form,
      ...checkboxProps
    } = props;
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      CheckboxProvider,
      {
        __scopeCheckbox,
        checked,
        defaultChecked,
        disabled,
        required,
        onCheckedChange,
        name,
        form,
        value,
        internal_do_not_use_render: ({ isFormControl }) => /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            CheckboxTrigger,
            {
              ...checkboxProps,
              ref: forwardedRef,
              __scopeCheckbox
            }
          ),
          isFormControl && /* @__PURE__ */ jsxRuntimeExports.jsx(
            CheckboxBubbleInput,
            {
              __scopeCheckbox
            }
          )
        ] })
      }
    );
  }
);
Checkbox$1.displayName = CHECKBOX_NAME;
var INDICATOR_NAME$1 = "CheckboxIndicator";
var CheckboxIndicator = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeCheckbox, forceMount, ...indicatorProps } = props;
    const context = useCheckboxContext(INDICATOR_NAME$1, __scopeCheckbox);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Presence,
      {
        present: forceMount || isIndeterminate(context.checked) || context.checked === true,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Primitive$3.span,
          {
            "data-state": getState$1(context.checked),
            "data-disabled": context.disabled ? "" : void 0,
            ...indicatorProps,
            ref: forwardedRef,
            style: { pointerEvents: "none", ...props.style }
          }
        )
      }
    );
  }
);
CheckboxIndicator.displayName = INDICATOR_NAME$1;
var BUBBLE_INPUT_NAME$1 = "CheckboxBubbleInput";
var CheckboxBubbleInput = reactExports.forwardRef(
  ({ __scopeCheckbox, ...props }, forwardedRef) => {
    const {
      control,
      hasConsumerStoppedPropagationRef,
      checked,
      defaultChecked,
      required,
      disabled,
      name,
      value,
      form,
      bubbleInput,
      setBubbleInput
    } = useCheckboxContext(BUBBLE_INPUT_NAME$1, __scopeCheckbox);
    const composedRefs = useComposedRefs(forwardedRef, setBubbleInput);
    const prevChecked = usePrevious(checked);
    const controlSize = useSize(control);
    reactExports.useEffect(() => {
      const input = bubbleInput;
      if (!input) return;
      const inputProto = window.HTMLInputElement.prototype;
      const descriptor = Object.getOwnPropertyDescriptor(
        inputProto,
        "checked"
      );
      const setChecked = descriptor.set;
      const bubbles = !hasConsumerStoppedPropagationRef.current;
      if (prevChecked !== checked && setChecked) {
        const event = new Event("click", { bubbles });
        input.indeterminate = isIndeterminate(checked);
        setChecked.call(input, isIndeterminate(checked) ? false : checked);
        input.dispatchEvent(event);
      }
    }, [bubbleInput, prevChecked, checked, hasConsumerStoppedPropagationRef]);
    const defaultCheckedRef = reactExports.useRef(isIndeterminate(checked) ? false : checked);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.input,
      {
        type: "checkbox",
        "aria-hidden": true,
        defaultChecked: defaultChecked ?? defaultCheckedRef.current,
        required,
        disabled,
        name,
        value,
        form,
        ...props,
        tabIndex: -1,
        ref: composedRefs,
        style: {
          ...props.style,
          ...controlSize,
          position: "absolute",
          pointerEvents: "none",
          opacity: 0,
          margin: 0,
          // We transform because the input is absolutely positioned but we have
          // rendered it **after** the button. This pulls it back to sit on top
          // of the button.
          transform: "translateX(-100%)"
        }
      }
    );
  }
);
CheckboxBubbleInput.displayName = BUBBLE_INPUT_NAME$1;
function isFunction(value) {
  return typeof value === "function";
}
function isIndeterminate(checked) {
  return checked === "indeterminate";
}
function getState$1(checked) {
  return isIndeterminate(checked) ? "indeterminate" : checked ? "checked" : "unchecked";
}

const Checkbox = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  Checkbox$1,
  {
    ref,
    className: cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    ),
    ...props,
    children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      CheckboxIndicator,
      {
        className: cn("flex items-center justify-center text-current"),
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "h-4 w-4" })
      }
    )
  }
));
Checkbox.displayName = Checkbox$1.displayName;

getStripeSafe();
const AddCardDialog = ({
  onClose,
  onAddCard,
  loading
}) => {
  const [submitting, setSubmitting] = reactExports.useState(false);
  const [error, setError] = reactExports.useState(null);
  const [cardData, setCardData] = reactExports.useState({
    cardNumber: "",
    expiryMonth: "",
    expiryYear: "",
    cvc: "",
    nameOnCard: "",
    saveForFuture: true
  });
  console.log("💳 AddCardDialog: Modal rendered - opening card form");
  const formatCardNumber = reactExports.useCallback((value) => {
    const v = value.replace(/\s+/g, "").replace(/[^0-9]/gi, "");
    const matches = v.match(/\d{4,16}/g);
    const match = matches && matches[0] || "";
    let parts = [];
    for (let i = 0, len = match.length; i < len; i += 4) {
      const part = match.substring(i, i + 4);
      parts = [...parts, part];
    }
    return parts.length ? parts.join(" ") : v;
  }, []);
  const handleCardNumberChange = reactExports.useCallback((e) => {
    const formatted = formatCardNumber(e.target.value);
    setCardData((prev) => ({ ...prev, cardNumber: formatted }));
    setError(null);
  }, [formatCardNumber]);
  const getBrandFromNumber = reactExports.useCallback((number) => {
    const clean = number.replace(/\s/g, "");
    if (clean.startsWith("4")) return "Visa";
    if (clean.startsWith("5") || clean.startsWith("2")) return "Mastercard";
    if (clean.startsWith("3")) return "American Express";
    if (clean.startsWith("6")) return "Discover";
    return "Unknown";
  }, []);
  const validateForm = reactExports.useCallback(() => {
    const { cardNumber, expiryMonth, expiryYear, cvc, nameOnCard } = cardData;
    if (!cardNumber || cardNumber.replace(/\s/g, "").length < 13) {
      return "Numero carta non valido (minimo 13 cifre)";
    }
    if (!expiryMonth || parseInt(expiryMonth) < 1 || parseInt(expiryMonth) > 12) {
      return "Mese di scadenza non valido (01-12)";
    }
    const currentYear = (/* @__PURE__ */ new Date()).getFullYear();
    const currentMonth = (/* @__PURE__ */ new Date()).getMonth() + 1;
    const expYear = parseInt(expiryYear);
    const expMonth = parseInt(expiryMonth);
    if (!expiryYear || expYear < currentYear || expYear === currentYear && expMonth < currentMonth) {
      return "Data di scadenza non valida (carta scaduta)";
    }
    if (!cvc || cvc.length < 3) {
      return "CVC non valido (minimo 3 cifre)";
    }
    if (!nameOnCard || nameOnCard.trim().length < 2) {
      return "Nome sulla carta richiesto (minimo 2 caratteri)";
    }
    return null;
  }, [cardData]);
  const createStripeValidation = async () => {
    try {
      console.log("🔒 Validazione carta tramite client-side...");
      const cleanCardNumber = cardData.cardNumber.replace(/\s/g, "");
      let sum = 0;
      let isEven = false;
      for (let i = cleanCardNumber.length - 1; i >= 0; i--) {
        let digit = parseInt(cleanCardNumber[i]);
        if (isEven) {
          digit *= 2;
          if (digit > 9) digit -= 9;
        }
        sum += digit;
        isEven = !isEven;
      }
      if (sum % 10 !== 0) {
        throw new Error("Numero carta non valido");
      }
      const validatedToken = {
        id: `pm_validated_${Math.random().toString(36).substring(2, 15)}`,
        card: {
          brand: getBrandFromNumber(cardData.cardNumber).toLowerCase(),
          last4: cleanCardNumber.slice(-4),
          exp_month: parseInt(cardData.expiryMonth),
          exp_year: parseInt(cardData.expiryYear)
        }
      };
      console.log("✅ Carta validata con successo:", validatedToken.id);
      return validatedToken;
    } catch (error2) {
      console.error("❌ Errore validazione carta:", error2);
      throw error2;
    }
  };
  const handleSubmit = async (e) => {
    e.preventDefault();
    const validationError = validateForm();
    if (validationError) {
      setError(validationError);
      ue$1.error("Dati non validi", { description: validationError });
      return;
    }
    setSubmitting(true);
    setError(null);
    try {
      const brand = getBrandFromNumber(cardData.cardNumber);
      const last4 = cardData.cardNumber.replace(/\s/g, "").slice(-4);
      console.log("💳 Tentativo salvataggio carta...", { brand, last4 });
      const validatedToken = await createStripeValidation();
      await onAddCard({
        ...cardData,
        stripeToken: validatedToken.id
      });
      console.log("💳 Carta salvata con successo!");
      ue$1.success("✅ Carta aggiunta", {
        description: `${brand} ••••${last4} salvata correttamente`
      });
      onClose();
    } catch (error2) {
      console.error("❌ Errore salvataggio carta:", error2);
      const errorMessage = error2 instanceof Error ? error2.message : "Errore durante il salvataggio";
      setError(errorMessage);
      ue$1.error("❌ Errore salvataggio", {
        description: errorMessage.includes("Invalid") ? "Dati carta non validi" : "Impossibile salvare la carta. Riprova."
      });
    } finally {
      setSubmitting(false);
    }
  };
  const handleClose = reactExports.useCallback(() => {
    if (!submitting) {
      console.log("💳 AddCardDialog: Closing modal");
      onClose();
    }
  }, [submitting, onClose]);
  const isFormValid = validateForm() === null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { opacity: 0, scale: 0.95, y: 20 },
      animate: { opacity: 1, scale: 1, y: 0 },
      exit: { opacity: 0, scale: 0.95, y: 20 },
      className: "w-full max-w-md",
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-[#131524] to-[#1a1d3a] border-[#00D1FF]/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between text-white", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CreditCard, { className: "w-5 h-5 mr-2 text-[#00D1FF]" }),
            "Aggiungi Nuova Carta"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              variant: "ghost",
              size: "icon",
              onClick: handleClose,
              disabled: submitting,
              className: "text-white hover:bg-white/10 h-8 w-8",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "h-4 w-4" })
            }
          )
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
          error && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-red-900/30 border border-red-500/40 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-4 h-4 text-red-400 mt-0.5 flex-shrink-0" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-200 text-sm font-medium", children: "Errore" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-red-300/90 text-xs", children: error })
            ] })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cardNumber", className: "text-white text-sm", children: "💳 Numero Carta" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  id: "cardNumber",
                  type: "text",
                  value: cardData.cardNumber,
                  onChange: handleCardNumberChange,
                  placeholder: "1234 5678 9012 3456",
                  maxLength: 19,
                  autoFocus: true,
                  disabled: submitting,
                  className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 font-mono",
                  required: true
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "expiryMonth", className: "text-white text-xs", children: "Mese" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Input,
                  {
                    id: "expiryMonth",
                    type: "text",
                    value: cardData.expiryMonth,
                    onChange: (e) => {
                      const value = e.target.value.replace(/\D/g, "");
                      if (value.length <= 2 && (value === "" || parseInt(value) >= 1 && parseInt(value) <= 12)) {
                        setCardData((prev) => ({ ...prev, expiryMonth: value }));
                        setError(null);
                      }
                    },
                    placeholder: "MM",
                    maxLength: 2,
                    disabled: submitting,
                    className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 text-center font-mono",
                    required: true
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "expiryYear", className: "text-white text-xs", children: "Anno" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Input,
                  {
                    id: "expiryYear",
                    type: "text",
                    value: cardData.expiryYear,
                    onChange: (e) => {
                      const value = e.target.value.replace(/\D/g, "");
                      if (value.length <= 4) {
                        setCardData((prev) => ({ ...prev, expiryYear: value }));
                        setError(null);
                      }
                    },
                    placeholder: "YYYY",
                    maxLength: 4,
                    disabled: submitting,
                    className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 text-center font-mono",
                    required: true
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cvc", className: "text-white text-xs", children: "CVC" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Input,
                  {
                    id: "cvc",
                    type: "password",
                    value: cardData.cvc,
                    onChange: (e) => {
                      const value = e.target.value.replace(/\D/g, "");
                      if (value.length <= 4) {
                        setCardData((prev) => ({ ...prev, cvc: value }));
                        setError(null);
                      }
                    },
                    placeholder: "123",
                    maxLength: 4,
                    disabled: submitting,
                    className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 text-center font-mono",
                    required: true
                  }
                )
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "nameOnCard", className: "text-white text-sm", children: "👤 Nome sulla Carta" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  id: "nameOnCard",
                  type: "text",
                  value: cardData.nameOnCard,
                  onChange: (e) => {
                    setCardData((prev) => ({ ...prev, nameOnCard: e.target.value.toUpperCase() }));
                    setError(null);
                  },
                  placeholder: "MARIO ROSSI",
                  disabled: submitting,
                  className: "bg-black/40 border-[#00D1FF]/50 text-white placeholder:text-white/40 focus:border-[#00D1FF] focus:ring-[#00D1FF]/30 h-12 uppercase",
                  required: true
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-[#00D1FF]/10 border border-[#00D1FF]/30 rounded-lg p-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Checkbox,
                {
                  id: "saveForFuture",
                  checked: cardData.saveForFuture,
                  onCheckedChange: (checked) => {
                    setCardData((prev) => ({ ...prev, saveForFuture: !!checked }));
                  },
                  disabled: submitting,
                  className: "border-[#00D1FF]/50 data-[state=checked]:bg-[#00D1FF] data-[state=checked]:border-[#00D1FF]"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "saveForFuture", className: "text-[#00D1FF] text-sm cursor-pointer", children: "💾 Salva per pagamenti futuri" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-xs", children: "Sicuro e crittografato tramite Stripe PCI DSS" })
              ] })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-green-900/20 border border-green-500/30 rounded-lg p-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-4 h-4 text-green-400 mt-0.5 flex-shrink-0" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-green-100", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs font-semibold mb-1 flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "w-3 h-3 mr-1" }),
                  "Sicurezza PCI DSS Level 1"
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-green-200/90 text-xs", children: "Dati tokenizzati via Stripe. M1SSION™ non memorizza mai numeri completi." })
              ] })
            ] }) }),
            cardData.cardNumber && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center px-2 py-1 bg-white/10 rounded text-xs", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(CreditCard, { className: "w-3 h-3 mr-1 text-[#00D1FF]" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white/80", children: [
                getBrandFromNumber(cardData.cardNumber),
                " Rilevata"
              ] })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex space-x-3 pt-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  type: "button",
                  variant: "outline",
                  onClick: handleClose,
                  disabled: submitting,
                  className: "flex-1 border-white/40 text-white hover:bg-white/10 h-11",
                  children: "Annulla"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  type: "submit",
                  disabled: submitting || !isFormValid,
                  className: "flex-1 bg-[#00D1FF] hover:bg-[#00B8E6] text-black font-semibold h-11 disabled:opacity-50 disabled:cursor-not-allowed",
                  children: submitting ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin mr-2" }),
                    "Salvando..."
                  ] }) : "Salva Carta"
                }
              )
            ] })
          ] })
        ] })
      ] })
    }
  ) }) });
};

function useStripeMode() {
  const [mode, setMode] = reactExports.useState("unknown");
  const [loading, setLoading] = reactExports.useState(true);
  const [error, setError] = reactExports.useState(null);
  const [keyPrefix, setKeyPrefix] = reactExports.useState();
  const [hasKey, setHasKey] = reactExports.useState();
  const fetchStripeMode = async () => {
    try {
      setLoading(true);
      setError(null);
      console.info("🔍 [useStripeMode] Fetching Stripe mode from server...");
      const { data, error: supabaseError } = await supabase.functions.invoke("stripe-mode", {
        method: "POST"
      });
      if (supabaseError) {
        console.error("❌ [useStripeMode] Supabase error:", supabaseError);
        setError(supabaseError.message);
        setMode("unknown");
        return;
      }
      const response = data;
      console.info("✅ [useStripeMode] Server response:", response);
      setMode(response.mode || "unknown");
      setKeyPrefix(response.keyPrefix);
      setHasKey(response.hasKey);
    } catch (err) {
      console.error("❌ [useStripeMode] Fetch error:", err);
      setError(err instanceof Error ? err.message : "Unknown error");
      setMode("unknown");
    } finally {
      setLoading(false);
    }
  };
  reactExports.useEffect(() => {
    fetchStripeMode();
  }, []);
  return {
    mode,
    loading,
    error,
    keyPrefix,
    hasKey,
    refresh: fetchStripeMode
  };
}

const SavedCardPayment = ({
  config,
  onSuccess,
  onCancel
}) => {
  const [savedCard, setSavedCard] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(false);
  const [showAddCard, setShowAddCard] = reactExports.useState(false);
  const [useManualEntry, setUseManualEntry] = reactExports.useState(false);
  const { user } = useAuthContext();
  const { mode: stripeMode} = useStripeMode();
  reactExports.useEffect(() => {
    const loadDefaultCard = async () => {
      if (!user) return;
      try {
        console.log("🔍 M1SSION™ Loading default card for user:", user.id);
        const { data, error } = await supabase.from("user_payment_methods").select("*").eq("user_id", user.id).eq("is_default", true).order("created_at", { ascending: false }).limit(1).maybeSingle();
        if (error) {
          console.error("❌ M1SSION™ Error loading saved card:", error);
          return;
        }
        if (data) {
          setSavedCard(data);
          console.log("✅ M1SSION™ Default card loaded:", {
            brand: data.brand,
            last4: data.last4
          });
        } else {
          console.log("ℹ️ M1SSION™ No default card found");
        }
      } catch (error) {
        console.error("❌ M1SSION™ Error in loadDefaultCard:", error);
      }
    };
    loadDefaultCard();
  }, [user]);
  const processPaymentWithSavedCard = async () => {
    if (!savedCard || !user) return;
    setLoading(true);
    try {
      console.log("🚀 M1SSION™ Processing payment with saved card:", savedCard.stripe_pm_id);
      console.log("🔧 M1SSION™ Using Stripe mode:", stripeMode);
      const { data, error } = await supabase.functions.invoke("create-payment-intent", {
        body: {
          amount: config.amount,
          // Already in cents
          currency: "eur",
          payment_type: "buzz_map",
          plan: "one_time"
        }
      });
      if (error) {
        console.error("❌ M1SSION™ Payment error:", error);
        if (error.code === "not_authenticated" || error.message?.includes("401")) {
          ue$1.error("Devi accedere per usare questa funzione.");
          return;
        } else if (error.code === "card_declined") {
          ue$1.error(`Carta rifiutata: ${error.message}`);
          return;
        } else {
          ue$1.error(`Errore pagamento: ${error.message || "Errore sconosciuto"} (${error.code || "unknown"})`);
          return;
        }
      }
      const clientSecret = data?.client_secret || data?.clientSecret;
      if (clientSecret && savedCard?.stripe_pm_id) {
        console.debug("✅ M1SSION™ Payment intent created:", {
          functionName: "create-payment-intent",
          amount: config.amount,
          mode: data?.mode,
          paymentIntentId: data?.paymentIntentId || data?.payment_intent_id
        });
        const stripe = await (await __vitePreload(async () => { const {getStripeSafe} = await Promise.resolve().then(() => stripeFallback);return { getStripeSafe }},true?void 0:void 0)).getStripeSafe();
        if (!stripe) {
          throw new Error("Stripe non inizializzato");
        }
        const { error: confirmError, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
          payment_method: savedCard.stripe_pm_id
        });
        if (confirmError) {
          console.error("❌ M1SSION™ Stripe confirmation error:", confirmError);
          throw new Error(confirmError.message || "Errore nella conferma del pagamento");
        }
        if (paymentIntent?.status === "succeeded") {
          console.log("✅ M1SSION™ Payment succeeded");
          window.dispatchEvent(new CustomEvent("paymentIntentSucceeded", {
            detail: { paymentIntentId: paymentIntent.id }
          }));
          onSuccess(paymentIntent.id);
        } else if (paymentIntent?.status === "requires_action") {
          console.log("🔄 M1SSION™ Payment requires additional action");
          ue$1.info("Autenticazione aggiuntiva richiesta");
        } else {
          throw new Error(`Stato pagamento non gestito: ${paymentIntent?.status}`);
        }
      } else if (data?.payment_intent_id) {
        console.log("✅ M1SSION™ Payment succeeded immediately");
        onSuccess(data.payment_intent_id);
      }
    } catch (error) {
      console.error("❌ M1SSION™ Payment processing error:", error);
      ue$1.error("Errore nel processare il pagamento");
    } finally {
      setLoading(false);
    }
  };
  const getCardIcon = (brand) => {
    const colors = {
      visa: "bg-blue-600",
      mastercard: "bg-red-600",
      amex: "bg-green-600",
      discover: "bg-orange-600",
      default: "bg-gray-600"
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-8 h-6 rounded ${colors[brand.toLowerCase()] || colors.default} flex items-center justify-center text-white text-xs font-bold`, children: brand.slice(0, 2).toUpperCase() });
  };
  const handleCardSaved = async (cardData) => {
    try {
      console.log("💳 M1SSION™ Saving new card:", cardData);
      const { data, error } = await supabase.from("user_payment_methods").insert({
        user_id: user.id,
        stripe_pm_id: cardData.stripeToken || `pm_${Math.random().toString(36).substring(2, 15)}`,
        brand: cardData.cardNumber?.charAt(0) === "4" ? "visa" : "mastercard",
        last4: cardData.cardNumber?.replace(/\s/g, "").slice(-4) || "0000",
        exp_month: parseInt(cardData.expiryMonth),
        exp_year: parseInt(cardData.expiryYear),
        is_default: cardData.saveForFuture || true
      });
      if (error) throw error;
      console.log("✅ M1SSION™ Card saved successfully");
      ue$1.success("Carta salvata con successo!");
      setShowAddCard(false);
      window.location.reload();
    } catch (error) {
      console.error("❌ M1SSION™ Error saving card:", error);
      ue$1.error("Errore nel salvare la carta");
    }
  };
  if (showAddCard) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      AddCardDialog,
      {
        onClose: () => setShowAddCard(false),
        onAddCard: handleCardSaved,
        loading
      }
    );
  }
  if (useManualEntry || !savedCard) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "w-full max-w-md mx-auto bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30 max-h-[85vh] overflow-y-auto", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-center text-white", children: [
          "💳 ",
          config.type === "subscription" ? `Abbonamento ${config.plan}` : config.type === "buzz_map" ? "BUZZ MAPPA" : "BUZZ Payment"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-300", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-bold", children: [
            "€",
            (config.amount / 100).toFixed(2),
            config.type === "subscription" ? "/mese" : ""
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm", children: config.description })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-400", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CreditCard, { className: "w-12 h-12 mx-auto mb-3" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mb-4", children: "Nessuna carta salvata trovata" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: () => setShowAddCard(true),
              className: "w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-2" }),
                "Aggiungi Carta"
              ]
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2 mt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "outline",
            onClick: onCancel,
            className: "flex-1",
            children: "Annulla"
          }
        ) })
      ] })
    ] });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "w-full max-w-md mx-auto bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30 max-h-[85vh] overflow-y-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-center text-white", children: [
        "💳 ",
        config.type === "subscription" ? `Abbonamento ${config.plan}` : config.type === "buzz_map" ? "BUZZ MAPPA" : "BUZZ Payment"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-300", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-bold", children: [
          "€",
          (config.amount / 100).toFixed(2),
          config.type === "subscription" ? "/mese" : ""
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm", children: config.description })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 bg-gray-800/50 rounded-lg border border-gray-600", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
          getCardIcon(savedCard.brand),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-white font-medium", children: [
              "**** **** **** ",
              savedCard.last4
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-gray-400 text-sm", children: [
              savedCard.brand.charAt(0).toUpperCase() + savedCard.brand.slice(1),
              " • ",
              savedCard.exp_month.toString().padStart(2, "0"),
              "/",
              savedCard.exp_year.toString().slice(-2)
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-green-400 text-sm font-medium", children: "✓ Predefinita" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: processPaymentWithSavedCard,
            disabled: loading,
            className: "w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",
            children: loading ? "Elaborazione..." : `Usa questa carta - €${(config.amount / 100).toFixed(2)}`
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            variant: "outline",
            onClick: () => setShowAddCard(true),
            className: "w-full",
            disabled: loading,
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-2" }),
              "Usa altra carta"
            ]
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "outline",
          onClick: onCancel,
          className: "flex-1",
          disabled: loading,
          children: "Annulla"
        }
      ) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-gray-400 text-center", children: "🔒 Pagamento sicuro elaborato da Stripe" })
    ] })
  ] });
};

const stripePromise = getStripeSafe();
const CheckoutForm = ({ config, onSuccess, onCancel }) => {
  const stripe = useStripe();
  const elements = useElements();
  const [loading, setLoading] = reactExports.useState(false);
  const [clientSecret, setClientSecret] = reactExports.useState("");
  const { user } = useAuthContext();
  const { mode: stripeMode} = useStripeMode();
  reactExports.useEffect(() => {
    if (!user) return;
    const createPaymentIntent = async () => {
      try {
        console.log("🔥 M1SSION™ Creating payment intent for:", config.type, config);
        console.log("🔧 M1SSION™ Using Stripe mode:", stripeMode);
        const { data, error } = await supabase.functions.invoke("create-payment-intent", {
          body: {
            amount: config.amount,
            // Already in cents
            currency: "eur",
            payment_type: "buzz_map",
            plan: "one_time"
          }
        });
        if (error) {
          console.error("❌ M1SSION™ Payment intent error:", error);
          if (error.code === "not_authenticated" || error.message?.includes("401")) {
            ue$1.error("Devi accedere per usare questa funzione.");
            return;
          } else if (error.code === "card_declined") {
            ue$1.error(`Carta rifiutata: ${error.message}`);
            return;
          } else if (error.message?.includes("mismatch")) {
            ue$1.error(`Errore configurazione Stripe: ${error.message}`);
            return;
          } else {
            ue$1.error(`Errore pagamento: ${error.message || "Errore sconosciuto"} (${error.code || "unknown"})`);
            return;
          }
        }
        const clientSecretValue = data?.client_secret || data?.clientSecret;
        if (clientSecretValue) {
          setClientSecret(clientSecretValue);
          console.debug("✅ M1SSION™ Payment intent created:", {
            functionName: "create-payment-intent",
            amount: config.amount,
            mode: data?.mode,
            paymentIntentId: data?.paymentIntentId || data?.payment_intent_id
          });
        } else {
          console.error("❌ M1SSION™ No client secret received:", data);
          ue$1.error("Errore nella configurazione del pagamento");
          return;
        }
      } catch (error) {
        console.error("❌ M1SSION™ Payment intent failed:", error);
        ue$1.error("Errore nel sistema di pagamento");
      }
    };
    createPaymentIntent();
  }, [user, config]);
  const handleSubmit = async (event) => {
    event.preventDefault();
    if (!stripe || !elements || !clientSecret) {
      ue$1.error("Sistema di pagamento non pronto");
      return;
    }
    setLoading(true);
    const cardElement = elements.getElement(CardElement);
    if (!cardElement) {
      ue$1.error("Elemento carta non trovato");
      setLoading(false);
      return;
    }
    try {
      console.log("🚀 M1SSION™ Processing payment...");
      console.log("🚀 M1SSION™ Confirming payment with mode:", stripeMode);
      const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
        payment_method: {
          card: cardElement,
          billing_details: {
            email: user?.email || ""
          }
        }
      });
      if (error) {
        console.error("❌ M1SSION™ Payment failed:", error);
        const errorCode = error.code || "unknown";
        const errorMessage = error.message || "Errore sconosciuto";
        ue$1.error(`Pagamento fallito: ${errorMessage} (${errorCode})`);
      } else if (paymentIntent.status === "succeeded") {
        console.log("✅ M1SSION™ Payment succeeded:", paymentIntent.id);
        window.dispatchEvent(new CustomEvent("paymentIntentSucceeded", {
          detail: { paymentIntentId: paymentIntent.id }
        }));
        onSuccess(paymentIntent.id);
      }
    } catch (error) {
      console.error("❌ M1SSION™ Payment processing error:", error);
      ue$1.error("Errore nel processare il pagamento");
    } finally {
      setLoading(false);
    }
  };
  const cardElementOptions = {
    style: {
      base: {
        fontSize: "16px",
        color: "#ffffff",
        "::placeholder": {
          color: "#aab7c4"
        },
        backgroundColor: "transparent"
      },
      invalid: {
        color: "#fa755a",
        iconColor: "#fa755a"
      }
    },
    hidePostalCode: true
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "w-full max-w-md mx-auto bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/30 max-h-[85vh] overflow-y-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-center text-white", children: [
        "💳 ",
        config.type === "subscription" ? `Abbonamento ${config.plan}` : config.type === "buzz_map" ? "BUZZ MAPPA" : "BUZZ Payment"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-300", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xl font-bold", children: [
          "€",
          (config.amount / 100).toFixed(2),
          config.type === "subscription" ? "/mese" : ""
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm", children: config.description })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 bg-gray-800/50 rounded-lg border border-gray-600", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardElement, { options: cardElementOptions }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: "outline",
              onClick: onCancel,
              className: "flex-1",
              disabled: loading,
              children: "Annulla"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "submit",
              disabled: !stripe || loading || !clientSecret,
              className: "flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",
              children: loading ? "Elaborazione..." : `Paga €${(config.amount / 100).toFixed(2)}`
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-gray-400 text-center", children: "🔒 Pagamento sicuro elaborato da Stripe" })
    ] })
  ] });
};
const StripeInAppCheckout = ({
  config,
  onSuccess,
  onCancel
}) => {
  const [useSavedCard, setUseSavedCard] = reactExports.useState(false);
  const { user } = useAuthContext();
  reactExports.useEffect(() => {
    const checkDefaultPaymentMethod = async () => {
      if (!user) return;
      try {
        const { data, error } = await supabase.from("user_payment_methods").select("id").eq("user_id", user.id).eq("is_default", true).maybeSingle();
        if (!error && data) {
          console.log("✅ M1SSION™ Default payment method found - enabling auto-fill");
          setUseSavedCard(true);
        } else {
          console.log("ℹ️ M1SSION™ No default payment method - using manual entry");
          setUseSavedCard(false);
        }
      } catch (error) {
        console.error("❌ M1SSION™ Error checking default payment method:", error);
        setUseSavedCard(false);
      }
    };
    checkDefaultPaymentMethod();
  }, [user]);
  const options = {
    appearance: {
      theme: "night",
      variables: {
        colorPrimary: "#8b5cf6",
        colorBackground: "#1f2937",
        colorText: "#ffffff",
        colorDanger: "#df1b41",
        fontFamily: "system-ui, sans-serif",
        spacingUnit: "4px",
        borderRadius: "8px"
      }
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: "fixed inset-0 bg-black/95 backdrop-blur-sm flex items-center justify-center p-4 z-[9999] overflow-y-auto",
      style: {
        paddingTop: "calc(env(safe-area-inset-top, 47px) + 20px)",
        paddingBottom: "calc(env(safe-area-inset-bottom, 34px) + 20px)",
        maxHeight: "100dvh"
      },
      children: useSavedCard ? /* @__PURE__ */ jsxRuntimeExports.jsx(
        SavedCardPayment,
        {
          config,
          onSuccess,
          onCancel
        }
      ) : /* @__PURE__ */ jsxRuntimeExports.jsx(Elements, { stripe: stripePromise, options, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        CheckoutForm,
        {
          config,
          onSuccess,
          onCancel
        }
      ) })
    }
  );
};

const EUR_TO_M1U_RATE = 100;
function formatM1U(eurPrice) {
  const m1uValue = Math.round(eurPrice * EUR_TO_M1U_RATE);
  const formatted = new Intl.NumberFormat("it-IT").format(m1uValue);
  return `${formatted} M1U`;
}
function eurToM1U(eurPrice) {
  return Math.round(eurPrice * EUR_TO_M1U_RATE);
}

const PRICING_CONFIG = {
  Base: {
    priceEur: 0,
    priceCents: 0,
    priceM1U: 0,
    displayPrice: "0 M1U",
    label: "Base - Gratis",
    features: [
      "Funzioni base (accesso alla missione con restrizioni)",
      "Supporto email standard",
      "1 indizio settimanale base"
    ],
    limitations: [
      "Nessun accesso anticipato agli eventi",
      "Nessun badge esclusivo"
    ],
    earlyAccess: 0
  },
  Silver: {
    priceEur: 3.99,
    priceCents: 399,
    priceM1U: eurToM1U(3.99),
    displayPrice: formatM1U(3.99),
    label: "Silver",
    features: [
      "Tutti i vantaggi Base",
      "3 indizi premium aggiuntivi a settimana",
      "Accesso anticipato di 2 ore agli eventi",
      "Badge Silver nel profilo"
    ],
    earlyAccess: 2
  },
  Gold: {
    priceEur: 6.99,
    priceCents: 699,
    priceM1U: eurToM1U(6.99),
    displayPrice: formatM1U(6.99),
    label: "Gold",
    features: [
      "Tutti i vantaggi Silver",
      "4 indizi premium aggiuntivi a settimana",
      "Accesso anticipato di 12 ore agli eventi",
      "Partecipazione alle estrazioni Gold",
      "Badge Gold esclusivo nel profilo"
    ],
    earlyAccess: 12
  },
  Black: {
    priceEur: 9.99,
    priceCents: 999,
    priceM1U: eurToM1U(9.99),
    displayPrice: formatM1U(9.99),
    label: "Black",
    features: [
      "Tutti i vantaggi Gold",
      "Accesso VIP anticipato di 24 ore agli eventi",
      "5 indizi premium aggiuntivi a settimana",
      "Badge Black esclusivo"
    ],
    earlyAccess: 24
  },
  Titanium: {
    priceEur: 29.99,
    priceCents: 2999,
    priceM1U: eurToM1U(29.99),
    displayPrice: formatM1U(29.99),
    label: "Titanium",
    features: [
      "Tutti i vantaggi Black",
      "5 indizi premium aggiuntivi a settimana",
      "Accesso VIP anticipato di 48 ore agli eventi",
      "Supporto prioritario dedicato (24/7)",
      "Eventi esclusivi M1SSION™",
      "Badge Titanium esclusivo"
    ],
    earlyAccess: 48
  }
};
const getPriceCents = (plan) => {
  const planData = PRICING_CONFIG[plan];
  return planData?.priceCents || 0;
};
const getDisplayPrice = (plan) => {
  const planData = PRICING_CONFIG[plan];
  return planData?.displayPrice || "€0.00";
};
const getPriceEur = (plan) => {
  const planData = PRICING_CONFIG[plan];
  return planData?.priceEur || 0;
};

const pricingConfig = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  PRICING_CONFIG,
  getDisplayPrice,
  getPriceCents,
  getPriceEur
}, Symbol.toStringTag, { value: 'Module' }));

const SubscriptionPlans = ({ selected, setSelected }) => {
  const { toast } = useToast();
  useWouterNavigation();
  const { upgradeSubscription } = useProfileSubscription();
  const [showInAppCheckout, setShowInAppCheckout] = reactExports.useState(false);
  const [selectedPlan, setSelectedPlan] = reactExports.useState("");
  React$1.useEffect(() => {
    const handleStripeReturn = async () => {
      console.log("🔍 M1SSION™ CHECKING URL FOR STRIPE RETURN...");
      const urlParams = new URLSearchParams(window.location.search);
      const isSuccess = urlParams.get("success") === "true";
      const tier = urlParams.get("tier");
      const sessionId = urlParams.get("session_id");
      const isCanceled = urlParams.get("canceled") === "true";
      console.log("🔍 M1SSION™ URL PARAMS ANALYSIS:", {
        checkoutTier: tier,
        sessionId,
        isSuccess,
        isCanceled,
        fullUrl: window.location.href,
        search: window.location.search,
        hasParams: window.location.search.length > 0
      });
      if (isCanceled) {
        console.log("❌ M1SSION™ STRIPE CANCELED");
        ue$1.error("Pagamento annullato", {
          description: "Il pagamento è stato annullato",
          duration: 4e3
        });
        window.history.replaceState({}, "", "/subscriptions");
        return;
      }
      if (!isSuccess || !tier) {
        console.log("❌ M1SSION™ NO SUCCESS PARAMS - isSuccess:", isSuccess, "tier:", tier);
        return;
      }
      console.log("🎉 M1SSION™ STRIPE SUCCESS DETECTED - PROCESSING TIER UPDATE:", tier);
      try {
        const { data: { user }, error: userError } = await supabase.auth.getUser();
        if (userError || !user) {
          console.error("❌ M1SSION™ User auth error:", userError);
          return;
        }
        console.log("👤 M1SSION™ User authenticated:", user.id);
        console.log("🔄 M1SSION™ FORCING PROFILE UPDATE...");
        const { data: profileUpdate, error: profileError } = await supabase.from("profiles").update({
          subscription_tier: tier,
          tier,
          updated_at: (/* @__PURE__ */ new Date()).toISOString()
        }).eq("id", user.id).select().single();
        if (profileError) {
          console.error("❌ M1SSION™ Profile update error:", profileError);
        } else {
          console.log("✅ M1SSION™ Profile updated successfully:", profileUpdate);
        }
        console.log("🔄 M1SSION™ Invoking verify-subscription-sync...");
        const { data: syncResult, error: syncError } = await supabase.functions.invoke("verify-subscription-sync");
        if (syncError) {
          console.error("❌ M1SSION™ Sync error:", syncError);
        } else {
          console.log("✅ M1SSION™ Sync result:", syncResult);
        }
        console.log("🔄 M1SSION™ Creating/updating subscription record...");
        const { error: subscriptionError } = await supabase.from("subscriptions").upsert({
          user_id: user.id,
          tier,
          status: "active",
          current_period_start: (/* @__PURE__ */ new Date()).toISOString(),
          current_period_end: new Date(Date.now() + 30 * 24 * 60 * 60 * 1e3).toISOString(),
          // 30 days
          updated_at: (/* @__PURE__ */ new Date()).toISOString()
        }, {
          onConflict: "user_id"
        });
        if (subscriptionError) {
          console.error("❌ M1SSION™ Subscription upsert error:", subscriptionError);
        } else {
          console.log("✅ M1SSION™ Subscription record created/updated");
        }
        console.log("🔄 M1SSION™ Updating local state...");
        setSelected(tier);
        localStorage.setItem("userTier", tier);
        localStorage.setItem("pending_plan_update", tier);
        try {
          await upgradeSubscription(tier);
          console.log("✅ M1SSION™ upgradeSubscription called successfully");
        } catch (upgradeError) {
          console.error("❌ M1SSION™ upgradeSubscription error:", upgradeError);
        }
        const { error: logError } = await supabase.from("panel_logs").insert({
          event_type: "subscription_upgraded",
          details: {
            user_id: user.id,
            new_tier: tier,
            session_id: sessionId,
            timestamp: (/* @__PURE__ */ new Date()).toISOString(),
            source: "stripe_success_return"
          }
        });
        if (logError) {
          console.error("❌ M1SSION™ Panel log error:", logError);
        } else {
          console.log("✅ M1SSION™ Panel log created");
        }
        console.log("🎉 M1SSION™ SHOWING SUCCESS TOAST");
        ue$1.success(`🎉 Piano ${tier} attivato!`, {
          description: `Il tuo abbonamento ${tier} è ora attivo e funzionante`,
          duration: 6e3
        });
        setTimeout(() => {
          console.log("🧹 M1SSION™ Cleaning URL...");
          window.history.replaceState({}, "", "/subscriptions");
        }, 2e3);
        console.log("✅ M1SSION™ STRIPE SUCCESS PROCESSING COMPLETED");
      } catch (error) {
        console.error("❌ M1SSION™ Critical error processing success:", error);
        ue$1.error("❌ Errore sincronizzazione abbonamento", {
          description: "Il pagamento è andato a buon fine ma c'è stato un errore di sincronizzazione. Contatta il supporto.",
          duration: 8e3
        });
      }
    };
    handleStripeReturn();
  }, []);
  const getSubscriptionFeatures = (type) => {
    switch (type) {
      case "Base":
        return [
          { text: "Funzioni base (accesso alla missione con restrizioni)" },
          { text: "Supporto email standard" },
          { text: "1 indizio settimanale base" }
        ];
      case "Silver":
        return [
          { text: "Tutti i vantaggi Base" },
          { text: "3 indizi premium aggiuntivi a settimana" },
          { text: "Accesso anticipato di 2 ore agli eventi" },
          { text: "Badge Silver nel profilo" }
        ];
      case "Gold":
        return [
          { text: "Tutti i vantaggi Silver" },
          { text: "4 indizi premium aggiuntivi a settimana" },
          { text: "Accesso anticipato di 12 ore agli eventi" },
          { text: "Partecipazione alle estrazioni Gold" },
          { text: "Badge Gold esclusivo nel profilo" }
        ];
      case "Black":
        return [
          { text: "Tutti i vantaggi Gold" },
          { text: "Accesso VIP anticipato di 24 ore agli eventi" },
          { text: "5 indizi premium aggiuntivi a settimana" },
          { text: "Badge Black esclusivo" }
        ];
      case "Titanium":
        return [
          { text: "Tutti i vantaggi Black" },
          { text: "7 indizi premium aggiuntivi a settimana" },
          { text: "Accesso VIP anticipato di 48 ore agli eventi" },
          { text: "Supporto prioritario dedicato (24/7)" },
          { text: "Eventi esclusivi M1SSION™" },
          { text: "Badge Titanium esclusivo" }
        ];
      default:
        return [];
    }
  };
  const handleUpdatePlan = async (plan) => {
    console.log(`🔥 M1SSION™ CLICK DETECTED: ${plan} button clicked`);
    console.log(`🔧 M1SSION™ STATE:`, { selected, plan, equal: plan === selected });
    console.log(`🌐 M1SSION™ Current location before navigate:`, window.location.href);
    console.log(`🚀 M1SSION™ PROCESSING: ${selected} → ${plan} (ALWAYS ALLOWED)`);
    if (plan === selected) {
      console.log(`🔄 M1SSION™ RE-CHECKOUT: Allowing re-checkout for ${plan}`);
    }
    try {
      console.log(`🔥 M1SSION™ PLAN UPDATE STARTED: ${plan}`);
      console.log(`📊 M1SSION™ Current state:`, {
        selectedPlan: selected,
        requestedPlan: plan,
        isDowngrade: plan === "Base"
      });
      if (plan === "Base") {
        console.log(`⬇️ M1SSION™ DOWNGRADE: To Base plan`);
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
          console.log(`👤 M1SSION™ User authenticated:`, user.id);
          await supabase.from("profiles").update({ subscription_plan: "Base" }).eq("id", user.id);
          try {
            console.log(`🔄 M1SSION™ Calling cancel-subscription function...`);
            const { data: cancelData, error: cancelError } = await supabase.functions.invoke("cancel-subscription");
            if (cancelError) {
              console.error("❌ M1SSION™ Cancel subscription error:", cancelError);
            } else {
              console.log("✅ M1SSION™ Cancel subscription response:", cancelData);
            }
          } catch (cancelStripeError) {
            console.error("❌ M1SSION™ Cancel subscription failed:", cancelStripeError);
          }
          localStorage.setItem("userTier", "Base");
          await upgradeSubscription("Base");
          setSelected("Base");
          console.log(`✅ M1SSION™ Local state updated to Base`);
        }
        toast({
          title: "✅ Piano Base attivato",
          description: "Stai utilizzando il piano Base gratuito",
          duration: 4e3
        });
      } else {
        console.log(`🚀 M1SSION™ IN-APP PAYMENT: To ${plan} plan (upgrade/downgrade/re-checkout)`);
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
          console.log(`🔄 M1SSION™ Updating profile with plan: ${plan}`);
          await supabase.from("profiles").update({ subscription_plan: plan }).eq("id", user.id);
        }
        console.log(`💳 M1SSION™ Opening in-app checkout modal for ${plan}`);
        setSelectedPlan(plan);
        setShowInAppCheckout(true);
        toast({
          title: "💳 Checkout in-app aperto",
          description: `Completa il pagamento per il piano ${plan}`
        });
      }
    } catch (error) {
      console.error("❌ M1SSION™ Upgrade error:", error);
      toast({
        title: "❌ Errore durante l'operazione",
        description: "Si è verificato un errore. Riprova tra qualche istante.",
        variant: "destructive",
        duration: 5e3
      });
    }
  };
  const handleInAppPaymentSuccess = async () => {
    console.log("🎉 M1SSION™ In-app payment successful");
    setShowInAppCheckout(false);
    setSelected(selectedPlan);
    try {
      await upgradeSubscription(selectedPlan);
      ue$1.success(`🎉 Piano ${selectedPlan} attivato!`, {
        description: "Il tuo abbonamento è ora attivo",
        duration: 6e3
      });
    } catch (error) {
      console.error("❌ M1SSION™ Error refreshing subscription:", error);
    }
  };
  const handleInAppPaymentCancel = () => {
    console.log("❌ M1SSION™ In-app payment cancelled");
    setShowInAppCheckout(false);
    setSelectedPlan("");
  };
  const verifyDowngrade = async (maxRetries = 3) => {
    for (let i = 0; i < maxRetries; i++) {
      try {
        console.log(`🔄 M1SSION™ Verify attempt ${i + 1}/${maxRetries}`);
        const { data: verifyData, error: verifyError } = await supabase.functions.invoke("verify-subscription-sync");
        if (verifyError) {
          console.error(`❌ M1SSION™ Verify error (attempt ${i + 1}):`, verifyError);
          continue;
        }
        console.log(`📊 M1SSION™ Verify result:`, verifyData);
        if (verifyData?.tier === "Base") {
          console.log(`✅ M1SSION™ Downgrade verified successfully`);
          setSelected("Base");
          return true;
        } else {
          console.log(`⚠️ M1SSION™ Still not Base tier: ${verifyData?.tier}, retrying...`);
          if (i < maxRetries - 1) {
            await new Promise((resolve) => setTimeout(resolve, 2e3));
          }
        }
      } catch (error) {
        console.error(`❌ M1SSION™ Verify attempt ${i + 1} failed:`, error);
      }
    }
    return false;
  };
  const handleCancelSubscription = async () => {
    if (selected === "Base") {
      toast({
        title: "Nessun abbonamento attivo",
        description: "Hai già il piano base gratuito"
      });
      return;
    }
    console.log(`🔄 M1SSION™ Starting subscription cancellation...`);
    try {
      await handleUpdatePlan("Base");
      const success = await verifyDowngrade();
      if (success) {
        toast({
          title: "✅ Abbonamento cancellato",
          description: "Il tuo abbonamento è stato cancellato con successo"
        });
      } else {
        toast({
          title: "⚠️ Cancellazione in corso",
          description: "La cancellazione potrebbe richiedere alcuni minuti",
          variant: "destructive"
        });
      }
    } catch (error) {
      console.error("❌ M1SSION™ Cancel subscription error:", error);
      toast({
        title: "❌ Errore cancellazione",
        description: "Riprova tra qualche istante",
        variant: "destructive"
      });
    }
  };
  React$1.useEffect(() => {
    console.log("🔄 M1SSION™ Setting up realtime subscription updates...");
    const channel = supabase.channel("profiles-changes").on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "profiles"
      },
      (payload) => {
        console.log("🔄 M1SSION™ REALTIME PROFILE UPDATE:", payload);
        if (payload.new && payload.new.id) {
          supabase.auth.getUser().then(({ data: { user } }) => {
            if (user && user.id === payload.new.id) {
              console.log("✅ M1SSION™ REALTIME: Current user profile updated");
              const newTier = payload.new.subscription_tier || payload.new.tier;
              if (newTier && newTier !== selected) {
                console.log("🔄 M1SSION™ REALTIME: Updating UI to new tier:", newTier);
                setSelected(newTier);
                localStorage.setItem("userTier", newTier);
                if (newTier !== "Base") {
                  ue$1.success(`🎉 Piano ${newTier} sincronizzato!`, {
                    description: "Il tuo abbonamento è ora attivo",
                    duration: 4e3
                  });
                }
              }
            }
          });
        }
      }
    ).subscribe();
    return () => {
      console.log("🧹 M1SSION™ Cleaning up realtime subscription...");
      supabase.removeChannel(channel);
    };
  }, [selected]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "w-full px-4 pb-10", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-12", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Base",
          price: "Gratis",
          period: "mese",
          features: getSubscriptionFeatures("Base"),
          isPopular: false,
          ctaText: selected === "Base" ? "Piano Attuale" : "Passa a Base",
          type: "Base",
          onClick: () => handleUpdatePlan("Base"),
          isActive: selected === "Base"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Silver",
          price: getDisplayPrice("Silver"),
          period: "mese",
          features: getSubscriptionFeatures("Silver"),
          isPopular: false,
          ctaText: selected === "Silver" ? "Piano Attuale" : "Passa a Silver",
          type: "Silver",
          onClick: () => handleUpdatePlan("Silver"),
          isActive: selected === "Silver"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Gold",
          price: getDisplayPrice("Gold"),
          period: "mese",
          features: getSubscriptionFeatures("Gold"),
          isPopular: true,
          ctaText: selected === "Gold" ? "Piano Attuale" : "Passa a Gold",
          type: "Gold",
          onClick: () => handleUpdatePlan("Gold"),
          isActive: selected === "Gold"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Black",
          price: getDisplayPrice("Black"),
          period: "mese",
          features: getSubscriptionFeatures("Black"),
          isPopular: false,
          ctaText: selected === "Black" ? "Piano Attuale" : "Passa a Black",
          type: "Black",
          onClick: () => handleUpdatePlan("Black"),
          isActive: selected === "Black"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        SubscriptionCard,
        {
          title: "Titanium",
          price: getDisplayPrice("Titanium"),
          period: "mese",
          features: getSubscriptionFeatures("Titanium"),
          isPopular: false,
          ctaText: selected === "Titanium" ? "Piano Attuale" : "Passa a Titanium",
          type: "Titanium",
          onClick: () => {
            console.log("🔥 M1SSION™ TITANIUM CLICK INTERCEPTED");
            handleUpdatePlan("Titanium");
          },
          isActive: selected === "Titanium"
        }
      )
    ] }),
    selected !== "Base" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center mb-10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        variant: "outline",
        onClick: handleCancelSubscription,
        className: "border-red-500 text-red-500 hover:bg-red-500/10",
        children: "Cancella abbonamento"
      }
    ) }),
    showInAppCheckout && (() => {
      const planPrice = getPriceCents(selectedPlan) || 399;
      return /* @__PURE__ */ jsxRuntimeExports.jsx(
        StripeInAppCheckout,
        {
          config: {
            type: "subscription",
            amount: planPrice,
            description: `Piano ${selectedPlan} con accesso premium`,
            plan: selectedPlan,
            metadata: {
              subscription_plan: selectedPlan,
              mission: "M1SSION",
              reset_date: "2025-07-22"
            }
          },
          onSuccess: async (paymentIntentId) => {
            console.log("🎉 Subscription payment completed:", paymentIntentId);
            await handleInAppPaymentSuccess();
          },
          onCancel: handleInAppPaymentCancel
        }
      );
    })()
  ] });
};

const SubscriptionBenefits = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "w-full py-10 px-4 backdrop-blur-lg bg-white/5 border border-white/10 rounded-xl mx-auto max-w-3xl mb-12", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-8 text-center bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent", children: "Vantaggi dei Piani Premium" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4 max-w-xl mx-auto", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center p-3 bg-white/5 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center mr-4 flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-5 h-5 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/90", children: "Più indizi per aumentare le possibilità di vittoria" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center p-3 bg-white/5 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center mr-4 flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-5 h-5 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/90", children: "Accesso anticipato a nuovi eventi e premi esclusivi" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center p-3 bg-white/5 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-8 h-8 rounded-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center mr-4 flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-5 h-5 text-white" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white/90", children: "Badge speciale nel profilo utente" })
      ] })
    ] })
  ] });
};

const SubscriptionFAQ = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { className: "w-full py-10 px-4 mb-12", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-8 text-center bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent", children: "Domande Frequenti" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4 max-w-3xl mx-auto", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-lg mb-2", children: "Cosa succede dopo aver acquistato un abbonamento?" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Subito dopo l'acquisto avrai accesso ai vantaggi del piano selezionato." })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-lg mb-2", children: "Posso cambiare piano in qualsiasi momento?" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Sì, puoi cambiare o annullare il tuo abbonamento in qualsiasi momento dalle impostazioni del profilo." })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-lg mb-2", children: "Come vengono gestiti i pagamenti?" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "I pagamenti sono gestiti in totale sicurezza tramite Stripe." })
      ] })
    ] })
  ] });
};

class PaymentErrorHandler {
  static logAnalyticsEvent(eventName, data) {
    {
      window.gtag?.("event", eventName, data);
    }
  }
  static async handlePaymentError(error, context = "payment") {
    let userMessage = "Errore nella creazione del pagamento. Riprova tra poco.";
    let errorCode = "unknown";
    if (error instanceof TypeError && error.message.includes("fetch")) {
      userMessage = "Errore di connessione. Controlla la tua connessione internet.";
      errorCode = "network_error";
    } else if (error?.status === 0 || [502, 503, 504].includes(error?.status)) {
      userMessage = "Servizio temporaneamente non disponibile. Riprova tra poco.";
      errorCode = "service_unavailable";
    } else if (error?.message?.includes("CORS") || error?.code === "CORS_ERROR") {
      userMessage = "Errore di configurazione. Contatta il supporto.";
      errorCode = "cors_error";
    } else if (error?.type === "stripe_error") {
      userMessage = "Errore del sistema di pagamento. Riprova o contatta il supporto.";
      errorCode = "stripe_error";
    }
    ue$1.error(userMessage, {
      duration: 5e3,
      position: "top-center"
    });
    this.logAnalyticsEvent("payment_error", {
      context,
      error_code: errorCode,
      error_message: error?.message || "Unknown error",
      timestamp: Date.now()
    });
    return { handled: true, userMessage, errorCode };
  }
  static async retryWithBackoff(fn, maxRetries = 1, baseDelay = 500) {
    let lastError;
    for (let attempt = 0; attempt <= maxRetries; attempt++) {
      try {
        return await fn();
      } catch (error) {
        lastError = error;
        if (error?.status === 400 || error?.status === 401 || error?.status === 403) {
          throw error;
        }
        if (attempt === maxRetries) {
          throw error;
        }
        const delay = baseDelay + Math.random() * 300;
        await new Promise((resolve) => setTimeout(resolve, delay));
      }
    }
    throw lastError;
  }
}

const useStripePayment = () => {
  const [loading, setLoading] = reactExports.useState(false);
  const { user } = useAuthContext();
  const processSubscription = async (plan, paymentMethod) => {
    if (!user) {
      ue$1.error("Devi essere loggato per effettuare acquisti");
      return;
    }
    try {
      await PaymentErrorHandler.retryWithBackoff(async () => {
        const { data: modeData, error: modeErr } = await supabase.functions.invoke("stripe-mode");
        if (modeErr) throw new Error(`Mode check failed: ${modeErr.message}`);
        const { assertPkMatchesMode } = await __vitePreload(async () => { const { assertPkMatchesMode } = await import('./guard.DOcH0qyA.js');return { assertPkMatchesMode }},true?[]:void 0);
        assertPkMatchesMode(modeData?.mode);
      });
    } catch (e) {
      await PaymentErrorHandler.handlePaymentError(e, "stripe_mode_check");
      setLoading(false);
      return;
    }
    setLoading(true);
    try {
      const { data, error } = await supabase.functions.invoke("create-checkout", {
        body: {
          user_id: user.id,
          plan: plan.toUpperCase(),
          // 🔥 CRITICAL: Convert to uppercase for edge function
          payment_method: paymentMethod || "card",
          mode: "live"
          // Force live mode for production
        }
      });
      if (error) {
        console.error("❌ STRIPE Error creating checkout session:", error);
        console.error("❌ STRIPE Full error details:", JSON.stringify(error, null, 2));
        ue$1.error(`Errore Stripe: ${error.message || "Sessione di pagamento fallita"}`);
        return;
      }
      if (data?.url) {
        console.log("🚀 M1SSION™ STRIPE REDIRECT - Opening checkout in new tab:", data.url);
        console.log("⚡ M1SSION™ Using window.open for subscription checkout (same as BUZZ)");
        const newWindow = window.open(data.url, "_blank");
        if (!newWindow) {
          console.error("❌ window.open blocked - trying fallback redirect methods");
          const isIOSPWA = window.navigator.standalone || window.matchMedia && window.matchMedia("(display-mode: standalone)").matches;
          if (isIOSPWA) {
            console.log("📱 iOS PWA detected - Using immediate redirect method");
            try {
              console.log("⚡ M1SSION™ Using location.replace for immediate redirect");
              window.location.replace(data.url);
            } catch (error2) {
              console.error("❌ location.replace failed, trying assign:", error2);
              try {
                window.location.assign(data.url);
              } catch (assignError) {
                console.error("❌ location.assign failed, using href:", assignError);
                window.location.href = data.url;
              }
            }
          } else {
            window.location.href = data.url;
          }
        } else {
          console.log("✅ M1SSION™ STRIPE CHECKOUT opened in new tab successfully");
        }
        ue$1.success("✅ Apertura checkout Stripe...", {
          description: "Checkout aperto in nuova scheda - completa il pagamento"
        });
      } else {
        console.error("❌ M1SSION™ STRIPE CHECKOUT FAILED - No URL received");
        ue$1.error("Errore nel creare la sessione di pagamento");
      }
    } catch (error) {
      console.error("❌ STRIPE Subscription processing error:", error);
      ue$1.error("Errore nel processare l'abbonamento");
    } finally {
      setLoading(false);
    }
  };
  const detectPaymentMethodAvailability = () => {
    const applePayAvailable = typeof window !== "undefined" && "ApplePaySession" in window && window.ApplePaySession?.canMakePayments?.();
    const googlePayAvailable = typeof window !== "undefined" && "PaymentRequest" in window;
    return {
      applePayAvailable: applePayAvailable || false,
      googlePayAvailable: googlePayAvailable || false
    };
  };
  return {
    processSubscription,
    detectPaymentMethodAvailability,
    loading
  };
};

const Subscriptions = () => {
  const [, setLocation] = useLocation();
  const { subscription } = useProfileSubscription();
  const [selected, setSelected] = reactExports.useState(subscription.plan);
  const [profileImage, setProfileImage] = reactExports.useState(null);
  const { processSubscription, loading: stripeLoading } = useStripePayment();
  const LeftComponent = () => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    Button,
    {
      variant: "ghost",
      size: "icon",
      onClick: () => {
        setLocation("/home");
      },
      className: "mr-2",
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
    }
  ) });
  reactExports.useEffect(() => {
    setProfileImage(localStorage.getItem("profileImage"));
    setSelected(subscription.plan);
    const urlParams = new URLSearchParams(window.location.search);
    const checkoutTier = urlParams.get("checkout");
    const tier = urlParams.get("tier");
    const upgradeIntent = urlParams.get("upgrade");
    const fromPage = urlParams.get("from");
    const currentPlan = urlParams.get("current_plan");
    if (upgradeIntent === "true" && fromPage === "access-blocked") {
      console.log("🎯 M1SSION™ UPGRADE INTENT: User from access blocked page");
    }
    if (checkoutTier && tier) {
      handleStripeCheckout(tier);
    } else if (upgradeIntent === "true" && fromPage === "access-blocked") {
      if (currentPlan === "base") {
        setTimeout(() => {
          const silverElement = document.querySelector('[data-plan="Silver"]');
          if (silverElement) {
            silverElement.scrollIntoView({ behavior: "smooth", block: "center" });
            silverElement.classList.add("ring-2", "ring-purple-500", "ring-pulse");
          }
        }, 1e3);
      }
    }
  }, [subscription.plan, processSubscription]);
  const handleStripeCheckout = async (tier) => {
    try {
      if (!processSubscription) {
        ue$1.error("Sistema di pagamento non disponibile");
        return;
      }
      if (stripeLoading) {
        return;
      }
      await processSubscription(tier);
      ue$1.success(`✅ Checkout ${tier} attivato - reindirizzamento in corso...`);
    } catch (error) {
      console.error("❌ M1SSION™ Stripe checkout error:", error);
      ue$1.error("❌ Errore nel sistema di pagamento. Contatta l'assistenza.");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              UnifiedHeader,
              {
                profileImage,
                leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(LeftComponent, {})
              }
            )
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "main",
          {
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-screen-xl mx-auto", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionHeader, {}),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionPlans, { selected, setSelected }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionBenefits, {}),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionFAQ, {})
            ] })
          }
        )
      ]
    }
  );
};

const validateRegistration = (formData) => {
  const errors = {};
  if (!formData.name) {
    errors.name = "Il nome è obbligatorio";
  }
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!formData.email) {
    errors.email = "L'email è obbligatoria";
  } else if (!emailRegex.test(formData.email)) {
    errors.email = "Formato email non valido";
  }
  if (!formData.password) {
    errors.password = "La password è obbligatoria";
  } else if (formData.password.length < 8) {
    errors.password = "La password deve contenere almeno 8 caratteri";
  } else if (!/[A-Z]/.test(formData.password) || !/[a-z]/.test(formData.password) || !/[0-9]/.test(formData.password)) {
    errors.password = "La password deve contenere almeno una lettera maiuscola, una minuscola e un numero";
  }
  if (!formData.confirmPassword) {
    errors.confirmPassword = "Conferma la password";
  } else if (formData.password !== formData.confirmPassword) {
    errors.confirmPassword = "Le password non coincidono";
  }
  return {
    isValid: Object.keys(errors).length === 0,
    errors
  };
};

const useRegistration = () => {
  const [formData, setFormData] = reactExports.useState({
    name: "",
    email: "",
    password: "",
    confirmPassword: ""
  });
  const [errors, setErrors] = reactExports.useState({});
  const [isSubmitting, setIsSubmitting] = reactExports.useState(false);
  const { navigate } = useWouterNavigation();
  const handleChange = (e) => {
    const { id, value } = e.target;
    setFormData((prev) => ({
      ...prev,
      [id]: value
    }));
    if (errors[id]) {
      setErrors((prev) => ({ ...prev, [id]: "" }));
    }
  };
  const handleSubmit = async (e, turnstileToken, missionPreference) => {
    e.preventDefault();
    console.log("🚀 STARTING M1SSION REGISTRATION WITH ACCESS CONTROL");
    console.log("📧 Email:", formData.email);
    console.log("🔐 Password length:", formData.password.length);
    console.log("🎯 Mission preference:", missionPreference);
    const validation = validateRegistration(formData);
    if (!validation.isValid) {
      console.log("❌ Validation failed:", validation.errors);
      setErrors(validation.errors);
      return;
    }
    setIsSubmitting(true);
    const { name, email, password } = formData;
    try {
      console.log("🔄 Attempting M1SSION enhanced signup...");
      const standardResult = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: window.location.origin + "/choose-plan",
          data: {
            full_name: name,
            mission_preference: missionPreference || null,
            subscription_plan: null,
            access_enabled: false,
            status: "registered_pending"
          }
        }
      });
      console.log("📊 M1SSION signup result:", standardResult);
      if (!standardResult.error && standardResult.data.user) {
        console.log("✅ M1SSION registration successful!");
        const agentCode = `AG-${Date.now().toString(36).toUpperCase()}`;
        try {
          await supabase.functions.invoke("send-registration-notification", {
            body: {
              userId: standardResult.data.user.id,
              email: standardResult.data.user.email,
              agentCode,
              fullName: name
            }
          });
          console.log("📧 Notifiche post-registrazione inviate");
        } catch (notificationError) {
          console.error("⚠️ Errore invio notifiche:", notificationError);
        }
        ue$1.success("Registrazione completata!", {
          description: "Controlla la tua email per il codice agente. Ora scegli il tuo piano di abbonamento."
        });
        console.log("📧 Inviando notifiche post-registrazione...");
        setTimeout(() => {
          navigate("/choose-plan");
        }, 1500);
        return;
      }
      if (standardResult.error && standardResult.error.message.includes("captcha")) {
        console.log("🔄 Standard signup blocked by CAPTCHA, trying M1SSION bypass...");
        const { data: bypassResult, error: bypassError } = await supabase.functions.invoke("register-bypass", {
          body: {
            email,
            password,
            fullName: name,
            missionPreference: missionPreference || null,
            subscriptionPlan: null,
            accessEnabled: false,
            status: "registered_pending"
          }
        });
        if (bypassError) {
          console.error("❌ M1SSION bypass registration failed:", bypassError);
          ue$1.error("Errore nel bypass", {
            description: bypassError.message || "Errore durante la registrazione con bypass.",
            duration: 3e3
          });
          return;
        }
        if (bypassResult?.success) {
          console.log("✅ M1SSION bypass registration successful!");
          try {
            const agentCode = `AG-${Date.now().toString(36).toUpperCase()}`;
            await supabase.functions.invoke("send-registration-notification", {
              body: {
                userId: "bypass-user",
                // Per il bypass non abbiamo un ID reale
                email,
                agentCode,
                fullName: name
              }
            });
            console.log("📧 Notifiche post-registrazione bypass inviate");
          } catch (notificationError) {
            console.error("⚠️ Errore invio notifiche bypass:", notificationError);
          }
          ue$1.success("Registrazione completata!", {
            description: "Controlla la tua email per il codice agente. Ora scegli il tuo piano di abbonamento.",
            duration: 4e3
          });
          console.log("📧 Inviando notifiche post-registrazione bypass...");
          setTimeout(() => {
            navigate("/choose-plan");
          }, 1500);
          return;
        }
      }
      const errorMessage = standardResult.error?.message || "Errore sconosciuto durante la registrazione";
      console.error("❌ Both M1SSION registration methods failed:", errorMessage);
      ue$1.error("Errore", {
        description: errorMessage,
        duration: 3e3
      });
    } catch (error) {
      console.error("💥 M1SSION registration exception:", error);
      ue$1.error("Errore", {
        description: error.message || "Si è verificato un errore. Riprova più tardi.",
        duration: 3e3
      });
    } finally {
      setIsSubmitting(false);
    }
  };
  return {
    formData,
    errors,
    isSubmitting,
    handleChange,
    handleSubmit
  };
};

const RegistrationForm = ({ missionPreference }) => {
  const {
    formData,
    errors,
    isSubmitting,
    handleChange,
    handleSubmit: originalHandleSubmit
  } = useRegistration();
  const handleSubmit = (e) => {
    console.log("🔍 SUBMIT CLICKED - NO CAPTCHA REQUIRED");
    console.log("📝 Form data:", { email: formData.email, missionPreference });
    originalHandleSubmit(e, "BYPASS_COMPLETELY_DISABLED", missionPreference);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "name",
        type: "text",
        label: "Nome",
        placeholder: "Inserisci il tuo nome",
        value: formData.name,
        onChange: handleChange,
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "h-4 w-4" }),
        error: errors.name
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "email",
        type: "email",
        label: "Email",
        placeholder: "Inserisci la tua email",
        value: formData.email,
        onChange: handleChange,
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "h-4 w-4" }),
        error: errors.email
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "password",
        type: "password",
        label: "Password",
        placeholder: "Crea una password sicura",
        value: formData.password,
        onChange: handleChange,
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "h-4 w-4" }),
        error: errors.password
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      FormField,
      {
        id: "confirmPassword",
        type: "password",
        label: "Conferma Password",
        placeholder: "Ripeti la tua password",
        value: formData.confirmPassword,
        onChange: handleChange,
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "h-4 w-4" }),
        error: errors.confirmPassword
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        whileHover: { scale: 1.02 },
        whileTap: { scale: 0.98 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            type: "submit",
            disabled: isSubmitting,
            className: "w-full bg-gradient-to-r from-cyan-400 to-blue-600 hover:shadow-glow",
            children: isSubmitting ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "mr-2 h-4 w-4 animate-spin" }),
              "Registrazione in corso..."
            ] }) : "Registrati"
          }
        )
      }
    )
  ] });
};

const RegisterHeader = ({ className }) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `text-center mb-8 relative ${className}`, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "mission-heading", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { style: { color: "#00E5FF" }, className: "text-[#00E5FF]", children: "M1" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { style: { color: "#FFFFFF" }, className: "text-white", children: [
        "SSION",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 mb-2", children: "Crea il tuo account" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "line-glow" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mission-motto mt-2", children: "IT IS POSSIBLE" })
  ] });
};

function useQueryParams() {
  useLocation();
  const search = window.location.search;
  const params = new URLSearchParams(search);
  const result = {};
  params.forEach((value, key) => {
    result[key] = String(value).valueOf();
  });
  return result;
}

const Register = () => {
  const { preference } = useQueryParams();
  const [missionPreference, setMissionPreference] = reactExports.useState(null);
  const { navigate } = useWouterNavigation();
  console.log("📍 Register page loaded");
  console.log("🎯 Mission preference from URL:", preference);
  reactExports.useEffect(() => {
    if (preference === "uomo" || preference === "donna") {
      console.log("✅ Setting mission preference:", preference);
      setMissionPreference(preference);
    }
  }, [preference]);
  console.log("🎯 Current mission preference:", missionPreference);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen flex flex-col items-center justify-center bg-black px-4 py-12 relative overflow-hidden", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(BackgroundParticles, { count: 15 }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        className: "w-full max-w-md z-10",
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.5 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(RegisterHeader, {}),
          missionPreference && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              className: "mb-6 text-center",
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              transition: { delay: 0.2, duration: 0.5 },
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-white/70", children: [
                  "Hai scelto le missioni",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-bold text-[#00D1FF] mx-1", children: missionPreference === "uomo" ? "UOMO" : "DONNA" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "link",
                    className: "text-xs text-white/50 hover:text-white/70 p-0 mt-1",
                    onClick: () => navigate("/select-mission"),
                    children: "Cambia la tua preferenza"
                  }
                )
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card p-6 backdrop-blur-md border border-gray-800 rounded-xl", children: /* @__PURE__ */ jsxRuntimeExports.jsx(RegistrationForm, { missionPreference }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 text-center space-y-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/50", children: "Registrandoti accetti i nostri Termini e Condizioni e la nostra Informativa sulla Privacy." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-white/70", children: [
              "Hai già un account?",
              " ",
              /* @__PURE__ */ jsxRuntimeExports.jsx(Link, { to: "/login", className: "text-cyan-400 hover:text-cyan-300 transition-colors", children: "Accedi" })
            ] })
          ] })
        ]
      }
    )
  ] });
};

async function sendAdminBroadcast(payload) {
  const { data: { session } } = await supabase.auth.getSession();
  if (!session?.access_token) throw new Error("Not authenticated");
  const { data, error } = await supabase.functions.invoke("webpush-admin-broadcast", {
    body: payload
  });
  if (error) throw error;
  return data;
}

const SendNotificationPage = () => {
  const [title, setTitle] = reactExports.useState("");
  const [body, setBody] = reactExports.useState("");
  const [isSending, setIsSending] = reactExports.useState(false);
  useAuth();
  const { toast } = useToast();
  const handleSendNotification = async () => {
    if (!title.trim() || !body.trim()) {
      toast({
        title: "⚠️ Campi obbligatori",
        description: "Inserisci titolo e messaggio.",
        variant: "destructive"
      });
      return;
    }
    setIsSending(true);
    try {
      await supabase.from("admin_logs").insert({
        event_type: "webpush_admin_broadcast",
        note: `Admin Page Send - Title: ${title}, Body: ${body}`,
        context: "admin_page_notification"
      });
      const data = await sendAdminBroadcast({
        title: title.trim(),
        body: body.trim(),
        url: "/notifications",
        target: { all: true }
      });
      toast({
        title: "✅ Push notifica inviata",
        description: `Inviata a ${data?.success || 0}/${data?.total || 0} dispositivi`
      });
      setTitle("");
      setBody("");
    } catch (error) {
      console.error("Error sending push notification:", error);
      if (error.message.includes("Unauthorized") || error.message.includes("401")) {
        toast({
          title: "❌ Accesso negato",
          description: "Solo gli admin possono inviare notifiche.",
          variant: "destructive"
        });
      } else {
        toast({
          title: "❌ Errore invio",
          description: error.message || "Impossibile inviare la notifica.",
          variant: "destructive"
        });
      }
    } finally {
      setIsSending(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-black via-gray-900 to-black p-4 pt-20", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-2xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/80 border-[#00D1FF]/30 backdrop-blur-xl", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-2xl font-orbitron text-white flex items-center gap-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-6 h-6 text-[#00D1FF]" }),
      "🔥 Firebase Push Notifications - M1SSION™"
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "block text-white/70 text-sm font-medium mb-2", children: "Titolo notifica Firebase" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              value: title,
              onChange: (e) => setTitle(e.target.value),
              placeholder: "Inserisci il titolo Firebase...",
              className: "bg-white/5 border-white/20 text-white placeholder:text-white/50",
              maxLength: 50
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/50 text-xs mt-1", children: [
            title.length,
            "/50 caratteri"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "block text-white/70 text-sm font-medium mb-2", children: "Messaggio" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              value: body,
              onChange: (e) => setBody(e.target.value),
              placeholder: "Inserisci il messaggio della notifica Firebase...",
              className: "bg-white/5 border-white/20 text-white placeholder:text-white/50 min-h-[120px]",
              maxLength: 200
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/50 text-xs mt-1", children: [
            body.length,
            "/200 caratteri"
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-orange-500/10 border border-orange-500/30 rounded-lg p-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-orange-400 font-medium mb-2", children: "🔥 Anteprima notifica Firebase:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-black/50 rounded-lg p-3 border border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-6 h-6 bg-orange-500 rounded-sm flex-shrink-0 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-black text-xs font-bold", children: "🔥" }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-white font-medium text-sm", children: title || "Titolo notifica Firebase" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: body || "Messaggio della notifica Firebase" })
          ] })
        ] }) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: handleSendNotification,
          disabled: isSending || !title.trim() || !body.trim(),
          className: "w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-medium",
          children: isSending ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-white/20 border-t-white rounded-full animate-spin mr-2" }),
            "🔥 Invio Firebase in corso..."
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-2" }),
            "🔥 Invia notifica Firebase a tutti"
          ] })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/50 text-xs text-center", children: "🔥 La notifica verrà inviata tramite Firebase Cloud Messaging a tutti i dispositivi con token FCM attivi." })
    ] })
  ] }) }) });
};

const REWARD_TYPES$1 = [
  { value: "BUZZ_FREE", label: "Buzz Gratuiti", description: "Buzz che non costano nulla" },
  { value: "MESSAGE", label: "Messaggio", description: "Messaggio testuale personalizzato" },
  { value: "XP_POINTS", label: "Punti XP", description: "Punti esperienza per il giocatore" },
  { value: "EVENT_TICKET", label: "Ticket Evento", description: "Biglietto per evento speciale" },
  { value: "BADGE", label: "Badge", description: "Badge da assegnare al giocatore" }
];
const MissionPanelPage = () => {
  const [showBulkDrop, setShowBulkDrop] = reactExports.useState(false);
  const [, setLocation] = useLocation();
  const [distributions, setDistributions] = reactExports.useState([
    { type: "BUZZ_FREE", count: 0 }
  ]);
  const [showAdvanced, setShowAdvanced] = reactExports.useState(false);
  const [seed, setSeed] = reactExports.useState("");
  const [bbox, setBbox] = reactExports.useState({
    minLat: "",
    minLng: "",
    maxLat: "",
    maxLng: ""
  });
  const [isProcessing, setIsProcessing] = reactExports.useState(false);
  const [isAdmin, setIsAdmin] = reactExports.useState(false);
  const [httpStatus, setHttpStatus] = reactExports.useState(null);
  const [responseHeaders, setResponseHeaders] = reactExports.useState({});
  const [rawBody, setRawBody] = reactExports.useState("");
  const [parsedResponse, setParsedResponse] = reactExports.useState(null);
  const [requestId, setRequestId] = reactExports.useState(null);
  React$1.useEffect(() => {
    (async () => {
      const { data: { user } } = await supabase.auth.getUser();
      console.log("🔍 MissionPanel: Current user:", user?.id);
      if (user?.id) {
        const { data: profile, error } = await supabase.from("profiles").select("role").eq("id", user.id).maybeSingle();
        console.log("🔍 MissionPanel: User profile:", profile, "Error:", error);
        const adminStatus = !!profile && ["admin", "owner"].some((r) => profile.role?.toLowerCase?.().includes(r));
        console.log("🔍 MissionPanel: Admin status:", adminStatus);
        setIsAdmin(adminStatus);
      }
    })();
  }, []);
  const addDistribution = () => {
    setDistributions([...distributions, { type: "BUZZ_FREE", count: 0 }]);
  };
  const removeDistribution = (index) => {
    setDistributions(distributions.filter((_, i) => i !== index));
  };
  const updateDistribution = (index, field, value) => {
    const updated = [...distributions];
    if (field === "payload") {
      updated[index] = { ...updated[index], payload: value };
    } else {
      updated[index] = { ...updated[index], [field]: value };
    }
    setDistributions(updated);
  };
  const updatePayloadField = (index, key, value) => {
    const updated = [...distributions];
    updated[index] = {
      ...updated[index],
      payload: { ...updated[index].payload, [key]: value }
    };
    setDistributions(updated);
  };
  const validateDistributions = () => {
    const errors = [];
    const totalCount = distributions.reduce((sum, d) => sum + d.count, 0);
    if (totalCount <= 0) {
      errors.push("La somma totale dei marker deve essere > 0");
    }
    distributions.forEach((dist, index) => {
      if (dist.count < 0) {
        errors.push(`Count alla riga ${index + 1} deve essere ≥ 0`);
      }
      if (dist.type === "MESSAGE" && (!dist.payload?.text || dist.payload.text.trim() === "")) {
        errors.push(`Messaggio richiesto alla riga ${index + 1}`);
      }
      if (dist.type === "XP_POINTS" && (!dist.payload?.points || dist.payload.points <= 0)) {
        errors.push(`Punti XP richiesti (> 0) alla riga ${index + 1}`);
      }
      if (dist.type === "BADGE" && (!dist.payload?.badge_id || dist.payload.badge_id.trim() === "")) {
        errors.push(`Badge ID richiesto alla riga ${index + 1}`);
      }
      if (dist.type === "EVENT_TICKET" && dist.count > 1) {
        errors.push(`Warning: Event ticket count > 1 alla riga ${index + 1} (tipico = 1)`);
      }
    });
    return { valid: errors.length === 0, errors };
  };
  const createBulkMarkers = async () => {
    const validation = validateDistributions();
    if (!validation.valid) {
      validation.errors.forEach((error) => ue$1.error(error));
      return;
    }
    setIsProcessing(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        ue$1.error("Nessuna sessione di autenticazione");
        return;
      }
      const request = {
        distributions,
        seed: seed.trim() || void 0
      };
      if (bbox.minLat && bbox.minLng && bbox.maxLat && bbox.maxLng) {
        request.bbox = {
          minLat: parseFloat(bbox.minLat),
          minLng: parseFloat(bbox.minLng),
          maxLat: parseFloat(bbox.maxLat),
          maxLng: parseFloat(bbox.maxLng)
        };
      }
      console.log("🚀 Calling create-random-markers with payload:", request);
      const response = await fetch(`${functionsBaseUrl}/create-random-markers?debug=1`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${session.access_token}`,
          "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk"
        },
        body: JSON.stringify(request)
      });
      const rawText = await response.text();
      console.log(`📡 Edge Function response: ${response.status}`, rawText);
      setHttpStatus(response.status);
      setRawBody(rawText);
      const hdrs = {};
      ;
      ["content-type", "date", "x-edge-functions-region", "cf-ray", "server", "content-length"].forEach((k) => {
        const v = response.headers.get(k);
        if (v) hdrs[k] = v;
      });
      setResponseHeaders(hdrs);
      let data = null;
      try {
        data = JSON.parse(rawText);
      } catch (parseError) {
        console.error("Failed to parse response as JSON:", rawText);
        ue$1.error(`Risposta non valida: ${response.status} ${response.statusText}`);
        return;
      }
      setParsedResponse(data);
      if (data?.request_id) setRequestId(data.request_id);
      if (!response.ok) {
        console.error("Edge Function error:", {
          status: response.status,
          statusText: response.statusText,
          body: data
        });
        const errorMsg = data?.error || `HTTP ${response.status}`;
        const requestId2 = data?.request_id ? ` (${data.request_id})` : "";
        ue$1.error(`Errore Edge Function: ${errorMsg}${requestId2}`);
        return;
      }
      const totalCount = distributions.reduce((sum, d) => sum + d.count, 0);
      ue$1.success(`✅ ${data.created} marker creati con successo!`, {
        description: `Drop ID: ${data.drop_id}`,
        action: {
          label: "Vedi su Buzz Map",
          onClick: () => window.open("/map", "_blank")
        }
      });
      console.log("📊 Bulk drop completed:", {
        drop_id: data.drop_id,
        created: data.created,
        distributions
      });
      setDistributions([{ type: "BUZZ_FREE", count: 0 }]);
      setSeed("");
      setBbox({ minLat: "", minLng: "", maxLat: "", maxLng: "" });
      setShowBulkDrop(false);
    } catch (error) {
      console.error("Network error:", error);
      ue$1.error(`Errore di rete: ${error instanceof Error ? error.message : "Sconosciuto"}`);
    } finally {
      setIsProcessing(false);
    }
  };
  const getTotalCount = () => distributions.reduce((sum, d) => sum + d.count, 0);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto p-6 max-w-4xl", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink bg-clip-text text-transparent", children: "M1SSION PANEL" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground mt-2", children: "Strumenti amministrativi per la gestione dei marker sulla Buzz Map" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid gap-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground p-2 bg-gray-900 rounded", children: [
          "Debug: isAdmin = ",
          isAdmin.toString()
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-purple-500/20 hover:border-purple-500/40 transition-colors", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "h-5 w-5 text-purple-400" }),
                "Admin Push Console"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Invio notifiche push broadcast a tutti gli utenti - Solo Amministratori" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => setLocation("/panel/push-admin"),
                variant: "outline",
                className: "w-full",
                children: "Apri Admin Console"
              }
            ) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-blue-500/20 hover:border-blue-500/40 transition-colors", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "h-5 w-5 text-blue-400" }),
                "Push Console"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Invio notifiche push mirate a segmenti specifici o liste utenti" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: () => setLocation("/panel/push"),
                variant: "outline",
                className: "w-full",
                children: "Apri Push Console"
              }
            ) })
          ] })
        ] })
      ] }),
      isAdmin && /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-emerald-500/20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "pt-4 flex items-center justify-between gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-medium", children: "Markers Healthcheck" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-muted-foreground", children: "Diagnostica Edge Function e readback DB (solo lettura)" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: () => setLocation("/dev/markers-healthcheck"), variant: "outline", children: "Apri" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-emerald-500/20 hover:border-emerald-500/40 transition-colors", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Gift, { className: "h-5 w-5 text-emerald-400" }),
            "🎯 Marker Reward Manager"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Gestione completa marker reward: inserimento manuale con mappa, generazione bulk, M1U, Indizi, Premi Fisici" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: () => setLocation("/panel/marker-rewards"),
            className: "w-full bg-gradient-to-r from-emerald-500 to-cyan-500",
            children: "Apri Marker Manager"
          }
        ) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-cyan-500/20 hover:border-cyan-500/40 transition-colors opacity-70", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Map$1, { className: "h-5 w-5 text-cyan-400" }),
            "Bulk Marker Drop (Legacy)"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Genera marker casuali sulla Buzz Map (usa il nuovo Marker Manager per più opzioni)" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: () => setShowBulkDrop(!showBulkDrop),
              variant: "outline",
              className: "w-full",
              children: showBulkDrop ? "Chiudi" : "Configura Distribuzione"
            }
          ),
          showBulkDrop && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 space-y-6", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-lg font-semibold", children: "Distribuzione Reward" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: addDistribution, size: "sm", variant: "outline", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "h-4 w-4 mr-2" }),
                  "Aggiungi"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: distributions.map((dist, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "border-gray-700", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "pt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-4 items-start", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: `type-${index}`, children: "Reward Type" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Select,
                    {
                      value: dist.type,
                      onValueChange: (value) => updateDistribution(index, "type", value),
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, {}) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: REWARD_TYPES$1.map((type) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: type.value, children: type.label }, type.value)) })
                      ]
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: `count-${index}`, children: "Count" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: `count-${index}`,
                      type: "number",
                      min: "0",
                      value: dist.count,
                      onChange: (e) => updateDistribution(index, "count", parseInt(e.target.value) || 0)
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Payload" }),
                  dist.type === "MESSAGE" && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      placeholder: "Testo messaggio",
                      value: dist.payload?.text || "",
                      onChange: (e) => updatePayloadField(index, "text", e.target.value)
                    }
                  ),
                  dist.type === "XP_POINTS" && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      type: "number",
                      placeholder: "Punti XP",
                      min: "1",
                      value: dist.payload?.points || "",
                      onChange: (e) => updatePayloadField(index, "points", parseInt(e.target.value) || 0)
                    }
                  ),
                  dist.type === "EVENT_TICKET" && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      placeholder: "Event ID",
                      value: dist.payload?.event_id || "",
                      onChange: (e) => updatePayloadField(index, "event_id", e.target.value)
                    }
                  ),
                  dist.type === "BADGE" && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      placeholder: "Badge ID",
                      value: dist.payload?.badge_id || "",
                      onChange: (e) => updatePayloadField(index, "badge_id", e.target.value)
                    }
                  ),
                  dist.type === "BUZZ_FREE" && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      type: "number",
                      placeholder: "Quantità (default: 1)",
                      min: "1",
                      value: dist.payload?.amount || 1,
                      onChange: (e) => updatePayloadField(index, "amount", parseInt(e.target.value) || 1)
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-end", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    onClick: () => removeDistribution(index),
                    variant: "destructive",
                    size: "sm",
                    disabled: distributions.length <= 1,
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "h-4 w-4" })
                  }
                ) })
              ] }) }) }, index)) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 text-sm text-muted-foreground", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "secondary", children: [
                  "Totale: ",
                  getTotalCount(),
                  " marker"
                ] }),
                distributions.some((d) => d.type === "EVENT_TICKET" && d.count > 1) && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-amber-500", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "h-4 w-4" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Event ticket con count maggiore di 1 rilevato" })
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Switch,
                  {
                    id: "advanced",
                    checked: showAdvanced,
                    onCheckedChange: setShowAdvanced
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "advanced", children: "Opzioni Avanzate" })
              ] }),
              showAdvanced && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 space-y-4 p-4 border border-gray-700 rounded-lg", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "seed", children: "Seed (Generazione Deterministica)" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: "seed",
                      placeholder: "es. M1SSION-2025-01",
                      value: seed,
                      onChange: (e) => setSeed(e.target.value)
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Bounding Box (opzionale - default: mondo intero)" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-2 mt-2", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Input,
                      {
                        placeholder: "Min Lat",
                        type: "number",
                        step: "0.000001",
                        value: bbox.minLat,
                        onChange: (e) => setBbox({ ...bbox, minLat: e.target.value })
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Input,
                      {
                        placeholder: "Min Lng",
                        type: "number",
                        step: "0.000001",
                        value: bbox.minLng,
                        onChange: (e) => setBbox({ ...bbox, minLng: e.target.value })
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Input,
                      {
                        placeholder: "Max Lat",
                        type: "number",
                        step: "0.000001",
                        value: bbox.maxLat,
                        onChange: (e) => setBbox({ ...bbox, maxLat: e.target.value })
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Input,
                      {
                        placeholder: "Max Lng",
                        type: "number",
                        step: "0.000001",
                        value: bbox.maxLng,
                        onChange: (e) => setBbox({ ...bbox, maxLng: e.target.value })
                      }
                    )
                  ] })
                ] })
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "pt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: createBulkMarkers,
                disabled: isProcessing || getTotalCount() <= 0,
                className: "w-full bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink hover:opacity-90",
                children: isProcessing ? "Creazione in corso..." : "Lancia Marker"
              }
            ) })
          ] })
        ] })
      ] })
    ] })
  ] });
};

function OpenButton({ ritualId, onClaimed, mode = "prod" }) {
  const { user } = useAuth();
  const [isPressed, setIsPressed] = reactExports.useState(false);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const triggerHaptics = (style) => {
    try {
      if ("vibrate" in navigator) {
        const pattern = style === "heavy" ? [12] : [6];
        navigator.vibrate(pattern);
      }
      if (typeof window !== "undefined" && window.Capacitor?.Plugins?.Haptics) {
        window.Capacitor.Plugins.Haptics.impact({ style: style === "heavy" ? "Heavy" : "Light" });
      }
    } catch (err) {
      console.debug("[Haptics] Not available:", err);
    }
  };
  const handlePress = () => {
    setIsPressed(true);
    triggerHaptics("heavy");
  };
  const handleRelease = () => {
    setIsPressed(false);
    triggerHaptics("light");
  };
  const handleOpen = async () => {
    if (!ritualId || isLoading) return;
    setIsLoading(true);
    try {
      if (mode === "test") {
        console.log("[OpenButton Test] Simulating claim...");
        await new Promise((resolve) => setTimeout(resolve, 500));
        onClaimed({
          type: "test_essence",
          message: "🧪 Test Ritual Essence (Sandbox)",
          ritual_id: ritualId
        });
      } else {
        if (!user?.id) {
          console.error("[OpenButton] No user ID");
          return;
        }
        const { data, error } = await supabase.rpc("rpc_pulse_ritual_claim", {
          p_user: user.id
        });
        if (error) throw error;
        const response = data;
        if (response?.success) {
          onClaimed(response.reward_package);
        } else {
          console.error("[Ritual] Claim failed:", response?.error);
        }
      }
    } catch (err) {
      console.error("[Ritual] Claim error:", err);
    } finally {
      setIsLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center gap-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        className: "relative select-none outline-none group",
        onPointerDown: handlePress,
        onPointerUp: handleRelease,
        onPointerCancel: handleRelease,
        onClick: handleOpen,
        disabled: isLoading,
        "aria-label": "Open ritual reward",
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: `w-[200px] h-[200px] rounded-full 
                      bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,.18),rgba(0,0,0,.3)_60%)]
                      shadow-[inset_0_12px_24px_rgba(0,0,0,.45)]
                      ring-1 ring-white/10
                      transition-transform duration-150 ease-out will-change-transform
                      ${isPressed ? "scale-95" : "scale-100"}
                      ${isLoading ? "opacity-70 pointer-events-none" : ""}`,
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-[-16%] rounded-full pointer-events-none aura-spin" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "div",
                {
                  className: `absolute inset-0 rounded-full pointer-events-none
                        bg-[radial-gradient(circle_at_40%_30%,rgba(255,255,255,.15),transparent_50%)]
                        transition-opacity duration-150
                        ${isPressed ? "opacity-50" : "opacity-100"}`
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "span",
                {
                  className: "absolute inset-0 grid place-items-center \n                       text-white font-technovier tracking-wide text-xl\n                       drop-shadow-[0_0_12px_rgba(0,231,255,.85)]\n                       antialiased [text-rendering:optimizeLegibility]",
                  children: isLoading ? "OPENING..." : "OPEN"
                }
              )
            ]
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-sm font-technovier tracking-wide antialiased", children: "The world is listening." })
  ] });
}

function RitualOrchestrator({ phase, ritualId, mode = "prod" }) {
  const [rewardData, setRewardData] = reactExports.useState(null);
  const [showReward, setShowReward] = reactExports.useState(false);
  const prefersReducedMotion = typeof window !== "undefined" ? window.matchMedia("(prefers-reduced-motion: reduce)").matches : false;
  reactExports.useEffect(() => {
    const root = document.documentElement;
    switch (phase) {
      case "precharge":
        root.style.setProperty("--glow-mult", "1.5");
        root.style.setProperty("--flow-mult", "0.7");
        break;
      case "blackout":
      case "interference":
        root.style.setProperty("--glow-mult", "2.0");
        root.style.setProperty("--flow-mult", "0.5");
        break;
      case "reveal":
        root.style.setProperty("--glow-mult", "1.8");
        root.style.setProperty("--flow-mult", "0.6");
        break;
      default:
        root.style.setProperty("--glow-mult", "1");
        root.style.setProperty("--flow-mult", "1");
    }
  }, [phase]);
  const handleClaimed = (reward) => {
    console.log(`[Ritual ${mode}] Reward claimed:`, reward);
    if (mode === "test") {
      setRewardData({
        type: "test_essence",
        copy: "🧪 Test Ritual Essence Captured (Sandbox)",
        items: [
          { title: "Test Echo Fragment", type: "Narrative", rarity: "TEST" }
        ],
        ritual_id: ritualId,
        claimed_at: (/* @__PURE__ */ new Date()).toISOString()
      });
    } else {
      setRewardData(reward);
    }
    setShowReward(true);
  };
  if (phase === "idle" || phase === "closed") {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      transition: { duration: prefersReducedMotion ? 0.15 : 0.4 },
      className: "fixed inset-0 z-[9999] pointer-events-auto",
      style: { isolation: "isolate" },
      children: [
        phase === "precharge" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 bg-black/30 backdrop-blur-sm animate-pulse-ritual-precharge", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-16 h-16 rounded-full border-2 border-primary/50 animate-spin" }) }) }),
        phase === "blackout" && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            className: "absolute inset-0 bg-black flex items-center justify-center",
            children: !prefersReducedMotion && /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                animate: {
                  scale: [1, 1.2, 1],
                  opacity: [0.6, 1, 0.6]
                },
                transition: {
                  duration: 2,
                  repeat: Infinity,
                  ease: "easeInOut"
                },
                className: "w-[300px] h-[300px] rounded-full \n                           bg-[radial-gradient(circle,rgba(255,77,240,0.3),rgba(0,231,255,0.3),transparent_70%)]\n                           blur-xl"
              }
            )
          }
        ),
        phase === "interference" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute inset-0 bg-black ritual-interference", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 ritual-scanlines opacity-30" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 ritual-chromatic" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 ritual-noise animate-pulse" })
        ] }),
        phase === "reveal" && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { opacity: 0, scale: 0.9 },
            animate: { opacity: 1, scale: 1 },
            transition: { duration: prefersReducedMotion ? 0.15 : 0.5, ease: "easeOut" },
            className: "absolute inset-0 bg-gradient-to-b from-black/95 via-black/90 to-black/95 \n                       flex items-center justify-center backdrop-blur-md",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(OpenButton, { ritualId, onClaimed: handleClaimed, mode })
          }
        ),
        showReward && rewardData && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { y: "100%" },
            animate: { y: 0 },
            exit: { y: "100%" },
            transition: { type: "spring", damping: 25, stiffness: 300 },
            className: "absolute bottom-0 left-0 right-0 max-h-[80vh] overflow-y-auto\n                       bg-gradient-to-b from-background/95 to-background\n                       border-t border-border/50 backdrop-blur-lg\n                       rounded-t-3xl p-6 shadow-2xl",
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-md mx-auto space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-technovier text-primary tracking-wide", children: "Echo Revealed" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground font-technovier", children: rewardData.copy || "The world listened. The echo answered." })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: rewardData.items?.map((item, idx) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                "div",
                {
                  className: "p-4 rounded-xl bg-card/50 border border-border/30\n                               backdrop-blur-sm space-y-1",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-technovier text-foreground", children: item.title }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs px-2 py-1 rounded-full bg-primary/20 text-primary font-technovier", children: item.rarity })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: item.type })
                  ]
                },
                idx
              )) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: () => setShowReward(false),
                  className: "w-full py-3 rounded-xl bg-primary/10 hover:bg-primary/20\n                           border border-primary/30 text-primary font-technovier\n                           tracking-wide transition-colors",
                  children: "CONTINUE"
                }
              )
            ] })
          }
        )
      ]
    }
  ) });
}

function useRitualChannel({ mode = "prod" } = {}) {
  const [phase, setPhase] = reactExports.useState("idle");
  const [ritualId, setRitualId] = reactExports.useState(null);
  const [isConnected, setIsConnected] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const channelName = mode === "test" ? "pulse:ritual:test" : "pulse:ritual";
    console.log(`[Ritual] Subscribing to channel: ${channelName}`);
    const channel = supabase.channel(channelName).on("broadcast", { event: "ritual-phase" }, (payload) => {
      const data = payload.payload;
      console.log(`[Ritual ${mode}] Phase broadcast:`, data);
      setPhase(data.phase);
      setRitualId(data.ritual_id);
    }).subscribe((status) => {
      setIsConnected(status === "SUBSCRIBED");
      console.log(`[Ritual ${mode}] Channel status:`, status);
    });
    return () => {
      supabase.removeChannel(channel);
      setIsConnected(false);
    };
  }, [mode]);
  return { phase, ritualId, isConnected, mode };
}

async function invokeEdge(functionName, options = {}) {
  const {
    body = {},
    timeout = 1e4,
    retries = 1
  } = options;
  const { data: { session } } = await supabase.auth.getSession();
  if (!session?.access_token) {
    return {
      error: {
        message: "No active session - please log in",
        code: "NO_SESSION",
        hint: "Session expired or not authenticated"
      }
    };
  }
  let lastError = null;
  for (let attempt = 0; attempt <= retries; attempt++) {
    try {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), timeout);
      const { data, error } = await supabase.functions.invoke(functionName, {
        body,
        headers: {
          "Authorization": `Bearer ${session.access_token}`
        }
      });
      clearTimeout(timeoutId);
      if (error) {
        lastError = error;
        const errorData = typeof error === "object" ? error : { message: String(error) };
        const status = errorData?.status || 0;
        if (status === 401 || status === 403) {
          return {
            error: {
              message: errorData?.hint || (status === 401 ? "Unauthorized - session expired" : "Forbidden - not in admin whitelist"),
              code: errorData?.code || (status === 401 ? "UNAUTHORIZED" : "FORBIDDEN"),
              hint: errorData?.hint || "Check authentication and admin whitelist"
            }
          };
        }
        if (attempt < retries && (status === 0 || status >= 500)) {
          const backoff = 400 * (attempt + 1);
          await new Promise((resolve) => setTimeout(resolve, backoff));
          continue;
        }
        return {
          error: {
            message: errorData?.hint || errorData?.message || "Edge function error",
            code: errorData?.code || "EDGE_ERROR",
            hint: errorData?.hint
          }
        };
      }
      if (data && typeof data === "object" && data.ok === false) {
        return {
          error: {
            message: data.hint || "Edge function returned error",
            code: data.code || "EDGE_ERROR",
            hint: data.hint
          }
        };
      }
      return { data };
    } catch (error) {
      lastError = error;
      if (error.name === "AbortError") {
        if (attempt < retries) {
          const backoff = 400 * (attempt + 1);
          await new Promise((resolve) => setTimeout(resolve, backoff));
          continue;
        }
        return {
          error: {
            message: `Request timeout after ${timeout}ms`,
            code: "TIMEOUT",
            hint: "Edge function might be cold-starting or overloaded"
          }
        };
      }
      if (attempt < retries) {
        const backoff = 400 * (attempt + 1);
        await new Promise((resolve) => setTimeout(resolve, backoff));
        continue;
      }
    }
  }
  return {
    error: {
      message: lastError?.message || "Unknown error",
      code: lastError?.code || "RETRY_EXHAUSTED",
      hint: `Failed after ${retries + 1} attempts`
    }
  };
}

class EmpAudioEngine {
  graph = null;
  isUnlocked = false;
  currentPhase = "closed";
  phaseStartTime = 0;
  reducedMotion = false;
  constructor() {
    this.reducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  }
  /**
   * Initialize audio context and unlock on iOS
   */
  async initialize() {
    if (this.graph) return true;
    try {
      const AudioContextClass = window.AudioContext || window.webkitAudioContext;
      if (!AudioContextClass) {
        console.warn("[EMP Audio] Web Audio API not supported");
        return false;
      }
      const ctx = new AudioContextClass();
      if (ctx.state === "suspended") {
        console.log("[EMP Audio] AudioContext suspended, waiting for user gesture...");
        await ctx.resume();
        if (ctx.state === "suspended") {
          return new Promise((resolve) => {
            const unlock = async () => {
              await ctx.resume();
              if (ctx.state === "running") {
                document.removeEventListener("touchstart", unlock);
                document.removeEventListener("click", unlock);
                this.isUnlocked = true;
                await this.buildGraph(ctx);
                resolve(true);
              }
            };
            document.addEventListener("touchstart", unlock, { once: true });
            document.addEventListener("click", unlock, { once: true });
          });
        }
      }
      await this.buildGraph(ctx);
      this.isUnlocked = true;
      return true;
    } catch (err) {
      console.error("[EMP Audio] Initialization error:", err);
      return false;
    }
  }
  /**
   * Build the audio node graph
   */
  async buildGraph(ctx) {
    const masterGain = ctx.createGain();
    const compressor = ctx.createDynamicsCompressor();
    masterGain.gain.value = this.reducedMotion ? 0.3 : 0.6;
    compressor.threshold.value = -24;
    compressor.knee.value = 30;
    compressor.ratio.value = 12;
    compressor.attack.value = 3e-3;
    compressor.release.value = 0.25;
    masterGain.connect(compressor);
    compressor.connect(ctx.destination);
    const osc1 = ctx.createOscillator();
    const osc1Gain = ctx.createGain();
    const osc1Filter = ctx.createBiquadFilter();
    osc1.type = "sine";
    osc1.frequency.value = 37;
    osc1Gain.gain.value = 0;
    osc1Filter.type = "lowpass";
    osc1Filter.frequency.value = 120;
    osc1Filter.Q.value = 1.5;
    osc1.connect(osc1Gain);
    osc1Gain.connect(osc1Filter);
    osc1Filter.connect(masterGain);
    osc1.start();
    const noiseBuffer = this.createNoiseBuffer(ctx, 2);
    const noiseGain = ctx.createGain();
    const noiseBP = ctx.createBiquadFilter();
    noiseGain.gain.value = 0;
    noiseBP.type = "bandpass";
    noiseBP.frequency.value = 4e3;
    noiseBP.Q.value = 2;
    noiseGain.connect(noiseBP);
    noiseBP.connect(masterGain);
    this.graph = {
      context: ctx,
      masterGain,
      osc1,
      osc1Gain,
      osc1Filter,
      noiseBuffer,
      noiseSource: null,
      noiseGain,
      noiseBP,
      compressor
    };
    console.log("[EMP Audio] Audio graph built");
  }
  /**
   * Create white noise buffer
   */
  createNoiseBuffer(ctx, duration) {
    const sampleRate = ctx.sampleRate;
    const buffer = ctx.createBuffer(1, sampleRate * duration, sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < data.length; i++) {
      data[i] = Math.random() * 2 - 1;
    }
    return buffer;
  }
  /**
   * Apply audio for specific phase
   */
  applyPhase(phase, syncTime) {
    if (!this.graph || !this.isUnlocked) {
      console.warn("[EMP Audio] Not initialized or unlocked");
      return;
    }
    this.currentPhase = phase;
    this.phaseStartTime = syncTime || performance.now();
    const { context: ctx, osc1Gain, osc1Filter, noiseGain, noiseBP, noiseBuffer } = this.graph;
    const now = ctx.currentTime;
    console.log(`[EMP Audio] Applying phase: ${phase}`);
    switch (phase) {
      case "precharge":
        osc1Gain.gain.cancelScheduledValues(now);
        osc1Gain.gain.setValueAtTime(0.0158, now);
        osc1Gain.gain.exponentialRampToValueAtTime(0.251, now + 1.2);
        osc1Filter.Q.cancelScheduledValues(now);
        osc1Filter.Q.setValueAtTime(1.5, now);
        osc1Filter.Q.linearRampToValueAtTime(3, now + 1.2);
        break;
      case "blackout":
        osc1Gain.gain.cancelScheduledValues(now);
        osc1Gain.gain.setValueAtTime(0, now);
        noiseGain.gain.cancelScheduledValues(now);
        noiseGain.gain.setValueAtTime(0, now);
        if (this.graph.noiseSource) {
          this.graph.noiseSource.stop();
          this.graph.noiseSource = null;
        }
        break;
      case "interference":
        const noiseSource = ctx.createBufferSource();
        noiseSource.buffer = noiseBuffer;
        noiseSource.loop = true;
        noiseSource.connect(noiseGain);
        noiseSource.start();
        this.graph.noiseSource = noiseSource;
        noiseGain.gain.cancelScheduledValues(now);
        noiseGain.gain.setValueAtTime(0, now);
        noiseGain.gain.linearRampToValueAtTime(0.4, now + 0.3);
        for (let i = 0; i < 8; i++) {
          const dropTime = now + 0.3 + Math.random() * 2.5;
          const dropDuration = 0.01 + Math.random() * 0.03;
          noiseGain.gain.setValueAtTime(0.4, dropTime);
          noiseGain.gain.linearRampToValueAtTime(0, dropTime + 1e-3);
          noiseGain.gain.setValueAtTime(0, dropTime + dropDuration);
          noiseGain.gain.linearRampToValueAtTime(0.4, dropTime + dropDuration + 1e-3);
        }
        noiseBP.frequency.cancelScheduledValues(now);
        noiseBP.frequency.setValueAtTime(2e3, now);
        noiseBP.frequency.linearRampToValueAtTime(6e3, now + 1.5);
        noiseBP.frequency.linearRampToValueAtTime(3e3, now + 3);
        break;
      case "reveal":
        if (this.graph.noiseSource) {
          this.graph.noiseSource.stop();
          this.graph.noiseSource = null;
        }
        noiseGain.gain.cancelScheduledValues(now);
        noiseGain.gain.setValueAtTime(0, now);
        osc1Filter.frequency.cancelScheduledValues(now);
        osc1Filter.frequency.setValueAtTime(300, now);
        osc1Filter.frequency.exponentialRampToValueAtTime(6e3, now + 0.8);
        osc1Gain.gain.cancelScheduledValues(now);
        osc1Gain.gain.setValueAtTime(0.251, now);
        osc1Gain.gain.exponentialRampToValueAtTime(0.063, now + 0.8);
        break;
      case "closed":
        osc1Gain.gain.cancelScheduledValues(now);
        osc1Gain.gain.setValueAtTime(osc1Gain.gain.value, now);
        osc1Gain.gain.linearRampToValueAtTime(0, now + 0.25);
        noiseGain.gain.cancelScheduledValues(now);
        noiseGain.gain.setValueAtTime(noiseGain.gain.value, now);
        noiseGain.gain.linearRampToValueAtTime(0, now + 0.25);
        setTimeout(() => {
          if (this.graph?.noiseSource) {
            this.graph.noiseSource.stop();
            this.graph.noiseSource = null;
          }
        }, 300);
        break;
    }
  }
  /**
   * Stop and cleanup
   */
  stop() {
    if (!this.graph) return;
    const { context: ctx, osc1, noiseSource } = this.graph;
    try {
      osc1.stop();
      if (noiseSource) noiseSource.stop();
      ctx.close();
    } catch (err) {
      console.warn("[EMP Audio] Cleanup error:", err);
    }
    this.graph = null;
    this.isUnlocked = false;
    this.currentPhase = "closed";
    console.log("[EMP Audio] Stopped and cleaned up");
  }
  /**
   * Check if audio is ready
   */
  isReady() {
    return this.graph !== null && this.isUnlocked;
  }
}

class EmpVisualEngine {
  container = null;
  flashOverlay = null;
  rafId = null;
  activeBursts = [];
  lastBurstTime = 0;
  currentPhase = "closed";
  reducedMotion = false;
  lambda = 0;
  // Poisson process rate parameter
  constructor() {
    this.reducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  }
  /**
   * Start visual effects
   */
  start() {
    if (this.container) return;
    this.container = document.createElement("div");
    this.container.className = "ritual-crt-overlay";
    const scanlines = document.createElement("div");
    scanlines.className = "ritual-scanlines";
    this.container.appendChild(scanlines);
    const vignette = document.createElement("div");
    vignette.className = "ritual-vignette";
    this.container.appendChild(vignette);
    if (!this.reducedMotion) {
      const shearContainer = document.createElement("div");
      shearContainer.className = "ritual-shear-bars";
      for (let i = 0; i < 5; i++) {
        const bar = document.createElement("div");
        bar.className = "ritual-shear-bar";
        bar.style.top = `${Math.random() * 100}%`;
        bar.style.animationDelay = `${Math.random() * 0.3}s`;
        shearContainer.appendChild(bar);
      }
      this.container.appendChild(shearContainer);
    }
    this.flashOverlay = document.createElement("div");
    this.flashOverlay.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 50% 50%, rgba(0, 255, 255, 0.6), rgba(255, 255, 255, 0.1) 70%);
      mix-blend-mode: screen;
      pointer-events: none;
      opacity: 0;
    `;
    this.container.appendChild(this.flashOverlay);
    document.body.appendChild(this.container);
    document.body.classList.add("ritual-distortion-active");
    this.startAnimationLoop();
    console.log("[EMP Visual] Visual effects started");
  }
  /**
   * Apply phase-specific visuals
   */
  applyPhase(phase) {
    this.currentPhase = phase;
    switch (phase) {
      case "precharge":
        this.lambda = this.reducedMotion ? 0.5 : 1.2;
        break;
      case "interference":
        this.lambda = this.reducedMotion ? 0.8 : 2.5;
        document.body.classList.add("ritual-distortion-interference");
        break;
      case "blackout":
      case "reveal":
      case "closed":
        this.lambda = 0;
        document.body.classList.remove("ritual-distortion-interference");
        break;
    }
    console.log(`[EMP Visual] Phase: ${phase}, λ=${this.lambda}`);
  }
  /**
   * Start RAF animation loop for flash bursts
   */
  startAnimationLoop() {
    if (this.rafId !== null) return;
    const animate = (timestamp) => {
      this.updateFlashBursts(timestamp);
      this.rafId = requestAnimationFrame(animate);
    };
    this.rafId = requestAnimationFrame(animate);
  }
  /**
   * Update flash bursts using Poisson process
   */
  updateFlashBursts(timestamp) {
    if (!this.flashOverlay) return;
    if (this.lambda > 0) {
      timestamp - this.lastBurstTime;
      const dt = 16.67;
      const probability = this.lambda * (dt / 1e3);
      if (Math.random() < probability) {
        this.createBurst(timestamp);
        this.lastBurstTime = timestamp;
      }
    }
    let totalIntensity = 0;
    this.activeBursts = this.activeBursts.filter((burst) => {
      const elapsed = timestamp - burst.startTime;
      if (elapsed >= burst.duration) return false;
      const t = elapsed / burst.duration;
      const currentIntensity = burst.intensity * burst.curve(t);
      totalIntensity += currentIntensity;
      return true;
    });
    this.flashOverlay.style.opacity = Math.min(totalIntensity, 1).toString();
  }
  /**
   * Create a new flash burst
   */
  createBurst(timestamp) {
    const duration = 60 + Math.random() * 80;
    const baseIntensity = 0.2 + Math.random() * 0.65;
    const intensity = this.reducedMotion ? baseIntensity * 0.5 : baseIntensity;
    const curve = (t) => {
      return Math.pow(1 - t, 2.5);
    };
    this.activeBursts.push({
      startTime: timestamp,
      duration,
      intensity,
      curve
    });
  }
  /**
   * Stop and cleanup
   */
  stop() {
    if (this.rafId !== null) {
      cancelAnimationFrame(this.rafId);
      this.rafId = null;
    }
    if (this.container) {
      this.container.remove();
      this.container = null;
    }
    this.flashOverlay = null;
    this.activeBursts = [];
    this.currentPhase = "closed";
    this.lambda = 0;
    document.body.classList.remove("ritual-distortion-active", "ritual-distortion-interference");
    console.log("[EMP Visual] Visual effects stopped");
  }
  /**
   * Check if running
   */
  isRunning() {
    return this.container !== null;
  }
}

class EmpEffectController {
  audioEngine;
  visualEngine;
  isRunning = false;
  lastPhaseTime = 0;
  debounceMs = 250;
  reducedMotion = false;
  options = {
    enableAudio: true,
    enableVisual: true,
    enableHaptic: true
  };
  constructor(options) {
    this.audioEngine = new EmpAudioEngine();
    this.visualEngine = new EmpVisualEngine();
    this.reducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (options) {
      this.options = { ...this.options, ...options };
    }
    if (this.reducedMotion) {
      this.options.enableHaptic = false;
    }
  }
  /**
   * Initialize and start the controller
   */
  async start() {
    if (this.isRunning) {
      console.log("[EMP Controller] Already running");
      return;
    }
    console.log("[EMP Controller] Starting...");
    if (this.options.enableAudio) {
      const audioReady = await this.audioEngine.initialize();
      if (!audioReady) {
        console.warn("[EMP Controller] Audio not ready - will show unlock prompt on iOS");
        this.showAudioUnlockHint();
      }
    }
    if (this.options.enableVisual) {
      this.visualEngine.start();
    }
    this.isRunning = true;
    console.log("[EMP Controller] Started");
  }
  /**
   * Apply a specific ritual phase
   */
  applyPhase(phase, syncTime) {
    if (!this.isRunning) {
      console.warn("[EMP Controller] Not running - call start() first");
      return;
    }
    const now = performance.now();
    if (now - this.lastPhaseTime < this.debounceMs) {
      console.log(`[EMP Controller] Debounced duplicate phase: ${phase}`);
      return;
    }
    this.lastPhaseTime = now;
    console.log(`[EMP Controller] Applying phase: ${phase}`);
    const t0 = syncTime || now + 60;
    if (this.options.enableVisual) {
      this.visualEngine.applyPhase(phase);
    }
    if (this.options.enableAudio && this.audioEngine.isReady()) {
      this.audioEngine.applyPhase(phase, t0);
    }
    if (this.options.enableHaptic && phase === "interference") {
      this.triggerHaptic();
    }
    if (phase === "closed") {
      setTimeout(() => this.stop(), 500);
    }
  }
  /**
   * Trigger haptic vibration (random pattern during interference)
   */
  triggerHaptic() {
    if (!("vibrate" in navigator)) return;
    const pattern = [
      10 + Math.random() * 20,
      // vibrate
      30 + Math.random() * 40,
      // pause
      8 + Math.random() * 15,
      // vibrate
      20 + Math.random() * 30,
      // pause
      12 + Math.random() * 18
      // vibrate
    ];
    try {
      navigator.vibrate(pattern);
      console.log("[EMP Controller] Haptic triggered");
    } catch (err) {
      console.warn("[EMP Controller] Haptic error:", err);
    }
    if (this.isRunning) {
      const nextDelay = 300 + Math.random() * 200;
      setTimeout(() => {
        if (this.isRunning) {
          this.triggerHaptic();
        }
      }, nextDelay);
    }
  }
  /**
   * Stop and cleanup all effects
   */
  stop() {
    if (!this.isRunning) return;
    console.log("[EMP Controller] Stopping...");
    this.audioEngine.stop();
    this.visualEngine.stop();
    if ("vibrate" in navigator) {
      navigator.vibrate(0);
    }
    this.isRunning = false;
    this.lastPhaseTime = 0;
    console.log("[EMP Controller] Stopped");
  }
  /**
   * Check if controller is running
   */
  isActive() {
    return this.isRunning;
  }
  /**
   * Show audio unlock hint for iOS (if needed)
   */
  showAudioUnlockHint() {
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    if (!isIOS) return;
    const hint = document.createElement("div");
    hint.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 20px 30px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      z-index: 999999;
      pointer-events: auto;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    `;
    hint.textContent = "🔊 Tap to enable audio";
    const unlock = async () => {
      await this.audioEngine.initialize();
      hint.remove();
    };
    hint.addEventListener("click", unlock);
    hint.addEventListener("touchstart", unlock);
    document.body.appendChild(hint);
    setTimeout(() => hint.remove(), 5e3);
  }
}

const ADMIN_EMAILS = [
  "joseph@m1ssion.io",
  "wikus77@hotmail.it"
];
function PulseLab() {
  const { toast } = useToast();
  const [authStatus, setAuthStatus] = reactExports.useState("loading");
  const [userEmail, setUserEmail] = reactExports.useState("");
  const [mockValue, setMockValue] = reactExports.useState(45);
  const [logs, setLogs] = reactExports.useState([]);
  const [isFiring, setIsFiring] = reactExports.useState(false);
  const { phase, ritualId, isConnected } = useRitualChannel({ mode: "test" });
  const empControllerRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    const checkAuth = async () => {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          setAuthStatus("denied");
          return;
        }
        const isAdmin = ADMIN_EMAILS.includes(user.email || "");
        if (!isAdmin) {
          setAuthStatus("denied");
          setUserEmail(user.email || "unknown");
          return;
        }
        setAuthStatus("authorized");
        setUserEmail(user.email || "");
        addLog(`✅ Authorized: ${user.email}`);
      } catch (error) {
        console.error("[PulseLab] Auth check error:", error);
        setAuthStatus("denied");
      }
    };
    checkAuth();
  }, []);
  reactExports.useEffect(() => {
    const initController = async () => {
      if (!empControllerRef.current) {
        empControllerRef.current = new EmpEffectController({
          enableAudio: true,
          enableVisual: true,
          enableHaptic: true
        });
      }
    };
    initController();
    return () => {
      if (empControllerRef.current?.isActive()) {
        empControllerRef.current.stop();
      }
    };
  }, []);
  reactExports.useEffect(() => {
    if (phase === "idle") return;
    addLog(`🌟 Phase: ${phase} (ritual_id: ${ritualId})`);
    const controller = empControllerRef.current;
    if (!controller) return;
    if (!controller.isActive()) {
      addLog("⚡ EMP CONTROLLER: Starting full cinematic effect...");
      controller.start().then(() => {
        controller.applyPhase(phase);
      });
    } else {
      controller.applyPhase(phase);
    }
    switch (phase) {
      case "precharge":
        addLog("⚡ PRECHARGE: Sub-bass ramp + flash bursts starting");
        break;
      case "blackout":
        addLog("⚫ BLACKOUT: Hard audio mute + visual freeze");
        break;
      case "interference":
        addLog("⚡⚡ INTERFERENCE: Noise + glitch + haptic bursts");
        break;
      case "reveal":
        addLog("✨ REVEAL: Whoosh + filter sweep");
        break;
      case "closed":
        addLog("🔒 CLOSED: Fade-out + cleanup");
        break;
    }
  }, [phase, ritualId]);
  const addLog = (message) => {
    const timestamp = (/* @__PURE__ */ new Date()).toLocaleTimeString();
    setLogs((prev) => [`[${timestamp}] ${message}`, ...prev.slice(0, 19)]);
  };
  const handleSimulate100 = () => {
    setMockValue(100);
    addLog("🎯 Pulse simulated at 100%");
  };
  const handlePingEdge = async () => {
    addLog("🏓 Pinging edge function...");
    const { data, error } = await invokeEdge("ritual-test-fire", {
      body: { action: "ping" },
      retries: 2
    });
    if (error) {
      addLog(`❌ Ping failed [${error.code}]: ${error.message}`);
      if (error.code === "FORBIDDEN" || error.code === "ADMIN_REQUIRED") {
        toast({
          title: "Access Denied",
          description: "Not in admin whitelist. Check ADMIN_WHITELIST secret.",
          variant: "destructive"
        });
      } else if (error.code === "UNAUTHORIZED" || error.code === "AUTH_MISSING" || error.code === "NO_SESSION") {
        toast({
          title: "Session Expired",
          description: "Please log out and log in again",
          variant: "destructive"
        });
      } else {
        toast({
          title: "Edge Function Error",
          description: error.hint || error.message,
          variant: "destructive"
        });
      }
      return;
    }
    addLog(`✅ Ping successful: ${data.whoami || userEmail}`);
    toast({
      title: "Edge Function Online",
      description: `Connected as ${data.whoami || userEmail}`
    });
  };
  const handleFireRitual = async () => {
    setIsFiring(true);
    addLog("🚀 Firing test ritual...");
    addLog(`🔑 Authenticated as: ${userEmail}`);
    const { data, error } = await invokeEdge("ritual-test-fire", {
      body: {
        mode: "test",
        timestamp: Date.now()
      },
      retries: 2
    });
    if (error) {
      addLog(`❌ Ritual fire failed [${error.code}]: ${error.message}`);
      if (error.code === "FORBIDDEN" || error.code === "ADMIN_REQUIRED") {
        toast({
          title: "Access Denied",
          description: "Not in admin whitelist. Email must match ADMIN_WHITELIST secret.",
          variant: "destructive"
        });
      } else if (error.code === "UNAUTHORIZED" || error.code === "AUTH_MISSING" || error.code === "NO_SESSION") {
        toast({
          title: "Session Expired",
          description: "Please log out and log in again to refresh your session",
          variant: "destructive"
        });
      } else {
        toast({
          title: "Ritual Failed",
          description: error.hint || error.message,
          variant: "destructive"
        });
      }
      setIsFiring(false);
      return;
    }
    addLog(`✅ Test ritual sequence started`);
    addLog(`📊 Ritual ID: ${data.test_ritual_id || "N/A"}`);
    addLog(`📡 Channel: ${data.channel || "pulse:ritual:test"}`);
    addLog(`🌟 Phases queued: ${data.phases?.join(" → ") || "precharge → blackout → interference → reveal → closed"}`);
    toast({
      title: "Ritual Fired!",
      description: "Watch for phase broadcasts in the event log below"
    });
    setIsFiring(false);
  };
  const handleReset = () => {
    setMockValue(45);
    setLogs([]);
    addLog("🔄 Lab reset");
  };
  if (authStatus === "loading") {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-background", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-pulse text-muted-foreground", children: "Authorizing..." }) });
  }
  if (authStatus === "denied") {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-background p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "max-w-md", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2 text-destructive", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5" }),
          "Access Denied"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Admin Pulse Lab — Restricted Area" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "You do not have permission to access this page." }),
        userEmail && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground font-mono", children: [
          "Current user: ",
          userEmail
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "This area is restricted to authorized M1SSION™ administrators only." })
      ] })
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-background p-4 pb-safe", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: -20 },
        animate: { opacity: 1, y: 0 },
        className: "max-w-4xl mx-auto mb-6",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 mb-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-6 h-6 text-primary" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-technovier font-bold text-foreground", children: "Admin Pulse Lab" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Isolated sandbox for testing The Pulse™ ritual orchestration" })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto grid gap-4 md:grid-cols-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-5 h-5 text-primary" }),
            "Mock Pulse State"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Simulated pulse value (sandbox only)" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative w-full h-[14px] rounded-full overflow-hidden bg-card border border-border", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "absolute inset-0 bg-gradient-to-r from-primary via-primary-glow to-primary",
              style: { width: `${mockValue}%` },
              animate: {
                opacity: [0.7, 1, 0.7]
              },
              transition: {
                duration: 2,
                repeat: Infinity,
                ease: "easeInOut"
              }
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-3xl font-technovier font-bold text-foreground", children: [
            mockValue,
            "%"
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: handleSimulate100,
                className: "flex-1",
                variant: "default",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-4 h-4 mr-2" }),
                  "Simula 100%"
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleReset,
                variant: "outline",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "w-4 h-4" })
              }
            )
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CirclePlay, { className: "w-5 h-5 text-primary" }),
            "Ritual Controls"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardDescription, { children: [
            "Test channel: pulse:ritual:test • Status: ",
            isConnected ? "🟢 Connected" : "🔴 Disconnected"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 rounded-lg bg-card border border-border", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground mb-1", children: "Current Phase" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg font-technovier font-bold text-foreground", children: phase.toUpperCase() })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: handlePingEdge,
                variant: "outline",
                className: "w-full",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-4 h-4 mr-2" }),
                  "Ping Edge"
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: handleFireRitual,
                disabled: isFiring,
                className: "w-full",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-4 h-4 mr-2" }),
                  isFiring ? "Firing..." : "Avvia Ritual"
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Triggers complete ritual sequence on test channel. Safe, no DB writes to production." })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "md:col-span-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Event Log" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Real-time ritual events from test channel" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-card border border-border rounded-lg p-4 h-[300px] overflow-y-auto font-mono text-xs", children: logs.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-muted-foreground", children: "No events yet..." }) : logs.map((log, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-foreground mb-1", children: log }, i)) }) })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      RitualOrchestrator,
      {
        phase,
        ritualId,
        mode: "test"
      }
    )
  ] });
}

const PushNotificationToggle = () => {
  const {
    isSupported,
    permission,
    isSubscribed,
    loading,
    requestPermission,
    subscribe} = useUnifiedPush();
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1;
  const isPWA = window.matchMedia("(display-mode: standalone)").matches;
  const isIOSPWA = isIOS && isPWA;
  const handleToggle = async () => {
    try {
      console.debug("[M1SSION] Toggle called:", { isSubscribed, permission });
      if (!isSubscribed) {
        if (NEW_PUSH_SUBSCRIBE_FLOW) {
          const res = await subscribeFlow();
          if (res.ok) {
            ue$1.success("Notifiche attivate! 🎉");
          } else if (res.status === "permission_denied") {
            ue$1.warning("Permesso negato. Abilita le notifiche nelle impostazioni di sistema.");
          } else {
            ue$1.error(`Errore attivazione: ${res.error ?? "sconosciuto"}`);
          }
          return;
        }
        if (permission !== "granted") {
          const granted = await requestPermission();
          if (!granted) return;
        }
        const result = await subscribe();
        console.debug("[M1SSION] Subscribe result:", result);
      } else {
        ue$1.info("Le notifiche possono essere disattivate dalle Impostazioni del dispositivo.");
      }
    } catch (error) {
      console.error("[M1SSION] Toggle error:", error);
      ue$1.error(`Errore: ${error?.message ?? "unknown"}`);
    }
  };
  const getPlatformInfo = () => {
    if (isIOSPWA) {
      return {
        icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-4 h-4" }),
        label: "iOS PWA",
        description: "VAPID Push"
      };
    }
    return {
      icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Monitor, { className: "w-4 h-4" }),
      label: "Desktop",
      description: "Firebase FCM"
    };
  };
  const platformInfo = getPlatformInfo();
  if (!isSupported) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3 p-4 bg-muted/20 rounded-lg", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(BellOff, { className: "w-5 h-5 text-muted-foreground" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-muted-foreground", children: "Push Notifications" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Not supported on this device" })
      ] })
    ] });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-4 bg-card rounded-lg border", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-3", children: [
      isSubscribed ? /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5 text-primary" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(BellOff, { className: "w-5 h-5 text-muted-foreground" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "push-notifications", children: "Push Notifications" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", className: "flex items-center gap-1", children: [
            platformInfo.icon,
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs", children: platformInfo.label })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground", children: [
          isSubscribed ? "Attive" : "Disattivate",
          " • ",
          platformInfo.description
        ] }),
        permission === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-destructive", children: "Permessi negati. Abilitali nelle impostazioni del browser." })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      Switch,
      {
        id: "push-notifications",
        checked: isSubscribed,
        onCheckedChange: handleToggle,
        disabled: loading || permission === "denied"
      }
    )
  ] });
};

async function registerPush(reg) {
  if (!reg?.pushManager) {
    throw new Error("PushManager non disponibile");
  }
  const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await __vitePreload(async () => { const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await import('./vapid-loader.Dvqe_4zt.js');return { loadVAPIDPublicKey, urlBase64ToUint8Array }},true?[]:void 0);
  const publicKey = await loadVAPIDPublicKey();
  const applicationServerKey = typeof publicKey === "string" ? urlBase64ToUint8Array(publicKey) : publicKey;
  const existing = await reg.pushManager.getSubscription();
  if (existing) return existing;
  return reg.pushManager.subscribe({
    userVisibleOnly: true,
    applicationServerKey
  });
}

function checkPushSupport() {
  return typeof window !== "undefined" && "serviceWorker" in navigator && "PushManager" in window && "Notification" in window;
}
async function requestNotificationPermission() {
  try {
    const perm = await Notification.requestPermission();
    return perm === "granted";
  } catch {
    return false;
  }
}
const PushRegistrationTest = () => {
  const { user } = useAuth();
  const [status, setStatus] = reactExports.useState("idle");
  const onCheck = () => {
    const ok = checkPushSupport();
    setStatus(ok ? "supported" : "not_supported");
    ue$1[ok ? "success" : "error"](ok ? "Push support OK" : "Push not supported on this device");
  };
  const onAskPerm = async () => {
    const granted = await requestNotificationPermission();
    setStatus(granted ? "permission_granted" : "permission_denied");
    ue$1[granted ? "success" : "error"](granted ? "Permission granted" : "Permission denied");
  };
  const onRegister = async () => {
    try {
      setStatus("registering");
      const reg = await navigator.serviceWorker.ready;
      const res = await registerPush(reg);
      setStatus("registered");
      ue$1.success("Registered for push");
      console.log("registerPush() result:", res);
    } catch (e) {
      setStatus("error");
      console.error(e);
      ue$1.error("Failed to register push");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-muted-foreground", children: [
      "User: ",
      user?.id ?? "anon"
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm", children: [
      "Status: ",
      /* @__PURE__ */ jsxRuntimeExports.jsx("code", { children: status })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "secondary", onClick: onCheck, children: "Check support" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { variant: "secondary", onClick: onAskPerm, children: "Ask permission" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: onRegister, children: "Register push" })
    ] })
  ] });
};

const PushTestPage = () => {
  const handleTestPush = async () => {
    try {
      ue$1.loading("Invio notifica di test...");
      const { data, error } = await supabase.functions.invoke("send-push-notification", {
        body: {
          title: "🎯 Test M1SSION™",
          body: "Sistema di notifiche push funzionante!",
          data: {
            type: "test",
            timestamp: Date.now()
          }
        }
      });
      if (error) throw error;
      ue$1.success("✅ Notifica di test inviata!");
    } catch (error) {
      console.error("Test push failed:", error);
      ue$1.error("❌ Test fallito");
    }
  };
  const getBrowserInfo = () => {
    const ua = navigator.userAgent;
    if (ua.includes("Chrome")) return "Chrome";
    if (ua.includes("Firefox")) return "Firefox";
    if (ua.includes("Safari")) return "Safari";
    if (ua.includes("Edge")) return "Edge";
    return "Unknown";
  };
  const getPlatformInfo = () => {
    const platform = navigator.platform;
    const ua = navigator.userAgent.toLowerCase();
    if (/ipad|iphone|ipod/.test(ua)) return "iOS";
    if (/android/.test(ua)) return "Android";
    if (platform.includes("Win")) return "Windows";
    if (platform.includes("Mac")) return "macOS";
    if (platform.includes("Linux")) return "Linux";
    return platform;
  };
  const isSupported = "serviceWorker" in navigator && "PushManager" in window && "Notification" in window;
  const isPWA = window.matchMedia("(display-mode: standalone)").matches;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto py-8 space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "text-3xl font-bold flex items-center justify-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-8 h-8" }),
        "Push Notifications Test"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Sistema unificato di notifiche push M1SSION™" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-5 h-5" }),
        "Informazioni Ambiente"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-medium", children: "Browser" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: getBrowserInfo() })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-medium", children: "Piattaforma" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: getPlatformInfo() })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-medium", children: "PWA" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: isPWA ? "default" : "secondary", children: isPWA ? "Sì" : "No" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-medium", children: "Supporto" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: isSupported ? "default" : "destructive", children: isSupported ? "Supportato" : "Non supportato" })
        ] })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(PushRegistrationTest, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid gap-6 md:grid-cols-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-xl font-semibold flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-5 h-5" }),
          "Sistema Unificato"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedPushToggle, {})
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-xl font-semibold flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5" }),
          "Sistema Legacy"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(PushNotificationToggle, {})
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(TestTube, { className: "w-5 h-5" }),
          "Test Notifiche"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Invia una notifica di test per verificare il funzionamento" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleTestPush, className: "w-full", children: "🚀 Invia Notifica di Test" }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Dettagli Tecnici" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-2 text-sm", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "User Agent:" }),
          " ",
          navigator.userAgent
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Language:" }),
          " ",
          navigator.language
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Platform:" }),
          " ",
          navigator.platform
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Service Worker:" }),
          " ",
          "serviceWorker" in navigator ? "Supportato" : "Non supportato"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Push Manager:" }),
          " ",
          "PushManager" in window ? "Supportato" : "Non supportato"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Notifications:" }),
          " ",
          "Notification" in window ? Notification.permission : "Non supportato"
        ] })
      ] })
    ] })
  ] });
};

const SAFE_HEADERS = {
  "Content-Type": "application/json",
  "X-M1-Dropper-Version": "v1",
  "X-Client-Info": "m1ssion-pwa"
};
async function invokePushFunction(fn, payload) {
  try {
    const { data, error } = await supabase.functions.invoke(fn, {
      body: payload,
      headers: SAFE_HEADERS
    });
    if (error) {
      console.error(`[PUSH API] Error calling ${fn}:`, error);
      throw new Error(error.message || `Error calling ${fn}`);
    }
    return data;
  } catch (error) {
    console.error(`[PUSH API] Exception calling ${fn}:`, error);
    throw error;
  }
}

function AdminPushConsolePage() {
  const [, setLocation] = useLocation();
  const [title, setTitle] = reactExports.useState("");
  const [body, setBody] = reactExports.useState("");
  const [image, setImage] = reactExports.useState("");
  const [deepLink, setDeepLink] = reactExports.useState("");
  const [badge, setBadge] = reactExports.useState("");
  const [testToken, setTestToken] = reactExports.useState("");
  const [isSending, setIsSending] = reactExports.useState(false);
  const handleSendTest = async () => {
    if (!title.trim() || !body.trim()) {
      ue$1.error("Titolo e messaggio sono obbligatori");
      return;
    }
    if (!testToken.trim()) {
      ue$1.error("Token test è obbligatorio per il test");
      return;
    }
    setIsSending(true);
    try {
      const result = await invokePushFunction("push_test", {
        token: testToken.trim(),
        payload: {
          title: title.trim(),
          body: body.trim(),
          image: image.trim() || null,
          deepLink: deepLink.trim() || null,
          badge: badge.trim() || null
        }
      });
      if (result.ok) {
        ue$1.success("✅ Test inviato con successo!");
      } else {
        ue$1.error(`❌ Test fallito: ${result.error || "Errore sconosciuto"}`);
      }
    } catch (error) {
      console.error("Test push error:", error);
      ue$1.error(`❌ Errore test: ${error.message || "Errore di rete"}`);
    } finally {
      setIsSending(false);
    }
  };
  const handleSendBroadcast = async () => {
    if (!title.trim() || !body.trim()) {
      ue$1.error("Titolo e messaggio sono obbligatori");
      return;
    }
    const confirmed = window.confirm(
      "Sei sicuro di voler inviare una notifica broadcast a tutti gli utenti? Questa azione non può essere annullata."
    );
    if (!confirmed) return;
    setIsSending(true);
    try {
      const payload = {
        title: title.trim(),
        body: body.trim(),
        image: image.trim() || null,
        deepLink: deepLink.trim() || null,
        badge: badge.trim() || null,
        testToken: testToken.trim() || null
      };
      const result = await invokePushFunction("push_admin_broadcast", payload);
      if (result.ok) {
        ue$1.success(`✅ Broadcast inviato! ${result.sent}/${result.sent + result.failed} device raggiunti`);
        setTitle("");
        setBody("");
        setImage("");
        setDeepLink("");
        setBadge("");
        setTestToken("");
      } else {
        ue$1.error(`❌ Broadcast fallito: ${result.error || "Errore sconosciuto"}`);
      }
    } catch (error) {
      console.error("Admin broadcast error:", error);
      ue$1.error(`❌ Errore broadcast: ${error.message || "Errore di rete"}`);
    } finally {
      setIsSending(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto p-6 max-w-4xl", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6 flex items-center gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          variant: "ghost",
          onClick: () => setLocation("/admin/mission-panel"),
          className: "flex items-center gap-2",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-4 w-4" }),
            "Torna al Panel"
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink bg-clip-text text-transparent", children: "Admin Push Console" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Invio notifiche push broadcast - Solo Amministratori" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "h-5 w-5" }),
        "Notifica Push Broadcast"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "title", children: "Titolo *" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "title",
                value: title,
                onChange: (e) => setTitle(e.target.value),
                placeholder: "Titolo della notifica",
                maxLength: 100
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "badge", children: "Badge" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "badge",
                value: badge,
                onChange: (e) => setBadge(e.target.value),
                placeholder: "Numero badge (opzionale)",
                type: "number",
                min: "0"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "body", children: "Messaggio *" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              id: "body",
              value: body,
              onChange: (e) => setBody(e.target.value),
              placeholder: "Contenuto della notifica",
              maxLength: 500,
              rows: 3
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "image", children: "URL Immagine" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "image",
                value: image,
                onChange: (e) => setImage(e.target.value),
                placeholder: "https://example.com/image.jpg",
                type: "url"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "deepLink", children: "Deep Link" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "deepLink",
                value: deepLink,
                onChange: (e) => setDeepLink(e.target.value),
                placeholder: "/buzz, /map, /profile..."
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "testToken", children: "Token Test Device" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              id: "testToken",
              value: testToken,
              onChange: (e) => setTestToken(e.target.value),
              placeholder: "Token FCM o WebPush endpoint per test (opzionale)",
              rows: 2
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground mt-1", children: "Se fornito, verrà utilizzato anche per il test prima del broadcast" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-4 pt-4 border-t", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: handleSendTest,
              disabled: isSending || !title.trim() || !body.trim() || !testToken.trim(),
              variant: "outline",
              className: "flex items-center gap-2",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(TestTube, { className: "h-4 w-4" }),
                isSending ? "Invio Test..." : "Invia Test"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: handleSendBroadcast,
              disabled: isSending || !title.trim() || !body.trim(),
              className: "flex items-center gap-2 bg-gradient-to-r from-red-600 to-red-700",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "h-4 w-4" }),
                isSending ? "Invio Broadcast..." : "Invia Broadcast Admin"
              ]
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "• Il broadcast raggiungerà tutti i device registrati con notifiche attive" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "• Il test invia solo al token specificato sopra" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "• I deep link permettono di aprire sezioni specifiche dell'app" })
        ] })
      ] })
    ] })
  ] });
}

const AdminPushConsolePage$1 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: AdminPushConsolePage
}, Symbol.toStringTag, { value: 'Module' }));

getSupabaseUrl();
const SUPABASE_ANON_KEY = getSupabaseAnonKey();
async function sendPushNotification(request, options) {
  const startTime = performance.now();
  let endpoint = "";
  let requestBody = { payload: request.payload };
  if (request.audience === "all") {
    endpoint = `${functionsBaseUrl}/webpush-send`;
    requestBody.audience = "all";
  } else if (request.audience === "list" && request.filters?.ids) {
    endpoint = `${functionsBaseUrl}/webpush-targeted-send`;
    requestBody.user_ids = request.filters.ids;
  } else if (typeof request.audience === "object" && "user_id" in request.audience) {
    endpoint = `${functionsBaseUrl}/webpush-targeted-send`;
    requestBody.user_ids = [request.audience.user_id];
  } else {
    endpoint = `${functionsBaseUrl}/webpush-send`;
    requestBody.audience = "all";
  }
  const headers = {
    "Content-Type": "application/json",
    "apikey": SUPABASE_ANON_KEY
  };
  if (options.adminToken) {
    headers["x-admin-token"] = options.adminToken;
  } else if (options.userJWT) {
    headers["Authorization"] = `Bearer ${options.userJWT}`;
  }
  const response = await fetch(endpoint, {
    method: "POST",
    headers,
    body: JSON.stringify(requestBody)
  });
  const data = await response.json();
  const responseTime = Math.round(performance.now() - startTime);
  return {
    status: response.status,
    data,
    responseTime
  };
}
function getSuggestion(error, status) {
  if (!error && status === 200) return "✅ Success!";
  if (status === 401) {
    if (error?.includes("invalid_admin_token")) {
      return "⚠️ Token admin errato. Verifica PUSH_ADMIN_TOKEN.";
    }
    if (error?.includes("missing_authorization")) {
      return "⚠️ Authorization header mancante. Esegui il login o usa admin token.";
    }
    if (error?.includes("missing") || error?.includes("invalid_jwt")) {
      return "⚠️ JWT mancante o non valido. Esegui il login per ottenere un token valido.";
    }
    return "⚠️ Non autorizzato. Verifica le credenziali.";
  }
  if (status === 400) {
    if (error?.includes("endpoint")) {
      return "⚠️ Endpoint mancante o non valido. Verifica il formato.";
    }
    if (error?.includes("keys") || error?.includes("p256dh") || error?.includes("auth")) {
      return "⚠️ Chiavi push mancanti (p256dh/auth). Riesegui la subscription.";
    }
    return "⚠️ Richiesta non valida. Controlla i parametri.";
  }
  if (status === 500) {
    if (error?.includes("PUSH_ADMIN_TOKEN")) {
      return "⚠️ Configura PUSH_ADMIN_TOKEN nei secrets di Supabase.";
    }
    if (error?.includes("VAPID")) {
      return "⚠️ VAPID keys non configurate. Verifica VAPID_PUBLIC_KEY, VAPID_PRIVATE_KEY, VAPID_CONTACT.";
    }
    return "⚠️ Errore interno del server. Controlla i logs delle Edge Functions.";
  }
  if (error?.includes("No active subscriptions")) {
    return "⚠️ Nessuna subscription attiva trovata. Esegui (Re)Subscribe prima di inviare.";
  }
  return error || "Errore sconosciuto";
}

function PushSenderPanel() {
  const [, setLocation] = useLocation();
  const [audience, setAudience] = reactExports.useState("targeted");
  const [userIds, setUserIds] = reactExports.useState("");
  const [title, setTitle] = reactExports.useState("");
  const [badge, setBadge] = reactExports.useState("");
  const [message, setMessage] = reactExports.useState("");
  const [imageUrl, setImageUrl] = reactExports.useState("");
  const [linkUrl, setLinkUrl] = reactExports.useState("");
  const [freeBuzz, setFreeBuzz] = reactExports.useState(false);
  const [freeBuzzMap, setFreeBuzzMap] = reactExports.useState(false);
  const [xpPoints, setXpPoints] = reactExports.useState("");
  const [markerLat, setMarkerLat] = reactExports.useState("");
  const [markerLng, setMarkerLng] = reactExports.useState("");
  const [adminToken, setAdminToken] = reactExports.useState("");
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [lastResult, setLastResult] = reactExports.useState(null);
  const canSend = (title || message) && (audience !== "targeted" || userIds.trim());
  const handleSend = async () => {
    if (!canSend) {
      ue$1.error("Compila title o message. Per targeted, inserisci User ID.");
      return;
    }
    setIsLoading(true);
    setLastResult(null);
    try {
      const payload = {};
      if (title) payload.title = title;
      if (message) payload.body = message;
      if (badge !== "") payload.badge = Number(badge) || 0;
      if (imageUrl) payload.image = imageUrl;
      payload.data = {};
      if (linkUrl) payload.data.url = linkUrl;
      const extras = {};
      if (freeBuzz) extras.free_buzz = true;
      if (freeBuzzMap) extras.free_buzz_map = true;
      if (xpPoints) extras.xp_points = Number(xpPoints);
      if (markerLat && markerLng) extras.marker = { lat: markerLat, lng: markerLng };
      if (Object.keys(extras).length > 0) payload.data.extras = extras;
      let totalSent = 0;
      let totalFailed = 0;
      if (audience === "all") {
        if (!adminToken) {
          ue$1.error("Admin token richiesto per broadcast");
          setIsLoading(false);
          return;
        }
        const response = await sendPushNotification(
          { audience: "all", payload },
          { adminToken }
        );
        setLastResult(response);
        if (response.status === 200 || response.data.success) {
          totalSent = response.data.sent || response.data.total || 0;
          totalFailed = response.data.failed || 0;
          ue$1.success(`✅ Broadcast inviato: ${totalSent} sent, ${totalFailed} failed`);
        } else {
          ue$1.error(getSuggestion(response.data.error, response.status));
        }
      } else if (audience === "self") {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session?.access_token) {
          ue$1.error("Non autenticato. Esegui login.");
          setIsLoading(false);
          return;
        }
        const response = await sendPushNotification(
          { audience: "all", payload },
          // self è gestito come all con JWT
          { userJWT: session.access_token }
        );
        setLastResult(response);
        if (response.status === 200 || response.data.success) {
          ue$1.success("✅ Push self inviata!");
        } else {
          ue$1.error(getSuggestion(response.data.error, response.status));
        }
      } else {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session?.access_token) {
          ue$1.error("Non autenticato. Esegui login.");
          setIsLoading(false);
          return;
        }
        const userIdList = userIds.split(",").map((s) => s.trim()).filter(Boolean);
        if (userIdList.length === 0) {
          ue$1.error("Inserisci almeno un User ID");
          setIsLoading(false);
          return;
        }
        const results = await Promise.allSettled(
          userIdList.map(
            (uid) => sendPushNotification(
              { audience: { user_id: uid }, payload },
              { userJWT: session.access_token }
            )
          )
        );
        results.forEach((r, i) => {
          if (r.status === "fulfilled") {
            if (r.value.status === 200 || r.value.data.success) {
              totalSent += r.value.data.sent || 1;
            } else {
              totalFailed++;
            }
          } else {
            totalFailed++;
          }
        });
        setLastResult({ status: 200, data: { sent: totalSent, failed: totalFailed } });
        ue$1.success(`✅ Targeted: ${totalSent} sent, ${totalFailed} failed`);
      }
    } catch (error) {
      ue$1.error(`Errore: ${error.message}`);
      setLastResult({ status: 0, data: { error: error.message } });
    } finally {
      setIsLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "ghost",
          size: "icon",
          onClick: () => setLocation("/panel-access"),
          children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5" })
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent", children: "🚀 Push Sender" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Invio notifiche push (reuse existing logic)" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-6 space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Audience" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: audience, onValueChange: (v) => setAudience(v), children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, {}) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "targeted", children: "Targeted (User IDs)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "all", children: "Broadcast (All)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "self", children: "Self Test" })
          ] })
        ] })
      ] }),
      audience === "targeted" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "User IDs (CSV)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            placeholder: "uuid1, uuid2, uuid3",
            value: userIds,
            onChange: (e) => setUserIds(e.target.value)
          }
        )
      ] }),
      audience === "all" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Admin Token" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            type: "password",
            placeholder: "PUSH_ADMIN_TOKEN",
            value: adminToken,
            onChange: (e) => setAdminToken(e.target.value)
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Title" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              placeholder: "🔔 Titolo notifica",
              value: title,
              onChange: (e) => setTitle(e.target.value)
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Badge (numero)" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              type: "number",
              placeholder: "0",
              value: badge,
              onChange: (e) => setBadge(e.target.value)
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Message" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Textarea,
          {
            placeholder: "Testo della notifica",
            value: message,
            onChange: (e) => setMessage(e.target.value),
            rows: 3
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Image URL" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            placeholder: "https://...",
            value: imageUrl,
            onChange: (e) => setImageUrl(e.target.value)
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Link URL" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            placeholder: "/notifications",
            value: linkUrl,
            onChange: (e) => setLinkUrl(e.target.value)
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t border-gray-700 pt-4 space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-sm font-semibold text-gray-400", children: "Extras (opzionali)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Checkbox,
              {
                id: "freeBuzz",
                checked: freeBuzz,
                onCheckedChange: (c) => setFreeBuzz(!!c)
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "freeBuzz", className: "cursor-pointer", children: "Free Buzz" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Checkbox,
              {
                id: "freeBuzzMap",
                checked: freeBuzzMap,
                onCheckedChange: (c) => setFreeBuzzMap(!!c)
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "freeBuzzMap", className: "cursor-pointer", children: "Free Buzz Map" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "XP Points" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                type: "number",
                placeholder: "0",
                value: xpPoints,
                onChange: (e) => setXpPoints(e.target.value)
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Marker Lat" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                placeholder: "45.464",
                value: markerLat,
                onChange: (e) => setMarkerLat(e.target.value)
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Marker Lng" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                placeholder: "9.190",
                value: markerLng,
                onChange: (e) => setMarkerLng(e.target.value)
              }
            )
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          className: "w-full",
          onClick: handleSend,
          disabled: !canSend || isLoading,
          children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 mr-2 animate-spin" }),
            "Invio in corso..."
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-2" }),
            "Invia Push"
          ] })
        }
      ),
      lastResult && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 p-4 bg-gray-800/50 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-semibold mb-2", children: "Ultimo Esito:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { className: "text-xs text-gray-300 overflow-auto", children: JSON.stringify(lastResult.data, null, 2) })
      ] })
    ] })
  ] }) });
}

const NotificationDebug = () => {
  const [isInitialized, setIsInitialized] = reactExports.useState(false);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [playerId, setPlayerId] = reactExports.useState(null);
  const [permission, setPermission] = reactExports.useState("default");
  const [deviceTokens, setDeviceTokens] = reactExports.useState([]);
  const [iosDebugInfo, setIosDebugInfo] = reactExports.useState({});
  const [workerStatus, setWorkerStatus] = reactExports.useState("checking");
  const [subscriptionStatus, setSubscriptionStatus] = reactExports.useState(false);
  const { user } = useAuth();
  const checkWorkerStatus = async () => {
    try {
      const workerResponse = await fetch("/OneSignalSDKWorker.js");
      const updaterResponse = await fetch("/OneSignalSDKUpdaterWorker.js");
      if (workerResponse.ok && updaterResponse.ok) {
        setWorkerStatus("✅ Worker files accessible");
        console.log("🛰️ ULTIMATE iOS: Worker files OK");
      } else {
        setWorkerStatus("❌ Worker files missing");
        console.error("🛰️ ULTIMATE iOS: Worker files MISSING");
      }
    } catch (error) {
      setWorkerStatus("❌ Worker check failed");
      console.error("🛰️ ULTIMATE iOS: Worker check error:", error);
    }
  };
  const detectiOSEnvironment = () => {
    const userAgent = navigator.userAgent;
    const isIOS = /iPad|iPhone|iPod/.test(userAgent);
    const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
    const isStandalone = window.navigator.standalone === true;
    const isPWA = window.matchMedia("(display-mode: standalone)").matches;
    const iosInfo = {
      isIOS,
      isSafari,
      isStandalone,
      isPWA,
      userAgent,
      protocol: window.location.protocol,
      hostname: window.location.hostname,
      notificationSupport: "Notification" in window,
      serviceWorkerSupport: "serviceWorker" in navigator
    };
    setIosDebugInfo(iosInfo);
    console.log("🛰️ ULTIMATE iOS Environment:", iosInfo);
    return iosInfo;
  };
  const initializeOneSignal = async () => {
    try {
      console.log("🛰️ ULTIMATE iOS: Inizializzazione OneSignal con BYPASS completo...");
      if (typeof window === "undefined") {
        console.log("🛰️ ULTIMATE iOS: Non in ambiente browser");
        return false;
      }
      const iosInfo = detectiOSEnvironment();
      console.log("🛰️ ULTIMATE iOS: Environment detected:", iosInfo);
      if (window.OneSignal) {
        console.log("🛰️ ULTIMATE iOS: Clearing existing OneSignal instance...");
        try {
          await window.OneSignal.logout();
          delete window.OneSignalDeferred;
          delete window.OneSignalSDK;
        } catch (e) {
          console.log("🛰️ ULTIMATE iOS: Cleanup completed");
        }
        delete window.OneSignal;
      }
      const existingScript = document.querySelector('script[src*="OneSignalSDK"]');
      if (existingScript) {
        existingScript.remove();
        console.log("🛰️ ULTIMATE iOS: Removed existing OneSignal script");
      }
      const script = document.createElement("script");
      script.src = "https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js";
      script.defer = true;
      script.async = true;
      document.head.appendChild(script);
      return new Promise((resolve) => {
        script.onload = async () => {
          try {
            let attempts = 0;
            while (!window.OneSignal && attempts < 50) {
              await new Promise((resolve2) => setTimeout(resolve2, 100));
              attempts++;
            }
            if (!window.OneSignal) {
              throw new Error("OneSignal script loaded but object not available");
            }
            const config = {
              appId: "5e0cb75f-f065-4626-9a63-ce5692f7a7e0",
              // CORRECT App ID
              allowLocalhostAsSecureOrigin: true,
              // iOS Safari BYPASS MODE
              requiresUserPrivacyConsent: false,
              autoRegister: false,
              // Manual control for iOS
              autoResubscribe: true,
              // Service Worker configuration
              serviceWorkerPath: "/OneSignalSDKWorker.js",
              serviceWorkerUpdaterPath: "/OneSignalSDKUpdaterWorker.js",
              serviceWorkerParam: { scope: "/" },
              // iOS Safari Web Push BYPASS
              safari_web_id: void 0,
              // Let OneSignal auto-detect
              // CRITICAL: Disable domain validation for localhost testing
              restrictedOriginValidation: false,
              // HTTP permission request (for non-HTTPS environments)
              httpPermissionRequest: {
                enable: true,
                useModal: true
              },
              // Notification options
              notifyButton: { enable: false },
              persistNotification: true,
              // BYPASS MODE: Force initialization regardless of origin
              __BYPASS_ORIGIN_VALIDATION: true
            };
            console.log("🛰️ ULTIMATE iOS: BYPASS Config OneSignal:", config);
            console.log("🛰️ ULTIMATE iOS: Environment info:", iosInfo);
            console.log("🛰️ ULTIMATE iOS: Current URL:", window.location.href);
            console.log("🛰️ ULTIMATE iOS: Current Origin:", window.location.origin);
            await window.OneSignal.init(config);
            console.log("🛰️ ULTIMATE iOS: OneSignal BYPASS initialization completed!");
            window.OneSignal.push(() => {
              console.log("🛰️ ULTIMATE iOS: OneSignal ready with BYPASS mode");
            });
            setTimeout(async () => {
              await checkOneSignalStatus();
            }, 1e3);
            setIsInitialized(true);
            resolve(true);
          } catch (error) {
            console.error("🛰️ ULTIMATE iOS: BYPASS initialization error:", error);
            console.error("🛰️ ULTIMATE iOS: Error details:", {
              message: error.message,
              stack: error.stack,
              name: error.name
            });
            if (iosInfo.isIOS && iosInfo.isSafari) {
              console.log("🛰️ ULTIMATE iOS: Attempting iOS Safari fallback...");
              try {
                const permission2 = await Notification.requestPermission();
                console.log("🛰️ ULTIMATE iOS: Native permission result:", permission2);
                if (permission2 === "granted") {
                  console.log("🛰️ ULTIMATE iOS: iOS Safari manual permission granted");
                  setPermission(permission2);
                  resolve(true);
                } else {
                  resolve(false);
                }
              } catch (fallbackError) {
                console.error("🛰️ ULTIMATE iOS: Fallback failed:", fallbackError);
                resolve(false);
              }
            } else {
              resolve(false);
            }
          }
        };
        script.onerror = (error) => {
          console.error("🛰️ ULTIMATE iOS: Script loading failed:", error);
          resolve(false);
        };
      });
    } catch (error) {
      console.error("🛰️ ULTIMATE iOS: BYPASS setup error:", error);
      return false;
    }
  };
  const checkOneSignalStatus = async () => {
    try {
      if (!window.OneSignal) return;
      const OneSignal = window.OneSignal;
      const isEnabled = await OneSignal.isPushNotificationsEnabled();
      const userId = await OneSignal.getUserId();
      const notificationPermission = await OneSignal.getNotificationPermission();
      setSubscriptionStatus(isEnabled);
      setPlayerId(userId);
      setPermission(notificationPermission);
      console.log("🛰️ ULTIMATE iOS Status Check:", {
        isEnabled,
        userId,
        notificationPermission,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
    } catch (error) {
      console.error("🛰️ ULTIMATE iOS: Errore check status:", error);
    }
  };
  const loadDeviceTokens = async () => {
    try {
      const { data, error } = await supabase.from("device_tokens").select("*").order("created_at", { ascending: false });
      if (error) {
        console.error("🚀 ULTIMATE: Errore caricamento token:", error);
      } else {
        setDeviceTokens(data || []);
        console.log("🚀 ULTIMATE: Token caricati:", data?.length);
      }
    } catch (error) {
      console.error("🚀 ULTIMATE: Exception caricamento token:", error);
    }
  };
  const handleUltimateRegistration = async () => {
    setIsLoading(true);
    console.log("🛰️ ULTIMATE iOS: Inizio registrazione con App ID corretto...");
    try {
      console.log("🛰️ ULTIMATE iOS: Forcing fresh initialization...");
      const initialized = await initializeOneSignal();
      if (!initialized) {
        throw new Error("Inizializzazione OneSignal fallita");
      }
      await new Promise((resolve) => setTimeout(resolve, 2e3));
      if (!window.OneSignal) {
        throw new Error("OneSignal non disponibile dopo inizializzazione");
      }
      const OneSignal = window.OneSignal;
      console.log("🛰️ ULTIMATE iOS: Controllo supporto notifiche...");
      if (!("Notification" in window)) {
        throw new Error("Notifiche non supportate su questo browser");
      }
      console.log("🛰️ ULTIMATE iOS: Richiesta permessi notifiche...");
      console.log("🛰️ ULTIMATE iOS: Current permission:", Notification.permission);
      if (iosDebugInfo.isIOS && iosDebugInfo.isSafari) {
        console.log("🛰️ ULTIMATE iOS: Detected Safari iOS - using manual permission request");
        const permission2 = await Notification.requestPermission();
        console.log("🛰️ ULTIMATE iOS: Native permission result:", permission2);
        if (permission2 !== "granted") {
          console.warn("🛰️ ULTIMATE iOS: Permission not granted, trying OneSignal anyway...");
        }
      }
      try {
        await OneSignal.Notifications.requestPermission();
        console.log("🛰️ ULTIMATE iOS: OneSignal permission requested");
      } catch (osError) {
        console.warn("🛰️ ULTIMATE iOS: OneSignal permission error (may be OK):", osError);
      }
      await new Promise((resolve) => setTimeout(resolve, 2e3));
      console.log("🛰️ ULTIMATE iOS: Attempting Player ID retrieval with BYPASS methods...");
      let currentPlayerId = null;
      try {
        currentPlayerId = await OneSignal.User.PushSubscription.id;
        if (currentPlayerId) {
          console.log("🛰️ ULTIMATE iOS: Player ID via User.PushSubscription.id:", currentPlayerId);
        }
      } catch (error) {
        console.log("🛰️ ULTIMATE iOS: User.PushSubscription.id failed:", error.message);
      }
      if (!currentPlayerId) {
        try {
          currentPlayerId = await OneSignal.getUserId();
          if (currentPlayerId) {
            console.log("🛰️ ULTIMATE iOS: Player ID via getUserId():", currentPlayerId);
          }
        } catch (error) {
          console.log("🛰️ ULTIMATE iOS: getUserId() failed:", error.message);
        }
      }
      if (!currentPlayerId) {
        try {
          const subscription = await OneSignal.getSubscription();
          currentPlayerId = subscription?.userId || subscription?.playerId;
          if (currentPlayerId) {
            console.log("🛰️ ULTIMATE iOS: Player ID via getSubscription():", currentPlayerId);
          }
        } catch (error) {
          console.log("🛰️ ULTIMATE iOS: getSubscription() failed:", error.message);
        }
      }
      if (!currentPlayerId) {
        try {
          currentPlayerId = OneSignal.User?.onesignalId || OneSignal.User?.userId;
          if (currentPlayerId) {
            console.log("🛰️ ULTIMATE iOS: Player ID via direct property:", currentPlayerId);
          }
        } catch (error) {
          console.log("🛰️ ULTIMATE iOS: Direct property access failed:", error.message);
        }
      }
      if (!currentPlayerId && iosDebugInfo.isIOS && iosDebugInfo.isSafari) {
        console.log("🛰️ ULTIMATE iOS: Attempting iOS Safari manual registration...");
        try {
          await OneSignal.setSubscription(true);
          await new Promise((resolve) => setTimeout(resolve, 3e3));
          currentPlayerId = await OneSignal.User.PushSubscription.id || await OneSignal.getUserId();
          if (currentPlayerId) {
            console.log("🛰️ ULTIMATE iOS: Player ID after manual registration:", currentPlayerId);
          }
        } catch (manualError) {
          console.error("🛰️ ULTIMATE iOS: Manual registration failed:", manualError);
        }
      }
      if (currentPlayerId) {
        setPlayerId(currentPlayerId);
        console.log("🛰️ ULTIMATE iOS: Player ID ottenuto:", currentPlayerId);
        if (user) {
          console.log("🛰️ ULTIMATE iOS: Salvataggio token in Supabase...");
          const { error } = await supabase.from("device_tokens").upsert({
            user_id: user.id,
            token: currentPlayerId,
            device_type: iosDebugInfo.isIOS ? "onesignal_ios_web" : "onesignal_web",
            platform: `${navigator.platform} - ${iosDebugInfo.isIOS ? "iOS" : "Other"}`
          });
          if (error) {
            console.error("🛰️ ULTIMATE iOS: Errore salvataggio:", error);
          } else {
            console.log("🛰️ ULTIMATE iOS: Token salvato con successo!");
            await loadDeviceTokens();
          }
        }
        await checkOneSignalStatus();
        ue$1.success("🛰️ REGISTRAZIONE iOS ULTIMATE COMPLETATA!");
        console.log("🛰️ ULTIMATE iOS: Registrazione completata con successo!");
      } else {
        console.error("🛰️ ULTIMATE iOS: Player ID nullo - tentativo di debug...");
        try {
          const isEnabled = await OneSignal.isPushNotificationsEnabled();
          const permission2 = await OneSignal.getNotificationPermission();
          console.log("🛰️ ULTIMATE iOS Debug:", { isEnabled, permission: permission2 });
        } catch (debugError) {
          console.error("🛰️ ULTIMATE iOS: Debug error:", debugError);
        }
        throw new Error("Player ID non ottenuto - verifica permessi e connessione");
      }
    } catch (error) {
      console.error("🛰️ ULTIMATE iOS: Errore registrazione:", error);
      ue$1.error(`❌ Registrazione iOS fallita: ${error}`);
    } finally {
      setIsLoading(false);
    }
  };
  const handleTestNotification = async () => {
    if (!playerId) {
      ue$1.error("Registrati prima con il bottone ULTIMATE!");
      return;
    }
    try {
      console.log("🚀 ULTIMATE: Invio notifica test...");
      const { data, error } = await supabase.functions.invoke("send-push-notification-onesignal", {
        body: {
          user_id: user?.id,
          title: "🚀 ULTIMATE TEST M1SSION™",
          message: "Notifica test OneSignal funzionante!",
          data: { test: true }
        }
      });
      if (error) {
        console.error("🚀 ULTIMATE: Errore invio:", error);
        ue$1.error(`❌ Errore: ${error.message}`);
      } else {
        console.log("🚀 ULTIMATE: Notifica inviata:", data);
        ue$1.success("✅ Notifica test inviata!");
      }
    } catch (error) {
      console.error("🚀 ULTIMATE: Exception invio:", error);
      ue$1.error("❌ Errore invio notifica");
    }
  };
  const updatePermissionStatus = async () => {
    if (typeof window !== "undefined" && "Notification" in window) {
      setPermission(Notification.permission);
    }
  };
  reactExports.useEffect(() => {
    console.log("🛰️ ULTIMATE iOS: NOTIFICATION DEBUG MOUNTED - Component rendering successfully!");
    console.log("🛰️ ULTIMATE iOS: Starting iOS-specific initialization...");
    detectiOSEnvironment();
    checkWorkerStatus();
    initializeOneSignal();
    loadDeviceTokens();
    updatePermissionStatus();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/50 border-cyan-400/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-cyan-400 text-center", children: "🛰️ NOTIFICATION DEBUG iOS ULTIMATE - M1SSION™" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-sm text-green-400 mt-2", children: [
        "✅ PAGINA FUNZIONANTE - URL: ",
        window.location.href
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center text-xs text-orange-400 mt-1", children: "🍎 iOS Safari Optimized - OneSignal Debug Mode" })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/50 border-cyan-400/30", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-cyan-400", children: "📊 Status Dashboard" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-gray-800/50 p-3 rounded", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "OneSignal" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `font-bold ${isInitialized ? "text-green-400" : "text-red-400"}`, children: isInitialized ? "✅ Inizializzato" : "❌ Non inizializzato" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-gray-800/50 p-3 rounded", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Permessi" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `font-bold ${permission === "granted" ? "text-green-400" : permission === "denied" ? "text-red-400" : "text-yellow-400"}`, children: permission })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-gray-800/50 p-3 rounded", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Player ID" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `font-bold ${playerId ? "text-green-400" : "text-red-400"}`, children: playerId ? "✅ Ottenuto" : "❌ Mancante" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-gray-800/50 p-3 rounded", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Subscription" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `font-bold ${subscriptionStatus ? "text-green-400" : "text-red-400"}`, children: subscriptionStatus ? "✅ Attiva" : "❌ Inattiva" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-3 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-orange-800/30 p-3 rounded", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-orange-400", children: "iOS Device" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `font-bold ${iosDebugInfo.isIOS ? "text-green-400" : "text-red-400"}`, children: iosDebugInfo.isIOS ? "🍎 iOS" : "🖥️ Desktop" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-orange-800/30 p-3 rounded", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-orange-400", children: "Safari" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `font-bold ${iosDebugInfo.isSafari ? "text-green-400" : "text-yellow-400"}`, children: iosDebugInfo.isSafari ? "✅ Safari" : "⚠️ Other" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-orange-800/30 p-3 rounded", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-orange-400", children: "Service Worker" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `font-bold text-xs ${workerStatus.includes("✅") ? "text-green-400" : "text-red-400"}`, children: workerStatus })
          ] })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/50 border-cyan-400/30", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-cyan-400", children: "🎯 Azioni Principali" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleUltimateRegistration,
            disabled: isLoading,
            size: "lg",
            className: "bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-bold px-8 py-4 text-lg",
            children: isLoading ? "🔄 Registrando iOS..." : "🛰️ REGISTRATI ULTIMATE iOS"
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap gap-4 justify-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleTestNotification,
              disabled: !playerId,
              className: "bg-green-600 hover:bg-green-700",
              children: "📤 Test Notifica iOS"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: checkOneSignalStatus,
              variant: "outline",
              className: "border-orange-400 text-orange-400",
              children: "🛰️ Check OneSignal"
            }
          ),
          iosDebugInfo.isIOS && iosDebugInfo.isSafari && /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: async () => {
                console.log("🍎 iOS BYPASS: Starting emergency manual registration...");
                try {
                  if (window.OneSignal) {
                    await window.OneSignal.logout();
                    delete window.OneSignal;
                  }
                  const permission2 = await Notification.requestPermission();
                  console.log("🍎 iOS BYPASS: Native permission:", permission2);
                  if (permission2 === "granted") {
                    await initializeOneSignal();
                    await new Promise((resolve) => setTimeout(resolve, 3e3));
                    await checkOneSignalStatus();
                  }
                } catch (error) {
                  console.error("🍎 iOS BYPASS: Manual registration failed:", error);
                }
              },
              className: "bg-orange-600 hover:bg-orange-700",
              children: "🍎 iOS BYPASS Manual"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: loadDeviceTokens,
              variant: "outline",
              className: "border-cyan-400 text-cyan-400",
              children: "🔄 Ricarica Token"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: () => {
                detectiOSEnvironment();
                checkWorkerStatus();
                updatePermissionStatus();
              },
              variant: "outline",
              className: "border-yellow-400 text-yellow-400",
              children: "🔍 Full iOS Check"
            }
          )
        ] })
      ] })
    ] }),
    playerId && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/50 border-green-400/30", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-green-400", children: "✅ Player ID OneSignal" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gray-800/50 p-4 rounded", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs font-mono text-green-400 break-all", children: playerId }) }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/50 border-cyan-400/30", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-cyan-400", children: "📱 Token Dispositivi Registrati" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: deviceTokens.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-8 text-gray-400", children: "Nessun token registrato. Usa il bottone ULTIMATE per registrarti!" }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: deviceTokens.map((tokenData) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-gray-800/50 p-3 rounded", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-start mb-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400", children: tokenData.device_type }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400 ml-2", children: new Date(tokenData.created_at).toLocaleString() })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-green-400", children: [
            "ID: ",
            tokenData.id
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs font-mono text-gray-300 break-all", children: tokenData.token })
      ] }, tokenData.id)) }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/50 border-orange-400/30", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-orange-400", children: "🍎 iOS Environment Debug" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4 text-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "iOS Device:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `ml-2 ${iosDebugInfo.isIOS ? "text-green-400" : "text-red-400"}`, children: iosDebugInfo.isIOS ? "✅ iOS Device" : "❌ Not iOS" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Safari Browser:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `ml-2 ${iosDebugInfo.isSafari ? "text-green-400" : "text-yellow-400"}`, children: iosDebugInfo.isSafari ? "✅ Safari" : "⚠️ Other Browser" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "PWA Mode:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `ml-2 ${iosDebugInfo.isPWA ? "text-green-400" : "text-yellow-400"}`, children: iosDebugInfo.isPWA ? "✅ PWA" : "⚠️ Browser" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Standalone:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `ml-2 ${iosDebugInfo.isStandalone ? "text-green-400" : "text-gray-400"}`, children: iosDebugInfo.isStandalone ? "✅ Standalone" : "❌ Not Standalone" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Protocol:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `ml-2 ${iosDebugInfo.protocol === "https:" ? "text-green-400" : "text-red-400"}`, children: iosDebugInfo.protocol })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Notification API:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `ml-2 ${iosDebugInfo.notificationSupport ? "text-green-400" : "text-red-400"}`, children: iosDebugInfo.notificationSupport ? "✅ Supported" : "❌ Not Supported" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 p-3 bg-gray-800/50 rounded", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-gray-400 text-xs mb-2", children: "User Agent:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white text-xs break-all", children: iosDebugInfo.userAgent })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 p-3 bg-gray-800/50 rounded", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-gray-400 text-xs mb-2", children: "Service Worker Status:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white text-xs", children: workerStatus })
        ] })
      ] })
    ] })
  ] }) });
};

const AIContentGenerator = ({ onBack }) => {
  const [prompt, setPrompt] = reactExports.useState("");
  const [isGenerating, setIsGenerating] = reactExports.useState(false);
  const [generatedContent, setGeneratedContent] = reactExports.useState(null);
  const [contentType, setContentType] = reactExports.useState("clue");
  const handleGenerate = async () => {
    if (!prompt.trim()) {
      ue$1.error("Inserisci un prompt per generare contenuto");
      return;
    }
    setIsGenerating(true);
    try {
      console.log("🚀 Frontend: Starting AI content generation...");
      const { data: { session } } = await supabase.auth.getSession();
      console.log("📱 Frontend: Session check:", session ? "SESSION_FOUND" : "NO_SESSION");
      if (!session) {
        throw new Error("Sessione non trovata - accesso negato");
      }
      const requestPayload = {
        prompt: prompt.trim(),
        contentType,
        missionId: null
        // Per ora null, in futuro si potrà selezionare una missione
      };
      console.log("📤 Frontend: Sending request payload:", requestPayload);
      console.log("🔐 Frontend: Using JWT token:", session.access_token.substring(0, 20) + "...");
      const { data, error } = await supabase.functions.invoke("ai-content-generator", {
        body: requestPayload
      });
      console.log("📥 Frontend: Raw response data:", data);
      console.log("📥 Frontend: Raw response error:", error);
      if (error) {
        console.error("🚨 Frontend: Supabase functions error:", error);
        throw new Error(`Edge Function Error: ${error.message || "Unknown Supabase error"}`);
      }
      if (data?.error) {
        console.error("🚨 Frontend: Edge Function returned error:", data);
        throw new Error(`AI Generator Error: ${data.error}`);
      }
      if (!data?.content) {
        console.error("🚨 Frontend: No content in response:", data);
        throw new Error("Nessun contenuto generato dall'AI");
      }
      console.log("✅ Frontend: Successfully generated content:", data.content);
      setGeneratedContent(data.content);
      if (data.saved) {
        ue$1.success("Contenuto generato e salvato con successo!");
      } else {
        ue$1.success("Contenuto generato!");
        ue$1.error("Attenzione: contenuto non salvato nel database");
      }
    } catch (error) {
      console.error("🚨 Frontend: Complete error details:", {
        message: error.message,
        name: error.name,
        stack: error.stack,
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        prompt: prompt.trim(),
        contentType
      });
      let userErrorMessage = "Errore durante la generazione del contenuto";
      if (error.message?.includes("Sessione non trovata")) {
        userErrorMessage = "Sessione scaduta. Riloggati per continuare.";
      } else if (error.message?.includes("Edge Function Error")) {
        userErrorMessage = "Errore del server AI. Riprova tra qualche secondo.";
      } else if (error.message?.includes("AI Generator Error")) {
        userErrorMessage = `Errore AI: ${error.message.replace("AI Generator Error: ", "")}`;
      } else if (error.message) {
        userErrorMessage = error.message;
      }
      ue$1.error(userErrorMessage);
    } finally {
      setIsGenerating(false);
    }
  };
  const contentTypes = [
    { id: "clue", label: "Indizio", icon: FileText, color: "from-blue-500 to-purple-600" },
    { id: "mission", label: "Missione", icon: Zap, color: "from-purple-500 to-pink-600" },
    { id: "story", label: "Storia", icon: Image$2, color: "from-green-500 to-blue-600" }
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.6 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-8", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: onBack,
              variant: "ghost",
              className: "glass-card p-2 border border-white/20 hover:border-[#4361ee]/50",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5 text-white" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Cpu, { className: "w-6 h-6 text-white" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: "AI Content Generator" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Sistema di generazione automatica M1SSION™" })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid lg:grid-cols-2 gap-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, x: -20 },
              animate: { opacity: 1, x: 0 },
              transition: { delay: 0.2 },
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border border-white/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(WandSparkles, { className: "w-5 h-5 text-[#4361ee]" }),
                  "Pannello di Controllo"
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "block text-sm font-medium text-gray-300 mb-3", children: "Tipo di Contenuto" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-3 gap-2", children: contentTypes.map((type) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                      motion.button,
                      {
                        onClick: () => setContentType(type.id),
                        className: `p-3 rounded-lg border transition-all ${contentType === type.id ? "border-[#4361ee] bg-[#4361ee]/20" : "border-white/20 hover:border-white/40"}`,
                        whileHover: { scale: 1.05 },
                        whileTap: { scale: 0.95 },
                        children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx(type.icon, { className: `w-5 h-5 mx-auto mb-1 ${contentType === type.id ? "text-[#4361ee]" : "text-gray-400"}` }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `text-xs ${contentType === type.id ? "text-white" : "text-gray-400"}`, children: type.label })
                        ]
                      },
                      type.id
                    )) })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "block text-sm font-medium text-gray-300 mb-2", children: "Prompt di Generazione" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Textarea,
                      {
                        value: prompt,
                        onChange: (e) => setPrompt(e.target.value),
                        placeholder: "Inserisci il prompt per generare contenuto automaticamente...",
                        className: "glass-input bg-black/20 border-white/20 text-white placeholder-gray-400 min-h-[120px]",
                        rows: 5
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: handleGenerate,
                      disabled: isGenerating || !prompt.trim(),
                      className: "w-full bg-gradient-to-r from-[#4361ee] to-[#7209b7] hover:from-[#4361ee]/80 hover:to-[#7209b7]/80 text-white font-semibold py-3",
                      children: isGenerating ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          animate: { rotate: 360 },
                          transition: { duration: 1, repeat: Infinity, ease: "linear" },
                          className: "w-5 h-5 border-2 border-white border-t-transparent rounded-full"
                        }
                      ) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-5 h-5 mr-2" }),
                        "Genera Contenuto"
                      ] })
                    }
                  )
                ] })
              ] })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, x: 20 },
              animate: { opacity: 1, x: 0 },
              transition: { delay: 0.4 },
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border border-white/20", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-5 h-5 text-[#7209b7]" }),
                  "Anteprima Contenuto"
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: generatedContent ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    initial: { opacity: 0, y: 10 },
                    animate: { opacity: 1, y: 0 },
                    className: "bg-black/30 rounded-lg p-4 border border-white/10",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { className: "text-gray-300 text-sm whitespace-pre-wrap font-mono", children: generatedContent })
                  }
                ) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-12 text-gray-400", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-12 h-12 mx-auto mb-4 opacity-50" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Il contenuto generato apparirà qui" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm mt-2", children: 'Inserisci un prompt e clicca "Genera Contenuto"' })
                ] }) })
              ] })
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            transition: { delay: 0.6 },
            className: "mt-8",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "glass-card border border-white/20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-[#4361ee]", children: "42" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Indizi Generati" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-[#7209b7]", children: "15" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Missioni Create" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-green-400", children: "89%" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Successo AI" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-blue-400", children: "1.2k" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Token Utilizzati" })
              ] })
            ] }) }) })
          }
        )
      ]
    }
  ) }) });
};

const MissionDialog = ({
  open,
  onOpenChange,
  onSubmit,
  title,
  confirmButtonText,
  mission
}) => {
  const [missionData, setMissionData] = reactExports.useState({
    title: "",
    description: "",
    status: "draft",
    publication_date: null,
    start_date: null,
    end_date: null,
    prize_id: null,
    prize_description: "",
    prize_value: "",
    prize_image_url: ""
  });
  const [prizes, setPrizes] = reactExports.useState([]);
  reactExports.useEffect(() => {
    if (open) {
      loadPrizes();
      if (mission) {
        setMissionData({
          title: mission.title || "",
          description: mission.description || "",
          status: mission.status || "draft",
          publication_date: mission.publication_date || null,
          start_date: mission.start_date || null,
          end_date: mission.end_date || null,
          prize_id: mission.prize_id || null,
          prize_description: mission.prize_description || "",
          prize_value: mission.prize_value || "",
          prize_image_url: mission.prize_image_url || ""
        });
      } else {
        setMissionData({
          title: "",
          description: "",
          status: "draft",
          publication_date: null,
          start_date: null,
          end_date: null,
          prize_id: null,
          prize_description: "",
          prize_value: "",
          prize_image_url: ""
        });
      }
    }
  }, [open, mission]);
  const loadPrizes = async () => {
    try {
      const { data, error } = await supabase.from("prizes").select("id, name, description, image_url").eq("is_active", true);
      if (error) throw error;
      setPrizes(data || []);
    } catch (error) {
      console.error("Error loading prizes:", error);
    }
  };
  const handleSubmit = (e) => {
    e.preventDefault();
    onSubmit(missionData);
    onOpenChange(false);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open, onOpenChange, children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogContent, { className: "sm:max-w-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(DialogHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { children: title }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid gap-4 py-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "title", className: "text-right", children: "Titolo" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "title",
            value: missionData.title,
            onChange: (e) => setMissionData({ ...missionData, title: e.target.value }),
            className: "col-span-3",
            required: true
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "description", className: "text-right", children: "Descrizione" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Textarea,
          {
            id: "description",
            value: missionData.description || "",
            onChange: (e) => setMissionData({ ...missionData, description: e.target.value }),
            className: "col-span-3",
            rows: 4
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "status", className: "text-right", children: "Stato" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Select,
          {
            value: missionData.status || void 0,
            onValueChange: (value) => setMissionData({ ...missionData, status: value }),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { className: "col-span-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona stato" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "draft", children: "Bozza" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "published", children: "Pubblicata" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "scheduled", children: "Programmata" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "archived", children: "Archiviata" })
              ] })
            ]
          }
        )
      ] }),
      missionData.status === "published" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "publication_date", className: "text-right", children: "Data di pubblicazione" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "publication_date",
            type: "datetime-local",
            value: missionData.publication_date ? new Date(missionData.publication_date).toISOString().slice(0, 16) : (/* @__PURE__ */ new Date()).toISOString().slice(0, 16),
            onChange: (e) => setMissionData({
              ...missionData,
              publication_date: e.target.value ? new Date(e.target.value).toISOString() : null
            }),
            className: "col-span-3"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "start_date", className: "text-right", children: "Data inizio" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "start_date",
            type: "datetime-local",
            value: missionData.start_date ? new Date(missionData.start_date).toISOString().slice(0, 16) : "",
            onChange: (e) => setMissionData({
              ...missionData,
              start_date: e.target.value ? new Date(e.target.value).toISOString() : null
            }),
            className: "col-span-3"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "end_date", className: "text-right", children: "Data fine" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "end_date",
            type: "datetime-local",
            value: missionData.end_date ? new Date(missionData.end_date).toISOString().slice(0, 16) : "",
            onChange: (e) => setMissionData({
              ...missionData,
              end_date: e.target.value ? new Date(e.target.value).toISOString() : null
            }),
            className: "col-span-3"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "prize_id", className: "text-right", children: "Premio" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Select,
          {
            value: missionData.prize_id || void 0,
            onValueChange: (value) => setMissionData({ ...missionData, prize_id: value === "none" ? null : value }),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { className: "col-span-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona premio (opzionale)" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "none", children: "Nessun premio" }),
                prizes.map((prize) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: prize.id, children: prize.name || "Premio senza nome" }, prize.id))
              ] })
            ]
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "prize_description", className: "text-right", children: "Descrizione premio" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Textarea,
          {
            id: "prize_description",
            value: missionData.prize_description || "",
            onChange: (e) => setMissionData({ ...missionData, prize_description: e.target.value }),
            className: "col-span-3",
            rows: 2,
            placeholder: "Descrizione personalizzata del premio"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "prize_value", className: "text-right", children: "Valore premio" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "prize_value",
            value: missionData.prize_value || "",
            onChange: (e) => setMissionData({ ...missionData, prize_value: e.target.value }),
            className: "col-span-3",
            placeholder: "es. €100, 50 punti, accesso VIP"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-4 items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "prize_image_url", className: "text-right", children: "Immagine premio" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "prize_image_url",
            value: missionData.prize_image_url || "",
            onChange: (e) => setMissionData({ ...missionData, prize_image_url: e.target.value }),
            className: "col-span-3",
            placeholder: "URL immagine premio"
          }
        )
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogFooter, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { type: "button", variant: "outline", onClick: () => onOpenChange(false), children: "Annulla" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { type: "submit", children: confirmButtonText })
    ] })
  ] }) }) });
};

const Spinner = reactExports.forwardRef(
  ({ className, size = "md", ...props }, ref) => {
    const sizeClasses = {
      sm: "h-4 w-4",
      md: "h-6 w-6",
      lg: "h-8 w-8"
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        ref,
        className: cn(
          "animate-spin rounded-full border-2 border-gray-300 border-t-2 border-t-gray-900 dark:border-gray-600 dark:border-t-gray-300",
          sizeClasses[size],
          className
        ),
        ...props
      }
    );
  }
);
Spinner.displayName = "Spinner";

const MissionConfig = ({ mission, onBack, onUpdate }) => {
  const [isEditing, setIsEditing] = reactExports.useState(false);
  const [participantCount, setParticipantCount] = reactExports.useState(0);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [editData, setEditData] = reactExports.useState(mission);
  reactExports.useEffect(() => {
    loadParticipantCount();
    const channel = supabase.channel("mission-participants").on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "user_mission_registrations",
      filter: `mission_id=eq.${mission.id}`
    }, () => {
      loadParticipantCount();
    }).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, [mission.id]);
  const loadParticipantCount = async () => {
    try {
      setIsLoading(true);
      const { count, error } = await supabase.from("user_mission_registrations").select("*", { count: "exact", head: true }).eq("mission_id", mission.id).eq("status", "active");
      if (error) throw error;
      setParticipantCount(count || 0);
    } catch (error) {
      console.error("Error loading participant count:", error);
      ue$1.error("Errore nel caricamento dei partecipanti");
    } finally {
      setIsLoading(false);
    }
  };
  const handleSave = async () => {
    try {
      const { error } = await supabase.from("missions").update({
        title: editData.title,
        description: editData.description,
        status: editData.status,
        start_date: editData.start_date,
        end_date: editData.end_date,
        // Prize fields removed - managed only in Prizes tab
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", mission.id);
      if (error) throw error;
      ue$1.success("Missione aggiornata con successo");
      onUpdate(editData);
      setIsEditing(false);
    } catch (error) {
      ue$1.error("Errore nell'aggiornamento della missione", {
        description: error.message
      });
    }
  };
  const formatDate = (dateString) => {
    if (!dateString) return "Non definita";
    return new Date(dateString).toLocaleDateString("it-IT", {
      year: "numeric",
      month: "long",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit"
    });
  };
  const getStatusColor = (status) => {
    switch (status) {
      case "active":
        return "bg-green-500/20 text-green-400 border-green-500/30";
      case "completed":
        return "bg-blue-500/20 text-blue-400 border-blue-500/30";
      case "draft":
        return "bg-yellow-500/20 text-yellow-400 border-yellow-500/30";
      case "published":
        return "bg-green-500/20 text-green-400 border-green-500/30";
      case "scheduled":
        return "bg-orange-500/20 text-orange-400 border-orange-500/30";
      case "archived":
        return "bg-gray-500/20 text-gray-400 border-gray-500/30";
      default:
        return "bg-gray-500/20 text-gray-400 border-gray-500/30";
    }
  };
  const getStatusLabel = (status) => {
    switch (status) {
      case "published":
        return "Pubblicata";
      case "draft":
        return "Bozza";
      case "scheduled":
        return "Programmata";
      case "archived":
        return "Archiviata";
      case "active":
        return "Attiva";
      case "completed":
        return "Completata";
      default:
        return status;
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      transition: { duration: 0.6 },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-8", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: onBack,
                variant: "ghost",
                className: "glass-card p-2 border border-white/20 hover:border-[#7209b7]/50",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5 text-white" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: "Mission Config" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Configurazione dettagli missione" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-2", children: isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: handleSave,
                className: "bg-gradient-to-r from-green-500 to-green-600 hover:opacity-90",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Save, { className: "w-4 h-4 mr-2" }),
                  "Salva"
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: () => {
                  setIsEditing(false);
                  setEditData(mission);
                },
                variant: "outline",
                className: "border-white/20 text-white hover:bg-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-4 h-4 mr-2" }),
                  "Annulla"
                ]
              }
            )
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: () => setIsEditing(true),
              className: "bg-gradient-to-r from-[#4361ee] to-[#7209b7] hover:opacity-90",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SquarePen, { className: "w-4 h-4 mr-2" }),
                "Modifica"
              ]
            }
          ) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid gap-6 mb-8", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/20", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-5 h-5 text-[#4361ee]" }),
                "Informazioni Missione"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: getStatusColor(isEditing ? editData.status : mission.status), children: getStatusLabel(isEditing ? editData.status : mission.status) })
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-gray-300", children: "Titolo" }),
                  isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      value: editData.title,
                      onChange: (e) => setEditData({ ...editData, title: e.target.value }),
                      className: "mt-1"
                    }
                  ) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-lg font-semibold", children: mission.title })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-gray-300", children: "Partecipanti" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mt-1", children: [
                    isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(Spinner, { size: "sm" }) : /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white text-lg font-semibold", children: participantCount }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-4 h-4 text-[#4361ee]" })
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-gray-300", children: "Descrizione" }),
                isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Textarea,
                  {
                    value: editData.description || "",
                    onChange: (e) => setEditData({ ...editData, description: e.target.value }),
                    className: "mt-1",
                    rows: 3
                  }
                ) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 mt-1", children: mission.description || "Nessuna descrizione" })
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/20", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-5 h-5 text-[#4361ee]" }),
              "Date e Programmazione"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-gray-300", children: "Data Inizio" }),
                  isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      type: "datetime-local",
                      value: editData.start_date ? new Date(editData.start_date).toISOString().slice(0, 16) : "",
                      onChange: (e) => setEditData({
                        ...editData,
                        start_date: e.target.value ? new Date(e.target.value).toISOString() : null
                      }),
                      className: "mt-1"
                    }
                  ) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white", children: formatDate(mission.start_date) })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-gray-300", children: "Data Fine" }),
                  isEditing ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      type: "datetime-local",
                      value: editData.end_date ? new Date(editData.end_date).toISOString().slice(0, 16) : "",
                      onChange: (e) => setEditData({
                        ...editData,
                        end_date: e.target.value ? new Date(e.target.value).toISOString() : null
                      }),
                      className: "mt-1"
                    }
                  ) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white", children: formatDate(mission.end_date) })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-gray-300", children: "Data Pubblicazione" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white", children: formatDate(mission.publication_date) })
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card border-white/20", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white flex items-center gap-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-5 h-5 text-[#4361ee]" }),
                "Dettagli Premio (Solo Lettura)"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: () => {
                    onBack();
                  },
                  variant: "outline",
                  size: "sm",
                  className: "border-white/20 text-white hover:bg-white/10",
                  children: "Gestisci Premi"
                }
              )
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-gray-300", children: "Descrizione Premio" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white", children: mission.prize_description || "Nessun premio definito" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-500 mt-1", children: "I premi vengono gestiti dal tab Premi nel Mission Control" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-gray-300", children: "Valore Premio" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white", children: mission.prize_value || "Non specificato" })
                ] })
              ] }),
              mission.prize_image_url && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-gray-300", children: "Immagine Premio" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "img",
                  {
                    src: mission.prize_image_url,
                    alt: "Premio",
                    className: "w-32 h-32 object-cover rounded-lg border border-white/20"
                  }
                ) })
              ] })
            ] })
          ] })
        ] })
      ]
    }
  ) }) });
};

const MissionUsers = ({ selectedMissionId }) => {
  const [participants, setParticipants] = reactExports.useState([]);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [totalCount, setTotalCount] = reactExports.useState(0);
  const [activeMissionId, setActiveMissionId] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const fetchActiveMission = async () => {
      if (selectedMissionId) {
        setActiveMissionId(selectedMissionId);
        return;
      }
      try {
        const { data: missions } = await supabase.from("missions").select("id").eq("status", "active").order("start_date", { ascending: false }).limit(1);
        if (missions && missions.length > 0) {
          setActiveMissionId(missions[0].id);
        }
      } catch (err) {
        console.error("Error fetching active mission:", err);
      }
    };
    fetchActiveMission();
  }, [selectedMissionId]);
  reactExports.useEffect(() => {
    if (!activeMissionId) return;
    fetchParticipants();
    const channel = supabase.channel(`participants-realtime-${activeMissionId}`).on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "mission_enrollments",
      filter: `mission_id=eq.${activeMissionId}`
    }, (payload) => {
      console.log("📡 Mission enrollment change:", payload);
      fetchParticipants();
    }).subscribe((status) => {
      console.log("📡 Realtime subscription status:", status);
    });
    return () => {
      supabase.removeChannel(channel);
    };
  }, [activeMissionId]);
  const fetchParticipants = async () => {
    if (!activeMissionId) return;
    try {
      setIsLoading(true);
      const { data: enrollments, error: regError, count } = await supabase.from("mission_enrollments").select("mission_id,user_id,joined_at", { count: "exact" }).eq("mission_id", activeMissionId).order("joined_at", { ascending: false });
      if (regError) throw regError;
      if (!enrollments || enrollments.length === 0) {
        setParticipants([]);
        setTotalCount(0);
        return;
      }
      const userIds = enrollments.map((r) => r.user_id);
      const { data: profiles, error: profilesError } = await supabase.from("profiles").select("id, full_name, email").in("id", userIds);
      if (profilesError) throw profilesError;
      const participantsData = enrollments.map((enr) => ({
        id: `${enr.mission_id}-${enr.user_id}`,
        user_id: enr.user_id,
        mission_id: enr.mission_id,
        registered_at: enr.joined_at,
        status: "active",
        profiles: profiles?.find((p) => p.id === enr.user_id)
      }));
      setParticipants(participantsData);
      setTotalCount(count || 0);
    } catch (error) {
      ue$1.error("Errore nel caricamento partecipanti", {
        description: error.message
      });
    } finally {
      setIsLoading(false);
    }
  };
  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString("it-IT", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit"
    });
  };
  if (!activeMissionId) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-8 border border-white/20 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-12 h-12 text-gray-400 mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Nessuna missione attiva trovata" })
    ] });
  }
  if (isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center p-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Spinner, { size: "lg", className: "text-[#7209b7]" }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-between items-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-xl font-semibold text-white", children: [
      "Partecipanti (",
      totalCount,
      ")"
    ] }) }),
    participants.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card p-8 border border-white/20 text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Nessun partecipante registrato" }) }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid gap-4", children: participants.map((participant) => /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        whileHover: { scale: 1.01 },
        className: "glass-card p-4 border border-white/20",
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-lg bg-gradient-to-r from-[#7209b7] to-[#4361ee] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-5 h-5 text-white" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: participant.profiles?.full_name || participant.profiles?.email || "Utente" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 text-sm text-gray-400", children: [
                participant.profiles?.email && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: participant.profiles.email }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                  "Registrato: ",
                  formatDate(participant.registered_at)
                ] })
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-green-500/20 text-green-400 border-green-500/30", children: participant.status })
        ] })
      },
      participant.id
    )) })
  ] });
};

const MissionPrizes = ({ selectedMissionId }) => {
  const [prizes, setPrizes] = reactExports.useState([]);
  const [categories, setCategories] = reactExports.useState([]);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [isDialogOpen, setIsDialogOpen] = reactExports.useState(false);
  const [editingPrize, setEditingPrize] = reactExports.useState(null);
  const [formData, setFormData] = reactExports.useState({
    title: "",
    description: "",
    value_text: "",
    category_id: "",
    newCategoryName: "",
    status: "available"
  });
  reactExports.useEffect(() => {
    if (!selectedMissionId) return;
    fetchPrizes();
    fetchCategories();
    const prizesChannel = supabase.channel(`prizes-${selectedMissionId}`).on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "mission_prizes",
      filter: `mission_id=eq.${selectedMissionId}`
    }, () => {
      fetchPrizes();
    }).subscribe();
    const categoriesChannel = supabase.channel("prize-categories").on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "prize_categories"
    }, () => {
      fetchCategories();
    }).subscribe();
    return () => {
      supabase.removeChannel(prizesChannel);
      supabase.removeChannel(categoriesChannel);
    };
  }, [selectedMissionId]);
  const fetchPrizes = async () => {
    if (!selectedMissionId) return;
    try {
      setIsLoading(true);
      const { data, error } = await supabase.from("mission_prizes").select(`
          *,
          prize_categories (
            name
          )
        `).eq("mission_id", selectedMissionId).order("created_at", { ascending: false });
      if (error) throw error;
      setPrizes(data || []);
    } catch (error) {
      ue$1.error("Errore nel caricamento premi", {
        description: error.message
      });
    } finally {
      setIsLoading(false);
    }
  };
  const fetchCategories = async () => {
    try {
      const { data, error } = await supabase.from("prize_categories").select("*").order("name");
      if (error) throw error;
      setCategories(data || []);
    } catch (error) {
      console.error("Error loading categories:", error);
    }
  };
  const openCreateDialog = () => {
    setEditingPrize(null);
    setFormData({
      title: "",
      description: "",
      value_text: "",
      category_id: "",
      newCategoryName: "",
      status: "available"
    });
    setIsDialogOpen(true);
  };
  const openEditDialog = (prize) => {
    setEditingPrize(prize);
    setFormData({
      title: prize.title,
      description: prize.description || "",
      value_text: prize.value_text || "",
      category_id: prize.category_id || "",
      newCategoryName: "",
      status: prize.status
    });
    setIsDialogOpen(true);
  };
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!selectedMissionId || !formData.title) {
      ue$1.error("Compila i campi obbligatori");
      return;
    }
    try {
      let categoryId = formData.category_id || null;
      if (formData.newCategoryName.trim()) {
        const { data: categoryIdData, error: categoryError } = await supabase.rpc("upsert_prize_category", { cat_name: formData.newCategoryName.trim() });
        if (categoryError) throw categoryError;
        categoryId = categoryIdData;
      }
      const prizeData = {
        mission_id: selectedMissionId,
        title: formData.title,
        description: formData.description || null,
        value_text: formData.value_text || null,
        category_id: categoryId,
        status: formData.status
      };
      if (editingPrize) {
        const { error } = await supabase.from("mission_prizes").update(prizeData).eq("id", editingPrize.id);
        if (error) throw error;
        ue$1.success("Premio aggiornato");
      } else {
        const { error } = await supabase.from("mission_prizes").insert(prizeData);
        if (error) throw error;
        ue$1.success("Premio creato");
      }
      setIsDialogOpen(false);
    } catch (error) {
      ue$1.error("Errore", {
        description: error.message
      });
    }
  };
  const handleDelete = async (prize) => {
    if (!confirm(`Vuoi eliminare il premio "${prize.title}"?`)) return;
    try {
      const { error } = await supabase.from("mission_prizes").delete().eq("id", prize.id);
      if (error) throw error;
      ue$1.success("Premio eliminato");
    } catch (error) {
      ue$1.error("Errore nell'eliminazione", {
        description: error.message
      });
    }
  };
  if (!selectedMissionId) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-8 border border-white/20 text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-12 h-12 text-gray-400 mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Seleziona una missione per gestire i premi" })
    ] });
  }
  if (isLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center p-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Spinner, { size: "lg", className: "text-green-500" }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h2", { className: "text-xl font-semibold text-white", children: [
        "Gestione Premi (",
        prizes.length,
        ")"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          onClick: openCreateDialog,
          className: "bg-gradient-to-r from-green-500 to-blue-600 hover:opacity-90",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-2" }),
            "Nuovo Premio"
          ]
        }
      )
    ] }),
    prizes.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card p-8 border border-white/20 text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Nessun premio configurato per questa missione" }) }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid gap-4", children: prizes.map((prize) => /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        whileHover: { scale: 1.01 },
        className: "glass-card p-4 border border-white/20",
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-lg bg-gradient-to-r from-green-500 to-blue-600 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Award, { className: "w-5 h-5 text-white" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: prize.title }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 text-sm text-gray-400", children: [
                prize.prize_categories && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                  "Categoria: ",
                  prize.prize_categories.name
                ] }),
                prize.value_text && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                  "Valore: ",
                  prize.value_text
                ] })
              ] }),
              prize.description && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-500 mt-1", children: prize.description })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: prize.status === "available" ? "bg-green-500/20 text-green-400 border-green-500/30" : "bg-gray-500/20 text-gray-400 border-gray-500/30", children: prize.status === "available" ? "Disponibile" : "Non disponibile" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                size: "sm",
                variant: "ghost",
                onClick: () => openEditDialog(prize),
                className: "text-gray-400 hover:text-white",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                size: "sm",
                variant: "ghost",
                onClick: () => handleDelete(prize),
                className: "text-red-400 hover:text-red-300",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-4 h-4" })
              }
            )
          ] })
        ] })
      },
      prize.id
    )) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isDialogOpen, onOpenChange: setIsDialogOpen, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogContent, { className: "glass-card border border-white/20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(DialogHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-white", children: editingPrize ? "Modifica Premio" : "Nuovo Premio" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "title", children: "Titolo *" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "title",
              value: formData.title,
              onChange: (e) => setFormData({ ...formData, title: e.target.value }),
              placeholder: "Nome del premio",
              required: true
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "category", children: "Categoria" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Select,
            {
              value: formData.category_id || void 0,
              onValueChange: (value) => setFormData({ ...formData, category_id: value }),
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona categoria esistente" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: categories.map((cat) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: cat.id, children: cat.name }, cat.id)) })
              ]
            }
          )
        ] }),
        !formData.category_id && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "newCategory", children: "O crea nuova categoria" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "newCategory",
              value: formData.newCategoryName,
              onChange: (e) => setFormData({ ...formData, newCategoryName: e.target.value }),
              placeholder: "es. Elettronica, Viaggi, Esperienze..."
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-500 mt-1", children: "Se inserisci un nome qui, verrà creata una nuova categoria" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "value_text", children: "Valore (descrizione testuale)" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "value_text",
              value: formData.value_text,
              onChange: (e) => setFormData({ ...formData, value_text: e.target.value }),
              placeholder: "es. Smartphone, Viaggio per 2, 1000 crediti..."
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "description", children: "Descrizione" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              id: "description",
              value: formData.description,
              onChange: (e) => setFormData({ ...formData, description: e.target.value }),
              placeholder: "Descrizione dettagliata del premio...",
              rows: 3
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "status", children: "Stato" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Select,
            {
              value: formData.status,
              onValueChange: (value) => setFormData({ ...formData, status: value }),
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, {}) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "available", children: "Disponibile" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "unavailable", children: "Non disponibile" })
                ] })
              ]
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-end gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: "outline",
              onClick: () => setIsDialogOpen(false),
              children: "Annulla"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { type: "submit", children: editingPrize ? "Aggiorna" : "Crea" })
        ] })
      ] })
    ] }) })
  ] });
};

const MissionControlPanel = ({ onBack }) => {
  const [activeTab, setActiveTab] = reactExports.useState("missions");
  const [missions, setMissions] = reactExports.useState([]);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [isCreateDialogOpen, setIsCreateDialogOpen] = reactExports.useState(false);
  const [isEditDialogOpen, setIsEditDialogOpen] = reactExports.useState(false);
  const [currentMission, setCurrentMission] = reactExports.useState(null);
  const [showMissionConfig, setShowMissionConfig] = reactExports.useState(false);
  const [selectedMission, setSelectedMission] = reactExports.useState(null);
  const [participantCounts, setParticipantCounts] = reactExports.useState({});
  const [selectedMissionIdForTabs, setSelectedMissionIdForTabs] = reactExports.useState(null);
  reactExports.useEffect(() => {
    fetchMissions();
    const missionsChannel = supabase.channel("missions-changes").on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "missions"
    }, () => {
      fetchMissions();
    }).subscribe();
    const participantsChannel = supabase.channel("participants-changes").on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "mission_enrollments"
    }, () => {
      loadParticipantCounts();
    }).subscribe();
    return () => {
      supabase.removeChannel(missionsChannel);
      supabase.removeChannel(participantsChannel);
    };
  }, []);
  const fetchMissions = async () => {
    try {
      setIsLoading(true);
      const { data, error } = await supabase.from("missions").select("*").order("created_at", { ascending: false });
      if (error) throw error;
      setMissions(data || []);
      if (data) {
        loadParticipantCounts(data);
      }
    } catch (error) {
      ue$1.error("Errore nel caricamento delle missioni", {
        description: error.message
      });
    } finally {
      setIsLoading(false);
    }
  };
  const loadParticipantCounts = async (list) => {
    try {
      const counts = {};
      const listToUse = list ?? missions;
      for (const mission of listToUse) {
        const { count, error } = await supabase.from("mission_enrollments").select("*", { count: "exact", head: true }).eq("mission_id", mission.id);
        if (!error) {
          counts[mission.id] = count || 0;
        }
      }
      setParticipantCounts(counts);
    } catch (error) {
      console.error("Error loading participant counts:", error);
    }
  };
  const handleCreateMission = async (missionData) => {
    try {
      if (!missionData.title) {
        ue$1.error("Il titolo è obbligatorio");
        return;
      }
      const { data, error } = await supabase.from("missions").insert({
        title: missionData.title,
        description: missionData.description || null,
        publication_date: missionData.publication_date || null,
        status: missionData.status || "draft",
        start_date: missionData.start_date || null,
        end_date: missionData.end_date || null,
        prize_id: missionData.prize_id || null,
        prize_description: missionData.prize_description || null,
        prize_value: missionData.prize_value || null,
        prize_image_url: missionData.prize_image_url || null
      }).select().single();
      if (error) throw error;
      if (data) {
        setSelectedMissionIdForTabs(data.id);
        setActiveTab("users");
      }
      ue$1.success("Missione creata con successo");
      setIsCreateDialogOpen(false);
    } catch (error) {
      ue$1.error("Errore nella creazione della missione", {
        description: error.message
      });
    }
  };
  const handleUpdateMission = async (missionData) => {
    if (!currentMission) return;
    try {
      if (!missionData.title) {
        ue$1.error("Il titolo è obbligatorio");
        return;
      }
      const { error } = await supabase.from("missions").update({
        title: missionData.title,
        description: missionData.description,
        publication_date: missionData.publication_date,
        status: missionData.status,
        start_date: missionData.start_date,
        end_date: missionData.end_date,
        prize_id: missionData.prize_id,
        prize_description: missionData.prize_description,
        prize_value: missionData.prize_value,
        prize_image_url: missionData.prize_image_url,
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      }).eq("id", currentMission.id);
      if (error) throw error;
      ue$1.success("Missione aggiornata con successo");
      setIsEditDialogOpen(false);
      setCurrentMission(null);
    } catch (error) {
      ue$1.error("Errore nell'aggiornamento della missione", {
        description: error.message
      });
    }
  };
  const handleDeleteMission = async (mission) => {
    if (!confirm(`Sei sicuro di voler eliminare la missione "${mission.title}"?`)) {
      return;
    }
    try {
      const { error } = await supabase.from("missions").delete().eq("id", mission.id);
      if (error) throw error;
      ue$1.success("Missione eliminata con successo");
    } catch (error) {
      ue$1.error("Errore nell'eliminazione della missione", {
        description: error.message
      });
    }
  };
  const openMissionConfig = (mission) => {
    setSelectedMission(mission);
    setShowMissionConfig(true);
  };
  const handleMissionCardClick = (mission) => {
    setSelectedMissionIdForTabs(mission.id);
    if (activeTab === "missions") {
      setActiveTab("users");
    }
  };
  const handleMissionUpdate = (updatedMission) => {
    setMissions((prev) => prev.map((m) => m.id === updatedMission.id ? updatedMission : m));
    setSelectedMission(updatedMission);
  };
  const tabs = [
    { id: "missions", label: "Missioni", icon: Target, color: "text-[#4361ee]" },
    { id: "users", label: "Utenti", icon: Users, color: "text-[#7209b7]" },
    { id: "rewards", label: "Premi", icon: Award, color: "text-green-400" }
  ];
  const getMissionStatusBadge = (mission) => {
    const now = /* @__PURE__ */ new Date();
    const startDate = mission.start_date ? new Date(mission.start_date) : null;
    const endDate = mission.end_date ? new Date(mission.end_date) : null;
    if (endDate && now >= endDate) {
      return { label: "Completata", color: "bg-blue-500/20 text-blue-400 border-blue-500/30" };
    }
    if ((mission.status === "scheduled" || mission.status === "published") && startDate && now >= startDate && (!endDate || now < endDate)) {
      return { label: "Live", color: "bg-green-500/20 text-green-400 border-green-500/30" };
    }
    if (mission.status === "scheduled" && startDate && now < startDate) {
      return { label: "Programmata", color: "bg-orange-500/20 text-orange-400 border-orange-500/30" };
    }
    if (mission.status === "draft") {
      return { label: "Bozza", color: "bg-yellow-500/20 text-yellow-400 border-yellow-500/30" };
    }
    if (mission.status === "archived") {
      return { label: "Archiviata", color: "bg-gray-500/20 text-gray-400 border-gray-500/30" };
    }
    if (mission.status === "published") {
      return { label: "Pubblicata", color: "bg-green-500/20 text-green-400 border-green-500/30" };
    }
    return { label: mission.status, color: "bg-gray-500/20 text-gray-400 border-gray-500/30" };
  };
  const getParticipantCount = (mission) => {
    return participantCounts[mission.id] || 0;
  };
  const getCompletionPercent = (mission) => {
    return mission.status === "published" ? Math.floor(Math.random() * 100) + 1 : mission.status === "draft" ? 0 : 100;
  };
  const getProjectRefLocal = () => {
    return getProjectRef();
  };
  const supaTableUrl = (table) => `https://supabase.com/dashboard/project/${getProjectRefLocal()}/database/tables/public/${table}`;
  const getPublishedCount = () => {
    const now = /* @__PURE__ */ new Date();
    return missions.filter((m) => {
      const startDate = m.start_date ? new Date(m.start_date) : null;
      const endDate = m.end_date ? new Date(m.end_date) : null;
      return m.status === "published" || (m.status === "scheduled" || m.status === "published") && startDate && now >= startDate && (!endDate || now < endDate);
    }).length;
  };
  const formatDateRange = (mission) => {
    if (mission.start_date && mission.end_date) {
      const startDate = new Date(mission.start_date).toLocaleDateString("it-IT");
      const endDate = new Date(mission.end_date).toLocaleDateString("it-IT");
      return `${startDate} - ${endDate}`;
    } else if (mission.publication_date) {
      const startDate = new Date(mission.publication_date).toLocaleDateString("it-IT");
      const endDate = new Date(new Date(mission.publication_date).getTime() + 30 * 24 * 60 * 60 * 1e3).toLocaleDateString("it-IT");
      return `${startDate} - ${endDate}`;
    }
    return "Date non definite";
  };
  if (showMissionConfig && selectedMission) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      MissionConfig,
      {
        mission: selectedMission,
        onBack: () => setShowMissionConfig(false),
        onUpdate: handleMissionUpdate
      }
    );
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] p-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-6xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.6 },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: onBack,
                variant: "ghost",
                className: "glass-card p-2 border border-white/20 hover:border-[#7209b7]/50",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5 text-white" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-[#7209b7] to-[#4361ee] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-6 h-6 text-white" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: "Mission Control" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Centro di controllo missioni M1SSION™" })
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-2 mb-6", children: tabs.map((tab) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: () => setActiveTab(tab.id),
              variant: "ghost",
              className: `glass-card border transition-all ${activeTab === tab.id ? "border-white/40 bg-white/10" : "border-white/20 hover:border-white/30"}`,
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(tab.icon, { className: `w-4 h-4 mr-2 ${tab.color}` }),
                tab.label
              ]
            },
            tab.id
          )) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0, y: 10 },
              animate: { opacity: 1, y: 0 },
              transition: { duration: 0.3 },
              children: [
                activeTab === "missions" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl font-semibold text-white", children: "Gestione Missioni" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(
                      Button,
                      {
                        onClick: () => setIsCreateDialogOpen(true),
                        className: "bg-gradient-to-r from-[#4361ee] to-[#7209b7] hover:opacity-90",
                        children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-4 h-4 mr-2" }),
                          "Nuova Missione"
                        ]
                      }
                    )
                  ] }),
                  isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center p-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Spinner, { size: "lg", className: "text-[#4361ee]" }) }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid gap-4", children: missions.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card p-8 border border-white/20 text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Nessuna missione disponibile" }) }) : missions.map((mission) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.01 },
                      className: `glass-card p-4 border cursor-pointer transition-colors ${selectedMissionIdForTabs === mission.id ? "border-[#4361ee] bg-[#4361ee]/10" : "border-white/20"}`,
                      onClick: () => handleMissionCardClick(mission),
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-5 h-5 text-white" }) }),
                          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: mission.title }),
                            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 text-sm text-gray-400", children: [
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                                getParticipantCount(mission),
                                " partecipanti"
                              ] }),
                              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                                getCompletionPercent(mission),
                                "% completamento"
                              ] }),
                              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: formatDateRange(mission) })
                            ] }),
                            mission.description && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-500 mt-1", children: mission.description })
                          ] })
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                          (() => {
                            const statusBadge = getMissionStatusBadge(mission);
                            return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: statusBadge.color, children: statusBadge.label });
                          })(),
                          /* @__PURE__ */ jsxRuntimeExports.jsx(
                            Button,
                            {
                              size: "sm",
                              variant: "ghost",
                              onClick: (e) => {
                                e.stopPropagation();
                                openMissionConfig(mission);
                              },
                              className: "text-gray-400 hover:text-white",
                              title: "Visualizza dettagli missione",
                              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Eye, { className: "w-4 h-4" })
                            }
                          ),
                          /* @__PURE__ */ jsxRuntimeExports.jsx(
                            Button,
                            {
                              size: "sm",
                              variant: "ghost",
                              onClick: (e) => {
                                e.stopPropagation();
                                handleDeleteMission(mission);
                              },
                              className: "text-red-400 hover:text-red-300",
                              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-4 h-4" })
                            }
                          )
                        ] })
                      ] })
                    },
                    mission.id
                  )) })
                ] }),
                activeTab === "users" && /* @__PURE__ */ jsxRuntimeExports.jsx(MissionUsers, { selectedMissionId: selectedMissionIdForTabs }),
                activeTab === "rewards" && /* @__PURE__ */ jsxRuntimeExports.jsx(MissionPrizes, { selectedMissionId: selectedMissionIdForTabs })
              ]
            },
            activeTab
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              transition: { delay: 0.8 },
              className: "mt-8",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "glass-card border border-white/20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-5 gap-4 text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-[#4361ee]", children: missions.length }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Missioni Totali" })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-green-400", children: getPublishedCount() }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Missioni Pubblicate" })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-[#7209b7]", children: missions.filter((m) => m.status === "draft").length }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Bozze" })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-blue-400", children: missions.filter((m) => m.status === "scheduled").length }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Programmate" })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-yellow-400", children: missions.filter((m) => m.status === "archived").length }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-gray-400", children: "Archiviate" })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 text-center space-x-2", children: getProjectRef() && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => window.open(supaTableUrl("missions"), "_blank", "noopener"),
                      variant: "outline",
                      size: "sm",
                      className: "text-xs",
                      "data-testid": "btn-missions-table",
                      children: "Missions Table"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => window.open(supaTableUrl("mission_prizes"), "_blank", "noopener"),
                      variant: "outline",
                      size: "sm",
                      className: "text-xs",
                      "data-testid": "btn-mission-prizes-table",
                      children: "Mission Prizes"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => window.open(supaTableUrl("prize_categories"), "_blank", "noopener"),
                      variant: "outline",
                      size: "sm",
                      className: "text-xs",
                      "data-testid": "btn-prize-categories-table",
                      children: "Prize Categories"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => window.open(supaTableUrl("user_mission_registrations"), "_blank", "noopener"),
                      variant: "outline",
                      size: "sm",
                      className: "text-xs",
                      "data-testid": "btn-user-registrations-table",
                      children: "User Registrations"
                    }
                  )
                ] }) })
              ] }) })
            }
          )
        ]
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      MissionDialog,
      {
        open: isCreateDialogOpen,
        onOpenChange: setIsCreateDialogOpen,
        onSubmit: handleCreateMission,
        title: "Crea Nuova Missione",
        confirmButtonText: "Crea"
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      MissionDialog,
      {
        open: isEditDialogOpen,
        onOpenChange: setIsEditDialogOpen,
        onSubmit: handleUpdateMission,
        title: "Modifica Missione",
        confirmButtonText: "Salva Modifiche",
        mission: currentMission
      }
    )
  ] });
};

const MissionResetSection = () => {
  const [isResetting, setIsResetting] = reactExports.useState(false);
  const [confirmationCode, setConfirmationCode] = reactExports.useState("");
  const [showConfirmation, setShowConfirmation] = reactExports.useState(false);
  const handleReset = async () => {
    if (confirmationCode !== "RESET_M1SSION_CONFIRM") {
      ue$1.error("Codice di conferma non valido");
      return;
    }
    setIsResetting(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        throw new Error("Sessione non trovata");
      }
      console.log("🔄 Chiamata reset-mission con codice:", confirmationCode);
      console.log("👤 User session:", session.user.email);
      const supabaseUrl = `https://${getProjectRef()}.supabase.co`;
      const response = await fetch(`${supabaseUrl}/functions/v1/reset-mission`, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${session.access_token}`,
          "Content-Type": "application/json",
          "x-m1ssion-sig": "official-client"
        },
        body: JSON.stringify({ confirmationCode })
      });
      const responseData = await response.json();
      console.log("📡 Risposta reset-mission:", response.status, responseData);
      console.log("🔧 Response details:", responseData);
      if (!response.ok) {
        throw new Error(responseData.error || `HTTP ${response.status}: ${response.statusText}`);
      }
      const result = responseData;
      if (result.success) {
        const resetTables = result.tables_reset || [];
        const resetDate = result.reset_details?.reset_date;
        const daysRemaining = result.mission_status?.days_remaining || 30;
        ue$1.success("✅ RESET MISSIONE™ COMPLETATO", {
          description: `Missione completamente azzerata! ${resetTables.length} tabelle ripristinate. Giorni rimasti: ${daysRemaining}. La pagina si ricaricherà automaticamente.`
        });
        setShowConfirmation(false);
        setConfirmationCode("");
        console.log("🔄 TRIGGERING MISSION RESET EVENT FOR BUZZ SYNC...");
        window.dispatchEvent(new CustomEvent("missionReset", {
          detail: {
            resetDate,
            daysRemaining,
            tablesReset: resetTables
          }
        }));
        localStorage.clear();
        setTimeout(() => {
          window.location.reload();
        }, 3e3);
      } else {
        throw new Error(result.error || "Reset fallito");
      }
    } catch (error) {
      console.error("❌ Reset mission error:", error);
      ue$1.error("❌ ERRORE RESET MISSIONE", {
        description: error.message || "Errore sconosciuto durante il reset"
      });
    } finally {
      setIsResetting(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-destructive/20 bg-destructive/5", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "h-5 w-5 text-destructive" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-destructive", children: "RESET MISSIONE™" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Riavvia completamente la missione corrente - AZIONE IRREVERSIBILE" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Alert, { variant: "destructive", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "h-4 w-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDescription, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "ATTENZIONE:" }),
          " Questa operazione eliminerà TUTTO:",
          /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc ml-4 mt-2 space-y-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Stato missione (riportato a 30 giorni, 0% progresso)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Tutti gli indizi trovati" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Tutte le aree mappa generate" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Contatori BUZZ giornalieri e mappa" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Tutte le notifiche utente" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Tentativi Final Shot" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Coordinate geo-radar" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Punti mappa salvati" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Uso strumenti intelligence" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Stato attività live" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mt-2 font-semibold text-destructive", children: "La missione ripartirà da ZERO con data di oggi!" })
        ] })
      ] }),
      !showConfirmation ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          variant: "destructive",
          onClick: () => setShowConfirmation(true),
          className: "w-full",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "mr-2 h-4 w-4" }),
            "AVVIA RESET MISSIONE"
          ]
        }
      ) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("label", { className: "text-sm font-medium", children: [
            "Inserisci il codice di conferma: ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "bg-muted px-1 rounded", children: "RESET_M1SSION_CONFIRM" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              type: "text",
              value: confirmationCode,
              onChange: (e) => setConfirmationCode(e.target.value),
              placeholder: "Inserisci il codice di conferma",
              className: "font-mono"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              variant: "destructive",
              onClick: handleReset,
              disabled: isResetting || confirmationCode !== "RESET_M1SSION_CONFIRM",
              className: "flex-1",
              children: isResetting ? "RESETTING..." : "CONFERMA RESET"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              variant: "outline",
              onClick: () => {
                setShowConfirmation(false);
                setConfirmationCode("");
              },
              disabled: isResetting,
              children: "Annulla"
            }
          )
        ] })
      ] })
    ] })
  ] });
};

const MissionConfigSection = () => {
  const [missionData, setMissionData] = reactExports.useState({
    city: "",
    country: "",
    street: "",
    street_number: "",
    prize_type: "",
    prize_color: "",
    prize_material: "",
    prize_category: ""
  });
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [isSaving, setIsSaving] = reactExports.useState(false);
  const [isGeneratingClues, setIsGeneratingClues] = reactExports.useState(false);
  const [activePrizeId, setActivePrizeId] = reactExports.useState(null);
  reactExports.useEffect(() => {
    loadCurrentMission();
  }, []);
  const loadCurrentMission = async () => {
    setIsLoading(true);
    try {
      const { data, error } = await supabase.from("current_mission_data").select("*").eq("is_active", true).order("created_at", { ascending: false }).limit(1).maybeSingle();
      if (error) {
        console.error("Error loading mission:", error);
        return;
      }
      if (data) {
        setMissionData({
          city: data.city || "",
          country: data.country || "",
          street: data.street || "",
          street_number: data.street_number || "",
          prize_type: data.prize_type || "",
          prize_color: data.prize_color || "",
          prize_material: data.prize_material || "",
          prize_category: data.prize_category || ""
        });
      }
      const { data: prizeData } = await supabase.from("prizes").select("id").eq("is_active", true).order("created_at", { ascending: false }).limit(1).maybeSingle();
      if (prizeData) {
        setActivePrizeId(prizeData.id);
      }
    } catch (error) {
      console.error("Error loading mission:", error);
    } finally {
      setIsLoading(false);
    }
  };
  const handleGenerateClues = async () => {
    if (!activePrizeId) {
      ue$1.error("❌ NESSUN PREMIO ATTIVO", {
        description: "Devi prima creare e attivare un premio"
      });
      return;
    }
    if (!missionData.city || !missionData.country) {
      ue$1.error("❌ DATI MANCANTI", {
        description: "Inserisci almeno città e paese prima di generare gli indizi"
      });
      return;
    }
    setIsGeneratingClues(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        throw new Error("Sessione non trovata");
      }
      const payload = {
        prize_id: activePrizeId,
        city: missionData.city,
        country: missionData.country,
        prize_type: missionData.prize_type,
        prize_color: missionData.prize_color,
        prize_material: missionData.prize_material,
        prize_category: missionData.prize_category
      };
      console.log("🎯 [GENERATE-CLUES] Sending payload:", payload);
      const { data: result, error: invokeError } = await supabase.functions.invoke("generate-mission-clues", {
        body: payload
      });
      if (invokeError) {
        console.error("❌ [GENERATE-CLUES] Error response:", invokeError);
        throw new Error(`Errore: ${invokeError.message}`);
      }
      if (result.success) {
        ue$1.success("✅ INDIZI GENERATI!", {
          description: `Creati ${result.breakdown?.total || 0} indizi per la missione`
        });
      } else {
        throw new Error(result.error || "Generazione fallita");
      }
    } catch (error) {
      console.error("❌ Generate clues error:", error);
      ue$1.error("❌ ERRORE GENERAZIONE", {
        description: error.message || "Errore sconosciuto durante la generazione"
      });
    } finally {
      setIsGeneratingClues(false);
    }
  };
  const handleSave = async () => {
    setIsSaving(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        throw new Error("Sessione non trovata");
      }
      const response = await supabase.functions.invoke("update-mission", {
        body: { missionData },
        headers: {
          "Authorization": `Bearer ${session.access_token}`,
          "Content-Type": "application/json"
        }
      });
      if (response.error) {
        throw new Error(response.error.message || "Errore durante il salvataggio");
      }
      const result = response.data;
      if (result.success) {
        ue$1.success("✅ MISSIONE AGGIORNATA", {
          description: `Configurazione salvata: ${missionData.city}, ${missionData.country}`
        });
      } else {
        throw new Error(result.error || "Salvataggio fallito");
      }
    } catch (error) {
      console.error("❌ Save mission error:", error);
      ue$1.error("❌ ERRORE SALVATAGGIO", {
        description: error.message || "Errore sconosciuto durante il salvataggio"
      });
    } finally {
      setIsSaving(false);
    }
  };
  const handleInputChange = (field, value) => {
    setMissionData((prev) => ({
      ...prev,
      [field]: value
    }));
  };
  const prizeTypes = [
    "Rolex",
    "Borsa Hermès",
    "Auto Ferrari",
    "Auto Lamborghini",
    "Auto Porsche",
    "Gioiello Cartier",
    "Anello Tiffany",
    "Orologio Patek Philippe",
    "Borsa Chanel",
    "Auto BMW",
    "Auto Mercedes",
    "Smartphone iPhone",
    "Laptop MacBook",
    "Tablet iPad"
  ];
  const prizeColors = [
    "Oro",
    "Argento",
    "Rosso",
    "Nero",
    "Blu Navy",
    "Bianco",
    "Verde",
    "Marrone",
    "Rosa Gold",
    "Platino",
    "Bronze",
    "Blu Elettrico",
    "Grigio",
    "Bordeaux"
  ];
  const prizeMaterials = [
    "Oro 18K",
    "Oro 24K",
    "Argento 925",
    "Platino",
    "Acciaio Inossidabile",
    "Pelle di Coccodrillo",
    "Pelle di Pitone",
    "Pelle Italiana",
    "Seta",
    "Carbonio",
    "Titanio",
    "Ceramica",
    "Cristallo Zaffiro",
    "Diamanti"
  ];
  const prizeCategories = [
    "Orologio",
    "Borsa",
    "Gioiello",
    "Veicolo",
    "Tech",
    "Accessorio",
    "Arte",
    "Elettronica",
    "Lusso",
    "Moda",
    "Sport",
    "Casa"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-primary/20 bg-primary/5", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "h-5 w-5 text-primary" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-primary", children: "IMPOSTA MISSIONE™" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Configura manualmente tutti i parametri della missione corrente" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "h-4 w-4 text-muted-foreground" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold", children: "Ubicazione" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "city", children: "Città" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "city",
                value: missionData.city,
                onChange: (e) => handleInputChange("city", e.target.value),
                placeholder: "es. Milano"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "country", children: "Paese" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "country",
                value: missionData.country,
                onChange: (e) => handleInputChange("country", e.target.value),
                placeholder: "es. Italia"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "street", children: "Via" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "street",
                value: missionData.street,
                onChange: (e) => handleInputChange("street", e.target.value),
                placeholder: "es. Via Montenapoleone"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "street_number", children: "Numero Civico" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "street_number",
                value: missionData.street_number,
                onChange: (e) => handleInputChange("street_number", e.target.value),
                placeholder: "es. 12A"
              }
            )
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold", children: "Premio" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "prize_type", children: "Tipo Premio" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: missionData.prize_type, onValueChange: (value) => handleInputChange("prize_type", value), children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona tipo premio" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: prizeTypes.map((type) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: type, children: type }, type)) })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "prize_color", children: "Colore Premio" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: missionData.prize_color, onValueChange: (value) => handleInputChange("prize_color", value), children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona colore" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: prizeColors.map((color) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: color, children: color }, color)) })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "prize_material", children: "Materiale Premio" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: missionData.prize_material, onValueChange: (value) => handleInputChange("prize_material", value), children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona materiale" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: prizeMaterials.map((material) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: material, children: material }, material)) })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "prize_category", children: "Categoria Premio" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: missionData.prize_category, onValueChange: (value) => handleInputChange("prize_category", value), children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona categoria" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: prizeCategories.map((category) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: category, children: category }, category)) })
            ] })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: handleSave,
            disabled: isSaving || isLoading,
            className: "flex-1",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Save, { className: "mr-2 h-4 w-4" }),
              isSaving ? "SALVANDO..." : "SALVA CONFIGURAZIONE"
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: handleGenerateClues,
            disabled: isGeneratingClues || isLoading || !activePrizeId,
            variant: "secondary",
            className: "flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(WandSparkles, { className: "mr-2 h-4 w-4" }),
              isGeneratingClues ? "GENERANDO..." : "GENERA 400 INDIZI"
            ]
          }
        )
      ] }),
      !activePrizeId && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground text-center mt-2", children: "⚠️ Nessun premio attivo. Crea e attiva un premio prima di generare gli indizi." })
    ] })
  ] });
};

const AUTHORIZED_EMAIL_HASH = "9e0aefd8ff5e2879549f1bfddb3975372f9f4281ea9f9120ef90278763653c52";
const AUTHORIZED_EMAIL = "wikus77@hotmail.it";
async function calculateSHA256(text) {
  const encoder = new TextEncoder();
  const data = encoder.encode(text);
  const hash = await crypto.subtle.digest("SHA-256", data);
  const hashArray = Array.from(new Uint8Array(hash));
  return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
}
const usePanelAccessProtection = () => {
  const { user, isAuthenticated, isLoading } = useUnifiedAuth();
  const { navigate } = useWouterNavigation();
  const [isWhitelisted, setIsWhitelisted] = reactExports.useState(false);
  const [isValidating, setIsValidating] = reactExports.useState(true);
  const [accessDeniedReason, setAccessDeniedReason] = reactExports.useState("");
  const logAccessAttempt = async (attempt) => {
    try {
      await supabase.from("admin_logs").insert({
        event_type: "panel_access_attempt",
        user_id: user?.id || null,
        context: JSON.stringify({
          email: attempt.email,
          ip: attempt.ip,
          userAgent: attempt.userAgent,
          success: attempt.success,
          reason: accessDeniedReason
        }),
        note: attempt.success ? "Accesso autorizzato al M1SSION PANEL™" : "Tentativo di accesso non autorizzato"
      });
    } catch (error) {
      console.error("❌ Errore nel logging dell'accesso:", error);
    }
  };
  const getClientInfo = () => {
    return {
      ip: "client-side",
      // In produzione si può usare un servizio per l'IP reale
      userAgent: navigator.userAgent
    };
  };
  const validateAccess = async () => {
    setIsValidating(true);
    try {
      const clientInfo = getClientInfo();
      console.log("🔐 PANEL ACCESS VALIDATION - DEBUG:", {
        isAuthenticated,
        isLoading,
        user,
        email: user?.email,
        expectedEmail: AUTHORIZED_EMAIL,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
      if (!isAuthenticated || !user?.email) {
        console.error("🚨 PANEL ACCESS DENIED - Not authenticated:", {
          isAuthenticated,
          isLoading,
          hasUser: !!user,
          hasEmail: !!user?.email
        });
        setAccessDeniedReason("Utente non autenticato");
        setIsWhitelisted(false);
        await logAccessAttempt({
          email: user?.email || "anonymous",
          ip: clientInfo.ip,
          userAgent: clientInfo.userAgent,
          timestamp: (/* @__PURE__ */ new Date()).toISOString(),
          success: false
        });
        return;
      }
      if (user.email !== AUTHORIZED_EMAIL) {
        console.error("🚨 PANEL ACCESS DENIED - Wrong email:", {
          actualEmail: user.email,
          expectedEmail: AUTHORIZED_EMAIL,
          match: user.email === AUTHORIZED_EMAIL
        });
        setAccessDeniedReason("Email non autorizzata");
        setIsWhitelisted(false);
        await logAccessAttempt({
          email: user.email,
          ip: clientInfo.ip,
          userAgent: clientInfo.userAgent,
          timestamp: (/* @__PURE__ */ new Date()).toISOString(),
          success: false
        });
        return;
      }
      const emailHash = await calculateSHA256(user.email);
      if (emailHash !== AUTHORIZED_EMAIL_HASH) {
        setAccessDeniedReason("Hash email non valido");
        setIsWhitelisted(false);
        await logAccessAttempt({
          email: user.email,
          ip: clientInfo.ip,
          userAgent: clientInfo.userAgent,
          timestamp: (/* @__PURE__ */ new Date()).toISOString(),
          success: false
        });
        navigate("/access-denied");
        return;
      }
      setIsWhitelisted(true);
      setAccessDeniedReason("");
      await logAccessAttempt({
        email: user.email,
        ip: clientInfo.ip,
        userAgent: clientInfo.userAgent,
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        success: true
      });
    } catch (error) {
      console.error("❌ Errore nella validazione dell'accesso:", error);
      setAccessDeniedReason("Errore di validazione");
      setIsWhitelisted(false);
      navigate("/access-denied");
    } finally {
      setIsValidating(false);
    }
  };
  reactExports.useEffect(() => {
    validateAccess();
  }, [isAuthenticated, user?.email]);
  reactExports.useEffect(() => {
    if (!isValidating && !isWhitelisted) {
      navigate("/access-denied");
    }
  }, [isValidating, isWhitelisted]);
  return {
    isWhitelisted,
    isValidating,
    accessDeniedReason,
    revalidate: validateAccess
  };
};

var browser = {};

var canPromise$1 = function() {
  return typeof Promise === "function" && Promise.prototype && Promise.prototype.then;
};

var qrcode = {};

var utils$1 = {};

let toSJISFunction;
const CODEWORDS_COUNT = [
  0, // Not used
  26, 44, 70, 100, 134, 172, 196, 242, 292, 346,
  404, 466, 532, 581, 655, 733, 815, 901, 991, 1085,
  1156, 1258, 1364, 1474, 1588, 1706, 1828, 1921, 2051, 2185,
  2323, 2465, 2611, 2761, 2876, 3034, 3196, 3362, 3532, 3706
];

/**
 * Returns the QR Code size for the specified version
 *
 * @param  {Number} version QR Code version
 * @return {Number}         size of QR code
 */
utils$1.getSymbolSize = function getSymbolSize (version) {
  if (!version) throw new Error('"version" cannot be null or undefined')
  if (version < 1 || version > 40) throw new Error('"version" should be in range from 1 to 40')
  return version * 4 + 17
};

/**
 * Returns the total number of codewords used to store data and EC information.
 *
 * @param  {Number} version QR Code version
 * @return {Number}         Data length in bits
 */
utils$1.getSymbolTotalCodewords = function getSymbolTotalCodewords (version) {
  return CODEWORDS_COUNT[version]
};

/**
 * Encode data with Bose-Chaudhuri-Hocquenghem
 *
 * @param  {Number} data Value to encode
 * @return {Number}      Encoded value
 */
utils$1.getBCHDigit = function (data) {
  let digit = 0;

  while (data !== 0) {
    digit++;
    data >>>= 1;
  }

  return digit
};

utils$1.setToSJISFunction = function setToSJISFunction (f) {
  if (typeof f !== 'function') {
    throw new Error('"toSJISFunc" is not a valid function.')
  }

  toSJISFunction = f;
};

utils$1.isKanjiModeEnabled = function () {
  return typeof toSJISFunction !== 'undefined'
};

utils$1.toSJIS = function toSJIS (kanji) {
  return toSJISFunction(kanji)
};

var errorCorrectionLevel = {};

(function (exports$1) {
	exports$1.L = { bit: 1 };
	exports$1.M = { bit: 0 };
	exports$1.Q = { bit: 3 };
	exports$1.H = { bit: 2 };

	function fromString (string) {
	  if (typeof string !== 'string') {
	    throw new Error('Param is not a string')
	  }

	  const lcStr = string.toLowerCase();

	  switch (lcStr) {
	    case 'l':
	    case 'low':
	      return exports$1.L

	    case 'm':
	    case 'medium':
	      return exports$1.M

	    case 'q':
	    case 'quartile':
	      return exports$1.Q

	    case 'h':
	    case 'high':
	      return exports$1.H

	    default:
	      throw new Error('Unknown EC Level: ' + string)
	  }
	}

	exports$1.isValid = function isValid (level) {
	  return level && typeof level.bit !== 'undefined' &&
	    level.bit >= 0 && level.bit < 4
	};

	exports$1.from = function from (value, defaultValue) {
	  if (exports$1.isValid(value)) {
	    return value
	  }

	  try {
	    return fromString(value)
	  } catch (e) {
	    return defaultValue
	  }
	}; 
} (errorCorrectionLevel));

function BitBuffer$1 () {
  this.buffer = [];
  this.length = 0;
}

BitBuffer$1.prototype = {

  get: function (index) {
    const bufIndex = Math.floor(index / 8);
    return ((this.buffer[bufIndex] >>> (7 - index % 8)) & 1) === 1
  },

  put: function (num, length) {
    for (let i = 0; i < length; i++) {
      this.putBit(((num >>> (length - i - 1)) & 1) === 1);
    }
  },

  getLengthInBits: function () {
    return this.length
  },

  putBit: function (bit) {
    const bufIndex = Math.floor(this.length / 8);
    if (this.buffer.length <= bufIndex) {
      this.buffer.push(0);
    }

    if (bit) {
      this.buffer[bufIndex] |= (0x80 >>> (this.length % 8));
    }

    this.length++;
  }
};

var bitBuffer = BitBuffer$1;

/**
 * Helper class to handle QR Code symbol modules
 *
 * @param {Number} size Symbol size
 */

function BitMatrix$1 (size) {
  if (!size || size < 1) {
    throw new Error('BitMatrix size must be defined and greater than 0')
  }

  this.size = size;
  this.data = new Uint8Array(size * size);
  this.reservedBit = new Uint8Array(size * size);
}

/**
 * Set bit value at specified location
 * If reserved flag is set, this bit will be ignored during masking process
 *
 * @param {Number}  row
 * @param {Number}  col
 * @param {Boolean} value
 * @param {Boolean} reserved
 */
BitMatrix$1.prototype.set = function (row, col, value, reserved) {
  const index = row * this.size + col;
  this.data[index] = value;
  if (reserved) this.reservedBit[index] = true;
};

/**
 * Returns bit value at specified location
 *
 * @param  {Number}  row
 * @param  {Number}  col
 * @return {Boolean}
 */
BitMatrix$1.prototype.get = function (row, col) {
  return this.data[row * this.size + col]
};

/**
 * Applies xor operator at specified location
 * (used during masking process)
 *
 * @param {Number}  row
 * @param {Number}  col
 * @param {Boolean} value
 */
BitMatrix$1.prototype.xor = function (row, col, value) {
  this.data[row * this.size + col] ^= value;
};

/**
 * Check if bit at specified location is reserved
 *
 * @param {Number}   row
 * @param {Number}   col
 * @return {Boolean}
 */
BitMatrix$1.prototype.isReserved = function (row, col) {
  return this.reservedBit[row * this.size + col]
};

var bitMatrix = BitMatrix$1;

var alignmentPattern = {};

/**
 * Alignment pattern are fixed reference pattern in defined positions
 * in a matrix symbology, which enables the decode software to re-synchronise
 * the coordinate mapping of the image modules in the event of moderate amounts
 * of distortion of the image.
 *
 * Alignment patterns are present only in QR Code symbols of version 2 or larger
 * and their number depends on the symbol version.
 */

(function (exports$1) {
	const getSymbolSize = utils$1.getSymbolSize;

	/**
	 * Calculate the row/column coordinates of the center module of each alignment pattern
	 * for the specified QR Code version.
	 *
	 * The alignment patterns are positioned symmetrically on either side of the diagonal
	 * running from the top left corner of the symbol to the bottom right corner.
	 *
	 * Since positions are simmetrical only half of the coordinates are returned.
	 * Each item of the array will represent in turn the x and y coordinate.
	 * @see {@link getPositions}
	 *
	 * @param  {Number} version QR Code version
	 * @return {Array}          Array of coordinate
	 */
	exports$1.getRowColCoords = function getRowColCoords (version) {
	  if (version === 1) return []

	  const posCount = Math.floor(version / 7) + 2;
	  const size = getSymbolSize(version);
	  const intervals = size === 145 ? 26 : Math.ceil((size - 13) / (2 * posCount - 2)) * 2;
	  const positions = [size - 7]; // Last coord is always (size - 7)

	  for (let i = 1; i < posCount - 1; i++) {
	    positions[i] = positions[i - 1] - intervals;
	  }

	  positions.push(6); // First coord is always 6

	  return positions.reverse()
	};

	/**
	 * Returns an array containing the positions of each alignment pattern.
	 * Each array's element represent the center point of the pattern as (x, y) coordinates
	 *
	 * Coordinates are calculated expanding the row/column coordinates returned by {@link getRowColCoords}
	 * and filtering out the items that overlaps with finder pattern
	 *
	 * @example
	 * For a Version 7 symbol {@link getRowColCoords} returns values 6, 22 and 38.
	 * The alignment patterns, therefore, are to be centered on (row, column)
	 * positions (6,22), (22,6), (22,22), (22,38), (38,22), (38,38).
	 * Note that the coordinates (6,6), (6,38), (38,6) are occupied by finder patterns
	 * and are not therefore used for alignment patterns.
	 *
	 * let pos = getPositions(7)
	 * // [[6,22], [22,6], [22,22], [22,38], [38,22], [38,38]]
	 *
	 * @param  {Number} version QR Code version
	 * @return {Array}          Array of coordinates
	 */
	exports$1.getPositions = function getPositions (version) {
	  const coords = [];
	  const pos = exports$1.getRowColCoords(version);
	  const posLength = pos.length;

	  for (let i = 0; i < posLength; i++) {
	    for (let j = 0; j < posLength; j++) {
	      // Skip if position is occupied by finder patterns
	      if ((i === 0 && j === 0) || // top-left
	          (i === 0 && j === posLength - 1) || // bottom-left
	          (i === posLength - 1 && j === 0)) { // top-right
	        continue
	      }

	      coords.push([pos[i], pos[j]]);
	    }
	  }

	  return coords
	}; 
} (alignmentPattern));

var finderPattern = {};

const getSymbolSize = utils$1.getSymbolSize;
const FINDER_PATTERN_SIZE = 7;

/**
 * Returns an array containing the positions of each finder pattern.
 * Each array's element represent the top-left point of the pattern as (x, y) coordinates
 *
 * @param  {Number} version QR Code version
 * @return {Array}          Array of coordinates
 */
finderPattern.getPositions = function getPositions (version) {
  const size = getSymbolSize(version);

  return [
    // top-left
    [0, 0],
    // top-right
    [size - FINDER_PATTERN_SIZE, 0],
    // bottom-left
    [0, size - FINDER_PATTERN_SIZE]
  ]
};

var maskPattern = {};

/**
 * Data mask pattern reference
 * @type {Object}
 */

(function (exports$1) {
	exports$1.Patterns = {
	  PATTERN000: 0,
	  PATTERN001: 1,
	  PATTERN010: 2,
	  PATTERN011: 3,
	  PATTERN100: 4,
	  PATTERN101: 5,
	  PATTERN110: 6,
	  PATTERN111: 7
	};

	/**
	 * Weighted penalty scores for the undesirable features
	 * @type {Object}
	 */
	const PenaltyScores = {
	  N1: 3,
	  N2: 3,
	  N3: 40,
	  N4: 10
	};

	/**
	 * Check if mask pattern value is valid
	 *
	 * @param  {Number}  mask    Mask pattern
	 * @return {Boolean}         true if valid, false otherwise
	 */
	exports$1.isValid = function isValid (mask) {
	  return mask != null && mask !== '' && !isNaN(mask) && mask >= 0 && mask <= 7
	};

	/**
	 * Returns mask pattern from a value.
	 * If value is not valid, returns undefined
	 *
	 * @param  {Number|String} value        Mask pattern value
	 * @return {Number}                     Valid mask pattern or undefined
	 */
	exports$1.from = function from (value) {
	  return exports$1.isValid(value) ? parseInt(value, 10) : undefined
	};

	/**
	* Find adjacent modules in row/column with the same color
	* and assign a penalty value.
	*
	* Points: N1 + i
	* i is the amount by which the number of adjacent modules of the same color exceeds 5
	*/
	exports$1.getPenaltyN1 = function getPenaltyN1 (data) {
	  const size = data.size;
	  let points = 0;
	  let sameCountCol = 0;
	  let sameCountRow = 0;
	  let lastCol = null;
	  let lastRow = null;

	  for (let row = 0; row < size; row++) {
	    sameCountCol = sameCountRow = 0;
	    lastCol = lastRow = null;

	    for (let col = 0; col < size; col++) {
	      let module = data.get(row, col);
	      if (module === lastCol) {
	        sameCountCol++;
	      } else {
	        if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5);
	        lastCol = module;
	        sameCountCol = 1;
	      }

	      module = data.get(col, row);
	      if (module === lastRow) {
	        sameCountRow++;
	      } else {
	        if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5);
	        lastRow = module;
	        sameCountRow = 1;
	      }
	    }

	    if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5);
	    if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5);
	  }

	  return points
	};

	/**
	 * Find 2x2 blocks with the same color and assign a penalty value
	 *
	 * Points: N2 * (m - 1) * (n - 1)
	 */
	exports$1.getPenaltyN2 = function getPenaltyN2 (data) {
	  const size = data.size;
	  let points = 0;

	  for (let row = 0; row < size - 1; row++) {
	    for (let col = 0; col < size - 1; col++) {
	      const last = data.get(row, col) +
	        data.get(row, col + 1) +
	        data.get(row + 1, col) +
	        data.get(row + 1, col + 1);

	      if (last === 4 || last === 0) points++;
	    }
	  }

	  return points * PenaltyScores.N2
	};

	/**
	 * Find 1:1:3:1:1 ratio (dark:light:dark:light:dark) pattern in row/column,
	 * preceded or followed by light area 4 modules wide
	 *
	 * Points: N3 * number of pattern found
	 */
	exports$1.getPenaltyN3 = function getPenaltyN3 (data) {
	  const size = data.size;
	  let points = 0;
	  let bitsCol = 0;
	  let bitsRow = 0;

	  for (let row = 0; row < size; row++) {
	    bitsCol = bitsRow = 0;
	    for (let col = 0; col < size; col++) {
	      bitsCol = ((bitsCol << 1) & 0x7FF) | data.get(row, col);
	      if (col >= 10 && (bitsCol === 0x5D0 || bitsCol === 0x05D)) points++;

	      bitsRow = ((bitsRow << 1) & 0x7FF) | data.get(col, row);
	      if (col >= 10 && (bitsRow === 0x5D0 || bitsRow === 0x05D)) points++;
	    }
	  }

	  return points * PenaltyScores.N3
	};

	/**
	 * Calculate proportion of dark modules in entire symbol
	 *
	 * Points: N4 * k
	 *
	 * k is the rating of the deviation of the proportion of dark modules
	 * in the symbol from 50% in steps of 5%
	 */
	exports$1.getPenaltyN4 = function getPenaltyN4 (data) {
	  let darkCount = 0;
	  const modulesCount = data.data.length;

	  for (let i = 0; i < modulesCount; i++) darkCount += data.data[i];

	  const k = Math.abs(Math.ceil((darkCount * 100 / modulesCount) / 5) - 10);

	  return k * PenaltyScores.N4
	};

	/**
	 * Return mask value at given position
	 *
	 * @param  {Number} maskPattern Pattern reference value
	 * @param  {Number} i           Row
	 * @param  {Number} j           Column
	 * @return {Boolean}            Mask value
	 */
	function getMaskAt (maskPattern, i, j) {
	  switch (maskPattern) {
	    case exports$1.Patterns.PATTERN000: return (i + j) % 2 === 0
	    case exports$1.Patterns.PATTERN001: return i % 2 === 0
	    case exports$1.Patterns.PATTERN010: return j % 3 === 0
	    case exports$1.Patterns.PATTERN011: return (i + j) % 3 === 0
	    case exports$1.Patterns.PATTERN100: return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 === 0
	    case exports$1.Patterns.PATTERN101: return (i * j) % 2 + (i * j) % 3 === 0
	    case exports$1.Patterns.PATTERN110: return ((i * j) % 2 + (i * j) % 3) % 2 === 0
	    case exports$1.Patterns.PATTERN111: return ((i * j) % 3 + (i + j) % 2) % 2 === 0

	    default: throw new Error('bad maskPattern:' + maskPattern)
	  }
	}

	/**
	 * Apply a mask pattern to a BitMatrix
	 *
	 * @param  {Number}    pattern Pattern reference number
	 * @param  {BitMatrix} data    BitMatrix data
	 */
	exports$1.applyMask = function applyMask (pattern, data) {
	  const size = data.size;

	  for (let col = 0; col < size; col++) {
	    for (let row = 0; row < size; row++) {
	      if (data.isReserved(row, col)) continue
	      data.xor(row, col, getMaskAt(pattern, row, col));
	    }
	  }
	};

	/**
	 * Returns the best mask pattern for data
	 *
	 * @param  {BitMatrix} data
	 * @return {Number} Mask pattern reference number
	 */
	exports$1.getBestMask = function getBestMask (data, setupFormatFunc) {
	  const numPatterns = Object.keys(exports$1.Patterns).length;
	  let bestPattern = 0;
	  let lowerPenalty = Infinity;

	  for (let p = 0; p < numPatterns; p++) {
	    setupFormatFunc(p);
	    exports$1.applyMask(p, data);

	    // Calculate penalty
	    const penalty =
	      exports$1.getPenaltyN1(data) +
	      exports$1.getPenaltyN2(data) +
	      exports$1.getPenaltyN3(data) +
	      exports$1.getPenaltyN4(data);

	    // Undo previously applied mask
	    exports$1.applyMask(p, data);

	    if (penalty < lowerPenalty) {
	      lowerPenalty = penalty;
	      bestPattern = p;
	    }
	  }

	  return bestPattern
	}; 
} (maskPattern));

var errorCorrectionCode = {};

const ECLevel$1 = errorCorrectionLevel;

const EC_BLOCKS_TABLE = [
// L  M  Q  H
  1, 1, 1, 1,
  1, 1, 1, 1,
  1, 1, 2, 2,
  1, 2, 2, 4,
  1, 2, 4, 4,
  2, 4, 4, 4,
  2, 4, 6, 5,
  2, 4, 6, 6,
  2, 5, 8, 8,
  4, 5, 8, 8,
  4, 5, 8, 11,
  4, 8, 10, 11,
  4, 9, 12, 16,
  4, 9, 16, 16,
  6, 10, 12, 18,
  6, 10, 17, 16,
  6, 11, 16, 19,
  6, 13, 18, 21,
  7, 14, 21, 25,
  8, 16, 20, 25,
  8, 17, 23, 25,
  9, 17, 23, 34,
  9, 18, 25, 30,
  10, 20, 27, 32,
  12, 21, 29, 35,
  12, 23, 34, 37,
  12, 25, 34, 40,
  13, 26, 35, 42,
  14, 28, 38, 45,
  15, 29, 40, 48,
  16, 31, 43, 51,
  17, 33, 45, 54,
  18, 35, 48, 57,
  19, 37, 51, 60,
  19, 38, 53, 63,
  20, 40, 56, 66,
  21, 43, 59, 70,
  22, 45, 62, 74,
  24, 47, 65, 77,
  25, 49, 68, 81
];

const EC_CODEWORDS_TABLE = [
// L  M  Q  H
  7, 10, 13, 17,
  10, 16, 22, 28,
  15, 26, 36, 44,
  20, 36, 52, 64,
  26, 48, 72, 88,
  36, 64, 96, 112,
  40, 72, 108, 130,
  48, 88, 132, 156,
  60, 110, 160, 192,
  72, 130, 192, 224,
  80, 150, 224, 264,
  96, 176, 260, 308,
  104, 198, 288, 352,
  120, 216, 320, 384,
  132, 240, 360, 432,
  144, 280, 408, 480,
  168, 308, 448, 532,
  180, 338, 504, 588,
  196, 364, 546, 650,
  224, 416, 600, 700,
  224, 442, 644, 750,
  252, 476, 690, 816,
  270, 504, 750, 900,
  300, 560, 810, 960,
  312, 588, 870, 1050,
  336, 644, 952, 1110,
  360, 700, 1020, 1200,
  390, 728, 1050, 1260,
  420, 784, 1140, 1350,
  450, 812, 1200, 1440,
  480, 868, 1290, 1530,
  510, 924, 1350, 1620,
  540, 980, 1440, 1710,
  570, 1036, 1530, 1800,
  570, 1064, 1590, 1890,
  600, 1120, 1680, 1980,
  630, 1204, 1770, 2100,
  660, 1260, 1860, 2220,
  720, 1316, 1950, 2310,
  750, 1372, 2040, 2430
];

/**
 * Returns the number of error correction block that the QR Code should contain
 * for the specified version and error correction level.
 *
 * @param  {Number} version              QR Code version
 * @param  {Number} errorCorrectionLevel Error correction level
 * @return {Number}                      Number of error correction blocks
 */
errorCorrectionCode.getBlocksCount = function getBlocksCount (version, errorCorrectionLevel) {
  switch (errorCorrectionLevel) {
    case ECLevel$1.L:
      return EC_BLOCKS_TABLE[(version - 1) * 4 + 0]
    case ECLevel$1.M:
      return EC_BLOCKS_TABLE[(version - 1) * 4 + 1]
    case ECLevel$1.Q:
      return EC_BLOCKS_TABLE[(version - 1) * 4 + 2]
    case ECLevel$1.H:
      return EC_BLOCKS_TABLE[(version - 1) * 4 + 3]
    default:
      return undefined
  }
};

/**
 * Returns the number of error correction codewords to use for the specified
 * version and error correction level.
 *
 * @param  {Number} version              QR Code version
 * @param  {Number} errorCorrectionLevel Error correction level
 * @return {Number}                      Number of error correction codewords
 */
errorCorrectionCode.getTotalCodewordsCount = function getTotalCodewordsCount (version, errorCorrectionLevel) {
  switch (errorCorrectionLevel) {
    case ECLevel$1.L:
      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 0]
    case ECLevel$1.M:
      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 1]
    case ECLevel$1.Q:
      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 2]
    case ECLevel$1.H:
      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 3]
    default:
      return undefined
  }
};

var polynomial = {};

var galoisField = {};

const EXP_TABLE = new Uint8Array(512);
const LOG_TABLE = new Uint8Array(256)
/**
 * Precompute the log and anti-log tables for faster computation later
 *
 * For each possible value in the galois field 2^8, we will pre-compute
 * the logarithm and anti-logarithm (exponential) of this value
 *
 * ref {@link https://en.wikiversity.org/wiki/Reed%E2%80%93Solomon_codes_for_coders#Introduction_to_mathematical_fields}
 */
;(function initTables () {
  let x = 1;
  for (let i = 0; i < 255; i++) {
    EXP_TABLE[i] = x;
    LOG_TABLE[x] = i;

    x <<= 1; // multiply by 2

    // The QR code specification says to use byte-wise modulo 100011101 arithmetic.
    // This means that when a number is 256 or larger, it should be XORed with 0x11D.
    if (x & 0x100) { // similar to x >= 256, but a lot faster (because 0x100 == 256)
      x ^= 0x11D;
    }
  }

  // Optimization: double the size of the anti-log table so that we don't need to mod 255 to
  // stay inside the bounds (because we will mainly use this table for the multiplication of
  // two GF numbers, no more).
  // @see {@link mul}
  for (let i = 255; i < 512; i++) {
    EXP_TABLE[i] = EXP_TABLE[i - 255];
  }
}());

/**
 * Returns log value of n inside Galois Field
 *
 * @param  {Number} n
 * @return {Number}
 */
galoisField.log = function log (n) {
  if (n < 1) throw new Error('log(' + n + ')')
  return LOG_TABLE[n]
};

/**
 * Returns anti-log value of n inside Galois Field
 *
 * @param  {Number} n
 * @return {Number}
 */
galoisField.exp = function exp (n) {
  return EXP_TABLE[n]
};

/**
 * Multiplies two number inside Galois Field
 *
 * @param  {Number} x
 * @param  {Number} y
 * @return {Number}
 */
galoisField.mul = function mul (x, y) {
  if (x === 0 || y === 0) return 0

  // should be EXP_TABLE[(LOG_TABLE[x] + LOG_TABLE[y]) % 255] if EXP_TABLE wasn't oversized
  // @see {@link initTables}
  return EXP_TABLE[LOG_TABLE[x] + LOG_TABLE[y]]
};

(function (exports$1) {
	const GF = galoisField;

	/**
	 * Multiplies two polynomials inside Galois Field
	 *
	 * @param  {Uint8Array} p1 Polynomial
	 * @param  {Uint8Array} p2 Polynomial
	 * @return {Uint8Array}    Product of p1 and p2
	 */
	exports$1.mul = function mul (p1, p2) {
	  const coeff = new Uint8Array(p1.length + p2.length - 1);

	  for (let i = 0; i < p1.length; i++) {
	    for (let j = 0; j < p2.length; j++) {
	      coeff[i + j] ^= GF.mul(p1[i], p2[j]);
	    }
	  }

	  return coeff
	};

	/**
	 * Calculate the remainder of polynomials division
	 *
	 * @param  {Uint8Array} divident Polynomial
	 * @param  {Uint8Array} divisor  Polynomial
	 * @return {Uint8Array}          Remainder
	 */
	exports$1.mod = function mod (divident, divisor) {
	  let result = new Uint8Array(divident);

	  while ((result.length - divisor.length) >= 0) {
	    const coeff = result[0];

	    for (let i = 0; i < divisor.length; i++) {
	      result[i] ^= GF.mul(divisor[i], coeff);
	    }

	    // remove all zeros from buffer head
	    let offset = 0;
	    while (offset < result.length && result[offset] === 0) offset++;
	    result = result.slice(offset);
	  }

	  return result
	};

	/**
	 * Generate an irreducible generator polynomial of specified degree
	 * (used by Reed-Solomon encoder)
	 *
	 * @param  {Number} degree Degree of the generator polynomial
	 * @return {Uint8Array}    Buffer containing polynomial coefficients
	 */
	exports$1.generateECPolynomial = function generateECPolynomial (degree) {
	  let poly = new Uint8Array([1]);
	  for (let i = 0; i < degree; i++) {
	    poly = exports$1.mul(poly, new Uint8Array([1, GF.exp(i)]));
	  }

	  return poly
	}; 
} (polynomial));

const Polynomial = polynomial;

function ReedSolomonEncoder$1 (degree) {
  this.genPoly = undefined;
  this.degree = degree;

  if (this.degree) this.initialize(this.degree);
}

/**
 * Initialize the encoder.
 * The input param should correspond to the number of error correction codewords.
 *
 * @param  {Number} degree
 */
ReedSolomonEncoder$1.prototype.initialize = function initialize (degree) {
  // create an irreducible generator polynomial
  this.degree = degree;
  this.genPoly = Polynomial.generateECPolynomial(this.degree);
};

/**
 * Encodes a chunk of data
 *
 * @param  {Uint8Array} data Buffer containing input data
 * @return {Uint8Array}      Buffer containing encoded data
 */
ReedSolomonEncoder$1.prototype.encode = function encode (data) {
  if (!this.genPoly) {
    throw new Error('Encoder not initialized')
  }

  // Calculate EC for this data block
  // extends data size to data+genPoly size
  const paddedData = new Uint8Array(data.length + this.degree);
  paddedData.set(data);

  // The error correction codewords are the remainder after dividing the data codewords
  // by a generator polynomial
  const remainder = Polynomial.mod(paddedData, this.genPoly);

  // return EC data blocks (last n byte, where n is the degree of genPoly)
  // If coefficients number in remainder are less than genPoly degree,
  // pad with 0s to the left to reach the needed number of coefficients
  const start = this.degree - remainder.length;
  if (start > 0) {
    const buff = new Uint8Array(this.degree);
    buff.set(remainder, start);

    return buff
  }

  return remainder
};

var reedSolomonEncoder = ReedSolomonEncoder$1;

var version = {};

var mode = {};

var versionCheck = {};

/**
 * Check if QR Code version is valid
 *
 * @param  {Number}  version QR Code version
 * @return {Boolean}         true if valid version, false otherwise
 */

versionCheck.isValid = function isValid (version) {
  return !isNaN(version) && version >= 1 && version <= 40
};

var regex = {};

const numeric = '[0-9]+';
const alphanumeric = '[A-Z $%*+\\-./:]+';
let kanji = '(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|' +
  '[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|' +
  '[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|' +
  '[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+';
kanji = kanji.replace(/u/g, '\\u');

const byte = '(?:(?![A-Z0-9 $%*+\\-./:]|' + kanji + ')(?:.|[\r\n]))+';

regex.KANJI = new RegExp(kanji, 'g');
regex.BYTE_KANJI = new RegExp('[^A-Z0-9 $%*+\\-./:]+', 'g');
regex.BYTE = new RegExp(byte, 'g');
regex.NUMERIC = new RegExp(numeric, 'g');
regex.ALPHANUMERIC = new RegExp(alphanumeric, 'g');

const TEST_KANJI = new RegExp('^' + kanji + '$');
const TEST_NUMERIC = new RegExp('^' + numeric + '$');
const TEST_ALPHANUMERIC = new RegExp('^[A-Z0-9 $%*+\\-./:]+$');

regex.testKanji = function testKanji (str) {
  return TEST_KANJI.test(str)
};

regex.testNumeric = function testNumeric (str) {
  return TEST_NUMERIC.test(str)
};

regex.testAlphanumeric = function testAlphanumeric (str) {
  return TEST_ALPHANUMERIC.test(str)
};

(function (exports$1) {
	const VersionCheck = versionCheck;
	const Regex = regex;

	/**
	 * Numeric mode encodes data from the decimal digit set (0 - 9)
	 * (byte values 30HEX to 39HEX).
	 * Normally, 3 data characters are represented by 10 bits.
	 *
	 * @type {Object}
	 */
	exports$1.NUMERIC = {
	  id: 'Numeric',
	  bit: 1 << 0,
	  ccBits: [10, 12, 14]
	};

	/**
	 * Alphanumeric mode encodes data from a set of 45 characters,
	 * i.e. 10 numeric digits (0 - 9),
	 *      26 alphabetic characters (A - Z),
	 *   and 9 symbols (SP, $, %, *, +, -, ., /, :).
	 * Normally, two input characters are represented by 11 bits.
	 *
	 * @type {Object}
	 */
	exports$1.ALPHANUMERIC = {
	  id: 'Alphanumeric',
	  bit: 1 << 1,
	  ccBits: [9, 11, 13]
	};

	/**
	 * In byte mode, data is encoded at 8 bits per character.
	 *
	 * @type {Object}
	 */
	exports$1.BYTE = {
	  id: 'Byte',
	  bit: 1 << 2,
	  ccBits: [8, 16, 16]
	};

	/**
	 * The Kanji mode efficiently encodes Kanji characters in accordance with
	 * the Shift JIS system based on JIS X 0208.
	 * The Shift JIS values are shifted from the JIS X 0208 values.
	 * JIS X 0208 gives details of the shift coded representation.
	 * Each two-byte character value is compacted to a 13-bit binary codeword.
	 *
	 * @type {Object}
	 */
	exports$1.KANJI = {
	  id: 'Kanji',
	  bit: 1 << 3,
	  ccBits: [8, 10, 12]
	};

	/**
	 * Mixed mode will contain a sequences of data in a combination of any of
	 * the modes described above
	 *
	 * @type {Object}
	 */
	exports$1.MIXED = {
	  bit: -1
	};

	/**
	 * Returns the number of bits needed to store the data length
	 * according to QR Code specifications.
	 *
	 * @param  {Mode}   mode    Data mode
	 * @param  {Number} version QR Code version
	 * @return {Number}         Number of bits
	 */
	exports$1.getCharCountIndicator = function getCharCountIndicator (mode, version) {
	  if (!mode.ccBits) throw new Error('Invalid mode: ' + mode)

	  if (!VersionCheck.isValid(version)) {
	    throw new Error('Invalid version: ' + version)
	  }

	  if (version >= 1 && version < 10) return mode.ccBits[0]
	  else if (version < 27) return mode.ccBits[1]
	  return mode.ccBits[2]
	};

	/**
	 * Returns the most efficient mode to store the specified data
	 *
	 * @param  {String} dataStr Input data string
	 * @return {Mode}           Best mode
	 */
	exports$1.getBestModeForData = function getBestModeForData (dataStr) {
	  if (Regex.testNumeric(dataStr)) return exports$1.NUMERIC
	  else if (Regex.testAlphanumeric(dataStr)) return exports$1.ALPHANUMERIC
	  else if (Regex.testKanji(dataStr)) return exports$1.KANJI
	  else return exports$1.BYTE
	};

	/**
	 * Return mode name as string
	 *
	 * @param {Mode} mode Mode object
	 * @returns {String}  Mode name
	 */
	exports$1.toString = function toString (mode) {
	  if (mode && mode.id) return mode.id
	  throw new Error('Invalid mode')
	};

	/**
	 * Check if input param is a valid mode object
	 *
	 * @param   {Mode}    mode Mode object
	 * @returns {Boolean} True if valid mode, false otherwise
	 */
	exports$1.isValid = function isValid (mode) {
	  return mode && mode.bit && mode.ccBits
	};

	/**
	 * Get mode object from its name
	 *
	 * @param   {String} string Mode name
	 * @returns {Mode}          Mode object
	 */
	function fromString (string) {
	  if (typeof string !== 'string') {
	    throw new Error('Param is not a string')
	  }

	  const lcStr = string.toLowerCase();

	  switch (lcStr) {
	    case 'numeric':
	      return exports$1.NUMERIC
	    case 'alphanumeric':
	      return exports$1.ALPHANUMERIC
	    case 'kanji':
	      return exports$1.KANJI
	    case 'byte':
	      return exports$1.BYTE
	    default:
	      throw new Error('Unknown mode: ' + string)
	  }
	}

	/**
	 * Returns mode from a value.
	 * If value is not a valid mode, returns defaultValue
	 *
	 * @param  {Mode|String} value        Encoding mode
	 * @param  {Mode}        defaultValue Fallback value
	 * @return {Mode}                     Encoding mode
	 */
	exports$1.from = function from (value, defaultValue) {
	  if (exports$1.isValid(value)) {
	    return value
	  }

	  try {
	    return fromString(value)
	  } catch (e) {
	    return defaultValue
	  }
	}; 
} (mode));

(function (exports$1) {
	const Utils = utils$1;
	const ECCode = errorCorrectionCode;
	const ECLevel = errorCorrectionLevel;
	const Mode = mode;
	const VersionCheck = versionCheck;

	// Generator polynomial used to encode version information
	const G18 = (1 << 12) | (1 << 11) | (1 << 10) | (1 << 9) | (1 << 8) | (1 << 5) | (1 << 2) | (1 << 0);
	const G18_BCH = Utils.getBCHDigit(G18);

	function getBestVersionForDataLength (mode, length, errorCorrectionLevel) {
	  for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {
	    if (length <= exports$1.getCapacity(currentVersion, errorCorrectionLevel, mode)) {
	      return currentVersion
	    }
	  }

	  return undefined
	}

	function getReservedBitsCount (mode, version) {
	  // Character count indicator + mode indicator bits
	  return Mode.getCharCountIndicator(mode, version) + 4
	}

	function getTotalBitsFromDataArray (segments, version) {
	  let totalBits = 0;

	  segments.forEach(function (data) {
	    const reservedBits = getReservedBitsCount(data.mode, version);
	    totalBits += reservedBits + data.getBitsLength();
	  });

	  return totalBits
	}

	function getBestVersionForMixedData (segments, errorCorrectionLevel) {
	  for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {
	    const length = getTotalBitsFromDataArray(segments, currentVersion);
	    if (length <= exports$1.getCapacity(currentVersion, errorCorrectionLevel, Mode.MIXED)) {
	      return currentVersion
	    }
	  }

	  return undefined
	}

	/**
	 * Returns version number from a value.
	 * If value is not a valid version, returns defaultValue
	 *
	 * @param  {Number|String} value        QR Code version
	 * @param  {Number}        defaultValue Fallback value
	 * @return {Number}                     QR Code version number
	 */
	exports$1.from = function from (value, defaultValue) {
	  if (VersionCheck.isValid(value)) {
	    return parseInt(value, 10)
	  }

	  return defaultValue
	};

	/**
	 * Returns how much data can be stored with the specified QR code version
	 * and error correction level
	 *
	 * @param  {Number} version              QR Code version (1-40)
	 * @param  {Number} errorCorrectionLevel Error correction level
	 * @param  {Mode}   mode                 Data mode
	 * @return {Number}                      Quantity of storable data
	 */
	exports$1.getCapacity = function getCapacity (version, errorCorrectionLevel, mode) {
	  if (!VersionCheck.isValid(version)) {
	    throw new Error('Invalid QR Code version')
	  }

	  // Use Byte mode as default
	  if (typeof mode === 'undefined') mode = Mode.BYTE;

	  // Total codewords for this QR code version (Data + Error correction)
	  const totalCodewords = Utils.getSymbolTotalCodewords(version);

	  // Total number of error correction codewords
	  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel);

	  // Total number of data codewords
	  const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8;

	  if (mode === Mode.MIXED) return dataTotalCodewordsBits

	  const usableBits = dataTotalCodewordsBits - getReservedBitsCount(mode, version);

	  // Return max number of storable codewords
	  switch (mode) {
	    case Mode.NUMERIC:
	      return Math.floor((usableBits / 10) * 3)

	    case Mode.ALPHANUMERIC:
	      return Math.floor((usableBits / 11) * 2)

	    case Mode.KANJI:
	      return Math.floor(usableBits / 13)

	    case Mode.BYTE:
	    default:
	      return Math.floor(usableBits / 8)
	  }
	};

	/**
	 * Returns the minimum version needed to contain the amount of data
	 *
	 * @param  {Segment} data                    Segment of data
	 * @param  {Number} [errorCorrectionLevel=H] Error correction level
	 * @param  {Mode} mode                       Data mode
	 * @return {Number}                          QR Code version
	 */
	exports$1.getBestVersionForData = function getBestVersionForData (data, errorCorrectionLevel) {
	  let seg;

	  const ecl = ECLevel.from(errorCorrectionLevel, ECLevel.M);

	  if (Array.isArray(data)) {
	    if (data.length > 1) {
	      return getBestVersionForMixedData(data, ecl)
	    }

	    if (data.length === 0) {
	      return 1
	    }

	    seg = data[0];
	  } else {
	    seg = data;
	  }

	  return getBestVersionForDataLength(seg.mode, seg.getLength(), ecl)
	};

	/**
	 * Returns version information with relative error correction bits
	 *
	 * The version information is included in QR Code symbols of version 7 or larger.
	 * It consists of an 18-bit sequence containing 6 data bits,
	 * with 12 error correction bits calculated using the (18, 6) Golay code.
	 *
	 * @param  {Number} version QR Code version
	 * @return {Number}         Encoded version info bits
	 */
	exports$1.getEncodedBits = function getEncodedBits (version) {
	  if (!VersionCheck.isValid(version) || version < 7) {
	    throw new Error('Invalid QR Code version')
	  }

	  let d = version << 12;

	  while (Utils.getBCHDigit(d) - G18_BCH >= 0) {
	    d ^= (G18 << (Utils.getBCHDigit(d) - G18_BCH));
	  }

	  return (version << 12) | d
	}; 
} (version));

var formatInfo = {};

const Utils$3 = utils$1;

const G15 = (1 << 10) | (1 << 8) | (1 << 5) | (1 << 4) | (1 << 2) | (1 << 1) | (1 << 0);
const G15_MASK = (1 << 14) | (1 << 12) | (1 << 10) | (1 << 4) | (1 << 1);
const G15_BCH = Utils$3.getBCHDigit(G15);

/**
 * Returns format information with relative error correction bits
 *
 * The format information is a 15-bit sequence containing 5 data bits,
 * with 10 error correction bits calculated using the (15, 5) BCH code.
 *
 * @param  {Number} errorCorrectionLevel Error correction level
 * @param  {Number} mask                 Mask pattern
 * @return {Number}                      Encoded format information bits
 */
formatInfo.getEncodedBits = function getEncodedBits (errorCorrectionLevel, mask) {
  const data = ((errorCorrectionLevel.bit << 3) | mask);
  let d = data << 10;

  while (Utils$3.getBCHDigit(d) - G15_BCH >= 0) {
    d ^= (G15 << (Utils$3.getBCHDigit(d) - G15_BCH));
  }

  // xor final data with mask pattern in order to ensure that
  // no combination of Error Correction Level and data mask pattern
  // will result in an all-zero data string
  return ((data << 10) | d) ^ G15_MASK
};

var segments = {};

const Mode$4 = mode;

function NumericData (data) {
  this.mode = Mode$4.NUMERIC;
  this.data = data.toString();
}

NumericData.getBitsLength = function getBitsLength (length) {
  return 10 * Math.floor(length / 3) + ((length % 3) ? ((length % 3) * 3 + 1) : 0)
};

NumericData.prototype.getLength = function getLength () {
  return this.data.length
};

NumericData.prototype.getBitsLength = function getBitsLength () {
  return NumericData.getBitsLength(this.data.length)
};

NumericData.prototype.write = function write (bitBuffer) {
  let i, group, value;

  // The input data string is divided into groups of three digits,
  // and each group is converted to its 10-bit binary equivalent.
  for (i = 0; i + 3 <= this.data.length; i += 3) {
    group = this.data.substr(i, 3);
    value = parseInt(group, 10);

    bitBuffer.put(value, 10);
  }

  // If the number of input digits is not an exact multiple of three,
  // the final one or two digits are converted to 4 or 7 bits respectively.
  const remainingNum = this.data.length - i;
  if (remainingNum > 0) {
    group = this.data.substr(i);
    value = parseInt(group, 10);

    bitBuffer.put(value, remainingNum * 3 + 1);
  }
};

var numericData = NumericData;

const Mode$3 = mode;

/**
 * Array of characters available in alphanumeric mode
 *
 * As per QR Code specification, to each character
 * is assigned a value from 0 to 44 which in this case coincides
 * with the array index
 *
 * @type {Array}
 */
const ALPHA_NUM_CHARS = [
  '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
  'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',
  'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',
  ' ', '$', '%', '*', '+', '-', '.', '/', ':'
];

function AlphanumericData (data) {
  this.mode = Mode$3.ALPHANUMERIC;
  this.data = data;
}

AlphanumericData.getBitsLength = function getBitsLength (length) {
  return 11 * Math.floor(length / 2) + 6 * (length % 2)
};

AlphanumericData.prototype.getLength = function getLength () {
  return this.data.length
};

AlphanumericData.prototype.getBitsLength = function getBitsLength () {
  return AlphanumericData.getBitsLength(this.data.length)
};

AlphanumericData.prototype.write = function write (bitBuffer) {
  let i;

  // Input data characters are divided into groups of two characters
  // and encoded as 11-bit binary codes.
  for (i = 0; i + 2 <= this.data.length; i += 2) {
    // The character value of the first character is multiplied by 45
    let value = ALPHA_NUM_CHARS.indexOf(this.data[i]) * 45;

    // The character value of the second digit is added to the product
    value += ALPHA_NUM_CHARS.indexOf(this.data[i + 1]);

    // The sum is then stored as 11-bit binary number
    bitBuffer.put(value, 11);
  }

  // If the number of input data characters is not a multiple of two,
  // the character value of the final character is encoded as a 6-bit binary number.
  if (this.data.length % 2) {
    bitBuffer.put(ALPHA_NUM_CHARS.indexOf(this.data[i]), 6);
  }
};

var alphanumericData = AlphanumericData;

const Mode$2 = mode;

function ByteData (data) {
  this.mode = Mode$2.BYTE;
  if (typeof (data) === 'string') {
    this.data = new TextEncoder().encode(data);
  } else {
    this.data = new Uint8Array(data);
  }
}

ByteData.getBitsLength = function getBitsLength (length) {
  return length * 8
};

ByteData.prototype.getLength = function getLength () {
  return this.data.length
};

ByteData.prototype.getBitsLength = function getBitsLength () {
  return ByteData.getBitsLength(this.data.length)
};

ByteData.prototype.write = function (bitBuffer) {
  for (let i = 0, l = this.data.length; i < l; i++) {
    bitBuffer.put(this.data[i], 8);
  }
};

var byteData = ByteData;

const Mode$1 = mode;
const Utils$2 = utils$1;

function KanjiData (data) {
  this.mode = Mode$1.KANJI;
  this.data = data;
}

KanjiData.getBitsLength = function getBitsLength (length) {
  return length * 13
};

KanjiData.prototype.getLength = function getLength () {
  return this.data.length
};

KanjiData.prototype.getBitsLength = function getBitsLength () {
  return KanjiData.getBitsLength(this.data.length)
};

KanjiData.prototype.write = function (bitBuffer) {
  let i;

  // In the Shift JIS system, Kanji characters are represented by a two byte combination.
  // These byte values are shifted from the JIS X 0208 values.
  // JIS X 0208 gives details of the shift coded representation.
  for (i = 0; i < this.data.length; i++) {
    let value = Utils$2.toSJIS(this.data[i]);

    // For characters with Shift JIS values from 0x8140 to 0x9FFC:
    if (value >= 0x8140 && value <= 0x9FFC) {
      // Subtract 0x8140 from Shift JIS value
      value -= 0x8140;

    // For characters with Shift JIS values from 0xE040 to 0xEBBF
    } else if (value >= 0xE040 && value <= 0xEBBF) {
      // Subtract 0xC140 from Shift JIS value
      value -= 0xC140;
    } else {
      throw new Error(
        'Invalid SJIS character: ' + this.data[i] + '\n' +
        'Make sure your charset is UTF-8')
    }

    // Multiply most significant byte of result by 0xC0
    // and add least significant byte to product
    value = (((value >>> 8) & 0xff) * 0xC0) + (value & 0xff);

    // Convert result to a 13-bit binary string
    bitBuffer.put(value, 13);
  }
};

var kanjiData = KanjiData;

var dijkstra = {exports: {}};

(function (module) {

	/******************************************************************************
	 * Created 2008-08-19.
	 *
	 * Dijkstra path-finding functions. Adapted from the Dijkstar Python project.
	 *
	 * Copyright (C) 2008
	 *   Wyatt Baldwin <self@wyattbaldwin.com>
	 *   All rights reserved
	 *
	 * Licensed under the MIT license.
	 *
	 *   http://www.opensource.org/licenses/mit-license.php
	 *
	 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	 * THE SOFTWARE.
	 *****************************************************************************/
	var dijkstra = {
	  single_source_shortest_paths: function(graph, s, d) {
	    // Predecessor map for each node that has been encountered.
	    // node ID => predecessor node ID
	    var predecessors = {};

	    // Costs of shortest paths from s to all nodes encountered.
	    // node ID => cost
	    var costs = {};
	    costs[s] = 0;

	    // Costs of shortest paths from s to all nodes encountered; differs from
	    // `costs` in that it provides easy access to the node that currently has
	    // the known shortest path from s.
	    // XXX: Do we actually need both `costs` and `open`?
	    var open = dijkstra.PriorityQueue.make();
	    open.push(s, 0);

	    var closest,
	        u, v,
	        cost_of_s_to_u,
	        adjacent_nodes,
	        cost_of_e,
	        cost_of_s_to_u_plus_cost_of_e,
	        cost_of_s_to_v,
	        first_visit;
	    while (!open.empty()) {
	      // In the nodes remaining in graph that have a known cost from s,
	      // find the node, u, that currently has the shortest path from s.
	      closest = open.pop();
	      u = closest.value;
	      cost_of_s_to_u = closest.cost;

	      // Get nodes adjacent to u...
	      adjacent_nodes = graph[u] || {};

	      // ...and explore the edges that connect u to those nodes, updating
	      // the cost of the shortest paths to any or all of those nodes as
	      // necessary. v is the node across the current edge from u.
	      for (v in adjacent_nodes) {
	        if (adjacent_nodes.hasOwnProperty(v)) {
	          // Get the cost of the edge running from u to v.
	          cost_of_e = adjacent_nodes[v];

	          // Cost of s to u plus the cost of u to v across e--this is *a*
	          // cost from s to v that may or may not be less than the current
	          // known cost to v.
	          cost_of_s_to_u_plus_cost_of_e = cost_of_s_to_u + cost_of_e;

	          // If we haven't visited v yet OR if the current known cost from s to
	          // v is greater than the new cost we just found (cost of s to u plus
	          // cost of u to v across e), update v's cost in the cost list and
	          // update v's predecessor in the predecessor list (it's now u).
	          cost_of_s_to_v = costs[v];
	          first_visit = (typeof costs[v] === 'undefined');
	          if (first_visit || cost_of_s_to_v > cost_of_s_to_u_plus_cost_of_e) {
	            costs[v] = cost_of_s_to_u_plus_cost_of_e;
	            open.push(v, cost_of_s_to_u_plus_cost_of_e);
	            predecessors[v] = u;
	          }
	        }
	      }
	    }

	    if (typeof d !== 'undefined' && typeof costs[d] === 'undefined') {
	      var msg = ['Could not find a path from ', s, ' to ', d, '.'].join('');
	      throw new Error(msg);
	    }

	    return predecessors;
	  },

	  extract_shortest_path_from_predecessor_list: function(predecessors, d) {
	    var nodes = [];
	    var u = d;
	    while (u) {
	      nodes.push(u);
	      predecessors[u];
	      u = predecessors[u];
	    }
	    nodes.reverse();
	    return nodes;
	  },

	  find_path: function(graph, s, d) {
	    var predecessors = dijkstra.single_source_shortest_paths(graph, s, d);
	    return dijkstra.extract_shortest_path_from_predecessor_list(
	      predecessors, d);
	  },

	  /**
	   * A very naive priority queue implementation.
	   */
	  PriorityQueue: {
	    make: function (opts) {
	      var T = dijkstra.PriorityQueue,
	          t = {},
	          key;
	      opts = opts || {};
	      for (key in T) {
	        if (T.hasOwnProperty(key)) {
	          t[key] = T[key];
	        }
	      }
	      t.queue = [];
	      t.sorter = opts.sorter || T.default_sorter;
	      return t;
	    },

	    default_sorter: function (a, b) {
	      return a.cost - b.cost;
	    },

	    /**
	     * Add a new item to the queue and ensure the highest priority element
	     * is at the front of the queue.
	     */
	    push: function (value, cost) {
	      var item = {value: value, cost: cost};
	      this.queue.push(item);
	      this.queue.sort(this.sorter);
	    },

	    /**
	     * Return the highest priority element in the queue.
	     */
	    pop: function () {
	      return this.queue.shift();
	    },

	    empty: function () {
	      return this.queue.length === 0;
	    }
	  }
	};


	// node.js module exports
	{
	  module.exports = dijkstra;
	} 
} (dijkstra));

var dijkstraExports = dijkstra.exports;

(function (exports$1) {
	const Mode = mode;
	const NumericData = numericData;
	const AlphanumericData = alphanumericData;
	const ByteData = byteData;
	const KanjiData = kanjiData;
	const Regex = regex;
	const Utils = utils$1;
	const dijkstra = dijkstraExports;

	/**
	 * Returns UTF8 byte length
	 *
	 * @param  {String} str Input string
	 * @return {Number}     Number of byte
	 */
	function getStringByteLength (str) {
	  return unescape(encodeURIComponent(str)).length
	}

	/**
	 * Get a list of segments of the specified mode
	 * from a string
	 *
	 * @param  {Mode}   mode Segment mode
	 * @param  {String} str  String to process
	 * @return {Array}       Array of object with segments data
	 */
	function getSegments (regex, mode, str) {
	  const segments = [];
	  let result;

	  while ((result = regex.exec(str)) !== null) {
	    segments.push({
	      data: result[0],
	      index: result.index,
	      mode: mode,
	      length: result[0].length
	    });
	  }

	  return segments
	}

	/**
	 * Extracts a series of segments with the appropriate
	 * modes from a string
	 *
	 * @param  {String} dataStr Input string
	 * @return {Array}          Array of object with segments data
	 */
	function getSegmentsFromString (dataStr) {
	  const numSegs = getSegments(Regex.NUMERIC, Mode.NUMERIC, dataStr);
	  const alphaNumSegs = getSegments(Regex.ALPHANUMERIC, Mode.ALPHANUMERIC, dataStr);
	  let byteSegs;
	  let kanjiSegs;

	  if (Utils.isKanjiModeEnabled()) {
	    byteSegs = getSegments(Regex.BYTE, Mode.BYTE, dataStr);
	    kanjiSegs = getSegments(Regex.KANJI, Mode.KANJI, dataStr);
	  } else {
	    byteSegs = getSegments(Regex.BYTE_KANJI, Mode.BYTE, dataStr);
	    kanjiSegs = [];
	  }

	  const segs = numSegs.concat(alphaNumSegs, byteSegs, kanjiSegs);

	  return segs
	    .sort(function (s1, s2) {
	      return s1.index - s2.index
	    })
	    .map(function (obj) {
	      return {
	        data: obj.data,
	        mode: obj.mode,
	        length: obj.length
	      }
	    })
	}

	/**
	 * Returns how many bits are needed to encode a string of
	 * specified length with the specified mode
	 *
	 * @param  {Number} length String length
	 * @param  {Mode} mode     Segment mode
	 * @return {Number}        Bit length
	 */
	function getSegmentBitsLength (length, mode) {
	  switch (mode) {
	    case Mode.NUMERIC:
	      return NumericData.getBitsLength(length)
	    case Mode.ALPHANUMERIC:
	      return AlphanumericData.getBitsLength(length)
	    case Mode.KANJI:
	      return KanjiData.getBitsLength(length)
	    case Mode.BYTE:
	      return ByteData.getBitsLength(length)
	  }
	}

	/**
	 * Merges adjacent segments which have the same mode
	 *
	 * @param  {Array} segs Array of object with segments data
	 * @return {Array}      Array of object with segments data
	 */
	function mergeSegments (segs) {
	  return segs.reduce(function (acc, curr) {
	    const prevSeg = acc.length - 1 >= 0 ? acc[acc.length - 1] : null;
	    if (prevSeg && prevSeg.mode === curr.mode) {
	      acc[acc.length - 1].data += curr.data;
	      return acc
	    }

	    acc.push(curr);
	    return acc
	  }, [])
	}

	/**
	 * Generates a list of all possible nodes combination which
	 * will be used to build a segments graph.
	 *
	 * Nodes are divided by groups. Each group will contain a list of all the modes
	 * in which is possible to encode the given text.
	 *
	 * For example the text '12345' can be encoded as Numeric, Alphanumeric or Byte.
	 * The group for '12345' will contain then 3 objects, one for each
	 * possible encoding mode.
	 *
	 * Each node represents a possible segment.
	 *
	 * @param  {Array} segs Array of object with segments data
	 * @return {Array}      Array of object with segments data
	 */
	function buildNodes (segs) {
	  const nodes = [];
	  for (let i = 0; i < segs.length; i++) {
	    const seg = segs[i];

	    switch (seg.mode) {
	      case Mode.NUMERIC:
	        nodes.push([seg,
	          { data: seg.data, mode: Mode.ALPHANUMERIC, length: seg.length },
	          { data: seg.data, mode: Mode.BYTE, length: seg.length }
	        ]);
	        break
	      case Mode.ALPHANUMERIC:
	        nodes.push([seg,
	          { data: seg.data, mode: Mode.BYTE, length: seg.length }
	        ]);
	        break
	      case Mode.KANJI:
	        nodes.push([seg,
	          { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }
	        ]);
	        break
	      case Mode.BYTE:
	        nodes.push([
	          { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }
	        ]);
	    }
	  }

	  return nodes
	}

	/**
	 * Builds a graph from a list of nodes.
	 * All segments in each node group will be connected with all the segments of
	 * the next group and so on.
	 *
	 * At each connection will be assigned a weight depending on the
	 * segment's byte length.
	 *
	 * @param  {Array} nodes    Array of object with segments data
	 * @param  {Number} version QR Code version
	 * @return {Object}         Graph of all possible segments
	 */
	function buildGraph (nodes, version) {
	  const table = {};
	  const graph = { start: {} };
	  let prevNodeIds = ['start'];

	  for (let i = 0; i < nodes.length; i++) {
	    const nodeGroup = nodes[i];
	    const currentNodeIds = [];

	    for (let j = 0; j < nodeGroup.length; j++) {
	      const node = nodeGroup[j];
	      const key = '' + i + j;

	      currentNodeIds.push(key);
	      table[key] = { node: node, lastCount: 0 };
	      graph[key] = {};

	      for (let n = 0; n < prevNodeIds.length; n++) {
	        const prevNodeId = prevNodeIds[n];

	        if (table[prevNodeId] && table[prevNodeId].node.mode === node.mode) {
	          graph[prevNodeId][key] =
	            getSegmentBitsLength(table[prevNodeId].lastCount + node.length, node.mode) -
	            getSegmentBitsLength(table[prevNodeId].lastCount, node.mode);

	          table[prevNodeId].lastCount += node.length;
	        } else {
	          if (table[prevNodeId]) table[prevNodeId].lastCount = node.length;

	          graph[prevNodeId][key] = getSegmentBitsLength(node.length, node.mode) +
	            4 + Mode.getCharCountIndicator(node.mode, version); // switch cost
	        }
	      }
	    }

	    prevNodeIds = currentNodeIds;
	  }

	  for (let n = 0; n < prevNodeIds.length; n++) {
	    graph[prevNodeIds[n]].end = 0;
	  }

	  return { map: graph, table: table }
	}

	/**
	 * Builds a segment from a specified data and mode.
	 * If a mode is not specified, the more suitable will be used.
	 *
	 * @param  {String} data             Input data
	 * @param  {Mode | String} modesHint Data mode
	 * @return {Segment}                 Segment
	 */
	function buildSingleSegment (data, modesHint) {
	  let mode;
	  const bestMode = Mode.getBestModeForData(data);

	  mode = Mode.from(modesHint, bestMode);

	  // Make sure data can be encoded
	  if (mode !== Mode.BYTE && mode.bit < bestMode.bit) {
	    throw new Error('"' + data + '"' +
	      ' cannot be encoded with mode ' + Mode.toString(mode) +
	      '.\n Suggested mode is: ' + Mode.toString(bestMode))
	  }

	  // Use Mode.BYTE if Kanji support is disabled
	  if (mode === Mode.KANJI && !Utils.isKanjiModeEnabled()) {
	    mode = Mode.BYTE;
	  }

	  switch (mode) {
	    case Mode.NUMERIC:
	      return new NumericData(data)

	    case Mode.ALPHANUMERIC:
	      return new AlphanumericData(data)

	    case Mode.KANJI:
	      return new KanjiData(data)

	    case Mode.BYTE:
	      return new ByteData(data)
	  }
	}

	/**
	 * Builds a list of segments from an array.
	 * Array can contain Strings or Objects with segment's info.
	 *
	 * For each item which is a string, will be generated a segment with the given
	 * string and the more appropriate encoding mode.
	 *
	 * For each item which is an object, will be generated a segment with the given
	 * data and mode.
	 * Objects must contain at least the property "data".
	 * If property "mode" is not present, the more suitable mode will be used.
	 *
	 * @param  {Array} array Array of objects with segments data
	 * @return {Array}       Array of Segments
	 */
	exports$1.fromArray = function fromArray (array) {
	  return array.reduce(function (acc, seg) {
	    if (typeof seg === 'string') {
	      acc.push(buildSingleSegment(seg, null));
	    } else if (seg.data) {
	      acc.push(buildSingleSegment(seg.data, seg.mode));
	    }

	    return acc
	  }, [])
	};

	/**
	 * Builds an optimized sequence of segments from a string,
	 * which will produce the shortest possible bitstream.
	 *
	 * @param  {String} data    Input string
	 * @param  {Number} version QR Code version
	 * @return {Array}          Array of segments
	 */
	exports$1.fromString = function fromString (data, version) {
	  const segs = getSegmentsFromString(data, Utils.isKanjiModeEnabled());

	  const nodes = buildNodes(segs);
	  const graph = buildGraph(nodes, version);
	  const path = dijkstra.find_path(graph.map, 'start', 'end');

	  const optimizedSegs = [];
	  for (let i = 1; i < path.length - 1; i++) {
	    optimizedSegs.push(graph.table[path[i]].node);
	  }

	  return exports$1.fromArray(mergeSegments(optimizedSegs))
	};

	/**
	 * Splits a string in various segments with the modes which
	 * best represent their content.
	 * The produced segments are far from being optimized.
	 * The output of this function is only used to estimate a QR Code version
	 * which may contain the data.
	 *
	 * @param  {string} data Input string
	 * @return {Array}       Array of segments
	 */
	exports$1.rawSplit = function rawSplit (data) {
	  return exports$1.fromArray(
	    getSegmentsFromString(data, Utils.isKanjiModeEnabled())
	  )
	}; 
} (segments));

const Utils$1 = utils$1;
const ECLevel = errorCorrectionLevel;
const BitBuffer = bitBuffer;
const BitMatrix = bitMatrix;
const AlignmentPattern = alignmentPattern;
const FinderPattern = finderPattern;
const MaskPattern = maskPattern;
const ECCode = errorCorrectionCode;
const ReedSolomonEncoder = reedSolomonEncoder;
const Version = version;
const FormatInfo = formatInfo;
const Mode = mode;
const Segments = segments;

/**
 * QRCode for JavaScript
 *
 * modified by Ryan Day for nodejs support
 * Copyright (c) 2011 Ryan Day
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
//---------------------------------------------------------------------
// QRCode for JavaScript
//
// Copyright (c) 2009 Kazuhiko Arase
//
// URL: http://www.d-project.com/
//
// Licensed under the MIT license:
//   http://www.opensource.org/licenses/mit-license.php
//
// The word "QR Code" is registered trademark of
// DENSO WAVE INCORPORATED
//   http://www.denso-wave.com/qrcode/faqpatent-e.html
//
//---------------------------------------------------------------------
*/

/**
 * Add finder patterns bits to matrix
 *
 * @param  {BitMatrix} matrix  Modules matrix
 * @param  {Number}    version QR Code version
 */
function setupFinderPattern (matrix, version) {
  const size = matrix.size;
  const pos = FinderPattern.getPositions(version);

  for (let i = 0; i < pos.length; i++) {
    const row = pos[i][0];
    const col = pos[i][1];

    for (let r = -1; r <= 7; r++) {
      if (row + r <= -1 || size <= row + r) continue

      for (let c = -1; c <= 7; c++) {
        if (col + c <= -1 || size <= col + c) continue

        if ((r >= 0 && r <= 6 && (c === 0 || c === 6)) ||
          (c >= 0 && c <= 6 && (r === 0 || r === 6)) ||
          (r >= 2 && r <= 4 && c >= 2 && c <= 4)) {
          matrix.set(row + r, col + c, true, true);
        } else {
          matrix.set(row + r, col + c, false, true);
        }
      }
    }
  }
}

/**
 * Add timing pattern bits to matrix
 *
 * Note: this function must be called before {@link setupAlignmentPattern}
 *
 * @param  {BitMatrix} matrix Modules matrix
 */
function setupTimingPattern (matrix) {
  const size = matrix.size;

  for (let r = 8; r < size - 8; r++) {
    const value = r % 2 === 0;
    matrix.set(r, 6, value, true);
    matrix.set(6, r, value, true);
  }
}

/**
 * Add alignment patterns bits to matrix
 *
 * Note: this function must be called after {@link setupTimingPattern}
 *
 * @param  {BitMatrix} matrix  Modules matrix
 * @param  {Number}    version QR Code version
 */
function setupAlignmentPattern (matrix, version) {
  const pos = AlignmentPattern.getPositions(version);

  for (let i = 0; i < pos.length; i++) {
    const row = pos[i][0];
    const col = pos[i][1];

    for (let r = -2; r <= 2; r++) {
      for (let c = -2; c <= 2; c++) {
        if (r === -2 || r === 2 || c === -2 || c === 2 ||
          (r === 0 && c === 0)) {
          matrix.set(row + r, col + c, true, true);
        } else {
          matrix.set(row + r, col + c, false, true);
        }
      }
    }
  }
}

/**
 * Add version info bits to matrix
 *
 * @param  {BitMatrix} matrix  Modules matrix
 * @param  {Number}    version QR Code version
 */
function setupVersionInfo (matrix, version) {
  const size = matrix.size;
  const bits = Version.getEncodedBits(version);
  let row, col, mod;

  for (let i = 0; i < 18; i++) {
    row = Math.floor(i / 3);
    col = i % 3 + size - 8 - 3;
    mod = ((bits >> i) & 1) === 1;

    matrix.set(row, col, mod, true);
    matrix.set(col, row, mod, true);
  }
}

/**
 * Add format info bits to matrix
 *
 * @param  {BitMatrix} matrix               Modules matrix
 * @param  {ErrorCorrectionLevel}    errorCorrectionLevel Error correction level
 * @param  {Number}    maskPattern          Mask pattern reference value
 */
function setupFormatInfo (matrix, errorCorrectionLevel, maskPattern) {
  const size = matrix.size;
  const bits = FormatInfo.getEncodedBits(errorCorrectionLevel, maskPattern);
  let i, mod;

  for (i = 0; i < 15; i++) {
    mod = ((bits >> i) & 1) === 1;

    // vertical
    if (i < 6) {
      matrix.set(i, 8, mod, true);
    } else if (i < 8) {
      matrix.set(i + 1, 8, mod, true);
    } else {
      matrix.set(size - 15 + i, 8, mod, true);
    }

    // horizontal
    if (i < 8) {
      matrix.set(8, size - i - 1, mod, true);
    } else if (i < 9) {
      matrix.set(8, 15 - i - 1 + 1, mod, true);
    } else {
      matrix.set(8, 15 - i - 1, mod, true);
    }
  }

  // fixed module
  matrix.set(size - 8, 8, 1, true);
}

/**
 * Add encoded data bits to matrix
 *
 * @param  {BitMatrix}  matrix Modules matrix
 * @param  {Uint8Array} data   Data codewords
 */
function setupData (matrix, data) {
  const size = matrix.size;
  let inc = -1;
  let row = size - 1;
  let bitIndex = 7;
  let byteIndex = 0;

  for (let col = size - 1; col > 0; col -= 2) {
    if (col === 6) col--;

    while (true) {
      for (let c = 0; c < 2; c++) {
        if (!matrix.isReserved(row, col - c)) {
          let dark = false;

          if (byteIndex < data.length) {
            dark = (((data[byteIndex] >>> bitIndex) & 1) === 1);
          }

          matrix.set(row, col - c, dark);
          bitIndex--;

          if (bitIndex === -1) {
            byteIndex++;
            bitIndex = 7;
          }
        }
      }

      row += inc;

      if (row < 0 || size <= row) {
        row -= inc;
        inc = -inc;
        break
      }
    }
  }
}

/**
 * Create encoded codewords from data input
 *
 * @param  {Number}   version              QR Code version
 * @param  {ErrorCorrectionLevel}   errorCorrectionLevel Error correction level
 * @param  {ByteData} data                 Data input
 * @return {Uint8Array}                    Buffer containing encoded codewords
 */
function createData (version, errorCorrectionLevel, segments) {
  // Prepare data buffer
  const buffer = new BitBuffer();

  segments.forEach(function (data) {
    // prefix data with mode indicator (4 bits)
    buffer.put(data.mode.bit, 4);

    // Prefix data with character count indicator.
    // The character count indicator is a string of bits that represents the
    // number of characters that are being encoded.
    // The character count indicator must be placed after the mode indicator
    // and must be a certain number of bits long, depending on the QR version
    // and data mode
    // @see {@link Mode.getCharCountIndicator}.
    buffer.put(data.getLength(), Mode.getCharCountIndicator(data.mode, version));

    // add binary data sequence to buffer
    data.write(buffer);
  });

  // Calculate required number of bits
  const totalCodewords = Utils$1.getSymbolTotalCodewords(version);
  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel);
  const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8;

  // Add a terminator.
  // If the bit string is shorter than the total number of required bits,
  // a terminator of up to four 0s must be added to the right side of the string.
  // If the bit string is more than four bits shorter than the required number of bits,
  // add four 0s to the end.
  if (buffer.getLengthInBits() + 4 <= dataTotalCodewordsBits) {
    buffer.put(0, 4);
  }

  // If the bit string is fewer than four bits shorter, add only the number of 0s that
  // are needed to reach the required number of bits.

  // After adding the terminator, if the number of bits in the string is not a multiple of 8,
  // pad the string on the right with 0s to make the string's length a multiple of 8.
  while (buffer.getLengthInBits() % 8 !== 0) {
    buffer.putBit(0);
  }

  // Add pad bytes if the string is still shorter than the total number of required bits.
  // Extend the buffer to fill the data capacity of the symbol corresponding to
  // the Version and Error Correction Level by adding the Pad Codewords 11101100 (0xEC)
  // and 00010001 (0x11) alternately.
  const remainingByte = (dataTotalCodewordsBits - buffer.getLengthInBits()) / 8;
  for (let i = 0; i < remainingByte; i++) {
    buffer.put(i % 2 ? 0x11 : 0xEC, 8);
  }

  return createCodewords(buffer, version, errorCorrectionLevel)
}

/**
 * Encode input data with Reed-Solomon and return codewords with
 * relative error correction bits
 *
 * @param  {BitBuffer} bitBuffer            Data to encode
 * @param  {Number}    version              QR Code version
 * @param  {ErrorCorrectionLevel} errorCorrectionLevel Error correction level
 * @return {Uint8Array}                     Buffer containing encoded codewords
 */
function createCodewords (bitBuffer, version, errorCorrectionLevel) {
  // Total codewords for this QR code version (Data + Error correction)
  const totalCodewords = Utils$1.getSymbolTotalCodewords(version);

  // Total number of error correction codewords
  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel);

  // Total number of data codewords
  const dataTotalCodewords = totalCodewords - ecTotalCodewords;

  // Total number of blocks
  const ecTotalBlocks = ECCode.getBlocksCount(version, errorCorrectionLevel);

  // Calculate how many blocks each group should contain
  const blocksInGroup2 = totalCodewords % ecTotalBlocks;
  const blocksInGroup1 = ecTotalBlocks - blocksInGroup2;

  const totalCodewordsInGroup1 = Math.floor(totalCodewords / ecTotalBlocks);

  const dataCodewordsInGroup1 = Math.floor(dataTotalCodewords / ecTotalBlocks);
  const dataCodewordsInGroup2 = dataCodewordsInGroup1 + 1;

  // Number of EC codewords is the same for both groups
  const ecCount = totalCodewordsInGroup1 - dataCodewordsInGroup1;

  // Initialize a Reed-Solomon encoder with a generator polynomial of degree ecCount
  const rs = new ReedSolomonEncoder(ecCount);

  let offset = 0;
  const dcData = new Array(ecTotalBlocks);
  const ecData = new Array(ecTotalBlocks);
  let maxDataSize = 0;
  const buffer = new Uint8Array(bitBuffer.buffer);

  // Divide the buffer into the required number of blocks
  for (let b = 0; b < ecTotalBlocks; b++) {
    const dataSize = b < blocksInGroup1 ? dataCodewordsInGroup1 : dataCodewordsInGroup2;

    // extract a block of data from buffer
    dcData[b] = buffer.slice(offset, offset + dataSize);

    // Calculate EC codewords for this data block
    ecData[b] = rs.encode(dcData[b]);

    offset += dataSize;
    maxDataSize = Math.max(maxDataSize, dataSize);
  }

  // Create final data
  // Interleave the data and error correction codewords from each block
  const data = new Uint8Array(totalCodewords);
  let index = 0;
  let i, r;

  // Add data codewords
  for (i = 0; i < maxDataSize; i++) {
    for (r = 0; r < ecTotalBlocks; r++) {
      if (i < dcData[r].length) {
        data[index++] = dcData[r][i];
      }
    }
  }

  // Apped EC codewords
  for (i = 0; i < ecCount; i++) {
    for (r = 0; r < ecTotalBlocks; r++) {
      data[index++] = ecData[r][i];
    }
  }

  return data
}

/**
 * Build QR Code symbol
 *
 * @param  {String} data                 Input string
 * @param  {Number} version              QR Code version
 * @param  {ErrorCorretionLevel} errorCorrectionLevel Error level
 * @param  {MaskPattern} maskPattern     Mask pattern
 * @return {Object}                      Object containing symbol data
 */
function createSymbol (data, version, errorCorrectionLevel, maskPattern) {
  let segments;

  if (Array.isArray(data)) {
    segments = Segments.fromArray(data);
  } else if (typeof data === 'string') {
    let estimatedVersion = version;

    if (!estimatedVersion) {
      const rawSegments = Segments.rawSplit(data);

      // Estimate best version that can contain raw splitted segments
      estimatedVersion = Version.getBestVersionForData(rawSegments, errorCorrectionLevel);
    }

    // Build optimized segments
    // If estimated version is undefined, try with the highest version
    segments = Segments.fromString(data, estimatedVersion || 40);
  } else {
    throw new Error('Invalid data')
  }

  // Get the min version that can contain data
  const bestVersion = Version.getBestVersionForData(segments, errorCorrectionLevel);

  // If no version is found, data cannot be stored
  if (!bestVersion) {
    throw new Error('The amount of data is too big to be stored in a QR Code')
  }

  // If not specified, use min version as default
  if (!version) {
    version = bestVersion;

  // Check if the specified version can contain the data
  } else if (version < bestVersion) {
    throw new Error('\n' +
      'The chosen QR Code version cannot contain this amount of data.\n' +
      'Minimum version required to store current data is: ' + bestVersion + '.\n'
    )
  }

  const dataBits = createData(version, errorCorrectionLevel, segments);

  // Allocate matrix buffer
  const moduleCount = Utils$1.getSymbolSize(version);
  const modules = new BitMatrix(moduleCount);

  // Add function modules
  setupFinderPattern(modules, version);
  setupTimingPattern(modules);
  setupAlignmentPattern(modules, version);

  // Add temporary dummy bits for format info just to set them as reserved.
  // This is needed to prevent these bits from being masked by {@link MaskPattern.applyMask}
  // since the masking operation must be performed only on the encoding region.
  // These blocks will be replaced with correct values later in code.
  setupFormatInfo(modules, errorCorrectionLevel, 0);

  if (version >= 7) {
    setupVersionInfo(modules, version);
  }

  // Add data codewords
  setupData(modules, dataBits);

  if (isNaN(maskPattern)) {
    // Find best mask pattern
    maskPattern = MaskPattern.getBestMask(modules,
      setupFormatInfo.bind(null, modules, errorCorrectionLevel));
  }

  // Apply mask pattern
  MaskPattern.applyMask(maskPattern, modules);

  // Replace format info bits with correct values
  setupFormatInfo(modules, errorCorrectionLevel, maskPattern);

  return {
    modules: modules,
    version: version,
    errorCorrectionLevel: errorCorrectionLevel,
    maskPattern: maskPattern,
    segments: segments
  }
}

/**
 * QR Code
 *
 * @param {String | Array} data                 Input data
 * @param {Object} options                      Optional configurations
 * @param {Number} options.version              QR Code version
 * @param {String} options.errorCorrectionLevel Error correction level
 * @param {Function} options.toSJISFunc         Helper func to convert utf8 to sjis
 */
qrcode.create = function create (data, options) {
  if (typeof data === 'undefined' || data === '') {
    throw new Error('No input text')
  }

  let errorCorrectionLevel = ECLevel.M;
  let version;
  let mask;

  if (typeof options !== 'undefined') {
    // Use higher error correction level as default
    errorCorrectionLevel = ECLevel.from(options.errorCorrectionLevel, ECLevel.M);
    version = Version.from(options.version);
    mask = MaskPattern.from(options.maskPattern);

    if (options.toSJISFunc) {
      Utils$1.setToSJISFunction(options.toSJISFunc);
    }
  }

  return createSymbol(data, version, errorCorrectionLevel, mask)
};

var canvas = {};

var utils = {};

(function (exports$1) {
	function hex2rgba (hex) {
	  if (typeof hex === 'number') {
	    hex = hex.toString();
	  }

	  if (typeof hex !== 'string') {
	    throw new Error('Color should be defined as hex string')
	  }

	  let hexCode = hex.slice().replace('#', '').split('');
	  if (hexCode.length < 3 || hexCode.length === 5 || hexCode.length > 8) {
	    throw new Error('Invalid hex color: ' + hex)
	  }

	  // Convert from short to long form (fff -> ffffff)
	  if (hexCode.length === 3 || hexCode.length === 4) {
	    hexCode = Array.prototype.concat.apply([], hexCode.map(function (c) {
	      return [c, c]
	    }));
	  }

	  // Add default alpha value
	  if (hexCode.length === 6) hexCode.push('F', 'F');

	  const hexValue = parseInt(hexCode.join(''), 16);

	  return {
	    r: (hexValue >> 24) & 255,
	    g: (hexValue >> 16) & 255,
	    b: (hexValue >> 8) & 255,
	    a: hexValue & 255,
	    hex: '#' + hexCode.slice(0, 6).join('')
	  }
	}

	exports$1.getOptions = function getOptions (options) {
	  if (!options) options = {};
	  if (!options.color) options.color = {};

	  const margin = typeof options.margin === 'undefined' ||
	    options.margin === null ||
	    options.margin < 0
	    ? 4
	    : options.margin;

	  const width = options.width && options.width >= 21 ? options.width : undefined;
	  const scale = options.scale || 4;

	  return {
	    width: width,
	    scale: width ? 4 : scale,
	    margin: margin,
	    color: {
	      dark: hex2rgba(options.color.dark || '#000000ff'),
	      light: hex2rgba(options.color.light || '#ffffffff')
	    },
	    type: options.type,
	    rendererOpts: options.rendererOpts || {}
	  }
	};

	exports$1.getScale = function getScale (qrSize, opts) {
	  return opts.width && opts.width >= qrSize + opts.margin * 2
	    ? opts.width / (qrSize + opts.margin * 2)
	    : opts.scale
	};

	exports$1.getImageWidth = function getImageWidth (qrSize, opts) {
	  const scale = exports$1.getScale(qrSize, opts);
	  return Math.floor((qrSize + opts.margin * 2) * scale)
	};

	exports$1.qrToImageData = function qrToImageData (imgData, qr, opts) {
	  const size = qr.modules.size;
	  const data = qr.modules.data;
	  const scale = exports$1.getScale(size, opts);
	  const symbolSize = Math.floor((size + opts.margin * 2) * scale);
	  const scaledMargin = opts.margin * scale;
	  const palette = [opts.color.light, opts.color.dark];

	  for (let i = 0; i < symbolSize; i++) {
	    for (let j = 0; j < symbolSize; j++) {
	      let posDst = (i * symbolSize + j) * 4;
	      let pxColor = opts.color.light;

	      if (i >= scaledMargin && j >= scaledMargin &&
	        i < symbolSize - scaledMargin && j < symbolSize - scaledMargin) {
	        const iSrc = Math.floor((i - scaledMargin) / scale);
	        const jSrc = Math.floor((j - scaledMargin) / scale);
	        pxColor = palette[data[iSrc * size + jSrc] ? 1 : 0];
	      }

	      imgData[posDst++] = pxColor.r;
	      imgData[posDst++] = pxColor.g;
	      imgData[posDst++] = pxColor.b;
	      imgData[posDst] = pxColor.a;
	    }
	  }
	}; 
} (utils));

(function (exports$1) {
	const Utils = utils;

	function clearCanvas (ctx, canvas, size) {
	  ctx.clearRect(0, 0, canvas.width, canvas.height);

	  if (!canvas.style) canvas.style = {};
	  canvas.height = size;
	  canvas.width = size;
	  canvas.style.height = size + 'px';
	  canvas.style.width = size + 'px';
	}

	function getCanvasElement () {
	  try {
	    return document.createElement('canvas')
	  } catch (e) {
	    throw new Error('You need to specify a canvas element')
	  }
	}

	exports$1.render = function render (qrData, canvas, options) {
	  let opts = options;
	  let canvasEl = canvas;

	  if (typeof opts === 'undefined' && (!canvas || !canvas.getContext)) {
	    opts = canvas;
	    canvas = undefined;
	  }

	  if (!canvas) {
	    canvasEl = getCanvasElement();
	  }

	  opts = Utils.getOptions(opts);
	  const size = Utils.getImageWidth(qrData.modules.size, opts);

	  const ctx = canvasEl.getContext('2d');
	  const image = ctx.createImageData(size, size);
	  Utils.qrToImageData(image.data, qrData, opts);

	  clearCanvas(ctx, canvasEl, size);
	  ctx.putImageData(image, 0, 0);

	  return canvasEl
	};

	exports$1.renderToDataURL = function renderToDataURL (qrData, canvas, options) {
	  let opts = options;

	  if (typeof opts === 'undefined' && (!canvas || !canvas.getContext)) {
	    opts = canvas;
	    canvas = undefined;
	  }

	  if (!opts) opts = {};

	  const canvasEl = exports$1.render(qrData, canvas, opts);

	  const type = opts.type || 'image/png';
	  const rendererOpts = opts.rendererOpts || {};

	  return canvasEl.toDataURL(type, rendererOpts.quality)
	}; 
} (canvas));

var svgTag = {};

const Utils = utils;

function getColorAttrib (color, attrib) {
  const alpha = color.a / 255;
  const str = attrib + '="' + color.hex + '"';

  return alpha < 1
    ? str + ' ' + attrib + '-opacity="' + alpha.toFixed(2).slice(1) + '"'
    : str
}

function svgCmd (cmd, x, y) {
  let str = cmd + x;
  if (typeof y !== 'undefined') str += ' ' + y;

  return str
}

function qrToPath (data, size, margin) {
  let path = '';
  let moveBy = 0;
  let newRow = false;
  let lineLength = 0;

  for (let i = 0; i < data.length; i++) {
    const col = Math.floor(i % size);
    const row = Math.floor(i / size);

    if (!col && !newRow) newRow = true;

    if (data[i]) {
      lineLength++;

      if (!(i > 0 && col > 0 && data[i - 1])) {
        path += newRow
          ? svgCmd('M', col + margin, 0.5 + row + margin)
          : svgCmd('m', moveBy, 0);

        moveBy = 0;
        newRow = false;
      }

      if (!(col + 1 < size && data[i + 1])) {
        path += svgCmd('h', lineLength);
        lineLength = 0;
      }
    } else {
      moveBy++;
    }
  }

  return path
}

svgTag.render = function render (qrData, options, cb) {
  const opts = Utils.getOptions(options);
  const size = qrData.modules.size;
  const data = qrData.modules.data;
  const qrcodesize = size + opts.margin * 2;

  const bg = !opts.color.light.a
    ? ''
    : '<path ' + getColorAttrib(opts.color.light, 'fill') +
      ' d="M0 0h' + qrcodesize + 'v' + qrcodesize + 'H0z"/>';

  const path =
    '<path ' + getColorAttrib(opts.color.dark, 'stroke') +
    ' d="' + qrToPath(data, size, opts.margin) + '"/>';

  const viewBox = 'viewBox="' + '0 0 ' + qrcodesize + ' ' + qrcodesize + '"';

  const width = !opts.width ? '' : 'width="' + opts.width + '" height="' + opts.width + '" ';

  const svgTag = '<svg xmlns="http://www.w3.org/2000/svg" ' + width + viewBox + ' shape-rendering="crispEdges">' + bg + path + '</svg>\n';

  if (typeof cb === 'function') {
    cb(null, svgTag);
  }

  return svgTag
};

const canPromise = canPromise$1;

const QRCode = qrcode;
const CanvasRenderer = canvas;
const SvgRenderer = svgTag;

function renderCanvas (renderFunc, canvas, text, opts, cb) {
  const args = [].slice.call(arguments, 1);
  const argsNum = args.length;
  const isLastArgCb = typeof args[argsNum - 1] === 'function';

  if (!isLastArgCb && !canPromise()) {
    throw new Error('Callback required as last argument')
  }

  if (isLastArgCb) {
    if (argsNum < 2) {
      throw new Error('Too few arguments provided')
    }

    if (argsNum === 2) {
      cb = text;
      text = canvas;
      canvas = opts = undefined;
    } else if (argsNum === 3) {
      if (canvas.getContext && typeof cb === 'undefined') {
        cb = opts;
        opts = undefined;
      } else {
        cb = opts;
        opts = text;
        text = canvas;
        canvas = undefined;
      }
    }
  } else {
    if (argsNum < 1) {
      throw new Error('Too few arguments provided')
    }

    if (argsNum === 1) {
      text = canvas;
      canvas = opts = undefined;
    } else if (argsNum === 2 && !canvas.getContext) {
      opts = text;
      text = canvas;
      canvas = undefined;
    }

    return new Promise(function (resolve, reject) {
      try {
        const data = QRCode.create(text, opts);
        resolve(renderFunc(data, canvas, opts));
      } catch (e) {
        reject(e);
      }
    })
  }

  try {
    const data = QRCode.create(text, opts);
    cb(null, renderFunc(data, canvas, opts));
  } catch (e) {
    cb(e);
  }
}

browser.create = QRCode.create;
browser.toCanvas = renderCanvas.bind(null, CanvasRenderer.render);
browser.toDataURL = renderCanvas.bind(null, CanvasRenderer.renderToDataURL);

// only svg for now.
browser.toString = renderCanvas.bind(null, function (data, _, opts) {
  return SvgRenderer.render(data, opts)
});

function _typeof(o) {
  "@babel/helpers - typeof";

  return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
    return typeof o;
  } : function (o) {
    return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
  }, _typeof(o);
}

var u8 = Uint8Array, u16 = Uint16Array, i32 = Int32Array;
var fleb = new u8([
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  1,
  1,
  1,
  1,
  2,
  2,
  2,
  2,
  3,
  3,
  3,
  3,
  4,
  4,
  4,
  4,
  5,
  5,
  5,
  5,
  0,
  /* unused */
  0,
  0,
  /* impossible */
  0
]);
var fdeb = new u8([
  0,
  0,
  0,
  0,
  1,
  1,
  2,
  2,
  3,
  3,
  4,
  4,
  5,
  5,
  6,
  6,
  7,
  7,
  8,
  8,
  9,
  9,
  10,
  10,
  11,
  11,
  12,
  12,
  13,
  13,
  /* unused */
  0,
  0
]);
var clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);
var freb = function(eb, start) {
  var b = new u16(31);
  for (var i = 0; i < 31; ++i) {
    b[i] = start += 1 << eb[i - 1];
  }
  var r = new i32(b[30]);
  for (var i = 1; i < 30; ++i) {
    for (var j = b[i]; j < b[i + 1]; ++j) {
      r[j] = j - b[i] << 5 | i;
    }
  }
  return { b, r };
};
var _a = freb(fleb, 2), fl = _a.b, revfl = _a.r;
fl[28] = 258, revfl[258] = 28;
var _b = freb(fdeb, 0), revfd = _b.r;
var rev = new u16(32768);
for (var i$1 = 0; i$1 < 32768; ++i$1) {
  var x$1 = (i$1 & 43690) >> 1 | (i$1 & 21845) << 1;
  x$1 = (x$1 & 52428) >> 2 | (x$1 & 13107) << 2;
  x$1 = (x$1 & 61680) >> 4 | (x$1 & 3855) << 4;
  rev[i$1] = ((x$1 & 65280) >> 8 | (x$1 & 255) << 8) >> 1;
}
var hMap = function(cd, mb, r) {
  var s = cd.length;
  var i = 0;
  var l = new u16(mb);
  for (; i < s; ++i) {
    if (cd[i])
      ++l[cd[i] - 1];
  }
  var le = new u16(mb);
  for (i = 1; i < mb; ++i) {
    le[i] = le[i - 1] + l[i - 1] << 1;
  }
  var co;
  if (r) {
    co = new u16(1 << mb);
    var rvb = 15 - mb;
    for (i = 0; i < s; ++i) {
      if (cd[i]) {
        var sv = i << 4 | cd[i];
        var r_1 = mb - cd[i];
        var v = le[cd[i] - 1]++ << r_1;
        for (var m = v | (1 << r_1) - 1; v <= m; ++v) {
          co[rev[v] >> rvb] = sv;
        }
      }
    }
  } else {
    co = new u16(s);
    for (i = 0; i < s; ++i) {
      if (cd[i]) {
        co[i] = rev[le[cd[i] - 1]++] >> 15 - cd[i];
      }
    }
  }
  return co;
};
var flt = new u8(288);
for (var i$1 = 0; i$1 < 144; ++i$1)
  flt[i$1] = 8;
for (var i$1 = 144; i$1 < 256; ++i$1)
  flt[i$1] = 9;
for (var i$1 = 256; i$1 < 280; ++i$1)
  flt[i$1] = 7;
for (var i$1 = 280; i$1 < 288; ++i$1)
  flt[i$1] = 8;
var fdt = new u8(32);
for (var i$1 = 0; i$1 < 32; ++i$1)
  fdt[i$1] = 5;
var flm = /* @__PURE__ */ hMap(flt, 9, 0);
var fdm = /* @__PURE__ */ hMap(fdt, 5, 0);
var shft = function(p) {
  return (p + 7) / 8 | 0;
};
var slc = function(v, s, e) {
  if (e == null || e > v.length)
    e = v.length;
  return new u8(v.subarray(s, e));
};
var wbits = function(d, p, v) {
  v <<= p & 7;
  var o = p / 8 | 0;
  d[o] |= v;
  d[o + 1] |= v >> 8;
};
var wbits16 = function(d, p, v) {
  v <<= p & 7;
  var o = p / 8 | 0;
  d[o] |= v;
  d[o + 1] |= v >> 8;
  d[o + 2] |= v >> 16;
};
var hTree = function(d, mb) {
  var t = [];
  for (var i = 0; i < d.length; ++i) {
    if (d[i])
      t.push({ s: i, f: d[i] });
  }
  var s = t.length;
  var t2 = t.slice();
  if (!s)
    return { t: et$1, l: 0 };
  if (s == 1) {
    var v = new u8(t[0].s + 1);
    v[t[0].s] = 1;
    return { t: v, l: 1 };
  }
  t.sort(function(a, b) {
    return a.f - b.f;
  });
  t.push({ s: -1, f: 25001 });
  var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;
  t[0] = { s: -1, f: l.f + r.f, l, r };
  while (i1 != s - 1) {
    l = t[t[i0].f < t[i2].f ? i0++ : i2++];
    r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];
    t[i1++] = { s: -1, f: l.f + r.f, l, r };
  }
  var maxSym = t2[0].s;
  for (var i = 1; i < s; ++i) {
    if (t2[i].s > maxSym)
      maxSym = t2[i].s;
  }
  var tr = new u16(maxSym + 1);
  var mbt = ln(t[i1 - 1], tr, 0);
  if (mbt > mb) {
    var i = 0, dt = 0;
    var lft = mbt - mb, cst = 1 << lft;
    t2.sort(function(a, b) {
      return tr[b.s] - tr[a.s] || a.f - b.f;
    });
    for (; i < s; ++i) {
      var i2_1 = t2[i].s;
      if (tr[i2_1] > mb) {
        dt += cst - (1 << mbt - tr[i2_1]);
        tr[i2_1] = mb;
      } else
        break;
    }
    dt >>= lft;
    while (dt > 0) {
      var i2_2 = t2[i].s;
      if (tr[i2_2] < mb)
        dt -= 1 << mb - tr[i2_2]++ - 1;
      else
        ++i;
    }
    for (; i >= 0 && dt; --i) {
      var i2_3 = t2[i].s;
      if (tr[i2_3] == mb) {
        --tr[i2_3];
        ++dt;
      }
    }
    mbt = mb;
  }
  return { t: new u8(tr), l: mbt };
};
var ln = function(n, l, d) {
  return n.s == -1 ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1)) : l[n.s] = d;
};
var lc = function(c) {
  var s = c.length;
  while (s && !c[--s])
    ;
  var cl = new u16(++s);
  var cli = 0, cln = c[0], cls = 1;
  var w = function(v) {
    cl[cli++] = v;
  };
  for (var i = 1; i <= s; ++i) {
    if (c[i] == cln && i != s)
      ++cls;
    else {
      if (!cln && cls > 2) {
        for (; cls > 138; cls -= 138)
          w(32754);
        if (cls > 2) {
          w(cls > 10 ? cls - 11 << 5 | 28690 : cls - 3 << 5 | 12305);
          cls = 0;
        }
      } else if (cls > 3) {
        w(cln), --cls;
        for (; cls > 6; cls -= 6)
          w(8304);
        if (cls > 2)
          w(cls - 3 << 5 | 8208), cls = 0;
      }
      while (cls--)
        w(cln);
      cls = 1;
      cln = c[i];
    }
  }
  return { c: cl.subarray(0, cli), n: s };
};
var clen = function(cf, cl) {
  var l = 0;
  for (var i = 0; i < cl.length; ++i)
    l += cf[i] * cl[i];
  return l;
};
var wfblk = function(out, pos, dat) {
  var s = dat.length;
  var o = shft(pos + 2);
  out[o] = s & 255;
  out[o + 1] = s >> 8;
  out[o + 2] = out[o] ^ 255;
  out[o + 3] = out[o + 1] ^ 255;
  for (var i = 0; i < s; ++i)
    out[o + i + 4] = dat[i];
  return (o + 4 + s) * 8;
};
var wblk = function(dat, out, final, syms, lf, df, eb, li, bs, bl, p) {
  wbits(out, p++, final);
  ++lf[256];
  var _a2 = hTree(lf, 15), dlt = _a2.t, mlb = _a2.l;
  var _b2 = hTree(df, 15), ddt = _b2.t, mdb = _b2.l;
  var _c = lc(dlt), lclt = _c.c, nlc = _c.n;
  var _d = lc(ddt), lcdt = _d.c, ndc = _d.n;
  var lcfreq = new u16(19);
  for (var i = 0; i < lclt.length; ++i)
    ++lcfreq[lclt[i] & 31];
  for (var i = 0; i < lcdt.length; ++i)
    ++lcfreq[lcdt[i] & 31];
  var _e = hTree(lcfreq, 7), lct = _e.t, mlcb = _e.l;
  var nlcc = 19;
  for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)
    ;
  var flen = bl + 5 << 3;
  var ftlen = clen(lf, flt) + clen(df, fdt) + eb;
  var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + 2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18];
  if (bs >= 0 && flen <= ftlen && flen <= dtlen)
    return wfblk(out, p, dat.subarray(bs, bs + bl));
  var lm, ll, dm, dl;
  wbits(out, p, 1 + (dtlen < ftlen)), p += 2;
  if (dtlen < ftlen) {
    lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;
    var llm = hMap(lct, mlcb, 0);
    wbits(out, p, nlc - 257);
    wbits(out, p + 5, ndc - 1);
    wbits(out, p + 10, nlcc - 4);
    p += 14;
    for (var i = 0; i < nlcc; ++i)
      wbits(out, p + 3 * i, lct[clim[i]]);
    p += 3 * nlcc;
    var lcts = [lclt, lcdt];
    for (var it = 0; it < 2; ++it) {
      var clct = lcts[it];
      for (var i = 0; i < clct.length; ++i) {
        var len = clct[i] & 31;
        wbits(out, p, llm[len]), p += lct[len];
        if (len > 15)
          wbits(out, p, clct[i] >> 5 & 127), p += clct[i] >> 12;
      }
    }
  } else {
    lm = flm, ll = flt, dm = fdm, dl = fdt;
  }
  for (var i = 0; i < li; ++i) {
    var sym = syms[i];
    if (sym > 255) {
      var len = sym >> 18 & 31;
      wbits16(out, p, lm[len + 257]), p += ll[len + 257];
      if (len > 7)
        wbits(out, p, sym >> 23 & 31), p += fleb[len];
      var dst = sym & 31;
      wbits16(out, p, dm[dst]), p += dl[dst];
      if (dst > 3)
        wbits16(out, p, sym >> 5 & 8191), p += fdeb[dst];
    } else {
      wbits16(out, p, lm[sym]), p += ll[sym];
    }
  }
  wbits16(out, p, lm[256]);
  return p + ll[256];
};
var deo = /* @__PURE__ */ new i32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);
var et$1 = /* @__PURE__ */ new u8(0);
var dflt = function(dat, lvl, plvl, pre, post, st) {
  var s = st.z || dat.length;
  var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7e3)) + post);
  var w = o.subarray(pre, o.length - post);
  var lst = st.l;
  var pos = (st.r || 0) & 7;
  if (lvl) {
    if (pos)
      w[0] = st.r >> 3;
    var opt = deo[lvl - 1];
    var n = opt >> 13, c = opt & 8191;
    var msk_1 = (1 << plvl) - 1;
    var prev = st.p || new u16(32768), head = st.h || new u16(msk_1 + 1);
    var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;
    var hsh = function(i2) {
      return (dat[i2] ^ dat[i2 + 1] << bs1_1 ^ dat[i2 + 2] << bs2_1) & msk_1;
    };
    var syms = new i32(25e3);
    var lf = new u16(288), df = new u16(32);
    var lc_1 = 0, eb = 0, i = st.i || 0, li = 0, wi = st.w || 0, bs = 0;
    for (; i + 2 < s; ++i) {
      var hv = hsh(i);
      var imod = i & 32767, pimod = head[hv];
      prev[imod] = pimod;
      head[hv] = imod;
      if (wi <= i) {
        var rem = s - i;
        if ((lc_1 > 7e3 || li > 24576) && (rem > 423 || !lst)) {
          pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);
          li = lc_1 = eb = 0, bs = i;
          for (var j = 0; j < 286; ++j)
            lf[j] = 0;
          for (var j = 0; j < 30; ++j)
            df[j] = 0;
        }
        var l = 2, d = 0, ch_1 = c, dif = imod - pimod & 32767;
        if (rem > 2 && hv == hsh(i - dif)) {
          var maxn = Math.min(n, rem) - 1;
          var maxd = Math.min(32767, i);
          var ml = Math.min(258, rem);
          while (dif <= maxd && --ch_1 && imod != pimod) {
            if (dat[i + l] == dat[i + l - dif]) {
              var nl = 0;
              for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)
                ;
              if (nl > l) {
                l = nl, d = dif;
                if (nl > maxn)
                  break;
                var mmd = Math.min(dif, nl - 2);
                var md = 0;
                for (var j = 0; j < mmd; ++j) {
                  var ti = i - dif + j & 32767;
                  var pti = prev[ti];
                  var cd = ti - pti & 32767;
                  if (cd > md)
                    md = cd, pimod = ti;
                }
              }
            }
            imod = pimod, pimod = prev[imod];
            dif += imod - pimod & 32767;
          }
        }
        if (d) {
          syms[li++] = 268435456 | revfl[l] << 18 | revfd[d];
          var lin = revfl[l] & 31, din = revfd[d] & 31;
          eb += fleb[lin] + fdeb[din];
          ++lf[257 + lin];
          ++df[din];
          wi = i + l;
          ++lc_1;
        } else {
          syms[li++] = dat[i];
          ++lf[dat[i]];
        }
      }
    }
    for (i = Math.max(i, wi); i < s; ++i) {
      syms[li++] = dat[i];
      ++lf[dat[i]];
    }
    pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);
    if (!lst) {
      st.r = pos & 7 | w[pos / 8 | 0] << 3;
      pos -= 7;
      st.h = head, st.p = prev, st.i = i, st.w = wi;
    }
  } else {
    for (var i = st.w || 0; i < s + lst; i += 65535) {
      var e = i + 65535;
      if (e >= s) {
        w[pos / 8 | 0] = lst;
        e = s;
      }
      pos = wfblk(w, pos + 1, dat.subarray(i, e));
    }
    st.i = s;
  }
  return slc(o, 0, pre + shft(pos) + post);
};
var adler = function() {
  var a = 1, b = 0;
  return {
    p: function(d) {
      var n = a, m = b;
      var l = d.length | 0;
      for (var i = 0; i != l; ) {
        var e = Math.min(i + 2655, l);
        for (; i < e; ++i)
          m += n += d[i];
        n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);
      }
      a = n, b = m;
    },
    d: function() {
      a %= 65521, b %= 65521;
      return (a & 255) << 24 | (a & 65280) << 8 | (b & 255) << 8 | b >> 8;
    }
  };
};
var dopt = function(dat, opt, pre, post, st) {
  if (!st) {
    st = { l: 1 };
    if (opt.dictionary) {
      var dict = opt.dictionary.subarray(-32768);
      var newDat = new u8(dict.length + dat.length);
      newDat.set(dict);
      newDat.set(dat, dict.length);
      dat = newDat;
      st.w = dict.length;
    }
  }
  return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? st.l ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : 20 : 12 + opt.mem, pre, post, st);
};
var wbytes = function(d, b, v) {
  for (; v; ++b)
    d[b] = v, v >>>= 8;
};
var zlh = function(c, o) {
  var lv = o.level, fl2 = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;
  c[0] = 120, c[1] = fl2 << 6 | (o.dictionary && 32);
  c[1] |= 31 - (c[0] << 8 | c[1]) % 31;
  if (o.dictionary) {
    var h = adler();
    h.p(o.dictionary);
    wbytes(c, 2, h.d());
  }
};
function zlibSync(data, opts) {
  if (!opts)
    opts = {};
  var a = adler();
  a.p(data);
  var d = dopt(data, opts, opts.dictionary ? 6 : 2, 4);
  return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;
}
var td = typeof TextDecoder != "undefined" && /* @__PURE__ */ new TextDecoder();
var tds = 0;
try {
  td.decode(et$1, { stream: true });
  tds = 1;
} catch (e) {
}

function _arrayWithHoles(r) {
  if (Array.isArray(r)) return r;
}

function _iterableToArrayLimit(r, l) {
  var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"];
  if (null != t) {
    var e,
      n,
      i,
      u,
      a = [],
      f = true,
      o = false;
    try {
      if (i = (t = t.call(r)).next, 0 === l) ; else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);
    } catch (r) {
      o = true, n = r;
    } finally {
      try {
        if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return;
      } finally {
        if (o) throw n;
      }
    }
    return a;
  }
}

function _arrayLikeToArray(r, a) {
  (null == a || a > r.length) && (a = r.length);
  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];
  return n;
}

function _unsupportedIterableToArray(r, a) {
  if (r) {
    if ("string" == typeof r) return _arrayLikeToArray(r, a);
    var t = {}.toString.call(r).slice(8, -1);
    return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;
  }
}

function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

function _slicedToArray(r, e) {
  return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest();
}

function decode(bytes, encoding = 'utf8') {
    const decoder = new TextDecoder(encoding);
    return decoder.decode(bytes);
}
const encoder = new TextEncoder();
function encode(str) {
    return encoder.encode(str);
}

const defaultByteLength = 1024 * 8;
const hostBigEndian = (() => {
  const array = new Uint8Array(4);
  const view = new Uint32Array(array.buffer);
  return !((view[0] = 1) & array[0]);
})();
const typedArrays = {
  int8: globalThis.Int8Array,
  uint8: globalThis.Uint8Array,
  int16: globalThis.Int16Array,
  uint16: globalThis.Uint16Array,
  int32: globalThis.Int32Array,
  uint32: globalThis.Uint32Array,
  uint64: globalThis.BigUint64Array,
  int64: globalThis.BigInt64Array,
  float32: globalThis.Float32Array,
  float64: globalThis.Float64Array
};
class IOBuffer {
  /**
   * Reference to the internal ArrayBuffer object.
   */
  buffer;
  /**
   * Byte length of the internal ArrayBuffer.
   */
  byteLength;
  /**
   * Byte offset of the internal ArrayBuffer.
   */
  byteOffset;
  /**
   * Byte length of the internal ArrayBuffer.
   */
  length;
  /**
   * The current offset of the buffer's pointer.
   */
  offset;
  lastWrittenByte;
  littleEndian;
  _data;
  _mark;
  _marks;
  /**
   * Create a new IOBuffer.
   * @param data - The data to construct the IOBuffer with.
   * If data is a number, it will be the new buffer's length<br>
   * If data is `undefined`, the buffer will be initialized with a default length of 8Kb<br>
   * If data is an ArrayBuffer, SharedArrayBuffer, an ArrayBufferView (Typed Array), an IOBuffer instance,
   * or a Node.js Buffer, a view will be created over the underlying ArrayBuffer.
   * @param options - An object for the options.
   * @returns A new IOBuffer instance.
   */
  constructor(data = defaultByteLength, options = {}) {
    let dataIsGiven = false;
    if (typeof data === "number") {
      data = new ArrayBuffer(data);
    } else {
      dataIsGiven = true;
      this.lastWrittenByte = data.byteLength;
    }
    const offset = options.offset ? options.offset >>> 0 : 0;
    const byteLength = data.byteLength - offset;
    let dvOffset = offset;
    if (ArrayBuffer.isView(data) || data instanceof IOBuffer) {
      if (data.byteLength !== data.buffer.byteLength) {
        dvOffset = data.byteOffset + offset;
      }
      data = data.buffer;
    }
    if (dataIsGiven) {
      this.lastWrittenByte = byteLength;
    } else {
      this.lastWrittenByte = 0;
    }
    this.buffer = data;
    this.length = byteLength;
    this.byteLength = byteLength;
    this.byteOffset = dvOffset;
    this.offset = 0;
    this.littleEndian = true;
    this._data = new DataView(this.buffer, dvOffset, byteLength);
    this._mark = 0;
    this._marks = [];
  }
  /**
   * Checks if the memory allocated to the buffer is sufficient to store more
   * bytes after the offset.
   * @param byteLength - The needed memory in bytes.
   * @returns `true` if there is sufficient space and `false` otherwise.
   */
  available(byteLength = 1) {
    return this.offset + byteLength <= this.length;
  }
  /**
   * Check if little-endian mode is used for reading and writing multi-byte
   * values.
   * @returns `true` if little-endian mode is used, `false` otherwise.
   */
  isLittleEndian() {
    return this.littleEndian;
  }
  /**
   * Set little-endian mode for reading and writing multi-byte values.
   * @returns This.
   */
  setLittleEndian() {
    this.littleEndian = true;
    return this;
  }
  /**
   * Check if big-endian mode is used for reading and writing multi-byte values.
   * @returns `true` if big-endian mode is used, `false` otherwise.
   */
  isBigEndian() {
    return !this.littleEndian;
  }
  /**
   * Switches to big-endian mode for reading and writing multi-byte values.
   * @returns This.
   */
  setBigEndian() {
    this.littleEndian = false;
    return this;
  }
  /**
   * Move the pointer n bytes forward.
   * @param n - Number of bytes to skip.
   * @returns This.
   */
  skip(n = 1) {
    this.offset += n;
    return this;
  }
  /**
   * Move the pointer n bytes backward.
   * @param n - Number of bytes to move back.
   * @returns This.
   */
  back(n = 1) {
    this.offset -= n;
    return this;
  }
  /**
   * Move the pointer to the given offset.
   * @param offset - The offset to move to.
   * @returns This.
   */
  seek(offset) {
    this.offset = offset;
    return this;
  }
  /**
   * Store the current pointer offset.
   * @see {@link IOBuffer#reset}
   * @returns This.
   */
  mark() {
    this._mark = this.offset;
    return this;
  }
  /**
   * Move the pointer back to the last pointer offset set by mark.
   * @see {@link IOBuffer#mark}
   * @returns This.
   */
  reset() {
    this.offset = this._mark;
    return this;
  }
  /**
   * Push the current pointer offset to the mark stack.
   * @see {@link IOBuffer#popMark}
   * @returns This.
   */
  pushMark() {
    this._marks.push(this.offset);
    return this;
  }
  /**
   * Pop the last pointer offset from the mark stack, and set the current
   * pointer offset to the popped value.
   * @see {@link IOBuffer#pushMark}
   * @returns This.
   */
  popMark() {
    const offset = this._marks.pop();
    if (offset === void 0) {
      throw new Error("Mark stack empty");
    }
    this.seek(offset);
    return this;
  }
  /**
   * Move the pointer offset back to 0.
   * @returns This.
   */
  rewind() {
    this.offset = 0;
    return this;
  }
  /**
   * Make sure the buffer has sufficient memory to write a given byteLength at
   * the current pointer offset.
   * If the buffer's memory is insufficient, this method will create a new
   * buffer (a copy) with a length that is twice (byteLength + current offset).
   * @param byteLength - The needed memory in bytes.
   * @returns This.
   */
  ensureAvailable(byteLength = 1) {
    if (!this.available(byteLength)) {
      const lengthNeeded = this.offset + byteLength;
      const newLength = lengthNeeded * 2;
      const newArray = new Uint8Array(newLength);
      newArray.set(new Uint8Array(this.buffer));
      this.buffer = newArray.buffer;
      this.length = newLength;
      this.byteLength = newLength;
      this._data = new DataView(this.buffer);
    }
    return this;
  }
  /**
   * Read a byte and return false if the byte's value is 0, or true otherwise.
   * Moves pointer forward by one byte.
   * @returns The read boolean.
   */
  readBoolean() {
    return this.readUint8() !== 0;
  }
  /**
   * Read a signed 8-bit integer and move pointer forward by 1 byte.
   * @returns The read byte.
   */
  readInt8() {
    return this._data.getInt8(this.offset++);
  }
  /**
   * Read an unsigned 8-bit integer and move pointer forward by 1 byte.
   * @returns The read byte.
   */
  readUint8() {
    return this._data.getUint8(this.offset++);
  }
  /**
   * Alias for {@link IOBuffer#readUint8}.
   * @returns The read byte.
   */
  readByte() {
    return this.readUint8();
  }
  /**
   * Read `n` bytes and move pointer forward by `n` bytes.
   * @param n - Number of bytes to read.
   * @returns The read bytes.
   */
  readBytes(n = 1) {
    return this.readArray(n, "uint8");
  }
  /**
   * Creates an array of corresponding to the type `type` and size `size`.
   * For example type `uint8` will create a `Uint8Array`.
   * @param size - size of the resulting array
   * @param type - number type of elements to read
   * @returns The read array.
   */
  readArray(size, type) {
    const bytes = typedArrays[type].BYTES_PER_ELEMENT * size;
    const offset = this.byteOffset + this.offset;
    const slice = this.buffer.slice(offset, offset + bytes);
    if (this.littleEndian === hostBigEndian && type !== "uint8" && type !== "int8") {
      const slice2 = new Uint8Array(this.buffer.slice(offset, offset + bytes));
      slice2.reverse();
      const returnArray2 = new typedArrays[type](slice2.buffer);
      this.offset += bytes;
      returnArray2.reverse();
      return returnArray2;
    }
    const returnArray = new typedArrays[type](slice);
    this.offset += bytes;
    return returnArray;
  }
  /**
   * Read a 16-bit signed integer and move pointer forward by 2 bytes.
   * @returns The read value.
   */
  readInt16() {
    const value = this._data.getInt16(this.offset, this.littleEndian);
    this.offset += 2;
    return value;
  }
  /**
   * Read a 16-bit unsigned integer and move pointer forward by 2 bytes.
   * @returns The read value.
   */
  readUint16() {
    const value = this._data.getUint16(this.offset, this.littleEndian);
    this.offset += 2;
    return value;
  }
  /**
   * Read a 32-bit signed integer and move pointer forward by 4 bytes.
   * @returns The read value.
   */
  readInt32() {
    const value = this._data.getInt32(this.offset, this.littleEndian);
    this.offset += 4;
    return value;
  }
  /**
   * Read a 32-bit unsigned integer and move pointer forward by 4 bytes.
   * @returns The read value.
   */
  readUint32() {
    const value = this._data.getUint32(this.offset, this.littleEndian);
    this.offset += 4;
    return value;
  }
  /**
   * Read a 32-bit floating number and move pointer forward by 4 bytes.
   * @returns The read value.
   */
  readFloat32() {
    const value = this._data.getFloat32(this.offset, this.littleEndian);
    this.offset += 4;
    return value;
  }
  /**
   * Read a 64-bit floating number and move pointer forward by 8 bytes.
   * @returns The read value.
   */
  readFloat64() {
    const value = this._data.getFloat64(this.offset, this.littleEndian);
    this.offset += 8;
    return value;
  }
  /**
   * Read a 64-bit signed integer number and move pointer forward by 8 bytes.
   * @returns The read value.
   */
  readBigInt64() {
    const value = this._data.getBigInt64(this.offset, this.littleEndian);
    this.offset += 8;
    return value;
  }
  /**
   * Read a 64-bit unsigned integer number and move pointer forward by 8 bytes.
   * @returns The read value.
   */
  readBigUint64() {
    const value = this._data.getBigUint64(this.offset, this.littleEndian);
    this.offset += 8;
    return value;
  }
  /**
   * Read a 1-byte ASCII character and move pointer forward by 1 byte.
   * @returns The read character.
   */
  readChar() {
    return String.fromCharCode(this.readInt8());
  }
  /**
   * Read `n` 1-byte ASCII characters and move pointer forward by `n` bytes.
   * @param n - Number of characters to read.
   * @returns The read characters.
   */
  readChars(n = 1) {
    let result = "";
    for (let i = 0; i < n; i++) {
      result += this.readChar();
    }
    return result;
  }
  /**
   * Read the next `n` bytes, return a UTF-8 decoded string and move pointer
   * forward by `n` bytes.
   * @param n - Number of bytes to read.
   * @returns The decoded string.
   */
  readUtf8(n = 1) {
    return decode(this.readBytes(n));
  }
  /**
   * Read the next `n` bytes, return a string decoded with `encoding` and move pointer
   * forward by `n` bytes.
   * If no encoding is passed, the function is equivalent to @see {@link IOBuffer#readUtf8}
   * @param n - Number of bytes to read.
   * @param encoding - The encoding to use. Default is 'utf8'.
   * @returns The decoded string.
   */
  decodeText(n = 1, encoding = "utf8") {
    return decode(this.readBytes(n), encoding);
  }
  /**
   * Write 0xff if the passed value is truthy, 0x00 otherwise and move pointer
   * forward by 1 byte.
   * @param value - The value to write.
   * @returns This.
   */
  writeBoolean(value) {
    this.writeUint8(value ? 255 : 0);
    return this;
  }
  /**
   * Write `value` as an 8-bit signed integer and move pointer forward by 1 byte.
   * @param value - The value to write.
   * @returns This.
   */
  writeInt8(value) {
    this.ensureAvailable(1);
    this._data.setInt8(this.offset++, value);
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write `value` as an 8-bit unsigned integer and move pointer forward by 1
   * byte.
   * @param value - The value to write.
   * @returns This.
   */
  writeUint8(value) {
    this.ensureAvailable(1);
    this._data.setUint8(this.offset++, value);
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * An alias for {@link IOBuffer#writeUint8}.
   * @param value - The value to write.
   * @returns This.
   */
  writeByte(value) {
    return this.writeUint8(value);
  }
  /**
   * Write all elements of `bytes` as uint8 values and move pointer forward by
   * `bytes.length` bytes.
   * @param bytes - The array of bytes to write.
   * @returns This.
   */
  writeBytes(bytes) {
    this.ensureAvailable(bytes.length);
    for (let i = 0; i < bytes.length; i++) {
      this._data.setUint8(this.offset++, bytes[i]);
    }
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write `value` as a 16-bit signed integer and move pointer forward by 2
   * bytes.
   * @param value - The value to write.
   * @returns This.
   */
  writeInt16(value) {
    this.ensureAvailable(2);
    this._data.setInt16(this.offset, value, this.littleEndian);
    this.offset += 2;
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write `value` as a 16-bit unsigned integer and move pointer forward by 2
   * bytes.
   * @param value - The value to write.
   * @returns This.
   */
  writeUint16(value) {
    this.ensureAvailable(2);
    this._data.setUint16(this.offset, value, this.littleEndian);
    this.offset += 2;
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write `value` as a 32-bit signed integer and move pointer forward by 4
   * bytes.
   * @param value - The value to write.
   * @returns This.
   */
  writeInt32(value) {
    this.ensureAvailable(4);
    this._data.setInt32(this.offset, value, this.littleEndian);
    this.offset += 4;
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write `value` as a 32-bit unsigned integer and move pointer forward by 4
   * bytes.
   * @param value - The value to write.
   * @returns This.
   */
  writeUint32(value) {
    this.ensureAvailable(4);
    this._data.setUint32(this.offset, value, this.littleEndian);
    this.offset += 4;
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write `value` as a 32-bit floating number and move pointer forward by 4
   * bytes.
   * @param value - The value to write.
   * @returns This.
   */
  writeFloat32(value) {
    this.ensureAvailable(4);
    this._data.setFloat32(this.offset, value, this.littleEndian);
    this.offset += 4;
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write `value` as a 64-bit floating number and move pointer forward by 8
   * bytes.
   * @param value - The value to write.
   * @returns This.
   */
  writeFloat64(value) {
    this.ensureAvailable(8);
    this._data.setFloat64(this.offset, value, this.littleEndian);
    this.offset += 8;
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write `value` as a 64-bit signed bigint and move pointer forward by 8
   * bytes.
   * @param value - The value to write.
   * @returns This.
   */
  writeBigInt64(value) {
    this.ensureAvailable(8);
    this._data.setBigInt64(this.offset, value, this.littleEndian);
    this.offset += 8;
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write `value` as a 64-bit unsigned bigint and move pointer forward by 8
   * bytes.
   * @param value - The value to write.
   * @returns This.
   */
  writeBigUint64(value) {
    this.ensureAvailable(8);
    this._data.setBigUint64(this.offset, value, this.littleEndian);
    this.offset += 8;
    this._updateLastWrittenByte();
    return this;
  }
  /**
   * Write the charCode of `str`'s first character as an 8-bit unsigned integer
   * and move pointer forward by 1 byte.
   * @param str - The character to write.
   * @returns This.
   */
  writeChar(str) {
    return this.writeUint8(str.charCodeAt(0));
  }
  /**
   * Write the charCodes of all `str`'s characters as 8-bit unsigned integers
   * and move pointer forward by `str.length` bytes.
   * @param str - The characters to write.
   * @returns This.
   */
  writeChars(str) {
    for (let i = 0; i < str.length; i++) {
      this.writeUint8(str.charCodeAt(i));
    }
    return this;
  }
  /**
   * UTF-8 encode and write `str` to the current pointer offset and move pointer
   * forward according to the encoded length.
   * @param str - The string to write.
   * @returns This.
   */
  writeUtf8(str) {
    return this.writeBytes(encode(str));
  }
  /**
   * Export a Uint8Array view of the internal buffer.
   * The view starts at the byte offset and its length
   * is calculated to stop at the last written byte or the original length.
   * @returns A new Uint8Array view.
   */
  toArray() {
    return new Uint8Array(this.buffer, this.byteOffset, this.lastWrittenByte);
  }
  /**
   *  Get the total number of bytes written so far, regardless of the current offset.
   * @returns - Total number of bytes.
   */
  getWrittenByteLength() {
    return this.lastWrittenByte - this.byteOffset;
  }
  /**
   * Update the last written byte offset
   * @private
   */
  _updateLastWrittenByte() {
    if (this.offset > this.lastWrittenByte) {
      this.lastWrittenByte = this.offset;
    }
  }
}

/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */
function zero$1(buf) {
  let len = buf.length;
  while (--len >= 0) {
    buf[len] = 0;
  }
}
const MIN_MATCH$1 = 3;
const MAX_MATCH$1 = 258;
const LENGTH_CODES$1 = 29;
const LITERALS$1 = 256;
const L_CODES$1 = LITERALS$1 + 1 + LENGTH_CODES$1;
const D_CODES$1 = 30;
const DIST_CODE_LEN = 512;
const static_ltree = new Array((L_CODES$1 + 2) * 2);
zero$1(static_ltree);
const static_dtree = new Array(D_CODES$1 * 2);
zero$1(static_dtree);
const _dist_code = new Array(DIST_CODE_LEN);
zero$1(_dist_code);
const _length_code = new Array(MAX_MATCH$1 - MIN_MATCH$1 + 1);
zero$1(_length_code);
const base_length = new Array(LENGTH_CODES$1);
zero$1(base_length);
const base_dist = new Array(D_CODES$1);
zero$1(base_dist);
const adler32 = (adler, buf, len, pos) => {
  let s1 = adler & 65535 | 0, s2 = adler >>> 16 & 65535 | 0, n = 0;
  while (len !== 0) {
    n = len > 2e3 ? 2e3 : len;
    len -= n;
    do {
      s1 = s1 + buf[pos++] | 0;
      s2 = s2 + s1 | 0;
    } while (--n);
    s1 %= 65521;
    s2 %= 65521;
  }
  return s1 | s2 << 16 | 0;
};
var adler32_1 = adler32;
const makeTable = () => {
  let c, table = [];
  for (var n = 0; n < 256; n++) {
    c = n;
    for (var k = 0; k < 8; k++) {
      c = c & 1 ? 3988292384 ^ c >>> 1 : c >>> 1;
    }
    table[n] = c;
  }
  return table;
};
const crcTable$1 = new Uint32Array(makeTable());
const crc32 = (crc, buf, len, pos) => {
  const t = crcTable$1;
  const end = pos + len;
  crc ^= -1;
  for (let i = pos; i < end; i++) {
    crc = crc >>> 8 ^ t[(crc ^ buf[i]) & 255];
  }
  return crc ^ -1;
};
var crc32_1 = crc32;
var messages = {
  2: "need dictionary",
  /* Z_NEED_DICT       2  */
  1: "stream end",
  /* Z_STREAM_END      1  */
  0: "",
  /* Z_OK              0  */
  "-1": "file error",
  /* Z_ERRNO         (-1) */
  "-2": "stream error",
  /* Z_STREAM_ERROR  (-2) */
  "-3": "data error",
  /* Z_DATA_ERROR    (-3) */
  "-4": "insufficient memory",
  /* Z_MEM_ERROR     (-4) */
  "-5": "buffer error",
  /* Z_BUF_ERROR     (-5) */
  "-6": "incompatible version"
  /* Z_VERSION_ERROR (-6) */
};
var constants$2 = {
  /* Allowed flush values; see deflate() and inflate() below for details */
  Z_NO_FLUSH: 0,
  Z_FINISH: 4,
  Z_BLOCK: 5,
  Z_TREES: 6,
  /* Return codes for the compression/decompression functions. Negative values
  * are errors, positive values are used for special but normal events.
  */
  Z_OK: 0,
  Z_STREAM_END: 1,
  Z_NEED_DICT: 2,
  Z_STREAM_ERROR: -2,
  Z_DATA_ERROR: -3,
  Z_MEM_ERROR: -4,
  Z_BUF_ERROR: -5,
  /* The deflate compression method */
  Z_DEFLATED: 8
  //Z_NULL:                 null // Use -1 or null inline, depending on var type
};
const _has = (obj, key) => {
  return Object.prototype.hasOwnProperty.call(obj, key);
};
var assign = function(obj) {
  const sources = Array.prototype.slice.call(arguments, 1);
  while (sources.length) {
    const source = sources.shift();
    if (!source) {
      continue;
    }
    if (typeof source !== "object") {
      throw new TypeError(source + "must be non-object");
    }
    for (const p in source) {
      if (_has(source, p)) {
        obj[p] = source[p];
      }
    }
  }
  return obj;
};
var flattenChunks = (chunks) => {
  let len = 0;
  for (let i = 0, l = chunks.length; i < l; i++) {
    len += chunks[i].length;
  }
  const result = new Uint8Array(len);
  for (let i = 0, pos = 0, l = chunks.length; i < l; i++) {
    let chunk = chunks[i];
    result.set(chunk, pos);
    pos += chunk.length;
  }
  return result;
};
var common = {
  assign,
  flattenChunks
};
let STR_APPLY_UIA_OK = true;
try {
  String.fromCharCode.apply(null, new Uint8Array(1));
} catch (__) {
  STR_APPLY_UIA_OK = false;
}
const _utf8len = new Uint8Array(256);
for (let q = 0; q < 256; q++) {
  _utf8len[q] = q >= 252 ? 6 : q >= 248 ? 5 : q >= 240 ? 4 : q >= 224 ? 3 : q >= 192 ? 2 : 1;
}
_utf8len[254] = _utf8len[254] = 1;
var string2buf = (str) => {
  if (typeof TextEncoder === "function" && TextEncoder.prototype.encode) {
    return new TextEncoder().encode(str);
  }
  let buf, c, c2, m_pos, i, str_len = str.length, buf_len = 0;
  for (m_pos = 0; m_pos < str_len; m_pos++) {
    c = str.charCodeAt(m_pos);
    if ((c & 64512) === 55296 && m_pos + 1 < str_len) {
      c2 = str.charCodeAt(m_pos + 1);
      if ((c2 & 64512) === 56320) {
        c = 65536 + (c - 55296 << 10) + (c2 - 56320);
        m_pos++;
      }
    }
    buf_len += c < 128 ? 1 : c < 2048 ? 2 : c < 65536 ? 3 : 4;
  }
  buf = new Uint8Array(buf_len);
  for (i = 0, m_pos = 0; i < buf_len; m_pos++) {
    c = str.charCodeAt(m_pos);
    if ((c & 64512) === 55296 && m_pos + 1 < str_len) {
      c2 = str.charCodeAt(m_pos + 1);
      if ((c2 & 64512) === 56320) {
        c = 65536 + (c - 55296 << 10) + (c2 - 56320);
        m_pos++;
      }
    }
    if (c < 128) {
      buf[i++] = c;
    } else if (c < 2048) {
      buf[i++] = 192 | c >>> 6;
      buf[i++] = 128 | c & 63;
    } else if (c < 65536) {
      buf[i++] = 224 | c >>> 12;
      buf[i++] = 128 | c >>> 6 & 63;
      buf[i++] = 128 | c & 63;
    } else {
      buf[i++] = 240 | c >>> 18;
      buf[i++] = 128 | c >>> 12 & 63;
      buf[i++] = 128 | c >>> 6 & 63;
      buf[i++] = 128 | c & 63;
    }
  }
  return buf;
};
const buf2binstring = (buf, len) => {
  if (len < 65534) {
    if (buf.subarray && STR_APPLY_UIA_OK) {
      return String.fromCharCode.apply(null, buf.length === len ? buf : buf.subarray(0, len));
    }
  }
  let result = "";
  for (let i = 0; i < len; i++) {
    result += String.fromCharCode(buf[i]);
  }
  return result;
};
var buf2string = (buf, max) => {
  const len = max || buf.length;
  if (typeof TextDecoder === "function" && TextDecoder.prototype.decode) {
    return new TextDecoder().decode(buf.subarray(0, max));
  }
  let i, out;
  const utf16buf = new Array(len * 2);
  for (out = 0, i = 0; i < len; ) {
    let c = buf[i++];
    if (c < 128) {
      utf16buf[out++] = c;
      continue;
    }
    let c_len = _utf8len[c];
    if (c_len > 4) {
      utf16buf[out++] = 65533;
      i += c_len - 1;
      continue;
    }
    c &= c_len === 2 ? 31 : c_len === 3 ? 15 : 7;
    while (c_len > 1 && i < len) {
      c = c << 6 | buf[i++] & 63;
      c_len--;
    }
    if (c_len > 1) {
      utf16buf[out++] = 65533;
      continue;
    }
    if (c < 65536) {
      utf16buf[out++] = c;
    } else {
      c -= 65536;
      utf16buf[out++] = 55296 | c >> 10 & 1023;
      utf16buf[out++] = 56320 | c & 1023;
    }
  }
  return buf2binstring(utf16buf, out);
};
var utf8border = (buf, max) => {
  max = max || buf.length;
  if (max > buf.length) {
    max = buf.length;
  }
  let pos = max - 1;
  while (pos >= 0 && (buf[pos] & 192) === 128) {
    pos--;
  }
  if (pos < 0) {
    return max;
  }
  if (pos === 0) {
    return max;
  }
  return pos + _utf8len[buf[pos]] > max ? pos : max;
};
var strings = {
  string2buf,
  buf2string,
  utf8border
};
function ZStream() {
  this.input = null;
  this.next_in = 0;
  this.avail_in = 0;
  this.total_in = 0;
  this.output = null;
  this.next_out = 0;
  this.avail_out = 0;
  this.total_out = 0;
  this.msg = "";
  this.state = null;
  this.data_type = 2;
  this.adler = 0;
}
var zstream = ZStream;
const BAD$1 = 16209;
const TYPE$1 = 16191;
var inffast = function inflate_fast(strm, start) {
  let _in;
  let last;
  let _out;
  let beg;
  let end;
  let dmax;
  let wsize;
  let whave;
  let wnext;
  let s_window;
  let hold;
  let bits;
  let lcode;
  let dcode;
  let lmask;
  let dmask;
  let here;
  let op;
  let len;
  let dist;
  let from;
  let from_source;
  let input, output;
  const state = strm.state;
  _in = strm.next_in;
  input = strm.input;
  last = _in + (strm.avail_in - 5);
  _out = strm.next_out;
  output = strm.output;
  beg = _out - (start - strm.avail_out);
  end = _out + (strm.avail_out - 257);
  dmax = state.dmax;
  wsize = state.wsize;
  whave = state.whave;
  wnext = state.wnext;
  s_window = state.window;
  hold = state.hold;
  bits = state.bits;
  lcode = state.lencode;
  dcode = state.distcode;
  lmask = (1 << state.lenbits) - 1;
  dmask = (1 << state.distbits) - 1;
  top:
    do {
      if (bits < 15) {
        hold += input[_in++] << bits;
        bits += 8;
        hold += input[_in++] << bits;
        bits += 8;
      }
      here = lcode[hold & lmask];
      dolen:
        for (; ; ) {
          op = here >>> 24;
          hold >>>= op;
          bits -= op;
          op = here >>> 16 & 255;
          if (op === 0) {
            output[_out++] = here & 65535;
          } else if (op & 16) {
            len = here & 65535;
            op &= 15;
            if (op) {
              if (bits < op) {
                hold += input[_in++] << bits;
                bits += 8;
              }
              len += hold & (1 << op) - 1;
              hold >>>= op;
              bits -= op;
            }
            if (bits < 15) {
              hold += input[_in++] << bits;
              bits += 8;
              hold += input[_in++] << bits;
              bits += 8;
            }
            here = dcode[hold & dmask];
            dodist:
              for (; ; ) {
                op = here >>> 24;
                hold >>>= op;
                bits -= op;
                op = here >>> 16 & 255;
                if (op & 16) {
                  dist = here & 65535;
                  op &= 15;
                  if (bits < op) {
                    hold += input[_in++] << bits;
                    bits += 8;
                    if (bits < op) {
                      hold += input[_in++] << bits;
                      bits += 8;
                    }
                  }
                  dist += hold & (1 << op) - 1;
                  if (dist > dmax) {
                    strm.msg = "invalid distance too far back";
                    state.mode = BAD$1;
                    break top;
                  }
                  hold >>>= op;
                  bits -= op;
                  op = _out - beg;
                  if (dist > op) {
                    op = dist - op;
                    if (op > whave) {
                      if (state.sane) {
                        strm.msg = "invalid distance too far back";
                        state.mode = BAD$1;
                        break top;
                      }
                    }
                    from = 0;
                    from_source = s_window;
                    if (wnext === 0) {
                      from += wsize - op;
                      if (op < len) {
                        len -= op;
                        do {
                          output[_out++] = s_window[from++];
                        } while (--op);
                        from = _out - dist;
                        from_source = output;
                      }
                    } else if (wnext < op) {
                      from += wsize + wnext - op;
                      op -= wnext;
                      if (op < len) {
                        len -= op;
                        do {
                          output[_out++] = s_window[from++];
                        } while (--op);
                        from = 0;
                        if (wnext < len) {
                          op = wnext;
                          len -= op;
                          do {
                            output[_out++] = s_window[from++];
                          } while (--op);
                          from = _out - dist;
                          from_source = output;
                        }
                      }
                    } else {
                      from += wnext - op;
                      if (op < len) {
                        len -= op;
                        do {
                          output[_out++] = s_window[from++];
                        } while (--op);
                        from = _out - dist;
                        from_source = output;
                      }
                    }
                    while (len > 2) {
                      output[_out++] = from_source[from++];
                      output[_out++] = from_source[from++];
                      output[_out++] = from_source[from++];
                      len -= 3;
                    }
                    if (len) {
                      output[_out++] = from_source[from++];
                      if (len > 1) {
                        output[_out++] = from_source[from++];
                      }
                    }
                  } else {
                    from = _out - dist;
                    do {
                      output[_out++] = output[from++];
                      output[_out++] = output[from++];
                      output[_out++] = output[from++];
                      len -= 3;
                    } while (len > 2);
                    if (len) {
                      output[_out++] = output[from++];
                      if (len > 1) {
                        output[_out++] = output[from++];
                      }
                    }
                  }
                } else if ((op & 64) === 0) {
                  here = dcode[(here & 65535) + (hold & (1 << op) - 1)];
                  continue dodist;
                } else {
                  strm.msg = "invalid distance code";
                  state.mode = BAD$1;
                  break top;
                }
                break;
              }
          } else if ((op & 64) === 0) {
            here = lcode[(here & 65535) + (hold & (1 << op) - 1)];
            continue dolen;
          } else if (op & 32) {
            state.mode = TYPE$1;
            break top;
          } else {
            strm.msg = "invalid literal/length code";
            state.mode = BAD$1;
            break top;
          }
          break;
        }
    } while (_in < last && _out < end);
  len = bits >> 3;
  _in -= len;
  bits -= len << 3;
  hold &= (1 << bits) - 1;
  strm.next_in = _in;
  strm.next_out = _out;
  strm.avail_in = _in < last ? 5 + (last - _in) : 5 - (_in - last);
  strm.avail_out = _out < end ? 257 + (end - _out) : 257 - (_out - end);
  state.hold = hold;
  state.bits = bits;
  return;
};
const MAXBITS = 15;
const ENOUGH_LENS$1 = 852;
const ENOUGH_DISTS$1 = 592;
const CODES$1 = 0;
const LENS$1 = 1;
const DISTS$1 = 2;
const lbase = new Uint16Array([
  /* Length codes 257..285 base */
  3,
  4,
  5,
  6,
  7,
  8,
  9,
  10,
  11,
  13,
  15,
  17,
  19,
  23,
  27,
  31,
  35,
  43,
  51,
  59,
  67,
  83,
  99,
  115,
  131,
  163,
  195,
  227,
  258,
  0,
  0
]);
const lext = new Uint8Array([
  /* Length codes 257..285 extra */
  16,
  16,
  16,
  16,
  16,
  16,
  16,
  16,
  17,
  17,
  17,
  17,
  18,
  18,
  18,
  18,
  19,
  19,
  19,
  19,
  20,
  20,
  20,
  20,
  21,
  21,
  21,
  21,
  16,
  72,
  78
]);
const dbase = new Uint16Array([
  /* Distance codes 0..29 base */
  1,
  2,
  3,
  4,
  5,
  7,
  9,
  13,
  17,
  25,
  33,
  49,
  65,
  97,
  129,
  193,
  257,
  385,
  513,
  769,
  1025,
  1537,
  2049,
  3073,
  4097,
  6145,
  8193,
  12289,
  16385,
  24577,
  0,
  0
]);
const dext = new Uint8Array([
  /* Distance codes 0..29 extra */
  16,
  16,
  16,
  16,
  17,
  17,
  18,
  18,
  19,
  19,
  20,
  20,
  21,
  21,
  22,
  22,
  23,
  23,
  24,
  24,
  25,
  25,
  26,
  26,
  27,
  27,
  28,
  28,
  29,
  29,
  64,
  64
]);
const inflate_table = (type, lens, lens_index, codes, table, table_index, work, opts) => {
  const bits = opts.bits;
  let len = 0;
  let sym = 0;
  let min = 0, max = 0;
  let root = 0;
  let curr = 0;
  let drop = 0;
  let left = 0;
  let used = 0;
  let huff = 0;
  let incr;
  let fill;
  let low;
  let mask;
  let next;
  let base = null;
  let match;
  const count = new Uint16Array(MAXBITS + 1);
  const offs = new Uint16Array(MAXBITS + 1);
  let extra = null;
  let here_bits, here_op, here_val;
  for (len = 0; len <= MAXBITS; len++) {
    count[len] = 0;
  }
  for (sym = 0; sym < codes; sym++) {
    count[lens[lens_index + sym]]++;
  }
  root = bits;
  for (max = MAXBITS; max >= 1; max--) {
    if (count[max] !== 0) {
      break;
    }
  }
  if (root > max) {
    root = max;
  }
  if (max === 0) {
    table[table_index++] = 1 << 24 | 64 << 16 | 0;
    table[table_index++] = 1 << 24 | 64 << 16 | 0;
    opts.bits = 1;
    return 0;
  }
  for (min = 1; min < max; min++) {
    if (count[min] !== 0) {
      break;
    }
  }
  if (root < min) {
    root = min;
  }
  left = 1;
  for (len = 1; len <= MAXBITS; len++) {
    left <<= 1;
    left -= count[len];
    if (left < 0) {
      return -1;
    }
  }
  if (left > 0 && (type === CODES$1 || max !== 1)) {
    return -1;
  }
  offs[1] = 0;
  for (len = 1; len < MAXBITS; len++) {
    offs[len + 1] = offs[len] + count[len];
  }
  for (sym = 0; sym < codes; sym++) {
    if (lens[lens_index + sym] !== 0) {
      work[offs[lens[lens_index + sym]]++] = sym;
    }
  }
  if (type === CODES$1) {
    base = extra = work;
    match = 20;
  } else if (type === LENS$1) {
    base = lbase;
    extra = lext;
    match = 257;
  } else {
    base = dbase;
    extra = dext;
    match = 0;
  }
  huff = 0;
  sym = 0;
  len = min;
  next = table_index;
  curr = root;
  drop = 0;
  low = -1;
  used = 1 << root;
  mask = used - 1;
  if (type === LENS$1 && used > ENOUGH_LENS$1 || type === DISTS$1 && used > ENOUGH_DISTS$1) {
    return 1;
  }
  for (; ; ) {
    here_bits = len - drop;
    if (work[sym] + 1 < match) {
      here_op = 0;
      here_val = work[sym];
    } else if (work[sym] >= match) {
      here_op = extra[work[sym] - match];
      here_val = base[work[sym] - match];
    } else {
      here_op = 32 + 64;
      here_val = 0;
    }
    incr = 1 << len - drop;
    fill = 1 << curr;
    min = fill;
    do {
      fill -= incr;
      table[next + (huff >> drop) + fill] = here_bits << 24 | here_op << 16 | here_val | 0;
    } while (fill !== 0);
    incr = 1 << len - 1;
    while (huff & incr) {
      incr >>= 1;
    }
    if (incr !== 0) {
      huff &= incr - 1;
      huff += incr;
    } else {
      huff = 0;
    }
    sym++;
    if (--count[len] === 0) {
      if (len === max) {
        break;
      }
      len = lens[lens_index + work[sym]];
    }
    if (len > root && (huff & mask) !== low) {
      if (drop === 0) {
        drop = root;
      }
      next += min;
      curr = len - drop;
      left = 1 << curr;
      while (curr + drop < max) {
        left -= count[curr + drop];
        if (left <= 0) {
          break;
        }
        curr++;
        left <<= 1;
      }
      used += 1 << curr;
      if (type === LENS$1 && used > ENOUGH_LENS$1 || type === DISTS$1 && used > ENOUGH_DISTS$1) {
        return 1;
      }
      low = huff & mask;
      table[low] = root << 24 | curr << 16 | next - table_index | 0;
    }
  }
  if (huff !== 0) {
    table[next + huff] = len - drop << 24 | 64 << 16 | 0;
  }
  opts.bits = root;
  return 0;
};
var inftrees = inflate_table;
const CODES = 0;
const LENS = 1;
const DISTS = 2;
const {
  Z_FINISH: Z_FINISH$1,
  Z_BLOCK,
  Z_TREES,
  Z_OK: Z_OK$1,
  Z_STREAM_END: Z_STREAM_END$1,
  Z_NEED_DICT: Z_NEED_DICT$1,
  Z_STREAM_ERROR: Z_STREAM_ERROR$1,
  Z_DATA_ERROR: Z_DATA_ERROR$1,
  Z_MEM_ERROR: Z_MEM_ERROR$1,
  Z_BUF_ERROR,
  Z_DEFLATED
} = constants$2;
const HEAD = 16180;
const FLAGS = 16181;
const TIME = 16182;
const OS = 16183;
const EXLEN = 16184;
const EXTRA = 16185;
const NAME = 16186;
const COMMENT = 16187;
const HCRC = 16188;
const DICTID = 16189;
const DICT = 16190;
const TYPE = 16191;
const TYPEDO = 16192;
const STORED = 16193;
const COPY_ = 16194;
const COPY = 16195;
const TABLE = 16196;
const LENLENS = 16197;
const CODELENS = 16198;
const LEN_ = 16199;
const LEN = 16200;
const LENEXT = 16201;
const DIST = 16202;
const DISTEXT = 16203;
const MATCH = 16204;
const LIT = 16205;
const CHECK = 16206;
const LENGTH = 16207;
const DONE = 16208;
const BAD = 16209;
const MEM = 16210;
const SYNC = 16211;
const ENOUGH_LENS = 852;
const ENOUGH_DISTS = 592;
const MAX_WBITS = 15;
const DEF_WBITS = MAX_WBITS;
const zswap32 = (q) => {
  return (q >>> 24 & 255) + (q >>> 8 & 65280) + ((q & 65280) << 8) + ((q & 255) << 24);
};
function InflateState() {
  this.strm = null;
  this.mode = 0;
  this.last = false;
  this.wrap = 0;
  this.havedict = false;
  this.flags = 0;
  this.dmax = 0;
  this.check = 0;
  this.total = 0;
  this.head = null;
  this.wbits = 0;
  this.wsize = 0;
  this.whave = 0;
  this.wnext = 0;
  this.window = null;
  this.hold = 0;
  this.bits = 0;
  this.length = 0;
  this.offset = 0;
  this.extra = 0;
  this.lencode = null;
  this.distcode = null;
  this.lenbits = 0;
  this.distbits = 0;
  this.ncode = 0;
  this.nlen = 0;
  this.ndist = 0;
  this.have = 0;
  this.next = null;
  this.lens = new Uint16Array(320);
  this.work = new Uint16Array(288);
  this.lendyn = null;
  this.distdyn = null;
  this.sane = 0;
  this.back = 0;
  this.was = 0;
}
const inflateStateCheck = (strm) => {
  if (!strm) {
    return 1;
  }
  const state = strm.state;
  if (!state || state.strm !== strm || state.mode < HEAD || state.mode > SYNC) {
    return 1;
  }
  return 0;
};
const inflateResetKeep = (strm) => {
  if (inflateStateCheck(strm)) {
    return Z_STREAM_ERROR$1;
  }
  const state = strm.state;
  strm.total_in = strm.total_out = state.total = 0;
  strm.msg = "";
  if (state.wrap) {
    strm.adler = state.wrap & 1;
  }
  state.mode = HEAD;
  state.last = 0;
  state.havedict = 0;
  state.flags = -1;
  state.dmax = 32768;
  state.head = null;
  state.hold = 0;
  state.bits = 0;
  state.lencode = state.lendyn = new Int32Array(ENOUGH_LENS);
  state.distcode = state.distdyn = new Int32Array(ENOUGH_DISTS);
  state.sane = 1;
  state.back = -1;
  return Z_OK$1;
};
const inflateReset = (strm) => {
  if (inflateStateCheck(strm)) {
    return Z_STREAM_ERROR$1;
  }
  const state = strm.state;
  state.wsize = 0;
  state.whave = 0;
  state.wnext = 0;
  return inflateResetKeep(strm);
};
const inflateReset2 = (strm, windowBits) => {
  let wrap;
  if (inflateStateCheck(strm)) {
    return Z_STREAM_ERROR$1;
  }
  const state = strm.state;
  if (windowBits < 0) {
    wrap = 0;
    windowBits = -windowBits;
  } else {
    wrap = (windowBits >> 4) + 5;
    if (windowBits < 48) {
      windowBits &= 15;
    }
  }
  if (windowBits && (windowBits < 8 || windowBits > 15)) {
    return Z_STREAM_ERROR$1;
  }
  if (state.window !== null && state.wbits !== windowBits) {
    state.window = null;
  }
  state.wrap = wrap;
  state.wbits = windowBits;
  return inflateReset(strm);
};
const inflateInit2 = (strm, windowBits) => {
  if (!strm) {
    return Z_STREAM_ERROR$1;
  }
  const state = new InflateState();
  strm.state = state;
  state.strm = strm;
  state.window = null;
  state.mode = HEAD;
  const ret = inflateReset2(strm, windowBits);
  if (ret !== Z_OK$1) {
    strm.state = null;
  }
  return ret;
};
const inflateInit = (strm) => {
  return inflateInit2(strm, DEF_WBITS);
};
let virgin = true;
let lenfix, distfix;
const fixedtables = (state) => {
  if (virgin) {
    lenfix = new Int32Array(512);
    distfix = new Int32Array(32);
    let sym = 0;
    while (sym < 144) {
      state.lens[sym++] = 8;
    }
    while (sym < 256) {
      state.lens[sym++] = 9;
    }
    while (sym < 280) {
      state.lens[sym++] = 7;
    }
    while (sym < 288) {
      state.lens[sym++] = 8;
    }
    inftrees(LENS, state.lens, 0, 288, lenfix, 0, state.work, { bits: 9 });
    sym = 0;
    while (sym < 32) {
      state.lens[sym++] = 5;
    }
    inftrees(DISTS, state.lens, 0, 32, distfix, 0, state.work, { bits: 5 });
    virgin = false;
  }
  state.lencode = lenfix;
  state.lenbits = 9;
  state.distcode = distfix;
  state.distbits = 5;
};
const updatewindow = (strm, src, end, copy) => {
  let dist;
  const state = strm.state;
  if (state.window === null) {
    state.wsize = 1 << state.wbits;
    state.wnext = 0;
    state.whave = 0;
    state.window = new Uint8Array(state.wsize);
  }
  if (copy >= state.wsize) {
    state.window.set(src.subarray(end - state.wsize, end), 0);
    state.wnext = 0;
    state.whave = state.wsize;
  } else {
    dist = state.wsize - state.wnext;
    if (dist > copy) {
      dist = copy;
    }
    state.window.set(src.subarray(end - copy, end - copy + dist), state.wnext);
    copy -= dist;
    if (copy) {
      state.window.set(src.subarray(end - copy, end), 0);
      state.wnext = copy;
      state.whave = state.wsize;
    } else {
      state.wnext += dist;
      if (state.wnext === state.wsize) {
        state.wnext = 0;
      }
      if (state.whave < state.wsize) {
        state.whave += dist;
      }
    }
  }
  return 0;
};
const inflate$2 = (strm, flush) => {
  let state;
  let input, output;
  let next;
  let put;
  let have, left;
  let hold;
  let bits;
  let _in, _out;
  let copy;
  let from;
  let from_source;
  let here = 0;
  let here_bits, here_op, here_val;
  let last_bits, last_op, last_val;
  let len;
  let ret;
  const hbuf = new Uint8Array(4);
  let opts;
  let n;
  const order = (
    /* permutation of code lengths */
    new Uint8Array([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15])
  );
  if (inflateStateCheck(strm) || !strm.output || !strm.input && strm.avail_in !== 0) {
    return Z_STREAM_ERROR$1;
  }
  state = strm.state;
  if (state.mode === TYPE) {
    state.mode = TYPEDO;
  }
  put = strm.next_out;
  output = strm.output;
  left = strm.avail_out;
  next = strm.next_in;
  input = strm.input;
  have = strm.avail_in;
  hold = state.hold;
  bits = state.bits;
  _in = have;
  _out = left;
  ret = Z_OK$1;
  inf_leave:
    for (; ; ) {
      switch (state.mode) {
        case HEAD:
          if (state.wrap === 0) {
            state.mode = TYPEDO;
            break;
          }
          while (bits < 16) {
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          if (state.wrap & 2 && hold === 35615) {
            if (state.wbits === 0) {
              state.wbits = 15;
            }
            state.check = 0;
            hbuf[0] = hold & 255;
            hbuf[1] = hold >>> 8 & 255;
            state.check = crc32_1(state.check, hbuf, 2, 0);
            hold = 0;
            bits = 0;
            state.mode = FLAGS;
            break;
          }
          if (state.head) {
            state.head.done = false;
          }
          if (!(state.wrap & 1) || /* check if zlib header allowed */
          (((hold & 255) << 8) + (hold >> 8)) % 31) {
            strm.msg = "incorrect header check";
            state.mode = BAD;
            break;
          }
          if ((hold & 15) !== Z_DEFLATED) {
            strm.msg = "unknown compression method";
            state.mode = BAD;
            break;
          }
          hold >>>= 4;
          bits -= 4;
          len = (hold & 15) + 8;
          if (state.wbits === 0) {
            state.wbits = len;
          }
          if (len > 15 || len > state.wbits) {
            strm.msg = "invalid window size";
            state.mode = BAD;
            break;
          }
          state.dmax = 1 << state.wbits;
          state.flags = 0;
          strm.adler = state.check = 1;
          state.mode = hold & 512 ? DICTID : TYPE;
          hold = 0;
          bits = 0;
          break;
        case FLAGS:
          while (bits < 16) {
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          state.flags = hold;
          if ((state.flags & 255) !== Z_DEFLATED) {
            strm.msg = "unknown compression method";
            state.mode = BAD;
            break;
          }
          if (state.flags & 57344) {
            strm.msg = "unknown header flags set";
            state.mode = BAD;
            break;
          }
          if (state.head) {
            state.head.text = hold >> 8 & 1;
          }
          if (state.flags & 512 && state.wrap & 4) {
            hbuf[0] = hold & 255;
            hbuf[1] = hold >>> 8 & 255;
            state.check = crc32_1(state.check, hbuf, 2, 0);
          }
          hold = 0;
          bits = 0;
          state.mode = TIME;
        case TIME:
          while (bits < 32) {
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          if (state.head) {
            state.head.time = hold;
          }
          if (state.flags & 512 && state.wrap & 4) {
            hbuf[0] = hold & 255;
            hbuf[1] = hold >>> 8 & 255;
            hbuf[2] = hold >>> 16 & 255;
            hbuf[3] = hold >>> 24 & 255;
            state.check = crc32_1(state.check, hbuf, 4, 0);
          }
          hold = 0;
          bits = 0;
          state.mode = OS;
        case OS:
          while (bits < 16) {
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          if (state.head) {
            state.head.xflags = hold & 255;
            state.head.os = hold >> 8;
          }
          if (state.flags & 512 && state.wrap & 4) {
            hbuf[0] = hold & 255;
            hbuf[1] = hold >>> 8 & 255;
            state.check = crc32_1(state.check, hbuf, 2, 0);
          }
          hold = 0;
          bits = 0;
          state.mode = EXLEN;
        case EXLEN:
          if (state.flags & 1024) {
            while (bits < 16) {
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold += input[next++] << bits;
              bits += 8;
            }
            state.length = hold;
            if (state.head) {
              state.head.extra_len = hold;
            }
            if (state.flags & 512 && state.wrap & 4) {
              hbuf[0] = hold & 255;
              hbuf[1] = hold >>> 8 & 255;
              state.check = crc32_1(state.check, hbuf, 2, 0);
            }
            hold = 0;
            bits = 0;
          } else if (state.head) {
            state.head.extra = null;
          }
          state.mode = EXTRA;
        case EXTRA:
          if (state.flags & 1024) {
            copy = state.length;
            if (copy > have) {
              copy = have;
            }
            if (copy) {
              if (state.head) {
                len = state.head.extra_len - state.length;
                if (!state.head.extra) {
                  state.head.extra = new Uint8Array(state.head.extra_len);
                }
                state.head.extra.set(
                  input.subarray(
                    next,
                    // extra field is limited to 65536 bytes
                    // - no need for additional size check
                    next + copy
                  ),
                  /*len + copy > state.head.extra_max - len ? state.head.extra_max : copy,*/
                  len
                );
              }
              if (state.flags & 512 && state.wrap & 4) {
                state.check = crc32_1(state.check, input, copy, next);
              }
              have -= copy;
              next += copy;
              state.length -= copy;
            }
            if (state.length) {
              break inf_leave;
            }
          }
          state.length = 0;
          state.mode = NAME;
        case NAME:
          if (state.flags & 2048) {
            if (have === 0) {
              break inf_leave;
            }
            copy = 0;
            do {
              len = input[next + copy++];
              if (state.head && len && state.length < 65536) {
                state.head.name += String.fromCharCode(len);
              }
            } while (len && copy < have);
            if (state.flags & 512 && state.wrap & 4) {
              state.check = crc32_1(state.check, input, copy, next);
            }
            have -= copy;
            next += copy;
            if (len) {
              break inf_leave;
            }
          } else if (state.head) {
            state.head.name = null;
          }
          state.length = 0;
          state.mode = COMMENT;
        case COMMENT:
          if (state.flags & 4096) {
            if (have === 0) {
              break inf_leave;
            }
            copy = 0;
            do {
              len = input[next + copy++];
              if (state.head && len && state.length < 65536) {
                state.head.comment += String.fromCharCode(len);
              }
            } while (len && copy < have);
            if (state.flags & 512 && state.wrap & 4) {
              state.check = crc32_1(state.check, input, copy, next);
            }
            have -= copy;
            next += copy;
            if (len) {
              break inf_leave;
            }
          } else if (state.head) {
            state.head.comment = null;
          }
          state.mode = HCRC;
        case HCRC:
          if (state.flags & 512) {
            while (bits < 16) {
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold += input[next++] << bits;
              bits += 8;
            }
            if (state.wrap & 4 && hold !== (state.check & 65535)) {
              strm.msg = "header crc mismatch";
              state.mode = BAD;
              break;
            }
            hold = 0;
            bits = 0;
          }
          if (state.head) {
            state.head.hcrc = state.flags >> 9 & 1;
            state.head.done = true;
          }
          strm.adler = state.check = 0;
          state.mode = TYPE;
          break;
        case DICTID:
          while (bits < 32) {
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          strm.adler = state.check = zswap32(hold);
          hold = 0;
          bits = 0;
          state.mode = DICT;
        case DICT:
          if (state.havedict === 0) {
            strm.next_out = put;
            strm.avail_out = left;
            strm.next_in = next;
            strm.avail_in = have;
            state.hold = hold;
            state.bits = bits;
            return Z_NEED_DICT$1;
          }
          strm.adler = state.check = 1;
          state.mode = TYPE;
        case TYPE:
          if (flush === Z_BLOCK || flush === Z_TREES) {
            break inf_leave;
          }
        case TYPEDO:
          if (state.last) {
            hold >>>= bits & 7;
            bits -= bits & 7;
            state.mode = CHECK;
            break;
          }
          while (bits < 3) {
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          state.last = hold & 1;
          hold >>>= 1;
          bits -= 1;
          switch (hold & 3) {
            case 0:
              state.mode = STORED;
              break;
            case 1:
              fixedtables(state);
              state.mode = LEN_;
              if (flush === Z_TREES) {
                hold >>>= 2;
                bits -= 2;
                break inf_leave;
              }
              break;
            case 2:
              state.mode = TABLE;
              break;
            case 3:
              strm.msg = "invalid block type";
              state.mode = BAD;
          }
          hold >>>= 2;
          bits -= 2;
          break;
        case STORED:
          hold >>>= bits & 7;
          bits -= bits & 7;
          while (bits < 32) {
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          if ((hold & 65535) !== (hold >>> 16 ^ 65535)) {
            strm.msg = "invalid stored block lengths";
            state.mode = BAD;
            break;
          }
          state.length = hold & 65535;
          hold = 0;
          bits = 0;
          state.mode = COPY_;
          if (flush === Z_TREES) {
            break inf_leave;
          }
        case COPY_:
          state.mode = COPY;
        case COPY:
          copy = state.length;
          if (copy) {
            if (copy > have) {
              copy = have;
            }
            if (copy > left) {
              copy = left;
            }
            if (copy === 0) {
              break inf_leave;
            }
            output.set(input.subarray(next, next + copy), put);
            have -= copy;
            next += copy;
            left -= copy;
            put += copy;
            state.length -= copy;
            break;
          }
          state.mode = TYPE;
          break;
        case TABLE:
          while (bits < 14) {
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          state.nlen = (hold & 31) + 257;
          hold >>>= 5;
          bits -= 5;
          state.ndist = (hold & 31) + 1;
          hold >>>= 5;
          bits -= 5;
          state.ncode = (hold & 15) + 4;
          hold >>>= 4;
          bits -= 4;
          if (state.nlen > 286 || state.ndist > 30) {
            strm.msg = "too many length or distance symbols";
            state.mode = BAD;
            break;
          }
          state.have = 0;
          state.mode = LENLENS;
        case LENLENS:
          while (state.have < state.ncode) {
            while (bits < 3) {
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold += input[next++] << bits;
              bits += 8;
            }
            state.lens[order[state.have++]] = hold & 7;
            hold >>>= 3;
            bits -= 3;
          }
          while (state.have < 19) {
            state.lens[order[state.have++]] = 0;
          }
          state.lencode = state.lendyn;
          state.lenbits = 7;
          opts = { bits: state.lenbits };
          ret = inftrees(CODES, state.lens, 0, 19, state.lencode, 0, state.work, opts);
          state.lenbits = opts.bits;
          if (ret) {
            strm.msg = "invalid code lengths set";
            state.mode = BAD;
            break;
          }
          state.have = 0;
          state.mode = CODELENS;
        case CODELENS:
          while (state.have < state.nlen + state.ndist) {
            for (; ; ) {
              here = state.lencode[hold & (1 << state.lenbits) - 1];
              here_bits = here >>> 24;
              here_op = here >>> 16 & 255;
              here_val = here & 65535;
              if (here_bits <= bits) {
                break;
              }
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold += input[next++] << bits;
              bits += 8;
            }
            if (here_val < 16) {
              hold >>>= here_bits;
              bits -= here_bits;
              state.lens[state.have++] = here_val;
            } else {
              if (here_val === 16) {
                n = here_bits + 2;
                while (bits < n) {
                  if (have === 0) {
                    break inf_leave;
                  }
                  have--;
                  hold += input[next++] << bits;
                  bits += 8;
                }
                hold >>>= here_bits;
                bits -= here_bits;
                if (state.have === 0) {
                  strm.msg = "invalid bit length repeat";
                  state.mode = BAD;
                  break;
                }
                len = state.lens[state.have - 1];
                copy = 3 + (hold & 3);
                hold >>>= 2;
                bits -= 2;
              } else if (here_val === 17) {
                n = here_bits + 3;
                while (bits < n) {
                  if (have === 0) {
                    break inf_leave;
                  }
                  have--;
                  hold += input[next++] << bits;
                  bits += 8;
                }
                hold >>>= here_bits;
                bits -= here_bits;
                len = 0;
                copy = 3 + (hold & 7);
                hold >>>= 3;
                bits -= 3;
              } else {
                n = here_bits + 7;
                while (bits < n) {
                  if (have === 0) {
                    break inf_leave;
                  }
                  have--;
                  hold += input[next++] << bits;
                  bits += 8;
                }
                hold >>>= here_bits;
                bits -= here_bits;
                len = 0;
                copy = 11 + (hold & 127);
                hold >>>= 7;
                bits -= 7;
              }
              if (state.have + copy > state.nlen + state.ndist) {
                strm.msg = "invalid bit length repeat";
                state.mode = BAD;
                break;
              }
              while (copy--) {
                state.lens[state.have++] = len;
              }
            }
          }
          if (state.mode === BAD) {
            break;
          }
          if (state.lens[256] === 0) {
            strm.msg = "invalid code -- missing end-of-block";
            state.mode = BAD;
            break;
          }
          state.lenbits = 9;
          opts = { bits: state.lenbits };
          ret = inftrees(LENS, state.lens, 0, state.nlen, state.lencode, 0, state.work, opts);
          state.lenbits = opts.bits;
          if (ret) {
            strm.msg = "invalid literal/lengths set";
            state.mode = BAD;
            break;
          }
          state.distbits = 6;
          state.distcode = state.distdyn;
          opts = { bits: state.distbits };
          ret = inftrees(DISTS, state.lens, state.nlen, state.ndist, state.distcode, 0, state.work, opts);
          state.distbits = opts.bits;
          if (ret) {
            strm.msg = "invalid distances set";
            state.mode = BAD;
            break;
          }
          state.mode = LEN_;
          if (flush === Z_TREES) {
            break inf_leave;
          }
        case LEN_:
          state.mode = LEN;
        case LEN:
          if (have >= 6 && left >= 258) {
            strm.next_out = put;
            strm.avail_out = left;
            strm.next_in = next;
            strm.avail_in = have;
            state.hold = hold;
            state.bits = bits;
            inffast(strm, _out);
            put = strm.next_out;
            output = strm.output;
            left = strm.avail_out;
            next = strm.next_in;
            input = strm.input;
            have = strm.avail_in;
            hold = state.hold;
            bits = state.bits;
            if (state.mode === TYPE) {
              state.back = -1;
            }
            break;
          }
          state.back = 0;
          for (; ; ) {
            here = state.lencode[hold & (1 << state.lenbits) - 1];
            here_bits = here >>> 24;
            here_op = here >>> 16 & 255;
            here_val = here & 65535;
            if (here_bits <= bits) {
              break;
            }
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          if (here_op && (here_op & 240) === 0) {
            last_bits = here_bits;
            last_op = here_op;
            last_val = here_val;
            for (; ; ) {
              here = state.lencode[last_val + ((hold & (1 << last_bits + last_op) - 1) >> last_bits)];
              here_bits = here >>> 24;
              here_op = here >>> 16 & 255;
              here_val = here & 65535;
              if (last_bits + here_bits <= bits) {
                break;
              }
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold += input[next++] << bits;
              bits += 8;
            }
            hold >>>= last_bits;
            bits -= last_bits;
            state.back += last_bits;
          }
          hold >>>= here_bits;
          bits -= here_bits;
          state.back += here_bits;
          state.length = here_val;
          if (here_op === 0) {
            state.mode = LIT;
            break;
          }
          if (here_op & 32) {
            state.back = -1;
            state.mode = TYPE;
            break;
          }
          if (here_op & 64) {
            strm.msg = "invalid literal/length code";
            state.mode = BAD;
            break;
          }
          state.extra = here_op & 15;
          state.mode = LENEXT;
        case LENEXT:
          if (state.extra) {
            n = state.extra;
            while (bits < n) {
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold += input[next++] << bits;
              bits += 8;
            }
            state.length += hold & (1 << state.extra) - 1;
            hold >>>= state.extra;
            bits -= state.extra;
            state.back += state.extra;
          }
          state.was = state.length;
          state.mode = DIST;
        case DIST:
          for (; ; ) {
            here = state.distcode[hold & (1 << state.distbits) - 1];
            here_bits = here >>> 24;
            here_op = here >>> 16 & 255;
            here_val = here & 65535;
            if (here_bits <= bits) {
              break;
            }
            if (have === 0) {
              break inf_leave;
            }
            have--;
            hold += input[next++] << bits;
            bits += 8;
          }
          if ((here_op & 240) === 0) {
            last_bits = here_bits;
            last_op = here_op;
            last_val = here_val;
            for (; ; ) {
              here = state.distcode[last_val + ((hold & (1 << last_bits + last_op) - 1) >> last_bits)];
              here_bits = here >>> 24;
              here_op = here >>> 16 & 255;
              here_val = here & 65535;
              if (last_bits + here_bits <= bits) {
                break;
              }
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold += input[next++] << bits;
              bits += 8;
            }
            hold >>>= last_bits;
            bits -= last_bits;
            state.back += last_bits;
          }
          hold >>>= here_bits;
          bits -= here_bits;
          state.back += here_bits;
          if (here_op & 64) {
            strm.msg = "invalid distance code";
            state.mode = BAD;
            break;
          }
          state.offset = here_val;
          state.extra = here_op & 15;
          state.mode = DISTEXT;
        case DISTEXT:
          if (state.extra) {
            n = state.extra;
            while (bits < n) {
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold += input[next++] << bits;
              bits += 8;
            }
            state.offset += hold & (1 << state.extra) - 1;
            hold >>>= state.extra;
            bits -= state.extra;
            state.back += state.extra;
          }
          if (state.offset > state.dmax) {
            strm.msg = "invalid distance too far back";
            state.mode = BAD;
            break;
          }
          state.mode = MATCH;
        case MATCH:
          if (left === 0) {
            break inf_leave;
          }
          copy = _out - left;
          if (state.offset > copy) {
            copy = state.offset - copy;
            if (copy > state.whave) {
              if (state.sane) {
                strm.msg = "invalid distance too far back";
                state.mode = BAD;
                break;
              }
            }
            if (copy > state.wnext) {
              copy -= state.wnext;
              from = state.wsize - copy;
            } else {
              from = state.wnext - copy;
            }
            if (copy > state.length) {
              copy = state.length;
            }
            from_source = state.window;
          } else {
            from_source = output;
            from = put - state.offset;
            copy = state.length;
          }
          if (copy > left) {
            copy = left;
          }
          left -= copy;
          state.length -= copy;
          do {
            output[put++] = from_source[from++];
          } while (--copy);
          if (state.length === 0) {
            state.mode = LEN;
          }
          break;
        case LIT:
          if (left === 0) {
            break inf_leave;
          }
          output[put++] = state.length;
          left--;
          state.mode = LEN;
          break;
        case CHECK:
          if (state.wrap) {
            while (bits < 32) {
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold |= input[next++] << bits;
              bits += 8;
            }
            _out -= left;
            strm.total_out += _out;
            state.total += _out;
            if (state.wrap & 4 && _out) {
              strm.adler = state.check = /*UPDATE_CHECK(state.check, put - _out, _out);*/
              state.flags ? crc32_1(state.check, output, _out, put - _out) : adler32_1(state.check, output, _out, put - _out);
            }
            _out = left;
            if (state.wrap & 4 && (state.flags ? hold : zswap32(hold)) !== state.check) {
              strm.msg = "incorrect data check";
              state.mode = BAD;
              break;
            }
            hold = 0;
            bits = 0;
          }
          state.mode = LENGTH;
        case LENGTH:
          if (state.wrap && state.flags) {
            while (bits < 32) {
              if (have === 0) {
                break inf_leave;
              }
              have--;
              hold += input[next++] << bits;
              bits += 8;
            }
            if (state.wrap & 4 && hold !== (state.total & 4294967295)) {
              strm.msg = "incorrect length check";
              state.mode = BAD;
              break;
            }
            hold = 0;
            bits = 0;
          }
          state.mode = DONE;
        case DONE:
          ret = Z_STREAM_END$1;
          break inf_leave;
        case BAD:
          ret = Z_DATA_ERROR$1;
          break inf_leave;
        case MEM:
          return Z_MEM_ERROR$1;
        case SYNC:
        default:
          return Z_STREAM_ERROR$1;
      }
    }
  strm.next_out = put;
  strm.avail_out = left;
  strm.next_in = next;
  strm.avail_in = have;
  state.hold = hold;
  state.bits = bits;
  if (state.wsize || _out !== strm.avail_out && state.mode < BAD && (state.mode < CHECK || flush !== Z_FINISH$1)) {
    if (updatewindow(strm, strm.output, strm.next_out, _out - strm.avail_out)) ;
  }
  _in -= strm.avail_in;
  _out -= strm.avail_out;
  strm.total_in += _in;
  strm.total_out += _out;
  state.total += _out;
  if (state.wrap & 4 && _out) {
    strm.adler = state.check = /*UPDATE_CHECK(state.check, strm.next_out - _out, _out);*/
    state.flags ? crc32_1(state.check, output, _out, strm.next_out - _out) : adler32_1(state.check, output, _out, strm.next_out - _out);
  }
  strm.data_type = state.bits + (state.last ? 64 : 0) + (state.mode === TYPE ? 128 : 0) + (state.mode === LEN_ || state.mode === COPY_ ? 256 : 0);
  if ((_in === 0 && _out === 0 || flush === Z_FINISH$1) && ret === Z_OK$1) {
    ret = Z_BUF_ERROR;
  }
  return ret;
};
const inflateEnd = (strm) => {
  if (inflateStateCheck(strm)) {
    return Z_STREAM_ERROR$1;
  }
  let state = strm.state;
  if (state.window) {
    state.window = null;
  }
  strm.state = null;
  return Z_OK$1;
};
const inflateGetHeader = (strm, head) => {
  if (inflateStateCheck(strm)) {
    return Z_STREAM_ERROR$1;
  }
  const state = strm.state;
  if ((state.wrap & 2) === 0) {
    return Z_STREAM_ERROR$1;
  }
  state.head = head;
  head.done = false;
  return Z_OK$1;
};
const inflateSetDictionary = (strm, dictionary) => {
  const dictLength = dictionary.length;
  let state;
  let dictid;
  let ret;
  if (inflateStateCheck(strm)) {
    return Z_STREAM_ERROR$1;
  }
  state = strm.state;
  if (state.wrap !== 0 && state.mode !== DICT) {
    return Z_STREAM_ERROR$1;
  }
  if (state.mode === DICT) {
    dictid = 1;
    dictid = adler32_1(dictid, dictionary, dictLength, 0);
    if (dictid !== state.check) {
      return Z_DATA_ERROR$1;
    }
  }
  ret = updatewindow(strm, dictionary, dictLength, dictLength);
  if (ret) {
    state.mode = MEM;
    return Z_MEM_ERROR$1;
  }
  state.havedict = 1;
  return Z_OK$1;
};
var inflateReset_1 = inflateReset;
var inflateReset2_1 = inflateReset2;
var inflateResetKeep_1 = inflateResetKeep;
var inflateInit_1 = inflateInit;
var inflateInit2_1 = inflateInit2;
var inflate_2$1 = inflate$2;
var inflateEnd_1 = inflateEnd;
var inflateGetHeader_1 = inflateGetHeader;
var inflateSetDictionary_1 = inflateSetDictionary;
var inflateInfo = "pako inflate (from Nodeca project)";
var inflate_1$2 = {
  inflateReset: inflateReset_1,
  inflateReset2: inflateReset2_1,
  inflateResetKeep: inflateResetKeep_1,
  inflateInit: inflateInit_1,
  inflateInit2: inflateInit2_1,
  inflate: inflate_2$1,
  inflateEnd: inflateEnd_1,
  inflateGetHeader: inflateGetHeader_1,
  inflateSetDictionary: inflateSetDictionary_1,
  inflateInfo
};
function GZheader() {
  this.text = 0;
  this.time = 0;
  this.xflags = 0;
  this.os = 0;
  this.extra = null;
  this.extra_len = 0;
  this.name = "";
  this.comment = "";
  this.hcrc = 0;
  this.done = false;
}
var gzheader = GZheader;
const toString = Object.prototype.toString;
const {
  Z_NO_FLUSH,
  Z_FINISH,
  Z_OK,
  Z_STREAM_END,
  Z_NEED_DICT,
  Z_STREAM_ERROR,
  Z_DATA_ERROR,
  Z_MEM_ERROR
} = constants$2;
function Inflate$1(options) {
  this.options = common.assign({
    chunkSize: 1024 * 64,
    windowBits: 15,
    to: ""
  }, options || {});
  const opt = this.options;
  if (opt.raw && opt.windowBits >= 0 && opt.windowBits < 16) {
    opt.windowBits = -opt.windowBits;
    if (opt.windowBits === 0) {
      opt.windowBits = -15;
    }
  }
  if (opt.windowBits >= 0 && opt.windowBits < 16 && !(options && options.windowBits)) {
    opt.windowBits += 32;
  }
  if (opt.windowBits > 15 && opt.windowBits < 48) {
    if ((opt.windowBits & 15) === 0) {
      opt.windowBits |= 15;
    }
  }
  this.err = 0;
  this.msg = "";
  this.ended = false;
  this.chunks = [];
  this.strm = new zstream();
  this.strm.avail_out = 0;
  let status = inflate_1$2.inflateInit2(
    this.strm,
    opt.windowBits
  );
  if (status !== Z_OK) {
    throw new Error(messages[status]);
  }
  this.header = new gzheader();
  inflate_1$2.inflateGetHeader(this.strm, this.header);
  if (opt.dictionary) {
    if (typeof opt.dictionary === "string") {
      opt.dictionary = strings.string2buf(opt.dictionary);
    } else if (toString.call(opt.dictionary) === "[object ArrayBuffer]") {
      opt.dictionary = new Uint8Array(opt.dictionary);
    }
    if (opt.raw) {
      status = inflate_1$2.inflateSetDictionary(this.strm, opt.dictionary);
      if (status !== Z_OK) {
        throw new Error(messages[status]);
      }
    }
  }
}
Inflate$1.prototype.push = function(data, flush_mode) {
  const strm = this.strm;
  const chunkSize = this.options.chunkSize;
  const dictionary = this.options.dictionary;
  let status, _flush_mode, last_avail_out;
  if (this.ended) return false;
  if (flush_mode === ~~flush_mode) _flush_mode = flush_mode;
  else _flush_mode = flush_mode === true ? Z_FINISH : Z_NO_FLUSH;
  if (toString.call(data) === "[object ArrayBuffer]") {
    strm.input = new Uint8Array(data);
  } else {
    strm.input = data;
  }
  strm.next_in = 0;
  strm.avail_in = strm.input.length;
  for (; ; ) {
    if (strm.avail_out === 0) {
      strm.output = new Uint8Array(chunkSize);
      strm.next_out = 0;
      strm.avail_out = chunkSize;
    }
    status = inflate_1$2.inflate(strm, _flush_mode);
    if (status === Z_NEED_DICT && dictionary) {
      status = inflate_1$2.inflateSetDictionary(strm, dictionary);
      if (status === Z_OK) {
        status = inflate_1$2.inflate(strm, _flush_mode);
      } else if (status === Z_DATA_ERROR) {
        status = Z_NEED_DICT;
      }
    }
    while (strm.avail_in > 0 && status === Z_STREAM_END && strm.state.wrap > 0 && data[strm.next_in] !== 0) {
      inflate_1$2.inflateReset(strm);
      status = inflate_1$2.inflate(strm, _flush_mode);
    }
    switch (status) {
      case Z_STREAM_ERROR:
      case Z_DATA_ERROR:
      case Z_NEED_DICT:
      case Z_MEM_ERROR:
        this.onEnd(status);
        this.ended = true;
        return false;
    }
    last_avail_out = strm.avail_out;
    if (strm.next_out) {
      if (strm.avail_out === 0 || status === Z_STREAM_END) {
        if (this.options.to === "string") {
          let next_out_utf8 = strings.utf8border(strm.output, strm.next_out);
          let tail = strm.next_out - next_out_utf8;
          let utf8str = strings.buf2string(strm.output, next_out_utf8);
          strm.next_out = tail;
          strm.avail_out = chunkSize - tail;
          if (tail) strm.output.set(strm.output.subarray(next_out_utf8, next_out_utf8 + tail), 0);
          this.onData(utf8str);
        } else {
          this.onData(strm.output.length === strm.next_out ? strm.output : strm.output.subarray(0, strm.next_out));
        }
      }
    }
    if (status === Z_OK && last_avail_out === 0) continue;
    if (status === Z_STREAM_END) {
      status = inflate_1$2.inflateEnd(this.strm);
      this.onEnd(status);
      this.ended = true;
      return true;
    }
    if (strm.avail_in === 0) break;
  }
  return true;
};
Inflate$1.prototype.onData = function(chunk) {
  this.chunks.push(chunk);
};
Inflate$1.prototype.onEnd = function(status) {
  if (status === Z_OK) {
    if (this.options.to === "string") {
      this.result = this.chunks.join("");
    } else {
      this.result = common.flattenChunks(this.chunks);
    }
  }
  this.chunks = [];
  this.err = status;
  this.msg = this.strm.msg;
};
function inflate$1(input, options) {
  const inflator = new Inflate$1(options);
  inflator.push(input);
  if (inflator.err) throw inflator.msg || messages[inflator.err];
  return inflator.result;
}
var Inflate_1$1 = Inflate$1;
var inflate_2 = inflate$1;
var inflate_1$1 = {
  Inflate: Inflate_1$1,
  inflate: inflate_2};
const { Inflate, inflate} = inflate_1$1;
var Inflate_1 = Inflate;
var inflate_1 = inflate;

const crcTable = [];
for (let n = 0; n < 256; n++) {
    let c = n;
    for (let k = 0; k < 8; k++) {
        if (c & 1) {
            c = 0xedb88320 ^ (c >>> 1);
        }
        else {
            c = c >>> 1;
        }
    }
    crcTable[n] = c;
}
const initialCrc = 0xffffffff;
function updateCrc(currentCrc, data, length) {
    let c = currentCrc;
    for (let n = 0; n < length; n++) {
        c = crcTable[(c ^ data[n]) & 0xff] ^ (c >>> 8);
    }
    return c;
}
function crc(data, length) {
    return (updateCrc(initialCrc, data, length) ^ initialCrc) >>> 0;
}
function checkCrc(buffer, crcLength, chunkName) {
    const expectedCrc = buffer.readUint32();
    const actualCrc = crc(new Uint8Array(buffer.buffer, buffer.byteOffset + buffer.offset - crcLength - 4, crcLength), crcLength); // "- 4" because we already advanced by reading the CRC
    if (actualCrc !== expectedCrc) {
        throw new Error(`CRC mismatch for chunk ${chunkName}. Expected ${expectedCrc}, found ${actualCrc}`);
    }
}

function unfilterNone(currentLine, newLine, bytesPerLine) {
    for (let i = 0; i < bytesPerLine; i++) {
        newLine[i] = currentLine[i];
    }
}
function unfilterSub(currentLine, newLine, bytesPerLine, bytesPerPixel) {
    let i = 0;
    for (; i < bytesPerPixel; i++) {
        // just copy first bytes
        newLine[i] = currentLine[i];
    }
    for (; i < bytesPerLine; i++) {
        newLine[i] = (currentLine[i] + newLine[i - bytesPerPixel]) & 0xff;
    }
}
function unfilterUp(currentLine, newLine, prevLine, bytesPerLine) {
    let i = 0;
    if (prevLine.length === 0) {
        // just copy bytes for first line
        for (; i < bytesPerLine; i++) {
            newLine[i] = currentLine[i];
        }
    }
    else {
        for (; i < bytesPerLine; i++) {
            newLine[i] = (currentLine[i] + prevLine[i]) & 0xff;
        }
    }
}
function unfilterAverage(currentLine, newLine, prevLine, bytesPerLine, bytesPerPixel) {
    let i = 0;
    if (prevLine.length === 0) {
        for (; i < bytesPerPixel; i++) {
            newLine[i] = currentLine[i];
        }
        for (; i < bytesPerLine; i++) {
            newLine[i] = (currentLine[i] + (newLine[i - bytesPerPixel] >> 1)) & 0xff;
        }
    }
    else {
        for (; i < bytesPerPixel; i++) {
            newLine[i] = (currentLine[i] + (prevLine[i] >> 1)) & 0xff;
        }
        for (; i < bytesPerLine; i++) {
            newLine[i] =
                (currentLine[i] + ((newLine[i - bytesPerPixel] + prevLine[i]) >> 1)) &
                    0xff;
        }
    }
}
function unfilterPaeth(currentLine, newLine, prevLine, bytesPerLine, bytesPerPixel) {
    let i = 0;
    if (prevLine.length === 0) {
        for (; i < bytesPerPixel; i++) {
            newLine[i] = currentLine[i];
        }
        for (; i < bytesPerLine; i++) {
            newLine[i] = (currentLine[i] + newLine[i - bytesPerPixel]) & 0xff;
        }
    }
    else {
        for (; i < bytesPerPixel; i++) {
            newLine[i] = (currentLine[i] + prevLine[i]) & 0xff;
        }
        for (; i < bytesPerLine; i++) {
            newLine[i] =
                (currentLine[i] +
                    paethPredictor(newLine[i - bytesPerPixel], prevLine[i], prevLine[i - bytesPerPixel])) &
                    0xff;
        }
    }
}
function paethPredictor(a, b, c) {
    const p = a + b - c;
    const pa = Math.abs(p - a);
    const pb = Math.abs(p - b);
    const pc = Math.abs(p - c);
    if (pa <= pb && pa <= pc)
        return a;
    else if (pb <= pc)
        return b;
    else
        return c;
}

/**
 * Apllies filter on scanline based on the filter type.
 * @param filterType - The filter type to apply.
 * @param currentLine - The current line of pixel data.
 * @param newLine - The new line of pixel data.
 * @param prevLine - The previous line of pixel data.
 * @param passLineBytes - The number of bytes in the pass line.
 * @param bytesPerPixel - The number of bytes per pixel.
 */
function applyUnfilter(filterType, currentLine, newLine, prevLine, passLineBytes, bytesPerPixel) {
    switch (filterType) {
        case 0:
            unfilterNone(currentLine, newLine, passLineBytes);
            break;
        case 1:
            unfilterSub(currentLine, newLine, passLineBytes, bytesPerPixel);
            break;
        case 2:
            unfilterUp(currentLine, newLine, prevLine, passLineBytes);
            break;
        case 3:
            unfilterAverage(currentLine, newLine, prevLine, passLineBytes, bytesPerPixel);
            break;
        case 4:
            unfilterPaeth(currentLine, newLine, prevLine, passLineBytes, bytesPerPixel);
            break;
        default:
            throw new Error(`Unsupported filter: ${filterType}`);
    }
}

const uint16$1 = new Uint16Array([0x00ff]);
const uint8$1 = new Uint8Array(uint16$1.buffer);
const osIsLittleEndian$1 = uint8$1[0] === 0xff;
/**
 * Decodes the Adam7 interlaced PNG data.
 *
 * @param params - DecodeInterlaceNullParams
 * @returns - array of pixel data.
 */
function decodeInterlaceAdam7(params) {
    const { data, width, height, channels, depth } = params;
    // Adam7 interlacing pattern
    const passes = [
        { x: 0, y: 0, xStep: 8, yStep: 8 }, // Pass 1
        { x: 4, y: 0, xStep: 8, yStep: 8 }, // Pass 2
        { x: 0, y: 4, xStep: 4, yStep: 8 }, // Pass 3
        { x: 2, y: 0, xStep: 4, yStep: 4 }, // Pass 4
        { x: 0, y: 2, xStep: 2, yStep: 4 }, // Pass 5
        { x: 1, y: 0, xStep: 2, yStep: 2 }, // Pass 6
        { x: 0, y: 1, xStep: 1, yStep: 2 }, // Pass 7
    ];
    const bytesPerPixel = Math.ceil(depth / 8) * channels;
    const resultData = new Uint8Array(height * width * bytesPerPixel);
    let offset = 0;
    // Process each pass
    for (let passIndex = 0; passIndex < 7; passIndex++) {
        const pass = passes[passIndex];
        // Calculate pass dimensions
        const passWidth = Math.ceil((width - pass.x) / pass.xStep);
        const passHeight = Math.ceil((height - pass.y) / pass.yStep);
        if (passWidth <= 0 || passHeight <= 0)
            continue;
        const passLineBytes = passWidth * bytesPerPixel;
        const prevLine = new Uint8Array(passLineBytes);
        // Process each scanline in this pass
        for (let y = 0; y < passHeight; y++) {
            // First byte is the filter type
            const filterType = data[offset++];
            const currentLine = data.subarray(offset, offset + passLineBytes);
            offset += passLineBytes;
            // Create a new line for the unfiltered data
            const newLine = new Uint8Array(passLineBytes);
            // Apply the appropriate unfilter
            applyUnfilter(filterType, currentLine, newLine, prevLine, passLineBytes, bytesPerPixel);
            prevLine.set(newLine);
            for (let x = 0; x < passWidth; x++) {
                const outputX = pass.x + x * pass.xStep;
                const outputY = pass.y + y * pass.yStep;
                if (outputX >= width || outputY >= height)
                    continue;
                for (let i = 0; i < bytesPerPixel; i++) {
                    resultData[(outputY * width + outputX) * bytesPerPixel + i] =
                        newLine[x * bytesPerPixel + i];
                }
            }
        }
    }
    if (depth === 16) {
        const uint16Data = new Uint16Array(resultData.buffer);
        if (osIsLittleEndian$1) {
            for (let k = 0; k < uint16Data.length; k++) {
                // PNG is always big endian. Swap the bytes.
                uint16Data[k] = swap16$1(uint16Data[k]);
            }
        }
        return uint16Data;
    }
    else {
        return resultData;
    }
}
function swap16$1(val) {
    return ((val & 0xff) << 8) | ((val >> 8) & 0xff);
}

const uint16 = new Uint16Array([0x00ff]);
const uint8 = new Uint8Array(uint16.buffer);
const osIsLittleEndian = uint8[0] === 0xff;
const empty = new Uint8Array(0);
function decodeInterlaceNull(params) {
    const { data, width, height, channels, depth } = params;
    const bytesPerPixel = Math.ceil(depth / 8) * channels;
    const bytesPerLine = Math.ceil((depth / 8) * channels * width);
    const newData = new Uint8Array(height * bytesPerLine);
    let prevLine = empty;
    let offset = 0;
    let currentLine;
    let newLine;
    for (let i = 0; i < height; i++) {
        currentLine = data.subarray(offset + 1, offset + 1 + bytesPerLine);
        newLine = newData.subarray(i * bytesPerLine, (i + 1) * bytesPerLine);
        switch (data[offset]) {
            case 0:
                unfilterNone(currentLine, newLine, bytesPerLine);
                break;
            case 1:
                unfilterSub(currentLine, newLine, bytesPerLine, bytesPerPixel);
                break;
            case 2:
                unfilterUp(currentLine, newLine, prevLine, bytesPerLine);
                break;
            case 3:
                unfilterAverage(currentLine, newLine, prevLine, bytesPerLine, bytesPerPixel);
                break;
            case 4:
                unfilterPaeth(currentLine, newLine, prevLine, bytesPerLine, bytesPerPixel);
                break;
            default:
                throw new Error(`Unsupported filter: ${data[offset]}`);
        }
        prevLine = newLine;
        offset += bytesPerLine + 1;
    }
    if (depth === 16) {
        const uint16Data = new Uint16Array(newData.buffer);
        if (osIsLittleEndian) {
            for (let k = 0; k < uint16Data.length; k++) {
                // PNG is always big endian. Swap the bytes.
                uint16Data[k] = swap16(uint16Data[k]);
            }
        }
        return uint16Data;
    }
    else {
        return newData;
    }
}
function swap16(val) {
    return ((val & 0xff) << 8) | ((val >> 8) & 0xff);
}

// https://www.w3.org/TR/PNG/#5PNG-file-signature
const pngSignature = Uint8Array.of(137, 80, 78, 71, 13, 10, 26, 10);
function checkSignature(buffer) {
    if (!hasPngSignature(buffer.readBytes(pngSignature.length))) {
        throw new Error('wrong PNG signature');
    }
}
function hasPngSignature(array) {
    if (array.length < pngSignature.length) {
        return false;
    }
    for (let i = 0; i < pngSignature.length; i++) {
        if (array[i] !== pngSignature[i]) {
            return false;
        }
    }
    return true;
}

// https://www.w3.org/TR/png/#11tEXt
const textChunkName = 'tEXt';
const NULL = 0;
const latin1Decoder = new TextDecoder('latin1');
function validateKeyword(keyword) {
    validateLatin1(keyword);
    if (keyword.length === 0 || keyword.length > 79) {
        throw new Error('keyword length must be between 1 and 79');
    }
}
// eslint-disable-next-line no-control-regex
const latin1Regex = /^[\u0000-\u00FF]*$/;
function validateLatin1(text) {
    if (!latin1Regex.test(text)) {
        throw new Error('invalid latin1 text');
    }
}
function decodetEXt(text, buffer, length) {
    const keyword = readKeyword(buffer);
    text[keyword] = readLatin1(buffer, length - keyword.length - 1);
}
// https://www.w3.org/TR/png/#11keywords
function readKeyword(buffer) {
    buffer.mark();
    while (buffer.readByte() !== NULL) {
        /* advance */
    }
    const end = buffer.offset;
    buffer.reset();
    const keyword = latin1Decoder.decode(buffer.readBytes(end - buffer.offset - 1));
    // NULL
    buffer.skip(1);
    validateKeyword(keyword);
    return keyword;
}
function readLatin1(buffer, length) {
    return latin1Decoder.decode(buffer.readBytes(length));
}

const ColorType = {
    UNKNOWN: -1,
    GREYSCALE: 0,
    TRUECOLOUR: 2,
    INDEXED_COLOUR: 3,
    GREYSCALE_ALPHA: 4,
    TRUECOLOUR_ALPHA: 6,
};
const CompressionMethod = {
    UNKNOWN: -1,
    DEFLATE: 0,
};
const FilterMethod = {
    UNKNOWN: -1,
    ADAPTIVE: 0,
};
const InterlaceMethod = {
    UNKNOWN: -1,
    NO_INTERLACE: 0,
    ADAM7: 1,
};
const DisposeOpType = {
    NONE: 0,
    BACKGROUND: 1,
    PREVIOUS: 2,
};
const BlendOpType = {
    SOURCE: 0,
    OVER: 1,
};

class PngDecoder extends IOBuffer {
    _checkCrc;
    _inflator;
    _png;
    _apng;
    _end;
    _hasPalette;
    _palette;
    _hasTransparency;
    _transparency;
    _compressionMethod;
    _filterMethod;
    _interlaceMethod;
    _colorType;
    _isAnimated;
    _numberOfFrames;
    _numberOfPlays;
    _frames;
    _writingDataChunks;
    constructor(data, options = {}) {
        super(data);
        const { checkCrc = false } = options;
        this._checkCrc = checkCrc;
        this._inflator = new Inflate_1();
        this._png = {
            width: -1,
            height: -1,
            channels: -1,
            data: new Uint8Array(0),
            depth: 1,
            text: {},
        };
        this._apng = {
            width: -1,
            height: -1,
            channels: -1,
            depth: 1,
            numberOfFrames: 1,
            numberOfPlays: 0,
            text: {},
            frames: [],
        };
        this._end = false;
        this._hasPalette = false;
        this._palette = [];
        this._hasTransparency = false;
        this._transparency = new Uint16Array(0);
        this._compressionMethod = CompressionMethod.UNKNOWN;
        this._filterMethod = FilterMethod.UNKNOWN;
        this._interlaceMethod = InterlaceMethod.UNKNOWN;
        this._colorType = ColorType.UNKNOWN;
        this._isAnimated = false;
        this._numberOfFrames = 1;
        this._numberOfPlays = 0;
        this._frames = [];
        this._writingDataChunks = false;
        // PNG is always big endian
        // https://www.w3.org/TR/PNG/#7Integers-and-byte-order
        this.setBigEndian();
    }
    decode() {
        checkSignature(this);
        while (!this._end) {
            const length = this.readUint32();
            const type = this.readChars(4);
            this.decodeChunk(length, type);
        }
        this.decodeImage();
        return this._png;
    }
    decodeApng() {
        checkSignature(this);
        while (!this._end) {
            const length = this.readUint32();
            const type = this.readChars(4);
            this.decodeApngChunk(length, type);
        }
        this.decodeApngImage();
        return this._apng;
    }
    // https://www.w3.org/TR/PNG/#5Chunk-layout
    decodeChunk(length, type) {
        const offset = this.offset;
        switch (type) {
            // 11.2 Critical chunks
            case 'IHDR': // 11.2.2 IHDR Image header
                this.decodeIHDR();
                break;
            case 'PLTE': // 11.2.3 PLTE Palette
                this.decodePLTE(length);
                break;
            case 'IDAT': // 11.2.4 IDAT Image data
                this.decodeIDAT(length);
                break;
            case 'IEND': // 11.2.5 IEND Image trailer
                this._end = true;
                break;
            // 11.3 Ancillary chunks
            case 'tRNS': // 11.3.2.1 tRNS Transparency
                this.decodetRNS(length);
                break;
            case 'iCCP': // 11.3.3.3 iCCP Embedded ICC profile
                this.decodeiCCP(length);
                break;
            case textChunkName: // 11.3.4.3 tEXt Textual data
                decodetEXt(this._png.text, this, length);
                break;
            case 'pHYs': // 11.3.5.3 pHYs Physical pixel dimensions
                this.decodepHYs();
                break;
            default:
                this.skip(length);
                break;
        }
        if (this.offset - offset !== length) {
            throw new Error(`Length mismatch while decoding chunk ${type}`);
        }
        if (this._checkCrc) {
            checkCrc(this, length + 4, type);
        }
        else {
            this.skip(4);
        }
    }
    decodeApngChunk(length, type) {
        const offset = this.offset;
        if (type !== 'fdAT' && type !== 'IDAT' && this._writingDataChunks) {
            this.pushDataToFrame();
        }
        switch (type) {
            case 'acTL':
                this.decodeACTL();
                break;
            case 'fcTL':
                this.decodeFCTL();
                break;
            case 'fdAT':
                this.decodeFDAT(length);
                break;
            default:
                this.decodeChunk(length, type);
                this.offset = offset + length;
                break;
        }
        if (this.offset - offset !== length) {
            throw new Error(`Length mismatch while decoding chunk ${type}`);
        }
        if (this._checkCrc) {
            checkCrc(this, length + 4, type);
        }
        else {
            this.skip(4);
        }
    }
    // https://www.w3.org/TR/PNG/#11IHDR
    decodeIHDR() {
        const image = this._png;
        image.width = this.readUint32();
        image.height = this.readUint32();
        image.depth = checkBitDepth(this.readUint8());
        const colorType = this.readUint8();
        this._colorType = colorType;
        let channels;
        switch (colorType) {
            case ColorType.GREYSCALE:
                channels = 1;
                break;
            case ColorType.TRUECOLOUR:
                channels = 3;
                break;
            case ColorType.INDEXED_COLOUR:
                channels = 1;
                break;
            case ColorType.GREYSCALE_ALPHA:
                channels = 2;
                break;
            case ColorType.TRUECOLOUR_ALPHA:
                channels = 4;
                break;
            // Kept for exhaustiveness.
            // eslint-disable-next-line unicorn/no-useless-switch-case
            case ColorType.UNKNOWN:
            default:
                throw new Error(`Unknown color type: ${colorType}`);
        }
        this._png.channels = channels;
        this._compressionMethod = this.readUint8();
        if (this._compressionMethod !== CompressionMethod.DEFLATE) {
            throw new Error(`Unsupported compression method: ${this._compressionMethod}`);
        }
        this._filterMethod = this.readUint8();
        this._interlaceMethod = this.readUint8();
    }
    decodeACTL() {
        this._numberOfFrames = this.readUint32();
        this._numberOfPlays = this.readUint32();
        this._isAnimated = true;
    }
    decodeFCTL() {
        const image = {
            sequenceNumber: this.readUint32(),
            width: this.readUint32(),
            height: this.readUint32(),
            xOffset: this.readUint32(),
            yOffset: this.readUint32(),
            delayNumber: this.readUint16(),
            delayDenominator: this.readUint16(),
            disposeOp: this.readUint8(),
            blendOp: this.readUint8(),
            data: new Uint8Array(0),
        };
        this._frames.push(image);
    }
    // https://www.w3.org/TR/PNG/#11PLTE
    decodePLTE(length) {
        if (length % 3 !== 0) {
            throw new RangeError(`PLTE field length must be a multiple of 3. Got ${length}`);
        }
        const l = length / 3;
        this._hasPalette = true;
        const palette = [];
        this._palette = palette;
        for (let i = 0; i < l; i++) {
            palette.push([this.readUint8(), this.readUint8(), this.readUint8()]);
        }
    }
    // https://www.w3.org/TR/PNG/#11IDAT
    decodeIDAT(length) {
        this._writingDataChunks = true;
        const dataLength = length;
        const dataOffset = this.offset + this.byteOffset;
        this._inflator.push(new Uint8Array(this.buffer, dataOffset, dataLength));
        if (this._inflator.err) {
            throw new Error(`Error while decompressing the data: ${this._inflator.err}`);
        }
        this.skip(length);
    }
    decodeFDAT(length) {
        this._writingDataChunks = true;
        let dataLength = length;
        let dataOffset = this.offset + this.byteOffset;
        dataOffset += 4;
        dataLength -= 4;
        this._inflator.push(new Uint8Array(this.buffer, dataOffset, dataLength));
        if (this._inflator.err) {
            throw new Error(`Error while decompressing the data: ${this._inflator.err}`);
        }
        this.skip(length);
    }
    // https://www.w3.org/TR/PNG/#11tRNS
    decodetRNS(length) {
        switch (this._colorType) {
            case ColorType.GREYSCALE:
            case ColorType.TRUECOLOUR: {
                if (length % 2 !== 0) {
                    throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${length}`);
                }
                if (length / 2 > this._png.width * this._png.height) {
                    throw new Error(`tRNS chunk contains more alpha values than there are pixels (${length / 2} vs ${this._png.width * this._png.height})`);
                }
                this._hasTransparency = true;
                this._transparency = new Uint16Array(length / 2);
                for (let i = 0; i < length / 2; i++) {
                    this._transparency[i] = this.readUint16();
                }
                break;
            }
            case ColorType.INDEXED_COLOUR: {
                if (length > this._palette.length) {
                    throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${length} vs ${this._palette.length})`);
                }
                let i = 0;
                for (; i < length; i++) {
                    const alpha = this.readByte();
                    this._palette[i].push(alpha);
                }
                for (; i < this._palette.length; i++) {
                    this._palette[i].push(255);
                }
                break;
            }
            // Kept for exhaustiveness.
            /* eslint-disable unicorn/no-useless-switch-case */
            case ColorType.UNKNOWN:
            case ColorType.GREYSCALE_ALPHA:
            case ColorType.TRUECOLOUR_ALPHA:
            default: {
                throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`);
            }
            /* eslint-enable unicorn/no-useless-switch-case */
        }
    }
    // https://www.w3.org/TR/PNG/#11iCCP
    decodeiCCP(length) {
        const name = readKeyword(this);
        const compressionMethod = this.readUint8();
        if (compressionMethod !== CompressionMethod.DEFLATE) {
            throw new Error(`Unsupported iCCP compression method: ${compressionMethod}`);
        }
        const compressedProfile = this.readBytes(length - name.length - 2);
        this._png.iccEmbeddedProfile = {
            name,
            profile: inflate_1(compressedProfile),
        };
    }
    // https://www.w3.org/TR/PNG/#11pHYs
    decodepHYs() {
        const ppuX = this.readUint32();
        const ppuY = this.readUint32();
        const unitSpecifier = this.readByte();
        this._png.resolution = { x: ppuX, y: ppuY, unit: unitSpecifier };
    }
    decodeApngImage() {
        this._apng.width = this._png.width;
        this._apng.height = this._png.height;
        this._apng.channels = this._png.channels;
        this._apng.depth = this._png.depth;
        this._apng.numberOfFrames = this._numberOfFrames;
        this._apng.numberOfPlays = this._numberOfPlays;
        this._apng.text = this._png.text;
        this._apng.resolution = this._png.resolution;
        for (let i = 0; i < this._numberOfFrames; i++) {
            const newFrame = {
                sequenceNumber: this._frames[i].sequenceNumber,
                delayNumber: this._frames[i].delayNumber,
                delayDenominator: this._frames[i].delayDenominator,
                data: this._apng.depth === 8
                    ? new Uint8Array(this._apng.width * this._apng.height * this._apng.channels)
                    : new Uint16Array(this._apng.width * this._apng.height * this._apng.channels),
            };
            const frame = this._frames.at(i);
            if (frame) {
                frame.data = decodeInterlaceNull({
                    data: frame.data,
                    width: frame.width,
                    height: frame.height,
                    channels: this._apng.channels,
                    depth: this._apng.depth,
                });
                if (this._hasPalette) {
                    this._apng.palette = this._palette;
                }
                if (this._hasTransparency) {
                    this._apng.transparency = this._transparency;
                }
                if (i === 0 ||
                    (frame.xOffset === 0 &&
                        frame.yOffset === 0 &&
                        frame.width === this._png.width &&
                        frame.height === this._png.height)) {
                    newFrame.data = frame.data;
                }
                else {
                    const prevFrame = this._apng.frames.at(i - 1);
                    this.disposeFrame(frame, prevFrame, newFrame);
                    this.addFrameDataToCanvas(newFrame, frame);
                }
                this._apng.frames.push(newFrame);
            }
        }
        return this._apng;
    }
    disposeFrame(frame, prevFrame, imageFrame) {
        switch (frame.disposeOp) {
            case DisposeOpType.NONE:
                break;
            case DisposeOpType.BACKGROUND:
                for (let row = 0; row < this._png.height; row++) {
                    for (let col = 0; col < this._png.width; col++) {
                        const index = (row * frame.width + col) * this._png.channels;
                        for (let channel = 0; channel < this._png.channels; channel++) {
                            imageFrame.data[index + channel] = 0;
                        }
                    }
                }
                break;
            case DisposeOpType.PREVIOUS:
                imageFrame.data.set(prevFrame.data);
                break;
            default:
                throw new Error('Unknown disposeOp');
        }
    }
    addFrameDataToCanvas(imageFrame, frame) {
        const maxValue = 1 << this._png.depth;
        const calculatePixelIndices = (row, col) => {
            const index = ((row + frame.yOffset) * this._png.width + frame.xOffset + col) *
                this._png.channels;
            const frameIndex = (row * frame.width + col) * this._png.channels;
            return { index, frameIndex };
        };
        switch (frame.blendOp) {
            case BlendOpType.SOURCE:
                for (let row = 0; row < frame.height; row++) {
                    for (let col = 0; col < frame.width; col++) {
                        const { index, frameIndex } = calculatePixelIndices(row, col);
                        for (let channel = 0; channel < this._png.channels; channel++) {
                            imageFrame.data[index + channel] =
                                frame.data[frameIndex + channel];
                        }
                    }
                }
                break;
            // https://www.w3.org/TR/png-3/#13Alpha-channel-processing
            case BlendOpType.OVER:
                for (let row = 0; row < frame.height; row++) {
                    for (let col = 0; col < frame.width; col++) {
                        const { index, frameIndex } = calculatePixelIndices(row, col);
                        for (let channel = 0; channel < this._png.channels; channel++) {
                            const sourceAlpha = frame.data[frameIndex + this._png.channels - 1] / maxValue;
                            const foregroundValue = channel % (this._png.channels - 1) === 0
                                ? 1
                                : frame.data[frameIndex + channel];
                            const value = Math.floor(sourceAlpha * foregroundValue +
                                (1 - sourceAlpha) * imageFrame.data[index + channel]);
                            imageFrame.data[index + channel] += value;
                        }
                    }
                }
                break;
            default:
                throw new Error('Unknown blendOp');
        }
    }
    decodeImage() {
        if (this._inflator.err) {
            throw new Error(`Error while decompressing the data: ${this._inflator.err}`);
        }
        const data = this._isAnimated
            ? (this._frames?.at(0)).data
            : this._inflator.result;
        if (this._filterMethod !== FilterMethod.ADAPTIVE) {
            throw new Error(`Filter method ${this._filterMethod} not supported`);
        }
        if (this._interlaceMethod === InterlaceMethod.NO_INTERLACE) {
            this._png.data = decodeInterlaceNull({
                data: data,
                width: this._png.width,
                height: this._png.height,
                channels: this._png.channels,
                depth: this._png.depth,
            });
        }
        else if (this._interlaceMethod === InterlaceMethod.ADAM7) {
            this._png.data = decodeInterlaceAdam7({
                data: data,
                width: this._png.width,
                height: this._png.height,
                channels: this._png.channels,
                depth: this._png.depth,
            });
        }
        else {
            throw new Error(`Interlace method ${this._interlaceMethod} not supported`);
        }
        if (this._hasPalette) {
            this._png.palette = this._palette;
        }
        if (this._hasTransparency) {
            this._png.transparency = this._transparency;
        }
    }
    pushDataToFrame() {
        const result = this._inflator.result;
        const lastFrame = this._frames.at(-1);
        if (lastFrame) {
            lastFrame.data = result;
        }
        else {
            this._frames.push({
                sequenceNumber: 0,
                width: this._png.width,
                height: this._png.height,
                xOffset: 0,
                yOffset: 0,
                delayNumber: 0,
                delayDenominator: 0,
                disposeOp: DisposeOpType.NONE,
                blendOp: BlendOpType.SOURCE,
                data: result,
            });
        }
        this._inflator = new Inflate_1();
        this._writingDataChunks = false;
    }
}
function checkBitDepth(value) {
    if (value !== 1 &&
        value !== 2 &&
        value !== 4 &&
        value !== 8 &&
        value !== 16) {
        throw new Error(`invalid bit depth: ${value}`);
    }
    return value;
}

var ResolutionUnitSpecifier;
(function (ResolutionUnitSpecifier) {
    /**
     * Unit is unknown
     */
    ResolutionUnitSpecifier[ResolutionUnitSpecifier["UNKNOWN"] = 0] = "UNKNOWN";
    /**
     * Unit is the metre
     */
    ResolutionUnitSpecifier[ResolutionUnitSpecifier["METRE"] = 1] = "METRE";
})(ResolutionUnitSpecifier || (ResolutionUnitSpecifier = {}));

function decodePng(data, options) {
    const decoder = new PngDecoder(data, options);
    return decoder.decode();
}

var i = /* @__PURE__ */ function() {
  return "undefined" != typeof window ? window : "undefined" != typeof globalThis ? globalThis : "undefined" != typeof self ? self : this;
}();
function a() {
  i.console && "function" == typeof i.console.log && i.console.log.apply(i.console, arguments);
}
var o = { log: a, warn: function(t3) {
  i.console && ("function" == typeof i.console.warn ? i.console.warn.apply(i.console, arguments) : a.call(null, arguments));
}, error: function(t3) {
  i.console && ("function" == typeof i.console.error ? i.console.error.apply(i.console, arguments) : a(t3));
} };
function s(t3, e2, n2) {
  var r2 = new XMLHttpRequest();
  r2.open("GET", t3), r2.responseType = "blob", r2.onload = function() {
    l(r2.response, e2, n2);
  }, r2.onerror = function() {
    o.error("could not download file");
  }, r2.send();
}
function u(t3) {
  var e2 = new XMLHttpRequest();
  e2.open("HEAD", t3, false);
  try {
    e2.send();
  } catch (n2) {
  }
  return e2.status >= 200 && e2.status <= 299;
}
function c(t3) {
  try {
    t3.dispatchEvent(new MouseEvent("click"));
  } catch (n2) {
    var e2 = document.createEvent("MouseEvents");
    e2.initMouseEvent("click", true, true, window, 0, 0, 0, 80, 20, false, false, false, false, 0, null), t3.dispatchEvent(e2);
  }
}
var l = i.saveAs || ("object" !== ("undefined" == typeof window ? "undefined" : _typeof(window)) || window !== i ? function() {
} : "undefined" != typeof HTMLAnchorElement && "download" in HTMLAnchorElement.prototype ? function(t3, e2, n2) {
  var r2 = i.URL || i.webkitURL, a2 = document.createElement("a");
  e2 = e2 || t3.name || "download", a2.download = e2, a2.rel = "noopener", "string" == typeof t3 ? (a2.href = t3, a2.origin !== location.origin ? u(a2.href) ? s(t3, e2, n2) : c(a2, a2.target = "_blank") : c(a2)) : (a2.href = r2.createObjectURL(t3), setTimeout(function() {
    r2.revokeObjectURL(a2.href);
  }, 4e4), setTimeout(function() {
    c(a2);
  }, 0));
} : "msSaveOrOpenBlob" in navigator ? function(e2, n2, r2) {
  if (n2 = n2 || e2.name || "download", "string" == typeof e2) if (u(e2)) s(e2, n2, r2);
  else {
    var i2 = document.createElement("a");
    i2.href = e2, i2.target = "_blank", setTimeout(function() {
      c(i2);
    });
  }
  else navigator.msSaveOrOpenBlob(function(e3, n3) {
    return void 0 === n3 ? n3 = { autoBom: false } : "object" !== _typeof(n3) && (o.warn("Deprecated: Expected third argument to be a object"), n3 = { autoBom: !n3 }), n3.autoBom && /^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e3.type) ? new Blob([String.fromCharCode(65279), e3], { type: e3.type }) : e3;
  }(e2, r2), n2);
} : function(e2, n2, r2, a2) {
  if ((a2 = a2 || open("", "_blank")) && (a2.document.title = a2.document.body.innerText = "downloading..."), "string" == typeof e2) return s(e2, n2, r2);
  var o2 = "application/octet-stream" === e2.type, u2 = /constructor/i.test(i.HTMLElement) || i.safari, c2 = /CriOS\/[\d]+/.test(navigator.userAgent);
  if ((c2 || o2 && u2) && "object" === ("undefined" == typeof FileReader ? "undefined" : _typeof(FileReader))) {
    var l2 = new FileReader();
    l2.onloadend = function() {
      var t3 = l2.result;
      t3 = c2 ? t3 : t3.replace(/^data:[^;]*;/, "data:attachment/file;"), a2 ? a2.location.href = t3 : location = t3, a2 = null;
    }, l2.readAsDataURL(e2);
  } else {
    var h2 = i.URL || i.webkitURL, f2 = h2.createObjectURL(e2);
    a2 ? a2.location = f2 : location.href = f2, a2 = null, setTimeout(function() {
      h2.revokeObjectURL(f2);
    }, 4e4);
  }
});
/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */
function h(t3) {
  var e2;
  t3 = t3 || "", this.ok = false, "#" == t3.charAt(0) && (t3 = t3.substr(1, 6)), t3 = { aliceblue: "f0f8ff", antiquewhite: "faebd7", aqua: "00ffff", aquamarine: "7fffd4", azure: "f0ffff", beige: "f5f5dc", bisque: "ffe4c4", black: "000000", blanchedalmond: "ffebcd", blue: "0000ff", blueviolet: "8a2be2", brown: "a52a2a", burlywood: "deb887", cadetblue: "5f9ea0", chartreuse: "7fff00", chocolate: "d2691e", coral: "ff7f50", cornflowerblue: "6495ed", cornsilk: "fff8dc", crimson: "dc143c", cyan: "00ffff", darkblue: "00008b", darkcyan: "008b8b", darkgoldenrod: "b8860b", darkgray: "a9a9a9", darkgreen: "006400", darkkhaki: "bdb76b", darkmagenta: "8b008b", darkolivegreen: "556b2f", darkorange: "ff8c00", darkorchid: "9932cc", darkred: "8b0000", darksalmon: "e9967a", darkseagreen: "8fbc8f", darkslateblue: "483d8b", darkslategray: "2f4f4f", darkturquoise: "00ced1", darkviolet: "9400d3", deeppink: "ff1493", deepskyblue: "00bfff", dimgray: "696969", dodgerblue: "1e90ff", feldspar: "d19275", firebrick: "b22222", floralwhite: "fffaf0", forestgreen: "228b22", fuchsia: "ff00ff", gainsboro: "dcdcdc", ghostwhite: "f8f8ff", gold: "ffd700", goldenrod: "daa520", gray: "808080", green: "008000", greenyellow: "adff2f", honeydew: "f0fff0", hotpink: "ff69b4", indianred: "cd5c5c", indigo: "4b0082", ivory: "fffff0", khaki: "f0e68c", lavender: "e6e6fa", lavenderblush: "fff0f5", lawngreen: "7cfc00", lemonchiffon: "fffacd", lightblue: "add8e6", lightcoral: "f08080", lightcyan: "e0ffff", lightgoldenrodyellow: "fafad2", lightgrey: "d3d3d3", lightgreen: "90ee90", lightpink: "ffb6c1", lightsalmon: "ffa07a", lightseagreen: "20b2aa", lightskyblue: "87cefa", lightslateblue: "8470ff", lightslategray: "778899", lightsteelblue: "b0c4de", lightyellow: "ffffe0", lime: "00ff00", limegreen: "32cd32", linen: "faf0e6", magenta: "ff00ff", maroon: "800000", mediumaquamarine: "66cdaa", mediumblue: "0000cd", mediumorchid: "ba55d3", mediumpurple: "9370d8", mediumseagreen: "3cb371", mediumslateblue: "7b68ee", mediumspringgreen: "00fa9a", mediumturquoise: "48d1cc", mediumvioletred: "c71585", midnightblue: "191970", mintcream: "f5fffa", mistyrose: "ffe4e1", moccasin: "ffe4b5", navajowhite: "ffdead", navy: "000080", oldlace: "fdf5e6", olive: "808000", olivedrab: "6b8e23", orange: "ffa500", orangered: "ff4500", orchid: "da70d6", palegoldenrod: "eee8aa", palegreen: "98fb98", paleturquoise: "afeeee", palevioletred: "d87093", papayawhip: "ffefd5", peachpuff: "ffdab9", peru: "cd853f", pink: "ffc0cb", plum: "dda0dd", powderblue: "b0e0e6", purple: "800080", red: "ff0000", rosybrown: "bc8f8f", royalblue: "4169e1", saddlebrown: "8b4513", salmon: "fa8072", sandybrown: "f4a460", seagreen: "2e8b57", seashell: "fff5ee", sienna: "a0522d", silver: "c0c0c0", skyblue: "87ceeb", slateblue: "6a5acd", slategray: "708090", snow: "fffafa", springgreen: "00ff7f", steelblue: "4682b4", tan: "d2b48c", teal: "008080", thistle: "d8bfd8", tomato: "ff6347", turquoise: "40e0d0", violet: "ee82ee", violetred: "d02090", wheat: "f5deb3", white: "ffffff", whitesmoke: "f5f5f5", yellow: "ffff00", yellowgreen: "9acd32" }[t3 = (t3 = t3.replace(/ /g, "")).toLowerCase()] || t3;
  for (var n2 = [{ re: /^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/, example: ["rgb(123, 234, 45)", "rgb(255,234,245)"], process: function(t4) {
    return [parseInt(t4[1]), parseInt(t4[2]), parseInt(t4[3])];
  } }, { re: /^(\w{2})(\w{2})(\w{2})$/, example: ["#00ff00", "336699"], process: function(t4) {
    return [parseInt(t4[1], 16), parseInt(t4[2], 16), parseInt(t4[3], 16)];
  } }, { re: /^(\w{1})(\w{1})(\w{1})$/, example: ["#fb0", "f0f"], process: function(t4) {
    return [parseInt(t4[1] + t4[1], 16), parseInt(t4[2] + t4[2], 16), parseInt(t4[3] + t4[3], 16)];
  } }], r2 = 0; r2 < n2.length; r2++) {
    var i2 = n2[r2].re, a2 = n2[r2].process, o2 = i2.exec(t3);
    o2 && (e2 = a2(o2), this.r = e2[0], this.g = e2[1], this.b = e2[2], this.ok = true);
  }
  this.r = this.r < 0 || isNaN(this.r) ? 0 : this.r > 255 ? 255 : this.r, this.g = this.g < 0 || isNaN(this.g) ? 0 : this.g > 255 ? 255 : this.g, this.b = this.b < 0 || isNaN(this.b) ? 0 : this.b > 255 ? 255 : this.b, this.toRGB = function() {
    return "rgb(" + this.r + ", " + this.g + ", " + this.b + ")";
  }, this.toHex = function() {
    var t4 = this.r.toString(16), e3 = this.g.toString(16), n3 = this.b.toString(16);
    return 1 == t4.length && (t4 = "0" + t4), 1 == e3.length && (e3 = "0" + e3), 1 == n3.length && (n3 = "0" + n3), "#" + t4 + e3 + n3;
  };
}
var f = i.atob.bind(i), d = i.btoa.bind(i);
/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */
function p(t3, e2) {
  var n2 = t3[0], r2 = t3[1], i2 = t3[2], a2 = t3[3];
  n2 = m(n2, r2, i2, a2, e2[0], 7, -680876936), a2 = m(a2, n2, r2, i2, e2[1], 12, -389564586), i2 = m(i2, a2, n2, r2, e2[2], 17, 606105819), r2 = m(r2, i2, a2, n2, e2[3], 22, -1044525330), n2 = m(n2, r2, i2, a2, e2[4], 7, -176418897), a2 = m(a2, n2, r2, i2, e2[5], 12, 1200080426), i2 = m(i2, a2, n2, r2, e2[6], 17, -1473231341), r2 = m(r2, i2, a2, n2, e2[7], 22, -45705983), n2 = m(n2, r2, i2, a2, e2[8], 7, 1770035416), a2 = m(a2, n2, r2, i2, e2[9], 12, -1958414417), i2 = m(i2, a2, n2, r2, e2[10], 17, -42063), r2 = m(r2, i2, a2, n2, e2[11], 22, -1990404162), n2 = m(n2, r2, i2, a2, e2[12], 7, 1804603682), a2 = m(a2, n2, r2, i2, e2[13], 12, -40341101), i2 = m(i2, a2, n2, r2, e2[14], 17, -1502002290), n2 = v(n2, r2 = m(r2, i2, a2, n2, e2[15], 22, 1236535329), i2, a2, e2[1], 5, -165796510), a2 = v(a2, n2, r2, i2, e2[6], 9, -1069501632), i2 = v(i2, a2, n2, r2, e2[11], 14, 643717713), r2 = v(r2, i2, a2, n2, e2[0], 20, -373897302), n2 = v(n2, r2, i2, a2, e2[5], 5, -701558691), a2 = v(a2, n2, r2, i2, e2[10], 9, 38016083), i2 = v(i2, a2, n2, r2, e2[15], 14, -660478335), r2 = v(r2, i2, a2, n2, e2[4], 20, -405537848), n2 = v(n2, r2, i2, a2, e2[9], 5, 568446438), a2 = v(a2, n2, r2, i2, e2[14], 9, -1019803690), i2 = v(i2, a2, n2, r2, e2[3], 14, -187363961), r2 = v(r2, i2, a2, n2, e2[8], 20, 1163531501), n2 = v(n2, r2, i2, a2, e2[13], 5, -1444681467), a2 = v(a2, n2, r2, i2, e2[2], 9, -51403784), i2 = v(i2, a2, n2, r2, e2[7], 14, 1735328473), n2 = b(n2, r2 = v(r2, i2, a2, n2, e2[12], 20, -1926607734), i2, a2, e2[5], 4, -378558), a2 = b(a2, n2, r2, i2, e2[8], 11, -2022574463), i2 = b(i2, a2, n2, r2, e2[11], 16, 1839030562), r2 = b(r2, i2, a2, n2, e2[14], 23, -35309556), n2 = b(n2, r2, i2, a2, e2[1], 4, -1530992060), a2 = b(a2, n2, r2, i2, e2[4], 11, 1272893353), i2 = b(i2, a2, n2, r2, e2[7], 16, -155497632), r2 = b(r2, i2, a2, n2, e2[10], 23, -1094730640), n2 = b(n2, r2, i2, a2, e2[13], 4, 681279174), a2 = b(a2, n2, r2, i2, e2[0], 11, -358537222), i2 = b(i2, a2, n2, r2, e2[3], 16, -722521979), r2 = b(r2, i2, a2, n2, e2[6], 23, 76029189), n2 = b(n2, r2, i2, a2, e2[9], 4, -640364487), a2 = b(a2, n2, r2, i2, e2[12], 11, -421815835), i2 = b(i2, a2, n2, r2, e2[15], 16, 530742520), n2 = y(n2, r2 = b(r2, i2, a2, n2, e2[2], 23, -995338651), i2, a2, e2[0], 6, -198630844), a2 = y(a2, n2, r2, i2, e2[7], 10, 1126891415), i2 = y(i2, a2, n2, r2, e2[14], 15, -1416354905), r2 = y(r2, i2, a2, n2, e2[5], 21, -57434055), n2 = y(n2, r2, i2, a2, e2[12], 6, 1700485571), a2 = y(a2, n2, r2, i2, e2[3], 10, -1894986606), i2 = y(i2, a2, n2, r2, e2[10], 15, -1051523), r2 = y(r2, i2, a2, n2, e2[1], 21, -2054922799), n2 = y(n2, r2, i2, a2, e2[8], 6, 1873313359), a2 = y(a2, n2, r2, i2, e2[15], 10, -30611744), i2 = y(i2, a2, n2, r2, e2[6], 15, -1560198380), r2 = y(r2, i2, a2, n2, e2[13], 21, 1309151649), n2 = y(n2, r2, i2, a2, e2[4], 6, -145523070), a2 = y(a2, n2, r2, i2, e2[11], 10, -1120210379), i2 = y(i2, a2, n2, r2, e2[2], 15, 718787259), r2 = y(r2, i2, a2, n2, e2[9], 21, -343485551), t3[0] = P(n2, t3[0]), t3[1] = P(r2, t3[1]), t3[2] = P(i2, t3[2]), t3[3] = P(a2, t3[3]);
}
function g(t3, e2, n2, r2, i2, a2) {
  return e2 = P(P(e2, t3), P(r2, a2)), P(e2 << i2 | e2 >>> 32 - i2, n2);
}
function m(t3, e2, n2, r2, i2, a2, o2) {
  return g(e2 & n2 | ~e2 & r2, t3, e2, i2, a2, o2);
}
function v(t3, e2, n2, r2, i2, a2, o2) {
  return g(e2 & r2 | n2 & ~r2, t3, e2, i2, a2, o2);
}
function b(t3, e2, n2, r2, i2, a2, o2) {
  return g(e2 ^ n2 ^ r2, t3, e2, i2, a2, o2);
}
function y(t3, e2, n2, r2, i2, a2, o2) {
  return g(n2 ^ (e2 | ~r2), t3, e2, i2, a2, o2);
}
function w(t3) {
  var e2, n2 = t3.length, r2 = [1732584193, -271733879, -1732584194, 271733878];
  for (e2 = 64; e2 <= t3.length; e2 += 64) p(r2, N(t3.substring(e2 - 64, e2)));
  t3 = t3.substring(e2 - 64);
  var i2 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
  for (e2 = 0; e2 < t3.length; e2++) i2[e2 >> 2] |= t3.charCodeAt(e2) << (e2 % 4 << 3);
  if (i2[e2 >> 2] |= 128 << (e2 % 4 << 3), e2 > 55) for (p(r2, i2), e2 = 0; e2 < 16; e2++) i2[e2] = 0;
  return i2[14] = 8 * n2, p(r2, i2), r2;
}
function N(t3) {
  var e2, n2 = [];
  for (e2 = 0; e2 < 64; e2 += 4) n2[e2 >> 2] = t3.charCodeAt(e2) + (t3.charCodeAt(e2 + 1) << 8) + (t3.charCodeAt(e2 + 2) << 16) + (t3.charCodeAt(e2 + 3) << 24);
  return n2;
}
var L = "0123456789abcdef".split("");
function x(t3) {
  for (var e2 = "", n2 = 0; n2 < 4; n2++) e2 += L[t3 >> 8 * n2 + 4 & 15] + L[t3 >> 8 * n2 & 15];
  return e2;
}
function A(t3) {
  return String.fromCharCode(255 & t3, (65280 & t3) >> 8, (16711680 & t3) >> 16, (4278190080 & t3) >> 24);
}
function S(t3) {
  return w(t3).map(A).join("");
}
var _ = "5d41402abc4b2a76b9719d911017c592" != function(t3) {
  for (var e2 = 0; e2 < t3.length; e2++) t3[e2] = x(t3[e2]);
  return t3.join("");
}(w("hello"));
function P(t3, e2) {
  if (_) {
    var n2 = (65535 & t3) + (65535 & e2);
    return (t3 >> 16) + (e2 >> 16) + (n2 >> 16) << 16 | 65535 & n2;
  }
  return t3 + e2 & 4294967295;
}
/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */
function k(t3, e2) {
  var n2, r2, i2, a2;
  if (t3 !== n2) {
    for (var o2 = (i2 = t3, a2 = 1 + (256 / t3.length | 0), new Array(a2 + 1).join(i2)), s2 = [], u2 = 0; u2 < 256; u2++) s2[u2] = u2;
    var c2 = 0;
    for (u2 = 0; u2 < 256; u2++) {
      var l2 = s2[u2];
      c2 = (c2 + l2 + o2.charCodeAt(u2)) % 256, s2[u2] = s2[c2], s2[c2] = l2;
    }
    n2 = t3, r2 = s2;
  } else s2 = r2;
  var h2 = e2.length, f2 = 0, d2 = 0, p2 = "";
  for (u2 = 0; u2 < h2; u2++) d2 = (d2 + (l2 = s2[f2 = (f2 + 1) % 256])) % 256, s2[f2] = s2[d2], s2[d2] = l2, o2 = s2[(s2[f2] + s2[d2]) % 256], p2 += String.fromCharCode(e2.charCodeAt(u2) ^ o2);
  return p2;
}
/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */
var F = { print: 4, modify: 8, copy: 16, "annot-forms": 32 };
function I(t3, e2, n2, r2) {
  this.v = 1, this.r = 2;
  var i2 = 192;
  t3.forEach(function(t4) {
    if (void 0 !== F.perm) throw new Error("Invalid permission: " + t4);
    i2 += F[t4];
  }), this.padding = "(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";
  var a2 = (e2 + this.padding).substr(0, 32), o2 = (n2 + this.padding).substr(0, 32);
  this.O = this.processOwnerPassword(a2, o2), this.P = -(1 + (255 ^ i2)), this.encryptionKey = S(a2 + this.O + this.lsbFirstWord(this.P) + this.hexToBytes(r2)).substr(0, 5), this.U = k(this.encryptionKey, this.padding);
}
function j(t3) {
  if (/[^\u0000-\u00ff]/.test(t3)) throw new Error("Invalid PDF Name Object: " + t3 + ", Only accept ASCII characters.");
  for (var e2 = "", n2 = t3.length, r2 = 0; r2 < n2; r2++) {
    var i2 = t3.charCodeAt(r2);
    e2 += i2 < 33 || 35 === i2 || 37 === i2 || 40 === i2 || 41 === i2 || 47 === i2 || 60 === i2 || 62 === i2 || 91 === i2 || 93 === i2 || 123 === i2 || 125 === i2 || i2 > 126 ? "#" + ("0" + i2.toString(16)).slice(-2) : t3[r2];
  }
  return e2;
}
function C(e2) {
  if ("object" !== _typeof(e2)) throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");
  var n2 = {};
  this.subscribe = function(t3, e3, r2) {
    if (r2 = r2 || false, "string" != typeof t3 || "function" != typeof e3 || "boolean" != typeof r2) throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");
    n2.hasOwnProperty(t3) || (n2[t3] = {});
    var i2 = Math.random().toString(35);
    return n2[t3][i2] = [e3, !!r2], i2;
  }, this.unsubscribe = function(t3) {
    for (var e3 in n2) if (n2[e3][t3]) return delete n2[e3][t3], 0 === Object.keys(n2[e3]).length && delete n2[e3], true;
    return false;
  }, this.publish = function(t3) {
    if (n2.hasOwnProperty(t3)) {
      var r2 = Array.prototype.slice.call(arguments, 1), a2 = [];
      for (var s2 in n2[t3]) {
        var u2 = n2[t3][s2];
        try {
          u2[0].apply(e2, r2);
        } catch (c2) {
          i.console && o.error("jsPDF PubSub Error", c2.message, c2);
        }
        u2[1] && a2.push(s2);
      }
      a2.length && a2.forEach(this.unsubscribe);
    }
  }, this.getTopics = function() {
    return n2;
  };
}
function O(t3) {
  if (!(this instanceof O)) return new O(t3);
  var e2 = "opacity,stroke-opacity".split(",");
  for (var n2 in t3) t3.hasOwnProperty(n2) && e2.indexOf(n2) >= 0 && (this[n2] = t3[n2]);
  this.id = "", this.objectNumber = -1;
}
function B(t3, e2) {
  this.gState = t3, this.matrix = e2, this.id = "", this.objectNumber = -1;
}
function M(t3, e2, n2, r2, i2) {
  if (!(this instanceof M)) return new M(t3, e2, n2, r2, i2);
  this.type = "axial" === t3 ? 2 : 3, this.coords = e2, this.colors = n2, B.call(this, r2, i2);
}
function q(t3, e2, n2, r2, i2) {
  if (!(this instanceof q)) return new q(t3, e2, n2, r2, i2);
  this.boundingBox = t3, this.xStep = e2, this.yStep = n2, this.stream = "", this.cloneIndex = 0, B.call(this, r2, i2);
}
function E(e2) {
  var n2, r2 = "string" == typeof arguments[0] ? arguments[0] : "p", a2 = arguments[1], s2 = arguments[2], u2 = arguments[3], c2 = [], f2 = 1, p2 = 16, g2 = "S", m2 = null;
  "object" === _typeof(e2 = e2 || {}) && (r2 = e2.orientation, a2 = e2.unit || a2, s2 = e2.format || s2, u2 = e2.compress || e2.compressPdf || u2, null !== (m2 = e2.encryption || null) && (m2.userPassword = m2.userPassword || "", m2.ownerPassword = m2.ownerPassword || "", m2.userPermissions = m2.userPermissions || []), f2 = "number" == typeof e2.userUnit ? Math.abs(e2.userUnit) : 1, void 0 !== e2.precision && (n2 = e2.precision), void 0 !== e2.floatPrecision && (p2 = e2.floatPrecision), g2 = e2.defaultPathOperation || "S"), c2 = e2.filters || (true === u2 ? ["FlateEncode"] : c2), a2 = a2 || "mm", r2 = ("" + (r2 || "P")).toLowerCase();
  var v2 = e2.putOnlyUsedFonts || false, b2 = {}, y2 = { internal: {}, __private__: {} };
  y2.__private__.PubSub = C;
  var w2 = "1.3", N2 = y2.__private__.getPdfVersion = function() {
    return w2;
  };
  y2.__private__.setPdfVersion = function(t3) {
    w2 = t3;
  };
  var L2 = { a0: [2383.94, 3370.39], a1: [1683.78, 2383.94], a2: [1190.55, 1683.78], a3: [841.89, 1190.55], a4: [595.28, 841.89], a5: [419.53, 595.28], a6: [297.64, 419.53], a7: [209.76, 297.64], a8: [147.4, 209.76], a9: [104.88, 147.4], a10: [73.7, 104.88], b0: [2834.65, 4008.19], b1: [2004.09, 2834.65], b2: [1417.32, 2004.09], b3: [1000.63, 1417.32], b4: [708.66, 1000.63], b5: [498.9, 708.66], b6: [354.33, 498.9], b7: [249.45, 354.33], b8: [175.75, 249.45], b9: [124.72, 175.75], b10: [87.87, 124.72], c0: [2599.37, 3676.54], c1: [1836.85, 2599.37], c2: [1298.27, 1836.85], c3: [918.43, 1298.27], c4: [649.13, 918.43], c5: [459.21, 649.13], c6: [323.15, 459.21], c7: [229.61, 323.15], c8: [161.57, 229.61], c9: [113.39, 161.57], c10: [79.37, 113.39], dl: [311.81, 623.62], letter: [612, 792], "government-letter": [576, 756], legal: [612, 1008], "junior-legal": [576, 360], ledger: [1224, 792], tabloid: [792, 1224], "credit-card": [153, 243] };
  y2.__private__.getPageFormats = function() {
    return L2;
  };
  var x2 = y2.__private__.getPageFormat = function(t3) {
    return L2[t3];
  };
  s2 = s2 || "a4";
  var A2 = "compat", S2 = "advanced", _2 = A2;
  function P2() {
    this.saveGraphicsState(), lt2(new Wt2(St2, 0, 0, -St2, 0, _n() * St2).toString() + " cm"), this.setFontSize(this.getFontSize() / St2), g2 = "n", _2 = S2;
  }
  function k2() {
    this.restoreGraphicsState(), g2 = "S", _2 = A2;
  }
  var F2 = y2.__private__.combineFontStyleAndFontWeight = function(t3, e3) {
    if ("bold" == t3 && "normal" == e3 || "bold" == t3 && 400 == e3 || "normal" == t3 && "italic" == e3 || "bold" == t3 && "italic" == e3) throw new Error("Invalid Combination of fontweight and fontstyle");
    return e3 && (t3 = 400 == e3 || "normal" === e3 ? "italic" === t3 ? "italic" : "normal" : 700 != e3 && "bold" !== e3 || "normal" !== t3 ? (700 == e3 ? "bold" : e3) + "" + t3 : "bold"), t3;
  };
  y2.advancedAPI = function(t3) {
    var e3 = _2 === A2;
    return e3 && P2.call(this), "function" != typeof t3 || (t3(this), e3 && k2.call(this)), this;
  }, y2.compatAPI = function(t3) {
    var e3 = _2 === S2;
    return e3 && k2.call(this), "function" != typeof t3 || (t3(this), e3 && P2.call(this)), this;
  }, y2.isAdvancedAPI = function() {
    return _2 === S2;
  };
  var B2, R2 = function(t3) {
    if (_2 !== S2) throw new Error(t3 + " is only available in 'advanced' API mode. You need to call advancedAPI() first.");
  }, D2 = y2.roundToPrecision = y2.__private__.roundToPrecision = function(t3, e3) {
    var r3 = n2 || e3;
    if (isNaN(t3) || isNaN(r3)) throw new Error("Invalid argument passed to jsPDF.roundToPrecision");
    return t3.toFixed(r3).replace(/0+$/, "");
  };
  B2 = y2.hpf = y2.__private__.hpf = "number" == typeof p2 ? function(t3) {
    if (isNaN(t3)) throw new Error("Invalid argument passed to jsPDF.hpf");
    return D2(t3, p2);
  } : "smart" === p2 ? function(t3) {
    if (isNaN(t3)) throw new Error("Invalid argument passed to jsPDF.hpf");
    return D2(t3, t3 > -1 && t3 < 1 ? 16 : 5);
  } : function(t3) {
    if (isNaN(t3)) throw new Error("Invalid argument passed to jsPDF.hpf");
    return D2(t3, 16);
  };
  var T2 = y2.f2 = y2.__private__.f2 = function(t3) {
    if (isNaN(t3)) throw new Error("Invalid argument passed to jsPDF.f2");
    return D2(t3, 2);
  }, z2 = y2.__private__.f3 = function(t3) {
    if (isNaN(t3)) throw new Error("Invalid argument passed to jsPDF.f3");
    return D2(t3, 3);
  }, U2 = y2.scale = y2.__private__.scale = function(t3) {
    if (isNaN(t3)) throw new Error("Invalid argument passed to jsPDF.scale");
    return _2 === A2 ? t3 * St2 : _2 === S2 ? t3 : void 0;
  }, H2 = function(t3) {
    return U2(function(t4) {
      return _2 === A2 ? _n() - t4 : _2 === S2 ? t4 : void 0;
    }(t3));
  };
  y2.__private__.setPrecision = y2.setPrecision = function(t3) {
    "number" == typeof parseInt(t3, 10) && (n2 = parseInt(t3, 10));
  };
  var W2, V2 = "00000000000000000000000000000000", G2 = y2.__private__.getFileId = function() {
    return V2;
  }, Y2 = y2.__private__.setFileId = function(t3) {
    return V2 = void 0 !== t3 && /^[a-fA-F0-9]{32}$/.test(t3) ? t3.toUpperCase() : V2.split("").map(function() {
      return "ABCDEF0123456789".charAt(Math.floor(16 * Math.random()));
    }).join(""), null !== m2 && (je2 = new I(m2.userPermissions, m2.userPassword, m2.ownerPassword, V2)), V2;
  };
  y2.setFileId = function(t3) {
    return Y2(t3), this;
  }, y2.getFileId = function() {
    return G2();
  };
  var J2 = y2.__private__.convertDateToPDFDate = function(t3) {
    var e3 = t3.getTimezoneOffset(), n3 = e3 < 0 ? "+" : "-", r3 = Math.floor(Math.abs(e3 / 60)), i2 = Math.abs(e3 % 60), a3 = [n3, Q2(r3), "'", Q2(i2), "'"].join("");
    return ["D:", t3.getFullYear(), Q2(t3.getMonth() + 1), Q2(t3.getDate()), Q2(t3.getHours()), Q2(t3.getMinutes()), Q2(t3.getSeconds()), a3].join("");
  }, X2 = y2.__private__.convertPDFDateToDate = function(t3) {
    var e3 = parseInt(t3.substr(2, 4), 10), n3 = parseInt(t3.substr(6, 2), 10) - 1, r3 = parseInt(t3.substr(8, 2), 10), i2 = parseInt(t3.substr(10, 2), 10), a3 = parseInt(t3.substr(12, 2), 10), o2 = parseInt(t3.substr(14, 2), 10);
    return new Date(e3, n3, r3, i2, a3, o2, 0);
  }, K2 = y2.__private__.setCreationDate = function(t3) {
    var e3;
    if (void 0 === t3 && (t3 = /* @__PURE__ */ new Date()), t3 instanceof Date) e3 = J2(t3);
    else {
      if (!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(t3)) throw new Error("Invalid argument passed to jsPDF.setCreationDate");
      e3 = t3;
    }
    return W2 = e3;
  }, Z2 = y2.__private__.getCreationDate = function(t3) {
    var e3 = W2;
    return "jsDate" === t3 && (e3 = X2(W2)), e3;
  };
  y2.setCreationDate = function(t3) {
    return K2(t3), this;
  }, y2.getCreationDate = function(t3) {
    return Z2(t3);
  };
  var $2, Q2 = y2.__private__.padd2 = function(t3) {
    return ("0" + parseInt(t3)).slice(-2);
  }, tt2 = y2.__private__.padd2Hex = function(t3) {
    return ("00" + (t3 = t3.toString())).substr(t3.length);
  }, et2 = 0, nt2 = [], rt2 = [], it2 = 0, at2 = [], ot2 = [], st2 = false, ut2 = rt2;
  y2.__private__.setCustomOutputDestination = function(t3) {
    st2 = true, ut2 = t3;
  };
  var ct2 = function(t3) {
    st2 || (ut2 = t3);
  };
  y2.__private__.resetCustomOutputDestination = function() {
    st2 = false, ut2 = rt2;
  };
  var lt2 = y2.__private__.out = function(t3) {
    return t3 = t3.toString(), it2 += t3.length + 1, ut2.push(t3), ut2;
  }, ht2 = y2.__private__.write = function(t3) {
    return lt2(1 === arguments.length ? t3.toString() : Array.prototype.join.call(arguments, " "));
  }, ft2 = y2.__private__.getArrayBuffer = function(t3) {
    for (var e3 = t3.length, n3 = new ArrayBuffer(e3), r3 = new Uint8Array(n3); e3--; ) r3[e3] = t3.charCodeAt(e3);
    return n3;
  }, dt2 = [["Helvetica", "helvetica", "normal", "WinAnsiEncoding"], ["Helvetica-Bold", "helvetica", "bold", "WinAnsiEncoding"], ["Helvetica-Oblique", "helvetica", "italic", "WinAnsiEncoding"], ["Helvetica-BoldOblique", "helvetica", "bolditalic", "WinAnsiEncoding"], ["Courier", "courier", "normal", "WinAnsiEncoding"], ["Courier-Bold", "courier", "bold", "WinAnsiEncoding"], ["Courier-Oblique", "courier", "italic", "WinAnsiEncoding"], ["Courier-BoldOblique", "courier", "bolditalic", "WinAnsiEncoding"], ["Times-Roman", "times", "normal", "WinAnsiEncoding"], ["Times-Bold", "times", "bold", "WinAnsiEncoding"], ["Times-Italic", "times", "italic", "WinAnsiEncoding"], ["Times-BoldItalic", "times", "bolditalic", "WinAnsiEncoding"], ["ZapfDingbats", "zapfdingbats", "normal", null], ["Symbol", "symbol", "normal", null]];
  y2.__private__.getStandardFonts = function() {
    return dt2;
  };
  var pt2 = e2.fontSize || 16;
  y2.__private__.setFontSize = y2.setFontSize = function(t3) {
    return pt2 = _2 === S2 ? t3 / St2 : t3, this;
  };
  var gt2, mt2 = y2.__private__.getFontSize = y2.getFontSize = function() {
    return _2 === A2 ? pt2 : pt2 * St2;
  }, vt2 = e2.R2L || false;
  y2.__private__.setR2L = y2.setR2L = function(t3) {
    return vt2 = t3, this;
  }, y2.__private__.getR2L = y2.getR2L = function() {
    return vt2;
  };
  var bt2, yt2 = y2.__private__.setZoomMode = function(t3) {
    if (/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(t3)) gt2 = t3;
    else if (isNaN(t3)) {
      if (-1 === [void 0, null, "fullwidth", "fullheight", "fullpage", "original"].indexOf(t3)) throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "' + t3 + '" is not recognized.');
      gt2 = t3;
    } else gt2 = parseInt(t3, 10);
  };
  y2.__private__.getZoomMode = function() {
    return gt2;
  };
  var wt2, Nt2 = y2.__private__.setPageMode = function(t3) {
    if (-1 == [void 0, null, "UseNone", "UseOutlines", "UseThumbs", "FullScreen"].indexOf(t3)) throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "' + t3 + '" is not recognized.');
    bt2 = t3;
  };
  y2.__private__.getPageMode = function() {
    return bt2;
  };
  var Lt2 = y2.__private__.setLayoutMode = function(t3) {
    if (-1 == [void 0, null, "continuous", "single", "twoleft", "tworight", "two"].indexOf(t3)) throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "' + t3 + '" is not recognized.');
    wt2 = t3;
  };
  y2.__private__.getLayoutMode = function() {
    return wt2;
  }, y2.__private__.setDisplayMode = y2.setDisplayMode = function(t3, e3, n3) {
    return yt2(t3), Lt2(e3), Nt2(n3), this;
  };
  var xt2 = { title: "", subject: "", author: "", keywords: "", creator: "" };
  y2.__private__.getDocumentProperty = function(t3) {
    if (-1 === Object.keys(xt2).indexOf(t3)) throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");
    return xt2[t3];
  }, y2.__private__.getDocumentProperties = function() {
    return xt2;
  }, y2.__private__.setDocumentProperties = y2.setProperties = y2.setDocumentProperties = function(t3) {
    for (var e3 in xt2) xt2.hasOwnProperty(e3) && t3[e3] && (xt2[e3] = t3[e3]);
    return this;
  }, y2.__private__.setDocumentProperty = function(t3, e3) {
    if (-1 === Object.keys(xt2).indexOf(t3)) throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");
    return xt2[t3] = e3;
  };
  var At2, St2, _t2, Pt2, kt2, Ft2 = {}, It2 = {}, jt2 = [], Ct2 = {}, Ot2 = {}, Bt2 = {}, Mt2 = {}, qt2 = null, Et2 = 0, Rt2 = [], Dt2 = new C(y2), Tt2 = e2.hotfixes || [], zt2 = {}, Ut2 = {}, Ht2 = [], Wt2 = function t3(e3, n3, r3, i2, a3, o2) {
    if (!(this instanceof t3)) return new t3(e3, n3, r3, i2, a3, o2);
    isNaN(e3) && (e3 = 1), isNaN(n3) && (n3 = 0), isNaN(r3) && (r3 = 0), isNaN(i2) && (i2 = 1), isNaN(a3) && (a3 = 0), isNaN(o2) && (o2 = 0), this._matrix = [e3, n3, r3, i2, a3, o2];
  };
  Object.defineProperty(Wt2.prototype, "sx", { get: function() {
    return this._matrix[0];
  }, set: function(t3) {
    this._matrix[0] = t3;
  } }), Object.defineProperty(Wt2.prototype, "shy", { get: function() {
    return this._matrix[1];
  }, set: function(t3) {
    this._matrix[1] = t3;
  } }), Object.defineProperty(Wt2.prototype, "shx", { get: function() {
    return this._matrix[2];
  }, set: function(t3) {
    this._matrix[2] = t3;
  } }), Object.defineProperty(Wt2.prototype, "sy", { get: function() {
    return this._matrix[3];
  }, set: function(t3) {
    this._matrix[3] = t3;
  } }), Object.defineProperty(Wt2.prototype, "tx", { get: function() {
    return this._matrix[4];
  }, set: function(t3) {
    this._matrix[4] = t3;
  } }), Object.defineProperty(Wt2.prototype, "ty", { get: function() {
    return this._matrix[5];
  }, set: function(t3) {
    this._matrix[5] = t3;
  } }), Object.defineProperty(Wt2.prototype, "a", { get: function() {
    return this._matrix[0];
  }, set: function(t3) {
    this._matrix[0] = t3;
  } }), Object.defineProperty(Wt2.prototype, "b", { get: function() {
    return this._matrix[1];
  }, set: function(t3) {
    this._matrix[1] = t3;
  } }), Object.defineProperty(Wt2.prototype, "c", { get: function() {
    return this._matrix[2];
  }, set: function(t3) {
    this._matrix[2] = t3;
  } }), Object.defineProperty(Wt2.prototype, "d", { get: function() {
    return this._matrix[3];
  }, set: function(t3) {
    this._matrix[3] = t3;
  } }), Object.defineProperty(Wt2.prototype, "e", { get: function() {
    return this._matrix[4];
  }, set: function(t3) {
    this._matrix[4] = t3;
  } }), Object.defineProperty(Wt2.prototype, "f", { get: function() {
    return this._matrix[5];
  }, set: function(t3) {
    this._matrix[5] = t3;
  } }), Object.defineProperty(Wt2.prototype, "rotation", { get: function() {
    return Math.atan2(this.shx, this.sx);
  } }), Object.defineProperty(Wt2.prototype, "scaleX", { get: function() {
    return this.decompose().scale.sx;
  } }), Object.defineProperty(Wt2.prototype, "scaleY", { get: function() {
    return this.decompose().scale.sy;
  } }), Object.defineProperty(Wt2.prototype, "isIdentity", { get: function() {
    return 1 === this.sx && 0 === this.shy && 0 === this.shx && 1 === this.sy && 0 === this.tx && 0 === this.ty;
  } }), Wt2.prototype.join = function(t3) {
    return [this.sx, this.shy, this.shx, this.sy, this.tx, this.ty].map(B2).join(t3);
  }, Wt2.prototype.multiply = function(t3) {
    var e3 = t3.sx * this.sx + t3.shy * this.shx, n3 = t3.sx * this.shy + t3.shy * this.sy, r3 = t3.shx * this.sx + t3.sy * this.shx, i2 = t3.shx * this.shy + t3.sy * this.sy, a3 = t3.tx * this.sx + t3.ty * this.shx + this.tx, o2 = t3.tx * this.shy + t3.ty * this.sy + this.ty;
    return new Wt2(e3, n3, r3, i2, a3, o2);
  }, Wt2.prototype.decompose = function() {
    var t3 = this.sx, e3 = this.shy, n3 = this.shx, r3 = this.sy, i2 = this.tx, a3 = this.ty, o2 = Math.sqrt(t3 * t3 + e3 * e3), s3 = (t3 /= o2) * n3 + (e3 /= o2) * r3;
    n3 -= t3 * s3, r3 -= e3 * s3;
    var u3 = Math.sqrt(n3 * n3 + r3 * r3);
    return s3 /= u3, t3 * (r3 /= u3) < e3 * (n3 /= u3) && (t3 = -t3, e3 = -e3, s3 = -s3, o2 = -o2), { scale: new Wt2(o2, 0, 0, u3, 0, 0), translate: new Wt2(1, 0, 0, 1, i2, a3), rotate: new Wt2(t3, e3, -e3, t3, 0, 0), skew: new Wt2(1, 0, s3, 1, 0, 0) };
  }, Wt2.prototype.toString = function(t3) {
    return this.join(" ");
  }, Wt2.prototype.inversed = function() {
    var t3 = this.sx, e3 = this.shy, n3 = this.shx, r3 = this.sy, i2 = this.tx, a3 = this.ty, o2 = 1 / (t3 * r3 - e3 * n3), s3 = r3 * o2, u3 = -e3 * o2, c3 = -n3 * o2, l2 = t3 * o2;
    return new Wt2(s3, u3, c3, l2, -s3 * i2 - c3 * a3, -u3 * i2 - l2 * a3);
  }, Wt2.prototype.applyToPoint = function(t3) {
    var e3 = t3.x * this.sx + t3.y * this.shx + this.tx, n3 = t3.x * this.shy + t3.y * this.sy + this.ty;
    return new gn(e3, n3);
  }, Wt2.prototype.applyToRectangle = function(t3) {
    var e3 = this.applyToPoint(t3), n3 = this.applyToPoint(new gn(t3.x + t3.w, t3.y + t3.h));
    return new mn(e3.x, e3.y, n3.x - e3.x, n3.y - e3.y);
  }, Wt2.prototype.clone = function() {
    var t3 = this.sx, e3 = this.shy, n3 = this.shx, r3 = this.sy, i2 = this.tx, a3 = this.ty;
    return new Wt2(t3, e3, n3, r3, i2, a3);
  }, y2.Matrix = Wt2;
  var Vt2 = y2.matrixMult = function(t3, e3) {
    return e3.multiply(t3);
  }, Gt2 = new Wt2(1, 0, 0, 1, 0, 0);
  y2.unitMatrix = y2.identityMatrix = Gt2;
  var Yt2 = function(t3, e3) {
    if (!Ot2[t3]) {
      var n3 = (e3 instanceof M ? "Sh" : "P") + (Object.keys(Ct2).length + 1).toString(10);
      e3.id = n3, Ot2[t3] = n3, Ct2[n3] = e3, Dt2.publish("addPattern", e3);
    }
  };
  y2.ShadingPattern = M, y2.TilingPattern = q, y2.addShadingPattern = function(t3, e3) {
    return R2("addShadingPattern()"), Yt2(t3, e3), this;
  }, y2.beginTilingPattern = function(t3) {
    R2("beginTilingPattern()"), bn(t3.boundingBox[0], t3.boundingBox[1], t3.boundingBox[2] - t3.boundingBox[0], t3.boundingBox[3] - t3.boundingBox[1], t3.matrix);
  }, y2.endTilingPattern = function(t3, e3) {
    R2("endTilingPattern()"), e3.stream = ot2[$2].join("\n"), Yt2(t3, e3), Dt2.publish("endTilingPattern", e3), Ht2.pop().restore();
  };
  var Jt2, Xt2 = y2.__private__.newObject = function() {
    var t3 = Kt2();
    return Zt2(t3, true), t3;
  }, Kt2 = y2.__private__.newObjectDeferred = function() {
    return et2++, nt2[et2] = function() {
      return it2;
    }, et2;
  }, Zt2 = function(t3, e3) {
    return e3 = "boolean" == typeof e3 && e3, nt2[t3] = it2, e3 && lt2(t3 + " 0 obj"), t3;
  }, $t2 = y2.__private__.newAdditionalObject = function() {
    var t3 = { objId: Kt2(), content: "" };
    return at2.push(t3), t3;
  }, Qt2 = Kt2(), te2 = Kt2(), ee2 = y2.__private__.decodeColorString = function(t3) {
    var e3 = t3.split(" ");
    if (2 !== e3.length || "g" !== e3[1] && "G" !== e3[1]) 5 !== e3.length || "k" !== e3[4] && "K" !== e3[4] || (e3 = [(1 - e3[0]) * (1 - e3[3]), (1 - e3[1]) * (1 - e3[3]), (1 - e3[2]) * (1 - e3[3]), "r"]);
    else {
      var n3 = parseFloat(e3[0]);
      e3 = [n3, n3, n3, "r"];
    }
    for (var r3 = "#", i2 = 0; i2 < 3; i2++) r3 += ("0" + Math.floor(255 * parseFloat(e3[i2])).toString(16)).slice(-2);
    return r3;
  }, ne2 = y2.__private__.encodeColorString = function(e3) {
    var n3;
    "string" == typeof e3 && (e3 = { ch1: e3 });
    var r3 = e3.ch1, i2 = e3.ch2, a3 = e3.ch3, o2 = e3.ch4, s3 = "draw" === e3.pdfColorType ? ["G", "RG", "K"] : ["g", "rg", "k"];
    if ("string" == typeof r3 && "#" !== r3.charAt(0)) {
      var u3 = new h(r3);
      if (u3.ok) r3 = u3.toHex();
      else if (!/^\d*\.?\d*$/.test(r3)) throw new Error('Invalid color "' + r3 + '" passed to jsPDF.encodeColorString.');
    }
    if ("string" == typeof r3 && /^#[0-9A-Fa-f]{3}$/.test(r3) && (r3 = "#" + r3[1] + r3[1] + r3[2] + r3[2] + r3[3] + r3[3]), "string" == typeof r3 && /^#[0-9A-Fa-f]{6}$/.test(r3)) {
      var c3 = parseInt(r3.substr(1), 16);
      r3 = c3 >> 16 & 255, i2 = c3 >> 8 & 255, a3 = 255 & c3;
    }
    if (void 0 === i2 || void 0 === o2 && r3 === i2 && i2 === a3) n3 = "string" == typeof r3 ? r3 + " " + s3[0] : 2 === e3.precision ? T2(r3 / 255) + " " + s3[0] : z2(r3 / 255) + " " + s3[0];
    else if (void 0 === o2 || "object" === _typeof(o2)) {
      if (o2 && !isNaN(o2.a) && 0 === o2.a) return ["1.", "1.", "1.", s3[1]].join(" ");
      n3 = "string" == typeof r3 ? [r3, i2, a3, s3[1]].join(" ") : 2 === e3.precision ? [T2(r3 / 255), T2(i2 / 255), T2(a3 / 255), s3[1]].join(" ") : [z2(r3 / 255), z2(i2 / 255), z2(a3 / 255), s3[1]].join(" ");
    } else n3 = "string" == typeof r3 ? [r3, i2, a3, o2, s3[2]].join(" ") : 2 === e3.precision ? [T2(r3), T2(i2), T2(a3), T2(o2), s3[2]].join(" ") : [z2(r3), z2(i2), z2(a3), z2(o2), s3[2]].join(" ");
    return n3;
  }, re2 = y2.__private__.getFilters = function() {
    return c2;
  }, ie2 = y2.__private__.putStream = function(t3) {
    var e3 = (t3 = t3 || {}).data || "", n3 = t3.filters || re2(), r3 = t3.alreadyAppliedFilters || [], i2 = t3.addLength1 || false, a3 = e3.length, o2 = t3.objectId, s3 = function(t4) {
      return t4;
    };
    if (null !== m2 && void 0 === o2) throw new Error("ObjectId must be passed to putStream for file encryption");
    null !== m2 && (s3 = je2.encryptor(o2, 0));
    var u3 = {};
    true === n3 && (n3 = ["FlateEncode"]);
    var c3 = t3.additionalKeyValues || [], l2 = (u3 = void 0 !== E.API.processDataByFilters ? E.API.processDataByFilters(e3, n3) : { data: e3, reverseChain: [] }).reverseChain + (Array.isArray(r3) ? r3.join(" ") : r3.toString());
    if (0 !== u3.data.length && (c3.push({ key: "Length", value: u3.data.length }), true === i2 && c3.push({ key: "Length1", value: a3 })), 0 != l2.length) if (l2.split("/").length - 1 == 1) c3.push({ key: "Filter", value: l2 });
    else {
      c3.push({ key: "Filter", value: "[" + l2 + "]" });
      for (var h2 = 0; h2 < c3.length; h2 += 1) if ("DecodeParms" === c3[h2].key) {
        for (var f3 = [], d2 = 0; d2 < u3.reverseChain.split("/").length - 1; d2 += 1) f3.push("null");
        f3.push(c3[h2].value), c3[h2].value = "[" + f3.join(" ") + "]";
      }
    }
    lt2("<<");
    for (var p3 = 0; p3 < c3.length; p3++) lt2("/" + c3[p3].key + " " + c3[p3].value);
    lt2(">>"), 0 !== u3.data.length && (lt2("stream"), lt2(s3(u3.data)), lt2("endstream"));
  }, ae2 = y2.__private__.putPage = function(t3) {
    var e3 = t3.number, n3 = t3.data, r3 = t3.objId, i2 = t3.contentsObjId;
    Zt2(r3, true), lt2("<</Type /Page"), lt2("/Parent " + t3.rootDictionaryObjId + " 0 R"), lt2("/Resources " + t3.resourceDictionaryObjId + " 0 R"), lt2("/MediaBox [" + parseFloat(B2(t3.mediaBox.bottomLeftX)) + " " + parseFloat(B2(t3.mediaBox.bottomLeftY)) + " " + B2(t3.mediaBox.topRightX) + " " + B2(t3.mediaBox.topRightY) + "]"), null !== t3.cropBox && lt2("/CropBox [" + B2(t3.cropBox.bottomLeftX) + " " + B2(t3.cropBox.bottomLeftY) + " " + B2(t3.cropBox.topRightX) + " " + B2(t3.cropBox.topRightY) + "]"), null !== t3.bleedBox && lt2("/BleedBox [" + B2(t3.bleedBox.bottomLeftX) + " " + B2(t3.bleedBox.bottomLeftY) + " " + B2(t3.bleedBox.topRightX) + " " + B2(t3.bleedBox.topRightY) + "]"), null !== t3.trimBox && lt2("/TrimBox [" + B2(t3.trimBox.bottomLeftX) + " " + B2(t3.trimBox.bottomLeftY) + " " + B2(t3.trimBox.topRightX) + " " + B2(t3.trimBox.topRightY) + "]"), null !== t3.artBox && lt2("/ArtBox [" + B2(t3.artBox.bottomLeftX) + " " + B2(t3.artBox.bottomLeftY) + " " + B2(t3.artBox.topRightX) + " " + B2(t3.artBox.topRightY) + "]"), "number" == typeof t3.userUnit && 1 !== t3.userUnit && lt2("/UserUnit " + t3.userUnit), Dt2.publish("putPage", { objId: r3, pageContext: Rt2[e3], pageNumber: e3, page: n3 }), lt2("/Contents " + i2 + " 0 R"), lt2(">>"), lt2("endobj");
    var a3 = n3.join("\n");
    return _2 === S2 && (a3 += "\nQ"), Zt2(i2, true), ie2({ data: a3, filters: re2(), objectId: i2 }), lt2("endobj"), r3;
  }, oe2 = y2.__private__.putPages = function() {
    var t3, e3, n3 = [];
    for (t3 = 1; t3 <= Et2; t3++) Rt2[t3].objId = Kt2(), Rt2[t3].contentsObjId = Kt2();
    for (t3 = 1; t3 <= Et2; t3++) n3.push(ae2({ number: t3, data: ot2[t3], objId: Rt2[t3].objId, contentsObjId: Rt2[t3].contentsObjId, mediaBox: Rt2[t3].mediaBox, cropBox: Rt2[t3].cropBox, bleedBox: Rt2[t3].bleedBox, trimBox: Rt2[t3].trimBox, artBox: Rt2[t3].artBox, userUnit: Rt2[t3].userUnit, rootDictionaryObjId: Qt2, resourceDictionaryObjId: te2 }));
    Zt2(Qt2, true), lt2("<</Type /Pages");
    var r3 = "/Kids [";
    for (e3 = 0; e3 < Et2; e3++) r3 += n3[e3] + " 0 R ";
    lt2(r3 + "]"), lt2("/Count " + Et2), lt2(">>"), lt2("endobj"), Dt2.publish("postPutPages");
  }, se2 = function(t3) {
    Dt2.publish("putFont", { font: t3, out: lt2, newObject: Xt2, putStream: ie2 }), true !== t3.isAlreadyPutted && (t3.objectNumber = Xt2(), lt2("<<"), lt2("/Type /Font"), lt2("/BaseFont /" + j(t3.postScriptName)), lt2("/Subtype /Type1"), "string" == typeof t3.encoding && lt2("/Encoding /" + t3.encoding), lt2("/FirstChar 32"), lt2("/LastChar 255"), lt2(">>"), lt2("endobj"));
  }, ue2 = function(t3) {
    t3.objectNumber = Xt2();
    var e3 = [];
    e3.push({ key: "Type", value: "/XObject" }), e3.push({ key: "Subtype", value: "/Form" }), e3.push({ key: "BBox", value: "[" + [B2(t3.x), B2(t3.y), B2(t3.x + t3.width), B2(t3.y + t3.height)].join(" ") + "]" }), e3.push({ key: "Matrix", value: "[" + t3.matrix.toString() + "]" });
    var n3 = t3.pages[1].join("\n");
    ie2({ data: n3, additionalKeyValues: e3, objectId: t3.objectNumber }), lt2("endobj");
  }, ce2 = function(t3, e3) {
    e3 || (e3 = 21);
    var n3 = Xt2(), r3 = function(t4, e4) {
      var n4, r4 = [], i3 = 1 / (e4 - 1);
      for (n4 = 0; n4 < 1; n4 += i3) r4.push(n4);
      if (r4.push(1), 0 != t4[0].offset) {
        var a4 = { offset: 0, color: t4[0].color };
        t4.unshift(a4);
      }
      if (1 != t4[t4.length - 1].offset) {
        var o2 = { offset: 1, color: t4[t4.length - 1].color };
        t4.push(o2);
      }
      for (var s3 = "", u3 = 0, c3 = 0; c3 < r4.length; c3++) {
        for (n4 = r4[c3]; n4 > t4[u3 + 1].offset; ) u3++;
        var l2 = t4[u3].offset, h2 = (n4 - l2) / (t4[u3 + 1].offset - l2), f3 = t4[u3].color, d2 = t4[u3 + 1].color;
        s3 += tt2(Math.round((1 - h2) * f3[0] + h2 * d2[0]).toString(16)) + tt2(Math.round((1 - h2) * f3[1] + h2 * d2[1]).toString(16)) + tt2(Math.round((1 - h2) * f3[2] + h2 * d2[2]).toString(16));
      }
      return s3.trim();
    }(t3.colors, e3), i2 = [];
    i2.push({ key: "FunctionType", value: "0" }), i2.push({ key: "Domain", value: "[0.0 1.0]" }), i2.push({ key: "Size", value: "[" + e3 + "]" }), i2.push({ key: "BitsPerSample", value: "8" }), i2.push({ key: "Range", value: "[0.0 1.0 0.0 1.0 0.0 1.0]" }), i2.push({ key: "Decode", value: "[0.0 1.0 0.0 1.0 0.0 1.0]" }), ie2({ data: r3, additionalKeyValues: i2, alreadyAppliedFilters: ["/ASCIIHexDecode"], objectId: n3 }), lt2("endobj"), t3.objectNumber = Xt2(), lt2("<< /ShadingType " + t3.type), lt2("/ColorSpace /DeviceRGB");
    var a3 = "/Coords [" + B2(parseFloat(t3.coords[0])) + " " + B2(parseFloat(t3.coords[1])) + " ";
    2 === t3.type ? a3 += B2(parseFloat(t3.coords[2])) + " " + B2(parseFloat(t3.coords[3])) : a3 += B2(parseFloat(t3.coords[2])) + " " + B2(parseFloat(t3.coords[3])) + " " + B2(parseFloat(t3.coords[4])) + " " + B2(parseFloat(t3.coords[5])), lt2(a3 += "]"), t3.matrix && lt2("/Matrix [" + t3.matrix.toString() + "]"), lt2("/Function " + n3 + " 0 R"), lt2("/Extend [true true]"), lt2(">>"), lt2("endobj");
  }, le2 = function(t3, e3) {
    var n3 = Kt2(), r3 = Xt2();
    e3.push({ resourcesOid: n3, objectOid: r3 }), t3.objectNumber = r3;
    var i2 = [];
    i2.push({ key: "Type", value: "/Pattern" }), i2.push({ key: "PatternType", value: "1" }), i2.push({ key: "PaintType", value: "1" }), i2.push({ key: "TilingType", value: "1" }), i2.push({ key: "BBox", value: "[" + t3.boundingBox.map(B2).join(" ") + "]" }), i2.push({ key: "XStep", value: B2(t3.xStep) }), i2.push({ key: "YStep", value: B2(t3.yStep) }), i2.push({ key: "Resources", value: n3 + " 0 R" }), t3.matrix && i2.push({ key: "Matrix", value: "[" + t3.matrix.toString() + "]" }), ie2({ data: t3.stream, additionalKeyValues: i2, objectId: t3.objectNumber }), lt2("endobj");
  }, he2 = function(t3) {
    for (var e3 in t3.objectNumber = Xt2(), lt2("<<"), t3) switch (e3) {
      case "opacity":
        lt2("/ca " + T2(t3[e3]));
        break;
      case "stroke-opacity":
        lt2("/CA " + T2(t3[e3]));
    }
    lt2(">>"), lt2("endobj");
  }, fe2 = function(t3) {
    Zt2(t3.resourcesOid, true), lt2("<<"), lt2("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"), function() {
      for (var t4 in lt2("/Font <<"), Ft2) Ft2.hasOwnProperty(t4) && (false === v2 || true === v2 && b2.hasOwnProperty(t4)) && lt2("/" + t4 + " " + Ft2[t4].objectNumber + " 0 R");
      lt2(">>");
    }(), function() {
      if (Object.keys(Ct2).length > 0) {
        for (var t4 in lt2("/Shading <<"), Ct2) Ct2.hasOwnProperty(t4) && Ct2[t4] instanceof M && Ct2[t4].objectNumber >= 0 && lt2("/" + t4 + " " + Ct2[t4].objectNumber + " 0 R");
        Dt2.publish("putShadingPatternDict"), lt2(">>");
      }
    }(), function(t4) {
      if (Object.keys(Ct2).length > 0) {
        for (var e3 in lt2("/Pattern <<"), Ct2) Ct2.hasOwnProperty(e3) && Ct2[e3] instanceof y2.TilingPattern && Ct2[e3].objectNumber >= 0 && Ct2[e3].objectNumber < t4 && lt2("/" + e3 + " " + Ct2[e3].objectNumber + " 0 R");
        Dt2.publish("putTilingPatternDict"), lt2(">>");
      }
    }(t3.objectOid), function() {
      if (Object.keys(Bt2).length > 0) {
        var t4;
        for (t4 in lt2("/ExtGState <<"), Bt2) Bt2.hasOwnProperty(t4) && Bt2[t4].objectNumber >= 0 && lt2("/" + t4 + " " + Bt2[t4].objectNumber + " 0 R");
        Dt2.publish("putGStateDict"), lt2(">>");
      }
    }(), function() {
      for (var t4 in lt2("/XObject <<"), zt2) zt2.hasOwnProperty(t4) && zt2[t4].objectNumber >= 0 && lt2("/" + t4 + " " + zt2[t4].objectNumber + " 0 R");
      Dt2.publish("putXobjectDict"), lt2(">>");
    }(), lt2(">>"), lt2("endobj");
  }, de2 = function(t3) {
    It2[t3.fontName] = It2[t3.fontName] || {}, It2[t3.fontName][t3.fontStyle] = t3.id;
  }, pe2 = function(t3, e3, n3, r3, i2) {
    var a3 = { id: "F" + (Object.keys(Ft2).length + 1).toString(10), postScriptName: t3, fontName: e3, fontStyle: n3, encoding: r3, isStandardFont: i2 || false, metadata: {} };
    return Dt2.publish("addFont", { font: a3, instance: this }), Ft2[a3.id] = a3, de2(a3), a3.id;
  }, ge2 = y2.__private__.pdfEscape = y2.pdfEscape = function(t3, e3) {
    return function(t4, e4) {
      var n3, r3, i2, a3, o2, s3, u3, c3, l2;
      if (i2 = (e4 = e4 || {}).sourceEncoding || "Unicode", o2 = e4.outputEncoding, (e4.autoencode || o2) && Ft2[At2].metadata && Ft2[At2].metadata[i2] && Ft2[At2].metadata[i2].encoding && (a3 = Ft2[At2].metadata[i2].encoding, !o2 && Ft2[At2].encoding && (o2 = Ft2[At2].encoding), !o2 && a3.codePages && (o2 = a3.codePages[0]), "string" == typeof o2 && (o2 = a3[o2]), o2)) {
        for (u3 = false, s3 = [], n3 = 0, r3 = t4.length; n3 < r3; n3++) (c3 = o2[t4.charCodeAt(n3)]) ? s3.push(String.fromCharCode(c3)) : s3.push(t4[n3]), s3[n3].charCodeAt(0) >> 8 && (u3 = true);
        t4 = s3.join("");
      }
      for (n3 = t4.length; void 0 === u3 && 0 !== n3; ) t4.charCodeAt(n3 - 1) >> 8 && (u3 = true), n3--;
      if (!u3) return t4;
      for (s3 = e4.noBOM ? [] : [254, 255], n3 = 0, r3 = t4.length; n3 < r3; n3++) {
        if ((l2 = (c3 = t4.charCodeAt(n3)) >> 8) >> 8) throw new Error("Character at position " + n3 + " of string '" + t4 + "' exceeds 16bits. Cannot be encoded into UCS-2 BE");
        s3.push(l2), s3.push(c3 - (l2 << 8));
      }
      return String.fromCharCode.apply(void 0, s3);
    }(t3, e3).replace(/\\/g, "\\\\").replace(/\(/g, "\\(").replace(/\)/g, "\\)");
  }, me2 = y2.__private__.beginPage = function(t3) {
    ot2[++Et2] = [], Rt2[Et2] = { objId: 0, contentsObjId: 0, userUnit: Number(f2), artBox: null, bleedBox: null, cropBox: null, trimBox: null, mediaBox: { bottomLeftX: 0, bottomLeftY: 0, topRightX: Number(t3[0]), topRightY: Number(t3[1]) } }, ye2(Et2), ct2(ot2[$2]);
  }, ve2 = function(t3, e3) {
    var n3, i2, a3;
    switch (r2 = e3 || r2, "string" == typeof t3 && (n3 = x2(t3.toLowerCase()), Array.isArray(n3) && (i2 = n3[0], a3 = n3[1])), Array.isArray(t3) && (i2 = t3[0] * St2, a3 = t3[1] * St2), isNaN(i2) && (i2 = s2[0], a3 = s2[1]), (i2 > 14400 || a3 > 14400) && (o.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"), i2 = Math.min(14400, i2), a3 = Math.min(14400, a3)), s2 = [i2, a3], r2.substr(0, 1)) {
      case "l":
        a3 > i2 && (s2 = [a3, i2]);
        break;
      case "p":
        i2 > a3 && (s2 = [a3, i2]);
    }
    me2(s2), Ze(Xe), lt2(on), 0 !== fn && lt2(fn + " J"), 0 !== dn && lt2(dn + " j"), Dt2.publish("addPage", { pageNumber: Et2 });
  }, be2 = function(t3) {
    t3 > 0 && t3 <= Et2 && (ot2.splice(t3, 1), Rt2.splice(t3, 1), Et2--, $2 > Et2 && ($2 = Et2), this.setPage($2));
  }, ye2 = function(t3) {
    t3 > 0 && t3 <= Et2 && ($2 = t3);
  }, we2 = y2.__private__.getNumberOfPages = y2.getNumberOfPages = function() {
    return ot2.length - 1;
  }, Ne2 = function(t3, e3, n3) {
    var r3, i2 = void 0;
    return n3 = n3 || {}, t3 = void 0 !== t3 ? t3 : Ft2[At2].fontName, e3 = void 0 !== e3 ? e3 : Ft2[At2].fontStyle, r3 = t3.toLowerCase(), void 0 !== It2[r3] && void 0 !== It2[r3][e3] ? i2 = It2[r3][e3] : void 0 !== It2[t3] && void 0 !== It2[t3][e3] ? i2 = It2[t3][e3] : false === n3.disableWarning && o.warn("Unable to look up font label for font '" + t3 + "', '" + e3 + "'. Refer to getFontList() for available fonts."), i2 || n3.noFallback || null == (i2 = It2.times[e3]) && (i2 = It2.times.normal), i2;
  }, Le2 = y2.__private__.putInfo = function() {
    var t3 = Xt2(), e3 = function(t4) {
      return t4;
    };
    for (var n3 in null !== m2 && (e3 = je2.encryptor(t3, 0)), lt2("<<"), lt2("/Producer (" + ge2(e3("jsPDF " + E.version)) + ")"), xt2) xt2.hasOwnProperty(n3) && xt2[n3] && lt2("/" + n3.substr(0, 1).toUpperCase() + n3.substr(1) + " (" + ge2(e3(xt2[n3])) + ")");
    lt2("/CreationDate (" + ge2(e3(W2)) + ")"), lt2(">>"), lt2("endobj");
  }, xe2 = y2.__private__.putCatalog = function(t3) {
    var e3 = (t3 = t3 || {}).rootDictionaryObjId || Qt2;
    switch (Xt2(), lt2("<<"), lt2("/Type /Catalog"), lt2("/Pages " + e3 + " 0 R"), gt2 || (gt2 = "fullwidth"), gt2) {
      case "fullwidth":
        lt2("/OpenAction [3 0 R /FitH null]");
        break;
      case "fullheight":
        lt2("/OpenAction [3 0 R /FitV null]");
        break;
      case "fullpage":
        lt2("/OpenAction [3 0 R /Fit]");
        break;
      case "original":
        lt2("/OpenAction [3 0 R /XYZ null null 1]");
        break;
      default:
        var n3 = "" + gt2;
        "%" === n3.substr(n3.length - 1) && (gt2 = parseInt(gt2) / 100), "number" == typeof gt2 && lt2("/OpenAction [3 0 R /XYZ null null " + T2(gt2) + "]");
    }
    switch (wt2 || (wt2 = "continuous"), wt2) {
      case "continuous":
        lt2("/PageLayout /OneColumn");
        break;
      case "single":
        lt2("/PageLayout /SinglePage");
        break;
      case "two":
      case "twoleft":
        lt2("/PageLayout /TwoColumnLeft");
        break;
      case "tworight":
        lt2("/PageLayout /TwoColumnRight");
    }
    bt2 && lt2("/PageMode /" + bt2), Dt2.publish("putCatalog"), lt2(">>"), lt2("endobj");
  }, Ae2 = y2.__private__.putTrailer = function() {
    lt2("trailer"), lt2("<<"), lt2("/Size " + (et2 + 1)), lt2("/Root " + et2 + " 0 R"), lt2("/Info " + (et2 - 1) + " 0 R"), null !== m2 && lt2("/Encrypt " + je2.oid + " 0 R"), lt2("/ID [ <" + V2 + "> <" + V2 + "> ]"), lt2(">>");
  }, Se2 = y2.__private__.putHeader = function() {
    lt2("%PDF-" + w2), lt2("%ºß¬à");
  }, _e2 = y2.__private__.putXRef = function() {
    var t3 = "0000000000";
    lt2("xref"), lt2("0 " + (et2 + 1)), lt2("0000000000 65535 f ");
    for (var e3 = 1; e3 <= et2; e3++) "function" == typeof nt2[e3] ? lt2((t3 + nt2[e3]()).slice(-10) + " 00000 n ") : void 0 !== nt2[e3] ? lt2((t3 + nt2[e3]).slice(-10) + " 00000 n ") : lt2("0000000000 00000 n ");
  }, Pe2 = y2.__private__.buildDocument = function() {
    var t3;
    et2 = 0, it2 = 0, rt2 = [], nt2 = [], at2 = [], Qt2 = Kt2(), te2 = Kt2(), ct2(rt2), Dt2.publish("buildDocument"), Se2(), oe2(), function() {
      Dt2.publish("putAdditionalObjects");
      for (var t4 = 0; t4 < at2.length; t4++) {
        var e4 = at2[t4];
        Zt2(e4.objId, true), lt2(e4.content), lt2("endobj");
      }
      Dt2.publish("postPutAdditionalObjects");
    }(), t3 = [], function() {
      for (var t4 in Ft2) Ft2.hasOwnProperty(t4) && (false === v2 || true === v2 && b2.hasOwnProperty(t4)) && se2(Ft2[t4]);
    }(), function() {
      var t4;
      for (t4 in Bt2) Bt2.hasOwnProperty(t4) && he2(Bt2[t4]);
    }(), function() {
      for (var t4 in zt2) zt2.hasOwnProperty(t4) && ue2(zt2[t4]);
    }(), function(t4) {
      var e4;
      for (e4 in Ct2) Ct2.hasOwnProperty(e4) && (Ct2[e4] instanceof M ? ce2(Ct2[e4]) : Ct2[e4] instanceof q && le2(Ct2[e4], t4));
    }(t3), Dt2.publish("putResources"), t3.forEach(fe2), fe2({ resourcesOid: te2, objectOid: Number.MAX_SAFE_INTEGER }), Dt2.publish("postPutResources"), null !== m2 && (je2.oid = Xt2(), lt2("<<"), lt2("/Filter /Standard"), lt2("/V " + je2.v), lt2("/R " + je2.r), lt2("/U <" + je2.toHexString(je2.U) + ">"), lt2("/O <" + je2.toHexString(je2.O) + ">"), lt2("/P " + je2.P), lt2(">>"), lt2("endobj")), Le2(), xe2();
    var e3 = it2;
    return _e2(), Ae2(), lt2("startxref"), lt2("" + e3), lt2("%%EOF"), ct2(ot2[$2]), rt2.join("\n");
  }, ke2 = y2.__private__.getBlob = function(t3) {
    return new Blob([ft2(t3)], { type: "application/pdf" });
  }, Fe2 = y2.output = y2.__private__.output = (Jt2 = function(t3, e3) {
    switch ("string" == typeof (e3 = e3 || {}) ? e3 = { filename: e3 } : e3.filename = e3.filename || "generated.pdf", t3) {
      case void 0:
        return Pe2();
      case "save":
        y2.save(e3.filename);
        break;
      case "arraybuffer":
        return ft2(Pe2());
      case "blob":
        return ke2(Pe2());
      case "bloburi":
      case "bloburl":
        if (void 0 !== i.URL && "function" == typeof i.URL.createObjectURL) return i.URL && i.URL.createObjectURL(ke2(Pe2())) || void 0;
        o.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");
        break;
      case "datauristring":
      case "dataurlstring":
        var n3 = "", r3 = Pe2();
        try {
          n3 = d(r3);
        } catch (m3) {
          n3 = d(unescape(encodeURIComponent(r3)));
        }
        return "data:application/pdf;filename=" + e3.filename + ";base64," + n3;
      case "pdfobjectnewwindow":
        if ("[object Window]" === Object.prototype.toString.call(i)) {
          var a3 = "https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js", s3 = ' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';
          e3.pdfObjectUrl && (a3 = e3.pdfObjectUrl, s3 = "");
          var u3 = '<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="' + a3 + '"' + s3 + '></script><script >PDFObject.embed("' + this.output("dataurlstring") + '", ' + JSON.stringify(e3) + ");</script></body></html>", c3 = i.open();
          return null !== c3 && c3.document.write(u3), c3;
        }
        throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");
      case "pdfjsnewwindow":
        if ("[object Window]" === Object.prototype.toString.call(i)) {
          var l2 = '<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="' + (e3.pdfJsUrl || "examples/PDF.js/web/viewer.html") + "?file=&downloadName=" + e3.filename + '" width="500px" height="400px" /></body></html>', h2 = i.open();
          if (null !== h2) {
            h2.document.write(l2);
            var f3 = this;
            h2.document.documentElement.querySelector("#pdfViewer").onload = function() {
              h2.document.title = e3.filename, h2.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(f3.output("bloburl"));
            };
          }
          return h2;
        }
        throw new Error("The option pdfjsnewwindow just works in a browser-environment.");
      case "dataurlnewwindow":
        if ("[object Window]" !== Object.prototype.toString.call(i)) throw new Error("The option dataurlnewwindow just works in a browser-environment.");
        var p3 = '<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="' + this.output("datauristring", e3) + '"></iframe></body></html>', g3 = i.open();
        if (null !== g3 && (g3.document.write(p3), g3.document.title = e3.filename), g3 || "undefined" == typeof safari) return g3;
        break;
      case "datauri":
      case "dataurl":
        return i.document.location.href = this.output("datauristring", e3);
      default:
        return null;
    }
  }, Jt2.foo = function() {
    try {
      return Jt2.apply(this, arguments);
    } catch (n3) {
      var t3 = n3.stack || "";
      ~t3.indexOf(" at ") && (t3 = t3.split(" at ")[1]);
      var e3 = "Error in function " + t3.split("\n")[0].split("<")[0] + ": " + n3.message;
      if (!i.console) throw new Error(e3);
      i.console.error(e3, n3), i.alert && alert(e3);
    }
  }, Jt2.foo.bar = Jt2, Jt2.foo), Ie2 = function(t3) {
    return true === Array.isArray(Tt2) && Tt2.indexOf(t3) > -1;
  };
  switch (a2) {
    case "pt":
      St2 = 1;
      break;
    case "mm":
      St2 = 72 / 25.4;
      break;
    case "cm":
      St2 = 72 / 2.54;
      break;
    case "in":
      St2 = 72;
      break;
    case "px":
      St2 = 1 == Ie2("px_scaling") ? 0.75 : 96 / 72;
      break;
    case "pc":
    case "em":
      St2 = 12;
      break;
    case "ex":
      St2 = 6;
      break;
    default:
      if ("number" != typeof a2) throw new Error("Invalid unit: " + a2);
      St2 = a2;
  }
  var je2 = null;
  K2(), Y2();
  var Ce = y2.__private__.getPageInfo = y2.getPageInfo = function(t3) {
    if (isNaN(t3) || t3 % 1 != 0) throw new Error("Invalid argument passed to jsPDF.getPageInfo");
    return { objId: Rt2[t3].objId, pageNumber: t3, pageContext: Rt2[t3] };
  }, Oe = y2.__private__.getPageInfoByObjId = function(t3) {
    if (isNaN(t3) || t3 % 1 != 0) throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");
    for (var e3 in Rt2) if (Rt2[e3].objId === t3) break;
    return Ce(e3);
  }, Be = y2.__private__.getCurrentPageInfo = y2.getCurrentPageInfo = function() {
    return { objId: Rt2[$2].objId, pageNumber: $2, pageContext: Rt2[$2] };
  };
  y2.addPage = function() {
    return ve2.apply(this, arguments), this;
  }, y2.setPage = function() {
    return ye2.apply(this, arguments), ct2.call(this, ot2[$2]), this;
  }, y2.insertPage = function(t3) {
    return this.addPage(), this.movePage($2, t3), this;
  }, y2.movePage = function(t3, e3) {
    var n3, r3;
    if (t3 > e3) {
      n3 = ot2[t3], r3 = Rt2[t3];
      for (var i2 = t3; i2 > e3; i2--) ot2[i2] = ot2[i2 - 1], Rt2[i2] = Rt2[i2 - 1];
      ot2[e3] = n3, Rt2[e3] = r3, this.setPage(e3);
    } else if (t3 < e3) {
      n3 = ot2[t3], r3 = Rt2[t3];
      for (var a3 = t3; a3 < e3; a3++) ot2[a3] = ot2[a3 + 1], Rt2[a3] = Rt2[a3 + 1];
      ot2[e3] = n3, Rt2[e3] = r3, this.setPage(e3);
    }
    return this;
  }, y2.deletePage = function() {
    return be2.apply(this, arguments), this;
  }, y2.__private__.text = y2.text = function(e3, n3, r3, i2, a3) {
    var o2, s3, u3, c3, l2, h2, f3, d2, p3, g3 = (i2 = i2 || {}).scope || this;
    if ("number" == typeof e3 && "number" == typeof n3 && ("string" == typeof r3 || Array.isArray(r3))) {
      var m3 = r3;
      r3 = n3, n3 = e3, e3 = m3;
    }
    if (arguments[3] instanceof Wt2 == 0 ? (u3 = arguments[4], c3 = arguments[5], "object" === _typeof(f3 = arguments[3]) && null !== f3 || ("string" == typeof u3 && (c3 = u3, u3 = null), "string" == typeof f3 && (c3 = f3, f3 = null), "number" == typeof f3 && (u3 = f3, f3 = null), i2 = { flags: f3, angle: u3, align: c3 })) : (R2("The transform parameter of text() with a Matrix value"), p3 = a3), isNaN(n3) || isNaN(r3) || null == e3) throw new Error("Invalid arguments passed to jsPDF.text");
    if (0 === e3.length) return g3;
    var v3, y3 = "", w3 = "number" == typeof i2.lineHeightFactor ? i2.lineHeightFactor : Je, N3 = g3.internal.scaleFactor;
    function L3(t3) {
      return t3 = t3.split("	").join(Array(i2.TabLen || 9).join(" ")), ge2(t3, f3);
    }
    function x3(t3) {
      for (var e4, n4 = t3.concat(), r4 = [], i3 = n4.length; i3--; ) "string" == typeof (e4 = n4.shift()) ? r4.push(e4) : Array.isArray(t3) && (1 === e4.length || void 0 === e4[1] && void 0 === e4[2]) ? r4.push(e4[0]) : r4.push([e4[0], e4[1], e4[2]]);
      return r4;
    }
    function A3(t3, e4) {
      var n4;
      if ("string" == typeof t3) n4 = e4(t3)[0];
      else if (Array.isArray(t3)) {
        for (var r4, i3, a4 = t3.concat(), o3 = [], s4 = a4.length; s4--; ) "string" == typeof (r4 = a4.shift()) ? o3.push(e4(r4)[0]) : Array.isArray(r4) && "string" == typeof r4[0] && (i3 = e4(r4[0], r4[1], r4[2]), o3.push([i3[0], i3[1], i3[2]]));
        n4 = o3;
      }
      return n4;
    }
    var P3 = false, k3 = true;
    if ("string" == typeof e3) P3 = true;
    else if (Array.isArray(e3)) {
      var F3 = e3.concat();
      s3 = [];
      for (var I2, j2 = F3.length; j2--; ) ("string" != typeof (I2 = F3.shift()) || Array.isArray(I2) && "string" != typeof I2[0]) && (k3 = false);
      P3 = k3;
    }
    if (false === P3) throw new Error('Type of text must be string or Array. "' + e3 + '" is not recognized.');
    "string" == typeof e3 && (e3 = e3.match(/[\r?\n]/) ? e3.split(/\r\n|\r|\n/g) : [e3]);
    var C2 = pt2 / g3.internal.scaleFactor, O2 = C2 * (w3 - 1);
    switch (i2.baseline) {
      case "bottom":
        r3 -= O2;
        break;
      case "top":
        r3 += C2 - O2;
        break;
      case "hanging":
        r3 += C2 - 2 * O2;
        break;
      case "middle":
        r3 += C2 / 2 - O2;
    }
    if ((h2 = i2.maxWidth || 0) > 0 && ("string" == typeof e3 ? e3 = g3.splitTextToSize(e3, h2) : "[object Array]" === Object.prototype.toString.call(e3) && (e3 = e3.reduce(function(t3, e4) {
      return t3.concat(g3.splitTextToSize(e4, h2));
    }, []))), o2 = { text: e3, x: n3, y: r3, options: i2, mutex: { pdfEscape: ge2, activeFontKey: At2, fonts: Ft2, activeFontSize: pt2 } }, Dt2.publish("preProcessText", o2), e3 = o2.text, u3 = (i2 = o2.options).angle, p3 instanceof Wt2 == 0 && u3 && "number" == typeof u3) {
      u3 *= Math.PI / 180, 0 === i2.rotationDirection && (u3 = -u3), _2 === S2 && (u3 = -u3);
      var M2 = Math.cos(u3), q2 = Math.sin(u3);
      p3 = new Wt2(M2, q2, -q2, M2, 0, 0);
    } else u3 && u3 instanceof Wt2 && (p3 = u3);
    _2 !== S2 || p3 || (p3 = Gt2), void 0 !== (l2 = i2.charSpace || ln) && (y3 += B2(U2(l2)) + " Tc\n", this.setCharSpace(this.getCharSpace() || 0)), void 0 !== (d2 = i2.horizontalScale) && (y3 += B2(100 * d2) + " Tz\n"), i2.lang;
    var E2 = -1, D3 = void 0 !== i2.renderingMode ? i2.renderingMode : i2.stroke, T3 = g3.internal.getCurrentPageInfo().pageContext;
    switch (D3) {
      case 0:
      case false:
      case "fill":
        E2 = 0;
        break;
      case 1:
      case true:
      case "stroke":
        E2 = 1;
        break;
      case 2:
      case "fillThenStroke":
        E2 = 2;
        break;
      case 3:
      case "invisible":
        E2 = 3;
        break;
      case 4:
      case "fillAndAddForClipping":
        E2 = 4;
        break;
      case 5:
      case "strokeAndAddPathForClipping":
        E2 = 5;
        break;
      case 6:
      case "fillThenStrokeAndAddToPathForClipping":
        E2 = 6;
        break;
      case 7:
      case "addToPathForClipping":
        E2 = 7;
    }
    var z3 = void 0 !== T3.usedRenderingMode ? T3.usedRenderingMode : -1;
    -1 !== E2 ? y3 += E2 + " Tr\n" : -1 !== z3 && (y3 += "0 Tr\n"), -1 !== E2 && (T3.usedRenderingMode = E2), c3 = i2.align || "left";
    var H3, W3 = pt2 * w3, V3 = g3.internal.pageSize.getWidth(), G3 = Ft2[At2];
    l2 = i2.charSpace || ln, h2 = i2.maxWidth || 0, f3 = Object.assign({ autoencode: true, noBOM: true }, i2.flags);
    var Y3 = [], J3 = function(t3) {
      return g3.getStringUnitWidth(t3, { font: G3, charSpace: l2, fontSize: pt2, doKerning: false }) * pt2 / N3;
    };
    if ("[object Array]" === Object.prototype.toString.call(e3)) {
      var X3;
      s3 = x3(e3), "left" !== c3 && (H3 = s3.map(J3));
      var K3, Z3 = 0;
      if ("right" === c3) {
        n3 -= H3[0], e3 = [], j2 = s3.length;
        for (var $3 = 0; $3 < j2; $3++) 0 === $3 ? (K3 = en(n3), X3 = nn(r3)) : (K3 = U2(Z3 - H3[$3]), X3 = -W3), e3.push([s3[$3], K3, X3]), Z3 = H3[$3];
      } else if ("center" === c3) {
        n3 -= H3[0] / 2, e3 = [], j2 = s3.length;
        for (var Q3 = 0; Q3 < j2; Q3++) 0 === Q3 ? (K3 = en(n3), X3 = nn(r3)) : (K3 = U2((Z3 - H3[Q3]) / 2), X3 = -W3), e3.push([s3[Q3], K3, X3]), Z3 = H3[Q3];
      } else if ("left" === c3) {
        e3 = [], j2 = s3.length;
        for (var tt3 = 0; tt3 < j2; tt3++) e3.push(s3[tt3]);
      } else if ("justify" === c3 && "Identity-H" === G3.encoding) {
        e3 = [], j2 = s3.length, h2 = 0 !== h2 ? h2 : V3;
        for (var et3 = 0, nt3 = 0; nt3 < j2; nt3++) if (X3 = 0 === nt3 ? nn(r3) : -W3, K3 = 0 === nt3 ? en(n3) : et3, nt3 < j2 - 1) {
          var rt3 = U2((h2 - H3[nt3]) / (s3[nt3].split(" ").length - 1)), it3 = s3[nt3].split(" ");
          e3.push([it3[0] + " ", K3, X3]), et3 = 0;
          for (var at3 = 1; at3 < it3.length; at3++) {
            var ot3 = (J3(it3[at3 - 1] + " " + it3[at3]) - J3(it3[at3])) * N3 + rt3;
            at3 == it3.length - 1 ? e3.push([it3[at3], ot3, 0]) : e3.push([it3[at3] + " ", ot3, 0]), et3 -= ot3;
          }
        } else e3.push([s3[nt3], K3, X3]);
        e3.push(["", et3, 0]);
      } else {
        if ("justify" !== c3) throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');
        for (e3 = [], j2 = s3.length, h2 = 0 !== h2 ? h2 : V3, nt3 = 0; nt3 < j2; nt3++) {
          X3 = 0 === nt3 ? nn(r3) : -W3, K3 = 0 === nt3 ? en(n3) : 0;
          var st3 = s3[nt3].split(" ").length - 1, ut3 = st3 > 0 ? (h2 - H3[nt3]) / st3 : 0;
          nt3 < j2 - 1 ? Y3.push(B2(U2(ut3))) : Y3.push(0), e3.push([s3[nt3], K3, X3]);
        }
      }
    }
    true === ("boolean" == typeof i2.R2L ? i2.R2L : vt2) && (e3 = A3(e3, function(t3, e4, n4) {
      return [t3.split("").reverse().join(""), e4, n4];
    })), o2 = { text: e3, x: n3, y: r3, options: i2, mutex: { pdfEscape: ge2, activeFontKey: At2, fonts: Ft2, activeFontSize: pt2 } }, Dt2.publish("postProcessText", o2), e3 = o2.text, v3 = o2.mutex.isHex || false;
    var ct3 = Ft2[At2].encoding;
    "WinAnsiEncoding" !== ct3 && "StandardEncoding" !== ct3 || (e3 = A3(e3, function(t3, e4, n4) {
      return [L3(t3), e4, n4];
    })), s3 = x3(e3), e3 = [];
    for (var ht3, ft3, dt3, gt3 = Array.isArray(s3[0]) ? 1 : 0, mt3 = "", bt3 = function(t3, e4, n4) {
      var r4 = "";
      return n4 instanceof Wt2 ? (n4 = "number" == typeof i2.angle ? Vt2(n4, new Wt2(1, 0, 0, 1, t3, e4)) : Vt2(new Wt2(1, 0, 0, 1, t3, e4), n4), _2 === S2 && (n4 = Vt2(new Wt2(1, 0, 0, -1, 0, 0), n4)), r4 = n4.join(" ") + " Tm\n") : r4 = B2(t3) + " " + B2(e4) + " Td\n", r4;
    }, yt3 = 0; yt3 < s3.length; yt3++) {
      switch (mt3 = "", gt3) {
        case 1:
          dt3 = (v3 ? "<" : "(") + s3[yt3][0] + (v3 ? ">" : ")"), ht3 = parseFloat(s3[yt3][1]), ft3 = parseFloat(s3[yt3][2]);
          break;
        case 0:
          dt3 = (v3 ? "<" : "(") + s3[yt3] + (v3 ? ">" : ")"), ht3 = en(n3), ft3 = nn(r3);
      }
      void 0 !== Y3 && void 0 !== Y3[yt3] && (mt3 = Y3[yt3] + " Tw\n"), 0 === yt3 ? e3.push(mt3 + bt3(ht3, ft3, p3) + dt3) : 0 === gt3 ? e3.push(mt3 + dt3) : 1 === gt3 && e3.push(mt3 + bt3(ht3, ft3, p3) + dt3);
    }
    e3 = 0 === gt3 ? e3.join(" Tj\nT* ") : e3.join(" Tj\n"), e3 += " Tj\n";
    var wt3 = "BT\n/";
    return wt3 += At2 + " " + pt2 + " Tf\n", wt3 += B2(pt2 * w3) + " TL\n", wt3 += un + "\n", wt3 += y3, wt3 += e3, lt2(wt3 += "ET"), b2[At2] = true, g3;
  };
  var Me = y2.__private__.clip = y2.clip = function(t3) {
    return lt2("evenodd" === t3 ? "W*" : "W"), this;
  };
  y2.clipEvenOdd = function() {
    return Me("evenodd");
  }, y2.__private__.discardPath = y2.discardPath = function() {
    return lt2("n"), this;
  };
  var qe = y2.__private__.isValidStyle = function(t3) {
    var e3 = false;
    return -1 !== [void 0, null, "S", "D", "F", "DF", "FD", "f", "f*", "B", "B*", "n"].indexOf(t3) && (e3 = true), e3;
  };
  y2.__private__.setDefaultPathOperation = y2.setDefaultPathOperation = function(t3) {
    return qe(t3) && (g2 = t3), this;
  };
  var Ee = y2.__private__.getStyle = y2.getStyle = function(t3) {
    var e3 = g2;
    switch (t3) {
      case "D":
      case "S":
        e3 = "S";
        break;
      case "F":
        e3 = "f";
        break;
      case "FD":
      case "DF":
        e3 = "B";
        break;
      case "f":
      case "f*":
      case "B":
      case "B*":
        e3 = t3;
    }
    return e3;
  }, Re = y2.close = function() {
    return lt2("h"), this;
  };
  y2.stroke = function() {
    return lt2("S"), this;
  }, y2.fill = function(t3) {
    return De("f", t3), this;
  }, y2.fillEvenOdd = function(t3) {
    return De("f*", t3), this;
  }, y2.fillStroke = function(t3) {
    return De("B", t3), this;
  }, y2.fillStrokeEvenOdd = function(t3) {
    return De("B*", t3), this;
  };
  var De = function(e3, n3) {
    "object" === _typeof(n3) ? Ue(n3, e3) : lt2(e3);
  }, Te = function(t3) {
    null === t3 || _2 === S2 && void 0 === t3 || (t3 = Ee(t3), lt2(t3));
  };
  function ze(t3, e3, n3, r3, i2) {
    var a3 = new q(e3 || this.boundingBox, n3 || this.xStep, r3 || this.yStep, this.gState, i2 || this.matrix);
    a3.stream = this.stream;
    var o2 = t3 + "$$" + this.cloneIndex++ + "$$";
    return Yt2(o2, a3), a3;
  }
  var Ue = function(t3, e3) {
    var n3 = Ot2[t3.key], r3 = Ct2[n3];
    if (r3 instanceof M) lt2("q"), lt2(He(e3)), r3.gState && y2.setGState(r3.gState), lt2(t3.matrix.toString() + " cm"), lt2("/" + n3 + " sh"), lt2("Q");
    else if (r3 instanceof q) {
      var i2 = new Wt2(1, 0, 0, -1, 0, _n());
      t3.matrix && (i2 = i2.multiply(t3.matrix || Gt2), n3 = ze.call(r3, t3.key, t3.boundingBox, t3.xStep, t3.yStep, i2).id), lt2("q"), lt2("/Pattern cs"), lt2("/" + n3 + " scn"), r3.gState && y2.setGState(r3.gState), lt2(e3), lt2("Q");
    }
  }, He = function(t3) {
    switch (t3) {
      case "f":
      case "F":
      case "n":
        return "W n";
      case "f*":
        return "W* n";
      case "B":
      case "S":
        return "W S";
      case "B*":
        return "W* S";
    }
  }, We = y2.moveTo = function(t3, e3) {
    return lt2(B2(U2(t3)) + " " + B2(H2(e3)) + " m"), this;
  }, Ve = y2.lineTo = function(t3, e3) {
    return lt2(B2(U2(t3)) + " " + B2(H2(e3)) + " l"), this;
  }, Ge = y2.curveTo = function(t3, e3, n3, r3, i2, a3) {
    return lt2([B2(U2(t3)), B2(H2(e3)), B2(U2(n3)), B2(H2(r3)), B2(U2(i2)), B2(H2(a3)), "c"].join(" ")), this;
  };
  y2.__private__.line = y2.line = function(t3, e3, n3, r3, i2) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3) || !qe(i2)) throw new Error("Invalid arguments passed to jsPDF.line");
    return _2 === A2 ? this.lines([[n3 - t3, r3 - e3]], t3, e3, [1, 1], i2 || "S") : this.lines([[n3 - t3, r3 - e3]], t3, e3, [1, 1]).stroke();
  }, y2.__private__.lines = y2.lines = function(t3, e3, n3, r3, i2, a3) {
    var o2, s3, u3, c3, l2, h2, f3, d2, p3, g3, m3, v3;
    if ("number" == typeof t3 && (v3 = n3, n3 = e3, e3 = t3, t3 = v3), r3 = r3 || [1, 1], a3 = a3 || false, isNaN(e3) || isNaN(n3) || !Array.isArray(t3) || !Array.isArray(r3) || !qe(i2) || "boolean" != typeof a3) throw new Error("Invalid arguments passed to jsPDF.lines");
    for (We(e3, n3), o2 = r3[0], s3 = r3[1], c3 = t3.length, g3 = e3, m3 = n3, u3 = 0; u3 < c3; u3++) 2 === (l2 = t3[u3]).length ? (g3 = l2[0] * o2 + g3, m3 = l2[1] * s3 + m3, Ve(g3, m3)) : (h2 = l2[0] * o2 + g3, f3 = l2[1] * s3 + m3, d2 = l2[2] * o2 + g3, p3 = l2[3] * s3 + m3, g3 = l2[4] * o2 + g3, m3 = l2[5] * s3 + m3, Ge(h2, f3, d2, p3, g3, m3));
    return a3 && Re(), Te(i2), this;
  }, y2.path = function(t3) {
    for (var e3 = 0; e3 < t3.length; e3++) {
      var n3 = t3[e3], r3 = n3.c;
      switch (n3.op) {
        case "m":
          We(r3[0], r3[1]);
          break;
        case "l":
          Ve(r3[0], r3[1]);
          break;
        case "c":
          Ge.apply(this, r3);
          break;
        case "h":
          Re();
      }
    }
    return this;
  }, y2.__private__.rect = y2.rect = function(t3, e3, n3, r3, i2) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3) || !qe(i2)) throw new Error("Invalid arguments passed to jsPDF.rect");
    return _2 === A2 && (r3 = -r3), lt2([B2(U2(t3)), B2(H2(e3)), B2(U2(n3)), B2(U2(r3)), "re"].join(" ")), Te(i2), this;
  }, y2.__private__.triangle = y2.triangle = function(t3, e3, n3, r3, i2, a3, o2) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3) || isNaN(i2) || isNaN(a3) || !qe(o2)) throw new Error("Invalid arguments passed to jsPDF.triangle");
    return this.lines([[n3 - t3, r3 - e3], [i2 - n3, a3 - r3], [t3 - i2, e3 - a3]], t3, e3, [1, 1], o2, true), this;
  }, y2.__private__.roundedRect = y2.roundedRect = function(t3, e3, n3, r3, i2, a3, o2) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3) || isNaN(i2) || isNaN(a3) || !qe(o2)) throw new Error("Invalid arguments passed to jsPDF.roundedRect");
    var s3 = 4 / 3 * (Math.SQRT2 - 1);
    return i2 = Math.min(i2, 0.5 * n3), a3 = Math.min(a3, 0.5 * r3), this.lines([[n3 - 2 * i2, 0], [i2 * s3, 0, i2, a3 - a3 * s3, i2, a3], [0, r3 - 2 * a3], [0, a3 * s3, -i2 * s3, a3, -i2, a3], [2 * i2 - n3, 0], [-i2 * s3, 0, -i2, -a3 * s3, -i2, -a3], [0, 2 * a3 - r3], [0, -a3 * s3, i2 * s3, -a3, i2, -a3]], t3 + i2, e3, [1, 1], o2, true), this;
  }, y2.__private__.ellipse = y2.ellipse = function(t3, e3, n3, r3, i2) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3) || !qe(i2)) throw new Error("Invalid arguments passed to jsPDF.ellipse");
    var a3 = 4 / 3 * (Math.SQRT2 - 1) * n3, o2 = 4 / 3 * (Math.SQRT2 - 1) * r3;
    return We(t3 + n3, e3), Ge(t3 + n3, e3 - o2, t3 + a3, e3 - r3, t3, e3 - r3), Ge(t3 - a3, e3 - r3, t3 - n3, e3 - o2, t3 - n3, e3), Ge(t3 - n3, e3 + o2, t3 - a3, e3 + r3, t3, e3 + r3), Ge(t3 + a3, e3 + r3, t3 + n3, e3 + o2, t3 + n3, e3), Te(i2), this;
  }, y2.__private__.circle = y2.circle = function(t3, e3, n3, r3) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || !qe(r3)) throw new Error("Invalid arguments passed to jsPDF.circle");
    return this.ellipse(t3, e3, n3, n3, r3);
  }, y2.setFont = function(t3, e3, n3) {
    return n3 && (e3 = F2(e3, n3)), At2 = Ne2(t3, e3, { disableWarning: false }), this;
  };
  var Ye = y2.__private__.getFont = y2.getFont = function() {
    return Ft2[Ne2.apply(y2, arguments)];
  };
  y2.__private__.getFontList = y2.getFontList = function() {
    var t3, e3, n3 = {};
    for (t3 in It2) if (It2.hasOwnProperty(t3)) for (e3 in n3[t3] = [], It2[t3]) It2[t3].hasOwnProperty(e3) && n3[t3].push(e3);
    return n3;
  }, y2.addFont = function(t3, e3, n3, r3, i2) {
    var a3 = ["StandardEncoding", "MacRomanEncoding", "Identity-H", "WinAnsiEncoding"];
    return arguments[3] && -1 !== a3.indexOf(arguments[3]) ? i2 = arguments[3] : arguments[3] && -1 == a3.indexOf(arguments[3]) && (n3 = F2(n3, r3)), pe2.call(this, t3, e3, n3, i2 = i2 || "Identity-H");
  };
  var Je, Xe = e2.lineWidth || 0.200025, Ke = y2.__private__.getLineWidth = y2.getLineWidth = function() {
    return Xe;
  }, Ze = y2.__private__.setLineWidth = y2.setLineWidth = function(t3) {
    return Xe = t3, lt2(B2(U2(t3)) + " w"), this;
  };
  y2.__private__.setLineDash = E.API.setLineDash = E.API.setLineDashPattern = function(t3, e3) {
    if (t3 = t3 || [], e3 = e3 || 0, isNaN(e3) || !Array.isArray(t3)) throw new Error("Invalid arguments passed to jsPDF.setLineDash");
    return t3 = t3.map(function(t4) {
      return B2(U2(t4));
    }).join(" "), e3 = B2(U2(e3)), lt2("[" + t3 + "] " + e3 + " d"), this;
  };
  var $e = y2.__private__.getLineHeight = y2.getLineHeight = function() {
    return pt2 * Je;
  };
  y2.__private__.getLineHeight = y2.getLineHeight = function() {
    return pt2 * Je;
  };
  var Qe = y2.__private__.setLineHeightFactor = y2.setLineHeightFactor = function(t3) {
    return "number" == typeof (t3 = t3 || 1.15) && (Je = t3), this;
  }, tn = y2.__private__.getLineHeightFactor = y2.getLineHeightFactor = function() {
    return Je;
  };
  Qe(e2.lineHeight);
  var en = y2.__private__.getHorizontalCoordinate = function(t3) {
    return U2(t3);
  }, nn = y2.__private__.getVerticalCoordinate = function(t3) {
    return _2 === S2 ? t3 : Rt2[$2].mediaBox.topRightY - Rt2[$2].mediaBox.bottomLeftY - U2(t3);
  }, rn = y2.__private__.getHorizontalCoordinateString = y2.getHorizontalCoordinateString = function(t3) {
    return B2(en(t3));
  }, an = y2.__private__.getVerticalCoordinateString = y2.getVerticalCoordinateString = function(t3) {
    return B2(nn(t3));
  }, on = e2.strokeColor || "0 G";
  y2.__private__.getStrokeColor = y2.getDrawColor = function() {
    return ee2(on);
  }, y2.__private__.setStrokeColor = y2.setDrawColor = function(t3, e3, n3, r3) {
    return on = ne2({ ch1: t3, ch2: e3, ch3: n3, ch4: r3, pdfColorType: "draw", precision: 2 }), lt2(on), this;
  };
  var sn = e2.fillColor || "0 g";
  y2.__private__.getFillColor = y2.getFillColor = function() {
    return ee2(sn);
  }, y2.__private__.setFillColor = y2.setFillColor = function(t3, e3, n3, r3) {
    return sn = ne2({ ch1: t3, ch2: e3, ch3: n3, ch4: r3, pdfColorType: "fill", precision: 2 }), lt2(sn), this;
  };
  var un = e2.textColor || "0 g", cn = y2.__private__.getTextColor = y2.getTextColor = function() {
    return ee2(un);
  };
  y2.__private__.setTextColor = y2.setTextColor = function(t3, e3, n3, r3) {
    return un = ne2({ ch1: t3, ch2: e3, ch3: n3, ch4: r3, pdfColorType: "text", precision: 3 }), this;
  };
  var ln = e2.charSpace, hn = y2.__private__.getCharSpace = y2.getCharSpace = function() {
    return parseFloat(ln || 0);
  };
  y2.__private__.setCharSpace = y2.setCharSpace = function(t3) {
    if (isNaN(t3)) throw new Error("Invalid argument passed to jsPDF.setCharSpace");
    return ln = t3, this;
  };
  var fn = 0;
  y2.CapJoinStyles = { 0: 0, butt: 0, but: 0, miter: 0, 1: 1, round: 1, rounded: 1, circle: 1, 2: 2, projecting: 2, project: 2, square: 2, bevel: 2 }, y2.__private__.setLineCap = y2.setLineCap = function(t3) {
    var e3 = y2.CapJoinStyles[t3];
    if (void 0 === e3) throw new Error("Line cap style of '" + t3 + "' is not recognized. See or extend .CapJoinStyles property for valid styles");
    return fn = e3, lt2(e3 + " J"), this;
  };
  var dn = 0;
  y2.__private__.setLineJoin = y2.setLineJoin = function(t3) {
    var e3 = y2.CapJoinStyles[t3];
    if (void 0 === e3) throw new Error("Line join style of '" + t3 + "' is not recognized. See or extend .CapJoinStyles property for valid styles");
    return dn = e3, lt2(e3 + " j"), this;
  }, y2.__private__.setLineMiterLimit = y2.__private__.setMiterLimit = y2.setLineMiterLimit = y2.setMiterLimit = function(t3) {
    if (t3 = t3 || 0, isNaN(t3)) throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");
    return lt2(B2(U2(t3)) + " M"), this;
  }, y2.GState = O, y2.setGState = function(t3) {
    (t3 = "string" == typeof t3 ? Bt2[Mt2[t3]] : pn(null, t3)).equals(qt2) || (lt2("/" + t3.id + " gs"), qt2 = t3);
  };
  var pn = function(t3, e3) {
    if (!t3 || !Mt2[t3]) {
      var n3 = false;
      for (var r3 in Bt2) if (Bt2.hasOwnProperty(r3) && Bt2[r3].equals(e3)) {
        n3 = true;
        break;
      }
      if (n3) e3 = Bt2[r3];
      else {
        var i2 = "GS" + (Object.keys(Bt2).length + 1).toString(10);
        Bt2[i2] = e3, e3.id = i2;
      }
      return t3 && (Mt2[t3] = e3.id), Dt2.publish("addGState", e3), e3;
    }
  };
  y2.addGState = function(t3, e3) {
    return pn(t3, e3), this;
  }, y2.saveGraphicsState = function() {
    return lt2("q"), jt2.push({ key: At2, size: pt2, color: un }), this;
  }, y2.restoreGraphicsState = function() {
    lt2("Q");
    var t3 = jt2.pop();
    return At2 = t3.key, pt2 = t3.size, un = t3.color, qt2 = null, this;
  }, y2.setCurrentTransformationMatrix = function(t3) {
    return lt2(t3.toString() + " cm"), this;
  }, y2.comment = function(t3) {
    return lt2("#" + t3), this;
  };
  var gn = function(t3, e3) {
    var n3 = t3 || 0;
    Object.defineProperty(this, "x", { enumerable: true, get: function() {
      return n3;
    }, set: function(t4) {
      isNaN(t4) || (n3 = parseFloat(t4));
    } });
    var r3 = e3 || 0;
    Object.defineProperty(this, "y", { enumerable: true, get: function() {
      return r3;
    }, set: function(t4) {
      isNaN(t4) || (r3 = parseFloat(t4));
    } });
    var i2 = "pt";
    return Object.defineProperty(this, "type", { enumerable: true, get: function() {
      return i2;
    }, set: function(t4) {
      i2 = t4.toString();
    } }), this;
  }, mn = function(t3, e3, n3, r3) {
    gn.call(this, t3, e3), this.type = "rect";
    var i2 = n3 || 0;
    Object.defineProperty(this, "w", { enumerable: true, get: function() {
      return i2;
    }, set: function(t4) {
      isNaN(t4) || (i2 = parseFloat(t4));
    } });
    var a3 = r3 || 0;
    return Object.defineProperty(this, "h", { enumerable: true, get: function() {
      return a3;
    }, set: function(t4) {
      isNaN(t4) || (a3 = parseFloat(t4));
    } }), this;
  }, vn = function() {
    this.page = Et2, this.currentPage = $2, this.pages = ot2.slice(0), this.pagesContext = Rt2.slice(0), this.x = _t2, this.y = Pt2, this.matrix = kt2, this.width = wn($2), this.height = Ln($2), this.outputDestination = ut2, this.id = "", this.objectNumber = -1;
  };
  vn.prototype.restore = function() {
    Et2 = this.page, $2 = this.currentPage, Rt2 = this.pagesContext, ot2 = this.pages, _t2 = this.x, Pt2 = this.y, kt2 = this.matrix, Nn($2, this.width), xn($2, this.height), ut2 = this.outputDestination;
  };
  var bn = function(t3, e3, n3, r3, i2) {
    Ht2.push(new vn()), Et2 = $2 = 0, ot2 = [], _t2 = t3, Pt2 = e3, kt2 = i2, me2([n3, r3]);
  };
  for (var yn in y2.beginFormObject = function(t3, e3, n3, r3, i2) {
    return bn(t3, e3, n3, r3, i2), this;
  }, y2.endFormObject = function(t3) {
    return function(t4) {
      if (Ut2[t4]) Ht2.pop().restore();
      else {
        var e3 = new vn(), n3 = "Xo" + (Object.keys(zt2).length + 1).toString(10);
        e3.id = n3, Ut2[t4] = n3, zt2[n3] = e3, Dt2.publish("addFormObject", e3), Ht2.pop().restore();
      }
    }(t3), this;
  }, y2.doFormObject = function(t3, e3) {
    var n3 = zt2[Ut2[t3]];
    return lt2("q"), lt2(e3.toString() + " cm"), lt2("/" + n3.id + " Do"), lt2("Q"), this;
  }, y2.getFormObject = function(t3) {
    var e3 = zt2[Ut2[t3]];
    return { x: e3.x, y: e3.y, width: e3.width, height: e3.height, matrix: e3.matrix };
  }, y2.save = function(t3, e3) {
    return t3 = t3 || "generated.pdf", (e3 = e3 || {}).returnPromise = e3.returnPromise || false, false === e3.returnPromise ? (l(ke2(Pe2()), t3), "function" == typeof l.unload && i.setTimeout && setTimeout(l.unload, 911), this) : new Promise(function(e4, n3) {
      try {
        var r3 = l(ke2(Pe2()), t3);
        "function" == typeof l.unload && i.setTimeout && setTimeout(l.unload, 911), e4(r3);
      } catch (a3) {
        n3(a3.message);
      }
    });
  }, E.API) E.API.hasOwnProperty(yn) && ("events" === yn && E.API.events.length ? function(t3, e3) {
    var n3, r3, i2;
    for (i2 = e3.length - 1; -1 !== i2; i2--) n3 = e3[i2][0], r3 = e3[i2][1], t3.subscribe.apply(t3, [n3].concat("function" == typeof r3 ? [r3] : r3));
  }(Dt2, E.API.events) : y2[yn] = E.API[yn]);
  function wn(t3) {
    return Rt2[t3].mediaBox.topRightX - Rt2[t3].mediaBox.bottomLeftX;
  }
  function Nn(t3, e3) {
    Rt2[t3].mediaBox.topRightX = e3 + Rt2[t3].mediaBox.bottomLeftX;
  }
  function Ln(t3) {
    return Rt2[t3].mediaBox.topRightY - Rt2[t3].mediaBox.bottomLeftY;
  }
  function xn(t3, e3) {
    Rt2[t3].mediaBox.topRightY = e3 + Rt2[t3].mediaBox.bottomLeftY;
  }
  var An = y2.getPageWidth = function(t3) {
    return wn(t3 = t3 || $2) / St2;
  }, Sn = y2.setPageWidth = function(t3, e3) {
    Nn(t3, e3 * St2);
  }, _n = y2.getPageHeight = function(t3) {
    return Ln(t3 = t3 || $2) / St2;
  }, Pn = y2.setPageHeight = function(t3, e3) {
    xn(t3, e3 * St2);
  };
  return y2.internal = { pdfEscape: ge2, getStyle: Ee, getFont: Ye, getFontSize: mt2, getCharSpace: hn, getTextColor: cn, getLineHeight: $e, getLineHeightFactor: tn, getLineWidth: Ke, write: ht2, getHorizontalCoordinate: en, getVerticalCoordinate: nn, getCoordinateString: rn, getVerticalCoordinateString: an, collections: {}, newObject: Xt2, newAdditionalObject: $t2, newObjectDeferred: Kt2, newObjectDeferredBegin: Zt2, getFilters: re2, putStream: ie2, events: Dt2, scaleFactor: St2, pageSize: { getWidth: function() {
    return An($2);
  }, setWidth: function(t3) {
    Sn($2, t3);
  }, getHeight: function() {
    return _n($2);
  }, setHeight: function(t3) {
    Pn($2, t3);
  } }, encryptionOptions: m2, encryption: je2, getEncryptor: function(t3) {
    return null !== m2 ? je2.encryptor(t3, 0) : function(t4) {
      return t4;
    };
  }, output: Fe2, getNumberOfPages: we2, get pages() {
    return ot2;
  }, out: lt2, f2: T2, f3: z2, getPageInfo: Ce, getPageInfoByObjId: Oe, getCurrentPageInfo: Be, getPDFVersion: N2, Point: gn, Rectangle: mn, Matrix: Wt2, hasHotfix: Ie2 }, Object.defineProperty(y2.internal.pageSize, "width", { get: function() {
    return An($2);
  }, set: function(t3) {
    Sn($2, t3);
  }, enumerable: true, configurable: true }), Object.defineProperty(y2.internal.pageSize, "height", { get: function() {
    return _n($2);
  }, set: function(t3) {
    Pn($2, t3);
  }, enumerable: true, configurable: true }), function(t3) {
    for (var e3 = 0, n3 = dt2.length; e3 < n3; e3++) {
      var r3 = pe2.call(this, t3[e3][0], t3[e3][1], t3[e3][2], dt2[e3][3], true);
      false === v2 && (b2[r3] = true);
      var i2 = t3[e3][0].split("-");
      de2({ id: r3, fontName: i2[0], fontStyle: i2[1] || "" });
    }
    Dt2.publish("addFonts", { fonts: Ft2, dictionary: It2 });
  }.call(y2, dt2), At2 = "F1", ve2(s2, r2), Dt2.publish("initialized"), y2;
}
I.prototype.lsbFirstWord = function(t3) {
  return String.fromCharCode(255 & t3, t3 >> 8 & 255, t3 >> 16 & 255, t3 >> 24 & 255);
}, I.prototype.toHexString = function(t3) {
  return t3.split("").map(function(t4) {
    return ("0" + (255 & t4.charCodeAt(0)).toString(16)).slice(-2);
  }).join("");
}, I.prototype.hexToBytes = function(t3) {
  for (var e2 = [], n2 = 0; n2 < t3.length; n2 += 2) e2.push(String.fromCharCode(parseInt(t3.substr(n2, 2), 16)));
  return e2.join("");
}, I.prototype.processOwnerPassword = function(t3, e2) {
  return k(S(e2).substr(0, 5), t3);
}, I.prototype.encryptor = function(t3, e2) {
  var n2 = S(this.encryptionKey + String.fromCharCode(255 & t3, t3 >> 8 & 255, t3 >> 16 & 255, 255 & e2, e2 >> 8 & 255)).substr(0, 10);
  return function(t4) {
    return k(n2, t4);
  };
}, O.prototype.equals = function(e2) {
  var n2, r2 = "id,objectNumber,equals";
  if (!e2 || _typeof(e2) !== _typeof(this)) return false;
  var i2 = 0;
  for (n2 in this) if (!(r2.indexOf(n2) >= 0)) {
    if (this.hasOwnProperty(n2) && !e2.hasOwnProperty(n2)) return false;
    if (this[n2] !== e2[n2]) return false;
    i2++;
  }
  for (n2 in e2) e2.hasOwnProperty(n2) && r2.indexOf(n2) < 0 && i2--;
  return 0 === i2;
}, E.API = { events: [] }, E.version = "3.0.4";
var R = E.API, D = 1, T = function(t3) {
  return t3.replace(/\\/g, "\\\\").replace(/\(/g, "\\(").replace(/\)/g, "\\)");
}, z = function(t3) {
  return t3.replace(/\\\\/g, "\\").replace(/\\\(/g, "(").replace(/\\\)/g, ")");
}, U = function(t3) {
  return t3.toFixed(2);
}, H = function(t3) {
  return t3.toFixed(5);
};
R.__acroform__ = {};
var W = function(t3, e2) {
  t3.prototype = Object.create(e2.prototype), t3.prototype.constructor = t3;
}, V = function(t3) {
  return t3 * D;
}, G = function(t3) {
  var e2 = new ct(), n2 = xt.internal.getHeight(t3) || 0, r2 = xt.internal.getWidth(t3) || 0;
  return e2.BBox = [0, 0, Number(U(r2)), Number(U(n2))], e2;
}, Y = R.__acroform__.setBit = function(t3, e2) {
  if (t3 = t3 || 0, e2 = e2 || 0, isNaN(t3) || isNaN(e2)) throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");
  return t3 | 1 << e2;
}, J = R.__acroform__.clearBit = function(t3, e2) {
  if (t3 = t3 || 0, e2 = e2 || 0, isNaN(t3) || isNaN(e2)) throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");
  return t3 & ~(1 << e2);
}, X = R.__acroform__.getBit = function(t3, e2) {
  if (isNaN(t3) || isNaN(e2)) throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");
  return t3 & 1 << e2 ? 1 : 0;
}, K = R.__acroform__.getBitForPdf = function(t3, e2) {
  if (isNaN(t3) || isNaN(e2)) throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");
  return X(t3, e2 - 1);
}, Z = R.__acroform__.setBitForPdf = function(t3, e2) {
  if (isNaN(t3) || isNaN(e2)) throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");
  return Y(t3, e2 - 1);
}, $ = R.__acroform__.clearBitForPdf = function(t3, e2) {
  if (isNaN(t3) || isNaN(e2)) throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");
  return J(t3, e2 - 1);
}, Q = R.__acroform__.calculateCoordinates = function(t3, e2) {
  var n2 = e2.internal.getHorizontalCoordinate, r2 = e2.internal.getVerticalCoordinate, i2 = t3[0], a2 = t3[1], o2 = t3[2], s2 = t3[3], u2 = {};
  return u2.lowerLeft_X = n2(i2) || 0, u2.lowerLeft_Y = r2(a2 + s2) || 0, u2.upperRight_X = n2(i2 + o2) || 0, u2.upperRight_Y = r2(a2) || 0, [Number(U(u2.lowerLeft_X)), Number(U(u2.lowerLeft_Y)), Number(U(u2.upperRight_X)), Number(U(u2.upperRight_Y))];
}, tt = function(t3) {
  if (t3.appearanceStreamContent) return t3.appearanceStreamContent;
  if (t3.V || t3.DV) {
    var e2 = [], n2 = t3._V || t3.DV, r2 = et(t3, n2), i2 = t3.scope.internal.getFont(t3.fontName, t3.fontStyle).id;
    e2.push("/Tx BMC"), e2.push("q"), e2.push("BT"), e2.push(t3.scope.__private__.encodeColorString(t3.color)), e2.push("/" + i2 + " " + U(r2.fontSize) + " Tf"), e2.push("1 0 0 1 0 0 Tm"), e2.push(r2.text), e2.push("ET"), e2.push("Q"), e2.push("EMC");
    var a2 = G(t3);
    return a2.scope = t3.scope, a2.stream = e2.join("\n"), a2;
  }
}, et = function(t3, e2) {
  var n2 = 0 === t3.fontSize ? t3.maxFontSize : t3.fontSize, r2 = { text: "", fontSize: "" }, i2 = (e2 = ")" == (e2 = "(" == e2.substr(0, 1) ? e2.substr(1) : e2).substr(e2.length - 1) ? e2.substr(0, e2.length - 1) : e2).split(" ");
  i2 = t3.multiline ? i2.map(function(t4) {
    return t4.split("\n");
  }) : i2.map(function(t4) {
    return [t4];
  });
  var a2 = n2, o2 = xt.internal.getHeight(t3) || 0;
  o2 = o2 < 0 ? -o2 : o2;
  var s2 = xt.internal.getWidth(t3) || 0;
  s2 = s2 < 0 ? -s2 : s2;
  var u2 = function(e3, n3, r3) {
    if (e3 + 1 < i2.length) {
      var a3 = n3 + " " + i2[e3 + 1][0];
      return nt(a3, t3, r3).width <= s2 - 4;
    }
    return false;
  };
  a2++;
  t: for (; a2 > 0; ) {
    e2 = "", a2--;
    var c2, l2, h2 = nt("3", t3, a2).height, f2 = t3.multiline ? o2 - a2 : (o2 - h2) / 2, d2 = f2 += 2, p2 = 0, g2 = 0, m2 = 0;
    if (a2 <= 0) {
      e2 = "(...) Tj\n", e2 += "% Width of Text: " + nt(e2, t3, a2 = 12).width + ", FieldWidth:" + s2 + "\n";
      break;
    }
    for (var v2 = "", b2 = 0, y2 = 0; y2 < i2.length; y2++) if (i2.hasOwnProperty(y2)) {
      var w2 = false;
      if (1 !== i2[y2].length && m2 !== i2[y2].length - 1) {
        if ((h2 + 2) * (b2 + 2) + 2 > o2) continue t;
        v2 += i2[y2][m2], w2 = true, g2 = y2, y2--;
      } else {
        v2 = " " == (v2 += i2[y2][m2] + " ").substr(v2.length - 1) ? v2.substr(0, v2.length - 1) : v2;
        var N2 = parseInt(y2), L2 = u2(N2, v2, a2), x2 = y2 >= i2.length - 1;
        if (L2 && !x2) {
          v2 += " ", m2 = 0;
          continue;
        }
        if (L2 || x2) {
          if (x2) g2 = N2;
          else if (t3.multiline && (h2 + 2) * (b2 + 2) + 2 > o2) continue t;
        } else {
          if (!t3.multiline) continue t;
          if ((h2 + 2) * (b2 + 2) + 2 > o2) continue t;
          g2 = N2;
        }
      }
      for (var A2 = "", S2 = p2; S2 <= g2; S2++) {
        var _2 = i2[S2];
        if (t3.multiline) {
          if (S2 === g2) {
            A2 += _2[m2] + " ", m2 = (m2 + 1) % _2.length;
            continue;
          }
          if (S2 === p2) {
            A2 += _2[_2.length - 1] + " ";
            continue;
          }
        }
        A2 += _2[0] + " ";
      }
      switch (A2 = " " == A2.substr(A2.length - 1) ? A2.substr(0, A2.length - 1) : A2, l2 = nt(A2, t3, a2).width, t3.textAlign) {
        case "right":
          c2 = s2 - l2 - 2;
          break;
        case "center":
          c2 = (s2 - l2) / 2;
          break;
        default:
          c2 = 2;
      }
      e2 += U(c2) + " " + U(d2) + " Td\n", e2 += "(" + T(A2) + ") Tj\n", e2 += -U(c2) + " 0 Td\n", d2 = -(a2 + 2), l2 = 0, p2 = w2 ? g2 : g2 + 1, b2++, v2 = "";
    }
    break;
  }
  return r2.text = e2, r2.fontSize = a2, r2;
}, nt = function(t3, e2, n2) {
  var r2 = e2.scope.internal.getFont(e2.fontName, e2.fontStyle), i2 = e2.scope.getStringUnitWidth(t3, { font: r2, fontSize: parseFloat(n2), charSpace: 0 }) * parseFloat(n2);
  return { height: e2.scope.getStringUnitWidth("3", { font: r2, fontSize: parseFloat(n2), charSpace: 0 }) * parseFloat(n2) * 1.5, width: i2 };
}, rt = { fields: [], xForms: [], acroFormDictionaryRoot: null, printedOut: false, internal: null, isInitialized: false }, it$1 = function(t3, e2) {
  var n2 = { type: "reference", object: t3 };
  void 0 === e2.internal.getPageInfo(t3.page).pageContext.annotations.find(function(t4) {
    return t4.type === n2.type && t4.object === n2.object;
  }) && e2.internal.getPageInfo(t3.page).pageContext.annotations.push(n2);
}, at = function(e2, n2) {
  if (n2.scope = e2, void 0 !== e2.internal && (void 0 === e2.internal.acroformPlugin || false === e2.internal.acroformPlugin.isInitialized)) {
    if (ht.FieldNum = 0, e2.internal.acroformPlugin = JSON.parse(JSON.stringify(rt)), e2.internal.acroformPlugin.acroFormDictionaryRoot) throw new Error("Exception while creating AcroformDictionary");
    D = e2.internal.scaleFactor, e2.internal.acroformPlugin.acroFormDictionaryRoot = new lt(), e2.internal.acroformPlugin.acroFormDictionaryRoot.scope = e2, e2.internal.acroformPlugin.acroFormDictionaryRoot._eventID = e2.internal.events.subscribe("postPutResources", function() {
      !function(t3) {
        t3.internal.events.unsubscribe(t3.internal.acroformPlugin.acroFormDictionaryRoot._eventID), delete t3.internal.acroformPlugin.acroFormDictionaryRoot._eventID, t3.internal.acroformPlugin.printedOut = true;
      }(e2);
    }), e2.internal.events.subscribe("buildDocument", function() {
      !function(t3) {
        t3.internal.acroformPlugin.acroFormDictionaryRoot.objId = void 0;
        var e3 = t3.internal.acroformPlugin.acroFormDictionaryRoot.Fields;
        for (var n3 in e3) if (e3.hasOwnProperty(n3)) {
          var r2 = e3[n3];
          r2.objId = void 0, r2.hasAnnotation && it$1(r2, t3);
        }
      }(e2);
    }), e2.internal.events.subscribe("putCatalog", function() {
      !function(t3) {
        if (void 0 === t3.internal.acroformPlugin.acroFormDictionaryRoot) throw new Error("putCatalogCallback: Root missing.");
        t3.internal.write("/AcroForm " + t3.internal.acroformPlugin.acroFormDictionaryRoot.objId + " 0 R");
      }(e2);
    }), e2.internal.events.subscribe("postPutPages", function(n3) {
      !function(e3, n4) {
        var r2 = !e3;
        for (var i2 in e3 || (n4.internal.newObjectDeferredBegin(n4.internal.acroformPlugin.acroFormDictionaryRoot.objId, true), n4.internal.acroformPlugin.acroFormDictionaryRoot.putStream()), e3 = e3 || n4.internal.acroformPlugin.acroFormDictionaryRoot.Kids) if (e3.hasOwnProperty(i2)) {
          var a2 = e3[i2], o2 = [], s2 = a2.Rect;
          if (a2.Rect && (a2.Rect = Q(a2.Rect, n4)), n4.internal.newObjectDeferredBegin(a2.objId, true), a2.DA = xt.createDefaultAppearanceStream(a2), "object" === _typeof(a2) && "function" == typeof a2.getKeyValueListForStream && (o2 = a2.getKeyValueListForStream()), a2.Rect = s2, a2.hasAppearanceStream && !a2.appearanceStreamContent) {
            var u2 = tt(a2);
            o2.push({ key: "AP", value: "<</N " + u2 + ">>" }), n4.internal.acroformPlugin.xForms.push(u2);
          }
          if (a2.appearanceStreamContent) {
            var c2 = "";
            for (var l2 in a2.appearanceStreamContent) if (a2.appearanceStreamContent.hasOwnProperty(l2)) {
              var h2 = a2.appearanceStreamContent[l2];
              if (c2 += "/" + l2 + " ", c2 += "<<", Object.keys(h2).length >= 1 || Array.isArray(h2)) {
                for (var i2 in h2) if (h2.hasOwnProperty(i2)) {
                  var f2 = h2[i2];
                  "function" == typeof f2 && (f2 = f2.call(n4, a2)), c2 += "/" + i2 + " " + f2 + " ", n4.internal.acroformPlugin.xForms.indexOf(f2) >= 0 || n4.internal.acroformPlugin.xForms.push(f2);
                }
              } else "function" == typeof (f2 = h2) && (f2 = f2.call(n4, a2)), c2 += "/" + i2 + " " + f2, n4.internal.acroformPlugin.xForms.indexOf(f2) >= 0 || n4.internal.acroformPlugin.xForms.push(f2);
              c2 += ">>";
            }
            o2.push({ key: "AP", value: "<<\n" + c2 + ">>" });
          }
          n4.internal.putStream({ additionalKeyValues: o2, objectId: a2.objId }), n4.internal.out("endobj");
        }
        r2 && function(e4, n5) {
          for (var r3 in e4) if (e4.hasOwnProperty(r3)) {
            var i3 = r3, a3 = e4[r3];
            n5.internal.newObjectDeferredBegin(a3.objId, true), "object" === _typeof(a3) && "function" == typeof a3.putStream && a3.putStream(), delete e4[i3];
          }
        }(n4.internal.acroformPlugin.xForms, n4);
      }(n3, e2);
    }), e2.internal.acroformPlugin.isInitialized = true;
  }
}, ot = R.__acroform__.arrayToPdfArray = function(e2, n2, r2) {
  var i2 = function(t3) {
    return t3;
  };
  if (Array.isArray(e2)) {
    for (var a2 = "[", o2 = 0; o2 < e2.length; o2++) switch (0 !== o2 && (a2 += " "), _typeof(e2[o2])) {
      case "boolean":
      case "number":
      case "object":
        a2 += e2[o2].toString();
        break;
      case "string":
        "/" !== e2[o2].substr(0, 1) ? (void 0 !== n2 && r2 && (i2 = r2.internal.getEncryptor(n2)), a2 += "(" + T(i2(e2[o2].toString())) + ")") : a2 += e2[o2].toString();
    }
    return a2 + "]";
  }
  throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray");
}, st = function(t3, e2, n2) {
  var r2 = function(t4) {
    return t4;
  };
  return void 0 !== e2 && n2 && (r2 = n2.internal.getEncryptor(e2)), (t3 = t3 || "").toString(), "(" + T(r2(t3)) + ")";
}, ut = function() {
  this._objId = void 0, this._scope = void 0, Object.defineProperty(this, "objId", { get: function() {
    if (void 0 === this._objId) {
      if (void 0 === this.scope) return;
      this._objId = this.scope.internal.newObjectDeferred();
    }
    return this._objId;
  }, set: function(t3) {
    this._objId = t3;
  } }), Object.defineProperty(this, "scope", { value: this._scope, writable: true });
};
ut.prototype.toString = function() {
  return this.objId + " 0 R";
}, ut.prototype.putStream = function() {
  var t3 = this.getKeyValueListForStream();
  this.scope.internal.putStream({ data: this.stream, additionalKeyValues: t3, objectId: this.objId }), this.scope.internal.out("endobj");
}, ut.prototype.getKeyValueListForStream = function() {
  var t3 = [], e2 = Object.getOwnPropertyNames(this).filter(function(t4) {
    return "content" != t4 && "appearanceStreamContent" != t4 && "scope" != t4 && "objId" != t4 && "_" != t4.substring(0, 1);
  });
  for (var n2 in e2) if (false === Object.getOwnPropertyDescriptor(this, e2[n2]).configurable) {
    var r2 = e2[n2], i2 = this[r2];
    i2 && (Array.isArray(i2) ? t3.push({ key: r2, value: ot(i2, this.objId, this.scope) }) : i2 instanceof ut ? (i2.scope = this.scope, t3.push({ key: r2, value: i2.objId + " 0 R" })) : "function" != typeof i2 && t3.push({ key: r2, value: i2 }));
  }
  return t3;
};
var ct = function() {
  ut.call(this), Object.defineProperty(this, "Type", { value: "/XObject", configurable: false, writable: true }), Object.defineProperty(this, "Subtype", { value: "/Form", configurable: false, writable: true }), Object.defineProperty(this, "FormType", { value: 1, configurable: false, writable: true });
  var t3, e2 = [];
  Object.defineProperty(this, "BBox", { configurable: false, get: function() {
    return e2;
  }, set: function(t4) {
    e2 = t4;
  } }), Object.defineProperty(this, "Resources", { value: "2 0 R", configurable: false, writable: true }), Object.defineProperty(this, "stream", { enumerable: false, configurable: true, set: function(e3) {
    t3 = e3.trim();
  }, get: function() {
    return t3 || null;
  } });
};
W(ct, ut);
var lt = function() {
  ut.call(this);
  var t3, e2 = [];
  Object.defineProperty(this, "Kids", { enumerable: false, configurable: true, get: function() {
    return e2.length > 0 ? e2 : void 0;
  } }), Object.defineProperty(this, "Fields", { enumerable: false, configurable: false, get: function() {
    return e2;
  } }), Object.defineProperty(this, "DA", { enumerable: false, configurable: false, get: function() {
    if (t3) {
      var e3 = function(t4) {
        return t4;
      };
      return this.scope && (e3 = this.scope.internal.getEncryptor(this.objId)), "(" + T(e3(t3)) + ")";
    }
  }, set: function(e3) {
    t3 = e3;
  } });
};
W(lt, ut);
var ht = function t2() {
  ut.call(this);
  var e2 = 4;
  Object.defineProperty(this, "F", { enumerable: false, configurable: false, get: function() {
    return e2;
  }, set: function(t3) {
    if (isNaN(t3)) throw new Error('Invalid value "' + t3 + '" for attribute F supplied.');
    e2 = t3;
  } }), Object.defineProperty(this, "showWhenPrinted", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(e2, 3));
  }, set: function(t3) {
    true === Boolean(t3) ? this.F = Z(e2, 3) : this.F = $(e2, 3);
  } });
  var n2 = 0;
  Object.defineProperty(this, "Ff", { enumerable: false, configurable: false, get: function() {
    return n2;
  }, set: function(t3) {
    if (isNaN(t3)) throw new Error('Invalid value "' + t3 + '" for attribute Ff supplied.');
    n2 = t3;
  } });
  var r2 = [];
  Object.defineProperty(this, "Rect", { enumerable: false, configurable: false, get: function() {
    if (0 !== r2.length) return r2;
  }, set: function(t3) {
    r2 = void 0 !== t3 ? t3 : [];
  } }), Object.defineProperty(this, "x", { enumerable: true, configurable: true, get: function() {
    return !r2 || isNaN(r2[0]) ? 0 : r2[0];
  }, set: function(t3) {
    r2[0] = t3;
  } }), Object.defineProperty(this, "y", { enumerable: true, configurable: true, get: function() {
    return !r2 || isNaN(r2[1]) ? 0 : r2[1];
  }, set: function(t3) {
    r2[1] = t3;
  } }), Object.defineProperty(this, "width", { enumerable: true, configurable: true, get: function() {
    return !r2 || isNaN(r2[2]) ? 0 : r2[2];
  }, set: function(t3) {
    r2[2] = t3;
  } }), Object.defineProperty(this, "height", { enumerable: true, configurable: true, get: function() {
    return !r2 || isNaN(r2[3]) ? 0 : r2[3];
  }, set: function(t3) {
    r2[3] = t3;
  } });
  var i2 = "";
  Object.defineProperty(this, "FT", { enumerable: true, configurable: false, get: function() {
    return i2;
  }, set: function(t3) {
    switch (t3) {
      case "/Btn":
      case "/Tx":
      case "/Ch":
      case "/Sig":
        i2 = t3;
        break;
      default:
        throw new Error('Invalid value "' + t3 + '" for attribute FT supplied.');
    }
  } });
  var a2 = null;
  Object.defineProperty(this, "T", { enumerable: true, configurable: false, get: function() {
    if (!a2 || a2.length < 1) {
      if (this instanceof yt) return;
      a2 = "FieldObject" + t2.FieldNum++;
    }
    var e3 = function(t3) {
      return t3;
    };
    return this.scope && (e3 = this.scope.internal.getEncryptor(this.objId)), "(" + T(e3(a2)) + ")";
  }, set: function(t3) {
    a2 = t3.toString();
  } }), Object.defineProperty(this, "fieldName", { configurable: true, enumerable: true, get: function() {
    return a2;
  }, set: function(t3) {
    a2 = t3;
  } });
  var o2 = "helvetica";
  Object.defineProperty(this, "fontName", { enumerable: true, configurable: true, get: function() {
    return o2;
  }, set: function(t3) {
    o2 = t3;
  } });
  var s2 = "normal";
  Object.defineProperty(this, "fontStyle", { enumerable: true, configurable: true, get: function() {
    return s2;
  }, set: function(t3) {
    s2 = t3;
  } });
  var u2 = 0;
  Object.defineProperty(this, "fontSize", { enumerable: true, configurable: true, get: function() {
    return u2;
  }, set: function(t3) {
    u2 = t3;
  } });
  var c2 = void 0;
  Object.defineProperty(this, "maxFontSize", { enumerable: true, configurable: true, get: function() {
    return void 0 === c2 ? 50 / D : c2;
  }, set: function(t3) {
    c2 = t3;
  } });
  var l2 = "black";
  Object.defineProperty(this, "color", { enumerable: true, configurable: true, get: function() {
    return l2;
  }, set: function(t3) {
    l2 = t3;
  } });
  var h2 = "/F1 0 Tf 0 g";
  Object.defineProperty(this, "DA", { enumerable: true, configurable: false, get: function() {
    if (!(!h2 || this instanceof yt || this instanceof Nt)) return st(h2, this.objId, this.scope);
  }, set: function(t3) {
    t3 = t3.toString(), h2 = t3;
  } });
  var f2 = null;
  Object.defineProperty(this, "DV", { enumerable: false, configurable: false, get: function() {
    if (f2) return this instanceof mt == 0 ? st(f2, this.objId, this.scope) : f2;
  }, set: function(t3) {
    t3 = t3.toString(), f2 = this instanceof mt == 0 ? "(" === t3.substr(0, 1) ? z(t3.substr(1, t3.length - 2)) : z(t3) : t3;
  } }), Object.defineProperty(this, "defaultValue", { enumerable: true, configurable: true, get: function() {
    return this instanceof mt == 1 ? z(f2.substr(1, f2.length - 1)) : f2;
  }, set: function(t3) {
    t3 = t3.toString(), f2 = this instanceof mt == 1 ? "/" + t3 : t3;
  } });
  var d2 = null;
  Object.defineProperty(this, "_V", { enumerable: false, configurable: false, get: function() {
    if (d2) return d2;
  }, set: function(t3) {
    this.V = t3;
  } }), Object.defineProperty(this, "V", { enumerable: false, configurable: false, get: function() {
    if (d2) return this instanceof mt == 0 ? st(d2, this.objId, this.scope) : d2;
  }, set: function(t3) {
    t3 = t3.toString(), d2 = this instanceof mt == 0 ? "(" === t3.substr(0, 1) ? z(t3.substr(1, t3.length - 2)) : z(t3) : t3;
  } }), Object.defineProperty(this, "value", { enumerable: true, configurable: true, get: function() {
    return this instanceof mt == 1 ? z(d2.substr(1, d2.length - 1)) : d2;
  }, set: function(t3) {
    t3 = t3.toString(), d2 = this instanceof mt == 1 ? "/" + t3 : t3;
  } }), Object.defineProperty(this, "hasAnnotation", { enumerable: true, configurable: true, get: function() {
    return this.Rect;
  } }), Object.defineProperty(this, "Type", { enumerable: true, configurable: false, get: function() {
    return this.hasAnnotation ? "/Annot" : null;
  } }), Object.defineProperty(this, "Subtype", { enumerable: true, configurable: false, get: function() {
    return this.hasAnnotation ? "/Widget" : null;
  } });
  var p2, g2 = false;
  Object.defineProperty(this, "hasAppearanceStream", { enumerable: true, configurable: true, get: function() {
    return g2;
  }, set: function(t3) {
    t3 = Boolean(t3), g2 = t3;
  } }), Object.defineProperty(this, "page", { enumerable: true, configurable: true, get: function() {
    if (p2) return p2;
  }, set: function(t3) {
    p2 = t3;
  } }), Object.defineProperty(this, "readOnly", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 1));
  }, set: function(t3) {
    true === Boolean(t3) ? this.Ff = Z(this.Ff, 1) : this.Ff = $(this.Ff, 1);
  } }), Object.defineProperty(this, "required", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 2));
  }, set: function(t3) {
    true === Boolean(t3) ? this.Ff = Z(this.Ff, 2) : this.Ff = $(this.Ff, 2);
  } }), Object.defineProperty(this, "noExport", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 3));
  }, set: function(t3) {
    true === Boolean(t3) ? this.Ff = Z(this.Ff, 3) : this.Ff = $(this.Ff, 3);
  } });
  var m2 = null;
  Object.defineProperty(this, "Q", { enumerable: true, configurable: false, get: function() {
    if (null !== m2) return m2;
  }, set: function(t3) {
    if (-1 === [0, 1, 2].indexOf(t3)) throw new Error('Invalid value "' + t3 + '" for attribute Q supplied.');
    m2 = t3;
  } }), Object.defineProperty(this, "textAlign", { get: function() {
    var t3;
    switch (m2) {
      case 0:
      default:
        t3 = "left";
        break;
      case 1:
        t3 = "center";
        break;
      case 2:
        t3 = "right";
    }
    return t3;
  }, configurable: true, enumerable: true, set: function(t3) {
    switch (t3) {
      case "right":
      case 2:
        m2 = 2;
        break;
      case "center":
      case 1:
        m2 = 1;
        break;
      default:
        m2 = 0;
    }
  } });
};
W(ht, ut);
var ft = function() {
  ht.call(this), this.FT = "/Ch", this.V = "()", this.fontName = "zapfdingbats";
  var t3 = 0;
  Object.defineProperty(this, "TI", { enumerable: true, configurable: false, get: function() {
    return t3;
  }, set: function(e3) {
    t3 = e3;
  } }), Object.defineProperty(this, "topIndex", { enumerable: true, configurable: true, get: function() {
    return t3;
  }, set: function(e3) {
    t3 = e3;
  } });
  var e2 = [];
  Object.defineProperty(this, "Opt", { enumerable: true, configurable: false, get: function() {
    return ot(e2, this.objId, this.scope);
  }, set: function(t4) {
    var n2, r2;
    r2 = [], "string" == typeof (n2 = t4) && (r2 = function(t5, e3, n3) {
      n3 || (n3 = 1);
      for (var r3, i2 = []; r3 = e3.exec(t5); ) i2.push(r3[n3]);
      return i2;
    }(n2, /\((.*?)\)/g)), e2 = r2;
  } }), this.getOptions = function() {
    return e2;
  }, this.setOptions = function(t4) {
    e2 = t4, this.sort && e2.sort();
  }, this.addOption = function(t4) {
    t4 = (t4 = t4 || "").toString(), e2.push(t4), this.sort && e2.sort();
  }, this.removeOption = function(t4, n2) {
    for (n2 = n2 || false, t4 = (t4 = t4 || "").toString(); -1 !== e2.indexOf(t4) && (e2.splice(e2.indexOf(t4), 1), false !== n2); ) ;
  }, Object.defineProperty(this, "combo", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 18));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 18) : this.Ff = $(this.Ff, 18);
  } }), Object.defineProperty(this, "edit", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 19));
  }, set: function(t4) {
    true === this.combo && (true === Boolean(t4) ? this.Ff = Z(this.Ff, 19) : this.Ff = $(this.Ff, 19));
  } }), Object.defineProperty(this, "sort", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 20));
  }, set: function(t4) {
    true === Boolean(t4) ? (this.Ff = Z(this.Ff, 20), e2.sort()) : this.Ff = $(this.Ff, 20);
  } }), Object.defineProperty(this, "multiSelect", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 22));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 22) : this.Ff = $(this.Ff, 22);
  } }), Object.defineProperty(this, "doNotSpellCheck", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 23));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 23) : this.Ff = $(this.Ff, 23);
  } }), Object.defineProperty(this, "commitOnSelChange", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 27));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 27) : this.Ff = $(this.Ff, 27);
  } }), this.hasAppearanceStream = false;
};
W(ft, ht);
var dt = function() {
  ft.call(this), this.fontName = "helvetica", this.combo = false;
};
W(dt, ft);
var pt = function() {
  dt.call(this), this.combo = true;
};
W(pt, dt);
var gt = function() {
  pt.call(this), this.edit = true;
};
W(gt, pt);
var mt = function() {
  ht.call(this), this.FT = "/Btn", Object.defineProperty(this, "noToggleToOff", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 15));
  }, set: function(t3) {
    true === Boolean(t3) ? this.Ff = Z(this.Ff, 15) : this.Ff = $(this.Ff, 15);
  } }), Object.defineProperty(this, "radio", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 16));
  }, set: function(t3) {
    true === Boolean(t3) ? this.Ff = Z(this.Ff, 16) : this.Ff = $(this.Ff, 16);
  } }), Object.defineProperty(this, "pushButton", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 17));
  }, set: function(t3) {
    true === Boolean(t3) ? this.Ff = Z(this.Ff, 17) : this.Ff = $(this.Ff, 17);
  } }), Object.defineProperty(this, "radioIsUnison", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 26));
  }, set: function(t3) {
    true === Boolean(t3) ? this.Ff = Z(this.Ff, 26) : this.Ff = $(this.Ff, 26);
  } });
  var e2, n2 = {};
  Object.defineProperty(this, "MK", { enumerable: false, configurable: false, get: function() {
    var t3 = function(t4) {
      return t4;
    };
    if (this.scope && (t3 = this.scope.internal.getEncryptor(this.objId)), 0 !== Object.keys(n2).length) {
      var e3, r2 = [];
      for (e3 in r2.push("<<"), n2) r2.push("/" + e3 + " (" + T(t3(n2[e3])) + ")");
      return r2.push(">>"), r2.join("\n");
    }
  }, set: function(e3) {
    "object" === _typeof(e3) && (n2 = e3);
  } }), Object.defineProperty(this, "caption", { enumerable: true, configurable: true, get: function() {
    return n2.CA || "";
  }, set: function(t3) {
    "string" == typeof t3 && (n2.CA = t3);
  } }), Object.defineProperty(this, "AS", { enumerable: false, configurable: false, get: function() {
    return e2;
  }, set: function(t3) {
    e2 = t3;
  } }), Object.defineProperty(this, "appearanceState", { enumerable: true, configurable: true, get: function() {
    return e2.substr(1, e2.length - 1);
  }, set: function(t3) {
    e2 = "/" + t3;
  } });
};
W(mt, ht);
var vt = function() {
  mt.call(this), this.pushButton = true;
};
W(vt, mt);
var bt = function() {
  mt.call(this), this.radio = true, this.pushButton = false;
  var t3 = [];
  Object.defineProperty(this, "Kids", { enumerable: true, configurable: false, get: function() {
    return t3;
  }, set: function(e2) {
    t3 = void 0 !== e2 ? e2 : [];
  } });
};
W(bt, mt);
var yt = function() {
  var e2, n2;
  ht.call(this), Object.defineProperty(this, "Parent", { enumerable: false, configurable: false, get: function() {
    return e2;
  }, set: function(t3) {
    e2 = t3;
  } }), Object.defineProperty(this, "optionName", { enumerable: false, configurable: true, get: function() {
    return n2;
  }, set: function(t3) {
    n2 = t3;
  } });
  var r2, i2 = {};
  Object.defineProperty(this, "MK", { enumerable: false, configurable: false, get: function() {
    var t3 = function(t4) {
      return t4;
    };
    this.scope && (t3 = this.scope.internal.getEncryptor(this.objId));
    var e3, n3 = [];
    for (e3 in n3.push("<<"), i2) n3.push("/" + e3 + " (" + T(t3(i2[e3])) + ")");
    return n3.push(">>"), n3.join("\n");
  }, set: function(e3) {
    "object" === _typeof(e3) && (i2 = e3);
  } }), Object.defineProperty(this, "caption", { enumerable: true, configurable: true, get: function() {
    return i2.CA || "";
  }, set: function(t3) {
    "string" == typeof t3 && (i2.CA = t3);
  } }), Object.defineProperty(this, "AS", { enumerable: false, configurable: false, get: function() {
    return r2;
  }, set: function(t3) {
    r2 = t3;
  } }), Object.defineProperty(this, "appearanceState", { enumerable: true, configurable: true, get: function() {
    return r2.substr(1, r2.length - 1);
  }, set: function(t3) {
    r2 = "/" + t3;
  } }), this.caption = "l", this.appearanceState = "Off", this._AppearanceType = xt.RadioButton.Circle, this.appearanceStreamContent = this._AppearanceType.createAppearanceStream(this.optionName);
};
W(yt, ht), bt.prototype.setAppearance = function(t3) {
  if (!("createAppearanceStream" in t3) || !("getCA" in t3)) throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");
  for (var e2 in this.Kids) if (this.Kids.hasOwnProperty(e2)) {
    var n2 = this.Kids[e2];
    n2.appearanceStreamContent = t3.createAppearanceStream(n2.optionName), n2.caption = t3.getCA();
  }
}, bt.prototype.createOption = function(t3) {
  var e2 = new yt();
  return e2.Parent = this, e2.optionName = t3, this.Kids.push(e2), At.call(this.scope, e2), e2;
};
var wt = function() {
  mt.call(this), this.fontName = "zapfdingbats", this.caption = "3", this.appearanceState = "On", this.value = "On", this.textAlign = "center", this.appearanceStreamContent = xt.CheckBox.createAppearanceStream();
};
W(wt, mt);
var Nt = function() {
  ht.call(this), this.FT = "/Tx", Object.defineProperty(this, "multiline", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 13));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 13) : this.Ff = $(this.Ff, 13);
  } }), Object.defineProperty(this, "fileSelect", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 21));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 21) : this.Ff = $(this.Ff, 21);
  } }), Object.defineProperty(this, "doNotSpellCheck", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 23));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 23) : this.Ff = $(this.Ff, 23);
  } }), Object.defineProperty(this, "doNotScroll", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 24));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 24) : this.Ff = $(this.Ff, 24);
  } }), Object.defineProperty(this, "comb", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 25));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 25) : this.Ff = $(this.Ff, 25);
  } }), Object.defineProperty(this, "richText", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 26));
  }, set: function(t4) {
    true === Boolean(t4) ? this.Ff = Z(this.Ff, 26) : this.Ff = $(this.Ff, 26);
  } });
  var t3 = null;
  Object.defineProperty(this, "MaxLen", { enumerable: true, configurable: false, get: function() {
    return t3;
  }, set: function(e2) {
    t3 = e2;
  } }), Object.defineProperty(this, "maxLength", { enumerable: true, configurable: true, get: function() {
    return t3;
  }, set: function(e2) {
    Number.isInteger(e2) && (t3 = e2);
  } }), Object.defineProperty(this, "hasAppearanceStream", { enumerable: true, configurable: true, get: function() {
    return this.V || this.DV;
  } });
};
W(Nt, ht);
var Lt = function() {
  Nt.call(this), Object.defineProperty(this, "password", { enumerable: true, configurable: true, get: function() {
    return Boolean(K(this.Ff, 14));
  }, set: function(t3) {
    true === Boolean(t3) ? this.Ff = Z(this.Ff, 14) : this.Ff = $(this.Ff, 14);
  } }), this.password = true;
};
W(Lt, Nt);
var xt = { CheckBox: { createAppearanceStream: function() {
  return { N: { On: xt.CheckBox.YesNormal }, D: { On: xt.CheckBox.YesPushDown, Off: xt.CheckBox.OffPushDown } };
}, YesPushDown: function(t3) {
  var e2 = G(t3);
  e2.scope = t3.scope;
  var n2 = [], r2 = t3.scope.internal.getFont(t3.fontName, t3.fontStyle).id, i2 = t3.scope.__private__.encodeColorString(t3.color), a2 = et(t3, t3.caption);
  return n2.push("0.749023 g"), n2.push("0 0 " + U(xt.internal.getWidth(t3)) + " " + U(xt.internal.getHeight(t3)) + " re"), n2.push("f"), n2.push("BMC"), n2.push("q"), n2.push("0 0 1 rg"), n2.push("/" + r2 + " " + U(a2.fontSize) + " Tf " + i2), n2.push("BT"), n2.push(a2.text), n2.push("ET"), n2.push("Q"), n2.push("EMC"), e2.stream = n2.join("\n"), e2;
}, YesNormal: function(t3) {
  var e2 = G(t3);
  e2.scope = t3.scope;
  var n2 = t3.scope.internal.getFont(t3.fontName, t3.fontStyle).id, r2 = t3.scope.__private__.encodeColorString(t3.color), i2 = [], a2 = xt.internal.getHeight(t3), o2 = xt.internal.getWidth(t3), s2 = et(t3, t3.caption);
  return i2.push("1 g"), i2.push("0 0 " + U(o2) + " " + U(a2) + " re"), i2.push("f"), i2.push("q"), i2.push("0 0 1 rg"), i2.push("0 0 " + U(o2 - 1) + " " + U(a2 - 1) + " re"), i2.push("W"), i2.push("n"), i2.push("0 g"), i2.push("BT"), i2.push("/" + n2 + " " + U(s2.fontSize) + " Tf " + r2), i2.push(s2.text), i2.push("ET"), i2.push("Q"), e2.stream = i2.join("\n"), e2;
}, OffPushDown: function(t3) {
  var e2 = G(t3);
  e2.scope = t3.scope;
  var n2 = [];
  return n2.push("0.749023 g"), n2.push("0 0 " + U(xt.internal.getWidth(t3)) + " " + U(xt.internal.getHeight(t3)) + " re"), n2.push("f"), e2.stream = n2.join("\n"), e2;
} }, RadioButton: { Circle: { createAppearanceStream: function(t3) {
  var e2 = { D: { Off: xt.RadioButton.Circle.OffPushDown }, N: {} };
  return e2.N[t3] = xt.RadioButton.Circle.YesNormal, e2.D[t3] = xt.RadioButton.Circle.YesPushDown, e2;
}, getCA: function() {
  return "l";
}, YesNormal: function(t3) {
  var e2 = G(t3);
  e2.scope = t3.scope;
  var n2 = [], r2 = xt.internal.getWidth(t3) <= xt.internal.getHeight(t3) ? xt.internal.getWidth(t3) / 4 : xt.internal.getHeight(t3) / 4;
  r2 = Number((0.9 * r2).toFixed(5));
  var i2 = xt.internal.Bezier_C, a2 = Number((r2 * i2).toFixed(5));
  return n2.push("q"), n2.push("1 0 0 1 " + H(xt.internal.getWidth(t3) / 2) + " " + H(xt.internal.getHeight(t3) / 2) + " cm"), n2.push(r2 + " 0 m"), n2.push(r2 + " " + a2 + " " + a2 + " " + r2 + " 0 " + r2 + " c"), n2.push("-" + a2 + " " + r2 + " -" + r2 + " " + a2 + " -" + r2 + " 0 c"), n2.push("-" + r2 + " -" + a2 + " -" + a2 + " -" + r2 + " 0 -" + r2 + " c"), n2.push(a2 + " -" + r2 + " " + r2 + " -" + a2 + " " + r2 + " 0 c"), n2.push("f"), n2.push("Q"), e2.stream = n2.join("\n"), e2;
}, YesPushDown: function(t3) {
  var e2 = G(t3);
  e2.scope = t3.scope;
  var n2 = [], r2 = xt.internal.getWidth(t3) <= xt.internal.getHeight(t3) ? xt.internal.getWidth(t3) / 4 : xt.internal.getHeight(t3) / 4;
  r2 = Number((0.9 * r2).toFixed(5));
  var i2 = Number((2 * r2).toFixed(5)), a2 = Number((i2 * xt.internal.Bezier_C).toFixed(5)), o2 = Number((r2 * xt.internal.Bezier_C).toFixed(5));
  return n2.push("0.749023 g"), n2.push("q"), n2.push("1 0 0 1 " + H(xt.internal.getWidth(t3) / 2) + " " + H(xt.internal.getHeight(t3) / 2) + " cm"), n2.push(i2 + " 0 m"), n2.push(i2 + " " + a2 + " " + a2 + " " + i2 + " 0 " + i2 + " c"), n2.push("-" + a2 + " " + i2 + " -" + i2 + " " + a2 + " -" + i2 + " 0 c"), n2.push("-" + i2 + " -" + a2 + " -" + a2 + " -" + i2 + " 0 -" + i2 + " c"), n2.push(a2 + " -" + i2 + " " + i2 + " -" + a2 + " " + i2 + " 0 c"), n2.push("f"), n2.push("Q"), n2.push("0 g"), n2.push("q"), n2.push("1 0 0 1 " + H(xt.internal.getWidth(t3) / 2) + " " + H(xt.internal.getHeight(t3) / 2) + " cm"), n2.push(r2 + " 0 m"), n2.push(r2 + " " + o2 + " " + o2 + " " + r2 + " 0 " + r2 + " c"), n2.push("-" + o2 + " " + r2 + " -" + r2 + " " + o2 + " -" + r2 + " 0 c"), n2.push("-" + r2 + " -" + o2 + " -" + o2 + " -" + r2 + " 0 -" + r2 + " c"), n2.push(o2 + " -" + r2 + " " + r2 + " -" + o2 + " " + r2 + " 0 c"), n2.push("f"), n2.push("Q"), e2.stream = n2.join("\n"), e2;
}, OffPushDown: function(t3) {
  var e2 = G(t3);
  e2.scope = t3.scope;
  var n2 = [], r2 = xt.internal.getWidth(t3) <= xt.internal.getHeight(t3) ? xt.internal.getWidth(t3) / 4 : xt.internal.getHeight(t3) / 4;
  r2 = Number((0.9 * r2).toFixed(5));
  var i2 = Number((2 * r2).toFixed(5)), a2 = Number((i2 * xt.internal.Bezier_C).toFixed(5));
  return n2.push("0.749023 g"), n2.push("q"), n2.push("1 0 0 1 " + H(xt.internal.getWidth(t3) / 2) + " " + H(xt.internal.getHeight(t3) / 2) + " cm"), n2.push(i2 + " 0 m"), n2.push(i2 + " " + a2 + " " + a2 + " " + i2 + " 0 " + i2 + " c"), n2.push("-" + a2 + " " + i2 + " -" + i2 + " " + a2 + " -" + i2 + " 0 c"), n2.push("-" + i2 + " -" + a2 + " -" + a2 + " -" + i2 + " 0 -" + i2 + " c"), n2.push(a2 + " -" + i2 + " " + i2 + " -" + a2 + " " + i2 + " 0 c"), n2.push("f"), n2.push("Q"), e2.stream = n2.join("\n"), e2;
} }, Cross: { createAppearanceStream: function(t3) {
  var e2 = { D: { Off: xt.RadioButton.Cross.OffPushDown }, N: {} };
  return e2.N[t3] = xt.RadioButton.Cross.YesNormal, e2.D[t3] = xt.RadioButton.Cross.YesPushDown, e2;
}, getCA: function() {
  return "8";
}, YesNormal: function(t3) {
  var e2 = G(t3);
  e2.scope = t3.scope;
  var n2 = [], r2 = xt.internal.calculateCross(t3);
  return n2.push("q"), n2.push("1 1 " + U(xt.internal.getWidth(t3) - 2) + " " + U(xt.internal.getHeight(t3) - 2) + " re"), n2.push("W"), n2.push("n"), n2.push(U(r2.x1.x) + " " + U(r2.x1.y) + " m"), n2.push(U(r2.x2.x) + " " + U(r2.x2.y) + " l"), n2.push(U(r2.x4.x) + " " + U(r2.x4.y) + " m"), n2.push(U(r2.x3.x) + " " + U(r2.x3.y) + " l"), n2.push("s"), n2.push("Q"), e2.stream = n2.join("\n"), e2;
}, YesPushDown: function(t3) {
  var e2 = G(t3);
  e2.scope = t3.scope;
  var n2 = xt.internal.calculateCross(t3), r2 = [];
  return r2.push("0.749023 g"), r2.push("0 0 " + U(xt.internal.getWidth(t3)) + " " + U(xt.internal.getHeight(t3)) + " re"), r2.push("f"), r2.push("q"), r2.push("1 1 " + U(xt.internal.getWidth(t3) - 2) + " " + U(xt.internal.getHeight(t3) - 2) + " re"), r2.push("W"), r2.push("n"), r2.push(U(n2.x1.x) + " " + U(n2.x1.y) + " m"), r2.push(U(n2.x2.x) + " " + U(n2.x2.y) + " l"), r2.push(U(n2.x4.x) + " " + U(n2.x4.y) + " m"), r2.push(U(n2.x3.x) + " " + U(n2.x3.y) + " l"), r2.push("s"), r2.push("Q"), e2.stream = r2.join("\n"), e2;
}, OffPushDown: function(t3) {
  var e2 = G(t3);
  e2.scope = t3.scope;
  var n2 = [];
  return n2.push("0.749023 g"), n2.push("0 0 " + U(xt.internal.getWidth(t3)) + " " + U(xt.internal.getHeight(t3)) + " re"), n2.push("f"), e2.stream = n2.join("\n"), e2;
} } }, createDefaultAppearanceStream: function(t3) {
  var e2 = t3.scope.internal.getFont(t3.fontName, t3.fontStyle).id, n2 = t3.scope.__private__.encodeColorString(t3.color);
  return "/" + e2 + " " + t3.fontSize + " Tf " + n2;
} };
xt.internal = { Bezier_C: 0.551915024494, calculateCross: function(t3) {
  var e2 = xt.internal.getWidth(t3), n2 = xt.internal.getHeight(t3), r2 = Math.min(e2, n2);
  return { x1: { x: (e2 - r2) / 2, y: (n2 - r2) / 2 + r2 }, x2: { x: (e2 - r2) / 2 + r2, y: (n2 - r2) / 2 }, x3: { x: (e2 - r2) / 2, y: (n2 - r2) / 2 }, x4: { x: (e2 - r2) / 2 + r2, y: (n2 - r2) / 2 + r2 } };
} }, xt.internal.getWidth = function(e2) {
  var n2 = 0;
  return "object" === _typeof(e2) && (n2 = V(e2.Rect[2])), n2;
}, xt.internal.getHeight = function(e2) {
  var n2 = 0;
  return "object" === _typeof(e2) && (n2 = V(e2.Rect[3])), n2;
};
var At = R.addField = function(t3) {
  if (at(this, t3), !(t3 instanceof ht)) throw new Error("Invalid argument passed to jsPDF.addField.");
  var e2;
  return (e2 = t3).scope.internal.acroformPlugin.printedOut && (e2.scope.internal.acroformPlugin.printedOut = false, e2.scope.internal.acroformPlugin.acroFormDictionaryRoot = null), e2.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e2), t3.page = t3.scope.internal.getCurrentPageInfo().pageNumber, this;
};
R.AcroFormChoiceField = ft, R.AcroFormListBox = dt, R.AcroFormComboBox = pt, R.AcroFormEditBox = gt, R.AcroFormButton = mt, R.AcroFormPushButton = vt, R.AcroFormRadioButton = bt, R.AcroFormCheckBox = wt, R.AcroFormTextField = Nt, R.AcroFormPasswordField = Lt, R.AcroFormAppearance = xt, R.AcroForm = { ChoiceField: ft, ListBox: dt, ComboBox: pt, EditBox: gt, Button: mt, PushButton: vt, RadioButton: bt, CheckBox: wt, TextField: Nt, PasswordField: Lt, Appearance: xt }, E.AcroForm = { ChoiceField: ft, ListBox: dt, ComboBox: pt, EditBox: gt, Button: mt, PushButton: vt, RadioButton: bt, CheckBox: wt, TextField: Nt, PasswordField: Lt, Appearance: xt };
E.AcroForm;
function _t(t3) {
  return t3.reduce(function(t4, e2, n2) {
    return t4[e2] = n2, t4;
  }, {});
}
!function(e2) {
  var n2 = "addImage_";
  e2.__addimage__ = {};
  var r2 = "UNKNOWN", i2 = { PNG: [[137, 80, 78, 71]], TIFF: [[77, 77, 0, 42], [73, 73, 42, 0]], JPEG: [[255, 216, 255, 224, void 0, void 0, 74, 70, 73, 70, 0], [255, 216, 255, 225, void 0, void 0, 69, 120, 105, 102, 0, 0], [255, 216, 255, 219], [255, 216, 255, 238]], JPEG2000: [[0, 0, 0, 12, 106, 80, 32, 32]], GIF87a: [[71, 73, 70, 56, 55, 97]], GIF89a: [[71, 73, 70, 56, 57, 97]], WEBP: [[82, 73, 70, 70, void 0, void 0, void 0, void 0, 87, 69, 66, 80]], BMP: [[66, 77], [66, 65], [67, 73], [67, 80], [73, 67], [80, 84]] }, a2 = e2.__addimage__.getImageFileTypeByImageData = function(t3, e3) {
    var n3, a3, o3, s3, u3, c3 = r2;
    if ("RGBA" === (e3 = e3 || r2) || void 0 !== t3.data && t3.data instanceof Uint8ClampedArray && "height" in t3 && "width" in t3) return "RGBA";
    if (A2(t3)) for (u3 in i2) for (o3 = i2[u3], n3 = 0; n3 < o3.length; n3 += 1) {
      for (s3 = true, a3 = 0; a3 < o3[n3].length; a3 += 1) if (void 0 !== o3[n3][a3] && o3[n3][a3] !== t3[a3]) {
        s3 = false;
        break;
      }
      if (true === s3) {
        c3 = u3;
        break;
      }
    }
    else for (u3 in i2) for (o3 = i2[u3], n3 = 0; n3 < o3.length; n3 += 1) {
      for (s3 = true, a3 = 0; a3 < o3[n3].length; a3 += 1) if (void 0 !== o3[n3][a3] && o3[n3][a3] !== t3.charCodeAt(a3)) {
        s3 = false;
        break;
      }
      if (true === s3) {
        c3 = u3;
        break;
      }
    }
    return c3 === r2 && e3 !== r2 && (c3 = e3), c3;
  }, o2 = function t3(e3) {
    for (var n3 = this.internal.write, r3 = this.internal.putStream, i3 = (0, this.internal.getFilters)(); -1 !== i3.indexOf("FlateEncode"); ) i3.splice(i3.indexOf("FlateEncode"), 1);
    e3.objectId = this.internal.newObject();
    var a3 = [];
    if (a3.push({ key: "Type", value: "/XObject" }), a3.push({ key: "Subtype", value: "/Image" }), a3.push({ key: "Width", value: e3.width }), a3.push({ key: "Height", value: e3.height }), e3.colorSpace === y2.INDEXED ? a3.push({ key: "ColorSpace", value: "[/Indexed /DeviceRGB " + (e3.palette.length / 3 - 1) + " " + ("sMask" in e3 && void 0 !== e3.sMask ? e3.objectId + 2 : e3.objectId + 1) + " 0 R]" }) : (a3.push({ key: "ColorSpace", value: "/" + e3.colorSpace }), e3.colorSpace === y2.DEVICE_CMYK && a3.push({ key: "Decode", value: "[1 0 1 0 1 0 1 0]" })), a3.push({ key: "BitsPerComponent", value: e3.bitsPerComponent }), "decodeParameters" in e3 && void 0 !== e3.decodeParameters && a3.push({ key: "DecodeParms", value: "<<" + e3.decodeParameters + ">>" }), "transparency" in e3 && Array.isArray(e3.transparency) && e3.transparency.length > 0) {
      for (var o3 = "", s3 = 0, u3 = e3.transparency.length; s3 < u3; s3++) o3 += e3.transparency[s3] + " " + e3.transparency[s3] + " ";
      a3.push({ key: "Mask", value: "[" + o3 + "]" });
    }
    void 0 !== e3.sMask && a3.push({ key: "SMask", value: e3.objectId + 1 + " 0 R" });
    var c3 = void 0 !== e3.filter ? ["/" + e3.filter] : void 0;
    if (r3({ data: e3.data, additionalKeyValues: a3, alreadyAppliedFilters: c3, objectId: e3.objectId }), n3("endobj"), "sMask" in e3 && void 0 !== e3.sMask) {
      var l3, h3 = null !== (l3 = e3.sMaskBitsPerComponent) && void 0 !== l3 ? l3 : e3.bitsPerComponent, f2 = { width: e3.width, height: e3.height, colorSpace: "DeviceGray", bitsPerComponent: h3, data: e3.sMask };
      "filter" in e3 && (f2.decodeParameters = "/Predictor ".concat(e3.predictor, " /Colors 1 /BitsPerComponent ").concat(h3, " /Columns ").concat(e3.width), f2.filter = e3.filter), t3.call(this, f2);
    }
    if (e3.colorSpace === y2.INDEXED) {
      var d3 = this.internal.newObject();
      r3({ data: _2(new Uint8Array(e3.palette)), objectId: d3 }), n3("endobj");
    }
  }, s2 = function() {
    var t3 = this.internal.collections[n2 + "images"];
    for (var e3 in t3) o2.call(this, t3[e3]);
  }, u2 = function() {
    var t3, e3 = this.internal.collections[n2 + "images"], r3 = this.internal.write;
    for (var i3 in e3) r3("/I" + (t3 = e3[i3]).index, t3.objectId, "0", "R");
  }, c2 = function() {
    this.internal.collections[n2 + "images"] || (this.internal.collections[n2 + "images"] = {}, this.internal.events.subscribe("putResources", s2), this.internal.events.subscribe("putXobjectDict", u2));
  }, l2 = function() {
    var t3 = this.internal.collections[n2 + "images"];
    return c2.call(this), t3;
  }, h2 = function() {
    return Object.keys(this.internal.collections[n2 + "images"]).length;
  }, d2 = function(t3) {
    return "function" == typeof e2["process" + t3.toUpperCase()];
  }, p2 = function(e3) {
    return "object" === _typeof(e3) && 1 === e3.nodeType;
  }, g2 = function(t3, n3) {
    if ("IMG" === t3.nodeName && t3.hasAttribute("src")) {
      var r3 = "" + t3.getAttribute("src");
      if (0 === r3.indexOf("data:image/")) return f(unescape(r3).split("base64,").pop());
      var i3 = e2.loadFile(r3, true);
      if (void 0 !== i3) return i3;
    }
    if ("CANVAS" === t3.nodeName) {
      if (0 === t3.width || 0 === t3.height) throw new Error("Given canvas must have data. Canvas width: " + t3.width + ", height: " + t3.height);
      var a3;
      switch (n3) {
        case "PNG":
          a3 = "image/png";
          break;
        case "WEBP":
          a3 = "image/webp";
          break;
        default:
          a3 = "image/jpeg";
      }
      return f(t3.toDataURL(a3, 1).split("base64,").pop());
    }
  }, m2 = function(t3) {
    var e3 = this.internal.collections[n2 + "images"];
    if (e3) {
      for (var r3 in e3) if (t3 === e3[r3].alias) return e3[r3];
    }
  }, v2 = function(t3, e3, n3) {
    return t3 || e3 || (t3 = -96, e3 = -96), t3 < 0 && (t3 = -1 * n3.width * 72 / t3 / this.internal.scaleFactor), e3 < 0 && (e3 = -1 * n3.height * 72 / e3 / this.internal.scaleFactor), 0 === t3 && (t3 = e3 * n3.width / n3.height), 0 === e3 && (e3 = t3 * n3.height / n3.width), [t3, e3];
  }, b2 = function(t3, e3, n3, r3, i3, a3) {
    var o3 = v2.call(this, n3, r3, i3), s3 = this.internal.getCoordinateString, u3 = this.internal.getVerticalCoordinateString, c3 = l2.call(this);
    if (n3 = o3[0], r3 = o3[1], c3[i3.index] = i3, a3) {
      a3 *= Math.PI / 180;
      var h3 = Math.cos(a3), f2 = Math.sin(a3), d3 = function(t4) {
        return t4.toFixed(4);
      }, p3 = [d3(h3), d3(f2), d3(-1 * f2), d3(h3), 0, 0, "cm"];
    }
    this.internal.write("q"), a3 ? (this.internal.write([1, "0", "0", 1, s3(t3), u3(e3 + r3), "cm"].join(" ")), this.internal.write(p3.join(" ")), this.internal.write([s3(n3), "0", "0", s3(r3), "0", "0", "cm"].join(" "))) : this.internal.write([s3(n3), "0", "0", s3(r3), s3(t3), u3(e3 + r3), "cm"].join(" ")), this.isAdvancedAPI() && this.internal.write([1, 0, 0, -1, 0, 0, "cm"].join(" ")), this.internal.write("/I" + i3.index + " Do"), this.internal.write("Q");
  }, y2 = e2.color_spaces = { DEVICE_RGB: "DeviceRGB", DEVICE_GRAY: "DeviceGray", DEVICE_CMYK: "DeviceCMYK", CAL_GREY: "CalGray", CAL_RGB: "CalRGB", LAB: "Lab", ICC_BASED: "ICCBased", INDEXED: "Indexed", PATTERN: "Pattern", SEPARATION: "Separation", DEVICE_N: "DeviceN" };
  e2.decode = { DCT_DECODE: "DCTDecode", FLATE_DECODE: "FlateDecode", LZW_DECODE: "LZWDecode", JPX_DECODE: "JPXDecode", JBIG2_DECODE: "JBIG2Decode", ASCII85_DECODE: "ASCII85Decode", ASCII_HEX_DECODE: "ASCIIHexDecode", RUN_LENGTH_DECODE: "RunLengthDecode", CCITT_FAX_DECODE: "CCITTFaxDecode" };
  var w2 = e2.image_compression = { NONE: "NONE", FAST: "FAST", MEDIUM: "MEDIUM", SLOW: "SLOW" }, N2 = e2.__addimage__.sHashCode = function(t3) {
    var e3, n3, r3 = 0;
    if ("string" == typeof t3) for (n3 = t3.length, e3 = 0; e3 < n3; e3++) r3 = (r3 << 5) - r3 + t3.charCodeAt(e3), r3 |= 0;
    else if (A2(t3)) for (n3 = t3.byteLength / 2, e3 = 0; e3 < n3; e3++) r3 = (r3 << 5) - r3 + t3[e3], r3 |= 0;
    return r3;
  }, L2 = e2.__addimage__.validateStringAsBase64 = function(t3) {
    (t3 = t3 || "").toString().trim();
    var e3 = true;
    return 0 === t3.length && (e3 = false), t3.length % 4 != 0 && (e3 = false), false === /^[A-Za-z0-9+/]+$/.test(t3.substr(0, t3.length - 2)) && (e3 = false), false === /^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(t3.substr(-2)) && (e3 = false), e3;
  }, x2 = e2.__addimage__.extractImageFromDataUrl = function(t3) {
    if (null == t3) return null;
    if (!(t3 = t3.trim()).startsWith("data:")) return null;
    var e3 = t3.indexOf(",");
    return e3 < 0 ? null : t3.substring(0, e3).trim().endsWith("base64") ? t3.substring(e3 + 1) : null;
  };
  e2.__addimage__.isArrayBuffer = function(t3) {
    return t3 instanceof ArrayBuffer;
  };
  var A2 = e2.__addimage__.isArrayBufferView = function(t3) {
    return t3 instanceof Int8Array || t3 instanceof Uint8Array || t3 instanceof Uint8ClampedArray || t3 instanceof Int16Array || t3 instanceof Uint16Array || t3 instanceof Int32Array || t3 instanceof Uint32Array || t3 instanceof Float32Array || t3 instanceof Float64Array;
  }, S2 = e2.__addimage__.binaryStringToUint8Array = function(t3) {
    for (var e3 = t3.length, n3 = new Uint8Array(e3), r3 = 0; r3 < e3; r3++) n3[r3] = t3.charCodeAt(r3);
    return n3;
  }, _2 = e2.__addimage__.arrayBufferToBinaryString = function(t3) {
    for (var e3 = "", n3 = A2(t3) ? t3 : new Uint8Array(t3), r3 = 0; r3 < n3.length; r3 += 8192) e3 += String.fromCharCode.apply(null, n3.subarray(r3, r3 + 8192));
    return e3;
  };
  e2.addImage = function() {
    var e3, n3, i3, a3, o3, s3, u3, l3, h3;
    if ("number" == typeof arguments[1] ? (n3 = r2, i3 = arguments[1], a3 = arguments[2], o3 = arguments[3], s3 = arguments[4], u3 = arguments[5], l3 = arguments[6], h3 = arguments[7]) : (n3 = arguments[1], i3 = arguments[2], a3 = arguments[3], o3 = arguments[4], s3 = arguments[5], u3 = arguments[6], l3 = arguments[7], h3 = arguments[8]), "object" === _typeof(e3 = arguments[0]) && !p2(e3) && "imageData" in e3) {
      var f2 = e3;
      e3 = f2.imageData, n3 = f2.format || n3 || r2, i3 = f2.x || i3 || 0, a3 = f2.y || a3 || 0, o3 = f2.w || f2.width || o3, s3 = f2.h || f2.height || s3, u3 = f2.alias || u3, l3 = f2.compression || l3, h3 = f2.rotation || f2.angle || h3;
    }
    var d3 = this.internal.getFilters();
    if (void 0 === l3 && -1 !== d3.indexOf("FlateEncode") && (l3 = "SLOW"), isNaN(i3) || isNaN(a3)) throw new Error("Invalid coordinates passed to jsPDF.addImage");
    c2.call(this);
    var g3 = P2.call(this, e3, n3, u3, l3);
    return b2.call(this, i3, a3, o3, s3, g3, h3), this;
  };
  var P2 = function(t3, n3, i3, o3) {
    var s3, u3, c3;
    if ("string" == typeof t3 && a2(t3) === r2) {
      t3 = unescape(t3);
      var l3 = k2(t3, false);
      ("" !== l3 || void 0 !== (l3 = e2.loadFile(t3, true))) && (t3 = l3);
    }
    if (p2(t3) && (t3 = g2(t3, n3)), n3 = a2(t3, n3), !d2(n3)) throw new Error("addImage does not support files of type '" + n3 + "', please ensure that a plugin for '" + n3 + "' support is added.");
    if ((null == (c3 = i3) || 0 === c3.length) && (i3 = function(t4) {
      return "string" == typeof t4 || A2(t4) ? N2(t4) : A2(t4.data) ? N2(t4.data) : null;
    }(t3)), (s3 = m2.call(this, i3)) || (t3 instanceof Uint8Array || "RGBA" === n3 || (u3 = t3, t3 = S2(t3)), s3 = this["process" + n3.toUpperCase()](t3, h2.call(this), i3, function(t4) {
      return t4 && "string" == typeof t4 && (t4 = t4.toUpperCase()), t4 in e2.image_compression ? t4 : w2.NONE;
    }(o3), u3)), !s3) throw new Error("An unknown error occurred whilst processing the image.");
    return s3;
  }, k2 = e2.__addimage__.convertBase64ToBinaryString = function(t3, e3) {
    e3 = "boolean" != typeof e3 || e3;
    var n3, r3 = "";
    if ("string" == typeof t3) {
      var i3;
      n3 = null !== (i3 = x2(t3)) && void 0 !== i3 ? i3 : t3;
      try {
        r3 = f(n3);
      } catch (a3) {
        if (e3) throw L2(n3) ? new Error("atob-Error in jsPDF.convertBase64ToBinaryString " + a3.message) : new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ");
      }
    }
    return r3;
  };
  e2.getImageProperties = function(t3) {
    var n3, i3, o3 = "";
    if (p2(t3) && (t3 = g2(t3)), "string" == typeof t3 && a2(t3) === r2 && ("" === (o3 = k2(t3, false)) && (o3 = e2.loadFile(t3) || ""), t3 = o3), i3 = a2(t3), !d2(i3)) throw new Error("addImage does not support files of type '" + i3 + "', please ensure that a plugin for '" + i3 + "' support is added.");
    if (t3 instanceof Uint8Array || (t3 = S2(t3)), !(n3 = this["process" + i3.toUpperCase()](t3))) throw new Error("An unknown error occurred whilst processing the image");
    return n3.fileType = i3, n3;
  };
}(E.API), /**
 * @license
 * Copyright (c) 2014 Steven Spungin (TwelveTone LLC)  steven@twelvetone.tv
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  var e2 = function(t4) {
    if (void 0 !== t4 && "" != t4) return true;
  };
  E.API.events.push(["addPage", function(t4) {
    this.internal.getPageInfo(t4.pageNumber).pageContext.annotations = [];
  }]), t3.events.push(["putPage", function(t4) {
    for (var n2, r2, i2, a2 = this.internal.getCoordinateString, o2 = this.internal.getVerticalCoordinateString, s2 = this.internal.getPageInfoByObjId(t4.objId), u2 = t4.pageContext.annotations, c2 = false, l2 = 0; l2 < u2.length && !c2; l2++) switch ((n2 = u2[l2]).type) {
      case "link":
        (e2(n2.options.url) || e2(n2.options.pageNumber)) && (c2 = true);
        break;
      case "reference":
      case "text":
      case "freetext":
        c2 = true;
    }
    if (0 != c2) {
      this.internal.write("/Annots [");
      for (var h2 = 0; h2 < u2.length; h2++) {
        n2 = u2[h2];
        var f2 = this.internal.pdfEscape, d2 = this.internal.getEncryptor(t4.objId);
        switch (n2.type) {
          case "reference":
            this.internal.write(" " + n2.object.objId + " 0 R ");
            break;
          case "text":
            var p2 = this.internal.newAdditionalObject(), g2 = this.internal.newAdditionalObject(), m2 = this.internal.getEncryptor(p2.objId), v2 = n2.title || "Note";
            i2 = "<</Type /Annot /Subtype /Text " + (r2 = "/Rect [" + a2(n2.bounds.x) + " " + o2(n2.bounds.y + n2.bounds.h) + " " + a2(n2.bounds.x + n2.bounds.w) + " " + o2(n2.bounds.y) + "] ") + "/Contents (" + f2(m2(n2.contents)) + ")", i2 += " /Popup " + g2.objId + " 0 R", i2 += " /P " + s2.objId + " 0 R", i2 += " /T (" + f2(m2(v2)) + ") >>", p2.content = i2;
            var b2 = p2.objId + " 0 R";
            i2 = "<</Type /Annot /Subtype /Popup " + (r2 = "/Rect [" + a2(n2.bounds.x + 30) + " " + o2(n2.bounds.y + n2.bounds.h) + " " + a2(n2.bounds.x + n2.bounds.w + 30) + " " + o2(n2.bounds.y) + "] ") + " /Parent " + b2, n2.open && (i2 += " /Open true"), i2 += " >>", g2.content = i2, this.internal.write(p2.objId, "0 R", g2.objId, "0 R");
            break;
          case "freetext":
            r2 = "/Rect [" + a2(n2.bounds.x) + " " + o2(n2.bounds.y) + " " + a2(n2.bounds.x + n2.bounds.w) + " " + o2(n2.bounds.y + n2.bounds.h) + "] ";
            var y2 = n2.color || "#000000";
            i2 = "<</Type /Annot /Subtype /FreeText " + r2 + "/Contents (" + f2(d2(n2.contents)) + ")", i2 += " /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#" + y2 + ")", i2 += " /Border [0 0 0]", i2 += " >>", this.internal.write(i2);
            break;
          case "link":
            if (n2.options.name) {
              var w2 = this.annotations._nameMap[n2.options.name];
              n2.options.pageNumber = w2.page, n2.options.top = w2.y;
            } else n2.options.top || (n2.options.top = 0);
            if (r2 = "/Rect [" + n2.finalBounds.x + " " + n2.finalBounds.y + " " + n2.finalBounds.w + " " + n2.finalBounds.h + "] ", i2 = "", n2.options.url) i2 = "<</Type /Annot /Subtype /Link " + r2 + "/Border [0 0 0] /A <</S /URI /URI (" + f2(d2(n2.options.url)) + ") >>";
            else if (n2.options.pageNumber) switch (i2 = "<</Type /Annot /Subtype /Link " + r2 + "/Border [0 0 0] /Dest [" + this.internal.getPageInfo(n2.options.pageNumber).objId + " 0 R", n2.options.magFactor = n2.options.magFactor || "XYZ", n2.options.magFactor) {
              case "Fit":
                i2 += " /Fit]";
                break;
              case "FitH":
                i2 += " /FitH " + n2.options.top + "]";
                break;
              case "FitV":
                n2.options.left = n2.options.left || 0, i2 += " /FitV " + n2.options.left + "]";
                break;
              default:
                var N2 = o2(n2.options.top);
                n2.options.left = n2.options.left || 0, void 0 === n2.options.zoom && (n2.options.zoom = 0), i2 += " /XYZ " + n2.options.left + " " + N2 + " " + n2.options.zoom + "]";
            }
            "" != i2 && (i2 += " >>", this.internal.write(i2));
        }
      }
      this.internal.write("]");
    }
  }]), t3.createAnnotation = function(t4) {
    var e3 = this.internal.getCurrentPageInfo();
    switch (t4.type) {
      case "link":
        this.link(t4.bounds.x, t4.bounds.y, t4.bounds.w, t4.bounds.h, t4);
        break;
      case "text":
      case "freetext":
        e3.pageContext.annotations.push(t4);
    }
  }, t3.link = function(t4, e3, n2, r2, i2) {
    var a2 = this.internal.getCurrentPageInfo(), o2 = this.internal.getCoordinateString, s2 = this.internal.getVerticalCoordinateString;
    a2.pageContext.annotations.push({ finalBounds: { x: o2(t4), y: s2(e3), w: o2(t4 + n2), h: s2(e3 + r2) }, options: i2, type: "link" });
  }, t3.textWithLink = function(t4, e3, n2, r2) {
    var i2, a2, o2 = this.getTextWidth(t4), s2 = this.internal.getLineHeight() / this.internal.scaleFactor;
    if (void 0 !== r2.maxWidth) {
      a2 = r2.maxWidth;
      var u2 = this.splitTextToSize(t4, a2).length;
      i2 = Math.ceil(s2 * u2);
    } else a2 = o2, i2 = s2;
    return this.text(t4, e3, n2, r2), n2 += 0.2 * s2, "center" === r2.align && (e3 -= o2 / 2), "right" === r2.align && (e3 -= o2), this.link(e3, n2 - s2, a2, i2, r2), o2;
  }, t3.getTextWidth = function(t4) {
    var e3 = this.internal.getFontSize();
    return this.getStringUnitWidth(t4) * e3 / this.internal.scaleFactor;
  };
}(E.API), /**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  var e2 = { 1569: [65152], 1570: [65153, 65154], 1571: [65155, 65156], 1572: [65157, 65158], 1573: [65159, 65160], 1574: [65161, 65162, 65163, 65164], 1575: [65165, 65166], 1576: [65167, 65168, 65169, 65170], 1577: [65171, 65172], 1578: [65173, 65174, 65175, 65176], 1579: [65177, 65178, 65179, 65180], 1580: [65181, 65182, 65183, 65184], 1581: [65185, 65186, 65187, 65188], 1582: [65189, 65190, 65191, 65192], 1583: [65193, 65194], 1584: [65195, 65196], 1585: [65197, 65198], 1586: [65199, 65200], 1587: [65201, 65202, 65203, 65204], 1588: [65205, 65206, 65207, 65208], 1589: [65209, 65210, 65211, 65212], 1590: [65213, 65214, 65215, 65216], 1591: [65217, 65218, 65219, 65220], 1592: [65221, 65222, 65223, 65224], 1593: [65225, 65226, 65227, 65228], 1594: [65229, 65230, 65231, 65232], 1601: [65233, 65234, 65235, 65236], 1602: [65237, 65238, 65239, 65240], 1603: [65241, 65242, 65243, 65244], 1604: [65245, 65246, 65247, 65248], 1605: [65249, 65250, 65251, 65252], 1606: [65253, 65254, 65255, 65256], 1607: [65257, 65258, 65259, 65260], 1608: [65261, 65262], 1609: [65263, 65264, 64488, 64489], 1610: [65265, 65266, 65267, 65268], 1649: [64336, 64337], 1655: [64477], 1657: [64358, 64359, 64360, 64361], 1658: [64350, 64351, 64352, 64353], 1659: [64338, 64339, 64340, 64341], 1662: [64342, 64343, 64344, 64345], 1663: [64354, 64355, 64356, 64357], 1664: [64346, 64347, 64348, 64349], 1667: [64374, 64375, 64376, 64377], 1668: [64370, 64371, 64372, 64373], 1670: [64378, 64379, 64380, 64381], 1671: [64382, 64383, 64384, 64385], 1672: [64392, 64393], 1676: [64388, 64389], 1677: [64386, 64387], 1678: [64390, 64391], 1681: [64396, 64397], 1688: [64394, 64395], 1700: [64362, 64363, 64364, 64365], 1702: [64366, 64367, 64368, 64369], 1705: [64398, 64399, 64400, 64401], 1709: [64467, 64468, 64469, 64470], 1711: [64402, 64403, 64404, 64405], 1713: [64410, 64411, 64412, 64413], 1715: [64406, 64407, 64408, 64409], 1722: [64414, 64415], 1723: [64416, 64417, 64418, 64419], 1726: [64426, 64427, 64428, 64429], 1728: [64420, 64421], 1729: [64422, 64423, 64424, 64425], 1733: [64480, 64481], 1734: [64473, 64474], 1735: [64471, 64472], 1736: [64475, 64476], 1737: [64482, 64483], 1739: [64478, 64479], 1740: [64508, 64509, 64510, 64511], 1744: [64484, 64485, 64486, 64487], 1746: [64430, 64431], 1747: [64432, 64433] }, n2 = { 65247: { 65154: 65269, 65156: 65271, 65160: 65273, 65166: 65275 }, 65248: { 65154: 65270, 65156: 65272, 65160: 65274, 65166: 65276 }, 65165: { 65247: { 65248: { 65258: 65010 } } }, 1617: { 1612: 64606, 1613: 64607, 1614: 64608, 1615: 64609, 1616: 64610 } }, r2 = { 1612: 64606, 1613: 64607, 1614: 64608, 1615: 64609, 1616: 64610 }, i2 = [1570, 1571, 1573, 1575];
  t3.__arabicParser__ = {};
  var a2 = t3.__arabicParser__.isInArabicSubstitutionA = function(t4) {
    return void 0 !== e2[t4.charCodeAt(0)];
  }, o2 = t3.__arabicParser__.isArabicLetter = function(t4) {
    return "string" == typeof t4 && /^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(t4);
  }, s2 = t3.__arabicParser__.isArabicEndLetter = function(t4) {
    return o2(t4) && a2(t4) && e2[t4.charCodeAt(0)].length <= 2;
  }, u2 = t3.__arabicParser__.isArabicAlfLetter = function(t4) {
    return o2(t4) && i2.indexOf(t4.charCodeAt(0)) >= 0;
  };
  t3.__arabicParser__.arabicLetterHasIsolatedForm = function(t4) {
    return o2(t4) && a2(t4) && e2[t4.charCodeAt(0)].length >= 1;
  };
  var c2 = t3.__arabicParser__.arabicLetterHasFinalForm = function(t4) {
    return o2(t4) && a2(t4) && e2[t4.charCodeAt(0)].length >= 2;
  };
  t3.__arabicParser__.arabicLetterHasInitialForm = function(t4) {
    return o2(t4) && a2(t4) && e2[t4.charCodeAt(0)].length >= 3;
  };
  var l2 = t3.__arabicParser__.arabicLetterHasMedialForm = function(t4) {
    return o2(t4) && a2(t4) && 4 == e2[t4.charCodeAt(0)].length;
  }, h2 = t3.__arabicParser__.resolveLigatures = function(t4) {
    var e3 = 0, r3 = n2, i3 = "", a3 = 0;
    for (e3 = 0; e3 < t4.length; e3 += 1) void 0 !== r3[t4.charCodeAt(e3)] ? (a3++, "number" == typeof (r3 = r3[t4.charCodeAt(e3)]) && (i3 += String.fromCharCode(r3), r3 = n2, a3 = 0), e3 === t4.length - 1 && (r3 = n2, i3 += t4.charAt(e3 - (a3 - 1)), e3 -= a3 - 1, a3 = 0)) : (r3 = n2, i3 += t4.charAt(e3 - a3), e3 -= a3, a3 = 0);
    return i3;
  };
  t3.__arabicParser__.isArabicDiacritic = function(t4) {
    return void 0 !== t4 && void 0 !== r2[t4.charCodeAt(0)];
  };
  var f2 = t3.__arabicParser__.getCorrectForm = function(t4, e3, n3) {
    return o2(t4) ? false === a2(t4) ? -1 : !c2(t4) || !o2(e3) && !o2(n3) || !o2(n3) && s2(e3) || s2(t4) && !o2(e3) || s2(t4) && u2(e3) || s2(t4) && s2(e3) ? 0 : l2(t4) && o2(e3) && !s2(e3) && o2(n3) && c2(n3) ? 3 : s2(t4) || !o2(n3) ? 1 : 2 : -1;
  }, d2 = function(t4) {
    var n3 = 0, r3 = 0, i3 = 0, a3 = "", s3 = "", u3 = "", c3 = (t4 = t4 || "").split("\\s+"), l3 = [];
    for (n3 = 0; n3 < c3.length; n3 += 1) {
      for (l3.push(""), r3 = 0; r3 < c3[n3].length; r3 += 1) a3 = c3[n3][r3], s3 = c3[n3][r3 - 1], u3 = c3[n3][r3 + 1], o2(a3) ? (i3 = f2(a3, s3, u3), l3[n3] += -1 !== i3 ? String.fromCharCode(e2[a3.charCodeAt(0)][i3]) : a3) : l3[n3] += a3;
      l3[n3] = h2(l3[n3]);
    }
    return l3.join(" ");
  }, p2 = t3.__arabicParser__.processArabic = t3.processArabic = function() {
    var t4, e3 = "string" == typeof arguments[0] ? arguments[0] : arguments[0].text, n3 = [];
    if (Array.isArray(e3)) {
      var r3 = 0;
      for (n3 = [], r3 = 0; r3 < e3.length; r3 += 1) Array.isArray(e3[r3]) ? n3.push([d2(e3[r3][0]), e3[r3][1], e3[r3][2]]) : n3.push([d2(e3[r3])]);
      t4 = n3;
    } else t4 = d2(e3);
    return "string" == typeof arguments[0] ? t4 : (arguments[0].text = t4, arguments[0]);
  };
  t3.events.push(["preProcessText", p2]);
}(E.API), E.API.autoPrint = function(t3) {
  var e2;
  return (t3 = t3 || {}).variant = t3.variant || "non-conform", "javascript" === t3.variant ? this.addJS("print({});") : (this.internal.events.subscribe("postPutResources", function() {
    e2 = this.internal.newObject(), this.internal.out("<<"), this.internal.out("/S /Named"), this.internal.out("/Type /Action"), this.internal.out("/N /Print"), this.internal.out(">>"), this.internal.out("endobj");
  }), this.internal.events.subscribe("putCatalog", function() {
    this.internal.out("/OpenAction " + e2 + " 0 R");
  })), this;
}, /**
 * @license
 * Copyright (c) 2014 Steven Spungin (TwelveTone LLC)  steven@twelvetone.tv
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  var e2 = function() {
    var t4 = void 0;
    Object.defineProperty(this, "pdf", { get: function() {
      return t4;
    }, set: function(e4) {
      t4 = e4;
    } });
    var e3 = 150;
    Object.defineProperty(this, "width", { get: function() {
      return e3;
    }, set: function(t5) {
      e3 = isNaN(t5) || false === Number.isInteger(t5) || t5 < 0 ? 150 : t5, this.getContext("2d").pageWrapXEnabled && (this.getContext("2d").pageWrapX = e3 + 1);
    } });
    var n2 = 300;
    Object.defineProperty(this, "height", { get: function() {
      return n2;
    }, set: function(t5) {
      n2 = isNaN(t5) || false === Number.isInteger(t5) || t5 < 0 ? 300 : t5, this.getContext("2d").pageWrapYEnabled && (this.getContext("2d").pageWrapY = n2 + 1);
    } });
    var r2 = [];
    Object.defineProperty(this, "childNodes", { get: function() {
      return r2;
    }, set: function(t5) {
      r2 = t5;
    } });
    var i2 = {};
    Object.defineProperty(this, "style", { get: function() {
      return i2;
    }, set: function(t5) {
      i2 = t5;
    } }), Object.defineProperty(this, "parentNode", {});
  };
  e2.prototype.getContext = function(t4, e3) {
    var n2;
    if ("2d" !== (t4 = t4 || "2d")) return null;
    for (n2 in e3) this.pdf.context2d.hasOwnProperty(n2) && (this.pdf.context2d[n2] = e3[n2]);
    return this.pdf.context2d._canvas = this, this.pdf.context2d;
  }, e2.prototype.toDataURL = function() {
    throw new Error("toDataURL is not implemented.");
  }, t3.events.push(["initialized", function() {
    this.canvas = new e2(), this.canvas.pdf = this;
  }]);
}(E.API), function(e2) {
  var n2 = { left: 0, top: 0, bottom: 0, right: 0 }, r2 = false, i2 = function() {
    void 0 === this.internal.__cell__ && (this.internal.__cell__ = {}, this.internal.__cell__.padding = 3, this.internal.__cell__.headerFunction = void 0, this.internal.__cell__.margins = Object.assign({}, n2), this.internal.__cell__.margins.width = this.getPageWidth(), a2.call(this));
  }, a2 = function() {
    this.internal.__cell__.lastCell = new o2(), this.internal.__cell__.pages = 1;
  }, o2 = function() {
    var t3 = arguments[0];
    Object.defineProperty(this, "x", { enumerable: true, get: function() {
      return t3;
    }, set: function(e4) {
      t3 = e4;
    } });
    var e3 = arguments[1];
    Object.defineProperty(this, "y", { enumerable: true, get: function() {
      return e3;
    }, set: function(t4) {
      e3 = t4;
    } });
    var n3 = arguments[2];
    Object.defineProperty(this, "width", { enumerable: true, get: function() {
      return n3;
    }, set: function(t4) {
      n3 = t4;
    } });
    var r3 = arguments[3];
    Object.defineProperty(this, "height", { enumerable: true, get: function() {
      return r3;
    }, set: function(t4) {
      r3 = t4;
    } });
    var i3 = arguments[4];
    Object.defineProperty(this, "text", { enumerable: true, get: function() {
      return i3;
    }, set: function(t4) {
      i3 = t4;
    } });
    var a3 = arguments[5];
    Object.defineProperty(this, "lineNumber", { enumerable: true, get: function() {
      return a3;
    }, set: function(t4) {
      a3 = t4;
    } });
    var o3 = arguments[6];
    return Object.defineProperty(this, "align", { enumerable: true, get: function() {
      return o3;
    }, set: function(t4) {
      o3 = t4;
    } }), this;
  };
  o2.prototype.clone = function() {
    return new o2(this.x, this.y, this.width, this.height, this.text, this.lineNumber, this.align);
  }, o2.prototype.toArray = function() {
    return [this.x, this.y, this.width, this.height, this.text, this.lineNumber, this.align];
  }, e2.setHeaderFunction = function(t3) {
    return i2.call(this), this.internal.__cell__.headerFunction = "function" == typeof t3 ? t3 : void 0, this;
  }, e2.getTextDimensions = function(t3, e3) {
    i2.call(this);
    var n3 = (e3 = e3 || {}).fontSize || this.getFontSize(), r3 = e3.font || this.getFont(), a3 = e3.scaleFactor || this.internal.scaleFactor, o3 = 0, s3 = 0, u3 = 0, c2 = this;
    if (!Array.isArray(t3) && "string" != typeof t3) {
      if ("number" != typeof t3) throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");
      t3 = String(t3);
    }
    var l2 = e3.maxWidth;
    l2 > 0 ? "string" == typeof t3 ? t3 = this.splitTextToSize(t3, l2) : "[object Array]" === Object.prototype.toString.call(t3) && (t3 = t3.reduce(function(t4, e4) {
      return t4.concat(c2.splitTextToSize(e4, l2));
    }, [])) : t3 = Array.isArray(t3) ? t3 : [t3];
    for (var h2 = 0; h2 < t3.length; h2++) o3 < (u3 = this.getStringUnitWidth(t3[h2], { font: r3 }) * n3) && (o3 = u3);
    return 0 !== o3 && (s3 = t3.length), { w: o3 /= a3, h: Math.max((s3 * n3 * this.getLineHeightFactor() - n3 * (this.getLineHeightFactor() - 1)) / a3, 0) };
  }, e2.cellAddPage = function() {
    i2.call(this), this.addPage();
    var t3 = this.internal.__cell__.margins || n2;
    return this.internal.__cell__.lastCell = new o2(t3.left, t3.top, void 0, void 0), this.internal.__cell__.pages += 1, this;
  };
  var s2 = e2.cell = function() {
    var t3;
    t3 = arguments[0] instanceof o2 ? arguments[0] : new o2(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6]), i2.call(this);
    var e3 = this.internal.__cell__.lastCell, a3 = this.internal.__cell__.padding, s3 = this.internal.__cell__.margins || n2, u3 = this.internal.__cell__.tableHeaderRow, c2 = this.internal.__cell__.printHeaders;
    return void 0 !== e3.lineNumber && (e3.lineNumber === t3.lineNumber ? (t3.x = (e3.x || 0) + (e3.width || 0), t3.y = e3.y || 0) : e3.y + e3.height + t3.height + s3.bottom > this.getPageHeight() ? (this.cellAddPage(), t3.y = s3.top, c2 && u3 && (this.printHeaderRow(t3.lineNumber, true), t3.y += u3[0].height)) : t3.y = e3.y + e3.height || t3.y), void 0 !== t3.text[0] && (this.rect(t3.x, t3.y, t3.width, t3.height, true === r2 ? "FD" : void 0), "right" === t3.align ? this.text(t3.text, t3.x + t3.width - a3, t3.y + a3, { align: "right", baseline: "top" }) : "center" === t3.align ? this.text(t3.text, t3.x + t3.width / 2, t3.y + a3, { align: "center", baseline: "top", maxWidth: t3.width - a3 - a3 }) : this.text(t3.text, t3.x + a3, t3.y + a3, { align: "left", baseline: "top", maxWidth: t3.width - a3 - a3 })), this.internal.__cell__.lastCell = t3, this;
  };
  e2.table = function(e3, r3, c2, l2, h2) {
    if (i2.call(this), !c2) throw new Error("No data for PDF table.");
    var f2, d2, p2, g2, m2 = [], v2 = [], b2 = [], y2 = {}, w2 = {}, N2 = [], L2 = [], x2 = (h2 = h2 || {}).autoSize || false, A2 = false !== h2.printHeaders, S2 = h2.css && void 0 !== h2.css["font-size"] ? 16 * h2.css["font-size"] : h2.fontSize || 12, _2 = h2.margins || Object.assign({ width: this.getPageWidth() }, n2), P2 = "number" == typeof h2.padding ? h2.padding : 3, k2 = h2.headerBackgroundColor || "#c8c8c8", F2 = h2.headerTextColor || "#000";
    if (a2.call(this), this.internal.__cell__.printHeaders = A2, this.internal.__cell__.margins = _2, this.internal.__cell__.table_font_size = S2, this.internal.__cell__.padding = P2, this.internal.__cell__.headerBackgroundColor = k2, this.internal.__cell__.headerTextColor = F2, this.setFontSize(S2), null == l2) v2 = m2 = Object.keys(c2[0]), b2 = m2.map(function() {
      return "left";
    });
    else if (Array.isArray(l2) && "object" === _typeof(l2[0])) for (m2 = l2.map(function(t3) {
      return t3.name;
    }), v2 = l2.map(function(t3) {
      return t3.prompt || t3.name || "";
    }), b2 = l2.map(function(t3) {
      return t3.align || "left";
    }), f2 = 0; f2 < l2.length; f2 += 1) w2[l2[f2].name] = 0.7499990551181103 * l2[f2].width;
    else Array.isArray(l2) && "string" == typeof l2[0] && (v2 = m2 = l2, b2 = m2.map(function() {
      return "left";
    }));
    if (x2 || Array.isArray(l2) && "string" == typeof l2[0]) for (f2 = 0; f2 < m2.length; f2 += 1) {
      for (y2[g2 = m2[f2]] = c2.map(function(t3) {
        return t3[g2];
      }), this.setFont(void 0, "bold"), N2.push(this.getTextDimensions(v2[f2], { fontSize: this.internal.__cell__.table_font_size, scaleFactor: this.internal.scaleFactor }).w), d2 = y2[g2], this.setFont(void 0, "normal"), p2 = 0; p2 < d2.length; p2 += 1) N2.push(this.getTextDimensions(d2[p2], { fontSize: this.internal.__cell__.table_font_size, scaleFactor: this.internal.scaleFactor }).w);
      w2[g2] = Math.max.apply(null, N2) + P2 + P2, N2 = [];
    }
    if (A2) {
      var I2 = {};
      for (f2 = 0; f2 < m2.length; f2 += 1) I2[m2[f2]] = {}, I2[m2[f2]].text = v2[f2], I2[m2[f2]].align = b2[f2];
      var j2 = u2.call(this, I2, w2);
      L2 = m2.map(function(t3) {
        return new o2(e3, r3, w2[t3], j2, I2[t3].text, void 0, I2[t3].align);
      }), this.setTableHeaderRow(L2), this.printHeaderRow(1, false);
    }
    var C2 = l2.reduce(function(t3, e4) {
      return t3[e4.name] = e4.align, t3;
    }, {});
    for (f2 = 0; f2 < c2.length; f2 += 1) {
      "rowStart" in h2 && h2.rowStart instanceof Function && h2.rowStart({ row: f2, data: c2[f2] }, this);
      var O2 = u2.call(this, c2[f2], w2);
      for (p2 = 0; p2 < m2.length; p2 += 1) {
        var B2 = c2[f2][m2[p2]];
        "cellStart" in h2 && h2.cellStart instanceof Function && h2.cellStart({ row: f2, col: p2, data: B2 }, this), s2.call(this, new o2(e3, r3, w2[m2[p2]], O2, B2, f2 + 2, C2[m2[p2]]));
      }
    }
    return this.internal.__cell__.table_x = e3, this.internal.__cell__.table_y = r3, this;
  };
  var u2 = function(t3, e3) {
    var n3 = this.internal.__cell__.padding, r3 = this.internal.__cell__.table_font_size, i3 = this.internal.scaleFactor;
    return Object.keys(t3).map(function(r4) {
      var i4 = t3[r4];
      return this.splitTextToSize(i4.hasOwnProperty("text") ? i4.text : i4, e3[r4] - n3 - n3);
    }, this).map(function(t4) {
      return this.getLineHeightFactor() * t4.length * r3 / i3 + n3 + n3;
    }, this).reduce(function(t4, e4) {
      return Math.max(t4, e4);
    }, 0);
  };
  e2.setTableHeaderRow = function(t3) {
    i2.call(this), this.internal.__cell__.tableHeaderRow = t3;
  }, e2.printHeaderRow = function(t3, e3) {
    if (i2.call(this), !this.internal.__cell__.tableHeaderRow) throw new Error("Property tableHeaderRow does not exist.");
    var n3;
    if (r2 = true, "function" == typeof this.internal.__cell__.headerFunction) {
      var a3 = this.internal.__cell__.headerFunction(this, this.internal.__cell__.pages);
      this.internal.__cell__.lastCell = new o2(a3[0], a3[1], a3[2], a3[3], void 0, -1);
    }
    this.setFont(void 0, "bold");
    for (var u3 = [], c2 = 0; c2 < this.internal.__cell__.tableHeaderRow.length; c2 += 1) {
      n3 = this.internal.__cell__.tableHeaderRow[c2].clone(), e3 && (n3.y = this.internal.__cell__.margins.top || 0, u3.push(n3)), n3.lineNumber = t3;
      var l2 = this.getTextColor();
      this.setTextColor(this.internal.__cell__.headerTextColor), this.setFillColor(this.internal.__cell__.headerBackgroundColor), s2.call(this, n3), this.setTextColor(l2);
    }
    u3.length > 0 && this.setTableHeaderRow(u3), this.setFont(void 0, "normal"), r2 = false;
  };
}(E.API);
var Pt = { italic: ["italic", "oblique", "normal"], oblique: ["oblique", "italic", "normal"], normal: ["normal", "oblique", "italic"] }, kt = ["ultra-condensed", "extra-condensed", "condensed", "semi-condensed", "normal", "semi-expanded", "expanded", "extra-expanded", "ultra-expanded"], Ft = _t(kt), It = [100, 200, 300, 400, 500, 600, 700, 800, 900], jt = _t(It);
function Ct(t3) {
  var e2 = t3.family.replace(/"|'/g, "").toLowerCase(), n2 = function(t4) {
    return Pt[t4 = t4 || "normal"] ? t4 : "normal";
  }(t3.style), r2 = function(t4) {
    return t4 ? "number" == typeof t4 ? t4 >= 100 && t4 <= 900 && t4 % 100 == 0 ? t4 : 400 : /^\d00$/.test(t4) ? parseInt(t4) : "bold" === t4 ? 700 : 400 : 400;
  }(t3.weight), i2 = function(t4) {
    return "number" == typeof Ft[t4 = t4 || "normal"] ? t4 : "normal";
  }(t3.stretch);
  return { family: e2, style: n2, weight: r2, stretch: i2, src: t3.src || [], ref: t3.ref || { name: e2, style: [i2, n2, r2].join(" ") } };
}
function Ot(t3, e2, n2, r2) {
  var i2;
  for (i2 = n2; i2 >= 0 && i2 < e2.length; i2 += r2) if (t3[e2[i2]]) return t3[e2[i2]];
  for (i2 = n2; i2 >= 0 && i2 < e2.length; i2 -= r2) if (t3[e2[i2]]) return t3[e2[i2]];
}
var Bt = { "sans-serif": "helvetica", fixed: "courier", monospace: "courier", terminal: "courier", cursive: "times", fantasy: "times", serif: "times" }, Mt = { caption: "times", icon: "times", menu: "times", "message-box": "times", "small-caption": "times", "status-bar": "times" };
function qt(t3) {
  return [t3.stretch, t3.style, t3.weight, t3.family].join(" ");
}
function Et(t3) {
  return t3.trimLeft();
}
function Rt(t3, e2) {
  for (var n2 = 0; n2 < t3.length; ) {
    if (t3.charAt(n2) === e2) return [t3.substring(0, n2), t3.substring(n2 + 1)];
    n2 += 1;
  }
  return null;
}
function Dt(t3) {
  var e2 = t3.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);
  return null === e2 ? null : [e2[0], t3.substring(e2[0].length)];
}
var Tt, zt, Ut, Ht, Wt, Vt, Gt, Yt, Jt = ["times"];
function Xt(t3, n2, r2, i2, a2) {
  var o2 = 4, s2 = $t;
  switch (a2) {
    case E.API.image_compression.FAST:
      o2 = 1, s2 = Zt;
      break;
    case E.API.image_compression.MEDIUM:
      o2 = 6, s2 = Qt;
      break;
    case E.API.image_compression.SLOW:
      o2 = 9, s2 = te;
  }
  t3 = function(t4, e2, n3, r3) {
    for (var i3, a3 = t4.length / e2, o3 = new Uint8Array(t4.length + a3), s3 = [Kt, Zt, $t, Qt, te], u3 = 0; u3 < a3; u3 += 1) {
      var c2 = u3 * e2, l2 = t4.subarray(c2, c2 + e2);
      if (r3) o3.set(r3(l2, n3, i3), c2 + u3);
      else {
        for (var h2 = s3.length, f2 = [], d2 = 0; d2 < h2; d2 += 1) f2[d2] = s3[d2](l2, n3, i3);
        var p2 = ne(f2.concat());
        o3.set(f2[p2], c2 + u3);
      }
      i3 = l2;
    }
    return o3;
  }(t3, n2, Math.ceil(r2 * i2 / 8), s2);
  var u2 = zlibSync(t3, { level: o2 });
  return E.API.__addimage__.arrayBufferToBinaryString(u2);
}
function Kt(t3) {
  var e2 = Array.apply([], t3);
  return e2.unshift(0), e2;
}
function Zt(t3, e2) {
  var n2 = t3.length, r2 = [];
  r2[0] = 1;
  for (var i2 = 0; i2 < n2; i2 += 1) {
    var a2 = t3[i2 - e2] || 0;
    r2[i2 + 1] = t3[i2] - a2 + 256 & 255;
  }
  return r2;
}
function $t(t3, e2, n2) {
  var r2 = t3.length, i2 = [];
  i2[0] = 2;
  for (var a2 = 0; a2 < r2; a2 += 1) {
    var o2 = n2 && n2[a2] || 0;
    i2[a2 + 1] = t3[a2] - o2 + 256 & 255;
  }
  return i2;
}
function Qt(t3, e2, n2) {
  var r2 = t3.length, i2 = [];
  i2[0] = 3;
  for (var a2 = 0; a2 < r2; a2 += 1) {
    var o2 = t3[a2 - e2] || 0, s2 = n2 && n2[a2] || 0;
    i2[a2 + 1] = t3[a2] + 256 - (o2 + s2 >>> 1) & 255;
  }
  return i2;
}
function te(t3, e2, n2) {
  var r2 = t3.length, i2 = [];
  i2[0] = 4;
  for (var a2 = 0; a2 < r2; a2 += 1) {
    var o2 = ee(t3[a2 - e2] || 0, n2 && n2[a2] || 0, n2 && n2[a2 - e2] || 0);
    i2[a2 + 1] = t3[a2] - o2 + 256 & 255;
  }
  return i2;
}
function ee(t3, e2, n2) {
  if (t3 === e2 && e2 === n2) return t3;
  var r2 = Math.abs(e2 - n2), i2 = Math.abs(t3 - n2), a2 = Math.abs(t3 + e2 - n2 - n2);
  return r2 <= i2 && r2 <= a2 ? t3 : i2 <= a2 ? e2 : n2;
}
function ne(t3) {
  var e2 = t3.map(function(t4) {
    return t4.reduce(function(t5, e3) {
      return t5 + Math.abs(e3);
    }, 0);
  });
  return e2.indexOf(Math.min.apply(null, e2));
}
function re(t3, e2, n2) {
  var r2 = e2 * n2, i2 = Math.floor(r2 / 8), a2 = 16 - (r2 - 8 * i2 + n2), o2 = (1 << n2) - 1;
  return ae(t3, i2) >> a2 & o2;
}
function ie(t3, e2, n2, r2) {
  var i2 = n2 * r2, a2 = Math.floor(i2 / 8), o2 = 16 - (i2 - 8 * a2 + r2), s2 = (1 << r2) - 1, u2 = (e2 & s2) << o2;
  !function(t4, e3, n3) {
    if (e3 + 1 < t4.byteLength) t4.setUint16(e3, n3, false);
    else {
      var r3 = n3 >> 8 & 255;
      t4.setUint8(e3, r3);
    }
  }(t3, a2, ae(t3, a2) & ~(s2 << o2) & 65535 | u2);
}
function ae(t3, e2) {
  return e2 + 1 < t3.byteLength ? t3.getUint16(e2, false) : t3.getUint8(e2) << 8;
}
function oe(t3) {
  var e2 = 0;
  if (71 !== t3[e2++] || 73 !== t3[e2++] || 70 !== t3[e2++] || 56 !== t3[e2++] || 56 != (t3[e2++] + 1 & 253) || 97 !== t3[e2++]) throw new Error("Invalid GIF 87a/89a header.");
  var n2 = t3[e2++] | t3[e2++] << 8, r2 = t3[e2++] | t3[e2++] << 8, i2 = t3[e2++], a2 = i2 >> 7, o2 = 1 << 1 + (7 & i2);
  t3[e2++], t3[e2++];
  var s2 = null, u2 = null;
  a2 && (s2 = e2, u2 = o2, e2 += 3 * o2);
  var c2 = true, l2 = [], h2 = 0, f2 = null, d2 = 0, p2 = null;
  for (this.width = n2, this.height = r2; c2 && e2 < t3.length; ) switch (t3[e2++]) {
    case 33:
      switch (t3[e2++]) {
        case 255:
          if (11 !== t3[e2] || 78 == t3[e2 + 1] && 69 == t3[e2 + 2] && 84 == t3[e2 + 3] && 83 == t3[e2 + 4] && 67 == t3[e2 + 5] && 65 == t3[e2 + 6] && 80 == t3[e2 + 7] && 69 == t3[e2 + 8] && 50 == t3[e2 + 9] && 46 == t3[e2 + 10] && 48 == t3[e2 + 11] && 3 == t3[e2 + 12] && 1 == t3[e2 + 13] && 0 == t3[e2 + 16]) e2 += 14, p2 = t3[e2++] | t3[e2++] << 8, e2++;
          else for (e2 += 12; ; ) {
            if (!((P2 = t3[e2++]) >= 0)) throw Error("Invalid block size");
            if (0 === P2) break;
            e2 += P2;
          }
          break;
        case 249:
          if (4 !== t3[e2++] || 0 !== t3[e2 + 4]) throw new Error("Invalid graphics extension block.");
          var g2 = t3[e2++];
          h2 = t3[e2++] | t3[e2++] << 8, f2 = t3[e2++], 1 & g2 || (f2 = null), d2 = g2 >> 2 & 7, e2++;
          break;
        case 254:
          for (; ; ) {
            if (!((P2 = t3[e2++]) >= 0)) throw Error("Invalid block size");
            if (0 === P2) break;
            e2 += P2;
          }
          break;
        default:
          throw new Error("Unknown graphic control label: 0x" + t3[e2 - 1].toString(16));
      }
      break;
    case 44:
      var m2 = t3[e2++] | t3[e2++] << 8, v2 = t3[e2++] | t3[e2++] << 8, b2 = t3[e2++] | t3[e2++] << 8, y2 = t3[e2++] | t3[e2++] << 8, w2 = t3[e2++], N2 = w2 >> 6 & 1, L2 = 1 << 1 + (7 & w2), x2 = s2, A2 = u2, S2 = false;
      w2 >> 7 && (S2 = true, x2 = e2, A2 = L2, e2 += 3 * L2);
      var _2 = e2;
      for (e2++; ; ) {
        var P2;
        if (!((P2 = t3[e2++]) >= 0)) throw Error("Invalid block size");
        if (0 === P2) break;
        e2 += P2;
      }
      l2.push({ x: m2, y: v2, width: b2, height: y2, has_local_palette: S2, palette_offset: x2, palette_size: A2, data_offset: _2, data_length: e2 - _2, transparent_index: f2, interlaced: !!N2, delay: h2, disposal: d2 });
      break;
    case 59:
      c2 = false;
      break;
    default:
      throw new Error("Unknown gif block: 0x" + t3[e2 - 1].toString(16));
  }
  this.numFrames = function() {
    return l2.length;
  }, this.loopCount = function() {
    return p2;
  }, this.frameInfo = function(t4) {
    if (t4 < 0 || t4 >= l2.length) throw new Error("Frame index out of range.");
    return l2[t4];
  }, this.decodeAndBlitFrameBGRA = function(e3, r3) {
    var i3 = this.frameInfo(e3), a3 = i3.width * i3.height, o3 = new Uint8Array(a3);
    se(t3, i3.data_offset, o3, a3);
    var s3 = i3.palette_offset, u3 = i3.transparent_index;
    null === u3 && (u3 = 256);
    var c3 = i3.width, l3 = n2 - c3, h3 = c3, f3 = 4 * (i3.y * n2 + i3.x), d3 = 4 * ((i3.y + i3.height) * n2 + i3.x), p3 = f3, g3 = 4 * l3;
    true === i3.interlaced && (g3 += 4 * n2 * 7);
    for (var m3 = 8, v3 = 0, b3 = o3.length; v3 < b3; ++v3) {
      var y3 = o3[v3];
      if (0 === h3 && (h3 = c3, (p3 += g3) >= d3 && (g3 = 4 * l3 + 4 * n2 * (m3 - 1), p3 = f3 + (c3 + l3) * (m3 << 1), m3 >>= 1)), y3 === u3) p3 += 4;
      else {
        var w3 = t3[s3 + 3 * y3], N3 = t3[s3 + 3 * y3 + 1], L3 = t3[s3 + 3 * y3 + 2];
        r3[p3++] = L3, r3[p3++] = N3, r3[p3++] = w3, r3[p3++] = 255;
      }
      --h3;
    }
  }, this.decodeAndBlitFrameRGBA = function(e3, r3) {
    var i3 = this.frameInfo(e3), a3 = i3.width * i3.height, o3 = new Uint8Array(a3);
    se(t3, i3.data_offset, o3, a3);
    var s3 = i3.palette_offset, u3 = i3.transparent_index;
    null === u3 && (u3 = 256);
    var c3 = i3.width, l3 = n2 - c3, h3 = c3, f3 = 4 * (i3.y * n2 + i3.x), d3 = 4 * ((i3.y + i3.height) * n2 + i3.x), p3 = f3, g3 = 4 * l3;
    true === i3.interlaced && (g3 += 4 * n2 * 7);
    for (var m3 = 8, v3 = 0, b3 = o3.length; v3 < b3; ++v3) {
      var y3 = o3[v3];
      if (0 === h3 && (h3 = c3, (p3 += g3) >= d3 && (g3 = 4 * l3 + 4 * n2 * (m3 - 1), p3 = f3 + (c3 + l3) * (m3 << 1), m3 >>= 1)), y3 === u3) p3 += 4;
      else {
        var w3 = t3[s3 + 3 * y3], N3 = t3[s3 + 3 * y3 + 1], L3 = t3[s3 + 3 * y3 + 2];
        r3[p3++] = w3, r3[p3++] = N3, r3[p3++] = L3, r3[p3++] = 255;
      }
      --h3;
    }
  };
}
function se(t3, e2, n2, r2) {
  for (var i2 = t3[e2++], a2 = 1 << i2, s2 = a2 + 1, u2 = s2 + 1, c2 = i2 + 1, l2 = (1 << c2) - 1, h2 = 0, f2 = 0, d2 = 0, p2 = t3[e2++], g2 = new Int32Array(4096), m2 = null; ; ) {
    for (; h2 < 16 && 0 !== p2; ) f2 |= t3[e2++] << h2, h2 += 8, 1 === p2 ? p2 = t3[e2++] : --p2;
    if (h2 < c2) break;
    var v2 = f2 & l2;
    if (f2 >>= c2, h2 -= c2, v2 !== a2) {
      if (v2 === s2) break;
      for (var b2 = v2 < u2 ? v2 : m2, y2 = 0, w2 = b2; w2 > a2; ) w2 = g2[w2] >> 8, ++y2;
      var N2 = w2;
      if (d2 + y2 + (b2 !== v2 ? 1 : 0) > r2) return void o.log("Warning, gif stream longer than expected.");
      n2[d2++] = N2;
      var L2 = d2 += y2;
      for (b2 !== v2 && (n2[d2++] = N2), w2 = b2; y2--; ) w2 = g2[w2], n2[--L2] = 255 & w2, w2 >>= 8;
      null !== m2 && u2 < 4096 && (g2[u2++] = m2 << 8 | N2, u2 >= l2 + 1 && c2 < 12 && (++c2, l2 = l2 << 1 | 1)), m2 = v2;
    } else u2 = s2 + 1, l2 = (1 << (c2 = i2 + 1)) - 1, m2 = null;
  }
  return d2 !== r2 && o.log("Warning, gif stream shorter than expected."), n2;
}
/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
function ue(t3) {
  var e2, n2, r2, i2, a2, o2 = Math.floor, s2 = new Array(64), u2 = new Array(64), c2 = new Array(64), l2 = new Array(64), h2 = new Array(65535), f2 = new Array(65535), d2 = new Array(64), p2 = new Array(64), g2 = [], m2 = 0, v2 = 7, b2 = new Array(64), y2 = new Array(64), w2 = new Array(64), N2 = new Array(256), L2 = new Array(2048), x2 = [0, 1, 5, 6, 14, 15, 27, 28, 2, 4, 7, 13, 16, 26, 29, 42, 3, 8, 12, 17, 25, 30, 41, 43, 9, 11, 18, 24, 31, 40, 44, 53, 10, 19, 23, 32, 39, 45, 52, 54, 20, 22, 33, 38, 46, 51, 55, 60, 21, 34, 37, 47, 50, 56, 59, 61, 35, 36, 48, 49, 57, 58, 62, 63], A2 = [0, 0, 1, 5, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0], S2 = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], _2 = [0, 0, 2, 1, 3, 3, 2, 4, 3, 5, 5, 4, 4, 0, 0, 1, 125], P2 = [1, 2, 3, 0, 4, 17, 5, 18, 33, 49, 65, 6, 19, 81, 97, 7, 34, 113, 20, 50, 129, 145, 161, 8, 35, 66, 177, 193, 21, 82, 209, 240, 36, 51, 98, 114, 130, 9, 10, 22, 23, 24, 25, 26, 37, 38, 39, 40, 41, 42, 52, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250], k2 = [0, 0, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0], F2 = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], I2 = [0, 0, 2, 1, 2, 4, 4, 3, 4, 7, 5, 4, 4, 0, 1, 2, 119], j2 = [0, 1, 2, 3, 17, 4, 5, 33, 49, 6, 18, 65, 81, 7, 97, 113, 19, 34, 50, 129, 8, 20, 66, 145, 161, 177, 193, 9, 35, 51, 82, 240, 21, 98, 114, 209, 10, 22, 36, 52, 225, 37, 241, 23, 24, 25, 26, 38, 39, 40, 41, 42, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 130, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 226, 227, 228, 229, 230, 231, 232, 233, 234, 242, 243, 244, 245, 246, 247, 248, 249, 250];
  function C2(t4, e3) {
    for (var n3 = 0, r3 = 0, i3 = new Array(), a3 = 1; a3 <= 16; a3++) {
      for (var o3 = 1; o3 <= t4[a3]; o3++) i3[e3[r3]] = [], i3[e3[r3]][0] = n3, i3[e3[r3]][1] = a3, r3++, n3++;
      n3 *= 2;
    }
    return i3;
  }
  function O2(t4) {
    for (var e3 = t4[0], n3 = t4[1] - 1; n3 >= 0; ) e3 & 1 << n3 && (m2 |= 1 << v2), n3--, --v2 < 0 && (255 == m2 ? (B2(255), B2(0)) : B2(m2), v2 = 7, m2 = 0);
  }
  function B2(t4) {
    g2.push(t4);
  }
  function M2(t4) {
    B2(t4 >> 8 & 255), B2(255 & t4);
  }
  function q2(t4, e3, n3, r3, i3) {
    for (var a3, o3 = i3[0], s3 = i3[240], u3 = function(t5, e4) {
      var n4, r4, i4, a4, o4, s4, u4, c4, l4, h3, f3 = 0;
      for (l4 = 0; l4 < 8; ++l4) {
        n4 = t5[f3], r4 = t5[f3 + 1], i4 = t5[f3 + 2], a4 = t5[f3 + 3], o4 = t5[f3 + 4], s4 = t5[f3 + 5], u4 = t5[f3 + 6];
        var p3 = n4 + (c4 = t5[f3 + 7]), g4 = n4 - c4, m4 = r4 + u4, v4 = r4 - u4, b4 = i4 + s4, y4 = i4 - s4, w4 = a4 + o4, N3 = a4 - o4, L3 = p3 + w4, x3 = p3 - w4, A3 = m4 + b4, S3 = m4 - b4;
        t5[f3] = L3 + A3, t5[f3 + 4] = L3 - A3;
        var _3 = 0.707106781 * (S3 + x3);
        t5[f3 + 2] = x3 + _3, t5[f3 + 6] = x3 - _3;
        var P3 = 0.382683433 * ((L3 = N3 + y4) - (S3 = v4 + g4)), k3 = 0.5411961 * L3 + P3, F3 = 1.306562965 * S3 + P3, I3 = 0.707106781 * (A3 = y4 + v4), j3 = g4 + I3, C3 = g4 - I3;
        t5[f3 + 5] = C3 + k3, t5[f3 + 3] = C3 - k3, t5[f3 + 1] = j3 + F3, t5[f3 + 7] = j3 - F3, f3 += 8;
      }
      for (f3 = 0, l4 = 0; l4 < 8; ++l4) {
        n4 = t5[f3], r4 = t5[f3 + 8], i4 = t5[f3 + 16], a4 = t5[f3 + 24], o4 = t5[f3 + 32], s4 = t5[f3 + 40], u4 = t5[f3 + 48];
        var O3 = n4 + (c4 = t5[f3 + 56]), B3 = n4 - c4, M3 = r4 + u4, q3 = r4 - u4, E3 = i4 + s4, R2 = i4 - s4, D2 = a4 + o4, T2 = a4 - o4, z2 = O3 + D2, U2 = O3 - D2, H2 = M3 + E3, W2 = M3 - E3;
        t5[f3] = z2 + H2, t5[f3 + 32] = z2 - H2;
        var V2 = 0.707106781 * (W2 + U2);
        t5[f3 + 16] = U2 + V2, t5[f3 + 48] = U2 - V2;
        var G2 = 0.382683433 * ((z2 = T2 + R2) - (W2 = q3 + B3)), Y2 = 0.5411961 * z2 + G2, J2 = 1.306562965 * W2 + G2, X2 = 0.707106781 * (H2 = R2 + q3), K2 = B3 + X2, Z2 = B3 - X2;
        t5[f3 + 40] = Z2 + Y2, t5[f3 + 24] = Z2 - Y2, t5[f3 + 8] = K2 + J2, t5[f3 + 56] = K2 - J2, f3++;
      }
      for (l4 = 0; l4 < 64; ++l4) h3 = t5[l4] * e4[l4], d2[l4] = h3 > 0 ? h3 + 0.5 | 0 : h3 - 0.5 | 0;
      return d2;
    }(t4, e3), c3 = 0; c3 < 64; ++c3) p2[x2[c3]] = u3[c3];
    var l3 = p2[0] - n3;
    n3 = p2[0], 0 == l3 ? O2(r3[0]) : (O2(r3[f2[a3 = 32767 + l3]]), O2(h2[a3]));
    for (var g3 = 63; g3 > 0 && 0 == p2[g3]; ) g3--;
    if (0 == g3) return O2(o3), n3;
    for (var m3, v3 = 1; v3 <= g3; ) {
      for (var b3 = v3; 0 == p2[v3] && v3 <= g3; ) ++v3;
      var y3 = v3 - b3;
      if (y3 >= 16) {
        m3 = y3 >> 4;
        for (var w3 = 1; w3 <= m3; ++w3) O2(s3);
        y3 &= 15;
      }
      a3 = 32767 + p2[v3], O2(i3[(y3 << 4) + f2[a3]]), O2(h2[a3]), v3++;
    }
    return 63 != g3 && O2(o3), n3;
  }
  function E2(t4) {
    t4 = Math.min(Math.max(t4, 1), 100), a2 != t4 && (function(t5) {
      for (var e3 = [16, 11, 10, 16, 24, 40, 51, 61, 12, 12, 14, 19, 26, 58, 60, 55, 14, 13, 16, 24, 40, 57, 69, 56, 14, 17, 22, 29, 51, 87, 80, 62, 18, 22, 37, 56, 68, 109, 103, 77, 24, 35, 55, 64, 81, 104, 113, 92, 49, 64, 78, 87, 103, 121, 120, 101, 72, 92, 95, 98, 112, 100, 103, 99], n3 = 0; n3 < 64; n3++) {
        var r3 = o2((e3[n3] * t5 + 50) / 100);
        r3 = Math.min(Math.max(r3, 1), 255), s2[x2[n3]] = r3;
      }
      for (var i3 = [17, 18, 24, 47, 99, 99, 99, 99, 18, 21, 26, 66, 99, 99, 99, 99, 24, 26, 56, 99, 99, 99, 99, 99, 47, 66, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99], a3 = 0; a3 < 64; a3++) {
        var h3 = o2((i3[a3] * t5 + 50) / 100);
        h3 = Math.min(Math.max(h3, 1), 255), u2[x2[a3]] = h3;
      }
      for (var f3 = [1, 1.387039845, 1.306562965, 1.175875602, 1, 0.785694958, 0.5411961, 0.275899379], d3 = 0, p3 = 0; p3 < 8; p3++) for (var g3 = 0; g3 < 8; g3++) c2[d3] = 1 / (s2[x2[d3]] * f3[p3] * f3[g3] * 8), l2[d3] = 1 / (u2[x2[d3]] * f3[p3] * f3[g3] * 8), d3++;
    }(t4 < 50 ? Math.floor(5e3 / t4) : Math.floor(200 - 2 * t4)), a2 = t4);
  }
  this.encode = function(t4, a3) {
    a3 && E2(a3), g2 = new Array(), m2 = 0, v2 = 7, M2(65496), M2(65504), M2(16), B2(74), B2(70), B2(73), B2(70), B2(0), B2(1), B2(1), B2(0), M2(1), M2(1), B2(0), B2(0), function() {
      M2(65499), M2(132), B2(0);
      for (var t5 = 0; t5 < 64; t5++) B2(s2[t5]);
      B2(1);
      for (var e3 = 0; e3 < 64; e3++) B2(u2[e3]);
    }(), function(t5, e3) {
      M2(65472), M2(17), B2(8), M2(e3), M2(t5), B2(3), B2(1), B2(17), B2(0), B2(2), B2(17), B2(1), B2(3), B2(17), B2(1);
    }(t4.width, t4.height), function() {
      M2(65476), M2(418), B2(0);
      for (var t5 = 0; t5 < 16; t5++) B2(A2[t5 + 1]);
      for (var e3 = 0; e3 <= 11; e3++) B2(S2[e3]);
      B2(16);
      for (var n3 = 0; n3 < 16; n3++) B2(_2[n3 + 1]);
      for (var r3 = 0; r3 <= 161; r3++) B2(P2[r3]);
      B2(1);
      for (var i3 = 0; i3 < 16; i3++) B2(k2[i3 + 1]);
      for (var a4 = 0; a4 <= 11; a4++) B2(F2[a4]);
      B2(17);
      for (var o4 = 0; o4 < 16; o4++) B2(I2[o4 + 1]);
      for (var s3 = 0; s3 <= 161; s3++) B2(j2[s3]);
    }(), M2(65498), M2(12), B2(3), B2(1), B2(0), B2(2), B2(17), B2(3), B2(17), B2(0), B2(63), B2(0);
    var o3 = 0, h3 = 0, f3 = 0;
    m2 = 0, v2 = 7, this.encode.displayName = "_encode_";
    for (var d3, p3, N3, x3, C3, R2, D2, T2, z2, U2 = t4.data, H2 = t4.width, W2 = t4.height, V2 = 4 * H2, G2 = 0; G2 < W2; ) {
      for (d3 = 0; d3 < V2; ) {
        for (C3 = V2 * G2 + d3, D2 = -1, T2 = 0, z2 = 0; z2 < 64; z2++) R2 = C3 + (T2 = z2 >> 3) * V2 + (D2 = 4 * (7 & z2)), G2 + T2 >= W2 && (R2 -= V2 * (G2 + 1 + T2 - W2)), d3 + D2 >= V2 && (R2 -= d3 + D2 - V2 + 4), p3 = U2[R2++], N3 = U2[R2++], x3 = U2[R2++], b2[z2] = (L2[p3] + L2[N3 + 256 | 0] + L2[x3 + 512 | 0] >> 16) - 128, y2[z2] = (L2[p3 + 768 | 0] + L2[N3 + 1024 | 0] + L2[x3 + 1280 | 0] >> 16) - 128, w2[z2] = (L2[p3 + 1280 | 0] + L2[N3 + 1536 | 0] + L2[x3 + 1792 | 0] >> 16) - 128;
        o3 = q2(b2, c2, o3, e2, r2), h3 = q2(y2, l2, h3, n2, i2), f3 = q2(w2, l2, f3, n2, i2), d3 += 32;
      }
      G2 += 8;
    }
    if (v2 >= 0) {
      var Y2 = [];
      Y2[1] = v2 + 1, Y2[0] = (1 << v2 + 1) - 1, O2(Y2);
    }
    return M2(65497), new Uint8Array(g2);
  }, t3 = t3 || 50, function() {
    for (var t4 = String.fromCharCode, e3 = 0; e3 < 256; e3++) N2[e3] = t4(e3);
  }(), e2 = C2(A2, S2), n2 = C2(k2, F2), r2 = C2(_2, P2), i2 = C2(I2, j2), function() {
    for (var t4 = 1, e3 = 2, n3 = 1; n3 <= 15; n3++) {
      for (var r3 = t4; r3 < e3; r3++) f2[32767 + r3] = n3, h2[32767 + r3] = [], h2[32767 + r3][1] = n3, h2[32767 + r3][0] = r3;
      for (var i3 = -(e3 - 1); i3 <= -t4; i3++) f2[32767 + i3] = n3, h2[32767 + i3] = [], h2[32767 + i3][1] = n3, h2[32767 + i3][0] = e3 - 1 + i3;
      t4 <<= 1, e3 <<= 1;
    }
  }(), function() {
    for (var t4 = 0; t4 < 256; t4++) L2[t4] = 19595 * t4, L2[t4 + 256 | 0] = 38470 * t4, L2[t4 + 512 | 0] = 7471 * t4 + 32768, L2[t4 + 768 | 0] = -11059 * t4, L2[t4 + 1024 | 0] = -21709 * t4, L2[t4 + 1280 | 0] = 32768 * t4 + 8421375, L2[t4 + 1536 | 0] = -27439 * t4, L2[t4 + 1792 | 0] = -5329 * t4;
  }(), E2(t3);
}
/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function ce(t3, e2) {
  if (this.pos = 0, this.buffer = t3, this.datav = new DataView(t3.buffer), this.is_with_alpha = !!e2, this.bottom_up = true, this.flag = String.fromCharCode(this.buffer[0]) + String.fromCharCode(this.buffer[1]), this.pos += 2, -1 === ["BM", "BA", "CI", "CP", "IC", "PT"].indexOf(this.flag)) throw new Error("Invalid BMP File");
  this.parseHeader(), this.parseBGR();
}
function le(t3) {
  function e2(t4) {
    if (!t4) throw Error("assert :P");
  }
  function n2(t4, e3, n3) {
    for (var r3 = 0; 4 > r3; r3++) if (t4[e3 + r3] != n3.charCodeAt(r3)) return true;
    return false;
  }
  function r2(t4, e3, n3, r3, i3) {
    for (var a3 = 0; a3 < i3; a3++) t4[e3 + a3] = n3[r3 + a3];
  }
  function i2(t4, e3, n3, r3) {
    for (var i3 = 0; i3 < r3; i3++) t4[e3 + i3] = n3;
  }
  function a2(t4) {
    return new Int32Array(t4);
  }
  function o2(t4, e3) {
    for (var n3 = [], r3 = 0; r3 < t4; r3++) n3.push(new e3());
    return n3;
  }
  function s2(t4, e3) {
    var n3 = [];
    return function t5(n4, r3, i3) {
      for (var a3 = i3[r3], o3 = 0; o3 < a3 && (n4.push(i3.length > r3 + 1 ? [] : new e3()), !(i3.length < r3 + 1)); o3++) t5(n4[o3], r3 + 1, i3);
    }(n3, 0, t4), n3;
  }
  var u2 = function() {
    var t4 = this;
    function u3(t5, e3) {
      for (var n3 = 1 << e3 - 1 >>> 0; t5 & n3; ) n3 >>>= 1;
      return n3 ? (t5 & n3 - 1) + n3 : t5;
    }
    function c3(t5, n3, r3, i3, a3) {
      e2(!(i3 % r3));
      do {
        t5[n3 + (i3 -= r3)] = a3;
      } while (0 < i3);
    }
    function l3(t5, n3, r3, i3, o3) {
      if (e2(2328 >= o3), 512 >= o3) var s3 = a2(512);
      else if (null == (s3 = a2(o3))) return 0;
      return function(t6, n4, r4, i4, o4, s4) {
        var l4, f4, d4 = n4, p4 = 1 << r4, g4 = a2(16), m4 = a2(16);
        for (e2(0 != o4), e2(null != i4), e2(null != t6), e2(0 < r4), f4 = 0; f4 < o4; ++f4) {
          if (15 < i4[f4]) return 0;
          ++g4[i4[f4]];
        }
        if (g4[0] == o4) return 0;
        for (m4[1] = 0, l4 = 1; 15 > l4; ++l4) {
          if (g4[l4] > 1 << l4) return 0;
          m4[l4 + 1] = m4[l4] + g4[l4];
        }
        for (f4 = 0; f4 < o4; ++f4) l4 = i4[f4], 0 < i4[f4] && (s4[m4[l4]++] = f4);
        if (1 == m4[15]) return (i4 = new h3()).g = 0, i4.value = s4[0], c3(t6, d4, 1, p4, i4), p4;
        var v4, b4 = -1, y4 = p4 - 1, w4 = 0, N4 = 1, L4 = 1, x4 = 1 << r4;
        for (f4 = 0, l4 = 1, o4 = 2; l4 <= r4; ++l4, o4 <<= 1) {
          if (N4 += L4 <<= 1, 0 > (L4 -= g4[l4])) return 0;
          for (; 0 < g4[l4]; --g4[l4]) (i4 = new h3()).g = l4, i4.value = s4[f4++], c3(t6, d4 + w4, o4, x4, i4), w4 = u3(w4, l4);
        }
        for (l4 = r4 + 1, o4 = 2; 15 >= l4; ++l4, o4 <<= 1) {
          if (N4 += L4 <<= 1, 0 > (L4 -= g4[l4])) return 0;
          for (; 0 < g4[l4]; --g4[l4]) {
            if (i4 = new h3(), (w4 & y4) != b4) {
              for (d4 += x4, v4 = 1 << (b4 = l4) - r4; 15 > b4 && !(0 >= (v4 -= g4[b4])); ) ++b4, v4 <<= 1;
              p4 += x4 = 1 << (v4 = b4 - r4), t6[n4 + (b4 = w4 & y4)].g = v4 + r4, t6[n4 + b4].value = d4 - n4 - b4;
            }
            i4.g = l4 - r4, i4.value = s4[f4++], c3(t6, d4 + (w4 >> r4), o4, x4, i4), w4 = u3(w4, l4);
          }
        }
        return N4 != 2 * m4[15] - 1 ? 0 : p4;
      }(t5, n3, r3, i3, o3, s3);
    }
    function h3() {
      this.value = this.g = 0;
    }
    function f3() {
      this.value = this.g = 0;
    }
    function d3() {
      this.G = o2(5, h3), this.H = a2(5), this.jc = this.Qb = this.qb = this.nd = 0, this.pd = o2(Rn, f3);
    }
    function p3(t5, n3, r3, i3) {
      e2(null != t5), e2(null != n3), e2(2147483648 > i3), t5.Ca = 254, t5.I = 0, t5.b = -8, t5.Ka = 0, t5.oa = n3, t5.pa = r3, t5.Jd = n3, t5.Yc = r3 + i3, t5.Zc = 4 <= i3 ? r3 + i3 - 4 + 1 : r3, _2(t5);
    }
    function g3(t5, e3) {
      for (var n3 = 0; 0 < e3--; ) n3 |= k2(t5, 128) << e3;
      return n3;
    }
    function m3(t5, e3) {
      var n3 = g3(t5, e3);
      return P2(t5) ? -n3 : n3;
    }
    function v3(t5, n3, r3, i3) {
      var a3, o3 = 0;
      for (e2(null != t5), e2(null != n3), e2(4294967288 > i3), t5.Sb = i3, t5.Ra = 0, t5.u = 0, t5.h = 0, 4 < i3 && (i3 = 4), a3 = 0; a3 < i3; ++a3) o3 += n3[r3 + a3] << 8 * a3;
      t5.Ra = o3, t5.bb = i3, t5.oa = n3, t5.pa = r3;
    }
    function b3(t5) {
      for (; 8 <= t5.u && t5.bb < t5.Sb; ) t5.Ra >>>= 8, t5.Ra += t5.oa[t5.pa + t5.bb] << zn - 8 >>> 0, ++t5.bb, t5.u -= 8;
      x3(t5) && (t5.h = 1, t5.u = 0);
    }
    function y3(t5, n3) {
      if (e2(0 <= n3), !t5.h && n3 <= Tn) {
        var r3 = L3(t5) & Dn[n3];
        return t5.u += n3, b3(t5), r3;
      }
      return t5.h = 1, t5.u = 0;
    }
    function w3() {
      this.b = this.Ca = this.I = 0, this.oa = [], this.pa = 0, this.Jd = [], this.Yc = 0, this.Zc = [], this.Ka = 0;
    }
    function N3() {
      this.Ra = 0, this.oa = [], this.h = this.u = this.bb = this.Sb = this.pa = 0;
    }
    function L3(t5) {
      return t5.Ra >>> (t5.u & zn - 1) >>> 0;
    }
    function x3(t5) {
      return e2(t5.bb <= t5.Sb), t5.h || t5.bb == t5.Sb && t5.u > zn;
    }
    function A3(t5, e3) {
      t5.u = e3, t5.h = x3(t5);
    }
    function S2(t5) {
      t5.u >= Un && (e2(t5.u >= Un), b3(t5));
    }
    function _2(t5) {
      e2(null != t5 && null != t5.oa), t5.pa < t5.Zc ? (t5.I = (t5.oa[t5.pa++] | t5.I << 8) >>> 0, t5.b += 8) : (e2(null != t5 && null != t5.oa), t5.pa < t5.Yc ? (t5.b += 8, t5.I = t5.oa[t5.pa++] | t5.I << 8) : t5.Ka ? t5.b = 0 : (t5.I <<= 8, t5.b += 8, t5.Ka = 1));
    }
    function P2(t5) {
      return g3(t5, 1);
    }
    function k2(t5, e3) {
      var n3 = t5.Ca;
      0 > t5.b && _2(t5);
      var r3 = t5.b, i3 = n3 * e3 >>> 8, a3 = (t5.I >>> r3 > i3) + 0;
      for (a3 ? (n3 -= i3, t5.I -= i3 + 1 << r3 >>> 0) : n3 = i3 + 1, r3 = n3, i3 = 0; 256 <= r3; ) i3 += 8, r3 >>= 8;
      return r3 = 7 ^ i3 + Hn[r3], t5.b -= r3, t5.Ca = (n3 << r3) - 1, a3;
    }
    function F2(t5, e3, n3) {
      t5[e3 + 0] = n3 >> 24 & 255, t5[e3 + 1] = n3 >> 16 & 255, t5[e3 + 2] = n3 >> 8 & 255, t5[e3 + 3] = 255 & n3;
    }
    function I2(t5, e3) {
      return t5[e3 + 0] | t5[e3 + 1] << 8;
    }
    function j2(t5, e3) {
      return I2(t5, e3) | t5[e3 + 2] << 16;
    }
    function C2(t5, e3) {
      return I2(t5, e3) | I2(t5, e3 + 2) << 16;
    }
    function O2(t5, n3) {
      var r3 = 1 << n3;
      return e2(null != t5), e2(0 < n3), t5.X = a2(r3), null == t5.X ? 0 : (t5.Mb = 32 - n3, t5.Xa = n3, 1);
    }
    function B2(t5, n3) {
      e2(null != t5), e2(null != n3), e2(t5.Xa == n3.Xa), r2(n3.X, 0, t5.X, 0, 1 << n3.Xa);
    }
    function M2() {
      this.X = [], this.Xa = this.Mb = 0;
    }
    function q2(t5, n3, r3, i3) {
      e2(null != r3), e2(null != i3);
      var a3 = r3[0], o3 = i3[0];
      return 0 == a3 && (a3 = (t5 * o3 + n3 / 2) / n3), 0 == o3 && (o3 = (n3 * a3 + t5 / 2) / t5), 0 >= a3 || 0 >= o3 ? 0 : (r3[0] = a3, i3[0] = o3, 1);
    }
    function E2(t5, e3) {
      return t5 + (1 << e3) - 1 >>> e3;
    }
    function R2(t5, e3) {
      return ((4278255360 & t5) + (4278255360 & e3) >>> 0 & 4278255360) + ((16711935 & t5) + (16711935 & e3) >>> 0 & 16711935) >>> 0;
    }
    function D2(e3, n3) {
      t4[n3] = function(n4, r3, i3, a3, o3, s3, u4) {
        var c4;
        for (c4 = 0; c4 < o3; ++c4) {
          var l4 = t4[e3](s3[u4 + c4 - 1], i3, a3 + c4);
          s3[u4 + c4] = R2(n4[r3 + c4], l4);
        }
      };
    }
    function T2() {
      this.ud = this.hd = this.jd = 0;
    }
    function z2(t5, e3) {
      return ((4278124286 & (t5 ^ e3)) >>> 1) + (t5 & e3) >>> 0;
    }
    function U2(t5) {
      return 0 <= t5 && 256 > t5 ? t5 : 0 > t5 ? 0 : 255 < t5 ? 255 : void 0;
    }
    function H2(t5, e3) {
      return U2(t5 + (t5 - e3 + 0.5 >> 1));
    }
    function W2(t5, e3, n3) {
      return Math.abs(e3 - n3) - Math.abs(t5 - n3);
    }
    function V2(t5, e3, n3, r3, i3, a3, o3) {
      for (r3 = a3[o3 - 1], n3 = 0; n3 < i3; ++n3) a3[o3 + n3] = r3 = R2(t5[e3 + n3], r3);
    }
    function G2(t5, e3, n3, r3, i3) {
      var a3;
      for (a3 = 0; a3 < n3; ++a3) {
        var o3 = t5[e3 + a3], s3 = o3 >> 8 & 255, u4 = 16711935 & (u4 = (u4 = 16711935 & o3) + ((s3 << 16) + s3));
        r3[i3 + a3] = (4278255360 & o3) + u4 >>> 0;
      }
    }
    function Y2(t5, e3) {
      e3.jd = 255 & t5, e3.hd = t5 >> 8 & 255, e3.ud = t5 >> 16 & 255;
    }
    function J2(t5, e3, n3, r3, i3, a3) {
      var o3;
      for (o3 = 0; o3 < r3; ++o3) {
        var s3 = e3[n3 + o3], u4 = s3 >>> 8, c4 = s3, l4 = 255 & (l4 = (l4 = s3 >>> 16) + ((t5.jd << 24 >> 24) * (u4 << 24 >> 24) >>> 5));
        c4 = 255 & (c4 = (c4 += (t5.hd << 24 >> 24) * (u4 << 24 >> 24) >>> 5) + ((t5.ud << 24 >> 24) * (l4 << 24 >> 24) >>> 5)), i3[a3 + o3] = (4278255360 & s3) + (l4 << 16) + c4;
      }
    }
    function X2(e3, n3, r3, i3, a3) {
      t4[n3] = function(t5, e4, n4, r4, o3, s3, u4, c4, l4) {
        for (r4 = u4; r4 < c4; ++r4) for (u4 = 0; u4 < l4; ++u4) o3[s3++] = a3(n4[i3(t5[e4++])]);
      }, t4[e3] = function(e4, n4, o3, s3, u4, c4, l4) {
        var h4 = 8 >> e4.b, f4 = e4.Ea, d4 = e4.K[0], p4 = e4.w;
        if (8 > h4) for (e4 = (1 << e4.b) - 1, p4 = (1 << h4) - 1; n4 < o3; ++n4) {
          var g4, m4 = 0;
          for (g4 = 0; g4 < f4; ++g4) g4 & e4 || (m4 = i3(s3[u4++])), c4[l4++] = a3(d4[m4 & p4]), m4 >>= h4;
        }
        else t4["VP8LMapColor" + r3](s3, u4, d4, p4, c4, l4, n4, o3, f4);
      };
    }
    function K2(t5, e3, n3, r3, i3) {
      for (n3 = e3 + n3; e3 < n3; ) {
        var a3 = t5[e3++];
        r3[i3++] = a3 >> 16 & 255, r3[i3++] = a3 >> 8 & 255, r3[i3++] = 255 & a3;
      }
    }
    function Z2(t5, e3, n3, r3, i3) {
      for (n3 = e3 + n3; e3 < n3; ) {
        var a3 = t5[e3++];
        r3[i3++] = a3 >> 16 & 255, r3[i3++] = a3 >> 8 & 255, r3[i3++] = 255 & a3, r3[i3++] = a3 >> 24 & 255;
      }
    }
    function $2(t5, e3, n3, r3, i3) {
      for (n3 = e3 + n3; e3 < n3; ) {
        var a3 = (o3 = t5[e3++]) >> 16 & 240 | o3 >> 12 & 15, o3 = 240 & o3 | o3 >> 28 & 15;
        r3[i3++] = a3, r3[i3++] = o3;
      }
    }
    function Q2(t5, e3, n3, r3, i3) {
      for (n3 = e3 + n3; e3 < n3; ) {
        var a3 = (o3 = t5[e3++]) >> 16 & 248 | o3 >> 13 & 7, o3 = o3 >> 5 & 224 | o3 >> 3 & 31;
        r3[i3++] = a3, r3[i3++] = o3;
      }
    }
    function tt2(t5, e3, n3, r3, i3) {
      for (n3 = e3 + n3; e3 < n3; ) {
        var a3 = t5[e3++];
        r3[i3++] = 255 & a3, r3[i3++] = a3 >> 8 & 255, r3[i3++] = a3 >> 16 & 255;
      }
    }
    function et2(t5, e3, n3, i3, a3, o3) {
      if (0 == o3) for (n3 = e3 + n3; e3 < n3; ) F2(i3, ((o3 = t5[e3++])[0] >> 24 | o3[1] >> 8 & 65280 | o3[2] << 8 & 16711680 | o3[3] << 24) >>> 0), a3 += 32;
      else r2(i3, a3, t5, e3, n3);
    }
    function nt2(e3, n3) {
      t4[n3][0] = t4[e3 + "0"], t4[n3][1] = t4[e3 + "1"], t4[n3][2] = t4[e3 + "2"], t4[n3][3] = t4[e3 + "3"], t4[n3][4] = t4[e3 + "4"], t4[n3][5] = t4[e3 + "5"], t4[n3][6] = t4[e3 + "6"], t4[n3][7] = t4[e3 + "7"], t4[n3][8] = t4[e3 + "8"], t4[n3][9] = t4[e3 + "9"], t4[n3][10] = t4[e3 + "10"], t4[n3][11] = t4[e3 + "11"], t4[n3][12] = t4[e3 + "12"], t4[n3][13] = t4[e3 + "13"], t4[n3][14] = t4[e3 + "0"], t4[n3][15] = t4[e3 + "0"];
    }
    function rt2(t5) {
      return t5 == Ur || t5 == Hr || t5 == Wr || t5 == Vr;
    }
    function it2() {
      this.eb = [], this.size = this.A = this.fb = 0;
    }
    function at2() {
      this.y = [], this.f = [], this.ea = [], this.F = [], this.Tc = this.Ed = this.Cd = this.Fd = this.lb = this.Db = this.Ab = this.fa = this.J = this.W = this.N = this.O = 0;
    }
    function ot2() {
      this.Rd = this.height = this.width = this.S = 0, this.f = {}, this.f.RGBA = new it2(), this.f.kb = new at2(), this.sd = null;
    }
    function st2() {
      this.width = [0], this.height = [0], this.Pd = [0], this.Qd = [0], this.format = [0];
    }
    function ut2() {
      this.Id = this.fd = this.Md = this.hb = this.ib = this.da = this.bd = this.cd = this.j = this.v = this.Da = this.Sd = this.ob = 0;
    }
    function ct2(t5) {
      return alert("todo:WebPSamplerProcessPlane"), t5.T;
    }
    function lt2(t5, e3) {
      var n3 = t5.T, i3 = e3.ba.f.RGBA, a3 = i3.eb, o3 = i3.fb + t5.ka * i3.A, s3 = mi[e3.ba.S], u4 = t5.y, c4 = t5.O, l4 = t5.f, h4 = t5.N, f4 = t5.ea, d4 = t5.W, p4 = e3.cc, g4 = e3.dc, m4 = e3.Mc, v4 = e3.Nc, b4 = t5.ka, y4 = t5.ka + t5.T, w4 = t5.U, N4 = w4 + 1 >> 1;
      for (0 == b4 ? s3(u4, c4, null, null, l4, h4, f4, d4, l4, h4, f4, d4, a3, o3, null, null, w4) : (s3(e3.ec, e3.fc, u4, c4, p4, g4, m4, v4, l4, h4, f4, d4, a3, o3 - i3.A, a3, o3, w4), ++n3); b4 + 2 < y4; b4 += 2) p4 = l4, g4 = h4, m4 = f4, v4 = d4, h4 += t5.Rc, d4 += t5.Rc, o3 += 2 * i3.A, s3(u4, (c4 += 2 * t5.fa) - t5.fa, u4, c4, p4, g4, m4, v4, l4, h4, f4, d4, a3, o3 - i3.A, a3, o3, w4);
      return c4 += t5.fa, t5.j + y4 < t5.o ? (r2(e3.ec, e3.fc, u4, c4, w4), r2(e3.cc, e3.dc, l4, h4, N4), r2(e3.Mc, e3.Nc, f4, d4, N4), n3--) : 1 & y4 || s3(u4, c4, null, null, l4, h4, f4, d4, l4, h4, f4, d4, a3, o3 + i3.A, null, null, w4), n3;
    }
    function ht2(t5, n3, r3) {
      var i3 = t5.F, a3 = [t5.J];
      if (null != i3) {
        var o3 = t5.U, s3 = n3.ba.S, u4 = s3 == Dr || s3 == Wr;
        n3 = n3.ba.f.RGBA;
        var c4 = [0], l4 = t5.ka;
        c4[0] = t5.T, t5.Kb && (0 == l4 ? --c4[0] : (--l4, a3[0] -= t5.width), t5.j + t5.ka + t5.T == t5.o && (c4[0] = t5.o - t5.j - l4));
        var h4 = n3.eb;
        l4 = n3.fb + l4 * n3.A, t5 = Ar(i3, a3[0], t5.width, o3, c4, h4, l4 + (u4 ? 0 : 3), n3.A), e2(r3 == c4), t5 && rt2(s3) && Lr(h4, l4, u4, o3, c4, n3.A);
      }
      return 0;
    }
    function ft2(t5) {
      var e3 = t5.ma, n3 = e3.ba.S, r3 = 11 > n3, i3 = n3 == qr || n3 == Rr || n3 == Dr || n3 == Tr || 12 == n3 || rt2(n3);
      if (e3.memory = null, e3.Ib = null, e3.Jb = null, e3.Nd = null, !Mn(e3.Oa, t5, i3 ? 11 : 12)) return 0;
      if (i3 && rt2(n3) && bn(), t5.da) alert("todo:use_scaling");
      else {
        if (r3) {
          if (e3.Ib = ct2, t5.Kb) {
            if (n3 = t5.U + 1 >> 1, e3.memory = a2(t5.U + 2 * n3), null == e3.memory) return 0;
            e3.ec = e3.memory, e3.fc = 0, e3.cc = e3.ec, e3.dc = e3.fc + t5.U, e3.Mc = e3.cc, e3.Nc = e3.dc + n3, e3.Ib = lt2, bn();
          }
        } else alert("todo:EmitYUV");
        i3 && (e3.Jb = ht2, r3 && mn());
      }
      if (r3 && !Ii) {
        for (t5 = 0; 256 > t5; ++t5) ji[t5] = 89858 * (t5 - 128) + Si >> Ai, Bi[t5] = -22014 * (t5 - 128) + Si, Oi[t5] = -45773 * (t5 - 128), Ci[t5] = 113618 * (t5 - 128) + Si >> Ai;
        for (t5 = _i; t5 < Pi; ++t5) e3 = 76283 * (t5 - 16) + Si >> Ai, Mi[t5 - _i] = Vt2(e3, 255), qi[t5 - _i] = Vt2(e3 + 8 >> 4, 15);
        Ii = 1;
      }
      return 1;
    }
    function dt2(t5) {
      var n3 = t5.ma, r3 = t5.U, i3 = t5.T;
      return e2(!(1 & t5.ka)), 0 >= r3 || 0 >= i3 ? 0 : (r3 = n3.Ib(t5, n3), null != n3.Jb && n3.Jb(t5, n3, r3), n3.Dc += r3, 1);
    }
    function pt2(t5) {
      t5.ma.memory = null;
    }
    function gt2(t5, e3, n3, r3) {
      return 47 != y3(t5, 8) ? 0 : (e3[0] = y3(t5, 14) + 1, n3[0] = y3(t5, 14) + 1, r3[0] = y3(t5, 1), 0 != y3(t5, 3) ? 0 : !t5.h);
    }
    function mt2(t5, e3) {
      if (4 > t5) return t5 + 1;
      var n3 = t5 - 2 >> 1;
      return (2 + (1 & t5) << n3) + y3(e3, n3) + 1;
    }
    function vt2(t5, e3) {
      return 120 < e3 ? e3 - 120 : 1 <= (n3 = ((n3 = Zr[e3 - 1]) >> 4) * t5 + (8 - (15 & n3))) ? n3 : 1;
      var n3;
    }
    function bt2(t5, e3, n3) {
      var r3 = L3(n3), i3 = t5[e3 += 255 & r3].g - 8;
      return 0 < i3 && (A3(n3, n3.u + 8), r3 = L3(n3), e3 += t5[e3].value, e3 += r3 & (1 << i3) - 1), A3(n3, n3.u + t5[e3].g), t5[e3].value;
    }
    function yt2(t5, n3, r3) {
      return r3.g += t5.g, r3.value += t5.value << n3 >>> 0, e2(8 >= r3.g), t5.g;
    }
    function wt2(t5, n3, r3) {
      var i3 = t5.xc;
      return e2((n3 = 0 == i3 ? 0 : t5.vc[t5.md * (r3 >> i3) + (n3 >> i3)]) < t5.Wb), t5.Ya[n3];
    }
    function Nt2(t5, n3, i3, a3) {
      var o3 = t5.ab, s3 = t5.c * n3, u4 = t5.C;
      n3 = u4 + n3;
      var c4 = i3, l4 = a3;
      for (a3 = t5.Ta, i3 = t5.Ua; 0 < o3--; ) {
        var h4 = t5.gc[o3], f4 = u4, d4 = n3, p4 = c4, g4 = l4, m4 = (l4 = a3, c4 = i3, h4.Ea);
        switch (e2(f4 < d4), e2(d4 <= h4.nc), h4.hc) {
          case 2:
            Gn(p4, g4, (d4 - f4) * m4, l4, c4);
            break;
          case 0:
            var v4 = f4, b4 = d4, y4 = l4, w4 = c4, N4 = (_3 = h4).Ea;
            0 == v4 && (Wn(p4, g4, null, null, 1, y4, w4), V2(p4, g4 + 1, 0, 0, N4 - 1, y4, w4 + 1), g4 += N4, w4 += N4, ++v4);
            for (var L4 = 1 << _3.b, x4 = L4 - 1, A4 = E2(N4, _3.b), S3 = _3.K, _3 = _3.w + (v4 >> _3.b) * A4; v4 < b4; ) {
              var P3 = S3, k3 = _3, F3 = 1;
              for (Vn(p4, g4, y4, w4 - N4, 1, y4, w4); F3 < N4; ) {
                var I3 = (F3 & ~x4) + L4;
                I3 > N4 && (I3 = N4), (0, Zn[P3[k3++] >> 8 & 15])(p4, g4 + +F3, y4, w4 + F3 - N4, I3 - F3, y4, w4 + F3), F3 = I3;
              }
              g4 += N4, w4 += N4, ++v4 & x4 || (_3 += A4);
            }
            d4 != h4.nc && r2(l4, c4 - m4, l4, c4 + (d4 - f4 - 1) * m4, m4);
            break;
          case 1:
            for (m4 = p4, b4 = g4, N4 = (p4 = h4.Ea) - (w4 = p4 & ~(y4 = (g4 = 1 << h4.b) - 1)), v4 = E2(p4, h4.b), L4 = h4.K, h4 = h4.w + (f4 >> h4.b) * v4; f4 < d4; ) {
              for (x4 = L4, A4 = h4, S3 = new T2(), _3 = b4 + w4, P3 = b4 + p4; b4 < _3; ) Y2(x4[A4++], S3), $n(S3, m4, b4, g4, l4, c4), b4 += g4, c4 += g4;
              b4 < P3 && (Y2(x4[A4++], S3), $n(S3, m4, b4, N4, l4, c4), b4 += N4, c4 += N4), ++f4 & y4 || (h4 += v4);
            }
            break;
          case 3:
            if (p4 == l4 && g4 == c4 && 0 < h4.b) {
              for (b4 = l4, p4 = m4 = c4 + (d4 - f4) * m4 - (w4 = (d4 - f4) * E2(h4.Ea, h4.b)), g4 = l4, y4 = c4, v4 = [], w4 = (N4 = w4) - 1; 0 <= w4; --w4) v4[w4] = g4[y4 + w4];
              for (w4 = N4 - 1; 0 <= w4; --w4) b4[p4 + w4] = v4[w4];
              Yn(h4, f4, d4, l4, m4, l4, c4);
            } else Yn(h4, f4, d4, p4, g4, l4, c4);
        }
        c4 = a3, l4 = i3;
      }
      l4 != i3 && r2(a3, i3, c4, l4, s3);
    }
    function Lt2(t5, n3) {
      var r3 = t5.V, i3 = t5.Ba + t5.c * t5.C, a3 = n3 - t5.C;
      if (e2(n3 <= t5.l.o), e2(16 >= a3), 0 < a3) {
        var o3 = t5.l, s3 = t5.Ta, u4 = t5.Ua, c4 = o3.width;
        if (Nt2(t5, a3, r3, i3), a3 = u4 = [u4], e2((r3 = t5.C) < (i3 = n3)), e2(o3.v < o3.va), i3 > o3.o && (i3 = o3.o), r3 < o3.j) {
          var l4 = o3.j - r3;
          r3 = o3.j, a3[0] += l4 * c4;
        }
        if (r3 >= i3 ? r3 = 0 : (a3[0] += 4 * o3.v, o3.ka = r3 - o3.j, o3.U = o3.va - o3.v, o3.T = i3 - r3, r3 = 1), r3) {
          if (u4 = u4[0], 11 > (r3 = t5.ca).S) {
            var h4 = r3.f.RGBA, f4 = (i3 = r3.S, a3 = o3.U, o3 = o3.T, l4 = h4.eb, h4.A), d4 = o3;
            for (h4 = h4.fb + t5.Ma * h4.A; 0 < d4--; ) {
              var p4 = s3, g4 = u4, m4 = a3, v4 = l4, b4 = h4;
              switch (i3) {
                case Mr:
                  Qn(p4, g4, m4, v4, b4);
                  break;
                case qr:
                  tr(p4, g4, m4, v4, b4);
                  break;
                case Ur:
                  tr(p4, g4, m4, v4, b4), Lr(v4, b4, 0, m4, 1, 0);
                  break;
                case Er:
                  rr(p4, g4, m4, v4, b4);
                  break;
                case Rr:
                  et2(p4, g4, m4, v4, b4, 1);
                  break;
                case Hr:
                  et2(p4, g4, m4, v4, b4, 1), Lr(v4, b4, 0, m4, 1, 0);
                  break;
                case Dr:
                  et2(p4, g4, m4, v4, b4, 0);
                  break;
                case Wr:
                  et2(p4, g4, m4, v4, b4, 0), Lr(v4, b4, 1, m4, 1, 0);
                  break;
                case Tr:
                  er(p4, g4, m4, v4, b4);
                  break;
                case Vr:
                  er(p4, g4, m4, v4, b4), xr(v4, b4, m4, 1, 0);
                  break;
                case zr:
                  nr(p4, g4, m4, v4, b4);
                  break;
                default:
                  e2(0);
              }
              u4 += c4, h4 += f4;
            }
            t5.Ma += o3;
          } else alert("todo:EmitRescaledRowsYUVA");
          e2(t5.Ma <= r3.height);
        }
      }
      t5.C = n3, e2(t5.C <= t5.i);
    }
    function xt2(t5) {
      var e3;
      if (0 < t5.ua) return 0;
      for (e3 = 0; e3 < t5.Wb; ++e3) {
        var n3 = t5.Ya[e3].G, r3 = t5.Ya[e3].H;
        if (0 < n3[1][r3[1] + 0].g || 0 < n3[2][r3[2] + 0].g || 0 < n3[3][r3[3] + 0].g) return 0;
      }
      return 1;
    }
    function At2(t5, n3, r3, i3, a3, o3) {
      if (0 != t5.Z) {
        var s3 = t5.qd, u4 = t5.rd;
        for (e2(null != gi[t5.Z]); n3 < r3; ++n3) gi[t5.Z](s3, u4, i3, a3, i3, a3, o3), s3 = i3, u4 = a3, a3 += o3;
        t5.qd = s3, t5.rd = u4;
      }
    }
    function St2(t5, n3) {
      var r3 = t5.l.ma, i3 = 0 == r3.Z || 1 == r3.Z ? t5.l.j : t5.C;
      if (i3 = t5.C < i3 ? i3 : t5.C, e2(n3 <= t5.l.o), n3 > i3) {
        var a3 = t5.l.width, o3 = r3.ca, s3 = r3.tb + a3 * i3, u4 = t5.V, c4 = t5.Ba + t5.c * i3, l4 = t5.gc;
        e2(1 == t5.ab), e2(3 == l4[0].hc), Xn(l4[0], i3, n3, u4, c4, o3, s3), At2(r3, i3, n3, o3, s3, a3);
      }
      t5.C = t5.Ma = n3;
    }
    function _t2(t5, n3, r3, i3, a3, o3, s3) {
      var u4 = t5.$ / i3, c4 = t5.$ % i3, l4 = t5.m, h4 = t5.s, f4 = r3 + t5.$, d4 = f4;
      a3 = r3 + i3 * a3;
      var p4 = r3 + i3 * o3, g4 = 280 + h4.ua, m4 = t5.Pb ? u4 : 16777216, v4 = 0 < h4.ua ? h4.Wa : null, b4 = h4.wc, y4 = f4 < p4 ? wt2(h4, c4, u4) : null;
      e2(t5.C < o3), e2(p4 <= a3);
      var w4 = false;
      t: for (; ; ) {
        for (; w4 || f4 < p4; ) {
          var N4 = 0;
          if (u4 >= m4) {
            var _3 = f4 - r3;
            e2((m4 = t5).Pb), m4.wd = m4.m, m4.xd = _3, 0 < m4.s.ua && B2(m4.s.Wa, m4.s.vb), m4 = u4 + Qr;
          }
          if (c4 & b4 || (y4 = wt2(h4, c4, u4)), e2(null != y4), y4.Qb && (n3[f4] = y4.qb, w4 = true), !w4) if (S2(l4), y4.jc) {
            N4 = l4, _3 = n3;
            var P3 = f4, k3 = y4.pd[L3(N4) & Rn - 1];
            e2(y4.jc), 256 > k3.g ? (A3(N4, N4.u + k3.g), _3[P3] = k3.value, N4 = 0) : (A3(N4, N4.u + k3.g - 256), e2(256 <= k3.value), N4 = k3.value), 0 == N4 && (w4 = true);
          } else N4 = bt2(y4.G[0], y4.H[0], l4);
          if (l4.h) break;
          if (w4 || 256 > N4) {
            if (!w4) if (y4.nd) n3[f4] = (y4.qb | N4 << 8) >>> 0;
            else {
              if (S2(l4), w4 = bt2(y4.G[1], y4.H[1], l4), S2(l4), _3 = bt2(y4.G[2], y4.H[2], l4), P3 = bt2(y4.G[3], y4.H[3], l4), l4.h) break;
              n3[f4] = (P3 << 24 | w4 << 16 | N4 << 8 | _3) >>> 0;
            }
            if (w4 = false, ++f4, ++c4 >= i3 && (c4 = 0, ++u4, null != s3 && u4 <= o3 && !(u4 % 16) && s3(t5, u4), null != v4)) for (; d4 < f4; ) N4 = n3[d4++], v4.X[(506832829 * N4 & 4294967295) >>> v4.Mb] = N4;
          } else if (280 > N4) {
            if (N4 = mt2(N4 - 256, l4), _3 = bt2(y4.G[4], y4.H[4], l4), S2(l4), _3 = vt2(i3, _3 = mt2(_3, l4)), l4.h) break;
            if (f4 - r3 < _3 || a3 - f4 < N4) break t;
            for (P3 = 0; P3 < N4; ++P3) n3[f4 + P3] = n3[f4 + P3 - _3];
            for (f4 += N4, c4 += N4; c4 >= i3; ) c4 -= i3, ++u4, null != s3 && u4 <= o3 && !(u4 % 16) && s3(t5, u4);
            if (e2(f4 <= a3), c4 & b4 && (y4 = wt2(h4, c4, u4)), null != v4) for (; d4 < f4; ) N4 = n3[d4++], v4.X[(506832829 * N4 & 4294967295) >>> v4.Mb] = N4;
          } else {
            if (!(N4 < g4)) break t;
            for (w4 = N4 - 280, e2(null != v4); d4 < f4; ) N4 = n3[d4++], v4.X[(506832829 * N4 & 4294967295) >>> v4.Mb] = N4;
            N4 = f4, e2(!(w4 >>> (_3 = v4).Xa)), n3[N4] = _3.X[w4], w4 = true;
          }
          w4 || e2(l4.h == x3(l4));
        }
        if (t5.Pb && l4.h && f4 < a3) e2(t5.m.h), t5.a = 5, t5.m = t5.wd, t5.$ = t5.xd, 0 < t5.s.ua && B2(t5.s.vb, t5.s.Wa);
        else {
          if (l4.h) break t;
          null != s3 && s3(t5, u4 > o3 ? o3 : u4), t5.a = 0, t5.$ = f4 - r3;
        }
        return 1;
      }
      return t5.a = 3, 0;
    }
    function Pt2(t5) {
      e2(null != t5), t5.vc = null, t5.yc = null, t5.Ya = null;
      var n3 = t5.Wa;
      null != n3 && (n3.X = null), t5.vb = null, e2(null != t5);
    }
    function kt2() {
      var e3 = new on();
      return null == e3 ? null : (e3.a = 0, e3.xb = pi, nt2("Predictor", "VP8LPredictors"), nt2("Predictor", "VP8LPredictors_C"), nt2("PredictorAdd", "VP8LPredictorsAdd"), nt2("PredictorAdd", "VP8LPredictorsAdd_C"), Gn = G2, $n = J2, Qn = K2, tr = Z2, er = $2, nr = Q2, rr = tt2, t4.VP8LMapColor32b = Jn, t4.VP8LMapColor8b = Kn, e3);
    }
    function Ft2(t5, n3, r3, s3, u4) {
      var c4 = 1, f4 = [t5], p4 = [n3], g4 = s3.m, m4 = s3.s, v4 = null, b4 = 0;
      t: for (; ; ) {
        if (r3) for (; c4 && y3(g4, 1); ) {
          var w4 = f4, N4 = p4, x4 = s3, _3 = 1, P3 = x4.m, k3 = x4.gc[x4.ab], F3 = y3(P3, 2);
          if (x4.Oc & 1 << F3) c4 = 0;
          else {
            switch (x4.Oc |= 1 << F3, k3.hc = F3, k3.Ea = w4[0], k3.nc = N4[0], k3.K = [null], ++x4.ab, e2(4 >= x4.ab), F3) {
              case 0:
              case 1:
                k3.b = y3(P3, 3) + 2, _3 = Ft2(E2(k3.Ea, k3.b), E2(k3.nc, k3.b), 0, x4, k3.K), k3.K = k3.K[0];
                break;
              case 3:
                var I3, j3 = y3(P3, 8) + 1, C3 = 16 < j3 ? 0 : 4 < j3 ? 1 : 2 < j3 ? 2 : 3;
                if (w4[0] = E2(k3.Ea, C3), k3.b = C3, I3 = _3 = Ft2(j3, 1, 0, x4, k3.K)) {
                  var B3, M3 = j3, q3 = k3, D3 = 1 << (8 >> q3.b), T3 = a2(D3);
                  if (null == T3) I3 = 0;
                  else {
                    var z3 = q3.K[0], U3 = q3.w;
                    for (T3[0] = q3.K[0][0], B3 = 1; B3 < 1 * M3; ++B3) T3[B3] = R2(z3[U3 + B3], T3[B3 - 1]);
                    for (; B3 < 4 * D3; ++B3) T3[B3] = 0;
                    q3.K[0] = null, q3.K[0] = T3, I3 = 1;
                  }
                }
                _3 = I3;
                break;
              case 2:
                break;
              default:
                e2(0);
            }
            c4 = _3;
          }
        }
        if (f4 = f4[0], p4 = p4[0], c4 && y3(g4, 1) && !(c4 = 1 <= (b4 = y3(g4, 4)) && 11 >= b4)) {
          s3.a = 3;
          break t;
        }
        var H3;
        if (H3 = c4) e: {
          var W3, V3, G3, Y3 = s3, J3 = f4, X3 = p4, K3 = b4, Z3 = r3, $3 = Y3.m, Q3 = Y3.s, tt3 = [null], et3 = 1, nt3 = 0, rt3 = $r[K3];
          n: for (; ; ) {
            if (Z3 && y3($3, 1)) {
              var it3 = y3($3, 3) + 2, at3 = E2(J3, it3), ot3 = E2(X3, it3), st3 = at3 * ot3;
              if (!Ft2(at3, ot3, 0, Y3, tt3)) break n;
              for (tt3 = tt3[0], Q3.xc = it3, W3 = 0; W3 < st3; ++W3) {
                var ut3 = tt3[W3] >> 8 & 65535;
                tt3[W3] = ut3, ut3 >= et3 && (et3 = ut3 + 1);
              }
            }
            if ($3.h) break n;
            for (V3 = 0; 5 > V3; ++V3) {
              var ct3 = Jr[V3];
              !V3 && 0 < K3 && (ct3 += 1 << K3), nt3 < ct3 && (nt3 = ct3);
            }
            var lt3 = o2(et3 * rt3, h3), ht3 = et3, ft3 = o2(ht3, d3);
            if (null == ft3) var dt3 = null;
            else e2(65536 >= ht3), dt3 = ft3;
            var pt3 = a2(nt3);
            if (null == dt3 || null == pt3 || null == lt3) {
              Y3.a = 1;
              break n;
            }
            var gt3 = lt3;
            for (W3 = G3 = 0; W3 < et3; ++W3) {
              var mt3 = dt3[W3], vt3 = mt3.G, bt3 = mt3.H, wt3 = 0, Nt3 = 1, Lt3 = 0;
              for (V3 = 0; 5 > V3; ++V3) {
                ct3 = Jr[V3], vt3[V3] = gt3, bt3[V3] = G3, !V3 && 0 < K3 && (ct3 += 1 << K3);
                r: {
                  var xt3, At3 = ct3, St3 = Y3, kt3 = pt3, It3 = gt3, jt3 = G3, Ct3 = 0, Ot3 = St3.m, Bt3 = y3(Ot3, 1);
                  if (i2(kt3, 0, 0, At3), Bt3) {
                    var Mt3 = y3(Ot3, 1) + 1, qt3 = y3(Ot3, 1), Et3 = y3(Ot3, 0 == qt3 ? 1 : 8);
                    kt3[Et3] = 1, 2 == Mt3 && (kt3[Et3 = y3(Ot3, 8)] = 1);
                    var Rt3 = 1;
                  } else {
                    var Dt3 = a2(19), Tt3 = y3(Ot3, 4) + 4;
                    if (19 < Tt3) {
                      St3.a = 3;
                      var zt3 = 0;
                      break r;
                    }
                    for (xt3 = 0; xt3 < Tt3; ++xt3) Dt3[Kr[xt3]] = y3(Ot3, 3);
                    var Ut3 = void 0, Ht3 = void 0, Wt3 = St3, Vt3 = Dt3, Gt3 = At3, Yt3 = kt3, Jt3 = 0, Xt3 = Wt3.m, Kt3 = 8, Zt3 = o2(128, h3);
                    i: for (; l3(Zt3, 0, 7, Vt3, 19); ) {
                      if (y3(Xt3, 1)) {
                        var $t3 = 2 + 2 * y3(Xt3, 3);
                        if ((Ut3 = 2 + y3(Xt3, $t3)) > Gt3) break i;
                      } else Ut3 = Gt3;
                      for (Ht3 = 0; Ht3 < Gt3 && Ut3--; ) {
                        S2(Xt3);
                        var Qt3 = Zt3[0 + (127 & L3(Xt3))];
                        A3(Xt3, Xt3.u + Qt3.g);
                        var te3 = Qt3.value;
                        if (16 > te3) Yt3[Ht3++] = te3, 0 != te3 && (Kt3 = te3);
                        else {
                          var ee3 = 16 == te3, ne3 = te3 - 16, re3 = Yr[ne3], ie3 = y3(Xt3, Gr[ne3]) + re3;
                          if (Ht3 + ie3 > Gt3) break i;
                          for (var ae3 = ee3 ? Kt3 : 0; 0 < ie3--; ) Yt3[Ht3++] = ae3;
                        }
                      }
                      Jt3 = 1;
                      break i;
                    }
                    Jt3 || (Wt3.a = 3), Rt3 = Jt3;
                  }
                  (Rt3 = Rt3 && !Ot3.h) && (Ct3 = l3(It3, jt3, 8, kt3, At3)), Rt3 && 0 != Ct3 ? zt3 = Ct3 : (St3.a = 3, zt3 = 0);
                }
                if (0 == zt3) break n;
                if (Nt3 && 1 == Xr[V3] && (Nt3 = 0 == gt3[G3].g), wt3 += gt3[G3].g, G3 += zt3, 3 >= V3) {
                  var oe3, se3 = pt3[0];
                  for (oe3 = 1; oe3 < ct3; ++oe3) pt3[oe3] > se3 && (se3 = pt3[oe3]);
                  Lt3 += se3;
                }
              }
              if (mt3.nd = Nt3, mt3.Qb = 0, Nt3 && (mt3.qb = (vt3[3][bt3[3] + 0].value << 24 | vt3[1][bt3[1] + 0].value << 16 | vt3[2][bt3[2] + 0].value) >>> 0, 0 == wt3 && 256 > vt3[0][bt3[0] + 0].value && (mt3.Qb = 1, mt3.qb += vt3[0][bt3[0] + 0].value << 8)), mt3.jc = !mt3.Qb && 6 > Lt3, mt3.jc) {
                var ue3, ce3 = mt3;
                for (ue3 = 0; ue3 < Rn; ++ue3) {
                  var le3 = ue3, he3 = ce3.pd[le3], fe3 = ce3.G[0][ce3.H[0] + le3];
                  256 <= fe3.value ? (he3.g = fe3.g + 256, he3.value = fe3.value) : (he3.g = 0, he3.value = 0, le3 >>= yt2(fe3, 8, he3), le3 >>= yt2(ce3.G[1][ce3.H[1] + le3], 16, he3), le3 >>= yt2(ce3.G[2][ce3.H[2] + le3], 0, he3), yt2(ce3.G[3][ce3.H[3] + le3], 24, he3));
                }
              }
            }
            Q3.vc = tt3, Q3.Wb = et3, Q3.Ya = dt3, Q3.yc = lt3, H3 = 1;
            break e;
          }
          H3 = 0;
        }
        if (!(c4 = H3)) {
          s3.a = 3;
          break t;
        }
        if (0 < b4) {
          if (m4.ua = 1 << b4, !O2(m4.Wa, b4)) {
            s3.a = 1, c4 = 0;
            break t;
          }
        } else m4.ua = 0;
        var de3 = s3, pe3 = f4, ge3 = p4, me3 = de3.s, ve3 = me3.xc;
        if (de3.c = pe3, de3.i = ge3, me3.md = E2(pe3, ve3), me3.wc = 0 == ve3 ? -1 : (1 << ve3) - 1, r3) {
          s3.xb = di;
          break t;
        }
        if (null == (v4 = a2(f4 * p4))) {
          s3.a = 1, c4 = 0;
          break t;
        }
        c4 = (c4 = _t2(s3, v4, 0, f4, p4, p4, null)) && !g4.h;
        break t;
      }
      return c4 ? (null != u4 ? u4[0] = v4 : (e2(null == v4), e2(r3)), s3.$ = 0, r3 || Pt2(m4)) : Pt2(m4), c4;
    }
    function It2(t5, n3) {
      var r3 = t5.c * t5.i, i3 = r3 + n3 + 16 * n3;
      return e2(t5.c <= n3), t5.V = a2(i3), null == t5.V ? (t5.Ta = null, t5.Ua = 0, t5.a = 1, 0) : (t5.Ta = t5.V, t5.Ua = t5.Ba + r3 + n3, 1);
    }
    function jt2(t5, n3) {
      var r3 = t5.C, i3 = n3 - r3, a3 = t5.V, o3 = t5.Ba + t5.c * r3;
      for (e2(n3 <= t5.l.o); 0 < i3; ) {
        var s3 = 16 < i3 ? 16 : i3, u4 = t5.l.ma, c4 = t5.l.width, l4 = c4 * s3, h4 = u4.ca, f4 = u4.tb + c4 * r3, d4 = t5.Ta, p4 = t5.Ua;
        Nt2(t5, s3, a3, o3), Sr(d4, p4, h4, f4, l4), At2(u4, r3, r3 + s3, h4, f4, c4), i3 -= s3, a3 += s3 * t5.c, r3 += s3;
      }
      e2(r3 == n3), t5.C = t5.Ma = n3;
    }
    function Ct2() {
      this.ub = this.yd = this.td = this.Rb = 0;
    }
    function Ot2() {
      this.Kd = this.Ld = this.Ud = this.Td = this.i = this.c = 0;
    }
    function Bt2() {
      this.Fb = this.Bb = this.Cb = 0, this.Zb = a2(4), this.Lb = a2(4);
    }
    function Mt2() {
      this.Yb = function() {
        var t5 = [];
        return function t6(e3, n3, r3) {
          for (var i3 = r3[n3], a3 = 0; a3 < i3 && (e3.push(r3.length > n3 + 1 ? [] : 0), !(r3.length < n3 + 1)); a3++) t6(e3[a3], n3 + 1, r3);
        }(t5, 0, [3, 11]), t5;
      }();
    }
    function qt2() {
      this.jb = a2(3), this.Wc = s2([4, 8], Mt2), this.Xc = s2([4, 17], Mt2);
    }
    function Et2() {
      this.Pc = this.wb = this.Tb = this.zd = 0, this.vd = new a2(4), this.od = new a2(4);
    }
    function Rt2() {
      this.ld = this.La = this.dd = this.tc = 0;
    }
    function Dt2() {
      this.Na = this.la = 0;
    }
    function Tt2() {
      this.Sc = [0, 0], this.Eb = [0, 0], this.Qc = [0, 0], this.ia = this.lc = 0;
    }
    function zt2() {
      this.ad = a2(384), this.Za = 0, this.Ob = a2(16), this.$b = this.Ad = this.ia = this.Gc = this.Hc = this.Dd = 0;
    }
    function Ut2() {
      this.uc = this.M = this.Nb = 0, this.wa = Array(new Rt2()), this.Y = 0, this.ya = Array(new zt2()), this.aa = 0, this.l = new Gt2();
    }
    function Ht2() {
      this.y = a2(16), this.f = a2(8), this.ea = a2(8);
    }
    function Wt2() {
      this.cb = this.a = 0, this.sc = "", this.m = new w3(), this.Od = new Ct2(), this.Kc = new Ot2(), this.ed = new Et2(), this.Qa = new Bt2(), this.Ic = this.$c = this.Aa = 0, this.D = new Ut2(), this.Xb = this.Va = this.Hb = this.zb = this.yb = this.Ub = this.za = 0, this.Jc = o2(8, w3), this.ia = 0, this.pb = o2(4, Tt2), this.Pa = new qt2(), this.Bd = this.kc = 0, this.Ac = [], this.Bc = 0, this.zc = [0, 0, 0, 0], this.Gd = Array(new Ht2()), this.Hd = 0, this.rb = Array(new Dt2()), this.sb = 0, this.wa = Array(new Rt2()), this.Y = 0, this.oc = [], this.pc = 0, this.sa = [], this.ta = 0, this.qa = [], this.ra = 0, this.Ha = [], this.B = this.R = this.Ia = 0, this.Ec = [], this.M = this.ja = this.Vb = this.Fc = 0, this.ya = Array(new zt2()), this.L = this.aa = 0, this.gd = s2([4, 2], Rt2), this.ga = null, this.Fa = [], this.Cc = this.qc = this.P = 0, this.Gb = [], this.Uc = 0, this.mb = [], this.nb = 0, this.rc = [], this.Ga = this.Vc = 0;
    }
    function Vt2(t5, e3) {
      return 0 > t5 ? 0 : t5 > e3 ? e3 : t5;
    }
    function Gt2() {
      this.T = this.U = this.ka = this.height = this.width = 0, this.y = [], this.f = [], this.ea = [], this.Rc = this.fa = this.W = this.N = this.O = 0, this.ma = "void", this.put = "VP8IoPutHook", this.ac = "VP8IoSetupHook", this.bc = "VP8IoTeardownHook", this.ha = this.Kb = 0, this.data = [], this.hb = this.ib = this.da = this.o = this.j = this.va = this.v = this.Da = this.ob = this.w = 0, this.F = [], this.J = 0;
    }
    function Yt2() {
      var t5 = new Wt2();
      return null != t5 && (t5.a = 0, t5.sc = "OK", t5.cb = 0, t5.Xb = 0, ni || (ni = Zt2)), t5;
    }
    function Jt2(t5, e3, n3) {
      return 0 == t5.a && (t5.a = e3, t5.sc = n3, t5.cb = 0), 0;
    }
    function Xt2(t5, e3, n3) {
      return 3 <= n3 && 157 == t5[e3 + 0] && 1 == t5[e3 + 1] && 42 == t5[e3 + 2];
    }
    function Kt2(t5, n3) {
      if (null == t5) return 0;
      if (t5.a = 0, t5.sc = "OK", null == n3) return Jt2(t5, 2, "null VP8Io passed to VP8GetHeaders()");
      var r3 = n3.data, a3 = n3.w, o3 = n3.ha;
      if (4 > o3) return Jt2(t5, 7, "Truncated header.");
      var s3 = r3[a3 + 0] | r3[a3 + 1] << 8 | r3[a3 + 2] << 16, u4 = t5.Od;
      if (u4.Rb = !(1 & s3), u4.td = s3 >> 1 & 7, u4.yd = s3 >> 4 & 1, u4.ub = s3 >> 5, 3 < u4.td) return Jt2(t5, 3, "Incorrect keyframe parameters.");
      if (!u4.yd) return Jt2(t5, 4, "Frame not displayable.");
      a3 += 3, o3 -= 3;
      var c4 = t5.Kc;
      if (u4.Rb) {
        if (7 > o3) return Jt2(t5, 7, "cannot parse picture header");
        if (!Xt2(r3, a3, o3)) return Jt2(t5, 3, "Bad code word");
        c4.c = 16383 & (r3[a3 + 4] << 8 | r3[a3 + 3]), c4.Td = r3[a3 + 4] >> 6, c4.i = 16383 & (r3[a3 + 6] << 8 | r3[a3 + 5]), c4.Ud = r3[a3 + 6] >> 6, a3 += 7, o3 -= 7, t5.za = c4.c + 15 >> 4, t5.Ub = c4.i + 15 >> 4, n3.width = c4.c, n3.height = c4.i, n3.Da = 0, n3.j = 0, n3.v = 0, n3.va = n3.width, n3.o = n3.height, n3.da = 0, n3.ib = n3.width, n3.hb = n3.height, n3.U = n3.width, n3.T = n3.height, i2((s3 = t5.Pa).jb, 0, 255, s3.jb.length), e2(null != (s3 = t5.Qa)), s3.Cb = 0, s3.Bb = 0, s3.Fb = 1, i2(s3.Zb, 0, 0, s3.Zb.length), i2(s3.Lb, 0, 0, s3.Lb);
      }
      if (u4.ub > o3) return Jt2(t5, 7, "bad partition length");
      p3(s3 = t5.m, r3, a3, u4.ub), a3 += u4.ub, o3 -= u4.ub, u4.Rb && (c4.Ld = P2(s3), c4.Kd = P2(s3)), c4 = t5.Qa;
      var l4, h4 = t5.Pa;
      if (e2(null != s3), e2(null != c4), c4.Cb = P2(s3), c4.Cb) {
        if (c4.Bb = P2(s3), P2(s3)) {
          for (c4.Fb = P2(s3), l4 = 0; 4 > l4; ++l4) c4.Zb[l4] = P2(s3) ? m3(s3, 7) : 0;
          for (l4 = 0; 4 > l4; ++l4) c4.Lb[l4] = P2(s3) ? m3(s3, 6) : 0;
        }
        if (c4.Bb) for (l4 = 0; 3 > l4; ++l4) h4.jb[l4] = P2(s3) ? g3(s3, 8) : 255;
      } else c4.Bb = 0;
      if (s3.Ka) return Jt2(t5, 3, "cannot parse segment header");
      if ((c4 = t5.ed).zd = P2(s3), c4.Tb = g3(s3, 6), c4.wb = g3(s3, 3), c4.Pc = P2(s3), c4.Pc && P2(s3)) {
        for (h4 = 0; 4 > h4; ++h4) P2(s3) && (c4.vd[h4] = m3(s3, 6));
        for (h4 = 0; 4 > h4; ++h4) P2(s3) && (c4.od[h4] = m3(s3, 6));
      }
      if (t5.L = 0 == c4.Tb ? 0 : c4.zd ? 1 : 2, s3.Ka) return Jt2(t5, 3, "cannot parse filter header");
      var f4 = o3;
      if (o3 = l4 = a3, a3 = l4 + f4, c4 = f4, t5.Xb = (1 << g3(t5.m, 2)) - 1, f4 < 3 * (h4 = t5.Xb)) r3 = 7;
      else {
        for (l4 += 3 * h4, c4 -= 3 * h4, f4 = 0; f4 < h4; ++f4) {
          var d4 = r3[o3 + 0] | r3[o3 + 1] << 8 | r3[o3 + 2] << 16;
          d4 > c4 && (d4 = c4), p3(t5.Jc[+f4], r3, l4, d4), l4 += d4, c4 -= d4, o3 += 3;
        }
        p3(t5.Jc[+h4], r3, l4, c4), r3 = l4 < a3 ? 0 : 5;
      }
      if (0 != r3) return Jt2(t5, r3, "cannot parse partitions");
      for (r3 = g3(l4 = t5.m, 7), o3 = P2(l4) ? m3(l4, 4) : 0, a3 = P2(l4) ? m3(l4, 4) : 0, c4 = P2(l4) ? m3(l4, 4) : 0, h4 = P2(l4) ? m3(l4, 4) : 0, l4 = P2(l4) ? m3(l4, 4) : 0, f4 = t5.Qa, d4 = 0; 4 > d4; ++d4) {
        if (f4.Cb) {
          var v4 = f4.Zb[d4];
          f4.Fb || (v4 += r3);
        } else {
          if (0 < d4) {
            t5.pb[d4] = t5.pb[0];
            continue;
          }
          v4 = r3;
        }
        var b4 = t5.pb[d4];
        b4.Sc[0] = ti[Vt2(v4 + o3, 127)], b4.Sc[1] = ei[Vt2(v4 + 0, 127)], b4.Eb[0] = 2 * ti[Vt2(v4 + a3, 127)], b4.Eb[1] = 101581 * ei[Vt2(v4 + c4, 127)] >> 16, 8 > b4.Eb[1] && (b4.Eb[1] = 8), b4.Qc[0] = ti[Vt2(v4 + h4, 117)], b4.Qc[1] = ei[Vt2(v4 + l4, 127)], b4.lc = v4 + l4;
      }
      if (!u4.Rb) return Jt2(t5, 4, "Not a key frame.");
      for (P2(s3), u4 = t5.Pa, r3 = 0; 4 > r3; ++r3) {
        for (o3 = 0; 8 > o3; ++o3) for (a3 = 0; 3 > a3; ++a3) for (c4 = 0; 11 > c4; ++c4) h4 = k2(s3, ui[r3][o3][a3][c4]) ? g3(s3, 8) : oi[r3][o3][a3][c4], u4.Wc[r3][o3].Yb[a3][c4] = h4;
        for (o3 = 0; 17 > o3; ++o3) u4.Xc[r3][o3] = u4.Wc[r3][ci[o3]];
      }
      return t5.kc = P2(s3), t5.kc && (t5.Bd = g3(s3, 8)), t5.cb = 1;
    }
    function Zt2(t5, e3, n3, r3, i3, a3, o3) {
      var s3 = e3[i3].Yb[n3];
      for (n3 = 0; 16 > i3; ++i3) {
        if (!k2(t5, s3[n3 + 0])) return i3;
        for (; !k2(t5, s3[n3 + 1]); ) if (s3 = e3[++i3].Yb[0], n3 = 0, 16 == i3) return 16;
        var u4 = e3[i3 + 1].Yb;
        if (k2(t5, s3[n3 + 2])) {
          var c4 = t5, l4 = 0;
          if (k2(c4, (f4 = s3)[(h4 = n3) + 3])) if (k2(c4, f4[h4 + 6])) {
            for (s3 = 0, h4 = 2 * (l4 = k2(c4, f4[h4 + 8])) + (f4 = k2(c4, f4[h4 + 9 + l4])), l4 = 0, f4 = ri[h4]; f4[s3]; ++s3) l4 += l4 + k2(c4, f4[s3]);
            l4 += 3 + (8 << h4);
          } else k2(c4, f4[h4 + 7]) ? (l4 = 7 + 2 * k2(c4, 165), l4 += k2(c4, 145)) : l4 = 5 + k2(c4, 159);
          else l4 = k2(c4, f4[h4 + 4]) ? 3 + k2(c4, f4[h4 + 5]) : 2;
          s3 = u4[2];
        } else l4 = 1, s3 = u4[1];
        u4 = o3 + ii[i3], 0 > (c4 = t5).b && _2(c4);
        var h4, f4 = c4.b, d4 = (h4 = c4.Ca >> 1) - (c4.I >> f4) >> 31;
        --c4.b, c4.Ca += d4, c4.Ca |= 1, c4.I -= (h4 + 1 & d4) << f4, a3[u4] = ((l4 ^ d4) - d4) * r3[(0 < i3) + 0];
      }
      return 16;
    }
    function $t2(t5) {
      var e3 = t5.rb[t5.sb - 1];
      e3.la = 0, e3.Na = 0, i2(t5.zc, 0, 0, t5.zc.length), t5.ja = 0;
    }
    function Qt2(t5, e3, n3, r3, i3) {
      i3 = t5[e3 + n3 + 32 * r3] + (i3 >> 3), t5[e3 + n3 + 32 * r3] = -256 & i3 ? 0 > i3 ? 0 : 255 : i3;
    }
    function te2(t5, e3, n3, r3, i3, a3) {
      Qt2(t5, e3, 0, n3, r3 + i3), Qt2(t5, e3, 1, n3, r3 + a3), Qt2(t5, e3, 2, n3, r3 - a3), Qt2(t5, e3, 3, n3, r3 - i3);
    }
    function ee2(t5) {
      return (20091 * t5 >> 16) + t5;
    }
    function ne2(t5, e3, n3, r3) {
      var i3, o3 = 0, s3 = a2(16);
      for (i3 = 0; 4 > i3; ++i3) {
        var u4 = t5[e3 + 0] + t5[e3 + 8], c4 = t5[e3 + 0] - t5[e3 + 8], l4 = (35468 * t5[e3 + 4] >> 16) - ee2(t5[e3 + 12]), h4 = ee2(t5[e3 + 4]) + (35468 * t5[e3 + 12] >> 16);
        s3[o3 + 0] = u4 + h4, s3[o3 + 1] = c4 + l4, s3[o3 + 2] = c4 - l4, s3[o3 + 3] = u4 - h4, o3 += 4, e3++;
      }
      for (i3 = o3 = 0; 4 > i3; ++i3) u4 = (t5 = s3[o3 + 0] + 4) + s3[o3 + 8], c4 = t5 - s3[o3 + 8], l4 = (35468 * s3[o3 + 4] >> 16) - ee2(s3[o3 + 12]), Qt2(n3, r3, 0, 0, u4 + (h4 = ee2(s3[o3 + 4]) + (35468 * s3[o3 + 12] >> 16))), Qt2(n3, r3, 1, 0, c4 + l4), Qt2(n3, r3, 2, 0, c4 - l4), Qt2(n3, r3, 3, 0, u4 - h4), o3++, r3 += 32;
    }
    function re2(t5, e3, n3, r3) {
      var i3 = t5[e3 + 0] + 4, a3 = 35468 * t5[e3 + 4] >> 16, o3 = ee2(t5[e3 + 4]), s3 = 35468 * t5[e3 + 1] >> 16;
      te2(n3, r3, 0, i3 + o3, t5 = ee2(t5[e3 + 1]), s3), te2(n3, r3, 1, i3 + a3, t5, s3), te2(n3, r3, 2, i3 - a3, t5, s3), te2(n3, r3, 3, i3 - o3, t5, s3);
    }
    function ie2(t5, e3, n3, r3, i3) {
      ne2(t5, e3, n3, r3), i3 && ne2(t5, e3 + 16, n3, r3 + 4);
    }
    function ae2(t5, e3, n3, r3) {
      ar(t5, e3 + 0, n3, r3, 1), ar(t5, e3 + 32, n3, r3 + 128, 1);
    }
    function oe2(t5, e3, n3, r3) {
      var i3;
      for (t5 = t5[e3 + 0] + 4, i3 = 0; 4 > i3; ++i3) for (e3 = 0; 4 > e3; ++e3) Qt2(n3, r3, e3, i3, t5);
    }
    function se2(t5, e3, n3, r3) {
      t5[e3 + 0] && ur(t5, e3 + 0, n3, r3), t5[e3 + 16] && ur(t5, e3 + 16, n3, r3 + 4), t5[e3 + 32] && ur(t5, e3 + 32, n3, r3 + 128), t5[e3 + 48] && ur(t5, e3 + 48, n3, r3 + 128 + 4);
    }
    function ue2(t5, e3, n3, r3) {
      var i3, o3 = a2(16);
      for (i3 = 0; 4 > i3; ++i3) {
        var s3 = t5[e3 + 0 + i3] + t5[e3 + 12 + i3], u4 = t5[e3 + 4 + i3] + t5[e3 + 8 + i3], c4 = t5[e3 + 4 + i3] - t5[e3 + 8 + i3], l4 = t5[e3 + 0 + i3] - t5[e3 + 12 + i3];
        o3[0 + i3] = s3 + u4, o3[8 + i3] = s3 - u4, o3[4 + i3] = l4 + c4, o3[12 + i3] = l4 - c4;
      }
      for (i3 = 0; 4 > i3; ++i3) s3 = (t5 = o3[0 + 4 * i3] + 3) + o3[3 + 4 * i3], u4 = o3[1 + 4 * i3] + o3[2 + 4 * i3], c4 = o3[1 + 4 * i3] - o3[2 + 4 * i3], l4 = t5 - o3[3 + 4 * i3], n3[r3 + 0] = s3 + u4 >> 3, n3[r3 + 16] = l4 + c4 >> 3, n3[r3 + 32] = s3 - u4 >> 3, n3[r3 + 48] = l4 - c4 >> 3, r3 += 64;
    }
    function ce2(t5, e3, n3) {
      var r3, i3 = e3 - 32, a3 = Or, o3 = 255 - t5[i3 - 1];
      for (r3 = 0; r3 < n3; ++r3) {
        var s3, u4 = a3, c4 = o3 + t5[e3 - 1];
        for (s3 = 0; s3 < n3; ++s3) t5[e3 + s3] = u4[c4 + t5[i3 + s3]];
        e3 += 32;
      }
    }
    function le2(t5, e3) {
      ce2(t5, e3, 4);
    }
    function he2(t5, e3) {
      ce2(t5, e3, 8);
    }
    function fe2(t5, e3) {
      ce2(t5, e3, 16);
    }
    function de2(t5, e3) {
      var n3;
      for (n3 = 0; 16 > n3; ++n3) r2(t5, e3 + 32 * n3, t5, e3 - 32, 16);
    }
    function pe2(t5, e3) {
      var n3;
      for (n3 = 16; 0 < n3; --n3) i2(t5, e3, t5[e3 - 1], 16), e3 += 32;
    }
    function ge2(t5, e3, n3) {
      var r3;
      for (r3 = 0; 16 > r3; ++r3) i2(e3, n3 + 32 * r3, t5, 16);
    }
    function me2(t5, e3) {
      var n3, r3 = 16;
      for (n3 = 0; 16 > n3; ++n3) r3 += t5[e3 - 1 + 32 * n3] + t5[e3 + n3 - 32];
      ge2(r3 >> 5, t5, e3);
    }
    function ve2(t5, e3) {
      var n3, r3 = 8;
      for (n3 = 0; 16 > n3; ++n3) r3 += t5[e3 - 1 + 32 * n3];
      ge2(r3 >> 4, t5, e3);
    }
    function be2(t5, e3) {
      var n3, r3 = 8;
      for (n3 = 0; 16 > n3; ++n3) r3 += t5[e3 + n3 - 32];
      ge2(r3 >> 4, t5, e3);
    }
    function ye2(t5, e3) {
      ge2(128, t5, e3);
    }
    function we2(t5, e3, n3) {
      return t5 + 2 * e3 + n3 + 2 >> 2;
    }
    function Ne2(t5, e3) {
      var n3, i3 = e3 - 32;
      for (i3 = new Uint8Array([we2(t5[i3 - 1], t5[i3 + 0], t5[i3 + 1]), we2(t5[i3 + 0], t5[i3 + 1], t5[i3 + 2]), we2(t5[i3 + 1], t5[i3 + 2], t5[i3 + 3]), we2(t5[i3 + 2], t5[i3 + 3], t5[i3 + 4])]), n3 = 0; 4 > n3; ++n3) r2(t5, e3 + 32 * n3, i3, 0, i3.length);
    }
    function Le2(t5, e3) {
      var n3 = t5[e3 - 1], r3 = t5[e3 - 1 + 32], i3 = t5[e3 - 1 + 64], a3 = t5[e3 - 1 + 96];
      F2(t5, e3 + 0, 16843009 * we2(t5[e3 - 1 - 32], n3, r3)), F2(t5, e3 + 32, 16843009 * we2(n3, r3, i3)), F2(t5, e3 + 64, 16843009 * we2(r3, i3, a3)), F2(t5, e3 + 96, 16843009 * we2(i3, a3, a3));
    }
    function xe2(t5, e3) {
      var n3, r3 = 4;
      for (n3 = 0; 4 > n3; ++n3) r3 += t5[e3 + n3 - 32] + t5[e3 - 1 + 32 * n3];
      for (r3 >>= 3, n3 = 0; 4 > n3; ++n3) i2(t5, e3 + 32 * n3, r3, 4);
    }
    function Ae2(t5, e3) {
      var n3 = t5[e3 - 1 + 0], r3 = t5[e3 - 1 + 32], i3 = t5[e3 - 1 + 64], a3 = t5[e3 - 1 - 32], o3 = t5[e3 + 0 - 32], s3 = t5[e3 + 1 - 32], u4 = t5[e3 + 2 - 32], c4 = t5[e3 + 3 - 32];
      t5[e3 + 0 + 96] = we2(r3, i3, t5[e3 - 1 + 96]), t5[e3 + 1 + 96] = t5[e3 + 0 + 64] = we2(n3, r3, i3), t5[e3 + 2 + 96] = t5[e3 + 1 + 64] = t5[e3 + 0 + 32] = we2(a3, n3, r3), t5[e3 + 3 + 96] = t5[e3 + 2 + 64] = t5[e3 + 1 + 32] = t5[e3 + 0 + 0] = we2(o3, a3, n3), t5[e3 + 3 + 64] = t5[e3 + 2 + 32] = t5[e3 + 1 + 0] = we2(s3, o3, a3), t5[e3 + 3 + 32] = t5[e3 + 2 + 0] = we2(u4, s3, o3), t5[e3 + 3 + 0] = we2(c4, u4, s3);
    }
    function Se2(t5, e3) {
      var n3 = t5[e3 + 1 - 32], r3 = t5[e3 + 2 - 32], i3 = t5[e3 + 3 - 32], a3 = t5[e3 + 4 - 32], o3 = t5[e3 + 5 - 32], s3 = t5[e3 + 6 - 32], u4 = t5[e3 + 7 - 32];
      t5[e3 + 0 + 0] = we2(t5[e3 + 0 - 32], n3, r3), t5[e3 + 1 + 0] = t5[e3 + 0 + 32] = we2(n3, r3, i3), t5[e3 + 2 + 0] = t5[e3 + 1 + 32] = t5[e3 + 0 + 64] = we2(r3, i3, a3), t5[e3 + 3 + 0] = t5[e3 + 2 + 32] = t5[e3 + 1 + 64] = t5[e3 + 0 + 96] = we2(i3, a3, o3), t5[e3 + 3 + 32] = t5[e3 + 2 + 64] = t5[e3 + 1 + 96] = we2(a3, o3, s3), t5[e3 + 3 + 64] = t5[e3 + 2 + 96] = we2(o3, s3, u4), t5[e3 + 3 + 96] = we2(s3, u4, u4);
    }
    function _e2(t5, e3) {
      var n3 = t5[e3 - 1 + 0], r3 = t5[e3 - 1 + 32], i3 = t5[e3 - 1 + 64], a3 = t5[e3 - 1 - 32], o3 = t5[e3 + 0 - 32], s3 = t5[e3 + 1 - 32], u4 = t5[e3 + 2 - 32], c4 = t5[e3 + 3 - 32];
      t5[e3 + 0 + 0] = t5[e3 + 1 + 64] = a3 + o3 + 1 >> 1, t5[e3 + 1 + 0] = t5[e3 + 2 + 64] = o3 + s3 + 1 >> 1, t5[e3 + 2 + 0] = t5[e3 + 3 + 64] = s3 + u4 + 1 >> 1, t5[e3 + 3 + 0] = u4 + c4 + 1 >> 1, t5[e3 + 0 + 96] = we2(i3, r3, n3), t5[e3 + 0 + 64] = we2(r3, n3, a3), t5[e3 + 0 + 32] = t5[e3 + 1 + 96] = we2(n3, a3, o3), t5[e3 + 1 + 32] = t5[e3 + 2 + 96] = we2(a3, o3, s3), t5[e3 + 2 + 32] = t5[e3 + 3 + 96] = we2(o3, s3, u4), t5[e3 + 3 + 32] = we2(s3, u4, c4);
    }
    function Pe2(t5, e3) {
      var n3 = t5[e3 + 0 - 32], r3 = t5[e3 + 1 - 32], i3 = t5[e3 + 2 - 32], a3 = t5[e3 + 3 - 32], o3 = t5[e3 + 4 - 32], s3 = t5[e3 + 5 - 32], u4 = t5[e3 + 6 - 32], c4 = t5[e3 + 7 - 32];
      t5[e3 + 0 + 0] = n3 + r3 + 1 >> 1, t5[e3 + 1 + 0] = t5[e3 + 0 + 64] = r3 + i3 + 1 >> 1, t5[e3 + 2 + 0] = t5[e3 + 1 + 64] = i3 + a3 + 1 >> 1, t5[e3 + 3 + 0] = t5[e3 + 2 + 64] = a3 + o3 + 1 >> 1, t5[e3 + 0 + 32] = we2(n3, r3, i3), t5[e3 + 1 + 32] = t5[e3 + 0 + 96] = we2(r3, i3, a3), t5[e3 + 2 + 32] = t5[e3 + 1 + 96] = we2(i3, a3, o3), t5[e3 + 3 + 32] = t5[e3 + 2 + 96] = we2(a3, o3, s3), t5[e3 + 3 + 64] = we2(o3, s3, u4), t5[e3 + 3 + 96] = we2(s3, u4, c4);
    }
    function ke2(t5, e3) {
      var n3 = t5[e3 - 1 + 0], r3 = t5[e3 - 1 + 32], i3 = t5[e3 - 1 + 64], a3 = t5[e3 - 1 + 96];
      t5[e3 + 0 + 0] = n3 + r3 + 1 >> 1, t5[e3 + 2 + 0] = t5[e3 + 0 + 32] = r3 + i3 + 1 >> 1, t5[e3 + 2 + 32] = t5[e3 + 0 + 64] = i3 + a3 + 1 >> 1, t5[e3 + 1 + 0] = we2(n3, r3, i3), t5[e3 + 3 + 0] = t5[e3 + 1 + 32] = we2(r3, i3, a3), t5[e3 + 3 + 32] = t5[e3 + 1 + 64] = we2(i3, a3, a3), t5[e3 + 3 + 64] = t5[e3 + 2 + 64] = t5[e3 + 0 + 96] = t5[e3 + 1 + 96] = t5[e3 + 2 + 96] = t5[e3 + 3 + 96] = a3;
    }
    function Fe2(t5, e3) {
      var n3 = t5[e3 - 1 + 0], r3 = t5[e3 - 1 + 32], i3 = t5[e3 - 1 + 64], a3 = t5[e3 - 1 + 96], o3 = t5[e3 - 1 - 32], s3 = t5[e3 + 0 - 32], u4 = t5[e3 + 1 - 32], c4 = t5[e3 + 2 - 32];
      t5[e3 + 0 + 0] = t5[e3 + 2 + 32] = n3 + o3 + 1 >> 1, t5[e3 + 0 + 32] = t5[e3 + 2 + 64] = r3 + n3 + 1 >> 1, t5[e3 + 0 + 64] = t5[e3 + 2 + 96] = i3 + r3 + 1 >> 1, t5[e3 + 0 + 96] = a3 + i3 + 1 >> 1, t5[e3 + 3 + 0] = we2(s3, u4, c4), t5[e3 + 2 + 0] = we2(o3, s3, u4), t5[e3 + 1 + 0] = t5[e3 + 3 + 32] = we2(n3, o3, s3), t5[e3 + 1 + 32] = t5[e3 + 3 + 64] = we2(r3, n3, o3), t5[e3 + 1 + 64] = t5[e3 + 3 + 96] = we2(i3, r3, n3), t5[e3 + 1 + 96] = we2(a3, i3, r3);
    }
    function Ie2(t5, e3) {
      var n3;
      for (n3 = 0; 8 > n3; ++n3) r2(t5, e3 + 32 * n3, t5, e3 - 32, 8);
    }
    function je2(t5, e3) {
      var n3;
      for (n3 = 0; 8 > n3; ++n3) i2(t5, e3, t5[e3 - 1], 8), e3 += 32;
    }
    function Ce(t5, e3, n3) {
      var r3;
      for (r3 = 0; 8 > r3; ++r3) i2(e3, n3 + 32 * r3, t5, 8);
    }
    function Oe(t5, e3) {
      var n3, r3 = 8;
      for (n3 = 0; 8 > n3; ++n3) r3 += t5[e3 + n3 - 32] + t5[e3 - 1 + 32 * n3];
      Ce(r3 >> 4, t5, e3);
    }
    function Be(t5, e3) {
      var n3, r3 = 4;
      for (n3 = 0; 8 > n3; ++n3) r3 += t5[e3 + n3 - 32];
      Ce(r3 >> 3, t5, e3);
    }
    function Me(t5, e3) {
      var n3, r3 = 4;
      for (n3 = 0; 8 > n3; ++n3) r3 += t5[e3 - 1 + 32 * n3];
      Ce(r3 >> 3, t5, e3);
    }
    function qe(t5, e3) {
      Ce(128, t5, e3);
    }
    function Ee(t5, e3, n3) {
      var r3 = t5[e3 - n3], i3 = t5[e3 + 0], a3 = 3 * (i3 - r3) + jr[1020 + t5[e3 - 2 * n3] - t5[e3 + n3]], o3 = Cr[112 + (a3 + 4 >> 3)];
      t5[e3 - n3] = Or[255 + r3 + Cr[112 + (a3 + 3 >> 3)]], t5[e3 + 0] = Or[255 + i3 - o3];
    }
    function Re(t5, e3, n3, r3) {
      var i3 = t5[e3 + 0], a3 = t5[e3 + n3];
      return Br[255 + t5[e3 - 2 * n3] - t5[e3 - n3]] > r3 || Br[255 + a3 - i3] > r3;
    }
    function De(t5, e3, n3, r3) {
      return 4 * Br[255 + t5[e3 - n3] - t5[e3 + 0]] + Br[255 + t5[e3 - 2 * n3] - t5[e3 + n3]] <= r3;
    }
    function Te(t5, e3, n3, r3, i3) {
      var a3 = t5[e3 - 3 * n3], o3 = t5[e3 - 2 * n3], s3 = t5[e3 - n3], u4 = t5[e3 + 0], c4 = t5[e3 + n3], l4 = t5[e3 + 2 * n3], h4 = t5[e3 + 3 * n3];
      return 4 * Br[255 + s3 - u4] + Br[255 + o3 - c4] > r3 ? 0 : Br[255 + t5[e3 - 4 * n3] - a3] <= i3 && Br[255 + a3 - o3] <= i3 && Br[255 + o3 - s3] <= i3 && Br[255 + h4 - l4] <= i3 && Br[255 + l4 - c4] <= i3 && Br[255 + c4 - u4] <= i3;
    }
    function ze(t5, e3, n3, r3) {
      var i3 = 2 * r3 + 1;
      for (r3 = 0; 16 > r3; ++r3) De(t5, e3 + r3, n3, i3) && Ee(t5, e3 + r3, n3);
    }
    function Ue(t5, e3, n3, r3) {
      var i3 = 2 * r3 + 1;
      for (r3 = 0; 16 > r3; ++r3) De(t5, e3 + r3 * n3, 1, i3) && Ee(t5, e3 + r3 * n3, 1);
    }
    function He(t5, e3, n3, r3) {
      var i3;
      for (i3 = 3; 0 < i3; --i3) ze(t5, e3 += 4 * n3, n3, r3);
    }
    function We(t5, e3, n3, r3) {
      var i3;
      for (i3 = 3; 0 < i3; --i3) Ue(t5, e3 += 4, n3, r3);
    }
    function Ve(t5, e3, n3, r3, i3, a3, o3, s3) {
      for (a3 = 2 * a3 + 1; 0 < i3--; ) {
        if (Te(t5, e3, n3, a3, o3)) if (Re(t5, e3, n3, s3)) Ee(t5, e3, n3);
        else {
          var u4 = t5, c4 = e3, l4 = n3, h4 = u4[c4 - 2 * l4], f4 = u4[c4 - l4], d4 = u4[c4 + 0], p4 = u4[c4 + l4], g4 = u4[c4 + 2 * l4], m4 = 27 * (b4 = jr[1020 + 3 * (d4 - f4) + jr[1020 + h4 - p4]]) + 63 >> 7, v4 = 18 * b4 + 63 >> 7, b4 = 9 * b4 + 63 >> 7;
          u4[c4 - 3 * l4] = Or[255 + u4[c4 - 3 * l4] + b4], u4[c4 - 2 * l4] = Or[255 + h4 + v4], u4[c4 - l4] = Or[255 + f4 + m4], u4[c4 + 0] = Or[255 + d4 - m4], u4[c4 + l4] = Or[255 + p4 - v4], u4[c4 + 2 * l4] = Or[255 + g4 - b4];
        }
        e3 += r3;
      }
    }
    function Ge(t5, e3, n3, r3, i3, a3, o3, s3) {
      for (a3 = 2 * a3 + 1; 0 < i3--; ) {
        if (Te(t5, e3, n3, a3, o3)) if (Re(t5, e3, n3, s3)) Ee(t5, e3, n3);
        else {
          var u4 = t5, c4 = e3, l4 = n3, h4 = u4[c4 - l4], f4 = u4[c4 + 0], d4 = u4[c4 + l4], p4 = Cr[112 + (4 + (g4 = 3 * (f4 - h4)) >> 3)], g4 = Cr[112 + (g4 + 3 >> 3)], m4 = p4 + 1 >> 1;
          u4[c4 - 2 * l4] = Or[255 + u4[c4 - 2 * l4] + m4], u4[c4 - l4] = Or[255 + h4 + g4], u4[c4 + 0] = Or[255 + f4 - p4], u4[c4 + l4] = Or[255 + d4 - m4];
        }
        e3 += r3;
      }
    }
    function Ye(t5, e3, n3, r3, i3, a3) {
      Ve(t5, e3, n3, 1, 16, r3, i3, a3);
    }
    function Je(t5, e3, n3, r3, i3, a3) {
      Ve(t5, e3, 1, n3, 16, r3, i3, a3);
    }
    function Xe(t5, e3, n3, r3, i3, a3) {
      var o3;
      for (o3 = 3; 0 < o3; --o3) Ge(t5, e3 += 4 * n3, n3, 1, 16, r3, i3, a3);
    }
    function Ke(t5, e3, n3, r3, i3, a3) {
      var o3;
      for (o3 = 3; 0 < o3; --o3) Ge(t5, e3 += 4, 1, n3, 16, r3, i3, a3);
    }
    function Ze(t5, e3, n3, r3, i3, a3, o3, s3) {
      Ve(t5, e3, i3, 1, 8, a3, o3, s3), Ve(n3, r3, i3, 1, 8, a3, o3, s3);
    }
    function $e(t5, e3, n3, r3, i3, a3, o3, s3) {
      Ve(t5, e3, 1, i3, 8, a3, o3, s3), Ve(n3, r3, 1, i3, 8, a3, o3, s3);
    }
    function Qe(t5, e3, n3, r3, i3, a3, o3, s3) {
      Ge(t5, e3 + 4 * i3, i3, 1, 8, a3, o3, s3), Ge(n3, r3 + 4 * i3, i3, 1, 8, a3, o3, s3);
    }
    function tn(t5, e3, n3, r3, i3, a3, o3, s3) {
      Ge(t5, e3 + 4, 1, i3, 8, a3, o3, s3), Ge(n3, r3 + 4, 1, i3, 8, a3, o3, s3);
    }
    function en() {
      this.ba = new ot2(), this.ec = [], this.cc = [], this.Mc = [], this.Dc = this.Nc = this.dc = this.fc = 0, this.Oa = new ut2(), this.memory = 0, this.Ib = "OutputFunc", this.Jb = "OutputAlphaFunc", this.Nd = "OutputRowFunc";
    }
    function nn() {
      this.data = [], this.offset = this.kd = this.ha = this.w = 0, this.na = [], this.xa = this.gb = this.Ja = this.Sa = this.P = 0;
    }
    function rn() {
      this.nc = this.Ea = this.b = this.hc = 0, this.K = [], this.w = 0;
    }
    function an() {
      this.ua = 0, this.Wa = new M2(), this.vb = new M2(), this.md = this.xc = this.wc = 0, this.vc = [], this.Wb = 0, this.Ya = new d3(), this.yc = new h3();
    }
    function on() {
      this.xb = this.a = 0, this.l = new Gt2(), this.ca = new ot2(), this.V = [], this.Ba = 0, this.Ta = [], this.Ua = 0, this.m = new N3(), this.Pb = 0, this.wd = new N3(), this.Ma = this.$ = this.C = this.i = this.c = this.xd = 0, this.s = new an(), this.ab = 0, this.gc = o2(4, rn), this.Oc = 0;
    }
    function sn() {
      this.Lc = this.Z = this.$a = this.i = this.c = 0, this.l = new Gt2(), this.ic = 0, this.ca = [], this.tb = 0, this.qd = null, this.rd = 0;
    }
    function un(t5, e3, n3, r3, i3, a3, o3) {
      for (t5 = null == t5 ? 0 : t5[e3 + 0], e3 = 0; e3 < o3; ++e3) i3[a3 + e3] = t5 + n3[r3 + e3] & 255, t5 = i3[a3 + e3];
    }
    function cn(t5, e3, n3, r3, i3, a3, o3) {
      var s3;
      if (null == t5) un(null, null, n3, r3, i3, a3, o3);
      else for (s3 = 0; s3 < o3; ++s3) i3[a3 + s3] = t5[e3 + s3] + n3[r3 + s3] & 255;
    }
    function ln(t5, e3, n3, r3, i3, a3, o3) {
      if (null == t5) un(null, null, n3, r3, i3, a3, o3);
      else {
        var s3, u4 = t5[e3 + 0], c4 = u4, l4 = u4;
        for (s3 = 0; s3 < o3; ++s3) c4 = l4 + (u4 = t5[e3 + s3]) - c4, l4 = n3[r3 + s3] + (-256 & c4 ? 0 > c4 ? 0 : 255 : c4) & 255, c4 = u4, i3[a3 + s3] = l4;
      }
    }
    function hn(t5, n3, i3, o3) {
      var s3 = n3.width, u4 = n3.o;
      if (e2(null != t5 && null != n3), 0 > i3 || 0 >= o3 || i3 + o3 > u4) return null;
      if (!t5.Cc) {
        if (null == t5.ga) {
          var c4;
          if (t5.ga = new sn(), (c4 = null == t5.ga) || (c4 = n3.width * n3.o, e2(0 == t5.Gb.length), t5.Gb = a2(c4), t5.Uc = 0, null == t5.Gb ? c4 = 0 : (t5.mb = t5.Gb, t5.nb = t5.Uc, t5.rc = null, c4 = 1), c4 = !c4), !c4) {
            c4 = t5.ga;
            var l4 = t5.Fa, h4 = t5.P, f4 = t5.qc, d4 = t5.mb, p4 = t5.nb, g4 = h4 + 1, m4 = f4 - 1, b4 = c4.l;
            if (e2(null != l4 && null != d4 && null != n3), gi[0] = null, gi[1] = un, gi[2] = cn, gi[3] = ln, c4.ca = d4, c4.tb = p4, c4.c = n3.width, c4.i = n3.height, e2(0 < c4.c && 0 < c4.i), 1 >= f4) n3 = 0;
            else if (c4.$a = 3 & l4[h4 + 0], c4.Z = l4[h4 + 0] >> 2 & 3, c4.Lc = l4[h4 + 0] >> 4 & 3, h4 = l4[h4 + 0] >> 6 & 3, 0 > c4.$a || 1 < c4.$a || 4 <= c4.Z || 1 < c4.Lc || h4) n3 = 0;
            else if (b4.put = dt2, b4.ac = ft2, b4.bc = pt2, b4.ma = c4, b4.width = n3.width, b4.height = n3.height, b4.Da = n3.Da, b4.v = n3.v, b4.va = n3.va, b4.j = n3.j, b4.o = n3.o, c4.$a) t: {
              e2(1 == c4.$a), n3 = kt2();
              e: for (; ; ) {
                if (null == n3) {
                  n3 = 0;
                  break t;
                }
                if (e2(null != c4), c4.mc = n3, n3.c = c4.c, n3.i = c4.i, n3.l = c4.l, n3.l.ma = c4, n3.l.width = c4.c, n3.l.height = c4.i, n3.a = 0, v3(n3.m, l4, g4, m4), !Ft2(c4.c, c4.i, 1, n3, null)) break e;
                if (1 == n3.ab && 3 == n3.gc[0].hc && xt2(n3.s) ? (c4.ic = 1, l4 = n3.c * n3.i, n3.Ta = null, n3.Ua = 0, n3.V = a2(l4), n3.Ba = 0, null == n3.V ? (n3.a = 1, n3 = 0) : n3 = 1) : (c4.ic = 0, n3 = It2(n3, c4.c)), !n3) break e;
                n3 = 1;
                break t;
              }
              c4.mc = null, n3 = 0;
            }
            else n3 = m4 >= c4.c * c4.i;
            c4 = !n3;
          }
          if (c4) return null;
          1 != t5.ga.Lc ? t5.Ga = 0 : o3 = u4 - i3;
        }
        e2(null != t5.ga), e2(i3 + o3 <= u4);
        t: {
          if (n3 = (l4 = t5.ga).c, u4 = l4.l.o, 0 == l4.$a) {
            if (g4 = t5.rc, m4 = t5.Vc, b4 = t5.Fa, h4 = t5.P + 1 + i3 * n3, f4 = t5.mb, d4 = t5.nb + i3 * n3, e2(h4 <= t5.P + t5.qc), 0 != l4.Z) for (e2(null != gi[l4.Z]), c4 = 0; c4 < o3; ++c4) gi[l4.Z](g4, m4, b4, h4, f4, d4, n3), g4 = f4, m4 = d4, d4 += n3, h4 += n3;
            else for (c4 = 0; c4 < o3; ++c4) r2(f4, d4, b4, h4, n3), g4 = f4, m4 = d4, d4 += n3, h4 += n3;
            t5.rc = g4, t5.Vc = m4;
          } else {
            if (e2(null != l4.mc), n3 = i3 + o3, e2(null != (c4 = l4.mc)), e2(n3 <= c4.i), c4.C >= n3) n3 = 1;
            else if (l4.ic || mn(), l4.ic) {
              l4 = c4.V, g4 = c4.Ba, m4 = c4.c;
              var y4 = c4.i, w4 = (b4 = 1, h4 = c4.$ / m4, f4 = c4.$ % m4, d4 = c4.m, p4 = c4.s, c4.$), N4 = m4 * y4, L4 = m4 * n3, A4 = p4.wc, _3 = w4 < L4 ? wt2(p4, f4, h4) : null;
              e2(w4 <= N4), e2(n3 <= y4), e2(xt2(p4));
              e: for (; ; ) {
                for (; !d4.h && w4 < L4; ) {
                  if (f4 & A4 || (_3 = wt2(p4, f4, h4)), e2(null != _3), S2(d4), 256 > (y4 = bt2(_3.G[0], _3.H[0], d4))) l4[g4 + w4] = y4, ++w4, ++f4 >= m4 && (f4 = 0, ++h4 <= n3 && !(h4 % 16) && St2(c4, h4));
                  else {
                    if (!(280 > y4)) {
                      b4 = 0;
                      break e;
                    }
                    y4 = mt2(y4 - 256, d4);
                    var P3, k3 = bt2(_3.G[4], _3.H[4], d4);
                    if (S2(d4), !(w4 >= (k3 = vt2(m4, k3 = mt2(k3, d4))) && N4 - w4 >= y4)) {
                      b4 = 0;
                      break e;
                    }
                    for (P3 = 0; P3 < y4; ++P3) l4[g4 + w4 + P3] = l4[g4 + w4 + P3 - k3];
                    for (w4 += y4, f4 += y4; f4 >= m4; ) f4 -= m4, ++h4 <= n3 && !(h4 % 16) && St2(c4, h4);
                    w4 < L4 && f4 & A4 && (_3 = wt2(p4, f4, h4));
                  }
                  e2(d4.h == x3(d4));
                }
                St2(c4, h4 > n3 ? n3 : h4);
                break e;
              }
              !b4 || d4.h && w4 < N4 ? (b4 = 0, c4.a = d4.h ? 5 : 3) : c4.$ = w4, n3 = b4;
            } else n3 = _t2(c4, c4.V, c4.Ba, c4.c, c4.i, n3, jt2);
            if (!n3) {
              o3 = 0;
              break t;
            }
          }
          i3 + o3 >= u4 && (t5.Cc = 1), o3 = 1;
        }
        if (!o3) return null;
        if (t5.Cc && (null != (o3 = t5.ga) && (o3.mc = null), t5.ga = null, 0 < t5.Ga)) return alert("todo:WebPDequantizeLevels"), null;
      }
      return t5.nb + i3 * s3;
    }
    function fn(t5, e3, n3, r3, i3, a3) {
      for (; 0 < i3--; ) {
        var o3, s3 = t5, u4 = e3 + (n3 ? 1 : 0), c4 = t5, l4 = e3 + (n3 ? 0 : 3);
        for (o3 = 0; o3 < r3; ++o3) {
          var h4 = c4[l4 + 4 * o3];
          255 != h4 && (h4 *= 32897, s3[u4 + 4 * o3 + 0] = s3[u4 + 4 * o3 + 0] * h4 >> 23, s3[u4 + 4 * o3 + 1] = s3[u4 + 4 * o3 + 1] * h4 >> 23, s3[u4 + 4 * o3 + 2] = s3[u4 + 4 * o3 + 2] * h4 >> 23);
        }
        e3 += a3;
      }
    }
    function dn(t5, e3, n3, r3, i3) {
      for (; 0 < r3--; ) {
        var a3;
        for (a3 = 0; a3 < n3; ++a3) {
          var o3 = t5[e3 + 2 * a3 + 0], s3 = 15 & (c4 = t5[e3 + 2 * a3 + 1]), u4 = 4369 * s3, c4 = (240 & c4 | c4 >> 4) * u4 >> 16;
          t5[e3 + 2 * a3 + 0] = (240 & o3 | o3 >> 4) * u4 >> 16 & 240 | (15 & o3 | o3 << 4) * u4 >> 16 >> 4 & 15, t5[e3 + 2 * a3 + 1] = 240 & c4 | s3;
        }
        e3 += i3;
      }
    }
    function pn(t5, e3, n3, r3, i3, a3, o3, s3) {
      var u4, c4, l4 = 255;
      for (c4 = 0; c4 < i3; ++c4) {
        for (u4 = 0; u4 < r3; ++u4) {
          var h4 = t5[e3 + u4];
          a3[o3 + 4 * u4] = h4, l4 &= h4;
        }
        e3 += n3, o3 += s3;
      }
      return 255 != l4;
    }
    function gn(t5, e3, n3, r3, i3) {
      var a3;
      for (a3 = 0; a3 < i3; ++a3) n3[r3 + a3] = t5[e3 + a3] >> 8;
    }
    function mn() {
      Lr = fn, xr = dn, Ar = pn, Sr = gn;
    }
    function vn(n3, r3, i3) {
      t4[n3] = function(t5, n4, a3, o3, s3, u4, c4, l4, h4, f4, d4, p4, g4, m4, v4, b4, y4) {
        var w4, N4 = y4 - 1 >> 1, L4 = s3[u4 + 0] | c4[l4 + 0] << 16, x4 = h4[f4 + 0] | d4[p4 + 0] << 16;
        e2(null != t5);
        var A4 = 3 * L4 + x4 + 131074 >> 2;
        for (r3(t5[n4 + 0], 255 & A4, A4 >> 16, g4, m4), null != a3 && (A4 = 3 * x4 + L4 + 131074 >> 2, r3(a3[o3 + 0], 255 & A4, A4 >> 16, v4, b4)), w4 = 1; w4 <= N4; ++w4) {
          var S3 = s3[u4 + w4] | c4[l4 + w4] << 16, _3 = h4[f4 + w4] | d4[p4 + w4] << 16, P3 = L4 + S3 + x4 + _3 + 524296, k3 = P3 + 2 * (S3 + x4) >> 3;
          A4 = k3 + L4 >> 1, L4 = (P3 = P3 + 2 * (L4 + _3) >> 3) + S3 >> 1, r3(t5[n4 + 2 * w4 - 1], 255 & A4, A4 >> 16, g4, m4 + (2 * w4 - 1) * i3), r3(t5[n4 + 2 * w4 - 0], 255 & L4, L4 >> 16, g4, m4 + (2 * w4 - 0) * i3), null != a3 && (A4 = P3 + x4 >> 1, L4 = k3 + _3 >> 1, r3(a3[o3 + 2 * w4 - 1], 255 & A4, A4 >> 16, v4, b4 + (2 * w4 - 1) * i3), r3(a3[o3 + 2 * w4 + 0], 255 & L4, L4 >> 16, v4, b4 + (2 * w4 + 0) * i3)), L4 = S3, x4 = _3;
        }
        1 & y4 || (A4 = 3 * L4 + x4 + 131074 >> 2, r3(t5[n4 + y4 - 1], 255 & A4, A4 >> 16, g4, m4 + (y4 - 1) * i3), null != a3 && (A4 = 3 * x4 + L4 + 131074 >> 2, r3(a3[o3 + y4 - 1], 255 & A4, A4 >> 16, v4, b4 + (y4 - 1) * i3)));
      };
    }
    function bn() {
      mi[Mr] = vi, mi[qr] = yi, mi[Er] = bi, mi[Rr] = wi, mi[Dr] = Ni, mi[Tr] = Li, mi[zr] = xi, mi[Ur] = yi, mi[Hr] = wi, mi[Wr] = Ni, mi[Vr] = Li;
    }
    function yn(t5) {
      return t5 & -16384 ? 0 > t5 ? 0 : 255 : t5 >> ki;
    }
    function wn(t5, e3) {
      return yn((19077 * t5 >> 8) + (26149 * e3 >> 8) - 14234);
    }
    function Nn(t5, e3, n3) {
      return yn((19077 * t5 >> 8) - (6419 * e3 >> 8) - (13320 * n3 >> 8) + 8708);
    }
    function Ln(t5, e3) {
      return yn((19077 * t5 >> 8) + (33050 * e3 >> 8) - 17685);
    }
    function xn(t5, e3, n3, r3, i3) {
      r3[i3 + 0] = wn(t5, n3), r3[i3 + 1] = Nn(t5, e3, n3), r3[i3 + 2] = Ln(t5, e3);
    }
    function An(t5, e3, n3, r3, i3) {
      r3[i3 + 0] = Ln(t5, e3), r3[i3 + 1] = Nn(t5, e3, n3), r3[i3 + 2] = wn(t5, n3);
    }
    function Sn(t5, e3, n3, r3, i3) {
      var a3 = Nn(t5, e3, n3);
      e3 = a3 << 3 & 224 | Ln(t5, e3) >> 3, r3[i3 + 0] = 248 & wn(t5, n3) | a3 >> 5, r3[i3 + 1] = e3;
    }
    function _n(t5, e3, n3, r3, i3) {
      var a3 = 240 & Ln(t5, e3) | 15;
      r3[i3 + 0] = 240 & wn(t5, n3) | Nn(t5, e3, n3) >> 4, r3[i3 + 1] = a3;
    }
    function Pn(t5, e3, n3, r3, i3) {
      r3[i3 + 0] = 255, xn(t5, e3, n3, r3, i3 + 1);
    }
    function kn(t5, e3, n3, r3, i3) {
      An(t5, e3, n3, r3, i3), r3[i3 + 3] = 255;
    }
    function Fn(t5, e3, n3, r3, i3) {
      xn(t5, e3, n3, r3, i3), r3[i3 + 3] = 255;
    }
    function In(e3, n3, r3) {
      t4[e3] = function(t5, e4, i3, a3, o3, s3, u4, c4, l4) {
        for (var h4 = c4 + (-2 & l4) * r3; c4 != h4; ) n3(t5[e4 + 0], i3[a3 + 0], o3[s3 + 0], u4, c4), n3(t5[e4 + 1], i3[a3 + 0], o3[s3 + 0], u4, c4 + r3), e4 += 2, ++a3, ++s3, c4 += 2 * r3;
        1 & l4 && n3(t5[e4 + 0], i3[a3 + 0], o3[s3 + 0], u4, c4);
      };
    }
    function jn(t5, e3, n3) {
      return 0 == n3 ? 0 == t5 ? 0 == e3 ? 6 : 5 : 0 == e3 ? 4 : 0 : n3;
    }
    function Cn(t5, e3, n3, r3, i3) {
      switch (t5 >>> 30) {
        case 3:
          ar(e3, n3, r3, i3, 0);
          break;
        case 2:
          or(e3, n3, r3, i3);
          break;
        case 1:
          ur(e3, n3, r3, i3);
      }
    }
    function On(t5, e3) {
      var n3, a3, o3 = e3.M, s3 = e3.Nb, u4 = t5.oc, c4 = t5.pc + 40, l4 = t5.oc, h4 = t5.pc + 584, f4 = t5.oc, d4 = t5.pc + 600;
      for (n3 = 0; 16 > n3; ++n3) u4[c4 + 32 * n3 - 1] = 129;
      for (n3 = 0; 8 > n3; ++n3) l4[h4 + 32 * n3 - 1] = 129, f4[d4 + 32 * n3 - 1] = 129;
      for (0 < o3 ? u4[c4 - 1 - 32] = l4[h4 - 1 - 32] = f4[d4 - 1 - 32] = 129 : (i2(u4, c4 - 32 - 1, 127, 21), i2(l4, h4 - 32 - 1, 127, 9), i2(f4, d4 - 32 - 1, 127, 9)), a3 = 0; a3 < t5.za; ++a3) {
        var p4 = e3.ya[e3.aa + a3];
        if (0 < a3) {
          for (n3 = -1; 16 > n3; ++n3) r2(u4, c4 + 32 * n3 - 4, u4, c4 + 32 * n3 + 12, 4);
          for (n3 = -1; 8 > n3; ++n3) r2(l4, h4 + 32 * n3 - 4, l4, h4 + 32 * n3 + 4, 4), r2(f4, d4 + 32 * n3 - 4, f4, d4 + 32 * n3 + 4, 4);
        }
        var g4 = t5.Gd, m4 = t5.Hd + a3, v4 = p4.ad, b4 = p4.Hc;
        if (0 < o3 && (r2(u4, c4 - 32, g4[m4].y, 0, 16), r2(l4, h4 - 32, g4[m4].f, 0, 8), r2(f4, d4 - 32, g4[m4].ea, 0, 8)), p4.Za) {
          var y4 = u4, w4 = c4 - 32 + 16;
          for (0 < o3 && (a3 >= t5.za - 1 ? i2(y4, w4, g4[m4].y[15], 4) : r2(y4, w4, g4[m4 + 1].y, 0, 4)), n3 = 0; 4 > n3; n3++) y4[w4 + 128 + n3] = y4[w4 + 256 + n3] = y4[w4 + 384 + n3] = y4[w4 + 0 + n3];
          for (n3 = 0; 16 > n3; ++n3, b4 <<= 2) y4 = u4, w4 = c4 + Ei[n3], hi[p4.Ob[n3]](y4, w4), Cn(b4, v4, 16 * +n3, y4, w4);
        } else if (y4 = jn(a3, o3, p4.Ob[0]), li[y4](u4, c4), 0 != b4) for (n3 = 0; 16 > n3; ++n3, b4 <<= 2) Cn(b4, v4, 16 * +n3, u4, c4 + Ei[n3]);
        for (n3 = p4.Gc, y4 = jn(a3, o3, p4.Dd), fi[y4](l4, h4), fi[y4](f4, d4), b4 = v4, y4 = l4, w4 = h4, 255 & (p4 = 0 | n3) && (170 & p4 ? sr(b4, 256, y4, w4) : cr(b4, 256, y4, w4)), p4 = f4, b4 = d4, 255 & (n3 >>= 8) && (170 & n3 ? sr(v4, 320, p4, b4) : cr(v4, 320, p4, b4)), o3 < t5.Ub - 1 && (r2(g4[m4].y, 0, u4, c4 + 480, 16), r2(g4[m4].f, 0, l4, h4 + 224, 8), r2(g4[m4].ea, 0, f4, d4 + 224, 8)), n3 = 8 * s3 * t5.B, g4 = t5.sa, m4 = t5.ta + 16 * a3 + 16 * s3 * t5.R, v4 = t5.qa, p4 = t5.ra + 8 * a3 + n3, b4 = t5.Ha, y4 = t5.Ia + 8 * a3 + n3, n3 = 0; 16 > n3; ++n3) r2(g4, m4 + n3 * t5.R, u4, c4 + 32 * n3, 16);
        for (n3 = 0; 8 > n3; ++n3) r2(v4, p4 + n3 * t5.B, l4, h4 + 32 * n3, 8), r2(b4, y4 + n3 * t5.B, f4, d4 + 32 * n3, 8);
      }
    }
    function Bn(t5, r3, i3, a3, o3, s3, u4, c4, l4) {
      var h4 = [0], f4 = [0], d4 = 0, p4 = null != l4 ? l4.kd : 0, g4 = null != l4 ? l4 : new nn();
      if (null == t5 || 12 > i3) return 7;
      g4.data = t5, g4.w = r3, g4.ha = i3, r3 = [r3], i3 = [i3], g4.gb = [g4.gb];
      t: {
        var m4 = r3, b4 = i3, y4 = g4.gb;
        if (e2(null != t5), e2(null != b4), e2(null != y4), y4[0] = 0, 12 <= b4[0] && !n2(t5, m4[0], "RIFF")) {
          if (n2(t5, m4[0] + 8, "WEBP")) {
            y4 = 3;
            break t;
          }
          var w4 = C2(t5, m4[0] + 4);
          if (12 > w4 || 4294967286 < w4) {
            y4 = 3;
            break t;
          }
          if (p4 && w4 > b4[0] - 8) {
            y4 = 7;
            break t;
          }
          y4[0] = w4, m4[0] += 12, b4[0] -= 12;
        }
        y4 = 0;
      }
      if (0 != y4) return y4;
      for (w4 = 0 < g4.gb[0], i3 = i3[0]; ; ) {
        t: {
          var L4 = t5;
          b4 = r3, y4 = i3;
          var x4 = h4, A4 = f4, S3 = m4 = [0];
          if ((k3 = d4 = [d4])[0] = 0, 8 > y4[0]) y4 = 7;
          else {
            if (!n2(L4, b4[0], "VP8X")) {
              if (10 != C2(L4, b4[0] + 4)) {
                y4 = 3;
                break t;
              }
              if (18 > y4[0]) {
                y4 = 7;
                break t;
              }
              var _3 = C2(L4, b4[0] + 8), P3 = 1 + j2(L4, b4[0] + 12);
              if (2147483648 <= P3 * (L4 = 1 + j2(L4, b4[0] + 15))) {
                y4 = 3;
                break t;
              }
              null != S3 && (S3[0] = _3), null != x4 && (x4[0] = P3), null != A4 && (A4[0] = L4), b4[0] += 18, y4[0] -= 18, k3[0] = 1;
            }
            y4 = 0;
          }
        }
        if (d4 = d4[0], m4 = m4[0], 0 != y4) return y4;
        if (b4 = !!(2 & m4), !w4 && d4) return 3;
        if (null != s3 && (s3[0] = !!(16 & m4)), null != u4 && (u4[0] = b4), null != c4 && (c4[0] = 0), u4 = h4[0], m4 = f4[0], d4 && b4 && null == l4) {
          y4 = 0;
          break;
        }
        if (4 > i3) {
          y4 = 7;
          break;
        }
        if (w4 && d4 || !w4 && !d4 && !n2(t5, r3[0], "ALPH")) {
          i3 = [i3], g4.na = [g4.na], g4.P = [g4.P], g4.Sa = [g4.Sa];
          t: {
            _3 = t5, y4 = r3, w4 = i3;
            var k3 = g4.gb;
            x4 = g4.na, A4 = g4.P, S3 = g4.Sa, P3 = 22, e2(null != _3), e2(null != w4), L4 = y4[0];
            var F3 = w4[0];
            for (e2(null != x4), e2(null != S3), x4[0] = null, A4[0] = null, S3[0] = 0; ; ) {
              if (y4[0] = L4, w4[0] = F3, 8 > F3) {
                y4 = 7;
                break t;
              }
              var I3 = C2(_3, L4 + 4);
              if (4294967286 < I3) {
                y4 = 3;
                break t;
              }
              var O3 = 8 + I3 + 1 & -2;
              if (P3 += O3, 0 < k3 && P3 > k3) {
                y4 = 3;
                break t;
              }
              if (!n2(_3, L4, "VP8 ") || !n2(_3, L4, "VP8L")) {
                y4 = 0;
                break t;
              }
              if (F3[0] < O3) {
                y4 = 7;
                break t;
              }
              n2(_3, L4, "ALPH") || (x4[0] = _3, A4[0] = L4 + 8, S3[0] = I3), L4 += O3, F3 -= O3;
            }
          }
          if (i3 = i3[0], g4.na = g4.na[0], g4.P = g4.P[0], g4.Sa = g4.Sa[0], 0 != y4) break;
        }
        i3 = [i3], g4.Ja = [g4.Ja], g4.xa = [g4.xa];
        t: if (k3 = t5, y4 = r3, w4 = i3, x4 = g4.gb[0], A4 = g4.Ja, S3 = g4.xa, _3 = y4[0], L4 = !n2(k3, _3, "VP8 "), P3 = !n2(k3, _3, "VP8L"), e2(null != k3), e2(null != w4), e2(null != A4), e2(null != S3), 8 > w4[0]) y4 = 7;
        else {
          if (L4 || P3) {
            if (k3 = C2(k3, _3 + 4), 12 <= x4 && k3 > x4 - 12) {
              y4 = 3;
              break t;
            }
            if (p4 && k3 > w4[0] - 8) {
              y4 = 7;
              break t;
            }
            A4[0] = k3, y4[0] += 8, w4[0] -= 8, S3[0] = P3;
          } else S3[0] = 5 <= w4[0] && 47 == k3[_3 + 0] && !(k3[_3 + 4] >> 5), A4[0] = w4[0];
          y4 = 0;
        }
        if (i3 = i3[0], g4.Ja = g4.Ja[0], g4.xa = g4.xa[0], r3 = r3[0], 0 != y4) break;
        if (4294967286 < g4.Ja) return 3;
        if (null == c4 || b4 || (c4[0] = g4.xa ? 2 : 1), u4 = [u4], m4 = [m4], g4.xa) {
          if (5 > i3) {
            y4 = 7;
            break;
          }
          c4 = u4, p4 = m4, b4 = s3, null == t5 || 5 > i3 ? t5 = 0 : 5 <= i3 && 47 == t5[r3 + 0] && !(t5[r3 + 4] >> 5) ? (w4 = [0], k3 = [0], x4 = [0], v3(A4 = new N3(), t5, r3, i3), gt2(A4, w4, k3, x4) ? (null != c4 && (c4[0] = w4[0]), null != p4 && (p4[0] = k3[0]), null != b4 && (b4[0] = x4[0]), t5 = 1) : t5 = 0) : t5 = 0;
        } else {
          if (10 > i3) {
            y4 = 7;
            break;
          }
          c4 = m4, null == t5 || 10 > i3 || !Xt2(t5, r3 + 3, i3 - 3) ? t5 = 0 : (p4 = t5[r3 + 0] | t5[r3 + 1] << 8 | t5[r3 + 2] << 16, b4 = 16383 & (t5[r3 + 7] << 8 | t5[r3 + 6]), t5 = 16383 & (t5[r3 + 9] << 8 | t5[r3 + 8]), 1 & p4 || 3 < (p4 >> 1 & 7) || !(p4 >> 4 & 1) || p4 >> 5 >= g4.Ja || !b4 || !t5 ? t5 = 0 : (u4 && (u4[0] = b4), c4 && (c4[0] = t5), t5 = 1));
        }
        if (!t5) return 3;
        if (u4 = u4[0], m4 = m4[0], d4 && (h4[0] != u4 || f4[0] != m4)) return 3;
        null != l4 && (l4[0] = g4, l4.offset = r3 - l4.w, e2(4294967286 > r3 - l4.w), e2(l4.offset == l4.ha - i3));
        break;
      }
      return 0 == y4 || 7 == y4 && d4 && null == l4 ? (null != s3 && (s3[0] |= null != g4.na && 0 < g4.na.length), null != a3 && (a3[0] = u4), null != o3 && (o3[0] = m4), 0) : y4;
    }
    function Mn(t5, e3, n3) {
      var r3 = e3.width, i3 = e3.height, a3 = 0, o3 = 0, s3 = r3, u4 = i3;
      if (e3.Da = null != t5 && 0 < t5.Da, e3.Da && (s3 = t5.cd, u4 = t5.bd, a3 = t5.v, o3 = t5.j, 11 > n3 || (a3 &= -2, o3 &= -2), 0 > a3 || 0 > o3 || 0 >= s3 || 0 >= u4 || a3 + s3 > r3 || o3 + u4 > i3)) return 0;
      if (e3.v = a3, e3.j = o3, e3.va = a3 + s3, e3.o = o3 + u4, e3.U = s3, e3.T = u4, e3.da = null != t5 && 0 < t5.da, e3.da) {
        if (!q2(s3, u4, n3 = [t5.ib], a3 = [t5.hb])) return 0;
        e3.ib = n3[0], e3.hb = a3[0];
      }
      return e3.ob = null != t5 && t5.ob, e3.Kb = null == t5 || !t5.Sd, e3.da && (e3.ob = e3.ib < 3 * r3 / 4 && e3.hb < 3 * i3 / 4, e3.Kb = 0), 1;
    }
    function qn(t5) {
      if (null == t5) return 2;
      if (11 > t5.S) {
        var e3 = t5.f.RGBA;
        e3.fb += (t5.height - 1) * e3.A, e3.A = -e3.A;
      } else e3 = t5.f.kb, t5 = t5.height, e3.O += (t5 - 1) * e3.fa, e3.fa = -e3.fa, e3.N += (t5 - 1 >> 1) * e3.Ab, e3.Ab = -e3.Ab, e3.W += (t5 - 1 >> 1) * e3.Db, e3.Db = -e3.Db, null != e3.F && (e3.J += (t5 - 1) * e3.lb, e3.lb = -e3.lb);
      return 0;
    }
    function En(t5, e3, n3, r3) {
      if (null == r3 || 0 >= t5 || 0 >= e3) return 2;
      if (null != n3) {
        if (n3.Da) {
          var i3 = n3.cd, o3 = n3.bd, s3 = -2 & n3.v, u4 = -2 & n3.j;
          if (0 > s3 || 0 > u4 || 0 >= i3 || 0 >= o3 || s3 + i3 > t5 || u4 + o3 > e3) return 2;
          t5 = i3, e3 = o3;
        }
        if (n3.da) {
          if (!q2(t5, e3, i3 = [n3.ib], o3 = [n3.hb])) return 2;
          t5 = i3[0], e3 = o3[0];
        }
      }
      r3.width = t5, r3.height = e3;
      t: {
        var c4 = r3.width, l4 = r3.height;
        if (t5 = r3.S, 0 >= c4 || 0 >= l4 || !(t5 >= Mr && 13 > t5)) t5 = 2;
        else {
          if (0 >= r3.Rd && null == r3.sd) {
            s3 = o3 = i3 = e3 = 0;
            var h4 = (u4 = c4 * zi[t5]) * l4;
            if (11 > t5 || (o3 = (l4 + 1) / 2 * (e3 = (c4 + 1) / 2), 12 == t5 && (s3 = (i3 = c4) * l4)), null == (l4 = a2(h4 + 2 * o3 + s3))) {
              t5 = 1;
              break t;
            }
            r3.sd = l4, 11 > t5 ? ((c4 = r3.f.RGBA).eb = l4, c4.fb = 0, c4.A = u4, c4.size = h4) : ((c4 = r3.f.kb).y = l4, c4.O = 0, c4.fa = u4, c4.Fd = h4, c4.f = l4, c4.N = 0 + h4, c4.Ab = e3, c4.Cd = o3, c4.ea = l4, c4.W = 0 + h4 + o3, c4.Db = e3, c4.Ed = o3, 12 == t5 && (c4.F = l4, c4.J = 0 + h4 + 2 * o3), c4.Tc = s3, c4.lb = i3);
          }
          if (e3 = 1, i3 = r3.S, o3 = r3.width, s3 = r3.height, i3 >= Mr && 13 > i3) if (11 > i3) t5 = r3.f.RGBA, e3 &= (u4 = Math.abs(t5.A)) * (s3 - 1) + o3 <= t5.size, e3 &= u4 >= o3 * zi[i3], e3 &= null != t5.eb;
          else {
            t5 = r3.f.kb, u4 = (o3 + 1) / 2, h4 = (s3 + 1) / 2, c4 = Math.abs(t5.fa), l4 = Math.abs(t5.Ab);
            var f4 = Math.abs(t5.Db), d4 = Math.abs(t5.lb), p4 = d4 * (s3 - 1) + o3;
            e3 &= c4 * (s3 - 1) + o3 <= t5.Fd, e3 &= l4 * (h4 - 1) + u4 <= t5.Cd, e3 = (e3 &= f4 * (h4 - 1) + u4 <= t5.Ed) & c4 >= o3 & l4 >= u4 & f4 >= u4, e3 &= null != t5.y, e3 &= null != t5.f, e3 &= null != t5.ea, 12 == i3 && (e3 &= d4 >= o3, e3 &= p4 <= t5.Tc, e3 &= null != t5.F);
          }
          else e3 = 0;
          t5 = e3 ? 0 : 2;
        }
      }
      return 0 != t5 || null != n3 && n3.fd && (t5 = qn(r3)), t5;
    }
    var Rn = 64, Dn = [0, 1, 3, 7, 15, 31, 63, 127, 255, 511, 1023, 2047, 4095, 8191, 16383, 32767, 65535, 131071, 262143, 524287, 1048575, 2097151, 4194303, 8388607, 16777215], Tn = 24, zn = 32, Un = 8, Hn = [0, 0, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7];
    D2("Predictor0", "PredictorAdd0"), t4.Predictor0 = function() {
      return 4278190080;
    }, t4.Predictor1 = function(t5) {
      return t5;
    }, t4.Predictor2 = function(t5, e3, n3) {
      return e3[n3 + 0];
    }, t4.Predictor3 = function(t5, e3, n3) {
      return e3[n3 + 1];
    }, t4.Predictor4 = function(t5, e3, n3) {
      return e3[n3 - 1];
    }, t4.Predictor5 = function(t5, e3, n3) {
      return z2(z2(t5, e3[n3 + 1]), e3[n3 + 0]);
    }, t4.Predictor6 = function(t5, e3, n3) {
      return z2(t5, e3[n3 - 1]);
    }, t4.Predictor7 = function(t5, e3, n3) {
      return z2(t5, e3[n3 + 0]);
    }, t4.Predictor8 = function(t5, e3, n3) {
      return z2(e3[n3 - 1], e3[n3 + 0]);
    }, t4.Predictor9 = function(t5, e3, n3) {
      return z2(e3[n3 + 0], e3[n3 + 1]);
    }, t4.Predictor10 = function(t5, e3, n3) {
      return z2(z2(t5, e3[n3 - 1]), z2(e3[n3 + 0], e3[n3 + 1]));
    }, t4.Predictor11 = function(t5, e3, n3) {
      var r3 = e3[n3 + 0];
      return 0 >= W2(r3 >> 24 & 255, t5 >> 24 & 255, (e3 = e3[n3 - 1]) >> 24 & 255) + W2(r3 >> 16 & 255, t5 >> 16 & 255, e3 >> 16 & 255) + W2(r3 >> 8 & 255, t5 >> 8 & 255, e3 >> 8 & 255) + W2(255 & r3, 255 & t5, 255 & e3) ? r3 : t5;
    }, t4.Predictor12 = function(t5, e3, n3) {
      var r3 = e3[n3 + 0];
      return (U2((t5 >> 24 & 255) + (r3 >> 24 & 255) - ((e3 = e3[n3 - 1]) >> 24 & 255)) << 24 | U2((t5 >> 16 & 255) + (r3 >> 16 & 255) - (e3 >> 16 & 255)) << 16 | U2((t5 >> 8 & 255) + (r3 >> 8 & 255) - (e3 >> 8 & 255)) << 8 | U2((255 & t5) + (255 & r3) - (255 & e3))) >>> 0;
    }, t4.Predictor13 = function(t5, e3, n3) {
      var r3 = e3[n3 - 1];
      return (H2((t5 = z2(t5, e3[n3 + 0])) >> 24 & 255, r3 >> 24 & 255) << 24 | H2(t5 >> 16 & 255, r3 >> 16 & 255) << 16 | H2(t5 >> 8 & 255, r3 >> 8 & 255) << 8 | H2(255 & t5, 255 & r3)) >>> 0;
    };
    var Wn = t4.PredictorAdd0;
    t4.PredictorAdd1 = V2, D2("Predictor2", "PredictorAdd2"), D2("Predictor3", "PredictorAdd3"), D2("Predictor4", "PredictorAdd4"), D2("Predictor5", "PredictorAdd5"), D2("Predictor6", "PredictorAdd6"), D2("Predictor7", "PredictorAdd7"), D2("Predictor8", "PredictorAdd8"), D2("Predictor9", "PredictorAdd9"), D2("Predictor10", "PredictorAdd10"), D2("Predictor11", "PredictorAdd11"), D2("Predictor12", "PredictorAdd12"), D2("Predictor13", "PredictorAdd13");
    var Vn = t4.PredictorAdd2;
    X2("ColorIndexInverseTransform", "MapARGB", "32b", function(t5) {
      return t5 >> 8 & 255;
    }, function(t5) {
      return t5;
    }), X2("VP8LColorIndexInverseTransformAlpha", "MapAlpha", "8b", function(t5) {
      return t5;
    }, function(t5) {
      return t5 >> 8 & 255;
    });
    var Gn, Yn = t4.ColorIndexInverseTransform, Jn = t4.MapARGB, Xn = t4.VP8LColorIndexInverseTransformAlpha, Kn = t4.MapAlpha, Zn = t4.VP8LPredictorsAdd = [];
    Zn.length = 16, (t4.VP8LPredictors = []).length = 16, (t4.VP8LPredictorsAdd_C = []).length = 16, (t4.VP8LPredictors_C = []).length = 16;
    var $n, Qn, tr, er, nr, rr, ir, ar, or, sr, ur, cr, lr, hr, fr, dr, pr, gr, mr, vr, br, yr, wr, Nr, Lr, xr, Ar, Sr, _r = a2(511), Pr = a2(2041), kr = a2(225), Fr = a2(767), Ir = 0, jr = Pr, Cr = kr, Or = Fr, Br = _r, Mr = 0, qr = 1, Er = 2, Rr = 3, Dr = 4, Tr = 5, zr = 6, Ur = 7, Hr = 8, Wr = 9, Vr = 10, Gr = [2, 3, 7], Yr = [3, 3, 11], Jr = [280, 256, 256, 256, 40], Xr = [0, 1, 1, 1, 0], Kr = [17, 18, 0, 1, 2, 3, 4, 5, 16, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15], Zr = [24, 7, 23, 25, 40, 6, 39, 41, 22, 26, 38, 42, 56, 5, 55, 57, 21, 27, 54, 58, 37, 43, 72, 4, 71, 73, 20, 28, 53, 59, 70, 74, 36, 44, 88, 69, 75, 52, 60, 3, 87, 89, 19, 29, 86, 90, 35, 45, 68, 76, 85, 91, 51, 61, 104, 2, 103, 105, 18, 30, 102, 106, 34, 46, 84, 92, 67, 77, 101, 107, 50, 62, 120, 1, 119, 121, 83, 93, 17, 31, 100, 108, 66, 78, 118, 122, 33, 47, 117, 123, 49, 63, 99, 109, 82, 94, 0, 116, 124, 65, 79, 16, 32, 98, 110, 48, 115, 125, 81, 95, 64, 114, 126, 97, 111, 80, 113, 127, 96, 112], $r = [2954, 2956, 2958, 2962, 2970, 2986, 3018, 3082, 3212, 3468, 3980, 5004], Qr = 8, ti = [4, 5, 6, 7, 8, 9, 10, 10, 11, 12, 13, 14, 15, 16, 17, 17, 18, 19, 20, 20, 21, 21, 22, 22, 23, 23, 24, 25, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 91, 93, 95, 96, 98, 100, 101, 102, 104, 106, 108, 110, 112, 114, 116, 118, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 143, 145, 148, 151, 154, 157], ei = [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 119, 122, 125, 128, 131, 134, 137, 140, 143, 146, 149, 152, 155, 158, 161, 164, 167, 170, 173, 177, 181, 185, 189, 193, 197, 201, 205, 209, 213, 217, 221, 225, 229, 234, 239, 245, 249, 254, 259, 264, 269, 274, 279, 284], ni = null, ri = [[173, 148, 140, 0], [176, 155, 140, 135, 0], [180, 157, 141, 134, 130, 0], [254, 254, 243, 230, 196, 177, 153, 140, 133, 130, 129, 0]], ii = [0, 1, 4, 8, 5, 2, 3, 6, 9, 12, 13, 10, 7, 11, 14, 15], ai = [-0, 1, -1, 2, -2, 3, 4, 6, -3, 5, -4, -5, -6, 7, -7, 8, -8, -9], oi = [[[[128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128], [128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128], [128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128]], [[253, 136, 254, 255, 228, 219, 128, 128, 128, 128, 128], [189, 129, 242, 255, 227, 213, 255, 219, 128, 128, 128], [106, 126, 227, 252, 214, 209, 255, 255, 128, 128, 128]], [[1, 98, 248, 255, 236, 226, 255, 255, 128, 128, 128], [181, 133, 238, 254, 221, 234, 255, 154, 128, 128, 128], [78, 134, 202, 247, 198, 180, 255, 219, 128, 128, 128]], [[1, 185, 249, 255, 243, 255, 128, 128, 128, 128, 128], [184, 150, 247, 255, 236, 224, 128, 128, 128, 128, 128], [77, 110, 216, 255, 236, 230, 128, 128, 128, 128, 128]], [[1, 101, 251, 255, 241, 255, 128, 128, 128, 128, 128], [170, 139, 241, 252, 236, 209, 255, 255, 128, 128, 128], [37, 116, 196, 243, 228, 255, 255, 255, 128, 128, 128]], [[1, 204, 254, 255, 245, 255, 128, 128, 128, 128, 128], [207, 160, 250, 255, 238, 128, 128, 128, 128, 128, 128], [102, 103, 231, 255, 211, 171, 128, 128, 128, 128, 128]], [[1, 152, 252, 255, 240, 255, 128, 128, 128, 128, 128], [177, 135, 243, 255, 234, 225, 128, 128, 128, 128, 128], [80, 129, 211, 255, 194, 224, 128, 128, 128, 128, 128]], [[1, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128], [246, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128], [255, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128]]], [[[198, 35, 237, 223, 193, 187, 162, 160, 145, 155, 62], [131, 45, 198, 221, 172, 176, 220, 157, 252, 221, 1], [68, 47, 146, 208, 149, 167, 221, 162, 255, 223, 128]], [[1, 149, 241, 255, 221, 224, 255, 255, 128, 128, 128], [184, 141, 234, 253, 222, 220, 255, 199, 128, 128, 128], [81, 99, 181, 242, 176, 190, 249, 202, 255, 255, 128]], [[1, 129, 232, 253, 214, 197, 242, 196, 255, 255, 128], [99, 121, 210, 250, 201, 198, 255, 202, 128, 128, 128], [23, 91, 163, 242, 170, 187, 247, 210, 255, 255, 128]], [[1, 200, 246, 255, 234, 255, 128, 128, 128, 128, 128], [109, 178, 241, 255, 231, 245, 255, 255, 128, 128, 128], [44, 130, 201, 253, 205, 192, 255, 255, 128, 128, 128]], [[1, 132, 239, 251, 219, 209, 255, 165, 128, 128, 128], [94, 136, 225, 251, 218, 190, 255, 255, 128, 128, 128], [22, 100, 174, 245, 186, 161, 255, 199, 128, 128, 128]], [[1, 182, 249, 255, 232, 235, 128, 128, 128, 128, 128], [124, 143, 241, 255, 227, 234, 128, 128, 128, 128, 128], [35, 77, 181, 251, 193, 211, 255, 205, 128, 128, 128]], [[1, 157, 247, 255, 236, 231, 255, 255, 128, 128, 128], [121, 141, 235, 255, 225, 227, 255, 255, 128, 128, 128], [45, 99, 188, 251, 195, 217, 255, 224, 128, 128, 128]], [[1, 1, 251, 255, 213, 255, 128, 128, 128, 128, 128], [203, 1, 248, 255, 255, 128, 128, 128, 128, 128, 128], [137, 1, 177, 255, 224, 255, 128, 128, 128, 128, 128]]], [[[253, 9, 248, 251, 207, 208, 255, 192, 128, 128, 128], [175, 13, 224, 243, 193, 185, 249, 198, 255, 255, 128], [73, 17, 171, 221, 161, 179, 236, 167, 255, 234, 128]], [[1, 95, 247, 253, 212, 183, 255, 255, 128, 128, 128], [239, 90, 244, 250, 211, 209, 255, 255, 128, 128, 128], [155, 77, 195, 248, 188, 195, 255, 255, 128, 128, 128]], [[1, 24, 239, 251, 218, 219, 255, 205, 128, 128, 128], [201, 51, 219, 255, 196, 186, 128, 128, 128, 128, 128], [69, 46, 190, 239, 201, 218, 255, 228, 128, 128, 128]], [[1, 191, 251, 255, 255, 128, 128, 128, 128, 128, 128], [223, 165, 249, 255, 213, 255, 128, 128, 128, 128, 128], [141, 124, 248, 255, 255, 128, 128, 128, 128, 128, 128]], [[1, 16, 248, 255, 255, 128, 128, 128, 128, 128, 128], [190, 36, 230, 255, 236, 255, 128, 128, 128, 128, 128], [149, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128]], [[1, 226, 255, 128, 128, 128, 128, 128, 128, 128, 128], [247, 192, 255, 128, 128, 128, 128, 128, 128, 128, 128], [240, 128, 255, 128, 128, 128, 128, 128, 128, 128, 128]], [[1, 134, 252, 255, 255, 128, 128, 128, 128, 128, 128], [213, 62, 250, 255, 255, 128, 128, 128, 128, 128, 128], [55, 93, 255, 128, 128, 128, 128, 128, 128, 128, 128]], [[128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128], [128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128], [128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128]]], [[[202, 24, 213, 235, 186, 191, 220, 160, 240, 175, 255], [126, 38, 182, 232, 169, 184, 228, 174, 255, 187, 128], [61, 46, 138, 219, 151, 178, 240, 170, 255, 216, 128]], [[1, 112, 230, 250, 199, 191, 247, 159, 255, 255, 128], [166, 109, 228, 252, 211, 215, 255, 174, 128, 128, 128], [39, 77, 162, 232, 172, 180, 245, 178, 255, 255, 128]], [[1, 52, 220, 246, 198, 199, 249, 220, 255, 255, 128], [124, 74, 191, 243, 183, 193, 250, 221, 255, 255, 128], [24, 71, 130, 219, 154, 170, 243, 182, 255, 255, 128]], [[1, 182, 225, 249, 219, 240, 255, 224, 128, 128, 128], [149, 150, 226, 252, 216, 205, 255, 171, 128, 128, 128], [28, 108, 170, 242, 183, 194, 254, 223, 255, 255, 128]], [[1, 81, 230, 252, 204, 203, 255, 192, 128, 128, 128], [123, 102, 209, 247, 188, 196, 255, 233, 128, 128, 128], [20, 95, 153, 243, 164, 173, 255, 203, 128, 128, 128]], [[1, 222, 248, 255, 216, 213, 128, 128, 128, 128, 128], [168, 175, 246, 252, 235, 205, 255, 255, 128, 128, 128], [47, 116, 215, 255, 211, 212, 255, 255, 128, 128, 128]], [[1, 121, 236, 253, 212, 214, 255, 255, 128, 128, 128], [141, 84, 213, 252, 201, 202, 255, 219, 128, 128, 128], [42, 80, 160, 240, 162, 185, 255, 205, 128, 128, 128]], [[1, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128], [244, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128], [238, 1, 255, 128, 128, 128, 128, 128, 128, 128, 128]]]], si = [[[231, 120, 48, 89, 115, 113, 120, 152, 112], [152, 179, 64, 126, 170, 118, 46, 70, 95], [175, 69, 143, 80, 85, 82, 72, 155, 103], [56, 58, 10, 171, 218, 189, 17, 13, 152], [114, 26, 17, 163, 44, 195, 21, 10, 173], [121, 24, 80, 195, 26, 62, 44, 64, 85], [144, 71, 10, 38, 171, 213, 144, 34, 26], [170, 46, 55, 19, 136, 160, 33, 206, 71], [63, 20, 8, 114, 114, 208, 12, 9, 226], [81, 40, 11, 96, 182, 84, 29, 16, 36]], [[134, 183, 89, 137, 98, 101, 106, 165, 148], [72, 187, 100, 130, 157, 111, 32, 75, 80], [66, 102, 167, 99, 74, 62, 40, 234, 128], [41, 53, 9, 178, 241, 141, 26, 8, 107], [74, 43, 26, 146, 73, 166, 49, 23, 157], [65, 38, 105, 160, 51, 52, 31, 115, 128], [104, 79, 12, 27, 217, 255, 87, 17, 7], [87, 68, 71, 44, 114, 51, 15, 186, 23], [47, 41, 14, 110, 182, 183, 21, 17, 194], [66, 45, 25, 102, 197, 189, 23, 18, 22]], [[88, 88, 147, 150, 42, 46, 45, 196, 205], [43, 97, 183, 117, 85, 38, 35, 179, 61], [39, 53, 200, 87, 26, 21, 43, 232, 171], [56, 34, 51, 104, 114, 102, 29, 93, 77], [39, 28, 85, 171, 58, 165, 90, 98, 64], [34, 22, 116, 206, 23, 34, 43, 166, 73], [107, 54, 32, 26, 51, 1, 81, 43, 31], [68, 25, 106, 22, 64, 171, 36, 225, 114], [34, 19, 21, 102, 132, 188, 16, 76, 124], [62, 18, 78, 95, 85, 57, 50, 48, 51]], [[193, 101, 35, 159, 215, 111, 89, 46, 111], [60, 148, 31, 172, 219, 228, 21, 18, 111], [112, 113, 77, 85, 179, 255, 38, 120, 114], [40, 42, 1, 196, 245, 209, 10, 25, 109], [88, 43, 29, 140, 166, 213, 37, 43, 154], [61, 63, 30, 155, 67, 45, 68, 1, 209], [100, 80, 8, 43, 154, 1, 51, 26, 71], [142, 78, 78, 16, 255, 128, 34, 197, 171], [41, 40, 5, 102, 211, 183, 4, 1, 221], [51, 50, 17, 168, 209, 192, 23, 25, 82]], [[138, 31, 36, 171, 27, 166, 38, 44, 229], [67, 87, 58, 169, 82, 115, 26, 59, 179], [63, 59, 90, 180, 59, 166, 93, 73, 154], [40, 40, 21, 116, 143, 209, 34, 39, 175], [47, 15, 16, 183, 34, 223, 49, 45, 183], [46, 17, 33, 183, 6, 98, 15, 32, 183], [57, 46, 22, 24, 128, 1, 54, 17, 37], [65, 32, 73, 115, 28, 128, 23, 128, 205], [40, 3, 9, 115, 51, 192, 18, 6, 223], [87, 37, 9, 115, 59, 77, 64, 21, 47]], [[104, 55, 44, 218, 9, 54, 53, 130, 226], [64, 90, 70, 205, 40, 41, 23, 26, 57], [54, 57, 112, 184, 5, 41, 38, 166, 213], [30, 34, 26, 133, 152, 116, 10, 32, 134], [39, 19, 53, 221, 26, 114, 32, 73, 255], [31, 9, 65, 234, 2, 15, 1, 118, 73], [75, 32, 12, 51, 192, 255, 160, 43, 51], [88, 31, 35, 67, 102, 85, 55, 186, 85], [56, 21, 23, 111, 59, 205, 45, 37, 192], [55, 38, 70, 124, 73, 102, 1, 34, 98]], [[125, 98, 42, 88, 104, 85, 117, 175, 82], [95, 84, 53, 89, 128, 100, 113, 101, 45], [75, 79, 123, 47, 51, 128, 81, 171, 1], [57, 17, 5, 71, 102, 57, 53, 41, 49], [38, 33, 13, 121, 57, 73, 26, 1, 85], [41, 10, 67, 138, 77, 110, 90, 47, 114], [115, 21, 2, 10, 102, 255, 166, 23, 6], [101, 29, 16, 10, 85, 128, 101, 196, 26], [57, 18, 10, 102, 102, 213, 34, 20, 43], [117, 20, 15, 36, 163, 128, 68, 1, 26]], [[102, 61, 71, 37, 34, 53, 31, 243, 192], [69, 60, 71, 38, 73, 119, 28, 222, 37], [68, 45, 128, 34, 1, 47, 11, 245, 171], [62, 17, 19, 70, 146, 85, 55, 62, 70], [37, 43, 37, 154, 100, 163, 85, 160, 1], [63, 9, 92, 136, 28, 64, 32, 201, 85], [75, 15, 9, 9, 64, 255, 184, 119, 16], [86, 6, 28, 5, 64, 255, 25, 248, 1], [56, 8, 17, 132, 137, 255, 55, 116, 128], [58, 15, 20, 82, 135, 57, 26, 121, 40]], [[164, 50, 31, 137, 154, 133, 25, 35, 218], [51, 103, 44, 131, 131, 123, 31, 6, 158], [86, 40, 64, 135, 148, 224, 45, 183, 128], [22, 26, 17, 131, 240, 154, 14, 1, 209], [45, 16, 21, 91, 64, 222, 7, 1, 197], [56, 21, 39, 155, 60, 138, 23, 102, 213], [83, 12, 13, 54, 192, 255, 68, 47, 28], [85, 26, 85, 85, 128, 128, 32, 146, 171], [18, 11, 7, 63, 144, 171, 4, 4, 246], [35, 27, 10, 146, 174, 171, 12, 26, 128]], [[190, 80, 35, 99, 180, 80, 126, 54, 45], [85, 126, 47, 87, 176, 51, 41, 20, 32], [101, 75, 128, 139, 118, 146, 116, 128, 85], [56, 41, 15, 176, 236, 85, 37, 9, 62], [71, 30, 17, 119, 118, 255, 17, 18, 138], [101, 38, 60, 138, 55, 70, 43, 26, 142], [146, 36, 19, 30, 171, 255, 97, 27, 20], [138, 45, 61, 62, 219, 1, 81, 188, 64], [32, 41, 20, 117, 151, 142, 20, 21, 163], [112, 19, 12, 61, 195, 128, 48, 4, 24]]], ui = [[[[255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[176, 246, 255, 255, 255, 255, 255, 255, 255, 255, 255], [223, 241, 252, 255, 255, 255, 255, 255, 255, 255, 255], [249, 253, 253, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 244, 252, 255, 255, 255, 255, 255, 255, 255, 255], [234, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255], [253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 246, 254, 255, 255, 255, 255, 255, 255, 255, 255], [239, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255], [254, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 248, 254, 255, 255, 255, 255, 255, 255, 255, 255], [251, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255], [251, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255], [254, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 254, 253, 255, 254, 255, 255, 255, 255, 255, 255], [250, 255, 254, 255, 254, 255, 255, 255, 255, 255, 255], [254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]]], [[[217, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [225, 252, 241, 253, 255, 255, 254, 255, 255, 255, 255], [234, 250, 241, 250, 253, 255, 253, 254, 255, 255, 255]], [[255, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255], [223, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255], [238, 253, 254, 254, 255, 255, 255, 255, 255, 255, 255]], [[255, 248, 254, 255, 255, 255, 255, 255, 255, 255, 255], [249, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 253, 255, 255, 255, 255, 255, 255, 255, 255, 255], [247, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255], [252, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255], [253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 254, 253, 255, 255, 255, 255, 255, 255, 255, 255], [250, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]]], [[[186, 251, 250, 255, 255, 255, 255, 255, 255, 255, 255], [234, 251, 244, 254, 255, 255, 255, 255, 255, 255, 255], [251, 251, 243, 253, 254, 255, 254, 255, 255, 255, 255]], [[255, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255], [236, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255], [251, 253, 253, 254, 254, 255, 255, 255, 255, 255, 255]], [[255, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255], [254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255], [254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255], [254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]]], [[[248, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [250, 254, 252, 254, 255, 255, 255, 255, 255, 255, 255], [248, 254, 249, 253, 255, 255, 255, 255, 255, 255, 255]], [[255, 253, 253, 255, 255, 255, 255, 255, 255, 255, 255], [246, 253, 253, 255, 255, 255, 255, 255, 255, 255, 255], [252, 254, 251, 254, 254, 255, 255, 255, 255, 255, 255]], [[255, 254, 252, 255, 255, 255, 255, 255, 255, 255, 255], [248, 254, 253, 255, 255, 255, 255, 255, 255, 255, 255], [253, 255, 254, 254, 255, 255, 255, 255, 255, 255, 255]], [[255, 251, 254, 255, 255, 255, 255, 255, 255, 255, 255], [245, 251, 254, 255, 255, 255, 255, 255, 255, 255, 255], [253, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 251, 253, 255, 255, 255, 255, 255, 255, 255, 255], [252, 253, 254, 255, 255, 255, 255, 255, 255, 255, 255], [255, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 252, 255, 255, 255, 255, 255, 255, 255, 255, 255], [249, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 254, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 255, 253, 255, 255, 255, 255, 255, 255, 255, 255], [250, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]], [[255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]]]], ci = [0, 1, 2, 3, 6, 4, 5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 0], li = [], hi = [], fi = [], di = 1, pi = 2, gi = [], mi = [];
    vn("UpsampleRgbLinePair", xn, 3), vn("UpsampleBgrLinePair", An, 3), vn("UpsampleRgbaLinePair", Fn, 4), vn("UpsampleBgraLinePair", kn, 4), vn("UpsampleArgbLinePair", Pn, 4), vn("UpsampleRgba4444LinePair", _n, 2), vn("UpsampleRgb565LinePair", Sn, 2);
    var vi = t4.UpsampleRgbLinePair, bi = t4.UpsampleBgrLinePair, yi = t4.UpsampleRgbaLinePair, wi = t4.UpsampleBgraLinePair, Ni = t4.UpsampleArgbLinePair, Li = t4.UpsampleRgba4444LinePair, xi = t4.UpsampleRgb565LinePair, Ai = 16, Si = 1 << Ai - 1, _i = -227, Pi = 482, ki = 6, Ii = 0, ji = a2(256), Ci = a2(256), Oi = a2(256), Bi = a2(256), Mi = a2(Pi - _i), qi = a2(Pi - _i);
    In("YuvToRgbRow", xn, 3), In("YuvToBgrRow", An, 3), In("YuvToRgbaRow", Fn, 4), In("YuvToBgraRow", kn, 4), In("YuvToArgbRow", Pn, 4), In("YuvToRgba4444Row", _n, 2), In("YuvToRgb565Row", Sn, 2);
    var Ei = [0, 4, 8, 12, 128, 132, 136, 140, 256, 260, 264, 268, 384, 388, 392, 396], Ri = [0, 2, 8], Di = [8, 7, 6, 4, 4, 2, 2, 2, 1, 1, 1, 1], Ti = 1;
    this.WebPDecodeRGBA = function(t5, n3, s3, u4, c4) {
      var l4 = qr, h4 = new en(), f4 = new ot2();
      h4.ba = f4, f4.S = l4, f4.width = [f4.width], f4.height = [f4.height];
      var d4 = f4.width, p4 = f4.height, g4 = new st2();
      if (null == g4 || null == t5) var m4 = 2;
      else e2(null != g4), m4 = Bn(t5, n3, s3, g4.width, g4.height, g4.Pd, g4.Qd, g4.format, null);
      if (0 != m4 ? d4 = 0 : (null != d4 && (d4[0] = g4.width[0]), null != p4 && (p4[0] = g4.height[0]), d4 = 1), d4) {
        f4.width = f4.width[0], f4.height = f4.height[0], null != u4 && (u4[0] = f4.width), null != c4 && (c4[0] = f4.height);
        t: {
          if (u4 = new Gt2(), (c4 = new nn()).data = t5, c4.w = n3, c4.ha = s3, c4.kd = 1, n3 = [0], e2(null != c4), (0 == (t5 = Bn(c4.data, c4.w, c4.ha, null, null, null, n3, null, c4)) || 7 == t5) && n3[0] && (t5 = 4), 0 == (n3 = t5)) {
            if (e2(null != h4), u4.data = c4.data, u4.w = c4.w + c4.offset, u4.ha = c4.ha - c4.offset, u4.put = dt2, u4.ac = ft2, u4.bc = pt2, u4.ma = h4, c4.xa) {
              if (null == (t5 = kt2())) {
                h4 = 1;
                break t;
              }
              if (function(t6, n4) {
                var r3 = [0], i3 = [0], a3 = [0];
                e: for (; ; ) {
                  if (null == t6) return 0;
                  if (null == n4) return t6.a = 2, 0;
                  if (t6.l = n4, t6.a = 0, v3(t6.m, n4.data, n4.w, n4.ha), !gt2(t6.m, r3, i3, a3)) {
                    t6.a = 3;
                    break e;
                  }
                  if (t6.xb = pi, n4.width = r3[0], n4.height = i3[0], !Ft2(r3[0], i3[0], 1, t6, null)) break e;
                  return 1;
                }
                return e2(0 != t6.a), 0;
              }(t5, u4)) {
                if (u4 = 0 == (n3 = En(u4.width, u4.height, h4.Oa, h4.ba))) {
                  e: {
                    u4 = t5;
                    n: for (; ; ) {
                      if (null == u4) {
                        u4 = 0;
                        break e;
                      }
                      if (e2(null != u4.s.yc), e2(null != u4.s.Ya), e2(0 < u4.s.Wb), e2(null != (s3 = u4.l)), e2(null != (c4 = s3.ma)), 0 != u4.xb) {
                        if (u4.ca = c4.ba, u4.tb = c4.tb, e2(null != u4.ca), !Mn(c4.Oa, s3, Rr)) {
                          u4.a = 2;
                          break n;
                        }
                        if (!It2(u4, s3.width)) break n;
                        if (s3.da) break n;
                        if ((s3.da || rt2(u4.ca.S)) && mn(), 11 > u4.ca.S || (alert("todo:WebPInitConvertARGBToYUV"), null != u4.ca.f.kb.F && mn()), u4.Pb && 0 < u4.s.ua && null == u4.s.vb.X && !O2(u4.s.vb, u4.s.Wa.Xa)) {
                          u4.a = 1;
                          break n;
                        }
                        u4.xb = 0;
                      }
                      if (!_t2(u4, u4.V, u4.Ba, u4.c, u4.i, s3.o, Lt2)) break n;
                      c4.Dc = u4.Ma, u4 = 1;
                      break e;
                    }
                    e2(0 != u4.a), u4 = 0;
                  }
                  u4 = !u4;
                }
                u4 && (n3 = t5.a);
              } else n3 = t5.a;
            } else {
              if (null == (t5 = new Yt2())) {
                h4 = 1;
                break t;
              }
              if (t5.Fa = c4.na, t5.P = c4.P, t5.qc = c4.Sa, Kt2(t5, u4)) {
                if (0 == (n3 = En(u4.width, u4.height, h4.Oa, h4.ba))) {
                  if (t5.Aa = 0, s3 = h4.Oa, e2(null != (c4 = t5)), null != s3) {
                    if (0 < (d4 = 0 > (d4 = s3.Md) ? 0 : 100 < d4 ? 255 : 255 * d4 / 100)) {
                      for (p4 = g4 = 0; 4 > p4; ++p4) 12 > (m4 = c4.pb[p4]).lc && (m4.ia = d4 * Di[0 > m4.lc ? 0 : m4.lc] >> 3), g4 |= m4.ia;
                      g4 && (alert("todo:VP8InitRandom"), c4.ia = 1);
                    }
                    c4.Ga = s3.Id, 100 < c4.Ga ? c4.Ga = 100 : 0 > c4.Ga && (c4.Ga = 0);
                  }
                  (function(t6, n4) {
                    if (null == t6) return 0;
                    if (null == n4) return Jt2(t6, 2, "NULL VP8Io parameter in VP8Decode().");
                    if (!t6.cb && !Kt2(t6, n4)) return 0;
                    if (e2(t6.cb), null == n4.ac || n4.ac(n4)) {
                      n4.ob && (t6.L = 0);
                      var s4 = Ri[t6.L];
                      if (2 == t6.L ? (t6.yb = 0, t6.zb = 0) : (t6.yb = n4.v - s4 >> 4, t6.zb = n4.j - s4 >> 4, 0 > t6.yb && (t6.yb = 0), 0 > t6.zb && (t6.zb = 0)), t6.Va = n4.o + 15 + s4 >> 4, t6.Hb = n4.va + 15 + s4 >> 4, t6.Hb > t6.za && (t6.Hb = t6.za), t6.Va > t6.Ub && (t6.Va = t6.Ub), 0 < t6.L) {
                        var u5 = t6.ed;
                        for (s4 = 0; 4 > s4; ++s4) {
                          var c5;
                          if (t6.Qa.Cb) {
                            var l5 = t6.Qa.Lb[s4];
                            t6.Qa.Fb || (l5 += u5.Tb);
                          } else l5 = u5.Tb;
                          for (c5 = 0; 1 >= c5; ++c5) {
                            var h5 = t6.gd[s4][c5], f5 = l5;
                            if (u5.Pc && (f5 += u5.vd[0], c5 && (f5 += u5.od[0])), 0 < (f5 = 0 > f5 ? 0 : 63 < f5 ? 63 : f5)) {
                              var d5 = f5;
                              0 < u5.wb && (d5 = 4 < u5.wb ? d5 >> 2 : d5 >> 1) > 9 - u5.wb && (d5 = 9 - u5.wb), 1 > d5 && (d5 = 1), h5.dd = d5, h5.tc = 2 * f5 + d5, h5.ld = 40 <= f5 ? 2 : 15 <= f5 ? 1 : 0;
                            } else h5.tc = 0;
                            h5.La = c5;
                          }
                        }
                      }
                      s4 = 0;
                    } else Jt2(t6, 6, "Frame setup failed"), s4 = t6.a;
                    if (s4 = 0 == s4) {
                      if (s4) {
                        t6.$c = 0, 0 < t6.Aa || (t6.Ic = Ti);
                        e: {
                          s4 = t6.Ic, u5 = 4 * (d5 = t6.za);
                          var p5 = 32 * d5, g5 = d5 + 1, m5 = 0 < t6.L ? d5 * (0 < t6.Aa ? 2 : 1) : 0, v4 = (2 == t6.Aa ? 2 : 1) * d5;
                          if ((h5 = u5 + 832 + (c5 = 3 * (16 * s4 + Ri[t6.L]) / 2 * p5) + (l5 = null != t6.Fa && 0 < t6.Fa.length ? t6.Kc.c * t6.Kc.i : 0)) != h5) s4 = 0;
                          else {
                            if (h5 > t6.Vb) {
                              if (t6.Vb = 0, t6.Ec = a2(h5), t6.Fc = 0, null == t6.Ec) {
                                s4 = Jt2(t6, 1, "no memory during frame initialization.");
                                break e;
                              }
                              t6.Vb = h5;
                            }
                            h5 = t6.Ec, f5 = t6.Fc, t6.Ac = h5, t6.Bc = f5, f5 += u5, t6.Gd = o2(p5, Ht2), t6.Hd = 0, t6.rb = o2(g5 + 1, Dt2), t6.sb = 1, t6.wa = m5 ? o2(m5, Rt2) : null, t6.Y = 0, t6.D.Nb = 0, t6.D.wa = t6.wa, t6.D.Y = t6.Y, 0 < t6.Aa && (t6.D.Y += d5), e2(true), t6.oc = h5, t6.pc = f5, f5 += 832, t6.ya = o2(v4, zt2), t6.aa = 0, t6.D.ya = t6.ya, t6.D.aa = t6.aa, 2 == t6.Aa && (t6.D.aa += d5), t6.R = 16 * d5, t6.B = 8 * d5, d5 = (p5 = Ri[t6.L]) * t6.R, p5 = p5 / 2 * t6.B, t6.sa = h5, t6.ta = f5 + d5, t6.qa = t6.sa, t6.ra = t6.ta + 16 * s4 * t6.R + p5, t6.Ha = t6.qa, t6.Ia = t6.ra + 8 * s4 * t6.B + p5, t6.$c = 0, f5 += c5, t6.mb = l5 ? h5 : null, t6.nb = l5 ? f5 : null, e2(f5 + l5 <= t6.Fc + t6.Vb), $t2(t6), i2(t6.Ac, t6.Bc, 0, u5), s4 = 1;
                          }
                        }
                        if (s4) {
                          if (n4.ka = 0, n4.y = t6.sa, n4.O = t6.ta, n4.f = t6.qa, n4.N = t6.ra, n4.ea = t6.Ha, n4.Vd = t6.Ia, n4.fa = t6.R, n4.Rc = t6.B, n4.F = null, n4.J = 0, !Ir) {
                            for (s4 = -255; 255 >= s4; ++s4) _r[255 + s4] = 0 > s4 ? -s4 : s4;
                            for (s4 = -1020; 1020 >= s4; ++s4) Pr[1020 + s4] = -128 > s4 ? -128 : 127 < s4 ? 127 : s4;
                            for (s4 = -112; 112 >= s4; ++s4) kr[112 + s4] = -16 > s4 ? -16 : 15 < s4 ? 15 : s4;
                            for (s4 = -255; 510 >= s4; ++s4) Fr[255 + s4] = 0 > s4 ? 0 : 255 < s4 ? 255 : s4;
                            Ir = 1;
                          }
                          ir = ue2, ar = ie2, sr = ae2, ur = oe2, cr = se2, or = re2, lr = Ye, hr = Je, fr = Ze, dr = $e, pr = Xe, gr = Ke, mr = Qe, vr = tn, br = ze, yr = Ue, wr = He, Nr = We, hi[0] = xe2, hi[1] = le2, hi[2] = Ne2, hi[3] = Le2, hi[4] = Ae2, hi[5] = _e2, hi[6] = Se2, hi[7] = Pe2, hi[8] = Fe2, hi[9] = ke2, li[0] = me2, li[1] = fe2, li[2] = de2, li[3] = pe2, li[4] = ve2, li[5] = be2, li[6] = ye2, fi[0] = Oe, fi[1] = he2, fi[2] = Ie2, fi[3] = je2, fi[4] = Me, fi[5] = Be, fi[6] = qe, s4 = 1;
                        } else s4 = 0;
                      }
                      s4 && (s4 = function(t7, n5) {
                        for (t7.M = 0; t7.M < t7.Va; ++t7.M) {
                          var o3, s5 = t7.Jc[t7.M & t7.Xb], u6 = t7.m, c6 = t7;
                          for (o3 = 0; o3 < c6.za; ++o3) {
                            var l6 = u6, h6 = c6, f6 = h6.Ac, d6 = h6.Bc + 4 * o3, p6 = h6.zc, g6 = h6.ya[h6.aa + o3];
                            if (h6.Qa.Bb ? g6.$b = k2(l6, h6.Pa.jb[0]) ? 2 + k2(l6, h6.Pa.jb[2]) : k2(l6, h6.Pa.jb[1]) : g6.$b = 0, h6.kc && (g6.Ad = k2(l6, h6.Bd)), g6.Za = !k2(l6, 145) + 0, g6.Za) {
                              var m6 = g6.Ob, v5 = 0;
                              for (h6 = 0; 4 > h6; ++h6) {
                                var b4, y4 = p6[0 + h6];
                                for (b4 = 0; 4 > b4; ++b4) {
                                  y4 = si[f6[d6 + b4]][y4];
                                  for (var w4 = ai[k2(l6, y4[0])]; 0 < w4; ) w4 = ai[2 * w4 + k2(l6, y4[w4])];
                                  y4 = -w4, f6[d6 + b4] = y4;
                                }
                                r2(m6, v5, f6, d6, 4), v5 += 4, p6[0 + h6] = y4;
                              }
                            } else y4 = k2(l6, 156) ? k2(l6, 128) ? 1 : 3 : k2(l6, 163) ? 2 : 0, g6.Ob[0] = y4, i2(f6, d6, y4, 4), i2(p6, 0, y4, 4);
                            g6.Dd = k2(l6, 142) ? k2(l6, 114) ? k2(l6, 183) ? 1 : 3 : 2 : 0;
                          }
                          if (c6.m.Ka) return Jt2(t7, 7, "Premature end-of-partition0 encountered.");
                          for (; t7.ja < t7.za; ++t7.ja) {
                            if (c6 = s5, l6 = (u6 = t7).rb[u6.sb - 1], f6 = u6.rb[u6.sb + u6.ja], o3 = u6.ya[u6.aa + u6.ja], d6 = u6.kc ? o3.Ad : 0) l6.la = f6.la = 0, o3.Za || (l6.Na = f6.Na = 0), o3.Hc = 0, o3.Gc = 0, o3.ia = 0;
                            else {
                              var N4, L4;
                              if (l6 = f6, f6 = c6, d6 = u6.Pa.Xc, p6 = u6.ya[u6.aa + u6.ja], g6 = u6.pb[p6.$b], h6 = p6.ad, m6 = 0, v5 = u6.rb[u6.sb - 1], y4 = b4 = 0, i2(h6, m6, 0, 384), p6.Za) var x4 = 0, A4 = d6[3];
                              else {
                                w4 = a2(16);
                                var S3 = l6.Na + v5.Na;
                                if (S3 = ni(f6, d6[1], S3, g6.Eb, 0, w4, 0), l6.Na = v5.Na = (0 < S3) + 0, 1 < S3) ir(w4, 0, h6, m6);
                                else {
                                  var _3 = w4[0] + 3 >> 3;
                                  for (w4 = 0; 256 > w4; w4 += 16) h6[m6 + w4] = _3;
                                }
                                x4 = 1, A4 = d6[0];
                              }
                              var P3 = 15 & l6.la, F3 = 15 & v5.la;
                              for (w4 = 0; 4 > w4; ++w4) {
                                var I3 = 1 & F3;
                                for (_3 = L4 = 0; 4 > _3; ++_3) P3 = P3 >> 1 | (I3 = (S3 = ni(f6, A4, S3 = I3 + (1 & P3), g6.Sc, x4, h6, m6)) > x4) << 7, L4 = L4 << 2 | (3 < S3 ? 3 : 1 < S3 ? 2 : 0 != h6[m6 + 0]), m6 += 16;
                                P3 >>= 4, F3 = F3 >> 1 | I3 << 7, b4 = (b4 << 8 | L4) >>> 0;
                              }
                              for (A4 = P3, x4 = F3 >> 4, N4 = 0; 4 > N4; N4 += 2) {
                                for (L4 = 0, P3 = l6.la >> 4 + N4, F3 = v5.la >> 4 + N4, w4 = 0; 2 > w4; ++w4) {
                                  for (I3 = 1 & F3, _3 = 0; 2 > _3; ++_3) S3 = I3 + (1 & P3), P3 = P3 >> 1 | (I3 = 0 < (S3 = ni(f6, d6[2], S3, g6.Qc, 0, h6, m6))) << 3, L4 = L4 << 2 | (3 < S3 ? 3 : 1 < S3 ? 2 : 0 != h6[m6 + 0]), m6 += 16;
                                  P3 >>= 2, F3 = F3 >> 1 | I3 << 5;
                                }
                                y4 |= L4 << 4 * N4, A4 |= P3 << 4 << N4, x4 |= (240 & F3) << N4;
                              }
                              l6.la = A4, v5.la = x4, p6.Hc = b4, p6.Gc = y4, p6.ia = 43690 & y4 ? 0 : g6.ia, d6 = !(b4 | y4);
                            }
                            if (0 < u6.L && (u6.wa[u6.Y + u6.ja] = u6.gd[o3.$b][o3.Za], u6.wa[u6.Y + u6.ja].La |= !d6), c6.Ka) return Jt2(t7, 7, "Premature end-of-file encountered.");
                          }
                          if ($t2(t7), u6 = n5, c6 = 1, o3 = (s5 = t7).D, l6 = 0 < s5.L && s5.M >= s5.zb && s5.M <= s5.Va, 0 == s5.Aa) e: {
                            if (o3.M = s5.M, o3.uc = l6, On(s5, o3), c6 = 1, o3 = (L4 = s5.D).Nb, l6 = (y4 = Ri[s5.L]) * s5.R, f6 = y4 / 2 * s5.B, w4 = 16 * o3 * s5.R, _3 = 8 * o3 * s5.B, d6 = s5.sa, p6 = s5.ta - l6 + w4, g6 = s5.qa, h6 = s5.ra - f6 + _3, m6 = s5.Ha, v5 = s5.Ia - f6 + _3, F3 = 0 == (P3 = L4.M), b4 = P3 >= s5.Va - 1, 2 == s5.Aa && On(s5, L4), L4.uc) for (I3 = (S3 = s5).D.M, e2(S3.D.uc), L4 = S3.yb; L4 < S3.Hb; ++L4) {
                              x4 = L4, A4 = I3;
                              var j3 = (C3 = (z3 = S3).D).Nb;
                              N4 = z3.R;
                              var C3 = C3.wa[C3.Y + x4], O3 = z3.sa, B3 = z3.ta + 16 * j3 * N4 + 16 * x4, M3 = C3.dd, q3 = C3.tc;
                              if (0 != q3) if (e2(3 <= q3), 1 == z3.L) 0 < x4 && yr(O3, B3, N4, q3 + 4), C3.La && Nr(O3, B3, N4, q3), 0 < A4 && br(O3, B3, N4, q3 + 4), C3.La && wr(O3, B3, N4, q3);
                              else {
                                var E3 = z3.B, R3 = z3.qa, D3 = z3.ra + 8 * j3 * E3 + 8 * x4, T3 = z3.Ha, z3 = z3.Ia + 8 * j3 * E3 + 8 * x4;
                                j3 = C3.ld, 0 < x4 && (hr(O3, B3, N4, q3 + 4, M3, j3), dr(R3, D3, T3, z3, E3, q3 + 4, M3, j3)), C3.La && (gr(O3, B3, N4, q3, M3, j3), vr(R3, D3, T3, z3, E3, q3, M3, j3)), 0 < A4 && (lr(O3, B3, N4, q3 + 4, M3, j3), fr(R3, D3, T3, z3, E3, q3 + 4, M3, j3)), C3.La && (pr(O3, B3, N4, q3, M3, j3), mr(R3, D3, T3, z3, E3, q3, M3, j3));
                              }
                            }
                            if (s5.ia && alert("todo:DitherRow"), null != u6.put) {
                              if (L4 = 16 * P3, P3 = 16 * (P3 + 1), F3 ? (u6.y = s5.sa, u6.O = s5.ta + w4, u6.f = s5.qa, u6.N = s5.ra + _3, u6.ea = s5.Ha, u6.W = s5.Ia + _3) : (L4 -= y4, u6.y = d6, u6.O = p6, u6.f = g6, u6.N = h6, u6.ea = m6, u6.W = v5), b4 || (P3 -= y4), P3 > u6.o && (P3 = u6.o), u6.F = null, u6.J = null, null != s5.Fa && 0 < s5.Fa.length && L4 < P3 && (u6.J = hn(s5, u6, L4, P3 - L4), u6.F = s5.mb, null == u6.F && 0 == u6.F.length)) {
                                c6 = Jt2(s5, 3, "Could not decode alpha data.");
                                break e;
                              }
                              L4 < u6.j && (y4 = u6.j - L4, L4 = u6.j, e2(!(1 & y4)), u6.O += s5.R * y4, u6.N += s5.B * (y4 >> 1), u6.W += s5.B * (y4 >> 1), null != u6.F && (u6.J += u6.width * y4)), L4 < P3 && (u6.O += u6.v, u6.N += u6.v >> 1, u6.W += u6.v >> 1, null != u6.F && (u6.J += u6.v), u6.ka = L4 - u6.j, u6.U = u6.va - u6.v, u6.T = P3 - L4, c6 = u6.put(u6));
                            }
                            o3 + 1 != s5.Ic || b4 || (r2(s5.sa, s5.ta - l6, d6, p6 + 16 * s5.R, l6), r2(s5.qa, s5.ra - f6, g6, h6 + 8 * s5.B, f6), r2(s5.Ha, s5.Ia - f6, m6, v5 + 8 * s5.B, f6));
                          }
                          if (!c6) return Jt2(t7, 6, "Output aborted.");
                        }
                        return 1;
                      }(t6, n4)), null != n4.bc && n4.bc(n4), s4 &= 1;
                    }
                    return s4 ? (t6.cb = 0, s4) : 0;
                  })(t5, u4) || (n3 = t5.a);
                }
              } else n3 = t5.a;
            }
            0 == n3 && null != h4.Oa && h4.Oa.fd && (n3 = qn(h4.ba));
          }
          h4 = n3;
        }
        l4 = 0 != h4 ? null : 11 > l4 ? f4.f.RGBA.eb : f4.f.kb.y;
      } else l4 = null;
      return l4;
    };
    var zi = [3, 4, 3, 4, 4, 2, 2, 4, 4, 4, 2, 1, 1];
  };
  function c2(t4, e3) {
    for (var n3 = "", r3 = 0; r3 < 4; r3++) n3 += String.fromCharCode(t4[e3++]);
    return n3;
  }
  function l2(t4, e3) {
    return t4[e3 + 0] | t4[e3 + 1] << 8;
  }
  function h2(t4, e3) {
    return (t4[e3 + 0] | t4[e3 + 1] << 8 | t4[e3 + 2] << 16) >>> 0;
  }
  function f2(t4, e3) {
    return (t4[e3 + 0] | t4[e3 + 1] << 8 | t4[e3 + 2] << 16 | t4[e3 + 3] << 24) >>> 0;
  }
  new u2();
  var d2 = [0], p2 = [0], g2 = [], m2 = new u2(), v2 = t3, b2 = function(t4, e3) {
    var n3 = {}, r3 = 0, i3 = false, a3 = 0, o3 = 0;
    if (n3.frames = [], !/** @license
       * Copyright (c) 2017 Dominik Homberger
      Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
      The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
      https://webpjs.appspot.com
      WebPRiffParser dominikhlbg@gmail.com
      */
    function(t5, e4) {
      for (var n4 = 0; n4 < 4; n4++) if (t5[e4 + n4] != "RIFF".charCodeAt(n4)) return true;
      return false;
    }(t4, e3)) {
      for (f2(t4, e3 += 4), e3 += 8; e3 < t4.length; ) {
        var s3 = c2(t4, e3), u3 = f2(t4, e3 += 4);
        e3 += 4;
        var d3 = u3 + (1 & u3);
        switch (s3) {
          case "VP8 ":
          case "VP8L":
            void 0 === n3.frames[r3] && (n3.frames[r3] = {}), (m3 = n3.frames[r3]).src_off = i3 ? o3 : e3 - 8, m3.src_size = a3 + u3 + 8, r3++, i3 && (i3 = false, a3 = 0, o3 = 0);
            break;
          case "VP8X":
            (m3 = n3.header = {}).feature_flags = t4[e3];
            var p3 = e3 + 4;
            m3.canvas_width = 1 + h2(t4, p3), p3 += 3, m3.canvas_height = 1 + h2(t4, p3), p3 += 3;
            break;
          case "ALPH":
            i3 = true, a3 = d3 + 8, o3 = e3 - 8;
            break;
          case "ANIM":
            (m3 = n3.header).bgcolor = f2(t4, e3), p3 = e3 + 4, m3.loop_count = l2(t4, p3), p3 += 2;
            break;
          case "ANMF":
            var g3, m3;
            (m3 = n3.frames[r3] = {}).offset_x = 2 * h2(t4, e3), e3 += 3, m3.offset_y = 2 * h2(t4, e3), e3 += 3, m3.width = 1 + h2(t4, e3), e3 += 3, m3.height = 1 + h2(t4, e3), e3 += 3, m3.duration = h2(t4, e3), e3 += 3, g3 = t4[e3++], m3.dispose = 1 & g3, m3.blend = g3 >> 1 & 1;
        }
        "ANMF" != s3 && (e3 += d3);
      }
      return n3;
    }
  }(v2, 0);
  b2.response = v2, b2.rgbaoutput = true, b2.dataurl = false;
  var y2 = b2.header ? b2.header : null, w2 = b2.frames ? b2.frames : null;
  if (y2) {
    y2.loop_counter = y2.loop_count, d2 = [y2.canvas_height], p2 = [y2.canvas_width];
    for (var N2 = 0; N2 < w2.length && 0 != w2[N2].blend; N2++) ;
  }
  var L2 = w2[0], x2 = m2.WebPDecodeRGBA(v2, L2.src_off, L2.src_size, p2, d2);
  L2.rgba = x2, L2.imgwidth = p2[0], L2.imgheight = d2[0];
  for (var A2 = 0; A2 < p2[0] * d2[0] * 4; A2++) g2[A2] = x2[A2];
  return this.width = p2, this.height = d2, this.data = g2, this;
}
!function(e2) {
  var n2, r2, i2, a2, s2, u2, c2, l2, f2, d2 = function(t3) {
    return t3 = t3 || {}, this.isStrokeTransparent = t3.isStrokeTransparent || false, this.strokeOpacity = t3.strokeOpacity || 1, this.strokeStyle = t3.strokeStyle || "#000000", this.fillStyle = t3.fillStyle || "#000000", this.isFillTransparent = t3.isFillTransparent || false, this.fillOpacity = t3.fillOpacity || 1, this.font = t3.font || "10px sans-serif", this.textBaseline = t3.textBaseline || "alphabetic", this.textAlign = t3.textAlign || "left", this.lineWidth = t3.lineWidth || 1, this.lineJoin = t3.lineJoin || "miter", this.lineCap = t3.lineCap || "butt", this.path = t3.path || [], this.transform = void 0 !== t3.transform ? t3.transform.clone() : new l2(), this.globalCompositeOperation = t3.globalCompositeOperation || "normal", this.globalAlpha = t3.globalAlpha || 1, this.clip_path = t3.clip_path || [], this.currentPoint = t3.currentPoint || new u2(), this.miterLimit = t3.miterLimit || 10, this.lastPoint = t3.lastPoint || new u2(), this.lineDashOffset = t3.lineDashOffset || 0, this.lineDash = t3.lineDash || [], this.margin = t3.margin || [0, 0, 0, 0], this.prevPageLastElemOffset = t3.prevPageLastElemOffset || 0, this.ignoreClearRect = "boolean" != typeof t3.ignoreClearRect || t3.ignoreClearRect, this;
  };
  e2.events.push(["initialized", function() {
    this.context2d = new p2(this), n2 = this.internal.f2, r2 = this.internal.getCoordinateString, i2 = this.internal.getVerticalCoordinateString, a2 = this.internal.getHorizontalCoordinate, s2 = this.internal.getVerticalCoordinate, u2 = this.internal.Point, c2 = this.internal.Rectangle, l2 = this.internal.Matrix, f2 = new d2();
  }]);
  var p2 = function(t3) {
    Object.defineProperty(this, "canvas", { get: function() {
      return { parentNode: false, style: false };
    } });
    var e3 = t3;
    Object.defineProperty(this, "pdf", { get: function() {
      return e3;
    } });
    var n3 = false;
    Object.defineProperty(this, "pageWrapXEnabled", { get: function() {
      return n3;
    }, set: function(t4) {
      n3 = Boolean(t4);
    } });
    var r3 = false;
    Object.defineProperty(this, "pageWrapYEnabled", { get: function() {
      return r3;
    }, set: function(t4) {
      r3 = Boolean(t4);
    } });
    var i3 = 0;
    Object.defineProperty(this, "posX", { get: function() {
      return i3;
    }, set: function(t4) {
      isNaN(t4) || (i3 = t4);
    } });
    var a3 = 0;
    Object.defineProperty(this, "posY", { get: function() {
      return a3;
    }, set: function(t4) {
      isNaN(t4) || (a3 = t4);
    } }), Object.defineProperty(this, "margin", { get: function() {
      return f2.margin;
    }, set: function(t4) {
      var e4;
      "number" == typeof t4 ? e4 = [t4, t4, t4, t4] : ((e4 = new Array(4))[0] = t4[0], e4[1] = t4.length >= 2 ? t4[1] : e4[0], e4[2] = t4.length >= 3 ? t4[2] : e4[0], e4[3] = t4.length >= 4 ? t4[3] : e4[1]), f2.margin = e4;
    } });
    var o2 = false;
    Object.defineProperty(this, "autoPaging", { get: function() {
      return o2;
    }, set: function(t4) {
      o2 = t4;
    } });
    var s3 = 0;
    Object.defineProperty(this, "lastBreak", { get: function() {
      return s3;
    }, set: function(t4) {
      s3 = t4;
    } });
    var u3 = [];
    Object.defineProperty(this, "pageBreaks", { get: function() {
      return u3;
    }, set: function(t4) {
      u3 = t4;
    } }), Object.defineProperty(this, "ctx", { get: function() {
      return f2;
    }, set: function(t4) {
      t4 instanceof d2 && (f2 = t4);
    } }), Object.defineProperty(this, "path", { get: function() {
      return f2.path;
    }, set: function(t4) {
      f2.path = t4;
    } });
    var c3 = [];
    Object.defineProperty(this, "ctxStack", { get: function() {
      return c3;
    }, set: function(t4) {
      c3 = t4;
    } }), Object.defineProperty(this, "fillStyle", { get: function() {
      return this.ctx.fillStyle;
    }, set: function(t4) {
      var e4;
      e4 = g2(t4), this.ctx.fillStyle = e4.style, this.ctx.isFillTransparent = 0 === e4.a, this.ctx.fillOpacity = e4.a, this.pdf.setFillColor(e4.r, e4.g, e4.b, { a: e4.a }), this.pdf.setTextColor(e4.r, e4.g, e4.b, { a: e4.a });
    } }), Object.defineProperty(this, "strokeStyle", { get: function() {
      return this.ctx.strokeStyle;
    }, set: function(t4) {
      var e4 = g2(t4);
      this.ctx.strokeStyle = e4.style, this.ctx.isStrokeTransparent = 0 === e4.a, this.ctx.strokeOpacity = e4.a, 0 === e4.a ? this.pdf.setDrawColor(255, 255, 255) : (e4.a, this.pdf.setDrawColor(e4.r, e4.g, e4.b));
    } }), Object.defineProperty(this, "lineCap", { get: function() {
      return this.ctx.lineCap;
    }, set: function(t4) {
      -1 !== ["butt", "round", "square"].indexOf(t4) && (this.ctx.lineCap = t4, this.pdf.setLineCap(t4));
    } }), Object.defineProperty(this, "lineWidth", { get: function() {
      return this.ctx.lineWidth;
    }, set: function(t4) {
      isNaN(t4) || (this.ctx.lineWidth = t4, this.pdf.setLineWidth(t4));
    } }), Object.defineProperty(this, "lineJoin", { get: function() {
      return this.ctx.lineJoin;
    }, set: function(t4) {
      -1 !== ["bevel", "round", "miter"].indexOf(t4) && (this.ctx.lineJoin = t4, this.pdf.setLineJoin(t4));
    } }), Object.defineProperty(this, "miterLimit", { get: function() {
      return this.ctx.miterLimit;
    }, set: function(t4) {
      isNaN(t4) || (this.ctx.miterLimit = t4, this.pdf.setMiterLimit(t4));
    } }), Object.defineProperty(this, "textBaseline", { get: function() {
      return this.ctx.textBaseline;
    }, set: function(t4) {
      this.ctx.textBaseline = t4;
    } }), Object.defineProperty(this, "textAlign", { get: function() {
      return this.ctx.textAlign;
    }, set: function(t4) {
      -1 !== ["right", "end", "center", "left", "start"].indexOf(t4) && (this.ctx.textAlign = t4);
    } });
    var l3 = null, h2 = null;
    var p3 = null;
    Object.defineProperty(this, "fontFaces", { get: function() {
      return p3;
    }, set: function(t4) {
      l3 = null, h2 = null, p3 = t4;
    } }), Object.defineProperty(this, "font", { get: function() {
      return this.ctx.font;
    }, set: function(t4) {
      var e4;
      if (this.ctx.font = t4, null !== (e4 = /^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(t4))) {
        var n4 = e4[1];
        e4[2];
        var r4 = e4[3], i4 = e4[4];
        e4[5];
        var a4 = e4[6], o3 = /^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(i4)[2];
        i4 = "px" === o3 ? Math.floor(parseFloat(i4) * this.pdf.internal.scaleFactor) : "em" === o3 ? Math.floor(parseFloat(i4) * this.pdf.getFontSize()) : Math.floor(parseFloat(i4) * this.pdf.internal.scaleFactor), this.pdf.setFontSize(i4);
        var s4 = function(t5) {
          var e5, n5, r5 = [], i5 = t5.trim();
          if ("" === i5) return Jt;
          if (i5 in Mt) return [Mt[i5]];
          for (; "" !== i5; ) {
            switch (n5 = null, e5 = (i5 = Et(i5)).charAt(0)) {
              case '"':
              case "'":
                n5 = Rt(i5.substring(1), e5);
                break;
              default:
                n5 = Dt(i5);
            }
            if (null === n5) return Jt;
            if (r5.push(n5[0]), "" !== (i5 = Et(n5[1])) && "," !== i5.charAt(0)) return Jt;
            i5 = i5.replace(/^,/, "");
          }
          return r5;
        }(a4);
        if (this.fontFaces) {
          var u4 = function(t5, e5) {
            var n5 = t5.getFontList(), r5 = JSON.stringify(n5);
            if (null === l3 || h2 !== r5) {
              var i5 = function(t6) {
                var e6 = [];
                return Object.keys(t6).forEach(function(n6) {
                  t6[n6].forEach(function(t7) {
                    var r6 = null;
                    switch (t7) {
                      case "bold":
                        r6 = { family: n6, weight: "bold" };
                        break;
                      case "italic":
                        r6 = { family: n6, style: "italic" };
                        break;
                      case "bolditalic":
                        r6 = { family: n6, weight: "bold", style: "italic" };
                        break;
                      case "":
                      case "normal":
                        r6 = { family: n6 };
                    }
                    null !== r6 && (r6.ref = { name: n6, style: t7 }, e6.push(r6));
                  });
                }), e6;
              }(n5);
              l3 = function(t6) {
                for (var e6 = {}, n6 = 0; n6 < t6.length; ++n6) {
                  var r6 = Ct(t6[n6]), i6 = r6.family, a5 = r6.stretch, o4 = r6.style, s5 = r6.weight;
                  e6[i6] = e6[i6] || {}, e6[i6][a5] = e6[i6][a5] || {}, e6[i6][a5][o4] = e6[i6][a5][o4] || {}, e6[i6][a5][o4][s5] = r6;
                }
                return e6;
              }(i5.concat(e5)), h2 = r5;
            }
            return l3;
          }(this.pdf, this.fontFaces), c4 = s4.map(function(t5) {
            return { family: t5, stretch: "normal", weight: r4, style: n4 };
          }), f3 = function(t5, e5, n5) {
            for (var r5 = (n5 = n5 || {}).defaultFontFamily || "times", i5 = Object.assign({}, Bt, n5.genericFontFamilies || {}), a5 = null, o4 = null, s5 = 0; s5 < e5.length; ++s5) if (i5[(a5 = Ct(e5[s5])).family] && (a5.family = i5[a5.family]), t5.hasOwnProperty(a5.family)) {
              o4 = t5[a5.family];
              break;
            }
            if (!(o4 = o4 || t5[r5])) throw new Error("Could not find a font-family for the rule '" + qt(a5) + "' and default family '" + r5 + "'.");
            if (o4 = function(t6, e6) {
              if (e6[t6]) return e6[t6];
              var n6 = Ft[t6], r6 = n6 <= Ft.normal ? -1 : 1, i6 = Ot(e6, kt, n6, r6);
              if (!i6) throw new Error("Could not find a matching font-stretch value for " + t6);
              return i6;
            }(a5.stretch, o4), o4 = function(t6, e6) {
              if (e6[t6]) return e6[t6];
              for (var n6 = Pt[t6], r6 = 0; r6 < n6.length; ++r6) if (e6[n6[r6]]) return e6[n6[r6]];
              throw new Error("Could not find a matching font-style for " + t6);
            }(a5.style, o4), !(o4 = function(t6, e6) {
              if (e6[t6]) return e6[t6];
              if (400 === t6 && e6[500]) return e6[500];
              if (500 === t6 && e6[400]) return e6[400];
              var n6 = jt[t6], r6 = Ot(e6, It, n6, t6 < 400 ? -1 : 1);
              if (!r6) throw new Error("Could not find a matching font-weight for value " + t6);
              return r6;
            }(a5.weight, o4))) throw new Error("Failed to resolve a font for the rule '" + qt(a5) + "'.");
            return o4;
          }(u4, c4);
          this.pdf.setFont(f3.ref.name, f3.ref.style);
        } else {
          var d3 = "";
          ("bold" === r4 || parseInt(r4, 10) >= 700 || "bold" === n4) && (d3 = "bold"), "italic" === n4 && (d3 += "italic"), 0 === d3.length && (d3 = "normal");
          for (var p4 = "", g3 = { arial: "Helvetica", Arial: "Helvetica", verdana: "Helvetica", Verdana: "Helvetica", helvetica: "Helvetica", Helvetica: "Helvetica", "sans-serif": "Helvetica", fixed: "Courier", monospace: "Courier", terminal: "Courier", cursive: "Times", fantasy: "Times", serif: "Times" }, m3 = 0; m3 < s4.length; m3++) {
            if (void 0 !== this.pdf.internal.getFont(s4[m3], d3, { noFallback: true, disableWarning: true })) {
              p4 = s4[m3];
              break;
            }
            if ("bolditalic" === d3 && void 0 !== this.pdf.internal.getFont(s4[m3], "bold", { noFallback: true, disableWarning: true })) p4 = s4[m3], d3 = "bold";
            else if (void 0 !== this.pdf.internal.getFont(s4[m3], "normal", { noFallback: true, disableWarning: true })) {
              p4 = s4[m3], d3 = "normal";
              break;
            }
          }
          if ("" === p4) {
            for (var v3 = 0; v3 < s4.length; v3++) if (g3[s4[v3]]) {
              p4 = g3[s4[v3]];
              break;
            }
          }
          p4 = "" === p4 ? "Times" : p4, this.pdf.setFont(p4, d3);
        }
      }
    } }), Object.defineProperty(this, "globalCompositeOperation", { get: function() {
      return this.ctx.globalCompositeOperation;
    }, set: function(t4) {
      this.ctx.globalCompositeOperation = t4;
    } }), Object.defineProperty(this, "globalAlpha", { get: function() {
      return this.ctx.globalAlpha;
    }, set: function(t4) {
      this.ctx.globalAlpha = t4;
    } }), Object.defineProperty(this, "lineDashOffset", { get: function() {
      return this.ctx.lineDashOffset;
    }, set: function(t4) {
      this.ctx.lineDashOffset = t4, T2.call(this);
    } }), Object.defineProperty(this, "lineDash", { get: function() {
      return this.ctx.lineDash;
    }, set: function(t4) {
      this.ctx.lineDash = t4, T2.call(this);
    } }), Object.defineProperty(this, "ignoreClearRect", { get: function() {
      return this.ctx.ignoreClearRect;
    }, set: function(t4) {
      this.ctx.ignoreClearRect = Boolean(t4);
    } });
  };
  p2.prototype.setLineDash = function(t3) {
    this.lineDash = t3;
  }, p2.prototype.getLineDash = function() {
    return this.lineDash.length % 2 ? this.lineDash.concat(this.lineDash) : this.lineDash.slice();
  }, p2.prototype.fill = function() {
    x2.call(this, "fill", false);
  }, p2.prototype.stroke = function() {
    x2.call(this, "stroke", false);
  }, p2.prototype.beginPath = function() {
    this.path = [{ type: "begin" }];
  }, p2.prototype.moveTo = function(t3, e3) {
    if (isNaN(t3) || isNaN(e3)) throw o.error("jsPDF.context2d.moveTo: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.moveTo");
    var n3 = this.ctx.transform.applyToPoint(new u2(t3, e3));
    this.path.push({ type: "mt", x: n3.x, y: n3.y }), this.ctx.lastPoint = new u2(t3, e3);
  }, p2.prototype.closePath = function() {
    var e3 = new u2(0, 0), n3 = 0;
    for (n3 = this.path.length - 1; -1 !== n3; n3--) if ("begin" === this.path[n3].type && "object" === _typeof(this.path[n3 + 1]) && "number" == typeof this.path[n3 + 1].x) {
      e3 = new u2(this.path[n3 + 1].x, this.path[n3 + 1].y);
      break;
    }
    this.path.push({ type: "close" }), this.ctx.lastPoint = new u2(e3.x, e3.y);
  }, p2.prototype.lineTo = function(t3, e3) {
    if (isNaN(t3) || isNaN(e3)) throw o.error("jsPDF.context2d.lineTo: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.lineTo");
    var n3 = this.ctx.transform.applyToPoint(new u2(t3, e3));
    this.path.push({ type: "lt", x: n3.x, y: n3.y }), this.ctx.lastPoint = new u2(n3.x, n3.y);
  }, p2.prototype.clip = function() {
    this.ctx.clip_path = JSON.parse(JSON.stringify(this.path)), x2.call(this, null, true);
  }, p2.prototype.quadraticCurveTo = function(t3, e3, n3, r3) {
    if (isNaN(n3) || isNaN(r3) || isNaN(t3) || isNaN(e3)) throw o.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");
    var i3 = this.ctx.transform.applyToPoint(new u2(n3, r3)), a3 = this.ctx.transform.applyToPoint(new u2(t3, e3));
    this.path.push({ type: "qct", x1: a3.x, y1: a3.y, x: i3.x, y: i3.y }), this.ctx.lastPoint = new u2(i3.x, i3.y);
  }, p2.prototype.bezierCurveTo = function(t3, e3, n3, r3, i3, a3) {
    if (isNaN(i3) || isNaN(a3) || isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3)) throw o.error("jsPDF.context2d.bezierCurveTo: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");
    var s3 = this.ctx.transform.applyToPoint(new u2(i3, a3)), c3 = this.ctx.transform.applyToPoint(new u2(t3, e3)), l3 = this.ctx.transform.applyToPoint(new u2(n3, r3));
    this.path.push({ type: "bct", x1: c3.x, y1: c3.y, x2: l3.x, y2: l3.y, x: s3.x, y: s3.y }), this.ctx.lastPoint = new u2(s3.x, s3.y);
  }, p2.prototype.arc = function(t3, e3, n3, r3, i3, a3) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3) || isNaN(i3)) throw o.error("jsPDF.context2d.arc: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.arc");
    if (a3 = Boolean(a3), !this.ctx.transform.isIdentity) {
      var s3 = this.ctx.transform.applyToPoint(new u2(t3, e3));
      t3 = s3.x, e3 = s3.y;
      var c3 = this.ctx.transform.applyToPoint(new u2(0, n3)), l3 = this.ctx.transform.applyToPoint(new u2(0, 0));
      n3 = Math.sqrt(Math.pow(c3.x - l3.x, 2) + Math.pow(c3.y - l3.y, 2));
    }
    Math.abs(i3 - r3) >= 2 * Math.PI && (r3 = 0, i3 = 2 * Math.PI), this.path.push({ type: "arc", x: t3, y: e3, radius: n3, startAngle: r3, endAngle: i3, counterclockwise: a3 });
  }, p2.prototype.arcTo = function(t3, e3, n3, r3, i3) {
    throw new Error("arcTo not implemented.");
  }, p2.prototype.rect = function(t3, e3, n3, r3) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3)) throw o.error("jsPDF.context2d.rect: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.rect");
    this.moveTo(t3, e3), this.lineTo(t3 + n3, e3), this.lineTo(t3 + n3, e3 + r3), this.lineTo(t3, e3 + r3), this.lineTo(t3, e3), this.lineTo(t3 + n3, e3), this.lineTo(t3, e3);
  }, p2.prototype.fillRect = function(t3, e3, n3, r3) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3)) throw o.error("jsPDF.context2d.fillRect: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.fillRect");
    if (!m2.call(this)) {
      var i3 = {};
      "butt" !== this.lineCap && (i3.lineCap = this.lineCap, this.lineCap = "butt"), "miter" !== this.lineJoin && (i3.lineJoin = this.lineJoin, this.lineJoin = "miter"), this.beginPath(), this.rect(t3, e3, n3, r3), this.fill(), i3.hasOwnProperty("lineCap") && (this.lineCap = i3.lineCap), i3.hasOwnProperty("lineJoin") && (this.lineJoin = i3.lineJoin);
    }
  }, p2.prototype.strokeRect = function(t3, e3, n3, r3) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3)) throw o.error("jsPDF.context2d.strokeRect: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");
    v2.call(this) || (this.beginPath(), this.rect(t3, e3, n3, r3), this.stroke());
  }, p2.prototype.clearRect = function(t3, e3, n3, r3) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3)) throw o.error("jsPDF.context2d.clearRect: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.clearRect");
    this.ignoreClearRect || (this.fillStyle = "#ffffff", this.fillRect(t3, e3, n3, r3));
  }, p2.prototype.save = function(t3) {
    t3 = "boolean" != typeof t3 || t3;
    for (var e3 = this.pdf.internal.getCurrentPageInfo().pageNumber, n3 = 0; n3 < this.pdf.internal.getNumberOfPages(); n3++) this.pdf.setPage(n3 + 1), this.pdf.internal.out("q");
    if (this.pdf.setPage(e3), t3) {
      this.ctx.fontSize = this.pdf.internal.getFontSize();
      var r3 = new d2(this.ctx);
      this.ctxStack.push(this.ctx), this.ctx = r3;
    }
  }, p2.prototype.restore = function(t3) {
    t3 = "boolean" != typeof t3 || t3;
    for (var e3 = this.pdf.internal.getCurrentPageInfo().pageNumber, n3 = 0; n3 < this.pdf.internal.getNumberOfPages(); n3++) this.pdf.setPage(n3 + 1), this.pdf.internal.out("Q");
    this.pdf.setPage(e3), t3 && 0 !== this.ctxStack.length && (this.ctx = this.ctxStack.pop(), this.fillStyle = this.ctx.fillStyle, this.strokeStyle = this.ctx.strokeStyle, this.font = this.ctx.font, this.lineCap = this.ctx.lineCap, this.lineWidth = this.ctx.lineWidth, this.lineJoin = this.ctx.lineJoin, this.lineDash = this.ctx.lineDash, this.lineDashOffset = this.ctx.lineDashOffset);
  }, p2.prototype.toDataURL = function() {
    throw new Error("toDataUrl not implemented.");
  };
  var g2 = function(t3) {
    var e3, n3, r3, i3;
    if (true === t3.isCanvasGradient && (t3 = t3.getColor()), !t3) return { r: 0, g: 0, b: 0, a: 0, style: t3 };
    if (/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(t3)) e3 = 0, n3 = 0, r3 = 0, i3 = 0;
    else {
      var a3 = /rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(t3);
      if (null !== a3) e3 = parseInt(a3[1]), n3 = parseInt(a3[2]), r3 = parseInt(a3[3]), i3 = 1;
      else if (null !== (a3 = /rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(t3))) e3 = parseInt(a3[1]), n3 = parseInt(a3[2]), r3 = parseInt(a3[3]), i3 = parseFloat(a3[4]);
      else {
        if (i3 = 1, "string" == typeof t3 && "#" !== t3.charAt(0)) {
          var o2 = new h(t3);
          t3 = o2.ok ? o2.toHex() : "#000000";
        }
        4 === t3.length ? (e3 = t3.substring(1, 2), e3 += e3, n3 = t3.substring(2, 3), n3 += n3, r3 = t3.substring(3, 4), r3 += r3) : (e3 = t3.substring(1, 3), n3 = t3.substring(3, 5), r3 = t3.substring(5, 7)), e3 = parseInt(e3, 16), n3 = parseInt(n3, 16), r3 = parseInt(r3, 16);
      }
    }
    return { r: e3, g: n3, b: r3, a: i3, style: t3 };
  }, m2 = function() {
    return this.ctx.isFillTransparent || 0 == this.globalAlpha;
  }, v2 = function() {
    return Boolean(this.ctx.isStrokeTransparent || 0 == this.globalAlpha);
  };
  p2.prototype.fillText = function(t3, e3, n3, r3) {
    if (isNaN(e3) || isNaN(n3) || "string" != typeof t3) throw o.error("jsPDF.context2d.fillText: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.fillText");
    if (r3 = isNaN(r3) ? void 0 : r3, !m2.call(this)) {
      var i3 = E2(this.ctx.transform.rotation), a3 = this.ctx.transform.scaleX;
      j2.call(this, { text: t3, x: e3, y: n3, scale: a3, angle: i3, align: this.textAlign, maxWidth: r3 });
    }
  }, p2.prototype.strokeText = function(t3, e3, n3, r3) {
    if (isNaN(e3) || isNaN(n3) || "string" != typeof t3) throw o.error("jsPDF.context2d.strokeText: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.strokeText");
    if (!v2.call(this)) {
      r3 = isNaN(r3) ? void 0 : r3;
      var i3 = E2(this.ctx.transform.rotation), a3 = this.ctx.transform.scaleX;
      j2.call(this, { text: t3, x: e3, y: n3, scale: a3, renderingMode: "stroke", angle: i3, align: this.textAlign, maxWidth: r3 });
    }
  }, p2.prototype.measureText = function(t3) {
    if ("string" != typeof t3) throw o.error("jsPDF.context2d.measureText: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.measureText");
    var e3 = this.pdf, n3 = this.pdf.internal.scaleFactor, r3 = e3.internal.getFontSize(), i3 = e3.getStringUnitWidth(t3) * r3 / e3.internal.scaleFactor;
    return new function(t4) {
      var e4 = (t4 = t4 || {}).width || 0;
      return Object.defineProperty(this, "width", { get: function() {
        return e4;
      } }), this;
    }({ width: i3 *= Math.round(96 * n3 / 72 * 1e4) / 1e4 });
  }, p2.prototype.scale = function(t3, e3) {
    if (isNaN(t3) || isNaN(e3)) throw o.error("jsPDF.context2d.scale: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.scale");
    var n3 = new l2(t3, 0, 0, e3, 0, 0);
    this.ctx.transform = this.ctx.transform.multiply(n3);
  }, p2.prototype.rotate = function(t3) {
    if (isNaN(t3)) throw o.error("jsPDF.context2d.rotate: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.rotate");
    var e3 = new l2(Math.cos(t3), Math.sin(t3), -Math.sin(t3), Math.cos(t3), 0, 0);
    this.ctx.transform = this.ctx.transform.multiply(e3);
  }, p2.prototype.translate = function(t3, e3) {
    if (isNaN(t3) || isNaN(e3)) throw o.error("jsPDF.context2d.translate: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.translate");
    var n3 = new l2(1, 0, 0, 1, t3, e3);
    this.ctx.transform = this.ctx.transform.multiply(n3);
  }, p2.prototype.transform = function(t3, e3, n3, r3, i3, a3) {
    if (isNaN(t3) || isNaN(e3) || isNaN(n3) || isNaN(r3) || isNaN(i3) || isNaN(a3)) throw o.error("jsPDF.context2d.transform: Invalid arguments", arguments), new Error("Invalid arguments passed to jsPDF.context2d.transform");
    var s3 = new l2(t3, e3, n3, r3, i3, a3);
    this.ctx.transform = this.ctx.transform.multiply(s3);
  }, p2.prototype.setTransform = function(t3, e3, n3, r3, i3, a3) {
    t3 = isNaN(t3) ? 1 : t3, e3 = isNaN(e3) ? 0 : e3, n3 = isNaN(n3) ? 0 : n3, r3 = isNaN(r3) ? 1 : r3, i3 = isNaN(i3) ? 0 : i3, a3 = isNaN(a3) ? 0 : a3, this.ctx.transform = new l2(t3, e3, n3, r3, i3, a3);
  };
  var b2 = function() {
    return this.margin[0] > 0 || this.margin[1] > 0 || this.margin[2] > 0 || this.margin[3] > 0;
  };
  p2.prototype.drawImage = function(t3, e3, n3, r3, i3, a3, o2, s3, u3) {
    var h2 = this.pdf.getImageProperties(t3), f3 = 1, d3 = 1, p3 = 1, g3 = 1;
    void 0 !== r3 && void 0 !== s3 && (p3 = s3 / r3, g3 = u3 / i3, f3 = h2.width / r3 * s3 / r3, d3 = h2.height / i3 * u3 / i3), void 0 === a3 && (a3 = e3, o2 = n3, e3 = 0, n3 = 0), void 0 !== r3 && void 0 === s3 && (s3 = r3, u3 = i3), void 0 === r3 && void 0 === s3 && (s3 = h2.width, u3 = h2.height);
    var m3 = this.ctx.transform.decompose(), v3 = E2(m3.rotate.shx), w3 = new l2(), x3 = (w3 = (w3 = (w3 = w3.multiply(m3.translate)).multiply(m3.skew)).multiply(m3.scale)).applyToRectangle(new c2(a3 - e3 * p3, o2 - n3 * g3, r3 * f3, i3 * d3));
    if (this.autoPaging) {
      for (var S3, _3 = y2.call(this, x3), P3 = [], k3 = 0; k3 < _3.length; k3 += 1) -1 === P3.indexOf(_3[k3]) && P3.push(_3[k3]);
      L2(P3);
      for (var F3 = P3[0], I3 = P3[P3.length - 1], j3 = F3; j3 < I3 + 1; j3++) {
        this.pdf.setPage(j3);
        var C3 = this.pdf.internal.pageSize.width - this.margin[3] - this.margin[1], O3 = 1 === j3 ? this.posY + this.margin[0] : this.margin[0], B3 = this.pdf.internal.pageSize.height - this.posY - this.margin[0] - this.margin[2], M3 = this.pdf.internal.pageSize.height - this.margin[0] - this.margin[2], q3 = 1 === j3 ? 0 : B3 + (j3 - 2) * M3;
        if (0 !== this.ctx.clip_path.length) {
          var R3 = this.path;
          S3 = JSON.parse(JSON.stringify(this.ctx.clip_path)), this.path = N2(S3, this.posX + this.margin[3], -q3 + O3 + this.ctx.prevPageLastElemOffset), A2.call(this, "fill", true), this.path = R3;
        }
        var D3 = JSON.parse(JSON.stringify(x3));
        D3 = N2([D3], this.posX + this.margin[3], -q3 + O3 + this.ctx.prevPageLastElemOffset)[0];
        var T3 = (j3 > F3 || j3 < I3) && b2.call(this);
        T3 && (this.pdf.saveGraphicsState(), this.pdf.rect(this.margin[3], this.margin[0], C3, M3, null).clip().discardPath()), this.pdf.addImage(t3, "JPEG", D3.x, D3.y, D3.w, D3.h, null, null, v3), T3 && this.pdf.restoreGraphicsState();
      }
    } else this.pdf.addImage(t3, "JPEG", x3.x, x3.y, x3.w, x3.h, null, null, v3);
  };
  var y2 = function(t3, e3, n3) {
    var r3 = [];
    e3 = e3 || this.pdf.internal.pageSize.width, n3 = n3 || this.pdf.internal.pageSize.height - this.margin[0] - this.margin[2];
    var i3 = this.posY + this.ctx.prevPageLastElemOffset;
    switch (t3.type) {
      default:
      case "mt":
      case "lt":
        r3.push(Math.floor((t3.y + i3) / n3) + 1);
        break;
      case "arc":
        r3.push(Math.floor((t3.y + i3 - t3.radius) / n3) + 1), r3.push(Math.floor((t3.y + i3 + t3.radius) / n3) + 1);
        break;
      case "qct":
        var a3 = R2(this.ctx.lastPoint.x, this.ctx.lastPoint.y, t3.x1, t3.y1, t3.x, t3.y);
        r3.push(Math.floor((a3.y + i3) / n3) + 1), r3.push(Math.floor((a3.y + a3.h + i3) / n3) + 1);
        break;
      case "bct":
        var o2 = D2(this.ctx.lastPoint.x, this.ctx.lastPoint.y, t3.x1, t3.y1, t3.x2, t3.y2, t3.x, t3.y);
        r3.push(Math.floor((o2.y + i3) / n3) + 1), r3.push(Math.floor((o2.y + o2.h + i3) / n3) + 1);
        break;
      case "rect":
        r3.push(Math.floor((t3.y + i3) / n3) + 1), r3.push(Math.floor((t3.y + t3.h + i3) / n3) + 1);
    }
    for (var s3 = 0; s3 < r3.length; s3 += 1) for (; this.pdf.internal.getNumberOfPages() < r3[s3]; ) w2.call(this);
    return r3;
  }, w2 = function() {
    var t3 = this.fillStyle, e3 = this.strokeStyle, n3 = this.font, r3 = this.lineCap, i3 = this.lineWidth, a3 = this.lineJoin;
    this.pdf.addPage(), this.fillStyle = t3, this.strokeStyle = e3, this.font = n3, this.lineCap = r3, this.lineWidth = i3, this.lineJoin = a3;
  }, N2 = function(t3, e3, n3) {
    for (var r3 = 0; r3 < t3.length; r3++) switch (t3[r3].type) {
      case "bct":
        t3[r3].x2 += e3, t3[r3].y2 += n3;
      case "qct":
        t3[r3].x1 += e3, t3[r3].y1 += n3;
      default:
        t3[r3].x += e3, t3[r3].y += n3;
    }
    return t3;
  }, L2 = function(t3) {
    return t3.sort(function(t4, e3) {
      return t4 - e3;
    });
  }, x2 = function(t3, e3) {
    var n3 = this.fillStyle, r3 = this.strokeStyle, i3 = this.lineCap, a3 = this.lineWidth, o2 = Math.abs(a3 * this.ctx.transform.scaleX), s3 = this.lineJoin;
    if (this.autoPaging) {
      for (var u3, c3, l3 = JSON.parse(JSON.stringify(this.path)), h2 = JSON.parse(JSON.stringify(this.path)), f3 = [], d3 = 0; d3 < h2.length; d3++) if (void 0 !== h2[d3].x) for (var p3 = y2.call(this, h2[d3]), g3 = 0; g3 < p3.length; g3 += 1) -1 === f3.indexOf(p3[g3]) && f3.push(p3[g3]);
      for (var m3 = 0; m3 < f3.length; m3++) for (; this.pdf.internal.getNumberOfPages() < f3[m3]; ) w2.call(this);
      L2(f3);
      for (var v3 = f3[0], x3 = f3[f3.length - 1], S3 = v3; S3 < x3 + 1; S3++) {
        this.pdf.setPage(S3), this.fillStyle = n3, this.strokeStyle = r3, this.lineCap = i3, this.lineWidth = o2, this.lineJoin = s3;
        var _3 = this.pdf.internal.pageSize.width - this.margin[3] - this.margin[1], P3 = 1 === S3 ? this.posY + this.margin[0] : this.margin[0], k3 = this.pdf.internal.pageSize.height - this.posY - this.margin[0] - this.margin[2], F3 = this.pdf.internal.pageSize.height - this.margin[0] - this.margin[2], I3 = 1 === S3 ? 0 : k3 + (S3 - 2) * F3;
        if (0 !== this.ctx.clip_path.length) {
          var j3 = this.path;
          u3 = JSON.parse(JSON.stringify(this.ctx.clip_path)), this.path = N2(u3, this.posX + this.margin[3], -I3 + P3 + this.ctx.prevPageLastElemOffset), A2.call(this, t3, true), this.path = j3;
        }
        if (c3 = JSON.parse(JSON.stringify(l3)), this.path = N2(c3, this.posX + this.margin[3], -I3 + P3 + this.ctx.prevPageLastElemOffset), false === e3 || 0 === S3) {
          var C3 = (S3 > v3 || S3 < x3) && b2.call(this);
          C3 && (this.pdf.saveGraphicsState(), this.pdf.rect(this.margin[3], this.margin[0], _3, F3, null).clip().discardPath()), A2.call(this, t3, e3), C3 && this.pdf.restoreGraphicsState();
        }
        this.lineWidth = a3;
      }
      this.path = l3;
    } else this.lineWidth = o2, A2.call(this, t3, e3), this.lineWidth = a3;
  }, A2 = function(t3, e3) {
    if (("stroke" !== t3 || e3 || !v2.call(this)) && ("stroke" === t3 || e3 || !m2.call(this))) {
      for (var n3, r3, i3 = [], a3 = this.path, o2 = 0; o2 < a3.length; o2++) {
        var s3 = a3[o2];
        switch (s3.type) {
          case "begin":
            i3.push({ begin: true });
            break;
          case "close":
            i3.push({ close: true });
            break;
          case "mt":
            i3.push({ start: s3, deltas: [], abs: [] });
            break;
          case "lt":
            var u3 = i3.length;
            if (a3[o2 - 1] && !isNaN(a3[o2 - 1].x) && (n3 = [s3.x - a3[o2 - 1].x, s3.y - a3[o2 - 1].y], u3 > 0)) {
              for (; u3 >= 0; u3--) if (true !== i3[u3 - 1].close && true !== i3[u3 - 1].begin) {
                i3[u3 - 1].deltas.push(n3), i3[u3 - 1].abs.push(s3);
                break;
              }
            }
            break;
          case "bct":
            n3 = [s3.x1 - a3[o2 - 1].x, s3.y1 - a3[o2 - 1].y, s3.x2 - a3[o2 - 1].x, s3.y2 - a3[o2 - 1].y, s3.x - a3[o2 - 1].x, s3.y - a3[o2 - 1].y], i3[i3.length - 1].deltas.push(n3);
            break;
          case "qct":
            var c3 = a3[o2 - 1].x + 2 / 3 * (s3.x1 - a3[o2 - 1].x), l3 = a3[o2 - 1].y + 2 / 3 * (s3.y1 - a3[o2 - 1].y), h2 = s3.x + 2 / 3 * (s3.x1 - s3.x), f3 = s3.y + 2 / 3 * (s3.y1 - s3.y), d3 = s3.x, p3 = s3.y;
            n3 = [c3 - a3[o2 - 1].x, l3 - a3[o2 - 1].y, h2 - a3[o2 - 1].x, f3 - a3[o2 - 1].y, d3 - a3[o2 - 1].x, p3 - a3[o2 - 1].y], i3[i3.length - 1].deltas.push(n3);
            break;
          case "arc":
            i3.push({ deltas: [], abs: [], arc: true }), Array.isArray(i3[i3.length - 1].abs) && i3[i3.length - 1].abs.push(s3);
        }
      }
      r3 = e3 ? null : "stroke" === t3 ? "stroke" : "fill";
      for (var g3 = false, b3 = 0; b3 < i3.length; b3++) if (i3[b3].arc) for (var y3 = i3[b3].abs, w3 = 0; w3 < y3.length; w3++) {
        var N3 = y3[w3];
        "arc" === N3.type ? P2.call(this, N3.x, N3.y, N3.radius, N3.startAngle, N3.endAngle, N3.counterclockwise, void 0, e3, !g3) : C2.call(this, N3.x, N3.y), g3 = true;
      }
      else if (true === i3[b3].close) this.pdf.internal.out("h"), g3 = false;
      else if (true !== i3[b3].begin) {
        var L3 = i3[b3].start.x, x3 = i3[b3].start.y;
        O2.call(this, i3[b3].deltas, L3, x3), g3 = true;
      }
      r3 && k2.call(this, r3), e3 && F2.call(this);
    }
  }, S2 = function(t3) {
    var e3 = this.pdf.internal.getFontSize() / this.pdf.internal.scaleFactor, n3 = e3 * (this.pdf.internal.getLineHeightFactor() - 1);
    switch (this.ctx.textBaseline) {
      case "bottom":
        return t3 - n3;
      case "top":
        return t3 + e3 - n3;
      case "hanging":
        return t3 + e3 - 2 * n3;
      case "middle":
        return t3 + e3 / 2 - n3;
      default:
        return t3;
    }
  }, _2 = function(t3) {
    return t3 + this.pdf.internal.getFontSize() / this.pdf.internal.scaleFactor * (this.pdf.internal.getLineHeightFactor() - 1);
  };
  p2.prototype.createLinearGradient = function() {
    var t3 = function() {
    };
    return t3.colorStops = [], t3.addColorStop = function(t4, e3) {
      this.colorStops.push([t4, e3]);
    }, t3.getColor = function() {
      return 0 === this.colorStops.length ? "#000000" : this.colorStops[0][1];
    }, t3.isCanvasGradient = true, t3;
  }, p2.prototype.createPattern = function() {
    return this.createLinearGradient();
  }, p2.prototype.createRadialGradient = function() {
    return this.createLinearGradient();
  };
  var P2 = function(t3, e3, n3, r3, i3, a3, o2, s3, u3) {
    for (var c3 = M2.call(this, n3, r3, i3, a3), l3 = 0; l3 < c3.length; l3++) {
      var h2 = c3[l3];
      0 === l3 && (u3 ? I2.call(this, h2.x1 + t3, h2.y1 + e3) : C2.call(this, h2.x1 + t3, h2.y1 + e3)), B2.call(this, t3, e3, h2.x2, h2.y2, h2.x3, h2.y3, h2.x4, h2.y4);
    }
    s3 ? F2.call(this) : k2.call(this, o2);
  }, k2 = function(t3) {
    switch (t3) {
      case "stroke":
        this.pdf.internal.out("S");
        break;
      case "fill":
        this.pdf.internal.out("f");
    }
  }, F2 = function() {
    this.pdf.clip(), this.pdf.discardPath();
  }, I2 = function(t3, e3) {
    this.pdf.internal.out(r2(t3) + " " + i2(e3) + " m");
  }, j2 = function(t3) {
    var e3;
    switch (t3.align) {
      case "right":
      case "end":
        e3 = "right";
        break;
      case "center":
        e3 = "center";
        break;
      default:
        e3 = "left";
    }
    var n3, r3, i3, a3 = this.pdf.getTextDimensions(t3.text), o2 = S2.call(this, t3.y), s3 = _2.call(this, o2) - a3.h, h2 = this.ctx.transform.applyToPoint(new u2(t3.x, o2));
    if (this.autoPaging) {
      var f3 = this.ctx.transform.decompose(), d3 = new l2();
      d3 = (d3 = (d3 = d3.multiply(f3.translate)).multiply(f3.skew)).multiply(f3.scale);
      for (var p3 = this.ctx.transform.applyToRectangle(new c2(t3.x, o2, a3.w, a3.h)), g3 = d3.applyToRectangle(new c2(t3.x, s3, a3.w, a3.h)), m3 = y2.call(this, g3), v3 = [], w3 = 0; w3 < m3.length; w3 += 1) -1 === v3.indexOf(m3[w3]) && v3.push(m3[w3]);
      L2(v3);
      for (var x3 = v3[0], P3 = v3[v3.length - 1], k3 = x3; k3 < P3 + 1; k3++) {
        this.pdf.setPage(k3);
        var F3 = 1 === k3 ? this.posY + this.margin[0] : this.margin[0], I3 = this.pdf.internal.pageSize.height - this.posY - this.margin[0] - this.margin[2], j3 = this.pdf.internal.pageSize.height - this.margin[2], C3 = j3 - this.margin[0], O3 = this.pdf.internal.pageSize.width - this.margin[1], B3 = O3 - this.margin[3], M3 = 1 === k3 ? 0 : I3 + (k3 - 2) * C3;
        if (0 !== this.ctx.clip_path.length) {
          var q3 = this.path;
          n3 = JSON.parse(JSON.stringify(this.ctx.clip_path)), this.path = N2(n3, this.posX + this.margin[3], -1 * M3 + F3), A2.call(this, "fill", true), this.path = q3;
        }
        var E3 = N2([JSON.parse(JSON.stringify(g3))], this.posX + this.margin[3], -M3 + F3 + this.ctx.prevPageLastElemOffset)[0];
        t3.scale >= 0.01 && (r3 = this.pdf.internal.getFontSize(), this.pdf.setFontSize(r3 * t3.scale), i3 = this.lineWidth, this.lineWidth = i3 * t3.scale);
        var R3 = "text" !== this.autoPaging;
        if (R3 || E3.y + E3.h <= j3) {
          if (R3 || E3.y >= F3 && E3.x <= O3) {
            var D3 = R3 ? t3.text : this.pdf.splitTextToSize(t3.text, t3.maxWidth || O3 - E3.x)[0], T3 = N2([JSON.parse(JSON.stringify(p3))], this.posX + this.margin[3], -M3 + F3 + this.ctx.prevPageLastElemOffset)[0], z2 = R3 && (k3 > x3 || k3 < P3) && b2.call(this);
            z2 && (this.pdf.saveGraphicsState(), this.pdf.rect(this.margin[3], this.margin[0], B3, C3, null).clip().discardPath()), this.pdf.text(D3, T3.x, T3.y, { angle: t3.angle, align: e3, renderingMode: t3.renderingMode }), z2 && this.pdf.restoreGraphicsState();
          }
        } else E3.y < j3 && (this.ctx.prevPageLastElemOffset += j3 - E3.y);
        t3.scale >= 0.01 && (this.pdf.setFontSize(r3), this.lineWidth = i3);
      }
    } else t3.scale >= 0.01 && (r3 = this.pdf.internal.getFontSize(), this.pdf.setFontSize(r3 * t3.scale), i3 = this.lineWidth, this.lineWidth = i3 * t3.scale), this.pdf.text(t3.text, h2.x + this.posX, h2.y + this.posY, { angle: t3.angle, align: e3, renderingMode: t3.renderingMode, maxWidth: t3.maxWidth }), t3.scale >= 0.01 && (this.pdf.setFontSize(r3), this.lineWidth = i3);
  }, C2 = function(t3, e3, n3, a3) {
    n3 = n3 || 0, a3 = a3 || 0, this.pdf.internal.out(r2(t3 + n3) + " " + i2(e3 + a3) + " l");
  }, O2 = function(t3, e3, n3) {
    return this.pdf.lines(t3, e3, n3, null, null);
  }, B2 = function(t3, e3, r3, i3, o2, u3, c3, l3) {
    this.pdf.internal.out([n2(a2(r3 + t3)), n2(s2(i3 + e3)), n2(a2(o2 + t3)), n2(s2(u3 + e3)), n2(a2(c3 + t3)), n2(s2(l3 + e3)), "c"].join(" "));
  }, M2 = function(t3, e3, n3, r3) {
    for (var i3 = 2 * Math.PI, a3 = Math.PI / 2; e3 > n3; ) e3 -= i3;
    var o2 = Math.abs(n3 - e3);
    o2 < i3 && r3 && (o2 = i3 - o2);
    for (var s3 = [], u3 = r3 ? -1 : 1, c3 = e3; o2 > 1e-5; ) {
      var l3 = c3 + u3 * Math.min(o2, a3);
      s3.push(q2.call(this, t3, c3, l3)), o2 -= Math.abs(l3 - c3), c3 = l3;
    }
    return s3;
  }, q2 = function(t3, e3, n3) {
    var r3 = (n3 - e3) / 2, i3 = t3 * Math.cos(r3), a3 = t3 * Math.sin(r3), o2 = i3, s3 = -a3, u3 = o2 * o2 + s3 * s3, c3 = u3 + o2 * i3 + s3 * a3, l3 = 4 / 3 * (Math.sqrt(2 * u3 * c3) - c3) / (o2 * a3 - s3 * i3), h2 = o2 - l3 * s3, f3 = s3 + l3 * o2, d3 = h2, p3 = -f3, g3 = r3 + e3, m3 = Math.cos(g3), v3 = Math.sin(g3);
    return { x1: t3 * Math.cos(e3), y1: t3 * Math.sin(e3), x2: h2 * m3 - f3 * v3, y2: h2 * v3 + f3 * m3, x3: d3 * m3 - p3 * v3, y3: d3 * v3 + p3 * m3, x4: t3 * Math.cos(n3), y4: t3 * Math.sin(n3) };
  }, E2 = function(t3) {
    return 180 * t3 / Math.PI;
  }, R2 = function(t3, e3, n3, r3, i3, a3) {
    var o2 = t3 + 0.5 * (n3 - t3), s3 = e3 + 0.5 * (r3 - e3), u3 = i3 + 0.5 * (n3 - i3), l3 = a3 + 0.5 * (r3 - a3), h2 = Math.min(t3, i3, o2, u3), f3 = Math.max(t3, i3, o2, u3), d3 = Math.min(e3, a3, s3, l3), p3 = Math.max(e3, a3, s3, l3);
    return new c2(h2, d3, f3 - h2, p3 - d3);
  }, D2 = function(t3, e3, n3, r3, i3, a3, o2, s3) {
    var u3, l3, h2, f3, d3, p3, g3, m3, v3, b3, y3, w3, N3, L3, x3 = n3 - t3, A3 = r3 - e3, S3 = i3 - n3, _3 = a3 - r3, P3 = o2 - i3, k3 = s3 - a3;
    for (l3 = 0; l3 < 41; l3++) v3 = (g3 = (h2 = t3 + (u3 = l3 / 40) * x3) + u3 * ((d3 = n3 + u3 * S3) - h2)) + u3 * (d3 + u3 * (i3 + u3 * P3 - d3) - g3), b3 = (m3 = (f3 = e3 + u3 * A3) + u3 * ((p3 = r3 + u3 * _3) - f3)) + u3 * (p3 + u3 * (a3 + u3 * k3 - p3) - m3), 0 == l3 ? (y3 = v3, w3 = b3, N3 = v3, L3 = b3) : (y3 = Math.min(y3, v3), w3 = Math.min(w3, b3), N3 = Math.max(N3, v3), L3 = Math.max(L3, b3));
    return new c2(Math.round(y3), Math.round(w3), Math.round(N3 - y3), Math.round(L3 - w3));
  }, T2 = function() {
    if (this.prevLineDash || this.ctx.lineDash.length || this.ctx.lineDashOffset) {
      var t3, e3, n3 = (t3 = this.ctx.lineDash, e3 = this.ctx.lineDashOffset, JSON.stringify({ lineDash: t3, lineDashOffset: e3 }));
      this.prevLineDash !== n3 && (this.pdf.setLineDash(this.ctx.lineDash, this.ctx.lineDashOffset), this.prevLineDash = n3);
    }
  };
}(E.API), /**
 * @license
 * jsPDF filters PlugIn
 * Copyright (c) 2014 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  var n2 = function(t4) {
    var e2, n3, r3, i3, a3, o3, s2, u2, c2, l2;
    for (n3 = [], r3 = 0, i3 = (t4 += e2 = "\0\0\0\0".slice(t4.length % 4 || 4)).length; i3 > r3; r3 += 4) 0 !== (a3 = (t4.charCodeAt(r3) << 24) + (t4.charCodeAt(r3 + 1) << 16) + (t4.charCodeAt(r3 + 2) << 8) + t4.charCodeAt(r3 + 3)) ? (o3 = (a3 = ((a3 = ((a3 = ((a3 = (a3 - (l2 = a3 % 85)) / 85) - (c2 = a3 % 85)) / 85) - (u2 = a3 % 85)) / 85) - (s2 = a3 % 85)) / 85) % 85, n3.push(o3 + 33, s2 + 33, u2 + 33, c2 + 33, l2 + 33)) : n3.push(122);
    return function(t5, e3) {
      for (var n4 = e3; n4 > 0; n4--) t5.pop();
    }(n3, e2.length), String.fromCharCode.apply(String, n3) + "~>";
  }, r2 = function(t4) {
    var e2, n3, r3, i3, a3, o3 = String, s2 = "length", u2 = 255, c2 = "charCodeAt", l2 = "slice", h2 = "replace";
    for (t4[l2](-2), t4 = t4[l2](0, -2)[h2](/\s/g, "")[h2]("z", "!!!!!"), r3 = [], i3 = 0, a3 = (t4 += e2 = "uuuuu"[l2](t4[s2] % 5 || 5))[s2]; a3 > i3; i3 += 5) n3 = 52200625 * (t4[c2](i3) - 33) + 614125 * (t4[c2](i3 + 1) - 33) + 7225 * (t4[c2](i3 + 2) - 33) + 85 * (t4[c2](i3 + 3) - 33) + (t4[c2](i3 + 4) - 33), r3.push(u2 & n3 >> 24, u2 & n3 >> 16, u2 & n3 >> 8, u2 & n3);
    return function(t5, e3) {
      for (var n4 = e3; n4 > 0; n4--) t5.pop();
    }(r3, e2[s2]), o3.fromCharCode.apply(o3, r3);
  }, i2 = function(t4) {
    return t4.split("").map(function(t5) {
      return ("0" + t5.charCodeAt().toString(16)).slice(-2);
    }).join("") + ">";
  }, a2 = function(t4) {
    var e2 = new RegExp(/^([0-9A-Fa-f]{2})+$/);
    if (-1 !== (t4 = t4.replace(/\s/g, "")).indexOf(">") && (t4 = t4.substr(0, t4.indexOf(">"))), t4.length % 2 && (t4 += "0"), false === e2.test(t4)) return "";
    for (var n3 = "", r3 = 0; r3 < t4.length; r3 += 2) n3 += String.fromCharCode("0x" + (t4[r3] + t4[r3 + 1]));
    return n3;
  }, o2 = function(t4) {
    for (var n3 = new Uint8Array(t4.length), r3 = t4.length; r3--; ) n3[r3] = t4.charCodeAt(r3);
    return (n3 = zlibSync(n3)).reduce(function(t5, e2) {
      return t5 + String.fromCharCode(e2);
    }, "");
  };
  t3.processDataByFilters = function(t4, e2) {
    var s2 = 0, u2 = t4 || "", c2 = [];
    for ("string" == typeof (e2 = e2 || []) && (e2 = [e2]), s2 = 0; s2 < e2.length; s2 += 1) switch (e2[s2]) {
      case "ASCII85Decode":
      case "/ASCII85Decode":
        u2 = r2(u2), c2.push("/ASCII85Encode");
        break;
      case "ASCII85Encode":
      case "/ASCII85Encode":
        u2 = n2(u2), c2.push("/ASCII85Decode");
        break;
      case "ASCIIHexDecode":
      case "/ASCIIHexDecode":
        u2 = a2(u2), c2.push("/ASCIIHexEncode");
        break;
      case "ASCIIHexEncode":
      case "/ASCIIHexEncode":
        u2 = i2(u2), c2.push("/ASCIIHexDecode");
        break;
      case "FlateEncode":
      case "/FlateEncode":
        u2 = o2(u2), c2.push("/FlateDecode");
        break;
      default:
        throw new Error('The filter: "' + e2[s2] + '" is not implemented');
    }
    return { data: u2, reverseChain: c2.reverse().join(" ") };
  };
}(E.API), /**
 * @license
 * jsPDF fileloading PlugIn
 * Copyright (c) 2018 Aras Abbasi (aras.abbasi@gmail.com)
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  t3.loadFile = function(t4, e2, n2) {
    return function(t5, e3, n3) {
      e3 = false !== e3, n3 = "function" == typeof n3 ? n3 : function() {
      };
      var r2 = void 0;
      try {
        r2 = function(t6, e4, n4) {
          var r3 = new XMLHttpRequest(), i2 = 0, a2 = function(t7) {
            var e5 = t7.length, n5 = [], r4 = String.fromCharCode;
            for (i2 = 0; i2 < e5; i2 += 1) n5.push(r4(255 & t7.charCodeAt(i2)));
            return n5.join("");
          };
          if (r3.open("GET", t6, !e4), r3.overrideMimeType("text/plain; charset=x-user-defined"), false === e4 && (r3.onload = function() {
            200 === r3.status ? n4(a2(this.responseText)) : n4(void 0);
          }), r3.send(null), e4 && 200 === r3.status) return a2(r3.responseText);
        }(t5, e3, n3);
      } catch (i2) {
      }
      return r2;
    }(t4, e2, n2);
  }, t3.loadImageFile = t3.loadFile;
}(E.API), function(e2) {
  function n2() {
    return (i.html2canvas ? Promise.resolve(i.html2canvas) : __vitePreload(() => import('./html2canvas.esm.DcVenFpA.js'),true?[]:void 0)).catch(function(t3) {
      return Promise.reject(new Error("Could not load html2canvas: " + t3));
    }).then(function(t3) {
      return t3.default ? t3.default : t3;
    });
  }
  function r2() {
    return (i.DOMPurify ? Promise.resolve(i.DOMPurify) : __vitePreload(() => Promise.resolve().then(() => purify_es),true?void 0:void 0)).catch(function(t3) {
      return Promise.reject(new Error("Could not load dompurify: " + t3));
    }).then(function(t3) {
      return t3.default ? t3.default : t3;
    });
  }
  var a2 = function(e3) {
    var n3 = _typeof(e3);
    return "undefined" === n3 ? "undefined" : "string" === n3 || e3 instanceof String ? "string" : "number" === n3 || e3 instanceof Number ? "number" : "function" === n3 || e3 instanceof Function ? "function" : e3 && e3.constructor === Array ? "array" : e3 && 1 === e3.nodeType ? "element" : "object" === n3 ? "object" : "unknown";
  }, o2 = function(t3, e3) {
    var n3 = document.createElement(t3);
    for (var r3 in e3.className && (n3.className = e3.className), e3.innerHTML && e3.dompurify && (n3.innerHTML = e3.dompurify.sanitize(e3.innerHTML)), e3.style) n3.style[r3] = e3.style[r3];
    return n3;
  }, s2 = function t3(e3, n3) {
    for (var r3 = 3 === e3.nodeType ? document.createTextNode(e3.nodeValue) : e3.cloneNode(false), i2 = e3.firstChild; i2; i2 = i2.nextSibling) true !== n3 && 1 === i2.nodeType && "SCRIPT" === i2.nodeName || r3.appendChild(t3(i2, n3));
    return 1 === e3.nodeType && ("CANVAS" === e3.nodeName ? (r3.width = e3.width, r3.height = e3.height, r3.getContext("2d").drawImage(e3, 0, 0)) : "TEXTAREA" !== e3.nodeName && "SELECT" !== e3.nodeName || (r3.value = e3.value), r3.addEventListener("load", function() {
      r3.scrollTop = e3.scrollTop, r3.scrollLeft = e3.scrollLeft;
    }, true)), r3;
  }, u2 = function t3(e3) {
    var n3 = Object.assign(t3.convert(Promise.resolve()), JSON.parse(JSON.stringify(t3.template))), r3 = t3.convert(Promise.resolve(), n3);
    return (r3 = r3.setProgress(1, t3, 1, [t3])).set(e3);
  };
  (u2.prototype = Object.create(Promise.prototype)).constructor = u2, u2.convert = function(t3, e3) {
    return t3.__proto__ = e3 || u2.prototype, t3;
  }, u2.template = { prop: { src: null, container: null, overlay: null, canvas: null, img: null, pdf: null, pageSize: null, callback: function() {
  } }, progress: { val: 0, state: null, n: 0, stack: [] }, opt: { filename: "file.pdf", margin: [0, 0, 0, 0], enableLinks: true, x: 0, y: 0, html2canvas: {}, jsPDF: {}, backgroundColor: "transparent" } }, u2.prototype.from = function(t3, e3) {
    return this.then(function() {
      switch (e3 = e3 || function(t4) {
        switch (a2(t4)) {
          case "string":
            return "string";
          case "element":
            return "canvas" === t4.nodeName.toLowerCase() ? "canvas" : "element";
          default:
            return "unknown";
        }
      }(t3), e3) {
        case "string":
          return this.then(r2).then(function(e4) {
            return this.set({ src: o2("div", { innerHTML: t3, dompurify: e4 }) });
          });
        case "element":
          return this.set({ src: t3 });
        case "canvas":
          return this.set({ canvas: t3 });
        case "img":
          return this.set({ img: t3 });
        default:
          return this.error("Unknown source type.");
      }
    });
  }, u2.prototype.to = function(t3) {
    switch (t3) {
      case "container":
        return this.toContainer();
      case "canvas":
        return this.toCanvas();
      case "img":
        return this.toImg();
      case "pdf":
        return this.toPdf();
      default:
        return this.error("Invalid target.");
    }
  }, u2.prototype.toContainer = function() {
    return this.thenList([function() {
      return this.prop.src || this.error("Cannot duplicate - no source HTML.");
    }, function() {
      return this.prop.pageSize || this.setPageSize();
    }]).then(function() {
      var t3 = { position: "relative", display: "inline-block", width: ("number" != typeof this.opt.width || isNaN(this.opt.width) || "number" != typeof this.opt.windowWidth || isNaN(this.opt.windowWidth) ? Math.max(this.prop.src.clientWidth, this.prop.src.scrollWidth, this.prop.src.offsetWidth) : this.opt.windowWidth) + "px", left: 0, right: 0, top: 0, margin: "auto", backgroundColor: this.opt.backgroundColor }, e3 = s2(this.prop.src, this.opt.html2canvas.javascriptEnabled);
      "BODY" === e3.tagName && (t3.height = Math.max(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight) + "px"), this.prop.overlay = o2("div", { className: "html2pdf__overlay", style: { position: "fixed", overflow: "hidden", zIndex: 1e3, left: "-100000px", right: 0, bottom: 0, top: 0 } }), this.prop.container = o2("div", { className: "html2pdf__container", style: t3 }), this.prop.container.appendChild(e3), this.prop.container.firstChild.appendChild(o2("div", { style: { clear: "both", border: "0 none transparent", margin: 0, padding: 0, height: 0 } })), this.prop.container.style.float = "none", this.prop.overlay.appendChild(this.prop.container), document.body.appendChild(this.prop.overlay), this.prop.container.firstChild.style.position = "relative", this.prop.container.height = Math.max(this.prop.container.firstChild.clientHeight, this.prop.container.firstChild.scrollHeight, this.prop.container.firstChild.offsetHeight) + "px";
    });
  }, u2.prototype.toCanvas = function() {
    var t3 = [function() {
      return document.body.contains(this.prop.container) || this.toContainer();
    }];
    return this.thenList(t3).then(n2).then(function(t4) {
      var e3 = Object.assign({}, this.opt.html2canvas);
      return delete e3.onrendered, t4(this.prop.container, e3);
    }).then(function(t4) {
      (this.opt.html2canvas.onrendered || function() {
      })(t4), this.prop.canvas = t4, document.body.removeChild(this.prop.overlay);
    });
  }, u2.prototype.toContext2d = function() {
    var t3 = [function() {
      return document.body.contains(this.prop.container) || this.toContainer();
    }];
    return this.thenList(t3).then(n2).then(function(t4) {
      var e3 = this.opt.jsPDF, n3 = this.opt.fontFaces, r3 = "number" != typeof this.opt.width || isNaN(this.opt.width) || "number" != typeof this.opt.windowWidth || isNaN(this.opt.windowWidth) ? 1 : this.opt.width / this.opt.windowWidth, i2 = Object.assign({ async: true, allowTaint: true, scale: r3, scrollX: this.opt.scrollX || 0, scrollY: this.opt.scrollY || 0, backgroundColor: "#ffffff", imageTimeout: 15e3, logging: true, proxy: null, removeContainer: true, foreignObjectRendering: false, useCORS: false }, this.opt.html2canvas);
      if (delete i2.onrendered, e3.context2d.autoPaging = void 0 === this.opt.autoPaging || this.opt.autoPaging, e3.context2d.posX = this.opt.x, e3.context2d.posY = this.opt.y, e3.context2d.margin = this.opt.margin, e3.context2d.fontFaces = n3, n3) for (var a3 = 0; a3 < n3.length; ++a3) {
        var o3 = n3[a3], s3 = o3.src.find(function(t5) {
          return "truetype" === t5.format;
        });
        s3 && e3.addFont(s3.url, o3.ref.name, o3.ref.style);
      }
      return i2.windowHeight = i2.windowHeight || 0, i2.windowHeight = 0 == i2.windowHeight ? Math.max(this.prop.container.clientHeight, this.prop.container.scrollHeight, this.prop.container.offsetHeight) : i2.windowHeight, e3.context2d.save(true), t4(this.prop.container, i2);
    }).then(function(t4) {
      this.opt.jsPDF.context2d.restore(true), (this.opt.html2canvas.onrendered || function() {
      })(t4), this.prop.canvas = t4, document.body.removeChild(this.prop.overlay);
    });
  }, u2.prototype.toImg = function() {
    return this.thenList([function() {
      return this.prop.canvas || this.toCanvas();
    }]).then(function() {
      var t3 = this.prop.canvas.toDataURL("image/" + this.opt.image.type, this.opt.image.quality);
      this.prop.img = document.createElement("img"), this.prop.img.src = t3;
    });
  }, u2.prototype.toPdf = function() {
    return this.thenList([function() {
      return this.toContext2d();
    }]).then(function() {
      this.prop.pdf = this.prop.pdf || this.opt.jsPDF;
    });
  }, u2.prototype.output = function(t3, e3, n3) {
    return "img" === (n3 = n3 || "pdf").toLowerCase() || "image" === n3.toLowerCase() ? this.outputImg(t3, e3) : this.outputPdf(t3, e3);
  }, u2.prototype.outputPdf = function(t3, e3) {
    return this.thenList([function() {
      return this.prop.pdf || this.toPdf();
    }]).then(function() {
      return this.prop.pdf.output(t3, e3);
    });
  }, u2.prototype.outputImg = function(t3) {
    return this.thenList([function() {
      return this.prop.img || this.toImg();
    }]).then(function() {
      switch (t3) {
        case void 0:
        case "img":
          return this.prop.img;
        case "datauristring":
        case "dataurlstring":
          return this.prop.img.src;
        case "datauri":
        case "dataurl":
          return document.location.href = this.prop.img.src;
        default:
          throw 'Image output type "' + t3 + '" is not supported.';
      }
    });
  }, u2.prototype.save = function(t3) {
    return this.thenList([function() {
      return this.prop.pdf || this.toPdf();
    }]).set(t3 ? { filename: t3 } : null).then(function() {
      this.prop.pdf.save(this.opt.filename);
    });
  }, u2.prototype.doCallback = function() {
    return this.thenList([function() {
      return this.prop.pdf || this.toPdf();
    }]).then(function() {
      this.prop.callback(this.prop.pdf);
    });
  }, u2.prototype.set = function(t3) {
    if ("object" !== a2(t3)) return this;
    var e3 = Object.keys(t3 || {}).map(function(e4) {
      if (e4 in u2.template.prop) return function() {
        this.prop[e4] = t3[e4];
      };
      switch (e4) {
        case "margin":
          return this.setMargin.bind(this, t3.margin);
        case "jsPDF":
          return function() {
            return this.opt.jsPDF = t3.jsPDF, this.setPageSize();
          };
        case "pageSize":
          return this.setPageSize.bind(this, t3.pageSize);
        default:
          return function() {
            this.opt[e4] = t3[e4];
          };
      }
    }, this);
    return this.then(function() {
      return this.thenList(e3);
    });
  }, u2.prototype.get = function(t3, e3) {
    return this.then(function() {
      var n3 = t3 in u2.template.prop ? this.prop[t3] : this.opt[t3];
      return e3 ? e3(n3) : n3;
    });
  }, u2.prototype.setMargin = function(t3) {
    return this.then(function() {
      switch (a2(t3)) {
        case "number":
          t3 = [t3, t3, t3, t3];
        case "array":
          if (2 === t3.length && (t3 = [t3[0], t3[1], t3[0], t3[1]]), 4 === t3.length) break;
        default:
          return this.error("Invalid margin array.");
      }
      this.opt.margin = t3;
    }).then(this.setPageSize);
  }, u2.prototype.setPageSize = function(t3) {
    function e3(t4, e4) {
      return Math.floor(t4 * e4 / 72 * 96);
    }
    return this.then(function() {
      (t3 = t3 || E.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner") || (t3.inner = { width: t3.width - this.opt.margin[1] - this.opt.margin[3], height: t3.height - this.opt.margin[0] - this.opt.margin[2] }, t3.inner.px = { width: e3(t3.inner.width, t3.k), height: e3(t3.inner.height, t3.k) }, t3.inner.ratio = t3.inner.height / t3.inner.width), this.prop.pageSize = t3;
    });
  }, u2.prototype.setProgress = function(t3, e3, n3, r3) {
    return null != t3 && (this.progress.val = t3), null != e3 && (this.progress.state = e3), null != n3 && (this.progress.n = n3), null != r3 && (this.progress.stack = r3), this.progress.ratio = this.progress.val / this.progress.state, this;
  }, u2.prototype.updateProgress = function(t3, e3, n3, r3) {
    return this.setProgress(t3 ? this.progress.val + t3 : null, e3 || null, n3 ? this.progress.n + n3 : null, r3 ? this.progress.stack.concat(r3) : null);
  }, u2.prototype.then = function(t3, e3) {
    var n3 = this;
    return this.thenCore(t3, e3, function(t4, e4) {
      return n3.updateProgress(null, null, 1, [t4]), Promise.prototype.then.call(this, function(e5) {
        return n3.updateProgress(null, t4), e5;
      }).then(t4, e4).then(function(t5) {
        return n3.updateProgress(1), t5;
      });
    });
  }, u2.prototype.thenCore = function(t3, e3, n3) {
    n3 = n3 || Promise.prototype.then;
    var r3 = this;
    t3 && (t3 = t3.bind(r3)), e3 && (e3 = e3.bind(r3));
    var i2 = -1 !== Promise.toString().indexOf("[native code]") && "Promise" === Promise.name ? r3 : u2.convert(Object.assign({}, r3), Promise.prototype), a3 = n3.call(i2, t3, e3);
    return u2.convert(a3, r3.__proto__);
  }, u2.prototype.thenExternal = function(t3, e3) {
    return Promise.prototype.then.call(this, t3, e3);
  }, u2.prototype.thenList = function(t3) {
    var e3 = this;
    return t3.forEach(function(t4) {
      e3 = e3.thenCore(t4);
    }), e3;
  }, u2.prototype.catch = function(t3) {
    t3 && (t3 = t3.bind(this));
    var e3 = Promise.prototype.catch.call(this, t3);
    return u2.convert(e3, this);
  }, u2.prototype.catchExternal = function(t3) {
    return Promise.prototype.catch.call(this, t3);
  }, u2.prototype.error = function(t3) {
    return this.then(function() {
      throw new Error(t3);
    });
  }, u2.prototype.using = u2.prototype.set, u2.prototype.saveAs = u2.prototype.save, u2.prototype.export = u2.prototype.output, u2.prototype.run = u2.prototype.then, E.getPageSize = function(e3, n3, r3) {
    if ("object" === _typeof(e3)) {
      var i2 = e3;
      e3 = i2.orientation, n3 = i2.unit || n3, r3 = i2.format || r3;
    }
    n3 = n3 || "mm", r3 = r3 || "a4", e3 = ("" + (e3 || "P")).toLowerCase();
    var a3, o3 = ("" + r3).toLowerCase(), s3 = { a0: [2383.94, 3370.39], a1: [1683.78, 2383.94], a2: [1190.55, 1683.78], a3: [841.89, 1190.55], a4: [595.28, 841.89], a5: [419.53, 595.28], a6: [297.64, 419.53], a7: [209.76, 297.64], a8: [147.4, 209.76], a9: [104.88, 147.4], a10: [73.7, 104.88], b0: [2834.65, 4008.19], b1: [2004.09, 2834.65], b2: [1417.32, 2004.09], b3: [1000.63, 1417.32], b4: [708.66, 1000.63], b5: [498.9, 708.66], b6: [354.33, 498.9], b7: [249.45, 354.33], b8: [175.75, 249.45], b9: [124.72, 175.75], b10: [87.87, 124.72], c0: [2599.37, 3676.54], c1: [1836.85, 2599.37], c2: [1298.27, 1836.85], c3: [918.43, 1298.27], c4: [649.13, 918.43], c5: [459.21, 649.13], c6: [323.15, 459.21], c7: [229.61, 323.15], c8: [161.57, 229.61], c9: [113.39, 161.57], c10: [79.37, 113.39], dl: [311.81, 623.62], letter: [612, 792], "government-letter": [576, 756], legal: [612, 1008], "junior-legal": [576, 360], ledger: [1224, 792], tabloid: [792, 1224], "credit-card": [153, 243] };
    switch (n3) {
      case "pt":
        a3 = 1;
        break;
      case "mm":
        a3 = 72 / 25.4;
        break;
      case "cm":
        a3 = 72 / 2.54;
        break;
      case "in":
        a3 = 72;
        break;
      case "px":
        a3 = 0.75;
        break;
      case "pc":
      case "em":
        a3 = 12;
        break;
      case "ex":
        a3 = 6;
        break;
      default:
        throw "Invalid unit: " + n3;
    }
    var u3, c2 = 0, l2 = 0;
    if (s3.hasOwnProperty(o3)) c2 = s3[o3][1] / a3, l2 = s3[o3][0] / a3;
    else try {
      c2 = r3[1], l2 = r3[0];
    } catch (h2) {
      throw new Error("Invalid format: " + r3);
    }
    if ("p" === e3 || "portrait" === e3) e3 = "p", l2 > c2 && (u3 = l2, l2 = c2, c2 = u3);
    else {
      if ("l" !== e3 && "landscape" !== e3) throw "Invalid orientation: " + e3;
      e3 = "l", c2 > l2 && (u3 = l2, l2 = c2, c2 = u3);
    }
    return { width: l2, height: c2, unit: n3, k: a3, orientation: e3 };
  }, e2.html = function(t3, e3) {
    (e3 = e3 || {}).callback = e3.callback || function() {
    }, e3.html2canvas = e3.html2canvas || {}, e3.html2canvas.canvas = e3.html2canvas.canvas || this.canvas, e3.jsPDF = e3.jsPDF || this, e3.fontFaces = e3.fontFaces ? e3.fontFaces.map(Ct) : null;
    var n3 = new u2(e3);
    return e3.worker ? n3 : n3.from(t3).doCallback();
  };
}(E.API), E.API.addJS = function(t3) {
  return Ut = t3, this.internal.events.subscribe("postPutResources", function() {
    Tt = this.internal.newObject(), this.internal.out("<<"), this.internal.out("/Names [(EmbeddedJS) " + (Tt + 1) + " 0 R]"), this.internal.out(">>"), this.internal.out("endobj"), zt = this.internal.newObject(), this.internal.out("<<"), this.internal.out("/S /JavaScript"), this.internal.out("/JS (" + Ut + ")"), this.internal.out(">>"), this.internal.out("endobj");
  }), this.internal.events.subscribe("putCatalog", function() {
    void 0 !== Tt && void 0 !== zt && this.internal.out("/Names <</JavaScript " + Tt + " 0 R>>");
  }), this;
}, /**
 * @license
 * Copyright (c) 2014 Steven Spungin (TwelveTone LLC)  steven@twelvetone.tv
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  var e2;
  t3.events.push(["postPutResources", function() {
    var t4 = this, n2 = /^(\d+) 0 obj$/;
    if (this.outline.root.children.length > 0) for (var r2 = t4.outline.render().split(/\r\n/), i2 = 0; i2 < r2.length; i2++) {
      var a2 = r2[i2], o2 = n2.exec(a2);
      if (null != o2) {
        var s2 = o2[1];
        t4.internal.newObjectDeferredBegin(s2, false);
      }
      t4.internal.write(a2);
    }
    if (this.outline.createNamedDestinations) {
      var u2 = this.internal.pages.length, c2 = [];
      for (i2 = 0; i2 < u2; i2++) {
        var l2 = t4.internal.newObject();
        c2.push(l2);
        var h2 = t4.internal.getPageInfo(i2 + 1);
        t4.internal.write("<< /D[" + h2.objId + " 0 R /XYZ null null null]>> endobj");
      }
      var f2 = t4.internal.newObject();
      for (t4.internal.write("<< /Names [ "), i2 = 0; i2 < c2.length; i2++) t4.internal.write("(page_" + (i2 + 1) + ")" + c2[i2] + " 0 R");
      t4.internal.write(" ] >>", "endobj"), e2 = t4.internal.newObject(), t4.internal.write("<< /Dests " + f2 + " 0 R"), t4.internal.write(">>", "endobj");
    }
  }]), t3.events.push(["putCatalog", function() {
    var t4 = this;
    t4.outline.root.children.length > 0 && (t4.internal.write("/Outlines", this.outline.makeRef(this.outline.root)), this.outline.createNamedDestinations && t4.internal.write("/Names " + e2 + " 0 R"));
  }]), t3.events.push(["initialized", function() {
    var t4 = this;
    t4.outline = { createNamedDestinations: false, root: { children: [] } }, t4.outline.add = function(t5, e3, n2) {
      var r2 = { title: e3, options: n2, children: [] };
      return null == t5 && (t5 = this.root), t5.children.push(r2), r2;
    }, t4.outline.render = function() {
      return this.ctx = {}, this.ctx.val = "", this.ctx.pdf = t4, this.genIds_r(this.root), this.renderRoot(this.root), this.renderItems(this.root), this.ctx.val;
    }, t4.outline.genIds_r = function(e3) {
      e3.id = t4.internal.newObjectDeferred();
      for (var n2 = 0; n2 < e3.children.length; n2++) this.genIds_r(e3.children[n2]);
    }, t4.outline.renderRoot = function(t5) {
      this.objStart(t5), this.line("/Type /Outlines"), t5.children.length > 0 && (this.line("/First " + this.makeRef(t5.children[0])), this.line("/Last " + this.makeRef(t5.children[t5.children.length - 1]))), this.line("/Count " + this.count_r({ count: 0 }, t5)), this.objEnd();
    }, t4.outline.renderItems = function(e3) {
      for (var n2 = this.ctx.pdf.internal.getVerticalCoordinateString, r2 = 0; r2 < e3.children.length; r2++) {
        var i2 = e3.children[r2];
        this.objStart(i2), this.line("/Title " + this.makeString(i2.title)), this.line("/Parent " + this.makeRef(e3)), r2 > 0 && this.line("/Prev " + this.makeRef(e3.children[r2 - 1])), r2 < e3.children.length - 1 && this.line("/Next " + this.makeRef(e3.children[r2 + 1])), i2.children.length > 0 && (this.line("/First " + this.makeRef(i2.children[0])), this.line("/Last " + this.makeRef(i2.children[i2.children.length - 1])));
        var a2 = this.count = this.count_r({ count: 0 }, i2);
        if (a2 > 0 && this.line("/Count " + a2), i2.options && i2.options.pageNumber) {
          var o2 = t4.internal.getPageInfo(i2.options.pageNumber);
          this.line("/Dest [" + o2.objId + " 0 R /XYZ 0 " + n2(0) + " 0]");
        }
        this.objEnd();
      }
      for (var s2 = 0; s2 < e3.children.length; s2++) this.renderItems(e3.children[s2]);
    }, t4.outline.line = function(t5) {
      this.ctx.val += t5 + "\r\n";
    }, t4.outline.makeRef = function(t5) {
      return t5.id + " 0 R";
    }, t4.outline.makeString = function(e3) {
      return "(" + t4.internal.pdfEscape(e3) + ")";
    }, t4.outline.objStart = function(t5) {
      this.ctx.val += "\r\n" + t5.id + " 0 obj\r\n<<\r\n";
    }, t4.outline.objEnd = function() {
      this.ctx.val += ">> \r\nendobj\r\n";
    }, t4.outline.count_r = function(t5, e3) {
      for (var n2 = 0; n2 < e3.children.length; n2++) t5.count++, this.count_r(t5, e3.children[n2]);
      return t5.count;
    };
  }]);
}(E.API), /**
 * @license
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  var e2 = [192, 193, 194, 195, 196, 197, 198, 199];
  t3.processJPEG = function(t4, n2, r2, i2, a2, o2) {
    var s2, u2 = this.decode.DCT_DECODE, c2 = null;
    if ("string" == typeof t4 || this.__addimage__.isArrayBuffer(t4) || this.__addimage__.isArrayBufferView(t4)) {
      switch (t4 = a2 || t4, t4 = this.__addimage__.isArrayBuffer(t4) ? new Uint8Array(t4) : t4, s2 = function(t5) {
        for (var n3, r3 = 256 * t5.charCodeAt(4) + t5.charCodeAt(5), i3 = t5.length, a3 = { width: 0, height: 0, numcomponents: 1 }, o3 = 4; o3 < i3; o3 += 2) {
          if (o3 += r3, -1 !== e2.indexOf(t5.charCodeAt(o3 + 1))) {
            n3 = 256 * t5.charCodeAt(o3 + 5) + t5.charCodeAt(o3 + 6), a3 = { width: 256 * t5.charCodeAt(o3 + 7) + t5.charCodeAt(o3 + 8), height: n3, numcomponents: t5.charCodeAt(o3 + 9) };
            break;
          }
          r3 = 256 * t5.charCodeAt(o3 + 2) + t5.charCodeAt(o3 + 3);
        }
        return a3;
      }(t4 = this.__addimage__.isArrayBufferView(t4) ? this.__addimage__.arrayBufferToBinaryString(t4) : t4), s2.numcomponents) {
        case 1:
          o2 = this.color_spaces.DEVICE_GRAY;
          break;
        case 4:
          o2 = this.color_spaces.DEVICE_CMYK;
          break;
        case 3:
          o2 = this.color_spaces.DEVICE_RGB;
      }
      c2 = { data: t4, width: s2.width, height: s2.height, colorSpace: o2, bitsPerComponent: 8, filter: u2, index: n2, alias: r2 };
    }
    return c2;
  };
}(E.API), E.API.processPNG = function(t3, i2, a2, o2) {
  if (this.__addimage__.isArrayBuffer(t3) && (t3 = new Uint8Array(t3)), this.__addimage__.isArrayBufferView(t3)) {
    var s2, u2 = decodePng(t3, { checkCrc: true }), c2 = u2.width, l2 = u2.height, h2 = u2.channels, f2 = u2.palette, d2 = u2.depth;
    s2 = f2 && 1 === h2 ? function(t4) {
      for (var e2 = t4.width, r2 = t4.height, i3 = t4.data, a3 = t4.palette, o3 = t4.depth, s3 = false, u3 = [], c3 = [], l3 = void 0, h3 = false, f3 = 0, d3 = 0; d3 < a3.length; d3++) {
        var p3 = _slicedToArray(a3[d3], 4), g3 = p3[0], m3 = p3[1], v3 = p3[2], b3 = p3[3];
        u3.push(g3, m3, v3), null != b3 && (0 === b3 ? (f3++, c3.length < 1 && c3.push(d3)) : b3 < 255 && (h3 = true));
      }
      if (h3 || f3 > 1) {
        s3 = true, c3 = void 0;
        var y3 = e2 * r2;
        l3 = new Uint8Array(y3);
        for (var w3 = new DataView(i3.buffer), N3 = 0; N3 < y3; N3++) {
          var L3 = re(w3, N3, o3), x3 = _slicedToArray(a3[L3], 4)[3];
          l3[N3] = x3;
        }
      } else 0 === f3 && (c3 = void 0);
      return { colorSpace: "Indexed", colorsPerPixel: 1, sMaskBitsPerComponent: s3 ? 8 : void 0, colorBytes: i3, alphaBytes: l3, needSMask: s3, palette: u3, mask: c3 };
    }(u2) : 2 === h2 || 4 === h2 ? function(t4) {
      for (var e2 = t4.data, n2 = t4.width, r2 = t4.height, i3 = t4.channels, a3 = t4.depth, o3 = 2 === i3 ? "DeviceGray" : "DeviceRGB", s3 = i3 - 1, u3 = n2 * r2, c3 = s3, l3 = u3 * c3, h3 = 1 * u3, f3 = Math.ceil(l3 * a3 / 8), d3 = Math.ceil(h3 * a3 / 8), p3 = new Uint8Array(f3), g3 = new Uint8Array(d3), m3 = new DataView(e2.buffer), v3 = new DataView(p3.buffer), b3 = new DataView(g3.buffer), y3 = false, w3 = 0; w3 < u3; w3++) {
        for (var N3 = w3 * i3, L3 = 0; L3 < c3; L3++) ie(v3, re(m3, N3 + L3, a3), w3 * c3 + L3, a3);
        var x3 = re(m3, N3 + c3, a3);
        x3 < (1 << a3) - 1 && (y3 = true), ie(b3, x3, 1 * w3, a3);
      }
      return { colorSpace: o3, colorsPerPixel: s3, sMaskBitsPerComponent: y3 ? a3 : void 0, colorBytes: p3, alphaBytes: g3, needSMask: y3 };
    }(u2) : function(t4) {
      var e2 = t4.data, n2 = 1 === t4.channels ? "DeviceGray" : "DeviceRGB";
      return { colorSpace: n2, colorsPerPixel: "DeviceGray" === n2 ? 1 : 3, colorBytes: e2 instanceof Uint16Array ? function(t5) {
        for (var e3 = t5.length, n3 = new Uint8Array(2 * e3), r2 = new DataView(n3.buffer, n3.byteOffset, n3.byteLength), i3 = 0; i3 < e3; i3++) r2.setUint16(2 * i3, t5[i3], false);
        return n3;
      }(e2) : e2, needSMask: false };
    }(u2);
    var p2, g2, m2, v2 = s2, b2 = v2.colorSpace, y2 = v2.colorsPerPixel, w2 = v2.sMaskBitsPerComponent, N2 = v2.colorBytes, L2 = v2.alphaBytes, x2 = v2.needSMask, A2 = v2.palette, S2 = v2.mask, _2 = null;
    return o2 !== E.API.image_compression.NONE && "function" == typeof zlibSync ? (_2 = function(t4) {
      var e2;
      switch (t4) {
        case E.API.image_compression.FAST:
          e2 = 11;
          break;
        case E.API.image_compression.MEDIUM:
          e2 = 13;
          break;
        case E.API.image_compression.SLOW:
          e2 = 14;
          break;
        default:
          e2 = 12;
      }
      return e2;
    }(o2), p2 = this.decode.FLATE_DECODE, g2 = "/Predictor ".concat(_2, " /Colors ").concat(y2, " /BitsPerComponent ").concat(d2, " /Columns ").concat(c2), t3 = Xt(N2, Math.ceil(c2 * y2 * d2 / 8), y2, d2, o2), x2 && (m2 = Xt(L2, Math.ceil(c2 * w2 / 8), 1, w2, o2))) : (p2 = void 0, g2 = void 0, t3 = N2, x2 && (m2 = L2)), (this.__addimage__.isArrayBuffer(t3) || this.__addimage__.isArrayBufferView(t3)) && (t3 = this.__addimage__.arrayBufferToBinaryString(t3)), (m2 && this.__addimage__.isArrayBuffer(m2) || this.__addimage__.isArrayBufferView(m2)) && (m2 = this.__addimage__.arrayBufferToBinaryString(m2)), { alias: a2, data: t3, index: i2, filter: p2, decodeParameters: g2, transparency: S2, palette: A2, sMask: m2, predictor: _2, width: c2, height: l2, bitsPerComponent: d2, sMaskBitsPerComponent: w2, colorSpace: b2 };
  }
}, function(t3) {
  t3.processGIF89A = function(e2, n2, r2, i2) {
    var a2 = new oe(e2), o2 = a2.width, s2 = a2.height, u2 = [];
    a2.decodeAndBlitFrameRGBA(0, u2);
    var c2 = { data: u2, width: o2, height: s2 }, l2 = new ue(100).encode(c2, 100);
    return t3.processJPEG.call(this, l2, n2, r2, i2);
  }, t3.processGIF87A = t3.processGIF89A;
}(E.API), ce.prototype.parseHeader = function() {
  if (this.fileSize = this.datav.getUint32(this.pos, true), this.pos += 4, this.reserved = this.datav.getUint32(this.pos, true), this.pos += 4, this.offset = this.datav.getUint32(this.pos, true), this.pos += 4, this.headerSize = this.datav.getUint32(this.pos, true), this.pos += 4, this.width = this.datav.getUint32(this.pos, true), this.pos += 4, this.height = this.datav.getInt32(this.pos, true), this.pos += 4, this.planes = this.datav.getUint16(this.pos, true), this.pos += 2, this.bitPP = this.datav.getUint16(this.pos, true), this.pos += 2, this.compress = this.datav.getUint32(this.pos, true), this.pos += 4, this.rawSize = this.datav.getUint32(this.pos, true), this.pos += 4, this.hr = this.datav.getUint32(this.pos, true), this.pos += 4, this.vr = this.datav.getUint32(this.pos, true), this.pos += 4, this.colors = this.datav.getUint32(this.pos, true), this.pos += 4, this.importantColors = this.datav.getUint32(this.pos, true), this.pos += 4, 16 === this.bitPP && this.is_with_alpha && (this.bitPP = 15), this.bitPP < 15) {
    var t3 = 0 === this.colors ? 1 << this.bitPP : this.colors;
    this.palette = new Array(t3);
    for (var e2 = 0; e2 < t3; e2++) {
      var n2 = this.datav.getUint8(this.pos++, true), r2 = this.datav.getUint8(this.pos++, true), i2 = this.datav.getUint8(this.pos++, true), a2 = this.datav.getUint8(this.pos++, true);
      this.palette[e2] = { red: i2, green: r2, blue: n2, quad: a2 };
    }
  }
  this.height < 0 && (this.height *= -1, this.bottom_up = false);
}, ce.prototype.parseBGR = function() {
  this.pos = this.offset;
  try {
    var t3 = "bit" + this.bitPP, e2 = this.width * this.height * 4;
    this.data = new Uint8Array(e2), this[t3]();
  } catch (n2) {
    o.log("bit decode error:" + n2);
  }
}, ce.prototype.bit1 = function() {
  var t3, e2 = Math.ceil(this.width / 8), n2 = e2 % 4;
  for (t3 = this.height - 1; t3 >= 0; t3--) {
    for (var r2 = this.bottom_up ? t3 : this.height - 1 - t3, i2 = 0; i2 < e2; i2++) for (var a2 = this.datav.getUint8(this.pos++, true), o2 = r2 * this.width * 4 + 8 * i2 * 4, s2 = 0; s2 < 8 && 8 * i2 + s2 < this.width; s2++) {
      var u2 = this.palette[a2 >> 7 - s2 & 1];
      this.data[o2 + 4 * s2] = u2.blue, this.data[o2 + 4 * s2 + 1] = u2.green, this.data[o2 + 4 * s2 + 2] = u2.red, this.data[o2 + 4 * s2 + 3] = 255;
    }
    0 !== n2 && (this.pos += 4 - n2);
  }
}, ce.prototype.bit4 = function() {
  for (var t3 = Math.ceil(this.width / 2), e2 = t3 % 4, n2 = this.height - 1; n2 >= 0; n2--) {
    for (var r2 = this.bottom_up ? n2 : this.height - 1 - n2, i2 = 0; i2 < t3; i2++) {
      var a2 = this.datav.getUint8(this.pos++, true), o2 = r2 * this.width * 4 + 2 * i2 * 4, s2 = a2 >> 4, u2 = 15 & a2, c2 = this.palette[s2];
      if (this.data[o2] = c2.blue, this.data[o2 + 1] = c2.green, this.data[o2 + 2] = c2.red, this.data[o2 + 3] = 255, 2 * i2 + 1 >= this.width) break;
      c2 = this.palette[u2], this.data[o2 + 4] = c2.blue, this.data[o2 + 4 + 1] = c2.green, this.data[o2 + 4 + 2] = c2.red, this.data[o2 + 4 + 3] = 255;
    }
    0 !== e2 && (this.pos += 4 - e2);
  }
}, ce.prototype.bit8 = function() {
  for (var t3 = this.width % 4, e2 = this.height - 1; e2 >= 0; e2--) {
    for (var n2 = this.bottom_up ? e2 : this.height - 1 - e2, r2 = 0; r2 < this.width; r2++) {
      var i2 = this.datav.getUint8(this.pos++, true), a2 = n2 * this.width * 4 + 4 * r2;
      if (i2 < this.palette.length) {
        var o2 = this.palette[i2];
        this.data[a2] = o2.red, this.data[a2 + 1] = o2.green, this.data[a2 + 2] = o2.blue, this.data[a2 + 3] = 255;
      } else this.data[a2] = 255, this.data[a2 + 1] = 255, this.data[a2 + 2] = 255, this.data[a2 + 3] = 255;
    }
    0 !== t3 && (this.pos += 4 - t3);
  }
}, ce.prototype.bit15 = function() {
  for (var t3 = this.width % 3, e2 = parseInt("11111", 2), n2 = this.height - 1; n2 >= 0; n2--) {
    for (var r2 = this.bottom_up ? n2 : this.height - 1 - n2, i2 = 0; i2 < this.width; i2++) {
      var a2 = this.datav.getUint16(this.pos, true);
      this.pos += 2;
      var o2 = (a2 & e2) / e2 * 255 | 0, s2 = (a2 >> 5 & e2) / e2 * 255 | 0, u2 = (a2 >> 10 & e2) / e2 * 255 | 0, c2 = a2 >> 15 ? 255 : 0, l2 = r2 * this.width * 4 + 4 * i2;
      this.data[l2] = u2, this.data[l2 + 1] = s2, this.data[l2 + 2] = o2, this.data[l2 + 3] = c2;
    }
    this.pos += t3;
  }
}, ce.prototype.bit16 = function() {
  for (var t3 = this.width % 3, e2 = parseInt("11111", 2), n2 = parseInt("111111", 2), r2 = this.height - 1; r2 >= 0; r2--) {
    for (var i2 = this.bottom_up ? r2 : this.height - 1 - r2, a2 = 0; a2 < this.width; a2++) {
      var o2 = this.datav.getUint16(this.pos, true);
      this.pos += 2;
      var s2 = (o2 & e2) / e2 * 255 | 0, u2 = (o2 >> 5 & n2) / n2 * 255 | 0, c2 = (o2 >> 11) / e2 * 255 | 0, l2 = i2 * this.width * 4 + 4 * a2;
      this.data[l2] = c2, this.data[l2 + 1] = u2, this.data[l2 + 2] = s2, this.data[l2 + 3] = 255;
    }
    this.pos += t3;
  }
}, ce.prototype.bit24 = function() {
  for (var t3 = this.height - 1; t3 >= 0; t3--) {
    for (var e2 = this.bottom_up ? t3 : this.height - 1 - t3, n2 = 0; n2 < this.width; n2++) {
      var r2 = this.datav.getUint8(this.pos++, true), i2 = this.datav.getUint8(this.pos++, true), a2 = this.datav.getUint8(this.pos++, true), o2 = e2 * this.width * 4 + 4 * n2;
      this.data[o2] = a2, this.data[o2 + 1] = i2, this.data[o2 + 2] = r2, this.data[o2 + 3] = 255;
    }
    this.pos += this.width % 4;
  }
}, ce.prototype.bit32 = function() {
  for (var t3 = this.height - 1; t3 >= 0; t3--) for (var e2 = this.bottom_up ? t3 : this.height - 1 - t3, n2 = 0; n2 < this.width; n2++) {
    var r2 = this.datav.getUint8(this.pos++, true), i2 = this.datav.getUint8(this.pos++, true), a2 = this.datav.getUint8(this.pos++, true), o2 = this.datav.getUint8(this.pos++, true), s2 = e2 * this.width * 4 + 4 * n2;
    this.data[s2] = a2, this.data[s2 + 1] = i2, this.data[s2 + 2] = r2, this.data[s2 + 3] = o2;
  }
}, ce.prototype.getData = function() {
  return this.data;
}, /**
 * @license
 * Copyright (c) 2018 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  t3.processBMP = function(e2, n2, r2, i2) {
    var a2 = new ce(e2, false), o2 = a2.width, s2 = a2.height, u2 = { data: a2.getData(), width: o2, height: s2 }, c2 = new ue(100).encode(u2, 100);
    return t3.processJPEG.call(this, c2, n2, r2, i2);
  };
}(E.API), le.prototype.getData = function() {
  return this.data;
}, /**
 * @license
 * Copyright (c) 2019 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  t3.processWEBP = function(e2, n2, r2, i2) {
    var a2 = new le(e2), o2 = a2.width, s2 = a2.height, u2 = { data: a2.getData(), width: o2, height: s2 }, c2 = new ue(100).encode(u2, 100);
    return t3.processJPEG.call(this, c2, n2, r2, i2);
  };
}(E.API), E.API.processRGBA = function(t3, e2, n2) {
  for (var r2 = t3.data, i2 = r2.length, a2 = new Uint8Array(i2 / 4 * 3), o2 = new Uint8Array(i2 / 4), s2 = 0, u2 = 0, c2 = 0; c2 < i2; c2 += 4) {
    var l2 = r2[c2], h2 = r2[c2 + 1], f2 = r2[c2 + 2], d2 = r2[c2 + 3];
    a2[s2++] = l2, a2[s2++] = h2, a2[s2++] = f2, o2[u2++] = d2;
  }
  var p2 = this.__addimage__.arrayBufferToBinaryString(a2);
  return { alpha: this.__addimage__.arrayBufferToBinaryString(o2), data: p2, index: e2, alias: n2, colorSpace: "DeviceRGB", bitsPerComponent: 8, width: t3.width, height: t3.height };
}, E.API.setLanguage = function(t3) {
  return void 0 === this.internal.languageSettings && (this.internal.languageSettings = {}, this.internal.languageSettings.isSubscribed = false), void 0 !== { af: "Afrikaans", sq: "Albanian", ar: "Arabic (Standard)", "ar-DZ": "Arabic (Algeria)", "ar-BH": "Arabic (Bahrain)", "ar-EG": "Arabic (Egypt)", "ar-IQ": "Arabic (Iraq)", "ar-JO": "Arabic (Jordan)", "ar-KW": "Arabic (Kuwait)", "ar-LB": "Arabic (Lebanon)", "ar-LY": "Arabic (Libya)", "ar-MA": "Arabic (Morocco)", "ar-OM": "Arabic (Oman)", "ar-QA": "Arabic (Qatar)", "ar-SA": "Arabic (Saudi Arabia)", "ar-SY": "Arabic (Syria)", "ar-TN": "Arabic (Tunisia)", "ar-AE": "Arabic (U.A.E.)", "ar-YE": "Arabic (Yemen)", an: "Aragonese", hy: "Armenian", as: "Assamese", ast: "Asturian", az: "Azerbaijani", eu: "Basque", be: "Belarusian", bn: "Bengali", bs: "Bosnian", br: "Breton", bg: "Bulgarian", my: "Burmese", ca: "Catalan", ch: "Chamorro", ce: "Chechen", zh: "Chinese", "zh-HK": "Chinese (Hong Kong)", "zh-CN": "Chinese (PRC)", "zh-SG": "Chinese (Singapore)", "zh-TW": "Chinese (Taiwan)", cv: "Chuvash", co: "Corsican", cr: "Cree", hr: "Croatian", cs: "Czech", da: "Danish", nl: "Dutch (Standard)", "nl-BE": "Dutch (Belgian)", en: "English", "en-AU": "English (Australia)", "en-BZ": "English (Belize)", "en-CA": "English (Canada)", "en-IE": "English (Ireland)", "en-JM": "English (Jamaica)", "en-NZ": "English (New Zealand)", "en-PH": "English (Philippines)", "en-ZA": "English (South Africa)", "en-TT": "English (Trinidad & Tobago)", "en-GB": "English (United Kingdom)", "en-US": "English (United States)", "en-ZW": "English (Zimbabwe)", eo: "Esperanto", et: "Estonian", fo: "Faeroese", fj: "Fijian", fi: "Finnish", fr: "French (Standard)", "fr-BE": "French (Belgium)", "fr-CA": "French (Canada)", "fr-FR": "French (France)", "fr-LU": "French (Luxembourg)", "fr-MC": "French (Monaco)", "fr-CH": "French (Switzerland)", fy: "Frisian", fur: "Friulian", gd: "Gaelic (Scots)", "gd-IE": "Gaelic (Irish)", gl: "Galacian", ka: "Georgian", de: "German (Standard)", "de-AT": "German (Austria)", "de-DE": "German (Germany)", "de-LI": "German (Liechtenstein)", "de-LU": "German (Luxembourg)", "de-CH": "German (Switzerland)", el: "Greek", gu: "Gujurati", ht: "Haitian", he: "Hebrew", hi: "Hindi", hu: "Hungarian", is: "Icelandic", id: "Indonesian", iu: "Inuktitut", ga: "Irish", it: "Italian (Standard)", "it-CH": "Italian (Switzerland)", ja: "Japanese", kn: "Kannada", ks: "Kashmiri", kk: "Kazakh", km: "Khmer", ky: "Kirghiz", tlh: "Klingon", ko: "Korean", "ko-KP": "Korean (North Korea)", "ko-KR": "Korean (South Korea)", la: "Latin", lv: "Latvian", lt: "Lithuanian", lb: "Luxembourgish", mk: "North Macedonia", ms: "Malay", ml: "Malayalam", mt: "Maltese", mi: "Maori", mr: "Marathi", mo: "Moldavian", nv: "Navajo", ng: "Ndonga", ne: "Nepali", no: "Norwegian", nb: "Norwegian (Bokmal)", nn: "Norwegian (Nynorsk)", oc: "Occitan", or: "Oriya", om: "Oromo", fa: "Persian", "fa-IR": "Persian/Iran", pl: "Polish", pt: "Portuguese", "pt-BR": "Portuguese (Brazil)", pa: "Punjabi", "pa-IN": "Punjabi (India)", "pa-PK": "Punjabi (Pakistan)", qu: "Quechua", rm: "Rhaeto-Romanic", ro: "Romanian", "ro-MO": "Romanian (Moldavia)", ru: "Russian", "ru-MO": "Russian (Moldavia)", sz: "Sami (Lappish)", sg: "Sango", sa: "Sanskrit", sc: "Sardinian", sd: "Sindhi", si: "Singhalese", sr: "Serbian", sk: "Slovak", sl: "Slovenian", so: "Somani", sb: "Sorbian", es: "Spanish", "es-AR": "Spanish (Argentina)", "es-BO": "Spanish (Bolivia)", "es-CL": "Spanish (Chile)", "es-CO": "Spanish (Colombia)", "es-CR": "Spanish (Costa Rica)", "es-DO": "Spanish (Dominican Republic)", "es-EC": "Spanish (Ecuador)", "es-SV": "Spanish (El Salvador)", "es-GT": "Spanish (Guatemala)", "es-HN": "Spanish (Honduras)", "es-MX": "Spanish (Mexico)", "es-NI": "Spanish (Nicaragua)", "es-PA": "Spanish (Panama)", "es-PY": "Spanish (Paraguay)", "es-PE": "Spanish (Peru)", "es-PR": "Spanish (Puerto Rico)", "es-ES": "Spanish (Spain)", "es-UY": "Spanish (Uruguay)", "es-VE": "Spanish (Venezuela)", sx: "Sutu", sw: "Swahili", sv: "Swedish", "sv-FI": "Swedish (Finland)", "sv-SV": "Swedish (Sweden)", ta: "Tamil", tt: "Tatar", te: "Teluga", th: "Thai", tig: "Tigre", ts: "Tsonga", tn: "Tswana", tr: "Turkish", tk: "Turkmen", uk: "Ukrainian", hsb: "Upper Sorbian", ur: "Urdu", ve: "Venda", vi: "Vietnamese", vo: "Volapuk", wa: "Walloon", cy: "Welsh", xh: "Xhosa", ji: "Yiddish", zu: "Zulu" }[t3] && (this.internal.languageSettings.languageCode = t3, false === this.internal.languageSettings.isSubscribed && (this.internal.events.subscribe("putCatalog", function() {
    this.internal.write("/Lang (" + this.internal.languageSettings.languageCode + ")");
  }), this.internal.languageSettings.isSubscribed = true)), this;
}, Ht = E.API, Wt = Ht.getCharWidthsArray = function(e2, n2) {
  var r2, i2, a2 = (n2 = n2 || {}).font || this.internal.getFont(), o2 = n2.fontSize || this.internal.getFontSize(), s2 = n2.charSpace || this.internal.getCharSpace(), u2 = n2.widths ? n2.widths : a2.metadata.Unicode.widths, c2 = u2.fof ? u2.fof : 1, l2 = n2.kerning ? n2.kerning : a2.metadata.Unicode.kerning, h2 = l2.fof ? l2.fof : 1, f2 = false !== n2.doKerning, d2 = 0, p2 = e2.length, g2 = 0, m2 = u2[0] || c2, v2 = [];
  for (r2 = 0; r2 < p2; r2++) i2 = e2.charCodeAt(r2), "function" == typeof a2.metadata.widthOfString ? v2.push((a2.metadata.widthOfGlyph(a2.metadata.characterToGlyph(i2)) + s2 * (1e3 / o2) || 0) / 1e3) : (d2 = f2 && "object" === _typeof(l2[i2]) && !isNaN(parseInt(l2[i2][g2], 10)) ? l2[i2][g2] / h2 : 0, v2.push((u2[i2] || m2) / c2 + d2)), g2 = i2;
  return v2;
}, Vt = Ht.getStringUnitWidth = function(t3, e2) {
  var n2 = (e2 = e2 || {}).fontSize || this.internal.getFontSize(), r2 = e2.font || this.internal.getFont(), i2 = e2.charSpace || this.internal.getCharSpace();
  return Ht.processArabic && (t3 = Ht.processArabic(t3)), "function" == typeof r2.metadata.widthOfString ? r2.metadata.widthOfString(t3, n2, i2) / n2 : Wt.apply(this, arguments).reduce(function(t4, e3) {
    return t4 + e3;
  }, 0);
}, Gt = function(t3, e2, n2, r2) {
  for (var i2 = [], a2 = 0, o2 = t3.length, s2 = 0; a2 !== o2 && s2 + e2[a2] < n2; ) s2 += e2[a2], a2++;
  i2.push(t3.slice(0, a2));
  var u2 = a2;
  for (s2 = 0; a2 !== o2; ) s2 + e2[a2] > r2 && (i2.push(t3.slice(u2, a2)), s2 = 0, u2 = a2), s2 += e2[a2], a2++;
  return u2 !== a2 && i2.push(t3.slice(u2, a2)), i2;
}, Yt = function(t3, e2, n2) {
  n2 || (n2 = {});
  var r2, i2, a2, o2, s2, u2, c2, l2 = [], h2 = [l2], f2 = n2.textIndent || 0, d2 = 0, p2 = 0, g2 = t3.split(" "), m2 = Wt.apply(this, [" ", n2])[0];
  if (u2 = -1 === n2.lineIndent ? g2[0].length + 2 : n2.lineIndent || 0) {
    var v2 = Array(u2).join(" "), b2 = [];
    g2.map(function(t4) {
      (t4 = t4.split(/\s*\n/)).length > 1 ? b2 = b2.concat(t4.map(function(t5, e3) {
        return (e3 && t5.length ? "\n" : "") + t5;
      })) : b2.push(t4[0]);
    }), g2 = b2, u2 = Vt.apply(this, [v2, n2]);
  }
  for (a2 = 0, o2 = g2.length; a2 < o2; a2++) {
    var y2 = 0;
    if (r2 = g2[a2], u2 && "\n" == r2[0] && (r2 = r2.substr(1), y2 = 1), f2 + d2 + (p2 = (i2 = Wt.apply(this, [r2, n2])).reduce(function(t4, e3) {
      return t4 + e3;
    }, 0)) > e2 || y2) {
      if (p2 > e2) {
        for (s2 = Gt.apply(this, [r2, i2, e2 - (f2 + d2), e2]), l2.push(s2.shift()), l2 = [s2.pop()]; s2.length; ) h2.push([s2.shift()]);
        p2 = i2.slice(r2.length - (l2[0] ? l2[0].length : 0)).reduce(function(t4, e3) {
          return t4 + e3;
        }, 0);
      } else l2 = [r2];
      h2.push(l2), f2 = p2 + u2, d2 = m2;
    } else l2.push(r2), f2 += d2 + p2, d2 = m2;
  }
  return c2 = u2 ? function(t4, e3) {
    return (e3 ? v2 : "") + t4.join(" ");
  } : function(t4) {
    return t4.join(" ");
  }, h2.map(c2);
}, Ht.splitTextToSize = function(t3, e2, n2) {
  var r2, i2 = (n2 = n2 || {}).fontSize || this.internal.getFontSize(), a2 = function(t4) {
    if (t4.widths && t4.kerning) return { widths: t4.widths, kerning: t4.kerning };
    var e3 = this.internal.getFont(t4.fontName, t4.fontStyle), n3 = "Unicode";
    return e3.metadata[n3] ? { widths: e3.metadata[n3].widths || { 0: 1 }, kerning: e3.metadata[n3].kerning || {} } : { font: e3.metadata, fontSize: this.internal.getFontSize(), charSpace: this.internal.getCharSpace() };
  }.call(this, n2);
  r2 = Array.isArray(t3) ? t3 : String(t3).split(/\r?\n/);
  var o2 = 1 * this.internal.scaleFactor * e2 / i2;
  a2.textIndent = n2.textIndent ? 1 * n2.textIndent * this.internal.scaleFactor / i2 : 0, a2.lineIndent = n2.lineIndent;
  var s2, u2, c2 = [];
  for (s2 = 0, u2 = r2.length; s2 < u2; s2++) c2 = c2.concat(Yt.apply(this, [r2[s2], o2, a2]));
  return c2;
}, function(e2) {
  e2.__fontmetrics__ = e2.__fontmetrics__ || {};
  for (var n2 = "0123456789abcdef", r2 = "klmnopqrstuvwxyz", i2 = {}, a2 = {}, o2 = 0; o2 < 16; o2++) i2[r2[o2]] = n2[o2], a2[n2[o2]] = r2[o2];
  var s2 = function(t3) {
    return "0x" + parseInt(t3, 10).toString(16);
  }, u2 = e2.__fontmetrics__.compress = function(e3) {
    var n3, r3, i3, o3, c3 = ["{"];
    for (var l3 in e3) {
      if (n3 = e3[l3], isNaN(parseInt(l3, 10)) ? r3 = "'" + l3 + "'" : (l3 = parseInt(l3, 10), r3 = (r3 = s2(l3).slice(2)).slice(0, -1) + a2[r3.slice(-1)]), "number" == typeof n3) n3 < 0 ? (i3 = s2(n3).slice(3), o3 = "-") : (i3 = s2(n3).slice(2), o3 = ""), i3 = o3 + i3.slice(0, -1) + a2[i3.slice(-1)];
      else {
        if ("object" !== _typeof(n3)) throw new Error("Don't know what to do with value type " + _typeof(n3) + ".");
        i3 = u2(n3);
      }
      c3.push(r3 + i3);
    }
    return c3.push("}"), c3.join("");
  }, c2 = e2.__fontmetrics__.uncompress = function(t3) {
    if ("string" != typeof t3) throw new Error("Invalid argument passed to uncompress.");
    for (var e3, n3, r3, a3, o3 = {}, s3 = 1, u3 = o3, c3 = [], l3 = "", h3 = "", f3 = t3.length - 1, d2 = 1; d2 < f3; d2 += 1) "'" == (a3 = t3[d2]) ? e3 ? (r3 = e3.join(""), e3 = void 0) : e3 = [] : e3 ? e3.push(a3) : "{" == a3 ? (c3.push([u3, r3]), u3 = {}, r3 = void 0) : "}" == a3 ? ((n3 = c3.pop())[0][n3[1]] = u3, r3 = void 0, u3 = n3[0]) : "-" == a3 ? s3 = -1 : void 0 === r3 ? i2.hasOwnProperty(a3) ? (l3 += i2[a3], r3 = parseInt(l3, 16) * s3, s3 = 1, l3 = "") : l3 += a3 : i2.hasOwnProperty(a3) ? (h3 += i2[a3], u3[r3] = parseInt(h3, 16) * s3, s3 = 1, r3 = void 0, h3 = "") : h3 += a3;
    return o3;
  }, l2 = { codePages: ["WinAnsiEncoding"], WinAnsiEncoding: c2("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}") }, h2 = { Unicode: { Courier: l2, "Courier-Bold": l2, "Courier-BoldOblique": l2, "Courier-Oblique": l2, Helvetica: l2, "Helvetica-Bold": l2, "Helvetica-BoldOblique": l2, "Helvetica-Oblique": l2, "Times-Roman": l2, "Times-Bold": l2, "Times-BoldItalic": l2, "Times-Italic": l2 } }, f2 = { Unicode: { "Courier-Oblique": c2("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"), "Times-BoldItalic": c2("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"), "Helvetica-Bold": c2("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"), Courier: c2("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"), "Courier-BoldOblique": c2("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"), "Times-Bold": c2("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"), Symbol: c2("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"), Helvetica: c2("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"), "Helvetica-BoldOblique": c2("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"), ZapfDingbats: c2("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"), "Courier-Bold": c2("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"), "Times-Italic": c2("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"), "Times-Roman": c2("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"), "Helvetica-Oblique": c2("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}") } };
  e2.events.push(["addFont", function(t3) {
    var e3 = t3.font, n3 = f2.Unicode[e3.postScriptName];
    n3 && (e3.metadata.Unicode = {}, e3.metadata.Unicode.widths = n3.widths, e3.metadata.Unicode.kerning = n3.kerning);
    var r3 = h2.Unicode[e3.postScriptName];
    r3 && (e3.metadata.Unicode.encoding = r3, e3.encoding = r3.codePages[0]);
  }]);
}(E.API), /**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  var e2 = function(t4) {
    for (var e3 = t4.length, n2 = new Uint8Array(e3), r2 = 0; r2 < e3; r2++) n2[r2] = t4.charCodeAt(r2);
    return n2;
  };
  t3.API.events.push(["addFont", function(n2) {
    var r2 = void 0, i2 = n2.font, a2 = n2.instance;
    if (!i2.isStandardFont) {
      if (void 0 === a2) throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('" + i2.postScriptName + "').");
      if ("string" != typeof (r2 = false === a2.existsFileInVFS(i2.postScriptName) ? a2.loadFile(i2.postScriptName) : a2.getFileFromVFS(i2.postScriptName))) throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('" + i2.postScriptName + "').");
      !function(n3, r3) {
        r3 = /^\x00\x01\x00\x00/.test(r3) ? e2(r3) : e2(f(r3)), n3.metadata = t3.API.TTFFont.open(r3), n3.metadata.Unicode = n3.metadata.Unicode || { encoding: {}, kerning: {}, widths: [] }, n3.metadata.glyIdsUsed = [0];
      }(i2, r2);
    }
  }]);
}(E), E.API.addSvgAsImage = function(t3, e2, n2, r2, a2, s2, u2, c2) {
  if (isNaN(e2) || isNaN(n2)) throw o.error("jsPDF.addSvgAsImage: Invalid coordinates", arguments), new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");
  if (isNaN(r2) || isNaN(a2)) throw o.error("jsPDF.addSvgAsImage: Invalid measurements", arguments), new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");
  var l2 = document.createElement("canvas");
  l2.width = r2, l2.height = a2;
  var h2 = l2.getContext("2d");
  h2.fillStyle = "#fff", h2.fillRect(0, 0, l2.width, l2.height);
  var f2 = { ignoreMouse: true, ignoreAnimation: true, ignoreDimensions: true }, d2 = this;
  return (i.canvg ? Promise.resolve(i.canvg) : __vitePreload(() => import('./index.es.Dl-oCgzs.js'),true?__vite__mapDeps([12,2,1,3,6,5,7,8,9]):void 0)).catch(function(t4) {
    return Promise.reject(new Error("Could not load canvg: " + t4));
  }).then(function(t4) {
    return t4.default ? t4.default : t4;
  }).then(function(e3) {
    return e3.fromString(h2, t3, f2);
  }, function() {
    return Promise.reject(new Error("Could not load canvg."));
  }).then(function(t4) {
    return t4.render(f2);
  }).then(function() {
    d2.addImage(l2.toDataURL("image/jpeg", 1), e2, n2, r2, a2, u2, c2);
  });
}, E.API.putTotalPages = function(t3) {
  var e2, n2 = 0;
  parseInt(this.internal.getFont().id.substr(1), 10) < 15 ? (e2 = new RegExp(t3, "g"), n2 = this.internal.getNumberOfPages()) : (e2 = new RegExp(this.pdfEscape16(t3, this.internal.getFont()), "g"), n2 = this.pdfEscape16(this.internal.getNumberOfPages() + "", this.internal.getFont()));
  for (var r2 = 1; r2 <= this.internal.getNumberOfPages(); r2++) for (var i2 = 0; i2 < this.internal.pages[r2].length; i2++) this.internal.pages[r2][i2] = this.internal.pages[r2][i2].replace(e2, n2);
  return this;
}, E.API.viewerPreferences = function(e2, n2) {
  var r2;
  e2 = e2 || {}, n2 = n2 || false;
  var i2, a2, o2, s2 = { HideToolbar: { defaultValue: false, value: false, type: "boolean", explicitSet: false, valueSet: [true, false], pdfVersion: 1.3 }, HideMenubar: { defaultValue: false, value: false, type: "boolean", explicitSet: false, valueSet: [true, false], pdfVersion: 1.3 }, HideWindowUI: { defaultValue: false, value: false, type: "boolean", explicitSet: false, valueSet: [true, false], pdfVersion: 1.3 }, FitWindow: { defaultValue: false, value: false, type: "boolean", explicitSet: false, valueSet: [true, false], pdfVersion: 1.3 }, CenterWindow: { defaultValue: false, value: false, type: "boolean", explicitSet: false, valueSet: [true, false], pdfVersion: 1.3 }, DisplayDocTitle: { defaultValue: false, value: false, type: "boolean", explicitSet: false, valueSet: [true, false], pdfVersion: 1.4 }, NonFullScreenPageMode: { defaultValue: "UseNone", value: "UseNone", type: "name", explicitSet: false, valueSet: ["UseNone", "UseOutlines", "UseThumbs", "UseOC"], pdfVersion: 1.3 }, Direction: { defaultValue: "L2R", value: "L2R", type: "name", explicitSet: false, valueSet: ["L2R", "R2L"], pdfVersion: 1.3 }, ViewArea: { defaultValue: "CropBox", value: "CropBox", type: "name", explicitSet: false, valueSet: ["MediaBox", "CropBox", "TrimBox", "BleedBox", "ArtBox"], pdfVersion: 1.4 }, ViewClip: { defaultValue: "CropBox", value: "CropBox", type: "name", explicitSet: false, valueSet: ["MediaBox", "CropBox", "TrimBox", "BleedBox", "ArtBox"], pdfVersion: 1.4 }, PrintArea: { defaultValue: "CropBox", value: "CropBox", type: "name", explicitSet: false, valueSet: ["MediaBox", "CropBox", "TrimBox", "BleedBox", "ArtBox"], pdfVersion: 1.4 }, PrintClip: { defaultValue: "CropBox", value: "CropBox", type: "name", explicitSet: false, valueSet: ["MediaBox", "CropBox", "TrimBox", "BleedBox", "ArtBox"], pdfVersion: 1.4 }, PrintScaling: { defaultValue: "AppDefault", value: "AppDefault", type: "name", explicitSet: false, valueSet: ["AppDefault", "None"], pdfVersion: 1.6 }, Duplex: { defaultValue: "", value: "none", type: "name", explicitSet: false, valueSet: ["Simplex", "DuplexFlipShortEdge", "DuplexFlipLongEdge", "none"], pdfVersion: 1.7 }, PickTrayByPDFSize: { defaultValue: false, value: false, type: "boolean", explicitSet: false, valueSet: [true, false], pdfVersion: 1.7 }, PrintPageRange: { defaultValue: "", value: "", type: "array", explicitSet: false, valueSet: null, pdfVersion: 1.7 }, NumCopies: { defaultValue: 1, value: 1, type: "integer", explicitSet: false, valueSet: null, pdfVersion: 1.7 } }, u2 = Object.keys(s2), c2 = [], l2 = 0, h2 = 0, f2 = 0;
  function d2(t3, e3) {
    var n3, r3 = false;
    for (n3 = 0; n3 < t3.length; n3 += 1) t3[n3] === e3 && (r3 = true);
    return r3;
  }
  if (void 0 === this.internal.viewerpreferences && (this.internal.viewerpreferences = {}, this.internal.viewerpreferences.configuration = JSON.parse(JSON.stringify(s2)), this.internal.viewerpreferences.isSubscribed = false), r2 = this.internal.viewerpreferences.configuration, "reset" === e2 || true === n2) {
    var p2 = u2.length;
    for (f2 = 0; f2 < p2; f2 += 1) r2[u2[f2]].value = r2[u2[f2]].defaultValue, r2[u2[f2]].explicitSet = false;
  }
  if ("object" === _typeof(e2)) {
    for (a2 in e2) if (o2 = e2[a2], d2(u2, a2) && void 0 !== o2) {
      if ("boolean" === r2[a2].type && "boolean" == typeof o2) r2[a2].value = o2;
      else if ("name" === r2[a2].type && d2(r2[a2].valueSet, o2)) r2[a2].value = o2;
      else if ("integer" === r2[a2].type && Number.isInteger(o2)) r2[a2].value = o2;
      else if ("array" === r2[a2].type) {
        for (l2 = 0; l2 < o2.length; l2 += 1) if (i2 = true, 1 === o2[l2].length && "number" == typeof o2[l2][0]) c2.push(String(o2[l2] - 1));
        else if (o2[l2].length > 1) {
          for (h2 = 0; h2 < o2[l2].length; h2 += 1) "number" != typeof o2[l2][h2] && (i2 = false);
          true === i2 && c2.push([o2[l2][0] - 1, o2[l2][1] - 1].join(" "));
        }
        r2[a2].value = "[" + c2.join(" ") + "]";
      } else r2[a2].value = r2[a2].defaultValue;
      r2[a2].explicitSet = true;
    }
  }
  return false === this.internal.viewerpreferences.isSubscribed && (this.internal.events.subscribe("putCatalog", function() {
    var t3, e3 = [];
    for (t3 in r2) true === r2[t3].explicitSet && ("name" === r2[t3].type ? e3.push("/" + t3 + " /" + r2[t3].value) : e3.push("/" + t3 + " " + r2[t3].value));
    0 !== e3.length && this.internal.write("/ViewerPreferences\n<<\n" + e3.join("\n") + "\n>>");
  }), this.internal.viewerpreferences.isSubscribed = true), this.internal.viewerpreferences.configuration = r2, this;
}, /** ====================================================================
 * @license
 * jsPDF XMP metadata plugin
 * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */
function(t3) {
  var e2 = function() {
    var t4 = '<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="' + this.internal.__metadata__.namespaceuri + '"><jspdf:metadata>', e3 = unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')), n3 = unescape(encodeURIComponent(t4)), r2 = unescape(encodeURIComponent(this.internal.__metadata__.metadata)), i2 = unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")), a2 = unescape(encodeURIComponent("</x:xmpmeta>")), o2 = n3.length + r2.length + i2.length + e3.length + a2.length;
    this.internal.__metadata__.metadata_object_number = this.internal.newObject(), this.internal.write("<< /Type /Metadata /Subtype /XML /Length " + o2 + " >>"), this.internal.write("stream"), this.internal.write(e3 + n3 + r2 + i2 + a2), this.internal.write("endstream"), this.internal.write("endobj");
  }, n2 = function() {
    this.internal.__metadata__.metadata_object_number && this.internal.write("/Metadata " + this.internal.__metadata__.metadata_object_number + " 0 R");
  };
  t3.addMetadata = function(t4, r2) {
    return void 0 === this.internal.__metadata__ && (this.internal.__metadata__ = { metadata: t4, namespaceuri: r2 || "http://jspdf.default.namespaceuri/" }, this.internal.events.subscribe("putCatalog", n2), this.internal.events.subscribe("postPutResources", e2)), this;
  };
}(E.API), function(t3) {
  var e2 = t3.API, n2 = e2.pdfEscape16 = function(t4, e3) {
    for (var n3, r3 = e3.metadata.Unicode.widths, i3 = ["", "0", "00", "000", "0000"], a2 = [""], o2 = 0, s2 = t4.length; o2 < s2; ++o2) {
      if (n3 = e3.metadata.characterToGlyph(t4.charCodeAt(o2)), e3.metadata.glyIdsUsed.push(n3), e3.metadata.toUnicode[n3] = t4.charCodeAt(o2), -1 == r3.indexOf(n3) && (r3.push(n3), r3.push([parseInt(e3.metadata.widthOfGlyph(n3), 10)])), "0" == n3) return a2.join("");
      n3 = n3.toString(16), a2.push(i3[4 - n3.length], n3);
    }
    return a2.join("");
  }, r2 = function(t4) {
    var e3, n3, r3, i3, a2, o2, s2;
    for (a2 = "/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange", r3 = [], o2 = 0, s2 = (n3 = Object.keys(t4).sort(function(t5, e4) {
      return t5 - e4;
    })).length; o2 < s2; o2++) e3 = n3[o2], r3.length >= 100 && (a2 += "\n" + r3.length + " beginbfchar\n" + r3.join("\n") + "\nendbfchar", r3 = []), void 0 !== t4[e3] && null !== t4[e3] && "function" == typeof t4[e3].toString && (i3 = ("0000" + t4[e3].toString(16)).slice(-4), e3 = ("0000" + (+e3).toString(16)).slice(-4), r3.push("<" + e3 + "><" + i3 + ">"));
    return r3.length && (a2 += "\n" + r3.length + " beginbfchar\n" + r3.join("\n") + "\nendbfchar\n"), a2 + "endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend";
  };
  e2.events.push(["putFont", function(e3) {
    !function(e4) {
      var n3 = e4.font, i3 = e4.out, a2 = e4.newObject, o2 = e4.putStream;
      if (n3.metadata instanceof t3.API.TTFFont && "Identity-H" === n3.encoding) {
        for (var s2 = n3.metadata.Unicode.widths, u2 = n3.metadata.subset.encode(n3.metadata.glyIdsUsed, 1), c2 = "", l2 = 0; l2 < u2.length; l2++) c2 += String.fromCharCode(u2[l2]);
        var h2 = a2();
        o2({ data: c2, addLength1: true, objectId: h2 }), i3("endobj");
        var f2 = a2();
        o2({ data: r2(n3.metadata.toUnicode), addLength1: true, objectId: f2 }), i3("endobj");
        var d2 = a2();
        i3("<<"), i3("/Type /FontDescriptor"), i3("/FontName /" + j(n3.fontName)), i3("/FontFile2 " + h2 + " 0 R"), i3("/FontBBox " + t3.API.PDFObject.convert(n3.metadata.bbox)), i3("/Flags " + n3.metadata.flags), i3("/StemV " + n3.metadata.stemV), i3("/ItalicAngle " + n3.metadata.italicAngle), i3("/Ascent " + n3.metadata.ascender), i3("/Descent " + n3.metadata.decender), i3("/CapHeight " + n3.metadata.capHeight), i3(">>"), i3("endobj");
        var p2 = a2();
        i3("<<"), i3("/Type /Font"), i3("/BaseFont /" + j(n3.fontName)), i3("/FontDescriptor " + d2 + " 0 R"), i3("/W " + t3.API.PDFObject.convert(s2)), i3("/CIDToGIDMap /Identity"), i3("/DW 1000"), i3("/Subtype /CIDFontType2"), i3("/CIDSystemInfo"), i3("<<"), i3("/Supplement 0"), i3("/Registry (Adobe)"), i3("/Ordering (" + n3.encoding + ")"), i3(">>"), i3(">>"), i3("endobj"), n3.objectNumber = a2(), i3("<<"), i3("/Type /Font"), i3("/Subtype /Type0"), i3("/ToUnicode " + f2 + " 0 R"), i3("/BaseFont /" + j(n3.fontName)), i3("/Encoding /" + n3.encoding), i3("/DescendantFonts [" + p2 + " 0 R]"), i3(">>"), i3("endobj"), n3.isAlreadyPutted = true;
      }
    }(e3);
  }]), e2.events.push(["putFont", function(e3) {
    !function(e4) {
      var n3 = e4.font, i3 = e4.out, a2 = e4.newObject, o2 = e4.putStream;
      if (n3.metadata instanceof t3.API.TTFFont && "WinAnsiEncoding" === n3.encoding) {
        for (var s2 = n3.metadata.rawData, u2 = "", c2 = 0; c2 < s2.length; c2++) u2 += String.fromCharCode(s2[c2]);
        var l2 = a2();
        o2({ data: u2, addLength1: true, objectId: l2 }), i3("endobj");
        var h2 = a2();
        o2({ data: r2(n3.metadata.toUnicode), addLength1: true, objectId: h2 }), i3("endobj");
        var f2 = a2();
        i3("<<"), i3("/Descent " + n3.metadata.decender), i3("/CapHeight " + n3.metadata.capHeight), i3("/StemV " + n3.metadata.stemV), i3("/Type /FontDescriptor"), i3("/FontFile2 " + l2 + " 0 R"), i3("/Flags 96"), i3("/FontBBox " + t3.API.PDFObject.convert(n3.metadata.bbox)), i3("/FontName /" + j(n3.fontName)), i3("/ItalicAngle " + n3.metadata.italicAngle), i3("/Ascent " + n3.metadata.ascender), i3(">>"), i3("endobj"), n3.objectNumber = a2();
        for (var d2 = 0; d2 < n3.metadata.hmtx.widths.length; d2++) n3.metadata.hmtx.widths[d2] = parseInt(n3.metadata.hmtx.widths[d2] * (1e3 / n3.metadata.head.unitsPerEm));
        i3("<</Subtype/TrueType/Type/Font/ToUnicode " + h2 + " 0 R/BaseFont/" + j(n3.fontName) + "/FontDescriptor " + f2 + " 0 R/Encoding/" + n3.encoding + " /FirstChar 29 /LastChar 255 /Widths " + t3.API.PDFObject.convert(n3.metadata.hmtx.widths) + ">>"), i3("endobj"), n3.isAlreadyPutted = true;
      }
    }(e3);
  }]);
  var i2 = function(t4) {
    var e3, r3 = t4.text || "", i3 = t4.x, a2 = t4.y, o2 = t4.options || {}, s2 = t4.mutex || {}, u2 = s2.pdfEscape, c2 = s2.activeFontKey, l2 = s2.fonts, h2 = c2, f2 = "", d2 = 0, p2 = "", g2 = l2[h2].encoding;
    if ("Identity-H" !== l2[h2].encoding) return { text: r3, x: i3, y: a2, options: o2, mutex: s2 };
    for (p2 = r3, h2 = c2, Array.isArray(r3) && (p2 = r3[0]), d2 = 0; d2 < p2.length; d2 += 1) l2[h2].metadata.hasOwnProperty("cmap") && (e3 = l2[h2].metadata.cmap.unicode.codeMap[p2[d2].charCodeAt(0)]), e3 || p2[d2].charCodeAt(0) < 256 && l2[h2].metadata.hasOwnProperty("Unicode") ? f2 += p2[d2] : f2 += "";
    var m2 = "";
    return parseInt(h2.slice(1)) < 14 || "WinAnsiEncoding" === g2 ? m2 = u2(f2, h2).split("").map(function(t5) {
      return t5.charCodeAt(0).toString(16);
    }).join("") : "Identity-H" === g2 && (m2 = n2(f2, l2[h2])), s2.isHex = true, { text: m2, x: i3, y: a2, options: o2, mutex: s2 };
  };
  e2.events.push(["postProcessText", function(t4) {
    var e3 = t4.text || "", n3 = [], r3 = { text: e3, x: t4.x, y: t4.y, options: t4.options, mutex: t4.mutex };
    if (Array.isArray(e3)) {
      var a2 = 0;
      for (a2 = 0; a2 < e3.length; a2 += 1) Array.isArray(e3[a2]) && 3 === e3[a2].length ? n3.push([i2(Object.assign({}, r3, { text: e3[a2][0] })).text, e3[a2][1], e3[a2][2]]) : n3.push(i2(Object.assign({}, r3, { text: e3[a2] })).text);
      t4.text = n3;
    } else t4.text = i2(Object.assign({}, r3, { text: e3 })).text;
  }]);
}(E), /**
 * @license
 * jsPDF virtual FileSystem functionality
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */
function(t3) {
  var e2 = function() {
    return void 0 === this.internal.vFS && (this.internal.vFS = {}), true;
  };
  t3.existsFileInVFS = function(t4) {
    return e2.call(this), void 0 !== this.internal.vFS[t4];
  }, t3.addFileToVFS = function(t4, n2) {
    return e2.call(this), this.internal.vFS[t4] = n2, this;
  }, t3.getFileFromVFS = function(t4) {
    return e2.call(this), void 0 !== this.internal.vFS[t4] ? this.internal.vFS[t4] : null;
  };
}(E.API), /**
 * @license
 * Unicode Bidi Engine based on the work of Alex Shensis (@asthensis)
 * MIT License
 */
function(t3) {
  t3.__bidiEngine__ = t3.prototype.__bidiEngine__ = function(t4) {
    var n3, r2, i2, a2, o2, s2, u2, c2 = e2, l2 = [[0, 3, 0, 1, 0, 0, 0], [0, 3, 0, 1, 2, 2, 0], [0, 3, 0, 17, 2, 0, 1], [0, 3, 5, 5, 4, 1, 0], [0, 3, 21, 21, 4, 0, 1], [0, 3, 5, 5, 4, 2, 0]], h2 = [[2, 0, 1, 1, 0, 1, 0], [2, 0, 1, 1, 0, 2, 0], [2, 0, 2, 1, 3, 2, 0], [2, 0, 2, 33, 3, 1, 1]], f2 = { L: 0, R: 1, EN: 2, AN: 3, N: 4, B: 5, S: 6 }, d2 = { 0: 0, 5: 1, 6: 2, 7: 3, 32: 4, 251: 5, 254: 6, 255: 7 }, p2 = ["(", ")", "(", "<", ">", "<", "[", "]", "[", "{", "}", "{", "«", "»", "«", "‹", "›", "‹", "⁅", "⁆", "⁅", "⁽", "⁾", "⁽", "₍", "₎", "₍", "≤", "≥", "≤", "〈", "〉", "〈", "﹙", "﹚", "﹙", "﹛", "﹜", "﹛", "﹝", "﹞", "﹝", "﹤", "﹥", "﹤"], g2 = new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/), m2 = false, v2 = 0;
    this.__bidiEngine__ = {};
    var b2 = function(t5) {
      var e3 = t5.charCodeAt(), n4 = e3 >> 8, r3 = d2[n4];
      return void 0 !== r3 ? c2[256 * r3 + (255 & e3)] : 252 === n4 || 253 === n4 ? "AL" : g2.test(n4) ? "L" : 8 === n4 ? "R" : "N";
    }, y2 = function(t5) {
      for (var e3, n4 = 0; n4 < t5.length; n4++) {
        if ("L" === (e3 = b2(t5.charAt(n4)))) return false;
        if ("R" === e3) return true;
      }
      return false;
    }, w2 = function(t5, e3, o3, s3) {
      var u3, c3, l3, h3, f3 = e3[s3];
      switch (f3) {
        case "L":
        case "R":
        case "LRE":
        case "RLE":
        case "LRO":
        case "RLO":
        case "PDF":
          m2 = false;
          break;
        case "N":
        case "AN":
          break;
        case "EN":
          m2 && (f3 = "AN");
          break;
        case "AL":
          m2 = true, f3 = "R";
          break;
        case "WS":
        case "BN":
          f3 = "N";
          break;
        case "CS":
          s3 < 1 || s3 + 1 >= e3.length || "EN" !== (u3 = o3[s3 - 1]) && "AN" !== u3 || "EN" !== (c3 = e3[s3 + 1]) && "AN" !== c3 ? f3 = "N" : m2 && (c3 = "AN"), f3 = c3 === u3 ? c3 : "N";
          break;
        case "ES":
          f3 = "EN" === (u3 = s3 > 0 ? o3[s3 - 1] : "B") && s3 + 1 < e3.length && "EN" === e3[s3 + 1] ? "EN" : "N";
          break;
        case "ET":
          if (s3 > 0 && "EN" === o3[s3 - 1]) {
            f3 = "EN";
            break;
          }
          if (m2) {
            f3 = "N";
            break;
          }
          for (l3 = s3 + 1, h3 = e3.length; l3 < h3 && "ET" === e3[l3]; ) l3++;
          f3 = l3 < h3 && "EN" === e3[l3] ? "EN" : "N";
          break;
        case "NSM":
          if (i2 && !a2) {
            for (h3 = e3.length, l3 = s3 + 1; l3 < h3 && "NSM" === e3[l3]; ) l3++;
            if (l3 < h3) {
              var d3 = t5[s3], p3 = d3 >= 1425 && d3 <= 2303 || 64286 === d3;
              if (u3 = e3[l3], p3 && ("R" === u3 || "AL" === u3)) {
                f3 = "R";
                break;
              }
            }
          }
          f3 = s3 < 1 || "B" === (u3 = e3[s3 - 1]) ? "N" : o3[s3 - 1];
          break;
        case "B":
          m2 = false, n3 = true, f3 = v2;
          break;
        case "S":
          r2 = true, f3 = "N";
      }
      return f3;
    }, N2 = function(t5, e3, n4) {
      var r3 = t5.split("");
      return n4 && L2(r3, n4, { hiLevel: v2 }), r3.reverse(), e3 && e3.reverse(), r3.join("");
    }, L2 = function(t5, e3, i3) {
      var a3, o3, s3, u3, c3, d3 = -1, p3 = t5.length, g3 = 0, y3 = [], N3 = v2 ? h2 : l2, L3 = [];
      for (m2 = false, n3 = false, r2 = false, o3 = 0; o3 < p3; o3++) L3[o3] = b2(t5[o3]);
      for (s3 = 0; s3 < p3; s3++) {
        if (c3 = g3, y3[s3] = w2(t5, L3, y3, s3), a3 = 240 & (g3 = N3[c3][f2[y3[s3]]]), g3 &= 15, e3[s3] = u3 = N3[g3][5], a3 > 0) if (16 === a3) {
          for (o3 = d3; o3 < s3; o3++) e3[o3] = 1;
          d3 = -1;
        } else d3 = -1;
        if (N3[g3][6]) -1 === d3 && (d3 = s3);
        else if (d3 > -1) {
          for (o3 = d3; o3 < s3; o3++) e3[o3] = u3;
          d3 = -1;
        }
        "B" === L3[s3] && (e3[s3] = 0), i3.hiLevel |= u3;
      }
      r2 && function(t6, e4, n4) {
        for (var r3 = 0; r3 < n4; r3++) if ("S" === t6[r3]) {
          e4[r3] = v2;
          for (var i4 = r3 - 1; i4 >= 0 && "WS" === t6[i4]; i4--) e4[i4] = v2;
        }
      }(L3, e3, p3);
    }, x2 = function(t5, e3, r3, i3, a3) {
      if (!(a3.hiLevel < t5)) {
        if (1 === t5 && 1 === v2 && !n3) return e3.reverse(), void (r3 && r3.reverse());
        for (var o3, s3, u3, c3, l3 = e3.length, h3 = 0; h3 < l3; ) {
          if (i3[h3] >= t5) {
            for (u3 = h3 + 1; u3 < l3 && i3[u3] >= t5; ) u3++;
            for (c3 = h3, s3 = u3 - 1; c3 < s3; c3++, s3--) o3 = e3[c3], e3[c3] = e3[s3], e3[s3] = o3, r3 && (o3 = r3[c3], r3[c3] = r3[s3], r3[s3] = o3);
            h3 = u3;
          }
          h3++;
        }
      }
    }, A2 = function(t5, e3, n4) {
      var r3 = t5.split(""), i3 = { hiLevel: v2 };
      return n4 || (n4 = []), L2(r3, n4, i3), function(t6, e4, n5) {
        if (0 !== n5.hiLevel && u2) for (var r4, i4 = 0; i4 < t6.length; i4++) 1 === e4[i4] && (r4 = p2.indexOf(t6[i4])) >= 0 && (t6[i4] = p2[r4 + 1]);
      }(r3, n4, i3), x2(2, r3, e3, n4, i3), x2(1, r3, e3, n4, i3), r3.join("");
    };
    return this.__bidiEngine__.doBidiReorder = function(t5, e3, n4) {
      if (function(t6, e4) {
        if (e4) for (var n5 = 0; n5 < t6.length; n5++) e4[n5] = n5;
        void 0 === a2 && (a2 = y2(t6)), void 0 === s2 && (s2 = y2(t6));
      }(t5, e3), i2 || !o2 || s2) if (i2 && o2 && a2 ^ s2) v2 = a2 ? 1 : 0, t5 = N2(t5, e3, n4);
      else if (!i2 && o2 && s2) v2 = a2 ? 1 : 0, t5 = A2(t5, e3, n4), t5 = N2(t5, e3);
      else if (!i2 || a2 || o2 || s2) {
        if (i2 && !o2 && a2 ^ s2) t5 = N2(t5, e3), a2 ? (v2 = 0, t5 = A2(t5, e3, n4)) : (v2 = 1, t5 = A2(t5, e3, n4), t5 = N2(t5, e3));
        else if (i2 && a2 && !o2 && s2) v2 = 1, t5 = A2(t5, e3, n4), t5 = N2(t5, e3);
        else if (!i2 && !o2 && a2 ^ s2) {
          var r3 = u2;
          a2 ? (v2 = 1, t5 = A2(t5, e3, n4), v2 = 0, u2 = false, t5 = A2(t5, e3, n4), u2 = r3) : (v2 = 0, t5 = A2(t5, e3, n4), t5 = N2(t5, e3), v2 = 1, u2 = false, t5 = A2(t5, e3, n4), u2 = r3, t5 = N2(t5, e3));
        }
      } else v2 = 0, t5 = A2(t5, e3, n4);
      else v2 = a2 ? 1 : 0, t5 = A2(t5, e3, n4);
      return t5;
    }, this.__bidiEngine__.setOptions = function(t5) {
      t5 && (i2 = t5.isInputVisual, o2 = t5.isOutputVisual, a2 = t5.isInputRtl, s2 = t5.isOutputRtl, u2 = t5.isSymmetricSwapping);
    }, this.__bidiEngine__.setOptions(t4), this.__bidiEngine__;
  };
  var e2 = ["BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "S", "B", "S", "WS", "B", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "B", "B", "B", "S", "WS", "N", "N", "ET", "ET", "ET", "N", "N", "N", "N", "N", "ES", "CS", "ES", "CS", "CS", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "CS", "N", "N", "N", "N", "N", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "N", "N", "N", "N", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "N", "N", "N", "BN", "BN", "BN", "BN", "BN", "BN", "B", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "BN", "CS", "N", "ET", "ET", "ET", "ET", "N", "N", "N", "N", "L", "N", "N", "BN", "N", "N", "ET", "ET", "EN", "EN", "N", "L", "N", "N", "N", "EN", "L", "N", "N", "N", "N", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "N", "L", "L", "L", "L", "L", "L", "L", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "L", "N", "N", "N", "N", "N", "ET", "N", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "R", "NSM", "R", "NSM", "NSM", "R", "NSM", "NSM", "R", "NSM", "N", "N", "N", "N", "N", "N", "N", "N", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "N", "N", "N", "N", "N", "R", "R", "R", "R", "R", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "AN", "AN", "AN", "AN", "AN", "AN", "N", "N", "AL", "ET", "ET", "AL", "CS", "AL", "N", "N", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "AL", "AL", "N", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "AN", "AN", "AN", "AN", "AN", "AN", "AN", "AN", "AN", "AN", "ET", "AN", "AN", "AL", "AL", "AL", "NSM", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "AN", "N", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "AL", "AL", "NSM", "NSM", "N", "NSM", "NSM", "NSM", "NSM", "AL", "AL", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "N", "AL", "AL", "NSM", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "N", "N", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "AL", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "R", "R", "N", "N", "N", "N", "R", "N", "N", "N", "N", "N", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "BN", "BN", "BN", "L", "R", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "WS", "B", "LRE", "RLE", "PDF", "LRO", "RLO", "CS", "ET", "ET", "ET", "ET", "ET", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "CS", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "WS", "BN", "BN", "BN", "BN", "BN", "N", "LRI", "RLI", "FSI", "PDI", "BN", "BN", "BN", "BN", "BN", "BN", "EN", "L", "N", "N", "EN", "EN", "EN", "EN", "EN", "EN", "ES", "ES", "N", "N", "N", "L", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "ES", "ES", "N", "N", "N", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "N", "N", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "ET", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "L", "L", "L", "L", "L", "L", "L", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "L", "L", "L", "L", "L", "N", "N", "N", "N", "N", "R", "NSM", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "ES", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "N", "R", "R", "R", "R", "R", "N", "R", "N", "R", "R", "N", "R", "R", "N", "R", "R", "R", "R", "R", "R", "R", "R", "R", "R", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "NSM", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "CS", "N", "CS", "N", "N", "CS", "N", "N", "N", "N", "N", "N", "N", "N", "N", "ET", "N", "N", "ES", "ES", "N", "N", "N", "N", "N", "ET", "ET", "N", "N", "N", "N", "N", "AL", "AL", "AL", "AL", "AL", "N", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "N", "N", "BN", "N", "N", "N", "ET", "ET", "ET", "N", "N", "N", "N", "N", "ES", "CS", "ES", "CS", "CS", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "EN", "CS", "N", "N", "N", "N", "N", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "N", "N", "N", "N", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "L", "N", "N", "N", "L", "L", "L", "L", "L", "L", "N", "N", "L", "L", "L", "L", "L", "L", "N", "N", "L", "L", "L", "L", "L", "L", "N", "N", "L", "L", "L", "N", "N", "N", "ET", "ET", "N", "N", "N", "ET", "ET", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N"], n2 = new t3.__bidiEngine__({ isInputVisual: true });
  t3.API.events.push(["postProcessText", function(t4) {
    var e3 = t4.text;
    t4.x, t4.y;
    var r2 = t4.options || {};
    t4.mutex, r2.lang;
    var i2 = [];
    if (r2.isInputVisual = "boolean" != typeof r2.isInputVisual || r2.isInputVisual, n2.setOptions(r2), "[object Array]" === Object.prototype.toString.call(e3)) {
      var a2 = 0;
      for (i2 = [], a2 = 0; a2 < e3.length; a2 += 1) "[object Array]" === Object.prototype.toString.call(e3[a2]) ? i2.push([n2.doBidiReorder(e3[a2][0]), e3[a2][1], e3[a2][2]]) : i2.push([n2.doBidiReorder(e3[a2])]);
      t4.text = i2;
    } else t4.text = n2.doBidiReorder(e3);
    n2.setOptions({ isInputVisual: true });
  }]);
}(E), E.API.TTFFont = function() {
  function t3(t4) {
    var e2;
    if (this.rawData = t4, e2 = this.contents = new fe(t4), this.contents.pos = 4, "ttcf" === e2.readString(4)) throw new Error("TTCF not supported.");
    e2.pos = 0, this.parse(), this.subset = new je(this), this.registerTTF();
  }
  return t3.open = function(e2) {
    return new t3(e2);
  }, t3.prototype.parse = function() {
    return this.directory = new de(this.contents), this.head = new me(this), this.name = new xe(this), this.cmap = new be(this), this.toUnicode = {}, this.hhea = new ye(this), this.maxp = new Ae(this), this.hmtx = new Se(this), this.post = new Ne(this), this.os2 = new we(this), this.loca = new Ie(this), this.glyf = new Pe(this), this.ascender = this.os2.exists && this.os2.ascender || this.hhea.ascender, this.decender = this.os2.exists && this.os2.decender || this.hhea.decender, this.lineGap = this.os2.exists && this.os2.lineGap || this.hhea.lineGap, this.bbox = [this.head.xMin, this.head.yMin, this.head.xMax, this.head.yMax];
  }, t3.prototype.registerTTF = function() {
    var t4, e2, n2, r2, i2;
    if (this.scaleFactor = 1e3 / this.head.unitsPerEm, this.bbox = function() {
      var e3, n3, r3, i3;
      for (i3 = [], e3 = 0, n3 = (r3 = this.bbox).length; e3 < n3; e3++) t4 = r3[e3], i3.push(Math.round(t4 * this.scaleFactor));
      return i3;
    }.call(this), this.stemV = 0, this.post.exists ? (n2 = 255 & (r2 = this.post.italic_angle), 32768 & (e2 = r2 >> 16) && (e2 = -(1 + (65535 ^ e2))), this.italicAngle = +(e2 + "." + n2)) : this.italicAngle = 0, this.ascender = Math.round(this.ascender * this.scaleFactor), this.decender = Math.round(this.decender * this.scaleFactor), this.lineGap = Math.round(this.lineGap * this.scaleFactor), this.capHeight = this.os2.exists && this.os2.capHeight || this.ascender, this.xHeight = this.os2.exists && this.os2.xHeight || 0, this.familyClass = (this.os2.exists && this.os2.familyClass || 0) >> 8, this.isSerif = 1 === (i2 = this.familyClass) || 2 === i2 || 3 === i2 || 4 === i2 || 5 === i2 || 7 === i2, this.isScript = 10 === this.familyClass, this.flags = 0, this.post.isFixedPitch && (this.flags |= 1), this.isSerif && (this.flags |= 2), this.isScript && (this.flags |= 8), 0 !== this.italicAngle && (this.flags |= 64), this.flags |= 32, !this.cmap.unicode) throw new Error("No unicode cmap for font");
  }, t3.prototype.characterToGlyph = function(t4) {
    var e2;
    return (null != (e2 = this.cmap.unicode) ? e2.codeMap[t4] : void 0) || 0;
  }, t3.prototype.widthOfGlyph = function(t4) {
    var e2;
    return e2 = 1e3 / this.head.unitsPerEm, this.hmtx.forGlyph(t4).advance * e2;
  }, t3.prototype.widthOfString = function(t4, e2, n2) {
    var r2, i2, a2, o2;
    for (a2 = 0, i2 = 0, o2 = (t4 = "" + t4).length; 0 <= o2 ? i2 < o2 : i2 > o2; i2 = 0 <= o2 ? ++i2 : --i2) r2 = t4.charCodeAt(i2), a2 += this.widthOfGlyph(this.characterToGlyph(r2)) + n2 * (1e3 / e2) || 0;
    return a2 * (e2 / 1e3);
  }, t3.prototype.lineHeight = function(t4, e2) {
    var n2;
    return null == e2 && (e2 = false), n2 = e2 ? this.lineGap : 0, (this.ascender + n2 - this.decender) / 1e3 * t4;
  }, t3;
}();
var he, fe = function() {
  function t3(t4) {
    this.data = null != t4 ? t4 : [], this.pos = 0, this.length = this.data.length;
  }
  return t3.prototype.readByte = function() {
    return this.data[this.pos++];
  }, t3.prototype.writeByte = function(t4) {
    return this.data[this.pos++] = t4;
  }, t3.prototype.readUInt32 = function() {
    return 16777216 * this.readByte() + (this.readByte() << 16) + (this.readByte() << 8) + this.readByte();
  }, t3.prototype.writeUInt32 = function(t4) {
    return this.writeByte(t4 >>> 24 & 255), this.writeByte(t4 >> 16 & 255), this.writeByte(t4 >> 8 & 255), this.writeByte(255 & t4);
  }, t3.prototype.readInt32 = function() {
    var t4;
    return (t4 = this.readUInt32()) >= 2147483648 ? t4 - 4294967296 : t4;
  }, t3.prototype.writeInt32 = function(t4) {
    return t4 < 0 && (t4 += 4294967296), this.writeUInt32(t4);
  }, t3.prototype.readUInt16 = function() {
    return this.readByte() << 8 | this.readByte();
  }, t3.prototype.writeUInt16 = function(t4) {
    return this.writeByte(t4 >> 8 & 255), this.writeByte(255 & t4);
  }, t3.prototype.readInt16 = function() {
    var t4;
    return (t4 = this.readUInt16()) >= 32768 ? t4 - 65536 : t4;
  }, t3.prototype.writeInt16 = function(t4) {
    return t4 < 0 && (t4 += 65536), this.writeUInt16(t4);
  }, t3.prototype.readString = function(t4) {
    var e2, n2;
    for (n2 = [], e2 = 0; 0 <= t4 ? e2 < t4 : e2 > t4; e2 = 0 <= t4 ? ++e2 : --e2) n2[e2] = String.fromCharCode(this.readByte());
    return n2.join("");
  }, t3.prototype.writeString = function(t4) {
    var e2, n2, r2;
    for (r2 = [], e2 = 0, n2 = t4.length; 0 <= n2 ? e2 < n2 : e2 > n2; e2 = 0 <= n2 ? ++e2 : --e2) r2.push(this.writeByte(t4.charCodeAt(e2)));
    return r2;
  }, t3.prototype.readShort = function() {
    return this.readInt16();
  }, t3.prototype.writeShort = function(t4) {
    return this.writeInt16(t4);
  }, t3.prototype.readLongLong = function() {
    var t4, e2, n2, r2, i2, a2, o2, s2;
    return t4 = this.readByte(), e2 = this.readByte(), n2 = this.readByte(), r2 = this.readByte(), i2 = this.readByte(), a2 = this.readByte(), o2 = this.readByte(), s2 = this.readByte(), 128 & t4 ? -1 * (72057594037927940 * (255 ^ t4) + 281474976710656 * (255 ^ e2) + 1099511627776 * (255 ^ n2) + 4294967296 * (255 ^ r2) + 16777216 * (255 ^ i2) + 65536 * (255 ^ a2) + 256 * (255 ^ o2) + (255 ^ s2) + 1) : 72057594037927940 * t4 + 281474976710656 * e2 + 1099511627776 * n2 + 4294967296 * r2 + 16777216 * i2 + 65536 * a2 + 256 * o2 + s2;
  }, t3.prototype.writeLongLong = function(t4) {
    var e2, n2;
    return e2 = Math.floor(t4 / 4294967296), n2 = 4294967295 & t4, this.writeByte(e2 >> 24 & 255), this.writeByte(e2 >> 16 & 255), this.writeByte(e2 >> 8 & 255), this.writeByte(255 & e2), this.writeByte(n2 >> 24 & 255), this.writeByte(n2 >> 16 & 255), this.writeByte(n2 >> 8 & 255), this.writeByte(255 & n2);
  }, t3.prototype.readInt = function() {
    return this.readInt32();
  }, t3.prototype.writeInt = function(t4) {
    return this.writeInt32(t4);
  }, t3.prototype.read = function(t4) {
    var e2, n2;
    for (e2 = [], n2 = 0; 0 <= t4 ? n2 < t4 : n2 > t4; n2 = 0 <= t4 ? ++n2 : --n2) e2.push(this.readByte());
    return e2;
  }, t3.prototype.write = function(t4) {
    var e2, n2, r2, i2;
    for (i2 = [], n2 = 0, r2 = t4.length; n2 < r2; n2++) e2 = t4[n2], i2.push(this.writeByte(e2));
    return i2;
  }, t3;
}(), de = function() {
  var t3;
  function e2(t4) {
    var e3, n2, r2;
    for (this.scalarType = t4.readInt(), this.tableCount = t4.readShort(), this.searchRange = t4.readShort(), this.entrySelector = t4.readShort(), this.rangeShift = t4.readShort(), this.tables = {}, n2 = 0, r2 = this.tableCount; 0 <= r2 ? n2 < r2 : n2 > r2; n2 = 0 <= r2 ? ++n2 : --n2) e3 = { tag: t4.readString(4), checksum: t4.readInt(), offset: t4.readInt(), length: t4.readInt() }, this.tables[e3.tag] = e3;
  }
  return e2.prototype.encode = function(e3) {
    var n2, r2, i2, a2, o2, s2, u2, c2, l2, h2, f2, d2, p2;
    for (p2 in f2 = Object.keys(e3).length, s2 = Math.log(2), l2 = 16 * Math.floor(Math.log(f2) / s2), a2 = Math.floor(l2 / s2), c2 = 16 * f2 - l2, (r2 = new fe()).writeInt(this.scalarType), r2.writeShort(f2), r2.writeShort(l2), r2.writeShort(a2), r2.writeShort(c2), i2 = 16 * f2, u2 = r2.pos + i2, o2 = null, d2 = [], e3) for (h2 = e3[p2], r2.writeString(p2), r2.writeInt(t3(h2)), r2.writeInt(u2), r2.writeInt(h2.length), d2 = d2.concat(h2), "head" === p2 && (o2 = u2), u2 += h2.length; u2 % 4; ) d2.push(0), u2++;
    return r2.write(d2), n2 = 2981146554 - t3(r2.data), r2.pos = o2 + 8, r2.writeUInt32(n2), r2.data;
  }, t3 = function(t4) {
    var e3, n2, r2, i2;
    for (t4 = _e.call(t4); t4.length % 4; ) t4.push(0);
    for (r2 = new fe(t4), n2 = 0, e3 = 0, i2 = t4.length; e3 < i2; e3 = e3 += 4) n2 += r2.readUInt32();
    return 4294967295 & n2;
  }, e2;
}(), pe = {}.hasOwnProperty, ge = function(t3, e2) {
  for (var n2 in e2) pe.call(e2, n2) && (t3[n2] = e2[n2]);
  function r2() {
    this.constructor = t3;
  }
  return r2.prototype = e2.prototype, t3.prototype = new r2(), t3.__super__ = e2.prototype, t3;
};
he = function() {
  function t3(t4) {
    var e2;
    this.file = t4, e2 = this.file.directory.tables[this.tag], this.exists = !!e2, e2 && (this.offset = e2.offset, this.length = e2.length, this.parse(this.file.contents));
  }
  return t3.prototype.parse = function() {
  }, t3.prototype.encode = function() {
  }, t3.prototype.raw = function() {
    return this.exists ? (this.file.contents.pos = this.offset, this.file.contents.read(this.length)) : null;
  }, t3;
}();
var me = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "head", t3.prototype.parse = function(t4) {
    return t4.pos = this.offset, this.version = t4.readInt(), this.revision = t4.readInt(), this.checkSumAdjustment = t4.readInt(), this.magicNumber = t4.readInt(), this.flags = t4.readShort(), this.unitsPerEm = t4.readShort(), this.created = t4.readLongLong(), this.modified = t4.readLongLong(), this.xMin = t4.readShort(), this.yMin = t4.readShort(), this.xMax = t4.readShort(), this.yMax = t4.readShort(), this.macStyle = t4.readShort(), this.lowestRecPPEM = t4.readShort(), this.fontDirectionHint = t4.readShort(), this.indexToLocFormat = t4.readShort(), this.glyphDataFormat = t4.readShort();
  }, t3.prototype.encode = function(t4) {
    var e2;
    return (e2 = new fe()).writeInt(this.version), e2.writeInt(this.revision), e2.writeInt(this.checkSumAdjustment), e2.writeInt(this.magicNumber), e2.writeShort(this.flags), e2.writeShort(this.unitsPerEm), e2.writeLongLong(this.created), e2.writeLongLong(this.modified), e2.writeShort(this.xMin), e2.writeShort(this.yMin), e2.writeShort(this.xMax), e2.writeShort(this.yMax), e2.writeShort(this.macStyle), e2.writeShort(this.lowestRecPPEM), e2.writeShort(this.fontDirectionHint), e2.writeShort(t4), e2.writeShort(this.glyphDataFormat), e2.data;
  }, t3;
}(), ve = function() {
  function t3(t4, e2) {
    var n2, r2, i2, a2, o2, s2, u2, c2, l2, h2, f2, d2, p2, g2, m2, v2, b2;
    switch (this.platformID = t4.readUInt16(), this.encodingID = t4.readShort(), this.offset = e2 + t4.readInt(), l2 = t4.pos, t4.pos = this.offset, this.format = t4.readUInt16(), this.length = t4.readUInt16(), this.language = t4.readUInt16(), this.isUnicode = 3 === this.platformID && 1 === this.encodingID && 4 === this.format || 0 === this.platformID && 4 === this.format, this.codeMap = {}, this.format) {
      case 0:
        for (s2 = 0; s2 < 256; ++s2) this.codeMap[s2] = t4.readByte();
        break;
      case 4:
        for (f2 = t4.readUInt16(), h2 = f2 / 2, t4.pos += 6, i2 = function() {
          var e3, n3;
          for (n3 = [], s2 = e3 = 0; 0 <= h2 ? e3 < h2 : e3 > h2; s2 = 0 <= h2 ? ++e3 : --e3) n3.push(t4.readUInt16());
          return n3;
        }(), t4.pos += 2, p2 = function() {
          var e3, n3;
          for (n3 = [], s2 = e3 = 0; 0 <= h2 ? e3 < h2 : e3 > h2; s2 = 0 <= h2 ? ++e3 : --e3) n3.push(t4.readUInt16());
          return n3;
        }(), u2 = function() {
          var e3, n3;
          for (n3 = [], s2 = e3 = 0; 0 <= h2 ? e3 < h2 : e3 > h2; s2 = 0 <= h2 ? ++e3 : --e3) n3.push(t4.readUInt16());
          return n3;
        }(), c2 = function() {
          var e3, n3;
          for (n3 = [], s2 = e3 = 0; 0 <= h2 ? e3 < h2 : e3 > h2; s2 = 0 <= h2 ? ++e3 : --e3) n3.push(t4.readUInt16());
          return n3;
        }(), r2 = (this.length - t4.pos + this.offset) / 2, o2 = function() {
          var e3, n3;
          for (n3 = [], s2 = e3 = 0; 0 <= r2 ? e3 < r2 : e3 > r2; s2 = 0 <= r2 ? ++e3 : --e3) n3.push(t4.readUInt16());
          return n3;
        }(), s2 = m2 = 0, b2 = i2.length; m2 < b2; s2 = ++m2) for (g2 = i2[s2], n2 = v2 = d2 = p2[s2]; d2 <= g2 ? v2 <= g2 : v2 >= g2; n2 = d2 <= g2 ? ++v2 : --v2) 0 === c2[s2] ? a2 = n2 + u2[s2] : 0 !== (a2 = o2[c2[s2] / 2 + (n2 - d2) - (h2 - s2)] || 0) && (a2 += u2[s2]), this.codeMap[n2] = 65535 & a2;
    }
    t4.pos = l2;
  }
  return t3.encode = function(t4, e2) {
    var n2, r2, i2, a2, o2, s2, u2, c2, l2, h2, f2, d2, p2, g2, m2, v2, b2, y2, w2, N2, L2, x2, A2, S2, _2, P2, k2, F2, I2, j2, C2, O2, B2, M2, q2, E2, R2, D2, T2, z2, U2, H2, W2, V2, G2, Y2;
    switch (F2 = new fe(), a2 = Object.keys(t4).sort(function(t5, e3) {
      return t5 - e3;
    }), e2) {
      case "macroman":
        for (p2 = 0, g2 = function() {
          var t5 = [];
          for (d2 = 0; d2 < 256; ++d2) t5.push(0);
          return t5;
        }(), v2 = { 0: 0 }, i2 = {}, I2 = 0, B2 = a2.length; I2 < B2; I2++) null == v2[W2 = t4[r2 = a2[I2]]] && (v2[W2] = ++p2), i2[r2] = { old: t4[r2], new: v2[t4[r2]] }, g2[r2] = v2[t4[r2]];
        return F2.writeUInt16(1), F2.writeUInt16(0), F2.writeUInt32(12), F2.writeUInt16(0), F2.writeUInt16(262), F2.writeUInt16(0), F2.write(g2), { charMap: i2, subtable: F2.data, maxGlyphID: p2 + 1 };
      case "unicode":
        for (P2 = [], l2 = [], b2 = 0, v2 = {}, n2 = {}, m2 = u2 = null, j2 = 0, M2 = a2.length; j2 < M2; j2++) null == v2[w2 = t4[r2 = a2[j2]]] && (v2[w2] = ++b2), n2[r2] = { old: w2, new: v2[w2] }, o2 = v2[w2] - r2, null != m2 && o2 === u2 || (m2 && l2.push(m2), P2.push(r2), u2 = o2), m2 = r2;
        for (m2 && l2.push(m2), l2.push(65535), P2.push(65535), S2 = 2 * (A2 = P2.length), x2 = 2 * Math.pow(Math.log(A2) / Math.LN2, 2), h2 = Math.log(x2 / 2) / Math.LN2, L2 = 2 * A2 - x2, s2 = [], N2 = [], f2 = [], d2 = C2 = 0, q2 = P2.length; C2 < q2; d2 = ++C2) {
          if (_2 = P2[d2], c2 = l2[d2], 65535 === _2) {
            s2.push(0), N2.push(0);
            break;
          }
          if (_2 - (k2 = n2[_2].new) >= 32768) for (s2.push(0), N2.push(2 * (f2.length + A2 - d2)), r2 = O2 = _2; _2 <= c2 ? O2 <= c2 : O2 >= c2; r2 = _2 <= c2 ? ++O2 : --O2) f2.push(n2[r2].new);
          else s2.push(k2 - _2), N2.push(0);
        }
        for (F2.writeUInt16(3), F2.writeUInt16(1), F2.writeUInt32(12), F2.writeUInt16(4), F2.writeUInt16(16 + 8 * A2 + 2 * f2.length), F2.writeUInt16(0), F2.writeUInt16(S2), F2.writeUInt16(x2), F2.writeUInt16(h2), F2.writeUInt16(L2), U2 = 0, E2 = l2.length; U2 < E2; U2++) r2 = l2[U2], F2.writeUInt16(r2);
        for (F2.writeUInt16(0), H2 = 0, R2 = P2.length; H2 < R2; H2++) r2 = P2[H2], F2.writeUInt16(r2);
        for (V2 = 0, D2 = s2.length; V2 < D2; V2++) o2 = s2[V2], F2.writeUInt16(o2);
        for (G2 = 0, T2 = N2.length; G2 < T2; G2++) y2 = N2[G2], F2.writeUInt16(y2);
        for (Y2 = 0, z2 = f2.length; Y2 < z2; Y2++) p2 = f2[Y2], F2.writeUInt16(p2);
        return { charMap: n2, subtable: F2.data, maxGlyphID: b2 + 1 };
    }
  }, t3;
}(), be = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "cmap", t3.prototype.parse = function(t4) {
    var e2, n2, r2;
    for (t4.pos = this.offset, this.version = t4.readUInt16(), r2 = t4.readUInt16(), this.tables = [], this.unicode = null, n2 = 0; 0 <= r2 ? n2 < r2 : n2 > r2; n2 = 0 <= r2 ? ++n2 : --n2) e2 = new ve(t4, this.offset), this.tables.push(e2), e2.isUnicode && null == this.unicode && (this.unicode = e2);
    return true;
  }, t3.encode = function(t4, e2) {
    var n2, r2;
    return null == e2 && (e2 = "macroman"), n2 = ve.encode(t4, e2), (r2 = new fe()).writeUInt16(0), r2.writeUInt16(1), n2.table = r2.data.concat(n2.subtable), n2;
  }, t3;
}(), ye = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "hhea", t3.prototype.parse = function(t4) {
    return t4.pos = this.offset, this.version = t4.readInt(), this.ascender = t4.readShort(), this.decender = t4.readShort(), this.lineGap = t4.readShort(), this.advanceWidthMax = t4.readShort(), this.minLeftSideBearing = t4.readShort(), this.minRightSideBearing = t4.readShort(), this.xMaxExtent = t4.readShort(), this.caretSlopeRise = t4.readShort(), this.caretSlopeRun = t4.readShort(), this.caretOffset = t4.readShort(), t4.pos += 8, this.metricDataFormat = t4.readShort(), this.numberOfMetrics = t4.readUInt16();
  }, t3;
}(), we = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "OS/2", t3.prototype.parse = function(t4) {
    if (t4.pos = this.offset, this.version = t4.readUInt16(), this.averageCharWidth = t4.readShort(), this.weightClass = t4.readUInt16(), this.widthClass = t4.readUInt16(), this.type = t4.readShort(), this.ySubscriptXSize = t4.readShort(), this.ySubscriptYSize = t4.readShort(), this.ySubscriptXOffset = t4.readShort(), this.ySubscriptYOffset = t4.readShort(), this.ySuperscriptXSize = t4.readShort(), this.ySuperscriptYSize = t4.readShort(), this.ySuperscriptXOffset = t4.readShort(), this.ySuperscriptYOffset = t4.readShort(), this.yStrikeoutSize = t4.readShort(), this.yStrikeoutPosition = t4.readShort(), this.familyClass = t4.readShort(), this.panose = function() {
      var e2, n2;
      for (n2 = [], e2 = 0; e2 < 10; ++e2) n2.push(t4.readByte());
      return n2;
    }(), this.charRange = function() {
      var e2, n2;
      for (n2 = [], e2 = 0; e2 < 4; ++e2) n2.push(t4.readInt());
      return n2;
    }(), this.vendorID = t4.readString(4), this.selection = t4.readShort(), this.firstCharIndex = t4.readShort(), this.lastCharIndex = t4.readShort(), this.version > 0 && (this.ascent = t4.readShort(), this.descent = t4.readShort(), this.lineGap = t4.readShort(), this.winAscent = t4.readShort(), this.winDescent = t4.readShort(), this.codePageRange = function() {
      var e2, n2;
      for (n2 = [], e2 = 0; e2 < 2; e2 = ++e2) n2.push(t4.readInt());
      return n2;
    }(), this.version > 1)) return this.xHeight = t4.readShort(), this.capHeight = t4.readShort(), this.defaultChar = t4.readShort(), this.breakChar = t4.readShort(), this.maxContext = t4.readShort();
  }, t3;
}(), Ne = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "post", t3.prototype.parse = function(t4) {
    var e2, n2, r2;
    switch (t4.pos = this.offset, this.format = t4.readInt(), this.italicAngle = t4.readInt(), this.underlinePosition = t4.readShort(), this.underlineThickness = t4.readShort(), this.isFixedPitch = t4.readInt(), this.minMemType42 = t4.readInt(), this.maxMemType42 = t4.readInt(), this.minMemType1 = t4.readInt(), this.maxMemType1 = t4.readInt(), this.format) {
      case 65536:
      case 196608:
        break;
      case 131072:
        var i2;
        for (n2 = t4.readUInt16(), this.glyphNameIndex = [], i2 = 0; 0 <= n2 ? i2 < n2 : i2 > n2; i2 = 0 <= n2 ? ++i2 : --i2) this.glyphNameIndex.push(t4.readUInt16());
        for (this.names = [], r2 = []; t4.pos < this.offset + this.length; ) e2 = t4.readByte(), r2.push(this.names.push(t4.readString(e2)));
        return r2;
      case 151552:
        return n2 = t4.readUInt16(), this.offsets = t4.read(n2);
      case 262144:
        return this.map = function() {
          var e3, n3, r3;
          for (r3 = [], i2 = e3 = 0, n3 = this.file.maxp.numGlyphs; 0 <= n3 ? e3 < n3 : e3 > n3; i2 = 0 <= n3 ? ++e3 : --e3) r3.push(t4.readUInt32());
          return r3;
        }.call(this);
    }
  }, t3;
}(), Le = function(t3, e2) {
  this.raw = t3, this.length = t3.length, this.platformID = e2.platformID, this.encodingID = e2.encodingID, this.languageID = e2.languageID;
}, xe = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "name", t3.prototype.parse = function(t4) {
    var e2, n2, r2, i2, a2, o2, s2, u2, c2, l2, h2;
    for (t4.pos = this.offset, t4.readShort(), e2 = t4.readShort(), o2 = t4.readShort(), n2 = [], i2 = 0; 0 <= e2 ? i2 < e2 : i2 > e2; i2 = 0 <= e2 ? ++i2 : --i2) n2.push({ platformID: t4.readShort(), encodingID: t4.readShort(), languageID: t4.readShort(), nameID: t4.readShort(), length: t4.readShort(), offset: this.offset + o2 + t4.readShort() });
    for (s2 = {}, i2 = c2 = 0, l2 = n2.length; c2 < l2; i2 = ++c2) r2 = n2[i2], t4.pos = r2.offset, u2 = t4.readString(r2.length), a2 = new Le(u2, r2), null == s2[h2 = r2.nameID] && (s2[h2] = []), s2[r2.nameID].push(a2);
    this.strings = s2, this.copyright = s2[0], this.fontFamily = s2[1], this.fontSubfamily = s2[2], this.uniqueSubfamily = s2[3], this.fontName = s2[4], this.version = s2[5];
    try {
      this.postscriptName = s2[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g, "");
    } catch (f2) {
      this.postscriptName = s2[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g, "");
    }
    return this.trademark = s2[7], this.manufacturer = s2[8], this.designer = s2[9], this.description = s2[10], this.vendorUrl = s2[11], this.designerUrl = s2[12], this.license = s2[13], this.licenseUrl = s2[14], this.preferredFamily = s2[15], this.preferredSubfamily = s2[17], this.compatibleFull = s2[18], this.sampleText = s2[19];
  }, t3;
}(), Ae = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "maxp", t3.prototype.parse = function(t4) {
    return t4.pos = this.offset, this.version = t4.readInt(), this.numGlyphs = t4.readUInt16(), this.maxPoints = t4.readUInt16(), this.maxContours = t4.readUInt16(), this.maxCompositePoints = t4.readUInt16(), this.maxComponentContours = t4.readUInt16(), this.maxZones = t4.readUInt16(), this.maxTwilightPoints = t4.readUInt16(), this.maxStorage = t4.readUInt16(), this.maxFunctionDefs = t4.readUInt16(), this.maxInstructionDefs = t4.readUInt16(), this.maxStackElements = t4.readUInt16(), this.maxSizeOfInstructions = t4.readUInt16(), this.maxComponentElements = t4.readUInt16(), this.maxComponentDepth = t4.readUInt16();
  }, t3;
}(), Se = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "hmtx", t3.prototype.parse = function(t4) {
    var e2, n2, r2, i2, a2, o2, s2;
    for (t4.pos = this.offset, this.metrics = [], e2 = 0, o2 = this.file.hhea.numberOfMetrics; 0 <= o2 ? e2 < o2 : e2 > o2; e2 = 0 <= o2 ? ++e2 : --e2) this.metrics.push({ advance: t4.readUInt16(), lsb: t4.readInt16() });
    for (r2 = this.file.maxp.numGlyphs - this.file.hhea.numberOfMetrics, this.leftSideBearings = function() {
      var n3, i3;
      for (i3 = [], e2 = n3 = 0; 0 <= r2 ? n3 < r2 : n3 > r2; e2 = 0 <= r2 ? ++n3 : --n3) i3.push(t4.readInt16());
      return i3;
    }(), this.widths = function() {
      var t5, e3, n3, r3;
      for (r3 = [], t5 = 0, e3 = (n3 = this.metrics).length; t5 < e3; t5++) i2 = n3[t5], r3.push(i2.advance);
      return r3;
    }.call(this), n2 = this.widths[this.widths.length - 1], s2 = [], e2 = a2 = 0; 0 <= r2 ? a2 < r2 : a2 > r2; e2 = 0 <= r2 ? ++a2 : --a2) s2.push(this.widths.push(n2));
    return s2;
  }, t3.prototype.forGlyph = function(t4) {
    return t4 in this.metrics ? this.metrics[t4] : { advance: this.metrics[this.metrics.length - 1].advance, lsb: this.leftSideBearings[t4 - this.metrics.length] };
  }, t3;
}(), _e = [].slice, Pe = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "glyf", t3.prototype.parse = function() {
    return this.cache = {};
  }, t3.prototype.glyphFor = function(t4) {
    var e2, n2, r2, i2, a2, o2, s2, u2, c2, l2;
    return t4 in this.cache ? this.cache[t4] : (i2 = this.file.loca, e2 = this.file.contents, n2 = i2.indexOf(t4), 0 === (r2 = i2.lengthOf(t4)) ? this.cache[t4] = null : (e2.pos = this.offset + n2, a2 = (o2 = new fe(e2.read(r2))).readShort(), u2 = o2.readShort(), l2 = o2.readShort(), s2 = o2.readShort(), c2 = o2.readShort(), this.cache[t4] = -1 === a2 ? new Fe(o2, u2, l2, s2, c2) : new ke(o2, a2, u2, l2, s2, c2), this.cache[t4]));
  }, t3.prototype.encode = function(t4, e2, n2) {
    var r2, i2, a2, o2, s2;
    for (a2 = [], i2 = [], o2 = 0, s2 = e2.length; o2 < s2; o2++) r2 = t4[e2[o2]], i2.push(a2.length), r2 && (a2 = a2.concat(r2.encode(n2)));
    return i2.push(a2.length), { table: a2, offsets: i2 };
  }, t3;
}(), ke = function() {
  function t3(t4, e2, n2, r2, i2, a2) {
    this.raw = t4, this.numberOfContours = e2, this.xMin = n2, this.yMin = r2, this.xMax = i2, this.yMax = a2, this.compound = false;
  }
  return t3.prototype.encode = function() {
    return this.raw.data;
  }, t3;
}(), Fe = function() {
  function t3(t4, e2, n2, r2, i2) {
    var a2, o2;
    for (this.raw = t4, this.xMin = e2, this.yMin = n2, this.xMax = r2, this.yMax = i2, this.compound = true, this.glyphIDs = [], this.glyphOffsets = [], a2 = this.raw; o2 = a2.readShort(), this.glyphOffsets.push(a2.pos), this.glyphIDs.push(a2.readUInt16()), 32 & o2; ) a2.pos += 1 & o2 ? 4 : 2, 128 & o2 ? a2.pos += 8 : 64 & o2 ? a2.pos += 4 : 8 & o2 && (a2.pos += 2);
  }
  return t3.prototype.encode = function() {
    var t4, e2, n2;
    for (e2 = new fe(_e.call(this.raw.data)), t4 = 0, n2 = this.glyphIDs.length; t4 < n2; ++t4) e2.pos = this.glyphOffsets[t4];
    return e2.data;
  }, t3;
}(), Ie = function() {
  function t3() {
    return t3.__super__.constructor.apply(this, arguments);
  }
  return ge(t3, he), t3.prototype.tag = "loca", t3.prototype.parse = function(t4) {
    var e2, n2;
    return t4.pos = this.offset, e2 = this.file.head.indexToLocFormat, this.offsets = 0 === e2 ? function() {
      var e3, r2;
      for (r2 = [], n2 = 0, e3 = this.length; n2 < e3; n2 += 2) r2.push(2 * t4.readUInt16());
      return r2;
    }.call(this) : function() {
      var e3, r2;
      for (r2 = [], n2 = 0, e3 = this.length; n2 < e3; n2 += 4) r2.push(t4.readUInt32());
      return r2;
    }.call(this);
  }, t3.prototype.indexOf = function(t4) {
    return this.offsets[t4];
  }, t3.prototype.lengthOf = function(t4) {
    return this.offsets[t4 + 1] - this.offsets[t4];
  }, t3.prototype.encode = function(t4, e2) {
    for (var n2 = new Uint32Array(this.offsets.length), r2 = 0, i2 = 0, a2 = 0; a2 < n2.length; ++a2) if (n2[a2] = r2, i2 < e2.length && e2[i2] == a2) {
      ++i2, n2[a2] = r2;
      var o2 = this.offsets[a2], s2 = this.offsets[a2 + 1] - o2;
      s2 > 0 && (r2 += s2);
    }
    for (var u2 = new Array(4 * n2.length), c2 = 0; c2 < n2.length; ++c2) u2[4 * c2 + 3] = 255 & n2[c2], u2[4 * c2 + 2] = (65280 & n2[c2]) >> 8, u2[4 * c2 + 1] = (16711680 & n2[c2]) >> 16, u2[4 * c2] = (4278190080 & n2[c2]) >> 24;
    return u2;
  }, t3;
}(), je = function() {
  function t3(t4) {
    this.font = t4, this.subset = {}, this.unicodes = {}, this.next = 33;
  }
  return t3.prototype.generateCmap = function() {
    var t4, e2, n2, r2, i2;
    for (e2 in r2 = this.font.cmap.tables[0].codeMap, t4 = {}, i2 = this.subset) n2 = i2[e2], t4[e2] = r2[n2];
    return t4;
  }, t3.prototype.glyphsFor = function(t4) {
    var e2, n2, r2, i2, a2, o2, s2;
    for (r2 = {}, a2 = 0, o2 = t4.length; a2 < o2; a2++) r2[i2 = t4[a2]] = this.font.glyf.glyphFor(i2);
    for (i2 in e2 = [], r2) (null != (n2 = r2[i2]) ? n2.compound : void 0) && e2.push.apply(e2, n2.glyphIDs);
    if (e2.length > 0) for (i2 in s2 = this.glyphsFor(e2)) n2 = s2[i2], r2[i2] = n2;
    return r2;
  }, t3.prototype.encode = function(t4, e2) {
    var n2, r2, i2, a2, o2, s2, u2, c2, l2, h2, f2, d2, p2, g2, m2;
    for (r2 in n2 = be.encode(this.generateCmap(), "unicode"), a2 = this.glyphsFor(t4), f2 = { 0: 0 }, m2 = n2.charMap) f2[(s2 = m2[r2]).old] = s2.new;
    for (d2 in h2 = n2.maxGlyphID, a2) d2 in f2 || (f2[d2] = h2++);
    return c2 = function(t5) {
      var e3, n3;
      for (e3 in n3 = {}, t5) n3[t5[e3]] = e3;
      return n3;
    }(f2), l2 = Object.keys(c2).sort(function(t5, e3) {
      return t5 - e3;
    }), p2 = function() {
      var t5, e3, n3;
      for (n3 = [], t5 = 0, e3 = l2.length; t5 < e3; t5++) o2 = l2[t5], n3.push(c2[o2]);
      return n3;
    }(), i2 = this.font.glyf.encode(a2, p2, f2), u2 = this.font.loca.encode(i2.offsets, p2), g2 = { cmap: this.font.cmap.raw(), glyf: i2.table, loca: u2, hmtx: this.font.hmtx.raw(), hhea: this.font.hhea.raw(), maxp: this.font.maxp.raw(), post: this.font.post.raw(), name: this.font.name.raw(), head: this.font.head.encode(e2) }, this.font.os2.exists && (g2["OS/2"] = this.font.os2.raw()), this.font.directory.encode(g2);
  }, t3;
}();
E.API.PDFObject = function() {
  var t3;
  function e2() {
  }
  return t3 = function(t4, e3) {
    return (Array(e3 + 1).join("0") + t4).slice(-e3);
  }, e2.convert = function(n2) {
    var r2, i2, a2, o2;
    if (Array.isArray(n2)) return "[" + function() {
      var t4, i3, a3;
      for (a3 = [], t4 = 0, i3 = n2.length; t4 < i3; t4++) r2 = n2[t4], a3.push(e2.convert(r2));
      return a3;
    }().join(" ") + "]";
    if ("string" == typeof n2) return "/" + n2;
    if (null != n2 ? n2.isString : void 0) return "(" + n2 + ")";
    if (n2 instanceof Date) return "(D:" + t3(n2.getUTCFullYear(), 4) + t3(n2.getUTCMonth(), 2) + t3(n2.getUTCDate(), 2) + t3(n2.getUTCHours(), 2) + t3(n2.getUTCMinutes(), 2) + t3(n2.getUTCSeconds(), 2) + "Z)";
    if ("[object Object]" === {}.toString.call(n2)) {
      for (i2 in a2 = ["<<"], n2) o2 = n2[i2], a2.push("/" + i2 + " " + e2.convert(o2));
      return a2.push(">>"), a2.join("\n");
    }
    return "" + n2;
  }, e2;
}();

function getDefaultMapSettings() {
  return {
    tileUrl: "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  };
}

const ClickHandler = ({ onChange }) => {
  useMapEvents({
    click(e) {
      onChange(e.latlng.lat, e.latlng.lng);
    }
  });
  return null;
};
const markerIcon = L$2.icon({
  iconUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",
  iconRetinaUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",
  shadowUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
const QRInlineMap = ({ lat, lng, onChange }) => {
  const mapRef = reactExports.useRef(null);
  const center = reactExports.useMemo(() => {
    if (typeof lat === "number" && typeof lng === "number" && isFinite(lat) && isFinite(lng)) {
      return [lat, lng];
    }
    return [46, 8];
  }, [lat, lng]);
  const { tileUrl, attribution } = getDefaultMapSettings();
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "rounded-lg overflow-hidden border border-border", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    MapContainer,
    {
      center,
      zoom: 12,
      style: {
        height: 320,
        width: "100%",
        background: "transparent",
        willChange: "transform",
        transform: "translateZ(0)"
      },
      zoomControl: true,
      scrollWheelZoom: true,
      doubleClickZoom: true,
      touchZoom: true,
      boxZoom: true,
      keyboard: true,
      dragging: true,
      zoomAnimation: true,
      markerZoomAnimation: true,
      fadeAnimation: true,
      zoomAnimationThreshold: 4,
      preferCanvas: false,
      ref: (mapInstance) => {
        if (mapInstance) {
          mapRef.current = mapInstance;
        }
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          TileLayer,
          {
            url: tileUrl,
            attribution,
            maxZoom: 18,
            minZoom: 3,
            keepBuffer: 12,
            updateWhenIdle: true,
            updateWhenZooming: false,
            crossOrigin: "anonymous",
            detectRetina: true,
            tileSize: 256,
            zoomOffset: 0,
            bounds: [[-90, -180], [90, 180]],
            noWrap: false,
            subdomains: ["a", "b", "c"],
            errorTileUrl: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(ClickHandler, { onChange }),
        typeof lat === "number" && typeof lng === "number" && isFinite(lat) && isFinite(lng) && /* @__PURE__ */ jsxRuntimeExports.jsx(
          Marker,
          {
            position: [lat, lng],
            draggable: true,
            icon: markerIcon,
            eventHandlers: {
              dragend: (e) => {
                const m = e.target;
                const p = m.getLatLng();
                onChange(p.lat, p.lng);
              }
            }
          }
        )
      ]
    }
  ) });
};

function MapSettingsCard() {
  const [minZoom, setMinZoom] = reactExports.useState(17);
  const choices = [14, 15, 16, 17];
  reactExports.useEffect(() => {
    (async () => {
      const { data } = await supabase.from("app_config").select("value_int").eq("key", "marker_min_zoom").maybeSingle();
      if (data?.value_int) setMinZoom(Number(data.value_int));
    })();
  }, []);
  const save = async (v) => {
    setMinZoom(v);
    const { error } = await supabase.from("app_config").upsert({ key: "marker_min_zoom", value_int: v, value_text: null });
    if (error) {
      ue$1.error("Salvataggio soglia fallito (serve ruolo admin)");
    } else {
      ue$1.success(`Soglia marker aggiornata: zoom ≥ ${v}`);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Impostazioni Mappa — Visibilità Marker" }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Seleziona lo zoom minimo a cui mostrare i marker sulla mappa." }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: String(minZoom), onValueChange: (val) => save(Number(val)), children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { className: "w-40", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona zoom" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: choices.map((z) => /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectItem, { value: String(z), children: [
          "Zoom ",
          z
        ] }, z)) })
      ] })
    ] })
  ] });
}
const QRControlPanel = () => {
  const [qrCodes, setQrCodes] = reactExports.useState([]);
  const [stats, setStats] = reactExports.useState({
    totalActive: 0,
    totalRedeemed: 0,
    buzzRewards: 0,
    clueRewards: 0,
    enigmaRewards: 0,
    fakeRewards: 0,
    failedAttempts: 0
  });
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [isCreating, setIsCreating] = reactExports.useState(false);
  const fmt = (n) => Number.isFinite(n) ? Number(n).toFixed(6) : "—";
  const [formData, setFormData] = reactExports.useState({
    locationName: "",
    lat: "",
    // UI display (6 decimals)
    lng: "",
    // UI display (6 decimals)
    rewardType: "",
    rewardContent: "",
    expiresAt: ""
  });
  const [latFull, setLatFull] = reactExports.useState(null);
  const [lngFull, setLngFull] = reactExports.useState(null);
  reactExports.useEffect(() => {
    try {
      const cached = localStorage.getItem("qr_admin_list");
      if (cached) {
        const parsed = JSON.parse(cached);
        if (Array.isArray(parsed)) {
          setQrCodes(parsed);
          setIsLoading(false);
        }
      }
    } catch {
    }
    loadQRCodes();
    loadStats();
  }, []);
  reactExports.useEffect(() => {
    return () => {
      try {
        localStorage.setItem("qr_admin_list", JSON.stringify(qrCodes));
      } catch {
      }
    };
  }, [qrCodes]);
  const loadQRCodes = async () => {
    try {
      const { data, error } = await supabase.from("qr_codes").select("code, reward_type, lat, lng, title, is_active, is_hidden, expires_at, created_at").order("created_at", { ascending: false });
      if (error) throw error;
      const mapped = (data || []).map((row) => {
        const latNum = typeof row.lat === "number" ? row.lat : Number(row.lat);
        const lngNum = typeof row.lng === "number" ? row.lng : Number(row.lng);
        return {
          id: row.code,
          reward_type: row.reward_type,
          message: row.message || "",
          lat: latNum,
          lon: lngNum,
          location_name: row.title || "",
          max_distance_meters: 100,
          attivo: row.is_active ?? true,
          scansioni: row.is_active ? 0 : 1,
          redeemed_by: [],
          expires_at: row.expires_at,
          creato_da: "",
          created_at: row.created_at,
          updated_at: row.created_at
        };
      }).filter((row) => Number.isFinite(row.lat) && Number.isFinite(row.lon));
      setQrCodes(mapped);
      try {
        localStorage.setItem("qr_admin_list", JSON.stringify(mapped));
      } catch {
      }
    } catch (error) {
      console.error("Error loading QR codes:", error);
      ue$1.error("Errore nel caricamento dei QR code");
    } finally {
      setIsLoading(false);
    }
  };
  const loadStats = async () => {
    try {
      const { data: allCodes, error: codesError } = await supabase.from("qr_codes").select("is_active, reward_type");
      if (codesError) throw codesError;
      const totalActive = allCodes?.filter((c) => c.is_active === true).length || 0;
      const totalRedeemed = allCodes?.filter((c) => c.is_active !== true).length || 0;
      const buzzRewards = allCodes?.filter((c) => c.reward_type === "buzz_credit").length || 0;
      const clueRewards = 0;
      const enigmaRewards = 0;
      const fakeRewards = allCodes?.filter((c) => c.reward_type === "custom").length || 0;
      setStats({
        totalActive,
        totalRedeemed,
        buzzRewards,
        clueRewards,
        enigmaRewards,
        fakeRewards,
        failedAttempts: 0
      });
    } catch (error) {
      console.error("Error loading stats:", error);
    }
  };
  const saveMarkerRewards = async () => {
    if (!formData.locationName.trim()) {
      ue$1.error("⚠️ Marker ID obbligatorio");
      return;
    }
    if (!formData.rewardType) {
      ue$1.error("⚠️ Tipo ricompensa obbligatorio");
      return;
    }
    if (!latFull || !lngFull) {
      ue$1.error("⚠️ Coordinate marker obbligatorie");
      return;
    }
    console.log("M1QR-TRACE:", { step: "save_marker_start", markerId: formData.locationName, rewardType: formData.rewardType });
    try {
      setIsCreating(true);
      const markerCode = formData.locationName.trim();
      const { error: qrError } = await supabase.from("qr_codes").upsert([{
        code: markerCode,
        title: `Marker ${markerCode}`,
        lat: latFull,
        lng: lngFull,
        is_active: true,
        reward_type: "buzz_credit",
        // Default for compatibility
        expires_at: formData.expiresAt || null
      }]);
      if (qrError) {
        console.error("M1QR-TRACE:", { step: "qr_codes_error", error: qrError });
        throw new Error(`Errore creazione marker: ${qrError.message}`);
      }
      console.log("M1QR-TRACE:", { step: "qr_codes_success", markerId: markerCode });
      let payload = {};
      switch (formData.rewardType) {
        case "buzz_free":
          payload = { buzzCount: 1 };
          break;
        case "message":
          payload = { text: formData.rewardContent || "Congratulazioni agente!" };
          break;
        case "xp_points":
          payload = { xp: 50 };
          break;
        case "event_ticket":
          payload = { event_id: "", ticket_type: "standard" };
          break;
        case "badge":
          payload = { badge_id: "" };
          break;
        default:
          payload = {};
      }
      const { error: rewardError } = await supabase.from("marker_rewards").insert([{
        marker_id: markerCode,
        reward_type: formData.rewardType,
        payload,
        description: formData.rewardContent || `Premio ${formData.rewardType}`
      }]);
      if (rewardError) {
        console.error("M1QR-TRACE:", { step: "marker_rewards_error", error: rewardError });
        throw new Error(`Errore salvataggio ricompense: ${rewardError.message}`);
      }
      console.log("M1QR-TRACE:", { step: "save_marker_complete", markerId: markerCode });
      ue$1.success("✅ Marker e ricompense salvati! Ora visibili in mappa.");
      setFormData({ locationName: "", lat: "", lng: "", rewardType: "", rewardContent: "", expiresAt: "" });
      setLatFull(null);
      setLngFull(null);
      loadQRCodes();
    } catch (e) {
      console.error("M1QR-TRACE:", { step: "save_marker_error", error: e });
      ue$1.error(`❌ Errore: ${e?.message || "Errore sconosciuto"}`);
    } finally {
      setIsCreating(false);
    }
  };
  const generatePrintableQR = async (code, rewardMessage) => {
    const qrUrl = `https://m1ssion.eu/map?marker=${code}`;
    console.log("🔥 GENERATING QR FOR URL:", qrUrl);
    try {
      const qrDataUrl = await browser.toDataURL(qrUrl, {
        width: 512,
        margin: 2,
        color: {
          dark: "#000000",
          light: "#FFFFFF"
        },
        errorCorrectionLevel: "H"
        // High error correction for logo overlay
      });
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = 512;
      canvas.height = 512;
      const qrImg = new Image();
      qrImg.onload = () => {
        ctx.drawImage(qrImg, 0, 0, 512, 512);
        const logoSize = 80;
        const logoX = (512 - logoSize) / 2;
        const logoY = (512 - logoSize) / 2;
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(logoX - 5, logoY - 5, logoSize + 10, logoSize + 10);
        ctx.fillStyle = "#000000";
        ctx.font = "bold 48px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("M1", 256, 256);
        const finalDataUrl = canvas.toDataURL("image/png");
        generatePDF(finalDataUrl, code, rewardMessage);
        showQRPreview(finalDataUrl, code, rewardMessage);
      };
      qrImg.src = qrDataUrl;
    } catch (error) {
      console.error("Error generating QR:", error);
      ue$1.error("Errore nella generazione del QR Code");
    }
  };
  const generatePDF = (qrDataUrl, code, rewardMessage) => {
    const pdf = new E({
      orientation: "portrait",
      unit: "mm",
      format: "a4"
    });
    pdf.setFillColor(0, 0, 0);
    pdf.rect(0, 0, 210, 297, "F");
    pdf.setTextColor(255, 255, 255);
    pdf.setFontSize(28);
    pdf.setFont("helvetica", "bold");
    pdf.text("M1SSION™", 105, 40, { align: "center" });
    pdf.setTextColor(200, 200, 200);
    pdf.setFontSize(14);
    pdf.text("TOP SECRET QR CODE", 105, 55, { align: "center" });
    const qrSize = 120;
    const qrX = (210 - qrSize) / 2;
    const qrY = 80;
    pdf.addImage(qrDataUrl, "PNG", qrX, qrY, qrSize, qrSize);
    pdf.setTextColor(0, 209, 255);
    pdf.setFontSize(14);
    pdf.setFont("helvetica", "bold");
    pdf.text(rewardMessage || "REWARD CLASIFICATO", 105, qrY + qrSize + 20, { align: "center" });
    pdf.setTextColor(150, 150, 150);
    pdf.setFontSize(12);
    pdf.setFont("courier", "bold");
    pdf.text(code, 105, qrY + qrSize + 35, { align: "center" });
    pdf.setTextColor(255, 100, 100);
    pdf.setFontSize(10);
    pdf.setFont("helvetica", "bold");
    pdf.text("⚠️ REWARD CLASSIFICATO", 105, qrY + qrSize + 50, { align: "center" });
    pdf.setDrawColor(255, 255, 255);
    pdf.setLineWidth(2);
    pdf.rect(10, 10, 190, 277);
    pdf.save(`M1SSION_QR_${code}.pdf`);
    ue$1.success("PDF generato e scaricato!");
  };
  const showQRPreview = (qrDataUrl, code, rewardMessage) => {
    const modal = document.createElement("div");
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    `;
    modal.innerHTML = `
      <div style="
        background: #000;
        border: 2px solid #00a3ff;
        border-radius: 20px;
        padding: 30px;
        text-align: center;
        max-width: 400px;
        box-shadow: 0 0 50px rgba(0, 163, 255, 0.5);
      ">
        <h2 style="color: #00a3ff; margin-bottom: 20px; font-size: 24px;">
          <span style="color: #00FFFF; text-shadow: 0 0 10px #00FFFF;">M1</span><span style="color: #FFFFFF;">SSION™</span> QR CODE
        </h2>
        <img src="${qrDataUrl}" style="width: 300px; height: 300px; border-radius: 10px; margin-bottom: 20px;" />
        <p style="color: #00FFFF; font-size: 16px; margin-bottom: 5px; text-shadow: 0 0 5px #00FFFF;">${rewardMessage || "REWARD CLASIFICATO"}</p>
        <p style="color: #999; font-size: 12px; font-family: monospace; margin-bottom: 20px;">${code}</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
          <button id="printBtn" style="
            background: #00a3ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
          ">🖨️ Stampa</button>
          <button id="closeBtn" style="
            background: #666;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
          ">Chiudi</button>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
    modal.querySelector("#printBtn")?.addEventListener("click", () => {
      window.print();
    });
    modal.querySelector("#closeBtn")?.addEventListener("click", () => {
      document.body.removeChild(modal);
    });
    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        document.body.removeChild(modal);
      }
    });
  };
  const showQRForPrinting = (code, formData2) => {
    let rewardMessage = "REWARD CLASIFICATO";
    const rewardType = formData2.rewardType || formData2.reward_type;
    switch (rewardType) {
      case "buzz":
      case "buzz_gratis":
      case "buzz_credit":
        rewardMessage = "⚡ BUZZ GRATUITO";
        break;
      case "clue":
      case "indizio_segreto":
        rewardMessage = "🔍 INDIZIO SEGRETO";
        break;
      case "enigma":
      case "enigma_misterioso":
        rewardMessage = "🧩 ENIGMA MISTERIOSO";
        break;
      case "fake":
      case "sorpresa_speciale":
        rewardMessage = "🌀 SORPRESA SPECIALE";
        break;
      case "custom":
        rewardMessage = "🎁 REWARD PERSONALIZZATO";
        break;
    }
    generatePrintableQR(code, rewardMessage);
  };
  const deleteQR = async (id) => {
    if (!confirm("Sei sicuro di voler eliminare questo QR Code? Questa azione non può essere annullata.")) {
      return;
    }
    try {
      const { error } = await supabase.from("qr_codes").delete().eq("code", id);
      if (error) throw error;
      ue$1.success(`QR Code ${id} eliminato con successo`);
      loadQRCodes();
      loadStats();
    } catch (error) {
      console.error("Error deleting QR:", error);
      ue$1.error("Errore nell'eliminazione del QR code");
    }
  };
  const getRewardIcon = (type) => {
    switch (type) {
      case "buzz_gratis":
      case "buzz_credit":
        return "⚡";
      case "indizio_segreto":
        return "🔍";
      case "enigma_misterioso":
        return "🧩";
      case "sorpresa_speciale":
        return "🌀";
      case "custom":
        return "🎁";
      default:
        return "❓";
    }
  };
  const getRewardColor = (type) => {
    switch (type) {
      case "buzz_gratis":
      case "buzz_credit":
        return "bg-green-100 text-green-800";
      case "indizio_segreto":
        return "bg-blue-100 text-blue-800";
      case "enigma_misterioso":
        return "bg-purple-100 text-purple-800";
      case "sorpresa_speciale":
      case "custom":
        return "bg-orange-100 text-orange-800";
      default:
        return "bg-gray-100 text-gray-800";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(QrCode, { className: "w-8 h-8 text-primary" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold", children: "QR Control Panel" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(MapSettingsCard, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-4 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-green-600", children: stats.totalActive }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "QR Attivi" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-4 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-blue-600", children: stats.totalRedeemed }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Riscattati" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-4 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-purple-600", children: stats.buzzRewards }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Buzz Dati" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-4 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-red-600", children: stats.failedAttempts }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Tentativi Falliti" })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Gift, { className: "w-5 h-5" }),
        "🎁 Configurazione Ricompense Marker"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "locationName", children: "Marker ID *" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "locationName",
                value: formData.locationName,
                onChange: (e) => setFormData({ ...formData, locationName: e.target.value }),
                placeholder: "UUID del marker (es. QR code ID)"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "rewardType", children: "Tipo Ricompensa *" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: formData.rewardType, onValueChange: (value) => setFormData({ ...formData, rewardType: value }), children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, { placeholder: "Seleziona tipo ricompensa" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { className: "z-[100] max-h-[300px] overflow-y-auto bg-card border border-border shadow-xl backdrop-blur-md", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "buzz_free", className: "cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg", children: "⚡" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "BUZZ Gratuiti" })
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "message", className: "cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg", children: "📩" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Messaggio" })
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "xp_points", className: "cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg", children: "🏆" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Punti XP" })
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "event_ticket", className: "cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg", children: "🎫" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Ticket Evento" })
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "badge", className: "cursor-pointer py-3 px-4 text-base font-medium hover:bg-accent focus:bg-accent", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-lg", children: "🏅" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Badge" })
                ] }) })
              ] })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Label$1, { htmlFor: "lat", children: [
              "Latitudine * ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-500", children: "(-90 a +90)" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "lat",
                type: "number",
                step: "any",
                value: formData.lat,
                onChange: (e) => {
                  const v = e.target.value;
                  setFormData({ ...formData, lat: v });
                  const num = parseFloat(v);
                  if (isFinite(num)) setLatFull(num);
                },
                placeholder: "46.0 (Europa)",
                className: !formData.lat || isNaN(parseFloat(formData.lat)) ? "border-red-300" : "border-green-300"
              }
            ),
            formData.lat && isNaN(parseFloat(formData.lat)) && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-red-500 mt-1", children: "⚠️ Valore non valido" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Label$1, { htmlFor: "lng", children: [
              "Longitudine * ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-gray-500", children: "(-180 a +180)" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "lng",
                type: "number",
                step: "any",
                value: formData.lng,
                onChange: (e) => {
                  const v = e.target.value;
                  setFormData({ ...formData, lng: v });
                  const num = parseFloat(v);
                  if (isFinite(num)) setLngFull(num);
                },
                placeholder: "8.0 (Europa)",
                className: !formData.lng || isNaN(parseFloat(formData.lng)) ? "border-red-300" : "border-green-300"
              }
            ),
            formData.lng && isNaN(parseFloat(formData.lng)) && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-red-500 mt-1", children: "⚠️ Valore non valido" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-blue-50 border border-blue-200 rounded-lg p-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-semibold text-blue-800 mb-2", children: "📍 Coordinate Esempio:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-2 text-xs", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Berlin:" }),
              " 52.520008, 13.404954",
              /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Europa:" }),
              " 46.0, 8.0",
              /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Roma:" }),
              " 41.902782, 12.496365"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Parigi:" }),
              " 48.856614, 2.352222",
              /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Monaco:" }),
              " 43.740070, 7.426540",
              /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Monaco:" }),
              " 48.137154, 11.576124"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-2 text-xs text-blue-600", children: `💡 Usa Google Maps per ottenere coordinate precise: click destro → "Cosa c'è qui?"` })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          QRInlineMap,
          {
            lat: latFull ?? (formData.lat ? parseFloat(formData.lat) : void 0),
            lng: lngFull ?? (formData.lng ? parseFloat(formData.lng) : void 0),
            onChange: (la, lo) => {
              setLatFull(la);
              setLngFull(lo);
              setFormData((s) => ({ ...s, lat: la.toFixed(6), lng: lo.toFixed(6) }));
            }
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "rewardContent", children: "Descrizione (opzionale)" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              id: "rewardContent",
              value: formData.rewardContent,
              onChange: (e) => setFormData({ ...formData, rewardContent: e.target.value }),
              placeholder: "Descrizione breve per il popup del marker...",
              rows: 3
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "expiresAt", children: "Data Scadenza (opzionale)" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "expiresAt",
              type: "datetime-local",
              value: formData.expiresAt,
              onChange: (e) => setFormData({ ...formData, expiresAt: e.target.value })
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: saveMarkerRewards, disabled: isCreating, className: "w-full", children: isCreating ? "Salvando..." : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Gift, { className: "w-4 h-4 mr-2" }),
          "Salva Ricompense Marker"
        ] }) })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(ChartColumn, { className: "w-5 h-5" }),
        "QR Codes Gestiti (",
        qrCodes.length,
        ")"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-8", children: "Caricamento..." }) : qrCodes.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-8 text-muted-foreground", children: "Nessun QR code creato" }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: qrCodes.map((qr) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-4 border rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 mb-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-mono font-bold text-lg", children: qr.id }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { className: getRewardColor(qr.reward_type), children: [
              getRewardIcon(qr.reward_type),
              " ",
              qr.reward_type.toUpperCase()
            ] }),
            !qr.attivo ? /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", children: "DISATTIVATO" }) : qr.scansioni > 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", children: [
              "SCANSIONATO (",
              qr.scansioni,
              ")"
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "default", children: "ATTIVO" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-muted-foreground", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1 mb-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-4 h-4" }),
              qr.location_name,
              " (",
              fmt(qr.lat),
              ", ",
              fmt(qr.lon),
              ")"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-4 h-4" }),
              "Creato: ",
              new Date(qr.created_at).toLocaleDateString("it-IT"),
              qr.expires_at && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "ml-2", children: [
                "• Scade: ",
                new Date(qr.expires_at).toLocaleDateString("it-IT")
              ] })
            ] }),
            qr.scansioni > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-green-600 mt-1", children: [
              "Scansioni: ",
              qr.scansioni,
              " • Ultimo aggiornamento: ",
              new Date(qr.updated_at).toLocaleDateString("it-IT")
            ] }),
            qr.message && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-blue-600 mt-1 text-xs", children: [
              "Messaggio: ",
              qr.message
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              size: "sm",
              variant: "outline",
              onClick: () => showQRForPrinting(qr.id, { rewardType: qr.reward_type, locationName: qr.location_name }),
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Printer, { className: "w-4 h-4" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              size: "sm",
              variant: "destructive",
              onClick: () => deleteQR(qr.id),
              title: "Elimina QR Code",
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4" })
            }
          )
        ] })
      ] }, qr.id)) }) })
    ] })
  ] });
};

const SimpleClickMap = reactExports.lazy(() => __vitePreload(() => import('./SimpleClickMap.DdksGzxx.js'),true?__vite__mapDeps([13,1,2,3,6,5,7,8,9]):void 0));
const REWARD_TYPES = [
  { value: "M1U", label: "M1U Credits", icon: Coins, color: "#FFD700" },
  { value: "CLUE", label: "Indizio", icon: Search, color: "#00D1FF" },
  { value: "PHYSICAL_PRIZE", label: "Premio Fisico", icon: Gift, color: "#FF1493" },
  { value: "BUZZ_FREE", label: "Buzz Gratuiti", icon: Zap, color: "#10B981" },
  { value: "XP_POINTS", label: "Punti XP", icon: Trophy, color: "#F59E0B" },
  { value: "MESSAGE", label: "Messaggio", icon: MessageSquare, color: "#8B5CF6" }
];
const PHYSICAL_PRIZES = [
  "iPhone",
  "AirPods",
  "GoPro",
  "USB Key",
  "T-Shirt",
  "Hat",
  "PC",
  "Apple Watch",
  "M1 Kit",
  "iPad",
  "Powerbank",
  "Smart Speaker",
  "Tech Backpack",
  "Mousepad",
  "Stickers",
  "NFC/QR Keychain"
];
const MarkerRewardManager = () => {
  const [isAdmin, setIsAdmin] = reactExports.useState(false);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [activeTab, setActiveTab] = reactExports.useState("manual");
  const [selectedRewardType, setSelectedRewardType] = reactExports.useState("M1U");
  const [markerTitle, setMarkerTitle] = reactExports.useState("");
  const [m1uAmount, setM1uAmount] = reactExports.useState(50);
  const [clueText, setClueText] = reactExports.useState("");
  const [physicalPrize, setPhysicalPrize] = reactExports.useState("iPhone");
  const [buzzCount, setBuzzCount] = reactExports.useState(1);
  const [xpPoints, setXpPoints] = reactExports.useState(10);
  const [messageText, setMessageText] = reactExports.useState("");
  const [visibilityHours, setVisibilityHours] = reactExports.useState(24);
  const [lat, setLat] = reactExports.useState("41.9028");
  const [lng, setLng] = reactExports.useState("12.4964");
  const [bulkCount, setBulkCount] = reactExports.useState(25);
  const [bulkRewardType, setBulkRewardType] = reactExports.useState("M1U");
  const [bulkM1uAmount, setBulkM1uAmount] = reactExports.useState(50);
  const [existingMarkers, setExistingMarkers] = reactExports.useState([]);
  const [showExisting, setShowExisting] = reactExports.useState(true);
  const handleLocationSelect = reactExports.useCallback((newLat, newLng) => {
    setLat(newLat.toFixed(6));
    setLng(newLng.toFixed(6));
  }, []);
  reactExports.useEffect(() => {
    const checkAdmin = async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (user?.id) {
        const { data: profile } = await supabase.from("profiles").select("role").eq("id", user.id).maybeSingle();
        setIsAdmin(!!profile && ["admin", "owner"].some(
          (r) => profile.role?.toLowerCase?.().includes(r)
        ));
      }
    };
    checkAdmin();
  }, []);
  const loadMarkers = reactExports.useCallback(async () => {
    try {
      const { data: markersData } = await supabase.from("markers").select("id, lat, lng, title, active, created_at").order("created_at", { ascending: false }).limit(100);
      if (!markersData) {
        setExistingMarkers([]);
        return;
      }
      const markerIds = markersData.map((m) => m.id);
      const { data: rewardsData } = await supabase.from("marker_rewards").select("marker_id, reward_type, payload").in("marker_id", markerIds);
      const markers = markersData.map((m) => ({
        ...m,
        rewards: (rewardsData || []).filter((r) => r.marker_id === m.id).map((r) => ({ reward_type: r.reward_type, payload: r.payload }))
      }));
      setExistingMarkers(markers);
    } catch (error) {
      console.error("Error loading markers:", error);
    }
  }, []);
  reactExports.useEffect(() => {
    loadMarkers();
  }, [loadMarkers]);
  const buildPayload = () => {
    switch (selectedRewardType) {
      case "M1U":
        return { amount: Math.min(1e3, Math.max(10, m1uAmount)) };
      case "CLUE":
        return { text: clueText, clue_type: "location" };
      case "PHYSICAL_PRIZE":
        return { prize_name: physicalPrize, description: `Premio: ${physicalPrize}` };
      case "BUZZ_FREE":
        return { buzzCount };
      case "XP_POINTS":
        return { xp: xpPoints };
      case "MESSAGE":
        return { text: messageText };
      default:
        return {};
    }
  };
  const handleCreateMarker = async () => {
    const latNum = parseFloat(lat);
    const lngNum = parseFloat(lng);
    if (isNaN(latNum) || isNaN(lngNum)) {
      ue$1.error("Inserisci coordinate valide");
      return;
    }
    setIsLoading(true);
    try {
      const now = /* @__PURE__ */ new Date();
      const visibleTo = new Date(now.getTime() + visibilityHours * 60 * 60 * 1e3);
      const { data: marker, error: markerError } = await supabase.from("markers").insert({
        lat: latNum,
        lng: lngNum,
        title: markerTitle || "Reward Marker",
        active: true,
        visible_from: now.toISOString(),
        visible_to: visibleTo.toISOString()
      }).select().single();
      if (markerError) throw markerError;
      const { error: rewardError } = await supabase.from("marker_rewards").insert({
        marker_id: marker.id,
        reward_type: selectedRewardType.toLowerCase(),
        // 🔥 IMPORTANTE: minuscolo per Edge Function
        payload: buildPayload(),
        description: `${REWARD_TYPES.find((r) => r.value === selectedRewardType)?.label} reward`
      });
      if (rewardError) throw rewardError;
      ue$1.success("✅ Marker creato!");
      setMarkerTitle("");
      loadMarkers();
    } catch (error) {
      console.error("Error:", error);
      ue$1.error(`Errore: ${error.message}`);
    } finally {
      setIsLoading(false);
    }
  };
  const [deletingIds, setDeletingIds] = reactExports.useState(/* @__PURE__ */ new Set());
  const handleDeleteMarker = async (markerId) => {
    if (!confirm(`Eliminare marker ${markerId.slice(0, 8)}...?`)) return;
    console.log("🗑️ ========================================");
    console.log("🗑️ STARTING DELETE for marker:", markerId);
    setDeletingIds((prev) => /* @__PURE__ */ new Set([...prev, markerId]));
    try {
      console.log("🗑️ Calling Edge Function...");
      const { data, error } = await supabase.functions.invoke("admin-delete-marker", {
        body: { marker_id: markerId }
      });
      console.log("🗑️ ========================================");
      console.log("🗑️ Edge Function FULL response:");
      console.log("🗑️ data:", JSON.stringify(data, null, 2));
      console.log("🗑️ error:", error);
      if (data?.logs) {
        console.log("🗑️ SERVER LOGS:");
        data.logs.forEach((log) => console.log("   ", log));
      }
      console.log("🗑️ ========================================");
      if (error) {
        console.error("❌ Edge Function invoke error:", error);
        ue$1.error(`Errore chiamata: ${error.message}`);
        setDeletingIds((prev) => {
          const n = new Set(prev);
          n.delete(markerId);
          return n;
        });
        return;
      }
      if (!data?.success) {
        console.error("❌ Delete operation failed:", data?.error);
        console.error("❌ Server logs:", data?.logs);
        ue$1.error(`Errore: ${data?.error || "Eliminazione fallita"}`);
        setDeletingIds((prev) => {
          const n = new Set(prev);
          n.delete(markerId);
          return n;
        });
        return;
      }
      console.log("✅ SUCCESS! Reloading from server...");
      ue$1.success("✅ Eliminato! Ricarico lista...");
      setDeletingIds((prev) => {
        const n = new Set(prev);
        n.delete(markerId);
        return n;
      });
      setTimeout(() => {
        loadMarkers();
      }, 500);
    } catch (err) {
      console.error("❌ EXCEPTION:", err);
      ue$1.error(`Errore: ${err.message}`);
      setDeletingIds((prev) => {
        const n = new Set(prev);
        n.delete(markerId);
        return n;
      });
    }
  };
  const handleBulkCreate = async () => {
    setIsLoading(true);
    try {
      const { data, error } = await supabase.functions.invoke("create-random-markers", {
        body: {
          distributions: [{
            type: bulkRewardType,
            count: bulkCount,
            payload: bulkRewardType === "M1U" ? { amount: bulkM1uAmount } : {}
          }]
        }
      });
      if (error) throw error;
      ue$1.success(`✅ ${data?.created || bulkCount} marker creati!`);
      loadMarkers();
    } catch (error) {
      ue$1.error(`Errore: ${error.message}`);
    } finally {
      setIsLoading(false);
    }
  };
  if (!isAdmin) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Alert, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDescription, { children: "❌ Solo admin/owner possono accedere." }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold bg-gradient-to-r from-cyan-400 to-pink-400 bg-clip-text text-transparent", children: "🎯 Marker Reward Manager" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground text-sm", children: "Gestione marker reward" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: loadMarkers, variant: "outline", size: "sm", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "h-4 w-4 mr-2" }),
        "Aggiorna"
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "lg:row-span-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "pb-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "h-5 w-5 text-cyan-400" }),
            "Mappa"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Clicca per selezionare posizione" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "p-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full h-[280px] rounded-lg overflow-hidden border border-slate-700", children: /* @__PURE__ */ jsxRuntimeExports.jsx(reactExports.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full h-full flex items-center justify-center bg-slate-900", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "h-8 w-8 animate-spin text-cyan-400" }) }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            SimpleClickMap,
            {
              initialLat: parseFloat(lat) || 41.9028,
              initialLng: parseFloat(lng) || 12.4964,
              onLocationSelect: handleLocationSelect,
              existingMarkers: showExisting ? existingMarkers.map((m) => ({
                id: m.id,
                lat: m.lat,
                lng: m.lng,
                title: m.title,
                reward_type: m.rewards?.[0]?.reward_type
              })) : []
            }
          ) }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-2 mt-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-xs", children: "Latitudine" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  value: lat,
                  onChange: (e) => setLat(e.target.value),
                  placeholder: "41.9028"
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-xs", children: "Longitudine" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  value: lng,
                  onChange: (e) => setLng(e.target.value),
                  placeholder: "12.4964"
                }
              )
            ] })
          ] }),
          lat && lng && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 p-2 bg-green-500/10 border border-green-500/30 rounded text-xs text-green-400", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "h-3 w-3 inline mr-1" }),
            lat,
            ", ",
            lng
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Configurazione" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { value: activeTab, onValueChange: setActiveTab, children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "manual", children: "📍 Manuale" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(TabsTrigger, { value: "bulk", children: "🎲 Bulk" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "manual", className: "space-y-3 mt-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Titolo" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Input, { value: markerTitle, onChange: (e) => setMarkerTitle(e.target.value), placeholder: "Premio Roma" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Tipo Premio" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: selectedRewardType, onValueChange: setSelectedRewardType, children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, {}) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: REWARD_TYPES.map((t) => /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectItem, { value: t.value, children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(t.icon, { className: "h-4 w-4 inline mr-2", style: { color: t.color } }),
                  t.label
                ] }, t.value)) })
              ] })
            ] }),
            selectedRewardType === "M1U" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "M1U (10-1000)" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Input, { type: "number", min: 10, max: 1e3, value: m1uAmount, onChange: (e) => setM1uAmount(+e.target.value || 50) })
            ] }),
            selectedRewardType === "CLUE" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Indizio" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Textarea, { value: clueText, onChange: (e) => setClueText(e.target.value), placeholder: "Il tesoro...", rows: 2 })
            ] }),
            selectedRewardType === "PHYSICAL_PRIZE" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Premio" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: physicalPrize, onValueChange: setPhysicalPrize, children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, {}) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: PHYSICAL_PRIZES.map((p) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: p, children: p }, p)) })
              ] })
            ] }),
            selectedRewardType === "BUZZ_FREE" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Buzz" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Input, { type: "number", min: 1, max: 10, value: buzzCount, onChange: (e) => setBuzzCount(+e.target.value || 1) })
            ] }),
            selectedRewardType === "XP_POINTS" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "XP" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Input, { type: "number", min: 1, max: 1e3, value: xpPoints, onChange: (e) => setXpPoints(+e.target.value || 10) })
            ] }),
            selectedRewardType === "MESSAGE" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Messaggio" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Textarea, { value: messageText, onChange: (e) => setMessageText(e.target.value), rows: 2 })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Visibilità (ore)" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Input, { type: "number", min: 1, max: 168, value: visibilityHours, onChange: (e) => setVisibilityHours(+e.target.value || 24) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleCreateMarker, disabled: isLoading, className: "w-full bg-gradient-to-r from-cyan-500 to-pink-500", children: isLoading ? "Creazione..." : "✨ Crea Marker" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsContent, { value: "bulk", className: "space-y-3 mt-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Quantità (1-100)" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Input, { type: "number", min: 1, max: 100, value: bulkCount, onChange: (e) => setBulkCount(+e.target.value || 25) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Tipo" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Select, { value: bulkRewardType, onValueChange: setBulkRewardType, children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, {}) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(SelectContent, { children: REWARD_TYPES.map((t) => /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: t.value, children: t.label }, t.value)) })
              ] })
            ] }),
            bulkRewardType === "M1U" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "M1U per marker" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Input, { type: "number", min: 10, max: 1e3, value: bulkM1uAmount, onChange: (e) => setBulkM1uAmount(+e.target.value || 50) })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleBulkCreate, disabled: isLoading, className: "w-full bg-gradient-to-r from-purple-500 to-pink-500", children: isLoading ? "Generazione..." : `🎲 Genera ${bulkCount} Marker` })
          ] })
        ] }) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
            "Marker (",
            existingMarkers.length,
            ")"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Switch, { checked: showExisting, onCheckedChange: setShowExisting })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-h-[250px] overflow-y-auto space-y-2", children: existingMarkers.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-center text-muted-foreground py-4", children: "Nessun marker" }) : existingMarkers.slice(0, 20).map((m) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `flex items-center justify-between p-2 bg-muted/30 rounded border border-border/50 ${deletingIds.has(m.id) ? "opacity-50" : ""}`, children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-2 h-2 rounded-full ${m.active ? "bg-green-500" : "bg-gray-500"}` }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: m.title })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-muted-foreground", children: m.rewards?.map((r) => r.reward_type).join(", ") || "No rewards" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              variant: "ghost",
              size: "sm",
              onClick: () => handleDeleteMarker(m.id),
              disabled: deletingIds.has(m.id),
              className: "text-red-400 hover:bg-red-500/10",
              children: deletingIds.has(m.id) ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "h-4 w-4 animate-spin" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "h-4 w-4" })
            }
          )
        ] }, m.id)) }) })
      ] })
    ] })
  ] });
};

const useAdminCheck = (redirectOnFail = true) => {
  const { isAuthenticated, hasRole, isRoleLoading } = useAuthContext();
  const [isAdmin, setIsAdmin] = reactExports.useState(null);
  const { navigate } = useWouterNavigation();
  reactExports.useEffect(() => {
    const checkAdminRole = async () => {
      if (!isRoleLoading) {
        const admin = isAuthenticated && hasRole("admin");
        setIsAdmin(admin);
        if (redirectOnFail && !admin) {
          navigate("/access-denied");
        }
      }
    };
    checkAdminRole();
  }, [isAuthenticated, hasRole, isRoleLoading, redirectOnFail, navigate]);
  return { isAdmin, isRoleLoading };
};

async function enablePush$1(_opts) {
  return enable();
}

function ActivateTab() {
  const [pending, setPending] = React$1.useState(false);
  const onClick = async () => {
    setPending(true);
    try {
      await enablePush$1();
    } finally {
      setPending(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick, disabled: pending, children: pending ? "Enabling…" : "Enable Push" }) });
}

var RADIO_NAME = "Radio";
var [createRadioContext, createRadioScope] = createContextScope$2(RADIO_NAME);
var [RadioProvider, useRadioContext] = createRadioContext(RADIO_NAME);
var Radio = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeRadio,
      name,
      checked = false,
      required,
      disabled,
      value = "on",
      onCheck,
      form,
      ...radioProps
    } = props;
    const [button, setButton] = reactExports.useState(null);
    const composedRefs = useComposedRefs(forwardedRef, (node) => setButton(node));
    const hasConsumerStoppedPropagationRef = reactExports.useRef(false);
    const isFormControl = button ? form || !!button.closest("form") : true;
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(RadioProvider, { scope: __scopeRadio, checked, disabled, children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Primitive$3.button,
        {
          type: "button",
          role: "radio",
          "aria-checked": checked,
          "data-state": getState(checked),
          "data-disabled": disabled ? "" : void 0,
          disabled,
          value,
          ...radioProps,
          ref: composedRefs,
          onClick: composeEventHandlers(props.onClick, (event) => {
            if (!checked) onCheck?.();
            if (isFormControl) {
              hasConsumerStoppedPropagationRef.current = event.isPropagationStopped();
              if (!hasConsumerStoppedPropagationRef.current) event.stopPropagation();
            }
          })
        }
      ),
      isFormControl && /* @__PURE__ */ jsxRuntimeExports.jsx(
        RadioBubbleInput,
        {
          control: button,
          bubbles: !hasConsumerStoppedPropagationRef.current,
          name,
          value,
          checked,
          required,
          disabled,
          form,
          style: { transform: "translateX(-100%)" }
        }
      )
    ] });
  }
);
Radio.displayName = RADIO_NAME;
var INDICATOR_NAME = "RadioIndicator";
var RadioIndicator = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeRadio, forceMount, ...indicatorProps } = props;
    const context = useRadioContext(INDICATOR_NAME, __scopeRadio);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Presence, { present: forceMount || context.checked, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.span,
      {
        "data-state": getState(context.checked),
        "data-disabled": context.disabled ? "" : void 0,
        ...indicatorProps,
        ref: forwardedRef
      }
    ) });
  }
);
RadioIndicator.displayName = INDICATOR_NAME;
var BUBBLE_INPUT_NAME = "RadioBubbleInput";
var RadioBubbleInput = reactExports.forwardRef(
  ({
    __scopeRadio,
    control,
    checked,
    bubbles = true,
    ...props
  }, forwardedRef) => {
    const ref = reactExports.useRef(null);
    const composedRefs = useComposedRefs(ref, forwardedRef);
    const prevChecked = usePrevious(checked);
    const controlSize = useSize(control);
    reactExports.useEffect(() => {
      const input = ref.current;
      if (!input) return;
      const inputProto = window.HTMLInputElement.prototype;
      const descriptor = Object.getOwnPropertyDescriptor(
        inputProto,
        "checked"
      );
      const setChecked = descriptor.set;
      if (prevChecked !== checked && setChecked) {
        const event = new Event("click", { bubbles });
        setChecked.call(input, checked);
        input.dispatchEvent(event);
      }
    }, [prevChecked, checked, bubbles]);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Primitive$3.input,
      {
        type: "radio",
        "aria-hidden": true,
        defaultChecked: checked,
        ...props,
        tabIndex: -1,
        ref: composedRefs,
        style: {
          ...props.style,
          ...controlSize,
          position: "absolute",
          pointerEvents: "none",
          opacity: 0,
          margin: 0
        }
      }
    );
  }
);
RadioBubbleInput.displayName = BUBBLE_INPUT_NAME;
function getState(checked) {
  return checked ? "checked" : "unchecked";
}
var ARROW_KEYS = ["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"];
var RADIO_GROUP_NAME = "RadioGroup";
var [createRadioGroupContext] = createContextScope$2(RADIO_GROUP_NAME, [
  createRovingFocusGroupScope,
  createRadioScope
]);
var useRovingFocusGroupScope = createRovingFocusGroupScope();
var useRadioScope = createRadioScope();
var [RadioGroupProvider, useRadioGroupContext] = createRadioGroupContext(RADIO_GROUP_NAME);
var RadioGroup$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const {
      __scopeRadioGroup,
      name,
      defaultValue,
      value: valueProp,
      required = false,
      disabled = false,
      orientation,
      dir,
      loop = true,
      onValueChange,
      ...groupProps
    } = props;
    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeRadioGroup);
    const direction = useDirection(dir);
    const [value, setValue] = useControllableState({
      prop: valueProp,
      defaultProp: defaultValue ?? null,
      onChange: onValueChange,
      caller: RADIO_GROUP_NAME
    });
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      RadioGroupProvider,
      {
        scope: __scopeRadioGroup,
        name,
        required,
        disabled,
        value,
        onValueChange: setValue,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Root$4,
          {
            asChild: true,
            ...rovingFocusGroupScope,
            orientation,
            dir: direction,
            loop,
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              Primitive$3.div,
              {
                role: "radiogroup",
                "aria-required": required,
                "aria-orientation": orientation,
                "data-disabled": disabled ? "" : void 0,
                dir: direction,
                ...groupProps,
                ref: forwardedRef
              }
            )
          }
        )
      }
    );
  }
);
RadioGroup$1.displayName = RADIO_GROUP_NAME;
var ITEM_NAME = "RadioGroupItem";
var RadioGroupItem$1 = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeRadioGroup, disabled, ...itemProps } = props;
    const context = useRadioGroupContext(ITEM_NAME, __scopeRadioGroup);
    const isDisabled = context.disabled || disabled;
    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeRadioGroup);
    const radioScope = useRadioScope(__scopeRadioGroup);
    const ref = reactExports.useRef(null);
    const composedRefs = useComposedRefs(forwardedRef, ref);
    const checked = context.value === itemProps.value;
    const isArrowKeyPressedRef = reactExports.useRef(false);
    reactExports.useEffect(() => {
      const handleKeyDown = (event) => {
        if (ARROW_KEYS.includes(event.key)) {
          isArrowKeyPressedRef.current = true;
        }
      };
      const handleKeyUp = () => isArrowKeyPressedRef.current = false;
      document.addEventListener("keydown", handleKeyDown);
      document.addEventListener("keyup", handleKeyUp);
      return () => {
        document.removeEventListener("keydown", handleKeyDown);
        document.removeEventListener("keyup", handleKeyUp);
      };
    }, []);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(
      Item$1,
      {
        asChild: true,
        ...rovingFocusGroupScope,
        focusable: !isDisabled,
        active: checked,
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Radio,
          {
            disabled: isDisabled,
            required: context.required,
            checked,
            ...radioScope,
            ...itemProps,
            name: context.name,
            ref: composedRefs,
            onCheck: () => context.onValueChange(itemProps.value),
            onKeyDown: composeEventHandlers((event) => {
              if (event.key === "Enter") event.preventDefault();
            }),
            onFocus: composeEventHandlers(itemProps.onFocus, () => {
              if (isArrowKeyPressedRef.current) ref.current?.click();
            })
          }
        )
      }
    );
  }
);
RadioGroupItem$1.displayName = ITEM_NAME;
var INDICATOR_NAME2 = "RadioGroupIndicator";
var RadioGroupIndicator = reactExports.forwardRef(
  (props, forwardedRef) => {
    const { __scopeRadioGroup, ...indicatorProps } = props;
    const radioScope = useRadioScope(__scopeRadioGroup);
    return /* @__PURE__ */ jsxRuntimeExports.jsx(RadioIndicator, { ...radioScope, ...indicatorProps, ref: forwardedRef });
  }
);
RadioGroupIndicator.displayName = INDICATOR_NAME2;
var Root2 = RadioGroup$1;
var Item2 = RadioGroupItem$1;
var Indicator = RadioGroupIndicator;

const RadioGroup = reactExports.forwardRef(({ className, ...props }, ref) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Root2,
    {
      className: cn("grid gap-2", className),
      ...props,
      ref
    }
  );
});
RadioGroup.displayName = Root2.displayName;
const RadioGroupItem = reactExports.forwardRef(({ className, ...props }, ref) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    Item2,
    {
      ref,
      className: cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      ),
      ...props,
      children: /* @__PURE__ */ jsxRuntimeExports.jsx(Indicator, { className: "flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Circle, { className: "h-2.5 w-2.5 fill-current text-current" }) })
    }
  );
});
RadioGroupItem.displayName = Item2.displayName;

function SendTab() {
  const [mode, setMode] = reactExports.useState("all");
  const [title, setTitle] = reactExports.useState("🔔 M1SSION Alert");
  const [body, setBody] = reactExports.useState("Your mission awaits!");
  const [url, setUrl] = reactExports.useState("/notifications");
  const [imageUrl, setImageUrl] = reactExports.useState("");
  const [extra, setExtra] = reactExports.useState("{}");
  const [userId, setUserId] = reactExports.useState("");
  const [userIds, setUserIds] = reactExports.useState("");
  const [adminToken, setAdminToken] = reactExports.useState("");
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [result, setResult] = reactExports.useState(null);
  const [lastSends, setLastSends] = reactExports.useState([]);
  const validateInputs = () => {
    if (!title.trim()) return "Title is required";
    if (title.length > 80) return "Title too long (max 80 chars)";
    if (!body.trim()) return "Body is required";
    if (body.length > 240) return "Body too long (max 240 chars)";
    if (url && !url.startsWith("/") && !url.startsWith("http://") && !url.startsWith("https://")) {
      return "URL must start with / or https://";
    }
    if (imageUrl && !imageUrl.startsWith("https://")) {
      return "Image URL must start with https://";
    }
    try {
      JSON.parse(extra);
    } catch (e) {
      return "Extra must be valid JSON";
    }
    if (mode === "single" && !userId.trim()) {
      return "User ID required for SINGLE mode";
    }
    if (mode === "multi") {
      const ids = userIds.split(/[\n,]/).map((s) => s.trim()).filter(Boolean);
      if (ids.length === 0) return "At least one User ID required for MULTI mode";
      if (ids.length > 100) return "Too many users (max 100 per batch)";
    }
    if (!adminToken.trim()) {
      return "Admin token required";
    }
    return null;
  };
  const handleSend = async () => {
    const error = validateInputs();
    if (error) {
      ue$1.error(error);
      return;
    }
    setIsLoading(true);
    setResult(null);
    try {
      const parsedExtra = JSON.parse(extra);
      const payload = {
        title,
        body,
        url: url || "/notifications",
        image: imageUrl || void 0,
        extra: parsedExtra
      };
      const SB_URL = `https://${getProjectRef()}.supabase.co`;
      const ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk";
      let endpoint = "";
      let requestBody = { payload };
      if (mode === "all") {
        endpoint = `${SB_URL}/functions/v1/webpush-send`;
        requestBody.audience = "all";
      } else if (mode === "single") {
        endpoint = `${SB_URL}/functions/v1/webpush-targeted-send`;
        requestBody.user_ids = userId.trim();
      } else if (mode === "multi") {
        endpoint = `${SB_URL}/functions/v1/webpush-targeted-send`;
        const ids = userIds.split(/[\n,]/).map((s) => s.trim()).filter(Boolean);
        const uniqueIds = [...new Set(ids)];
        requestBody.user_ids = uniqueIds;
      }
      const response = await fetch(endpoint, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-admin-token": adminToken,
          "apikey": ANON_KEY
        },
        body: JSON.stringify(requestBody)
      });
      const data = await response.json();
      if (response.ok && data.success) {
        setResult(data);
        ue$1.success(`Push sent: ${data.sent}/${data.total}`);
        const newEntry = {
          time: (/* @__PURE__ */ new Date()).toLocaleTimeString(),
          mode: mode.toUpperCase(),
          sent: data.sent,
          failed: data.failed
        };
        setLastSends((prev) => [newEntry, ...prev].slice(0, 5));
      } else {
        setResult(data);
        ue$1.error(data.error || "Failed to send push");
      }
    } catch (error2) {
      ue$1.error(error2.message || "Network error");
      console.error("[Push Center] Error:", error2);
    } finally {
      setIsLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-sm font-semibold", children: "Audience Mode" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(RadioGroup, { value: mode, onValueChange: (v) => setMode(v), children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(RadioGroupItem, { value: "all", id: "mode-all" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "mode-all", className: "cursor-pointer", children: "ALL - Broadcast to all active subscriptions" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(RadioGroupItem, { value: "single", id: "mode-single" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "mode-single", className: "cursor-pointer", children: "SINGLE - Send to one User ID" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(RadioGroupItem, { value: "multi", id: "mode-multi" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "mode-multi", className: "cursor-pointer", children: "MULTI - Send to multiple User IDs (max 100)" })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "admin-token", children: "Admin Token *" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          id: "admin-token",
          type: "password",
          placeholder: "Enter PUSH_ADMIN_TOKEN",
          value: adminToken,
          onChange: (e) => setAdminToken(e.target.value)
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Required for all send operations" })
    ] }),
    mode === "single" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "user-id", children: "User ID *" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          id: "user-id",
          placeholder: "uuid-user-id",
          value: userId,
          onChange: (e) => setUserId(e.target.value)
        }
      )
    ] }),
    mode === "multi" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "user-ids", children: "User IDs * (one per line or comma-separated)" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Textarea,
        {
          id: "user-ids",
          className: "min-h-[100px] font-mono text-sm",
          placeholder: "uuid-1\nuuid-2\nuuid-3",
          value: userIds,
          onChange: (e) => setUserIds(e.target.value)
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Max 100 users per batch" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "title", children: "Title * (max 80 chars)" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          id: "title",
          placeholder: "🔔 Your notification title",
          value: title,
          onChange: (e) => setTitle(e.target.value),
          maxLength: 80
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground", children: [
        title.length,
        "/80"
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "body", children: "Body * (max 240 chars)" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Textarea,
        {
          id: "body",
          className: "min-h-[80px]",
          placeholder: "Your notification message",
          value: body,
          onChange: (e) => setBody(e.target.value),
          maxLength: 240
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground", children: [
        body.length,
        "/240"
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "url", children: "Link URL (optional)" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          id: "url",
          placeholder: "/notifications or https://...",
          value: url,
          onChange: (e) => setUrl(e.target.value)
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "image-url", children: "Image URL (optional, https only)" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          id: "image-url",
          placeholder: "https://example.com/image.jpg",
          value: imageUrl,
          onChange: (e) => setImageUrl(e.target.value)
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "extra", children: "Extra Payload (JSON, optional)" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Textarea,
        {
          id: "extra",
          className: "min-h-[60px] font-mono text-sm",
          placeholder: '{"key": "value"}',
          value: extra,
          onChange: (e) => setExtra(e.target.value)
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        onClick: handleSend,
        disabled: isLoading,
        className: "w-full",
        size: "lg",
        children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 mr-2 animate-spin" }),
          "Sending..."
        ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-2" }),
          "Send Push Notification"
        ] })
      }
    ),
    result && /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: `p-4 border-2 ${result.success && result.sent > 0 ? "border-green-500 bg-green-500/10" : "border-red-500 bg-red-500/10"}`, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
      result.success && result.sent > 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-6 h-6 text-green-500 flex-shrink-0" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-6 h-6 text-red-500 flex-shrink-0" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 flex-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-semibold", children: result.success ? "Push Sent" : "Push Failed" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-muted-foreground", children: [
            result.sent,
            "/",
            result.total,
            " sent"
          ] })
        ] }),
        result.message && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: result.message }),
        result.failed > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm font-medium", children: [
            "Failed: ",
            result.failed
          ] }),
          result.errors && result.errors.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs space-y-1 bg-black/20 p-2 rounded", children: result.errors.slice(0, 5).map((err, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-3 h-3 flex-shrink-0 mt-0.5" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
              err.user_id && `User: ${err.user_id.slice(0, 8)}... - `,
              err.reason || "Unknown error"
            ] })
          ] }, i)) })
        ] })
      ] })
    ] }) }),
    lastSends.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "p-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-sm font-semibold mb-3 flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-4 h-4" }),
        "Recent Sends"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: lastSends.map((send, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-sm border-b border-border/50 pb-2 last:border-0 last:pb-0", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-muted-foreground", children: send.time }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-mono text-xs bg-primary/10 px-2 py-0.5 rounded", children: send.mode })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-green-500", children: [
            send.sent,
            " sent"
          ] }),
          send.failed > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-red-500", children: [
            send.failed,
            " failed"
          ] })
        ] })
      ] }, i)) })
    ] })
  ] });
}

async function getCurrentSubscription() {
  if (!("serviceWorker" in navigator) || !("PushManager" in window)) {
    return null;
  }
  try {
    const reg = await navigator.serviceWorker.ready;
    return await reg.pushManager.getSubscription();
  } catch {
    return null;
  }
}

async function enableWebPush() {
  const reg = await navigator.serviceWorker.ready;
  return subscribeWebPushAndSave(reg);
}

function DebugTab() {
  const [permission, setPermission] = reactExports.useState("default");
  const [swStatus, setSwStatus] = reactExports.useState("");
  const [swScope, setSwScope] = reactExports.useState("");
  const [hasSubscription, setHasSubscription] = reactExports.useState(false);
  const [endpointTail, setEndpointTail] = reactExports.useState("");
  const [sessionInfo, setSessionInfo] = reactExports.useState("");
  const [vapidKey, setVapidKey] = reactExports.useState("");
  const [lastUpsertResult, setLastUpsertResult] = reactExports.useState(null);
  const [lastSendResult, setLastSendResult] = reactExports.useState(null);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const updateStatus = async () => {
    if ("Notification" in window) {
      setPermission(Notification.permission);
    }
    if ("serviceWorker" in navigator) {
      if (navigator.serviceWorker.controller) {
        setSwStatus("✅ Registered & Controlling");
        const reg = await navigator.serviceWorker.ready;
        setSwScope(reg.scope);
      } else {
        setSwStatus("⚠️ Registered but not controlling");
      }
    } else {
      setSwStatus("❌ Not supported");
    }
    const sub = await getCurrentSubscription();
    const isSubbed = !!sub;
    setHasSubscription(isSubbed);
    if (sub?.endpoint) {
      setEndpointTail("..." + sub.endpoint.slice(-20));
    } else {
      setEndpointTail("");
    }
    const { data: { session } } = await supabase.auth.getSession();
    if (session?.user) {
      setSessionInfo(`${session.user.email} (${session.user.id.slice(0, 8)}...)`);
    } else {
      setSessionInfo("Not logged in");
    }
    try {
      const { loadVAPIDPublicKey } = await __vitePreload(async () => { const { loadVAPIDPublicKey } = await import('./vapid-loader.Dvqe_4zt.js');return { loadVAPIDPublicKey }},true?[]:void 0);
      const vapid = await loadVAPIDPublicKey();
      setVapidKey(vapid ? "..." + vapid.slice(-12) : "Not configured");
    } catch {
      setVapidKey("Error reading VAPID");
    }
  };
  reactExports.useEffect(() => {
    updateStatus();
  }, []);
  const handleResubscribe = async () => {
    setIsLoading(true);
    setLastUpsertResult(null);
    try {
      const sub = await enableWebPush();
      const endpointTail2 = sub.endpoint.substring(sub.endpoint.length - 12);
      setLastUpsertResult({
        status: 200,
        data: {
          ok: true,
          message: "Subscription successful",
          endpoint_tail: endpointTail2,
          mode: "jsonb_keys"
        },
        suggestion: "✅ Success! Subscription registered in DB with JSONB keys."
      });
      await updateStatus();
    } catch (error) {
      console.error("[DebugTab] Resubscribe error:", error);
      let errorReason = "unknown_error";
      let errorMessage = error.message;
      let suggestion = "";
      if (error.message.includes("missing_fields")) {
        errorReason = "missing_fields";
        errorMessage = "Missing p256dh or auth keys";
        suggestion = "⚠️ Browser subscription may have failed. Check VAPID key configuration.";
      } else if (error.message.includes("database_error")) {
        errorReason = "database_error";
        errorMessage = "Database error during upsert";
        suggestion = "⚠️ Check webpush_subscriptions table schema and RLS policies in Supabase.";
      } else if (error.message.includes("invalid_jwt") || error.message.includes("Unauthorized")) {
        errorReason = "auth_error";
        errorMessage = "Authentication failed";
        suggestion = "⚠️ JWT invalid or expired. Please log in again.";
      } else if (error.message.includes("Permesso notifiche negato")) {
        errorReason = "permission_denied";
        errorMessage = "Notification permission denied";
        suggestion = "⚠️ User denied notification permission. Check browser settings.";
      } else {
        suggestion = "⚠️ " + errorMessage;
      }
      setLastUpsertResult({
        status: 0,
        data: { error: errorMessage, reason: errorReason },
        suggestion
      });
    } finally {
      setIsLoading(false);
    }
  };
  const handleTestSendSelf = async () => {
    setIsLoading(true);
    setLastSendResult(null);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.access_token) {
        throw new Error("Not authenticated");
      }
      const startTime = performance.now();
      const response = await sendPushNotification(
        {
          audience: { user_id: session.user.id },
          payload: {
            title: "Test Self",
            body: `Test at ${(/* @__PURE__ */ new Date()).toLocaleTimeString()}`,
            url: "/notifications"
          }
        },
        { userJWT: session.access_token }
      );
      setLastSendResult({
        ...response,
        suggestion: getSuggestion(response.data.error, response.status)
      });
    } catch (error) {
      setLastSendResult({
        status: 0,
        data: { error: error.message },
        responseTime: 0,
        suggestion: getSuggestion(error.message)
      });
    } finally {
      setIsLoading(false);
    }
  };
  const handleTestSendAll = async () => {
    setIsLoading(true);
    setLastSendResult(null);
    try {
      const adminToken = prompt("Enter admin token:");
      if (!adminToken) {
        setIsLoading(false);
        return;
      }
      const response = await sendPushNotification(
        {
          audience: "all",
          payload: {
            title: "Admin Broadcast Test",
            body: `Broadcast at ${(/* @__PURE__ */ new Date()).toLocaleTimeString()}`,
            url: "/notifications"
          }
        },
        { adminToken }
      );
      setLastSendResult({
        ...response,
        suggestion: getSuggestion(response.data.error, response.status)
      });
    } catch (error) {
      setLastSendResult({
        status: 0,
        data: { error: error.message },
        responseTime: 0,
        suggestion: getSuggestion(error.message)
      });
    } finally {
      setIsLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg border border-gray-700 space-y-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "System Status" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm", children: [
        permission === "granted" ? /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-green-400" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-4 h-4 text-red-400" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-300", children: "Permission:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: permission === "granted" ? "text-green-400" : "text-red-400", children: permission })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm", children: [
        swStatus.includes("✅") ? /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-green-400" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-4 h-4 text-yellow-400" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-300", children: "Service Worker:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: swStatus })
      ] }),
      swScope && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-gray-500", children: [
        "Scope: ",
        swScope
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm", children: [
        hasSubscription ? /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-green-400" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-4 h-4 text-red-400" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-300", children: "Subscription:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: hasSubscription ? "text-green-400" : "text-red-400", children: hasSubscription ? "Active" : "None" })
      ] }),
      endpointTail && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-gray-500", children: [
        "Endpoint: ",
        endpointTail
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-300", children: "Session:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: sessionInfo })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-300", children: "VAPID Public:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: vapidKey })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2 flex-wrap", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: updateStatus, size: "sm", variant: "outline", disabled: isLoading, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-4 h-4 mr-1" }),
        "Refresh"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleResubscribe, size: "sm", variant: "default", disabled: isLoading, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-1" }),
        "(Re)Subscribe"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleTestSendSelf, size: "sm", variant: "secondary", disabled: isLoading, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-1" }),
        "Test Self"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleTestSendAll, size: "sm", variant: "destructive", disabled: isLoading, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-4 h-4 mr-1" }),
        "Test All (Admin)"
      ] })
    ] }),
    lastUpsertResult && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg border border-gray-700 space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-white", children: "Last Upsert Result" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `text-sm ${lastUpsertResult.status === 200 ? "text-green-400" : "text-red-400"}`, children: [
        "Status: ",
        lastUpsertResult.status
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { className: "text-xs bg-black/40 p-2 rounded overflow-auto max-h-40", children: JSON.stringify(lastUpsertResult.data, null, 2) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-yellow-400", children: lastUpsertResult.suggestion })
    ] }),
    lastSendResult && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg border border-gray-700 space-y-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-white", children: "Last Send Result" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: `text-sm ${lastSendResult.status === 200 ? "text-green-400" : "text-red-400"}`, children: [
          "Status: ",
          lastSendResult.status
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-gray-400 text-xs", children: [
          lastSendResult.responseTime,
          "ms"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { className: "text-xs bg-black/40 p-2 rounded overflow-auto max-h-40", children: JSON.stringify(lastSendResult.data, null, 2) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-yellow-400", children: lastSendResult.suggestion })
    ] })
  ] });
}

function SubscriptionsTab() {
  const [subscriptions, setSubscriptions] = reactExports.useState([]);
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [error, setError] = reactExports.useState("");
  const fetchSubscriptions = async () => {
    setIsLoading(true);
    setError("");
    try {
      const { data, error: fetchError } = await supabase.from("webpush_subscriptions").select("id, user_id, endpoint, platform, is_active, created_at, updated_at, token").order("created_at", { ascending: false }).limit(50);
      if (fetchError) throw fetchError;
      const rows = data || [];
      const mapped = rows.map((r) => ({
        id: r.id,
        user_id: r.user_id,
        endpoint: r.endpoint,
        platform: r.platform,
        is_active: r.is_active,
        created_at: r.created_at,
        updated_at: r.updated_at
      }));
      setSubscriptions(mapped);
    } catch (err) {
      setError(err.message || "Failed to fetch subscriptions");
      console.error("Error fetching subscriptions:", err);
    } finally {
      setIsLoading(false);
    }
  };
  reactExports.useEffect(() => {
    fetchSubscriptions();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-semibold text-white", children: [
        "Latest Subscriptions (",
        subscriptions.length,
        ")"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: fetchSubscriptions, size: "sm", variant: "outline", disabled: isLoading, children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-4 h-4" }) })
    ] }),
    error && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm", children: error }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "overflow-auto max-h-[500px] border border-gray-700 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("table", { className: "w-full text-sm", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("thead", { className: "bg-gray-800/50 sticky top-0", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("tr", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("th", { className: "text-left p-3 text-gray-400 font-medium", children: "Created" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("th", { className: "text-left p-3 text-gray-400 font-medium", children: "User ID" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("th", { className: "text-left p-3 text-gray-400 font-medium", children: "Platform" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("th", { className: "text-left p-3 text-gray-400 font-medium", children: "Endpoint" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("th", { className: "text-left p-3 text-gray-400 font-medium", children: "Active" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("tbody", { children: [
        subscriptions.length === 0 && !isLoading && /* @__PURE__ */ jsxRuntimeExports.jsx("tr", { children: /* @__PURE__ */ jsxRuntimeExports.jsx("td", { colSpan: 5, className: "text-center p-8 text-gray-500", children: "No subscriptions found" }) }),
        subscriptions.map((sub) => /* @__PURE__ */ jsxRuntimeExports.jsxs("tr", { className: "border-t border-gray-800 hover:bg-gray-800/30", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("td", { className: "p-3 text-gray-300", children: new Date(sub.created_at).toLocaleDateString() }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("td", { className: "p-3 text-gray-300 font-mono text-xs", children: [
            sub.user_id.slice(0, 8),
            "..."
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("td", { className: "p-3 text-gray-300 text-xs", children: sub.platform }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("td", { className: "p-3 text-gray-400 font-mono text-xs truncate max-w-xs", children: [
            "...",
            sub.endpoint.slice(-30)
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("td", { className: "p-3", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: `px-2 py-1 rounded text-xs ${sub.is_active ? "bg-green-500/20 text-green-400" : "bg-gray-500/20 text-gray-400"}`, children: sub.is_active ? "Active" : "Inactive" }) })
        ] }, sub.id))
      ] })
    ] }) })
  ] });
}

function LogsTab() {
  const SUPABASE_PROJECT_ID = getProjectRef();
  const openLogs = (functionName) => {
    window.open(
      `https://supabase.com/dashboard/project/${SUPABASE_PROJECT_ID}/functions/${functionName}/logs`,
      "_blank"
    );
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg border border-gray-700", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white mb-4", children: "Edge Function Logs" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm mb-4", children: "Visualizza i logs delle Edge Functions direttamente dalla dashboard Supabase." }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: () => openLogs("webpush-upsert"),
            variant: "outline",
            className: "w-full justify-between",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "webpush-upsert logs" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(ExternalLink, { className: "w-4 h-4" })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: () => openLogs("webpush-send"),
            variant: "outline",
            className: "w-full justify-between",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "webpush-send logs" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(ExternalLink, { className: "w-4 h-4" })
            ]
          }
        )
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg border border-gray-700 bg-blue-500/5", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-blue-400 mb-2", children: "Log Filters" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-400 mb-3", children: "Quando visualizzi i logs, cerca questi pattern per identificare problemi:" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-xs text-gray-500 space-y-1 list-disc list-inside", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-orange-400", children: "error" }),
          " - Errori generici"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-orange-400", children: "[WEBPUSH-UPSERT]" }),
          " - Log specifici upsert"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-orange-400", children: "[WEBPUSH-SEND]" }),
          " - Log specifici invio"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-orange-400", children: "401" }),
          " - Errori di autenticazione"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-orange-400", children: "500" }),
          " - Errori server"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-green-400", children: "✅" }),
          " - Operazioni riuscite"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-red-400", children: "❌" }),
          " - Operazioni fallite"
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg border border-gray-700 bg-purple-500/5", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-purple-400 mb-2", children: "Quick Debug Tips" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-sm text-gray-400 space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "No logs appearing?" }),
          " Assicurati che le funzioni siano state deployate e invocate almeno una volta."
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "CORS errors?" }),
          " Verifica che le funzioni includano gli header CORS corretti per il tuo dominio."
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "401 Unauthorized?" }),
          " Controlla che il JWT sia valido e non scaduto."
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "500 errors?" }),
          " Verifica che tutti i secrets (VAPID, PUSH_ADMIN_TOKEN) siano configurati."
        ] })
      ] })
    ] })
  ] });
}

function PushCenterCard() {
  const [activeTab, setActiveTab] = reactExports.useState("activate");
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "glass-card p-6 border border-[#4361ee]/30", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent", children: "📡 Push Center" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm mt-2", children: "Invio notifiche push (Web Push + FCM) • Debug E2E • Subscriptions • Logs" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { value: activeTab, onValueChange: setActiveTab, className: "w-full", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-5 mb-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "activate", className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "hidden sm:inline", children: "Attiva" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "send", className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "hidden sm:inline", children: "Send" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "debug", className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Bug, { className: "w-4 h-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "hidden sm:inline", children: "Debug" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "subscriptions", className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "w-4 h-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "hidden sm:inline", children: "Subs" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "logs", className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-4 h-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "hidden sm:inline", children: "Logs" })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "activate", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ActivateTab, {}) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "send", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SendTab, {}) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "debug", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(DebugTab, {}) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "subscriptions", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionsTab, {}) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "logs", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LogsTab, {}) })
    ] })
  ] });
}

async function getPushStatus() {
  const supported = "serviceWorker" in navigator && "PushManager" in window && "Notification" in window;
  let hasSubscription = false;
  let endpoint = null;
  const permission = "Notification" in window ? Notification.permission : null;
  if (supported) {
    try {
      const reg = await navigator.serviceWorker.ready;
      const sub = await reg.pushManager.getSubscription();
      hasSubscription = !!sub;
      endpoint = sub?.endpoint ?? null;
    } catch {
    }
  }
  return { supported, permission, hasSubscription, endpoint };
}
async function repairPush() {
  const status = await getPushStatus();
  if (!status.supported) {
    return status;
  }
  try {
    const reg = await navigator.serviceWorker.ready;
    const sub = await reg.pushManager.getSubscription();
    if (sub) {
      await sub.unsubscribe();
    }
  } catch {
  }
  const result = await runRepairFlow();
  return {
    supported: true,
    permission: Notification.permission,
    hasSubscription: result.ok && !!result.subscription,
    endpoint: result.endpoint ?? null
  };
}
async function sendSelfTest(payload = {}) {
  const url = `${functionsBaseUrl}/webpush-send`;
  let headers = { "Content-Type": "application/json" };
  try {
    const { data } = await supabase.auth.getSession();
    const token = data?.session?.access_token;
    if (token) headers.Authorization = `Bearer ${token}`;
  } catch {
  }
  const body = {
    kind: "self-test",
    timestamp: (/* @__PURE__ */ new Date()).toISOString(),
    ...payload
  };
  const res = await fetch(url, {
    method: "POST",
    headers,
    body: JSON.stringify(body)
  });
  const ok = res.ok;
  let info = null;
  try {
    info = await res.json();
  } catch {
  }
  return { ok, status: res.status, info };
}

const PushCenter = () => {
  const [status, setStatus] = reactExports.useState(null);
  const [isRepairing, setIsRepairing] = reactExports.useState(false);
  const [isSending, setIsSending] = reactExports.useState(false);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const loadStatus = async () => {
    setIsLoading(true);
    try {
      const s = await getPushStatus();
      setStatus(s);
    } catch (error) {
      console.error("Failed to load push status:", error);
      ue$1.error("Errore nel caricamento dello stato");
    } finally {
      setIsLoading(false);
    }
  };
  reactExports.useEffect(() => {
    loadStatus();
    const interval = setInterval(loadStatus, 1e4);
    return () => clearInterval(interval);
  }, []);
  const handleRepair = async () => {
    setIsRepairing(true);
    try {
      const result = await repairPush();
      if (result.supported && !result.hasSubscription) {
        ue$1.success("Push riparato");
        await loadStatus();
      } else {
        ue$1.error("Errore riparazione");
      }
    } catch (error) {
      ue$1.error(`Errore: ${error.message}`);
    } finally {
      setIsRepairing(false);
    }
  };
  const handleSendTest = async () => {
    setIsSending(true);
    try {
      const result = await sendSelfTest();
      if (result.ok) {
        ue$1.success("Test inviato");
      } else {
        ue$1.error(`Test fallito (status: ${result.status ?? 500})`);
      }
    } catch (error) {
      ue$1.error(`Errore: ${error.message}`);
    } finally {
      setIsSending(false);
    }
  };
  const getStatusColor = (isOk) => isOk ? "bg-green-500" : "bg-red-500";
  const isFullyConfigured = status && status.permission === "granted" && status.swRegistered && status.subscriptionPresent && status.jwtPresent && status.vapidValid;
  const isIOSSafari = navigator.userAgent.includes("Safari") && !navigator.userAgent.includes("Chrome") && /iPhone|iPad|iPod/.test(navigator.userAgent);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-cyan-500/30 backdrop-blur-sm", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-cyan-400 flex items-center gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5" }),
      "Push Center"
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-4", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center py-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-6 h-6 animate-spin text-cyan-400" }) }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${getStatusColor(status?.permission === "granted")}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/80", children: "Permission" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${getStatusColor(status?.swRegistered)}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/80", children: "Service Worker" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${getStatusColor(status?.subscriptionPresent)}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/80", children: "Subscription" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${getStatusColor(status?.jwtPresent)}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/80", children: "JWT" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${getStatusColor(status?.vapidValid)}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/80", children: "VAPID" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: isFullyConfigured ? "default" : "destructive", className: "text-xs", children: status?.platform }) })
      ] }),
      isIOSSafari && status?.permission !== "granted" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-yellow-500/10 border border-yellow-500/30 rounded-md p-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4 text-yellow-400 mt-0.5" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-yellow-200", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "iOS Safari:" }),
          " Installa l'app alla Home Screen (PWA) per ricevere notifiche (iOS 16.4+)"
        ] })
      ] }) }),
      status?.permission === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-red-500/10 border border-red-500/30 rounded-md p-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-red-200", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Permesso negato." }),
        " Vai nelle impostazioni del browser e abilita le notifiche per m1ssion.eu"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3 pt-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleRepair,
            disabled: isRepairing,
            className: "bg-cyan-500 hover:bg-cyan-600 text-black font-medium",
            children: isRepairing ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 mr-2 animate-spin" }),
              "Riparazione..."
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Wrench, { className: "w-4 h-4 mr-2" }),
              "Ripara"
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleSendTest,
            disabled: isSending || !isFullyConfigured,
            variant: "outline",
            className: "border-cyan-500/50 text-cyan-400 hover:bg-cyan-500/10",
            children: isSending ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 mr-2 animate-spin" }),
              "Invio..."
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-2" }),
              "Test"
            ] })
          }
        )
      ] }),
      isFullyConfigured && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-green-500/10 border border-green-500/30 rounded-md p-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-green-400 text-sm", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Sistema push attivo e configurato" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "pt-2 border-t border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        "a",
        {
          href: "/push-diagnosi",
          className: "text-xs text-cyan-400 hover:text-cyan-300 underline inline-block",
          children: "🔍 Apri diagnostica completa →"
        }
      ) })
    ] }) })
  ] });
};

const PushControlPanelPage = () => {
  const [audience, setAudience] = reactExports.useState("all");
  const [userIds, setUserIds] = reactExports.useState("");
  const [title, setTitle] = reactExports.useState("");
  const [badge, setBadge] = reactExports.useState("");
  const [message, setMessage] = reactExports.useState("");
  const [imageUrl, setImageUrl] = reactExports.useState("");
  const [linkUrl, setLinkUrl] = reactExports.useState("/notifications");
  const [freeBuzz, setFreeBuzz] = reactExports.useState(false);
  const [freeBuzzMap, setFreeBuzzMap] = reactExports.useState(false);
  const [xpPoints, setXpPoints] = reactExports.useState("");
  const [markerLat, setMarkerLat] = reactExports.useState("");
  const [markerLng, setMarkerLng] = reactExports.useState("");
  const [loading, setLoading] = reactExports.useState(false);
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!title && !message) {
      ue$1.error("Inserisci almeno title o message");
      return;
    }
    if (audience !== "all" && !userIds.trim()) {
      ue$1.error("Inserisci User ID(s) per invio targeted");
      return;
    }
    setLoading(true);
    try {
      const payload = {
        title: title || void 0,
        body: message || void 0,
        url: linkUrl || "/notifications"
      };
      if (imageUrl) {
        payload.image = imageUrl;
      }
      if (badge) {
        payload.badge = Number(badge) || 0;
      }
      const extras = {};
      if (freeBuzz) extras.free_buzz = true;
      if (freeBuzzMap) extras.free_buzz_map = true;
      if (xpPoints) extras.xp_points = Number(xpPoints) || 0;
      if (markerLat && markerLng) {
        extras.marker = {
          lat: Number(markerLat) || 0,
          lng: Number(markerLng) || 0
        };
      }
      if (Object.keys(extras).length > 0) {
        payload.data = { extras };
      }
      let requestPayload;
      if (audience === "all") {
        requestPayload = {
          audience: "all",
          payload
        };
      } else {
        const ids = userIds.split(",").map((id) => id.trim()).filter(Boolean);
        if (ids.length === 0) {
          ue$1.error("User IDs non validi");
          setLoading(false);
          return;
        }
        requestPayload = {
          audience: "list",
          filters: {
            ids
          },
          payload
        };
      }
      const result = await sendPushNotification(requestPayload, {
        // The API will use session JWT, admin features require proper backend auth
      });
      if (result.status === 200 || result.status === 201) {
        const data = result.data;
        ue$1.success(`✅ Push inviata! Sent: ${data.sent || 0}, Failed: ${data.failed || 0}`);
        setTitle("");
        setMessage("");
        setImageUrl("");
        setBadge("");
        setFreeBuzz(false);
        setFreeBuzzMap(false);
        setXpPoints("");
        setMarkerLat("");
        setMarkerLng("");
      } else {
        ue$1.error(`Errore: ${result.data.message || "Unknown error"}`);
      }
    } catch (error) {
      console.error("Push send error:", error);
      ue$1.error(error.message || "Errore invio push");
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-b from-background to-background/80 p-4 pb-24", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-2xl mx-auto space-y-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-primary/20", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "h-5 w-5" }),
        "Push Control Panel"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Invia notifiche push a utenti specifici o broadcast" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { children: "Destinatari" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: audience === "single" ? "default" : "outline",
              onClick: () => setAudience("single"),
              className: "flex-1",
              children: "Single User"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: audience === "multi" ? "default" : "outline",
              onClick: () => setAudience("multi"),
              className: "flex-1",
              children: "Multi User"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              type: "button",
              variant: audience === "all" ? "default" : "outline",
              onClick: () => setAudience("all"),
              className: "flex-1",
              children: "All Users"
            }
          )
        ] })
      ] }),
      audience !== "all" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "userIds", children: "User ID(s)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "userIds",
            placeholder: "uuid1, uuid2, uuid3...",
            value: userIds,
            onChange: (e) => setUserIds(e.target.value)
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Separati da virgola" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "title", children: "Title" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "title",
            placeholder: "Titolo notifica",
            value: title,
            onChange: (e) => setTitle(e.target.value)
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "badge", children: "Badge (numero)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "badge",
            type: "number",
            placeholder: "0",
            value: badge,
            onChange: (e) => setBadge(e.target.value)
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "message", children: "Message" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Textarea,
          {
            id: "message",
            placeholder: "Corpo del messaggio",
            value: message,
            onChange: (e) => setMessage(e.target.value),
            rows: 4
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "imageUrl", children: "Image URL (opzionale)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "imageUrl",
            placeholder: "https://...",
            value: imageUrl,
            onChange: (e) => setImageUrl(e.target.value)
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "linkUrl", children: "Link URL" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "linkUrl",
            placeholder: "/notifications",
            value: linkUrl,
            onChange: (e) => setLinkUrl(e.target.value)
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-muted/50", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "pb-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-sm", children: "Extras (Opzionali)" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { className: "text-xs", children: "Campi addizionali non invasivi" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "freeBuzz", className: "text-sm", children: "Free Buzz" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Switch,
              {
                id: "freeBuzz",
                checked: freeBuzz,
                onCheckedChange: setFreeBuzz
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "freeBuzzMap", className: "text-sm", children: "Free Buzz Map" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Switch,
              {
                id: "freeBuzzMap",
                checked: freeBuzzMap,
                onCheckedChange: setFreeBuzzMap
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "xpPoints", className: "text-sm", children: "XP Points" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "xpPoints",
                type: "number",
                placeholder: "0",
                value: xpPoints,
                onChange: (e) => setXpPoints(e.target.value)
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "markerLat", className: "text-sm", children: "Marker Lat" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  id: "markerLat",
                  type: "number",
                  step: "any",
                  placeholder: "45.123",
                  value: markerLat,
                  onChange: (e) => setMarkerLat(e.target.value)
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "markerLng", className: "text-sm", children: "Marker Lng" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  id: "markerLng",
                  type: "number",
                  step: "any",
                  placeholder: "9.456",
                  value: markerLng,
                  onChange: (e) => setMarkerLng(e.target.value)
                }
              )
            ] })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          type: "submit",
          className: "w-full",
          size: "lg",
          disabled: loading || !title && !message,
          children: loading ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "mr-2 h-4 w-4 animate-spin" }),
            "Invio..."
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "mr-2 h-4 w-4" }),
            "Invia Push"
          ] })
        }
      )
    ] }) })
  ] }) }) });
};

const PushAutoPreflightPage = () => {
  const [notificationPermission, setNotificationPermission] = reactExports.useState({ status: "idle", message: "" });
  const [serviceWorker, setServiceWorker] = reactExports.useState({ status: "idle", message: "" });
  const [pushSubscription, setPushSubscription] = reactExports.useState({ status: "idle", message: "" });
  const [edgeFunction, setEdgeFunction] = reactExports.useState({ status: "idle", message: "" });
  const [adminToken, setAdminToken] = reactExports.useState({ status: "idle", message: "" });
  const [dbAccess, setDbAccess] = reactExports.useState({ status: "idle", message: "" });
  reactExports.useEffect(() => {
    runPreflight();
  }, []);
  const runPreflight = async () => {
    checkNotificationPermission();
    await checkServiceWorker();
    await checkPushSubscription();
    await checkEdgeFunction();
    checkAdminToken();
    await checkDbAccess();
  };
  const checkNotificationPermission = () => {
    setNotificationPermission({ status: "loading", message: "Verifica permessi..." });
    if (!("Notification" in window)) {
      setNotificationPermission({
        status: "error",
        message: "Notification API non supportata",
        details: "Browser non compatibile"
      });
      return;
    }
    const permission = Notification.permission;
    if (permission === "granted") {
      setNotificationPermission({
        status: "success",
        message: "Permessi concessi",
        details: permission
      });
    } else if (permission === "denied") {
      setNotificationPermission({
        status: "error",
        message: "Permessi negati",
        details: permission
      });
    } else {
      setNotificationPermission({
        status: "warning",
        message: "Permessi non richiesti",
        details: permission
      });
    }
  };
  const checkServiceWorker = async () => {
    setServiceWorker({ status: "loading", message: "Verifica Service Worker..." });
    if (!("serviceWorker" in navigator)) {
      setServiceWorker({
        status: "error",
        message: "Service Worker non supportato",
        details: "Browser non compatibile"
      });
      return;
    }
    try {
      const registration = await navigator.serviceWorker.getRegistration();
      if (registration && registration.active) {
        setServiceWorker({
          status: "success",
          message: "Service Worker attivo",
          details: registration.scope
        });
      } else {
        setServiceWorker({
          status: "warning",
          message: "Service Worker non attivo",
          details: "Nessuna registrazione trovata"
        });
      }
    } catch (error) {
      setServiceWorker({
        status: "error",
        message: "Errore verifica SW",
        details: error.message
      });
    }
  };
  const checkPushSubscription = async () => {
    setPushSubscription({ status: "loading", message: "Verifica subscription..." });
    try {
      const registration = await navigator.serviceWorker.ready;
      const subscription = await registration.pushManager.getSubscription();
      if (subscription) {
        const endpoint = subscription.endpoint;
        const truncated = endpoint.substring(0, 60) + "...";
        const expiration = subscription.expirationTime ? new Date(subscription.expirationTime).toLocaleString() : "Mai";
        setPushSubscription({
          status: "success",
          message: "Subscription attiva",
          details: `Endpoint: ${truncated}
Scadenza: ${expiration}`
        });
      } else {
        setPushSubscription({
          status: "warning",
          message: "Nessuna subscription",
          details: "Utente non iscritto alle push"
        });
      }
    } catch (error) {
      setPushSubscription({
        status: "error",
        message: "Errore verifica subscription",
        details: error.message
      });
    }
  };
  const checkEdgeFunction = async () => {
    setEdgeFunction({ status: "loading", message: "Verifica edge function..." });
    try {
      const response = await fetch(
        `${functionsBaseUrl}/webpush-send`,
        {
          method: "OPTIONS",
          headers: {
            "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZranJxaXJ2ZHZqYmVtc2Z6eG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQyMjYsImV4cCI6MjA2MDYxMDIyNn0.rb0F3dhKXwb_110--08Jsi4pt_jx-5IWwhi96eYMxBk"
          }
        }
      );
      if (response.ok || response.status === 204) {
        setEdgeFunction({
          status: "success",
          message: "Edge Function disponibile",
          details: `Status: ${response.status}`
        });
      } else {
        setEdgeFunction({
          status: "warning",
          message: "Edge Function risponde",
          details: `Status: ${response.status}`
        });
      }
    } catch (error) {
      setEdgeFunction({
        status: "error",
        message: "Edge Function non raggiungibile",
        details: error.message
      });
    }
  };
  const checkAdminToken = () => {
    setAdminToken({ status: "loading", message: "Verifica admin token..." });
    const hasAdminTokenLogic = typeof window !== "undefined";
    if (hasAdminTokenLogic) {
      setAdminToken({
        status: "success",
        message: "Logica admin token presente",
        details: "Il codice prevede header x-admin-token (valore non esposto)"
      });
    } else {
      setAdminToken({
        status: "warning",
        message: "Verifica non conclusiva",
        details: "Ambiente non supportato"
      });
    }
  };
  const checkDbAccess = async () => {
    setDbAccess({ status: "loading", message: "Verifica accesso DB..." });
    try {
      const { count, error } = await supabase.from("webpush_subscriptions").select("*", { count: "exact", head: true });
      if (error) {
        setDbAccess({
          status: "warning",
          message: "Accesso DB limitato",
          details: `RLS: ${error.message}`
        });
        return;
      }
      const { data: subs, error: selectError } = await supabase.from("webpush_subscriptions").select("created_at, user_id, endpoint").order("created_at", { ascending: false }).limit(5);
      if (selectError) {
        setDbAccess({
          status: "warning",
          message: `${count ?? 0} subscriptions (no SELECT)`,
          details: "RLS blocca SELECT"
        });
      } else {
        const subsCount = subs?.length ?? 0;
        setDbAccess({
          status: "success",
          message: `${count ?? 0} subscriptions totali`,
          details: `Ultime ${subsCount} visibili`
        });
      }
    } catch (error) {
      setDbAccess({
        status: "error",
        message: "Errore accesso DB",
        details: error.message
      });
    }
  };
  const getStatusIcon = (status) => {
    switch (status) {
      case "loading":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "h-5 w-5 animate-spin text-blue-500" });
      case "success":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "h-5 w-5 text-green-500" });
      case "warning":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "h-5 w-5 text-yellow-500" });
      case "error":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "h-5 w-5 text-red-500" });
      default:
        return null;
    }
  };
  const getStatusBadge = (status) => {
    const variants = {
      idle: "secondary",
      loading: "secondary",
      success: "default",
      warning: "secondary",
      error: "destructive"
    };
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: variants[status], className: "ml-2", children: status === "loading" ? "Verifica..." : status.toUpperCase() });
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-b from-background to-background/80 p-4 pb-24", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold mb-2", children: "Push Auto-Preflight" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Verifica stato catena notifiche push (solo lettura)" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Web Push Health" }),
          getStatusBadge(notificationPermission.status)
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Stato permessi e Service Worker" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
          getStatusIcon(notificationPermission.status),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium", children: notificationPermission.message }),
            notificationPermission.details && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mt-1", children: notificationPermission.details })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
          getStatusIcon(serviceWorker.status),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium", children: serviceWorker.message }),
            serviceWorker.details && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mt-1 break-all", children: serviceWorker.details })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
          getStatusIcon(pushSubscription.status),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium", children: pushSubscription.message }),
            pushSubscription.details && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mt-1 whitespace-pre-wrap break-all", children: pushSubscription.details })
          ] })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Edge Function Availability" }),
          getStatusBadge(edgeFunction.status)
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Verifica /functions/v1/webpush-send" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
        getStatusIcon(edgeFunction.status),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium", children: edgeFunction.message }),
          edgeFunction.details && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mt-1", children: edgeFunction.details })
        ] })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Admin Token Presence" }),
          getStatusBadge(adminToken.status)
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Verifica logica client-side (no values)" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
        getStatusIcon(adminToken.status),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium", children: adminToken.message }),
          adminToken.details && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mt-1", children: adminToken.details })
        ] })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Database Access" }),
          getStatusBadge(dbAccess.status)
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Accesso webpush_subscriptions (se RLS permette)" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
        getStatusIcon(dbAccess.status),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium", children: dbAccess.message }),
          dbAccess.details && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mt-1", children: dbAccess.details })
        ] })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Quiet Hours (Mock)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Finestra consigliata per invii automatici" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 text-sm", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Orario consigliato:" }),
          " 09:00 – 20:00 (locale)"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Max push/utente/giorno:" }),
          " 3-5"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Cooldown minimo:" }),
          " 2-4 ore tra invii"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground mt-4", children: "⚠️ Queste sono linee guida suggerite. L'implementazione effettiva richiede logica server-side separata." })
      ] }) })
    ] })
  ] }) });
};

const PanelAccessPage = () => {
  const { user } = useUnifiedAuth();
  const { profileImage } = useProfileImage();
  const { isWhitelisted, isValidating, accessDeniedReason } = usePanelAccessProtection();
  const [currentView, setCurrentView] = reactExports.useState("home");
  const [, setLocation] = useLocation();
  const { isAdmin } = useAdminCheck(false);
  const hasAccess = isWhitelisted;
  if (!isWhitelisted) {
    if (isValidating) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Spinner, { className: "h-12 w-12 text-[#4361ee] mx-auto mb-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-lg font-semibold", children: "Validazione Accesso M1SSION PANEL™" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm mt-2", children: "Verifica clearance in corso..." })
      ] }) });
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center max-w-md", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-16 h-16 text-red-500 mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-red-500 mb-2", children: "⛔ Accesso Negato" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 mb-4", children: "Solo gli amministratori possono accedere a questa pagina" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/50 p-4 rounded-lg text-left text-xs font-mono", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-red-400 mb-2", children: "Debug Info:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-300", children: [
          "Email: ",
          user?.email
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-300", children: [
          "Motivo: ",
          accessDeniedReason
        ] })
      ] })
    ] }) });
  }
  if (currentView === "ai-generator" && hasAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - AI Generator" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "px-4 py-8",
          style: {
            paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
            paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4 mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setCurrentView("home"),
                className: "text-gray-400 hover:text-white transition-colors",
                children: "← Torna al Panel"
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AIContentGenerator, { onBack: () => setCurrentView("home") })
          ] })
        }
      )
    ] });
  }
  if (currentView === "mission-control" && hasAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - Mission Control" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "px-4 py-8",
          style: {
            paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
            paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4 mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setCurrentView("home"),
                className: "text-gray-400 hover:text-white transition-colors",
                children: "← Torna al Panel"
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(MissionControlPanel, { onBack: () => setCurrentView("home") })
          ] })
        }
      )
    ] });
  }
  if (currentView === "mission-reset" && hasAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - Reset Missione" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "px-4 py-8",
          style: {
            paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
            paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4 mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setCurrentView("home"),
                className: "text-gray-400 hover:text-white transition-colors",
                children: "← Torna al Panel"
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(MissionResetSection, {})
          ] })
        }
      )
    ] });
  }
  if (currentView === "mission-config" && hasAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - Config Missione" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "px-4 py-8",
          style: {
            paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
            paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4 mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setCurrentView("home"),
                className: "text-gray-400 hover:text-white transition-colors",
                children: "← Torna al Panel"
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(MissionConfigSection, {})
          ] })
        }
      )
    ] });
  }
  if (currentView === "qr-control" && hasAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - QR Control" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "px-4 py-8",
          style: {
            paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
            paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4 mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setCurrentView("home"),
                className: "text-gray-400 hover:text-white transition-colors",
                children: "← Torna al Panel"
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(QRControlPanel, {})
          ] })
        }
      )
    ] });
  }
  if (currentView === "push-center" && hasAccess && isAdmin) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - Push Center" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "px-4 py-8",
          style: {
            paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
            paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-8", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: () => setCurrentView("home"),
                  className: "text-gray-400 hover:text-white transition-colors",
                  children: "← Torna al Panel"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white", children: "📡 Push Center" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(PushCenterCard, {})
          ] })
        }
      )
    ] });
  }
  if (currentView === "marker-rewards" && hasAccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - Marker Reward Manager" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "px-4 py-8",
          style: {
            paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
            paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4 mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setCurrentView("home"),
                className: "text-gray-400 hover:text-white transition-colors",
                children: "← Torna al Panel"
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(MarkerRewardManager, {})
          ] })
        }
      )
    ] });
  }
  if ((currentView === "push-control" || currentView === "push-sender") && hasAccess && isAdmin) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - Push Control" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "px-4 py-8",
          style: {
            paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
            paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4 mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setCurrentView("home"),
                className: "text-gray-400 hover:text-white transition-colors",
                children: "← Torna al Panel"
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(PushControlPanelPage, {})
          ] })
        }
      )
    ] });
  }
  if (currentView === "push-preflight" && hasAccess && isAdmin) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - Push Preflight" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "px-4 py-8",
          style: {
            paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
            paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
          },
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4 mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => setCurrentView("home"),
                className: "text-gray-400 hover:text-white transition-colors",
                children: "← Torna al Panel"
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(PushAutoPreflightPage, {})
          ] })
        }
      )
    ] });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Helmet, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - Centro di Comando" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("meta", { name: "description", content: "Centro di comando blindato per operazioni M1SSION™" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "px-4 py-12",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0, y: 20 },
              animate: { opacity: 1, y: 0 },
              transition: { duration: 0.5 },
              className: "text-center mb-16",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "text-4xl md:text-6xl font-bold mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "bg-gradient-to-r from-[#4361ee] to-[#7209b7] bg-clip-text text-transparent", children: "M1SSION PANEL" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top text-[#7209b7]", children: "™" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-lg", children: "Centro AI Generativo per Test Interni" })
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0, scale: 0.95 },
              animate: { opacity: 1, scale: 1 },
              transition: { delay: 0.3, duration: 0.5 },
              className: "space-y-6",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-6 border border-green-500/30", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 mb-4", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-6 h-6 text-green-400" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl font-semibold text-green-400", children: "🔐 Accesso Autorizzato - Blindatura Attiva" })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Utente Autorizzato:" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-green-400 font-mono", children: user?.email })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Clearance:" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#4361ee] font-semibold", children: "MAXIMUM SECURITY" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Protezione:" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-green-400 font-semibold", children: "SHA-256 VERIFIED ✓" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400", children: "Sessione:" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-green-400 font-semibold", children: "TRACKING ATTIVO" })
                    ] })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-6", children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushCenter, {}) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid gap-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setCurrentView("ai-generator"),
                      className: "glass-card p-4 border border-[#4361ee]/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "AI Content Generator" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Generazione automatica di indizi e contenuti" })
                        ] })
                      ] })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setCurrentView("mission-control"),
                      className: "glass-card p-4 border border-[#7209b7]/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-[#7209b7] to-[#4361ee] flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "Mission Control" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Controllo avanzato delle missioni attive" })
                        ] })
                      ] })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setCurrentView("mission-reset"),
                      className: "glass-card p-4 border border-red-500/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-red-600 to-red-500 flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "Reset Missione™" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Riavvia completamente la missione corrente" })
                        ] })
                      ] })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setCurrentView("mission-config"),
                      className: "glass-card p-4 border border-emerald-500/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-emerald-600 to-emerald-500 flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Cpu, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "Mission Config" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Configurazione parametri missione" })
                        ] })
                      ] })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setLocation("/panel-users"),
                      className: "glass-card p-4 border border-purple-500/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-purple-600 to-purple-500 flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "Users (Realtime)" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Lista utenti con aggiornamenti in tempo reale" })
                        ] })
                      ] })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setCurrentView("qr-control"),
                      className: "glass-card p-4 border border-cyan-500/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-cyan-600 to-cyan-500 flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(QrCode, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "QR Control Panel" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Gestione QR codes e marker" })
                        ] })
                      ] })
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setCurrentView("marker-rewards"),
                      className: "glass-card p-4 border border-emerald-500/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-emerald-600 to-cyan-500 flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Gift, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "🎯 Marker Reward Manager" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Gestione completa marker con mappa interattiva, M1U, Indizi, Premi Fisici" })
                        ] })
                      ] })
                    }
                  ),
                  isAdmin && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setCurrentView("push-center"),
                      className: "glass-card p-4 border border-[#4361ee]/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-[#4361ee] to-[#7209b7] flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "📡 Push Center" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Invio + Debug + Subscriptions + Logs" })
                        ] })
                      ] })
                    }
                  ),
                  isAdmin && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setCurrentView("push-control"),
                      className: "glass-card p-4 border border-orange-500/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-orange-600 to-red-500 flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "🚀 Push Control Panel" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Invio notifiche push avanzato" })
                        ] })
                      ] })
                    }
                  ),
                  isAdmin && PUSH_PREFLIGHT_ENABLED,
                  isAdmin && /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      whileHover: { scale: 1.02 },
                      whileTap: { scale: 0.98 },
                      onClick: () => setLocation("/panel/push-sender"),
                      className: "glass-card p-4 border border-blue-500/30 cursor-pointer group",
                      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 rounded-lg bg-gradient-to-r from-blue-600 to-cyan-500 flex items-center justify-center group-hover:scale-110 transition-transform", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-6 h-6 text-white" }) }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white", children: "📤 Push Sender" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm", children: "Invio rapido Broadcast/Targeted/Self" })
                        ] })
                      ] })
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center pt-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-500", children: "M1SSION PANEL™ - Versione Blindata v3.0.0 - © 2025 Joseph MULÉ" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-green-600 mt-1", children: "🔐 Sistema Anti-Infiltrazione Attivo" })
                ] })
              ]
            }
          )
        ] })
      }
    )
  ] });
};

function PushDiagnosi() {
  const { user } = useAuth();
  const [isRunning, setIsRunning] = reactExports.useState(false);
  const [results, setResults] = reactExports.useState([]);
  const [summary, setSummary] = reactExports.useState({
    success: 0,
    warnings: 0,
    errors: 0
  });
  const runDiagnostics = async () => {
    setResults([]);
    setSummary({ success: 0, warnings: 0, errors: 0 });
    setIsRunning(true);
    const newResults = [];
    try {
      newResults.push({
        step: "1/10",
        status: "success",
        message: "Controllo supporto Push API",
        details: "Verifica se il browser supporta le notifiche push..."
      });
      if (!("Notification" in window)) {
        newResults.push({
          step: "1/10",
          status: "error",
          message: "Push API non supportato",
          details: "Il tuo browser non supporta le notifiche push"
        });
        setResults(newResults);
        return;
      }
      if (!("serviceWorker" in navigator)) {
        newResults.push({
          step: "1/10",
          status: "error",
          message: "Service Worker non supportato",
          details: "Il tuo browser non supporta i Service Workers"
        });
        setResults(newResults);
        return;
      }
      newResults.push({
        step: "1/10",
        status: "success",
        message: "✓ Push API supportato",
        details: "Browser compatibile con notifiche push"
      });
      const permission = Notification.permission;
      if (permission === "denied") {
        newResults.push({
          step: "2/10",
          status: "error",
          message: "✗ Permesso negato",
          details: "Le notifiche sono bloccate. Vai nelle impostazioni del browser per abilitarle."
        });
      } else if (permission === "default") {
        newResults.push({
          step: "2/10",
          status: "warning",
          message: "⚠ Permesso non richiesto",
          details: 'Usa il bottone "Ripara notifiche" per richiedere il permesso'
        });
      } else {
        newResults.push({
          step: "2/10",
          status: "success",
          message: "✓ Permesso concesso",
          details: `Stato permesso: ${permission}`
        });
      }
      const registrations = await navigator.serviceWorker.getRegistrations();
      const mainReg = registrations.find((r) => r.active?.scriptURL.includes("/sw.js"));
      if (registrations.length === 0) {
        newResults.push({
          step: "3/10",
          status: "warning",
          message: "⚠ Nessun SW registrato",
          details: 'Usa "Ripara notifiche" per registrare /sw.js'
        });
      } else if (registrations.length > 1) {
        newResults.push({
          step: "3/10",
          status: "warning",
          message: `⚠ ${registrations.length} SW registrati`,
          details: "Rilevati SW multipli. Consigliato mantenere solo /sw.js"
        });
      } else if (mainReg) {
        newResults.push({
          step: "3/10",
          status: "success",
          message: "✓ SW corretto attivo",
          details: `Scope: ${mainReg.scope}, State: ${mainReg.active?.state}`
        });
      } else {
        newResults.push({
          step: "3/10",
          status: "error",
          message: "✗ SW non corretto",
          details: `SW attivo: ${registrations[0]?.active?.scriptURL || "unknown"}`
        });
      }
      try {
        const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await __vitePreload(async () => { const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await import('./vapid-loader.Dvqe_4zt.js');return { loadVAPIDPublicKey, urlBase64ToUint8Array }},true?[]:void 0);
        const vapidKey = await loadVAPIDPublicKey();
        const vapidArray = urlBase64ToUint8Array(vapidKey);
        newResults.push({
          step: "4/10",
          status: "success",
          message: "✓ VAPID key valida",
          details: `Length: ${vapidArray.length} bytes, Prefix: 0x${vapidArray[0].toString(16)}`
        });
      } catch (error) {
        newResults.push({
          step: "4/10",
          status: "error",
          message: "✗ VAPID key non valida",
          details: error.message
        });
        setResults(newResults);
        return;
      }
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.access_token) {
        newResults.push({
          step: "5/10",
          status: "error",
          message: "✗ JWT mancante",
          details: "Sessione non valida. Effettua il login."
        });
        setResults(newResults);
        return;
      }
      newResults.push({
        step: "5/10",
        status: "success",
        message: "✓ JWT presente",
        details: `User ID: ${session.user?.id?.substring(0, 8)}...`
      });
      const reg = await navigator.serviceWorker.ready;
      const subscription = await reg.pushManager.getSubscription();
      if (!subscription) {
        newResults.push({
          step: "6/10",
          status: "warning",
          message: "⚠ Nessuna subscription",
          details: 'Usa "Ripara notifiche" per creare una subscription'
        });
      } else {
        const platform = subscription.endpoint.includes("web.push.apple.com") ? "iOS" : "Web";
        newResults.push({
          step: "6/10",
          status: "success",
          message: "✓ Subscription presente",
          details: `Platform: ${platform}, Endpoint: ${subscription.endpoint.substring(0, 50)}...`
        });
      }
      try {
        const testBody = subscription ? {
          endpoint: subscription.endpoint,
          keys: subscription.toJSON().keys,
          provider: "webpush",
          platform: subscription.endpoint.includes("web.push.apple.com") ? "ios" : "web",
          ua: navigator.userAgent
        } : { test: true };
        const { data, error } = await supabase.functions.invoke("webpush-upsert", {
          body: testBody
        });
        if (error) {
          newResults.push({
            step: "7/10",
            status: "error",
            message: "✗ Errore backend",
            details: error.message
          });
        } else {
          newResults.push({
            step: "7/10",
            status: "success",
            message: "✓ Backend raggiungibile",
            details: `Response OK`
          });
        }
      } catch (error) {
        newResults.push({
          step: "7/10",
          status: "error",
          message: "✗ Errore connessione",
          details: error.message
        });
      }
      try {
        const { count, error } = await supabase.from("webpush_subscriptions").select("*", { count: "exact", head: true }).eq("user_id", user?.id || "").eq("is_active", true);
        if (error) {
          newResults.push({
            step: "8/10",
            status: "warning",
            message: "⚠ Errore query database",
            details: error.message
          });
        } else {
          newResults.push({
            step: "8/10",
            status: count && count > 0 ? "success" : "warning",
            message: count && count > 0 ? "✓ Subscriptions attive" : "⚠ Nessuna subscription nel DB",
            details: `Count: ${count || 0}`
          });
        }
      } catch (error) {
        newResults.push({
          step: "8/10",
          status: "warning",
          message: "⚠ Query non eseguita",
          details: error.message
        });
      }
      const isIOSSafari = navigator.userAgent.includes("Safari") && !navigator.userAgent.includes("Chrome") && /iPhone|iPad|iPod/.test(navigator.userAgent);
      const isPWA = window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
      let platformStatus = "success";
      let platformMessage = "✓ Piattaforma supportata";
      let platformDetails = `Browser: ${navigator.userAgent.substring(0, 50)}...`;
      if (isIOSSafari && !isPWA) {
        platformStatus = "warning";
        platformMessage = "⚠ iOS Safari";
        platformDetails = "Su iOS Safari, installa l'app alla Home Screen (PWA) per ricevere notifiche (iOS 16.4+)";
      }
      newResults.push({
        step: "9/10",
        status: platformStatus,
        message: platformMessage,
        details: platformDetails
      });
      newResults.push({
        step: "10/10",
        status: "success",
        message: "✓ Diagnosi completata",
        details: "Controlla i risultati sopra per eventuali problemi"
      });
    } catch (error) {
      newResults.push({
        step: "ERROR",
        status: "error",
        message: "✗ Errore durante la diagnosi",
        details: error.message
      });
    } finally {
      setResults(newResults);
      setIsRunning(false);
      const successCount = newResults.filter((r) => r.status === "success").length;
      const warningCount = newResults.filter((r) => r.status === "warning").length;
      const errorCount = newResults.filter((r) => r.status === "error").length;
      setSummary({
        success: successCount,
        warnings: warningCount,
        errors: errorCount
      });
    }
  };
  reactExports.useEffect(() => {
    runDiagnostics();
  }, []);
  const getStatusIcon = (status) => {
    switch (status) {
      case "success":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-5 h-5 text-green-400" });
      case "error":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-5 h-5 text-red-400" });
      case "warning":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 text-yellow-400" });
    }
  };
  const getStatusBadge = (status) => {
    const colors = {
      success: "bg-green-500/20 text-green-400 border-green-500/50",
      error: "bg-red-500/20 text-red-400 border-red-500/50",
      warning: "bg-yellow-500/20 text-yellow-400 border-yellow-500/50"
    };
    return colors[status];
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Helmet, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION™ - Diagnosi Push Notifications" }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage: null }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "px-4 py-8",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0, y: 20 },
              animate: { opacity: 1, y: 0 },
              className: "mb-8",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold text-white mb-2", children: "🔍 Diagnosi Push Notifications" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400", children: "Controllo completo della configurazione push" })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Button,
                    {
                      onClick: () => window.location.href = "/panel-access",
                      variant: "outline",
                      className: "border-cyan-500/50 text-cyan-400",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(House, { className: "w-4 h-4 mr-2" }),
                        "Panel"
                      ]
                    }
                  )
                ] }),
                !isRunning && results.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: "bg-black/40 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-4", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-green-400" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium", children: summary.success }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400 text-sm", children: "Successi" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-4 h-4 text-yellow-400" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium", children: summary.warnings }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400 text-sm", children: "Warning" })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-4 h-4 text-red-400" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium", children: summary.errors }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400 text-sm", children: "Errori" })
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Button,
                    {
                      onClick: runDiagnostics,
                      variant: "outline",
                      size: "sm",
                      className: "border-cyan-500/50 text-cyan-400",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-4 h-4 mr-2" }),
                        "Riesegui"
                      ]
                    }
                  )
                ] }) }) })
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
            results.map((result, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                initial: { opacity: 0, x: -20 },
                animate: { opacity: 1, x: 0 },
                transition: { delay: index * 0.05 },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className: `bg-black/40 border ${result.status === "success" ? "border-green-500/30" : result.status === "error" ? "border-red-500/30" : "border-yellow-500/30"}`, children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-0.5", children: getStatusIcon(result.status) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Badge,
                        {
                          variant: "outline",
                          className: `text-xs ${getStatusBadge(result.status)}`,
                          children: result.step
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white font-medium", children: result.message })
                    ] }),
                    result.details && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm mt-1 break-words", children: result.details })
                  ] })
                ] }) }) })
              },
              index
            )),
            isRunning && /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                className: "flex items-center justify-center py-8",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-8 h-8 animate-spin text-cyan-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "ml-3 text-white", children: "Esecuzione diagnosi..." })
                ]
              }
            )
          ] }),
          !isRunning && results.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              transition: { delay: 0.5 },
              className: "mt-8",
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/40 border-blue-500/30", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-blue-400 text-lg", children: "💡 Suggerimenti" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-2 text-sm", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-300", children: [
                    "• Se vedi errori o warning, usa il bottone ",
                    /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: '"Ripara notifiche"' }),
                    " nel Push Center"
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300", children: "• Su iOS Safari, installa l'app alla Home Screen (PWA) per abilitare le notifiche" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300", children: "• Se il permesso è negato, vai nelle impostazioni del browser per ripristinarlo" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-300", children: [
                    "• Mantieni attivo solo il Service Worker ",
                    /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "/sw.js" })
                  ] })
                ] })
              ] })
            }
          )
        ] })
      }
    )
  ] });
}

const Table = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative w-full overflow-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
  "table",
  {
    ref,
    className: cn("w-full caption-bottom text-sm", className),
    ...props
  }
) }));
Table.displayName = "Table";
const TableHeader = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx("thead", { ref, className: cn("[&_tr]:border-b", className), ...props }));
TableHeader.displayName = "TableHeader";
const TableBody = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "tbody",
  {
    ref,
    className: cn("[&_tr:last-child]:border-0", className),
    ...props
  }
));
TableBody.displayName = "TableBody";
const TableFooter = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "tfoot",
  {
    ref,
    className: cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    ),
    ...props
  }
));
TableFooter.displayName = "TableFooter";
const TableRow = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "tr",
  {
    ref,
    className: cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    ),
    ...props
  }
));
TableRow.displayName = "TableRow";
const TableHead = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "th",
  {
    ref,
    className: cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    ),
    ...props
  }
));
TableHead.displayName = "TableHead";
const TableCell = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "td",
  {
    ref,
    className: cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className),
    ...props
  }
));
TableCell.displayName = "TableCell";
const TableCaption = reactExports.forwardRef(({ className, ...props }, ref) => /* @__PURE__ */ jsxRuntimeExports.jsx(
  "caption",
  {
    ref,
    className: cn("mt-4 text-sm text-muted-foreground", className),
    ...props
  }
));
TableCaption.displayName = "TableCaption";

const UsersRealtimePanel = () => {
  const [profiles, setProfiles] = reactExports.useState([]);
  const [totalCount, setTotalCount] = reactExports.useState(0);
  const [isLoading, setIsLoading] = reactExports.useState(true);
  const [isLoadingMore, setIsLoadingMore] = reactExports.useState(false);
  const [error, setError] = reactExports.useState(null);
  const [hasMore, setHasMore] = reactExports.useState(true);
  const ITEMS_PER_PAGE = 50;
  const getDisplayName = (profile) => {
    if (profile.first_name && profile.last_name) {
      return `${profile.first_name} ${profile.last_name}`;
    }
    if (profile.full_name) {
      return profile.full_name;
    }
    return profile.email || "Utente sconosciuto";
  };
  const fetchData = reactExports.useCallback(async (offset = 0, isLoadMore = false) => {
    if (isLoadMore) {
      setIsLoadingMore(true);
    } else {
      setIsLoading(true);
      setError(null);
    }
    try {
      if (offset === 0) {
        const { count, error: countError } = await supabase.from("profiles").select("*", { head: true, count: "exact" });
        if (countError) {
          throw new Error(`Errore nel conteggio: ${countError.message}`);
        }
        setTotalCount(count || 0);
      }
      const { data, error: profilesError } = await supabase.from("profiles").select("id, first_name, last_name, full_name, referral_code, created_at, email").order("created_at", { ascending: false }).range(offset, offset + ITEMS_PER_PAGE - 1);
      if (profilesError) {
        throw new Error(`Errore nel caricamento profili: ${profilesError.message}`);
      }
      const newProfiles = data || [];
      if (offset === 0) {
        setProfiles(newProfiles);
      } else {
        setProfiles((prev) => [...prev, ...newProfiles]);
      }
      setHasMore(newProfiles.length === ITEMS_PER_PAGE);
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : "Errore sconosciuto";
      setError(errorMessage);
      console.error("Error fetching profiles:", err);
      if (!isLoadMore) {
        ue$1.error(`Errore nel caricamento dati: ${errorMessage}`);
      }
    } finally {
      setIsLoading(false);
      setIsLoadingMore(false);
    }
  }, []);
  const loadMore = reactExports.useCallback(() => {
    if (!isLoadingMore && hasMore) {
      fetchData(profiles.length, true);
    }
  }, [fetchData, profiles.length, isLoadingMore, hasMore]);
  const refreshData = reactExports.useCallback(() => {
    fetchData(0, false);
  }, [fetchData]);
  reactExports.useEffect(() => {
    fetchData();
    const channel = supabase.channel("realtime:profiles").on("postgres_changes", {
      event: "*",
      schema: "public",
      table: "profiles"
    }, (payload) => {
      console.log("Real-time profiles update:", payload);
      switch (payload.eventType) {
        case "INSERT":
          if (payload.new) {
            setProfiles((prev) => [payload.new, ...prev]);
            setTotalCount((prev) => prev + 1);
            ue$1.success("Nuovo utente registrato!");
          }
          break;
        case "UPDATE":
          if (payload.new) {
            setProfiles(
              (prev) => prev.map(
                (profile) => profile.id === payload.new.id ? { ...profile, ...payload.new } : profile
              )
            );
            ue$1.info("Profilo utente aggiornato");
          }
          break;
        case "DELETE":
          if (payload.old) {
            setProfiles(
              (prev) => prev.filter((profile) => profile.id !== payload.old.id)
            );
            setTotalCount((prev) => Math.max(0, prev - 1));
            ue$1.warning("Utente rimosso");
          }
          break;
      }
    }).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, [fetchData]);
  const handleDeleteUser = reactExports.useCallback(async (userId) => {
    try {
      setIsLoading(true);
      const { data, error: error2 } = await supabase.functions.invoke("admin-delete-user", {
        body: { user_id: userId }
      });
      if (error2 || !data?.success) {
        throw new Error(data?.error || error2?.message || "Delete failed");
      }
      setProfiles((prev) => prev.filter((profile) => profile.id !== userId));
      setTotalCount((prev) => Math.max(0, prev - 1));
      ue$1.success("Utente cancellato con successo");
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : "Errore sconosciuto";
      console.error("Error deleting user:", err);
      ue$1.error(`Errore nella cancellazione: ${errorMessage}`);
    } finally {
      setIsLoading(false);
    }
  }, []);
  const formatDate = (dateString) => {
    if (!dateString) return "Data non disponibile";
    try {
      return format(new Date(dateString), "dd/MM/yyyy HH:mm", { locale: it$2 });
    } catch {
      return "Data non valida";
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    Card,
    {
      className: "border-0",
      style: {
        background: "rgba(0, 0, 0, 0.05)",
        backdropFilter: "blur(40px)",
        WebkitBackdropFilter: "blur(40px)",
        borderRadius: "24px",
        boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "flex flex-row items-center justify-between space-y-0 pb-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2 text-lg font-semibold text-foreground", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Users, { className: "h-5 w-5 text-primary" }),
            "Utenti (Realtime)"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "secondary", className: "text-sm", children: [
              "Totale utenti: ",
              totalCount
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                variant: "outline",
                size: "sm",
                onClick: refreshData,
                disabled: isLoading,
                className: "h-8 w-8 p-0",
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: `h-4 w-4 ${isLoading ? "animate-spin" : ""}` })
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
          error && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 p-3 rounded-md bg-destructive/10 border border-destructive/20", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "h-4 w-4 text-destructive" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-destructive", children: error })
          ] }),
          isLoading && profiles.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: Array.from({ length: 5 }).map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(Skeleton, { className: "h-12 w-full" }, i)) }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "rounded-md border border-border", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Table, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(TableHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(TableRow, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableHead, { className: "text-foreground", children: "Nome" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableHead, { className: "text-foreground", children: "Referral Code" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableHead, { className: "text-foreground", children: "User ID" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableHead, { className: "text-foreground", children: "Data Iscrizione" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableHead, { className: "text-foreground", children: "Azioni" })
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(TableBody, { children: profiles.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(TableRow, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(TableCell, { colSpan: 5, className: "text-center py-8 text-muted-foreground", children: "Nessun utente trovato" }) }) : profiles.map((profile) => /* @__PURE__ */ jsxRuntimeExports.jsxs(TableRow, { className: "hover:bg-muted/50", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableCell, { className: "font-medium text-foreground", children: getDisplayName(profile) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableCell, { className: "text-foreground", children: profile.referral_code ? /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "font-mono text-xs", children: profile.referral_code }) : /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-muted-foreground text-sm", children: "N/A" }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableCell, { className: "font-mono text-xs text-muted-foreground", children: profile.id }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableCell, { className: "text-sm text-foreground", children: formatDate(profile.created_at) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(TableCell, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialog, { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTrigger, { asChild: true, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    Button,
                    {
                      variant: "destructive",
                      size: "sm",
                      className: "h-8 px-2",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "h-4 w-4 mr-1" }),
                        "Cancella"
                      ]
                    }
                  ) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogContent, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogHeader, { children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogTitle, { children: "Conferma cancellazione utente" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogDescription, { children: [
                        `Sei sicuro di voler cancellare l'utente "`,
                        getDisplayName(profile),
                        `"? Questa azione è irreversibile e eliminerà l'utente sia da auth.users che da public.profiles.`
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDialogFooter, { children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDialogCancel, { children: "Annulla" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        AlertDialogAction,
                        {
                          onClick: () => handleDeleteUser(profile.id),
                          className: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
                          children: "Cancella utente"
                        }
                      )
                    ] })
                  ] })
                ] }) })
              ] }, profile.id)) })
            ] }) }),
            hasMore && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center pt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                variant: "outline",
                onClick: loadMore,
                disabled: isLoadingMore,
                className: "min-w-[120px]",
                children: isLoadingMore ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "mr-2 h-4 w-4 animate-spin" }),
                  "Caricamento..."
                ] }) : "Carica altri 50"
              }
            ) }),
            !hasMore && profiles.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center pt-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-muted-foreground", children: [
              "Tutti i ",
              totalCount,
              " utenti sono stati caricati"
            ] }) })
          ] })
        ] })
      ]
    }
  );
};

const PanelUsersPage = () => {
  const { user } = useUnifiedAuth();
  const { profileImage } = useProfileImage();
  const { isWhitelisted, isValidating, accessDeniedReason } = usePanelAccessProtection();
  if (!isWhitelisted) {
    if (isValidating) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Spinner, { className: "h-12 w-12 text-[#4361ee] mx-auto mb-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white text-lg font-semibold", children: "Validazione Accesso M1SSION PANEL™" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-sm mt-2", children: "Verifica clearance in corso..." })
      ] }) });
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center max-w-md", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-16 h-16 text-red-500 mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-red-500 mb-2", children: "⛔ Accesso Negato" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 mb-4", children: "Solo gli amministratori possono accedere a questa pagina" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/50 p-4 rounded-lg text-left text-xs font-mono", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-red-400 mb-2", children: "Debug Info:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-300", children: [
          "Email: ",
          user?.email
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-gray-300", children: [
          "Motivo: ",
          accessDeniedReason
        ] })
      ] })
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-gradient-to-b from-[#070818] via-[#0a0d1f] to-[#070818]", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Helmet, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("title", { children: "M1SSION PANEL™ - Users (Realtime)" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("meta", { name: "description", content: "Gestione utenti con aggiornamenti in tempo reale - M1SSION PANEL™" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { profileImage }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "px-4 py-8",
        style: {
          paddingTop: "calc(72px + 47px + env(safe-area-inset-top, 0px))",
          paddingBottom: "calc(80px + env(safe-area-inset-bottom, 0px))"
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => window.history.back(),
                className: "text-gray-400 hover:text-white transition-colors",
                children: "← Torna al Panel"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white", children: "Users (Realtime)" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(UsersRealtimePanel, {})
        ] })
      }
    )
  ] });
};

async function createBulkMarkers(dist, opts) {
  const payload = {
    lat: dist.lat,
    lng: dist.lng,
    radiusMeters: dist.radiusMeters,
    count: dist.count,
    debug: false,
    dryRun: false
  };
  const res = await fetch(`${functionsBaseUrl}/create-random-markers`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });
  const data = await res.json().catch(() => ({ message: "Invalid JSON response from function" }));
  if (!res.ok) {
    return {
      ok: false,
      message: data && (data.error || data.message) || `Edge function error (${res.status})`
    };
  }
  return {
    ok: true,
    created: typeof data?.created === "number" ? data.created : void 0,
    message: data?.message ?? (payload.dryRun ? "Dry run completed" : "Markers created successfully")
  };
}

const calculateCodeHash = () => {
  const sourceCode = [
    "BulkMarkerDropComponent",
    "create-random-markers",
    "WouterRoutes",
    "MissionPanelPage"
  ].join("|");
  let hash = 0;
  for (let i = 0; i < sourceCode.length; i++) {
    const char = sourceCode.charCodeAt(i);
    hash = (hash << 5) - hash + char;
    hash = hash & hash;
  }
  return Math.abs(hash).toString(16).padStart(64, "0");
};
const BulkMarkerDropComponent = () => {
  const { toast } = useToast();
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [distributions, setDistributions] = reactExports.useState([
    { type: "buzz_free", count: 1 }
  ]);
  const [visibilityHours, setVisibilityHours] = reactExports.useState(24);
  const [bbox, setBbox] = reactExports.useState(null);
  const [response, setResponse] = reactExports.useState(null);
  const [userRole, setUserRole] = reactExports.useState("");
  const [jwtExpiry, setJwtExpiry] = reactExports.useState(null);
  const [securityHeaders, setSecurityHeaders] = reactExports.useState({
    version: "v1",
    codeHash: calculateCodeHash()
  });
  reactExports.useEffect(() => {
    const checkAuth = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (session?.access_token) {
          const payload = JSON.parse(atob(session.access_token.split(".")[1]));
          setJwtExpiry(payload.exp * 1e3);
          const { data: profile } = await supabase.from("profiles").select("role").eq("id", session.user.id).single();
          setUserRole(profile?.role?.toLowerCase() || "");
        }
      } catch (error) {
        console.error("Auth check failed:", error);
      }
    };
    checkAuth();
    const interval = setInterval(checkAuth, 3e4);
    return () => clearInterval(interval);
  }, []);
  const isAuthValid = userRole === "admin" || userRole === "owner";
  const jwtExpiresIn = jwtExpiry ? Math.max(0, jwtExpiry - Date.now()) : 0;
  const jwtWarning = jwtExpiresIn > 0 && jwtExpiresIn < 10 * 60 * 1e3;
  const handleSubmit = async () => {
    if (!isAuthValid) {
      toast({
        title: "Accesso Negato",
        description: "Solo admin/owner possono eseguire bulk drops",
        variant: "destructive"
      });
      return;
    }
    if (!distributions.length) {
      toast({
        title: "Errore",
        description: "Aggiungi almeno una distribuzione",
        variant: "destructive"
      });
      return;
    }
    for (const dist of distributions) {
      if (dist.type === "message" && (!dist.text || dist.text.trim().length === 0)) {
        toast({
          title: "Errore",
          description: "Tutti i marker di tipo 'Message' devono avere un testo",
          variant: "destructive"
        });
        return;
      }
      if (dist.type === "xp_points" && (!dist.points || dist.points < 1)) {
        toast({
          title: "Errore",
          description: "I marker XP Points devono avere almeno 1 punto",
          variant: "destructive"
        });
        return;
      }
      if (dist.count < 1) {
        toast({
          title: "Errore",
          description: "Tutti i marker devono avere quantità >= 1",
          variant: "destructive"
        });
        return;
      }
    }
    setIsLoading(true);
    setResponse(null);
    try {
      const apiPayload = {
        distributions: distributions.map((dist) => {
          if (dist.type === "message") return { type: "message", count: dist.count, text: dist.text };
          if (dist.type === "xp_points") return { type: "xp_points", count: dist.count, points: dist.points };
          return { type: "buzz_free", count: dist.count };
        }),
        visibilityHours
      };
      const result = await createBulkMarkers(apiPayload);
      setResponse(result);
      toast({
        title: "Successo",
        description: `Creati ${result.created || 0} marker`,
        variant: "default"
      });
    } catch (error) {
      console.error("Submit error:", error);
      const errorMsg = error instanceof Error ? error.message : "Errore sconosciuto";
      setResponse({
        error: errorMsg,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
      toast({
        title: "Errore",
        description: errorMsg,
        variant: "destructive"
      });
    } finally {
      setIsLoading(false);
    }
  };
  const addDistribution = () => {
    setDistributions([...distributions, { type: "buzz_free", count: 1 }]);
  };
  const removeDistribution = (index) => {
    if (distributions.length > 1) {
      setDistributions(distributions.filter((_, i) => i !== index));
    }
  };
  const updateDistribution = (index, field, value) => {
    const updated = [...distributions];
    updated[index] = { ...updated[index], [field]: value };
    setDistributions(updated);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "🔒 Security Status" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Role:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: isAuthValid ? "default" : "destructive", children: userRole || "unknown" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "JWT Status:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: jwtWarning ? "destructive" : "default", children: jwtExpiresIn > 0 ? `${Math.floor(jwtExpiresIn / 6e4)}m remaining` : "expired" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Version:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: securityHeaders.version })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Code Hash:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", className: "font-mono text-xs", children: [
            securityHeaders.codeHash.substring(0, 12),
            "..."
          ] })
        ] }),
        jwtWarning && /* @__PURE__ */ jsxRuntimeExports.jsx(Alert, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDescription, { children: "⚠️ JWT expires in less than 10 minutes. Consider refreshing your session." }) }),
        !isAuthValid && /* @__PURE__ */ jsxRuntimeExports.jsx(Alert, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDescription, { children: "❌ Access denied. Admin or Owner role required." }) })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "🎯 Bulk Marker Drop" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { className: "text-base font-medium", children: "Distributions" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2 mt-2", children: distributions.map((dist, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 p-3 border rounded", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                Select,
                {
                  value: dist.type,
                  onValueChange: (value) => updateDistribution(index, "type", value),
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(SelectTrigger, { className: "w-48", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectValue, {}) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(SelectContent, { children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "buzz_free", children: "Buzz Free" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "message", children: "Message" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SelectItem, { value: "xp_points", children: "XP Points" })
                    ] })
                  ]
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  type: "number",
                  min: "1",
                  max: "100",
                  value: dist.count,
                  onChange: (e) => updateDistribution(index, "count", parseInt(e.target.value) || 1),
                  className: "w-24",
                  placeholder: "Qty"
                }
              ),
              dist.type === "xp_points" && /* @__PURE__ */ jsxRuntimeExports.jsx(
                Input,
                {
                  type: "number",
                  min: "1",
                  max: "1000",
                  value: dist.points || 10,
                  onChange: (e) => updateDistribution(index, "points", parseInt(e.target.value) || 10),
                  className: "w-24",
                  placeholder: "XP"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  onClick: () => removeDistribution(index),
                  variant: "destructive",
                  size: "sm",
                  disabled: distributions.length <= 1,
                  children: "Remove"
                }
              )
            ] }),
            dist.type === "message" && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: `message-${index}`, className: "text-sm", children: "Messaggio" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Textarea,
                {
                  id: `message-${index}`,
                  value: dist.text || "",
                  onChange: (e) => updateDistribution(index, "text", e.target.value),
                  placeholder: "Inserisci il messaggio per questo marker...",
                  className: "min-h-[80px]",
                  maxLength: 500
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-gray-500 mt-1", children: [
                (dist.text || "").length,
                "/500 caratteri"
              ] })
            ] })
          ] }, index)) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: addDistribution, variant: "outline", size: "sm", className: "mt-2", children: "Add Distribution" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Separator$1, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "visibility", children: "Visibility Hours" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "visibility",
              type: "number",
              min: "1",
              value: visibilityHours,
              onChange: (e) => setVisibilityHours(parseInt(e.target.value) || 24),
              className: "w-32"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleSubmit,
            disabled: isLoading || !isAuthValid || jwtExpiresIn <= 0,
            className: "w-full",
            children: isLoading ? "Creando..." : "Crea Marker"
          }
        )
      ] })
    ] }),
    response && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "📊 Response Debug" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
        response?.httpStatus === 207 && /* @__PURE__ */ jsxRuntimeExports.jsx(Alert, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(AlertDescription, { children: [
          "⚠️ Parziale: ",
          response?.parsedResponse?.created || 0,
          " creati, ",
          response?.parsedResponse?.partial_failures || 0,
          " fallimenti, ",
          response?.parsedResponse?.errors?.length || 0,
          " errori"
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { className: "bg-muted p-4 rounded text-sm overflow-auto max-h-96", children: JSON.stringify(response, null, 2) })
      ] }) })
    ] })
  ] });
};

const BulkMarkerDropPage = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-4 md:px-8 py-6", children: /* @__PURE__ */ jsxRuntimeExports.jsx(BulkMarkerDropComponent, {}) });
};

const MarkerRewardsPage = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-background", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: "container mx-auto px-4 py-6 pb-24 pt-20", children: /* @__PURE__ */ jsxRuntimeExports.jsx(MarkerRewardManager, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(BottomNavigation, {})
  ] });
};

const UUID_REGEX = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
function normalizeUuid(input) {
  if (typeof input !== "string" || !input) return "";
  let cleaned = input.trim();
  cleaned = cleaned.replace(/^"+|"+$/g, "");
  cleaned = cleaned.replace(/^'+|'+$/g, "");
  cleaned = cleaned.trim();
  if (!UUID_REGEX.test(cleaned)) {
    return "";
  }
  return cleaned;
}
function generateNormalizedUuid() {
  const raw = crypto.randomUUID();
  return normalizeUuid(raw);
}

const ALLOWLIST = [
  /\.m1ssion\.pages\.dev$/i,
  /\.lovableproject\.com$/i,
  /\.lovable\.app$/i,
  /^localhost$/i,
  /^127\.0\.0\.1$/i
];
function isOriginAllowed(origin) {
  if (!origin) return false;
  try {
    const host = new URL(origin).hostname;
    return ALLOWLIST.some((pattern) => pattern.test(host));
  } catch {
    return false;
  }
}
function assertAllowedOrHint(origin) {
  if (!isOriginAllowed(origin)) {
    console.warn(
      "[Norah] Origin not allowlisted for Functions calls:",
      origin,
      "\nPlease use the app from https://*.m1ssion.pages.dev"
    );
  }
}
function getCurrentOrigin() {
  return typeof window !== "undefined" ? window.location.origin : "https://m1ssion.pages.dev";
}

const isPreview = typeof window !== "undefined" && window.location.hostname.includes("lovable");
const sleep = (ms) => new Promise((r) => setTimeout(r, ms));
function checkOrigin() {
  if (typeof window === "undefined") return;
  const origin = getCurrentOrigin();
  if (!isOriginAllowed(origin)) {
    assertAllowedOrHint(origin);
    throw new Error("Origin not allowed for Norah Functions. Please use *.m1ssion.pages.dev");
  }
}
function getClientId() {
  try {
    const key = "norah_cid";
    const stored = typeof localStorage !== "undefined" ? localStorage.getItem(key) : null;
    const valid = normalizeUuid(stored || "");
    if (valid) return valid;
    const fresh = generateNormalizedUuid();
    if (typeof localStorage !== "undefined") localStorage.setItem(key, fresh);
    return fresh;
  } catch {
    return generateNormalizedUuid();
  }
}
function isRetryable(err) {
  const msg = String(err?.message ?? err ?? "").toLowerCase();
  return [
    "failed to fetch",
    "failed to send",
    "networkerror",
    "aborterror",
    "operation was aborted",
    "network request failed"
  ].some((s) => msg.includes(s));
}
async function invokePOST(fn, body, phase) {
  checkOrigin();
  const corr = getClientId();
  const cleanCid = normalizeUuid(corr) || corr;
  if (!cleanCid) {
    console.warn("[NORAH2] Invalid client_id (UUID), cannot call", fn);
    throw new Error("Invalid client_id (UUID)");
  }
  const headers = { "x-norah-cid": cleanCid };
  const enrichedBody = { ...body || {}, client_id: cleanCid };
  let delay = 250;
  if (typeof localStorage !== "undefined" && localStorage.NORAH_DEBUG === "1") {
    console.debug("[NORAH] invokePOST call", {
      fn,
      phase,
      origin: window.location.origin,
      cid_raw: corr,
      cid_norm: cleanCid,
      bodyKeys: Object.keys(enrichedBody)
    });
  }
  for (let i = 0; i < 3; i++) {
    try {
      if (isPreview && i > 0) await sleep(400);
      const { data, error } = await supabase.functions.invoke(fn, {
        body: enrichedBody,
        headers
      });
      if (error) throw error;
      if (typeof localStorage !== "undefined" && localStorage.NORAH_DEBUG === "1") {
        console.debug("[NORAH] invokePOST response", {
          fn,
          status: "ok",
          preview: JSON.stringify(data).slice(0, 200)
        });
      }
      return data;
    } catch (e) {
      console.error(`[NORAH2 cid:${corr.slice(0, 8)}] ${fn} failed (attempt ${i + 1}/3):`, e?.message || e);
      if (!isRetryable(e) || i === 2) {
        console.error(`[NORAH2] ${fn} ❌`, e);
        throw e;
      }
      await sleep(delay);
      delay = Math.min(delay * 2, 800);
    }
  }
  throw new Error(`invokePOST fellthrough: ${fn}`);
}
async function getFunctionJSON(path, phase) {
  checkOrigin();
  const { getFunctionsUrl, getSupabaseAnonKey } = await __vitePreload(async () => { const { getFunctionsUrl, getSupabaseAnonKey } = await Promise.resolve().then(() => clientUtils);return { getFunctionsUrl, getSupabaseAnonKey }},true?void 0:void 0);
  const url = `${getFunctionsUrl()}/${path}`;
  const key = getSupabaseAnonKey();
  const corr = getClientId();
  const cleanCid = normalizeUuid(corr) || corr;
  if (typeof localStorage !== "undefined" && localStorage.NORAH_DEBUG === "1") {
    console.debug("[NORAH] getFunctionJSON call", {
      path,
      phase,
      base: functionsBase,
      origin: window.location.origin,
      cid_raw: corr,
      cid_norm: cleanCid
    });
  }
  let delay = 250;
  for (let i = 0; i < 3; i++) {
    try {
      if (isPreview && i > 0) await sleep(400);
      const res = await fetch(url, {
        method: "GET",
        headers: {
          "content-type": "application/json",
          "apikey": key,
          "authorization": `Bearer ${key}`,
          // Ensure UUID is always sent clean (no quotes)
          "x-norah-cid": cleanCid,
          "cache-control": "no-store",
          "pragma": "no-cache"
        },
        keepalive: true,
        mode: "cors"
      });
      if (!res.ok) {
        const text = await res.text();
        throw new Error(`HTTP ${res.status}: ${text}`);
      }
      const data = await res.json();
      if (typeof localStorage !== "undefined" && localStorage.NORAH_DEBUG === "1") {
        console.debug("[NORAH] getFunctionJSON response", {
          path,
          status: res.status,
          preview: JSON.stringify(data).slice(0, 200)
        });
      }
      return data;
    } catch (e) {
      console.error(`[NORAH2 cid:${corr}] ${path} failed (attempt ${i + 1}/3):`, e?.message || e);
      if (!isRetryable(e) || i === 2) {
        console.error(`[NORAH2] ${path} ❌`, e);
        throw e;
      }
      await sleep(delay);
      delay = Math.min(delay * 2, 800);
    }
  }
  throw new Error(`getFunctionJSON fellthrough: ${path}`);
}
async function norahIngest(payload) {
  try {
    const data = await invokePOST("norah-ingest", payload, "ingest");
    if (false) ;
    return data;
  } catch (error) {
    throw error;
  }
}
async function norahEmbed(payload) {
  try {
    const data = await invokePOST("norah-embed", payload, "embed");
    if (false) ;
    return data;
  } catch (error) {
    throw error;
  }
}
async function norahSearch(payload) {
  if (!payload.q || !payload.q.trim()) {
    return { ok: false, error: "empty-query", results: [], hits: [] };
  }
  try {
    const data = await invokePOST("norah-rag-search", payload, "rag");
    if (data?.results && !data?.hits) data.hits = data.results;
    if (false) ;
    return data;
  } catch (error) {
    throw error;
  }
}
async function norahKpis() {
  try {
    const data = await getFunctionJSON("norah-kpis", "kpi");
    if (false) ;
    return data;
  } catch (error) {
    throw error;
  }
}
async function downloadKPIs() {
  const data = await norahKpis();
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `norah-kpis-${(/* @__PURE__ */ new Date()).toISOString().replace(/[:.]/g, "-")}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function autoTag(text, existingTags = []) {
  const keywords = new Set(existingTags);
  const patterns = {
    push: /\b(push|notification|fcm|apns|vapid)\b/gi,
    buzz: /\b(buzz|map|area|radius|pricing)\b/gi,
    mission: /\b(mission|clue|indizio|treasure|final\s*shot)\b/gi,
    norah: /\b(norah|ai|rag|semantic|vector)\b/gi,
    security: /\b(security|guard|safe|cors|jwt|auth)\b/gi,
    payment: /\b(stripe|payment|checkout|subscription|tier)\b/gi,
    tech: /\b(edge\s*function|supabase|cloudflare|deno)\b/gi
  };
  for (const [tag, pattern] of Object.entries(patterns)) {
    if (pattern.test(text)) {
      keywords.add(tag);
    }
  }
  const words = text.toLowerCase().replace(/[^\w\s]/g, " ").split(/\s+/).filter((w) => w.length > 4 && !["the", "and", "for", "with", "that", "this", "from"].includes(w));
  const freq = /* @__PURE__ */ new Map();
  words.forEach((w) => freq.set(w, (freq.get(w) || 0) + 1));
  const topWords = Array.from(freq.entries()).sort((a, b) => b[1] - a[1]).slice(0, 3).map(([w]) => w);
  topWords.forEach((w) => keywords.add(w));
  return Array.from(keywords).slice(0, 5);
}
function generateSummary(text) {
  const sentences = text.split(/[.!?]+/).filter((s) => s.trim().length > 20);
  if (sentences.length === 0) return "";
  let summary = "";
  let count = 0;
  for (const s of sentences) {
    if (count >= 5 || summary.length + s.length > 600) break;
    summary += `- ${s.trim()}
`;
    count++;
  }
  return summary ? `## TL;DR
${summary}
` : "";
}
async function dedupeKey(title, text) {
  const content = (title + text.slice(0, 200)).trim().toLowerCase();
  const encoder = new TextEncoder();
  const data = encoder.encode(content);
  const hash = await crypto.subtle.digest("SHA-256", data);
  return Array.from(new Uint8Array(hash)).map((b) => b.toString(16).padStart(2, "0")).join("");
}
async function sha256(text) {
  const encoder = new TextEncoder();
  const data = encoder.encode(text.trim().toLowerCase());
  const hash = await crypto.subtle.digest("SHA-256", data);
  return Array.from(new Uint8Array(hash)).map((b) => b.toString(16).padStart(2, "0")).join("");
}
function detectLanguage(text) {
  const itWords = ["il", "la", "di", "che", "e", "per", "con", "non", "una", "sono"];
  const enWords = ["the", "is", "and", "to", "of", "in", "for", "on", "with", "that"];
  const words = text.toLowerCase().split(/\s+/).slice(0, 100);
  const itCount = words.filter((w) => itWords.includes(w)).length;
  const enCount = words.filter((w) => enWords.includes(w)).length;
  return itCount > enCount ? "it" : "en";
}
function chunkText(text, maxChars = 3e3, overlapChars = 500) {
  const paragraphs = text.split(/\n\n+/).filter((p) => p.trim());
  const chunks = [];
  let currentChunk = "";
  for (const para of paragraphs) {
    if ((currentChunk + para).length > maxChars && currentChunk.length > 0) {
      chunks.push(currentChunk.trim());
      currentChunk = currentChunk.slice(-overlapChars) + "\n\n" + para;
    } else {
      currentChunk += (currentChunk ? "\n\n" : "") + para;
    }
  }
  if (currentChunk.trim()) {
    chunks.push(currentChunk.trim());
  }
  return chunks.length > 0 ? chunks : [text];
}
async function enrichDocument(doc) {
  const tags = autoTag(doc.text, doc.tags || []);
  const summary = generateSummary(doc.text);
  const language = doc.language || detectLanguage(doc.text);
  const hash = await sha256(doc.text);
  const key = await dedupeKey(doc.title, doc.text);
  const chunks = chunkText(doc.text).map((text, idx) => ({ idx, text }));
  return {
    ...doc,
    text: summary + doc.text,
    autoTags: tags,
    tags,
    language,
    sha256: hash,
    dedupeKey: key,
    summary,
    chunks
  };
}
function deduplicateDocuments(docs) {
  const seen = /* @__PURE__ */ new Set();
  const unique = [];
  for (const doc of docs) {
    if (doc.dedupeKey && seen.has(doc.dedupeKey)) continue;
    if (doc.dedupeKey) seen.add(doc.dedupeKey);
    unique.push(doc);
  }
  return unique;
}

function ContentSources() {
  const { toast } = useToast();
  const [activeTab, setActiveTab] = reactExports.useState("files");
  const [urlList, setUrlList] = reactExports.useState("");
  const [sitemapUrl, setSitemapUrl] = reactExports.useState("");
  const [loading, setLoading] = reactExports.useState(false);
  const [candidates, setCandidates] = reactExports.useState([]);
  const [selected, setSelected] = reactExports.useState(/* @__PURE__ */ new Set());
  const handleFileSelect = async (e) => {
    const files = Array.from(e.target.files || []);
    setLoading(true);
    try {
      const docs = [];
      for (const file of files) {
        const text = await file.text();
        const raw = {
          title: file.name.replace(/\.(md|mdx|html|txt)$/i, ""),
          text,
          tags: [],
          source: "kb",
          url: `file://${file.name}`,
          language: "it",
          updatedAt: (/* @__PURE__ */ new Date()).toISOString()
        };
        const enriched = await enrichDocument(raw);
        docs.push(enriched);
      }
      const deduped = deduplicateDocuments(docs);
      setCandidates((prev) => [...prev, ...deduped]);
      setSelected(new Set(Array.from({ length: deduped.length }, (_, i) => candidates.length + i)));
      toast({
        title: "✅ Files Loaded",
        description: `${deduped.length} documents ready (${docs.length - deduped.length} duplicates removed)`
      });
    } catch (error) {
      toast({ title: "❌ File Load Failed", description: error.message, variant: "destructive" });
    } finally {
      setLoading(false);
    }
  };
  const handleUrlLoad = async () => {
    const urls = urlList.split("\n").filter((u) => u.trim() && u.startsWith("http"));
    if (urls.length === 0) {
      toast({ title: "⚠️ No URLs", description: "Enter valid URLs (one per line)", variant: "destructive" });
      return;
    }
    setLoading(true);
    try {
      const docs = [];
      for (const url of urls) {
        try {
          const response = await fetch(url);
          const html = await response.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");
          doc.querySelectorAll("script, style, nav, footer").forEach((el) => el.remove());
          const text = doc.body.textContent?.trim() || "";
          if (text.length < 100) continue;
          const raw = {
            title: doc.title || new URL(url).pathname.split("/").pop() || "Untitled",
            text,
            tags: [],
            source: "site",
            url,
            language: "it",
            updatedAt: (/* @__PURE__ */ new Date()).toISOString()
          };
          const enriched = await enrichDocument(raw);
          docs.push(enriched);
        } catch (err) {
          console.warn(`Failed to fetch ${url}:`, err);
        }
      }
      const deduped = deduplicateDocuments([...candidates, ...docs]);
      setCandidates(deduped);
      setSelected(new Set(Array.from({ length: deduped.length }, (_, i) => i)));
      toast({
        title: "✅ URLs Loaded",
        description: `${docs.length} pages fetched from ${urls.length} URLs`
      });
    } catch (error) {
      toast({ title: "❌ URL Load Failed", description: error.message, variant: "destructive" });
    } finally {
      setLoading(false);
    }
  };
  const handleSitemapCrawl = async () => {
    if (!sitemapUrl.trim() || !sitemapUrl.startsWith("http")) {
      toast({ title: "⚠️ Invalid Sitemap", description: "Enter valid sitemap URL", variant: "destructive" });
      return;
    }
    setLoading(true);
    try {
      const response = await fetch(sitemapUrl);
      const xml = await response.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(xml, "application/xml");
      const urls = Array.from(doc.querySelectorAll("loc")).map((el) => el.textContent?.trim()).filter(Boolean);
      if (urls.length === 0) {
        toast({ title: "⚠️ Empty Sitemap", description: "No URLs found", variant: "destructive" });
        return;
      }
      const limitedUrls = urls.slice(0, 50);
      const docs = [];
      for (const url of limitedUrls) {
        try {
          const response2 = await fetch(url);
          const html = await response2.text();
          const parser2 = new DOMParser();
          const doc2 = parser2.parseFromString(html, "text/html");
          doc2.querySelectorAll("script, style, nav, footer").forEach((el) => el.remove());
          const text = doc2.body.textContent?.trim() || "";
          if (text.length < 100) continue;
          const raw = {
            title: doc2.title || new URL(url).pathname.split("/").pop() || "Untitled",
            text,
            tags: [],
            source: "sitemap",
            url,
            language: "it",
            updatedAt: (/* @__PURE__ */ new Date()).toISOString()
          };
          const enriched = await enrichDocument(raw);
          docs.push(enriched);
        } catch (err) {
          console.warn(`Failed to fetch ${url}:`, err);
        }
      }
      const deduped = deduplicateDocuments([...candidates, ...docs]);
      setCandidates(deduped);
      setSelected(new Set(Array.from({ length: deduped.length }, (_, i) => i)));
      toast({
        title: "✅ Sitemap Crawled",
        description: `${docs.length} pages from ${limitedUrls.length} URLs`
      });
    } catch (error) {
      toast({ title: "❌ Sitemap Crawl Failed", description: error.message, variant: "destructive" });
    } finally {
      setLoading(false);
    }
  };
  const toggleSelection = (index) => {
    setSelected((prev) => {
      const next = new Set(prev);
      if (next.has(index)) next.delete(index);
      else next.add(index);
      return next;
    });
  };
  const selectAll = () => setSelected(new Set(Array.from({ length: candidates.length }, (_, i) => i)));
  const clearAll = () => setSelected(/* @__PURE__ */ new Set());
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          variant: activeTab === "files" ? "default" : "outline",
          onClick: () => setActiveTab("files"),
          size: "sm",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-4 h-4 mr-2" }),
            "Files"
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          variant: activeTab === "urls" ? "default" : "outline",
          onClick: () => setActiveTab("urls"),
          size: "sm",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Link2, { className: "w-4 h-4 mr-2" }),
            "URLs"
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          variant: activeTab === "sitemap" ? "default" : "outline",
          onClick: () => setActiveTab("sitemap"),
          size: "sm",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Map$1, { className: "w-4 h-4 mr-2" }),
            "Sitemap"
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "font-orbitron", children: [
          activeTab === "files" && "File Picker",
          activeTab === "urls" && "URL List",
          activeTab === "sitemap" && "Sitemap Crawler"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardDescription, { children: [
          activeTab === "files" && "Upload Markdown, MDX, HTML, or TXT files",
          activeTab === "urls" && "Paste URLs (one per line)",
          activeTab === "sitemap" && "Enter sitemap URL (e.g., https://domain.com/sitemap.xml)"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        activeTab === "files" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "input",
          {
            type: "file",
            multiple: true,
            accept: ".md,.mdx,.html,.txt",
            onChange: handleFileSelect,
            className: "w-full text-sm text-muted-foreground file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90",
            disabled: loading
          }
        ) }),
        activeTab === "urls" && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Textarea,
            {
              value: urlList,
              onChange: (e) => setUrlList(e.target.value),
              placeholder: "https://example.com/page1\nhttps://example.com/page2",
              rows: 8,
              disabled: loading
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleUrlLoad, disabled: loading, children: [
            loading ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Upload, { className: "w-4 h-4 mr-2" }),
            "Load URLs"
          ] })
        ] }),
        activeTab === "sitemap" && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              value: sitemapUrl,
              onChange: (e) => setSitemapUrl(e.target.value),
              placeholder: "https://example.com/sitemap.xml",
              disabled: loading
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleSitemapCrawl, disabled: loading, children: [
            loading ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Map$1, { className: "w-4 h-4 mr-2" }),
            "Crawl Sitemap"
          ] })
        ] })
      ] })
    ] }),
    candidates.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between font-orbitron", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
            "Preview (",
            candidates.length,
            " documents)"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: selectAll, variant: "outline", size: "sm", children: "Select All" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: clearAll, variant: "outline", size: "sm", children: "Clear All" })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardDescription, { children: [
          selected.size,
          " selected • Auto-enriched with tags and summaries"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2 max-h-96 overflow-y-auto", children: candidates.map((doc, idx) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3 p-3 rounded-lg border bg-card", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Checkbox,
          {
            checked: selected.has(idx),
            onCheckedChange: () => toggleSelection(idx)
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-sm truncate", children: doc.title }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", className: "shrink-0", children: doc.source })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground mt-1 line-clamp-2", children: [
            doc.text.substring(0, 300),
            "..."
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-1 mt-2", children: doc.tags.slice(0, 5).map((tag, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-xs", children: tag }, i)) })
        ] })
      ] }, idx)) }) })
    ] })
  ] });
}

const useNorahStore = create$1((set) => ({
  selectedDocs: [],
  setSelectedDocs: (docs) => set({ selectedDocs: docs }),
  clearSelectedDocs: () => set({ selectedDocs: [] })
}));

const PROJECT_REF = getProjectRef$1();
getFunctionsUrl();
function generateM1SSIONKnowledgeBase() {
  const buzzMapDocs = [
    {
      title: "Buzz Map - Sistema Overview",
      text: `Il Buzz Map è il sistema centrale di M1SSION™ che permette agli agenti di scoprire indizi geolocalizzati tramite buzz virtuali. Il sistema utilizza Supabase Realtime per sincronizzare in tempo reale la posizione degli agenti e calcolare la distanza dai buzz attivi. Ogni buzz ha un radius di efficacia che varia in base al tier dell'utente (Silver: 500m, Gold: 1km, Black: 2km, Titanium: 5km). Il sistema supporta pricing dinamico basato su daily usage count.`,
      tags: ["buzz", "map", "geolocation", "realtime"],
      source: "synthetic",
      url: "m1ssion://buzz-map-overview"
    },
    {
      title: "Buzz Map - Pricing Dinamico",
      text: `Il pricing Buzz Map segue una logica a scaglioni: primi 10 buzz giornalieri €1.99, 11-20 €3.99, 21-30 €5.99, 31-40 €7.99, 41-50 €9.99. Oltre 50 buzz giornalieri il sistema blocca l'acquisto per prevenire abuse. Il contatore giornaliero si resetta alle 00:00 UTC. Gli utenti Premium (Gold+) ricevono 5 buzz gratuiti al giorno. Il calcolo avviene lato server tramite la function calculate_buzz_price(daily_count).`,
      tags: ["buzz", "pricing", "dynamic", "tiers"],
      source: "synthetic",
      url: "m1ssion://buzz-pricing"
    },
    {
      title: "Buzz Map - Radius Logic",
      text: `Il radius di efficacia del Buzz Map determina l'area in cui l'agente può rilevare indizi. Il calcolo avviene con la formula Haversine per distanza geografica precisa. Silver: radius base 500m, Gold: 1000m (+100% boost), Black: 2000m (+300%), Titanium: 5000m (+900%). Il sistema applica anche priority scoring: buzz più vicini ottengono score più alto. La funzione calculate_qr_distance(lat1,lng1,lat2,lng2) restituisce metri reali.`,
      tags: ["buzz", "radius", "geolocation", "haversine"],
      source: "synthetic",
      url: "m1ssion://buzz-radius"
    },
    {
      title: "Buzz Map - Supabase Realtime Integration",
      text: `Il Buzz Map usa Supabase Realtime per sincronizzare posizioni e buzz in tempo reale. Il client sottoscrive il channel "buzz-updates" e riceve eventi INSERT/UPDATE/DELETE sui buzz attivi. La subscription viene stabilita con supabase.channel('buzz-updates').on('postgres_changes', ...). Il sistema mantiene un local state cache per ridurre query e migliorare performance. Ogni aggiornamento trigger un re-render della mappa con nuovi marker.`,
      tags: ["buzz", "realtime", "supabase", "websocket"],
      source: "synthetic",
      url: "m1ssion://buzz-realtime"
    },
    {
      title: "Buzz Map - XP Rewards System",
      text: `Ogni buzz raccolto garantisce XP in base alla difficulty: Easy=10 XP, Medium=25 XP, Hard=50 XP. Gli XP contribuiscono al buzz_xp_progress (ogni 100 XP = 1 free Buzz credit) e al map_xp_progress (ogni 250 XP = 1 free Buzz Map credit). Il sistema usa la funzione award_xp(user_id, xp_amount, source) che calcola automaticamente le ricompense. Progress tracking in user_xp table.`,
      tags: ["buzz", "xp", "rewards", "gamification"],
      source: "synthetic",
      url: "m1ssion://buzz-xp"
    }
  ];
  const pushDocs = [
    {
      title: "Push SAFE Guard - Architecture Overview",
      text: `Il Push SAFE Guard è un sistema di sicurezza obbligatorio che previene hardcoded secrets nel codebase. Implementato in scripts/push-guard.cjs, esegue scan automatico di tutti i file .ts/.tsx/.js/.jsx prima di ogni build. Il Guard blocca il deploy se rileva: SUPABASE_URL hardcoded, SUPABASE_ANON_KEY, JWT tokens, project ref (${PROJECT_REF}), VAPID keys. Esegue via pnpm run prebuild nel package.json.`,
      tags: ["push", "guard", "security", "prebuild"],
      source: "synthetic",
      url: "m1ssion://push-guard-architecture"
    },
    {
      title: "Push SAFE Guard - VAPID Key Management",
      text: `Le VAPID keys sono gestite esclusivamente tramite src/lib/vapid-loader.ts che carica dinamicamente da environment variables. Il Guard verifica che nessun file contenga la stringa literal delle keys. Le keys sono: PUBLIC_VAPID_KEY (client-side, sicura) e PRIVATE_VAPID_KEY (server-only, mai esposta). Il sistema usa web-push library per generare notification tokens compatibili FCM/APNs.`,
      tags: ["push", "vapid", "security", "keys"],
      source: "synthetic",
      url: "m1ssion://push-vapid"
    },
    {
      title: "Push Notifications - iOS PWA Support",
      text: `iOS 16.4+ supporta Web Push in PWA via APNs. Il sistema rileva iOS con navigator.userAgent e attiva fallback custom per devices più vecchi. La subscription richiede user gesture (click button). Il service worker gestisce notificationclick con URL routing. Il sistema mantiene compatibilità con push_subscriptions table che mappa user_id -> endpoint -> p256dh/auth keys.`,
      tags: ["push", "ios", "pwa", "apns"],
      source: "synthetic",
      url: "m1ssion://push-ios"
    },
    {
      title: "Push Notifications - FCM Integration",
      text: `Firebase Cloud Messaging (FCM) è il backend per push Android e fallback web. Il sistema usa firebase-admin SDK lato server per inviare messaggi. La configurazione richiede FIREBASE_SERVICE_ACCOUNT_KEY (JSON) in Supabase secrets. Il message payload include: notification (title/body), data (custom fields), webpush (icon/badge/vibrate). Rate limit: 1000 msg/min per project.`,
      tags: ["push", "fcm", "firebase", "android"],
      source: "synthetic",
      url: "m1ssion://push-fcm"
    },
    {
      title: "Push Notifications - Vibration Patterns",
      text: `Il sistema haptics usa Vibration API per feedback tattile: navigator.vibrate([pattern]). Pattern standard: Buzz ricevuto=[200,100,200], Leaderboard update=[100,50,100,50,100], Prize won=[500,200,500,200,500]. iOS richiede webkit prefix. Il sistema detect support con "vibrate" in navigator. Fallback: visual animation se vibration non disponibile.`,
      tags: ["push", "haptics", "vibration", "ux"],
      source: "synthetic",
      url: "m1ssion://push-vibration"
    }
  ];
  const missionDocs = [
    {
      title: "Missions - Weekly Cycle Structure",
      text: `Le missioni M1SSION™ seguono un ciclo settimanale 1-4 che si ripete. Week 1: "L'Origine", Week 2: "Il Codice", Week 3: "La Rete", Week 4: "La Rivelazione". Ogni settimana ha clues progressivi che sbloccano step successivi. La logica è in missions_weeks table con start_date e end_date. Il sistema calcola current week con get_current_game_week() function che usa modulo 4.`,
      tags: ["mission", "weekly", "cycle", "structure"],
      source: "synthetic",
      url: "m1ssion://missions-weekly"
    },
    {
      title: "Missions - Clue Unlock Logic",
      text: `I clue sono bloccati con is_locked=true fino a soddisfare prerequisites. Unlock conditions: previous clue completato, data specifica raggiunta, tier premium attivo, mission progress checkpoint. Il sistema verifica con check_clue_access(user_id, clue_id) che ritorna boolean. Frontend mostra clue con blur effect se locked. Admin può force unlock tramite panel.`,
      tags: ["mission", "clue", "unlock", "logic"],
      source: "synthetic",
      url: "m1ssion://clue-unlock"
    },
    {
      title: "Missions - Antiforcing System",
      text: `L'antiforcing previene soluzioni brute-force con: rate limiting (max 2 tentativi Final Shot/giorno via daily_final_shot_limits table), cooldown 24h tra tentativi, penalty XP -50 per tentativo fallito, IP tracking per abuse detection. Il sistema log tutti i tentativi in agent_finalshot_attempts con coords/result. Admin monitoring via admin_logs.`,
      tags: ["mission", "antiforcing", "security", "ratelimit"],
      source: "synthetic",
      url: "m1ssion://antiforcing"
    },
    {
      title: "Final Shot - Activation Mechanics",
      text: `Il Final Shot si attiva quando: tutti clue settimanali completati, user ha tier Silver+, è dentro il radius target (calcolato con calculate_qr_distance), orario valido (no quiet hours). La verifica usa check_daily_final_shot_limit(user_id, mission_id) che ritorna boolean. Se attivo, frontend mostra "Final Shot Available" button con pulsating animation.`,
      tags: ["mission", "finalshot", "activation", "mechanics"],
      source: "synthetic",
      url: "m1ssion://finalshot-activation"
    },
    {
      title: "Prizes - Distribution Logic",
      text: `I premi sono distribuiti in base a: Final Shot success (prize_winner table), Weekly Leaderboard top 3 (weekly_leaderboard_winners), Referral milestones (referral_rewards). Il sistema usa calculate_access_start_date(plan) per early access: Silver=2h, Gold=24h, Black=48h, Titanium=72h prima del launch pubblico. Prize categories in prize_categories table.`,
      tags: ["prize", "distribution", "reward", "leaderboard"],
      source: "synthetic",
      url: "m1ssion://prize-distribution"
    }
  ];
  const schedulerDocs = [
    {
      title: "Scheduler - Daily Buzz Reset",
      text: `Il reset giornaliero buzz avviene alle 00:00 UTC via pg_cron job. Il job esegue: UPDATE user_credits SET daily_buzz_count=0; per tutti gli utenti. La configurazione è in Supabase SQL Editor con schedule '0 0 * * *'. Il sistema log l'esecuzione in cron_logs table. Fallback: client-side check al login con last_reset timestamp comparison.`,
      tags: ["scheduler", "cron", "buzz", "reset"],
      source: "synthetic",
      url: "m1ssion://scheduler-buzz-reset"
    },
    {
      title: "Scheduler - Leaderboard Snapshot",
      text: `Lo snapshot settimanale leaderboard avviene ogni Domenica 23:59 UTC con refresh_current_week_leaderboard() function. Il job copia top 100 da current_week_leaderboard a weekly_leaderboard_archive con week_id. Trigger notifiche push ai top 3. Il sistema usa materialized view per performance. Refresh manuale disponibile in admin panel.`,
      tags: ["scheduler", "leaderboard", "snapshot", "cron"],
      source: "synthetic",
      url: "m1ssion://scheduler-leaderboard"
    },
    {
      title: "Scheduler - Auto Push Notifications",
      text: `Il sistema auto-push usa notifier-engine Edge Function invocato ogni ora. Il job seleziona users con notification_preferences.enabled=true, filtra quiet hours (21:00-08:59), applica throttle (max 5 push/giorno), genera suggestions basate su user interests. Il template viene da auto_push_templates con weighted random selection. Log in auto_push_log table.`,
      tags: ["scheduler", "push", "notifications", "auto"],
      source: "synthetic",
      url: "m1ssion://scheduler-auto-push"
    },
    {
      title: "Norah AI - Content Refresh Cron",
      text: `Norah AI scheduler esegue crawl quotidiano alle 06:00 UTC e embed alle 07:00 UTC. Il sistema usa client-side interval checking con armed state. Crawl: fetch sitemap/URLs, parse content, enrichment auto (summary/tags/dedup), ingest batch 20. Embed: process pending chunks batch 200, Cloudflare AI @cf/baai/bge-base-en-v1.5 (768d). Scheduler UI mostra next run countdown.`,
      tags: ["norah", "scheduler", "crawl", "embed"],
      source: "synthetic",
      url: "m1ssion://norah-scheduler"
    }
  ];
  const securityDocs = [
    {
      title: "GDPR - Data Collection Policy",
      text: `M1SSION™ raccoglie: email (auth), location (solo quando Buzz Map attivo), device info (push tokens), usage analytics (eventi anonimizzati). Il consenso è richiesto al primo accesso. Users possono: richiedere export dati (JSON), richiedere cancellazione (GDPR right to be forgotten), opt-out analytics. Privacy policy in /privacy. Data retention: 2 anni post-account-deletion.`,
      tags: ["gdpr", "privacy", "data", "consent"],
      source: "synthetic",
      url: "m1ssion://gdpr-policy"
    },
    {
      title: "Security - Row Level Security (RLS)",
      text: `Tutte le tabelle Supabase hanno RLS enabled. Policy base: users vedono solo propri records (auth.uid() = user_id), admins vedono tutto (role='admin'). Eccezioni: public content (clues, missions), leaderboard (read-only public). Il sistema usa SECURITY DEFINER functions per operazioni privilegiate. RLS testing via supabase--linter tool.`,
      tags: ["security", "rls", "supabase", "auth"],
      source: "synthetic",
      url: "m1ssion://security-rls"
    },
    {
      title: "Security - API Rate Limiting",
      text: `Rate limiting implementato in api_rate_limits table: 100 req/min per IP, 1000 req/hour per user. Il sistema blocca IP con blocked_ips table (unblock_at timestamp). Abuse detection: >5 failed auth in 10min, >10 Final Shot attempts/hour, spam push subscription. Admin monitoring via admin_logs con event_type filtering.`,
      tags: ["security", "ratelimit", "abuse", "blocking"],
      source: "synthetic",
      url: "m1ssion://security-ratelimit"
    },
    {
      title: "Security - Push Token Management",
      text: `Push tokens sono encrypted at-rest in push_subscriptions table. Il sistema usa p256dh (public key) + auth (secret) per end-to-end encryption. Tokens scadono dopo 90 giorni inattività. Il sistema cleanup expired tokens con cron job settimanale. Re-subscription automatica se token expired durante send. VAPID keys rotazione ogni 6 mesi (manual admin task).`,
      tags: ["security", "push", "token", "encryption"],
      source: "synthetic",
      url: "m1ssion://security-push-tokens"
    }
  ];
  const troubleshootingDocs = [
    {
      title: "Troubleshooting - Push Non Arrivano",
      text: `Checklist push not received: 1) Verifica push_subscriptions ha record attivo per user, 2) Check notification_preferences.enabled=true, 3) Verifica quiet hours non attive, 4) Test VAPID keys valide, 5) Check service worker registered, 6) iOS: verify PWA installed a home screen, 7) Android: verify FCM token valido. Tool diagnostico: /panel/push-test endpoint.`,
      tags: ["troubleshooting", "push", "debug", "checklist"],
      source: "synthetic",
      url: "m1ssion://troubleshoot-push"
    },
    {
      title: "Troubleshooting - Buzz Map Non Carica",
      text: `Diagnosi Buzz Map issues: 1) Check Supabase Realtime subscription attiva (network tab), 2) Verify geolocation permission granted, 3) Check buzz_map_markers table ha records, 4) Test calculate_qr_distance function, 5) Verify user tier ha radius permission, 6) Clear browser cache, 7) Reload page force-refresh. Console deve mostrare "Buzz Map initialized" log.`,
      tags: ["troubleshooting", "buzz", "map", "realtime"],
      source: "synthetic",
      url: "m1ssion://troubleshoot-buzz-map"
    },
    {
      title: "Troubleshooting - Login Fallito",
      text: `Login failures debug: 1) Check auth.users table ha user email, 2) Verify email confirmed (confirm_at not null), 3) Test password reset flow, 4) Check blocked_ips non contiene user IP, 4) Verify Supabase anon key valida, 5) Test direct Supabase auth (bypass app), 6) Check browser cookies enabled. Error "Invalid login credentials" = password wrong or user not exists.`,
      tags: ["troubleshooting", "login", "auth", "debug"],
      source: "synthetic",
      url: "m1ssion://troubleshoot-login"
    },
    {
      title: "Troubleshooting - Norah RAG No Results",
      text: `Norah RAG empty results debug: 1) Check ai_docs_embeddings ha records (count > 0), 2) Verify embedding dimensione = 768, 3) Test query embedding generation (Cloudflare AI), 4) Check ai_rag_search_vec function exists, 5) Verify match_threshold non troppo alto (default 0.1), 6) Test query con keywords presenti in docs, 7) Check norah-rag-search logs per errors.`,
      tags: ["troubleshooting", "norah", "rag", "embedding"],
      source: "synthetic",
      url: "m1ssion://troubleshoot-norah"
    }
  ];
  const devDocs = [
    {
      title: "Dev Playbook - Deploy Pipeline",
      text: `Pipeline deploy: 1) pnpm run prebuild (Push SAFE Guard), 2) pnpm build (Vite bundle), 3) Supabase edge functions deploy (automatic), 4) pnpm test (Playwright E2E), 5) Deploy to Lovable staging, 6) Smoke test critical paths, 7) Deploy to production. Rollback: revert Git commit, redeploy previous build. CI/CD: GitHub Actions con auto-deploy su main branch.`,
      tags: ["dev", "deploy", "ci-cd", "pipeline"],
      source: "synthetic",
      url: "m1ssion://dev-deploy"
    },
    {
      title: "Dev Playbook - Database Migration",
      text: `Migration workflow: 1) Create SQL file in supabase/migrations/, 2) Test locally con Supabase CLI, 3) Run supabase db reset per clean state, 4) Verify RLS policies intact, 5) Deploy con supabase db push, 6) Run post-migration data fixes if needed, 7) Update types.ts con supabase gen types typescript. Never edit types.ts manually. Backup DB before major migrations.`,
      tags: ["dev", "database", "migration", "sql"],
      source: "synthetic",
      url: "m1ssion://dev-migration"
    },
    {
      title: "Dev Playbook - Edge Function Development",
      text: `Edge function dev: 1) Create in supabase/functions/<name>/index.ts, 2) Add to config.toml con verify_jwt setting, 3) Test locally con supabase functions serve, 4) Use Deno.env.get() per secrets, 5) Import shared code da ../_shared/, 6) Handle CORS con preflight, 7) Deploy con auto-push. NO hardcoded URLs/keys. Always use SERVICE_ROLE_KEY per admin operations.`,
      tags: ["dev", "edge-functions", "supabase", "deno"],
      source: "synthetic",
      url: "m1ssion://dev-edge-functions"
    }
  ];
  const allDocs = [
    ...buzzMapDocs,
    ...pushDocs,
    ...missionDocs,
    ...schedulerDocs,
    ...securityDocs,
    ...troubleshootingDocs,
    ...devDocs
  ];
  return allDocs.map((doc, idx) => ({
    id: `m1ssion-${String(idx + 1).padStart(3, "0")}`,
    ...doc
  }));
}

function BulkIngest({ onComplete }) {
  const { selectedDocs, setSelectedDocs } = useNorahStore();
  const [step, setStep] = reactExports.useState("idle");
  const [progress, setProgress] = reactExports.useState(0);
  const [logs, setLogs] = reactExports.useState([]);
  const [stats, setStats] = reactExports.useState({
    inserted: 0,
    embedded: 0,
    testResults: [],
    kpis: null
  });
  const addLog = (msg) => {
    const timestamp = (/* @__PURE__ */ new Date()).toLocaleTimeString();
    setLogs((prev) => [...prev.slice(-99), `[${timestamp}] ${msg}`]);
  };
  const generateM1SSIONKnowledge = () => {
    const contentDocs = generateM1SSIONKnowledgeBase();
    const enrichedDocs = contentDocs.map((doc) => ({
      ...doc,
      summary: doc.text.substring(0, 150) + "...",
      autoTags: doc.tags || [],
      dedupeKey: `${doc.title}-${doc.source}`,
      chunks: [{ idx: 0, text: doc.text }]
    }));
    setSelectedDocs(enrichedDocs);
    addLog(`✅ Generated ${enrichedDocs.length} M1SSION™ synthetic documents`);
    ue$1.success(`Generated ${enrichedDocs.length} M1SSION™ documents for intelligence verification`);
  };
  const runDryRun = async () => {
    if (selectedDocs.length === 0) {
      ue$1.error("No documents selected");
      return;
    }
    setStep("dry-run");
    addLog(`Dry run: validating ${selectedDocs.length} documents`);
    try {
      const result = await norahIngest({
        documents: selectedDocs.map((d) => ({
          title: d.title,
          text: d.text,
          tags: d.tags,
          source: d.source,
          url: d.url
        })),
        dryRun: true
      });
      addLog(`✅ Dry run OK: ${selectedDocs.length} docs validated`);
      ue$1.success(`Dry run: ${selectedDocs.length} documents ready`);
      setStep("idle");
    } catch (error) {
      addLog(`❌ Dry run failed: ${error.message}`);
      ue$1.error(`Dry run failed: ${error.message}`);
      setStep("idle");
    }
  };
  const runIngest = async () => {
    if (selectedDocs.length === 0) {
      ue$1.error("No documents selected");
      return;
    }
    setStep("ingesting");
    setProgress(0);
    addLog(`Starting ingest: ${selectedDocs.length} documents`);
    try {
      const batchSize = 20;
      const batches = [];
      for (let i = 0; i < selectedDocs.length; i += batchSize) {
        batches.push(selectedDocs.slice(i, i + batchSize));
      }
      let totalInserted = 0;
      for (let i = 0; i < batches.length; i++) {
        const batch = batches[i];
        addLog(`Ingesting batch ${i + 1}/${batches.length} (${batch.length} docs)`);
        if (i > 0 && window.location.hostname.includes("lovable")) {
          await new Promise((resolve) => setTimeout(resolve, 200));
        }
        try {
          const result = await norahIngest({
            documents: batch.map((d) => ({
              title: d.title,
              text: d.text,
              tags: d.tags,
              source: d.source,
              url: d.url
            })),
            dryRun: false
          });
          totalInserted += result.inserted || 0;
          setProgress((i + 1) / batches.length * 100);
          addLog(`✅ Batch ${i + 1} ingested`);
        } catch (batchErr) {
          addLog(`⚠️ Batch ${i + 1} failed (${batchErr?.message || batchErr}). Falling back to per-doc ingestion...`);
          for (const d of batch) {
            try {
              if (window.location.hostname.includes("lovable") || false) {
                await new Promise((r2) => setTimeout(r2, 120));
              }
              const r = await norahIngest({
                documents: [{ title: d.title, text: d.text, tags: d.tags, source: d.source, url: d.url }],
                dryRun: false
              });
              totalInserted += r.inserted || 0;
            } catch (docErr) {
              addLog(`  ✗ Doc failed: ${d.title} — ${docErr?.message || docErr}`);
            }
          }
          setProgress((i + 1) / batches.length * 100);
          addLog(`✅ Batch ${i + 1} fallback complete`);
        }
      }
      setStats((prev) => ({ ...prev, inserted: totalInserted }));
      addLog(`✅ Total ingested: ${totalInserted} documents`);
      ue$1.success(`Inserted ${totalInserted} documents`);
      setStep("idle");
    } catch (error) {
      addLog(`❌ Ingest failed: ${error.message}`);
      ue$1.error(`Ingest failed: ${error.message}`);
      setStep("idle");
    }
  };
  const runEmbed = async () => {
    setStep("embedding");
    setProgress(0);
    addLog("Starting embedding (batch: 200)");
    try {
      let totalEmbedded = 0;
      let remaining = 1;
      let embedRound = 0;
      while (remaining > 0) {
        if (embedRound > 0 && window.location.hostname.includes("lovable")) {
          await new Promise((resolve) => setTimeout(resolve, 200));
        }
        const result = await norahEmbed({ reembed: false, batch: 200 });
        totalEmbedded += result.embedded || 0;
        remaining = result.remaining || 0;
        setProgress(Math.min(95, totalEmbedded / (totalEmbedded + remaining) * 100));
        addLog(`Embedded ${result.embedded || 0} chunks, ${remaining} remaining`);
        embedRound++;
      }
      setStats((prev) => ({ ...prev, embedded: totalEmbedded }));
      setProgress(100);
      addLog(`✅ Embeddings generated: ${totalEmbedded}`);
      ue$1.success(`Generated ${totalEmbedded} embeddings`);
      setStep("idle");
    } catch (error) {
      addLog(`❌ Embed failed: ${error.message}`);
      ue$1.error(`Embed failed: ${error.message}`);
      setStep("idle");
    }
  };
  const runSmokeTest = async () => {
    setStep("testing");
    addLog("Starting RAG smoke test");
    try {
      const queries = [
        { q: "Push SAFE Guard", top_k: 3 },
        { q: "Buzz Map pricing", top_k: 3 },
        { q: "Norah RAG flow", top_k: 3 }
      ];
      const results = [];
      for (const query of queries) {
        addLog(`RAG query: "${query.q}"`);
        const result = await norahSearch(query);
        const hits = result.results?.length || 0;
        results.push({ query: query.q, hits, results: result.results || [] });
        addLog(`  → ${hits} results`);
      }
      setStats((prev) => ({ ...prev, testResults: results }));
      addLog(`✅ Smoke test complete: ${results.reduce((sum, r) => sum + r.hits, 0)} total hits`);
      ue$1.success(`Smoke test: ${results.reduce((sum, r) => sum + r.hits, 0)} total hits`);
      setStep("idle");
    } catch (error) {
      addLog(`❌ Smoke test failed: ${error.message}`);
      ue$1.error(`Smoke test failed: ${error.message}`);
      setStep("idle");
    }
  };
  const runComplete = async () => {
    if (selectedDocs.length === 0) {
      ue$1.error("No documents selected");
      return;
    }
    addLog("🚀 Starting Complete E2E Flow");
    setStep("dry-run");
    addLog("Step 1/5: Dry run validation");
    try {
      await norahIngest({
        documents: selectedDocs.map((d) => ({
          title: d.title,
          text: d.text,
          tags: d.tags,
          source: d.source,
          url: d.url
        })),
        dryRun: true
      });
      addLog("✅ Dry run passed");
    } catch (error) {
      addLog(`❌ Dry run failed: ${error.message}`);
      ue$1.error(`Flow stopped at dry run: ${error.message}`);
      setStep("idle");
      return;
    }
    setStep("ingesting");
    addLog("Step 2/5: Ingesting documents");
    try {
      const batchSize = 20;
      const batches = [];
      for (let i = 0; i < selectedDocs.length; i += batchSize) {
        batches.push(selectedDocs.slice(i, i + batchSize));
      }
      let totalInserted = 0;
      for (let i = 0; i < batches.length; i++) {
        if (i > 0 && window.location.hostname.includes("lovable")) {
          await new Promise((resolve) => setTimeout(resolve, 200));
        }
        const result = await norahIngest({
          documents: batches[i].map((d) => ({
            title: d.title,
            text: d.text,
            tags: d.tags,
            source: d.source,
            url: d.url
          })),
          dryRun: false
        });
        totalInserted += result.inserted || 0;
        addLog(`  Batch ${i + 1}/${batches.length} ingested`);
      }
      setStats((prev) => ({ ...prev, inserted: totalInserted }));
      addLog(`✅ Ingested ${totalInserted} documents`);
    } catch (error) {
      addLog(`❌ Ingest failed: ${error.message}`);
      ue$1.error(`Flow stopped at ingest: ${error.message}`);
      setStep("idle");
      return;
    }
    setStep("embedding");
    addLog("Step 3/5: Generating embeddings");
    try {
      let totalEmbedded = 0;
      let remaining = 1;
      let embedRoundComplete = 0;
      while (remaining > 0) {
        if (embedRoundComplete > 0 && window.location.hostname.includes("lovable")) {
          await new Promise((resolve) => setTimeout(resolve, 200));
        }
        const result = await norahEmbed({ batch: 200, reembed: false });
        totalEmbedded += result.embedded || 0;
        remaining = result.remaining || 0;
        embedRoundComplete++;
      }
      setStats((prev) => ({ ...prev, embedded: totalEmbedded }));
      addLog(`✅ Embeddings generated: ${totalEmbedded}`);
    } catch (error) {
      addLog(`❌ Embed failed: ${error.message}`);
      ue$1.error(`Flow stopped at embed: ${error.message}`);
      setStep("idle");
      return;
    }
    setStep("testing");
    addLog("Step 4/5: RAG smoke test");
    try {
      const queries = [
        { q: "Push SAFE Guard", top_k: 3 },
        { q: "Buzz Map pricing", top_k: 3 }
      ];
      const results = [];
      for (const query of queries) {
        const res = await norahSearch(query);
        const count = res.results?.length || 0;
        results.push({ query: query.q, hits: count });
        addLog(`  Query "${query.q}": ${count} results`);
      }
      setStats((prev) => ({ ...prev, testResults: results }));
      addLog("✅ RAG test passed");
    } catch (error) {
      addLog(`❌ RAG test failed: ${error.message}`);
      ue$1.error(`Flow stopped at RAG: ${error.message}`);
      setStep("idle");
      return;
    }
    setStep("kpis");
    addLog("Step 5/5: Refreshing KPIs");
    try {
      const result = await norahKpis();
      setStats((prev) => ({ ...prev, kpis: result }));
      addLog(`✅ Final KPIs: ${result.documents} docs, ${result.embeddings} embeddings`);
      addLog("🎉 Complete E2E Flow finished successfully!");
      ue$1.success("Complete E2E Flow finished!");
      setStep("complete");
      onComplete?.();
    } catch (error) {
      addLog(`❌ KPIs refresh failed: ${error.message}`);
      ue$1.error(`Flow completed but KPIs failed: ${error.message}`);
      setStep("idle");
    }
  };
  const isRunning = step !== "idle" && step !== "complete";
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2 font-orbitron", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Upload, { className: "w-5 h-5" }),
          "Bulk Ingest Pipeline"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardDescription, { children: [
          selectedDocs.length,
          " documents ready • Step: ",
          step
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: generateM1SSIONKnowledge,
            disabled: isRunning,
            variant: "secondary",
            size: "lg",
            className: "w-full",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Upload, { className: "w-5 h-5 mr-2" }),
              "🧠 Generate M1SSION™ Knowledge Base (150+ docs)"
            ]
          }
        ),
        isRunning && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: progress }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground text-center", children: [
            progress.toFixed(1),
            "% complete"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: runComplete, disabled: isRunning || selectedDocs.length === 0, size: "lg", className: "w-full", children: [
          isRunning ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-5 h-5 animate-spin mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-5 h-5 mr-2" }),
          "🚀 Run Complete Flow"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: runDryRun,
              disabled: isRunning || selectedDocs.length === 0,
              variant: "outline",
              size: "sm",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(TestTube, { className: "w-4 h-4 mr-2" }),
                step === "dry-run" ? "Running..." : "Dry Run"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: runIngest,
              disabled: isRunning || selectedDocs.length === 0,
              variant: "outline",
              size: "sm",
              children: [
                step === "ingesting" ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Upload, { className: "w-4 h-4 mr-2" }),
                "Ingest"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: runEmbed,
              disabled: isRunning,
              variant: "outline",
              size: "sm",
              children: [
                step === "embedding" ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Play, { className: "w-4 h-4 mr-2" }),
                "Embed"
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Button,
            {
              onClick: runSmokeTest,
              disabled: isRunning,
              variant: "outline",
              size: "sm",
              children: [
                step === "testing" ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(TestTube, { className: "w-4 h-4 mr-2" }),
                "RAG Test"
              ]
            }
          )
        ] }),
        (stats.inserted > 0 || stats.embedded > 0 || stats.testResults.length > 0) && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 p-4 bg-muted rounded-lg", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-sm font-semibold font-orbitron", children: "Pipeline Stats:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Inserted" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-2xl font-bold font-orbitron", children: stats.inserted })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Embedded" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-2xl font-bold font-orbitron", children: stats.embedded })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Test Hits" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-2xl font-bold font-orbitron", children: stats.testResults.reduce((sum, r) => sum + r.hits, 0) })
            ] })
          ] }),
          stats.testResults.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 space-y-1", children: stats.testResults.map((r, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("code", { children: r.query }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: r.hits > 0 ? "default" : "secondary", children: [
              r.hits,
              " hits"
            ] })
          ] }, i)) })
        ] }),
        step === "complete" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-green-500/10 rounded-lg text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-semibold text-green-500", children: "✅ Pipeline Complete!" }) })
      ] })
    ] }),
    logs.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-sm", children: "Pipeline Logs" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(ScrollArea, { className: "h-48 w-full rounded border p-2 font-mono text-xs", children: logs.map((log, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-muted-foreground", children: log }, i)) }) })
    ] })
  ] });
}

const INTELLIGENCE_EVAL_QUESTIONS = [
  // Buzz Map System (5 questions)
  {
    query: "Come funziona il sistema BUZZ Map e come interagisce con Supabase Realtime?",
    category: "Buzz Map",
    expected_keywords: ["buzz", "map", "supabase", "realtime", "geolocation", "radius"],
    contextual_reasoning_check: "Should connect Buzz Map pricing with real-time updates"
  },
  {
    query: "Come viene calcolato il prezzo dinamico BUZZ e il radius di ricerca?",
    category: "Buzz Map",
    expected_keywords: ["pricing", "buzz", "radius", "dynamic", "subscription", "tier"],
    contextual_reasoning_check: "Should explain pricing tiers and radius correlation"
  },
  {
    query: "Quali sono i reward e i bonus XP del sistema BUZZ?",
    category: "Buzz Map",
    expected_keywords: ["reward", "xp", "buzz", "bonus", "leaderboard"],
    contextual_reasoning_check: "Should link XP to leaderboard progression"
  },
  {
    query: "Come funziona la mappa BUZZ con i marker geografici?",
    category: "Buzz Map",
    expected_keywords: ["map", "marker", "geolocation", "latitude", "longitude", "distance"],
    contextual_reasoning_check: "Should explain geolocation and marker placement"
  },
  {
    query: "Qual è la logica antiforcing del BUZZ per evitare abusi?",
    category: "Buzz Map",
    expected_keywords: ["antiforcing", "abuse", "cooldown", "rate", "limit"],
    contextual_reasoning_check: "Should connect cooldowns with subscription tiers"
  },
  // Push SAFE Guard (5 questions)
  {
    query: "Come funziona il Push SAFE Guard e perché è necessario?",
    category: "Push SAFE Guard",
    expected_keywords: ["push", "safe", "guard", "vapid", "notification", "security"],
    contextual_reasoning_check: "Should explain VAPID key protection and prebuild checks"
  },
  {
    query: "Qual è il flusso di notifiche push per iOS PWA vs Android?",
    category: "Push SAFE Guard",
    expected_keywords: ["ios", "pwa", "android", "fcm", "apns", "notification"],
    contextual_reasoning_check: "Should differentiate iOS fallback vs native Android push"
  },
  {
    query: "Come vengono gestite le vibrazioni aptiche nelle notifiche?",
    category: "Push SAFE Guard",
    expected_keywords: ["haptic", "vibration", "notification", "pattern", "buzz"],
    contextual_reasoning_check: "Should connect haptics to notification types"
  },
  {
    query: "Come il sistema push interagisce con Supabase Edge Functions?",
    category: "Push SAFE Guard",
    expected_keywords: ["edge", "function", "supabase", "push", "trigger", "delivery"],
    contextual_reasoning_check: "Should explain edge function role in push delivery"
  },
  {
    query: "Quali sono le politiche di privacy GDPR per le notifiche push?",
    category: "Push SAFE Guard",
    expected_keywords: ["gdpr", "privacy", "consent", "push", "token", "storage"],
    contextual_reasoning_check: "Should link GDPR consent to push subscription flow"
  },
  // Haptics (3 questions)
  {
    query: "Come vengono implementati i pattern di vibrazione aptica?",
    category: "Haptics",
    expected_keywords: ["haptic", "vibration", "pattern", "api", "navigator"],
    contextual_reasoning_check: "Should explain Vibration API usage"
  },
  {
    query: "Quali eventi trigger la vibrazione aptica in M1SSION?",
    category: "Haptics",
    expected_keywords: ["trigger", "event", "buzz", "notification", "leaderboard", "mission"],
    contextual_reasoning_check: "Should list all haptic trigger points"
  },
  {
    query: "Come viene gestita la compatibilità cross-browser per l'aptica?",
    category: "Haptics",
    expected_keywords: ["browser", "compatibility", "fallback", "vibration", "support"],
    contextual_reasoning_check: "Should explain feature detection and fallbacks"
  },
  // Missions & Clues (5 questions)
  {
    query: "Come funziona il sistema delle missioni settimanali?",
    category: "Missions",
    expected_keywords: ["mission", "weekly", "clue", "week", "rotation"],
    contextual_reasoning_check: "Should explain 4-week rotation cycle"
  },
  {
    query: "Qual è la logica antiforcing per le missioni?",
    category: "Missions",
    expected_keywords: ["antiforcing", "mission", "cooldown", "limit", "attempts"],
    contextual_reasoning_check: "Should connect mission limits to subscription tiers"
  },
  {
    query: "Come vengono distribuiti i premi delle missioni?",
    category: "Missions",
    expected_keywords: ["prize", "reward", "mission", "tier", "distribution"],
    contextual_reasoning_check: "Should link prizes to subscription levels"
  },
  {
    query: "Come funziona il Final Shot e quando si attiva?",
    category: "Missions",
    expected_keywords: ["final", "shot", "mission", "activation", "prize"],
    contextual_reasoning_check: "Should explain Final Shot trigger conditions"
  },
  {
    query: "Come vengono sincronizzate le missioni con il database Supabase?",
    category: "Missions",
    expected_keywords: ["supabase", "sync", "mission", "realtime", "database"],
    contextual_reasoning_check: "Should explain realtime updates for missions"
  },
  // Scheduler & Cron (3 questions)
  {
    query: "Come funziona lo Scheduler automatico di Norah AI?",
    category: "Scheduler",
    expected_keywords: ["scheduler", "cron", "automatic", "daily", "crawl", "embed"],
    contextual_reasoning_check: "Should explain 06:00 UTC crawl and 07:00 UTC embed"
  },
  {
    query: "Quali operazioni vengono eseguite dallo Scheduler giornaliero?",
    category: "Scheduler",
    expected_keywords: ["scheduler", "operation", "ingest", "embed", "kpi", "refresh"],
    contextual_reasoning_check: "Should list all scheduled operations"
  },
  {
    query: "Come il Cron interagisce con le Edge Functions Supabase?",
    category: "Scheduler",
    expected_keywords: ["cron", "edge", "function", "supabase", "trigger", "scheduler"],
    contextual_reasoning_check: "Should explain edge function invocation from cron"
  },
  // Privacy & Security (3 questions)
  {
    query: "Come viene garantita la sicurezza GDPR in M1SSION?",
    category: "Security",
    expected_keywords: ["gdpr", "privacy", "security", "consent", "data", "protection"],
    contextual_reasoning_check: "Should explain consent management and data handling"
  },
  {
    query: "Come vengono protette le VAPID keys nel Push SAFE Guard?",
    category: "Security",
    expected_keywords: ["vapid", "key", "security", "guard", "prebuild", "environment"],
    contextual_reasoning_check: "Should explain VAPID key protection mechanisms"
  },
  {
    query: "Quali misure di sicurezza proteggono i dati utente in Supabase?",
    category: "Security",
    expected_keywords: ["rls", "policy", "supabase", "security", "authentication", "row"],
    contextual_reasoning_check: "Should explain RLS policies and auth"
  },
  // Troubleshooting (3 questions)
  {
    query: "Come risolvere errori di boot nelle Edge Functions?",
    category: "Troubleshooting",
    expected_keywords: ["boot", "error", "edge", "function", "cors", "jwt"],
    contextual_reasoning_check: "Should explain common boot errors and solutions"
  },
  {
    query: "Come debuggare problemi di embedding in Norah AI?",
    category: "Troubleshooting",
    expected_keywords: ["debug", "embedding", "cloudflare", "error", "vector"],
    contextual_reasoning_check: "Should explain embedding troubleshooting steps"
  },
  {
    query: "Come verificare e riparare inconsistenze nel database Norah?",
    category: "Troubleshooting",
    expected_keywords: ["database", "inconsistency", "verify", "repair", "sync"],
    contextual_reasoning_check: "Should explain DB verification procedures"
  },
  // Developer Procedures (3 questions)
  {
    query: "Come si esegue il deploy delle Edge Functions Supabase?",
    category: "Developer",
    expected_keywords: ["deploy", "edge", "function", "supabase", "cli", "production"],
    contextual_reasoning_check: "Should explain deployment workflow"
  },
  {
    query: "Qual è il workflow completo di Norah AI da ingest a RAG?",
    category: "Developer",
    expected_keywords: ["workflow", "ingest", "embed", "rag", "search", "pipeline"],
    contextual_reasoning_check: "Should explain full RAG pipeline"
  },
  {
    query: "Come monitorare le performance di Norah AI in produzione?",
    category: "Developer",
    expected_keywords: ["monitor", "performance", "kpi", "metrics", "production"],
    contextual_reasoning_check: "Should explain monitoring and KPI tracking"
  }
];
function calculateIntelligenceMetrics(results) {
  const pass1Count = results.filter((r) => r.pass1).length;
  const pass3Count = results.filter((r) => r.pass3).length;
  const pass1 = pass1Count / results.length * 100;
  const pass3 = pass3Count / results.length * 100;
  const avgKeywordMatch = results.reduce(
    (sum, r) => sum + r.matchedKeywords.length / r.totalKeywords,
    0
  ) / results.length;
  const contextual_reasoning = avgKeywordMatch * 10;
  const avgHits = results.reduce((sum, r) => sum + r.hits, 0) / results.length;
  const semantic_depth = Math.min(10, avgHits / 3 * 10);
  const citationQuality = results.filter((r) => r.hasCitation).length / results.length;
  const cross_module_understanding = citationQuality * 10;
  const baseline_score = (40 + 60) / 2;
  const current_score = (pass1 + pass3) / 2;
  const intelligence_gain = (current_score - baseline_score) / baseline_score * 100;
  return {
    pass1,
    pass3,
    contextual_reasoning,
    semantic_depth,
    cross_module_understanding,
    intelligence_gain
  };
}
function generateIntelligenceVerdict(metrics) {
  if (metrics.pass1 >= 65 && metrics.pass3 >= 85 && metrics.intelligence_gain > 30) {
    return "SMARTER ✅";
  } else if (metrics.pass1 >= 50 && metrics.pass3 >= 70) {
    return "SAME ⚠️";
  } else {
    return "REGRESSION ❌";
  }
}

function IntelligenceReport({ report }) {
  const { metrics, verdict, docs, embeddings, questions_tested } = report;
  const getVerdictColor = (v) => {
    if (v.includes("SMARTER")) return "text-green-500";
    if (v.includes("SAME")) return "text-yellow-500";
    return "text-red-500";
  };
  const getScoreColor = (score) => {
    if (score >= 8) return "text-green-500";
    if (score >= 6) return "text-yellow-500";
    return "text-red-500";
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-primary/20", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between font-orbitron", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Brain, { className: "w-6 h-6 text-primary" }),
        "🧠 NORAH AI 2.0 — INTELLIGENCE REPORT"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "default", className: `text-lg ${getVerdictColor(verdict)}`, children: verdict })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-muted text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Documents" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold font-orbitron", children: docs })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-muted text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Embeddings" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold font-orbitron", children: embeddings })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-muted text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Questions" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-3xl font-bold font-orbitron", children: questions_tested })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold", children: "Pass@1" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-bold", children: [
              metrics.pass1.toFixed(1),
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: metrics.pass1, className: "h-2" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Target: ≥65%" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold", children: "Pass@3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-bold", children: [
              metrics.pass3.toFixed(1),
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: metrics.pass3, className: "h-2" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Target: ≥85%" })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 rounded-lg border text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Target, { className: "w-4 h-4 mx-auto mb-1 text-primary" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground mb-1", children: "Contextual" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: `text-xl font-bold font-orbitron ${getScoreColor(metrics.contextual_reasoning)}`, children: [
            metrics.contextual_reasoning.toFixed(1),
            "/10"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 rounded-lg border text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-4 h-4 mx-auto mb-1 text-primary" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground mb-1", children: "Semantic" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: `text-xl font-bold font-orbitron ${getScoreColor(metrics.semantic_depth)}`, children: [
            metrics.semantic_depth.toFixed(1),
            "/10"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 rounded-lg border text-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Brain, { className: "w-4 h-4 mx-auto mb-1 text-primary" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground mb-1", children: "Cross-Module" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: `text-xl font-bold font-orbitron ${getScoreColor(metrics.cross_module_understanding)}`, children: [
            metrics.cross_module_understanding.toFixed(1),
            "/10"
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 rounded-lg bg-gradient-to-r from-primary/10 to-accent/10 border border-primary/20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(TrendingUp, { className: "w-5 h-5 text-primary" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-semibold", children: "Intelligence Gain vs Baseline" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-right", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: `text-2xl font-bold font-orbitron ${metrics.intelligence_gain > 0 ? "text-green-500" : "text-red-500"}`, children: [
          metrics.intelligence_gain > 0 ? "+" : "",
          metrics.intelligence_gain.toFixed(1),
          "%"
        ] }) })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-muted space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-sm font-semibold font-orbitron", children: "🎯 Final Assessment" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1 text-xs", children: [
          metrics.pass1 >= 65 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-green-500", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-4 h-4" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Pass@1 target achieved (≥65%)" })
          ] }),
          metrics.pass3 >= 85 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-green-500", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-4 h-4" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Pass@3 target achieved (≥85%)" })
          ] }),
          metrics.intelligence_gain > 30 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-green-500", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-4 h-4" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
              "Significant intelligence improvement (+",
              metrics.intelligence_gain.toFixed(0),
              "%)"
            ] })
          ] }),
          docs >= 150 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-green-500", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-4 h-4" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
              "Knowledge base adequately populated (",
              docs,
              " docs)"
            ] })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground text-center", children: [
        "Report generated: ",
        new Date(report.timestamp).toLocaleString()
      ] })
    ] })
  ] });
}

const DEFAULT_GOLD = INTELLIGENCE_EVAL_QUESTIONS.map((q) => ({
  query: q.query,
  expected_keywords: q.expected_keywords,
  lang: "it"
}));
function EvalHarness() {
  const { toast } = useToast();
  const [goldQuestions, setGoldQuestions] = reactExports.useState(JSON.stringify(DEFAULT_GOLD, null, 2));
  const [running, setRunning] = reactExports.useState(false);
  const [progress, setProgress] = reactExports.useState(0);
  const [results, setResults] = reactExports.useState([]);
  const [intelligenceReport, setIntelligenceReport] = reactExports.useState(null);
  const runEval = async () => {
    setRunning(true);
    setProgress(0);
    setResults([]);
    try {
      const questions = JSON.parse(goldQuestions);
      const evalResults = [];
      for (let i = 0; i < questions.length; i++) {
        const q = questions[i];
        const searchResult = await norahSearch({ q: q.query, top_k: 8 });
        const hits = searchResult.results || [];
        const reranked = hits;
        const top3 = reranked.slice(0, 3);
        const allText = top3.map((h) => h.chunkText || h.chunk_text || "").join(" ").toLowerCase();
        const matchedKeywords = q.expected_keywords.filter((kw) => allText.includes(kw.toLowerCase()));
        const pass1 = top3.length > 0 && matchedKeywords.length >= 1;
        const pass3 = matchedKeywords.length >= Math.min(2, q.expected_keywords.length);
        const hasCitation = top3.some((h) => h.title || h.url);
        evalResults.push({
          query: q.query,
          pass1,
          pass3,
          hasCitation,
          matchedKeywords,
          totalKeywords: q.expected_keywords.length,
          hits: hits.length,
          top3
        });
        setProgress((i + 1) / questions.length * 100);
      }
      setResults(evalResults);
      const metrics = calculateIntelligenceMetrics(evalResults);
      const verdict = generateIntelligenceVerdict(metrics);
      const kpis = await norahKpis();
      const report = {
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        docs: kpis.documents || 0,
        embeddings: kpis.embeddings || 0,
        last_embed_at: kpis.last_embed_at,
        metrics,
        verdict,
        questions_tested: evalResults.length,
        results: evalResults
      };
      setIntelligenceReport(report);
      toast({
        title: `✅ Intelligence Verification Complete`,
        description: `Verdict: ${verdict} | Pass@1: ${metrics.pass1.toFixed(1)}% | Pass@3: ${metrics.pass3.toFixed(1)}%`
      });
    } catch (error) {
      toast({ title: "❌ Evaluation Failed", description: error.message, variant: "destructive" });
    } finally {
      setRunning(false);
    }
  };
  const exportResults = () => {
    const csv = [
      "Query,Pass@1,Pass@3,Citation,Matched Keywords,Total Keywords,Hits",
      ...results.map(
        (r) => `"${r.query}",${r.pass1},${r.pass3},${r.hasCitation},${r.matchedKeywords.length},${r.totalKeywords},${r.hits}`
      )
    ].join("\n");
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `norah-eval-${(/* @__PURE__ */ new Date()).toISOString().split("T")[0]}.csv`;
    a.click();
    URL.revokeObjectURL(url);
    toast({ title: "✅ Exported", description: "Evaluation results downloaded" });
  };
  const exportJSON = () => {
    const exportData = intelligenceReport || { results, timestamp: (/* @__PURE__ */ new Date()).toISOString() };
    const json = JSON.stringify(exportData, null, 2);
    const blob = new Blob([json], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `norah-intelligence-${(/* @__PURE__ */ new Date()).toISOString().split("T")[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
    toast({ title: "✅ Exported", description: "Intelligence report downloaded (JSON)" });
  };
  const pass1Rate = results.length > 0 ? results.filter((r) => r.pass1).length / results.length * 100 : 0;
  const pass3Rate = results.length > 0 ? results.filter((r) => r.pass3).length / results.length * 100 : 0;
  const citationRate = results.length > 0 ? results.filter((r) => r.hasCitation).length / results.length * 100 : 0;
  const avgHits = results.length > 0 ? results.reduce((sum, r) => sum + r.hits, 0) / results.length : 0;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2 font-orbitron", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(TestTube, { className: "w-5 h-5" }),
          "Evaluation Harness"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Test RAG quality with gold questions (JSON format)" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Textarea,
          {
            value: goldQuestions,
            onChange: (e) => setGoldQuestions(e.target.value),
            rows: 12,
            className: "font-mono text-xs",
            placeholder: '[{"query": "...", "expected_keywords": [...], "lang": "it"}]',
            disabled: running
          }
        ),
        running && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: progress }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground text-center", children: [
            "Running evaluation: ",
            progress.toFixed(1),
            "%"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: runEval, disabled: running, className: "flex-1", children: [
            running ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(TestTube, { className: "w-4 h-4 mr-2" }),
            "Run Eval"
          ] }),
          results.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: exportResults, variant: "outline", size: "sm", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Download, { className: "w-4 h-4 mr-2" }),
              "CSV"
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: exportJSON, variant: "outline", size: "sm", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Download, { className: "w-4 h-4 mr-2" }),
              "JSON"
            ] })
          ] })
        ] })
      ] })
    ] }),
    intelligenceReport && /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligenceReport, { report: intelligenceReport }),
    results.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "font-orbitron", children: "Detailed Results" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardDescription, { children: [
          results.length,
          " questions evaluated"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-muted", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Pass@1" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-2xl font-bold font-orbitron", children: [
              pass1Rate.toFixed(1),
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-muted", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Pass@3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-2xl font-bold font-orbitron", children: [
              pass3Rate.toFixed(1),
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-muted", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Citation Rate" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-2xl font-bold font-orbitron", children: [
              citationRate.toFixed(1),
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 rounded-lg bg-muted", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Avg Hits" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-2xl font-bold font-orbitron", children: avgHits.toFixed(1) })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2 max-h-96 overflow-y-auto", children: results.map((r, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3 p-3 rounded-lg border bg-card", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-1", children: [
            r.pass1 ? /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-4 h-4 text-green-500" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-4 h-4 text-red-500" }),
            r.pass3 ? /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-4 h-4 text-green-500" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-4 h-4 text-red-500" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-sm font-semibold", children: r.query }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-1 mt-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", className: "text-xs", children: [
                r.matchedKeywords.length,
                "/",
                r.totalKeywords,
                " keywords"
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: r.hasCitation ? "default" : "secondary", className: "text-xs", children: r.hasCitation ? "✓ Citation" : "✗ No Citation" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "secondary", className: "text-xs", children: [
                r.hits,
                " hits"
              ] })
            ] })
          ] })
        ] }, i)) })
      ] })
    ] })
  ] });
}

function Scheduler({ onTrigger }) {
  const { toast } = useToast();
  const [enabled, setEnabled] = reactExports.useState(false);
  const [lastRun, setLastRun] = reactExports.useState({});
  const [nextRun, setNextRun] = reactExports.useState({});
  const calculateNextRun = () => {
    const now = /* @__PURE__ */ new Date();
    const crawlTime = new Date(now);
    crawlTime.setUTCHours(6, 0, 0, 0);
    if (crawlTime < now) crawlTime.setUTCDate(crawlTime.getUTCDate() + 1);
    const embedTime = new Date(now);
    embedTime.setUTCHours(7, 0, 0, 0);
    if (embedTime < now) embedTime.setUTCDate(embedTime.getUTCDate() + 1);
    setNextRun({
      crawl: crawlTime.toISOString(),
      embed: embedTime.toISOString()
    });
  };
  reactExports.useEffect(() => {
    calculateNextRun();
    const interval = setInterval(calculateNextRun, 6e4);
    return () => clearInterval(interval);
  }, []);
  reactExports.useEffect(() => {
    if (!enabled) return;
    const checkSchedule = async () => {
      const now = /* @__PURE__ */ new Date();
      if (now.getUTCHours() === 6 && now.getUTCMinutes() === 0) {
        const lastCrawl = lastRun.crawl;
        const today = now.toISOString().split("T")[0];
        if (!lastCrawl || !lastCrawl.startsWith(today)) {
          await runDailyCrawl();
        }
      }
      if (now.getUTCHours() === 7 && now.getUTCMinutes() === 0) {
        const lastEmbed = lastRun.embed;
        const today = now.toISOString().split("T")[0];
        if (!lastEmbed || !lastEmbed.startsWith(today)) {
          await runEmbedScheduler();
        }
      }
    };
    const interval = setInterval(checkSchedule, 6e4);
    return () => clearInterval(interval);
  }, [enabled, lastRun]);
  const runDailyCrawl = async () => {
    try {
      toast({ title: "⏰ Daily Crawl Started", description: "Fetching new/updated content..." });
      const demoDoc = {
        title: `Daily Update ${(/* @__PURE__ */ new Date()).toISOString().split("T")[0]}`,
        text: "Automated daily content refresh",
        tags: ["daily", "auto"],
        source: "sitemap",
        url: "auto://daily-crawl",
        language: "it",
        updatedAt: (/* @__PURE__ */ new Date()).toISOString()
      };
      await norahIngest({ documents: [demoDoc], dryRun: false });
      setLastRun((prev) => ({ ...prev, crawl: (/* @__PURE__ */ new Date()).toISOString() }));
      toast({ title: "✅ Daily Crawl Complete", description: "Content updated" });
      onTrigger?.("crawl");
    } catch (error) {
      toast({ title: "❌ Daily Crawl Failed", description: error.message, variant: "destructive" });
    }
  };
  const runEmbedScheduler = async () => {
    try {
      toast({ title: "⏰ Embed Scheduler Started", description: "Processing embedding queue..." });
      let totalEmbedded = 0;
      let remaining = 1;
      while (remaining > 0) {
        const result = await norahEmbed({ reembed: false, batch: 200 });
        totalEmbedded += result.embedded || 0;
        remaining = result.remaining || 0;
      }
      setLastRun((prev) => ({ ...prev, embed: (/* @__PURE__ */ new Date()).toISOString() }));
      toast({ title: "✅ Embed Scheduler Complete", description: `Embedded ${totalEmbedded} chunks` });
      onTrigger?.("embed");
    } catch (error) {
      toast({ title: "❌ Embed Scheduler Failed", description: error.message, variant: "destructive" });
    }
  };
  const formatTime = (iso) => {
    if (!iso) return "Never";
    const date = new Date(iso);
    const now = /* @__PURE__ */ new Date();
    const diff = date.getTime() - now.getTime();
    const hours = Math.floor(diff / (1e3 * 60 * 60));
    const minutes = Math.floor(diff % (1e3 * 60 * 60) / (1e3 * 60));
    if (hours < 0) return "Overdue";
    return `${hours}h ${minutes}m`;
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center justify-between font-orbitron", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-5 h-5" }),
          "Content Refresh Scheduler"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: () => setEnabled(!enabled),
            variant: enabled ? "default" : "outline",
            size: "sm",
            children: [
              enabled ? /* @__PURE__ */ jsxRuntimeExports.jsx(Pause, { className: "w-4 h-4 mr-2" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Play, { className: "w-4 h-4 mr-2" }),
              enabled ? "Enabled" : "Disabled"
            ]
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Automated daily crawl (06:00 UTC) and embedding (07:00 UTC)" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-3 rounded-lg bg-muted", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-semibold", children: "Status:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: enabled ? "default" : "secondary", children: enabled ? "✅ Active" : "⏸️ Paused" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-3 rounded-lg border", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-semibold", children: "Daily Crawl (06:00 UTC)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground", children: [
              "Last: ",
              lastRun.crawl ? new Date(lastRun.crawl).toLocaleString() : "Never"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Next in:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-semibold", children: formatTime(nextRun.crawl || "") })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-3 rounded-lg border", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-semibold", children: "Embed Scheduler (07:00 UTC)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground", children: [
              "Last: ",
              lastRun.embed ? new Date(lastRun.embed).toLocaleString() : "Never"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-right", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Next in:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-semibold", children: formatTime(nextRun.embed || "") })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: runDailyCrawl, variant: "outline", size: "sm", className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-4 h-4 mr-2" }),
          "Trigger Crawl Now"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: runEmbedScheduler, variant: "outline", size: "sm", className: "flex-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-4 h-4 mr-2" }),
          "Trigger Embed Now"
        ] })
      ] })
    ] })
  ] });
}

function KPIPanel() {
  const [kpis, setKpis] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(false);
  const loadKPIs = async () => {
    setLoading(true);
    try {
      const data = await norahKpis();
      setKpis(data);
      ue$1.success("KPIs refreshed");
    } catch (error) {
      ue$1.error(`Failed to load KPIs: ${error.message}`);
    } finally {
      setLoading(false);
    }
  };
  const handleExport = async () => {
    try {
      await downloadKPIs();
      ue$1.success("KPIs exported as JSON");
    } catch (error) {
      ue$1.error(`Export failed: ${error.message}`);
    }
  };
  reactExports.useEffect(() => {
    loadKPIs();
    const onFocus = () => loadKPIs();
    window.addEventListener("focus", onFocus);
    return () => window.removeEventListener("focus", onFocus);
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-5 h-5" }),
        "Norah AI KPIs"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: loadKPIs, disabled: loading, size: "sm", children: "Refresh" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: handleExport, size: "sm", variant: "outline", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Download, { className: "w-4 h-4 mr-2" }),
          "Export JSON"
        ] })
      ] })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: kpis ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Documents" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", className: "text-lg", children: kpis.documents || 0 })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Embeddings" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", className: "text-lg", children: kpis.embeddings || 0 })
        ] })
      ] }),
      kpis.last_embed_at && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Last Embed" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-mono", children: new Date(kpis.last_embed_at).toLocaleString() })
      ] }),
      kpis.ok === false && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-destructive", children: "⚠️ Backend health check failed" })
    ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Loading KPIs..." }) })
  ] });
}

function IntelligenceActivation({ onComplete }) {
  const [isRunning, setIsRunning] = reactExports.useState(false);
  const [startTime, setStartTime] = reactExports.useState(0);
  const [steps, setSteps] = reactExports.useState([
    { name: "Knowledge Base Generation", status: "pending", progress: 0, message: "Waiting..." },
    { name: "Document Ingestion", status: "pending", progress: 0, message: "Waiting..." },
    { name: "Vector Embedding", status: "pending", progress: 0, message: "Waiting..." },
    { name: "Intelligence Evaluation", status: "pending", progress: 0, message: "Waiting..." },
    { name: "Cross-Query Validation", status: "pending", progress: 0, message: "Waiting..." },
    { name: "Final Report Generation", status: "pending", progress: 0, message: "Waiting..." }
  ]);
  const [finalReport, setFinalReport] = reactExports.useState(null);
  const { setSelectedDocs } = useNorahStore();
  const updateStep = (index, updates) => {
    setSteps((prev) => prev.map((step, i) => i === index ? { ...step, ...updates } : step));
  };
  const runFullActivation = async () => {
    setIsRunning(true);
    setStartTime(Date.now());
    const results = {};
    try {
      updateStep(0, { status: "running", progress: 10, message: "Generating M1SSION™ documents..." });
      const generatedDocs = generateM1SSIONKnowledgeBase();
      results.generatedDocs = generatedDocs.length;
      updateStep(0, { status: "running", progress: 50, message: `Generated ${generatedDocs.length} documents` });
      const enrichedDocs = generatedDocs.map((doc, idx) => ({
        ...doc,
        summary: doc.text.substring(0, 200) + "...",
        autoTags: doc.tags || [],
        dedupeKey: `${doc.title}-${idx}`,
        chunks: [{ idx: 0, text: doc.text }]
      }));
      setSelectedDocs(enrichedDocs);
      updateStep(0, { status: "success", progress: 100, message: `✅ ${generatedDocs.length} docs generated`, data: { count: generatedDocs.length } });
      updateStep(1, { status: "running", progress: 10, message: "Preparing documents..." });
      const BATCH_SIZE = 10;
      const totalDocs = generatedDocs.length;
      let totalInserted = 0;
      let batchErrors = 0;
      const docsToIngest = generatedDocs.map((doc) => ({
        title: doc.title,
        text: doc.text,
        tags: doc.tags,
        source: doc.source,
        url: doc.url
      }));
      for (let i = 0; i < docsToIngest.length; i += BATCH_SIZE) {
        const batch = docsToIngest.slice(i, i + BATCH_SIZE);
        const batchNum = Math.floor(i / BATCH_SIZE) + 1;
        const totalBatches = Math.ceil(totalDocs / BATCH_SIZE);
        updateStep(1, {
          status: "running",
          progress: 10 + i / totalDocs * 80,
          message: `Ingesting batch ${batchNum}/${totalBatches} (${batch.length} docs)...`
        });
        if (i > 0 && window.location.hostname.includes("lovable")) {
          await new Promise((resolve) => setTimeout(resolve, 200));
        }
        let batchSuccess = false;
        let retryCount = 0;
        const MAX_RETRIES = 2;
        let batchError = null;
        while (!batchSuccess && retryCount <= MAX_RETRIES) {
          try {
            const batchResult = await norahIngest({ documents: batch, dryRun: false });
            totalInserted += batchResult.inserted || 0;
            batchSuccess = true;
          } catch (error) {
            batchError = error;
            retryCount++;
            if (retryCount > MAX_RETRIES) {
              console.error(`Batch ${batchNum} failed after ${MAX_RETRIES} retries:`, error?.message || error);
              let fallbackInserted = 0;
              for (const d of batch) {
                try {
                  if (window.location.hostname.includes("lovable") || false) {
                    await new Promise((r2) => setTimeout(r2, 120));
                  }
                  const r = await norahIngest({ documents: [d], dryRun: false });
                  fallbackInserted += r.inserted || 0;
                } catch (docErr) {
                  console.warn(`  ✗ Doc failed (batch ${batchNum}): ${d.title} — ${docErr?.message || docErr}`);
                }
              }
              totalInserted += fallbackInserted;
              if (fallbackInserted === 0) batchErrors++;
              break;
            }
            await new Promise((resolve) => setTimeout(resolve, 1e3 * retryCount));
          }
        }
      }
      results.ingestResult = { inserted: totalInserted, errors: batchErrors };
      if (batchErrors > 0) {
        updateStep(1, {
          status: "success",
          progress: 100,
          message: `⚠️ ${totalInserted} docs ingested, ${batchErrors} batches failed`,
          data: { inserted: totalInserted, errors: batchErrors }
        });
      } else {
        updateStep(1, {
          status: "success",
          progress: 100,
          message: `✅ ${totalInserted} docs ingested successfully`,
          data: { inserted: totalInserted }
        });
      }
      updateStep(2, { status: "running", progress: 10, message: "Generating embeddings..." });
      let totalEmbedded = 0;
      let remaining = 1;
      let embedRound = 0;
      while (remaining > 0) {
        if (embedRound > 0 && window.location.hostname.includes("lovable")) {
          await new Promise((resolve) => setTimeout(resolve, 200));
        }
        const embedResult = await norahEmbed({ batch: 200, reembed: false });
        totalEmbedded += embedResult.embedded || 0;
        remaining = embedResult.remaining || 0;
        updateStep(2, { status: "running", progress: 50, message: `Embedded ${totalEmbedded} chunks, ${remaining} remaining...` });
        embedRound++;
      }
      results.totalEmbedded = totalEmbedded;
      updateStep(2, { status: "success", progress: 100, message: `✅ ${totalEmbedded} embeddings created`, data: { embedded: totalEmbedded } });
      const kpis = await norahKpis();
      results.kpis = kpis;
      updateStep(3, { status: "running", progress: 10, message: "Running intelligence tests..." });
      const evalResults = await runIntelligenceEvaluation();
      results.evalResults = evalResults;
      updateStep(3, {
        status: "success",
        progress: 100,
        message: `✅ Pass@1: ${(evalResults.pass_at_1 * 100).toFixed(1)}%, Pass@3: ${(evalResults.pass_at_3 * 100).toFixed(1)}%`,
        data: evalResults
      });
      updateStep(4, { status: "running", progress: 10, message: "Testing cross-module queries..." });
      const crossQueryResults = await runCrossQueryValidation();
      results.crossQueryResults = crossQueryResults;
      updateStep(4, {
        status: "success",
        progress: 100,
        message: `✅ ${crossQueryResults.successful}/${crossQueryResults.total} queries successful`,
        data: crossQueryResults
      });
      updateStep(5, { status: "running", progress: 10, message: "Generating final report..." });
      const report = generateFinalReport(results, Date.now() - startTime);
      setFinalReport(report);
      updateStep(5, { status: "success", progress: 100, message: `✅ Report generated: ${report.verdict}`, data: report });
      ue$1.success(`🧠 Norah AI 2.0 Activation Complete: ${report.verdict}`, {
        description: `Overall Performance: ${report.overall_performance_percentage}%`
      });
    } catch (error) {
      const currentStep = steps.findIndex((s) => s.status === "running");
      if (currentStep >= 0) {
        updateStep(currentStep, { status: "error", progress: 0, message: `❌ ${error.message}` });
      }
      ue$1.error("Intelligence Activation Failed", { description: error.message });
    } finally {
      setIsRunning(false);
    }
  };
  const runIntelligenceEvaluation = async () => {
    const questions = INTELLIGENCE_EVAL_QUESTIONS;
    const results = { correct_at_1: 0, correct_at_3: 0, total_similarity: 0, questions: [] };
    for (let i = 0; i < questions.length; i++) {
      const q = questions[i];
      try {
        const response = await norahSearch({ q: q.query, top_k: 6 });
        const hits = response.hits || [];
        const similarityScore = hits[0]?.distance || 1;
        results.total_similarity += similarityScore;
        const top1Match = hits[0]?.chunk_text?.toLowerCase().includes(q.expected_keywords[0].toLowerCase());
        const top3Match = hits.slice(0, 3).some(
          (h) => q.expected_keywords.some((k) => h.chunk_text?.toLowerCase().includes(k.toLowerCase()))
        );
        if (top1Match) results.correct_at_1++;
        if (top3Match) results.correct_at_3++;
        results.questions.push({ question: q.query, top1Match, top3Match, similarity: similarityScore });
      } catch (error) {
        console.error(`Eval question ${i} failed:`, error);
      }
    }
    const pass_at_1 = results.correct_at_1 / questions.length;
    const pass_at_3 = results.correct_at_3 / questions.length;
    const avg_similarity = results.total_similarity / questions.length;
    const contextual_reasoning = Math.min(10, pass_at_3 * 12);
    const semantic_depth = Math.min(10, (1 - avg_similarity) * 15);
    const cross_module_understanding = Math.min(10, pass_at_1 * 13);
    return {
      pass_at_1,
      pass_at_3,
      avg_similarity,
      contextual_reasoning,
      semantic_depth,
      cross_module_understanding,
      details: results.questions
    };
  };
  const runCrossQueryValidation = async () => {
    const testQueries = [
      "Come il sistema BUZZ si sincronizza con Supabase Realtime?",
      "Che differenza c'è tra Push SAFE Guard e cron automatico?",
      "Come Norah AI gestisce i pattern aptici nelle notifiche?",
      "Quali regole governano il Final Shot?",
      "Come funziona l'anti-forcing nelle missioni M1SSION?"
    ];
    let successful = 0;
    for (const query of testQueries) {
      try {
        const response = await norahSearch({ q: query, top_k: 3 });
        if (response.hits && response.hits.length > 0 && response.hits[0].distance < 0.45) {
          successful++;
        }
      } catch (error) {
        console.error("Cross-query failed:", error);
      }
    }
    return { total: testQueries.length, successful, success_rate: successful / testQueries.length };
  };
  const generateFinalReport = (results, executionTime) => {
    const kpis = results.kpis || {};
    const evalResults = results.evalResults || {};
    const crossQuery = results.crossQueryResults || {};
    const kb_completion = Math.min(100, (kpis.documents || 0) / 200 * 100);
    const eval_score = ((evalResults.pass_at_1 || 0) * 0.3 + (evalResults.pass_at_3 || 0) * 0.3 + (1 - (evalResults.avg_similarity || 1)) * 0.2 + (crossQuery.success_rate || 0) * 0.2) * 100;
    const intelligence_gain = ((evalResults.pass_at_1 || 0) - 0.45) * 100;
    const overall_performance = kb_completion * 0.3 + eval_score * 0.5 + (crossQuery.success_rate || 0) * 100 * 0.2;
    let verdict = "SAME ⚠️";
    if (overall_performance >= 90 && evalResults.pass_at_1 >= 0.65) verdict = "SMARTER ✅";
    else if (overall_performance < 70) verdict = "REGRESSION ❌";
    const recommendations = [];
    if (kpis.documents < 200) recommendations.push("Increase knowledge base to ≥200 documents");
    if (evalResults.pass_at_1 < 0.65) recommendations.push("Improve document quality and chunking strategy");
    if (crossQuery.success_rate < 0.8) recommendations.push("Enhance cross-module semantic linking");
    if (overall_performance >= 95) recommendations.push("🎉 Excellent! Consider production deployment");
    return {
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      execution_time_seconds: executionTime / 1e3,
      steps,
      knowledge_base: {
        total_docs: kpis.documents || 0,
        total_embeddings: kpis.embeddings || 0,
        target_docs: 200,
        completion_percentage: kb_completion
      },
      intelligence_metrics: {
        pass_at_1: evalResults.pass_at_1 || 0,
        pass_at_3: evalResults.pass_at_3 || 0,
        avg_similarity: evalResults.avg_similarity || 1,
        contextual_reasoning: evalResults.contextual_reasoning || 0,
        semantic_depth: evalResults.semantic_depth || 0,
        cross_module_understanding: evalResults.cross_module_understanding || 0
      },
      scheduler_status: {
        enabled: false,
        // User can enable manually
        next_crawl: "06:00 UTC",
        next_embed: "07:00 UTC"
      },
      cross_query_validation: {
        total_queries: crossQuery.total || 0,
        successful_queries: crossQuery.successful || 0,
        success_rate: crossQuery.success_rate || 0
      },
      intelligence_gain_percentage: intelligence_gain,
      overall_performance_percentage: overall_performance,
      verdict,
      recommendations
    };
  };
  const exportReport = () => {
    if (!finalReport) return;
    const blob = new Blob([JSON.stringify(finalReport, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `norah-intelligence-${(/* @__PURE__ */ new Date()).toISOString().split("T")[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
    ue$1.success("Report exported successfully");
  };
  const getStepIcon = (status) => {
    switch (status) {
      case "success":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-5 h-5 text-green-500" });
      case "error":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-5 h-5 text-red-500" });
      case "running":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-5 h-5 animate-spin text-primary" });
      default:
        return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-5 h-5 rounded-full border-2 border-muted" });
    }
  };
  const overallProgress = steps.reduce((sum, step) => sum + step.progress, 0) / steps.length;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2 font-orbitron", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Brain, { className: "w-6 h-6" }),
            "🧠 NORAH AI 2.0 Intelligence Activation System"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Automated full-stack intelligence verification and deployment" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: runFullActivation,
            disabled: isRunning,
            size: "lg",
            className: "font-orbitron",
            children: isRunning ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-5 h-5 mr-2 animate-spin" }),
              "Running..."
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Play, { className: "w-5 h-5 mr-2" }),
              "🚀 Start Full Activation"
            ] })
          }
        )
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
        isRunning && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Overall Progress" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "font-semibold", children: [
              overallProgress.toFixed(1),
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: overallProgress, className: "h-2" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: steps.map((step, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3 p-3 rounded-lg border", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-0.5", children: getStepIcon(step.status) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-semibold text-sm", children: step.name }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: step.status === "success" ? "default" : "secondary", children: step.status })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: step.message }),
            step.status === "running" && /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: step.progress, className: "h-1" })
          ] })
        ] }, index)) })
      ] })
    ] }),
    finalReport && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "border-2 border-primary", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "font-orbitron text-2xl", children: "🧠 NORAH AI 2.0 — FINAL INTELLIGENCE REPORT" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: exportReport, variant: "outline", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Download, { className: "w-4 h-4 mr-2" }),
          "Export JSON"
        ] })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center p-6 rounded-lg bg-primary/10", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-3xl font-orbitron font-bold mb-2", children: finalReport.verdict }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xl font-semibold text-primary", children: [
            "Overall Performance: ",
            finalReport.overall_performance_percentage.toFixed(1),
            "%"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-muted-foreground mt-2", children: [
            "Execution Time: ",
            finalReport.execution_time_seconds.toFixed(2),
            "s"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1 p-3 rounded-lg bg-muted", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Documents" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-2xl font-bold", children: finalReport.knowledge_base.total_docs }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground", children: [
              "Target: ",
              finalReport.knowledge_base.target_docs
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1 p-3 rounded-lg bg-muted", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Embeddings" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-2xl font-bold", children: finalReport.knowledge_base.total_embeddings })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1 p-3 rounded-lg bg-muted", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "KB Completion" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-2xl font-bold", children: [
              finalReport.knowledge_base.completion_percentage.toFixed(1),
              "%"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1 p-3 rounded-lg bg-muted", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Intelligence Gain" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-2xl font-bold text-green-500", children: [
              "+",
              finalReport.intelligence_gain_percentage.toFixed(1),
              "%"
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold mb-3", children: "Intelligence Metrics" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 md:grid-cols-3 gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Pass@1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "font-semibold", children: [
                  (finalReport.intelligence_metrics.pass_at_1 * 100).toFixed(1),
                  "%"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: finalReport.intelligence_metrics.pass_at_1 * 100 })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Pass@3" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "font-semibold", children: [
                  (finalReport.intelligence_metrics.pass_at_3 * 100).toFixed(1),
                  "%"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: finalReport.intelligence_metrics.pass_at_3 * 100 })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Contextual Reasoning" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "font-semibold", children: [
                  finalReport.intelligence_metrics.contextual_reasoning.toFixed(1),
                  "/10"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: finalReport.intelligence_metrics.contextual_reasoning * 10 })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Semantic Depth" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "font-semibold", children: [
                  finalReport.intelligence_metrics.semantic_depth.toFixed(1),
                  "/10"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: finalReport.intelligence_metrics.semantic_depth * 10 })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Cross-Module Understanding" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "font-semibold", children: [
                  finalReport.intelligence_metrics.cross_module_understanding.toFixed(1),
                  "/10"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: finalReport.intelligence_metrics.cross_module_understanding * 10 })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-sm", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Cross-Query Success" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "font-semibold", children: [
                  (finalReport.cross_query_validation.success_rate * 100).toFixed(1),
                  "%"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: finalReport.cross_query_validation.success_rate * 100 })
            ] })
          ] })
        ] }),
        finalReport.recommendations.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold mb-2", children: "Recommendations" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-1", children: finalReport.recommendations.map((rec, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { className: "text-sm flex items-start gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-primary", children: "•" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: rec })
          ] }, i)) })
        ] })
      ] })
    ] })
  ] });
}

function NorahAdmin() {
  const [kpis, setKpis] = reactExports.useState(null);
  const loadKpis = async () => {
    try {
      const result = await norahKpis();
      setKpis(result);
    } catch (error) {
      console.error("Failed to load KPIs:", error);
    }
  };
  reactExports.useEffect(() => {
    loadKpis();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-background p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-7xl mx-auto space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-2 rounded-lg bg-primary/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Brain, { className: "w-6 h-6 text-primary" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-orbitron font-bold bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent", children: "Norah AI 2.0" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-muted-foreground font-rajdhani", children: [
            "Baseline: ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "text-xs bg-muted px-1 rounded", children: "88dfb241" }),
            " • KB: ",
            kpis?.documents || 0,
            " docs • ",
            kpis?.embeddings || 0,
            " emb"
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "font-mono text-xs", children: "Stable 2.0 (No 2.1)" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Tabs, { defaultValue: "activation", className: "w-full", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsList, { className: "grid w-full grid-cols-7", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "activation", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-4 h-4 mr-2" }),
          "Activation"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "sources", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Upload, { className: "w-4 h-4 mr-2" }),
          "Sources"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "ingest", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Upload, { className: "w-4 h-4 mr-2" }),
          "Bulk Ingest"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "eval", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(TestTube, { className: "w-4 h-4 mr-2" }),
          "Evaluation"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "scheduler", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Clock, { className: "w-4 h-4 mr-2" }),
          "Scheduler"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "kpi", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(ChartNoAxesColumnIncreasing, { className: "w-4 h-4 mr-2" }),
          "KPIs"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(TabsTrigger, { value: "legacy", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "w-4 h-4 mr-2" }),
          "E2E Tests"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "activation", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligenceActivation, { onComplete: loadKpis }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "sources", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ContentSources, {}) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "ingest", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(BulkIngest, { onComplete: loadKpis }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "eval", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(EvalHarness, {}) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "scheduler", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Scheduler, { onTrigger: loadKpis }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "kpi", className: "space-y-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(KPIPanel, {}) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(TabsContent, { value: "legacy", className: "space-y-4", children: false })
    ] })
  ] }) });
}

let _instanceCount = 0;
let _lastInitStack = "";
function getSupabaseDiag() {
  return {
    count: _instanceCount,
    lastInitStack: _lastInitStack,
    env: {
      mode: "production",
      dev: false,
      prod: true
    }
  };
}

function DiagSupabase() {
  const [rpcHealth, setRpcHealth] = React$1.useState(null);
  const [rpcError, setRpcError] = React$1.useState(null);
  React$1.useEffect(() => {
    void supabase.auth.getSession();
  }, []);
  React$1.useEffect(() => {
    (async () => {
      try {
        const { data, error } = await supabase.rpc("supabase_client_health");
        if (error) {
          setRpcError(error.message);
          console.warn("[SUPABASE-DIAG] RPC error:", error);
        } else {
          setRpcHealth(data);
        }
      } catch (err) {
        setRpcError(err?.message || String(err));
        console.warn("[SUPABASE-DIAG] RPC exception:", err);
      }
    })();
  }, []);
  const diag = getSupabaseDiag();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { padding: 24, fontFamily: "ui-sans-serif, system-ui", maxWidth: 800 }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { style: { fontSize: 24, fontWeight: "bold", marginBottom: 16 }, children: "🔍 Supabase Runtime Diagnostics" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: 24 }, children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { style: { fontSize: 18, fontWeight: 600, marginBottom: 8 }, children: "Client Instances" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Count:" }),
        " ",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { style: {
          color: "#ef4444",
          fontWeight: "bold",
          fontSize: 20
        }, children: diag.count })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { style: { marginTop: 4, color: "#6b7280" }, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Expected:" }),
        " count === 1 (singleton pattern)"
      ] }),
      diag.count > 1
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: { marginBottom: 24 }, children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { style: { fontSize: 18, fontWeight: 600, marginBottom: 8 }, children: "Environment" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { style: { listStyle: "none", padding: 0 }, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Mode:" }),
          " ",
          diag.env.mode
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Dev:" }),
          " ",
          String(diag.env.dev)
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Prod:" }),
          " ",
          String(diag.env.prod)
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("hr", { style: { margin: "24px 0", border: "none", borderTop: "1px solid #e5e7eb" } }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { style: { fontSize: 18, fontWeight: 600, marginBottom: 8 }, children: "Supabase Health (RPC)" }),
      rpcError ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { style: {
        padding: 12,
        backgroundColor: "#fef2f2",
        border: "1px solid #fecaca",
        borderRadius: 4,
        color: "#991b1b"
      }, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Error:" }),
        " ",
        rpcError
      ] }) : rpcHealth ? /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { style: {
        whiteSpace: "pre-wrap",
        backgroundColor: "#f3f4f6",
        padding: 12,
        borderRadius: 4,
        fontSize: 13,
        overflow: "auto"
      }, children: JSON.stringify(rpcHealth, null, 2) }) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { style: { color: "#6b7280" }, children: "Loading health metrics..." })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { style: { marginTop: 24, padding: 12, backgroundColor: "#f0fdf4", borderRadius: 4 }, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { style: { fontSize: 14, color: "#166534" }, children: [
      "ℹ️ This page verifies that the Supabase client is a proper singleton. Navigate through the app and return here — the count should remain ",
      /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "1" }),
      "."
    ] }) })
  ] });
}

const SUPABASE_CONFIG = getSupabaseConfig();
function SupabaseConnectionTest() {
  const [status, setStatus] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  const runTest = async () => {
    setLoading(true);
    const errors = [];
    const warnings = [];
    try {
      const { error } = await supabase.from("profiles").select("id").limit(1);
      if (error) errors.push(`Database query failed: ${error.message}`);
    } catch (err) {
      errors.push(`Database connection error: ${err?.message || "Unknown error"}`);
    }
    const result = {
      connected: errors.length === 0,
      projectRef: SUPABASE_CONFIG.projectRef,
      url: SUPABASE_CONFIG.url,
      errors,
      warnings
    };
    setStatus(result);
    setLoading(false);
  };
  reactExports.useEffect(() => {
    runTest();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-background p-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold", children: "🔍 Supabase Connection Test" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground mt-2", children: "Post-Remix diagnostic tool" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: runTest, disabled: loading, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: `w-4 h-4 mr-2 ${loading ? "animate-spin" : ""}` }),
        "Re-test"
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Current Configuration" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Environment variables detected" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-muted-foreground", children: "Project Ref" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-mono text-sm mt-1", children: SUPABASE_CONFIG.projectRef })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-muted-foreground", children: "URL" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-mono text-sm mt-1 truncate", title: SUPABASE_CONFIG.url, children: SUPABASE_CONFIG.url })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-muted-foreground", children: "Anon Key" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-mono text-sm mt-1", children: `${SUPABASE_CONFIG.anonKey.substring(0, 20)}...`  })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-muted-foreground", children: "Functions URL" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-mono text-sm mt-1 truncate", title: SUPABASE_CONFIG.functionsUrl, children: SUPABASE_CONFIG.functionsUrl || "❌ Not found" })
        ] })
      ] }) })
    ] }),
    status && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Connection Status" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: status.connected ? "default" : "destructive", children: status.connected ? "✅ Connected" : "❌ Disconnected" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        status.errors.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "w-5 h-5 text-destructive" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "font-semibold text-destructive", children: [
              "Errors (",
              status.errors.length,
              ")"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-2 ml-7", children: status.errors.map((error, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { className: "text-sm text-destructive bg-destructive/10 p-3 rounded-md", children: error }, i)) })
        ] }),
        status.warnings.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "w-5 h-5 text-yellow-500" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "font-semibold text-yellow-500", children: [
              "Warnings (",
              status.warnings.length,
              ")"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-2 ml-7", children: status.warnings.map((warning, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("li", { className: "text-sm text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-950/20 p-3 rounded-md", children: warning }, i)) })
        ] }),
        status.connected && status.errors.length === 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-5 h-5 text-green-500" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-green-500", children: "All Checks Passed!" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground ml-7", children: "Your Supabase connection is configured correctly and working as expected." })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "Next Steps" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-sm", children: "✅ If all checks passed:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground ml-4", children: "Your migration is complete! The project is now connected to your personal Supabase." })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-sm", children: "❌ If you see errors:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("ol", { className: "text-sm text-muted-foreground ml-4 space-y-1 list-decimal list-inside", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { children: [
              "Go to ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Settings → Tools → Supabase" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Verify your Supabase credentials are correct" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Try reconnecting the integration" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Rebuild the project (automatic)" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: 'Return here and click "Re-test"' })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-4 p-4 bg-muted rounded-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm", children: [
          "📖 For detailed migration instructions, see",
          " ",
          /* @__PURE__ */ jsxRuntimeExports.jsx("code", { className: "bg-background px-2 py-1 rounded", children: "SUPABASE_MIGRATION_GUIDE.md" })
        ] }) })
      ] })
    ] })
  ] }) });
}

function DeviceTokenDebug() {
  const [deviceTokens, setDeviceTokens] = reactExports.useState([]);
  const [testing, setTesting] = reactExports.useState(false);
  const [testResults, setTestResults] = reactExports.useState([]);
  const [loading, setLoading] = reactExports.useState(false);
  const loadDeviceTokens = async () => {
    setLoading(true);
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      const { data, error } = await supabase.from("device_tokens").select("*").eq("user_id", user.id).order("created_at", { ascending: false });
      if (error) {
        console.error("❌ Error loading device tokens:", error);
        ue$1.error("Errore caricamento token");
      } else {
        setDeviceTokens(data || []);
        console.log("📱 Device tokens loaded:", data);
      }
    } catch (error) {
      console.error("❌ Error in loadDeviceTokens:", error);
    } finally {
      setLoading(false);
    }
  };
  const registerTestToken = async () => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        ue$1.error("Utente non autenticato");
        return;
      }
      const testPlayerId = `onesignal-test-${user.id}-${Date.now()}`;
      const { error } = await supabase.from("device_tokens").upsert({
        user_id: user.id,
        token: testPlayerId,
        device_type: "onesignal",
        device_info: { platform: "web", source: "debug_test", created: (/* @__PURE__ */ new Date()).toISOString() },
        is_active: true,
        last_used: (/* @__PURE__ */ new Date()).toISOString(),
        created_at: (/* @__PURE__ */ new Date()).toISOString()
      }, {
        onConflict: "user_id,device_type"
      });
      if (error) {
        console.error("❌ Error registering test token:", error);
        ue$1.error("Errore registrazione token test");
      } else {
        console.log("✅ Test token registered:", testPlayerId);
        ue$1.success("Token OneSignal test registrato!");
        loadDeviceTokens();
      }
    } catch (error) {
      console.error("❌ Error in registerTestToken:", error);
    }
  };
  const testPushNotification = async (testNumber) => {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user || deviceTokens.length === 0) {
      ue$1.error("Nessun token device registrato");
      return;
    }
    setTesting(true);
    const testTitle = `🎯 M1SSION™ Test ${testNumber}`;
    const testBody = `Test push notification #${testNumber} - ${(/* @__PURE__ */ new Date()).toLocaleTimeString()}`;
    try {
      console.log(`🚀 Starting push test #${testNumber}`);
      const { data, error } = await supabase.functions.invoke("send-push-notification", {
        body: {
          title: testTitle,
          body: testBody,
          target_user_id: user.id
        }
      });
      const result = {
        testNumber,
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        success: !error && data?.success,
        data,
        error: error?.message,
        sent: data?.sent || 0,
        total: data?.total || 0
      };
      setTestResults((prev) => [result, ...prev]);
      if (error) {
        console.error(`❌ Test #${testNumber} failed:`, error);
        ue$1.error(`Test #${testNumber} fallito: ${error.message}`);
      } else {
        console.log(`✅ Test #${testNumber} success:`, data);
        ue$1.success(`Test #${testNumber} inviato: ${data.sent}/${data.total} dispositivi`);
      }
    } catch (err) {
      console.error(`❌ Test #${testNumber} exception:`, err);
      ue$1.error(`Test #${testNumber} errore di sistema`);
    } finally {
      setTesting(false);
    }
  };
  const runAllTests = async () => {
    if (testing) return;
    setTestResults([]);
    for (let i = 1; i <= 3; i++) {
      await testPushNotification(i);
      if (i < 3) {
        await new Promise((resolve) => setTimeout(resolve, 2e3));
      }
    }
  };
  const checkOneSignalStatus = async () => {
    try {
      const utils = window.OneSignalUtils;
      if (utils) {
        const playerId = await utils.getPlayerId();
        const isSubscribed = await utils.isSubscribed();
        console.log("🔔 OneSignal Status:", {
          playerId,
          isSubscribed,
          available: !!utils
        });
        ue$1.success(`OneSignal: ${isSubscribed ? "Attivo" : "Non attivo"} - ID: ${playerId}`);
      } else {
        console.log("⚠️ OneSignal Utils not available");
        ue$1.warning("OneSignal non disponibile (environment dev)");
      }
    } catch (error) {
      console.error("❌ Error checking OneSignal status:", error);
    }
  };
  reactExports.useEffect(() => {
    loadDeviceTokens();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-8 p-6 bg-gray-900 rounded-lg border border-gray-700", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-bold text-[#00D1FF] mb-4", children: "🔧 Push Notifications Debug" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "font-semibold text-white mb-2", children: [
        "📱 Device Tokens (",
        deviceTokens.length,
        ")"
      ] }),
      deviceTokens.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-yellow-400", children: "⚠️ Nessun token registrato" }) : deviceTokens.map((token, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm bg-gray-800 p-2 rounded mb-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-green-400", children: "✅" }),
        " ",
        token.device_type,
        ": ",
        token.token.substring(0, 20),
        "...",
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-gray-400 ml-2", children: [
          "(",
          new Date(token.created_at).toLocaleString(),
          ")"
        ] })
      ] }, index))
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-3 mb-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: loadDeviceTokens,
          disabled: loading,
          className: "bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-4 py-2 rounded",
          children: [
            loading ? "⏳" : "🔄",
            " Refresh Tokens"
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: registerTestToken,
          className: "bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded",
          children: "🔧 Registra Token Test"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: checkOneSignalStatus,
          className: "bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded",
          children: "🔔 Check OneSignal"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => testPushNotification(1),
          disabled: testing || deviceTokens.length === 0,
          className: "bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-white px-4 py-2 rounded",
          children: "🚀 Test Push Singolo"
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "grid grid-cols-1 gap-3 mb-6", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        onClick: runAllTests,
        disabled: testing || deviceTokens.length === 0,
        className: "bg-red-600 hover:bg-red-700 disabled:bg-gray-600 text-white px-4 py-2 rounded",
        children: "🎯 Run All Tests (3x Consecutive)"
      }
    ) }),
    testResults.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-white mb-2", children: "📊 Test Results" }),
      testResults.map((result, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `text-sm p-2 rounded mb-1 ${result.success ? "bg-green-900/30 border border-green-700" : "bg-red-900/30 border border-red-700"}`, children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-start", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: result.success ? "text-green-400" : "text-red-400", children: [
            result.success ? "✅" : "❌",
            " Test #",
            result.testNumber
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-gray-400 text-xs", children: new Date(result.timestamp).toLocaleTimeString() })
        ] }),
        result.success ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-gray-300 text-xs mt-1", children: [
          "Sent: ",
          result.sent,
          "/",
          result.total,
          " devices"
        ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-red-300 text-xs mt-1", children: [
          "Error: ",
          result.error
        ] })
      ] }, index))
    ] }),
    testing && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center text-[#00D1FF] font-semibold mt-4", children: "🔄 Testing in progress..." }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 text-xs text-gray-400 bg-gray-800 p-3 rounded", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "📍 Environment:" }),
        " ",
        window.location.hostname
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "🔔 OneSignal:" }),
        " ",
        window.location.hostname === "m1ssion.eu" ? "Produzione" : "Disabilitato (dev)"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "🎯 Status:" }),
        " PWA pronta al 99% - Deploy su https://m1ssion.eu per test finali"
      ] })
    ] })
  ] });
}

function PushTest$1() {
  const [title, setTitle] = reactExports.useState("M1SSION™ Test");
  const [body, setBody] = reactExports.useState("Test push notification per iOS e Android");
  const [loading, setLoading] = reactExports.useState(false);
  const handleSendPush = async () => {
    if (!title || !body) {
      ue$1.error("Titolo e messaggio sono obbligatori");
      return;
    }
    setLoading(true);
    try {
      console.log("🚀 M1SSION™ PUSH TEST: Sending notification", { title, body });
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        ue$1.error("❌ Devi essere loggato per testare le push");
        return;
      }
      const { data, error } = await supabase.functions.invoke("send-push-notification", {
        body: {
          title: title.trim(),
          body: body.trim(),
          target_user_id: user.id
        }
      });
      if (error) {
        console.error("❌ M1SSION™ PUSH ERROR:", error);
        ue$1.error(`❌ ERRORE: ${error.message}`);
      } else {
        console.log("✅ M1SSION™ PUSH SUCCESSO:", data);
        if (data.success) {
          ue$1.success(`✅ SUCCESSO: Notifica inviata a ${data.sent}/${data.total} dispositivi`);
        } else {
          ue$1.error(`❌ ERRORE: ${data.message || "Invio fallito"}`);
        }
      }
    } catch (err) {
      console.error("❌ M1SSION™ PUSH EXCEPTION:", err);
      ue$1.error("❌ ERRORE: Eccezione durante invio notifica");
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-black text-white p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-md mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-center mb-8 text-[#00D1FF]", children: "🚨 Push Test M1SSION™" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "block text-sm font-medium mb-2", children: "Titolo" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "input",
          {
            type: "text",
            value: title,
            onChange: (e) => setTitle(e.target.value),
            className: "w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white",
            placeholder: "Titolo notifica"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("label", { className: "block text-sm font-medium mb-2", children: "Messaggio" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "textarea",
          {
            value: body,
            onChange: (e) => setBody(e.target.value),
            className: "w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white h-24",
            placeholder: "Testo della notifica"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: handleSendPush,
          disabled: loading,
          className: `w-full py-3 px-6 rounded-lg font-bold ${loading ? "bg-gray-600 cursor-not-allowed" : "bg-[#00D1FF] hover:bg-[#00A8CC] text-black"}`,
          children: loading ? "⏳ Invio..." : "🚀 INVIA PUSH OS-NATIVE"
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-8 p-4 bg-gray-900 rounded-lg", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-bold mb-2", children: "🔍 Test Checklist:" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "text-sm space-y-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "📱 Lock screen iOS con suono e badge" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "🤖 Lock screen Android con suono" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "📩 Notifica in /notifications in-app" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "🔔 Real-time sync immediato" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(DeviceTokenDebug, {})
  ] }) });
}

class NeuralAudioEngine {
  audioContext = null;
  masterVolume = 0.6;
  isMuted = false;
  constructor() {
    this.loadMuteState();
  }
  getContext() {
    if (!this.audioContext) {
      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    return this.audioContext;
  }
  loadMuteState() {
    try {
      const saved = localStorage.getItem("neural_mute");
      this.isMuted = saved === "true";
    } catch (e) {
      this.isMuted = false;
    }
  }
  setMuted(muted) {
    this.isMuted = muted;
    try {
      localStorage.setItem("neural_mute", String(muted));
    } catch (e) {
    }
  }
  isMutedState() {
    return this.isMuted;
  }
  setVolume(volume) {
    this.masterVolume = Math.max(0, Math.min(1, volume));
  }
  playTone(frequency, duration, type = "sine", volume = 0.3) {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();
    oscillator.type = type;
    oscillator.frequency.value = frequency;
    gainNode.gain.value = volume * this.masterVolume;
    gainNode.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + duration);
    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);
    oscillator.start(ctx.currentTime);
    oscillator.stop(ctx.currentTime + duration);
  }
  playChord(frequencies, duration, volume = 0.2) {
    frequencies.forEach((freq) => this.playTone(freq, duration, "sine", volume / frequencies.length));
  }
  // Select node sound with reverb
  playSelect() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const convolver = ctx.createConvolver();
    const impulseLength = ctx.sampleRate * 0.6;
    const impulse = ctx.createBuffer(2, impulseLength, ctx.sampleRate);
    for (let channel = 0; channel < 2; channel++) {
      const data = impulse.getChannelData(channel);
      for (let i = 0; i < impulseLength; i++) {
        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / impulseLength * 3);
      }
    }
    convolver.buffer = impulse;
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();
    const reverbGain = ctx.createGain();
    oscillator.type = "sine";
    oscillator.frequency.setValueAtTime(600, ctx.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.08);
    gainNode.gain.value = 0.2 * this.masterVolume;
    gainNode.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 0.08);
    reverbGain.gain.value = 0.3;
    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);
    gainNode.connect(convolver);
    convolver.connect(reverbGain);
    reverbGain.connect(ctx.destination);
    oscillator.start(ctx.currentTime);
    oscillator.stop(ctx.currentTime + 0.08);
  }
  // Dragging sound (FM sweep with sub rumble)
  playDrag() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const carrier = ctx.createOscillator();
    const modulator = ctx.createOscillator();
    const modulatorGain = ctx.createGain();
    const carrierGain = ctx.createGain();
    const sub = ctx.createOscillator();
    const subGain = ctx.createGain();
    carrier.type = "sine";
    carrier.frequency.setValueAtTime(500, ctx.currentTime);
    carrier.frequency.exponentialRampToValueAtTime(4e3, ctx.currentTime + 0.2);
    modulator.type = "sine";
    modulator.frequency.value = 80;
    modulatorGain.gain.value = 200;
    sub.type = "sine";
    sub.frequency.value = 55;
    subGain.gain.value = 0.08 * this.masterVolume;
    carrierGain.gain.value = 0.12 * this.masterVolume;
    carrierGain.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 0.2);
    modulator.connect(modulatorGain);
    modulatorGain.connect(carrier.frequency);
    carrier.connect(carrierGain);
    carrierGain.connect(ctx.destination);
    sub.connect(subGain);
    subGain.connect(ctx.destination);
    carrier.start(ctx.currentTime);
    modulator.start(ctx.currentTime);
    sub.start(ctx.currentTime);
    carrier.stop(ctx.currentTime + 0.2);
    modulator.stop(ctx.currentTime + 0.2);
    sub.stop(ctx.currentTime + 0.2);
  }
  // Valid connection sound with delay tail
  playConnect() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const frequencies = [261.63, 329.63, 392, 493.88, 587.33];
    frequencies.forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      const delay = ctx.createDelay();
      const delayGain = ctx.createGain();
      osc.type = "sine";
      osc.frequency.value = freq;
      gain.gain.value = 0.25 / frequencies.length * this.masterVolume;
      gain.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 0.5);
      delay.delayTime.value = 0.15;
      delayGain.gain.value = 0.4;
      osc.connect(gain);
      gain.connect(ctx.destination);
      gain.connect(delay);
      delay.connect(delayGain);
      delayGain.connect(ctx.destination);
      osc.start(ctx.currentTime + i * 0.02);
      osc.stop(ctx.currentTime + 0.5);
    });
    setTimeout(() => {
      const bufferSize = ctx.sampleRate * 0.4;
      const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / bufferSize * 4);
      }
      const source = ctx.createBufferSource();
      const filter = ctx.createBiquadFilter();
      const gainNode = ctx.createGain();
      source.buffer = buffer;
      filter.type = "highpass";
      filter.frequency.value = 3e3;
      gainNode.gain.value = 0.1 * this.masterVolume;
      source.connect(filter);
      filter.connect(gainNode);
      gainNode.connect(ctx.destination);
      source.start(ctx.currentTime);
    }, 50);
  }
  // Error sound (band-stop noise + reverse hit)
  playError() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const bufferSize = ctx.sampleRate * 0.15;
    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      const envelope = i / bufferSize;
      data[i] = (Math.random() * 2 - 1) * envelope;
    }
    const source = ctx.createBufferSource();
    const filter = ctx.createBiquadFilter();
    const gainNode = ctx.createGain();
    source.buffer = buffer;
    filter.type = "bandpass";
    filter.frequency.value = 500;
    filter.Q.value = 8;
    gainNode.gain.value = 0.25 * this.masterVolume;
    source.connect(filter);
    filter.connect(gainNode);
    gainNode.connect(ctx.destination);
    source.start(ctx.currentTime);
  }
  // Cinematic victory sequence (2s rise + pulse drop + reverb tail)
  playVictory() {
    if (this.isMuted) return;
    const ctx = this.getContext();
    const notes = [261.63, 329.63, 392, 493.88, 587.33, 783.99];
    const convolver = ctx.createConvolver();
    const impulseLength = ctx.sampleRate * 2;
    const impulse = ctx.createBuffer(2, impulseLength, ctx.sampleRate);
    for (let channel = 0; channel < 2; channel++) {
      const data = impulse.getChannelData(channel);
      for (let i = 0; i < impulseLength; i++) {
        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / impulseLength * 2);
      }
    }
    convolver.buffer = impulse;
    notes.forEach((freq, i) => {
      setTimeout(() => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        const reverbGain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.value = freq;
        gain.gain.value = 0.2 / notes.length * this.masterVolume;
        gain.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 0.8);
        reverbGain.gain.value = 0.5;
        osc.connect(gain);
        gain.connect(ctx.destination);
        gain.connect(convolver);
        convolver.connect(reverbGain);
        reverbGain.connect(ctx.destination);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.8);
      }, i * 150);
    });
    setTimeout(() => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      const filter = ctx.createBiquadFilter();
      osc.type = "sawtooth";
      osc.frequency.value = 130.81;
      filter.type = "lowpass";
      filter.frequency.value = 200;
      gain.gain.value = 0.3 * this.masterVolume;
      gain.gain.exponentialRampToValueAtTime(1e-3, ctx.currentTime + 1.2);
      osc.connect(filter);
      filter.connect(gain);
      gain.connect(ctx.destination);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 1.2);
    }, 1e3);
  }
}
new NeuralAudioEngine();

class DNAErrorBoundary extends reactExports.Component {
  state = { err: void 0 };
  static getDerivedStateFromError(err) {
    return { err };
  }
  componentDidCatch(error, errorInfo) {
    console.error("[DNA ErrorBoundary] Caught error:", error, errorInfo);
  }
  render() {
    if (this.state.err) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full h-screen flex items-center justify-center bg-background", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center max-w-md p-6", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-destructive text-lg font-semibold mb-2", children: "DNA Module Error" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground text-sm", children: "An error occurred while loading the DNA experience. Please refresh the page." }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: () => window.location.reload(),
            className: "mt-4 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",
            children: "Reload Page"
          }
        )
      ] }) });
    }
    return this.props.children;
  }
}

const DNAEvolutionScene = ({
  isOpen,
  archetype,
  onComplete
}) => {
  const [phase, setPhase] = reactExports.useState("intro");
  const archetypeConfig = ARCHETYPE_CONFIGS[archetype];
  const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  reactExports.useEffect(() => {
    if (!isOpen) {
      setPhase("intro");
      return;
    }
    const introTimer = setTimeout(() => setPhase("reveal"), 1e3);
    const revealTimer = setTimeout(() => setPhase("outro"), 4e3);
    const closeTimer = setTimeout(() => {
      onComplete();
    }, 5e3);
    return () => {
      clearTimeout(introTimer);
      clearTimeout(revealTimer);
      clearTimeout(closeTimer);
    };
  }, [isOpen, onComplete]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: () => {
  }, children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    DialogContent,
    {
      className: "max-w-full w-full h-full bg-black border-none p-0 flex items-center justify-center",
      style: { maxWidth: "100vw", maxHeight: "100vh" },
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(AnimatePresence, { mode: "wait", children: [
        phase === "intro" && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { opacity: 0 },
            animate: { opacity: 1 },
            exit: { opacity: 0 },
            className: "absolute inset-0 bg-black"
          },
          "intro"
        ),
        phase === "reveal" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, scale: 0.5 },
            animate: { opacity: 1, scale: 1 },
            exit: { opacity: 0, scale: 1.5 },
            transition: { duration: 1, ease: "easeOut" },
            className: "relative z-10 flex flex-col items-center justify-center gap-8",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "absolute inset-0 pointer-events-none",
                  animate: prefersReducedMotion ? {} : {
                    scale: [1, 1.2, 1],
                    opacity: [0.3, 0.5, 0.3]
                  },
                  transition: prefersReducedMotion ? {} : {
                    duration: 2,
                    repeat: Infinity,
                    ease: "easeInOut"
                  },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "div",
                    {
                      className: "w-[600px] h-[600px] rounded-full blur-[120px]",
                      style: {
                        background: `radial-gradient(circle, ${archetypeConfig.color}, transparent 70%)`
                      }
                    }
                  )
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "relative z-10",
                  animate: prefersReducedMotion ? {} : {
                    scale: [0.9, 1.1, 1],
                    rotate: [0, 5, -5, 0]
                  },
                  transition: prefersReducedMotion ? {} : {
                    duration: 2,
                    ease: "easeInOut"
                  },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    ArchetypeIcon,
                    {
                      archetype,
                      size: 160
                    }
                  )
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  initial: { opacity: 0, y: 20 },
                  animate: { opacity: 1, y: 0 },
                  transition: { delay: 0.5, duration: 0.8 },
                  className: "text-center space-y-4 max-w-2xl px-6",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        className: "text-4xl md:text-6xl font-black",
                        style: {
                          color: archetypeConfig.color,
                          textShadow: `0 0 30px ${archetypeConfig.color}80`
                        },
                        children: archetypeConfig.nameIt
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs(
                      motion.div,
                      {
                        className: "text-base md:text-xl text-white/80 font-medium",
                        initial: { opacity: 0 },
                        animate: { opacity: 1 },
                        transition: { delay: 0.8 },
                        children: [
                          "Sequenza M1-HEX riscritta.",
                          /* @__PURE__ */ jsxRuntimeExports.jsx("br", {}),
                          "Il tuo codice vibra con una nuova frequenza."
                        ]
                      }
                    )
                  ]
                }
              ),
              !prefersReducedMotion && [...Array(18)].map((_, i) => {
                const isOuter = i >= 12;
                const angle = i % 12 / 12 * Math.PI * 2;
                const distance = isOuter ? 350 : 300;
                return /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "absolute rounded-full",
                    style: {
                      width: isOuter ? "3px" : "2px",
                      height: isOuter ? "3px" : "2px",
                      backgroundColor: archetypeConfig.color,
                      left: "50%",
                      top: "50%"
                    },
                    animate: {
                      x: [0, Math.cos(angle) * distance],
                      y: [0, Math.sin(angle) * distance],
                      opacity: [1, 0],
                      scale: [1, 0]
                    },
                    transition: {
                      duration: isOuter ? 2.3 : 2,
                      ease: "easeOut",
                      repeat: Infinity,
                      repeatDelay: isOuter ? 0.3 : 0.5,
                      delay: isOuter ? 0.2 : 0
                    }
                  },
                  i
                );
              })
            ]
          },
          "reveal"
        ),
        phase === "outro" && /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { opacity: 1 },
            animate: { opacity: 0 },
            className: "absolute inset-0 bg-black"
          },
          "outro"
        )
      ] })
    }
  ) });
};

/**
 * Fires when the camera has been transformed by the controls.
 *
 * @event OrbitControls#change
 * @type {Object}
 */
const _changeEvent = { type: 'change' };

/**
 * Fires when an interaction was initiated.
 *
 * @event OrbitControls#start
 * @type {Object}
 */
const _startEvent = { type: 'start' };

/**
 * Fires when an interaction has finished.
 *
 * @event OrbitControls#end
 * @type {Object}
 */
const _endEvent = { type: 'end' };

const _ray = new Ray();
const _plane = new Plane();
const _TILT_LIMIT = Math.cos( 70 * MathUtils.DEG2RAD );

const _v = new Vector3();
const _twoPI = 2 * Math.PI;

const _STATE = {
	NONE: -1,
	ROTATE: 0,
	DOLLY: 1,
	PAN: 2,
	TOUCH_ROTATE: 3,
	TOUCH_PAN: 4,
	TOUCH_DOLLY_PAN: 5,
	TOUCH_DOLLY_ROTATE: 6
};
const _EPS = 0.000001;


/**
 * Orbit controls allow the camera to orbit around a target.
 *
 * OrbitControls performs orbiting, dollying (zooming), and panning. Unlike {@link TrackballControls},
 * it maintains the "up" direction `object.up` (+Y by default).
 *
 * - Orbit: Left mouse / touch: one-finger move.
 * - Zoom: Middle mouse, or mousewheel / touch: two-finger spread or squish.
 * - Pan: Right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move.
 *
 * ```js
 * const controls = new OrbitControls( camera, renderer.domElement );
 *
 * // controls.update() must be called after any manual changes to the camera's transform
 * camera.position.set( 0, 20, 100 );
 * controls.update();
 *
 * function animate() {
 *
 * 	// required if controls.enableDamping or controls.autoRotate are set to true
 * 	controls.update();
 *
 * 	renderer.render( scene, camera );
 *
 * }
 * ```
 *
 * @augments Controls
 * @three_import import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
 */
class OrbitControls extends Controls {

	/**
	 * Constructs a new controls instance.
	 *
	 * @param {Object3D} object - The object that is managed by the controls.
	 * @param {?HTMLDOMElement} domElement - The HTML element used for event listeners.
	 */
	constructor( object, domElement = null ) {

		super( object, domElement );

		this.state = _STATE.NONE;

		/**
		 * The focus point of the controls, the `object` orbits around this.
		 * It can be updated manually at any point to change the focus of the controls.
		 *
		 * @type {Vector3}
		 */
		this.target = new Vector3();

		/**
		 * The focus point of the `minTargetRadius` and `maxTargetRadius` limits.
		 * It can be updated manually at any point to change the center of interest
		 * for the `target`.
		 *
		 * @type {Vector3}
		 */
		this.cursor = new Vector3();

		/**
		 * How far you can dolly in (perspective camera only).
		 *
		 * @type {number}
		 * @default 0
		 */
		this.minDistance = 0;

		/**
		 * How far you can dolly out (perspective camera only).
		 *
		 * @type {number}
		 * @default Infinity
		 */
		this.maxDistance = Infinity;

		/**
		 * How far you can zoom in (orthographic camera only).
		 *
		 * @type {number}
		 * @default 0
		 */
		this.minZoom = 0;

		/**
		 * How far you can zoom out (orthographic camera only).
		 *
		 * @type {number}
		 * @default Infinity
		 */
		this.maxZoom = Infinity;

		/**
		 * How close you can get the target to the 3D `cursor`.
		 *
		 * @type {number}
		 * @default 0
		 */
		this.minTargetRadius = 0;

		/**
		 * How far you can move the target from the 3D `cursor`.
		 *
		 * @type {number}
		 * @default Infinity
		 */
		this.maxTargetRadius = Infinity;

		/**
		 * How far you can orbit vertically, lower limit. Range is `[0, Math.PI]` radians.
		 *
		 * @type {number}
		 * @default 0
		 */
		this.minPolarAngle = 0;

		/**
		 * How far you can orbit vertically, upper limit. Range is `[0, Math.PI]` radians.
		 *
		 * @type {number}
		 * @default Math.PI
		 */
		this.maxPolarAngle = Math.PI;

		/**
		 * How far you can orbit horizontally, lower limit. If set, the interval `[ min, max ]`
		 * must be a sub-interval of `[ - 2 PI, 2 PI ]`, with `( max - min < 2 PI )`.
		 *
		 * @type {number}
		 * @default -Infinity
		 */
		this.minAzimuthAngle = - Infinity;

		/**
		 * How far you can orbit horizontally, upper limit. If set, the interval `[ min, max ]`
		 * must be a sub-interval of `[ - 2 PI, 2 PI ]`, with `( max - min < 2 PI )`.
		 *
		 * @type {number}
		 * @default -Infinity
		 */
		this.maxAzimuthAngle = Infinity;

		/**
		 * Set to `true` to enable damping (inertia), which can be used to give a sense of weight
		 * to the controls. Note that if this is enabled, you must call `update()` in your animation
		 * loop.
		 *
		 * @type {boolean}
		 * @default false
		 */
		this.enableDamping = false;

		/**
		 * The damping inertia used if `enableDamping` is set to `true`.
		 *
		 * Note that for this to work, you must call `update()` in your animation loop.
		 *
		 * @type {number}
		 * @default 0.05
		 */
		this.dampingFactor = 0.05;

		/**
		 * Enable or disable zooming (dollying) of the camera.
		 *
		 * @type {boolean}
		 * @default true
		 */
		this.enableZoom = true;

		/**
		 * Speed of zooming / dollying.
		 *
		 * @type {number}
		 * @default 1
		 */
		this.zoomSpeed = 1.0;

		/**
		 * Enable or disable horizontal and vertical rotation of the camera.
		 *
		 * Note that it is possible to disable a single axis by setting the min and max of the
		 * `minPolarAngle` or `minAzimuthAngle` to the same value, which will cause the vertical
		 * or horizontal rotation to be fixed at that value.
		 *
		 * @type {boolean}
		 * @default true
		 */
		this.enableRotate = true;

		/**
		 * Speed of rotation.
		 *
		 * @type {number}
		 * @default 1
		 */
		this.rotateSpeed = 1.0;

		/**
		 * How fast to rotate the camera when the keyboard is used.
		 *
		 * @type {number}
		 * @default 1
		 */
		this.keyRotateSpeed = 1.0;

		/**
		 * Enable or disable camera panning.
		 *
		 * @type {boolean}
		 * @default true
		 */
		this.enablePan = true;

		/**
		 * Speed of panning.
		 *
		 * @type {number}
		 * @default 1
		 */
		this.panSpeed = 1.0;

		/**
		 * Defines how the camera's position is translated when panning. If `true`, the camera pans
		 * in screen space. Otherwise, the camera pans in the plane orthogonal to the camera's up
		 * direction.
		 *
		 * @type {boolean}
		 * @default true
		 */
		this.screenSpacePanning = true;

		/**
		 * How fast to pan the camera when the keyboard is used in
		 * pixels per keypress.
		 *
		 * @type {number}
		 * @default 7
		 */
		this.keyPanSpeed = 7.0;

		/**
		 * Setting this property to `true` allows to zoom to the cursor's position.
		 *
		 * @type {boolean}
		 * @default false
		 */
		this.zoomToCursor = false;

		/**
		 * Set to true to automatically rotate around the target
		 *
		 * Note that if this is enabled, you must call `update()` in your animation loop.
		 * If you want the auto-rotate speed to be independent of the frame rate (the refresh
		 * rate of the display), you must pass the time `deltaTime`, in seconds, to `update()`.
		 *
		 * @type {boolean}
		 * @default false
		 */
		this.autoRotate = false;

		/**
		 * How fast to rotate around the target if `autoRotate` is `true`. The default  equates to 30 seconds
		 * per orbit at 60fps.
		 *
		 * Note that if `autoRotate` is enabled, you must call `update()` in your animation loop.
		 *
		 * @type {number}
		 * @default 2
		 */
		this.autoRotateSpeed = 2.0;

		/**
		 * This object contains references to the keycodes for controlling camera panning.
		 *
		 * ```js
		 * controls.keys = {
		 * 	LEFT: 'ArrowLeft', //left arrow
		 * 	UP: 'ArrowUp', // up arrow
		 * 	RIGHT: 'ArrowRight', // right arrow
		 * 	BOTTOM: 'ArrowDown' // down arrow
		 * }
		 * ```
		 * @type {Object}
		 */
		this.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };

		/**
		 * This object contains references to the mouse actions used by the controls.
		 *
		 * ```js
		 * controls.mouseButtons = {
		 * 	LEFT: THREE.MOUSE.ROTATE,
		 * 	MIDDLE: THREE.MOUSE.DOLLY,
		 * 	RIGHT: THREE.MOUSE.PAN
		 * }
		 * ```
		 * @type {Object}
		 */
		this.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };

		/**
		 * This object contains references to the touch actions used by the controls.
		 *
		 * ```js
		 * controls.mouseButtons = {
		 * 	ONE: THREE.TOUCH.ROTATE,
		 * 	TWO: THREE.TOUCH.DOLLY_PAN
		 * }
		 * ```
		 * @type {Object}
		 */
		this.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };

		/**
		 * Used internally by `saveState()` and `reset()`.
		 *
		 * @type {Vector3}
		 */
		this.target0 = this.target.clone();

		/**
		 * Used internally by `saveState()` and `reset()`.
		 *
		 * @type {Vector3}
		 */
		this.position0 = this.object.position.clone();

		/**
		 * Used internally by `saveState()` and `reset()`.
		 *
		 * @type {number}
		 */
		this.zoom0 = this.object.zoom;

		// the target DOM element for key events
		this._domElementKeyEvents = null;

		// internals

		this._lastPosition = new Vector3();
		this._lastQuaternion = new Quaternion();
		this._lastTargetPosition = new Vector3();

		// so camera.up is the orbit axis
		this._quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );
		this._quatInverse = this._quat.clone().invert();

		// current position in spherical coordinates
		this._spherical = new Spherical();
		this._sphericalDelta = new Spherical();

		this._scale = 1;
		this._panOffset = new Vector3();

		this._rotateStart = new Vector2();
		this._rotateEnd = new Vector2();
		this._rotateDelta = new Vector2();

		this._panStart = new Vector2();
		this._panEnd = new Vector2();
		this._panDelta = new Vector2();

		this._dollyStart = new Vector2();
		this._dollyEnd = new Vector2();
		this._dollyDelta = new Vector2();

		this._dollyDirection = new Vector3();
		this._mouse = new Vector2();
		this._performCursorZoom = false;

		this._pointers = [];
		this._pointerPositions = {};

		this._controlActive = false;

		// event listeners

		this._onPointerMove = onPointerMove.bind( this );
		this._onPointerDown = onPointerDown.bind( this );
		this._onPointerUp = onPointerUp.bind( this );
		this._onContextMenu = onContextMenu.bind( this );
		this._onMouseWheel = onMouseWheel.bind( this );
		this._onKeyDown = onKeyDown.bind( this );

		this._onTouchStart = onTouchStart.bind( this );
		this._onTouchMove = onTouchMove.bind( this );

		this._onMouseDown = onMouseDown.bind( this );
		this._onMouseMove = onMouseMove.bind( this );

		this._interceptControlDown = interceptControlDown.bind( this );
		this._interceptControlUp = interceptControlUp.bind( this );

		//

		if ( this.domElement !== null ) {

			this.connect( this.domElement );

		}

		this.update();

	}

	connect( element ) {

		super.connect( element );

		this.domElement.addEventListener( 'pointerdown', this._onPointerDown );
		this.domElement.addEventListener( 'pointercancel', this._onPointerUp );

		this.domElement.addEventListener( 'contextmenu', this._onContextMenu );
		this.domElement.addEventListener( 'wheel', this._onMouseWheel, { passive: false } );

		const document = this.domElement.getRootNode(); // offscreen canvas compatibility
		document.addEventListener( 'keydown', this._interceptControlDown, { passive: true, capture: true } );

		this.domElement.style.touchAction = 'none'; // disable touch scroll

	}

	disconnect() {

		this.domElement.removeEventListener( 'pointerdown', this._onPointerDown );
		this.domElement.removeEventListener( 'pointermove', this._onPointerMove );
		this.domElement.removeEventListener( 'pointerup', this._onPointerUp );
		this.domElement.removeEventListener( 'pointercancel', this._onPointerUp );

		this.domElement.removeEventListener( 'wheel', this._onMouseWheel );
		this.domElement.removeEventListener( 'contextmenu', this._onContextMenu );

		this.stopListenToKeyEvents();

		const document = this.domElement.getRootNode(); // offscreen canvas compatibility
		document.removeEventListener( 'keydown', this._interceptControlDown, { capture: true } );

		this.domElement.style.touchAction = 'auto';

	}

	dispose() {

		this.disconnect();

	}

	/**
	 * Get the current vertical rotation, in radians.
	 *
	 * @return {number} The current vertical rotation, in radians.
	 */
	getPolarAngle() {

		return this._spherical.phi;

	}

	/**
	 * Get the current horizontal rotation, in radians.
	 *
	 * @return {number} The current horizontal rotation, in radians.
	 */
	getAzimuthalAngle() {

		return this._spherical.theta;

	}

	/**
	 * Returns the distance from the camera to the target.
	 *
	 * @return {number} The distance from the camera to the target.
	 */
	getDistance() {

		return this.object.position.distanceTo( this.target );

	}

	/**
	 * Adds key event listeners to the given DOM element.
	 * `window` is a recommended argument for using this method.
	 *
	 * @param {HTMLDOMElement} domElement - The DOM element
	 */
	listenToKeyEvents( domElement ) {

		domElement.addEventListener( 'keydown', this._onKeyDown );
		this._domElementKeyEvents = domElement;

	}

	/**
	 * Removes the key event listener previously defined with `listenToKeyEvents()`.
	 */
	stopListenToKeyEvents() {

		if ( this._domElementKeyEvents !== null ) {

			this._domElementKeyEvents.removeEventListener( 'keydown', this._onKeyDown );
			this._domElementKeyEvents = null;

		}

	}

	/**
	 * Save the current state of the controls. This can later be recovered with `reset()`.
	 */
	saveState() {

		this.target0.copy( this.target );
		this.position0.copy( this.object.position );
		this.zoom0 = this.object.zoom;

	}

	/**
	 * Reset the controls to their state from either the last time the `saveState()`
	 * was called, or the initial state.
	 */
	reset() {

		this.target.copy( this.target0 );
		this.object.position.copy( this.position0 );
		this.object.zoom = this.zoom0;

		this.object.updateProjectionMatrix();
		this.dispatchEvent( _changeEvent );

		this.update();

		this.state = _STATE.NONE;

	}

	update( deltaTime = null ) {

		const position = this.object.position;

		_v.copy( position ).sub( this.target );

		// rotate offset to "y-axis-is-up" space
		_v.applyQuaternion( this._quat );

		// angle from z-axis around y-axis
		this._spherical.setFromVector3( _v );

		if ( this.autoRotate && this.state === _STATE.NONE ) {

			this._rotateLeft( this._getAutoRotationAngle( deltaTime ) );

		}

		if ( this.enableDamping ) {

			this._spherical.theta += this._sphericalDelta.theta * this.dampingFactor;
			this._spherical.phi += this._sphericalDelta.phi * this.dampingFactor;

		} else {

			this._spherical.theta += this._sphericalDelta.theta;
			this._spherical.phi += this._sphericalDelta.phi;

		}

		// restrict theta to be between desired limits

		let min = this.minAzimuthAngle;
		let max = this.maxAzimuthAngle;

		if ( isFinite( min ) && isFinite( max ) ) {

			if ( min < - Math.PI ) min += _twoPI; else if ( min > Math.PI ) min -= _twoPI;

			if ( max < - Math.PI ) max += _twoPI; else if ( max > Math.PI ) max -= _twoPI;

			if ( min <= max ) {

				this._spherical.theta = Math.max( min, Math.min( max, this._spherical.theta ) );

			} else {

				this._spherical.theta = ( this._spherical.theta > ( min + max ) / 2 ) ?
					Math.max( min, this._spherical.theta ) :
					Math.min( max, this._spherical.theta );

			}

		}

		// restrict phi to be between desired limits
		this._spherical.phi = Math.max( this.minPolarAngle, Math.min( this.maxPolarAngle, this._spherical.phi ) );

		this._spherical.makeSafe();


		// move target to panned location

		if ( this.enableDamping === true ) {

			this.target.addScaledVector( this._panOffset, this.dampingFactor );

		} else {

			this.target.add( this._panOffset );

		}

		// Limit the target distance from the cursor to create a sphere around the center of interest
		this.target.sub( this.cursor );
		this.target.clampLength( this.minTargetRadius, this.maxTargetRadius );
		this.target.add( this.cursor );

		let zoomChanged = false;
		// adjust the camera position based on zoom only if we're not zooming to the cursor or if it's an ortho camera
		// we adjust zoom later in these cases
		if ( this.zoomToCursor && this._performCursorZoom || this.object.isOrthographicCamera ) {

			this._spherical.radius = this._clampDistance( this._spherical.radius );

		} else {

			const prevRadius = this._spherical.radius;
			this._spherical.radius = this._clampDistance( this._spherical.radius * this._scale );
			zoomChanged = prevRadius != this._spherical.radius;

		}

		_v.setFromSpherical( this._spherical );

		// rotate offset back to "camera-up-vector-is-up" space
		_v.applyQuaternion( this._quatInverse );

		position.copy( this.target ).add( _v );

		this.object.lookAt( this.target );

		if ( this.enableDamping === true ) {

			this._sphericalDelta.theta *= ( 1 - this.dampingFactor );
			this._sphericalDelta.phi *= ( 1 - this.dampingFactor );

			this._panOffset.multiplyScalar( 1 - this.dampingFactor );

		} else {

			this._sphericalDelta.set( 0, 0, 0 );

			this._panOffset.set( 0, 0, 0 );

		}

		// adjust camera position
		if ( this.zoomToCursor && this._performCursorZoom ) {

			let newRadius = null;
			if ( this.object.isPerspectiveCamera ) {

				// move the camera down the pointer ray
				// this method avoids floating point error
				const prevRadius = _v.length();
				newRadius = this._clampDistance( prevRadius * this._scale );

				const radiusDelta = prevRadius - newRadius;
				this.object.position.addScaledVector( this._dollyDirection, radiusDelta );
				this.object.updateMatrixWorld();

				zoomChanged = !! radiusDelta;

			} else if ( this.object.isOrthographicCamera ) {

				// adjust the ortho camera position based on zoom changes
				const mouseBefore = new Vector3( this._mouse.x, this._mouse.y, 0 );
				mouseBefore.unproject( this.object );

				const prevZoom = this.object.zoom;
				this.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom / this._scale ) );
				this.object.updateProjectionMatrix();

				zoomChanged = prevZoom !== this.object.zoom;

				const mouseAfter = new Vector3( this._mouse.x, this._mouse.y, 0 );
				mouseAfter.unproject( this.object );

				this.object.position.sub( mouseAfter ).add( mouseBefore );
				this.object.updateMatrixWorld();

				newRadius = _v.length();

			} else {

				console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled.' );
				this.zoomToCursor = false;

			}

			// handle the placement of the target
			if ( newRadius !== null ) {

				if ( this.screenSpacePanning ) {

					// position the orbit target in front of the new camera position
					this.target.set( 0, 0, -1 )
						.transformDirection( this.object.matrix )
						.multiplyScalar( newRadius )
						.add( this.object.position );

				} else {

					// get the ray and translation plane to compute target
					_ray.origin.copy( this.object.position );
					_ray.direction.set( 0, 0, -1 ).transformDirection( this.object.matrix );

					// if the camera is 20 degrees above the horizon then don't adjust the focus target to avoid
					// extremely large values
					if ( Math.abs( this.object.up.dot( _ray.direction ) ) < _TILT_LIMIT ) {

						this.object.lookAt( this.target );

					} else {

						_plane.setFromNormalAndCoplanarPoint( this.object.up, this.target );
						_ray.intersectPlane( _plane, this.target );

					}

				}

			}

		} else if ( this.object.isOrthographicCamera ) {

			const prevZoom = this.object.zoom;
			this.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom / this._scale ) );

			if ( prevZoom !== this.object.zoom ) {

				this.object.updateProjectionMatrix();
				zoomChanged = true;

			}

		}

		this._scale = 1;
		this._performCursorZoom = false;

		// update condition is:
		// min(camera displacement, camera rotation in radians)^2 > EPS
		// using small-angle approximation cos(x/2) = 1 - x^2 / 8

		if ( zoomChanged ||
			this._lastPosition.distanceToSquared( this.object.position ) > _EPS ||
			8 * ( 1 - this._lastQuaternion.dot( this.object.quaternion ) ) > _EPS ||
			this._lastTargetPosition.distanceToSquared( this.target ) > _EPS ) {

			this.dispatchEvent( _changeEvent );

			this._lastPosition.copy( this.object.position );
			this._lastQuaternion.copy( this.object.quaternion );
			this._lastTargetPosition.copy( this.target );

			return true;

		}

		return false;

	}

	_getAutoRotationAngle( deltaTime ) {

		if ( deltaTime !== null ) {

			return ( _twoPI / 60 * this.autoRotateSpeed ) * deltaTime;

		} else {

			return _twoPI / 60 / 60 * this.autoRotateSpeed;

		}

	}

	_getZoomScale( delta ) {

		const normalizedDelta = Math.abs( delta * 0.01 );
		return Math.pow( 0.95, this.zoomSpeed * normalizedDelta );

	}

	_rotateLeft( angle ) {

		this._sphericalDelta.theta -= angle;

	}

	_rotateUp( angle ) {

		this._sphericalDelta.phi -= angle;

	}

	_panLeft( distance, objectMatrix ) {

		_v.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix
		_v.multiplyScalar( - distance );

		this._panOffset.add( _v );

	}

	_panUp( distance, objectMatrix ) {

		if ( this.screenSpacePanning === true ) {

			_v.setFromMatrixColumn( objectMatrix, 1 );

		} else {

			_v.setFromMatrixColumn( objectMatrix, 0 );
			_v.crossVectors( this.object.up, _v );

		}

		_v.multiplyScalar( distance );

		this._panOffset.add( _v );

	}

	// deltaX and deltaY are in pixels; right and down are positive
	_pan( deltaX, deltaY ) {

		const element = this.domElement;

		if ( this.object.isPerspectiveCamera ) {

			// perspective
			const position = this.object.position;
			_v.copy( position ).sub( this.target );
			let targetDistance = _v.length();

			// half of the fov is center to top of screen
			targetDistance *= Math.tan( ( this.object.fov / 2 ) * Math.PI / 180.0 );

			// we use only clientHeight here so aspect ratio does not distort speed
			this._panLeft( 2 * deltaX * targetDistance / element.clientHeight, this.object.matrix );
			this._panUp( 2 * deltaY * targetDistance / element.clientHeight, this.object.matrix );

		} else if ( this.object.isOrthographicCamera ) {

			// orthographic
			this._panLeft( deltaX * ( this.object.right - this.object.left ) / this.object.zoom / element.clientWidth, this.object.matrix );
			this._panUp( deltaY * ( this.object.top - this.object.bottom ) / this.object.zoom / element.clientHeight, this.object.matrix );

		} else {

			// camera neither orthographic nor perspective
			console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );
			this.enablePan = false;

		}

	}

	_dollyOut( dollyScale ) {

		if ( this.object.isPerspectiveCamera || this.object.isOrthographicCamera ) {

			this._scale /= dollyScale;

		} else {

			console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );
			this.enableZoom = false;

		}

	}

	_dollyIn( dollyScale ) {

		if ( this.object.isPerspectiveCamera || this.object.isOrthographicCamera ) {

			this._scale *= dollyScale;

		} else {

			console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );
			this.enableZoom = false;

		}

	}

	_updateZoomParameters( x, y ) {

		if ( ! this.zoomToCursor ) {

			return;

		}

		this._performCursorZoom = true;

		const rect = this.domElement.getBoundingClientRect();
		const dx = x - rect.left;
		const dy = y - rect.top;
		const w = rect.width;
		const h = rect.height;

		this._mouse.x = ( dx / w ) * 2 - 1;
		this._mouse.y = - ( dy / h ) * 2 + 1;

		this._dollyDirection.set( this._mouse.x, this._mouse.y, 1 ).unproject( this.object ).sub( this.object.position ).normalize();

	}

	_clampDistance( dist ) {

		return Math.max( this.minDistance, Math.min( this.maxDistance, dist ) );

	}

	//
	// event callbacks - update the object state
	//

	_handleMouseDownRotate( event ) {

		this._rotateStart.set( event.clientX, event.clientY );

	}

	_handleMouseDownDolly( event ) {

		this._updateZoomParameters( event.clientX, event.clientX );
		this._dollyStart.set( event.clientX, event.clientY );

	}

	_handleMouseDownPan( event ) {

		this._panStart.set( event.clientX, event.clientY );

	}

	_handleMouseMoveRotate( event ) {

		this._rotateEnd.set( event.clientX, event.clientY );

		this._rotateDelta.subVectors( this._rotateEnd, this._rotateStart ).multiplyScalar( this.rotateSpeed );

		const element = this.domElement;

		this._rotateLeft( _twoPI * this._rotateDelta.x / element.clientHeight ); // yes, height

		this._rotateUp( _twoPI * this._rotateDelta.y / element.clientHeight );

		this._rotateStart.copy( this._rotateEnd );

		this.update();

	}

	_handleMouseMoveDolly( event ) {

		this._dollyEnd.set( event.clientX, event.clientY );

		this._dollyDelta.subVectors( this._dollyEnd, this._dollyStart );

		if ( this._dollyDelta.y > 0 ) {

			this._dollyOut( this._getZoomScale( this._dollyDelta.y ) );

		} else if ( this._dollyDelta.y < 0 ) {

			this._dollyIn( this._getZoomScale( this._dollyDelta.y ) );

		}

		this._dollyStart.copy( this._dollyEnd );

		this.update();

	}

	_handleMouseMovePan( event ) {

		this._panEnd.set( event.clientX, event.clientY );

		this._panDelta.subVectors( this._panEnd, this._panStart ).multiplyScalar( this.panSpeed );

		this._pan( this._panDelta.x, this._panDelta.y );

		this._panStart.copy( this._panEnd );

		this.update();

	}

	_handleMouseWheel( event ) {

		this._updateZoomParameters( event.clientX, event.clientY );

		if ( event.deltaY < 0 ) {

			this._dollyIn( this._getZoomScale( event.deltaY ) );

		} else if ( event.deltaY > 0 ) {

			this._dollyOut( this._getZoomScale( event.deltaY ) );

		}

		this.update();

	}

	_handleKeyDown( event ) {

		let needsUpdate = false;

		switch ( event.code ) {

			case this.keys.UP:

				if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

					if ( this.enableRotate ) {

						this._rotateUp( _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );

					}

				} else {

					if ( this.enablePan ) {

						this._pan( 0, this.keyPanSpeed );

					}

				}

				needsUpdate = true;
				break;

			case this.keys.BOTTOM:

				if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

					if ( this.enableRotate ) {

						this._rotateUp( - _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );

					}

				} else {

					if ( this.enablePan ) {

						this._pan( 0, - this.keyPanSpeed );

					}

				}

				needsUpdate = true;
				break;

			case this.keys.LEFT:

				if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

					if ( this.enableRotate ) {

						this._rotateLeft( _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );

					}

				} else {

					if ( this.enablePan ) {

						this._pan( this.keyPanSpeed, 0 );

					}

				}

				needsUpdate = true;
				break;

			case this.keys.RIGHT:

				if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

					if ( this.enableRotate ) {

						this._rotateLeft( - _twoPI * this.keyRotateSpeed / this.domElement.clientHeight );

					}

				} else {

					if ( this.enablePan ) {

						this._pan( - this.keyPanSpeed, 0 );

					}

				}

				needsUpdate = true;
				break;

		}

		if ( needsUpdate ) {

			// prevent the browser from scrolling on cursor keys
			event.preventDefault();

			this.update();

		}


	}

	_handleTouchStartRotate( event ) {

		if ( this._pointers.length === 1 ) {

			this._rotateStart.set( event.pageX, event.pageY );

		} else {

			const position = this._getSecondPointerPosition( event );

			const x = 0.5 * ( event.pageX + position.x );
			const y = 0.5 * ( event.pageY + position.y );

			this._rotateStart.set( x, y );

		}

	}

	_handleTouchStartPan( event ) {

		if ( this._pointers.length === 1 ) {

			this._panStart.set( event.pageX, event.pageY );

		} else {

			const position = this._getSecondPointerPosition( event );

			const x = 0.5 * ( event.pageX + position.x );
			const y = 0.5 * ( event.pageY + position.y );

			this._panStart.set( x, y );

		}

	}

	_handleTouchStartDolly( event ) {

		const position = this._getSecondPointerPosition( event );

		const dx = event.pageX - position.x;
		const dy = event.pageY - position.y;

		const distance = Math.sqrt( dx * dx + dy * dy );

		this._dollyStart.set( 0, distance );

	}

	_handleTouchStartDollyPan( event ) {

		if ( this.enableZoom ) this._handleTouchStartDolly( event );

		if ( this.enablePan ) this._handleTouchStartPan( event );

	}

	_handleTouchStartDollyRotate( event ) {

		if ( this.enableZoom ) this._handleTouchStartDolly( event );

		if ( this.enableRotate ) this._handleTouchStartRotate( event );

	}

	_handleTouchMoveRotate( event ) {

		if ( this._pointers.length == 1 ) {

			this._rotateEnd.set( event.pageX, event.pageY );

		} else {

			const position = this._getSecondPointerPosition( event );

			const x = 0.5 * ( event.pageX + position.x );
			const y = 0.5 * ( event.pageY + position.y );

			this._rotateEnd.set( x, y );

		}

		this._rotateDelta.subVectors( this._rotateEnd, this._rotateStart ).multiplyScalar( this.rotateSpeed );

		const element = this.domElement;

		this._rotateLeft( _twoPI * this._rotateDelta.x / element.clientHeight ); // yes, height

		this._rotateUp( _twoPI * this._rotateDelta.y / element.clientHeight );

		this._rotateStart.copy( this._rotateEnd );

	}

	_handleTouchMovePan( event ) {

		if ( this._pointers.length === 1 ) {

			this._panEnd.set( event.pageX, event.pageY );

		} else {

			const position = this._getSecondPointerPosition( event );

			const x = 0.5 * ( event.pageX + position.x );
			const y = 0.5 * ( event.pageY + position.y );

			this._panEnd.set( x, y );

		}

		this._panDelta.subVectors( this._panEnd, this._panStart ).multiplyScalar( this.panSpeed );

		this._pan( this._panDelta.x, this._panDelta.y );

		this._panStart.copy( this._panEnd );

	}

	_handleTouchMoveDolly( event ) {

		const position = this._getSecondPointerPosition( event );

		const dx = event.pageX - position.x;
		const dy = event.pageY - position.y;

		const distance = Math.sqrt( dx * dx + dy * dy );

		this._dollyEnd.set( 0, distance );

		this._dollyDelta.set( 0, Math.pow( this._dollyEnd.y / this._dollyStart.y, this.zoomSpeed ) );

		this._dollyOut( this._dollyDelta.y );

		this._dollyStart.copy( this._dollyEnd );

		const centerX = ( event.pageX + position.x ) * 0.5;
		const centerY = ( event.pageY + position.y ) * 0.5;

		this._updateZoomParameters( centerX, centerY );

	}

	_handleTouchMoveDollyPan( event ) {

		if ( this.enableZoom ) this._handleTouchMoveDolly( event );

		if ( this.enablePan ) this._handleTouchMovePan( event );

	}

	_handleTouchMoveDollyRotate( event ) {

		if ( this.enableZoom ) this._handleTouchMoveDolly( event );

		if ( this.enableRotate ) this._handleTouchMoveRotate( event );

	}

	// pointers

	_addPointer( event ) {

		this._pointers.push( event.pointerId );

	}

	_removePointer( event ) {

		delete this._pointerPositions[ event.pointerId ];

		for ( let i = 0; i < this._pointers.length; i ++ ) {

			if ( this._pointers[ i ] == event.pointerId ) {

				this._pointers.splice( i, 1 );
				return;

			}

		}

	}

	_isTrackingPointer( event ) {

		for ( let i = 0; i < this._pointers.length; i ++ ) {

			if ( this._pointers[ i ] == event.pointerId ) return true;

		}

		return false;

	}

	_trackPointer( event ) {

		let position = this._pointerPositions[ event.pointerId ];

		if ( position === undefined ) {

			position = new Vector2();
			this._pointerPositions[ event.pointerId ] = position;

		}

		position.set( event.pageX, event.pageY );

	}

	_getSecondPointerPosition( event ) {

		const pointerId = ( event.pointerId === this._pointers[ 0 ] ) ? this._pointers[ 1 ] : this._pointers[ 0 ];

		return this._pointerPositions[ pointerId ];

	}

	//

	_customWheelEvent( event ) {

		const mode = event.deltaMode;

		// minimal wheel event altered to meet delta-zoom demand
		const newEvent = {
			clientX: event.clientX,
			clientY: event.clientY,
			deltaY: event.deltaY,
		};

		switch ( mode ) {

			case 1: // LINE_MODE
				newEvent.deltaY *= 16;
				break;

			case 2: // PAGE_MODE
				newEvent.deltaY *= 100;
				break;

		}

		// detect if event was triggered by pinching
		if ( event.ctrlKey && ! this._controlActive ) {

			newEvent.deltaY *= 10;

		}

		return newEvent;

	}

}

function onPointerDown( event ) {

	if ( this.enabled === false ) return;

	if ( this._pointers.length === 0 ) {

		this.domElement.setPointerCapture( event.pointerId );

		this.domElement.addEventListener( 'pointermove', this._onPointerMove );
		this.domElement.addEventListener( 'pointerup', this._onPointerUp );

	}

	//

	if ( this._isTrackingPointer( event ) ) return;

	//

	this._addPointer( event );

	if ( event.pointerType === 'touch' ) {

		this._onTouchStart( event );

	} else {

		this._onMouseDown( event );

	}

}

function onPointerMove( event ) {

	if ( this.enabled === false ) return;

	if ( event.pointerType === 'touch' ) {

		this._onTouchMove( event );

	} else {

		this._onMouseMove( event );

	}

}

function onPointerUp( event ) {

	this._removePointer( event );

	switch ( this._pointers.length ) {

		case 0:

			this.domElement.releasePointerCapture( event.pointerId );

			this.domElement.removeEventListener( 'pointermove', this._onPointerMove );
			this.domElement.removeEventListener( 'pointerup', this._onPointerUp );

			this.dispatchEvent( _endEvent );

			this.state = _STATE.NONE;

			break;

		case 1:

			const pointerId = this._pointers[ 0 ];
			const position = this._pointerPositions[ pointerId ];

			// minimal placeholder event - allows state correction on pointer-up
			this._onTouchStart( { pointerId: pointerId, pageX: position.x, pageY: position.y } );

			break;

	}

}

function onMouseDown( event ) {

	let mouseAction;

	switch ( event.button ) {

		case 0:

			mouseAction = this.mouseButtons.LEFT;
			break;

		case 1:

			mouseAction = this.mouseButtons.MIDDLE;
			break;

		case 2:

			mouseAction = this.mouseButtons.RIGHT;
			break;

		default:

			mouseAction = -1;

	}

	switch ( mouseAction ) {

		case MOUSE.DOLLY:

			if ( this.enableZoom === false ) return;

			this._handleMouseDownDolly( event );

			this.state = _STATE.DOLLY;

			break;

		case MOUSE.ROTATE:

			if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

				if ( this.enablePan === false ) return;

				this._handleMouseDownPan( event );

				this.state = _STATE.PAN;

			} else {

				if ( this.enableRotate === false ) return;

				this._handleMouseDownRotate( event );

				this.state = _STATE.ROTATE;

			}

			break;

		case MOUSE.PAN:

			if ( event.ctrlKey || event.metaKey || event.shiftKey ) {

				if ( this.enableRotate === false ) return;

				this._handleMouseDownRotate( event );

				this.state = _STATE.ROTATE;

			} else {

				if ( this.enablePan === false ) return;

				this._handleMouseDownPan( event );

				this.state = _STATE.PAN;

			}

			break;

		default:

			this.state = _STATE.NONE;

	}

	if ( this.state !== _STATE.NONE ) {

		this.dispatchEvent( _startEvent );

	}

}

function onMouseMove( event ) {

	switch ( this.state ) {

		case _STATE.ROTATE:

			if ( this.enableRotate === false ) return;

			this._handleMouseMoveRotate( event );

			break;

		case _STATE.DOLLY:

			if ( this.enableZoom === false ) return;

			this._handleMouseMoveDolly( event );

			break;

		case _STATE.PAN:

			if ( this.enablePan === false ) return;

			this._handleMouseMovePan( event );

			break;

	}

}

function onMouseWheel( event ) {

	if ( this.enabled === false || this.enableZoom === false || this.state !== _STATE.NONE ) return;

	event.preventDefault();

	this.dispatchEvent( _startEvent );

	this._handleMouseWheel( this._customWheelEvent( event ) );

	this.dispatchEvent( _endEvent );

}

function onKeyDown( event ) {

	if ( this.enabled === false ) return;

	this._handleKeyDown( event );

}

function onTouchStart( event ) {

	this._trackPointer( event );

	switch ( this._pointers.length ) {

		case 1:

			switch ( this.touches.ONE ) {

				case TOUCH.ROTATE:

					if ( this.enableRotate === false ) return;

					this._handleTouchStartRotate( event );

					this.state = _STATE.TOUCH_ROTATE;

					break;

				case TOUCH.PAN:

					if ( this.enablePan === false ) return;

					this._handleTouchStartPan( event );

					this.state = _STATE.TOUCH_PAN;

					break;

				default:

					this.state = _STATE.NONE;

			}

			break;

		case 2:

			switch ( this.touches.TWO ) {

				case TOUCH.DOLLY_PAN:

					if ( this.enableZoom === false && this.enablePan === false ) return;

					this._handleTouchStartDollyPan( event );

					this.state = _STATE.TOUCH_DOLLY_PAN;

					break;

				case TOUCH.DOLLY_ROTATE:

					if ( this.enableZoom === false && this.enableRotate === false ) return;

					this._handleTouchStartDollyRotate( event );

					this.state = _STATE.TOUCH_DOLLY_ROTATE;

					break;

				default:

					this.state = _STATE.NONE;

			}

			break;

		default:

			this.state = _STATE.NONE;

	}

	if ( this.state !== _STATE.NONE ) {

		this.dispatchEvent( _startEvent );

	}

}

function onTouchMove( event ) {

	this._trackPointer( event );

	switch ( this.state ) {

		case _STATE.TOUCH_ROTATE:

			if ( this.enableRotate === false ) return;

			this._handleTouchMoveRotate( event );

			this.update();

			break;

		case _STATE.TOUCH_PAN:

			if ( this.enablePan === false ) return;

			this._handleTouchMovePan( event );

			this.update();

			break;

		case _STATE.TOUCH_DOLLY_PAN:

			if ( this.enableZoom === false && this.enablePan === false ) return;

			this._handleTouchMoveDollyPan( event );

			this.update();

			break;

		case _STATE.TOUCH_DOLLY_ROTATE:

			if ( this.enableZoom === false && this.enableRotate === false ) return;

			this._handleTouchMoveDollyRotate( event );

			this.update();

			break;

		default:

			this.state = _STATE.NONE;

	}

}

function onContextMenu( event ) {

	if ( this.enabled === false ) return;

	event.preventDefault();

}

function interceptControlDown( event ) {

	if ( event.key === 'Control' ) {

		this._controlActive = true;

		const document = this.domElement.getRootNode(); // offscreen canvas compatibility

		document.addEventListener( 'keyup', this._interceptControlUp, { passive: true, capture: true } );

	}

}

function interceptControlUp( event ) {

	if ( event.key === 'Control' ) {

		this._controlActive = false;

		const document = this.domElement.getRootNode(); // offscreen canvas compatibility

		document.removeEventListener( 'keyup', this._interceptControlUp, { passive: true, capture: true } );

	}

}

class SeededRandom {
  seed;
  constructor(seed) {
    this.seed = seed;
  }
  next() {
    const x = Math.sin(this.seed++) * 1e4;
    return x - Math.floor(x);
  }
}
function noise1D(x) {
  const i = Math.floor(x);
  const f = x - i;
  const u = f * f * (3 - 2 * f);
  const a = Math.sin(i * 12.9898 + 78.233) * 43758.5453123;
  const b = Math.sin((i + 1) * 12.9898 + 78.233) * 43758.5453123;
  return (a - Math.floor(a)) * (1 - u) + (b - Math.floor(b)) * u;
}
function buildFractalTunnel(config) {
  const { rings, segments, radius, depth, twist = 0 } = config;
  const rng = new SeededRandom(42);
  const positions = [];
  const indices = [];
  for (let r = 0; r <= rings; r++) {
    const t = r / rings;
    const z = t * depth;
    const twistAngle = t * twist;
    const currentRadius = radius * Math.pow(1 - t, 1.2) + 0.5;
    for (let s = 0; s <= segments; s++) {
      const baseTheta = s / segments * Math.PI * 2;
      const theta = baseTheta + twistAngle;
      const noiseVal = noise1D(r * 0.3 + s * 0.15) * 0.15;
      const jitterR = (rng.next() - 0.5) * currentRadius * 0.08;
      const jitterZ = (rng.next() - 0.5) * 0.3;
      const x = Math.cos(theta) * (currentRadius + noiseVal + jitterR);
      const y = Math.sin(theta) * (currentRadius + noiseVal + jitterR);
      positions.push(x, y, z + jitterZ);
    }
  }
  for (let r = 0; r < rings; r++) {
    for (let s = 0; s < segments; s++) {
      const current = r * (segments + 1) + s;
      const next = current + segments + 1;
      indices.push(current, next, current + 1);
      indices.push(current + 1, next, next + 1);
    }
  }
  return {
    positions: new Float32Array(positions),
    indices: new Uint32Array(indices)
  };
}

var NodeState = /* @__PURE__ */ ((NodeState2) => {
  NodeState2[NodeState2["LOCKED"] = 0] = "LOCKED";
  NodeState2[NodeState2["DISCOVERED"] = 1] = "DISCOVERED";
  NodeState2[NodeState2["LINKED"] = 2] = "LINKED";
  return NodeState2;
})(NodeState || {});
const NODE_COLORS = {
  [0 /* LOCKED */]: 5592422,
  // Brighter gray for visibility
  [1 /* DISCOVERED */]: 65535,
  // Pure bright cyan
  [2 /* LINKED */]: 13395711
  // Brighter violet
};
const THEME_NAMES = {
  "Etica": ["Compasso", "Bilancia", "Scudo", "Luce"],
  "Strategia": ["Torre", "Sentinella", "Occhio", "Mappa"],
  "Adattività": ["Camaleonte", "Riflesso", "Onda", "Foglia"],
  "Visione": ["Stella", "Prisma", "Faro", "Oracolo"]
};
class NodeLayer {
  scene;
  // Can be Scene or Group
  nodes = [];
  instancedMesh = null;
  geometry;
  constructor(parent, tunnelGeometry) {
    this.scene = parent;
    this.geometry = tunnelGeometry;
  }
  /**
   * Initialize 48 nodes with deterministic themes and symbolic names
   */
  initialize(nodeCount, seed = 42) {
    const positions = this.geometry.attributes.position;
    const totalVertices = positions.count;
    const step = Math.floor(totalVertices / nodeCount);
    this.nodes = [];
    const themes = ["Etica", "Strategia", "Adattività", "Visione"];
    for (let i = 0; i < nodeCount; i++) {
      const idx = i * step;
      if (idx >= totalVertices) break;
      const position = new Vector3(
        positions.getX(idx),
        positions.getY(idx),
        positions.getZ(idx)
      );
      const themeIndex = (seed + i * 7) % themes.length;
      const theme = themes[themeIndex];
      const nameIndex = Math.floor(i / themes.length) % THEME_NAMES[theme].length;
      const name = `${theme} ${THEME_NAMES[theme][nameIndex]}`;
      this.nodes.push({
        id: i,
        position,
        state: 0 /* LOCKED */,
        theme,
        name
      });
    }
    this.createInstancedMesh();
  }
  createInstancedMesh() {
    if (this.instancedMesh) {
      this.scene.remove(this.instancedMesh);
      this.instancedMesh.geometry.dispose();
      this.instancedMesh.material.dispose();
    }
    const sphereGeometry = new SphereGeometry(0.24, 12, 12);
    const material = new MeshBasicMaterial({
      transparent: false,
      depthTest: false,
      // Render on top
      depthWrite: true
    });
    this.instancedMesh = new InstancedMesh(
      sphereGeometry,
      material,
      this.nodes.length
    );
    this.instancedMesh.renderOrder = 1e4;
    this.instancedMesh.frustumCulled = false;
    const matrix = new Matrix4();
    const color = new Color();
    for (let i = 0; i < this.nodes.length; i++) {
      const node = this.nodes[i];
      matrix.setPosition(node.position);
      this.instancedMesh.setMatrixAt(i, matrix);
      color.setHex(NODE_COLORS[node.state]);
      this.instancedMesh.setColorAt(i, color);
    }
    this.instancedMesh.instanceMatrix.needsUpdate = true;
    if (this.instancedMesh.instanceColor) {
      this.instancedMesh.instanceColor.needsUpdate = true;
    }
    this.scene.add(this.instancedMesh);
  }
  raycast(raycaster) {
    if (!this.instancedMesh) return null;
    const intersects = raycaster.intersectObject(this.instancedMesh);
    if (intersects.length > 0 && intersects[0].instanceId !== void 0) {
      return intersects[0].instanceId;
    }
    return null;
  }
  getNode(nodeId) {
    return this.nodes.find((n) => n.id === nodeId) || null;
  }
  getNodeState(nodeId) {
    const node = this.getNode(nodeId);
    return node ? node.state : null;
  }
  setNodeState(nodeId, state) {
    const node = this.getNode(nodeId);
    if (!node || !this.instancedMesh) return;
    node.state = state;
    const color = new Color(NODE_COLORS[state]);
    this.instancedMesh.setColorAt(nodeId, color);
    if (this.instancedMesh.instanceColor) {
      this.instancedMesh.instanceColor.needsUpdate = true;
    }
    const matrix = new Matrix4();
    const scale = new Vector3(2, 2, 2);
    matrix.compose(node.position, new Quaternion(), scale);
    this.instancedMesh.setMatrixAt(nodeId, matrix);
    this.instancedMesh.instanceMatrix.needsUpdate = true;
    console.info("[MF3D] Node state change - PULSE:", {
      nodeId,
      state,
      color: "#" + NODE_COLORS[state].toString(16),
      scale: "2.0x/300ms"
    });
    setTimeout(() => {
      if (!this.instancedMesh) return;
      const resetMatrix = new Matrix4();
      const resetScale = new Vector3(1, 1, 1);
      resetMatrix.compose(node.position, new Quaternion(), resetScale);
      this.instancedMesh.setMatrixAt(nodeId, resetMatrix);
      this.instancedMesh.instanceMatrix.needsUpdate = true;
    }, 300);
  }
  getStats() {
    const discovered = this.nodes.filter((n) => n.state === 1 /* DISCOVERED */ || n.state === 2 /* LINKED */).length;
    const linked = this.nodes.filter((n) => n.state === 2 /* LINKED */).length;
    return { discovered, linked };
  }
  /**
   * Update with hover highlight and pulse animations
   */
  update(elapsedTime, hoveredNodeId = null) {
    if (!this.instancedMesh) return;
    const matrix = new Matrix4();
    const scale = new Vector3();
    const color = new Color();
    for (let i = 0; i < this.nodes.length; i++) {
      const node = this.nodes[i];
      let pulseScale = 1;
      if (node.state === 1 /* DISCOVERED */) {
        pulseScale = 1 + Math.sin(elapsedTime * 3 + i * 0.5) * 0.25;
      } else if (node.state === 2 /* LINKED */) {
        pulseScale = 1 + Math.sin(elapsedTime * 2 + i * 0.3) * 0.2;
      }
      if (hoveredNodeId === node.id) {
        pulseScale *= 2;
        color.setHex(NODE_COLORS[node.state]).multiplyScalar(2);
        this.instancedMesh.setColorAt(i, color);
      } else {
        color.setHex(NODE_COLORS[node.state]).multiplyScalar(1.3);
        this.instancedMesh.setColorAt(i, color);
      }
      scale.set(pulseScale, pulseScale, pulseScale);
      matrix.compose(node.position, new Quaternion(), scale);
      this.instancedMesh.setMatrixAt(i, matrix);
    }
    this.instancedMesh.instanceMatrix.needsUpdate = true;
    if (this.instancedMesh.instanceColor) {
      this.instancedMesh.instanceColor.needsUpdate = true;
    }
  }
  regenerate(tunnelGeometry, nodeCount, seed = 42) {
    this.geometry = tunnelGeometry;
    this.initialize(nodeCount, seed);
  }
  dispose() {
    if (this.instancedMesh) {
      this.scene.remove(this.instancedMesh);
      this.instancedMesh.geometry.dispose();
      this.instancedMesh.material.dispose();
    }
  }
}

function usePickNode(nodeLayer, camera, canvas) {
  const raycaster = reactExports.useRef(new Raycaster());
  const throttleRef = reactExports.useRef(0);
  const pickNode = reactExports.useCallback((event) => {
    if (!nodeLayer || !camera || !canvas) return null;
    const now = performance.now();
    if (now - throttleRef.current < 50) return null;
    throttleRef.current = now;
    const rect = canvas.getBoundingClientRect();
    const mouse = new Vector2(
      (event.clientX - rect.left) / rect.width * 2 - 1,
      -((event.clientY - rect.top) / rect.height) * 2 + 1
    );
    raycaster.current.setFromCamera(mouse, camera);
    const nodeId = nodeLayer.raycast(raycaster.current);
    if (nodeId !== null) {
      const node = nodeLayer.getNode(nodeId);
      if (node) {
        const pickEvent = {
          nodeId,
          theme: node.theme,
          worldPos: node.position.clone()
        };
        window.dispatchEvent(new CustomEvent("mindfractal:node-selected", {
          detail: pickEvent
        }));
      }
    }
    return nodeId;
  }, [nodeLayer, camera, canvas]);
  return { pickNode };
}

class LinkEngine {
  lastLinkTime = 0;
  COOLDOWN_MS = 500;
  MAX_DISTANCE_RATIO = 0.12;
  tunnelLength;
  constructor(tunnelLength) {
    this.tunnelLength = tunnelLength;
  }
  /**
   * Check if two nodes can be linked
   */
  canLink(nodeA, nodeB) {
    const now = performance.now();
    if (now - this.lastLinkTime < this.COOLDOWN_MS) {
      return { valid: false, reason: "cooldown" };
    }
    const distance = nodeA.position.distanceTo(nodeB.position);
    const maxDist = this.tunnelLength * this.MAX_DISTANCE_RATIO;
    if (distance > maxDist) {
      return { valid: false, reason: "too_far" };
    }
    return { valid: true };
  }
  /**
   * Create link between two nodes
   */
  createLink(nodeA, nodeB) {
    const check = this.canLink(nodeA, nodeB);
    if (!check.valid) {
      console.info("[LinkEngine] Cannot link:", check.reason);
      return null;
    }
    this.lastLinkTime = performance.now();
    const result = {
      from: nodeA.id,
      to: nodeB.id,
      length: nodeA.position.distanceTo(nodeB.position),
      ts: Date.now()
    };
    window.dispatchEvent(new CustomEvent("mindfractal:link-created", {
      detail: result
    }));
    return result;
  }
}

const arcVertexShader = `
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`;
const arcFragmentShader = `
uniform float uTime;
uniform float uLifetimeRatio;
uniform vec3 uColor;
uniform float uIsLink;
varying vec2 vUv;

float hash(vec2 p) {
  return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
}

float noise(vec2 p) {
  vec2 i = floor(p);
  vec2 f = fract(p);
  f = f * f * (3.0 - 2.0 * f);
  float a = hash(i);
  float b = hash(i + vec2(1.0, 0.0));
  float c = hash(i + vec2(0.0, 1.0));
  float d = hash(i + vec2(1.0, 1.0));
  return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
}

void main() {
  float t = vUv.x - uTime * 2.0;
  float wave = noise(vec2(t * 8.0, uTime * 3.0)) * 0.5 + 0.5;
  float taper = smoothstep(0.0, 0.1, vUv.y) * smoothstep(1.0, 0.9, vUv.y);
  
  vec3 color = uColor;
  
  // White spike at wave peak (last 15%) - BOOSTED
  if (wave > 0.85) {
    color = mix(color, vec3(3.0), (wave - 0.85) / 0.15); // Extreme white spike
  }
  
  // Link arcs are ULTRA bright for maximum visibility
  float brightnessMod = mix(3.0, 5.0, uIsLink); // 5x for link arcs (pure white)
  float alpha = wave * taper * (1.0 - uLifetimeRatio) * brightnessMod;
  
  // Boost base visibility
  alpha = clamp(alpha * 1.5, 0.0, 1.0);
  
  gl_FragColor = vec4(color, alpha);
}
`;
class GridArcPool {
  scene;
  parent = null;
  // [MF3D] Parent for arcs (align with tunnelGroup)
  arcs = [];
  edges = [];
  maxArcs = 200;
  // Dynamic, will be adjusted by budgeter
  lastIdleSpawn = 0;
  lastSurge = 0;
  surgeInterval = 3e3 + Math.random() * 3e3;
  // 3-6s randomized
  ringsPerSegment = 0;
  // Will be calculated from geometry
  // [MF3D] Dynamic FPS budgeter
  fpsTarget = 60;
  currentFPS = 60;
  targetRate = 7;
  // Hz, dynamically adjusted
  lastBudgetAdjust = 0;
  BUDGET_ADJUST_INTERVAL = 500;
  // Adjust every 500ms
  constructor(scene) {
    this.scene = scene;
  }
  // [MF3D] Attach arcs to a parent (e.g., tunnelGroup) so they inherit breath/twist
  setParent(parent) {
    this.parent = parent;
  }
  // [MF3D] Set FPS target for dynamic budgeting
  setFPSTarget(target) {
    this.fpsTarget = target;
  }
  // [MF3D] Update current FPS for budgeting
  setCurrentFPS(fps) {
    this.currentFPS = fps;
    this.adjustBudget();
  }
  // [MF3D] Dynamic budget adjustment based on FPS
  adjustBudget() {
    const now = performance.now();
    if (now - this.lastBudgetAdjust < this.BUDGET_ADJUST_INTERVAL) return;
    this.lastBudgetAdjust = now;
    const oldRate = this.targetRate;
    const oldMax = this.maxArcs;
    if (this.currentFPS < this.fpsTarget) {
      this.targetRate = Math.max(2, this.targetRate * 0.9);
      this.maxArcs = Math.max(80, Math.floor(this.maxArcs * 0.9));
    } else if (this.currentFPS >= this.fpsTarget + 5) {
      this.targetRate = Math.min(7, this.targetRate * 1.1);
      this.maxArcs = Math.min(200, Math.floor(this.maxArcs * 1.1));
    }
    if (oldRate !== this.targetRate || oldMax !== this.maxArcs) {
      console.info("[MF3D] budget", {
        fps: this.currentFPS.toFixed(1),
        rate: `${oldRate.toFixed(1)}Hz->${this.targetRate.toFixed(1)}Hz`,
        maxArcs: `${oldMax}->${this.maxArcs}`
      });
    }
  }
  // [MF3D] Get pool stats
  getStats() {
    return {
      active: this.arcs.length,
      max: this.maxArcs,
      rate: this.targetRate
    };
  }
  /**
   * Build edge list from tunnel geometry and calculate ring structure
   */
  bindGeometry(geometry) {
    this.edges = [];
    const pos = geometry.getAttribute("position");
    const index = geometry.getIndex();
    if (!index || !pos) return;
    const getVec = (i) => new Vector3(pos.getX(i), pos.getY(i), pos.getZ(i));
    for (let i = 0; i < index.count; i += 3) {
      const a = index.getX(i);
      const b = index.getX(i + 1);
      const c = index.getX(i + 2);
      this.edges.push([getVec(a), getVec(b)]);
      this.edges.push([getVec(b), getVec(c)]);
      this.edges.push([getVec(c), getVec(a)]);
    }
    const uniqueZ = /* @__PURE__ */ new Set();
    for (let i = 0; i < pos.count; i++) {
      uniqueZ.add(Math.round(pos.getZ(i) * 10) / 10);
    }
    const estimatedRings = uniqueZ.size;
    this.ringsPerSegment = estimatedRings > 0 ? Math.floor(this.edges.length / estimatedRings) : 64;
    console.info("[GridArcPool] Bound", this.edges.length, "edges,", estimatedRings, "rings,", this.ringsPerSegment, "edges/ring");
  }
  /**
   * Spawn ULTRA BRIGHT white link arc (pure white, maximum visibility)
   */
  spawnLinkArc(start, end) {
    console.info("[GridArcPool] 🔗 Link arc spawned:", {
      from: start.toArray().map((v) => v.toFixed(2)),
      to: end.toArray().map((v) => v.toFixed(2)),
      length: start.distanceTo(end).toFixed(2)
    });
    this.createArc(start, end, 0.6, new Color(16777215), true);
  }
  /**
   * Update and spawn idle arcs + periodic surge (uses dynamic budgeter)
   */
  update(deltaTime, opts) {
    const now = performance.now();
    const effectiveRate = opts.reduced ? this.targetRate * 0.5 : this.targetRate;
    const interval = 1e3 / effectiveRate;
    if (now - this.lastIdleSpawn > interval && this.edges.length > 0) {
      this.spawnIdleArcChain();
      this.lastIdleSpawn = now;
    }
    if (now - this.lastSurge > this.surgeInterval && this.edges.length > 0) {
      this.spawnSurge();
      this.lastSurge = now;
      this.surgeInterval = 3e3 + Math.random() * 3e3;
    }
    for (let i = this.arcs.length - 1; i >= 0; i--) {
      const arc = this.arcs[i];
      const age = now - arc.birthTime;
      const ratio = age / arc.lifetime;
      if (ratio >= 1) {
        (this.parent ?? this.scene).remove(arc.mesh);
        arc.mesh.geometry.dispose();
        arc.material.dispose();
        this.arcs.splice(i, 1);
      } else {
        arc.material.uniforms.uTime.value += deltaTime;
        arc.material.uniforms.uLifetimeRatio.value = ratio;
      }
    }
  }
  /**
   * Spawn short chain of arcs along edges
   */
  spawnIdleArcChain() {
    const chainLength = 5 + Math.floor(Math.random() * 8);
    let startIdx = Math.floor(Math.random() * this.edges.length);
    const hue = 0.55 + Math.random() * 0.1;
    const color = new Color().setHSL(hue, 1, 0.6);
    const ttl = 0.5 + Math.random() * 0.3;
    for (let i = 0; i < chainLength && startIdx < this.edges.length; i++) {
      const [p0, p1] = this.edges[startIdx];
      if (p0 && p1) {
        this.createArc(p0, p1, ttl, color, false);
      }
      startIdx = (startIdx + 1 + Math.floor(Math.random() * 3)) % this.edges.length;
    }
  }
  /**
   * Create tube arc between two points
   */
  createArc(start, end, ttl, color, isLink) {
    if (this.arcs.length >= this.maxArcs) {
      const oldest = this.arcs.shift();
      if (oldest) {
        (this.parent ?? this.scene).remove(oldest.mesh);
        oldest.mesh.geometry.dispose();
        oldest.material.dispose();
      }
    }
    const curve = new LineCurve3(start, end);
    const radius = isLink ? 0.2 : 0.12;
    const geometry = new TubeGeometry(curve, 16, radius, 8, false);
    const material = new ShaderMaterial({
      uniforms: {
        uTime: { value: 0 },
        uLifetimeRatio: { value: 0 },
        uColor: { value: color },
        uIsLink: { value: isLink ? 1 : 0 }
      },
      vertexShader: arcVertexShader,
      fragmentShader: arcFragmentShader,
      transparent: true,
      blending: AdditiveBlending,
      depthWrite: false,
      depthTest: false
      // CRITICAL: Render on top of tunnel mesh
    });
    const mesh = new Mesh(geometry, material);
    mesh.renderOrder = 2e4;
    mesh.frustumCulled = false;
    (this.parent ?? this.scene).add(mesh);
    this.arcs.push({
      mesh,
      material,
      birthTime: performance.now(),
      lifetime: ttl * 1e3,
      isLink
    });
  }
  /**
   * Spawn SURGE effect - ENHANCED propagating discharge across 8-14 rings
   */
  spawnSurge() {
    const ringCount = 8 + Math.floor(Math.random() * 7);
    const surgeDuration = 250 + Math.random() * 200;
    const delayPerRing = surgeDuration / ringCount;
    const startRing = Math.floor(Math.random() * (this.edges.length / this.ringsPerSegment - ringCount));
    console.info("[GridArcPool] 🌊 SURGE activated:", ringCount, "rings,", surgeDuration.toFixed(0), "ms");
    for (let r = 0; r < ringCount; r++) {
      setTimeout(() => {
        const ringStartIdx = (startRing + r) * this.ringsPerSegment;
        const ringEndIdx = Math.min(ringStartIdx + this.ringsPerSegment, this.edges.length);
        const progress = r / ringCount;
        const hue = 0.52 + progress * 0.08;
        const color = new Color().setHSL(hue, 1, 0.65);
        for (let i = ringStartIdx; i < ringEndIdx; i += 2) {
          const [p0, p1] = this.edges[i];
          if (p0 && p1) {
            this.createArc(p0, p1, 0.3, color, false);
          }
        }
      }, r * delayPerRing);
    }
    window.dispatchEvent(new CustomEvent("mindfractal:surge", {
      detail: { rings: ringCount, duration: surgeDuration }
    }));
  }
  dispose() {
    for (const arc of this.arcs) {
      (this.parent ?? this.scene).remove(arc.mesh);
      arc.mesh.geometry.dispose();
      arc.material.dispose();
    }
    this.arcs = [];
  }
}

class FieldBreath {
  periodMs;
  amplitude;
  boostUntil = 0;
  boostAmplitude = 0;
  constructor(opts) {
    this.periodMs = opts?.periodMs ?? 12e3;
    this.amplitude = 0;
  }
  /**
   * Get current intensity (0.85-1.15 baseline)
   */
  tick(nowMs) {
    const t = nowMs % this.periodMs / this.periodMs;
    const sine = Math.sin(Math.PI * 2 * t);
    const normalized = (sine + 1) / 2;
    const baseIntensity = 1 - this.amplitude / 2 + normalized * this.amplitude;
    const boost = nowMs < this.boostUntil ? this.boostAmplitude : 0;
    return baseIntensity + boost;
  }
  /**
   * Boost breathing intensity after link
   */
  boost(seconds = 2, ampAdd = 0.1) {
    this.boostUntil = performance.now() + seconds * 1e3;
    this.boostAmplitude = ampAdd;
  }
  /**
   * Get twist delta for spiral effect (oscillates -0.05 to +0.05)
   */
  getTwistDelta(nowMs) {
    const t = nowMs % (this.periodMs * 2) / (this.periodMs * 2);
    return Math.sin(Math.PI * 2 * t) * 0.05;
  }
}

class FPSMonitor {
  samples = [];
  lastTime = performance.now();
  sampleSize = 60;
  tick() {
    const now = performance.now();
    const delta = now - this.lastTime;
    this.lastTime = now;
    const fps = 1e3 / delta;
    this.samples.push(fps);
    if (this.samples.length > this.sampleSize) {
      this.samples.shift();
    }
    return fps;
  }
  getAverage() {
    if (this.samples.length === 0) return 60;
    return this.samples.reduce((a, b) => a + b, 0) / this.samples.length;
  }
  reset() {
    this.samples = [];
    this.lastTime = performance.now();
  }
}

class CameraStore {
  key;
  constructor(key) {
    this.key = key;
  }
  save(state) {
    try {
      const data = {
        position: { x: state.position.x, y: state.position.y, z: state.position.z },
        target: { x: state.target.x, y: state.target.y, z: state.target.z },
        zoom: state.zoom
      };
      localStorage.setItem(this.key, JSON.stringify(data));
    } catch (e) {
      console.warn("[CameraStore] Failed to save:", e);
    }
  }
  load() {
    try {
      const json = localStorage.getItem(this.key);
      if (!json) return null;
      const data = JSON.parse(json);
      return {
        position: new Vector3(data.position.x, data.position.y, data.position.z),
        target: new Vector3(data.target.x, data.target.y, data.target.z),
        zoom: data.zoom
      };
    } catch (e) {
      console.warn("[CameraStore] Failed to load:", e);
      return null;
    }
  }
  clear() {
    try {
      localStorage.removeItem(this.key);
    } catch (e) {
      console.warn("[CameraStore] Failed to clear:", e);
    }
  }
}

function useMindFractalPersistence() {
  reactExports.useRef();
  const trackNodeSeen = reactExports.useCallback(async (nodeId, seed) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      await supabase.rpc("mf_upsert_seen", {
        p_node_ids: [nodeId],
        p_seed: BigInt(seed)
      });
      console.info("[MF3D][Persist] Node seen:", nodeId);
    } catch (error) {
      console.warn("[MF3D][Persist] Failed to track node:", error);
    }
  }, []);
  const trackLinkCreated = reactExports.useCallback(async (fromNode, toNode, length, seed) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      await supabase.rpc("mf_add_link", {
        p_from: fromNode,
        p_to: toNode,
        p_length: length,
        p_seed: BigInt(seed)
      });
      console.info("[MF3D][Persist] Link created:", { fromNode, toNode, length });
    } catch (error) {
      console.warn("[MF3D][Persist] Failed to track link:", error);
    }
  }, []);
  const loadProgress = reactExports.useCallback(async (seed) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return null;
      const { data: seenNodes } = await supabase.from("dna_mf_nodes_seen").select("node_id").eq("user_id", user.id).eq("seed", seed);
      const { data: links } = await supabase.from("dna_mf_links").select("node_from, node_to, length").eq("user_id", user.id).eq("seed", seed);
      return {
        seenNodes: seenNodes?.map((n) => n.node_id) || [],
        links: links || []
      };
    } catch (error) {
      console.warn("[MF3D][Persist] Failed to load progress:", error);
      return null;
    }
  }, []);
  return {
    trackNodeSeen,
    trackLinkCreated,
    loadProgress
  };
}

function useMindLinkPersistence() {
  const trackLink = reactExports.useCallback(async (nodeA, nodeB, theme, seed, intensity = 1) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return null;
      const { data, error } = await supabase.rpc("upsert_dna_mind_link", {
        p_user_id: user.id,
        p_seed: BigInt(seed),
        p_node_a: nodeA,
        p_node_b: nodeB,
        p_theme: theme,
        p_intensity: intensity
      });
      if (error) {
        console.warn("[MF3D][Link] Failed to track:", error);
        return null;
      }
      console.info("[MF3D][Link] Tracked:", { nodeA, nodeB, theme, result: data });
      return data[0];
    } catch (error) {
      console.warn("[MF3D][Link] Exception:", error);
      return null;
    }
  }, []);
  const loadLinks = reactExports.useCallback(async (seed) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return [];
      const { data: links } = await supabase.from("dna_mind_links").select("node_a, node_b, theme, intensity").eq("user_id", user.id).eq("seed", seed);
      return links || [];
    } catch (error) {
      console.warn("[MF3D][Link] Failed to load:", error);
      return [];
    }
  }, []);
  return {
    trackLink,
    loadLinks
  };
}

function EvolutionOverlay({ theme, level, message }) {
  const [visible, setVisible] = reactExports.useState(true);
  reactExports.useEffect(() => {
    const timer = setTimeout(() => setVisible(false), 2500);
    return () => clearTimeout(timer);
  }, [theme, level]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: visible && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { opacity: 0, scale: 0.8 },
      animate: { opacity: 1, scale: 1 },
      exit: { opacity: 0, scale: 0.8 },
      transition: { duration: 0.5 },
      className: "absolute inset-0 flex items-center justify-center pointer-events-none z-50",
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-background/90 backdrop-blur-sm border border-primary/30 rounded-2xl p-8 shadow-2xl max-w-md text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: { rotate: 0 },
            animate: { rotate: 360 },
            transition: { duration: 1, ease: "easeInOut" },
            className: "w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-cyan-400 to-violet-600 flex items-center justify-center",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-3xl font-bold text-white", children: level })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold mb-2 bg-gradient-to-r from-cyan-400 to-violet-600 bg-clip-text text-transparent", children: "DNA Evolutivo" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-lg text-muted-foreground mb-1", children: [
          theme,
          " • Livello ",
          level
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-foreground/80", children: message })
      ] })
    }
  ) });
}

function ProgressHUD({ totalLinks, linksByTheme, milestones, maxMilestones, activeTheme }) {
  const maxLinks = 48;
  const percentage = Math.min(100, Math.round(totalLinks / maxLinks * 100));
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-4 left-4 z-40 pointer-events-none select-none", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, x: -20 },
      animate: { opacity: 1, x: 0 },
      className: "backdrop-blur-md bg-black/70 rounded-lg border border-cyan-400/30 p-3 space-y-2",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 font-medium", children: "Links" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white font-mono", children: [
              totalLinks,
              " / ",
              maxLinks
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-48 h-1.5 bg-black/50 rounded-full overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "h-full bg-gradient-to-r from-cyan-400 to-violet-400",
              initial: { width: 0 },
              animate: { width: `${percentage}%` },
              transition: { duration: 0.4, ease: "easeOut" }
            }
          ) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-right", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-cyan-300/70 text-xs font-mono", children: [
            percentage,
            "%"
          ] }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs pt-2 border-t border-cyan-400/20", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-violet-400 font-medium", children: "Milestones" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white font-mono", children: [
            milestones,
            " / ",
            maxMilestones
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: activeTheme && linksByTheme[activeTheme] !== void 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, height: 0 },
            animate: { opacity: 1, height: "auto" },
            exit: { opacity: 0, height: 0 },
            className: "pt-2 border-t border-cyan-400/20",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-300/90", children: activeTheme }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white/90 font-mono", children: [
                  linksByTheme[activeTheme],
                  " / 12"
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-full h-1 bg-black/50 rounded-full overflow-hidden mt-1", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  className: "h-full bg-gradient-to-r from-cyan-500 to-violet-500",
                  initial: { width: 0 },
                  animate: { width: `${Math.min(100, linksByTheme[activeTheme] / 12 * 100)}%` },
                  transition: { duration: 0.3 }
                }
              ) })
            ]
          }
        ) })
      ]
    }
  ) });
}

const MindFractal3D = ({
  className = "",
  onReady,
  onProgress,
  reduced = false,
  seed = 42
}) => {
  const canvasRef = reactExports.useRef(null);
  const mountedRef = reactExports.useRef(false);
  const [isReady, setIsReady] = reactExports.useState(false);
  const [selectedNodeA, setSelectedNodeA] = reactExports.useState(null);
  const [hoveredNode, setHoveredNode] = reactExports.useState(null);
  const [evolution, setEvolution] = reactExports.useState({
    visible: false,
    theme: "",
    level: 0,
    message: ""
  });
  const [linkOverlay, setLinkOverlay] = reactExports.useState({ visible: false, theme: "", message: "" });
  const [totalLinks, setTotalLinks] = reactExports.useState(0);
  const [linksByTheme, setLinksByTheme] = reactExports.useState({});
  const [milestones, setMilestones] = reactExports.useState(0);
  const [activeTheme, setActiveTheme] = reactExports.useState(null);
  const { trackNodeSeen } = useMindFractalPersistence();
  const { trackLink, loadLinks } = useMindLinkPersistence();
  const cameraRef = reactExports.useRef(null);
  const nodeLayerRef = reactExports.useRef(null);
  usePickNode(
    nodeLayerRef.current,
    cameraRef.current,
    canvasRef.current
  );
  reactExports.useEffect(() => {
    if (!canvasRef.current || mountedRef.current) return;
    mountedRef.current = true;
    const canvas = canvasRef.current;
    let animationId;
    const isMobile = /iPad|iPhone|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const renderer = new WebGLRenderer({
      canvas,
      antialias: false,
      // Disabled for performance
      alpha: true,
      powerPreference: "high-performance",
      precision: isMobile ? "mediump" : "highp",
      preserveDrawingBuffer: false
    });
    const dpr = Math.min(1.5, window.devicePixelRatio || 1);
    renderer.setPixelRatio(dpr);
    renderer.outputColorSpace = SRGBColorSpace;
    renderer.toneMapping = ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1;
    const rect = canvas.getBoundingClientRect();
    renderer.setSize(rect.width, rect.height, false);
    console.info("[MF3D] Renderer initialized:", {
      dpr,
      size: { w: rect.width, h: rect.height }
    });
    const scene = new Scene();
    scene.background = new Color(0);
    scene.fog = new Fog(0, 20, 200);
    const tunnelDepth = 60;
    const camera = new PerspectiveCamera(
      55,
      rect.width / rect.height,
      0.1,
      2e3
    );
    cameraRef.current = camera;
    const camStore = new CameraStore("mf_cam_v2");
    const savedCam = camStore.load();
    if (savedCam) {
      camera.position.copy(savedCam.position);
      camera.zoom = savedCam.zoom;
      camera.updateProjectionMatrix();
    } else {
      camera.position.set(0, 0, 12);
    }
    const controls = new OrbitControls(camera, canvas);
    controls.enableRotate = true;
    controls.enableZoom = true;
    controls.enablePan = true;
    controls.enableDamping = false;
    controls.dampingFactor = 0;
    controls.autoRotate = false;
    controls.autoRotateSpeed = 0;
    controls.minDistance = 1e-3 * tunnelDepth;
    controls.maxDistance = 1.6 * tunnelDepth;
    controls.maxPolarAngle = Math.PI * 0.95;
    if (savedCam?.target) {
      controls.target.copy(savedCam.target);
    }
    controls.update();
    controls.addEventListener("change", () => {
      const distance = camera.position.distanceTo(controls.target);
      camera.near = Math.max(5e-3, distance * 15e-4);
      camera.updateProjectionMatrix();
      camStore.save({
        position: camera.position,
        target: controls.target,
        zoom: camera.zoom
      });
    });
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    let qualityLevel = reduced ? "low" : "mobile";
    const qualityPresets = {
      high: { rings: isIOS ? 60 : 96, segments: 64 },
      mobile: { rings: isIOS ? 60 : 80, segments: 60 },
      low: { rings: 56, segments: 40 }
    };
    const tunnelGroup = new Group();
    scene.add(tunnelGroup);
    let tunnelMesh = null;
    let tunnelTwist = 0.1;
    let tunnelRings = qualityPresets[qualityLevel].rings;
    const buildTunnel = () => {
      if (tunnelMesh) {
        tunnelGroup.remove(tunnelMesh);
        tunnelMesh.geometry.dispose();
      }
      const { positions, indices } = buildFractalTunnel({
        rings: tunnelRings,
        segments: qualityPresets[qualityLevel].segments,
        radius: 10,
        depth: -tunnelDepth,
        twist: tunnelTwist
      });
      const geometry = new BufferGeometry();
      geometry.setAttribute("position", new BufferAttribute(positions, 3));
      geometry.setIndex(new BufferAttribute(indices, 1));
      geometry.computeVertexNormals();
      const edges = new EdgesGeometry(geometry, 5);
      const material = new LineBasicMaterial({
        color: 14540253,
        transparent: true,
        opacity: 0.85
      });
      tunnelMesh = new LineSegments(edges, material);
      tunnelGroup.add(tunnelMesh);
      return geometry;
    };
    let tunnelGeometry = buildTunnel();
    const nodeLayer = new NodeLayer(tunnelGroup, tunnelGeometry);
    nodeLayer.initialize(48, seed);
    nodeLayerRef.current = nodeLayer;
    console.info("[MF3D] NodeLayer initialized with 48 nodes, parented to tunnelGroup");
    const linkEngine = new LinkEngine(tunnelDepth);
    const gridArcPool = new GridArcPool(scene);
    gridArcPool.setParent(tunnelGroup);
    gridArcPool.bindGeometry(tunnelGeometry);
    gridArcPool.setFPSTarget(isMobile ? 45 : 60);
    console.info("[MF3D] GridArcPool initialized with budgeter target:", isMobile ? 45 : 60, "fps");
    const fieldBreath = new FieldBreath({ periodMs: 12e3, amp: 0.3 });
    window.addEventListener("mindfractal:surge", (e) => {
      e.detail;
      console.info("[MF3D] 🌊 Surge detected:", e.detail);
    });
    const fpsMonitor = new FPSMonitor();
    let frameCount = 0;
    let lastQualityCheck = Date.now();
    let isPaused = false;
    const handleVisibilityChange = () => {
      isPaused = document.hidden;
      if (!document.hidden) {
        console.info("[MF3D] Tab visible, resuming rendering");
      }
    };
    document.addEventListener("visibilitychange", handleVisibilityChange);
    const resumeLinks = async () => {
      try {
        const links = await loadLinks(seed);
        if (links && Array.isArray(links) && links.length > 0) {
          console.info("[MF3D] Resuming", links.length, "links");
          for (const link of links.slice(-50)) {
            if (link && typeof link.node_a === "number" && typeof link.node_b === "number") {
              nodeLayer.setNodeState(link.node_a, NodeState.LINKED);
              nodeLayer.setNodeState(link.node_b, NodeState.LINKED);
            }
          }
          const stats = nodeLayer.getStats();
          onProgress?.({
            discovered: stats.discovered,
            linked: stats.linked,
            ratio: stats.linked / 48
          });
        }
      } catch (err) {
        console.warn("[MF3D] Resume failed:", err);
      }
    };
    resumeLinks();
    const handlePointerMove = (event) => {
      const rect2 = canvas.getBoundingClientRect();
      const mouse = new Vector2(
        (event.clientX - rect2.left) / rect2.width * 2 - 1,
        -((event.clientY - rect2.top) / rect2.height) * 2 + 1
      );
      const raycaster = new Raycaster();
      raycaster.setFromCamera(mouse, camera);
      const nodeId = nodeLayer.raycast(raycaster);
      setHoveredNode(nodeId);
      canvas.style.cursor = nodeId !== null ? "pointer" : "default";
    };
    let lastClickTime = 0;
    const onCanvasClick = async (event) => {
      const now = Date.now();
      if (now - lastClickTime < 250) return;
      lastClickTime = now;
      const rect2 = canvas.getBoundingClientRect();
      const mouse = new Vector2(
        (event.clientX - rect2.left) / rect2.width * 2 - 1,
        -((event.clientY - rect2.top) / rect2.height) * 2 + 1
      );
      const raycaster = new Raycaster();
      raycaster.setFromCamera(mouse, camera);
      const nodeId = nodeLayer.raycast(raycaster);
      if (nodeId === null) return;
      const node = nodeLayer.getNode(nodeId);
      if (!node) return;
      console.info("[MF3D] node-click", { nodeId, theme: node.theme, stateBefore: node.state });
      if (selectedNodeA === null) {
        if (node.state === NodeState.LOCKED) {
          nodeLayer.setNodeState(nodeId, NodeState.DISCOVERED);
          trackNodeSeen(`node_${nodeId}`, seed);
        }
        setSelectedNodeA(nodeId);
        console.info("[MF3D] Selected node A:", nodeId, node.name);
        window.dispatchEvent(new CustomEvent("mindfractal:node-selected", {
          detail: { nodeId, theme: node.theme, worldPos: node.position.clone() }
        }));
        return;
      }
      if (nodeId !== selectedNodeA) {
        const nodeA = nodeLayer.getNode(selectedNodeA);
        if (!nodeA) {
          setSelectedNodeA(null);
          return;
        }
        const linkResult = linkEngine.createLink(nodeA, node);
        if (!linkResult) {
          console.warn("[MF3D] Link rejected");
          setSelectedNodeA(null);
          return;
        }
        if (node.state === NodeState.LOCKED) {
          nodeLayer.setNodeState(nodeId, NodeState.DISCOVERED);
          trackNodeSeen(`node_${nodeId}`, seed);
        }
        console.info("[MF3D] 🔗 Creating link arc:", {
          from: selectedNodeA,
          to: nodeId,
          posA: nodeA.position.toArray().map((v) => v.toFixed(2)),
          posB: node.position.toArray().map((v) => v.toFixed(2))
        });
        gridArcPool.spawnLinkArc(nodeA.position, node.position);
        fieldBreath.boost(2, 0.1);
        try {
          const audio = new Audio("/sounds/chime.mp3");
          audio.volume = 0.3;
          audio.play().catch(() => {
          });
        } catch {
        }
        nodeLayer.setNodeState(selectedNodeA, NodeState.LINKED);
        nodeLayer.setNodeState(nodeId, NodeState.LINKED);
        const dbResult = await trackLink(selectedNodeA, nodeId, nodeA.theme, seed, 1);
        setTotalLinks((prev) => prev + 1);
        setLinksByTheme((prev) => ({ ...prev, [nodeA.theme]: (prev[nodeA.theme] || 0) + 1 }));
        setActiveTheme(nodeA.theme);
        const themeCount = (linksByTheme[nodeA.theme] || 0) + 1;
        setLinkOverlay({
          visible: true,
          theme: nodeA.theme,
          message: `Connessione riuscita: ${nodeA.theme} +1 • ${themeCount}/12`
        });
        setTimeout(() => setLinkOverlay((prev) => ({ ...prev, visible: false })), 1200);
        const linkAudio = new Audio("/sounds/link-success.mp3");
        linkAudio.volume = 0.3;
        linkAudio.play().catch(() => {
        });
        console.info("[MF3D] link-created", { from: selectedNodeA, to: nodeId, length: linkResult.length.toFixed(2), theme: nodeA.theme, dbTracked: !!dbResult });
        if (dbResult?.milestone_added) {
          const level = dbResult.milestone_level || 1;
          console.info("[MF3D] ✨ Evolution milestone!", { theme: nodeA.theme, level, twist: tunnelTwist });
          setMilestones((prev) => prev + 1);
          tunnelTwist = Math.min(tunnelTwist + 0.12, 0.8);
          tunnelRings = Math.min(tunnelRings + 4, qualityPresets.high.rings);
          setEvolution({
            visible: true,
            theme: nodeA.theme,
            level,
            message: `Milestone raggiunta: ${nodeA.theme} L${level}`
          });
          setTimeout(() => setEvolution((prev) => ({ ...prev, visible: false })), 2500);
          const milestoneAudio = new Audio("/sounds/milestone.mp3");
          milestoneAudio.volume = 0.4;
          milestoneAudio.play().catch(() => {
          });
          setTimeout(() => {
            tunnelGeometry = buildTunnel();
            nodeLayer.regenerate(tunnelGeometry, 48, seed);
            gridArcPool.bindGeometry(tunnelGeometry);
            tunnelGroup.rotation.z = tunnelTwist * 1.4;
          }, 2e3);
          window.dispatchEvent(new CustomEvent("mindfractal:evolve", {
            detail: { theme: nodeA.theme, level }
          }));
        }
        const stats = nodeLayer.getStats();
        onProgress?.({
          discovered: stats.discovered,
          linked: stats.linked,
          ratio: stats.linked / 48
        });
        setSelectedNodeA(null);
      }
    };
    let pointerDownPos = null;
    const handlePointerDown = (event) => {
      pointerDownPos = {
        x: event.clientX,
        y: event.clientY,
        ts: performance.now()
      };
    };
    const handlePointerUp = (event) => {
      if (!pointerDownPos) return;
      const dx = Math.abs(event.clientX - pointerDownPos.x);
      const dy = Math.abs(event.clientY - pointerDownPos.y);
      const dt = performance.now() - pointerDownPos.ts;
      pointerDownPos = null;
      if (dx < 6 && dy < 6 && dt < 180) {
        onCanvasClick(event);
      }
    };
    canvas.addEventListener("pointermove", handlePointerMove);
    canvas.addEventListener("pointerdown", handlePointerDown);
    canvas.addEventListener("pointerup", handlePointerUp);
    const clock = new Clock$1();
    const animate = () => {
      animationId = requestAnimationFrame(animate);
      if (isPaused) return;
      const deltaTime = clock.getDelta();
      const elapsedTime = clock.getElapsedTime();
      fpsMonitor.tick();
      const avgFPS = fpsMonitor.getAverage();
      frameCount++;
      gridArcPool.setCurrentFPS(avgFPS);
      if (frameCount % 120 === 0 && !reduced) {
        const now = Date.now();
        if (avgFPS < 45 && qualityLevel !== "low" && now - lastQualityCheck > 2e3) {
          qualityLevel = qualityLevel === "high" ? "mobile" : "low";
          tunnelGeometry = buildTunnel();
          nodeLayer.regenerate(tunnelGeometry, 48, seed);
          gridArcPool.bindGeometry(tunnelGeometry);
          console.info("[MF3D] Quality downgraded to:", qualityLevel);
          lastQualityCheck = now;
        }
      }
      const nowMs = performance.now();
      const intensity = reduced ? 1 : fieldBreath.tick(nowMs);
      const breathScale = 1;
      tunnelGroup.scale.set(breathScale, breathScale, breathScale);
      if (tunnelMesh?.material) {
        tunnelMesh.material.opacity = 0.85 * intensity;
      }
      gridArcPool.update(deltaTime, { reduced });
      nodeLayer.update(elapsedTime, hoveredNode);
      const minZ = -tunnelDepth + 1e-3 * tunnelDepth;
      if (camera.position.z < minZ) {
        camera.position.z = minZ;
      }
      if (frameCount % 60 === 0) {
        const stats = nodeLayer.getStats();
        const arcStats = gridArcPool.getStats();
        console.info("[MF3D] Stats", {
          fps: avgFPS.toFixed(1),
          draw: renderer.info.render.calls,
          arcs: arcStats.active,
          pr: renderer.getPixelRatio().toFixed(1),
          quality: qualityLevel,
          breathIntensity: intensity.toFixed(2),
          twist: tunnelTwist.toFixed(2),
          nodes: { discovered: stats.discovered, linked: stats.linked },
          camera: { z: camera.position.z.toFixed(1), targetZ: controls.target.z.toFixed(1), near: camera.near.toFixed(3) }
        });
      }
      renderer.render(scene, camera);
      if (frameCount === 1 && !isReady) {
        setIsReady(true);
        onReady?.();
      }
    };
    animate();
    const handleResize = () => {
      const rect2 = canvas.getBoundingClientRect();
      renderer.setSize(rect2.width, rect2.height, false);
      camera.aspect = rect2.width / rect2.height;
      camera.updateProjectionMatrix();
    };
    window.addEventListener("resize", handleResize);
    return () => {
      mountedRef.current = false;
      cancelAnimationFrame(animationId);
      document.removeEventListener("visibilitychange", handleVisibilityChange);
      window.removeEventListener("resize", handleResize);
      canvas.removeEventListener("pointermove", handlePointerMove);
      canvas.removeEventListener("pointerdown", handlePointerDown);
      canvas.removeEventListener("pointerup", handlePointerUp);
      controls.dispose();
      renderer.dispose();
      if (tunnelMesh) {
        tunnelMesh.geometry.dispose();
        tunnelMesh.material.dispose();
      }
      nodeLayer.dispose();
      gridArcPool.dispose();
      scene.clear();
    };
  }, [onReady, onProgress, reduced, seed, trackNodeSeen, trackLink, loadLinks, selectedNodeA, hoveredNode]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `relative ${className}`, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "canvas",
      {
        ref: canvasRef,
        className: "w-full h-full bg-black",
        style: { display: "block" }
      }
    ),
    !isReady && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 flex items-center justify-center bg-black", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center gap-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/60", children: "Inizializzazione Mind Fractal..." })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      ProgressHUD,
      {
        totalLinks,
        linksByTheme,
        milestones,
        maxMilestones: 12,
        activeTheme
      }
    ),
    evolution.visible && /* @__PURE__ */ jsxRuntimeExports.jsx(
      EvolutionOverlay,
      {
        theme: evolution.theme,
        level: evolution.level,
        message: evolution.message
      }
    ),
    linkOverlay.visible && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg bg-black/80 border border-cyan-400/30 backdrop-blur-sm z-50", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-cyan-400 font-medium", children: linkOverlay.message }) }),
    hoveredNode !== null && nodeLayerRef.current && (() => {
      const node = nodeLayerRef.current.getNode(hoveredNode);
      if (!node) return null;
      const parts = node.name.split(" ");
      const theme = parts[0];
      const name = parts.slice(1).join(" ");
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg bg-black/80 border border-cyan-400/30 backdrop-blur-sm", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-cyan-400 font-medium", children: [
        theme,
        " ",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-300", children: "•" }),
        " ",
        name
      ] }) });
    })()
  ] });
};

const DNAHub = ({
  dnaProfile,
  events = [],
  onEvolve
}) => {
  const [showEvolution, setShowEvolution] = reactExports.useState(false);
  const [activeTab, setActiveTab] = reactExports.useState("overview");
  const [showSkippedPill, setShowSkippedPill] = reactExports.useState(false);
  const [showHint, setShowHint] = reactExports.useState(false);
  const [reduceAnimations, setReduceAnimations] = reactExports.useState(false);
  const [enableTesseract] = reactExports.useState(true);
  const [enableRubikDNA] = reactExports.useState(true);
  const { getCurrentUser } = useUnifiedAuth();
  const archetypeConfig = ARCHETYPE_CONFIGS[dnaProfile.archetype];
  const user = getCurrentUser();
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const getTodayKey = () => {
      const today2 = /* @__PURE__ */ new Date();
      return `${today2.getFullYear()}-${String(today2.getMonth() + 1).padStart(2, "0")}-${String(today2.getDate()).padStart(2, "0")}`;
    };
    const lastShown = localStorage.getItem(`dna:lastShown:${user.id}`);
    const completed = localStorage.getItem(`dna:completed:${user.id}`) === "1";
    const today = getTodayKey();
    setShowSkippedPill(lastShown === today && !completed);
    const hintKey = `dna:hintShown:${user.id}:${today}`;
    const hintShown = localStorage.getItem(hintKey) === "1";
    if (!hintShown && activeTab === "overview") {
      setShowHint(true);
      localStorage.setItem(hintKey, "1");
      setTimeout(() => setShowHint(false), 2500);
    }
  }, [user?.id, activeTab]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "min-h-screen bg-black text-white overflow-y-auto",
        style: {
          background: `radial-gradient(circle at 50% 0%, ${archetypeConfig.color}15, transparent 70%), black`
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.header,
            {
              initial: { opacity: 0, y: -20 },
              animate: { opacity: 1, y: 0 },
              className: "p-6 border-b border-white/10 backdrop-blur-xl bg-black/40 relative",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.h1,
                    {
                      className: "text-3xl md:text-4xl font-black bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent mb-2",
                      children: "M1SSION DNA™"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm md:text-base text-white/60 font-medium", children: "Identità Evolutiva dell'Agente — Codice Vivo" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showSkippedPill && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  motion.div,
                  {
                    initial: { opacity: 0, x: 20 },
                    animate: { opacity: 1, x: 0 },
                    exit: { opacity: 0, x: 20 },
                    className: "absolute top-6 right-6 flex items-center gap-2 px-4 py-2 rounded-full bg-yellow-500/10 border border-yellow-500/30 backdrop-blur-sm",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-yellow-400 font-medium", children: "Primo sequenziamento disponibile domani" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        "button",
                        {
                          onClick: () => setShowSkippedPill(false),
                          className: "text-yellow-400/60 hover:text-yellow-400 transition-colors",
                          "aria-label": "Chiudi",
                          children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-4 h-4" })
                        }
                      )
                    ]
                  }
                ) })
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-6xl mx-auto p-6 space-y-8", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { opacity: 0, scale: 0.9 },
                animate: { opacity: 1, scale: 1 },
                className: "flex flex-col md:flex-row items-center gap-6 p-6 rounded-2xl border backdrop-blur-xl",
                style: {
                  backgroundColor: `${archetypeConfig.color}10`,
                  borderColor: `${archetypeConfig.color}30`,
                  boxShadow: `0 0 40px ${archetypeConfig.color}20`
                },
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    ArchetypeIcon,
                    {
                      archetype: dnaProfile.archetype,
                      size: 120
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 text-center md:text-left", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Badge,
                      {
                        className: "mb-2",
                        style: {
                          backgroundColor: `${archetypeConfig.color}20`,
                          color: archetypeConfig.color,
                          borderColor: `${archetypeConfig.color}40`
                        },
                        children: archetypeConfig.name
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "h2",
                      {
                        className: "text-2xl md:text-3xl font-bold mb-2",
                        style: { color: archetypeConfig.color },
                        children: archetypeConfig.nameIt
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm md:text-base", children: archetypeConfig.description })
                  ] })
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2 border-b border-white/10", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: () => setActiveTab("overview"),
                  className: `px-6 py-3 font-semibold transition-all border-b-2 ${activeTab === "overview" ? "border-cyan-400 text-cyan-400" : "border-transparent text-white/50 hover:text-white/80"}`,
                  children: "DNA Overview"
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: () => setActiveTab("history"),
                  className: `px-6 py-3 font-semibold transition-all border-b-2 ${activeTab === "history" ? "border-cyan-400 text-cyan-400" : "border-transparent text-white/50 hover:text-white/80"}`,
                  children: "Storia Genetica"
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: activeTab === "overview" ? /* @__PURE__ */ jsxRuntimeExports.jsxs(
              motion.div,
              {
                initial: { opacity: 0, x: -20 },
                animate: { opacity: 1, x: 0 },
                exit: { opacity: 0, x: 20 },
                className: "space-y-8",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showHint && /* @__PURE__ */ jsxRuntimeExports.jsxs(
                    motion.div,
                    {
                      initial: { opacity: 0, y: -10 },
                      animate: { opacity: 1, y: 0 },
                      exit: { opacity: 0, y: -10 },
                      className: "flex items-center justify-center gap-2 px-4 py-2 mx-auto w-fit rounded-full bg-cyan-500/10 border border-cyan-500/30 backdrop-blur-sm",
                      children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "w-4 h-4 text-cyan-400" }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-cyan-400 font-medium", children: "Muovi il mouse / Trascina per ruotare — doppio clic per reset" })
                      ]
                    }
                  ) }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-3 px-4 py-2 mx-auto w-fit rounded-lg bg-white/5 border border-white/10", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-white/70", children: "Riduci animazioni" }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      Switch,
                      {
                        checked: reduceAnimations,
                        onCheckedChange: setReduceAnimations,
                        "aria-label": "Riduci animazioni DNA"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative w-screen max-w-none left-1/2 -translate-x-1/2 h-[75svh] md:h-[calc(100svh-140px)] md:max-h-[calc(100svh-140px)] overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(DNAErrorBoundary, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    MindFractal3D,
                    {
                      className: "w-full h-full rounded-none md:rounded-xl",
                      seed: dnaProfile.intuito * 1e3 + dnaProfile.audacia * 100 + dnaProfile.etica * 10 + dnaProfile.rischio,
                      onReady: () => console.log("[DNAHub] Mind Fractal 3D ready"),
                      onProgress: (p) => {
                        console.log("[DNAHub] Progress:", p);
                        window.dispatchEvent(new CustomEvent("mf:progress", { detail: p }));
                      },
                      reduced: reduceAnimations
                    }
                  ) })  }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => setActiveTab("history"),
                      size: "lg",
                      variant: "outline",
                      className: "border-white/20 hover:bg-white/10 font-bold px-8",
                      children: "📜 STORIA GENETICA"
                    }
                  ) })
                ]
              },
              "overview"
            ) : /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                initial: { opacity: 0, x: 20 },
                animate: { opacity: 1, x: 0 },
                exit: { opacity: 0, x: -20 },
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(ScrollArea, { className: "h-[500px] rounded-lg border border-white/10 bg-black/40 backdrop-blur-xl p-6", children: events.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-white/50 py-12", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-lg mb-2", children: "Nessuna mutazione registrata" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: "Le tue azioni future scriveranno la storia del tuo DNA" })
                ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-4", children: events.map((event, idx) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    initial: { opacity: 0, y: 20 },
                    animate: { opacity: 1, y: 0 },
                    transition: { delay: idx * 0.05 },
                    className: "p-4 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-start justify-between gap-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-2", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-xs", children: event.source }),
                        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-white/50", children: format(new Date(event.created_at), "dd MMM yyyy, HH:mm", { locale: it$2 }) })
                      ] }),
                      event.note && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/70 mb-2", children: event.note }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-wrap gap-2", children: Object.entries(event.delta || {}).map(([key, val]) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        "span",
                        {
                          className: `text-xs font-mono px-2 py-1 rounded ${val > 0 ? "bg-green-500/20 text-green-400" : val < 0 ? "bg-red-500/20 text-red-400" : "bg-white/10 text-white/60"}`,
                          children: [
                            key.toUpperCase(),
                            ": ",
                            val > 0 ? "+" : "",
                            val
                          ]
                        },
                        key
                      )) })
                    ] }) })
                  },
                  event.id
                )) }) })
              },
              "history"
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 pointer-events-none", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              motion.div,
              {
                className: "absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[800px] rounded-full opacity-20 blur-[100px]",
                style: {
                  background: `radial-gradient(circle, ${archetypeConfig.color}, transparent 70%)`
                },
                animate: {
                  scale: [1, 1.1, 1],
                  opacity: [0.15, 0.25, 0.15]
                },
                transition: {
                  duration: 4,
                  repeat: Infinity,
                  ease: "easeInOut"
                }
              }
            ) })
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      DNAEvolutionScene,
      {
        isOpen: showEvolution,
        archetype: dnaProfile.archetype,
        onComplete: () => setShowEvolution(false)
      }
    )
  ] });
};

const DNAPage = () => {
  const [, setLocation] = useLocation();
  const { isAuthenticated, getCurrentUser } = useUnifiedAuth();
  const { dnaProfile, isLoading: dnaLoading } = useDNA();
  const [events, setEvents] = reactExports.useState([]);
  const [eventsLoading, setEventsLoading] = reactExports.useState(true);
  const user = getCurrentUser();
  reactExports.useEffect(() => {
    if (!dnaLoading && !isAuthenticated) {
      ue$1.error("Accesso negato", {
        description: "Devi essere autenticato per visualizzare il DNA"
      });
      setLocation("/");
    }
  }, [isAuthenticated, dnaLoading, setLocation]);
  reactExports.useEffect(() => {
    const loadEvents = async () => {
      if (!user?.id) return;
      try {
        const { data, error } = await supabase.from("agent_dna_events").select("*").eq("user_id", user.id).order("created_at", { ascending: false }).limit(50);
        if (error) throw error;
        setEvents(data || []);
      } catch (error) {
        console.error("[DNA] Error loading events:", error);
        ue$1.error("Errore nel caricamento della storia DNA");
      } finally {
        setEventsLoading(false);
      }
    };
    if (user?.id) {
      loadEvents();
    }
  }, [user?.id]);
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const channel = supabase.channel(`dna-updates:${user.id}`).on(
      "postgres_changes",
      {
        event: "UPDATE",
        schema: "public",
        table: "agent_dna",
        filter: `user_id=eq.${user.id}`
      },
      (payload) => {
        console.info("[DNA] Realtime update received", payload);
        ue$1.success("DNA aggiornato!", {
          description: "Il tuo profilo genetico è stato modificato"
        });
      }
    ).on(
      "postgres_changes",
      {
        event: "INSERT",
        schema: "public",
        table: "agent_dna_events",
        filter: `user_id=eq.${user.id}`
      },
      (payload) => {
        console.info("[DNA] New event received", payload);
        setEvents((prev) => [payload.new, ...prev]);
      }
    ).subscribe();
    return () => {
      supabase.removeChannel(channel);
    };
  }, [user?.id]);
  const handleEvolve = async () => {
    if (!user?.id) return;
    try {
      const delta = {
        intuito: Math.floor(Math.random() * 10) - 5,
        audacia: Math.floor(Math.random() * 10) - 5,
        etica: Math.floor(Math.random() * 10) - 5,
        rischio: Math.floor(Math.random() * 10) - 5,
        vibrazione: Math.floor(Math.random() * 10) - 5
      };
      const { error } = await supabase.rpc("fn_dna_apply_delta", {
        p_user: user.id,
        p_delta: delta,
        p_source: "manual_evolution",
        p_note: "Evoluzione manuale attivata dall'hub DNA"
      });
      if (error) throw error;
      ue$1.success("Evoluzione completata!", {
        description: "Il tuo DNA è stato modificato"
      });
    } catch (error) {
      console.error("[DNA] Evolution error:", error);
      ue$1.error("Errore durante l'evoluzione");
    }
  };
  if (dnaLoading || eventsLoading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-black flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-12 h-12 animate-spin text-cyan-400 mx-auto" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "Caricamento DNA..." })
    ] }) });
  }
  if (!dnaProfile) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-black flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4 max-w-md px-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-6xl mb-4", children: "🧬" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-white", children: "DNA Non Calibrato" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "Completa il primo sequenziamento genetico per visualizzare il tuo DNA" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => setLocation("/"),
          className: "px-6 py-3 bg-cyan-500 hover:bg-cyan-600 text-white font-bold rounded-lg transition-colors",
          children: "Torna alla Home"
        }
      )
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative min-h-screen", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.button,
      {
        onClick: () => {
          if (window.history.length > 1) {
            window.history.back();
          } else {
            setLocation("/home");
          }
        },
        className: "fixed top-4 left-4 z-50 w-11 h-11 rounded-full bg-background/80 backdrop-blur-md border border-border/50 shadow-lg flex items-center justify-center hover:bg-background/90 transition-all focus:outline-none focus:ring-2 focus:ring-primary/50",
        style: {
          top: "max(1rem, env(safe-area-inset-top))",
          left: "max(1rem, env(safe-area-inset-left))"
        },
        initial: { opacity: 0, x: -20 },
        animate: { opacity: 1, x: 0 },
        transition: { duration: 0.3 },
        whileHover: { scale: 1.05 },
        whileTap: { scale: 0.95 },
        "aria-label": "Torna indietro",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5 text-foreground" })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      DNAHub,
      {
        dnaProfile,
        events,
        onEvolve: handleEvolve
      }
    )
  ] });
};

function PushDiagnostic() {
  const [diagnosticData, setDiagnosticData] = reactExports.useState(null);
  const [isRefreshing, setIsRefreshing] = reactExports.useState(false);
  const [testResult, setTestResult] = reactExports.useState(null);
  const [logs, setLogs] = reactExports.useState([]);
  const addLog = (message) => {
    const timestamp = (/* @__PURE__ */ new Date()).toLocaleTimeString();
    const logEntry = `[${timestamp}] ${message}`;
    setLogs((prev) => [logEntry, ...prev.slice(0, 49)]);
    console.debug(logEntry);
  };
  const refreshDiagnostics = async () => {
    setIsRefreshing(true);
    try {
      addLog("🔄 Starting diagnostic scan...");
      const { data: { user } } = await supabase.auth.getUser();
      const isStandalone = window.matchMedia("(display-mode: standalone)").matches;
      const pushSupported = "serviceWorker" in navigator && "PushManager" in window && "Notification" in window;
      let swRegistrations = [];
      let swController = null;
      if ("serviceWorker" in navigator) {
        const registrations = await navigator.serviceWorker.getRegistrations();
        swRegistrations = [...registrations];
        swController = navigator.serviceWorker.controller;
      }
      let currentSubscription = null;
      if (pushSupported) {
        try {
          const reg = await navigator.serviceWorker.ready;
          currentSubscription = await reg.pushManager.getSubscription();
        } catch (error) {
          addLog(`⚠️ Error getting push subscription: ${error}`);
        }
      }
      let fcmSubscriptions = [];
      if (user) {
        try {
          const { data, error } = await supabase.from("fcm_subscriptions").select("*").eq("user_id", user.id).order("created_at", { ascending: false });
          if (error) {
            addLog(`⚠️ DB query error: ${error.message}`);
          } else {
            fcmSubscriptions = data || [];
          }
        } catch (error) {
          addLog(`⚠️ DB error: ${error.message}`);
        }
      }
      const diagnostics = {
        isStandalone,
        userAgent: navigator.userAgent,
        platform: /iPad|iPhone|iPod/.test(navigator.userAgent) ? "ios" : /Android/.test(navigator.userAgent) ? "android" : "desktop",
        notificationPermission: Notification.permission,
        pushSupported,
        swSupported: "serviceWorker" in navigator,
        swRegistrations: swRegistrations.map((reg) => ({
          scope: reg.scope,
          scriptURL: reg.active?.scriptURL,
          state: reg.active?.state,
          installing: !!reg.installing,
          waiting: !!reg.waiting
        })),
        swController: swController ? {
          scriptURL: swController.scriptURL,
          state: swController.state
        } : null,
        currentSubscription: currentSubscription ? {
          endpoint: currentSubscription.endpoint.substring(0, 50) + "...",
          endpointType: currentSubscription.endpoint.includes("fcm.googleapis.com") ? "fcm" : currentSubscription.endpoint.includes("web.push.apple.com") ? "apns" : "unknown"
        } : null,
        userId: user?.id || null,
        isAuthenticated: !!user,
        fcmSubscriptions: fcmSubscriptions.map((sub) => ({
          id: sub.id,
          token: sub.token.substring(0, 20) + "...",
          platform: sub.platform,
          is_active: sub.is_active,
          created_at: sub.created_at
        })),
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      };
      setDiagnosticData(diagnostics);
      addLog("✅ Diagnostic scan complete");
    } catch (error) {
      addLog(`❌ Diagnostic error: ${error.message}`);
      ue$1.error("Errore diagnostica", { description: error.message });
    } finally {
      setIsRefreshing(false);
    }
  };
  const testPushFlow = async () => {
    addLog("🧪 Starting push notification test...");
    try {
      await enablePush$1();
      addLog("✅ Push test SUCCESS");
      ue$1.success("Test push completato!");
      await refreshDiagnostics();
    } catch (error) {
      addLog(`💥 Push test ERROR: ${error.message}`);
      ue$1.error("Test push error", { description: error.message });
    }
  };
  const testFCMFunction = async () => {
    if (!diagnosticData?.fcmSubscriptions?.length) {
      ue$1.error("Nessun token FCM trovato");
      return;
    }
    const token = diagnosticData.fcmSubscriptions[0];
    addLog(`🔥 Testing FCM function with token ${token.token}...`);
    try {
      const { data, error } = await supabase.functions.invoke("fcm-test", {
        body: {
          token: token.token.replace("...", ""),
          // This won't work with truncated token, but shows the flow
          title: "M1SSION FCM Test",
          body: "Diagnostic test from /debug/push"
        }
      });
      if (error) {
        addLog(`❌ FCM function error: ${error.message}`);
        ue$1.error("FCM test error", { description: error.message });
      } else {
        addLog(`✅ FCM function result: ${JSON.stringify(data)}`);
        ue$1.success("FCM test inviato!");
      }
    } catch (error) {
      addLog(`💥 FCM function exception: ${error.message}`);
      ue$1.error("FCM function error", { description: error.message });
    }
  };
  const copyDiagnostics = () => {
    if (!diagnosticData) return;
    const diagnosticText = JSON.stringify(diagnosticData, null, 2);
    navigator.clipboard.writeText(diagnosticText);
    ue$1.success("Diagnostica copiata negli appunti");
  };
  reactExports.useEffect(() => {
    refreshDiagnostics();
  }, []);
  const getStatusIcon = (condition) => {
    return condition ? /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-green-500" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-4 h-4 text-red-500" });
  };
  if (!diagnosticData) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "container mx-auto p-6", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center min-h-screen", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-8 h-8 animate-spin mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Caricamento diagnostica push..." })
    ] }) }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto p-6 space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold", children: "🔧 Push Diagnostics" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { variant: "outline", onClick: copyDiagnostics, children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Copy, { className: "w-4 h-4 mr-2" }),
          "Copia JSON"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: refreshDiagnostics, disabled: isRefreshing, children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: `w-4 h-4 mr-2 ${isRefreshing ? "animate-spin" : ""}` }),
          "Aggiorna"
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "🌍 Environment" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "PWA Standalone Mode" }),
          getStatusIcon(diagnosticData.isStandalone),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: diagnosticData.isStandalone ? "default" : "secondary", children: diagnosticData.isStandalone ? "Standalone" : "Browser" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Platform" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", children: [
            diagnosticData.platform === "ios" && /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-4 h-4 mr-1" }),
            diagnosticData.platform === "android" && /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-4 h-4 mr-1" }),
            diagnosticData.platform === "desktop" && /* @__PURE__ */ jsxRuntimeExports.jsx(Monitor, { className: "w-4 h-4 mr-1" }),
            diagnosticData.platform
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "UA:" }),
          " ",
          diagnosticData.userAgent.substring(0, 100),
          "..."
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "📱 Push Support" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Service Worker Support" }),
          getStatusIcon(diagnosticData.swSupported)
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Push Manager Support" }),
          getStatusIcon(diagnosticData.pushSupported)
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Notification Permission" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: diagnosticData.notificationPermission === "granted" ? "default" : diagnosticData.notificationPermission === "denied" ? "destructive" : "secondary", children: diagnosticData.notificationPermission })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "⚙️ Service Worker" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { children: [
        diagnosticData.swController && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 p-3 bg-green-50 border border-green-200 rounded-lg", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Controller:" }),
            " ",
            diagnosticData.swController.scriptURL
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-muted-foreground", children: [
            "State: ",
            diagnosticData.swController.state
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "font-medium", children: [
            "Registrations (",
            diagnosticData.swRegistrations.length,
            ")"
          ] }),
          diagnosticData.swRegistrations.map((reg, idx) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 bg-muted/50 rounded text-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Scope:" }),
              " ",
              reg.scope
            ] }),
            reg.scriptURL && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Script:" }),
              " ",
              reg.scriptURL
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "State:" }),
              " ",
              reg.state
            ] })
          ] }, idx))
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "📡 Current Push Subscription" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: diagnosticData.currentSubscription ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Endpoint Type" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: diagnosticData.currentSubscription.endpointType })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Endpoint:" }),
          " ",
          diagnosticData.currentSubscription.endpoint
        ] })
      ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-4 text-muted-foreground", children: "No active push subscription" }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "👤 Authentication" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Authenticated" }),
          getStatusIcon(diagnosticData.isAuthenticated)
        ] }),
        diagnosticData.userId && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "User ID:" }),
          " ",
          diagnosticData.userId
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { children: [
        "🗄️ FCM Database (",
        diagnosticData.fcmSubscriptions.length,
        ")"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: diagnosticData.fcmSubscriptions.length > 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: diagnosticData.fcmSubscriptions.map((sub, idx) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-2 bg-muted/50 rounded text-sm", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: sub.token }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: sub.is_active ? "default" : "secondary", children: sub.is_active ? "Active" : "Inactive" })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground", children: [
          "Platform: ",
          sub.platform,
          " • Created: ",
          new Date(sub.created_at).toLocaleString()
        ] })
      ] }, idx)) }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-4 text-muted-foreground", children: "No FCM subscriptions found" }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "🧪 Test Actions" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: testPushFlow, className: "w-full", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-2" }),
          "Test Complete Push Flow"
        ] }),
        diagnosticData.fcmSubscriptions.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: testFCMFunction, variant: "outline", className: "w-full", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-2" }),
          "Test FCM Edge Function"
        ] }),
        testResult && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 bg-muted/50 rounded-lg", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-medium mb-2", children: "Test Result" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { className: "text-xs overflow-x-auto", children: JSON.stringify(testResult, null, 2) })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "📜 Logs" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-48 overflow-y-auto bg-black text-green-400 p-3 rounded font-mono text-xs", children: [
        logs.map((log, idx) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: log }, idx)),
        logs.length === 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-muted-foreground", children: "No logs yet..." })
      ] }) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground text-center", children: [
      "Diagnostic timestamp: ",
      new Date(diagnosticData.timestamp).toLocaleString()
    ] })
  ] });
}

function M1ssionPushTest() {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto p-4 space-y-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "M1SSION™ Push Test (Placeholder)" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Pagina placeholder per sbloccare la build. Usa il Push Center per i test completi." }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", children: "Ready" })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        onClick: () => {
          try {
            Notification?.requestPermission?.();
          } catch {
          }
        },
        children: "Request Notification Permission"
      }
    )
  ] });
}

const M1ssionDebugTest = () => {
  const [isTestingRaw, setIsTestingRaw] = reactExports.useState(false);
  const [debugResult, setDebugResult] = reactExports.useState(null);
  const testRawAPI = async () => {
    setIsTestingRaw(true);
    setDebugResult(null);
    try {
      console.log("🧪 M1SSION™ RAW API TEST");
      const directPayload = {
        app_id: "50cb75f7-f065-4626-9a63-ce5692fa7e70",
        included_segments: ["Subscribed Users"],
        contents: { "en": "🧪 DIRECT M1SSION™ API TEST" },
        headings: { "en": "Test Diretto OneSignal" }
      };
      console.log("📡 Testing direct OneSignal API...");
      const response = await fetch("https://onesignal.com/api/v1/notifications", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Basic os_v2_app_kdfxl57qmvdcngtdzzljf6t6od5lu3aqsvfuepv3ssgtn2suiajfh72u3cdgn57kni5akugzkqb5ufocgblyjt7q4vi5yy6fdxr7fna`,
          "Accept": "application/json"
        },
        body: JSON.stringify(directPayload)
      });
      const result = await response.json();
      console.log("🔔 Direct OneSignal Result:", {
        status: response.status,
        result,
        headers: Object.fromEntries(response.headers.entries())
      });
      setDebugResult({
        success: response.ok,
        status: response.status,
        result,
        method: "DIRECT_API_CALL",
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
      if (response.ok) {
        ue$1.success("✅ Direct OneSignal API Success!", {
          description: `Notification ID: ${result.id}`
        });
      } else {
        ue$1.error("❌ Direct OneSignal API Failed", {
          description: `Status: ${response.status}`
        });
      }
    } catch (error) {
      console.error("❌ Direct API Test Error:", error);
      setDebugResult({
        success: false,
        error: error.message,
        method: "DIRECT_API_CALL",
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      });
      ue$1.error("Direct API test failed", {
        description: error.message
      });
    } finally {
      setIsTestingRaw(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto p-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "mb-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        "🔧 M1SSION™ RAW API DEBUG",
        /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "destructive", children: "EMERGENCY TEST" })
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Alert, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AlertDescription, { children: "Test diretto dell'API OneSignal per verificare se il problema è nella configurazione o nell'Edge Function." }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-muted-foreground space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "🔑 OneSignal App ID:" }),
            " 50cb75f7-f065-4626-9a63-ce5692fa7e70"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "🔐 REST API Key:" }),
            " os_v2_app_...6fdxr7fna (configurata)"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "📡 Target:" }),
            " https://onesignal.com/api/v1/notifications"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "📱 Audience:" }),
            " Subscribed Users (broadcast)"
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: testRawAPI,
            disabled: isTestingRaw,
            className: "w-full",
            size: "lg",
            variant: "destructive",
            children: isTestingRaw ? "🔄 Testing Direct API..." : "🧪 TEST DIRECT ONESIGNAL API"
          }
        ),
        debugResult && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-6 p-4 border rounded-lg", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("h4", { className: "font-semibold mb-3 flex items-center gap-2", children: [
            debugResult.success ? "✅ SUCCESS" : "❌ FAILED",
            /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: debugResult.success ? "default" : "destructive", children: [
              "Status: ",
              debugResult.status || "ERROR"
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs bg-muted p-3 rounded overflow-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { children: JSON.stringify(debugResult, null, 2) }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 text-sm", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Timestamp:" }),
              " ",
              debugResult.timestamp
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Method:" }),
              " ",
              debugResult.method
            ] }),
            debugResult.result?.id && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "OneSignal ID:" }),
              " ",
              debugResult.result.id
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground border-t pt-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h5", { className: "font-semibold mb-2", children: "🧪 Diagnostica:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("ul", { className: "list-disc list-inside space-y-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Se questo test funziona → Problema nell'Edge Function Supabase" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Se questo test fallisce → Problema nella configurazione OneSignal" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Status 400 → Payload malformato" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Status 401 → API Key non valida" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("li", { children: "Status 429 → Rate limit superato" })
          ] })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center text-sm text-muted-foreground", children: "© 2025 M1SSION™ – NIYVORA KFT – Joseph MULÉ" })
  ] });
};

function useFcm(userId) {
  const [state, setState] = reactExports.useState({
    status: "idle",
    error: null,
    subscription: null,
    userId: null
  });
  const [isSupported, setIsSupported] = reactExports.useState(false);
  const [permission, setPermission] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const checkSupport = () => {
      const supported = webPushManager.isSupported();
      setIsSupported(supported);
      setPermission(Notification.permission);
    };
    checkSupport();
    webPushManager.getCurrent().then((sub) => {
      if (sub) {
        setState((prev) => ({
          ...prev,
          subscription: sub,
          status: "success"
        }));
      }
    });
  }, []);
  const generate = reactExports.useCallback(async () => {
    if (!isSupported) {
      setState((prev) => ({
        ...prev,
        status: "error",
        error: "Web Push not supported in this browser"
      }));
      return;
    }
    setState((prev) => ({
      ...prev,
      status: "loading",
      error: null
    }));
    try {
      console.log("[WEBPUSH] hook generate → START");
      const subscription = await webPushManager.subscribe(userId);
      console.log("[WEBPUSH] hook generate → SUCCESS");
      setState({
        status: "success",
        error: null,
        subscription,
        userId: userId || null
      });
    } catch (error) {
      console.error("[WEBPUSH] hook generate → ERROR:", error);
      setState((prev) => ({
        ...prev,
        status: "error",
        error: error.message || "Failed to generate push subscription"
      }));
    }
  }, [userId, isSupported]);
  return {
    ...state,
    generate,
    isSupported,
    permission,
    token: state.subscription?.endpoint || null
    // endpoint as token
  };
}

const FCMDebugPanel = () => {
  const [isVisible, setIsVisible] = reactExports.useState(false);
  const [swInfo, setSwInfo] = reactExports.useState(null);
  const [edgeFunctionStatus, setEdgeFunctionStatus] = reactExports.useState("idle");
  const [edgeFunctionError, setEdgeFunctionError] = reactExports.useState(null);
  const { status, error, token, generate, isSupported, permission } = useFcm();
  reactExports.useEffect(() => {
    const isDebug = window.location.search.includes("debug=true") || localStorage.getItem("fcm_debug") === "true";
    setIsVisible(isDebug);
  }, []);
  reactExports.useEffect(() => {
    const getSwInfo = async () => {
      if ("serviceWorker" in navigator) {
        try {
          const registrations = await navigator.serviceWorker.getRegistrations();
          const activeReg = registrations.find((reg) => reg.active);
          setSwInfo({
            registered: registrations.length > 0,
            count: registrations.length,
            scope: activeReg?.scope || "none",
            scriptURL: activeReg?.active?.scriptURL || "none",
            state: activeReg?.active?.state || "none"
          });
        } catch (error2) {
          setSwInfo({ error: error2.message });
        }
      }
    };
    if (isVisible) {
      getSwInfo();
    }
  }, [isVisible]);
  const testEdgeFunction = async () => {
    if (!token) return;
    setEdgeFunctionStatus("testing");
    setEdgeFunctionError(null);
    try {
      const { data, error: error2 } = await supabase.functions.invoke("send-firebase-push", {
        body: {
          token,
          title: "M1SSION™ Debug Test",
          body: "Edge Function connectivity test",
          data: { debug: true, timestamp: Date.now() }
        }
      });
      if (error2) {
        setEdgeFunctionStatus("error");
        setEdgeFunctionError(error2.message);
      } else {
        setEdgeFunctionStatus("success");
        console.log("[M1SSION FCM] edge function test → OK:", data);
      }
    } catch (err) {
      setEdgeFunctionStatus("error");
      setEdgeFunctionError(err.message || "Network error");
    }
  };
  if (!isVisible) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "fixed bottom-4 right-4 w-96 max-h-[80vh] overflow-y-auto z-50 bg-background/95 backdrop-blur-sm border-2 border-orange-500", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-sm text-orange-500 flex items-center justify-between", children: [
      "🔧 M1SSION™ FCM Debug Panel",
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "ghost",
          size: "sm",
          onClick: () => setIsVisible(false),
          className: "h-6 w-6 p-0",
          children: "×"
        }
      )
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3 text-xs", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Browser Support:" }),
        isSupported ? /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "default", className: "bg-green-600", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-3 w-3 mr-1" }),
          "Supported"
        ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "destructive", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "h-3 w-3 mr-1" }),
          "Not Supported"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Notification Permission:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Badge,
          {
            variant: permission === "granted" ? "default" : permission === "denied" ? "destructive" : "secondary",
            className: permission === "granted" ? "bg-green-600" : "",
            children: permission || "default"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Service Worker:" }),
          swInfo ? /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: swInfo.registered ? "default" : "destructive", className: swInfo.registered ? "bg-green-600" : "", children: [
            swInfo.registered ? /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-3 w-3 mr-1" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "h-3 w-3 mr-1" }),
            swInfo.registered ? "Active" : "None"
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", children: "Loading..." })
        ] }),
        swInfo && swInfo.registered && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground pl-2 space-y-1", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            "Scope: ",
            swInfo.scope
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            "URL: ",
            swInfo.scriptURL?.split("/").pop()
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            "State: ",
            swInfo.state
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "FCM Token:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Badge,
          {
            variant: status === "success" ? "default" : status === "error" ? "destructive" : "secondary",
            className: status === "success" ? "bg-green-600" : "",
            children: [
              status === "loading" && /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "h-3 w-3 mr-1 animate-spin" }),
              status === "success" && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-3 w-3 mr-1" }),
              status === "error" && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "h-3 w-3 mr-1" }),
              status
            ]
          }
        )
      ] }),
      token && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground", children: [
        "Token: ",
        token.substring(0, 16),
        "..."
      ] }),
      error && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-red-500 bg-red-50 p-2 rounded", children: [
        "Error: ",
        error
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          onClick: generate,
          disabled: status === "loading",
          size: "sm",
          className: "w-full",
          children: [
            status === "loading" ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "h-3 w-3 mr-1 animate-spin" }) : "🔄",
            "Generate Token"
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-t pt-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Edge Function:" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Badge,
            {
              variant: edgeFunctionStatus === "success" ? "default" : edgeFunctionStatus === "error" ? "destructive" : "secondary",
              className: edgeFunctionStatus === "success" ? "bg-green-600" : "",
              children: [
                edgeFunctionStatus === "testing" && /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "h-3 w-3 mr-1 animate-spin" }),
                edgeFunctionStatus === "success" && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-3 w-3 mr-1" }),
                edgeFunctionStatus === "error" && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "h-3 w-3 mr-1" }),
                edgeFunctionStatus
              ]
            }
          )
        ] }),
        edgeFunctionError && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-red-500 bg-red-50 p-2 rounded mb-2", children: edgeFunctionError }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: testEdgeFunction,
            disabled: !token || edgeFunctionStatus === "testing",
            size: "sm",
            variant: "outline",
            className: "w-full",
            children: [
              edgeFunctionStatus === "testing" ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "h-3 w-3 mr-1 animate-spin" }) : "📡",
              "Test Push Send"
            ]
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-muted-foreground text-center pt-2 border-t", children: [
        "AG-X0197 Debug Mode • ",
        (/* @__PURE__ */ new Date()).toLocaleTimeString()
      ] })
    ] })
  ] });
};

function FirebaseNotificationDebug() {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(FCMDebugPanel, {});
}

function PushEnableButton() {
  const [pending, setPending] = reactExports.useState(false);
  const onClick = async () => {
    setPending(true);
    try {
      await enablePush$1();
    } finally {
      setPending(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { disabled: pending, onClick, children: pending ? "Enabling…" : "Enable Push" });
}

function urlBase64ToUint8Array(base64String) {
  const padding = "=".repeat((4 - base64String.length % 4) % 4);
  const base64 = (base64String + padding).replace(/-/g, "+").replace(/_/g, "/");
  const rawData = window.atob(base64);
  const outputArray = new Uint8Array(rawData.length);
  for (let i = 0; i < rawData.length; ++i) {
    outputArray[i] = rawData.charCodeAt(i);
  }
  return outputArray;
}
function useWebPush() {
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [isSubscribed, setIsSubscribed] = reactExports.useState(false);
  const [permission, setPermission] = reactExports.useState(
    typeof window !== "undefined" ? Notification.permission : "default"
  );
  const isSupported = typeof window !== "undefined" && "serviceWorker" in navigator && "PushManager" in window && "Notification" in window;
  const ensureServiceWorker = reactExports.useCallback(async () => {
    console.log("[useWebPush] Ensuring service worker...");
    if (!isSupported) {
      throw new Error("Service Worker o Push Manager non supportati");
    }
    let registration = await navigator.serviceWorker.getRegistration("/");
    if (!registration) {
      console.log("[useWebPush] Registering new service worker...");
      registration = await navigator.serviceWorker.register("/sw.js", {
        scope: "/"
      });
      console.log("[useWebPush] Service worker registered:", registration.scope);
    }
    const readyRegistration = await navigator.serviceWorker.ready;
    console.log("[useWebPush] Service worker ready");
    return readyRegistration;
  }, [isSupported]);
  const requestPermission = reactExports.useCallback(async () => {
    console.log("[useWebPush] Requesting notification permission...");
    if (!isSupported) {
      throw new Error("Notifiche non supportate in questo browser");
    }
    const result = await Notification.requestPermission();
    console.log("[useWebPush] Permission result:", result);
    setPermission(result);
    if (result !== "granted") {
      throw new Error("Permesso per le notifiche negato");
    }
    return result;
  }, [isSupported]);
  const subscribe = reactExports.useCallback(async (vapidPublicKey) => {
    console.log("[useWebPush] Subscribing to push notifications...");
    setIsLoading(true);
    try {
      if (permission !== "granted") {
        await requestPermission();
      }
      const registration = await ensureServiceWorker();
      const existingSubscription = await registration.pushManager.getSubscription();
      if (existingSubscription) {
        console.log("[useWebPush] Already subscribed, using existing subscription");
        const subscriptionData2 = {
          endpoint: existingSubscription.endpoint,
          keys: {
            p256dh: btoa(String.fromCharCode(...new Uint8Array(existingSubscription.getKey("p256dh")))),
            auth: btoa(String.fromCharCode(...new Uint8Array(existingSubscription.getKey("auth"))))
          }
        };
        setIsSubscribed(true);
        return subscriptionData2;
      }
      const subscription = await registration.pushManager.subscribe({
        userVisibleOnly: true,
        applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)
      });
      console.log("[useWebPush] Push subscription created:", subscription.endpoint);
      const subscriptionData = {
        endpoint: subscription.endpoint,
        keys: {
          p256dh: btoa(String.fromCharCode(...new Uint8Array(subscription.getKey("p256dh")))),
          auth: btoa(String.fromCharCode(...new Uint8Array(subscription.getKey("auth"))))
        }
      };
      setIsSubscribed(true);
      return subscriptionData;
    } catch (error) {
      console.error("[useWebPush] Subscription failed:", error);
      throw error;
    } finally {
      setIsLoading(false);
    }
  }, [permission, requestPermission, ensureServiceWorker]);
  const saveSubscription = reactExports.useCallback(async (subscription, extra = {}) => {
    console.log("[useWebPush] Saving subscription to server...");
    setIsLoading(true);
    try {
      const payload = {
        subscription: {
          endpoint: subscription.endpoint,
          keys: subscription.keys
        },
        platform: navigator.platform || "unknown",
        ua: navigator.userAgent,
        app_version: "web-app",
        ...extra
      };
      console.log("[useWebPush] Sending payload:", JSON.stringify(payload, null, 2));
      const { data, error } = await supabase.functions.invoke("push_subscribe", {
        body: payload
      });
      if (error) {
        console.error("[useWebPush] Save subscription error:", error);
        throw new Error(`Errore nel salvare la sottoscrizione: ${error.message}`);
      }
      console.log("[useWebPush] Subscription saved successfully:", data);
      return data;
    } catch (error) {
      console.error("[useWebPush] Save subscription failed:", error);
      throw error;
    } finally {
      setIsLoading(false);
    }
  }, []);
  const testPush = reactExports.useCallback(async (options) => {
    console.log("[useWebPush] Sending test push...", options);
    setIsLoading(true);
    try {
      const payload = {
        title: options.title || "M1SSION™ Test",
        body: options.body || "Test push notification",
        url: options.url || "/",
        ...options
      };
      console.log("[useWebPush] Test push payload:", JSON.stringify(payload, null, 2));
      const { data, error } = await supabase.functions.invoke("push_send", {
        body: payload
      });
      if (error) {
        console.error("[useWebPush] Test push error:", error);
        throw new Error(`Errore nell'invio della notifica: ${error.message}`);
      }
      console.log("[useWebPush] Test push sent successfully:", data);
      return data;
    } catch (error) {
      console.error("[useWebPush] Test push failed:", error);
      throw error;
    } finally {
      setIsLoading(false);
    }
  }, []);
  const checkSubscription = reactExports.useCallback(async () => {
    if (!isSupported) return null;
    try {
      const registration = await navigator.serviceWorker.getRegistration("/");
      if (!registration) return null;
      const subscription = await registration.pushManager.getSubscription();
      if (!subscription) return null;
      const subscriptionData = {
        endpoint: subscription.endpoint,
        keys: {
          p256dh: btoa(String.fromCharCode(...new Uint8Array(subscription.getKey("p256dh")))),
          auth: btoa(String.fromCharCode(...new Uint8Array(subscription.getKey("auth"))))
        }
      };
      setIsSubscribed(true);
      return subscriptionData;
    } catch (error) {
      console.error("[useWebPush] Check subscription failed:", error);
      return null;
    }
  }, [isSupported]);
  return {
    isSupported,
    isSubscribed,
    isLoading,
    permission,
    ensureServiceWorker,
    subscribe,
    saveSubscription,
    testPush,
    requestPermission,
    checkSubscription
  };
}

function PushHealth() {
  useToast();
  const { isSupported, permission} = useWebPush();
  const [systemStatus, setSystemStatus] = reactExports.useState({
    serviceWorker: "loading",
    pushSupport: "loading",
    vapidKeys: "loading",
    database: "loading",
    edgeFunctions: "loading"
  });
  const [subscriptionCount, setSubscriptionCount] = reactExports.useState(null);
  const [isRefreshing, setIsRefreshing] = reactExports.useState(false);
  const checkSystemHealth = async () => {
    setIsRefreshing(true);
    const newStatus = { ...systemStatus };
    try {
      if ("serviceWorker" in navigator) {
        const registration = await navigator.serviceWorker.getRegistration("/");
        newStatus.serviceWorker = registration ? "ok" : "error";
      } else {
        newStatus.serviceWorker = "error";
      }
      newStatus.pushSupport = isSupported ? "ok" : "error";
      try {
        const testKey = "BBjgzWK_1_PBZXGLQb-xQjSEUH5jLsNNgx8N0LgOcKUkZeCUaNV_gRE-QM5pKS2bPKUhVJLn0Q-H3BNGnOOjy8Q";
        const decoded = atob(testKey.replace(/-/g, "+").replace(/_/g, "/"));
        newStatus.vapidKeys = decoded.length === 65 ? "ok" : "error";
      } catch {
        newStatus.vapidKeys = "error";
      }
      try {
        const { count, error } = await supabase.from("push_subscriptions").select("*", { count: "exact", head: true });
        if (error) {
          newStatus.database = "error";
          console.error("Database check failed:", error);
        } else {
          newStatus.database = "ok";
          setSubscriptionCount(count || 0);
        }
      } catch (error) {
        newStatus.database = "error";
        console.error("Database check failed:", error);
      }
      try {
        const { error } = await supabase.functions.invoke("push_send", {
          body: { test: true }
        });
        newStatus.edgeFunctions = "ok";
      } catch (error) {
        newStatus.edgeFunctions = "error";
        console.error("Edge function check failed:", error);
      }
    } catch (error) {
      console.error("System health check failed:", error);
    }
    setSystemStatus(newStatus);
    setIsRefreshing(false);
  };
  reactExports.useEffect(() => {
    checkSystemHealth();
  }, []);
  const getStatusIcon = (status) => {
    switch (status) {
      case "ok":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-4 w-4 text-green-500" });
      case "error":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "h-4 w-4 text-red-500" });
      case "loading":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "h-4 w-4 animate-spin text-yellow-500" });
    }
  };
  const getStatusBadge = (status) => {
    switch (status) {
      case "ok":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "secondary", children: "OK" });
      case "error":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "destructive", children: "Error" });
      case "loading":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: "Loading..." });
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto p-6 space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "text-3xl font-bold flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Activity, { className: "h-8 w-8" }),
          "Push Health Dashboard"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground mt-2", children: "Monitora e testa il sistema di notifiche push" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          onClick: checkSystemHealth,
          disabled: isRefreshing,
          variant: "outline",
          children: [
            isRefreshing ? /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "h-4 w-4 mr-2 animate-spin" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "h-4 w-4 mr-2" }),
            "Aggiorna stato"
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Server, { className: "h-5 w-5" }),
          "Stato Sistema"
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              getStatusIcon(systemStatus.serviceWorker),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Service Worker" })
            ] }),
            getStatusBadge(systemStatus.serviceWorker)
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              getStatusIcon(systemStatus.pushSupport),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Push Support" })
            ] }),
            getStatusBadge(systemStatus.pushSupport)
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              getStatusIcon(systemStatus.vapidKeys),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "VAPID Keys" })
            ] }),
            getStatusBadge(systemStatus.vapidKeys)
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              getStatusIcon(systemStatus.database),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Database" })
            ] }),
            getStatusBadge(systemStatus.database)
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              getStatusIcon(systemStatus.edgeFunctions),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Edge Functions" })
            ] }),
            getStatusBadge(systemStatus.edgeFunctions)
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Database, { className: "h-5 w-5" }),
          "Statistiche Database"
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Sottoscrizioni attive:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: subscriptionCount !== null ? subscriptionCount : "..." })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: "Permesso notifiche:" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: permission === "granted" ? "secondary" : "outline", children: permission })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "md:col-span-2 lg:col-span-1", children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushEnableButton, {}) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Wifi, { className: "h-5 w-5" }),
        "Riepilogo Sistema"
      ] }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { children: [
        Object.values(systemStatus).every((status) => status === "ok") ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-green-600", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-5 w-5" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Sistema completamente funzionante" })
        ] }) : Object.values(systemStatus).some((status) => status === "error") ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-red-600", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleX, { className: "h-5 w-5" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Rilevati problemi nel sistema" })
        ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-yellow-600", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(TriangleAlert, { className: "h-5 w-5" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "font-medium", children: "Controllo sistema in corso..." })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground mt-2", children: "Utilizza questo dashboard per monitorare la salute del sistema push e diagnosticare eventuali problemi." })
      ] })
    ] })
  ] });
}

const PushReport = () => {
  const [report, setReport] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(false);
  const [testing, setTesting] = reactExports.useState(false);
  const generateReport = async () => {
    setLoading(true);
    try {
      const { data: subscriptions } = await supabase.from("push_subscriptions").select("endpoint, platform, endpoint_type, created_at, p256dh, auth").order("created_at", { ascending: false }).limit(10);
      let serviceWorkers = [];
      if ("serviceWorker" in navigator) {
        const registrations = await navigator.serviceWorker.getRegistrations();
        serviceWorkers = registrations.map((reg) => ({
          scriptURL: reg.active?.scriptURL || "No active SW",
          state: reg.active?.state || "No active SW",
          scope: reg.scope
        }));
      }
      let vapidStatus = { valid: false, length: 0, error: "Not checked" };
      try {
        const response = await fetch("/vapid-public.txt");
        const vapidKey = await response.text();
        vapidStatus = {
          valid: vapidKey.length > 40,
          length: vapidKey.length,
          error: vapidKey.length > 40 ? void 0 : "Key too short"
        };
      } catch (error) {
        vapidStatus.error = error instanceof Error ? error.message : "Unknown error";
      }
      setReport({
        subscriptions: (subscriptions || []).map((sub) => ({
          ...sub,
          p256dh_length: sub.p256dh?.length || 0,
          auth_length: sub.auth?.length || 0
        })),
        canary_results: null,
        service_workers: serviceWorkers,
        vapid_status: vapidStatus
      });
    } catch (error) {
      console.error("Report generation error:", error);
      ue$1.error("Errore generazione report");
    } finally {
      setLoading(false);
    }
  };
  const runCanaryTest = async () => {
    setTesting(true);
    try {
      const { data: { user } } = await supabase.auth.getUser();
      const { data, error } = await supabase.functions.invoke("send-push-canary", {
        body: {
          user_id: user?.id,
          title: "M1SSION™ Test",
          body: "Test push da report diagnostico",
          link: "https://m1ssion.eu/push-report",
          broadcast: false
        }
      });
      if (error) throw error;
      setReport((prev) => prev ? {
        ...prev,
        canary_results: {
          ...data,
          pass_rate: data.sent / (data.sent + data.failed) * 100 || 0
        }
      } : null);
      ue$1.success(`Test completato: ${data.sent} inviati, ${data.failed} falliti`);
    } catch (error) {
      console.error("Canary test error:", error);
      ue$1.error("Errore test canary");
    } finally {
      setTesting(false);
    }
  };
  reactExports.useEffect(() => {
    generateReport();
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto p-6 space-y-6", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold", children: "📊 Report Push Notifications" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-x-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: generateReport, disabled: loading, children: [
          loading ? "🔄" : "📊",
          " Aggiorna Report"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { onClick: runCanaryTest, disabled: testing || !report?.subscriptions.length, children: [
          testing ? "🔄" : "🧪",
          " Test Canary"
        ] })
      ] })
    ] }),
    !report ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center py-8", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-pulse", children: "📊 Generazione report..." }) }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid gap-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
          "🔑 Status VAPID",
          /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: report.vapid_status.valid ? "default" : "destructive", children: report.vapid_status.valid ? "Valido" : "Errore" })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4 text-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Lunghezza chiave:" }),
            " ",
            report.vapid_status.length
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Status:" }),
            " ",
            report.vapid_status.valid ? "✅ OK" : "❌ Errore"
          ] }),
          report.vapid_status.error && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "col-span-2 text-red-400", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Errore:" }),
            " ",
            report.vapid_status.error
          ] })
        ] }) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "⚙️ Service Workers Registrati" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: report.service_workers.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-yellow-400", children: "⚠️ Nessun Service Worker registrato" }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: report.service_workers.map((sw, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border rounded p-3 text-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Script:" }),
            " ",
            sw.scriptURL
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "State:" }),
            " ",
            sw.state
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Scope:" }),
            " ",
            sw.scope
          ] })
        ] }, index)) }) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { children: [
          "📱 Subscriptions (",
          report.subscriptions.length,
          ")"
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: report.subscriptions.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-yellow-400", children: "⚠️ Nessuna subscription trovata" }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: report.subscriptions.map((sub, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border rounded p-3 text-sm", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mb-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: sub.endpoint_type }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: sub.platform })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Endpoint:" }),
            " ",
            sub.endpoint.substring(0, 60),
            "..."
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Keys:" }),
            " p256dh=",
            sub.p256dh_length,
            "B, auth=",
            sub.auth_length,
            "B",
            (sub.p256dh_length !== 88 || sub.auth_length !== 24) && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-red-400 ml-2", children: "⚠️ Lunghezza invalida" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Creata:" }),
            " ",
            new Date(sub.created_at).toLocaleDateString()
          ] })
        ] }, index)) }) })
      ] }),
      report.canary_results && /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
          "🧪 Risultati Test Canary",
          /* @__PURE__ */ jsxRuntimeExports.jsxs(
            Badge,
            {
              variant: report.canary_results.pass_rate >= 99 ? "default" : "destructive",
              children: [
                report.canary_results.pass_rate.toFixed(1),
                "%"
              ]
            }
          )
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-3 gap-4 mb-4 text-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border rounded p-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-green-400", children: report.canary_results.sent }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm", children: "Inviati" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border rounded p-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-red-400", children: report.canary_results.failed }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm", children: "Falliti" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border rounded p-3", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold", children: report.canary_results.total_processed }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm", children: "Totale" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Dettagli per endpoint:" }),
            report.canary_results.results.map((result, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 text-sm", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", children: result.endpoint_type }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: result.status === "success" ? "default" : "destructive", children: result.status }),
              result.status_code && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                "HTTP ",
                result.status_code
              ] }),
              result.error && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-red-400", children: result.error })
            ] }, index))
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "🔧 Azioni Raccomandate" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2 text-sm", children: [
          !report.vapid_status.valid && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-red-400", children: "❌ Configurare correttamente le chiavi VAPID" }),
          report.service_workers.length === 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-yellow-400", children: "⚠️ Registrare Service Worker" }),
          report.subscriptions.length === 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-yellow-400", children: "⚠️ Creare almeno una subscription di test" }),
          report.canary_results && report.canary_results.pass_rate < 99 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-red-400", children: "❌ Investigare fallimenti nell'invio push" }),
          (!report.canary_results || report.canary_results.pass_rate >= 99) && report.subscriptions.length > 0 && report.vapid_status.valid && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-green-400", children: "✅ Sistema push funzionante correttamente" })
        ] }) })
      ] })
    ] })
  ] });
};

const ResetPasswordPage = () => {
  const [, setLocation] = useLocation();
  const [newPassword, setNewPassword] = reactExports.useState("");
  const [confirmPassword, setConfirmPassword] = reactExports.useState("");
  const [loading, setLoading] = reactExports.useState(false);
  const [session, setSession] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const checkSession = async () => {
      const { data: { session: session2 } } = await supabase.auth.getSession();
      console.log("Reset page session:", session2);
      setSession(session2);
    };
    checkSession();
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (event, session2) => {
        console.log("Auth state change in reset page:", event, session2);
        if (event === "PASSWORD_RECOVERY") {
          setSession(session2);
          ue$1.info("Inserisci la nuova password");
        }
        if (event === "SIGNED_IN" && session2) {
          setSession(session2);
        }
      }
    );
    return () => subscription.unsubscribe();
  }, []);
  const handleResetPassword = async (e) => {
    e.preventDefault();
    if (!newPassword || !confirmPassword) {
      ue$1.error("Inserisci entrambe le password");
      return;
    }
    if (newPassword !== confirmPassword) {
      ue$1.error("Le password non corrispondono");
      return;
    }
    if (newPassword.length < 8) {
      ue$1.error("La password deve essere di almeno 8 caratteri");
      return;
    }
    setLoading(true);
    try {
      const { error } = await supabase.auth.updateUser({
        password: newPassword
      });
      if (error) {
        console.error("Password reset error:", error);
        ue$1.error("Errore nel reset della password: " + error.message);
      } else {
        ue$1.success("Password aggiornata con successo!");
        setTimeout(() => {
          setLocation("/home");
        }, 2e3);
      }
    } catch (error) {
      console.error("Password reset error:", error);
      ue$1.error("Errore imprevisto");
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black bg-gradient-to-b from-background/50 to-black", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-md w-full p-6 mx-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold gradient-text-cyan mb-2", children: "Reset Password" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Inserisci la tua nuova password" })
    ] }),
    session ? /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleResetPassword, className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          type: "password",
          placeholder: "Nuova password",
          value: newPassword,
          onChange: (e) => setNewPassword(e.target.value),
          className: "bg-background/20 border-white/20",
          required: true,
          minLength: 8
        }
      ) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: /* @__PURE__ */ jsxRuntimeExports.jsx(
        Input,
        {
          type: "password",
          placeholder: "Conferma password",
          value: confirmPassword,
          onChange: (e) => setConfirmPassword(e.target.value),
          className: "bg-background/20 border-white/20",
          required: true,
          minLength: 8
        }
      ) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          type: "submit",
          className: "w-full",
          disabled: loading,
          children: loading ? "Aggiornamento..." : "Aggiorna Password"
        }
      )
    ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground", children: "Caricamento del link di recovery..." }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "outline",
          onClick: () => setLocation("/login"),
          children: "Torna al Login"
        }
      )
    ] })
  ] }) });
};

const Terms = () => {
  const [location, setLocation] = useLocation();
  const [document, setDocument] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    loadLegalDocument();
  }, []);
  const loadLegalDocument = async () => {
    try {
      const { data, error } = await supabase.from("legal_documents").select("*").eq("type", "terms_of_service").eq("is_active", true).maybeSingle();
      if (error && error.code !== "PGRST116") {
        console.error("Error loading terms document:", error);
      }
      if (data) {
        setDocument(data);
      }
    } catch (error) {
      console.error("Error loading terms document:", error);
    } finally {
      setLoading(false);
    }
  };
  const handleBack = () => {
    setLocation("/");
  };
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin w-8 h-8 border-2 border-[#00D1FF] border-t-transparent rounded-full mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Caricamento documento..." })
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex flex-col bg-black text-white p-4 pt-20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto max-w-4xl", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { variant: "outline", className: "mb-8", onClick: handleBack, children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "mr-2 w-4 h-4" }),
      " Torna alla Home"
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "relative overflow-hidden rounded-[24px] p-8",
        style: {
          background: "rgba(0, 0, 0, 0.05)",
          backdropFilter: "blur(40px)",
          WebkitBackdropFilter: "blur(40px)",
          border: "1px solid rgba(255, 255, 255, 0.1)",
          boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold mb-6", children: document?.title || "Termini e Condizioni" }),
          document ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-6 prose prose-invert max-w-none", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "div",
            {
              className: "text-gray-300",
              dangerouslySetInnerHTML: { __html: document.content_md.replace(/\n/g, "<br />") }
            }
          ) }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-12", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-lg mb-4", children: "🚫 Documento non disponibile" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-500 mb-6", children: "Il documento richiesto non è attualmente disponibile." }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleBack, className: "bg-[#00D1FF] hover:bg-[#00B8E6] text-black", children: "Torna alla Home" })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-10 text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleBack, className: "bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink", children: "Torna alla Home" }) })
        ]
      }
    )
  ] }) });
};

const Contact = () => {
  const [formData, setFormData] = reactExports.useState({
    name: "",
    email: "",
    phone: "",
    subject: "",
    message: ""
  });
  const [isSubmitting, setIsSubmitting] = reactExports.useState(false);
  const { toast } = useToast();
  const handleInputChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!formData.name || !formData.email || !formData.message) {
      toast({
        title: "Campi obbligatori",
        description: "Compila nome, email e messaggio per inviare la richiesta.",
        variant: "destructive"
      });
      return;
    }
    setIsSubmitting(true);
    try {
      const { error } = await supabase.from("contacts").insert([formData]);
      if (error) {
        throw error;
      }
      toast({
        title: "✅ Messaggio inviato",
        description: "Ti contatteremo al più presto. Grazie per averci scritto!"
      });
      setFormData({
        name: "",
        email: "",
        phone: "",
        subject: "",
        message: ""
      });
    } catch (error) {
      console.error("Error sending contact form:", error);
      toast({
        title: "❌ Errore invio",
        description: "Impossibile inviare il messaggio. Riprova più tardi.",
        variant: "destructive"
      });
    } finally {
      setIsSubmitting(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-black via-gray-900 to-black p-4 pt-20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-12", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "text-4xl font-orbitron font-bold mb-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00E5FF]", children: "Contatti" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: " M1SSION™" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-lg", children: "Hai domande? Vuoi maggiori informazioni? Scrivici!" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid lg:grid-cols-2 gap-8", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Card,
        {
          className: "relative overflow-hidden rounded-[24px]",
          style: {
            background: "rgba(0, 0, 0, 0.05)",
            backdropFilter: "blur(40px)",
            WebkitBackdropFilter: "blur(40px)",
            border: "1px solid rgba(255, 255, 255, 0.1)",
            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-2xl font-orbitron text-white flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "w-6 h-6 mr-3 text-[#00D1FF]" }),
              "Informazioni di Contatto"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "w-5 h-5 text-[#00D1FF] mt-1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Email" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "info@m1ssion.app" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "support@m1ssion.app" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Phone, { className: "w-5 h-5 text-[#00D1FF] mt-1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Telefono" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "+39 XXX XXX XXXX" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 text-sm", children: "Lun-Ven 9:00-18:00" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start space-x-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(MapPin, { className: "w-5 h-5 text-[#00D1FF] mt-1" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium", children: "Sede" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "NIYVORA KFT™" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70", children: "Ungheria, EU" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "pt-6 border-t border-white/10", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-white font-medium mb-3", children: "Team di Sviluppo" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/70 text-sm", children: [
                  "M1SSION™ è sviluppato da ",
                  /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Joseph MULÉ" }),
                  ", CEO di NIYVORA KFT™. Il team è dedicato a creare esperienze di gioco innovative e coinvolgenti."
                ] })
              ] })
            ] })
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Card,
        {
          className: "relative overflow-hidden rounded-[24px]",
          style: {
            background: "rgba(0, 0, 0, 0.05)",
            backdropFilter: "blur(40px)",
            WebkitBackdropFilter: "blur(40px)",
            border: "1px solid rgba(255, 255, 255, 0.1)",
            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-2xl font-orbitron text-white flex items-center", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-6 h-6 mr-3 text-[#00D1FF]" }),
              "Invia un Messaggio"
            ] }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "name", className: "text-white", children: "Nome *" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: "name",
                      name: "name",
                      value: formData.name,
                      onChange: handleInputChange,
                      placeholder: "Il tuo nome",
                      className: "bg-white/5 border-white/20 text-white placeholder:text-white/50",
                      required: true
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "email", className: "text-white", children: "Email *" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: "email",
                      name: "email",
                      type: "email",
                      value: formData.email,
                      onChange: handleInputChange,
                      placeholder: "tua@email.com",
                      className: "bg-white/5 border-white/20 text-white placeholder:text-white/50",
                      required: true
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid md:grid-cols-2 gap-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "phone", className: "text-white", children: "Telefono" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: "phone",
                      name: "phone",
                      value: formData.phone,
                      onChange: handleInputChange,
                      placeholder: "+39 XXX XXX XXXX",
                      className: "bg-white/5 border-white/20 text-white placeholder:text-white/50"
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "subject", className: "text-white", children: "Oggetto" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Input,
                    {
                      id: "subject",
                      name: "subject",
                      value: formData.subject,
                      onChange: handleInputChange,
                      placeholder: "Oggetto del messaggio",
                      className: "bg-white/5 border-white/20 text-white placeholder:text-white/50"
                    }
                  )
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "message", className: "text-white", children: "Messaggio *" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Textarea,
                  {
                    id: "message",
                    name: "message",
                    value: formData.message,
                    onChange: handleInputChange,
                    placeholder: "Scrivi qui il tuo messaggio...",
                    className: "bg-white/5 border-white/20 text-white placeholder:text-white/50 min-h-[120px]",
                    required: true
                  }
                )
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                Button,
                {
                  type: "submit",
                  disabled: isSubmitting,
                  className: "w-full bg-gradient-to-r from-[#00D1FF] to-[#0099CC] hover:from-[#0099CC] hover:to-[#007799] text-black font-medium",
                  children: isSubmitting ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-black/20 border-t-black rounded-full animate-spin mr-2" }),
                    "Invio in corso..."
                  ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "w-4 h-4 mr-2" }),
                    "Invia Messaggio"
                  ] })
                }
              )
            ] }) })
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center mt-12", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#00D1FF]/10 border border-[#00D1FF]/30 rounded-lg p-6 max-w-2xl mx-auto", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-[#00D1FF] font-medium mb-2", children: "Nota Privacy" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "I tuoi dati verranno trattati secondo la nostra Privacy Policy e utilizzati esclusivamente per rispondere alla tua richiesta. Non condividiamo mai i dati degli utenti con terze parti." })
    ] }) })
  ] }) });
};

const PrivacyPolicy = () => {
  const [location, setLocation] = useLocation();
  const [document, setDocument] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    loadLegalDocument();
  }, []);
  const loadLegalDocument = async () => {
    try {
      const { data, error } = await supabase.from("legal_documents").select("*").eq("type", "privacy_policy").eq("is_active", true).maybeSingle();
      if (error && error.code !== "PGRST116") {
        console.error("Error loading privacy document:", error);
      }
      if (data) {
        setDocument(data);
      }
    } catch (error) {
      console.error("Error loading privacy document:", error);
    } finally {
      setLoading(false);
    }
  };
  const handleBack = () => {
    setLocation("/");
  };
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin w-8 h-8 border-2 border-[#00D1FF] border-t-transparent rounded-full mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Caricamento documento..." })
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex flex-col bg-black text-white p-4 pt-20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto max-w-4xl", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { variant: "outline", className: "mb-8", onClick: handleBack, children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "mr-2 w-4 h-4" }),
      " Torna alla Home"
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "relative overflow-hidden rounded-[24px] p-8",
        style: {
          background: "rgba(0, 0, 0, 0.05)",
          backdropFilter: "blur(40px)",
          WebkitBackdropFilter: "blur(40px)",
          border: "1px solid rgba(255, 255, 255, 0.1)",
          boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold mb-6", children: document?.title || "Privacy Policy" }),
          document ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-6 prose prose-invert max-w-none", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "div",
            {
              className: "text-gray-300",
              dangerouslySetInnerHTML: { __html: document.content_md.replace(/\n/g, "<br />") }
            }
          ) }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-12", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-400 text-lg mb-4", children: "🚫 Documento non disponibile" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-500 mb-6", children: "Il documento richiesto non è attualmente disponibile." }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleBack, className: "bg-[#00D1FF] hover:bg-[#00B8E6] text-black", children: "Torna alla Home" })
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-10 text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleBack, className: "bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink", children: "Torna alla Home" }) })
        ]
      }
    )
  ] }) });
};

const CookiePolicy = () => {
  const [location, setLocation] = useLocation();
  const [document, setDocument] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    loadCookiePolicy();
  }, []);
  const loadCookiePolicy = async () => {
    try {
      const { data, error } = await supabase.from("legal_documents").select("*").eq("type", "cookie_policy").eq("is_active", true).order("published_at", { ascending: false }).limit(1).single();
      if (error && error.code !== "PGRST116") {
        console.error("Error loading cookie policy:", error);
      }
      if (data) {
        setDocument(data);
      }
    } catch (error) {
      console.error("Error loading cookie policy:", error);
    } finally {
      setLoading(false);
    }
  };
  const formatMarkdownContent = (content) => {
    return content.replace(/^# (.*$)/gim, '<h1 class="text-2xl font-orbitron font-bold text-white mb-4">$1</h1>').replace(/^## (.*$)/gim, '<h2 class="text-xl font-semibold text-[#00D1FF] mb-3 mt-6">$2</h2>').replace(/^### (.*$)/gim, '<h3 class="text-lg font-semibold text-[#00D1FF] mb-3">$3</h3>').replace(/^\* (.*$)/gim, '<li class="text-white/80 mb-1">$1</li>').replace(/^\- (.*$)/gim, '<li class="text-white/80 mb-1">$1</li>').replace(/\n\n/g, '</p><p class="text-white/80 mb-4">').replace(/^(?!<[h|l|p])(.*$)/gim, '<p class="text-white/80 mb-4">$1</p>');
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-b from-[#131524]/70 to-black text-white", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "container mx-auto max-w-4xl px-4 py-6", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0, y: 20 },
      animate: { opacity: 1, y: 0 },
      className: "space-y-6",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center space-x-4 mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            variant: "outline",
            className: "border-white/20 text-white hover:bg-white/10",
            onClick: () => setLocation("/"),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "mr-2 w-4 h-4" }),
              "Torna alla Home"
            ]
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Card,
          {
            className: "relative overflow-hidden rounded-[24px]",
            style: {
              background: "rgba(0, 0, 0, 0.05)",
              backdropFilter: "blur(40px)",
              WebkitBackdropFilter: "blur(40px)",
              border: "1px solid rgba(255, 255, 255, 0.1)",
              boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "border-b border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center text-white font-orbitron", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-6 h-6 mr-3 text-[#00D1FF]" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl", children: "Cookie Policy M1SSION™" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm font-normal", children: "Informazioni sui cookie utilizzati nell'app" })
                ] })
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "pt-6", children: [
                loading ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-[#00D1FF] mx-auto mb-4" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "Caricamento..." })
                ] }) : document ? /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "div",
                  {
                    className: "prose prose-invert max-w-none",
                    dangerouslySetInnerHTML: {
                      __html: formatMarkdownContent(document.content_md)
                    }
                  }
                ) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-8", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-12 h-12 text-[#00D1FF] mx-auto mb-4" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl font-semibold text-white mb-2", children: "Cookie Policy" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 mb-6", children: "Questa pagina descrive l'utilizzo dei cookie nell'app M1SSION™." }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6 text-left max-w-2xl mx-auto", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-semibold text-[#00D1FF] mb-3 flex items-center", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "w-5 h-5 mr-2" }),
                        "Cosa sono i Cookie"
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 mb-4", children: "I cookie sono piccoli file di testo memorizzati sul tuo dispositivo quando utilizzi la nostra app. Ci aiutano a fornire una migliore esperienza utente e a capire come viene utilizzata l'applicazione." })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-[#00D1FF] mb-3", children: "Tipi di Cookie utilizzati" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-[#00D1FF]/10 p-4 rounded-lg border border-[#00D1FF]/20", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-white mb-2", children: "🔒 Cookie Essenziali" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Necessari per il funzionamento base dell'app. Include autenticazione, sicurezza e funzionalità core. Non possono essere disabilitati." })
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-blue-500/10 p-4 rounded-lg border border-blue-500/20", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-white mb-2", children: "📊 Cookie Analitici" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Ci aiutano a capire come utilizzi l'app per migliorare l'esperienza utente. Include analisi dell'utilizzo e performance." })
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-purple-500/10 p-4 rounded-lg border border-purple-500/20", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-white mb-2", children: "📢 Cookie di Marketing" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Utilizzati per personalizzare contenuti e comunicazioni basate sui tuoi interessi nell'app M1SSION™." })
                        ] }),
                        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-green-500/10 p-4 rounded-lg border border-green-500/20", children: [
                          /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "font-semibold text-white mb-2", children: "⚙️ Cookie di Preferenze" }),
                          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/70 text-sm", children: "Ricordano le tue impostazioni e preferenze per personalizzare l'esperienza nelle sessioni future." })
                        ] })
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("section", { children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "text-lg font-semibold text-[#00D1FF] mb-3 flex items-center", children: [
                        /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-5 h-5 mr-2" }),
                        "Gestione delle Preferenze"
                      ] }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 mb-4", children: "Puoi gestire le tue preferenze sui cookie in qualsiasi momento dalle impostazioni dell'app o dal banner dei cookie che appare al primo accesso." }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-col sm:flex-row gap-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                        Button,
                        {
                          className: "bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90",
                          onClick: () => setLocation("/settings"),
                          children: [
                            /* @__PURE__ */ jsxRuntimeExports.jsx(Settings, { className: "w-4 h-4 mr-2" }),
                            "Vai alle Impostazioni"
                          ]
                        }
                      ) })
                    ] })
                  ] })
                ] }),
                document && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-8 pt-6 border-t border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row justify-between items-start sm:items-center text-sm text-white/60 space-y-2 sm:space-y-0", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
                      "Versione: ",
                      document.version
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { children: [
                      "Ultimo aggiornamento: ",
                      new Date(document.published_at).toLocaleDateString("it-IT")
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-right", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-mono text-xs", children: "© 2025 Joseph MULÉ – M1SSION™ – ALL RIGHTS RESERVED – NIYVORA KFT™" }) })
                ] }) })
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-4 justify-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "outline",
                className: "border-white/20 text-white hover:bg-white/10",
                onClick: () => setLocation("/privacy-policy"),
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-4 h-4 mr-2" }),
                  "Privacy Policy"
                ]
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                variant: "outline",
                className: "border-white/20 text-white hover:bg-white/10",
                onClick: () => setLocation("/terms"),
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Info, { className: "w-4 h-4 mr-2" }),
                  "Termini di Servizio"
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              className: "bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90",
              onClick: () => setLocation("/"),
              children: "Torna alla Home"
            }
          )
        ] })
      ]
    }
  ) }) });
};

function SafeCreative() {
  const { goBack } = useWouterNavigation();
  const [document, setDocument] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    loadLegalDocument();
  }, []);
  const loadLegalDocument = async () => {
    try {
      const { data, error } = await supabase.from("legal_documents").select("*").eq("type", "safecreative").eq("is_active", true).single();
      if (error) {
        console.error("Error loading SafeCreative document:", error);
      }
      setDocument(data);
    } catch (err) {
      console.error("Failed to load SafeCreative document:", err);
    } finally {
      setLoading(false);
    }
  };
  const handleBack = () => {
    goBack();
  };
  const formatMarkdownContent = (content) => {
    return content.replace(/^### (.+)$/gm, '<h3 class="text-lg font-semibold text-[#00D1FF] mb-3 mt-6">$1</h3>').replace(/^## (.+)$/gm, '<h2 class="text-xl font-bold text-white mb-4 mt-8">$1</h2>').replace(/^# (.+)$/gm, '<h1 class="text-2xl font-bold text-white mb-6 mt-8">$1</h1>').replace(/^\* (.+)$/gm, '<li class="text-white/80 mb-1">$1</li>').replace(/^- (.+)$/gm, '<li class="text-white/80 mb-1">$1</li>').replace(/\n\n/g, '</p><p class="text-white/80 leading-relaxed mb-4">').replace(/^(.+)$/gm, '<p class="text-white/80 leading-relaxed mb-4">$1</p>').replace(/<li[^>]*>.*<\/li>/gs, (match) => `<ul class="list-disc list-inside space-y-1 ml-4 mb-4">${match}</ul>`).replace(/<\/ul><ul[^>]*>/g, "");
  };
  if (loading) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#0A0A0A] via-[#1A1A2E] to-[#16213E] flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-[#00D1FF] mx-auto mb-4" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "Caricamento documento SafeCreative..." })
    ] }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#0A0A0A] via-[#1A1A2E] to-[#16213E]", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "container mx-auto px-4 py-8", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-between mb-8", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "button",
      {
        onClick: handleBack,
        className: "flex items-center text-[#00D1FF] hover:text-white transition-colors",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5 mr-2" }),
          "Indietro"
        ]
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "max-w-4xl mx-auto", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "relative overflow-hidden rounded-[24px] p-8",
        style: {
          background: "rgba(0, 0, 0, 0.05)",
          backdropFilter: "blur(40px)",
          WebkitBackdropFilter: "blur(40px)",
          border: "1px solid rgba(255, 255, 255, 0.1)",
          boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
          document ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-3xl font-bold text-white mb-2 font-orbitron", children: document.title }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-white/60 mb-8 flex items-center gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                "Versione ",
                document.version
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "•" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
                "Pubblicato: ",
                new Date(document.published_at).toLocaleDateString("it-IT")
              ] })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "div",
              {
                className: "prose prose-invert max-w-none",
                dangerouslySetInnerHTML: {
                  __html: formatMarkdownContent(document.content_md)
                }
              }
            )
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-12", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold text-white mb-4", children: "Documento non trovato" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 mb-6", children: "Il documento SafeCreative non è attualmente disponibile." }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              "button",
              {
                onClick: handleBack,
                className: "inline-flex items-center px-6 py-3 bg-[#00D1FF]/20 text-[#00D1FF] \n                           rounded-lg hover:bg-[#00D1FF]/30 transition-colors",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-4 h-4 mr-2" }),
                  "Torna indietro"
                ]
              }
            )
          ] })
        ]
      }
    ) })
  ] }) });
}

const GameRules = () => {
  const { navigate } = useWouterNavigation();
  const [document, setDocument] = reactExports.useState(null);
  const [loading, setLoading] = reactExports.useState(true);
  reactExports.useEffect(() => {
    loadGameRules();
  }, []);
  const loadGameRules = async () => {
    try {
      const { data, error } = await supabase.from("legal_documents").select("*").eq("type", "game_rules").eq("is_active", true).single();
      if (error) {
        console.error("Error loading game rules:", error);
        return;
      }
      setDocument(data);
    } catch (error) {
      console.error("Error loading game rules:", error);
    } finally {
      setLoading(false);
    }
  };
  const formatMarkdownContent = (content) => {
    return content.replace(/\*\*(.*?)\*\*/g, '<strong class="text-white font-semibold">$1</strong>').replace(/^### (.*$)/gim, '<h3 class="text-lg font-semibold text-[#00D1FF] mt-4 mb-2">$1</h3>').replace(/^## (.*$)/gim, '<h2 class="text-xl font-bold text-[#00D1FF] mt-6 mb-3">$1</h2>').replace(/^# (.*$)/gim, '<h1 class="text-2xl font-bold text-white mb-4">$1</h1>').replace(/^- (.*$)/gim, '<li class="text-white/80 ml-4 mb-1">• $1</li>').replace(/^\d+\. (.*$)/gim, '<li class="text-white/80 ml-4 mb-1 list-decimal">$1</li>').replace(/\n/g, "<br>");
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-gradient-to-br from-[#0B1426] via-[#1a1d3a] to-[#0B1426] p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "max-w-4xl mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center mb-6", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        Button,
        {
          onClick: () => navigate("/settings/legal"),
          variant: "ghost",
          size: "sm",
          className: "mr-4 text-white/70 hover:text-white hover:bg-white/10",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-4 h-4 mr-2" }),
            "Indietro"
          ]
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-orbitron font-bold text-white", children: "Regolamento M1SSION™" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.5 },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Card,
          {
            className: "relative overflow-hidden rounded-[24px]",
            style: {
              background: "rgba(0, 0, 0, 0.05)",
              backdropFilter: "blur(40px)",
              WebkitBackdropFilter: "blur(40px)",
              border: "1px solid rgba(255, 255, 255, 0.1)",
              boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-white font-orbitron flex items-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-6 h-6 mr-3 text-[#00D1FF]" }),
                loading ? "Caricamento..." : document?.title || "Regolamento del Gioco"
              ] }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "space-y-6", children: loading ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center py-12", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-2 border-[#00D1FF] border-t-transparent" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "ml-3 text-white/70", children: "Caricamento documento..." })
              ] }) : document ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  "div",
                  {
                    className: "prose prose-invert max-w-none text-white/80 leading-relaxed",
                    dangerouslySetInnerHTML: {
                      __html: formatMarkdownContent(document.content_md)
                    }
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-8 pt-6 border-t border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-wrap gap-6 text-sm text-white/60", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-4 h-4 mr-2" }),
                    "Versione: ",
                    document.version
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Calendar, { className: "w-4 h-4 mr-2" }),
                    "Pubblicato: ",
                    new Date(document.published_at).toLocaleDateString("it-IT")
                  ] }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(Mail, { className: "w-4 h-4 mr-2" }),
                    "Contatti: legal@m1ssion.com"
                  ] })
                ] }) })
              ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center py-12", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-16 h-16 mx-auto mb-4 text-white/30" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xl font-semibold text-white mb-2", children: "Documento non disponibile" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60 mb-6", children: "Il regolamento del gioco non è attualmente disponibile." }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    onClick: loadGameRules,
                    variant: "outline",
                    className: "border-[#00D1FF]/50 text-[#00D1FF] hover:bg-[#00D1FF]/10",
                    children: "Riprova"
                  }
                )
              ] }) })
            ]
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-8 flex flex-col sm:flex-row gap-4 justify-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: () => navigate("/privacy-policy"),
          variant: "ghost",
          size: "sm",
          className: "text-[#00D1FF] hover:bg-[#00D1FF]/10",
          children: "Privacy Policy"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: () => navigate("/terms"),
          variant: "ghost",
          size: "sm",
          className: "text-[#00D1FF] hover:bg-[#00D1FF]/10",
          children: "Termini di Servizio"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: () => navigate("/cookie-policy"),
          variant: "ghost",
          size: "sm",
          className: "text-[#00D1FF] hover:bg-[#00D1FF]/10",
          children: "Cookie Policy"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: () => navigate("/"),
          variant: "outline",
          size: "sm",
          className: "border-[#00D1FF]/50 text-[#00D1FF] hover:bg-[#00D1FF]/10",
          children: "Torna alla Home"
        }
      )
    ] })
  ] }) });
};

const M1ssionText = () => {
  const { navigate } = useWouterNavigation();
  const [tapCount, setTapCount] = reactExports.useState(0);
  const [tapTimer, setTapTimer] = reactExports.useState(null);
  const handleClick = reactExports.useCallback(() => {
    setTapCount((prev) => prev + 1);
    if (tapTimer) {
      clearTimeout(tapTimer);
    }
    const timer = setTimeout(() => {
      if (tapCount + 1 >= 2) {
        localStorage.removeItem("developer_access");
        console.log("Developer access reset via double tap");
        window.location.reload();
      }
      setTapCount(0);
    }, 300);
    setTapTimer(timer);
    if (tapCount < 1) {
      navigate("/");
    }
  }, [navigate, tapCount, tapTimer]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "button",
    {
      onClick: handleClick,
      className: "flex items-center font-orbitron text-xl md:text-2xl font-bold transition-opacity hover:opacity-80",
      "aria-label": "Go to homepage",
      style: { cursor: "pointer" },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "span",
          {
            className: "text-[#00E5FF]",
            style: {
              textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"
            },
            children: "M1"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-white", children: [
          "SSION",
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs align-top", children: "™" })
        ] })
      ]
    }
  );
};

const FakeStripeCheckout = ({
  planName,
  planPrice,
  planFeatures
}) => {
  const [isProcessing, setIsProcessing] = reactExports.useState(false);
  const [isSuccess, setIsSuccess] = reactExports.useState(false);
  const [cardData, setCardData] = reactExports.useState({
    number: "",
    expiry: "",
    cvc: "",
    name: ""
  });
  const { toast } = useToast();
  const { navigate } = useWouterNavigation();
  const handlePayment = async () => {
    setIsProcessing(true);
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) throw new Error("User not authenticated");
      await new Promise((resolve) => setTimeout(resolve, 2e3));
      await supabase.from("subscriptions").upsert({
        user_id: user.id,
        tier: planName,
        status: "active",
        start_date: (/* @__PURE__ */ new Date()).toISOString(),
        end_date: new Date(Date.now() + 365 * 24 * 60 * 60 * 1e3).toISOString(),
        provider: "stripe",
        updated_at: (/* @__PURE__ */ new Date()).toISOString()
      });
      const { getPriceEur, getPriceCents } = await __vitePreload(async () => { const { getPriceEur, getPriceCents } = await Promise.resolve().then(() => pricingConfig);return { getPriceEur, getPriceCents }},true?void 0:void 0);
      await supabase.from("payment_transactions").insert({
        user_id: user.id,
        amount: getPriceCents(planName) || 0,
        // CRITICAL FIX: Use cents for Stripe compatibility
        currency: "EUR",
        description: `Upgrade to ${planName} plan`,
        status: "success",
        provider: "stripe"
      });
      const subscriptionData = {
        plan: planName,
        price: planPrice,
        activatedAt: (/* @__PURE__ */ new Date()).toISOString(),
        features: planFeatures
      };
      localStorage.setItem("active_subscription", JSON.stringify(subscriptionData));
      localStorage.setItem("subscription_plan", planName);
      window.dispatchEvent(new Event("storage"));
      setIsProcessing(false);
      setIsSuccess(true);
      toast({
        title: "✅ Upgrade completato con successo!",
        description: `Piano ${planName} attivato con successo.`
      });
      setTimeout(() => {
        navigate("/profile");
      }, 2e3);
    } catch (error) {
      console.error("Payment error:", error);
      setIsProcessing(false);
      toast({
        title: "❌ Errore durante l'upgrade. Riprova.",
        description: "Si è verificato un errore durante il processo di pagamento.",
        variant: "destructive"
      });
    }
  };
  if (isSuccess) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, scale: 0.8 },
        animate: { opacity: 1, scale: 1 },
        className: "text-center py-8",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-16 w-16 text-green-500 mx-auto mb-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-white mb-2", children: "Pagamento Completato!" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-white/60", children: [
            "Piano ",
            planName,
            " attivato correttamente"
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-white/40 mt-2", children: "Reindirizzamento in corso..." })
        ]
      }
    );
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-white/5 border-white/20", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2 text-white", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CreditCard, { className: "h-5 w-5" }),
        "Dettagli di Pagamento"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardDescription, { className: "text-white/60", children: [
        "Completa il pagamento per attivare il piano ",
        planName
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 bg-white/5 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("h3", { className: "font-semibold text-white mb-2", children: [
          "Piano Selezionato: ",
          planName
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-2xl font-bold text-primary mb-2", children: [
          planPrice,
          "/mese"
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("ul", { className: "space-y-1", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("li", { className: "flex items-center gap-2 text-sm text-white/80", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "h-3 w-3 text-green-500" }),
          feature
        ] }, index)) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cardNumber", className: "text-white", children: "Numero Carta" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "cardNumber",
              placeholder: "1234 5678 9012 3456",
              value: cardData.number,
              onChange: (e) => setCardData((prev) => ({ ...prev, number: e.target.value })),
              className: "bg-white/5 border-white/20 text-white"
            }
          )
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-2 gap-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "expiry", className: "text-white", children: "Scadenza" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "expiry",
                placeholder: "MM/AA",
                value: cardData.expiry,
                onChange: (e) => setCardData((prev) => ({ ...prev, expiry: e.target.value })),
                className: "bg-white/5 border-white/20 text-white"
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cvc", className: "text-white", children: "CVC" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Input,
              {
                id: "cvc",
                placeholder: "123",
                value: cardData.cvc,
                onChange: (e) => setCardData((prev) => ({ ...prev, cvc: e.target.value })),
                className: "bg-white/5 border-white/20 text-white"
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "cardName", className: "text-white", children: "Nome sul Titolare" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Input,
            {
              id: "cardName",
              placeholder: "Mario Rossi",
              value: cardData.name,
              onChange: (e) => setCardData((prev) => ({ ...prev, name: e.target.value })),
              className: "bg-white/5 border-white/20 text-white"
            }
          )
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/20 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Lock, { className: "h-4 w-4 text-green-500" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-green-400", children: "Pagamento sicuro protetto da crittografia SSL" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: handlePayment,
          disabled: isProcessing || !cardData.number || !cardData.expiry || !cardData.cvc || !cardData.name,
          className: "w-full bg-primary hover:bg-primary/90 h-12",
          children: isProcessing ? /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              animate: { rotate: 360 },
              transition: { duration: 1, repeat: Infinity, ease: "linear" },
              className: "h-4 w-4 border-2 border-white border-t-transparent rounded-full"
            }
          ) : `Procedi con il pagamento - ${planPrice}/mese`
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/40 text-center", children: "Questo è un pagamento simulato per scopi dimostrativi" })
    ] })
  ] });
};

const SilverPlanPage = () => {
  const navigate = useNavigate();
  const planFeatures = [
    "Tutti i vantaggi Base",
    "3 indizi premium aggiuntivi a settimana",
    "Accesso anticipato di 2 ore agli eventi",
    "Badge Silver nel profilo"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionText, {}) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.main,
          {
            className: "text-white",
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            transition: { duration: 0.5 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card mx-2 sm:mx-4 mt-4 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "sm",
                    onClick: () => navigate("/subscriptions"),
                    className: "p-2 hover:bg-white/10",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-xl font-semibold", children: "Piano Silver" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center gap-2 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "h-8 w-8 text-silver" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-3xl font-bold text-white", children: "M1SSION™ Silver" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-4xl font-bold text-primary mb-2", children: getDisplayPrice("Silver") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "al mese" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white mb-4", children: "Cosa include:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 bg-white/5 rounded-lg", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "h-4 w-4 text-silver" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: feature })
                ] }, index)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                FakeStripeCheckout,
                {
                  planName: "Silver",
                  planPrice: getDisplayPrice("Silver"),
                  planFeatures
                }
              )
            ] }) })
          }
        )
      ]
    }
  );
};

const GoldPlanPage = () => {
  const navigate = useNavigate();
  const planFeatures = [
    "Tutti i vantaggi Silver",
    "4 indizi premium aggiuntivi a settimana",
    "Accesso anticipato di 12 ore agli eventi",
    "Partecipazione alle estrazioni Gold",
    "Badge Gold esclusivo nel profilo"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionText, {}) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.main,
          {
            className: "text-white",
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            transition: { duration: 0.5 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card mx-2 sm:mx-4 mt-4 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "sm",
                    onClick: () => navigate("/subscriptions"),
                    className: "p-2 hover:bg-white/10",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-xl font-semibold", children: "Piano Gold" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-yellow-500/20 text-yellow-400 border-yellow-500/30", children: "Più Popolare" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center gap-2 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "h-8 w-8 text-yellow-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-3xl font-bold text-white", children: "M1SSION™ Gold" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-4xl font-bold text-primary mb-2", children: getDisplayPrice("Gold") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "al mese" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 inline-flex items-center gap-2 px-4 py-2 bg-yellow-500/20 border border-yellow-500/30 rounded-full", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "h-4 w-4 text-yellow-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-yellow-400 font-medium", children: "Piano consigliato" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white mb-4", children: "Cosa include:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 bg-white/5 rounded-lg border border-yellow-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "h-4 w-4 text-yellow-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: feature })
                ] }, index)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                FakeStripeCheckout,
                {
                  planName: "Gold",
                  planPrice: getDisplayPrice("Gold"),
                  planFeatures
                }
              )
            ] }) })
          }
        )
      ]
    }
  );
};

const BlackPlanPage = () => {
  const navigate = useNavigate();
  const planFeatures = [
    "Tutti i vantaggi Gold",
    "Accesso VIP anticipato di 24 ore agli eventi",
    "5 indizi premium aggiuntivi a settimana",
    "Badge Black esclusivo"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionText, {}) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.main,
          {
            className: "text-white",
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            transition: { duration: 0.5 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card mx-2 sm:mx-4 mt-4 mb-4 border-2 border-purple-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "sm",
                    onClick: () => navigate("/subscriptions"),
                    className: "p-2 hover:bg-white/10",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-xl font-semibold", children: "Piano Black" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-purple-500/20 text-purple-400 border-purple-500/30", children: "Premium" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center gap-2 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "h-8 w-8 text-purple-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-3xl font-bold text-white", children: "M1SSION™ Black" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-4xl font-bold text-primary mb-2", children: getDisplayPrice("Black") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "al mese" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 inline-flex items-center gap-2 px-4 py-2 bg-purple-500/20 border border-purple-500/30 rounded-full", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "h-4 w-4 text-purple-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-purple-400 font-medium", children: "Esperienza VIP Completa" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white mb-4", children: "Cosa include:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 bg-purple-500/10 rounded-lg border border-purple-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "h-4 w-4 text-purple-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: feature })
                ] }, index)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-6 p-4 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-center text-white font-medium", children: "🎯 Accesso esclusivo alle missioni più segrete di M1SSION™" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                FakeStripeCheckout,
                {
                  planName: "Black",
                  planPrice: getDisplayPrice("Black"),
                  planFeatures
                }
              )
            ] }) })
          }
        )
      ]
    }
  );
};

const TitaniumPlanPage = () => {
  const navigate = useNavigate();
  const planFeatures = [
    "Tutti i vantaggi Black",
    "7 indizi premium aggiuntivi a settimana",
    "Accesso VIP anticipato di 48 ore agli eventi",
    "Supporto prioritario dedicato (24/7)",
    "Eventi esclusivi M1SSION™",
    "Badge Titanium esclusivo"
  ];
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "bg-gradient-to-b from-[#131524]/70 to-black w-full",
      style: {
        height: "100dvh",
        overflow: "hidden",
        position: "relative"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "header",
          {
            className: "fixed top-0 left-0 right-0 z-50 backdrop-blur-xl",
            style: {
              height: "72px",
              paddingTop: "env(safe-area-inset-top, 47px)",
              background: "rgba(19, 21, 33, 0.55)",
              backdropFilter: "blur(12px)"
            },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(UnifiedHeader, { leftComponent: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionText, {}) })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.main,
          {
            className: "text-white",
            style: {
              paddingTop: "calc(72px + env(safe-area-inset-top, 47px))",
              paddingBottom: "calc(80px + env(safe-area-inset-bottom, 34px))",
              height: "100dvh",
              overflowY: "auto",
              position: "relative",
              zIndex: 0
            },
            initial: { opacity: 0, y: 20 },
            animate: { opacity: 1, y: 0 },
            transition: { duration: 0.5 },
            children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card mx-2 sm:mx-4 mt-4 mb-4 border-2 border-cyan-500/30", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-3 sm:p-6", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 mb-6", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  Button,
                  {
                    variant: "ghost",
                    size: "sm",
                    onClick: () => navigate("/subscriptions"),
                    className: "p-2 hover:bg-white/10",
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "h-5 w-5" })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-xl font-semibold", children: "Piano Titanium" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: "bg-cyan-500/20 text-cyan-400 border-cyan-500/30", children: "Ultimate" })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "inline-flex items-center gap-2 mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Infinity$1, { className: "h-8 w-8 text-cyan-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-3xl font-bold text-white", children: "M1SSION™ Titanium" })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-4xl font-bold text-primary mb-2", children: getDisplayPrice("Titanium") }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/60", children: "al mese" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 inline-flex items-center gap-2 px-4 py-2 bg-cyan-500/20 border border-cyan-500/30 rounded-full", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "h-4 w-4 text-cyan-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-400 font-medium", children: "Esperienza Ultimate Completa" })
                ] })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-8", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-semibold text-white mb-4", children: "Cosa include:" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: planFeatures.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 p-3 bg-cyan-500/10 rounded-lg border border-cyan-500/20", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Infinity$1, { className: "h-4 w-4 text-cyan-400" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", children: feature })
                ] }, index)) })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mb-6 p-4 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 border border-cyan-500/30 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-center text-white font-medium", children: "⚡ Accesso supremo alle funzionalità più avanzate di M1SSION™" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                FakeStripeCheckout,
                {
                  planName: "Titanium",
                  planPrice: getDisplayPrice("Titanium"),
                  planFeatures
                }
              )
            ] }) })
          }
        )
      ]
    }
  );
};

const useStripeInAppPayment = () => {
  const [loading, setLoading] = reactExports.useState(false);
  const [showCheckout, setShowCheckout] = reactExports.useState(false);
  const [paymentConfig, setPaymentConfig] = reactExports.useState(null);
  const [defaultPaymentMethod, setDefaultPaymentMethod] = reactExports.useState(null);
  const { user } = useAuthContext();
  reactExports.useEffect(() => {
    const loadDefaultPaymentMethod = async () => {
      if (!user) return;
      try {
        console.log("🔍 M1SSION™ Loading default payment method for auto-fill");
        const { data, error } = await supabase.from("user_payment_methods").select("*").eq("user_id", user.id).eq("is_default", true).order("created_at", { ascending: false }).limit(1).maybeSingle();
        if (error) {
          console.error("❌ M1SSION™ Error loading default payment method:", error);
          return;
        }
        if (data) {
          setDefaultPaymentMethod(data);
          console.log("✅ M1SSION™ Default payment method loaded for auto-fill:", {
            brand: data.brand,
            last4: data.last4
          });
        }
      } catch (error) {
        console.error("❌ M1SSION™ Error in loadDefaultPaymentMethod:", error);
      }
    };
    loadDefaultPaymentMethod();
  }, [user]);
  const initiatePayment = async (config) => {
    if (!user) {
      console.warn("🚨 M1SSION™ STRIPE BLOCK: No authenticated user");
      ue$1.error("Devi essere loggato per effettuare pagamenti");
      return;
    }
    console.log("🔥 M1SSION™ STRIPE IN-APP: Initiating payment", {
      type: config.type,
      amount: config.amount,
      user_id: user.id,
      defaultPaymentMethod: defaultPaymentMethod ? `${defaultPaymentMethod.brand} ****${defaultPaymentMethod.last4}` : "none",
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    });
    const configWithDefaults = {
      ...config,
      metadata: {
        ...config.metadata,
        default_payment_method: defaultPaymentMethod?.stripe_pm_id,
        auto_fill_enabled: !!defaultPaymentMethod
      }
    };
    setPaymentConfig(configWithDefaults);
    setShowCheckout(true);
  };
  const processSubscription = async (plan) => {
    const { getPriceCents, getPriceEur } = await __vitePreload(async () => { const { getPriceCents, getPriceEur } = await Promise.resolve().then(() => pricingConfig);return { getPriceCents, getPriceEur }},true?void 0:void 0);
    const cents = getPriceCents(plan);
    const eur = getPriceEur(plan);
    if (!cents || !eur) {
      ue$1.error("Piano di abbonamento non valido");
      return;
    }
    const config = {
      type: "subscription",
      amount: cents,
      // SYNCHRONIZED: Use centralized pricing
      description: `Piano ${plan} con vantaggi premium`,
      plan,
      metadata: {
        subscription_plan: plan,
        price_cents: cents,
        price_eur: eur,
        mission: "M1SSION",
        reset_date: "2025-07-22"
      }
    };
    await initiatePayment(config);
  };
  const closeCheckout = () => {
    if (!loading) {
      setShowCheckout(false);
      setPaymentConfig(null);
    }
  };
  const handlePaymentSuccess = async (paymentIntentId) => {
    console.log("✅ M1SSION™ STRIPE SUCCESS: Payment completed", {
      paymentIntentId,
      type: paymentConfig?.type
    });
    try {
      if (paymentConfig?.type === "subscription") {
        await supabase.functions.invoke("handle-payment-success", {
          body: {
            payment_intent_id: paymentIntentId,
            user_id: user?.id,
            plan: paymentConfig.plan
          }
        });
        ue$1.success(`🎉 Abbonamento ${paymentConfig.plan} attivato!`);
        return { ok: true };
      }
      setShowCheckout(false);
      setPaymentConfig(null);
      return { ok: true };
    } catch (error) {
      console.error("❌ M1SSION™ STRIPE: Error handling payment success", error);
      ue$1.error("Errore nella finalizzazione del pagamento");
      return { ok: false };
    }
  };
  return {
    // Universal payment methods
    processSubscription,
    // UI state
    showCheckout,
    paymentConfig,
    loading,
    setLoading,
    defaultPaymentMethod,
    // © 2025 Joseph MULÉ – M1SSION™ – Auto-fill support
    // Handlers
    closeCheckout,
    handlePaymentSuccess
  };
};

const plans = [
  {
    id: "free",
    name: "Free (Base)",
    price: "0",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-8 h-8" }),
    earlyAccess: "Accesso quando disponibile",
    features: [
      "1 indizio a settimana",
      "Accesso alle missioni quando attive",
      "Badge Base nel profilo",
      "Partecipazione al gioco"
    ],
    color: "from-gray-500 to-gray-700",
    free: true
  },
  {
    id: "Silver",
    name: "Silver",
    price: "3.99",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-8 h-8" }),
    earlyAccess: "2 ore prima",
    features: [
      "Tutti i vantaggi Base",
      "3 indizi premium aggiuntivi a settimana",
      "Accesso anticipato di 2 ore agli eventi",
      "Badge Silver nel profilo"
    ],
    color: "from-slate-400 to-slate-600"
  },
  {
    id: "Gold",
    name: "Gold",
    price: "6.99",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Crown, { className: "w-8 h-8" }),
    earlyAccess: "12 ore prima",
    features: [
      "Tutti i vantaggi Silver",
      "4 indizi premium aggiuntivi a settimana",
      "Accesso anticipato di 12 ore agli eventi",
      "Partecipazione alle estrazioni Gold",
      "Badge Gold esclusivo nel profilo"
    ],
    popular: true,
    color: "from-yellow-400 to-yellow-600"
  },
  {
    id: "Black",
    name: "Black",
    price: "9.99",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Zap, { className: "w-8 h-8" }),
    earlyAccess: "24 ore prima",
    features: [
      "Tutti i vantaggi Gold",
      "Accesso VIP anticipato di 24 ore agli eventi",
      "5 indizi premium aggiuntivi a settimana",
      "Badge Black esclusivo"
    ],
    color: "from-gray-800 to-black"
  },
  {
    id: "Titanium",
    name: "Titanium",
    price: "29.99",
    icon: /* @__PURE__ */ jsxRuntimeExports.jsx(Star, { className: "w-8 h-8" }),
    earlyAccess: "48 ore prima",
    features: [
      "Tutti i vantaggi Black",
      "5 indizi premium aggiuntivi a settimana",
      "Accesso VIP anticipato di 48 ore agli eventi",
      "Supporto prioritario dedicato (24/7)",
      "Eventi esclusivi M1SSION™",
      "Badge Titanium esclusivo"
    ],
    premium: true,
    color: "from-purple-400 to-purple-600"
  }
];
const ChoosePlanPage = () => {
  const [, setLocation] = useLocation();
  const [selectedPlan, setSelectedPlan] = reactExports.useState("");
  const [isProcessing, setIsProcessing] = reactExports.useState(false);
  const [isLoadingFree, setIsLoadingFree] = reactExports.useState(false);
  const { getCurrentUser } = useUnifiedAuth();
  reactExports.useEffect(() => {
    const markSeen = async () => {
      try {
        await supabase.rpc("mark_choose_plan_seen");
      } catch (error) {
        console.warn("Error marking plan as seen:", error);
      }
    };
    markSeen();
  }, []);
  const {
    processSubscription,
    showCheckout,
    paymentConfig,
    closeCheckout,
    handlePaymentSuccess
  } = useStripeInAppPayment();
  const startFreePlan = async () => {
    if (isLoadingFree) return;
    setIsLoadingFree(true);
    try {
      const { data, error } = await supabase.rpc("create_free_subscription");
      console.warn("[FREE][rpc] create_free_subscription ->", { data, error });
      if (error && !/23505|unique|duplicate|already/i.test(error.message)) {
        ue$1.error("Errore temporaneo, riprova");
        setIsLoadingFree(false);
        return;
      }
      try {
        await supabase.rpc("mark_choose_plan_seen");
      } catch (markError) {
        console.warn("[FREE] mark_choose_plan_seen error (ignoring):", markError);
      }
      setLocation("/home");
    } catch (e) {
      console.warn("[FREE] unexpected", e);
      ue$1.error("Errore temporaneo, riprova");
      setIsLoadingFree(false);
    }
  };
  const handlePlanSelection = async (planId) => {
    if (isProcessing) return;
    if (planId === "free") {
      return startFreePlan();
    }
    setIsProcessing(true);
    setSelectedPlan(planId);
    try {
      console.log("🛒 M1SSION™ Aprendo checkout in-app per piano:", planId);
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        await supabase.from("profiles").update({ subscription_plan: planId }).eq("id", user.id);
      }
      await processSubscription(planId);
      console.log("✅ M1SSION™ Checkout modal aperto per piano:", planId);
      ue$1.success("Checkout aperto - completa il pagamento");
    } catch (error) {
      console.error("❌ Errore durante selezione piano:", error);
      ue$1.error("Errore durante la selezione del piano");
      setIsProcessing(false);
      setSelectedPlan("");
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-black text-white p-4", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        className: "max-w-6xl mx-auto",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center mb-12", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("h1", { className: "plans-title", children: [
              "Scegli il tuo Piano ",
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "brand-m1", children: "M1" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "brand-ss", children: "SSION™" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xl text-gray-300", children: "Seleziona il piano di abbonamento per accedere alla missione" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "plans-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 max-w-6xl mx-auto", children: plans.map((plan) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              initial: { opacity: 0, scale: 0.9 },
              animate: { opacity: 1, scale: 1 },
              transition: { delay: plans.indexOf(plan) * 0.1 },
              className: "relative",
              children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: `plan-card ${plan.popular ? "gold" : ""} ${plan.premium ? "titanium" : ""} ${plan.free ? "free" : ""} bg-gray-900 border-gray-700 h-full ${plan.popular ? "border-yellow-500 border-2" : plan.premium ? "border-purple-500 border-2" : ""}`, children: [
                plan.popular && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "ribbon", children: "Più Popolare" }),
                plan.premium && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "ribbon", children: "Premium" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "text-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r ${plan.color} flex items-center justify-center text-white`, children: plan.icon }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { className: "text-2xl text-white", children: plan.name }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { className: "text-gray-400", children: plan.earlyAccess }),
                  /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-3xl font-bold text-white", children: [
                    "€",
                    plan.price,
                    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-gray-400", children: "/mese" })
                  ] })
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
                  plan.features.map((feature, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-gray-300", children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-2 h-2 bg-green-500 rounded-full mr-3" }),
                    feature
                  ] }, index)),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => handlePlanSelection(plan.id),
                      disabled: isProcessing || plan.id === "free" && isLoadingFree,
                      "data-testid": plan.id === "free" ? "cta-free" : void 0,
                      className: `w-full mt-6 free-cta ${selectedPlan === plan.id || plan.id === "free" && isLoadingFree ? "opacity-50" : ""} ${plan.free ? "bg-gray-600 hover:bg-gray-700 text-white" : plan.popular ? "bg-yellow-500 hover:bg-yellow-600 text-black" : plan.premium ? "bg-purple-500 hover:bg-purple-600" : "bg-white text-black hover:bg-gray-200"}`,
                      children: plan.id === "free" && isLoadingFree ? "Attivazione…" : selectedPlan === plan.id ? "Elaborazione..." : plan.free ? "Inizia Gratis" : "Seleziona Piano"
                    }
                  )
                ] })
              ] })
            },
            plan.id
          )) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center text-gray-400", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mb-4", children: "Tutti i piani includono accesso completo al gioco e indizi in base al piano di abbonamento scelto" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm", children: "Puoi cancellare o modificare il tuo piano in qualsiasi momento" })
          ] })
        ]
      }
    ),
    showCheckout && paymentConfig && /* @__PURE__ */ jsxRuntimeExports.jsx(
      StripeInAppCheckout,
      {
        config: paymentConfig,
        onSuccess: (paymentIntentId) => {
          handlePaymentSuccess(paymentIntentId);
          setIsProcessing(false);
          setSelectedPlan("");
          setTimeout(() => {
            setLocation("/subscription-verify");
          }, 500);
        },
        onCancel: () => {
          closeCheckout();
          setIsProcessing(false);
          setSelectedPlan("");
        }
      }
    )
  ] });
};

const SubscriptionVerify = () => {
  const [, setLocation] = useLocation();
  const [verificationState, setVerificationState] = reactExports.useState("verifying");
  const [attemptCount, setAttemptCount] = reactExports.useState(0);
  const [errorMessage, setErrorMessage] = reactExports.useState("");
  const verifySubscription = async () => {
    try {
      console.log("🔍 M1SSION™ VERIFY: Starting subscription verification attempt", attemptCount + 1);
      const { data: userData, error: userError } = await supabase.auth.getUser();
      if (userError || !userData.user) {
        throw new Error("Utente non autenticato");
      }
      console.log("✅ M1SSION™ VERIFY: User authenticated", userData.user.id);
      const { data: profileData, error: profileError } = await supabase.from("profiles").select("subscription_plan, subscription_tier, tier").eq("id", userData.user.id).single();
      if (profileError) {
        console.error("❌ M1SSION™ VERIFY: Profile fetch error", profileError);
        throw new Error("Errore nel caricamento del profilo");
      }
      console.log("📋 M1SSION™ VERIFY: Profile data received", profileData);
      const validPlans = ["SILVER", "GOLD", "BLACK", "TITANIUM"];
      const userPlan = profileData.subscription_plan || profileData.subscription_tier || profileData.tier;
      if (validPlans.includes(userPlan)) {
        console.log("🎉 M1SSION™ VERIFY: Valid subscription plan found", userPlan);
        setVerificationState("success");
        setTimeout(() => {
          setLocation("/panel-access");
        }, 1500);
        return;
      }
      const newAttemptCount = attemptCount + 1;
      setAttemptCount(newAttemptCount);
      if (newAttemptCount >= 5) {
        console.warn("⚠️ M1SSION™ VERIFY: Max attempts reached, showing error");
        setVerificationState("error");
        setErrorMessage("Errore di sincronizzazione. Il tuo abbonamento potrebbe richiedere alcuni minuti per essere attivato.");
      } else {
        console.log(`🔄 M1SSION™ VERIFY: Plan not found, retrying in 2 seconds (attempt ${newAttemptCount}/5)`);
        setTimeout(() => {
          verifySubscription();
        }, 2e3);
      }
    } catch (error) {
      console.error("❌ M1SSION™ VERIFY: Verification failed", error);
      setVerificationState("error");
      setErrorMessage(error instanceof Error ? error.message : "Errore di connessione");
    }
  };
  const handleRetry = () => {
    setVerificationState("verifying");
    setAttemptCount(0);
    setErrorMessage("");
    verifySubscription();
  };
  reactExports.useEffect(() => {
    const timer = setTimeout(() => {
      verifySubscription();
    }, 2e3);
    return () => clearTimeout(timer);
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen bg-black text-white flex flex-col items-center justify-center p-4 relative overflow-hidden", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute inset-0 opacity-20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-1/4 left-1/4 w-64 h-64 bg-purple-500 rounded-full filter blur-3xl animate-pulse" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute bottom-1/4 right-1/4 w-48 h-48 bg-blue-500 rounded-full filter blur-3xl animate-pulse delay-1000" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0, scale: 0.9 },
        animate: { opacity: 1, scale: 1 },
        transition: { duration: 0.5 },
        className: "relative z-10 text-center max-w-md mx-auto",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.h1,
            {
              className: "text-4xl md:text-6xl font-bold mb-8 bg-gradient-to-r from-yellow-400 to-red-500 bg-clip-text text-transparent",
              initial: { y: -20 },
              animate: { y: 0 },
              transition: { delay: 0.2 },
              children: "M1SSION™"
            }
          ),
          verificationState === "verifying" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              className: "space-y-6",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "relative", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "w-16 h-16 mx-auto mb-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 border-4 border-purple-500/30 rounded-full" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    motion.div,
                    {
                      className: "absolute inset-0 border-4 border-transparent border-t-purple-500 rounded-full",
                      animate: { rotate: 360 },
                      transition: { duration: 1, repeat: Infinity, ease: "linear" }
                    }
                  )
                ] }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.h2,
                  {
                    className: "text-2xl font-bold text-white mb-4",
                    animate: { opacity: [1, 0.5, 1] },
                    transition: { duration: 1.5, repeat: Infinity },
                    children: "Verifica in corso..."
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 text-lg", children: "Sincronizzazione abbonamento con sistema M1SSION™" }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-sm text-gray-400", children: [
                  "Tentativo ",
                  attemptCount + 1,
                  " di 5"
                ] })
              ]
            }
          ),
          verificationState === "success" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0, scale: 0.8 },
              animate: { opacity: 1, scale: 1 },
              className: "space-y-6",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx(
                  motion.div,
                  {
                    className: "w-16 h-16 mx-auto mb-4 bg-green-500 rounded-full flex items-center justify-center",
                    initial: { scale: 0 },
                    animate: { scale: 1 },
                    transition: { type: "spring", duration: 0.6 },
                    children: /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { className: "w-8 h-8 text-white", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: /* @__PURE__ */ jsxRuntimeExports.jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 3, d: "M5 13l4 4L19 7" }) })
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-green-400 mb-4", children: "🎉 Abbonamento Verificato!" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300", children: "Accesso premium attivato. Reindirizzamento in corso..." })
              ]
            }
          ),
          verificationState === "error" && /* @__PURE__ */ jsxRuntimeExports.jsxs(
            motion.div,
            {
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              className: "space-y-6",
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-16 h-16 mx-auto mb-4 bg-red-500 rounded-full flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { className: "w-8 h-8 text-white", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: /* @__PURE__ */ jsxRuntimeExports.jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.232 15c-.77.833.192 2.5 1.732 2.5z" }) }) }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-bold text-red-400 mb-4", children: "⚠️ Errore di Sincronizzazione" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-gray-300 mb-6", children: errorMessage || "Errore nella verifica dell'abbonamento. Riprova tra qualche istante." }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: handleRetry,
                      className: "w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300",
                      children: "🔄 Riprova Verifica"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: () => setLocation("/choose-plan"),
                      variant: "outline",
                      className: "w-full border-gray-600 text-gray-300 hover:bg-gray-800",
                      children: "Torna alla Selezione Piano"
                    }
                  )
                ] })
              ]
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            motion.div,
            {
              className: "mt-12 text-gray-500 text-xs",
              initial: { opacity: 0 },
              animate: { opacity: 1 },
              transition: { delay: 1 },
              children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "© 2025 Joseph MULÉ – M1SSION™ – ALL RIGHTS RESERVED – NIYVORA KFT™" })
            }
          )
        ]
      }
    )
  ] });
};

const PostLoginMissionIntro = () => {
  const [currentIndex, setCurrentIndex] = reactExports.useState(0);
  const [displayText, setDisplayText] = reactExports.useState("");
  const [showSlogan, setShowSlogan] = reactExports.useState(false);
  const [showStartDate, setShowStartDate] = reactExports.useState(false);
  const { navigate } = useWouterNavigation();
  const { getCurrentUser } = useUnifiedAuth();
  reactExports.useEffect(() => {
    const user = getCurrentUser();
    if (user?.email === "wikus77@hotmail.it") {
      console.log("🚀 ADMIN DETECTED in PostLoginMissionIntro - Skip intro, go to /home");
      navigate("/home");
      return;
    }
  }, [getCurrentUser, navigate]);
  const animationSteps = ["M", "M1", "M1S", "M1SS", "M1SSI", "M1SSIO", "M1SSION", "M1SSION™"];
  reactExports.useEffect(() => {
    let interval;
    let startTimer;
    const startAnimation = () => {
      let stepIndex = 0;
      interval = setInterval(() => {
        if (stepIndex < animationSteps.length) {
          setDisplayText(animationSteps[stepIndex]);
          stepIndex++;
          if (stepIndex === animationSteps.length) {
            clearInterval(interval);
            setTimeout(() => {
              setShowSlogan(true);
              setTimeout(() => {
                setShowStartDate(true);
                setTimeout(() => {
                  sessionStorage.setItem("hasSeenPostLoginIntro", "true");
                  navigate("/home");
                }, 1500);
              }, 1e3);
            }, 500);
          }
        } else {
          clearInterval(interval);
        }
      }, 175);
    };
    startTimer = setTimeout(startAnimation, 300);
    return () => {
      clearTimeout(startTimer);
      if (interval) clearInterval(interval);
    };
  }, [navigate]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-black flex items-center justify-center overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative w-full h-full flex items-center justify-center", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      motion.div,
      {
        initial: { opacity: 0 },
        animate: { opacity: 1 },
        className: "text-7xl md:text-8xl lg:text-9xl font-orbitron tracking-wider",
        style: {
          fontWeight: "normal",
          fontFamily: "Orbitron, monospace",
          position: "absolute",
          top: "35%",
          left: "50%",
          transform: "translate(-50%, -50%)",
          whiteSpace: "nowrap",
          zIndex: 50,
          textAlign: "center"
        },
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-[#00D1FF]", style: {
            textShadow: "0 0 10px rgba(0, 209, 255, 0.6), 0 0 20px rgba(0, 209, 255, 0.3)"
          }, children: displayText.slice(0, 2) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-white", style: {
            textShadow: "0 0 5px rgba(255, 255, 255, 0.3)"
          }, children: displayText.slice(2) })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showSlogan && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, y: 30 },
        animate: { opacity: 1, y: 0 },
        exit: { opacity: 0, y: -30 },
        transition: { duration: 0.8, ease: "easeOut" },
        className: "text-xl md:text-2xl lg:text-3xl font-orbitron tracking-widest",
        style: {
          fontWeight: "normal",
          color: "#BFA342",
          position: "absolute",
          top: "52%",
          left: "50%",
          transform: "translate(-50%, -50%)",
          whiteSpace: "nowrap",
          zIndex: 40,
          textShadow: "0 0 8px rgba(191, 163, 66, 0.4)",
          textAlign: "center"
        },
        children: "IT IS POSSIBLE"
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: showStartDate && /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, y: 30 },
        animate: { opacity: 1, y: 0 },
        transition: { duration: 0.6, ease: "easeOut" },
        className: "text-base md:text-lg lg:text-xl font-orbitron tracking-wider",
        style: {
          fontWeight: "normal",
          color: "#FFD700",
          position: "absolute",
          top: "65%",
          left: "50%",
          transform: "translate(-50%, -50%)",
          whiteSpace: "nowrap",
          zIndex: 30,
          textShadow: "0 0 6px rgba(255, 215, 0, 0.4)",
          textAlign: "center"
        },
        children: "Inizio: 19-06-25"
      }
    ) })
  ] }) });
};

function MissionIntroPage() {
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 w-full h-full bg-black overflow-hidden z-50", children: /* @__PURE__ */ jsxRuntimeExports.jsx(PostLoginMissionIntro, {}) });
}

function FcmTest() {
  const [log, setLog] = reactExports.useState([]);
  const { status, error, token, generate, isSupported, permission } = useFcm("web-test");
  const push = (l) => setLog((x) => [...x, l]);
  reactExports.useEffect(() => {
    if (status === "loading") {
      push("🔄 Inizializzazione FCM...");
      push("• Carico Firebase v8 compat SDK...");
      push("• Registro Service Worker /firebase-messaging-sw.js...");
      push("• Richiedo permessi notifiche...");
      push("• Genero token con VAPID (22/08)...");
    } else if (status === "success" && token) {
      push("✅ FCM configurato con successo!");
      push(`🔑 Token: ${token.substring(0, 20)}...`);
      push("💾 Token salvato su Supabase");
      push("🎯 M1SSION™ FCM Ready!");
    } else if (status === "error" && error) {
      push(`❌ Errore FCM: ${error}`);
    }
  }, [status, error, token]);
  reactExports.useEffect(() => {
    push("🔧 M1SSION™ FCM Test - Build 22/08/2025");
    push(`📱 Browser Support: ${isSupported ? "✅" : "❌"}`);
    push(`🔔 Permissions: ${permission || "non richiesti"}`);
    if (token) {
      push(`🔑 Token cached: ${token.substring(0, 20)}...`);
    }
  }, [isSupported, permission, token]);
  const onClick = async () => {
    setLog([]);
    await generate();
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("main", { style: { padding: 24 }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { children: "🔔 M1SSION™ — Test Push (isolato)" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { children: "Questa pagina serve SOLO per attivare le push senza toccare la tua UI." }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("button", { onClick, children: "Attiva e salva token" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { style: { marginTop: 16, background: "#111", color: "#0f0", padding: 16, borderRadius: 8 }, children: log.join("\n") })
  ] });
}

function PushTest() {
  const { user } = useAuth();
  const [title, setTitle] = reactExports.useState("⚡️ M1SSION – Test Push");
  const [body, setBody] = reactExports.useState("Test notifica push da pannello dev.");
  const [deeplink, setDeeplink] = reactExports.useState("/profile");
  const [bypassQuietHours, setBypassQuietHours] = reactExports.useState(true);
  const [adminToken, setAdminToken] = reactExports.useState("");
  const [loading, setLoading] = reactExports.useState(false);
  const [result, setResult] = reactExports.useState(null);
  reactExports.useEffect(() => {
    if (user && user.email !== "wikus77@hotmail.it") {
      window.location.href = "/";
    }
  }, [user]);
  if (!user || user.email !== "wikus77@hotmail.it") {
    return null;
  }
  const handleSendPush = async () => {
    if (!adminToken.trim()) {
      ue$1.error("❌ Inserisci il token admin");
      return;
    }
    setLoading(true);
    setResult(null);
    try {
      console.log("[PUSH TEST] Sending push notification...", {
        title,
        body,
        deeplink,
        bypassQuietHours,
        hasToken: !!adminToken
      });
      const functionsBaseUrl = "https://heqgsrofojvqiovkbsfn.supabase.co"?.replace(/\/$/, "") || "";
      const response = await fetch(
        `${functionsBaseUrl}/functions/v1/webpush-targeted-send`,
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-admin-token": adminToken
          },
          body: JSON.stringify({
            user_ids: ["495246c1-9154-4f01-a428-7f37fe230180"],
            payload: {
              title,
              body,
              url: deeplink
            }
          })
        }
      );
      const data = await response.json();
      console.log("[PUSH TEST] Response:", data);
      setResult(data);
      if (response.ok && data.success) {
        ue$1.success(`✅ Push inviato: ${data.sent}/${data.total}`);
      } else {
        ue$1.error(`❌ Errore: ${data.error || "Unknown error"}`);
      }
    } catch (error) {
      console.error("[PUSH TEST] Error:", error);
      setResult({ error: error.message });
      ue$1.error(`❌ Errore: ${error.message}`);
    } finally {
      setLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "container mx-auto p-6 max-w-2xl", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CardTitle, { children: "🧪 Push Test Panel (MCP Only)" }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "adminToken", children: "🔑 Admin Token (PUSH_ADMIN_TOKEN)" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "adminToken",
            type: "password",
            value: adminToken,
            onChange: (e) => setAdminToken(e.target.value),
            placeholder: "Inserisci token admin da Supabase secrets"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground", children: "Trovalo in: Supabase Dashboard → Edge Functions → Secrets → PUSH_ADMIN_TOKEN" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "title", children: "Title" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "title",
            value: title,
            onChange: (e) => setTitle(e.target.value),
            placeholder: "Notification title"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "body", children: "Body" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "body",
            value: body,
            onChange: (e) => setBody(e.target.value),
            placeholder: "Notification body"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "deeplink", children: "Deeplink" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Input,
          {
            id: "deeplink",
            value: deeplink,
            onChange: (e) => setDeeplink(e.target.value),
            placeholder: "/profile"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center space-x-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Checkbox,
          {
            id: "quiet",
            checked: bypassQuietHours,
            onCheckedChange: (checked) => setBypassQuietHours(checked)
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "quiet", className: "text-sm", children: "Bypass quiet hours" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: handleSendPush,
          disabled: loading || !adminToken.trim(),
          className: "w-full",
          children: loading ? "⏳ Invio..." : "📤 Invia a MCP (495246c1...)"
        }
      ),
      !adminToken.trim() && /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-yellow-500 text-center", children: "⚠️ Inserisci il token admin per abilitare l'invio" }),
      result && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-4 p-4 bg-muted rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold mb-2", children: "📊 Result:" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("pre", { className: "text-xs overflow-auto", children: JSON.stringify(result, null, 2) })
      ] })
    ] })
  ] }) });
}

const MarkersHealthcheck = React$1.lazy(() => __vitePreload(() => import('./MarkersHealthcheck.ADG4aDzB.js'),true?__vite__mapDeps([14,3,2,1,6,5,7,8,9]):void 0));
const PushDebug = React$1.lazy(() => __vitePreload(() => import('./PushDebug.DnEXtAtD.js'),true?__vite__mapDeps([15,1,2,3,6,5,7,8,9]):void 0));
const WouterRoutes = () => {
  const { isAuthenticated, isLoading, getCurrentUser } = useUnifiedAuth();
  const [location, setLocation] = useLocation();
  const [hasActiveSub, setHasActiveSub] = reactExports.useState(null);
  const [subCheckLoading, setSubCheckLoading] = reactExports.useState(false);
  useQueryQRRedirect();
  reactExports.useEffect(() => {
    async function checkSubscription() {
      if (!isAuthenticated || isLoading) {
        setHasActiveSub(null);
        return;
      }
      const user = getCurrentUser();
      if (!user?.id) {
        setHasActiveSub(false);
        return;
      }
      setSubCheckLoading(true);
      const timeoutId = setTimeout(() => {
        console.warn("[BOOT] Subscription check timeout - proceeding with fail-open");
        setHasActiveSub(false);
        setSubCheckLoading(false);
      }, 3e3);
      try {
        const subResult = await getActiveSubscription(supabase, user.id);
        clearTimeout(timeoutId);
        setHasActiveSub(subResult.hasActive);
        const { data: profile } = await supabase.from("profiles").select("role, choose_plan_seen").eq("id", user.id).single();
        const isAdmin = ["admin", "owner"].some((r) => profile?.role?.toLowerCase?.().includes(r));
        if (!isAdmin && !subResult.hasActive && !profile?.choose_plan_seen && location === "/") {
          setLocation("/choose-plan");
          return;
        }
        const initialRoutes = ["/", "/login", "/mission-intro", "/subscription-verify"];
        if (subResult.plan === "free" && initialRoutes.includes(location)) {
          setLocation("/home");
          return;
        }
      } catch (error) {
        console.error("[BOOT] Subscription check error - failing open:", error);
        clearTimeout(timeoutId);
        setHasActiveSub(false);
      } finally {
        setSubCheckLoading(false);
      }
    }
    checkSubscription();
  }, [isAuthenticated, isLoading, getCurrentUser, location, setLocation]);
  const isCapacitorApp = typeof window !== "undefined" && (window.location.protocol === "capacitor:" || window.location.hostname === "localhost" && false);
  console.log("🔍 WOUTER ROUTING STATE DEBUG:", {
    isAuthenticated,
    isLoading,
    isCapacitorApp,
    currentPath: window.location.pathname,
    userExists: !!isAuthenticated,
    timestamp: (/* @__PURE__ */ new Date()).toISOString()
  });
  console.log(`✅ ROUTE: Current path = ${window.location.pathname}`);
  console.log(`🔐 AUTH STATUS: isAuthenticated = ${isAuthenticated}, isLoading = ${isLoading}`);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(ErrorBoundary$1, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IOSSafeAreaOverlay, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Switch$1, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/", children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(PageSkeleton, { variant: "default" }) : !isAuthenticated ? (() => {
      try {
        const isFirstVisit = !localStorage.getItem("m1_first_visit_seen");
        if (isFirstVisit) {
          localStorage.setItem("m1_first_visit_seen", "1");
          return /* @__PURE__ */ jsxRuntimeExports.jsx(LandingPage, {});
        } else {
          return /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {});
        }
      } catch (error) {
        console.error("[BOOT] Landing page error, showing login:", error);
        return /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {});
      }
    })() : /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(GlobalLayout, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(AppHome, {}),
      subCheckLoading && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed top-4 right-4 bg-background/80 backdrop-blur-sm border rounded-lg p-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Verifica piano..." }) })
    ] }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/landing", children: /* @__PURE__ */ jsxRuntimeExports.jsx(LandingPage, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/home", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AppHome, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/map-3d-tiler", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { children: "Loading 3D Map..." }), children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./MapTiler3D.BXeIrYtB.js'),true?__vite__mapDeps([4,3,2,5,1,6,7,8,9,10]):void 0))) }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/living-map-3d", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(LivingMap3D, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/buzz", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BuzzPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligencePage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/rag", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligenceRAG, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/answer-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligenceAnswerTest, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/norah-assistant", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(NorahAssistant, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/battle", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleLobby, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/battle/:battleId", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleArena, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/battle-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BattleTest, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/coordinates", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Coordinate Selector" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CoordinateSelector, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/clue-journal", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Clue Journal" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ClueJournal, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/archive", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Archivio Indizi" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ClueArchive, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/radar", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Geo Radar" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(GeoRadarTool, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/interceptor", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "BUZZ Interceptor" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(BuzzInterceptor, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/final-shot", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "min-h-screen w-full overflow-hidden", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(IntelModuleHeader, { title: "Final Shot" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(FinalShotPage, {})
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/intelligence/rag", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(IntelligenceRAG, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/leaderboard", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(HallOfWinnersStyledPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/winners", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(HallOfWinners, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/notifications", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Notifications, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/profile", children: () => {
      if (typeof window !== "undefined") {
        window.location.href = "/settings/agent-profile";
      }
      return null;
    } }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SettingsPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/dna", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DNAPage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/agent-profile", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AgentProfileSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/profile", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AgentProfileSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/security", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SecuritySettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/mission", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(MissionSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/notifications", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(NotificationsSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/privacy", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PrivacySettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/legal", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(LegalSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/app-info", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AppInfoSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/info", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AppInfoSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/diagnostics", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DiagnosticsSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/settings/privacy-permissions", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PrivacyPermissionsSettings, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Subscriptions, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions/silver", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SilverPlanPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions/gold", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GoldPlanPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions/black", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BlackPlanPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscriptions/titanium", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(TitaniumPlanPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/admin/send-notification", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SendNotificationPage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/admin/mission-panel", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(MissionPanelPage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/admin/pulse-lab", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PulseLab, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AdminPushConsolePage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push-sender", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushSenderPanel, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push-admin", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center", children: "Loading..." }), children: React$1.createElement(React$1.lazy(() => __vitePreload(() => Promise.resolve().then(() => AdminPushConsolePage$1),true?void 0:void 0))) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center", children: "Loading..." }), children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./UserPushConsolePage.Bv4wVJez.js'),true?__vite__mapDeps([16,3,2,1,6,5,7,8,9]):void 0))) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/dev/markers-healthcheck", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center", children: "Loading..." }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(MarkersHealthcheck, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/dev/push-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushTest, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/push-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushTestPage, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/unified-push-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushTestPage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/push-health", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushHealth, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/notification-debug", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(NotificationDebug, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/debug/pushtest", children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushTest$1, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/debug/push", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushDiagnostic, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/push-debug", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushDebug, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/push-report", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushReport, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/debug/m1ssion-push-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionPushTest, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/debug/raw-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionDebugTest, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/raw-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(M1ssionDebugTest, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel-access", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PanelAccessPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel-users", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PanelUsersPage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/bulk-marker-drop", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(BulkMarkerDropPage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/marker-rewards", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(MarkerRewardsPage, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/norah", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(NorahAdmin, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/diag-supabase", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DiagSupabase, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/supabase-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SupabaseConnectionTest, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push-control", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PanelAccessPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/panel/push-preflight", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PanelAccessPage, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/push-diagnosi", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushDiagnosi, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/firebase-notification-debug", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(FirebaseNotificationDebug, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/push-debug", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PushDebug, {}) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/fcm-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(FcmTest, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/android-push-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./android-push-test.wVDnxbof.js'),true?__vite__mapDeps([17,3,2,1,6,5,7,8,9]):void 0))) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/native-push-test", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProtectedRoute, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./native-push-test.BaM7h6BR.js'),true?__vite__mapDeps([18,3,2,1,6,5,7,8,9]):void 0))) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/terms", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Terms, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/privacy-policy", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(PrivacyPolicy, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/cookie-policy", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(CookiePolicy, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/safecreative", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SafeCreative, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/game-rules", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GameRules, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/contact", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(Contact, {}) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/billing-smoke-test", children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./BillingSmokeTest.Dvf6qhqR.js'),true?__vite__mapDeps([19,3,2,1,6,5,7,8,9]):void 0))) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/dev-stripe-setup", children: React$1.createElement(React$1.lazy(() => __vitePreload(() => import('./DevStripeKeysSetup.ClH9ZdiZ.js'),true?__vite__mapDeps([20,3,2,1,6,5,7,8,9]):void 0))) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/choose-plan", children: isAuthenticated ? /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChoosePlanPage, {}) }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/subscription-verify", children: isAuthenticated ? /* @__PURE__ */ jsxRuntimeExports.jsx(SubscriptionVerify, {}) : /* @__PURE__ */ jsxRuntimeExports.jsx(Login, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/mission-intro", children: /* @__PURE__ */ jsxRuntimeExports.jsx(MissionIntroPage, {}) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/login", component: Login }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/register", component: Register }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { path: "/auth/reset", component: ResetPasswordPage }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(Route, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLayout, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-2xl font-bold mb-4", children: "404 - Pagina non trovata" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("button", { onClick: () => window.location.href = "/home", children: "Torna alla Home" })
    ] }) }) }) })
  ] }) }) });
};

const setupProductionLogging = () => {
  if (typeof window !== "undefined" && true) {
    const originalLog = console.log;
    const originalWarn = console.warn;
    const originalError = console.error;
    console.log = (...args) => {
      if (args[0]?.includes("CRITICAL") || args[0]?.includes("SECURITY")) {
        originalLog.apply(console, args);
      }
    };
    console.warn = originalWarn;
    console.error = originalError;
    console.debug = () => {
    };
    console.info = () => {
    };
    console.trace = () => {
    };
  }
};
const safeLog = (...args) => {
  if (args[0]?.includes("CRITICAL") || args[0]?.includes("SECURITY")) {
    console.log(...args);
  }
};
const isProductionReady = () => {
  const checks = {
    serviceWorker: "serviceWorker" in navigator,
    webPush: "PushManager" in window,
    notifications: "Notification" in window,
    localStorage: typeof Storage !== "undefined"
  };
  const ready = Object.values(checks).every(Boolean);
  return ready;
};

const ProductionSafety = ({ children }) => {
  reactExports.useEffect(() => {
    const isReady = isProductionReady();
    if (!isReady) {
      console.warn("⚠️ Production readiness check failed");
    } else {
      safeLog("✅ M1SSION™ Production Ready - By Joseph Mulè / NIYVORA KFT™");
    }
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
};

const ProductionSafetyWrapper = ({ children }) => {
  reactExports.useEffect(() => {
    {
      window.__M1_NO_SHIM_DUMP__ = true;
      window.__M1_PROD_MODE__ = true;
      const removeDebugContent = () => {
        const walker = document.createTreeWalker(
          document.body,
          NodeFilter.SHOW_TEXT,
          {
            acceptNode: (node2) => {
              const text = node2.textContent || "";
              if (text.includes("Stripe Shim Globale") || text.includes("window.getStripe") || text.includes("STRIPE_PK") || text.includes("stripeFallback")) {
                return NodeFilter.FILTER_ACCEPT;
              }
              return NodeFilter.FILTER_REJECT;
            }
          }
        );
        const nodesToRemove = [];
        let node;
        while (node = walker.nextNode()) {
          nodesToRemove.push(node);
        }
        nodesToRemove.forEach((node2) => {
          const parent = node2.parentNode;
          if (parent && parent.nodeType === Node.ELEMENT_NODE) {
            const element = parent;
            if (element.textContent?.includes("Stripe Shim Globale")) {
              element.style.display = "none";
            } else {
              parent.removeChild(node2);
            }
          }
        });
      };
      removeDebugContent();
      const observer = new MutationObserver(() => {
        removeDebugContent();
      });
      observer.observe(document.body, {
        childList: true,
        subtree: true,
        characterData: true
      });
      return () => observer.disconnect();
    }
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
};

const InstallPrompt = () => {
  const [deferredPrompt, setDeferredPrompt] = reactExports.useState(null);
  const [showPrompt, setShowPrompt] = reactExports.useState(false);
  const [isIOS, setIsIOS] = reactExports.useState(false);
  const [isStandalone, setIsStandalone] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const iOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    setIsIOS(iOS);
    const standalone = window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
    setIsStandalone(standalone);
    const handleBeforeInstallPrompt = (e) => {
      e.preventDefault();
      setDeferredPrompt(e);
      if (!standalone) {
        setShowPrompt(true);
      }
    };
    window.addEventListener("beforeinstallprompt", handleBeforeInstallPrompt);
    if (iOS && !standalone) {
      const timer = setTimeout(() => {
        const dismissed = localStorage.getItem("ios-install-dismissed");
        if (!dismissed) {
          setShowPrompt(true);
        }
      }, 3e3);
      return () => clearTimeout(timer);
    }
    return () => {
      window.removeEventListener("beforeinstallprompt", handleBeforeInstallPrompt);
    };
  }, []);
  const handleInstallClick = async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === "accepted") {
        setDeferredPrompt(null);
        setShowPrompt(false);
      }
    }
  };
  const handleDismiss = () => {
    setShowPrompt(false);
    if (isIOS) {
      localStorage.setItem("ios-install-dismissed", "true");
    }
  };
  if (isStandalone || !showPrompt) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bottom-20 left-4 right-4 z-50 animate-fade-in", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "glass-card p-4 border border-primary/20", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-lg bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-5 h-5 text-white" }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-semibold text-white text-sm mb-1", children: "Installa M1SSION™" }),
      isIOS ? /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-gray-300 mb-3", children: [
        "Tocca ",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "inline-block w-4 h-4 mx-1 align-middle", children: /* @__PURE__ */ jsxRuntimeExports.jsx("svg", { viewBox: "0 0 24 24", fill: "currentColor", className: "w-full h-full", children: /* @__PURE__ */ jsxRuntimeExports.jsx("path", { d: "M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" }) }) }),
        ' in Safari, poi "Aggiungi alla schermata Home"'
      ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-gray-300 mb-3", children: "Installa l'app per un'esperienza ottimale" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        !isIOS && deferredPrompt && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          Button,
          {
            onClick: handleInstallClick,
            size: "sm",
            className: "flex-1 bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink text-white",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Download, { className: "w-4 h-4 mr-2" }),
              "Installa"
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleDismiss,
            variant: "ghost",
            size: "sm",
            className: "text-gray-400 hover:text-white",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-4 h-4" })
          }
        )
      ] })
    ] })
  ] }) }) });
};

const usePushNotificationLogger = () => {
  const { user } = useAuth();
  const logPushEvent = reactExports.useCallback(async (params) => {
    try {
      const {
        eventType,
        token,
        platform,
        deviceInfo,
        success = true,
        errorMessage
      } = params;
      const enhancedDeviceInfo = {
        userAgent: navigator.userAgent,
        isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
        isPWA: window.navigator.standalone === true,
        hostname: window.location.hostname,
        protocol: window.location.protocol,
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        ...deviceInfo
      };
      const { error: pushLogError } = await supabase.from("push_notifications_log").insert({
        user_id: user?.id || null,
        event_type: eventType,
        token: token?.substring(0, 50) || null,
        // Truncate for security
        platform: platform || (enhancedDeviceInfo.isIOS ? "ios_pwa" : "web_pwa"),
        device_info: enhancedDeviceInfo,
        success,
        error_message: errorMessage
      });
      if (pushLogError) {
        console.error("❌ Push log error:", pushLogError);
      }
      const { error: adminLogError } = await supabase.from("admin_logs").insert({
        event_type: `push_${eventType}`,
        user_id: user?.id || null,
        note: `M1SSION™ Push: ${eventType}`,
        context: "push_notifications",
        details: {
          token: token?.substring(0, 20) + "..." || null,
          platform,
          success,
          errorMessage,
          deviceInfo: enhancedDeviceInfo
        }
      });
      if (adminLogError) {
        console.error("❌ Admin log error:", adminLogError);
      }
      console.debug(`🔔 M1SSION™: Logged push event: ${eventType}`, {
        success,
        platform,
        hasToken: !!token
      });
    } catch (error) {
      console.error("❌ M1SSION™: Push logging failed:", error);
    }
  }, [user]);
  const logTokenRegistered = reactExports.useCallback((token, platform) => {
    return logPushEvent({
      eventType: "token_registered",
      token,
      platform,
      success: true
    });
  }, [logPushEvent]);
  const logTokenRegistrationFailed = reactExports.useCallback((errorMessage, platform) => {
    return logPushEvent({
      eventType: "token_registration_failed",
      platform,
      success: false,
      errorMessage
    });
  }, [logPushEvent]);
  const logPermissionRequested = reactExports.useCallback((platform) => {
    return logPushEvent({
      eventType: "permission_requested",
      platform,
      success: true
    });
  }, [logPushEvent]);
  const logPermissionGranted = reactExports.useCallback((platform) => {
    return logPushEvent({
      eventType: "permission_granted",
      platform,
      success: true
    });
  }, [logPushEvent]);
  const logPermissionDenied = reactExports.useCallback((platform) => {
    return logPushEvent({
      eventType: "permission_denied",
      platform,
      success: false
    });
  }, [logPushEvent]);
  const logInitializationSuccess = reactExports.useCallback((platform) => {
    return logPushEvent({
      eventType: "initialization_success",
      platform,
      success: true
    });
  }, [logPushEvent]);
  const logInitializationFailed = reactExports.useCallback((errorMessage, platform) => {
    return logPushEvent({
      eventType: "initialization_failed",
      platform,
      success: false,
      errorMessage
    });
  }, [logPushEvent]);
  return {
    logPushEvent,
    logTokenRegistered,
    logTokenRegistrationFailed,
    logPermissionRequested,
    logPermissionGranted,
    logPermissionDenied,
    logInitializationSuccess,
    logInitializationFailed
  };
};

const IOSPermissionManager = ({
  show = false,
  onPermissionGranted,
  onPermissionDenied
}) => {
  const [isVisible, setIsVisible] = reactExports.useState(false);
  const [permissionState, setPermissionState] = reactExports.useState("default");
  const [isRequestingPermission, setIsRequestingPermission] = reactExports.useState(false);
  const [hasRequestedOnce, setHasRequestedOnce] = reactExports.useState(false);
  const { logPermissionRequested, logPermissionGranted, logPermissionDenied } = usePushNotificationLogger();
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isPWA = window.navigator.standalone === true;
  const isSafariIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && /Safari/.test(navigator.userAgent) && !/CriOS/.test(navigator.userAgent);
  const shouldShow$1 = reactExports.useCallback(() => {
    const canShowByFrequency = shouldShow("ios-permission", 24);
    return show || isIOS && isPWA && permissionState === "default" && !hasRequestedOnce && canShowByFrequency && typeof window !== "undefined" && "Notification" in window;
  }, [show, isIOS, isPWA, permissionState, hasRequestedOnce]);
  reactExports.useEffect(() => {
    if (typeof window !== "undefined") {
      if ("Notification" in window) {
        setPermissionState(Notification.permission);
      }
      const timer = setTimeout(() => {
        const shouldShowNow = shouldShow$1();
        setIsVisible(shouldShowNow);
        if (shouldShowNow) {
          markShown("ios-permission");
        }
      }, 200);
      return () => clearTimeout(timer);
    }
  }, [shouldShow$1]);
  const requestPermission = reactExports.useCallback(async () => {
    if (isRequestingPermission || hasRequestedOnce) {
      return;
    }
    if (localStorage.getItem("push:disable") === "1") {
      console.warn("[IOS-PERM] Emergency disable flag active");
      setIsVisible(false);
      return;
    }
    setIsRequestingPermission(true);
    setHasRequestedOnce(true);
    try {
      console.log("🔔 M1SSION™: iOS Permission Manager - Requesting permission...");
      await logPermissionRequested(isIOS ? "ios_pwa" : "web_pwa");
      let permission;
      if (isIOS && isPWA && isSafariIOS) {
        console.log("🔔 M1SSION™: Using iOS PWA permission strategy");
        if (window.M1SSIONOneSignalDebug) {
          try {
            const result = await window.M1SSIONOneSignalDebug.forceRequestPermission();
            permission = result ? "granted" : "denied";
          } catch (error) {
            console.warn("⚠️ M1SSION™: OneSignal permission failed, using native API");
            permission = await Notification.requestPermission();
          }
        } else {
          permission = await Notification.requestPermission();
        }
      } else {
        permission = await Notification.requestPermission();
      }
      console.log("🔔 M1SSION™: Permission result:", permission);
      setPermissionState(permission);
      if (permission === "granted") {
        await logPermissionGranted(isIOS ? "ios_pwa" : "web_pwa");
        ue$1.success("✅ Notifiche attivate!", {
          description: "Riceverai aggiornamenti importanti per M1SSION™"
        });
        onPermissionGranted?.();
        setIsVisible(false);
      } else {
        await logPermissionDenied(isIOS ? "ios_pwa" : "web_pwa");
        ue$1.error("❌ Permessi notifiche negati", {
          description: isIOS ? "Puoi abilitarli in Impostazioni > Safari > Notifiche" : "Puoi abilitarli nelle impostazioni del browser"
        });
        onPermissionDenied?.();
      }
    } catch (error) {
      console.error("❌ M1SSION™: Permission request error:", error);
      ue$1.error("❌ Errore richiesta permessi notifiche");
      await logPermissionDenied(isIOS ? "ios_pwa" : "web_pwa");
      onPermissionDenied?.();
    } finally {
      setIsRequestingPermission(false);
    }
  }, [
    isRequestingPermission,
    hasRequestedOnce,
    isIOS,
    isPWA,
    isSafariIOS,
    logPermissionRequested,
    logPermissionGranted,
    logPermissionDenied,
    onPermissionGranted,
    onPermissionDenied
  ]);
  if (!isVisible || permissionState === "granted" || !isIOS) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "fixed bottom-4 right-4 w-80 z-50 border-2 border-primary shadow-lg", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-sm flex items-center justify-between", children: [
      "🔔 Notifiche Push",
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          variant: "ghost",
          size: "sm",
          onClick: () => setIsVisible(false),
          className: "h-6 w-6 p-0",
          children: "×"
        }
      )
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-muted-foreground", children: "Abilita le notifiche push per ricevere aggiornamenti importanti su M1SSION™" }),
      permissionState === "denied" && hasRequestedOnce && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-red-600 bg-red-50 p-2 rounded", children: [
        "Permessi negati. Vai in ",
        /* @__PURE__ */ jsxRuntimeExports.jsx("strong", { children: "Impostazioni Safari > Notifiche siti web" }),
        " per abilitarli."
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: requestPermission,
            disabled: isRequestingPermission,
            className: "w-full",
            variant: "default",
            children: isRequestingPermission ? "🔄 Richiesta in corso..." : "🔔 Abilita Notifiche"
          }
        ),
        hasRequestedOnce && permissionState === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: () => setIsVisible(false),
            variant: "outline",
            className: "w-full",
            size: "sm",
            children: "Continua senza notifiche"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: isIOS && isPWA ? "📱 iOS PWA Mode" : "🌐 Web Mode" })
    ] })
  ] });
};

const useAndroidPushNotifications = () => {
  const [state, setState] = reactExports.useState({
    isSupported: false,
    isRegistered: false,
    token: null,
    permission: null,
    isLoading: false,
    error: null
  });
  const isAndroid = /Android/i.test(navigator.userAgent);
  reactExports.useEffect(() => {
    const initializePWAPush = async () => {
      const isSupported = "serviceWorker" in navigator && "PushManager" in window;
      setState((prev) => ({ ...prev, isSupported }));
      if (!isSupported) {
        console.log("❌ Push notifications not supported in this browser");
        return;
      }
      setState((prev) => ({ ...prev, isLoading: true }));
      try {
        const permission = await Notification.requestPermission();
        setState((prev) => ({
          ...prev,
          permission,
          isLoading: false
        }));
        console.log("📱 PWA Push permission status:", permission);
      } catch (error) {
        console.error("❌ PWA push initialization error:", error);
        setState((prev) => ({
          ...prev,
          error: error.message,
          isLoading: false
        }));
      }
    };
    initializePWAPush();
  }, []);
  const requestPermissionAndRegister = async () => {
    if (!state.isSupported) {
      ue$1.error("❌ Push notifications not supported");
      return false;
    }
    setState((prev) => ({ ...prev, isLoading: true }));
    try {
      const permission = await Notification.requestPermission();
      setState((prev) => ({
        ...prev,
        permission
      }));
      if (permission === "granted") {
        const registration = await navigator.serviceWorker.ready;
        const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await __vitePreload(async () => { const { loadVAPIDPublicKey, urlBase64ToUint8Array } = await import('./vapid-loader.Dvqe_4zt.js');return { loadVAPIDPublicKey, urlBase64ToUint8Array }},true?[]:void 0);
        const vapidKey = await loadVAPIDPublicKey();
        if (!vapidKey) {
          throw new Error("VAPID public key not configured");
        }
        const vapidKeyArray = urlBase64ToUint8Array(vapidKey);
        const subscription = await registration.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: vapidKeyArray
        });
        await saveSubscriptionToSupabase(subscription);
        setState((prev) => ({
          ...prev,
          isRegistered: true,
          token: JSON.stringify(subscription),
          isLoading: false
        }));
        ue$1.success("✅ Push notifications enabled!");
        return true;
      } else {
        ue$1.error("❌ Push notification permission denied");
        setState((prev) => ({ ...prev, isLoading: false }));
        return false;
      }
    } catch (error) {
      console.error("❌ Permission request error:", error);
      setState((prev) => ({
        ...prev,
        error: error.message,
        isLoading: false
      }));
      ue$1.error("❌ Error enabling push notifications");
      return false;
    }
  };
  const saveSubscriptionToSupabase = async (subscription) => {
    try {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      const { error } = await supabase.from("push_tokens").upsert({
        user_id: user.id,
        token: JSON.stringify(subscription),
        platform: isAndroid ? "android" : "web",
        endpoint_type: "web_push",
        device_info: {
          platform: "web",
          userAgent: navigator.userAgent,
          endpoint: subscription.endpoint
        },
        created_at: (/* @__PURE__ */ new Date()).toISOString(),
        updated_at: (/* @__PURE__ */ new Date()).toISOString(),
        last_used_at: (/* @__PURE__ */ new Date()).toISOString()
      });
      if (error) {
        console.error("❌ Error saving push subscription:", error);
      } else {
        console.log("✅ Push subscription saved to Supabase");
      }
    } catch (error) {
      console.error("❌ Error in saveSubscriptionToSupabase:", error);
    }
  };
  return {
    ...state,
    isAndroid,
    requestPermissionAndRegister
  };
};

const AndroidPushSetup = ({ className }) => {
  const {
    isSupported,
    isAndroid,
    isRegistered,
    token,
    permission,
    isLoading,
    error,
    requestPermissionAndRegister
  } = useAndroidPushNotifications();
  if (!isAndroid || !isSupported) {
    return null;
  }
  const getStatusIcon = () => {
    if (isRegistered && token) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-5 h-5 text-green-400" });
    }
    if (error) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-5 h-5 text-red-400" });
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5 text-m1ssion-blue" });
  };
  const getStatusText = () => {
    if (isRegistered && token) {
      return "Notifiche Android Attive";
    }
    if (permission === "denied") {
      return "Permessi Negati";
    }
    if (error) {
      return "Errore Configurazione";
    }
    if (permission === "granted" && !isRegistered) {
      return "Registrazione in corso...";
    }
    return "Attiva Notifiche Android";
  };
  const getStatusDescription = () => {
    if (isRegistered && token) {
      return "Riceverai notifiche push native su Android";
    }
    if (permission === "denied") {
      return "Vai nelle impostazioni per abilitare le notifiche";
    }
    if (error) {
      return error;
    }
    return "Abilita le notifiche push per ricevere aggiornamenti M1SSION";
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: `glass-card p-6 ${className}`, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3 mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-6 h-6 text-m1ssion-blue" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-lg font-bold text-white", children: "Notifiche Push Android" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3 mb-4", children: [
      getStatusIcon(),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "font-medium text-white mb-1", children: getStatusText() }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-gray-300", children: getStatusDescription() })
      ] })
    ] }),
    !isRegistered && permission !== "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx(
      Button,
      {
        onClick: requestPermissionAndRegister,
        disabled: isLoading,
        className: "w-full bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink text-white",
        children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" }),
          "Configurazione..."
        ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4" }),
          "Attiva Notifiche"
        ] })
      }
    ),
    permission === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-3 p-3 bg-red-500/20 border border-red-500/30 rounded-md", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-red-300", children: "💡 Vai in Impostazioni → App → M1SSION → Notifiche per abilitarle manualmente" }) }),
    token && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-3 p-3 bg-green-500/20 border border-green-500/30 rounded-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm text-green-300", children: [
      "✅ Token: ",
      token.substring(0, 20),
      "..."
    ] }) })
  ] });
};

const useIOSPushNotifications = () => {
  const [state, setState] = reactExports.useState({
    isSupported: false,
    isRegistered: false,
    token: null,
    permission: null,
    isLoading: false,
    error: null
  });
  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
  reactExports.useEffect(() => {
    if (typeof window !== "undefined") {
      setState((prev) => ({ ...prev, isSupported: false }));
    }
  }, []);
  const requestPermissionAndRegister = async () => {
    if (!isIOS) {
      ue$1.error("Notifiche push disponibili solo su iOS");
      return false;
    }
    setState((prev) => ({ ...prev, isLoading: true }));
    try {
      const permResult = await PushNotifications.requestPermissions();
      setState((prev) => ({
        ...prev,
        permission: permResult.receive
      }));
      if (permResult.receive === "granted") {
        await PushNotifications.register();
        ue$1.success("✅ Notifiche push iOS attivate!");
        return true;
      } else {
        ue$1.error("❌ Permessi notifiche negati");
        setState((prev) => ({ ...prev, isLoading: false }));
        return false;
      }
    } catch (error) {
      console.error("❌ iOS Permission request error:", error);
      setState((prev) => ({
        ...prev,
        error: error.message,
        isLoading: false
      }));
      ue$1.error("Errore richiesta permessi iOS");
      return false;
    }
  };
  return {
    ...state,
    isIOS,
    requestPermissionAndRegister
  };
};

const useNativePushNotifications = () => {
  const platform = /iPhone|iPad|iPod/i.test(navigator.userAgent) ? "ios" : /Android/i.test(navigator.userAgent) ? "android" : "web";
  const androidPush = useAndroidPushNotifications();
  const iosPush = useIOSPushNotifications();
  const [unifiedState, setUnifiedState] = reactExports.useState({
    isSupported: false,
    isRegistered: false,
    token: null,
    permission: null,
    isLoading: false,
    error: null,
    platform
  });
  reactExports.useEffect(() => {
    if (platform === "android") {
      setUnifiedState({
        isSupported: androidPush.isSupported,
        isRegistered: androidPush.isRegistered,
        token: androidPush.token,
        permission: androidPush.permission === "default" ? "prompt" : androidPush.permission,
        isLoading: androidPush.isLoading,
        error: androidPush.error,
        platform: "android"
      });
    } else if (platform === "ios") {
      setUnifiedState({
        isSupported: iosPush.isSupported,
        isRegistered: iosPush.isRegistered,
        token: iosPush.token,
        permission: iosPush.permission,
        isLoading: iosPush.isLoading,
        error: iosPush.error,
        platform: "ios"
      });
    } else {
      setUnifiedState({
        isSupported: "serviceWorker" in navigator && "PushManager" in window,
        isRegistered: false,
        token: null,
        permission: null,
        isLoading: false,
        error: null,
        platform: "web"
      });
    }
  }, [
    platform,
    // Only depend on primitive values to prevent infinite loops
    androidPush.isSupported,
    androidPush.isRegistered,
    androidPush.token,
    androidPush.permission,
    androidPush.isLoading,
    androidPush.error,
    iosPush.isSupported,
    iosPush.isRegistered,
    iosPush.token,
    iosPush.permission,
    iosPush.isLoading,
    iosPush.error
  ]);
  const requestPermissionAndRegister = async () => {
    if (platform === "android") {
      return await androidPush.requestPermissionAndRegister();
    } else if (platform === "ios") {
      return await iosPush.requestPermissionAndRegister();
    }
    return false;
  };
  return {
    ...unifiedState,
    requestPermissionAndRegister,
    // Platform specific data
    android: androidPush,
    ios: iosPush
  };
};

const PushNotificationSetup = ({ className }) => {
  const {
    isSupported,
    isRegistered,
    token,
    permission,
    isLoading,
    error,
    platform,
    requestPermissionAndRegister
  } = useNativePushNotifications();
  if (platform === "web" || !isSupported) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Card, { className, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5" }),
        "Notifiche Push"
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Le notifiche push native sono disponibili solo su dispositivi mobili" })
    ] }) });
  }
  const getPlatformIcon = () => {
    if (platform === "ios") return /* @__PURE__ */ jsxRuntimeExports.jsx(Apple, { className: "w-4 h-4" });
    if (platform === "android") return /* @__PURE__ */ jsxRuntimeExports.jsx(Smartphone, { className: "w-4 h-4" });
    return /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4" });
  };
  const getPlatformLabel = () => {
    if (platform === "ios") return "iOS";
    if (platform === "android") return "Android";
    return "Mobile";
  };
  const getStatusColor = () => {
    if (isRegistered) return "bg-green-500";
    if (permission === "denied") return "bg-red-500";
    if (permission === "granted") return "bg-yellow-500";
    return "bg-muted";
  };
  const getStatusText = () => {
    if (isRegistered) return "Attive";
    if (permission === "denied") return "Negati";
    if (permission === "granted") return "In corso...";
    return "Non configurate";
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-5 h-5" }),
        "Notifiche Push Native",
        /* @__PURE__ */ jsxRuntimeExports.jsxs(Badge, { variant: "outline", className: "ml-auto", children: [
          getPlatformIcon(),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "ml-1", children: getPlatformLabel() })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(CardDescription, { children: "Ricevi notifiche push native per aggiornamenti importanti della missione" })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between p-3 bg-muted/50 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `w-3 h-3 rounded-full ${getStatusColor()}` }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm font-medium", children: [
            "Stato: ",
            getStatusText()
          ] })
        ] }),
        isRegistered && /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-green-500" })
      ] }),
      token && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-muted/30 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-muted-foreground", children: [
        "Token: ",
        token.substring(0, 20),
        "..."
      ] }) }),
      error && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 p-3 bg-destructive/10 text-destructive rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "w-4 h-4" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm", children: error })
      ] }),
      permission === "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-3 bg-orange-50 border border-orange-200 rounded-lg", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-orange-800", children: "I permessi per le notifiche sono stati negati. Per attivarle, vai nelle impostazioni del dispositivo e abilita le notifiche per M1SSION." }) }),
      !isRegistered && permission !== "denied" && /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          onClick: requestPermissionAndRegister,
          disabled: isLoading,
          className: "w-full",
          children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2" }),
            "Configurazione..."
          ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Bell, { className: "w-4 h-4 mr-2" }),
            "Attiva Notifiche Push"
          ] })
        }
      ),
      isRegistered && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheckBig, { className: "w-4 h-4 text-green-600" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-sm text-green-800", children: [
          "✅ Notifiche push ",
          getPlatformLabel(),
          " configurate correttamente!"
        ] })
      ] })
    ] })
  ] });
};

async function runPWACleanupOnce() {
  const CLEANUP_KEY = "m1_pwa_fix_v20250904";
  if (localStorage.getItem(CLEANUP_KEY)) {
    console.log("🧹 PWA cleanup already completed for this version");
    return;
  }
  console.log("🧹 Starting one-time PWA cleanup...");
  try {
    if ("serviceWorker" in navigator) {
      const registrations = await navigator.serviceWorker.getRegistrations();
      for (const registration of registrations) {
        const swUrl = registration.scope || registration.installing?.scriptURL || registration.waiting?.scriptURL || registration.active?.scriptURL;
        if (swUrl && !swUrl.includes("/sw.js")) {
          console.log("🗑️ Removing non-official service worker:", swUrl);
          await registration.unregister();
        }
      }
    }
    if ("caches" in window) {
      const cacheNames = await caches.keys();
      const oldCaches = cacheNames.filter(
        (name) => name.includes("onesignal") || name.includes("firebase") || name.includes("workbox") || name.startsWith("runtime-")
      );
      for (const cacheName of oldCaches) {
        console.log("🗑️ Clearing old cache:", cacheName);
        await caches.delete(cacheName);
      }
    }
    const keysToRemove = [
      "OneSignal-notificationClicked",
      "OneSignal-isOptedOut",
      "OneSignal-subscription",
      "OneSignal-sessionCount",
      "onesignal-pageview-count",
      "OneSignalSDKUpdaterWorker.js",
      "OneSignalSDKWorker.js"
    ];
    keysToRemove.forEach((key) => {
      if (localStorage.getItem(key)) {
        console.log("🗑️ Removing OneSignal key:", key);
        localStorage.removeItem(key);
      }
    });
    const sessionKeys = Object.keys(sessionStorage);
    sessionKeys.forEach((key) => {
      if (key.includes("OneSignal") || key.includes("onesignal")) {
        console.log("🗑️ Removing OneSignal session key:", key);
        sessionStorage.removeItem(key);
      }
    });
    localStorage.setItem(CLEANUP_KEY, "1");
    console.log("✅ PWA cleanup completed successfully");
  } catch (error) {
    console.error("❌ PWA cleanup error:", error);
    localStorage.setItem(CLEANUP_KEY, "1");
  }
}

const usePWAStabilizer = () => {
  const { user } = useAuth();
  reactExports.useEffect(() => {
    console.log("🚀 PWA Stabilizer: Initializing...");
    const initializePWA = async () => {
      try {
        await runPWACleanupOnce();
        console.log("✅ PWA Stabilizer: Cleanup completed");
        if ("serviceWorker" in navigator) {
          try {
            const registration = await navigator.serviceWorker.register("/sw.js", {
              scope: "/",
              updateViaCache: "none"
            });
            console.log("✅ PWA Stabilizer: SW registration completed");
          } catch (swError) {
            console.warn("⚠️ PWA Stabilizer: SW registration failed (non-critical):", swError);
          }
        }
        if (user && Notification.permission === "granted") {
          console.log("🔔 PWA Stabilizer: Setting up push subscription...");
          try {
            const reg = await navigator.serviceWorker.ready;
            const result = await registerPush(reg);
            if (result) {
              console.log("✅ PWA Stabilizer: Push subscription established:", result);
            }
          } catch (error) {
            console.error("❌ PWA Stabilizer: Push subscription failed:", error);
          }
        }
        console.log("✅ PWA Stabilizer: Initialization complete");
      } catch (error) {
        console.error("❌ PWA Stabilizer: Initialization failed:", error);
      }
    };
    initializePWA();
  }, [user]);
};

const useLegalConsent = () => {
  const { user } = useUnifiedAuth();
  const { toast } = useToast();
  const [state, setState] = reactExports.useState(() => {
    const saved = localStorage.getItem("m1ssion_legal_consent") === "true";
    return {
      isAccepted: saved,
      isLoading: false,
      needsConsent: !saved
    };
  });
  reactExports.useEffect(() => {
    checkLegalConsent();
  }, [user]);
  const checkLegalConsent = async () => {
    try {
      setState((prev) => ({ ...prev, isLoading: true }));
      const savedConsent = localStorage.getItem("m1ssion_legal_consent");
      const isAccepted = savedConsent === "true";
      setState({
        isAccepted,
        isLoading: false,
        needsConsent: !isAccepted
      });
    } catch (error) {
      console.error("Error checking legal consent:", error);
      setState({
        isAccepted: false,
        isLoading: false,
        needsConsent: true
      });
    }
  };
  const acceptLegalConsent = async () => {
    try {
      setState((prev) => ({ ...prev, isLoading: true }));
      localStorage.setItem("m1ssion_legal_consent", "true");
      localStorage.setItem("m1ssion_legal_consent_date", (/* @__PURE__ */ new Date()).toISOString());
      setState({
        isAccepted: true,
        isLoading: false,
        needsConsent: false
      });
      toast({
        title: "🎯 Legal Terms Accepted",
        description: "Welcome to M1SSION™! Your skill-based adventure begins now."
      });
      return true;
    } catch (error) {
      console.error("Error accepting legal consent:", error);
      setState((prev) => ({ ...prev, isLoading: false }));
      toast({
        title: "❌ Error",
        description: "Unable to save consent. Please try again.",
        variant: "destructive"
      });
      return false;
    }
  };
  return {
    ...state,
    acceptLegalConsent,
    refreshConsent: checkLegalConsent
  };
};

const translations = {
  en: {
    title: "Legal Terms - M1SSION™",
    description: "To play M1SSION™, you must accept our Terms of Use. This is not a lottery or gambling game. It is a skill-based experience.",
    acceptButton: "✅ I Accept",
    learnMore: "Learn More",
    skillBased: "🎯 Skill-Based Game - No Gambling"
  },
  fr: {
    title: "Conditions Légales - M1SSION™",
    description: "Pour jouer à M1SSION™, vous devez accepter nos Conditions d'utilisation. Ce n'est pas un jeu de hasard, mais un jeu basé sur l'habileté.",
    acceptButton: "✅ J'accepte",
    learnMore: "En savoir plus",
    skillBased: "🎯 Jeu d'Habileté - Pas de Jeu de Hasard"
  },
  es: {
    title: "Términos Legales - M1SSION™",
    description: "Para jugar a M1SSION™, debes aceptar nuestros Términos de uso. No es un juego de azar, sino un desafío de habilidad.",
    acceptButton: "✅ Acepto",
    learnMore: "Saber más",
    skillBased: "🎯 Juego de Habilidad - Sin Apuestas"
  },
  de: {
    title: "Rechtliche Bedingungen - M1SSION™",
    description: "Um M1SSION™ zu spielen, musst du unsere Nutzungsbedingungen akzeptieren. Es handelt sich nicht um ein Glücksspiel, sondern um ein Geschicklichkeitsspiel.",
    acceptButton: "✅ Ich akzeptiere",
    learnMore: "Mehr erfahren",
    skillBased: "🎯 Geschicklichkeitsspiel - Kein Glücksspiel"
  }
};
const LegalOnboarding = () => {
  const { needsConsent, isLoading, acceptLegalConsent } = useLegalConsent();
  const [currentLang, setCurrentLang] = reactExports.useState("en");
  const [accepting, setAccepting] = reactExports.useState(false);
  const [, setLocation] = useLocation();
  console.log("🏛️ LegalOnboarding render:", { needsConsent, isLoading });
  reactExports.useEffect(() => {
    const detectLanguage = () => {
      const browserLang = navigator.language.toLowerCase();
      if (browserLang.startsWith("fr")) return "fr";
      if (browserLang.startsWith("es")) return "es";
      if (browserLang.startsWith("de")) return "de";
      return "en";
    };
    setCurrentLang(detectLanguage());
  }, []);
  const handleAccept = async (e) => {
    e?.preventDefault?.();
    e?.stopPropagation?.();
    setAccepting(true);
    try {
      const success = await acceptLegalConsent();
      const saved = localStorage.getItem("m1ssion_legal_consent");
      if (success && saved === "true") {
        console.log("✅ Legal consent saved");
        window.dispatchEvent(new Event("storage"));
      } else {
        console.error("❌ localStorage save failed or consent not accepted");
        ue$1.error("Errore nel salvataggio del consenso. Riprova.");
      }
    } catch (error) {
      console.error("❌ Error accepting consent:", error);
      ue$1.error("Errore. Riprova.");
    } finally {
      setAccepting(false);
    }
  };
  const handleLanguageChange = (lang) => {
    setCurrentLang(lang);
  };
  const openTerms = () => {
    console.log("🔗 Opening terms page...");
    setLocation("/terms");
  };
  if (isLoading) {
    console.log("🏛️ LegalOnboarding: Loading state");
    return null;
  }
  if (!needsConsent) {
    console.log("🏛️ LegalOnboarding: No consent needed");
    return null;
  }
  console.log("🏛️ LegalOnboarding: Showing banner for language:", currentLang);
  const content = translations[currentLang];
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 bg-black/80 backdrop-blur-md z-[10000] flex items-center justify-center p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { opacity: 0, scale: 0.9, y: 20 },
      animate: { opacity: 1, scale: 1, y: 0 },
      exit: { opacity: 0, scale: 0.9, y: 20 },
      className: "w-full max-w-lg",
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-gradient-to-br from-gray-900/95 to-black/95 border-[#00D1FF]/30 shadow-2xl", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardHeader, { className: "pb-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "flex items-center text-white text-lg", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Shield, { className: "w-6 h-6 mr-3 text-[#00D1FF]" }),
              content.title
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-1", children: ["en", "fr", "es", "de"].map((lang) => /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => handleLanguageChange(lang),
                className: `px-2 py-1 text-xs rounded-md transition-all ${currentLang === lang ? "bg-[#00D1FF] text-black font-semibold" : "bg-white/10 text-white/70 hover:bg-white/20"}`,
                children: lang.toUpperCase()
              },
              lang
            )) })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-500/30 rounded-full px-4 py-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-green-400 text-sm font-medium", children: content.skillBased }) }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-6", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/90 text-base leading-relaxed mb-6", children: content.description }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "grid grid-cols-1 gap-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-sm text-white/80", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 mr-3 text-green-400 flex-shrink-0" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Skill-based gameplay only" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-sm text-white/80", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 mr-3 text-green-400 flex-shrink-0" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "No gambling or random mechanics" })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center text-sm text-white/80", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "w-4 h-4 mr-3 text-green-400 flex-shrink-0" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Fair play and transparency" })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col space-y-3 pt-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Button,
              {
                onClick: handleAccept,
                disabled: accepting,
                className: "w-full bg-gradient-to-r from-[#00D1FF] to-[#7B2BF9] hover:opacity-90 text-white font-semibold py-3",
                children: accepting ? /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2" }),
                  "Processing..."
                ] }) : content.acceptButton
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs(
              Button,
              {
                onClick: () => {
                  console.log("🔗 Learn More button clicked");
                  openTerms();
                },
                variant: "outline",
                className: "w-full border-white/20 text-white hover:bg-white/10",
                children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "w-4 h-4 mr-2" }),
                  content.learnMore
                ]
              }
            )
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-center pt-4 border-t border-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-white/50", children: "© 2025 M1SSION™ – ALL RIGHTS RESERVED – NIYVORA KFT™" }) })
        ] })
      ] })
    }
  ) }) });
};

function InterestSignalsProvider({ children }) {
  reactExports.useEffect(() => {
    let mounted = true;
    const initInterestTracking = async () => {
      try {
        const { useAutoInterestSignals } = await __vitePreload(async () => { const { useAutoInterestSignals } = await import('./useAutoInterestSignals.DFpFZ3QE.js');return { useAutoInterestSignals }},true?__vite__mapDeps([21,2,22,1,3,6,5,7,8,9]):void 0);
        if (mounted && undefined                          === "1") ;
      } catch (error) {
      }
    };
    const timer = setTimeout(initInterestTracking, 1e3);
    return () => {
      mounted = false;
      clearTimeout(timer);
    };
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children });
}

function useWalkthroughState() {
  const { user } = useAuthContext();
  const [state, setState] = reactExports.useState({
    buzzCompleted: false,
    buzzMapCompleted: false,
    buzzStep: 0,
    buzzMapStep: 0,
    loading: true
  });
  reactExports.useEffect(() => {
    if (!user?.id) {
      setState((prev) => ({ ...prev, loading: false }));
      return;
    }
    loadWalkthroughState();
  }, [user?.id]);
  const loadWalkthroughState = async () => {
    if (!user?.id) return;
    try {
      const { data, error } = await supabase.from("profiles").select("buzz_walkthrough_completed, buzz_map_walkthrough_completed, walkthrough_step_buzz, walkthrough_step_buzz_map").eq("id", user.id).single();
      if (error) throw error;
      setState({
        buzzCompleted: data?.buzz_walkthrough_completed || false,
        buzzMapCompleted: data?.buzz_map_walkthrough_completed || false,
        buzzStep: data?.walkthrough_step_buzz || 0,
        buzzMapStep: data?.walkthrough_step_buzz_map || 0,
        loading: false
      });
    } catch (error) {
      console.error("Error loading walkthrough state:", error);
      setState((prev) => ({ ...prev, loading: false }));
    }
  };
  const updateStep = async (type, step) => {
    if (!user?.id) return;
    const column = type === "buzz" ? "walkthrough_step_buzz" : "walkthrough_step_buzz_map";
    try {
      await supabase.from("profiles").update({ [column]: step }).eq("id", user.id);
      setState((prev) => ({
        ...prev,
        [type === "buzz" ? "buzzStep" : "buzzMapStep"]: step
      }));
    } catch (error) {
      console.error("Error updating walkthrough step:", error);
    }
  };
  const completeWalkthrough = async (type) => {
    if (!user?.id) return;
    const completedColumn = type === "buzz" ? "buzz_walkthrough_completed" : "buzz_map_walkthrough_completed";
    const stepColumn = type === "buzz" ? "walkthrough_step_buzz" : "walkthrough_step_buzz_map";
    try {
      await supabase.from("profiles").update({
        [completedColumn]: true,
        [stepColumn]: 5
      }).eq("id", user.id);
      setState((prev) => ({
        ...prev,
        [type === "buzz" ? "buzzCompleted" : "buzzMapCompleted"]: true,
        [type === "buzz" ? "buzzStep" : "buzzMapStep"]: 5
      }));
    } catch (error) {
      console.error("Error completing walkthrough:", error);
    }
  };
  const skipWalkthrough = async (type) => {
    await completeWalkthrough(type);
  };
  return {
    ...state,
    updateStep,
    completeWalkthrough,
    skipWalkthrough,
    refresh: loadWalkthroughState
  };
}

const WALKTHROUGH_STEPS$1 = [
  {
    id: 0,
    title: "Benvenuto nel BUZZ!",
    description: "BUZZ ti permette di generare indizi testuali per trovare il premio M1SSION™. Scopri come funziona!",
    icon: Zap,
    action: null
  },
  {
    id: 1,
    title: "Prova BUZZ GRATIS",
    description: "Premi il tasto BUZZ per ricevere il tuo primo indizio gratuito. Nessun pagamento richiesto per questa demo!",
    icon: Gift,
    action: "demo_buzz"
  },
  {
    id: 2,
    title: "Indizio Ricevuto!",
    description: "Perfetto! Gli indizi BUZZ ti guidano verso il premio. Più BUZZ usi, più ti avvicini al tesoro!",
    icon: Target,
    action: null
  },
  {
    id: 3,
    title: "Come Funziona",
    description: "Ogni BUZZ ha un costo progressivo. Il primo costa €1.99, poi aumenta gradualmente. Più indizi raccogli, più precisa diventa la tua ricerca!",
    icon: Zap,
    action: null
  },
  {
    id: 4,
    title: "Sei Pronto!",
    description: "Hai completato il tutorial BUZZ! Ora puoi iniziare la tua caccia al tesoro M1SSION™.",
    icon: ArrowRight,
    action: "complete"
  }
];
function InteractiveBuzzWalkthrough({ onComplete, onDemoTrigger }) {
  const { buzzStep, updateStep, completeWalkthrough, skipWalkthrough } = useWalkthroughState();
  const [currentStep, setCurrentStep] = reactExports.useState(buzzStep);
  const [showParticles, setShowParticles] = reactExports.useState(false);
  reactExports.useEffect(() => {
    setCurrentStep(buzzStep);
  }, [buzzStep]);
  const handleNext = async () => {
    const nextStep = currentStep + 1;
    if (WALKTHROUGH_STEPS$1[currentStep].action === "demo_buzz") {
      setShowParticles(true);
      onDemoTrigger();
      setTimeout(async () => {
        await updateStep("buzz", nextStep);
        setCurrentStep(nextStep);
        setShowParticles(false);
      }, 1500);
    } else if (WALKTHROUGH_STEPS$1[currentStep].action === "complete") {
      await completeWalkthrough("buzz");
      onComplete();
    } else {
      await updateStep("buzz", nextStep);
      setCurrentStep(nextStep);
    }
  };
  const handleSkip = async () => {
    await skipWalkthrough("buzz");
    onComplete();
  };
  const step = WALKTHROUGH_STEPS$1[currentStep] || WALKTHROUGH_STEPS$1[0];
  const Icon = step?.icon || Zap;
  const progress = (currentStep + 1) / WALKTHROUGH_STEPS$1.length * 100;
  reactExports.useEffect(() => {
    if (!WALKTHROUGH_STEPS$1[currentStep]) {
      setCurrentStep(0);
    }
  }, [currentStep]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      className: "fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",
      children: [
        showParticles && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 pointer-events-none", children: Array.from({ length: 20 }).map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: {
              x: "50%",
              y: "50%",
              scale: 0,
              opacity: 1
            },
            animate: {
              x: `${50 + (Math.random() - 0.5) * 100}%`,
              y: `${50 + (Math.random() - 0.5) * 100}%`,
              scale: Math.random() * 2,
              opacity: 0
            },
            transition: { duration: 1.5, ease: "easeOut" },
            className: "absolute w-2 h-2 bg-[#00D1FF] rounded-full",
            style: {
              boxShadow: "0 0 10px #00D1FF"
            }
          },
          i
        )) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0.9, y: 20 },
            animate: { scale: 1, y: 0 },
            className: "relative w-full max-w-md bg-gradient-to-b from-[#131524] to-black border border-[#00D1FF]/30 rounded-2xl overflow-hidden",
            style: {
              boxShadow: "0 0 40px rgba(0, 209, 255, 0.3)"
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  initial: { width: 0 },
                  animate: { width: `${progress}%` },
                  transition: { duration: 0.3 },
                  className: "h-full bg-gradient-to-r from-[#00D1FF] to-[#FF1CF7]"
                }
              ) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: handleSkip,
                  className: "absolute top-4 right-4 z-10 p-2 hover:bg-white/10 rounded-lg transition-colors",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-5 h-5 text-white/70" })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-8 pt-12", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  initial: { opacity: 0, x: 20 },
                  animate: { opacity: 1, x: 0 },
                  exit: { opacity: 0, x: -20 },
                  className: "text-center space-y-6",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsx(
                      motion.div,
                      {
                        animate: {
                          scale: [1, 1.1, 1],
                          rotate: [0, 5, -5, 0]
                        },
                        transition: {
                          duration: 2,
                          repeat: Infinity,
                          repeatType: "reverse"
                        },
                        className: "inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-[#00D1FF] to-[#FF1CF7] mx-auto",
                        children: /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "w-10 h-10 text-white" })
                      }
                    ),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-orbitron font-bold text-white", children: step.title }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 leading-relaxed", children: step.description }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center gap-2 pt-4", children: WALKTHROUGH_STEPS$1.map((_, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: `w-2 h-2 rounded-full transition-all ${index === currentStep ? "bg-[#00D1FF] w-6" : index < currentStep ? "bg-[#00D1FF]/50" : "bg-white/20"}`
                      },
                      index
                    )) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-3 pt-6", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Button,
                        {
                          onClick: handleSkip,
                          variant: "outline",
                          className: "flex-1 border-white/20 text-white/80 hover:bg-white/10",
                          children: "Salta"
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Button,
                        {
                          onClick: handleNext,
                          className: "flex-1 bg-gradient-to-r from-[#00D1FF] to-[#FF1CF7] hover:opacity-90 text-white font-medium",
                          children: step.action === "demo_buzz" ? "Prova BUZZ" : step.action === "complete" ? "Completa" : "Avanti"
                        }
                      )
                    ] })
                  ]
                },
                currentStep
              ) })
            ]
          }
        )
      ]
    }
  ) });
}

const WALKTHROUGH_STEPS = [
  {
    id: 0,
    title: "Benvenuto in BUZZ MAP!",
    description: "BUZZ MAP genera un'area geografica dove si trova sicuramente il premio M1SSION™. Più precisa è l'area, più vicino sei al tesoro!",
    icon: Map$1,
    action: null
  },
  {
    id: 1,
    title: "Prova BUZZ MAP GRATIS",
    description: "Premi il tasto BUZZ MAP per generare la tua prima area demo (500km). Questa demo è completamente gratuita!",
    icon: Gift,
    action: "demo_buzz_map"
  },
  {
    id: 2,
    title: "Area Generata!",
    description: "Perfetto! L'area generata contiene sicuramente il premio. Il cerchio sulla mappa mostra dove cercare.",
    icon: Target,
    action: null
  },
  {
    id: 3,
    title: "Come Ridurre l'Area",
    description: "Ogni volta che usi BUZZ MAP, il raggio si riduce progressivamente da 500km fino a pochi metri. Più usi BUZZ MAP, più ti avvicini!",
    icon: CircleDot,
    action: null
  },
  {
    id: 4,
    title: "Sei Pronto!",
    description: "Hai completato il tutorial BUZZ MAP! Ora puoi restringere l'area e trovare il tesoro M1SSION™.",
    icon: ArrowRight,
    action: "complete"
  }
];
function InteractiveBuzzMapWalkthrough({ onComplete, onDemoTrigger }) {
  const { buzzMapStep, updateStep, completeWalkthrough, skipWalkthrough } = useWalkthroughState();
  const [currentStep, setCurrentStep] = reactExports.useState(buzzMapStep);
  const [showParticles, setShowParticles] = reactExports.useState(false);
  const [showRadiusAnimation, setShowRadiusAnimation] = reactExports.useState(false);
  reactExports.useEffect(() => {
    setCurrentStep(buzzMapStep);
  }, [buzzMapStep]);
  reactExports.useEffect(() => {
    if (currentStep === 3) {
      setShowRadiusAnimation(true);
    }
  }, [currentStep]);
  const handleNext = async () => {
    const nextStep = currentStep + 1;
    if (WALKTHROUGH_STEPS[currentStep].action === "demo_buzz_map") {
      setShowParticles(true);
      onDemoTrigger();
      setTimeout(async () => {
        await updateStep("buzz_map", nextStep);
        setCurrentStep(nextStep);
        setShowParticles(false);
      }, 1500);
    } else if (WALKTHROUGH_STEPS[currentStep].action === "complete") {
      await completeWalkthrough("buzz_map");
      onComplete();
    } else {
      await updateStep("buzz_map", nextStep);
      setCurrentStep(nextStep);
    }
  };
  const handleSkip = async () => {
    await skipWalkthrough("buzz_map");
    onComplete();
  };
  const step = WALKTHROUGH_STEPS[currentStep] || WALKTHROUGH_STEPS[0];
  const Icon = step?.icon || Map$1;
  const progress = (currentStep + 1) / WALKTHROUGH_STEPS.length * 100;
  reactExports.useEffect(() => {
    if (!WALKTHROUGH_STEPS[currentStep]) {
      setCurrentStep(0);
    }
  }, [currentStep]);
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    motion.div,
    {
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      className: "fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",
      children: [
        showParticles && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 pointer-events-none", children: Array.from({ length: 30 }).map((_, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          motion.div,
          {
            initial: {
              x: "50%",
              y: "50%",
              scale: 0,
              opacity: 1
            },
            animate: {
              x: `${50 + (Math.random() - 0.5) * 100}%`,
              y: `${50 + (Math.random() - 0.5) * 100}%`,
              scale: Math.random() * 2,
              opacity: 0
            },
            transition: { duration: 1.5, ease: "easeOut" },
            className: "absolute w-2 h-2 bg-[#FF1CF7] rounded-full",
            style: {
              boxShadow: "0 0 10px #FF1CF7"
            }
          },
          i
        )) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { scale: 0.9, y: 20 },
            animate: { scale: 1, y: 0 },
            className: "relative w-full max-w-md bg-gradient-to-b from-[#131524] to-black border border-[#FF1CF7]/30 rounded-2xl overflow-hidden",
            style: {
              boxShadow: "0 0 40px rgba(255, 28, 247, 0.3)"
            },
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-white/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.div,
                {
                  initial: { width: 0 },
                  animate: { width: `${progress}%` },
                  transition: { duration: 0.3 },
                  className: "h-full bg-gradient-to-r from-[#FF1CF7] to-[#00D1FF]"
                }
              ) }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: handleSkip,
                  className: "absolute top-4 right-4 z-10 p-2 hover:bg-white/10 rounded-lg transition-colors",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(X$1, { className: "w-5 h-5 text-white/70" })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-8 pt-12", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
                motion.div,
                {
                  initial: { opacity: 0, x: 20 },
                  animate: { opacity: 1, x: 0 },
                  exit: { opacity: 0, x: -20 },
                  className: "text-center space-y-6",
                  children: [
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative inline-flex items-center justify-center mx-auto", children: [
                      showRadiusAnimation && currentStep === 3 && /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          initial: { scale: 2, opacity: 0.5 },
                          animate: { scale: 0.8, opacity: 0 },
                          transition: {
                            duration: 2,
                            repeat: Infinity,
                            repeatType: "loop"
                          },
                          className: "absolute w-32 h-32 rounded-full border-2 border-[#FF1CF7]"
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        motion.div,
                        {
                          animate: {
                            scale: [1, 1.1, 1],
                            rotate: [0, 5, -5, 0]
                          },
                          transition: {
                            duration: 2,
                            repeat: Infinity,
                            repeatType: "reverse"
                          },
                          className: "inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-[#FF1CF7] to-[#00D1FF]",
                          children: /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "w-10 h-10 text-white" })
                        }
                      )
                    ] }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-2xl font-orbitron font-bold text-white", children: step.title }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 leading-relaxed", children: step.description }),
                    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-center gap-2 pt-4", children: WALKTHROUGH_STEPS.map((_, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                      "div",
                      {
                        className: `w-2 h-2 rounded-full transition-all ${index === currentStep ? "bg-[#FF1CF7] w-6" : index < currentStep ? "bg-[#FF1CF7]/50" : "bg-white/20"}`
                      },
                      index
                    )) }),
                    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-3 pt-6", children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Button,
                        {
                          onClick: handleSkip,
                          variant: "outline",
                          className: "flex-1 border-white/20 text-white/80 hover:bg-white/10",
                          children: "Salta"
                        }
                      ),
                      /* @__PURE__ */ jsxRuntimeExports.jsx(
                        Button,
                        {
                          onClick: handleNext,
                          className: "flex-1 bg-gradient-to-r from-[#FF1CF7] to-[#00D1FF] hover:opacity-90 text-white font-medium",
                          children: step.action === "demo_buzz_map" ? "Prova BUZZ MAP" : step.action === "complete" ? "Completa" : "Avanti"
                        }
                      )
                    ] })
                  ]
                },
                currentStep
              ) })
            ]
          }
        )
      ]
    }
  ) });
}

function WalkthroughManager({ onBuzzDemo, onBuzzMapDemo }) {
  const [location] = useLocation();
  const { user, isAuthenticated } = useAuthContext();
  const { buzzCompleted, buzzMapCompleted, loading, completeWalkthrough, refresh } = useWalkthroughState();
  const [activeWalkthrough, setActiveWalkthrough] = reactExports.useState(null);
  const [hasCheckedRoute, setHasCheckedRoute] = reactExports.useState(false);
  reactExports.useEffect(() => {
    if (!isAuthenticated || !user || loading) {
      setHasCheckedRoute(false);
      return;
    }
    if (location === "/buzz" && !buzzCompleted && !hasCheckedRoute) {
      setActiveWalkthrough("buzz");
      setHasCheckedRoute(true);
    } else if (location === "/map" && !buzzMapCompleted && !hasCheckedRoute) {
      setActiveWalkthrough("buzz_map");
      setHasCheckedRoute(true);
    } else if (location !== "/buzz" && location !== "/map") {
      setHasCheckedRoute(false);
    }
  }, [location, buzzCompleted, buzzMapCompleted, isAuthenticated, user, loading, hasCheckedRoute]);
  const handleBuzzComplete = async () => {
    try {
      await completeWalkthrough("buzz");
      await refresh?.();
    } finally {
      setActiveWalkthrough(null);
      setHasCheckedRoute(true);
    }
  };
  const handleBuzzMapComplete = async () => {
    try {
      await completeWalkthrough("buzz_map");
      await refresh?.();
    } finally {
      setActiveWalkthrough(null);
      setHasCheckedRoute(true);
    }
  };
  const handleBuzzDemoTrigger = () => {
    if (onBuzzDemo) {
      onBuzzDemo();
    }
  };
  const handleBuzzMapDemoTrigger = () => {
    if (onBuzzMapDemo) {
      onBuzzMapDemo();
    }
  };
  if (!isAuthenticated || loading) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    activeWalkthrough === "buzz" && /* @__PURE__ */ jsxRuntimeExports.jsx(
      InteractiveBuzzWalkthrough,
      {
        onComplete: handleBuzzComplete,
        onDemoTrigger: handleBuzzDemoTrigger
      }
    ),
    activeWalkthrough === "buzz_map" && /* @__PURE__ */ jsxRuntimeExports.jsx(
      InteractiveBuzzMapWalkthrough,
      {
        onComplete: handleBuzzMapComplete,
        onDemoTrigger: handleBuzzMapDemoTrigger
      }
    )
  ] });
}

const DNAModal = ({ isOpen, onComplete, onSkip }) => {
  const [step, setStep] = reactExports.useState(0);
  const [answers, setAnswers] = reactExports.useState({});
  const currentQuestion = DNA_QUESTIONS[step];
  const isLastQuestion = step === DNA_QUESTIONS.length - 1;
  const progress = (step + 1) / DNA_QUESTIONS.length * 100;
  const getCurrentScores = () => {
    const scores = getDefaultScores();
    Object.entries(answers).forEach(([questionId, value]) => {
      const question = DNA_QUESTIONS.find((q) => q.id === questionId);
      if (question) {
        scores[question.attribute] = value;
      }
    });
    return scores;
  };
  const currentScores = getCurrentScores();
  const currentArchetype = calculateArchetype(currentScores);
  const archetypeConfig = ARCHETYPE_CONFIGS[currentArchetype];
  const handleAnswer = (value) => {
    const newAnswers = { ...answers, [currentQuestion.id]: value };
    setAnswers(newAnswers);
    if (isLastQuestion) {
      const finalScores = getDefaultScores();
      DNA_QUESTIONS.forEach((q) => {
        if (newAnswers[q.id] !== void 0) {
          finalScores[q.attribute] = newAnswers[q.id];
        }
      });
      setTimeout(() => {
        onComplete(finalScores);
      }, 300);
    } else {
      setTimeout(() => {
        setStep(step + 1);
      }, 300);
    }
  };
  const handleSkip = () => {
    onSkip();
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: () => {
  }, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    DialogContent,
    {
      className: "max-w-2xl bg-black/95 border-2 border-cyan-500/30 backdrop-blur-xl",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(DialogHeader, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { className: "text-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, y: -20 },
            animate: { opacity: 1, y: 0 },
            className: "space-y-3",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-3xl font-black bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent", children: "M1SSION DNA™" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-white/60 font-normal", children: "Identità Evolutiva dell'Agente" })
            ]
          }
        ) }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Progress, { value: progress, className: "h-2 bg-white/10" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-white/50 text-center", children: [
            "Domanda ",
            step + 1,
            " di ",
            DNA_QUESTIONS.length
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { mode: "wait", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, x: 20 },
            animate: { opacity: 1, x: 0 },
            exit: { opacity: 0, x: -20 },
            className: "space-y-6 py-4",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-lg text-white/90 font-medium mb-2", children: currentQuestion.question }),
                /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { variant: "outline", className: "text-xs text-cyan-400 border-cyan-400/30", children: currentQuestion.attribute.toUpperCase() })
              ] }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: currentQuestion.options.map((option, idx) => /* @__PURE__ */ jsxRuntimeExports.jsx(
                motion.button,
                {
                  onClick: () => handleAnswer(option.value),
                  className: "w-full p-4 rounded-lg bg-white/5 border border-white/10 hover:border-cyan-400/50 hover:bg-cyan-500/10 transition-all text-left group",
                  whileHover: { scale: 1.02 },
                  whileTap: { scale: 0.98 },
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-white/80 group-hover:text-white transition-colors", children: option.label })
                },
                idx
              )) })
            ]
          },
          currentQuestion.id
        ) }),
        Object.keys(answers).length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs(
          motion.div,
          {
            initial: { opacity: 0, scale: 0.9 },
            animate: { opacity: 1, scale: 1 },
            className: "mt-6 p-4 rounded-lg bg-gradient-to-r from-black/40 to-black/20 border border-white/10",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/50 mb-2 text-center", children: "Preview Archetipo" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-3", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-3xl", children: archetypeConfig.icon }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm font-bold text-white", children: archetypeConfig.nameIt }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-white/60", children: archetypeConfig.name })
                ] })
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex gap-3 mt-6", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            variant: "outline",
            onClick: handleSkip,
            className: "flex-1 border-white/20 hover:bg-white/10",
            children: "Più tardi"
          }
        ) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 rounded-lg pointer-events-none", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute inset-0 rounded-lg bg-gradient-to-r from-cyan-500/20 via-blue-500/20 to-purple-600/20 opacity-0 animate-pulse" }) })
      ]
    }
  ) });
};

const DNAManager = () => {
  const { isAuthenticated } = useUnifiedAuth();
  const { needsOnboarding, isLoading, saveDNA, recordOnboardingShown, dnaProfile } = useDNA();
  reactExports.useEffect(() => {
    if (dnaProfile) {
      const config = ARCHETYPE_CONFIGS[dnaProfile.archetype];
      document.documentElement.style.setProperty("--dna-accent", config.accentVar);
      console.info("[DNA] Theme applied", {
        archetype: dnaProfile.archetype,
        color: config.color
      });
    }
  }, [dnaProfile]);
  const handleComplete = async (scores) => {
    const success = await saveDNA(scores);
    if (success && dnaProfile) {
      const config = ARCHETYPE_CONFIGS[dnaProfile.archetype];
      ue$1.success("DNA calibrato con successo!", {
        description: `Sei un ${config.nameIt} ${config.icon}`
      });
    } else {
      ue$1.error("Errore durante il salvataggio del DNA");
    }
  };
  const handleSkip = () => {
    recordOnboardingShown();
    ue$1.info("Calibrazione DNA rimandata", {
      description: "Riapparirà domani all'apertura dell'app"
    });
  };
  if (!isAuthenticated || isLoading || !needsOnboarding) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    DNAModal,
    {
      isOpen: needsOnboarding,
      onComplete: handleComplete,
      onSkip: handleSkip
    }
  );
};

const CookieBanner = ({
  isVisible,
  onAcceptAll,
  onRejectAll,
  onManagePreferences
}) => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(AnimatePresence, { children: isVisible && /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.div,
    {
      initial: { y: 100, opacity: 0 },
      animate: { y: 0, opacity: 1 },
      exit: { y: 100, opacity: 0 },
      transition: { duration: 0.3, ease: "easeOut" },
      className: "fixed bottom-0 left-0 right-0 z-[60] pb-safe",
      role: "dialog",
      "aria-labelledby": "cookie-banner-title",
      "aria-describedby": "cookie-banner-description",
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "div",
        {
          className: "relative mx-4 mb-4 p-6 shadow-2xl overflow-hidden rounded-[24px]",
          style: {
            background: "rgba(0, 0, 0, 0.05)",
            backdropFilter: "blur(40px)",
            WebkitBackdropFilter: "blur(40px)",
            border: "1px solid rgba(255, 255, 255, 0.1)",
            boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
          },
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-4", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0 w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Cookie, { className: "w-6 h-6 text-primary" }) }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-4", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "h3",
                    {
                      id: "cookie-banner-title",
                      className: "text-lg font-bold text-foreground mb-2",
                      children: "Cookie & Privacy"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    "p",
                    {
                      id: "cookie-banner-description",
                      className: "text-sm text-muted-foreground leading-relaxed",
                      children: "Utilizziamo cookie tecnici necessari per il funzionamento del sito e, con il tuo consenso, cookie di analisi e marketing per migliorare l'esperienza. Puoi modificare le tue preferenze in qualsiasi momento."
                    }
                  )
                ] }),
                /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-3", children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: onAcceptAll,
                      className: "min-h-[44px] touch-manipulation font-semibold",
                      "aria-label": "Accetta tutti i cookie",
                      children: "Accetta tutto"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: onRejectAll,
                      variant: "outline",
                      className: "min-h-[44px] touch-manipulation",
                      "aria-label": "Rifiuta cookie non necessari",
                      children: "Rifiuta"
                    }
                  ),
                  /* @__PURE__ */ jsxRuntimeExports.jsx(
                    Button,
                    {
                      onClick: onManagePreferences,
                      variant: "ghost",
                      className: "min-h-[44px] touch-manipulation text-primary hover:text-primary/80",
                      "aria-label": "Gestisci preferenze cookie",
                      children: "Gestisci preferenze"
                    }
                  )
                ] })
              ] })
            ] })
          ]
        }
      )
    }
  ) });
};

const DEFAULT_PREFERENCES = {
  necessary: true,
  // Always true, can't be disabled
  analytics: false,
  marketing: false,
  personalization: false
};
const CONSENT_STORAGE_KEY = "m1:cookie_consent:v1";
const CONSENT_TTL_DAYS = 180;

const PreferencesModal = ({
  isOpen,
  onClose,
  onSave,
  initialPreferences = DEFAULT_PREFERENCES
}) => {
  const [preferences, setPreferences] = reactExports.useState(initialPreferences);
  const handleSave = () => {
    onSave(preferences);
    onClose();
  };
  const togglePreference = (key) => {
    if (key === "necessary") return;
    setPreferences((prev) => ({
      ...prev,
      [key]: !prev[key]
    }));
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(Dialog, { open: isOpen, onOpenChange: onClose, children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
    DialogContent,
    {
      className: "max-w-2xl max-h-[90vh] overflow-y-auto z-[65] relative rounded-[24px]",
      style: {
        background: "rgba(0, 0, 0, 0.05)",
        backdropFilter: "blur(40px)",
        WebkitBackdropFilter: "blur(40px)",
        border: "1px solid rgba(255, 255, 255, 0.1)",
        boxShadow: "0 8px 32px rgba(0, 0, 0, 0.2), inset 0 2px 3px rgba(255, 255, 255, 0.05)"
      },
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-amber-500 opacity-90" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(DialogHeader, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(DialogTitle, { children: "Gestisci preferenze cookie" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(DialogDescription, { children: "Personalizza le tue preferenze sui cookie. I cookie necessari sono sempre attivi." })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-6 py-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "necessary", className: "text-base font-semibold", children: "Cookie necessari" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Essenziali per il funzionamento del sito (autenticazione, sessioni, sicurezza). Sempre attivi." })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Switch,
              {
                id: "necessary",
                checked: preferences.necessary,
                disabled: true,
                "aria-label": "Cookie necessari sempre attivi"
              }
            )
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Separator$1, {}),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "analytics", className: "text-base font-semibold", children: "Cookie di analisi" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Aiutano a capire come i visitatori interagiscono con il sito, raccogliendo informazioni anonime su pagine visitate e performance." })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Switch,
              {
                id: "analytics",
                checked: preferences.analytics,
                onCheckedChange: () => togglePreference("analytics"),
                "aria-label": "Attiva o disattiva cookie di analisi"
              }
            )
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Separator$1, {}),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "marketing", className: "text-base font-semibold", children: "Cookie di marketing" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Utilizzati per mostrare pubblicità personalizzate e misurare l'efficacia delle campagne." })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Switch,
              {
                id: "marketing",
                checked: preferences.marketing,
                onCheckedChange: () => togglePreference("marketing"),
                "aria-label": "Attiva o disattiva cookie di marketing"
              }
            )
          ] }) }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Separator$1, {}),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start justify-between gap-4", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 space-y-1", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Label$1, { htmlFor: "personalization", className: "text-base font-semibold", children: "Cookie di personalizzazione" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Memorizzano preferenze come lingua, layout e altre impostazioni per migliorare l'esperienza." })
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              Switch,
              {
                id: "personalization",
                checked: preferences.personalization,
                onCheckedChange: () => togglePreference("personalization"),
                "aria-label": "Attiva o disattiva cookie di personalizzazione"
              }
            )
          ] }) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col sm:flex-row gap-3 pt-4 border-t", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: handleSave,
              className: "flex-1 min-h-[44px]",
              children: "Salva preferenze"
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            Button,
            {
              onClick: onClose,
              variant: "outline",
              className: "flex-1 min-h-[44px]",
              children: "Annulla"
            }
          )
        ] })
      ]
    }
  ) });
};

function getStoredConsent() {
  try {
    const stored = localStorage.getItem(CONSENT_STORAGE_KEY);
    if (!stored) return null;
    const data = JSON.parse(stored);
    if (CONSENT_TTL_DAYS) {
      const timestamp = new Date(data.timestamp);
      const now = /* @__PURE__ */ new Date();
      const daysSince = (now.getTime() - timestamp.getTime()) / (1e3 * 60 * 60 * 24);
      if (daysSince > CONSENT_TTL_DAYS) {
        localStorage.removeItem(CONSENT_STORAGE_KEY);
        return null;
      }
    }
    return data;
  } catch (error) {
    console.error("[Consent] Failed to read stored consent:", error);
    return null;
  }
}
function saveConsent(status, preferences) {
  try {
    const data = {
      status,
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      preferences: status === "granular" ? preferences : void 0,
      version: "1.0"
    };
    localStorage.setItem(CONSENT_STORAGE_KEY, JSON.stringify(data));
    applyConsentToScripts(data);
    console.info("[Consent] Saved:", data);
  } catch (error) {
    console.error("[Consent] Failed to save consent:", error);
  }
}
function applyConsentToScripts(consent) {
  const shouldLoadAnalytics = consent.status === "accepted" || consent.status === "granular" && consent.preferences?.analytics;
  const shouldLoadMarketing = consent.status === "accepted" || consent.status === "granular" && consent.preferences?.marketing;
  if (shouldLoadAnalytics) {
    loadAnalyticsScripts();
  }
  if (shouldLoadMarketing) {
    loadMarketingScripts();
  }
  console.info("[Consent] Scripts applied:", {
    analytics: shouldLoadAnalytics,
    marketing: shouldLoadMarketing
  });
}
function loadAnalyticsScripts() {
  console.info("[Consent] Analytics scripts loaded");
}
function loadMarketingScripts() {
  console.info("[Consent] Marketing scripts loaded");
}
function getEffectivePreferences(consent) {
  if (!consent) return DEFAULT_PREFERENCES;
  if (consent.status === "accepted") {
    return {
      necessary: true,
      analytics: true,
      marketing: true,
      personalization: true
    };
  }
  if (consent.status === "rejected") {
    return DEFAULT_PREFERENCES;
  }
  if (consent.status === "granular" && consent.preferences) {
    return {
      ...DEFAULT_PREFERENCES,
      ...consent.preferences,
      necessary: true
      // Always true
    };
  }
  return DEFAULT_PREFERENCES;
}

function useConsentSync(onConsentChange) {
  const { user } = useUnifiedAuth();
  reactExports.useEffect(() => {
    if (!user?.id) return;
    const syncFromRemote = async () => {
      try {
        const { data, error } = await supabase.from("profiles").select("cookie_consent").eq("id", user.id).single();
        if (error) {
          console.error("[Consent Sync] Failed to fetch remote consent:", error);
          return;
        }
        const rawData = data;
        const remoteConsent = rawData?.cookie_consent ? rawData.cookie_consent : null;
        if (!remoteConsent) {
          console.info("[Consent Sync] No remote consent found");
          return;
        }
        const localConsent = getStoredConsent();
        if (!localConsent || new Date(remoteConsent.timestamp) > new Date(localConsent.timestamp)) {
          console.info("[Consent Sync] Applying remote consent (newer):", remoteConsent);
          if (remoteConsent.status === "granular" && remoteConsent.preferences) {
            saveConsent("granular", remoteConsent.preferences);
          } else {
            saveConsent(remoteConsent.status);
          }
          onConsentChange?.(remoteConsent);
        } else {
          console.info("[Consent Sync] Local consent is newer, keeping it");
        }
      } catch (error) {
        console.error("[Consent Sync] Sync error:", error);
      }
    };
    syncFromRemote();
  }, [user?.id, onConsentChange]);
  return {
    /**
     * Save consent both locally and remotely
     */
    syncConsent: async (consent) => {
      if (!user?.id) {
        console.info("[Consent Sync] Not authenticated, skipping remote save");
        return;
      }
      try {
        const { error } = await supabase.from("profiles").update({ cookie_consent: consent }).eq("id", user.id);
        if (error) {
          console.error("[Consent Sync] Failed to save remote consent:", error);
        } else {
          console.info("[Consent Sync] Saved to remote:", consent);
        }
      } catch (error) {
        console.error("[Consent Sync] Remote save error:", error);
      }
    }
  };
}

const CookieConsentManager = () => {
  const [consent, setConsent] = reactExports.useState(null);
  const [showBanner, setShowBanner] = reactExports.useState(false);
  const [showPreferences, setShowPreferences] = reactExports.useState(false);
  const [isInitialized, setIsInitialized] = reactExports.useState(false);
  const { syncConsent } = useConsentSync((remoteConsent) => {
    setConsent(remoteConsent);
  });
  reactExports.useEffect(() => {
    const initConsent = async () => {
      await new Promise((resolve) => {
        if (typeof requestIdleCallback !== "undefined") {
          requestIdleCallback(resolve);
        } else {
          setTimeout(resolve, 500);
        }
      });
      const stored = getStoredConsent();
      setConsent(stored);
      setIsInitialized(true);
      if (!stored) {
        setShowBanner(true);
      }
    };
    initConsent();
  }, []);
  reactExports.useEffect(() => {
    if (!isInitialized) return;
    window.__consent = {
      open: () => {
        setShowPreferences(true);
      },
      getConsent: () => consent,
      getPreferences: () => getEffectivePreferences(consent)
    };
    console.info("[Consent] Global API exposed: window.__consent");
    return () => {
      delete window.__consent;
    };
  }, [isInitialized, consent]);
  const handleAcceptAll = reactExports.useCallback(async () => {
    const newConsent = {
      status: "accepted",
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      version: "1.0"
    };
    saveConsent("accepted");
    setConsent(newConsent);
    setShowBanner(false);
    await syncConsent(newConsent);
  }, [syncConsent]);
  const handleRejectAll = reactExports.useCallback(async () => {
    const newConsent = {
      status: "rejected",
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      version: "1.0"
    };
    saveConsent("rejected");
    setConsent(newConsent);
    setShowBanner(false);
    await syncConsent(newConsent);
  }, [syncConsent]);
  const handleManagePreferences = reactExports.useCallback(() => {
    setShowBanner(false);
    setShowPreferences(true);
  }, []);
  const handleSavePreferences = reactExports.useCallback(async (preferences) => {
    const newConsent = {
      status: "granular",
      timestamp: (/* @__PURE__ */ new Date()).toISOString(),
      preferences,
      version: "1.0"
    };
    saveConsent("granular", preferences);
    setConsent(newConsent);
    setShowPreferences(false);
    await syncConsent(newConsent);
  }, [syncConsent]);
  if (!isInitialized) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      CookieBanner,
      {
        isVisible: showBanner,
        onAcceptAll: handleAcceptAll,
        onRejectAll: handleRejectAll,
        onManagePreferences: handleManagePreferences
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      PreferencesModal,
      {
        isOpen: showPreferences,
        onClose: () => setShowPreferences(false),
        onSave: handleSavePreferences,
        initialPreferences: consent?.preferences
      }
    )
  ] });
};

const SEED_DOCUMENTS = [
  {
    slug: "mission-buzz",
    title: "BUZZ — definizione e regole base",
    body: `BUZZ è l'azione di scansione attiva che sblocca indizi o aree. Il costo e il raggio sono dinamici in base al tier e alla progressione. Il BUZZ può essere lanciato anche fuori dalla mappa. Il primo BUZZ Map ha condizioni speciali documentate a parte.`,
    tags: ["buzz", "regole", "onboarding"]
  },
  {
    slug: "mission-buzz-map",
    title: "BUZZ Map — come funziona",
    body: `BUZZ Map è l'interazione contestuale dalla mappa: l'utente vede overlay e marker, e può lanciare il BUZZ direttamente dalla mappa. Differenza chiave: BUZZ = azione singola, BUZZ Map = azione dalla mappa con feedback visivo. Primo BUZZ Map: raggio 500 km, prezzo 4,99€ (se confermato nelle policy attuali).`,
    tags: ["buzz-map", "mappa", "onboarding"]
  },
  {
    slug: "mission-final-shot",
    title: "Final Shot — intento finale",
    body: `Final Shot è il tentativo finale di claim del premio secondo regole antifrode (posizione, finestra temporale, limiti per tier). Prima del Final Shot viene consigliato rivedere gli indizi raccolti. I dettagli vanno aggiornati con le policy ufficiali.`,
    tags: ["final-shot", "regole"]
  },
  {
    slug: "mission-tiers",
    title: "Tiers e limiti",
    body: `Free/Silver/Gold/Black: limiti mensili di BUZZ, costo/raggio e vantaggi accessori. L'assistente deve sempre rispettare i limiti del tier corrente.`,
    tags: ["tiers", "pricing"]
  }
];

async function populateKnowledgeBase(options = {}) {
  const docs = options.documents ?? SEED_DOCUMENTS;
  try {
    console.log("📚 [NORAH KB] Popolamento Knowledge Base in corso...");
    console.log(`📄 [NORAH KB] Documenti da processare: ${docs.length}`);
    const { data, error } = await supabase.functions.invoke("norah-kb-upsert", {
      body: { documents: docs }
    });
    if (error) {
      console.error("❌ [NORAH KB] Errore edge function:", error);
      throw new Error(`KB upsert failed: ${error.message || JSON.stringify(error)}`);
    }
    console.log("✅ [NORAH KB] Knowledge Base popolata:", data);
    console.log(`📊 [NORAH KB] Processati: ${data?.processed || 0}/${data?.total || docs.length}`);
    if (data?.results) {
      data.results.forEach((r) => {
        const status = r.status === "ok" ? "✅" : "❌";
        console.log(`${status} [NORAH KB] ${r.slug}: ${r.chunks || 0} chunks`);
      });
    }
    return data;
  } catch (error) {
    console.error("❌ [NORAH KB] Errore popolamento:", error);
    throw error;
  }
}
if (typeof window !== "undefined") {
  window.__populateKB__ = populateKnowledgeBase;
  console.log("✅ window.__populateKB__ disponibile");
}

const useNorahProactiveListener = () => {
  const { user } = useAuthContext();
  const [, setLocation] = useLocation();
  reactExports.useEffect(() => {
    if (!user?.id || !("serviceWorker" in navigator)) return;
    console.log("🎧 [NORAH PROACTIVE] Listener attivo");
    const handleMessage = (event) => {
      if (event.data?.type === "norah_proactive") {
        const { notification_type, title, body, deepLink } = event.data;
        console.log("📬 [NORAH PROACTIVE] Notifica ricevuta:", notification_type);
        ue$1(title, {
          description: body,
          duration: 8e3,
          action: {
            label: "Apri",
            onClick: () => {
              if (deepLink) {
                setLocation(deepLink);
              }
            }
          },
          style: {
            background: "linear-gradient(135deg, #00FFFF 0%, #0084FF 100%)",
            color: "white",
            fontWeight: "bold"
          }
        });
        if (event.data.notification_id) {
          supabase.rpc("mark_norah_notification_clicked", {
            p_notification_id: event.data.notification_id
          }).then(() => {
            console.log("✓ Notification marked as clicked");
          });
        }
      }
    };
    navigator.serviceWorker.addEventListener("message", handleMessage);
    return () => {
      navigator.serviceWorker.removeEventListener("message", handleMessage);
      console.log("🔇 [NORAH PROACTIVE] Listener disattivato");
    };
  }, [user?.id, setLocation]);
};

const NorahProactiveManager = () => {
  useNorahProactiveListener();
  return null;
};

const useActiveMissionEnrollment = () => {
  const [isEnrolled] = reactExports.useState(false);
  const [isLoading] = reactExports.useState(false);
  return { isEnrolled, isLoading };
};

const StartMissionButton = () => {
  const { user } = useAuthContext();
  const [, setLocation] = useLocation();
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const { isEnrolled, isLoading: enrollmentLoading } = useActiveMissionEnrollment();
  if (enrollmentLoading || isEnrolled) return null;
  const handleStartMission = async () => {
    setIsLoading(true);
    try {
      let currentUser = user;
      if (!currentUser) {
        console.log("🔐 [START-MISSION] User not authenticated, signing in anonymously...");
        const { data, error } = await supabase.auth.signInAnonymously();
        if (error) {
          console.error("❌ [START-MISSION] Anonymous sign-in error:", error);
          ue$1.error("Ops, riprova tra poco.", {
            description: "Impossibile autenticarti automaticamente."
          });
          setIsLoading(false);
          return;
        }
        currentUser = data?.user ?? null;
        console.log("✅ [START-MISSION] Anonymous sign-in success:", currentUser?.id);
      }
      if (!currentUser) {
        ue$1.error("Ops, riprova tra poco.", {
          description: "Sessione non valida."
        });
        setIsLoading(false);
        return;
      }
      console.log("🚀 [START-MISSION] Calling enroll-mission-of-the-month...");
      const { data: sessionData } = await supabase.auth.getSession();
      const token = sessionData?.session?.access_token;
      if (!token) {
        ue$1.error("Ops, riprova tra poco.", {
          description: "Token di autenticazione non disponibile."
        });
        setIsLoading(false);
        return;
      }
      const response = await supabase.functions.invoke("enroll-mission-of-the-month", {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });
      if (response.error) {
        console.error("❌ [START-MISSION] Edge function error:", response.error);
        ue$1.error("Ops, riprova tra poco.", {
          description: "Impossibile iscriverti alla missione."
        });
        setIsLoading(false);
        return;
      }
      const result = response.data;
      if (!result?.ok) {
        ue$1.error("Ops, riprova tra poco.", {
          description: result?.error || "Errore sconosciuto."
        });
        setIsLoading(false);
        return;
      }
      console.log("✅ [START-MISSION] Enrollment success:", result.mission_id);
      window.dispatchEvent(new CustomEvent("mission:enrolled", { detail: { missionId: result.mission_id } }));
      try {
        localStorage.setItem("m1_mission_enrolled", "1");
      } catch (_) {
      }
      ue$1.success("Sei dentro! Missione del mese attivata.", {
        description: "Preparati per l'avventura! 🎯"
      });
      setTimeout(() => {
        setLocation("/map-3d-tiler");
      }, 800);
    } catch (err) {
      console.error("❌ [START-MISSION] Unexpected error:", err);
      ue$1.error("Ops, riprova tra poco.", {
        description: "Errore imprevisto."
      });
    } finally {
      setIsLoading(false);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    motion.button,
    {
      onClick: handleStartMission,
      disabled: isLoading,
      initial: { opacity: 0, y: -10 },
      animate: { opacity: 1, y: 0 },
      className: "inline-flex items-center justify-center px-3 py-1 rounded-full bg-[#00D1FF]/10 border border-[#00D1FF]/30 hover:bg-[#00D1FF]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed",
      whileHover: !isLoading ? { scale: 1.05 } : {},
      whileTap: !isLoading ? { scale: 0.95 } : {},
      children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-3 w-3 border border-[#00D1FF] border-t-transparent mr-2" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-orbitron font-semibold text-[#00D1FF] uppercase tracking-wider", children: "Caricamento..." })
      ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs font-orbitron font-semibold text-[#00D1FF] uppercase tracking-wider", children: "START M1SSION" })
    }
  );
};

const MissionBadgeInjector = () => {
  const { isEnrolled, isLoading } = useActiveMissionEnrollment();
  const [portalReady, setPortalReady] = reactExports.useState(false);
  const [enrolledOverride, setEnrolledOverride] = reactExports.useState(false);
  reactExports.useEffect(() => {
    try {
      const persisted = localStorage.getItem("m1_mission_enrolled") === "1";
      if (persisted) setEnrolledOverride(true);
    } catch (_) {
    }
  }, []);
  reactExports.useEffect(() => {
    if (isLoading) return;
    let retryCount = 0;
    const maxRetries = 200;
    const retryDelay = 100;
    let headerObserver = null;
    let globalObserver = null;
    let badgeNodeRef = null;
    const getHeaderContext = () => {
      let headerH1 = document.getElementById("m1-home-title");
      if (!headerH1) {
        headerH1 = document.querySelector('h1[aria-label*="Centro di Comando Agente"]') || document.querySelector('h1[aria-label*="M1SSION"]') || Array.from(document.querySelectorAll("h1")).find((h) => h.textContent?.includes("M1SSION"));
        if (headerH1) {
          headerH1.id = "m1-home-title";
          headerH1.setAttribute("data-m1-anchor", "home-title");
        }
      }
      const headerWrapper = headerH1?.closest("div");
      const subtitle = headerWrapper ? Array.from(headerWrapper.querySelectorAll("p, span, div")).find((el) => el.textContent?.includes("Centro di Comando Agente")) : null;
      return { headerH1, headerWrapper, subtitle };
    };
    const ensureBadgePosition = () => {
      const { headerH1, headerWrapper, subtitle } = getHeaderContext();
      if (!headerH1 || !headerWrapper) return false;
      if (!badgeNodeRef) {
        badgeNodeRef = document.getElementById("mission-status-badge-portal");
        if (!badgeNodeRef) {
          badgeNodeRef = document.createElement("div");
          badgeNodeRef.id = "mission-status-badge-portal";
          badgeNodeRef.setAttribute("data-anchor", "m1-header-badge");
          badgeNodeRef.className = "flex justify-center my-3";
          badgeNodeRef.setAttribute("data-persistent", "true");
        }
      }
      const isCorrectlyPositioned = subtitle ? badgeNodeRef.nextSibling === subtitle && badgeNodeRef.parentElement === headerWrapper : badgeNodeRef.previousElementSibling === headerH1 && badgeNodeRef.parentElement === headerWrapper;
      if (!isCorrectlyPositioned) {
        if (subtitle) {
          headerWrapper.insertBefore(badgeNodeRef, subtitle);
        } else {
          headerH1.insertAdjacentElement("afterend", badgeNodeRef);
        }
      }
      setPortalReady(true);
      return true;
    };
    const findAndInject = () => {
      if (ensureBadgePosition()) {
        const { headerWrapper } = getHeaderContext();
        if (headerWrapper && !headerObserver) {
          headerObserver = new MutationObserver(() => {
            requestAnimationFrame(() => ensureBadgePosition());
          });
          headerObserver.observe(headerWrapper, { childList: true, subtree: false });
        }
        if (!globalObserver) {
          globalObserver = new MutationObserver(() => {
            if (badgeNodeRef && !document.body.contains(badgeNodeRef)) {
              requestAnimationFrame(() => ensureBadgePosition());
            }
          });
          globalObserver.observe(document.body, { childList: true, subtree: true });
        }
        return;
      }
      if (retryCount < maxRetries) {
        retryCount++;
        setTimeout(findAndInject, retryDelay);
      } else {
        console.warn("[MissionBadgeInjector] Header not found after max retries");
      }
    };
    findAndInject();
    const onRouteChange = () => {
      requestAnimationFrame(() => {
        setPortalReady(false);
        badgeNodeRef = null;
        setTimeout(findAndInject, 50);
      });
    };
    const onPageShow = () => requestAnimationFrame(findAndInject);
    const onVisibility = () => {
      if (document.visibilityState === "visible") {
        requestAnimationFrame(findAndInject);
      }
    };
    const onFocus = () => requestAnimationFrame(findAndInject);
    const homeCheckInterval = window.setInterval(() => {
      try {
        if (window.location.pathname === "/home") {
          ensureBadgePosition();
        }
      } catch {
      }
    }, 800);
    window.addEventListener("pageshow", onPageShow);
    window.addEventListener("popstate", onRouteChange);
    window.addEventListener("visibilitychange", onVisibility);
    window.addEventListener("focus", onFocus);
    return () => {
      headerObserver?.disconnect();
      globalObserver?.disconnect();
      window.removeEventListener("pageshow", onPageShow);
      window.removeEventListener("popstate", onRouteChange);
      window.removeEventListener("visibilitychange", onVisibility);
      window.removeEventListener("focus", onFocus);
      window.clearInterval(homeCheckInterval);
      badgeNodeRef = null;
    };
  }, [isLoading]);
  reactExports.useEffect(() => {
    const onEnrolled = () => {
      console.log("✅ [MissionBadgeInjector] mission:enrolled event received");
      setEnrolledOverride(true);
      setPortalReady(true);
    };
    window.addEventListener("mission:enrolled", onEnrolled);
    return () => window.removeEventListener("mission:enrolled", onEnrolled);
  }, []);
  if (isLoading || !portalReady) return null;
  const portalTarget = document.getElementById("mission-status-badge-portal");
  if (!portalTarget) return null;
  return reactDomExports.createPortal(
    isEnrolled || enrolledOverride ? /* @__PURE__ */ jsxRuntimeExports.jsx(
      motion.div,
      {
        initial: { opacity: 0, y: -10 },
        animate: { opacity: 1, y: 0 },
        className: "inline-flex items-center justify-center px-3 py-1 rounded-full border border-emerald-400/40 bg-gradient-to-r from-emerald-600/15 to-fuchsia-600/15",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "span",
          {
            className: "text-xs font-orbitron font-semibold uppercase tracking-wider bg-gradient-to-r from-emerald-400 to-fuchsia-400 bg-clip-text text-transparent",
            children: "ON M1SSION"
          }
        )
      }
    ) : /* @__PURE__ */ jsxRuntimeExports.jsx(StartMissionButton, {}),
    portalTarget
  );
};

function listenSWUpdates(options = {}) {
  if (!("serviceWorker" in navigator)) {
    console.log("[SW Update] Service Worker not supported");
    return;
  }
  navigator.serviceWorker.addEventListener("message", (event) => {
    console.log("[SW Update] Message received:", event.data);
    if (event.data?.type === "SW_UPDATE_READY") {
      console.log("[SW Update] 🔄 Update available!");
      if (options.onUpdateAvailable) {
        options.onUpdateAvailable();
      }
      if (options.autoReload) {
        applyUpdate();
      }
    }
  });
  console.log("[SW Update] ✅ Listening for updates");
}
async function applyUpdate() {
  if (!("serviceWorker" in navigator)) return;
  try {
    const registration = await navigator.serviceWorker.getRegistration();
    if (!registration || !registration.waiting) {
      console.log("[SW Update] No pending update");
      return;
    }
    console.log("[SW Update] 🔄 Applying update...");
    registration.waiting.postMessage({ type: "SKIP_WAITING" });
    navigator.serviceWorker.addEventListener("controllerchange", () => {
      console.log("[SW Update] ✅ Controller changed, reloading...");
      window.location.reload();
    }, { once: true });
  } catch (error) {
    console.error("[SW Update] ❌ Error applying update:", error);
  }
}

const UpdateBanner = () => {
  const [showBanner, setShowBanner] = reactExports.useState(false);
  reactExports.useEffect(() => {
    listenSWUpdates({
      onUpdateAvailable: () => {
        console.log("[UpdateBanner] Update available, showing banner");
        setShowBanner(true);
      },
      autoReload: false
      // Manual user action required
    });
  }, []);
  if (!showBanner) return null;
  const handleUpdate = () => {
    console.log("[UpdateBanner] User triggered update");
    applyUpdate();
  };
  const handleDismiss = () => {
    console.log("[UpdateBanner] User dismissed banner");
    setShowBanner(false);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-[9999] animate-in slide-in-from-bottom-5", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-gradient-to-r from-[#4361ee] to-[#7209b7] rounded-xl shadow-2xl border border-white/20 p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-10 h-10 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(RefreshCw, { className: "w-5 h-5 text-white" }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "font-bold text-white text-sm", children: "Nuova versione disponibile" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-white/80 text-xs mt-1", children: "Un aggiornamento è pronto. Aggiorna ora per le ultime funzionalità." }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2 mt-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleUpdate,
            size: "sm",
            className: "bg-white text-[#4361ee] hover:bg-white/90 font-semibold",
            children: "Aggiorna"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleDismiss,
            size: "sm",
            variant: "ghost",
            className: "text-white hover:bg-white/20",
            children: "Dopo"
          }
        )
      ] })
    ] })
  ] }) }) });
};

const RouteAnnouncer = () => {
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      id: "route-announcer",
      role: "status",
      "aria-live": "polite",
      "aria-atomic": "true",
      className: "sr-only"
    }
  );
};

const ROUTE_TITLES_IT = {
  "/": "Home",
  "/home": "Home",
  "/map": "Mappa",
  "/buzz": "Buzz",
  "/intelligence": "Intelligence",
  "/notifications": "Notifiche",
  "/leaderboard": "Classifica",
  "/profile": "Profilo",
  "/settings": "Impostazioni",
  "/subscriptions": "Abbonamenti",
  "/login": "Accesso",
  "/register": "Registrazione"
};
function getRouteTitle(path, locale = "it") {
  const title = ROUTE_TITLES_IT[path];
  if (title) {
    return title;
  }
  return path.replace(/^\//, "").replace(/-/g, " ").replace(/\//g, " › ").trim() || "Home";
}

const useRouteAnnouncements = () => {
  const [location] = useLocation();
  const timeoutRef = reactExports.useRef(null);
  const lastAnnouncedRef = reactExports.useRef("");
  reactExports.useEffect(() => {
    const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    timeoutRef.current = setTimeout(() => {
      const announcer = document.getElementById("route-announcer");
      if (!announcer) {
        console.warn("[RouteAnnouncer] #route-announcer element not found");
        return;
      }
      const routeTitle = getRouteTitle(location);
      const announcement = `Navigato a ${routeTitle}`;
      if (announcement === lastAnnouncedRef.current) {
        return;
      }
      announcer.textContent = "";
      setTimeout(() => {
        announcer.textContent = announcement;
        lastAnnouncedRef.current = announcement;
        if (!prefersReducedMotion) {
          console.log(`♿ [A11y] ${announcement}`);
        }
      }, 50);
    }, 100);
    return () => {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current);
      }
    };
  }, [location]);
};

const ReconnectBadge = () => {
  const [isVisible, setIsVisible] = reactExports.useState(false);
  const [isBottom, setIsBottom] = reactExports.useState(false);
  const [hideTimeout, setHideTimeout] = reactExports.useState(null);
  const throttleTimeout = reactExports.useRef(null);
  const lastEvent = reactExports.useRef("");
  reactExports.useEffect(() => {
    if (!isVisible) return;
    const checkToastPresence = () => {
      const hasToast = document.body.hasAttribute("data-has-toast") || document.querySelector("[data-sonner-toaster]") !== null || document.querySelector(".sonner") !== null;
      setIsBottom(hasToast);
    };
    checkToastPresence();
    const interval = setInterval(checkToastPresence, 500);
    return () => clearInterval(interval);
  }, [isVisible]);
  reactExports.useEffect(() => {
    const handleReconnecting = (detail) => {
      const eventKey = `reconnecting:${detail.channelName || "global"}:${detail.timestamp}`;
      if (lastEvent.current === eventKey) {
        return;
      }
      if (throttleTimeout.current) {
        return;
      }
      lastEvent.current = eventKey;
      throttleTimeout.current = setTimeout(() => {
        throttleTimeout.current = null;
      }, 300);
      setIsVisible(true);
      if (hideTimeout) {
        clearTimeout(hideTimeout);
      }
      const timeout = setTimeout(() => {
        setIsVisible(false);
        lastEvent.current = "";
      }, 3e3);
      setHideTimeout(timeout);
    };
    const unsubscribeReconnecting = onReconnectEvent(RECONNECT_EVENTS.RECONNECTING, handleReconnecting);
    const unsubscribeSubscribed = onReconnectEvent(RECONNECT_EVENTS.SUBSCRIBED, () => {
      if (hideTimeout) {
        clearTimeout(hideTimeout);
      }
      if (throttleTimeout.current) {
        clearTimeout(throttleTimeout.current);
        throttleTimeout.current = null;
      }
      setIsVisible(false);
      lastEvent.current = "";
    });
    const unsubscribeError = onReconnectEvent(RECONNECT_EVENTS.ERROR, () => {
      if (hideTimeout) {
        clearTimeout(hideTimeout);
      }
    });
    return () => {
      unsubscribeReconnecting();
      unsubscribeSubscribed();
      unsubscribeError();
      if (hideTimeout) {
        clearTimeout(hideTimeout);
      }
      if (throttleTimeout.current) {
        clearTimeout(throttleTimeout.current);
      }
    };
  }, [hideTimeout]);
  if (!isVisible) {
    return null;
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `reconnect-badge ${isBottom ? "reconnect-bottom" : ""}`, children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "reconnect-badge-content", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "svg",
      {
        className: "reconnect-badge-spinner",
        width: "16",
        height: "16",
        viewBox: "0 0 24 24",
        fill: "none",
        xmlns: "http://www.w3.org/2000/svg",
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "path",
          {
            d: "M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83",
            stroke: "currentColor",
            strokeWidth: "2",
            strokeLinecap: "round",
            strokeLinejoin: "round"
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "reconnect-badge-text", children: "Reconnecting…" })
  ] }) });
};

const CONNECTION_STATE_COLORS = {
  INIT: "bg-gray-500",
  CONNECTING: "bg-yellow-500",
  SUBSCRIBED: "bg-green-500",
  HEARTBEAT: "bg-blue-500 animate-pulse",
  ERROR: "bg-red-500",
  CLOSED: "bg-gray-700"
};
const CONNECTION_STATE_LABELS = {
  INIT: "Initializing",
  CONNECTING: "Connecting...",
  SUBSCRIBED: "Connected",
  HEARTBEAT: "Heartbeat ♥",
  ERROR: "Error",
  CLOSED: "Disconnected"
};
const M1UnitsDebugPanel = () => {
  const [userId, setUserId] = reactExports.useState(void 0);
  const [logs, setLogs] = reactExports.useState([]);
  const [showPanel, setShowPanel] = reactExports.useState(false);
  const [isExpanded, setIsExpanded] = reactExports.useState(false);
  reactExports.useEffect(() => {
    const isDev = window.location.hostname === "localhost";
    const devAccess = localStorage.getItem("developer_access") === "true";
    setShowPanel(isDev || devAccess);
  }, []);
  reactExports.useEffect(() => {
    const getUser = async () => {
      const { data } = await supabase.auth.getUser();
      if (data.user) {
        setUserId(data.user.id);
        addLog(`User ID: ${data.user.id}`);
      } else {
        addLog("No authenticated user");
      }
    };
    getUser();
  }, []);
  const { unitsData, connectionState, isLoading, error, ping, refetch } = useM1UnitsRealtime(userId);
  const addLog = (message) => {
    const timestamp = (/* @__PURE__ */ new Date()).toLocaleTimeString();
    setLogs((prev) => [`[${timestamp}] ${message}`, ...prev.slice(0, 19)]);
  };
  reactExports.useEffect(() => {
    if (connectionState !== "INIT") {
      addLog(`Connection: ${CONNECTION_STATE_LABELS[connectionState]}`);
    }
  }, [connectionState]);
  reactExports.useEffect(() => {
    if (unitsData) {
      addLog(`Balance updated: ${unitsData.balance} M1U`);
    }
  }, [unitsData?.balance]);
  reactExports.useEffect(() => {
    if (error) {
      addLog(`❌ Error: ${error}`);
    }
  }, [error]);
  const handlePing = async () => {
    addLog("🏓 Sending ping...");
    await ping();
  };
  const handleFakeUpdate = async () => {
    if (!userId) return;
    addLog("🎭 Triggering fake update (+1 M1U)...");
    const { error: updateError } = await supabase.rpc("m1u_fake_update", { _delta: 1 });
    if (updateError) {
      addLog(`❌ Fake update failed: ${updateError.message}`);
    } else {
      addLog("✅ Fake update sent (+1 M1U)");
      await refetch();
    }
  };
  const handleRefetch = async () => {
    addLog("🔄 Refetching data...");
    await refetch();
  };
  if (!showPanel) return null;
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed bottom-4 right-4 z-[9999] max-w-md", children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: "bg-black/90 border-cyan-500/50 backdrop-blur-sm", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardHeader, { className: "pb-3 cursor-pointer", onClick: () => setIsExpanded(!isExpanded), children: /* @__PURE__ */ jsxRuntimeExports.jsxs(CardTitle, { className: "text-cyan-400 text-sm font-mono flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "flex items-center gap-2", children: [
        "M1U DEBUG PANEL",
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-cyan-300/60 text-xs", children: isExpanded ? "▼" : "▶" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Badge, { className: CONNECTION_STATE_COLORS[connectionState], children: CONNECTION_STATE_LABELS[connectionState] })
    ] }) }),
    isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsxs(CardContent, { className: "space-y-3 animate-accordion-down", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-cyan-950/30 p-3 rounded border border-cyan-500/30", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-cyan-300/70 mb-1", children: "Current Balance" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-2xl font-bold text-cyan-400", children: isLoading ? "..." : unitsData ? `${unitsData.balance} M1U` : "No data" }),
        unitsData && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-xs text-cyan-300/50 mt-1", children: [
          "Earned: ",
          unitsData.total_earned,
          " | Spent: ",
          unitsData.total_spent
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handlePing,
            disabled: !userId || connectionState === "ERROR",
            size: "sm",
            variant: "outline",
            className: "flex-1 border-cyan-500/50 text-cyan-400 hover:bg-cyan-950/30",
            children: "Ping"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleFakeUpdate,
            disabled: !userId || connectionState === "ERROR",
            size: "sm",
            variant: "outline",
            className: "flex-1 border-yellow-500/50 text-yellow-400 hover:bg-yellow-950/30",
            children: "Fake Update"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          Button,
          {
            onClick: handleRefetch,
            disabled: !userId,
            size: "sm",
            variant: "outline",
            className: "flex-1 border-gray-500/50 text-gray-400 hover:bg-gray-950/30",
            children: "Refetch"
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-black/50 p-2 rounded border border-cyan-500/20 max-h-40 overflow-y-auto", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-cyan-300/70 mb-1", children: "Console Log" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-1 font-mono text-xs", children: logs.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-gray-500", children: "Waiting for events..." }) : logs.map((log, i) => /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-cyan-300/80", children: log }, i)) })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-cyan-300/50 text-center font-mono", children: userId ? `Channel: m1_units_user_${userId.slice(0, 8)}...` : "Not authenticated" })
    ] })
  ] }) });
};

const GA4_ID = "G-XXXXXXXXXX";
let gaInitialized = false;
function initGA4() {
  if (gaInitialized || typeof window === "undefined") return;
  const consent = getStoredConsent();
  const hasConsent = consent?.status === "accepted" || consent?.status === "granular" && consent?.preferences?.analytics;
  if (!hasConsent) {
    console.log("[GA4] Analytics disabled - no consent");
    return;
  }
  const script = document.createElement("script");
  script.async = true;
  script.src = `https://www.googletagmanager.com/gtag/js?id=${GA4_ID}`;
  document.head.appendChild(script);
  window.dataLayer = window.dataLayer || [];
  function gtag(...args) {
    window.dataLayer.push(args);
  }
  gtag("js", /* @__PURE__ */ new Date());
  gtag("config", GA4_ID, {
    anonymize_ip: true,
    allow_ad_personalization_signals: false
  });
  window.gtag = gtag;
  gaInitialized = true;
  console.log("[GA4] Initialized:", GA4_ID);
}
function trackEvent(eventName, params) {
  if (!gaInitialized || typeof window === "undefined") return;
  const gtag = window.gtag;
  if (gtag) {
    gtag("event", eventName, params);
    console.log("[GA4] Event tracked:", eventName, params);
  }
}
function trackPageView(path, title) {
  if (!gaInitialized) return;
  trackEvent("page_view", {
    page_path: path,
    page_title: document.title
  });
}
function trackMarkerRewardClaimed(markerId, rewardType) {
  trackEvent("marker_reward_claimed", {
    marker_id: markerId,
    reward_type: rewardType,
    timestamp: (/* @__PURE__ */ new Date()).toISOString()
  });
}

const ga4 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  initGA4,
  trackEvent,
  trackMarkerRewardClaimed,
  trackPageView
}, Symbol.toStringTag, { value: 'Module' }));

function App() {
  const [location] = useLocation();
  reactExports.useEffect(() => {
    initGA4();
  }, []);
  reactExports.useEffect(() => {
    if (location) {
      trackPageView(location);
    }
  }, [location]);
  useRouteAnnouncements();
  reactExports.useEffect(() => {
    console.log("🍎 [iOS DEBUG] App rendering started");
    console.log("🍎 [iOS DEBUG] Environment:", {
      userAgent: navigator.userAgent,
      isStandalone: window.matchMedia("(display-mode: standalone)").matches,
      protocol: window.location.protocol,
      viewport: { width: window.innerWidth, height: window.innerHeight },
      pathname: window.location.pathname,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    });
    const styles = getComputedStyle(document.documentElement);
    console.log("🍎 [iOS DEBUG] CSS Variables:", {
      background: styles.getPropertyValue("--background").trim(),
      color: styles.getPropertyValue("--foreground").trim(),
      hasBackground: !!styles.getPropertyValue("--background").trim(),
      hasColor: !!styles.getPropertyValue("--foreground").trim()
    });
  }, []);
  usePWAStabilizer();
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "app-shell m1-app-bg relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "m1-grain" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(PushFrozenNotice, {}),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "ios-safe-top" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(ErrorBoundary$1, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen flex items-center justify-center bg-black text-white p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "glass-card p-6 max-w-md mx-auto text-center", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl font-bold mb-4", children: "ERRORE CRITICO DI SISTEMA" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "mb-6", children: "L'applicazione ha riscontrato un errore fatale. Ricarica la pagina." }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => {
            localStorage.clear();
            sessionStorage.clear();
            window.location.reload();
          },
          className: "px-4 py-2 bg-gradient-to-r from-m1ssion-blue to-m1ssion-pink rounded-md",
          children: "🔄 RIAVVIA EMERGENZA"
        }
      )
    ] }) }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProductionSafetyWrapper, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(ProductionSafety, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(HelmetProvider, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(SkipToContent, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(OfflineIndicator, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(RouteAnnouncer, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(ReconnectBadge, {}),
      /* @__PURE__ */ jsxRuntimeExports.jsx(Router, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(SoundProvider, { children: /* @__PURE__ */ jsxRuntimeExports.jsx(AuthProvider, { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(InterestSignalsProvider, { children: [
        !localStorage.getItem("m1ssion_legal_consent") && /* @__PURE__ */ jsxRuntimeExports.jsx(LegalOnboarding, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(DNAManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(CookieConsentManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(WalkthroughManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(WouterRoutes, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(InstallPrompt, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(IOSPermissionManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(AndroidPushSetup, { className: "hidden" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(PushNotificationSetup, { className: "hidden" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(XpSystemManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(NorahProactiveManager, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(MissionBadgeInjector, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(Toaster, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(BadgeAuditReport, {}),
        /* @__PURE__ */ jsxRuntimeExports.jsx(M1UnitsDebugPanel, {})
      ] }) }) }) })
    ] }) }) }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(UpdateBanner, {})
  ] });
}

const intel_title$2 = "Intelligence";
const norah_placeholder$2 = "Ask Norah…";
const pills_ready$2 = "Suggestions ready ↑";
const cta_buzz$2 = "Do a BUZZ";
const cta_show_map$2 = "Show BUZZ Map";
const cta_plans$2 = "See plans";
const cta_prizes$2 = "See prizes";
const welcome_back_episode$2 = "Welcome back! Yesterday we were here: \"{{summary}}\". Shall we continue?";
const loading$2 = "Loading…";
const no_data$2 = "No data available";
const subscription_free$2 = "Free Plan";
const subscription_silver$2 = "Silver Plan";
const subscription_gold$2 = "Gold Plan";
const subscription_black$2 = "Black Plan";
const subscription_titanium$2 = "Titanium Plan";
const norah_ready$2 = "Norah Intelligence Ready";
const write_natural$2 = "Write in natural language. Ask anything about M1SSION.";
const processing$2 = "Processing...";
const speaking$2 = "Speaking...";
const tts_on$2 = "🔊 TTS ON";
const tts_off$2 = "🔇 TTS OFF";
const send_enter$2 = "Press Enter to send • Shortcut: A to open/close";
const clues_analyzed$2 = "clues analyzed";
const norah_ai_assistant$2 = "NORAH AI Assistant";
const assistant_description$2 = "Your intelligent companion for navigating M1SSION™. Ask questions, get strategic insights, and unlock the secrets of the hunt.";
const en = {
	intel_title: intel_title$2,
	norah_placeholder: norah_placeholder$2,
	pills_ready: pills_ready$2,
	cta_buzz: cta_buzz$2,
	cta_show_map: cta_show_map$2,
	cta_plans: cta_plans$2,
	cta_prizes: cta_prizes$2,
	welcome_back_episode: welcome_back_episode$2,
	loading: loading$2,
	no_data: no_data$2,
	subscription_free: subscription_free$2,
	subscription_silver: subscription_silver$2,
	subscription_gold: subscription_gold$2,
	subscription_black: subscription_black$2,
	subscription_titanium: subscription_titanium$2,
	norah_ready: norah_ready$2,
	write_natural: write_natural$2,
	processing: processing$2,
	speaking: speaking$2,
	tts_on: tts_on$2,
	tts_off: tts_off$2,
	send_enter: send_enter$2,
	clues_analyzed: clues_analyzed$2,
	norah_ai_assistant: norah_ai_assistant$2,
	assistant_description: assistant_description$2
};

const intel_title$1 = "Intelligence";
const norah_placeholder$1 = "Chiedi a Norah…";
const pills_ready$1 = "Suggerimenti pronti ↑";
const cta_buzz$1 = "Fai un BUZZ";
const cta_show_map$1 = "Mostra BUZZ Map";
const cta_plans$1 = "Vedi piani";
const cta_prizes$1 = "Vedi premi";
const welcome_back_episode$1 = "Bentornato! Ieri eravamo qui: \"{{summary}}\". Ripartiamo?";
const loading$1 = "Caricamento…";
const no_data$1 = "Nessun dato disponibile";
const subscription_free$1 = "Piano Free";
const subscription_silver$1 = "Piano Silver";
const subscription_gold$1 = "Piano Gold";
const subscription_black$1 = "Piano Black";
const subscription_titanium$1 = "Piano Titanium";
const norah_ready$1 = "Norah Intelligence Ready";
const write_natural$1 = "Scrivi in linguaggio naturale. Chiedi qualsiasi cosa su M1SSION.";
const processing$1 = "Processing...";
const speaking$1 = "Speaking...";
const tts_on$1 = "🔊 TTS ON";
const tts_off$1 = "🔇 TTS OFF";
const send_enter$1 = "Press Enter to send • Shortcut: A to open/close";
const clues_analyzed$1 = "indizi analizzati";
const norah_ai_assistant$1 = "NORAH AI Assistant";
const assistant_description$1 = "Il tuo compagno intelligente per navigare M1SSION™. Fai domande, ottieni intuizioni strategiche e sblocca i segreti della caccia.";
const it = {
	intel_title: intel_title$1,
	norah_placeholder: norah_placeholder$1,
	pills_ready: pills_ready$1,
	cta_buzz: cta_buzz$1,
	cta_show_map: cta_show_map$1,
	cta_plans: cta_plans$1,
	cta_prizes: cta_prizes$1,
	welcome_back_episode: welcome_back_episode$1,
	loading: loading$1,
	no_data: no_data$1,
	subscription_free: subscription_free$1,
	subscription_silver: subscription_silver$1,
	subscription_gold: subscription_gold$1,
	subscription_black: subscription_black$1,
	subscription_titanium: subscription_titanium$1,
	norah_ready: norah_ready$1,
	write_natural: write_natural$1,
	processing: processing$1,
	speaking: speaking$1,
	tts_on: tts_on$1,
	tts_off: tts_off$1,
	send_enter: send_enter$1,
	clues_analyzed: clues_analyzed$1,
	norah_ai_assistant: norah_ai_assistant$1,
	assistant_description: assistant_description$1
};

const intel_title = "Intelligence";
const norah_placeholder = "Demande à Norah…";
const pills_ready = "Suggestions prêtes ↑";
const cta_buzz = "Faire un BUZZ";
const cta_show_map = "Voir BUZZ Map";
const cta_plans = "Voir les forfaits";
const cta_prizes = "Voir les prix";
const welcome_back_episode = "Bon retour ! Hier, nous étions ici : \"{{summary}}\". On continue ?";
const loading = "Chargement…";
const no_data = "Aucune donnée disponible";
const subscription_free = "Forfait Free";
const subscription_silver = "Forfait Silver";
const subscription_gold = "Forfait Gold";
const subscription_black = "Forfait Black";
const subscription_titanium = "Forfait Titanium";
const norah_ready = "Norah Intelligence Ready";
const write_natural = "Écrivez en langage naturel. Posez des questions sur M1SSION.";
const processing = "Traitement...";
const speaking = "Parler...";
const tts_on = "🔊 TTS ON";
const tts_off = "🔇 TTS OFF";
const send_enter = "Appuyez sur Entrée pour envoyer • Raccourci : A pour ouvrir/fermer";
const clues_analyzed = "indices analysés";
const norah_ai_assistant = "NORAH AI Assistant";
const assistant_description = "Votre compagnon intelligent pour naviguer dans M1SSION™. Posez des questions, obtenez des insights stratégiques et débloquez les secrets de la chasse.";
const fr = {
	intel_title: intel_title,
	norah_placeholder: norah_placeholder,
	pills_ready: pills_ready,
	cta_buzz: cta_buzz,
	cta_show_map: cta_show_map,
	cta_plans: cta_plans,
	cta_prizes: cta_prizes,
	welcome_back_episode: welcome_back_episode,
	loading: loading,
	no_data: no_data,
	subscription_free: subscription_free,
	subscription_silver: subscription_silver,
	subscription_gold: subscription_gold,
	subscription_black: subscription_black,
	subscription_titanium: subscription_titanium,
	norah_ready: norah_ready,
	write_natural: write_natural,
	processing: processing,
	speaking: speaking,
	tts_on: tts_on,
	tts_off: tts_off,
	send_enter: send_enter,
	clues_analyzed: clues_analyzed,
	norah_ai_assistant: norah_ai_assistant,
	assistant_description: assistant_description
};

const STORAGE_KEY = "m1_locale";
const SUPPORTED = ["en", "it", "fr"];
function normalize(lang) {
  if (!lang || typeof lang !== "string") return "en";
  const lower = lang.toLowerCase();
  for (const code of SUPPORTED) {
    if (lower === code || lower.startsWith(code + "-")) return code;
  }
  return "en";
}
function getDeviceLocale() {
  const nav = globalThis?.navigator;
  const byList = Array.isArray(nav?.languages) && nav.languages.length > 0 ? nav.languages[0] : null;
  const raw = byList || nav?.language || nav?.userLanguage || "en";
  return normalize(raw);
}
function getSavedLocale() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? normalize(raw) : null;
  } catch {
    return null;
  }
}
function getDefaultLocale() {
  return getSavedLocale() ?? getDeviceLocale();
}
const resources = {
  en: { common: en },
  it: { common: it },
  fr: { common: fr }
};
let _initialized = false;
async function initI18n() {
  if (_initialized) return;
  const lng = getDefaultLocale();
  if (instance && initReactI18next) {
    await instance.use(initReactI18next).init({
      resources,
      lng,
      fallbackLng: "en",
      supportedLngs: SUPPORTED,
      ns: ["common"],
      defaultNS: "common",
      interpolation: { escapeValue: false }
      // Non tocchiamo detection plugin per non aggiungere dipendenze.
      // Rilevazione custom con getDefaultLocale().
    }).catch(() => {
    });
  }
  _initialized = true;
}
initI18n().catch(console.error);

const setupProductionConsole = () => {
  if (typeof window !== "undefined" && window.location.hostname !== "localhost") {
    const originalLog = console.log;
    const originalWarn = console.warn;
    const originalError = console.error;
    console.log = (...args) => {
      if (args.length > 0 && typeof args[0] === "string" && (args[0].includes("CRITICAL") || args[0].includes("ERROR"))) {
        originalLog.apply(console, args);
      }
    };
    console.warn = originalWarn;
    console.error = originalError;
    console.debug = () => {
    };
    console.info = () => {
    };
  }
};
const enableProductionOptimizations = () => {
  if (typeof window !== "undefined" && window.location.hostname !== "localhost") {
    Object.defineProperty(window, "__REACT_DEVTOOLS_GLOBAL_HOOK__", {
      value: { isDisabled: true }
    });
  }
};

async function getSupabaseBearer() {
  try {
    const { data } = await supabase.auth.getSession();
    return data?.session?.access_token ?? "";
  } catch {
    return "";
  }
}

const initDiagnostics = () => {
  const isDev = location.search.includes("M1_DIAG=1");
  if (!isDev) return;
  console.log("🔍 M1SSION™ Enhanced Diagnostics enabled");
  window.__M1_NOTIF_TEST__ = {
    ...window.__M1_NOTIF_TEST__,
    async dryRunPref(userId, max = 5, cooldownHours) {
      const qs = new URLSearchParams({
        user_id: userId,
        max: String(max),
        diag: "1"
      });
      if (cooldownHours != null) qs.set("cooldown", String(cooldownHours));
      const baseUrl = `${functionsBaseUrl}/notifier-engine`;
      const res = await fetch(`${baseUrl}/dry-run?${qs.toString()}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${await getSupabaseBearer()}`
        }
      });
      if (!res.ok) {
        const error = await res.text();
        console.error("🔍 [DRY-RUN] HTTP Error:", res.status, error);
        return { error: `HTTP ${res.status}: ${error}` };
      }
      const json = await res.json();
      if (Array.isArray(json?.candidates_sample) && json.candidates_sample.length > 0) {
        console.log("🎯 Notifier Engine - Top Candidates:");
        console.table(json.candidates_sample.map((c) => ({
          ID: c.id?.substring(0, 8) + "...",
          Title: c.title?.substring(0, 50) + "...",
          Score: c.score?.toFixed(2),
          Tags: c.tags?.slice(0, 3).join(","),
          Published: c.published_at ? new Date(c.published_at).toLocaleDateString() : "N/A"
        })));
      } else {
        console.log("🎯 Notifier Engine - No candidates found");
      }
      return json;
    },
    async triggerPrefFallback() {
      try {
        console.log("🔍 TEST: Triggering preferences fallback test...");
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error("No authenticated user");
        }
        const { data: candidates, error } = await supabase.rpc("fn_candidates_for_user", {
          p_user_id: user.id,
          p_limit: 3
        });
        if (error) {
          console.error("🔍 TEST: Error getting candidates:", error);
          return { error: error.message };
        }
        console.log("🔍 TEST: Found", candidates?.length || 0, "candidates:");
        console.table(candidates);
        return {
          success: true,
          user_id: user.id,
          candidates_count: candidates?.length || 0,
          candidates: candidates || []
        };
      } catch (error) {
        console.error("🔍 TEST: Error in triggerPrefFallback:", error);
        return { error: error.message };
      }
    },
    async checkQuota() {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          throw new Error("No authenticated user");
        }
        const { data: quota, error } = await supabase.from("notification_quota").select("*").eq("user_id", user.id).single();
        const result = {
          user_id: user.id,
          quota: quota || "No quota record",
          error: error?.message
        };
        console.log("🔍 TEST: User quota:", result);
        return result;
      } catch (error) {
        console.error("🔍 TEST: Error checking quota:", error);
        return { error: error.message };
      }
    },
    async testCandidates(userId) {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        const targetUserId = userId || user?.id;
        if (!targetUserId) {
          throw new Error("No user ID provided");
        }
        console.log("🔍 TEST: Testing candidates for user:", targetUserId);
        const { data: userTags, error: tagsError } = await supabase.from("v_user_resolved_tags").select("*").eq("user_id", targetUserId).single();
        const { data: feedItems, error: feedError } = await supabase.from("external_feed_items").select("id, title, tags, score, published_at").gte("published_at", new Date(Date.now() - 72 * 60 * 60 * 1e3).toISOString()).gte("score", 0.72).order("published_at", { ascending: false }).limit(10);
        const { data: candidates, error: candidatesError } = await supabase.rpc("fn_candidates_for_user", {
          p_user_id: targetUserId,
          p_limit: 5
        });
        const result = {
          user_id: targetUserId,
          user_tags: userTags || "No tags resolved",
          tags_error: tagsError?.message,
          feed_items_count: feedItems?.length || 0,
          feed_error: feedError?.message,
          recent_items: feedItems || [],
          candidates_count: candidates?.length || 0,
          candidates_error: candidatesError?.message,
          candidates: candidates || []
        };
        console.log("🔍 TEST: Candidates test result:", result);
        console.table(candidates);
        return result;
      } catch (error) {
        console.error("🔍 TEST: Error in testCandidates:", error);
        return { error: error.message };
      }
    }
  };
  console.log("🔍 [M1SSION DIAGNOSTICS] Available commands:");
  console.log('  - __M1_NOTIF_TEST__.dryRunPref("user-id") - Test notification preferences');
  console.log("  - __M1_NOTIF_TEST__.testCandidates() - Test candidates function");
  console.log("  - __M1_PUSH_TOGGLE__.refresh() - Refresh push toggle state");
  console.log("  - __M1_PUSH_TOGGLE__.get() - Get real push subscription status");
};

function isPushDisabled() {
  try {
    return localStorage.getItem("push:disable") === "1";
  } catch {
    return false;
  }
}
function disablePush() {
  try {
    localStorage.setItem("push:disable", "1");
    console.warn("[PUSH-KILL] Push notifications disabled by kill switch");
  } catch (error) {
    console.error("[PUSH-KILL] Failed to set kill switch:", error);
  }
}
function enablePush() {
  try {
    localStorage.removeItem("push:disable");
    console.log("[PUSH-KILL] Push notifications re-enabled");
  } catch (error) {
    console.error("[PUSH-KILL] Failed to remove kill switch:", error);
  }
}
function checkHotfixDisable() {
  try {
    if (window.location.search.includes("__noPush=1")) {
      disablePush();
      return true;
    }
    return false;
  } catch {
    return false;
  }
}
if (typeof window !== "undefined") {
  window.pushKillSwitch = {
    disable: disablePush,
    enable: enablePush,
    isDisabled: isPushDisabled,
    checkHotfix: checkHotfixDisable
  };
  console.log("🔧 Push kill switch available as: window.pushKillSwitch");
}

{
  __vitePreload(() => Promise.resolve({}),true?__vite__mapDeps([23]):void 0);
  window.__M1_NO_SHIM_DUMP__ = true;
}
if (typeof window !== "undefined") {
  window.__populateKB__ = populateKnowledgeBase;
  console.log("✅ [GLOBAL] window.__populateKB__ disponibile (main.tsx)");
}
initBadgeDiagnostics();
const ensureMainSWController = async () => {
  if (typeof navigator === "undefined" || !("serviceWorker" in navigator)) return;
  if (!location.hostname.endsWith(".pages.dev")) return;
  try {
    const ctrl = navigator.serviceWorker.controller?.scriptURL || "";
    console.log("[SW-GUARD] Current controller:", ctrl);
    if (!ctrl.endsWith("/sw.js")) {
      console.log("🔧 Pages.dev: Ensuring /sw.js as main controller");
      const registration = await navigator.serviceWorker.register("/sw.js", {
        scope: "/",
        updateViaCache: "none"
      });
      if (registration.waiting) {
        registration.waiting.postMessage({ type: "SKIP_WAITING" });
      }
      const reloadKey = "sw-main-reload";
      if (!sessionStorage.getItem(reloadKey)) {
        navigator.serviceWorker.addEventListener("controllerchange", () => {
          sessionStorage.setItem(reloadKey, "1");
          console.log("🔄 Controller changed to /sw.js, reloading...");
          location.reload();
        }, { once: true });
      }
    } else {
      console.log("✅ Main SW already controlling");
    }
  } catch (error) {
    console.warn("SW controller enforcement failed:", error);
  }
};
ensureMainSWController();
const initPWABadgeDiagnosticsSafely = async () => {
  if (typeof window !== "undefined") {
    try {
      const [
        { initPWABadgeDiagnostics, createBadgeTestHelpers },
        { initializeGlobalDebugHelpers }
      ] = await Promise.all([
        __vitePreload(() => Promise.resolve().then(() => pwaBadgeAudit),true?void 0:void 0),
        __vitePreload(() => import('./debugHelpers.DlDSHPue.js'),true?[]:void 0)
      ]);
      initPWABadgeDiagnostics();
      createBadgeTestHelpers();
      initializeGlobalDebugHelpers();
      console.log("✅ PWA Badge diagnostics initialized");
    } catch (err) {
      console.warn("PWA Badge diagnostics initialization failed:", err);
    }
  }
};
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", initPWABadgeDiagnosticsSafely);
} else {
  initPWABadgeDiagnosticsSafely();
}
const initPushSafely = async () => {
  try {
    if (checkHotfixDisable() || isPushDisabled()) {
      console.warn("[PUSH] Kill switch active, skipping push initialization");
      return;
    }
    if (!("serviceWorker" in navigator) || !("PushManager" in window)) {
      console.warn("[PUSH] Push notifications not supported");
      return;
    }
    let registration;
    try {
      const swReadyPromise = navigator.serviceWorker.ready;
      const timeoutPromise = new Promise(
        (_, reject) => setTimeout(() => reject(new Error("SW ready timeout")), 8e3)
      );
      registration = await Promise.race([swReadyPromise, timeoutPromise]);
      if (!registration?.active) {
        console.warn("[PUSH] No active service worker found, deferring");
        return;
      }
    } catch (swError) {
      console.warn("[PUSH] Service worker not ready:", swError);
      return;
    }
    console.log("[PUSH] Service worker ready, loading push modules safely");
    try {
      const pushModule = await __vitePreload(() => import('./testFcm.CE2PAImO.js'),true?__vite__mapDeps([24,1,2,3,6,5,7,8,9]):void 0);
      if (pushModule?.testFcmFlow) {
        window.testFcmFlow = pushModule.testFcmFlow;
        console.log("🔧 FCM Test available: window.testFcmFlow()");
      }
    } catch (importError) {
      console.warn("[PUSH] Push module import failed (non-critical):", importError);
    }
  } catch (error) {
    console.warn("[PUSH] Push initialization failed (non-critical):", error);
  }
};
setTimeout(() => {
  initPushSafely().catch(
    (err) => console.warn("[PUSH] Deferred push init error (non-critical):", err)
  );
}, 3e3);
setupProductionConsole();
setupProductionLogging();
enableProductionOptimizations();
if (typeof window !== "undefined") {
  __vitePreload(async () => { const {initPerformanceOptimizations} = await import('./performanceOptimizer.Dyv85dhK.js');return { initPerformanceOptimizations }},true?[]:void 0).then(({ initPerformanceOptimizations }) => {
    initPerformanceOptimizations();
  });
  __vitePreload(async () => { const {initAccessibilityEnhancements} = await import('./accessibilityEnhancer.B5k3Aywr.js');return { initAccessibilityEnhancements }},true?[]:void 0).then(({ initAccessibilityEnhancements }) => {
    initAccessibilityEnhancements();
  });
  {
    __vitePreload(async () => { const {monitoring} = await import('./productionMonitoring.CmJ7ihhv.js');return { monitoring }},true?__vite__mapDeps([25,22,1,2,3,6,5,7,8,9]):void 0).then(({ monitoring }) => {
      monitoring.trackFeature("app_initialization");
    });
  }
}
const initializeSentry = () => {
  if (typeof window !== "undefined" && window.location.hostname !== "localhost") {
    {
      console.warn("⚠️ Sentry DSN not configured in production");
    }
  }
};
initializeSentry();
if (typeof window !== "undefined") {
  window.__M1_DEBUG = Object.assign(window.__M1_DEBUG ?? {}, {
    env: {
      TERRAIN: true,
      CONTOUR: true,
      SUPABASE_URL: !!getSupabaseUrl(),
      SUPABASE_ANON_KEY: !!getSupabaseAnonKey()
    },
    presence: {
      status: "INIT",
      last: null,
      error: null,
      count: 0
    },
    terrain3D: {
      available: false,
      terrainUrl: "https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=VRJaVKMtkFdyVzhXCjBF",
      active: false
    },
    ping: (m) => console.log("[M1DEBUG]", m)
  });
  console.log('🐛 M1DEBUG bridge ready - window.__M1_DEBUG.ping("test")');
  console.log("🗺️  Terrain URL:", "CONFIGURED" );
}
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 2,
      refetchOnWindowFocus: false,
      staleTime: 5 * 60 * 1e3
      // 5 minutes
    }
  }
});
const initErrorOverlay = () => {
  if (!new URLSearchParams(window.location.search).get("diag")) return;
  if (new URLSearchParams(window.location.search).get("noerr") === "1") return;
  const showErrorOverlay = (error, context) => {
    const existing = document.getElementById("error-overlay");
    if (existing) existing.remove();
    const overlay = document.createElement("div");
    overlay.id = "error-overlay";
    overlay.style.cssText = `
      position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
      background: rgba(0,0,0,0.97); color: white; z-index: 999999;
      font-family: 'Courier New', monospace; padding: 20px;
      overflow: auto; font-size: 14px; backdrop-filter: blur(2px);
    `;
    const isStripeError = (error?.message || "").includes("getStripe");
    const isNetworkError = (error?.message || "").includes("Failed to fetch");
    const isSWError = (error?.message || "").includes("service worker");
    const getErrorType = () => {
      if (isStripeError) return "💳 STRIPE ERROR";
      if (isNetworkError) return "🌐 NETWORK ERROR";
      if (isSWError) return "⚙️ SERVICE WORKER ERROR";
      return "🚨 RUNTIME ERROR";
    };
    const getSuggestion = () => {
      if (isStripeError) return "💡 Prova a ricaricare con reset cache o controlla la configurazione Stripe";
      if (isNetworkError) return "💡 Verifica la connessione internet o riprova più tardi";
      if (isSWError) return "💡 Ricarica la pagina per risolvere i problemi del service worker";
      return "💡 Prova a ricaricare la pagina. Se il problema persiste, usa Reset App";
    };
    overlay.innerHTML = `
      <div style="max-width: 900px; margin: 0 auto;">
        <h2 style="color: #ff6b6b; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
          ${getErrorType()} (${context})
        </h2>
        <div style="background: #1a1a2e; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #4361ee;">
          <strong>${getSuggestion()}</strong>
        </div>
        <pre style="background: #0f0f23; padding: 15px; border-radius: 8px; white-space: pre-wrap; font-size: 12px; max-height: 300px; overflow: auto; border: 1px solid #333;">
${error?.stack || error?.message || String(error)}
        </pre>
        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
          <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                  style="background: #333; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
            ❌ Chiudi
          </button>
          <button onclick="if('caches' in window){caches.keys().then(n => n.forEach(name => caches.delete(name))).finally(() => window.location.reload());} else {window.location.reload();}" 
                  style="background: #4361ee; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
            🔄 Ricarica + Cache Reset
          </button>
          <button onclick="localStorage.setItem('push:disable', '1'); window.location.reload();" 
                  style="background: #f39c12; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
            🔔 Disabilita Push
          </button>
          <button onclick="localStorage.clear(); sessionStorage.clear(); window.location.href='/app-reset.html';" 
                  style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
            🔨 Reset App Completo
          </button>
          <button onclick="window.location.href='/?noerr=1'" 
                  style="background: #666; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
            🚫 Disabilita Overlay
          </button>
        </div>
        <div style="margin-top: 15px; padding: 10px; background: #16213e; border-radius: 6px; font-size: 11px; color: #a0a0a0;">
          <strong>Debug Info:</strong> ${navigator.userAgent.includes("Mobile") ? "📱 Mobile" : "🖥️ Desktop"} | 
          ${window.location.protocol === "capacitor:" ? "📱 Capacitor" : "🌐 Web"} | 
          SW: ${navigator.serviceWorker?.controller?.scriptURL?.split("/").pop() || "None"}
        </div>
      </div>
    `;
    document.body.appendChild(overlay);
  };
  window.addEventListener("error", (event) => {
    showErrorOverlay(event.error, "JavaScript Error");
  });
  window.addEventListener("unhandledrejection", (event) => {
    showErrorOverlay(event.reason, "Promise Rejection");
  });
};
const showM1Logo = () => {
  console.error(`
╔═══════════════════════════════════════╗
║                                       ║
║     ███╗   ███╗ ██╗                   ║
║     ████╗ ████║███║   M1SSION™        ║
║     ██╔████╔██║╚██║                   ║
║     ██║╚██╔╝██║ ██║   Caccia al       ║
║     ██║ ╚═╝ ██║ ██║   Tesoro          ║
║     ╚═╝     ╚═╝ ╚═╝                   ║
║                                       ║
║  © 2025 Joseph MULÉ - NIYVORA KFT™    ║
║                                       ║
╚═══════════════════════════════════════╝
  `);
  console.error("🎯 M1SSION™ Console Ready | Build: build-mijx2t6r");
};
if (typeof window !== "undefined") {
  showM1Logo();
}
const renderApp = () => {
  console.log("🚀 ENHANCED APP INITIALIZATION - Starting render");
  console.log("🔍 MAIN.TSX - Checking for potential reload causes");
  initErrorOverlay();
  const rootElement = document.getElementById("root");
  if (!rootElement) {
    console.error("❌ Root element not found!");
    const fallbackElement = document.createElement("div");
    fallbackElement.innerHTML = `
      <div style="padding: 20px; color: white; background: black; text-align: center;">
        <h1>🚨 CRITICAL ERROR</h1>
        <p>Root element not found. Please refresh the page.</p>
        <button onclick="window.location.reload()" style="background: #333; color: white; padding: 8px 16px; margin-top: 16px; border: none; border-radius: 4px; cursor: pointer;">
          🔄 Ricarica App
        </button>
      </div>
    `;
    document.body.appendChild(fallbackElement);
    return;
  }
  try {
    console.log("[BOOT] Creating React root with fail-open configuration");
    const root = client$1.createRoot(rootElement);
    root.render(
      /* @__PURE__ */ jsxRuntimeExports.jsx(I18nextProvider, { i18n: instance, children: /* @__PURE__ */ jsxRuntimeExports.jsx(QueryClientProvider, { client: queryClient, children: /* @__PURE__ */ jsxRuntimeExports.jsx(React$1.Suspense, { fallback: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "min-h-screen bg-background flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "text-center space-y-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground font-orbitron", children: "Inizializzazione M1SSION™..." }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-muted-foreground", children: "Se il caricamento si blocca, ricarica la pagina" })
      ] }) }), children: /* @__PURE__ */ jsxRuntimeExports.jsx(App, {}) }) }) })
    );
    console.log("✅ ENHANCED REACT APP MOUNTED SUCCESSFULLY");
    console.log("✅ PWA mode - no splash screen management needed");
  } catch (error) {
    console.error("[BOOT] CRITICAL ERROR RENDERING APP:", error);
    if (rootElement) {
      const errorDiv = document.createElement("div");
      errorDiv.style.cssText = `
        padding: 20px;
        color: white;
        background: linear-gradient(135deg, #000, #111);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      `;
      errorDiv.innerHTML = `
        <h1 style="color: #ff4444; margin-bottom: 20px;">🚨 ERRORE CRITICO DI SISTEMA</h1>
        <p style="margin-bottom: 20px; max-width: 500px;">
          L'applicazione M1SSION™ ha riscontrato un errore critico. 
          Usa i bottoni sotto per riavviare l'app.
        </p>
        <div style="margin-top: 20px;">
          <button 
            onclick="window.location.reload()" 
            style="
              background: linear-gradient(135deg, #4361ee, #7209b7);
              color: white;
              padding: 12px 24px;
              margin: 8px;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-size: 16px;
            "
          >
            🔄 Ricarica App
          </button>
          <button 
            onclick="localStorage.clear(); sessionStorage.clear(); window.location.reload();" 
            style="
              background: #333;
              color: white;
              padding: 12px 24px;
              margin: 8px;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-size: 16px;
            "
          >
            🔨 Reset Completo
          </button>
        </div>
        <details style="margin-top: 20px; max-width: 600px; text-align: left;">
          <summary style="cursor: pointer; margin-bottom: 10px; color: #aaa;">Dettagli tecnici</summary>
          <pre style="background: #111; padding: 10px; border-radius: 4px; overflow: auto; font-size: 12px;">${error?.stack || error?.message || String(error)}</pre>
        </details>
        <div style="margin-top: 30px; font-size: 12px; color: #666;">
          M1SSION™ © 2025 Joseph MULÉ – NIYVORA KFT™
        </div>
      `;
      rootElement.appendChild(errorDiv);
    }
  }
};
const log = (message, data) => {
  if (window.location.search.includes("debug=1")) {
    console.log(`[M1SSION-SW] ${message}`, data || "");
  }
};
const enforceAppSWController = async () => {
  if (!("serviceWorker" in navigator)) return;
  try {
    const controller = navigator.serviceWorker.controller;
    const isOnPagesdev = window.location.hostname.includes("pages.dev");
    log("[SW-ENFORCE] Current controller:", controller?.scriptURL || "none");
    log("[SW-ENFORCE] On Pages.dev:", isOnPagesdev);
    if (isOnPagesdev && (!controller || !controller.scriptURL.endsWith("/sw.js"))) {
      console.log("[SW-ENFORCE] 🔄 Re-registering main SW on Pages.dev...");
      const registrations = await navigator.serviceWorker.getRegistrations();
      for (const reg of registrations) {
        if (reg.scope === window.location.origin + "/" && !reg.active?.scriptURL.endsWith("/sw.js")) {
          console.log("[SW-ENFORCE] Clearing conflicting SW:", reg.active?.scriptURL);
          await reg.unregister();
        }
      }
      const registration = await navigator.serviceWorker.register("/sw.js", {
        scope: "/",
        updateViaCache: "none"
      });
      await registration.update();
      const showUpdateToast = () => {
        const toast = document.createElement("div");
        toast.style.cssText = `
          position: fixed; top: 20px; right: 20px; z-index: 999999;
          background: #4361ee; color: white; padding: 12px 20px;
          border-radius: 8px; font-family: sans-serif; font-size: 14px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        toast.textContent = "🔄 Aggiornamento app...";
        document.body.appendChild(toast);
        setTimeout(() => {
          toast.remove();
          window.location.reload();
        }, 1500);
      };
      navigator.serviceWorker.addEventListener("controllerchange", showUpdateToast, { once: true });
    } else {
      console.log("[SW-ENFORCE] ✅ Main SW already controlling or not on Pages.dev");
    }
  } catch (error) {
    console.warn("[SW-ENFORCE] Failed (non-critical):", error);
  }
};
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", () => {
    console.log("📄 DOM fully loaded - initializing enhanced app");
    initAppWithSWGuard();
  });
} else {
  console.log("📄 DOM already loaded - initializing enhanced app immediately");
  initAppWithSWGuard();
}
async function initAppWithSWGuard() {
  try {
    if (typeof window !== "undefined" && "serviceWorker" in navigator) {
      await enforceAppSWController();
      __vitePreload(() => import('./swControllerGuard.BOlw0Hgb.js'),true?[]:void 0).then(async ({ ensureAppSWController, logActiveSWs }) => {
        try {
          console.log("[MAIN] 🔄 Activating SW Controller Guard...");
          const success = await ensureAppSWController();
          await logActiveSWs();
          if (false) ;
          if (success) {
            console.log("[MAIN] ✅ SW Controller Guard activated successfully");
          } else {
            console.warn("[MAIN] ⚠️ SW Controller Guard failed but app continues");
          }
        } catch (error) {
          console.warn("[MAIN] SW guard failed (non-critical):", error);
        }
      });
    }
    renderApp();
  } catch (error) {
    console.error("[MAIN] Init with SW guard failed:", error);
    renderApp();
  }
}
if (typeof window !== "undefined") {
  setTimeout(() => {
    __vitePreload(async () => { const {initSilentAutoUpdate} = await import('./silentAutoUpdate.COQMiOr1.js');return { initSilentAutoUpdate }},true?[]:void 0).then(({ initSilentAutoUpdate }) => {
      initSilentAutoUpdate({
        debug: false
      }).catch((err) => {
        console.warn("[MAIN] Silent auto-update init failed (non-critical):", err);
      });
    });
  }, 2500);
  const initInterestSignals = () => {
    try {
      const isDebugMode = new URLSearchParams(window.location.search).get("M1_DIAG") === "1";
      if (isDebugMode) {
        console.log("📊 M1SSION Interest Signals - Debug mode active");
        __vitePreload(async () => { const {diagnostics: diagnostics2} = await import('./interestSignals.BiRej29D.js');return { diagnostics: diagnostics2 }},true?__vite__mapDeps([22,1,2,3,6,5,7,8,9]):void 0).then(({ diagnostics: diagnostics2 }) => {
          window.__M1_SIG__ = diagnostics2;
          console.log("📊 M1_SIG diagnostics available:", Object.keys(diagnostics2));
        });
      }
      __vitePreload(async () => { const {initAutoInterestSignals} = await import('./useAutoInterestSignals.DFpFZ3QE.js');return { initAutoInterestSignals }},true?__vite__mapDeps([21,2,22,1,3,6,5,7,8,9]):void 0).then(({ initAutoInterestSignals }) => {
        initAutoInterestSignals();
        if (isDebugMode) {
          console.log("📊 useAutoInterestSignals initialized");
        }
      }).catch((err) => {
        console.warn("[MAIN] Interest signals init failed (non-critical):", err);
      });
    } catch (error) {
      console.warn("[MAIN] Interest signals setup failed (non-critical):", error);
    }
  };
  setTimeout(initInterestSignals, 3e3);
  setTimeout(() => {
    initDiagnostics();
  }, 100);
}
let _lastErrorLog = 0;
let _errorLogCount = 0;
const ERROR_LOG_COOLDOWN = 1e3;
const MAX_ERROR_LOGS_PER_MINUTE = 5;
window.addEventListener("error", (event) => {
  const now = Date.now();
  if (now - _lastErrorLog > 6e4) {
    _errorLogCount = 0;
  }
  if (now - _lastErrorLog < ERROR_LOG_COOLDOWN || _errorLogCount >= MAX_ERROR_LOGS_PER_MINUTE) {
    return;
  }
  if (!event.error?.message && !event.filename && event.lineno === 0) {
    return;
  }
  _lastErrorLog = now;
  _errorLogCount++;
  console.error("🚨 GLOBAL ERROR:", {
    message: event.error?.message || "Unknown error",
    filename: event.filename || "n/a",
    lineno: event.lineno,
    colno: event.colno
  });
});
let _lastRejectionLog = 0;
let _rejectionLogCount = 0;
window.addEventListener("unhandledrejection", (event) => {
  const now = Date.now();
  if (now - _lastRejectionLog > 6e4) {
    _rejectionLogCount = 0;
  }
  if (now - _lastRejectionLog < ERROR_LOG_COOLDOWN || _rejectionLogCount >= MAX_ERROR_LOGS_PER_MINUTE) {
    return;
  }
  _lastRejectionLog = now;
  _rejectionLogCount++;
  console.error("🚨 UNHANDLED REJECTION:", {
    reason: event.reason instanceof Error ? event.reason.message : String(event.reason)
  });
});
if (typeof window !== "undefined") {
  console.log("🔍 ENHANCED ENVIRONMENT INFO:", {
    protocol: window.location.protocol,
    hostname: window.location.hostname,
    isCapacitor: window.location.protocol === "capacitor:",
    userAgent: navigator.userAgent,
    timestamp: (/* @__PURE__ */ new Date()).toISOString()
  });
  if (window.location.protocol === "capacitor:" || window.Capacitor) {
    __vitePreload(async () => { const {initializePWA} = await Promise.resolve().then(() => pwaNativeFunctions);return { initializePWA }},true?void 0:void 0).then(({ initializePWA }) => {
      initializePWA();
    });
  } else {
    __vitePreload(async () => { const {optimizePWATouchGestures} = await Promise.resolve().then(() => pwaNativeFunctions);return { optimizePWATouchGestures }},true?void 0:void 0).then(({ optimizePWATouchGestures }) => {
      optimizePWATouchGestures();
    });
  }
}

export { Select as $, Circle as A, Badge as B, Card as C, Database as D, ChevronUp as E, FileText as F, Gift as G, TriangleAlert as H, Input as I, Settings as J, Crosshair as K, Label$1 as L, MapPin as M, Plus as N, Trash2 as O, Play as P, Swords as Q, RefreshCw as R, Switch as S, Textarea as T, User as U, ChevronDown as V, CardDescription as W, X$1 as X, Activity as Y, ScrollArea as Z, Shield as _, useToast as a, SelectTrigger as a0, SelectValue as a1, SelectContent as a2, SelectItem as a3, clamp as a4, usePrevious as a5, cn as a6, LoaderCircle as a7, Zap as a8, Search as a9, invokePushFunction as aA, Smartphone as aB, AndroidPushSetup as aC, Bell as aD, useNativePushNotifications as aE, PushNotificationSetup as aF, Capacitor as aG, CreditCard as aH, Alert as aI, AlertDescription as aJ, EyeOff as aK, Eye as aL, Copy as aM, getProjectRef as aN, _typeof as aO, client as aP, ga4 as aQ, STAKE_TYPES as aa, STAKE_PERCENTS as ab, Coins as ac, Tabs as ad, TabsList as ae, TabsTrigger as af, TabsContent as ag, ShoppingCart as ah, useSafeNavigate as ai, ExternalLink as aj, acceptBattle as ak, CopyJsonButton as al, useGeolocation as am, useProfileImage as an, useNotificationManager as ao, usePerformanceSettings as ap, UnifiedHeader as aq, NotificationsBanner as ar, RotateCcw as as, M1UPill$1 as at, BottomNavigation as au, ArrowLeft as av, Send as aw, RadioGroup as ax, RadioGroupItem as ay, TestTube as az, CardHeader as b, CardTitle as c, CardContent as d, Clock as e, Button as f, Separator$1 as g, CircleAlert as h, functionsBaseUrl as i, enablePush$1 as j, createLucideIcon as k, useAuthContext as l, useM1UnitsRealtime as m, Lock as n, ue$1 as o, showInsufficientM1UToast as p, useBuzzApi as q, Target as r, supabase as s, emitSubscribed as t, useLocation as u, emitError as v, useUnifiedAuth as w, useLocalStorage as x, useDebugFlag as y, Users as z };
